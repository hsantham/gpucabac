cscope 15 $HOME/Desktop/hemanth/JM               0003067930
	@lcommon/inc/blk_prediction.h

18 #iâdeà
_BLK_PREDICTION_H_


19 
	#_BLK_PREDICTION_H_


	)

20 
	~"mbufãr.h
"

22 
compu‹_»sidue
 (
img³l
 **
curImg
, img³È**
mb_´ed
, **
mb_¼es
, 
mb_x
, 
Ýix_x
, 
width
, 
height
);

23 
§m¶e_»cÚ¡ruù
 (
img³l
 **
curImg
, img³È**
mb_´ed
, **
mb_¼es
, 
mb_x
, 
Ýix_x
, 
width
, 
height
, 
max_img³l_v®ue
, 
dq_b™s
);

	@lcommon/inc/config_common.h

15 #iâdeà
_CONFIG_COMMON_H_


16 
	#_CONFIG_COMMON_H_


	)

20 *
	mTok’Name
;

21 *
	mPÏû
;

22 
	mTy³
;

23 
	mDeçuÉ
;

24 
	m·¿m_lim™s
;

25 
	mmš_lim™
;

26 
	mmax_lim™
;

27 
	mch¬_size
;

28 } 
	tM­pšg
;

30 *
G‘CÚfigFžeCÚ‹Á
 (*
Fž’ame
);

31 
In™P¬ams
 (
M­pšg
 *
M­
);

32 
Te¡P¬ams
(
M­pšg
 *
M­
, 
b™d•th_qp_sÿË
[3]);

33 
Di¥ÏyP¬ams
(
M­pšg
 *
M­
, *
mes§ge
);

34 
P¬£CÚ‹Á
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
M­pšg
 *
M­
, *
buf
, 
bufsize
);

	@lcommon/inc/ctx_tables.h

16 
	#CTX_UNUSED
 {0,64}

	)

17 
	#CTX_UNDEF
 {0,63}

	)

19 #ifdeà
CONTEXT_INI_C


22 
	#NUM_CTX_MODELS_I
 1

	)

23 
	#NUM_CTX_MODELS_P
 3

	)

26 cÚ¡ 
	gINIT_MB_TYPE_I
[1][3][11][2] =

30 { { 20, -15} , { 2, 54} , { 3, 74} , 
CTX_UNUSED
 , { -28, 127} , { -23, 104} , { -6, 53} , { -1, 54} , { 7, 51} , CTX_UNUSED , CTX_UNUSED },

32 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

35 cÚ¡ 
	gINIT_MB_TYPE_P
[3][3][11][2] =

39 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

40 { { 23, 33} , { 23, 2} , { 21, 0} , 
CTX_UNUSED
 , { 1, 9} , { 0, 49} , { -37, 118} , { 5, 57} , { -13, 78} , { -11, 65} , { 1, 62} },

41 { { 26, 67} , { 16, 90} , { 9, 104} , 
CTX_UNUSED
 , { -46, 127} , { -20, 104} , { 1, 67} , { 18, 64} , { 9, 43} , { 29, 0} , CTX_UNUSED }

45 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

46 { { 22, 25} , { 34, 0} , { 16, 0} , 
CTX_UNUSED
 , { -2, 9} , { 4, 41} , { -29, 118} , { 2, 65} , { -6, 71} , { -13, 79} , { 5, 52} },

47 { { 57, 2} , { 41, 36} , { 26, 69} , 
CTX_UNUSED
 , { -45, 127} , { -15, 101} , { -4, 76} , { 26, 34} , { 19, 22} , { 40, 0} , CTX_UNUSED }

51 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

52 { { 29, 16} , { 25, 0} , { 14, 0} , 
CTX_UNUSED
 , { -10, 51} , { -3, 62} , { -27, 99} , { 26, 16} , { -4, 85} , { -24, 102} , { 5, 57} },

53 { { 54, 0} , { 37, 42} , { 12, 97} , 
CTX_UNUSED
 , { -32, 127} , { -22, 117} , { -2, 74} , { 20, 40} , { 20, 10} , { 29, 0} , CTX_UNUSED }

57 cÚ¡ 
	gINIT_B8_TYPE_I
[1][2][9][2] =

61 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

62 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

66 cÚ¡ 
	gINIT_B8_TYPE_P
[3][2][9][2] =

70 { 
CTX_UNUSED
 , { 12, 49} , CTX_UNUSED , { -4, 73} , { 17, 50} , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

71 { { -6, 86} , { -17, 95} , { -6, 61} , { 9, 45} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

75 { 
CTX_UNUSED
 , { 9, 50} , CTX_UNUSED , { -3, 70} , { 10, 54} , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

76 { { 6, 69} , { -13, 90} , { 0, 52} , { 8, 43} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

80 { 
CTX_UNUSED
 , { 6, 57} , CTX_UNUSED , { -17, 73} , { 14, 57} , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

81 { { -6, 93} , { -14, 88} , { -6, 44} , { 4, 55} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

85 cÚ¡ 
	gINIT_MV_RES_I
[1][2][10][2] =

89 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

90 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

94 cÚ¡ 
	gINIT_MV_RES_P
[3][2][10][2] =

98 { { -3, 69} , 
CTX_UNUSED
 , { -6, 81} , { -11, 96} , CTX_UNUSED , { 0, 58} , CTX_UNUSED , { -3, 76} , { -10, 94} , CTX_UNUSED },

99 { { 6, 55} , { 7, 67} , { -5, 86} , { 2, 88} , 
CTX_UNUSED
 , { 5, 54} , { 4, 69} , { -3, 81} , { 0, 88} , CTX_UNUSED }

103 { { -2, 69} , 
CTX_UNUSED
 , { -5, 82} , { -10, 96} , CTX_UNUSED , { 1, 56} , CTX_UNUSED , { -3, 74} , { -6, 85} , CTX_UNUSED },

104 { { 2, 59} , { 2, 75} , { -3, 87} , { -3, 100} , 
CTX_UNUSED
 , { 0, 59} , { -3, 81} , { -7, 86} , { -5, 95} , CTX_UNUSED }

108 { { -11, 89} , 
CTX_UNUSED
 , { -15, 103} , { -21, 116} , CTX_UNUSED , { 1, 63} , CTX_UNUSED , { -5, 85} , { -13, 106} , CTX_UNUSED },

109 { { 19, 57} , { 20, 58} , { 4, 84} , { 6, 96} , 
CTX_UNUSED
 , { 5, 63} , { 6, 75} , { -3, 90} , { -1, 101} , CTX_UNUSED }

113 cÚ¡ 
	gINIT_REF_NO_I
[1][2][6][2] =

117 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

118 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

122 cÚ¡ 
	gINIT_REF_NO_P
[3][2][6][2] =

127 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

132 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

137 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

142 cÚ¡ 
	gINIT_TRANSFORM_SIZE_I
[1][1][3][2]=

151 cÚ¡ 
	gINIT_TRANSFORM_SIZE_P
[3][1][3][2]=

170 cÚ¡ 
	gINIT_DELTA_QP_I
[1][1][4][2]=

177 cÚ¡ 
	gINIT_DELTA_QP_P
[3][1][4][2]=

193 cÚ¡ 
	gINIT_MB_AFF_I
[1][1][4][2] =

197 { { 0, 11} , { 1, 55} , { 0, 69} , 
CTX_UNUSED
 }

200 cÚ¡ 
	gINIT_MB_AFF_P
[3][1][4][2] =

204 { { 0, 45} , { -4, 78} , { -3, 96} , 
CTX_UNUSED
 }

208 { { 13, 15} , { 7, 51} , { 2, 80} , 
CTX_UNUSED
 }

212 { { 7, 34} , { -9, 88} , { -20, 127} , 
CTX_UNUSED
 }

216 cÚ¡ 
	gINIT_IPR_I
[1][1][2][2] =

224 cÚ¡ 
	gINIT_IPR_P
[3][1][2][2] =

240 cÚ¡ 
	gINIT_CIPR_I
[1][1][4][2] =

248 cÚ¡ 
	gINIT_CIPR_P
[3][1][4][2] =

264 cÚ¡ 
	gINIT_CBP_I
[1][3][4][2] =

274 cÚ¡ 
	gINIT_CBP_P
[3][3][4][2] =

296 cÚ¡ 
	gINIT_BCBP_I
[1][22][4][2] =

303 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

307 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

308 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

309 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

314 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

316 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

321 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

323 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

327 cÚ¡ 
	gINIT_BCBP_P
[3][22][4][2] =

334 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

338 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

339 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

340 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

345 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

347 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

352 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

354 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

361 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

365 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

366 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

367 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

372 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

374 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

379 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

381 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

388 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

392 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

393 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

394 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

399 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

401 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

406 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

408 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

412 cÚ¡ 
	gINIT_MAP_I
[1][22][15][2] =

417 { 
CTX_UNUSED
 , { 1, 50} , { 7, 52} , { 10, 35} , { 0, 44} , { 11, 38} , { 1, 45} , { 0, 46} , { 5, 44} , { 31, 17} , { 1, 51} , { 7, 50} , { 28, 19} , { 16, 33} , { 14, 62} },

419 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

420 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

422 { { -8, 102} , { -15, 100} , { 0, 95} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

423 { 
CTX_UNUSED
 , { -4, 75} , { 2, 72} , { -11, 75} , { -3, 71} , { 15, 46} , { -13, 69} , { 0, 62} , { 0, 65} , { 21, 37} , { -15, 72} , { 9, 57} , { 16, 54} , { 0, 62} , { 12, 72} },

424 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

425 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

428 { 
CTX_UNUSED
 , { 1, 50} , { 7, 52} , { 10, 35} , { 0, 44} , { 11, 38} , { 1, 45} , { 0, 46} , { 5, 44} , { 31, 17} , { 1, 51} , { 7, 50} , { 28, 19} , { 16, 33} , { 14, 62} },

430 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

431 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

435 { 
CTX_UNUSED
 , { 1, 50} , { 7, 52} , { 10, 35} , { 0, 44} , { 11, 38} , { 1, 45} , { 0, 46} , { 5, 44} , { 31, 17} , { 1, 51} , { 7, 50} , { 28, 19} , { 16, 33} , { 14, 62} },

437 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

438 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

443 cÚ¡ 
	gINIT_MAP_P
[3][22][15][2] =

448 { 
CTX_UNUSED
 , { 11, 35} , { 4, 64} , { 1, 61} , { 11, 35} , { 18, 25} , { 12, 24} , { 13, 29} , { 13, 36} , { -10, 93} , { -7, 73} , { -2, 73} , { 13, 46} , { 9, 49} , { -7, 100} },

450 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

451 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

453 { { 3, 64} , { 1, 61} , { 9, 63} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

454 { 
CTX_UNUSED
 , { 7, 50} , { 16, 39} , { 5, 44} , { 4, 52} , { 11, 48} , { -5, 60} , { -1, 59} , { 0, 59} , { 22, 33} , { 5, 44} , { 14, 43} , { -1, 78} , { 0, 60} , { 9, 69} },

455 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

456 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

459 { 
CTX_UNUSED
 , { 11, 35} , { 4, 64} , { 1, 61} , { 11, 35} , { 18, 25} , { 12, 24} , { 13, 29} , { 13, 36} , { -10, 93} , { -7, 73} , { -2, 73} , { 13, 46} , { 9, 49} , { -7, 100} },

461 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

462 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

466 { 
CTX_UNUSED
 , { 11, 35} , { 4, 64} , { 1, 61} , { 11, 35} , { 18, 25} , { 12, 24} , { 13, 29} , { 13, 36} , { -10, 93} , { -7, 73} , { -2, 73} , { 13, 46} , { 9, 49} , { -7, 100} },

468 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

469 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

475 { 
CTX_UNUSED
 , { -4, 66} , { -5, 78} , { -4, 71} , { -8, 72} , { 2, 59} , { -1, 55} , { -7, 70} , { -6, 75} , { -8, 89} , { -34, 119} , { -3, 75} , { 32, 20} , { 30, 22} , { -44, 127} },

477 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

478 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

480 { { -4, 71} , { 0, 58} , { 7, 61} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

481 { 
CTX_UNUSED
 , { 9, 41} , { 18, 25} , { 9, 32} , { 5, 43} , { 9, 47} , { 0, 44} , { 0, 51} , { 2, 46} , { 19, 38} , { -4, 66} , { 15, 38} , { 12, 42} , { 9, 34} , { 0, 89} },

482 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

483 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

486 { 
CTX_UNUSED
 , { -4, 66} , { -5, 78} , { -4, 71} , { -8, 72} , { 2, 59} , { -1, 55} , { -7, 70} , { -6, 75} , { -8, 89} , { -34, 119} , { -3, 75} , { 32, 20} , { 30, 22} , { -44, 127} },

488 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

489 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

493 { 
CTX_UNUSED
 , { -4, 66} , { -5, 78} , { -4, 71} , { -8, 72} , { 2, 59} , { -1, 55} , { -7, 70} , { -6, 75} , { -8, 89} , { -34, 119} , { -3, 75} , { 32, 20} , { 30, 22} , { -44, 127} },

495 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

496 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

502 { 
CTX_UNUSED
 , { -4, 44} , { -1, 69} , { 0, 62} , { -7, 51} , { -4, 47} , { -6, 42} , { -3, 41} , { -6, 53} , { 8, 76} , { -9, 78} , { -11, 83} , { 9, 52} , { 0, 67} , { -5, 90} },

504 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

505 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

507 { { 3, 65} , { -7, 69} , { 8, 77} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

508 { 
CTX_UNUSED
 , { -10, 66} , { 3, 62} , { -3, 68} , { -20, 81} , { 0, 30} , { 1, 7} , { -3, 23} , { -21, 74} , { 16, 66} , { -23, 124} , { 17, 37} , { 44, -18} , { 50, -34} , { -22, 127} },

509 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

510 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

513 { 
CTX_UNUSED
 , { -4, 44} , { -1, 69} , { 0, 62} , { -7, 51} , { -4, 47} , { -6, 42} , { -3, 41} , { -6, 53} , { 8, 76} , { -9, 78} , { -11, 83} , { 9, 52} , { 0, 67} , { -5, 90} },

515 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

516 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

520 { 
CTX_UNUSED
 , { -4, 44} , { -1, 69} , { 0, 62} , { -7, 51} , { -4, 47} , { -6, 42} , { -3, 41} , { -6, 53} , { 8, 76} , { -9, 78} , { -11, 83} , { 9, 52} , { 0, 67} , { -5, 90} },

522 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

523 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

528 cÚ¡ 
	gINIT_LAST_I
[1][22][15][2] =

533 { 
CTX_UNUSED
 , { 12, 38} , { 11, 45} , { 15, 39} , { 11, 42} , { 13, 44} , { 16, 45} , { 12, 41} , { 10, 49} , { 30, 34} , { 18, 42} , { 10, 55} , { 17, 51} , { 17, 46} , { 0, 89} },

534 { { 23, -13} , { 26, -13} , { 40, -15} , { 49, -14} , { 44, 3} , { 45, 6} , { 44, 34} , { 33, 54} , { 19, 82} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

535 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

536 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

538 { { 30, -6} , { 27, 3} , { 26, 22} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

539 { 
CTX_UNUSED
 , { 37, -16} , { 35, -4} , { 38, -8} , { 38, -3} , { 37, 3} , { 38, 5} , { 42, 0} , { 35, 16} , { 39, 22} , { 14, 48} , { 27, 37} , { 21, 60} , { 12, 68} , { 2, 97} },

540 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

541 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

544 { 
CTX_UNUSED
 , { 12, 38} , { 11, 45} , { 15, 39} , { 11, 42} , { 13, 44} , { 16, 45} , { 12, 41} , { 10, 49} , { 30, 34} , { 18, 42} , { 10, 55} , { 17, 51} , { 17, 46} , { 0, 89} },

545 { { 23, -13} , { 26, -13} , { 40, -15} , { 49, -14} , { 44, 3} , { 45, 6} , { 44, 34} , { 33, 54} , { 19, 82} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

546 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

547 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

551 { 
CTX_UNUSED
 , { 12, 38} , { 11, 45} , { 15, 39} , { 11, 42} , { 13, 44} , { 16, 45} , { 12, 41} , { 10, 49} , { 30, 34} , { 18, 42} , { 10, 55} , { 17, 51} , { 17, 46} , { 0, 89} },

552 { { 23, -13} , { 26, -13} , { 40, -15} , { 49, -14} , { 44, 3} , { 45, 6} , { 44, 34} , { 33, 54} , { 19, 82} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

553 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

554 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

559 cÚ¡ 
	gINIT_LAST_P
[3][22][15][2] =

564 { 
CTX_UNUSED
 , { 6, 51} , { 6, 57} , { 7, 53} , { 6, 52} , { 6, 55} , { 11, 45} , { 14, 36} , { 8, 53} , { -1, 82} , { 7, 55} , { -3, 78} , { 15, 46} , { 22, 31} , { -1, 84} },

565 { { 9, -2} , { 26, -9} , { 33, -9} , { 39, -7} , { 41, -2} , { 45, 3} , { 49, 9} , { 45, 27} , { 36, 59} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

566 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

567 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

569 { { 1, 67} , { 5, 59} , { 9, 67} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

570 { 
CTX_UNUSED
 , { 16, 30} , { 18, 32} , { 18, 35} , { 22, 29} , { 24, 31} , { 23, 38} , { 18, 43} , { 20, 41} , { 11, 63} , { 9, 59} , { 9, 64} , { -1, 94} , { -2, 89} , { -9, 108} },

571 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

572 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

575 { 
CTX_UNUSED
 , { 6, 51} , { 6, 57} , { 7, 53} , { 6, 52} , { 6, 55} , { 11, 45} , { 14, 36} , { 8, 53} , { -1, 82} , { 7, 55} , { -3, 78} , { 15, 46} , { 22, 31} , { -1, 84} },

576 { { 9, -2} , { 26, -9} , { 33, -9} , { 39, -7} , { 41, -2} , { 45, 3} , { 49, 9} , { 45, 27} , { 36, 59} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

577 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

578 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

582 { 
CTX_UNUSED
 , { 6, 51} , { 6, 57} , { 7, 53} , { 6, 52} , { 6, 55} , { 11, 45} , { 14, 36} , { 8, 53} , { -1, 82} , { 7, 55} , { -3, 78} , { 15, 46} , { 22, 31} , { -1, 84} },

583 { { 9, -2} , { 26, -9} , { 33, -9} , { 39, -7} , { 41, -2} , { 45, 3} , { 49, 9} , { 45, 27} , { 36, 59} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

584 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

585 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

591 { 
CTX_UNUSED
 , { 33, -4} , { 29, 10} , { 37, -5} , { 51, -29} , { 39, -9} , { 52, -34} , { 69, -58} , { 67, -63} , { 44, -5} , { 32, 7} , { 55, -29} , { 32, 1} , { 0, 0} , { 27, 36} },

592 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

593 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

594 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

596 { { 0, 75} , { 2, 72} , { 8, 77} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

597 { 
CTX_UNUSED
 , { 14, 35} , { 18, 31} , { 17, 35} , { 21, 30} , { 17, 45} , { 20, 42} , { 18, 45} , { 27, 26} , { 16, 54} , { 7, 66} , { 16, 56} , { 11, 73} , { 10, 67} , { -10, 116} },

598 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

599 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

602 { 
CTX_UNUSED
 , { 33, -4} , { 29, 10} , { 37, -5} , { 51, -29} , { 39, -9} , { 52, -34} , { 69, -58} , { 67, -63} , { 44, -5} , { 32, 7} , { 55, -29} , { 32, 1} , { 0, 0} , { 27, 36} },

603 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

604 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

605 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

609 { 
CTX_UNUSED
 , { 33, -4} , { 29, 10} , { 37, -5} , { 51, -29} , { 39, -9} , { 52, -34} , { 69, -58} , { 67, -63} , { 44, -5} , { 32, 7} , { 55, -29} , { 32, 1} , { 0, 0} , { 27, 36} },

610 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

611 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

612 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

618 { 
CTX_UNUSED
 , { 8, 44} , { 11, 44} , { 14, 42} , { 7, 48} , { 4, 56} , { 4, 52} , { 13, 37} , { 9, 49} , { 19, 58} , { 10, 48} , { 12, 45} , { 0, 69} , { 20, 33} , { 8, 63} },

619 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

620 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

621 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

623 { { 20, 34} , { 19, 31} , { 27, 44} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

624 { 
CTX_UNUSED
 , { 19, 16} , { 15, 36} , { 15, 36} , { 21, 28} , { 25, 21} , { 30, 20} , { 31, 12} , { 27, 16} , { 24, 42} , { 0, 93} , { 14, 56} , { 15, 57} , { 26, 38} , { -24, 127} },

625 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

626 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

629 { 
CTX_UNUSED
 , { 8, 44} , { 11, 44} , { 14, 42} , { 7, 48} , { 4, 56} , { 4, 52} , { 13, 37} , { 9, 49} , { 19, 58} , { 10, 48} , { 12, 45} , { 0, 69} , { 20, 33} , { 8, 63} },

630 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

631 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

632 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

636 { 
CTX_UNUSED
 , { 8, 44} , { 11, 44} , { 14, 42} , { 7, 48} , { 4, 56} , { 4, 52} , { 13, 37} , { 9, 49} , { 19, 58} , { 10, 48} , { 12, 45} , { 0, 69} , { 20, 33} , { 8, 63} },

637 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

638 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

639 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

644 cÚ¡ 
	gINIT_ONE_I
[1][22][5][2] =

651 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

655 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

656 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

657 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

662 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

664 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

669 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

671 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

675 cÚ¡ 
	gINIT_ONE_P
[3][22][5][2] =

682 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

686 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

687 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

688 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

693 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

695 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

700 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

702 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

709 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

713 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

714 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

715 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

720 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

722 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

727 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

729 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

736 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

740 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

741 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

742 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

747 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

749 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

754 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

756 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

760 cÚ¡ 
	gINIT_ABS_I
[1][22][5][2] =

767 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

769 { { -13, 86} , { -13, 96} , { -11, 97} , { -19, 117} , 
CTX_UNUSED
 },

771 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

772 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

773 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

778 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

780 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

785 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

787 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

791 cÚ¡ 
	gINIT_ABS_P
[3][22][5][2] =

798 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

800 { { -2, 58} , { -3, 72} , { -3, 81} , { -11, 97} , 
CTX_UNUSED
 },

802 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

803 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

804 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

809 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

811 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

816 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

818 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

825 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

827 { { -2, 55} , { -2, 67} , { 0, 73} , { -8, 89} , 
CTX_UNUSED
 },

829 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

830 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

831 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

836 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

838 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

843 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

845 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

852 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

854 { { -13, 78} , { -9, 83} , { -4, 81} , { -13, 99} , 
CTX_UNUSED
 },

856 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

857 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

858 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

863 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

865 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

870 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

872 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED }

878 #ià
ENABLE_FIELD_CTX


879 cÚ¡ 
	gINIT_FLD_MAP_I
[1][22][15][2] =

884 { 
CTX_UNUSED
 , { 10, 44} , { -7, 62} , { 15, 36} , { 14, 40} , { 16, 27} , { 12, 29} , { 1, 44} , { 20, 36} , { 18, 32} , { 5, 42} , { 1, 48} , { 10, 62} , { 17, 46} , { 9, 64} },

886 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

887 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

889 { { -7, 99} , { -14, 95} , { 2, 95} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

890 { 
CTX_UNUSED
 , { 0, 76} , { -5, 74} , { 0, 70} , { -11, 75} , { 1, 68} , { 0, 65} , { -14, 73} , { 3, 62} , { 4, 62} , { -1, 68} , { -13, 75} , { 11, 55} , { 5, 64} , { 12, 70} },

891 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

892 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

895 { 
CTX_UNUSED
 , { 10, 44} , { -7, 62} , { 15, 36} , { 14, 40} , { 16, 27} , { 12, 29} , { 1, 44} , { 20, 36} , { 18, 32} , { 5, 42} , { 1, 48} , { 10, 62} , { 17, 46} , { 9, 64} },

897 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

898 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

902 { 
CTX_UNUSED
 , { 10, 44} , { -7, 62} , { 15, 36} , { 14, 40} , { 16, 27} , { 12, 29} , { 1, 44} , { 20, 36} , { 18, 32} , { 5, 42} , { 1, 48} , { 10, 62} , { 17, 46} , { 9, 64} },

904 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

905 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

910 cÚ¡ 
	gINIT_FLD_MAP_P
[3][22][15][2] =

915 { 
CTX_UNUSED
 , { -9, 93} , { -22, 94} , { -5, 86} , { 9, 67} , { -4, 80} , { -10, 85} , { -1, 70} , { 7, 60} , { 9, 58} , { 5, 61} , { 12, 50} , { 15, 50} , { 18, 49} , { 17, 54} },

917 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

918 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

920 { { -2, 69} , { -2, 59} , { 6, 70} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

921 { 
CTX_UNUSED
 , { 10, 44} , { 9, 31} , { 12, 43} , { 3, 53} , { 14, 34} , { 10, 38} , { -3, 52} , { 13, 40} , { 17, 32} , { 7, 44} , { 7, 38} , { 13, 50} , { 10, 57} , { 26, 43} },

922 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

923 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

926 { 
CTX_UNUSED
 , { -9, 93} , { -22, 94} , { -5, 86} , { 9, 67} , { -4, 80} , { -10, 85} , { -1, 70} , { 7, 60} , { 9, 58} , { 5, 61} , { 12, 50} , { 15, 50} , { 18, 49} , { 17, 54} },

928 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

929 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

933 { 
CTX_UNUSED
 , { -9, 93} , { -22, 94} , { -5, 86} , { 9, 67} , { -4, 80} , { -10, 85} , { -1, 70} , { 7, 60} , { 9, 58} , { 5, 61} , { 12, 50} , { 15, 50} , { 18, 49} , { 17, 54} },

935 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

936 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

942 { 
CTX_UNUSED
 , { -17, 111} , { -28, 114} , { -6, 89} , { -2, 80} , { -4, 82} , { -9, 85} , { -8, 81} , { -1, 72} , { 5, 64} , { 1, 67} , { 9, 56} , { 0, 69} , { 1, 69} , { 7, 69} },

944 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

945 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

947 { { -1, 70} , { -9, 72} , { 14, 60} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

948 { 
CTX_UNUSED
 , { 16, 37} , { 0, 47} , { 18, 35} , { 11, 37} , { 12, 41} , { 10, 41} , { 2, 48} , { 12, 41} , { 13, 41} , { 0, 59} , { 3, 50} , { 19, 40} , { 3, 66} , { 18, 50} },

949 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

950 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

953 { 
CTX_UNUSED
 , { -17, 111} , { -28, 114} , { -6, 89} , { -2, 80} , { -4, 82} , { -9, 85} , { -8, 81} , { -1, 72} , { 5, 64} , { 1, 67} , { 9, 56} , { 0, 69} , { 1, 69} , { 7, 69} },

955 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

956 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

960 { 
CTX_UNUSED
 , { -17, 111} , { -28, 114} , { -6, 89} , { -2, 80} , { -4, 82} , { -9, 85} , { -8, 81} , { -1, 72} , { 5, 64} , { 1, 67} , { 9, 56} , { 0, 69} , { 1, 69} , { 7, 69} },

962 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

963 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

969 { 
CTX_UNUSED
 , { -13, 106} , { -50, 127} , { -5, 92} , { 17, 57} , { -5, 86} , { -13, 94} , { -12, 91} , { -2, 77} , { 0, 71} , { -1, 73} , { 4, 64} , { -7, 81} , { 5, 64} , { 15, 57} },

971 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

972 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

974 { { -2, 76} , { -18, 86} , { 12, 70} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

975 { 
CTX_UNUSED
 , { 5, 64} , { -12, 70} , { 11, 55} , { 5, 56} , { 0, 69} , { 2, 65} , { -6, 74} , { 5, 54} , { 7, 54} , { -6, 76} , { -11, 82} , { -2, 77} , { -2, 77} , { 25, 42} },

976 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

977 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

980 { 
CTX_UNUSED
 , { -13, 106} , { -50, 127} , { -5, 92} , { 17, 57} , { -5, 86} , { -13, 94} , { -12, 91} , { -2, 77} , { 0, 71} , { -1, 73} , { 4, 64} , { -7, 81} , { 5, 64} , { 15, 57} },

982 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

983 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

987 { 
CTX_UNUSED
 , { -13, 106} , { -50, 127} , { -5, 92} , { 17, 57} , { -5, 86} , { -13, 94} , { -12, 91} , { -2, 77} , { 0, 71} , { -1, 73} , { 4, 64} , { -7, 81} , { 5, 64} , { 15, 57} },

989 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

990 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

995 cÚ¡ 
	gINIT_FLD_LAST_I
[1][22][15][2] =

1000 { 
CTX_UNUSED
 , { 24, 17} , { 21, 21} , { 25, 22} , { 31, 27} , { 22, 29} , { 19, 35} , { 14, 50} , { 10, 57} , { 7, 63} , { -2, 77} , { -4, 82} , { -3, 94} , { 9, 69} , { -12, 109} },

1001 { { 21, -10} , { 24, -11} , { 28, -8} , { 28, -1} , { 29, 3} , { 29, 9} , { 35, 20} , { 29, 36} , { 14, 67} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1002 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1003 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1005 { { 29, -3} , { 26, 0} , { 22, 30} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1006 { 
CTX_UNUSED
 , { 31, -7} , { 35, -15} , { 34, -3} , { 34, 3} , { 36, -1} , { 34, 5} , { 32, 11} , { 35, 5} , { 34, 12} , { 39, 11} , { 30, 29} , { 34, 26} , { 29, 39} , { 19, 66} },

1007 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1008 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1011 { 
CTX_UNUSED
 , { 24, 17} , { 21, 21} , { 25, 22} , { 31, 27} , { 22, 29} , { 19, 35} , { 14, 50} , { 10, 57} , { 7, 63} , { -2, 77} , { -4, 82} , { -3, 94} , { 9, 69} , { -12, 109} },

1012 { { 21, -10} , { 24, -11} , { 28, -8} , { 28, -1} , { 29, 3} , { 29, 9} , { 35, 20} , { 29, 36} , { 14, 67} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1013 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1014 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1018 { 
CTX_UNUSED
 , { 24, 17} , { 21, 21} , { 25, 22} , { 31, 27} , { 22, 29} , { 19, 35} , { 14, 50} , { 10, 57} , { 7, 63} , { -2, 77} , { -4, 82} , { -3, 94} , { 9, 69} , { -12, 109} },

1019 { { 21, -10} , { 24, -11} , { 28, -8} , { 28, -1} , { 29, 3} , { 29, 9} , { 35, 20} , { 29, 36} , { 14, 67} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1020 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1021 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1026 cÚ¡ 
	gINIT_FLD_LAST_P
[3][22][15][2] =

1031 { 
CTX_UNUSED
 , { 45, -24} , { 53, -45} , { 48, -26} , { 65, -43} , { 43, -19} , { 39, -10} , { 30, 9} , { 18, 26} , { 20, 27} , { 0, 57} , { -14, 82} , { -5, 75} , { -19, 97} , { -35, 125} },

1032 { { 21, -13} , { 33, -14} , { 39, -7} , { 46, -2} , { 51, 2} , { 60, 6} , { 61, 17} , { 55, 34} , { 42, 62} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1033 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1034 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1036 { { 8, 60} , { 6, 63} , { 17, 65} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1037 { 
CTX_UNUSED
 , { 21, 24} , { 23, 20} , { 26, 23} , { 27, 32} , { 28, 23} , { 28, 24} , { 23, 40} , { 24, 32} , { 28, 29} , { 23, 42} , { 19, 57} , { 22, 53} , { 22, 61} , { 11, 86} },

1038 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1039 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1042 { 
CTX_UNUSED
 , { 45, -24} , { 53, -45} , { 48, -26} , { 65, -43} , { 43, -19} , { 39, -10} , { 30, 9} , { 18, 26} , { 20, 27} , { 0, 57} , { -14, 82} , { -5, 75} , { -19, 97} , { -35, 125} },

1043 { { 21, -13} , { 33, -14} , { 39, -7} , { 46, -2} , { 51, 2} , { 60, 6} , { 61, 17} , { 55, 34} , { 42, 62} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1044 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1045 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1049 { 
CTX_UNUSED
 , { 45, -24} , { 53, -45} , { 48, -26} , { 65, -43} , { 43, -19} , { 39, -10} , { 30, 9} , { 18, 26} , { 20, 27} , { 0, 57} , { -14, 82} , { -5, 75} , { -19, 97} , { -35, 125} },

1050 { { 21, -13} , { 33, -14} , { 39, -7} , { 46, -2} , { 51, 2} , { 60, 6} , { 61, 17} , { 55, 34} , { 42, 62} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1051 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1052 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1058 { 
CTX_UNUSED
 , { 69, -71} , { 63, -63} , { 66, -64} , { 77, -74} , { 54, -39} , { 52, -35} , { 41, -10} , { 36, 0} , { 40, -1} , { 30, 14} , { 28, 26} , { 23, 37} , { 12, 55} , { 11, 65} },

1059 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1060 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1061 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1063 { { 12, 48} , { 11, 49} , { 26, 45} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1064 { 
CTX_UNUSED
 , { 22, 22} , { 23, 22} , { 27, 21} , { 33, 20} , { 26, 28} , { 30, 24} , { 27, 34} , { 18, 42} , { 25, 39} , { 18, 50} , { 12, 70} , { 21, 54} , { 14, 71} , { 11, 83} },

1065 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1066 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1069 { 
CTX_UNUSED
 , { 69, -71} , { 63, -63} , { 66, -64} , { 77, -74} , { 54, -39} , { 52, -35} , { 41, -10} , { 36, 0} , { 40, -1} , { 30, 14} , { 28, 26} , { 23, 37} , { 12, 55} , { 11, 65} },

1070 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1071 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1072 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1076 { 
CTX_UNUSED
 , { 69, -71} , { 63, -63} , { 66, -64} , { 77, -74} , { 54, -39} , { 52, -35} , { 41, -10} , { 36, 0} , { 40, -1} , { 30, 14} , { 28, 26} , { 23, 37} , { 12, 55} , { 11, 65} },

1077 { { 17, -10} , { 32, -13} , { 42, -9} , { 49, -5} , { 53, 0} , { 64, 3} , { 68, 10} , { 66, 27} , { 47, 57} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1078 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1079 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1085 { 
CTX_UNUSED
 , { 61, -55} , { 56, -46} , { 62, -50} , { 81, -67} , { 45, -20} , { 35, -2} , { 28, 15} , { 34, 1} , { 39, 1} , { 30, 17} , { 20, 38} , { 18, 45} , { 15, 54} , { 0, 79} },

1086 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1087 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1088 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1090 { { 18, 31} , { 19, 26} , { 36, 24} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1091 { 
CTX_UNUSED
 , { 24, 23} , { 27, 16} , { 24, 30} , { 31, 29} , { 22, 41} , { 22, 42} , { 16, 60} , { 15, 52} , { 14, 60} , { 3, 78} , { -16, 123} , { 21, 53} , { 22, 56} , { 25, 61} },

1092 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1093 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1096 { 
CTX_UNUSED
 , { 61, -55} , { 56, -46} , { 62, -50} , { 81, -67} , { 45, -20} , { 35, -2} , { 28, 15} , { 34, 1} , { 39, 1} , { 30, 17} , { 20, 38} , { 18, 45} , { 15, 54} , { 0, 79} },

1097 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1098 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1099 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1103 { 
CTX_UNUSED
 , { 61, -55} , { 56, -46} , { 62, -50} , { 81, -67} , { 45, -20} , { 35, -2} , { 28, 15} , { 34, 1} , { 39, 1} , { 30, 17} , { 20, 38} , { 18, 45} , { 15, 54} , { 0, 79} },

1104 { { 9, -2} , { 30, -10} , { 31, -4} , { 33, -1} , { 33, 7} , { 31, 12} , { 37, 23} , { 31, 38} , { 20, 64} , 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1105 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

1106 { 
CTX_UNUSED
 , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED , CTX_UNUSED },

	@lcommon/inc/distortion.h

14 #iâdeà
_DISTORTION_H_


15 
	#_DISTORTION_H_


	)

19 
	sdi¡ÜtiÚ_d©a


21 
	mi4x4rd
[4][4];

22 
di¡blk
 
	mi4x4
 [4][4];

23 
di¡blk
 
	mi8x8
 [2][2];

24 
	mi8x8rd
[2][2];

25 
	mi16x16
;

26 
	mi16x16rd
;

27 
	mrd_co¡
;

28 } 
	tDi¡ÜtiÚD©a
;

	@lcommon/inc/enc_statistics.h

16 #iâdeà
_ENC_STATISTICS_H_


17 
	#_ENC_STATISTICS_H_


	)

18 
	~"glob®.h
"

20 
	s¡©_·¿m‘”s


22 
	mb™¿‹
;

23 
št64
 
	mb™_ùr
;

24 
št64
 
	mb™_ùr_n
;

25 
št64
 
	mb™_ùr_emuÏtiÚ_´ev’tiÚ
;

26 
	mb™_¦iû
;

27 
	m¡Üed_b™_¦iû
;

28 
	mb8_mode_0_u£
 [
NUM_SLICE_TYPES
][2];

29 
št64
 
	mmode_u£_ŒªsfÜm
[
NUM_SLICE_TYPES
][
MAXMODE
][2];

30 
št64
 
	mšŒa_chroma_mode
[4];

33 
	mNumb”BF¿mes
;

35 
	mäame_couÁ”
;

36 
št64
 
	mquªt
 [
NUM_SLICE_TYPES
];

37 
št64
 
	mnum_maüoblocks
 [
NUM_SLICE_TYPES
];

38 
	mäame_ùr
 [
NUM_SLICE_TYPES
];

39 
št64
 
	mb™_couÁ”
 [
NUM_SLICE_TYPES
];

40 
	mb™¿‹_¡
 [
NUM_SLICE_TYPES
];

41 
št64
 
	mmode_u£
 [
NUM_SLICE_TYPES
][
MAXMODE
];

42 
št64
 
	mb™_u£_mode
 [
NUM_SLICE_TYPES
][
MAXMODE
];

43 
št64
 
	mb™_u£_mb_ty³
 [
NUM_SLICE_TYPES
];

44 
št64
 
	mb™_u£_h—d”
 [
NUM_SLICE_TYPES
];

45 
št64
 
	mtmp_b™_u£_cbp
 [
NUM_SLICE_TYPES
];

46 
št64
 
	mb™_u£_cÛffC
 [
NUM_SLICE_TYPES
];

47 
št64
 
	mb™_u£_cÛff
 [3][
NUM_SLICE_TYPES
];

48 
št64
 
	mb™_u£_d–_quªt
 [
NUM_SLICE_TYPES
];

49 
št64
 
	mb™_u£_¡uffšg_b™s
[
NUM_SLICE_TYPES
];

51 
	mb™_ùr_·¿m‘”£ts
;

52 
	mb™_ùr_·¿m‘”£ts_n
;

53 
št64
 
	mb™_ùr_fžËr_d©a
;

54 
št64
 
	mb™_ùr_fžËr_d©a_n
;

56 #ià(
MVC_EXTENSION_ENABLE
)

57 
	mb™¿‹_v
[2];

58 
št64
 
	mb™_ùr_v
[2];

59 
št64
 
	mb™_ùr_n_v
[2];

60 
št64
 
	mb™_ùr_emuÏtiÚ´ev’tiÚ_v
[2];

61 
št64
 
	mb™_couÁ”_v
[2][
NUM_SLICE_TYPES
];

62 
	mb™_ùr_·¿m‘”£ts_v
[2];

63 
	mb™_ùr_·¿m‘”£ts_n_v
[2];

64 
št64
 
	mb™_ùr_fžËr_d©a_v
[2];

65 
št64
 
	mb™_ùr_fžËr_d©a_n_v
[2];

68 
¡©_·¿m‘”s
 
	tStP¬am‘”s
;

	@lcommon/inc/fast_memory.h

15 #iâdeà
_FAST_MEMORY_H_


16 
	#_FAST_MEMORY_H_


	)

18 
	~"ty³defs.h
"

21 
šlše
 
	$ç¡_mem£t
(*
d¡
,
v®ue
,
width
)

23 
	`mem£t
(
d¡
,
v®ue
,
width
);

24 
	}
}

26 
šlše
 
	$ç¡_memýy
(*
d¡
,*
¤c
,
width
)

28 
	`memýy
(
d¡
,
¤c
,
width
);

29 
	}
}

31 
šlše
 
	$ç¡_mem£t_z”o
(*
d¡
, 
width
)

33 
	`mem£t
(
d¡
,0,
width
);

34 
	}
}

	@lcommon/inc/frame.h

12 #iâdeà
_FRAME_H_


13 
	#_FRAME_H_


	)

16 
	mCM_UNKNOWN
 = -1,

17 
	mCM_YUV
 = 0,

18 
	mCM_RGB
 = 1,

19 
	mCM_XYZ
 = 2

20 } 
	tCÞÜMod–
;

23 
	mCF_UNKNOWN
 = -1,

24 
	mYUV400
 = 0,

25 
	mYUV420
 = 1,

26 
	mYUV422
 = 2,

27 
	mYUV444
 = 3

28 } 
	tCÞÜFÜm©
;

31 
	mPF_UNKNOWN
 = -1,

32 
	mUYVY
 = 0,

33 
	mYUY2
 = 1,

34 
	mYUYV
 = 1,

35 
	mYVYU
 = 2,

36 
	mBGR
 = 3,

37 
	mV210
 = 4

38 } 
	tPix–FÜm©
;

41 
	säame_fÜm©


43 
CÞÜFÜm©
 
	myuv_fÜm©
;

44 
CÞÜMod–
 
	mcÞÜ_mod–
;

45 
Pix–FÜm©
 
	mpix–_fÜm©
;

46 
	mäame_¿‹
;

47 
	mwidth
[3];

48 
	mheight
[3];

49 
	mauto_üÝ_right
;

50 
	mauto_üÝ_bÙtom
;

51 
	mauto_üÝ_right_ü
;

52 
	mauto_üÝ_bÙtom_ü
;

53 
	mwidth_üÝ
;

54 
	mheight_üÝ
;

55 
	mmb_width
;

56 
	mmb_height
;

57 
	msize_cmp
[3];

58 
	msize
;

59 
	mb™_d•th
[3];

60 
	mmax_v®ue
[3];

61 
	mmax_v®ue_sq
[3];

62 
	mpic_un™_size_Ú_disk
;

63 
	mpic_un™_size_shiá3
;

64 } 
	tF¿meFÜm©
;

	@lcommon/inc/ifunctions.h

17 #iâdeà
_IFUNCTIONS_H_


18 
	#_IFUNCTIONS_H_


	)

20 #ià!(
defšed
(
WIN32
è|| defšed(
WIN64
)è&& (
__STDC_VERSION__
 < 199901L)

21 

	)

22 
	#šlše


	)

24 
	~<m©h.h
>

25 
	~<lim™s.h
>

28 
šlše
 
	$smš
(
a
, 
b
)

30  (è(((
a
è< (
b
)) ? (a) : (b));

31 
	}
}

33 
šlše
 
	$smax
(
a
, 
b
)

35  (è(((
a
è> (
b
)) ? (a) : (b));

36 
	}
}

38 
šlše
 
	$imš
(
a
, 
b
)

40  ((
a
è< (
b
)) ? (a) : (b);

41 
	}
}

43 
šlše
 
	$imš3
(
a
, 
b
, 
c
)

45  ((
a
è< (
b
)è? 
	`imš
×, 
c
) : imin(b, c);

46 
	}
}

48 
šlše
 
	$imax
(
a
, 
b
)

50  ((
a
è> (
b
)) ? (a) : (b);

51 
	}
}

53 
šlše
 
	$imedŸn
(
a
,
b
,
c
)

55 ià(
a
 > 
b
)

57 ià(
b
 > 
c
)

58 (
b
);

59 ià(
a
 > 
c
)

60 (
c
);

62 (
a
);

66 ià(
a
 > 
c
)

67 (
a
);

68 ià(
b
 > 
c
)

69 (
c
);

71 (
b
);

73 
	}
}

75 
šlše
 
	$imedŸn_Þd
(
a
, 
b
, 
c
)

77  (
a
 + 
b
 + 
c
 - 
	`imš
×, imš(b, c)è- 
	`imax
(a, imax(b ,c)));

78 
	}
}

80 
šlše
 
	$dmš
(
a
, 
b
)

82  ((
a
è< (
b
)) ? (a) : (b);

83 
	}
}

85 
šlše
 
	$dmax
(
a
, 
b
)

87  ((
a
è> (
b
)) ? (a) : (b);

88 
	}
}

90 
šlše
 
št64
 
	$i64mš
(
št64
 
a
, iÁ64 
b
)

92  ((
a
è< (
b
)) ? (a) : (b);

93 
	}
}

95 
šlše
 
št64
 
	$i64max
(
št64
 
a
, iÁ64 
b
)

97  ((
a
è> (
b
)) ? (a) : (b);

98 
	}
}

100 
šlše
 
di¡blk
 
	$di¡blkmš
(
di¡blk
 
a
, di¡blk 
b
)

102  ((
a
è< (
b
)) ? (a) : (b);

103 
	}
}

105 
šlše
 
di¡blk
 
	$di¡blkmax
(
di¡blk
 
a
, di¡blk 
b
)

107  ((
a
è> (
b
)) ? (a) : (b);

108 
	}
}

110 
šlše
 
	$§bs
(
x
)

112 cÚ¡ 
SHORT_BITS
 = ((è* 
CHAR_BIT
) - 1;

113 
y
 = (è(
x
 >> 
SHORT_BITS
);

114  (è((
x
 ^ 
y
) - y);

115 
	}
}

117 
šlše
 
	$Ÿbs
(
x
)

119 cÚ¡ 
INT_BITS
 = ((è* 
CHAR_BIT
) - 1;

120 
y
 = 
x
 >> 
INT_BITS
;

121  (
x
 ^ 
y
) - y;

122 
	}
}

124 
šlše
 
	$dabs
(
x
)

126  ((
x
) < 0) ? -(x) : (x);

127 
	}
}

129 
šlše
 
št64
 
	$i64abs
(
št64
 
x
)

131 cÚ¡ 
št64
 
INT64_BITS
 = ((št64è* 
CHAR_BIT
) - 1;

132 
št64
 
y
 = 
x
 >> 
INT64_BITS
;

133  (
x
 ^ 
y
) - y;

134 
	}
}

136 
šlše
 
	$dabs2
(
x
)

138  (
x
) * (x);

139 
	}
}

141 
šlše
 
	$Ÿbs2
(
x
)

143  (
x
) * (x);

144 
	}
}

146 
šlše
 
št64
 
	$i64abs2
(
št64
 
x
)

148  (
x
) * (x);

149 
	}
}

151 
šlše
 
	$isign
(
x
)

153  ( (
x
 > 0) - (x < 0));

154 
	}
}

156 
šlše
 
	$isigÇb
(
a
, 
b
)

158  ((
b
è< 0è? -
	`Ÿbs
(
a
) : iabs(a);

159 
	}
}

161 
šlše
 
	$rshiá_ºd
(
x
, 
a
)

163  (
a
 > 0è? ((
x
 + (1 << (a-1) )) >>‡) : (x << (-a));

164 
	}
}

166 
šlše
 
	$rshiá_ºd_sign
(
x
, 
a
)

168  (
x
 > 0è? ( ( x + (1 << (
a
-1)èè>>‡ ) : (-ÐÐ
	`Ÿbs
(x) + (1 << (a-1)) ) >>‡ ));

169 
	}
}

171 
šlše
 
	$rshiá_ºd_us
(
x
, 
a
)

173  (
a
 > 0è? ((
x
 + (1 << (a-1))) >>‡) : x;

174 
	}
}

176 
šlše
 
	$rshiá_ºd_sf
(
x
, 
a
)

178  ((
x
 + (1 << (
a
-1) )) >>‡);

179 
	}
}

181 
šlše
 
	$shiá_off_sf
(
x
, 
o
, 
a
)

183  ((
x
 + 
o
è>> 
a
);

184 
	}
}

186 
šlše
 
	$rshiá_ºd_us_sf
(
x
, 
a
)

188  ((
x
 + (1 << (
a
-1))) >>‡);

189 
	}
}

191 
šlše
 
	$iCl1
(
high
, 
x
)

193 
x
 = 
	`imax
(x, 0);

194 
x
 = 
	`imš
(x, 
high
);

196  
x
;

197 
	}
}

199 
šlše
 
	$iCl3
(
low
, 
high
, 
x
)

201 
x
 = 
	`imax
(x, 
low
);

202 
x
 = 
	`imš
(x, 
high
);

204  
x
;

205 
	}
}

207 
šlše
 
	$sCl3
(
low
, 
high
, 
x
)

209 
x
 = 
	`smax
(x, 
low
);

210 
x
 = 
	`smš
(x, 
high
);

212  
x
;

213 
	}
}

215 
šlše
 
	$dCl3
(
low
, 
high
, 
x
)

217 
x
 = 
	`dmax
(x, 
low
);

218 
x
 = 
	`dmš
(x, 
high
);

220  
x
;

221 
	}
}

224 
šlše
 
di¡blk
 
	$weigh‹d_co¡
(
çùÜ
, 
b™s
)

226 #ià
JCOST_CALC_SCALEUP


227  (((
di¡blk
)(
çùÜ
))*((di¡blk)(
b™s
)));

229 #ià(
USE_RND_COST
)

230  (
	`rshiá_ºd_sf
((
Ïmbda
è* (
b™s
), 
LAMBDA_ACCURACY_BITS
));

232  (((
çùÜ
)*(
b™s
))>>
LAMBDA_ACCURACY_BITS
);

235 
	}
}

237 
šlše
 
	$RSD
(
x
)

239  ((
x
&2)?(x|1):(x&(~1)));

240 
	}
}

242 
šlše
 
	$pow”2
(
x
)

244  1 << (
x
);

245 
	}
}

248 cÚ¡ 
št64
 
	gpo2
[64] = {0x1,0x2,0x4,0x8,0x10,0x20,0x40,0x80,0x100,0x200,0x400,0x800,0x1000,0x2000,0x4000,0x8000,

258 
šlše
 
št64
 
	$i64_pow”2
(
x
)

260 ((
x
 > 63è? 0 : 
po2
[x]);

261 
	}
}

263 
šlše
 
	$æßt2št
 (
x
)

265  ()((
x
 < 0) ? (x - 0.5f) : (x + 0.5f));

266 
	}
}

268 
šlše
 
	$g‘_b™
(
št64
 
x
,
n
)

270  ()(((
x
 >> 
n
) & 1));

271 
	}
}

273 #ià
ZEROSNR


274 
šlše
 
	$p¢r
(
max_§m¶e_sq
, 
§m¶es
, 
s£_di¡ÜtiÚ
 )

276  (è(10.0 * 
	`log10
(
max_§m¶e_sq
 * (è((è
§m¶es
 / (
s£_di¡ÜtiÚ
 < 1.0 ? 1.0 : sse_distortion))));

277 
	}
}

279 
šlše
 
	$p¢r
(
max_§m¶e_sq
, 
§m¶es
, 
s£_di¡ÜtiÚ
 )

281  (è(
s£_di¡ÜtiÚ
 =ð0.0 ? 0.0 : (10.0 * 
	`log10
(
max_§m¶e_sq
 * (è((è
§m¶es
 / sse_distortion))));

282 
	}
}

285 
šlše
 
	$CheckCo¡_Shiá
(
št64
 
mco¡
, iÁ64 
mš_mco¡
)

287 if((
mco¡
<<
LAMBDA_ACCURACY_BITS
è>ð
mš_mco¡
)

291 
	}
}

293 
šlše
 
	$CheckCo¡
(
št64
 
mco¡
, iÁ64 
mš_mco¡
)

295  ((
mco¡
è>ð(
mš_mco¡
));

296 
	}
}

298 
šlše
 
	$down_sÿË
(
di¡blk
 *
pblkdi¡Co¡
)

300 #ià
JCOST_CALC_SCALEUP


301 *
pblkdi¡Co¡
 = (*pblkdi¡Co¡)>>
LAMBDA_ACCURACY_BITS
;

303 
	}
}

305 
šlše
 
	$up_sÿË
(
di¡blk
 *
pblkdi¡Co¡
)

307 #ià
JCOST_CALC_SCALEUP


308 *
pblkdi¡Co¡
 = (*pblkdi¡Co¡)<<
LAMBDA_ACCURACY_BITS
;

310 
	}
}

312 
šlše
 
di¡blk
 
	$di¡_sÿË
(
di¡blk
 
blkdi¡Co¡
)

314 #ià
JCOST_CALC_SCALEUP


315  ((
blkdi¡Co¡
)<<
LAMBDA_ACCURACY_BITS
);

317  (
blkdi¡Co¡
);

319 
	}
}

321 
šlše
 
	$di¡_down
(
di¡blk
 
blkdi¡Co¡
)

323 #ià
JCOST_CALC_SCALEUP


324  (()((
blkdi¡Co¡
)>>
LAMBDA_ACCURACY_BITS
));

326  (()
blkdi¡Co¡
);

328 
	}
}

336 
šlše
 
	$RoundLog2
 (
iV®ue
)

338 
iR‘
 = 0;

339 
iV®ue_squ¬e
 = 
iV®ue
 * iValue;

340 (1 << (
iR‘
 + 1)è<ð
iV®ue_squ¬e
)

341 ++
iR‘
;

343 
iR‘
 = (iRet + 1) >> 1;

344  
iR‘
;

345 
	}
}

347 
šlše
 
	$ä“_poš‹r
(*
poš‹r
)

349 ià(
poš‹r
 !ð
NULL
)

351 
	`ä“
(
poš‹r
);

354 
	}
}

356 
šlše
 
	$i32_sw­
(*
x
, *
y
)

358 
‹mp
 = *
x
;

359 *
x
 = *
y
;

360 *
y
 = 
‹mp
;

361 
	}
}

363 
šlše
 
	$i64_sw­
(
št64
 *
x
, iÁ64 *
y
)

365 
št64
 
‹mp
 = *
x
;

366 *
x
 = *
y
;

367 *
y
 = 
‹mp
;

368 
	}
}

370 
šlše
 
	$is_šŒa_mb
(
mb_ty³
)

372  (
mb_ty³
==
SI4MB
 || mb_ty³==
I4MB
 || mb_ty³==
I16MB
 || mb_ty³==
I8MB
 || mb_ty³==
IPCM
);

373 
	}
}

375 #ià!(
defšed
(
WIN32
è|| defšed(
WIN64
)è&& (
__STDC_VERSION__
 < 199901L)

377 #undeà
šlše


	@lcommon/inc/img_io.h

13 
	~"glob®.h
"

15 #iâdeà
_IMG_IO_H_


16 
	#_IMG_IO_H_


	)

18 
	~"io_video.h
"

19 
	~"io_¿w.h
"

20 
	~"io_tiff.h
"

22 
P¬£SizeFromSŒšg
 (
VideoD©aFže
 *
šput_fže
, *
xËn
, *
yËn
, *
ås
);

23 
P¬£F¿meNoFÜm©FromSŒšg
 (
VideoD©aFže
 *
šput_fže
);

24 
O³nF¿meFže
 (
VideoD©aFže
 *
šput_fže
, 
F¿meNumb”InFže
);

25 
O³nFžes
 (
VideoD©aFže
 *
šput_fže
);

26 
Clo£Fžes
 (
VideoD©aFže
 *
šput_fže
);

27 
VideoFžeTy³
 
P¬£VideoTy³
 (
VideoD©aFže
 *
šput_fže
);

	@lcommon/inc/img_process.h

15 #iâdeà
_IMG_PROCESS_H_


16 
	#_IMG_PROCESS_H_


	)

19 
š™_´oûss_image
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

20 
þ—r_´oûss_image
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

21 
´oûss_image
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

	@lcommon/inc/img_process_types.h

16 #iâdeà
_IMG_PROCESS_TYPES_H_


17 
	#_IMG_PROCESS_TYPES_H_


	)

19 
	#DEMUX_META_DEBUG
 1

	)

20 
	#MAX_NUM_PARTITIONS
 512

	)

21 
	#NUM_VIEWS
 2

	)

22 
	#NUM_COMPONENTS
 3

	)

	@lcommon/inc/input.h

13 #iâdeà
_INPUT_H_


14 
	#_INPUT_H_


	)

16 
‹¡EndŸn
();

17 
š™IÅut
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
sourû
, F¿meFÜm© *
ouut
);

18 
AÎoÿ‹F¿meMemÜy
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meFÜm©
 *
sourû
);

19 
D–‘eF¿meMemÜy
 (
VideoP¬am‘”s
 *
p_Vid
);

21 
»ad_Úe_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, F¿meFÜm© *
ouut
, 
img³l
 **
pImage
[3]);

22 
·d_bÜd”s
 ( 
F¿meFÜm©
 
ouut
, 
img_size_x
, 
img_size_y
, 
img_size_x_ü
, 
img_size_y_ü
, 
img³l
 **
pImage
[3]);

	@lcommon/inc/io_image.h

14 #iâdeà
_IO_IMAGE_H_


15 
	#_IO_IMAGE_H_


	)

17 
	~"defšes.h
"

18 
	~"äame.h
"

20 
	simage_d©a


22 
F¿meFÜm©
 
	mfÜm©
;

24 
img³l
 **
	mäm_d©a
[
MAX_PLANE
];

25 
img³l
 **
	mtÝ_d©a
[
MAX_PLANE
];

26 
img³l
 **
	mbÙ_d©a
[
MAX_PLANE
];

28 
img³l
 **
	mäm_d©a_buf
[2][
MAX_PLANE
];

29 
img³l
 **
	mtÝ_d©a_buf
[2][
MAX_PLANE
];

30 
img³l
 **
	mbÙ_d©a_buf
[2][
MAX_PLANE
];

35 
ušt16
 **
	mäm_ušt16
[
MAX_PLANE
];

36 
ušt16
 **
	mtÝ_ušt16
[
MAX_PLANE
];

37 
ušt16
 **
	mbÙ_ušt16
[
MAX_PLANE
];

39 
	mäm_¡ride
[
MAX_PLANE
];

40 
	mtÝ_¡ride
[
MAX_PLANE
];

41 
	mbÙ_¡ride
[
MAX_PLANE
];

42 } 
	tImageD©a
;

	@lcommon/inc/io_raw.h

15 #iâdeà
_IO_RAW_H_


16 
	#_IO_RAW_H_


	)

18 
R—dF¿meCÚÿ‹Ç‹d
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, *
buf
);

19 
R—dF¿meS•¬©e
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, *
buf
);

	@lcommon/inc/io_tiff.h

16 #iâdeà
_IO_TIFF_H_


17 
	#_IO_TIFF_H_


	)

22 
R—dTIFFImage
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
F¿meFÜm©
 *
sourû
, *
buf
);

	@lcommon/inc/io_video.h

14 #iâdeà
_IO_VIDEO_H_


15 
	#_IO_VIDEO_H_


	)

17 
	~"äame.h
"

19 
	svideo_size
 {

20 * 
	mÇme
;

21 
	mx_size
;

22 
	my_size
;

23 } 
	tVIDEO_SIZE
;

26 
	mVIDEO_UNKNOWN
 = -1,

27 
	mVIDEO_YUV
 = 0,

28 
	mVIDEO_RGB
 = 1,

29 
	mVIDEO_XYZ
 = 2,

30 
	mVIDEO_TIFF
 = 3,

31 
	mVIDEO_AVI
 = 4

32 } 
	tVideoFžeTy³
;

34 
	svideo_d©a_fže


37 
	mâame
[
FILE_NAME_SIZE
];

38 
	mfh—d
[
FILE_NAME_SIZE
];

39 
	máaž
[
FILE_NAME_SIZE
];

40 
	mf_num
;

41 
VideoFžeTy³
 
	mvdty³
;

42 
F¿meFÜm©
 
	mfÜm©
;

43 
	mis_cÚÿ‹Ç‹d
;

44 
	mis_š‹¾—ved
;

45 
	mz”o_·d
;

46 
	mnum_dig™s
;

47 
	m¡¬t_äame
;

48 
	m’d_äame
;

49 
	mnäames
;

50 
	müÝ_x_size
;

51 
	müÝ_y_size
;

52 
	müÝ_x_off£t
;

53 
	müÝ_y_off£t
;

56 * 
	mavi
;

60 } 
	tVideoD©aFže
;

	@lcommon/inc/lagrangian.h

14 #iâdeà
_LAGRANGIAN_H_


15 
	#_LAGRANGIAN_H_


	)

17 
	sÏmbda_·¿ms


19 
	mmd
;

20 
	mme
[3];

21 
	mmf
[3];

22 } 
	tLambdaP¬ams
;

	@lcommon/inc/mb_access.h

16 #iâdeà
_MB_ACCESS_H_


17 
	#_MB_ACCESS_H_


	)

19 
CheckAvažabž™yOfNeighbÜs
(
Maüoblock
 *
cu¼MB
);

20 
CheckAvažabž™yOfNeighbÜsMBAFF
(
Maüoblock
 *
cu¼MB
);

21 
CheckAvažabž™yOfNeighbÜsNÜm®
(
Maüoblock
 *
cu¼MB
);

23 
g‘AffNeighbour
 (
Maüoblock
 *
cu¼MB
, 
xN
, 
yN
, 
mb_size
[2], 
Pix–Pos
 *
pix
);

24 
g‘NÚAffNeighbour
 (
Maüoblock
 *
cu¼MB
, 
xN
, 
yN
, 
mb_size
[2], 
Pix–Pos
 *
pix
);

25 
g‘4x4Neighbour
 (
Maüoblock
 *
cu¼MB
, 
xN
, 
yN
, 
mb_size
[2], 
Pix–Pos
 *
pix
);

26 
g‘4x4NeighbourBa£
 (
Maüoblock
 *
cu¼MB
, 
block_x
, 
block_y
, 
mb_size
[2], 
Pix–Pos
 *
pix
);

27 
BoÞ—n
 
mb_is_avažabË
 (
mbAddr
, 
Maüoblock
 *
cu¼MB
);

28 
g‘_mb_pos
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb_addr
, 
mb_size
[2], *
x
, *
y
);

29 
g‘_mb_block_pos_nÜm®
 (
BlockPos
 *
PicPos
, 
mb_addr
, *
x
, *
y
);

30 
g‘_mb_block_pos_mbaff
 (
BlockPos
 *
PicPos
, 
mb_addr
, *
x
, *
y
);

	@lcommon/inc/mbuffer_common.h

16 #iâdeà
_MBUFFER_COMMON_H_


17 
	#_MBUFFER_COMMON_H_


	)

26 
šlše
 
	$com·»_pic_by_pic_num_desc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

28 
pic_num1
 = (*(
StÜabËPiùu»
**)
¬g1
)->
pic_num
;

29 
pic_num2
 = (*(
StÜabËPiùu»
**)
¬g2
)->
pic_num
;

31 ià(
pic_num1
 < 
pic_num2
)

33 ià(
pic_num1
 > 
pic_num2
)

37 
	}
}

46 
šlše
 
	$com·»_pic_by_É_pic_num_asc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

48 
lÚg_‹rm_pic_num1
 = (*(
StÜabËPiùu»
**)
¬g1
)->
lÚg_‹rm_pic_num
;

49 
lÚg_‹rm_pic_num2
 = (*(
StÜabËPiùu»
**)
¬g2
)->
lÚg_‹rm_pic_num
;

51 iàÐ
lÚg_‹rm_pic_num1
 < 
lÚg_‹rm_pic_num2
)

53 iàÐ
lÚg_‹rm_pic_num1
 > 
lÚg_‹rm_pic_num2
)

57 
	}
}

66 
šlše
 
	$com·»_fs_by_äame_num_desc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

68 
äame_num_w¿p1
 = (*(
F¿meStÜe
**)
¬g1
)->
äame_num_w¿p
;

69 
äame_num_w¿p2
 = (*(
F¿meStÜe
**)
¬g2
)->
äame_num_w¿p
;

70 iàÐ
äame_num_w¿p1
 < 
äame_num_w¿p2
)

72 iàÐ
äame_num_w¿p1
 > 
äame_num_w¿p2
)

76 
	}
}

86 
šlše
 
	$com·»_fs_by_É_pic_idx_asc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

88 
lÚg_‹rm_äame_idx1
 = (*(
F¿meStÜe
**)
¬g1
)->
lÚg_‹rm_äame_idx
;

89 
lÚg_‹rm_äame_idx2
 = (*(
F¿meStÜe
**)
¬g2
)->
lÚg_‹rm_äame_idx
;

91 iàÐ
lÚg_‹rm_äame_idx1
 < 
lÚg_‹rm_äame_idx2
)

93 iàÐ
lÚg_‹rm_äame_idx1
 > 
lÚg_‹rm_äame_idx2
)

97 
	}
}

107 
šlše
 
	$com·»_pic_by_poc_asc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

109 
poc1
 = (*(
StÜabËPiùu»
**)
¬g1
)->
poc
;

110 
poc2
 = (*(
StÜabËPiùu»
**)
¬g2
)->
poc
;

112 iàÐ
poc1
 < 
poc2
)

114 iàÐ
poc1
 > 
poc2
)

118 
	}
}

128 
šlše
 
	$com·»_pic_by_poc_desc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

130 
poc1
 = (*(
StÜabËPiùu»
**)
¬g1
)->
poc
;

131 
poc2
 = (*(
StÜabËPiùu»
**)
¬g2
)->
poc
;

133 ià(
poc1
 < 
poc2
)

135 ià(
poc1
 > 
poc2
)

139 
	}
}

149 
šlše
 
	$com·»_fs_by_poc_asc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

151 
poc1
 = (*(
F¿meStÜe
**)
¬g1
)->
poc
;

152 
poc2
 = (*(
F¿meStÜe
**)
¬g2
)->
poc
;

154 ià(
poc1
 < 
poc2
)

156 ià(
poc1
 > 
poc2
)

160 
	}
}

170 
šlše
 
	$com·»_fs_by_poc_desc
ÐcÚ¡ *
¬g1
, cÚ¡ *
¬g2
 )

172 
poc1
 = (*(
F¿meStÜe
**)
¬g1
)->
poc
;

173 
poc2
 = (*(
F¿meStÜe
**)
¬g2
)->
poc
;

175 ià(
poc1
 < 
poc2
)

177 ià(
poc1
 > 
poc2
)

181 
	}
}

190 
šlše
 
	$is_shÜt_»f
(
StÜabËPiùu»
 *
s
)

192  ((
s
->
u£d_fÜ_»ã»nû
è&& (!(s->
is_lÚg_‹rm
)));

193 
	}
}

203 
šlše
 
	$is_lÚg_»f
(
StÜabËPiùu»
 *
s
)

205  ((
s
->
u£d_fÜ_»ã»nû
è&& (s->
is_lÚg_‹rm
));

206 
	}
}

209 
g’_pic_li¡_äom_äame_li¡
(
Piùu»SŒuùu»
 
cu¼SŒuùu»
, 
F¿meStÜe
 **
fs_li¡
, 
li¡_idx
, 
StÜabËPiùu»
 **
li¡
, *
li¡_size
, 
lÚg_‹rm
);

210 
StÜabËPiùu»
* 
g‘_lÚg_‹rm_pic
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
LÚg‹rmPicNum
);

211 
upd©e_»f_li¡
(
DecodedPiùu»Bufãr
 *
p_Dpb
);

212 
upd©e_É»f_li¡
(
DecodedPiùu»Bufãr
 *
p_Dpb
);

213 
mm_m¬k_cu¼’t_piùu»_lÚg_‹rm
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
lÚg_‹rm_äame_idx
);

214 
mm_unm¬k_shÜt_‹rm_fÜ_»ã»nû
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
difã»nû_of_pic_nums_mšus1
);

215 
mm_unm¬k_lÚg_‹rm_fÜ_»ã»nû
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
lÚg_‹rm_pic_num
);

216 
mm_assign_lÚg_‹rm_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
difã»nû_of_pic_nums_mšus1
, 
lÚg_‹rm_äame_idx
);

217 
mm_upd©e_max_lÚg_‹rm_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
max_lÚg_‹rm_äame_idx_¶us1
);

218 
mm_unm¬k_®l_shÜt_‹rm_fÜ_»ã»nû
 (
DecodedPiùu»Bufãr
 *
p_Dpb
);

219 
mm_unm¬k_®l_lÚg_‹rm_fÜ_»ã»nû
 (
DecodedPiùu»Bufãr
 *
p_Dpb
);

220 
is_u£d_fÜ_»ã»nû
 (
F¿meStÜe
* 
fs
);

221 
g‘_sm®Ë¡_poc
(
DecodedPiùu»Bufãr
 *
p_Dpb
, *
poc
,* 
pos
);

222 
»move_unu£d_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
);

	@lcommon/inc/memalloc.h

17 #iâdeà
_MEMALLOC_H_


18 
	#_MEMALLOC_H_


	)

20 
	~"glob®.h
"

21 
	~"mbufãr.h
"

22 
	~"di¡ÜtiÚ.h
"

23 
	~"Ïg¿ngŸn.h
"

24 
	~"quªt_·¿ms.h
"

26 
g‘_mem2Ddi¡
(
Di¡ÜtiÚD©a
 ***
¬¿y2D
, 
dim0
, 
dim1
);

28 
g‘_mem2Dlm
 (
LambdaP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
);

29 
g‘_mem2DÞm
 (
LambdaP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
);

31 
g‘_mem2Dmp
 (
PicMÙiÚP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
);

32 
g‘_mem3Dmp
 (
PicMÙiÚP¬ams
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

34 
g‘_mem2Dquªt
(
Lev–QuªtP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
);

35 
g‘_mem3Dquªt
(
Lev–QuªtP¬ams
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

36 
g‘_mem4Dquªt
(
Lev–QuªtP¬ams
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

37 
g‘_mem5Dquªt
(
Lev–QuªtP¬ams
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
);

39 
g‘_mem2Dmv
 (
MÙiÚVeùÜ
 ***
¬¿y2D
, 
dim0
, 
dim1
);

40 
g‘_mem3Dmv
 (
MÙiÚVeùÜ
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

41 
g‘_mem4Dmv
 (
MÙiÚVeùÜ
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

42 
g‘_mem5Dmv
 (
MÙiÚVeùÜ
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
);

43 
g‘_mem6Dmv
 (
MÙiÚVeùÜ
 *******
¬¿y6D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
);

44 
g‘_mem7Dmv
 (
MÙiÚVeùÜ
 ********
¬¿y7D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
);

46 
by‹
** 
Ãw_mem2D
(
dim0
, 
dim1
);

47 
g‘_mem2D
(
by‹
 ***
¬¿y2D
, 
dim0
, 
dim1
);

48 
g‘_mem3D
(
by‹
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

49 
g‘_mem4D
(
by‹
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

51 ** 
Ãw_mem2Dšt
(
dim0
, 
dim1
);

52 
g‘_mem2Dšt
(***
¬¿y2D
, 
dim0
, 
dim1
);

53 
g‘_mem2Dšt_·d
(***
¬¿y2D
, 
dim0
, 
dim1
, 
iPadY
, 
iPadX
);

54 
g‘_mem2Dšt64
(
št64
 ***
¬¿y2D
, 
dim0
, 
dim1
);

55 
g‘_mem3Dšt
(****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

56 
g‘_mem3Dšt64
(
št64
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

57 
g‘_mem4Dšt
(*****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

58 
g‘_mem4Dšt64
(
št64
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

59 
g‘_mem5Dšt
(******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
);

61 
ušt16
** 
Ãw_mem2Dušt16
(
dim0
, 
dim1
);

62 
g‘_mem2Dušt16
(
ušt16
 ***
¬¿y2D
, 
dim0
, 
dim1
);

63 
g‘_mem3Dušt16
(
ušt16
 ****
¬¿y3D
,
dim0
, 
dim1
, 
dim2
);

65 
g‘_mem2Ddi¡blk
(
di¡blk
 ***
¬¿y2D
, 
dim0
, 
dim1
);

66 
g‘_mem3Ddi¡blk
(
di¡blk
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

67 
g‘_mem4Ddi¡blk
(
di¡blk
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

69 
g‘_mem2DshÜt
(***
¬¿y2D
, 
dim0
, 
dim1
);

70 
g‘_mem3DshÜt
(****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

71 
g‘_mem4DshÜt
(*****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

72 
g‘_mem5DshÜt
(******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
);

73 
g‘_mem6DshÜt
(*******
¬¿y6D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
);

74 
g‘_mem7DshÜt
(********
¬¿y7D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
);

76 
g‘_mem1D³l
(
img³l
 **
¬¿y2D
, 
dim0
);

77 
g‘_mem2D³l
(
img³l
 ***
¬¿y2D
, 
dim0
, 
dim1
);

78 
g‘_mem2D³l_·d
(
img³l
 ***
¬¿y2D
, 
dim0
, 
dim1
, 
iPadY
, 
iPadX
);

80 
g‘_mem3D³l
 (
img³l
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

81 
g‘_mem3D³l_·d
(
img³l
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
, 
iPadY
, 
iPadX
);

82 
g‘_mem4D³l
 (
img³l
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
);

83 
g‘_mem4D³l_·d
(
img³l
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
iPadY
, 
iPadX
);

84 
g‘_mem5D³l
 (
img³l
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
);

85 
g‘_mem5D³l_·d
(
img³l
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
iPadY
, 
iPadX
);

86 
g‘_mem2DdoubË
 (***
¬¿y2D
, 
dim0
, 
dim1
);

88 
g‘_mem1DodoubË
(**
¬¿y1D
, 
dim0
, 
off£t
);

89 
g‘_mem2DodoubË
(***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
);

90 
g‘_mem3DodoubË
(****
¬¿y2D
, 
dim0
, 
dim1
, 
dim2
, 
off£t
);

92 
g‘_mem2Došt
 (***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
);

93 
g‘_mem3Došt
 (****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
, 
off£t
);

95 
g‘_mem2Dwp
 (
WPP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
);

97 
g‘_off£t_mem2DshÜt
(***
¬¿y2D
, 
rows
, 
cÞumns
, 
off£t_y
, 
off£t_x
);

99 
ä“_off£t_mem2DshÜt
(**
¬¿y2D
, 
cÞumns
, 
off£t_x
, 
off£t_y
);

101 
ä“_mem2Ddi¡
 (
Di¡ÜtiÚD©a
 **
¬¿y2D
);

103 
ä“_mem2Dlm
 (
LambdaP¬ams
 **
¬¿y2D
);

104 
ä“_mem2DÞm
 (
LambdaP¬ams
 **
¬¿y2D
, 
off£t
);

106 
ä“_mem2Dmp
 (
PicMÙiÚP¬ams
 **
¬¿y2D
);

107 
ä“_mem3Dmp
 (
PicMÙiÚP¬ams
 ***
¬¿y2D
);

109 
ä“_mem2Dquªt
(
Lev–QuªtP¬ams
 **
¬¿y2D
);

110 
ä“_mem3Dquªt
(
Lev–QuªtP¬ams
 ***
¬¿y2D
);

111 
ä“_mem4Dquªt
(
Lev–QuªtP¬ams
 ****
¬¿y2D
);

112 
ä“_mem5Dquªt
(
Lev–QuªtP¬ams
 *****
¬¿y2D
);

114 
ä“_mem2Dmv
 (
MÙiÚVeùÜ
 **
¬¿y2D
);

115 
ä“_mem3Dmv
 (
MÙiÚVeùÜ
 ***
¬¿y2D
);

116 
ä“_mem4Dmv
 (
MÙiÚVeùÜ
 ****
¬¿y2D
);

117 
ä“_mem5Dmv
 (
MÙiÚVeùÜ
 *****
¬¿y2D
);

118 
ä“_mem6Dmv
 (
MÙiÚVeùÜ
 ******
¬¿y2D
);

119 
ä“_mem7Dmv
 (
MÙiÚVeùÜ
 *******
¬¿y7D
);

121 
g‘_mem2D_¥p
(
StÜabËPiùu»PŒ
 ***
¬¿y3D
, 
dim0
, 
dim1
);

122 
g‘_mem3D_¥p
(
StÜabËPiùu»PŒ
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
);

124 
ä“_mem2D_¥p
 (
StÜabËPiùu»PŒ
 **
¬¿y2D
);

125 
ä“_mem3D_¥p
 (
StÜabËPiùu»PŒ
 ***
¬¿y2D
);

127 
ä“_mem2D
 (
by‹
 **
¬¿y2D
);

128 
ä“_mem3D
 (
by‹
 ***
¬¿y3D
);

129 
ä“_mem4D
 (
by‹
 ****
¬¿y4D
);

131 
ä“_mem2Dšt
 (**
¬¿y2D
);

132 
ä“_mem2Dšt_·d
(**
¬¿y2D
, 
iPadY
, 
iPadX
);

133 
ä“_mem3Dšt
 (***
¬¿y3D
);

134 
ä“_mem4Dšt
 (****
¬¿y4D
);

135 
ä“_mem5Dšt
 (*****
¬¿y5D
);

137 
ä“_mem2Dušt16
(
ušt16
 **
¬¿y2D
);

138 
ä“_mem3Dušt16
(
ušt16
 ***
¬¿y3D
);

140 
ä“_mem2Dšt64
(
št64
 **
¬¿y2D
);

141 
ä“_mem3Dšt64
(
št64
 ***
¬¿y3D
);

142 
ä“_mem4Dšt64
(
št64
 ****
¬¿y4D
);

144 
ä“_mem2Ddi¡blk
(
di¡blk
 **
¬¿y2D
);

145 
ä“_mem3Ddi¡blk
(
di¡blk
 ***
¬¿y3D
);

146 
ä“_mem4Ddi¡blk
(
di¡blk
 ****
¬¿y4D
);

148 
ä“_mem2DshÜt
(**
¬¿y2D
);

149 
ä“_mem3DshÜt
(***
¬¿y3D
);

150 
ä“_mem4DshÜt
(****
¬¿y4D
);

151 
ä“_mem5DshÜt
(*****
¬¿y5D
);

152 
ä“_mem6DshÜt
(******
¬¿y6D
);

153 
ä“_mem7DshÜt
(*******
¬¿y7D
);

155 
ä“_mem1D³l
 (
img³l
 *
¬¿y1D
);

156 
ä“_mem2D³l
 (
img³l
 **
¬¿y2D
);

157 
ä“_mem2D³l_·d
(
img³l
 **
¬¿y2D
, 
iPadY
, 
iPadX
);

158 
ä“_mem3D³l
 (
img³l
 ***
¬¿y3D
);

159 
ä“_mem3D³l_·d
(
img³l
 ***
¬¿y3D
, 
iDim12
, 
iPadY
, 
iPadX
);

160 
ä“_mem4D³l
 (
img³l
 ****
¬¿y4D
);

161 
ä“_mem4D³l_·d
(
img³l
 ****
¬¿y4D
, 
iF¿mes
, 
iPadY
, 
iPadX
);

162 
ä“_mem5D³l
 (
img³l
 *****
¬¿y5D
);

163 
ä“_mem5D³l_·d
(
img³l
 *****
¬¿y5D
, 
iF¿mes
, 
iPadY
, 
iPadX
);

164 
ä“_mem2DdoubË
 (**
¬¿y2D
);

165 
ä“_mem3DdoubË
 (***
¬¿y3D
);

167 
ä“_mem1DodoubË
(*
¬¿y1D
, 
off£t
);

168 
ä“_mem2DodoubË
(**
¬¿y2D
, 
off£t
);

169 
ä“_mem3DodoubË
(***
¬¿y3D
, 
rows
, 
cÞumns
, 
off£t
);

170 
ä“_mem2Došt
 (**
¬¿y2D
, 
off£t
);

171 
ä“_mem3Došt
 (***
¬¿y3D
, 
rows
, 
cÞumns
, 
off£t
);

173 
š™_tÝ_bÙ_¶ªes
(
img³l
 **
imgF¿me
, 
height
, img³È***
imgTÝF›ld
, img³È***
imgBÙF›ld
);

174 
ä“_tÝ_bÙ_¶ªes
(
img³l
 **
imgTÝF›ld
, img³È**
imgBÙF›ld
);

176 
ä“_mem2Dwp
 (
WPP¬ams
 **
¬¿y2D
);

178 
cÝy2DImage
(
img³l
 **
d¡_img
, img³È**
¤c_img
, 
size_x
, 
size_y
);

179 
no_mem_ex™
(*
wh”e
);

180 
m®loc_mem2D³l_2SLay”s
(
img³l
 ***
buf0
, 
imgty³0
, img³È***
buf1
, 
imgty³1
, 
height
, 
width
);

181 
m®loc_mem3D³l_2SLay”s
(
img³l
 ****
buf0
, 
imgty³0
, img³È****
buf1
, 
imgty³1
, 
äames
, 
height
, 
width
);

183 
ä“_mem2D³l_2SLay”s
(
img³l
 ***
buf0
, img³È***
buf1
);

184 
ä“_mem3D³l_2SLay”s
(
img³l
 ****
buf0
, img³È****
buf1
);

187 
šlše
 * 
	$mem_m®loc
(
size_t
 
n™ems
)

189 *
d
;

190 if((
d
 = 
	`m®loc
(
n™ems
)è=ð
NULL
)

192 
	`no_mem_ex™
("malloc failed.\n");

193  
NULL
;

195  
d
;

196 
	}
}

204 
šlše
 * 
	$mem_ÿÎoc
(
size_t
 
n™ems
, size_ˆ
size
)

206 
size_t
 
·dded_size
 = 
n™ems
 * 
size
;

207 *
d
 = 
	`mem_m®loc
(
·dded_size
);

208 
	`mem£t
(
d
, 0, ()
·dded_size
);

209  
d
;

210 
	}
}

212 
šlše
 
	$mem_ä“
(*
a
)

214 
	`ä“_poš‹r
(
a
);

215 
	}
}

	@lcommon/inc/mv_prediction.h

14 #iâdeà
_MV_PREDICTION_H_


15 
	#_MV_PREDICTION_H_


	)

17 
š™_mÙiÚ_veùÜ_´ediùiÚ
(
Maüoblock
 *
cu¼MB
, 
mb_aff_äame_æag
);

	@lcommon/inc/nalucommon.h

15 #iâdeà
_NALUCOMMON_H_


16 
	#_NALUCOMMON_H_


	)

18 
	~"defšes.h
"

20 
	#MAXRBSPSIZE
 64000

	)

21 
	#MAXNALUSIZE
 64000

	)

25 
	mNALU_TYPE_SLICE
 = 1,

26 
	mNALU_TYPE_DPA
 = 2,

27 
	mNALU_TYPE_DPB
 = 3,

28 
	mNALU_TYPE_DPC
 = 4,

29 
	mNALU_TYPE_IDR
 = 5,

30 
	mNALU_TYPE_SEI
 = 6,

31 
	mNALU_TYPE_SPS
 = 7,

32 
	mNALU_TYPE_PPS
 = 8,

33 
	mNALU_TYPE_AUD
 = 9,

34 
	mNALU_TYPE_EOSEQ
 = 10,

35 
	mNALU_TYPE_EOSTREAM
 = 11,

36 
	mNALU_TYPE_FILL
 = 12,

37 #ià(
MVC_EXTENSION_ENABLE
)

38 
	mNALU_TYPE_PREFIX
 = 14,

39 
	mNALU_TYPE_SUB_SPS
 = 15,

40 
	mNALU_TYPE_SLC_EXT
 = 20,

41 
	mNALU_TYPE_VDRD
 = 24

43 } 
	tN®uTy³
;

47 
	mNALU_PRIORITY_HIGHEST
 = 3,

48 
	mNALU_PRIORITY_HIGH
 = 2,

49 
	mNALU_PRIORITY_LOW
 = 1,

50 
	mNALU_PRIORITY_DISPOSABLE
 = 0

51 } 
	tN®RefIdc
;

54 
	sÇlu_t


56 
	m¡¬tcod•»fix_Ën
;

57 
	mËn
;

58 
	mmax_size
;

59 
	mfÜbidd’_b™
;

60 
N®uTy³
 
	mÇl_un™_ty³
;

61 
N®RefIdc
 
	mÇl_»ã»nû_idc
;

62 
by‹
 *
	mbuf
;

63 
ušt16
 
	mlo¡_·ck‘s
;

64 #ià(
MVC_EXTENSION_ENABLE
)

65 
	msvc_ex‹nsiÚ_æag
;

66 
	mnÚ_idr_æag
;

67 
	m´iÜ™y_id
;

68 
	mv›w_id
;

69 
	m‹mpÜ®_id
;

70 
	mªchÜ_pic_æag
;

71 
	mš‹r_v›w_æag
;

72 
	m»£rved_Úe_b™
;

74 } 
	tNALU_t
;

77 
NALU_t
 *
AÎocNALU
();

80 
F»eNALU
(
NALU_t
 *
n
);

82 #ià(
MVC_EXTENSION_ENABLE
)

83 
Çl_un™_h—d”_svc_ex‹nsiÚ
();

84 
´efix_Çl_un™_svc
();

	@lcommon/inc/parsetcommon.h

26 #iâdeà
_PARSETCOMMON_H_


27 
	#_PARSETCOMMON_H_


	)

29 
	~"defšes.h
"

31 
	#MAXIMUMPARSETRBSPSIZE
 1500

	)

32 
	#MAXIMUMPARSETNALUSIZE
 1500

	)

34 
	#MAXSPS
 32

	)

35 
	#MAXPPS
 256

	)

37 
	#MAXIMUMVALUEOFýb_út
 32

	)

40 
	mýb_út_mšus1
;

41 
	mb™_¿‹_sÿË
;

42 
	mýb_size_sÿË
;

43 
	mb™_¿‹_v®ue_mšus1
 [
MAXIMUMVALUEOFýb_út
];

44 
	mýb_size_v®ue_mšus1
 [
MAXIMUMVALUEOFýb_út
];

45 
	mcbr_æag
 [
MAXIMUMVALUEOFýb_út
];

46 
	mš™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

47 
	mýb_»mov®_d–ay_Ëngth_mšus1
;

48 
	mdpb_ouut_d–ay_Ëngth_mšus1
;

49 
	mtime_off£t_Ëngth
;

50 } 
	thrd_·¿m‘”s_t
;

55 
BoÞ—n
 
	ma¥eù_¿tio_šfo_´e£Á_æag
;

56 
	ma¥eù_¿tio_idc
;

57 
	m§r_width
;

58 
	m§r_height
;

59 
BoÞ—n
 
	mov”sÿn_šfo_´e£Á_æag
;

60 
BoÞ—n
 
	mov”sÿn_­´ÝrŸ‹_æag
;

61 
BoÞ—n
 
	mvideo_sigÇl_ty³_´e£Á_æag
;

62 
	mvideo_fÜm©
;

63 
BoÞ—n
 
	mvideo_fuÎ_¿nge_æag
;

64 
BoÞ—n
 
	mcÞour_desütiÚ_´e£Á_æag
;

65 
	mcÞour_´im¬›s
;

66 
	mŒªsãr_ch¬aù”i¡ics
;

67 
	mm©rix_cÛffic›Ás
;

68 
BoÞ—n
 
	mchroma_loÿtiÚ_šfo_´e£Á_æag
;

69 
	mchroma_§m¶e_loc_ty³_tÝ_f›ld
;

70 
	mchroma_§m¶e_loc_ty³_bÙtom_f›ld
;

71 
BoÞ—n
 
	mtimšg_šfo_´e£Á_æag
;

72 
	mnum_un™s_š_tick
;

73 
	mtime_sÿË
;

74 
BoÞ—n
 
	mfixed_äame_¿‹_æag
;

75 
BoÞ—n
 
	mÇl_hrd_·¿m‘”s_´e£Á_æag
;

76 
hrd_·¿m‘”s_t
 
	mÇl_hrd_·¿m‘”s
;

77 
BoÞ—n
 
	mvþ_hrd_·¿m‘”s_´e£Á_æag
;

78 
hrd_·¿m‘”s_t
 
	mvþ_hrd_·¿m‘”s
;

80 
BoÞ—n
 
	mlow_d–ay_hrd_æag
;

81 
BoÞ—n
 
	mpic_¡ruù_´e£Á_æag
;

82 
BoÞ—n
 
	mb™¡»am_»¡riùiÚ_æag
;

83 
BoÞ—n
 
	mmÙiÚ_veùÜs_ov”_pic_bound¬›s_æag
;

84 
	mmax_by‹s_³r_pic_d’om
;

85 
	mmax_b™s_³r_mb_d’om
;

86 
	mlog2_max_mv_Ëngth_v”tiÿl
;

87 
	mlog2_max_mv_Ëngth_hÜizÚl
;

88 
	mnum_»Üd”_äames
;

89 
	mmax_dec_äame_bufãršg
;

90 } 
	tvui_£q_·¿m‘”s_t
;

93 
	#MAXnum_¦iû_groups_mšus1
 8

	)

96 
BoÞ—n
 
	mV®id
;

97 
	mpic_·¿m‘”_£t_id
;

98 
	m£q_·¿m‘”_£t_id
;

99 
BoÞ—n
 
	m’ŒÝy_codšg_mode_æag
;

100 
BoÞ—n
 
	mŒªsfÜm_8x8_mode_æag
;

102 
BoÞ—n
 
	mpic_sÿlšg_m©rix_´e£Á_æag
;

103 
	mpic_sÿlšg_li¡_´e£Á_æag
[12];

104 
	mSÿlšgLi¡4x4
[6][16];

105 
	mSÿlšgLi¡8x8
[6][64];

106 
BoÞ—n
 
	mU£DeçuÉSÿlšgM©rix4x4FÏg
[6];

107 
BoÞ—n
 
	mU£DeçuÉSÿlšgM©rix8x8FÏg
[6];

110 
BoÞ—n
 
	mbÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
;

111 
	mnum_¦iû_groups_mšus1
;

112 
	m¦iû_group_m­_ty³
;

114 
	mrun_Ëngth_mšus1
[
MAXnum_¦iû_groups_mšus1
];

116 
	mtÝ_Ëá
[
MAXnum_¦iû_groups_mšus1
];

117 
	mbÙtom_right
[
MAXnum_¦iû_groups_mšus1
];

119 
BoÞ—n
 
	m¦iû_group_chªge_dœeùiÚ_æag
;

120 
	m¦iû_group_chªge_¿‹_mšus1
;

122 
	mpic_size_š_m­_un™s_mšus1
;

123 
by‹
 *
	m¦iû_group_id
;

125 
	mnum_»f_idx_l0_deçuÉ_aùive_mšus1
;

126 
	mnum_»f_idx_l1_deçuÉ_aùive_mšus1
;

127 
BoÞ—n
 
	mweigh‹d_´ed_æag
;

128 
	mweigh‹d_b»d_idc
;

129 
	mpic_š™_qp_mšus26
;

130 
	mpic_š™_qs_mšus26
;

131 
	mchroma_qp_šdex_off£t
;

133 
	mcb_qp_šdex_off£t
;

134 
	mü_qp_šdex_off£t
;

135 
	m£cÚd_chroma_qp_šdex_off£t
;

137 
BoÞ—n
 
	mdeblockšg_fž‹r_cÚŒÞ_´e£Á_æag
;

138 
BoÞ—n
 
	mcÚ¡¿šed_šŒa_´ed_æag
;

139 
BoÞ—n
 
	m»dundªt_pic_út_´e£Á_æag
;

140 
BoÞ—n
 
	mvui_pic_·¿m‘”s_æag
;

141 } 
	tpic_·¿m‘”_£t_rb¥_t
;

144 
	#MAXnum_»f_äames_š_pic_Üd”_út_cyþe
 256

	)

147 
BoÞ—n
 
	mV®id
;

149 
	m´ofže_idc
;

150 
BoÞ—n
 
	mcÚ¡¿šed_£t0_æag
;

151 
BoÞ—n
 
	mcÚ¡¿šed_£t1_æag
;

152 
BoÞ—n
 
	mcÚ¡¿šed_£t2_æag
;

153 
BoÞ—n
 
	mcÚ¡¿šed_£t3_æag
;

154 #ià(
MVC_EXTENSION_ENABLE
)

155 
BoÞ—n
 
	mcÚ¡¿šed_£t4_æag
;

156 
BoÞ—n
 
	mcÚ¡¿šed_£t5_æag
;

158 
	mËv–_idc
;

159 
	m£q_·¿m‘”_£t_id
;

160 
	mchroma_fÜm©_idc
;

162 
BoÞ—n
 
	m£q_sÿlšg_m©rix_´e£Á_æag
;

163 
	m£q_sÿlšg_li¡_´e£Á_æag
[12];

164 
	mSÿlšgLi¡4x4
[6][16];

165 
	mSÿlšgLi¡8x8
[6][64];

166 
BoÞ—n
 
	mU£DeçuÉSÿlšgM©rix4x4FÏg
[6];

167 
BoÞ—n
 
	mU£DeçuÉSÿlšgM©rix8x8FÏg
[6];

169 
	mb™_d•th_luma_mšus8
;

170 
	mb™_d•th_chroma_mšus8
;

171 
	mlog2_max_äame_num_mšus4
;

172 
	mpic_Üd”_út_ty³
;

174 
	mlog2_max_pic_Üd”_út_lsb_mšus4
;

176 
BoÞ—n
 
	md–_pic_Üd”_®ways_z”o_æag
;

177 
	moff£t_fÜ_nÚ_»f_pic
;

178 
	moff£t_fÜ_tÝ_to_bÙtom_f›ld
;

179 
	mnum_»f_äames_š_pic_Üd”_út_cyþe
;

181 
	moff£t_fÜ_»f_äame
[
MAXnum_»f_äames_š_pic_Üd”_út_cyþe
];

182 
	mnum_»f_äames
;

183 
BoÞ—n
 
	mg­s_š_äame_num_v®ue_®lowed_æag
;

184 
	mpic_width_š_mbs_mšus1
;

185 
	mpic_height_š_m­_un™s_mšus1
;

186 
BoÞ—n
 
	mäame_mbs_Úly_æag
;

188 
BoÞ—n
 
	mmb_ad­tive_äame_f›ld_æag
;

189 
BoÞ—n
 
	mdœeù_8x8_šã»nû_æag
;

190 
BoÞ—n
 
	mäame_üÝpšg_æag
;

191 
	mäame_üÝ_Ëá_off£t
;

192 
	mäame_üÝ_right_off£t
;

193 
	mäame_üÝ_tÝ_off£t
;

194 
	mäame_üÝ_bÙtom_off£t
;

195 
BoÞ—n
 
	mvui_·¿m‘”s_´e£Á_æag
;

196 
vui_£q_·¿m‘”s_t
 
	mvui_£q_·¿m‘”s
;

197 
	m£·¿‹_cÞour_¶ªe_æag
;

198 #ià(
MVC_EXTENSION_ENABLE
)

199 
	mmax_dec_äame_bufãršg
;

201 
	mlos¦ess_qµrime_æag
;

202 } 
	t£q_·¿m‘”_£t_rb¥_t
;

204 #ià(
MVC_EXTENSION_ENABLE
)

205 
	smvcvui_g


207 
	mnum_Ýs_mšus1
;

208 *
	m‹mpÜ®_id
;

209 *
	mnum_rg‘_ouut_v›ws_mšus1
;

210 **
	mv›w_id
;

211 *
	mtimšg_šfo_´e£Á_æag
;

212 *
	mnum_un™s_š_tick
;

213 *
	mtime_sÿË
;

214 *
	mfixed_äame_¿‹_æag
;

215 *
	mÇl_hrd_·¿m‘”s_´e£Á_æag
;

216 *
	mvþ_hrd_·¿m‘”s_´e£Á_æag
;

217 *
	mlow_d–ay_hrd_æag
;

218 *
	mpic_¡ruù_´e£Á_æag
;

221 
	mýb_út_mšus1
;

222 
	mb™_¿‹_sÿË
;

223 
	mýb_size_sÿË
;

224 
	mb™_¿‹_v®ue_mšus1
[32];

225 
	mýb_size_v®ue_mšus1
[32];

226 
	mcbr_æag
[32];

227 
	mš™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

228 
	mýb_»mov®_d–ay_Ëngth_mšus1
;

229 
	mdpb_ouut_d–ay_Ëngth_mšus1
;

230 
	mtime_off£t_Ëngth
;

231 }
	tMVCVUI_t
;

235 
£q_·¿m‘”_£t_rb¥_t
 
	m¥s
;

237 
	mb™_equ®_to_Úe
;

238 
	mnum_v›ws_mšus1
;

239 *
	mv›w_id
;

240 *
	mnum_ªchÜ_»fs_l0
;

241 **
	mªchÜ_»f_l0
;

242 *
	mnum_ªchÜ_»fs_l1
;

243 **
	mªchÜ_»f_l1
;

245 *
	mnum_nÚ_ªchÜ_»fs_l0
;

246 **
	mnÚ_ªchÜ_»f_l0
;

247 *
	mnum_nÚ_ªchÜ_»fs_l1
;

248 **
	mnÚ_ªchÜ_»f_l1
;

250 
	mnum_Ëv–_v®ues_sigÇÎed_mšus1
;

251 *
	mËv–_idc
;

252 *
	mnum_­¶iÿbË_Ýs_mšus1
;

253 **
	m­¶iÿbË_Ý_‹mpÜ®_id
;

254 **
	m­¶iÿbË_Ý_num_rg‘_v›ws_mšus1
;

255 ***
	m­¶iÿbË_Ý_rg‘_v›w_id
;

256 **
	m­¶iÿbË_Ý_num_v›ws_mšus1
;

258 
	mmvc_vui_·¿m‘”s_´e£Á_æag
;

259 
BoÞ—n
 
	mV®id
;

260 
MVCVUI_t
 
	mMVCVUIP¬ams
;

261 } 
	tsub£t_£q_·¿m‘”_£t_rb¥_t
;

265 
pic_·¿m‘”_£t_rb¥_t
 *
AÎocPPS
 ();

266 
£q_·¿m‘”_£t_rb¥_t
 *
AÎocSPS
 ();

268 
F»ePPS
 (
pic_·¿m‘”_£t_rb¥_t
 *
µs
);

269 
F»eSPS
 (
£q_·¿m‘”_£t_rb¥_t
 *
¥s
);

271 
¥s_is_equ®
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s1
, seq_·¿m‘”_£t_rb¥_ˆ*
¥s2
);

272 
µs_is_equ®
(
pic_·¿m‘”_£t_rb¥_t
 *
µs1
,…ic_·¿m‘”_£t_rb¥_ˆ*
µs2
);

	@lcommon/inc/quant_params.h

14 #iâdeà
_QUANT_PARAMS_H_


15 
	#_QUANT_PARAMS_H_


	)

17 
	sËv–_quªt_·¿ms
 {

18 
	mOff£tComp
;

19 
	mSÿËComp
;

20 
	mInvSÿËComp
;

21 } 
	tLev–QuªtP¬ams
;

23 
	squªt_·¿ms
 {

24 
	mAd­tRndWeight
;

25 
	mAd­tRndCrWeight
;

27 
Lev–QuªtP¬ams
 *****
	mq_·¿ms_4x4
;

28 
Lev–QuªtP¬ams
 *****
	mq_·¿ms_8x8
;

30 *
	mqp_³r_m©rix
;

31 *
	mqp_»m_m©rix
;

33 **
	mOff£tLi¡4x4šput
;

34 **
	mOff£tLi¡8x8šput
;

35 ***
	mOff£tLi¡4x4
;

36 ***
	mOff£tLi¡8x8
;

37 } 
	tQuªtP¬am‘”s
;

39 
	squªt_m‘hods
 {

40 
	mblock_y
;

41 
	mblock_x
;

42 
	mqp
;

43 * 
	mACLev–
;

44 * 
	mACRun
;

45 **
	mçdju¡
;

46 
Lev–QuªtP¬ams
 **
	mq_·¿ms
;

47 *
	mcÛff_co¡
;

48 cÚ¡ 
by‹
 (*
pos_sÿn
)[2];

49 cÚ¡ 
by‹
 *
	mc_co¡
;

50 
	mty³
;

51 } 
	tQuªtM‘hods
;

	@lcommon/inc/report.h

13 #iâdeà
_REPORT_H_


14 
	#_REPORT_H_


	)

15 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"’c_¡©i¡ics.h
"

19 
»pÜt
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
 );

20 
šfÜm©iÚ_š™
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
 );

21 
»pÜt_äame_¡©i¡ic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

22 
»pÜt_¡©s_Ú_”rÜ
 ();

	@lcommon/inc/resize.h

16 #iâdeà
_RESIZE_H_


17 
	#_RESIZE_H_


	)

18 
PyrDownG5x5_U8CnR
ÐcÚ¡ 
img³l
* 
¤c
,

19 
¤c¡•
,

20 
width
,

21 
height
,

22 
img³l
* 
d¡
,

23 
d¡¡•
,

24 
Cs


	@lcommon/inc/transform.h

18 #iâdeà
_TRANSFORM_H_


19 
	#_TRANSFORM_H_


	)

21 
fÜw¬d4x4
 (**
block
 , **
tblock
, 
pos_y
, 
pos_x
);

22 
šv”£4x4
 (**
tblock
, **
block
 , 
pos_y
, 
pos_x
);

23 
fÜw¬d8x8
 (**
block
 , **
tblock
, 
pos_y
, 
pos_x
);

24 
šv”£8x8
 (**
tblock
, **
block
 , 
pos_x
);

25 
hadam¬d4x4
 (**
block
 , **
tblock
);

26 
ihadam¬d4x4
 (**
tblock
, **
block
);

27 
hadam¬d4x2
 (**
block
 , **
tblock
);

28 
ihadam¬d4x2
 (**
tblock
, **
block
);

29 
hadam¬d2x2
 (**
block
 , 
tblock
[4]);

30 
ihadam¬d2x2
 (
block
[4], 
tblock
[4]);

	@lcommon/inc/typedefs.h

16 #iâdeà
_TYPEDEFS_H_


17 
	#_TYPEDEFS_H_


	)

19 
	~"wš32.h
"

21 
	tby‹
;

22 
	tušt8
;

23 
	tušt16
;

24 
	tušt32
;

26 
	tšt8
;

27 
	tšt16
;

28 
	tšt32
;

30 #ià
IMGTYPE
 == 0

31 
by‹
 
	timg³l
;

32 
ušt16
 
	tdi¡³l
;

33 
št32
 
	tdi¡blk
;

34 
št32
 
	tŒª¥–
;

36 
ušt16
 
	timg³l
;

37 
ušt32
 
	tdi¡³l
;

38 
št64
 
	tdi¡blk
;

39 
št32
 
	tŒª¥–
;

43 #ifdeà
FALSE


44 
	#BoÞ—n
 

	)

47 
	mFALSE
,

48 
	mTRUE


49 } 
	tBoÞ—n
;

52 #iâdeà
MAXINT64


53 
	#MAXINT64
 0x7fffffffffffffff

	)

	@lcommon/inc/types.h

14 #iâdeà
_TYPES_H_


15 
	#_TYPES_H_


	)

25 
	mPLANE_Y
 = 0,

26 
	mPLANE_U
 = 1,

27 
	mPLANE_V
 = 2,

29 
	mPLANE_G
 = 0,

30 
	mPLANE_B
 = 1,

31 
	mPLANE_R
 = 2

32 } 
	tCÞÜPÏÃ
;

35 
	mLIST_0
 = 0,

36 
	mLIST_1
 = 1,

37 
	mBI_PRED
 = 2,

38 
	mBI_PRED_L0
 = 3,

39 
	mBI_PRED_L1
 = 4

43 
	mERROR_SAD
 = 0,

44 
	mERROR_SSE
 = 1,

45 
	mERROR_SATD
 = 2,

46 
	mERROR_PSATD
 = 3

50 
	mME_Y_ONLY
 = 0,

51 
	mME_YUV_FP
 = 1,

52 
	mME_YUV_FP_SP
 = 2

57 
	mDISTORTION_MSE
 = 0

64 
	mPAR_DP_1
,

65 
	mPAR_DP_3


66 } 
	tPAR_DP_TYPE
;

72 
	mPAR_OF_ANNEXB
,

73 
	mPAR_OF_RTP


74 } 
	tPAR_OF_TYPE
;

79 
	mFRAME_CODING
 = 0,

80 
	mFIELD_CODING
 = 1,

81 
	mADAPTIVE_CODING
 = 2,

82 
	mFRAME_MB_PAIR_CODING
 = 3

83 } 
	tCodšgTy³
;

89 
	mSE_HEADER
,

90 
	mSE_PTYPE
,

91 
	mSE_MBTYPE
,

92 
	mSE_REFFRAME
,

93 
	mSE_INTRAPREDMODE
,

94 
	mSE_MVD
,

95 
	mSE_CBP
,

96 
	mSE_LUM_DC_INTRA
,

97 
	mSE_CHR_DC_INTRA
,

98 
	mSE_LUM_AC_INTRA
,

99 
	mSE_CHR_AC_INTRA
,

100 
	mSE_LUM_DC_INTER
,

101 
	mSE_CHR_DC_INTER
,

102 
	mSE_LUM_AC_INTER
,

103 
	mSE_CHR_AC_INTER
,

104 
	mSE_DELTA_QUANT
,

105 
	mSE_BFRAME
,

106 
	mSE_EOS
,

107 
	mSE_MAX_ELEMENTS
 = 20

108 } 
	tSE_ty³
;

113 
	mNO_SLICES
,

114 
	mFIXED_MB
,

115 
	mFIXED_RATE
,

116 
	mCALL_BACK


117 } 
	tSliûMode
;

122 
	mCAVLC
,

123 
	mCABAC


124 } 
	tSymbÞMode
;

128 
	mFULL_SEARCH
 = -1,

129 
	mFAST_FULL_SEARCH
 = 0,

130 
	mUM_HEX
 = 1,

131 
	mUM_HEX_SIMPLE
 = 2,

132 
	mEPZS
 = 3

133 } 
	tS—rchTy³
;

138 
	mFRAME
,

139 
	mTOP_FIELD
,

140 
	mBOTTOM_FIELD


141 } 
	tPiùu»SŒuùu»
;

145 
	mP_SLICE
 = 0,

146 
	mB_SLICE
 = 1,

147 
	mI_SLICE
 = 2,

148 
	mSP_SLICE
 = 3,

149 
	mSI_SLICE
 = 4,

150 
	mNUM_SLICE_TYPES
 = 5

151 } 
	tSliûTy³
;

156 
	mF_PEL
,

157 
	mH_PEL
,

158 
	mQ_PEL


159 } 
	tMELev–
;

163 
	mFAST_ACCESS
 = 0,

164 
	mUMV_ACCESS
 = 1

165 } 
	tREF_ACCESS_TYPE
;

169 
	mIS_LUMA
 = 0,

170 
	mIS_CHROMA
 = 1

171 } 
	tCompÚ’t_Ty³
;

175 
	mRC_MODE_0
 = 0,

176 
	mRC_MODE_1
 = 1,

177 
	mRC_MODE_2
 = 2,

178 
	mRC_MODE_3
 = 3

179 } 
	tRCModeTy³
;

183 
	mSSE
 = 0,

184 
	mSSE_RGB
 = 1,

185 
	mPSNR
 = 2,

186 
	mPSNR_RGB
 = 3,

187 
	mSSIM
 = 4,

188 
	mSSIM_RGB
 = 5,

189 
	mMS_SSIM
 = 6,

190 
	mMS_SSIM_RGB
 = 7,

191 
	mTOTAL_DIST_TYPES
 = 8

192 } 
	tdi¡ÜtiÚ_ty³s
;

195 
	mWP_MCPREC_PLUS0
 = 4,

196 
	mWP_MCPREC_PLUS1
 = 5,

197 
	mWP_MCPREC_MINUS0
 = 6,

198 
	mWP_MCPREC_MINUS1
 = 7,

199 
	mWP_MCPREC_MINUS_PLUS0
 = 8,

200 
	mWP_REGULAR
 = 9

201 } 
	tweigh‹d_´ediùiÚ_ty³s
;

	@lcommon/inc/vui_params.h

13 #iâdeà
_VUI_PARAMS_H_


14 
	#_VUI_PARAMS_H_


	)

17 
	svui_·¿m‘”s


19 
	ma¥eù_¿tio_šfo_´e£Á_æag
;

20 
	ma¥eù_¿tio_idc
;

21 
	m§r_width
;

22 
	m§r_height
;

23 
	mov”sÿn_šfo_´e£Á_æag
;

24 
	mov”sÿn_­´ÝrŸ‹_æag
;

25 
	mvideo_sigÇl_ty³_´e£Á_æag
;

26 
	mvideo_fÜm©
;

27 
	mvideo_fuÎ_¿nge_æag
;

28 
	mcÞour_desütiÚ_´e£Á_æag
;

29 
	mcÞour_´im¬›s
;

30 
	mŒªsãr_ch¬aù”i¡ics
;

31 
	mm©rix_cÛffic›Ás
;

32 
	mchroma_loÿtiÚ_šfo_´e£Á_æag
;

33 
	mchroma_§m¶e_loc_ty³_tÝ_f›ld
;

34 
	mchroma_§m¶e_loc_ty³_bÙtom_f›ld
;

35 
	mtimšg_šfo_´e£Á_æag
;

36 
	mnum_un™s_š_tick
;

37 
	mtime_sÿË
;

38 
	mfixed_äame_¿‹_æag
;

39 
	mÇl_hrd_·¿m‘”s_´e£Á_æag
;

40 
	mÇl_ýb_út_mšus1
;

41 
	mÇl_b™_¿‹_sÿË
;

42 
	mÇl_ýb_size_sÿË
;

43 
	mÇl_b™_¿‹_v®ue_mšus1
;

44 
	mÇl_ýb_size_v®ue_mšus1
;

45 
	mÇl_vbr_cbr_æag
;

46 
	mÇl_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

47 
	mÇl_ýb_»mov®_d–ay_Ëngth_mšus1
;

48 
	mÇl_dpb_ouut_d–ay_Ëngth_mšus1
;

49 
	mÇl_time_off£t_Ëngth
;

50 
	mvþ_hrd_·¿m‘”s_´e£Á_æag
;

51 
	mvþ_ýb_út_mšus1
;

52 
	mvþ_b™_¿‹_sÿË
;

53 
	mvþ_ýb_size_sÿË
;

54 
	mvþ_b™_¿‹_v®ue_mšus1
;

55 
	mvþ_ýb_size_v®ue_mšus1
;

56 
	mvþ_vbr_cbr_æag
;

57 
	mvþ_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

58 
	mvþ_ýb_»mov®_d–ay_Ëngth_mšus1
;

59 
	mvþ_dpb_ouut_d–ay_Ëngth_mšus1
;

60 
	mvþ_time_off£t_Ëngth
;

61 
	mlow_d–ay_hrd_æag
;

62 
	mpic_¡ruù_´e£Á_æag
;

63 
	mb™¡»am_»¡riùiÚ_æag
;

64 
	mmÙiÚ_veùÜs_ov”_pic_bound¬›s_æag
;

65 
	mmax_by‹s_³r_pic_d’om
;

66 
	mmax_b™s_³r_mb_d’om
;

67 
	mlog2_max_mv_Ëngth_v”tiÿl
;

68 
	mlog2_max_mv_Ëngth_hÜizÚl
;

69 
	mnum_»Üd”_äames
;

70 
	mmax_dec_äame_bufãršg
;

71 } 
	tVUIP¬am‘”s
;

	@lcommon/inc/win32.h

14 #iâdeà
_WIN32_H_


15 
	#_WIN32_H_


	)

17 
	~<fúŽ.h
>

18 
	~<¡dlib.h
>

19 
	~<¡dio.h
>

20 
	~<¡ršg.h
>

21 
	~<as£¹.h
>

23 #ià(
_MSC_VER
 >ð1400è|| 
defšed
(
__INTEL_COMPILER
è|| (
__GNUC__
 >= 5)

25 
	#NUM_THREADS
 8

	)

28 #ià
defšed
(
WIN32
è|| defšed (
WIN64
)

29 
	~<io.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<wšdows.h
>

33 #ià(
_MSC_VER
 < 1400)

34 
	tšŒ_t
;

36 
	~<ütdefs.h
>

38 #ià
defšed
(
OPENMP
)

39 
	~<omp.h
>

42 
	#¡rÿ£cmp
 
_¡rcmpi


	)

43 
	#¡ºÿ£cmp
 
_¡ºicmp


	)

45 
	#¢´štf
 
_¢´štf


	)

46 
	#Ý’
 
_Ý’


	)

47 
	#þo£
 
_þo£


	)

48 
	#»ad
 
_»ad


	)

49 
	#wr™e
 
_wr™e


	)

50 
	#l£ek
 
_l£eki64


	)

51 
	#fsync
 
_comm™


	)

52 
	#‹Î
 
_‹Îi64


	)

53 
	#TIMEB
 
_timeb


	)

54 
	#TIME_T
 
LARGE_INTEGER


	)

55 
	#OPENFLAGS_WRITE
 
_O_WRONLY
|
_O_CREAT
|
_O_BINARY
|
_O_TRUNC


	)

56 
	#OPEN_PERMISSIONS
 
_S_IREAD
 | 
_S_IWRITE


	)

57 
	#OPENFLAGS_READ
 
_O_RDONLY
|
_O_BINARY


	)

58 
	#šlše
 
_šlše


	)

59 
	#fÜûšlše
 
__fÜûšlše


	)

61 
	~<uni¡d.h
>

62 
	~<sys/time.h
>

63 
	~<sys/¡©.h
>

64 
	~<time.h
>

65 
	~<¡dšt.h
>

66 #ià
defšed
(
OPENMP
)

67 
	~<omp.h
>

70 
	#TIMEB
 
timeb


	)

71 
	#TIME_T
 
timev®


	)

72 
	#‹Î
(
fd
è
	`l£ek
(fd, 0, 
SEEK_CUR
)

	)

73 
	#OPENFLAGS_WRITE
 
O_WRONLY
|
O_CREAT
|
O_TRUNC


	)

74 
	#OPENFLAGS_READ
 
O_RDONLY


	)

75 
	#OPEN_PERMISSIONS
 
S_IRUSR
 | 
S_IWUSR


	)

77 #ià
__STDC_VERSION__
 >= 199901L

80 
	#šlše


	)

82 
	#fÜûšlše
 
šlše


	)

85 #ià(
defšed
(
WIN32
è|| defšed(
WIN64
)è&& !defšed(
__GNUC__
)

86 
__št64
 
	tšt64
;

87 
	t__št64
 
	tušt64
;

88 
	#FORMAT_OFF_T
 "I64d"

	)

89 #iâdeà
INT64_MIN


90 
	#INT64_MIN
 (-9223372036854775807
i64
 - 1i64)

	)

93 
	tšt64
;

94 
	tušt64
;

95 
	#FORMAT_OFF_T
 "Îd"

	)

96 #iâdeà
INT64_MIN


97 
	#INT64_MIN
 (-9223372036854775807LL - 1LL)

	)

101 
g‘time
(
TIME_T
* 
time
);

102 
š™_time
();

103 
št64
 
timediff
(
TIME_T
* 
¡¬t
, TIME_T* 
’d
);

104 
št64
 
tim’Üm
(št64 
cur_time
);

	@lcommon/src/blk_prediction.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<¡dlib.h
>

18 
	~<as£¹.h
>

19 
	~<lim™s.h
>

20 
	~<m©h.h
>

22 
	~"block.h
"

23 
	~"glob®.h
"

25 
	~"maüoblock.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"image.h
"

28 
	~"mb_acûss.h
"

30 
	$compu‹_»sidue
 (
img³l
 **
curImg
, img³È**
m´
, **
mb_¼es
, 
mb_x
, 
Ýix_x
, 
width
, 
height
)

32 
img³l
 *
imgOrg
, *
imgP»d
;

33 *
m7
;

34 
i
, 
j
;

36 
j
 = 0; j < 
height
; j++)

38 
imgOrg
 = &
curImg
[
j
][
Ýix_x
];

39 
imgP»d
 = &
m´
[
j
][
mb_x
];

40 
m7
 = &
mb_¼es
[
j
][
mb_x
];

41 
i
 = 0; i < 
width
; i++)

43 *
m7
++ = *
imgOrg
++ - *
imgP»d
++;

46 
	}
}

48 
	$§m¶e_»cÚ¡ruù
 (
img³l
 **
curImg
, img³È**
m´
, **
mb_¼es
, 
mb_x
, 
Ýix_x
, 
width
, 
height
, 
max_img³l_v®ue
, 
dq_b™s
)

50 
img³l
 *
imgOrg
, *
imgP»d
;

51 *
m7
;

52 
i
, 
j
;

54 
j
 = 0; j < 
height
; j++)

56 
imgOrg
 = &
curImg
[
j
][
Ýix_x
];

57 
imgP»d
 = &
m´
[
j
][
mb_x
];

58 
m7
 = &
mb_¼es
[
j
][
mb_x
];

59 
i
=0;i<
width
;i++)

60 *
imgOrg
++ = (
img³l
è
	`iCl1
Ð
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(*
m7
++, 
dq_b™s
è+ *
imgP»d
++);

62 
	}
}

	@lcommon/src/config_common.c

58 
	~<sys/¡©.h
>

60 
	~"glob®.h
"

61 
	~"cÚfigfže.h
"

62 
	~"mem®loc.h
"

64 
P¬am‘”NameToM­Index
 (
M­pšg
 *
M­
, *
s
);

67 
	#MAX_ITEMS_TO_PARSE
 10000

	)

81 *
	$G‘CÚfigFžeCÚ‹Á
 (*
Fž’ame
)

83 
FžeSize
;

84 
FILE
 *
f
;

85 *
buf
;

87 ià(
NULL
 =ð(
f
 = 
	`fÝ’
 (
Fž’ame
, "r")))

89 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "CªnÙ o³ÀcÚfigu¿tiÚ fž%s.", 
Fž’ame
);

90  
NULL
;

93 ià(0 !ð
	`f£ek
 (
f
, 0, 
SEEK_END
))

95 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "CªnÙ f£ek iÀcÚfigu¿tiÚ fž%s.", 
Fž’ame
);

96  
NULL
;

99 
FžeSize
 = 
	`á–l
 (
f
);

101 ià(
FžeSize
 < 0 || FileSize > 150000)

103 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "\nUÄ—sÚabË Fžesiz%ld„•Ü‹d by f‹Î fÜ cÚfigu¿tiÚ fž%s.", 
FžeSize
, 
Fž’ame
);

104  
NULL
;

106 ià(0 !ð
	`f£ek
 (
f
, 0, 
SEEK_SET
))

108 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "CªnÙ f£ek iÀcÚfigu¿tiÚ fž%s.", 
Fž’ame
);

109  
NULL
;

112 ià((
buf
 = 
	`m®loc
 (
FžeSize
 + 1))==
NULL
è
	`no_mem_ex™
("GetConfigFileContent: buf");

118 
FžeSize
 = (è
	`ä—d
 (
buf
, 1, FžeSize, 
f
);

119 
buf
[
FžeSize
] = '\0';

122 
	`fþo£
 (
f
);

123  
buf
;

124 
	}
}

143 
	$P¬£CÚ‹Á
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
M­pšg
 *
M­
, *
buf
, 
bufsize
)

145 *
™ems
[
MAX_ITEMS_TO_PARSE
] = {
NULL
};

146 
M­Idx
;

147 
™em
 = 0;

148 
InSŒšg
 = 0, 
InI‹m
 = 0;

149 *
p
 = 
buf
;

150 *
buãnd
 = &
buf
[
bufsize
];

151 
IÁCÚ‹Á
;

152 
DoubËCÚ‹Á
;

153 
i
;

158 
p
 < 
buãnd
)

160 *
p
)

163 ++
p
;

166 *
p
 = '\0';

167 *
p
 !ð'\n' &&… < 
buãnd
)

168 ++
p
;

169 
InSŒšg
 = 0;

170 
InI‹m
 = 0;

173 
InI‹m
 = 0;

174 
InSŒšg
 = 0;

175 *
p
++='\0';

179 ià(
InSŒšg
)

180 
p
++;

183 *
p
++ = '\0';

184 
InI‹m
 = 0;

189 *
p
++ = '\0';

190 ià(!
InSŒšg
)

192 
™ems
[
™em
++] = 
p
;

193 
InI‹m
 = ~InItem;

196 
InI‹m
 = 0;

197 
InSŒšg
 = ~InString;

201 ià(!
InI‹m
)

203 
™ems
[
™em
++] = 
p
;

204 
InI‹m
 = ~InItem;

206 
p
++;

210 
™em
--;

212 
i
=0; i<
™em
; i+= 3)

214 ià(0 > (
M­Idx
 = 
	`P¬am‘”NameToM­Index
 (
M­
, 
™ems
[
i
])))

218 
	`´štf
 ("\n\tP¬sšgƒ¼Ü iÀcÚfig fže: P¬am‘” Nam'%s'‚Ù„ecognized.", 
™ems
[
i
]);

219 
i
 -= 2 ;

222 ià(
	`¡rÿ£cmp
 ("=", 
™ems
[
i
+1]))

224 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " Parsingƒrror in config file: '='ƒxpected‡she secondoken inƒach†ine.");

225 
	`”rÜ
 (
”rÜ‹xt
, 300);

230 
M­
[
M­Idx
].
Ty³
)

233 ià(1 !ð
	`ssÿnf
 (
™ems
[
i
+2], "%d", &
IÁCÚ‹Á
))

235 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " P¬sšgƒ¼Ü: Ex³ùed‚um”iÿÈv®ufÜ P¬am‘” oà%s, found '%s'.", 
™ems
[
i
], items[i+2]);

236 
	`”rÜ
 (
”rÜ‹xt
, 300);

238 * (*è(
M­
[
M­Idx
].
PÏû
èð
IÁCÚ‹Á
;

239 
	`´štf
 (".");

242 ià(
™ems
[
i
 + 2] =ð
NULL
)

243 
	`mem£t
((*è
M­
[
M­Idx
].
PÏû
, 0, M­[M­Idx].
ch¬_size
);

245 
	`¡ºýy
 ((*è
M­
[
M­Idx
].
PÏû
, 
™ems
 [
i
+2], M­[M­Idx].
ch¬_size
);

246 
	`´štf
 (".");

249 ià(1 !ð
	`ssÿnf
 (
™ems
[
i
+2], "%lf", &
DoubËCÚ‹Á
))

251 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " P¬sšgƒ¼Ü: Ex³ùed‚um”iÿÈv®ufÜ P¬am‘” oà%s, found '%s'.", 
™ems
[
i
], items[i+2]);

252 
	`”rÜ
 (
”rÜ‹xt
, 300);

254 * (*è(
M­
[
M­Idx
].
PÏû
èð
DoubËCÚ‹Á
;

255 
	`´štf
 (".");

258 
	`”rÜ
 ("Unknown valueype inhe map definition of configfile.h",-1);

261 *
p_IÅ
 = 
cfg·¿ms
;

262 
	}
}

277 
	$P¬am‘”NameToM­Index
 (
M­pšg
 *
M­
, *
s
)

279 
i
 = 0;

281 
M­
[
i
].
Tok’Name
 !ð
NULL
)

282 ià(0==
	`¡rÿ£cmp
 (
M­
[
i
].
Tok’Name
, 
s
))

283  
i
;

285 
i
++;

287 
	}
}

297 
	$In™P¬ams
(
M­pšg
 *
M­
)

299 
i
 = 0;

301 
M­
[
i
].
Tok’Name
 !ð
NULL
)

303 ià(
M­
[
i
].
Ty³
 == 0)

304 * (*è(
M­
[
i
].
PÏû
èð(èM­[i].
DeçuÉ
;

305 ià(
M­
[
i
].
Ty³
 == 2)

306 * (*è(
M­
[
i
].
PÏû
èðM­[i].
DeçuÉ
;

307 
i
++;

310 
	}
}

320 
	$Te¡P¬ams
(
M­pšg
 *
M­
, 
b™d•th_qp_sÿË
[3])

322 
i
 = 0;

324 
M­
[
i
].
Tok’Name
 !ð
NULL
)

326 ià(
M­
[
i
].
·¿m_lim™s
 == 1)

328 ià(
M­
[
i
].
Ty³
 == 0)

330 iàÐ* (*è(
M­
[
i
].
PÏû
è< (èM­[i].
mš_lim™
 || * (*è(M­[i].PÏûè> (èM­[i].
max_lim™
 )

332 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%d, %d]„ªge.", 
M­
[
i
].
Tok’Name
, (èM­[i].
mš_lim™
,()M­[i].
max_lim™
 );

333 
	`”rÜ
 (
”rÜ‹xt
, 400);

337 ià(
M­
[
i
].
Ty³
 == 2)

339 iàÐ* (*è(
M­
[
i
].
PÏû
è< M­[i].
mš_lim™
 || * (*è(M­[i].PÏûè> M­[i].
max_lim™
 )

341 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%.2f, %.2f]„ªge.", 
M­
[
i
].
Tok’Name
,M­[i].
mš_lim™
 ,M­[i].
max_lim™
 );

342 
	`”rÜ
 (
”rÜ‹xt
, 400);

346 ià(
M­
[
i
].
·¿m_lim™s
 == 2)

348 ià(
M­
[
i
].
Ty³
 == 0)

350 iàÐ* (*è(
M­
[
i
].
PÏû
è< (èM­[i].
mš_lim™
 )

352 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould‚Ù bsm®Ë¸thª %d.", 
M­
[
i
].
Tok’Name
, (èM­[i].
mš_lim™
);

353 
	`”rÜ
 (
”rÜ‹xt
, 400);

356 ià(
M­
[
i
].
Ty³
 == 2)

358 iàÐ* (*è(
M­
[
i
].
PÏû
è< M­[i].
mš_lim™
 )

360 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould‚Ù bsm®Ë¸thª %2.f.", 
M­
[
i
].
Tok’Name
,M­[i].
mš_lim™
);

361 
	`”rÜ
 (
”rÜ‹xt
, 400);

365 ià(
M­
[
i
].
·¿m_lim™s
 == 3)

368 ià(
M­
[
i
].
Ty³
 == 0)

370 
cur_qp
 = * (*è(
M­
[
i
].
PÏû
);

371 
mš_qp
 = (è(
M­
[
i
].
mš_lim™
 - (
b™d•th_qp_sÿË
? bitdepth_qp_scale[0]: 0));

372 
max_qp
 = (è
M­
[
i
].
max_lim™
;

374 ià(Ð
cur_qp
 < 
mš_qp
 ) || ( cur_q°> 
max_qp
 ))

376 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%d, %d]„ªge.", 
M­
[
i
].
Tok’Name
, 
mš_qp
, 
max_qp
 );

377 
	`”rÜ
 (
”rÜ‹xt
, 400);

382 
i
++;

385 
	}
}

397 
	$Di¥ÏyP¬ams
(
M­pšg
 *
M­
, *
mes§ge
)

399 
i
 = 0;

401 
	`´štf
("******************************************************\n");

402 
	`´štf
("* %  *\n", 
mes§ge
);

403 
	`´štf
("******************************************************\n");

404 
M­
[
i
].
Tok’Name
 !ð
NULL
)

406 ià(
M­
[
i
].
Ty³
 == 0)

407 
	`´štf
("P¬am‘” % ð%d\n",
M­
[
i
].
Tok’Name
,* (*è(M­[i].
PÏû
));

408 ià(
M­
[
i
].
Ty³
 == 1)

409 
	`´štf
("P¬am‘” % ð""%s""\n",
M­
[
i
].
Tok’Name
,(*è(M­[i].
PÏû
));

410 ià(
M­
[
i
].
Ty³
 == 2)

411 
	`´štf
("P¬am‘” % ð%.2f\n",
M­
[
i
].
Tok’Name
,* (*è(M­[i].
PÏû
));

412 
i
++;

414 
	`´štf
("******************************************************\n");

415  
i
;

416 
	}
}

	@lcommon/src/img_io.c

14 
	~"cÚŒibutÜs.h
"

15 
	~"glob®.h
"

16 
	~"img_io.h
"

17 
	~"»pÜt.h
"

19 cÚ¡ 
VIDEO_SIZE
 
	gVideoRes
[] = {

31 { 
NULL
, 0, 0}

41 
	$P¬£SizeFromSŒšg
 (
VideoD©aFže
 *
šput_fže
, *
x_size
, *
y_size
, *
ås
)

43 *
p1
, *
p2
, *
ž
;

44 *
â
 = 
šput_fže
->
âame
;

45 
c
;

46 
i
 = 0;

48 *
x_size
 = *
y_size
 = -1;

49 
p1
 = 
p2
 = 
â
;

50 
p1
 !ð
NULL
 && 
p2
 != NULL)

53 
p1
 = 
	`¡r¡r
(…1, "_");

54 ià(
p1
 =ð
NULL
)

58 
p2
 = 
	`¡r¡r
Ð
p1
, "x");

61 ià(
p2
 =ð
NULL
)

65 *
p2
 = 0;

66 *
x_size
 = 
	`¡¹Þ
Ð
p1
 + 1, &
ž
, 10);

69 ià(*
ž
 !ð'\0' || *(
p1
 + 1) == '\0')

71 *
p2
 = 'x';

72 
p1
 = 
ž
;

77 *
p2
 = 'x';

80 
p1
 = 
	`¡½brk
Ð
p2
 + 1, "_.");

82 ià(
p1
 =ð
NULL
)

84 
p1
 = 
p2
 + 1;

89 
c
 = *
p1
;

90 *
p1
 = 0;

91 *
y_size
 = 
	`¡¹Þ
Ð
p2
 + 1, &
ž
, 10);

94 ià(*
ž
 !ð'\0' || *(
p2
 + 1) == '\0')

96 *
p1
 = 
c
;

97 
p1
 = 
ž
;

102 *
p1
 = 
c
;

105 
p2
 = 
	`¡r¡r
Ð
p1
 + 1, "ip");

108 ià(
p2
 =ð
NULL
)

112 
c
 = *
p2
;

113 *
p2
 = 0;

114 *
ås
 = 
	`¡¹od
Ð
p1
 + 1, &
ž
);

117 ià(*
ž
 !ð'\0' || *(
p1
 + 1) == '\0')

119 *
p2
 = 
c
;

120 
p1
 = 
ž
;

125 *
p2
 = 
c
;

130 ià(
p1
 =ð
NULL
 || 
p2
 == NULL)

132 
i
 = 0; 
VideoRes
[i].
Çme
 !ð
NULL
; i++)

134 ià(
	`¡rÿ£cmp
 (
â
, 
VideoRes
[
i
].
Çme
))

136 *
x_size
 = 
VideoRes
[
i
].x_size;

137 *
y_size
 = 
VideoRes
[
i
].y_size;

144  (*
x_size
 =ð-1 || *
y_size
 == -1) ? 0 : 1;

145 
	}
}

154 
	$P¬£F¿meNoFÜm©FromSŒšg
 (
VideoD©aFže
 *
šput_fže
)

156 *
p1
, *
p2
, *
ž
;

157 *
â
 = 
šput_fže
->
âame
;

158 *
fh—d
 = 
šput_fže
->fhead;

159 *
áaž
 = 
šput_fže
->ftail;

160 *
z”o_·d
 = &
šput_fže
->zero_pad;

161 *
num_dig™s
 = &
šput_fže
->num_digits;

163 *
z”o_·d
 = 0;

164 *
num_dig™s
 = -1;

165 
p1
 = 
p2
 = 
â
;

166 
p1
 !ð
NULL
 && 
p2
 != NULL)

169 
p1
 = 
	`¡r¡r
(…1, "%");

170 ià(
p1
 =ð
NULL
)

173 
	`¡ºýy
(
fh—d
, 
â
, 
p1
 - fn);

176 
p2
 = 
	`¡r¡r
Ð
p1
, "d");

179 ià(
p2
 =ð
NULL
)

183 *
p2
 = 0;

185 ià(*(
p1
 + 1) == '0')

186 *
z”o_·d
 = 1;

188 *
num_dig™s
 = 
	`¡¹Þ
Ð
p1
 + 1, &
ž
, 10);

191 ià(*
ž
 !ð'\0' || *(
p1
 + 1) == '\0')

193 *
p2
 = 'd';

194 
p1
 = 
ž
;

199 *
p2
 = 'd';

201 
ž
++;

202 
	`¡ºýy
(
áaž
, 
ž
, (è
	`¡¾’
(tail));

206 ià(
šput_fže
->
vdty³
 =ð
VIDEO_TIFF
)

208 
šput_fže
->
is_cÚÿ‹Ç‹d
 = 0;

211 
šput_fže
->
is_cÚÿ‹Ç‹d
 = (*
num_dig™s
 == -1) ? 1 : 0;

212 
	}
}

220 
	$O³nF¿meFže
Ð
VideoD©aFže
 *
šput_fže
, 
F¿meNumb”InFže
)

222 
šfže
 [
FILE_NAME_SIZE
], 
š_numb”
[16];

223 
šfže
[
FILE_NAME_SIZE
-1]='\0';

224 
	`¡ºýy
(
šfže
, 
šput_fže
->
fh—d
, 
FILE_NAME_SIZE
-1);

226 ià(
šput_fže
->
z”o_·d
)

227 
	`¢´štf
(
š_numb”
, 16, "%0*d", 
šput_fže
->
num_dig™s
, 
F¿meNumb”InFže
);

229 
	`¢´štf
(
š_numb”
, 16, "%*d", 
šput_fže
->
num_dig™s
, 
F¿meNumb”InFže
);

231 
	`¡ºÿt
(
šfže
, 
š_numb”
, 
FILE_NAME_SIZE
-
	`¡¾’
(in_number)-1);

232 
	`¡ºÿt
(
šfže
, 
šput_fže
->
áaž
, 
FILE_NAME_SIZE
-
	`¡¾’
(input_file->ftail)-1);

234 ià((
šput_fže
->
f_num
 = 
	`Ý’
(
šfže
, 
OPENFLAGS_READ
)) == -1)

236 
	`´štf
 ("O³nF¿meFže: cªnÙ o³Àfž%s\n", 
šfže
);

237 
	`»pÜt_¡©s_Ú_”rÜ
();

239 
	}
}

247 
	$O³nFžes
Ð
VideoD©aFže
 *
šput_fže
)

249 ià(
šput_fže
->
is_cÚÿ‹Ç‹d
 == 1)

251 ià((è
	`¡¾’
(
šput_fže
->
âame
) == 0)

253 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "No input sequence‚ame was…rovided. Please check settings.");

254 
	`”rÜ
 (
”rÜ‹xt
, 500);

257 ià((
šput_fže
->
f_num
 = 
	`Ý’
(šput_fže->
âame
, 
OPENFLAGS_READ
)) == -1)

259 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "IÅuˆfž% dÛ nÙƒxi¡",
šput_fže
->
âame
);

260 
	`”rÜ
 (
”rÜ‹xt
, 500);

263 
	}
}

271 
	$Clo£Fžes
(
VideoD©aFže
 *
šput_fže
)

273 ià(
šput_fže
->
f_num
 != -1)

274 
	`þo£
(
šput_fže
->
f_num
);

275 
šput_fže
->
f_num
 = -1;

276 
	}
}

284 
VideoFžeTy³
 
	$P¬£VideoTy³
 (
VideoD©aFže
 *
šput_fže
)

286 *
fÜm©
;

288 
fÜm©
 = 
šput_fže
->
âame
 + (è
	`¡¾’
(input_file->fname) - 3;

290 ià(
	`¡rÿ£cmp
 (
fÜm©
, "yuv") == 0)

292 
šput_fže
->
vdty³
 = 
VIDEO_YUV
;

293 
šput_fže
->
fÜm©
.
yuv_fÜm©
 = 
YUV420
;

294 
šput_fže
->
avi
 = 
NULL
;

296 ià(
	`¡rÿ£cmp
 (
fÜm©
, "rgb") == 0)

298 
šput_fže
->
vdty³
 = 
VIDEO_RGB
;

299 
šput_fže
->
fÜm©
.
yuv_fÜm©
 = 
YUV444
;

300 
šput_fže
->
avi
 = 
NULL
;

302 ià(
	`¡rÿ£cmp
 (
fÜm©
, "tif") == 0)

304 
šput_fže
->
vdty³
 = 
VIDEO_TIFF
;

305 
šput_fže
->
avi
 = 
NULL
;

307 ià(
	`¡rÿ£cmp
 (
fÜm©
, "avi") == 0)

309 
šput_fže
->
vdty³
 = 
VIDEO_AVI
;

315 
šput_fže
->
vdty³
 = 
VIDEO_YUV
;

316 
šput_fže
->
fÜm©
.
yuv_fÜm©
 = 
YUV420
;

317 
šput_fže
->
avi
 = 
NULL
;

320  
šput_fže
->
vdty³
;

321 
	}
}

	@lcommon/src/img_process.c

15 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"img_´oûss.h
"

18 
	~"io_image.h
"

19 
	~"mem®loc.h
"

20 
	~"ç¡_memÜy.h
"

22 
šlše
 
	$Re£tImage
(
ImageD©a
 *
imgOut
)

24 
	`ç¡_mem£t
(
imgOut
->
äm_d©a
[0][0], 0, imgOut->
fÜm©
.
height
[0] * imgOut->fÜm©.
width
[0] *  (
img³l
));

26 ià(
imgOut
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

28 ià((
img³l
) == ())

30 
	`ç¡_mem£t
(
imgOut
->
äm_d©a
[1][0], 128, imgOut->
fÜm©
.
height
[1] * imgOut->fÜm©.
width
[1] *  (
img³l
));

31 
	`ç¡_mem£t
(
imgOut
->
äm_d©a
[2][0], 128, imgOut->
fÜm©
.
height
[2] * imgOut->fÜm©.
width
[2] *  (
img³l
));

35 
i
, 
j
, 
k
;

36 
img³l
 
med_v®ue
;

37 
k
 = 1; k <=2; k++)

39 
med_v®ue
 = (
img³l
è(
imgOut
->
fÜm©
.
max_v®ue
[
k
] + 1) >> 1;

40 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[
k
]; j++)

42 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[
k
]; i++)

44 
imgOut
->
äm_d©a
[
k
][
j
][
i
] = 
med_v®ue
;

50 
	}
}

53 
šlše
 
	$CPImage
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn
)

55 
	`memýy
(
imgOut
->
äm_d©a
[0][0], 
imgIn
->äm_d©a[0][0], imgIn->
fÜm©
.
height
[0] * imgIn->fÜm©.
width
[0] *  (
img³l
));

57 ià(
imgIn
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

59 
	`memýy
(
imgOut
->
äm_d©a
[1][0], 
imgIn
->äm_d©a[1][0], imgIn->
fÜm©
.
height
[1] * imgIn->fÜm©.
width
[1] *  (
img³l
));

60 
	`memýy
(
imgOut
->
äm_d©a
[2][0], 
imgIn
->äm_d©a[2][0], imgIn->
fÜm©
.
height
[2] * imgIn->fÜm©.
width
[2] *  (
img³l
));

62 
	}
}

65 
šlše
 
	$Fž‹rImage
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn
)

67 
	`memýy
(
imgOut
->
äm_d©a
[0][0], 
imgIn
->äm_d©a[0][0], imgIn->
fÜm©
.
height
[0] * imgIn->fÜm©.
width
[0] *  (
img³l
));

69 ià(
imgIn
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

71 
	`memýy
(
imgOut
->
äm_d©a
[1][0], 
imgIn
->äm_d©a[1][0], imgIn->
fÜm©
.
height
[1] * imgIn->fÜm©.
width
[1] *  (
img³l
));

72 
	`memýy
(
imgOut
->
äm_d©a
[2][0], 
imgIn
->äm_d©a[2][0], imgIn->
fÜm©
.
height
[2] * imgIn->fÜm©.
width
[2] *  (
img³l
));

74 
	}
}

77 
šlše
 
	$BËndImageLšes
(
ImageD©a
 *
imgIn0
, ImageD©¨*
imgIn1
)

79 
j
;

80 
j
 = 1; j < 
imgIn1
->
fÜm©
.
height
[0]; j += 2)

81 
	`memýy
(
imgIn0
->
äm_d©a
[0][
j
], 
imgIn1
->äm_d©a[0][j], imgIn1->
fÜm©
.
width
[0] *  (
img³l
));

83 ià(
imgIn1
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

85 
j
 = 1; j < 
imgIn1
->
fÜm©
.
height
[1]; j += 2)

87 
	`memýy
(
imgIn0
->
äm_d©a
[1][
j
], 
imgIn1
->äm_d©a[1][j], imgIn1->
fÜm©
.
width
[1] *  (
img³l
));

89 
j
 = 1; j < 
imgIn1
->
fÜm©
.
height
[2]; j += 2)

91 
	`memýy
(
imgIn0
->
äm_d©a
[2][
j
], 
imgIn1
->äm_d©a[2][j], imgIn1->
fÜm©
.
width
[2] *  (
img³l
));

94 
	}
}

97 
šlše
 
	$Fž‹rImageS•
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn
)

99 
i
, 
j
;

100 cÚ¡ 
S•Fž‹r
[6] = {1, -5, 20, 20, -5, 1};

101 
max_width
 = 
imgOut
->
fÜm©
.
width
[0] - 1;

102 
max_height
 = 
imgOut
->
fÜm©
.
height
[0] - 1;

104 **
‹mp_d©a
 = 
	`Ãw_mem2Dšt
(
imgIn
->
fÜm©
.
height
[0], imgIn->fÜm©.
width
[0]);

105 
img³l
 *
äm_d©a
 = 
NULL
;

109 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[0]; j++)

111 
äm_d©a
 = 
imgIn
->äm_d©a[0][
j
];

112 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[0]; i++)

114 
‹mp_d©a
[
j
][
i
] =

115 
S•Fž‹r
[0] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 - 2)] +

116 
S•Fž‹r
[1] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 - 1)] +

117 
S•Fž‹r
[2] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 )] +

118 
S•Fž‹r
[3] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 1)] +

119 
S•Fž‹r
[4] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 2)] +

120 
S•Fž‹r
[5] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 3)];

124 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[0]; j++)

126 
äm_d©a
 = 
imgOut
->äm_d©a[0][
j
];

127 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[0]; i++)

129 
äm_d©a
[
i
] = (
img³l
è
	`iCl3
(0, 
imgOut
->
fÜm©
.
max_v®ue
[0], 
	`rshiá_ºd_sign
(

130 
S•Fž‹r
[0] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 - 2)][
i
] +

131 
S•Fž‹r
[1] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 - 1)][
i
] +

132 
S•Fž‹r
[2] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 )][
i
] +

133 
S•Fž‹r
[3] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 1)][
i
] +

134 
S•Fž‹r
[4] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 2)][
i
] +

135 
S•Fž‹r
[5] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 3)][
i
], 10));

139 ià(
imgOut
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

141 
k
;

143 
k
 = 1; k <=2; k++)

145 
max_width
 = 
imgOut
->
fÜm©
.
width
[
k
] - 1;

146 
max_height
 = 
imgOut
->
fÜm©
.
height
[
k
] - 1;

149 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[
k
]; j++)

151 
äm_d©a
 = 
imgIn
->äm_d©a[
k
][
j
];

152 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[
k
]; i++)

154 
‹mp_d©a
[
j
][
i
] =

155 
S•Fž‹r
[0] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 - 2)] +

156 
S•Fž‹r
[1] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 - 1)] +

157 
S•Fž‹r
[2] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 )] +

158 
S•Fž‹r
[3] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 1)] +

159 
S•Fž‹r
[4] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 2)] +

160 
S•Fž‹r
[5] * 
äm_d©a
[
	`iCl3
(0, 
max_width
, 
i
 + 3)];

164 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[
k
]; j++)

166 
äm_d©a
 = 
imgOut
->äm_d©a[
k
][
j
];

167 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[
k
]; i++)

169 
äm_d©a
[
i
] = (
img³l
è
	`iCl3
(0, 
imgOut
->
fÜm©
.
max_v®ue
[
k
], 
	`rshiá_ºd_sign
(

170 
S•Fž‹r
[0] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 - 2)][
i
] +

171 
S•Fž‹r
[1] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 - 1)][
i
] +

172 
S•Fž‹r
[2] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 )][
i
] +

173 
S•Fž‹r
[3] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 1)][
i
] +

174 
S•Fž‹r
[4] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 2)][
i
] +

175 
S•Fž‹r
[5] * 
‹mp_d©a
[
	`iCl3
(0, 
max_height
, 
j
 + 3)][
i
], 10));

181 
	`ä“_mem2Dšt
(
‹mp_d©a
);

182 
	}
}

186 
šlše
 
	$MuxImages
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn0
, ImageD©¨*
imgIn1
, ImageD©¨*
M­
)

188 
i
, 
j
;

189 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[0]; j++)

191 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[0]; i++)

193 
imgOut
->
äm_d©a
[0][
j
][
i
] = (
img³l
è
	`rshiá_ºd_sf
(
imgIn0
->äm_d©a[0][j][i] * (
M­
->
fÜm©
.
max_v®ue
[0] - M­->äm_d©a[0][j][i]è+ 
imgIn1
->äm_d©a[0][j][i] * M­->äm_d©a[0][j][i], M­->fÜm©.
b™_d•th
[0]);

197 ià(
imgOut
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

199 
k
;

200 
k
 = 1; k <=2; k++)

202 
j
 = 0; j < 
imgOut
->
fÜm©
.
height
[
k
]; j++)

204 
i
 = 0; i < 
imgOut
->
fÜm©
.
width
[
k
]; i++)

206 
imgOut
->
äm_d©a
[
k
][
j
][
i
] = (
img³l
è
	`rshiá_ºd_sf
(
imgIn0
->äm_d©a[k][j][i] * (
M­
->
fÜm©
.
max_v®ue
[k] - M­->äm_d©a[k][j][i]è+ 
imgIn1
->äm_d©a[k][j][i] * M­->äm_d©a[k][j][i], M­->fÜm©.
b™_d•th
[k]);

211 
	}
}

213 
šlše
 
	$YV12toYUV
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn
)

215 
	`memýy
(
imgOut
->
äm_d©a
[0][0], 
imgIn
->äm_d©a[0][0], imgIn->
fÜm©
.
height
[0] * imgIn->fÜm©.
width
[0] *  (
img³l
));

217 ià(
imgIn
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

219 
	`memýy
(
imgOut
->
äm_d©a
[1][0], 
imgIn
->äm_d©a[2][0], imgIn->
fÜm©
.
height
[1] * imgIn->fÜm©.
width
[1] *  (
img³l
));

220 
	`memýy
(
imgOut
->
äm_d©a
[2][0], 
imgIn
->äm_d©a[1][0], imgIn->
fÜm©
.
height
[2] * imgIn->fÜm©.
width
[2] *  (
img³l
));

222 
	}
}

224 
	$´oûss_image
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

226  
p_IÅ
->
ProûssIÅut
 )

230 
	`CPImage
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a0
);

231 ià(
p_IÅ
->
’abË_32_puÎdown
)

232 
	`BËndImageLšes
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a4
);

235 
	`Fž‹rImage
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a0
);

236 ià(
p_IÅ
->
’abË_32_puÎdown
)

238 
	`Fž‹rImage
(&
p_Vid
->
imgD©a32
, &p_Vid->
imgD©a4
);

239 
	`BËndImageLšes
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a32
);

243 
	`YV12toYUV
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a0
);

244 ià(
p_IÅ
->
’abË_32_puÎdown
)

246 
	`YV12toYUV
(&
p_Vid
->
imgD©a32
, &p_Vid->
imgD©a4
);

247 
	`BËndImageLšes
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a32
);

251 
	`MuxImages
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a0
, &p_Vid->
imgD©a1
, &p_Vid->
imgD©a2
);

252 ià(
p_IÅ
->
’abË_32_puÎdown
)

254 
	`MuxImages
(&
p_Vid
->
imgD©a32
, &p_Vid->
imgD©a4
, &p_Vid->
imgD©a5
, &p_Vid->
imgD©a6
);

255 
	`BËndImageLšes
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a32
);

260 
	`Fž‹rImageS•
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a0
);

261 ià(
p_IÅ
->
’abË_32_puÎdown
)

263 
	`Fž‹rImageS•
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a4
);

264 
	`BËndImageLšes
(&
p_Vid
->
imgD©a
, &p_Vid->
imgD©a32
);

269 
	}
}

	@lcommon/src/input.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

19 
	~<time.h
>

21 
	~"glob®.h
"

22 
	~"defšes.h
"

23 
	~"šput.h
"

24 
	~"img_io.h
"

25 
	~"mem®loc.h
"

26 
	~"ç¡_memÜy.h
"

28 
buf2img_basic
 ( 
img³l
** 
imgX
, * 
buf
, 
size_x
, 
size_y
, 
o_size_x
, 
o_size_y
, 
symbÞ_size_š_by‹s
, 
b™shiá
);

29 
buf2img_’dŸn
 ( 
img³l
** 
imgX
, * 
buf
, 
size_x
, 
size_y
, 
o_size_x
, 
o_size_y
, 
symbÞ_size_š_by‹s
, 
b™shiá
);

30 
buf2img_b™shiá
 ( 
img³l
** 
imgX
, * 
buf
, 
size_x
, 
size_y
, 
o_size_x
, 
o_size_y
, 
symbÞ_size_š_by‹s
, 
b™shiá
);

31 
fžlPÏÃ
 ( 
img³l
** 
imgX
, 
nV®
, 
size_x
, 
size_y
);

42 
	$š™IÅut
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
sourû
, F¿meFÜm© *
ouut
)

44 ià(
sourû
->
b™_d•th
[0] =ð
ouut
->bit_depth[0] && source->bit_depth[1] == output->bit_depth[1])

46 ià(Ð(è!ð (
img³l
)è&& 
	`‹¡EndŸn
())

47 
p_Vid
->
buf2img
 = 
buf2img_’dŸn
;

49 
p_Vid
->
buf2img
 = 
buf2img_basic
;

52 
p_Vid
->
buf2img
 = 
buf2img_b™shiá
;

53 
	}
}

65 
	$‹¡EndŸn
()

67 
s
;

68 
by‹
 *
p
;

70 
p
=(
by‹
*)&
s
;

72 
s
=1;

74  (*
p
==0);

75 
	}
}

77 #ià(
DEBUG_BITDEPTH
)

84 
	$MaskMSBs
 (
img³l
** 
imgX
, 
mask
, 
width
, 
height
)

86 
i
,
j
;

88 
j
=0; j < 
height
; j++)

90 
i
=0; i < 
width
; i++)

92 
imgX
[
j
][
i
]=(
img³l
è(imgX[j][i] & 
mask
);

95 
	}
}

104 
	$fžlPÏÃ
 ( 
img³l
** 
imgX
,

105 
nV®
,

106 
size_x
,

107 
size_y


110 
j
, 
i
;

112 ià((
img³l
) == ())

114 
	`ç¡_mem£t
(
imgX
[0], 
nV®
, 
size_y
 * 
size_x
);

118 
j
 = 0; j < 
size_y
; j++)

120 
i
 = 0; i < 
size_x
; i++)

122 
imgX
[
j
][
i
] = (
img³l
è
nV®
;

126 
	}
}

128 
	$deš‹¾—ve_yuv420
Ð** 
šput
,

129 ** 
ouut
,

130 
F¿meFÜm©
 *
sourû
,

131 
symbÞ_size_š_by‹s


134 
i
;

136 *
icmp
 = *
šput
;

138 *
ocmp0
 = *
ouut
;

140 *
ocmp1
 = 
ocmp0
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
Y_COMP
];

141 *
ocmp2
 = 
ocmp1
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
U_COMP
];

143 
i
 = 0; i < 
sourû
->
size_cmp
[
U_COMP
]; i++)

145 
	`memýy
(
ocmp1
, 
icmp
, 
symbÞ_size_š_by‹s
);

146 
ocmp1
 +ð
symbÞ_size_š_by‹s
;

147 
icmp
 +ð
symbÞ_size_š_by‹s
;

148 
	`memýy
(
ocmp0
, 
icmp
, 2 * 
symbÞ_size_š_by‹s
);

149 
ocmp0
 +ð2 * 
symbÞ_size_š_by‹s
;

150 
icmp
 +ð2 * 
symbÞ_size_š_by‹s
;

151 
	`memýy
(
ocmp2
, 
icmp
, 
symbÞ_size_š_by‹s
);

152 
ocmp2
 +ð
symbÞ_size_š_by‹s
;

153 
icmp
 +ð
symbÞ_size_š_by‹s
;

154 
	`memýy
(
ocmp0
, 
icmp
, 2 * 
symbÞ_size_š_by‹s
);

155 
ocmp0
 +ð2 * 
symbÞ_size_š_by‹s
;

156 
icmp
 +ð2 * 
symbÞ_size_š_by‹s
;

160 
icmp
 = *
šput
;

161 *
šput
 = *
ouut
;

162 *
ouut
 = 
icmp
;

163 
	}
}

165 
	$deš‹¾—ve_yuv444
Ð** 
šput
,

166 ** 
ouut
,

167 
F¿meFÜm©
 *
sourû
,

168 
symbÞ_size_š_by‹s


171 
i
;

173 *
icmp
 = *
šput
;

175 *
ocmp0
 = *
ouut
;

177 *
ocmp1
 = 
ocmp0
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
Y_COMP
];

178 *
ocmp2
 = 
ocmp1
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
U_COMP
];

180 
i
 = 0; i < 
sourû
->
size_cmp
[
Y_COMP
]; i++)

182 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

183 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

184 
icmp
 +ð
symbÞ_size_š_by‹s
;

185 
	`memýy
(
ocmp1
, 
icmp
, 
symbÞ_size_š_by‹s
);

186 
ocmp1
 +ð
symbÞ_size_š_by‹s
;

187 
icmp
 +ð
symbÞ_size_š_by‹s
;

188 
	`memýy
(
ocmp2
, 
icmp
, 
symbÞ_size_š_by‹s
);

189 
ocmp2
 +ð
symbÞ_size_š_by‹s
;

190 
icmp
 +ð
symbÞ_size_š_by‹s
;

193 
icmp
 = *
šput
;

194 *
šput
 = *
ouut
;

195 *
ouut
 = 
icmp
;

196 
	}
}

198 
	$deš‹¾—ve_yuyv
 ( ** 
šput
,

199 ** 
ouut
,

200 
F¿meFÜm©
 *
sourû
,

201 
symbÞ_size_š_by‹s


204 
i
;

206 *
icmp
 = *
šput
;

208 *
ocmp0
 = *
ouut
;

210 *
ocmp1
 = 
ocmp0
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
Y_COMP
];

211 *
ocmp2
 = 
ocmp1
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
U_COMP
];

213 
i
 = 0; i < 
sourû
->
size_cmp
[
U_COMP
]; i++)

216 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

217 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

218 
icmp
 +ð
symbÞ_size_š_by‹s
;

220 
	`memýy
(
ocmp1
, 
icmp
, 
symbÞ_size_š_by‹s
);

221 
ocmp1
 +ð
symbÞ_size_š_by‹s
;

222 
icmp
 +ð
symbÞ_size_š_by‹s
;

224 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

225 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

226 
icmp
 +ð
symbÞ_size_š_by‹s
;

228 
	`memýy
(
ocmp2
, 
icmp
, 
symbÞ_size_š_by‹s
);

229 
ocmp2
 +ð
symbÞ_size_š_by‹s
;

230 
icmp
 +ð
symbÞ_size_š_by‹s
;

233 
icmp
 = *
šput
;

234 *
šput
 = *
ouut
;

235 *
ouut
 = 
icmp
;

236 
	}
}

238 
	$deš‹¾—ve_yvyu
 ( ** 
šput
,

239 ** 
ouut
,

240 
F¿meFÜm©
 *
sourû
,

241 
symbÞ_size_š_by‹s


244 
i
;

246 *
icmp
 = *
šput
;

248 *
ocmp0
 = *
ouut
;

250 *
ocmp1
 = 
ocmp0
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
Y_COMP
];

251 *
ocmp2
 = 
ocmp1
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
U_COMP
];

253 
i
 = 0; i < 
sourû
->
size_cmp
[
U_COMP
]; i++)

256 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

257 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

258 
icmp
 +ð
symbÞ_size_š_by‹s
;

260 
	`memýy
(
ocmp2
, 
icmp
, 
symbÞ_size_š_by‹s
);

261 
ocmp2
 +ð
symbÞ_size_š_by‹s
;

262 
icmp
 +ð
symbÞ_size_š_by‹s
;

264 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

265 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

266 
icmp
 +ð
symbÞ_size_š_by‹s
;

268 
	`memýy
(
ocmp1
, 
icmp
, 
symbÞ_size_š_by‹s
);

269 
ocmp1
 +ð
symbÞ_size_š_by‹s
;

270 
icmp
 +ð
symbÞ_size_š_by‹s
;

273 
icmp
 = *
šput
;

274 *
šput
 = *
ouut
;

275 *
ouut
 = 
icmp
;

276 
	}
}

278 
	$deš‹¾—ve_uyvy
 ( ** 
šput
,

279 ** 
ouut
,

280 
F¿meFÜm©
 *
sourû
,

281 
symbÞ_size_š_by‹s


284 
i
;

286 *
icmp
 = *
šput
;

288 *
ocmp0
 = *
ouut
;

290 *
ocmp1
 = 
ocmp0
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
Y_COMP
];

291 *
ocmp2
 = 
ocmp1
 + 
symbÞ_size_š_by‹s
 * 
sourû
->
size_cmp
[
U_COMP
];

293 
i
 = 0; i < 
sourû
->
size_cmp
[
U_COMP
]; i++)

296 
	`memýy
(
ocmp1
, 
icmp
, 
symbÞ_size_š_by‹s
);

297 
ocmp1
 +ð
symbÞ_size_š_by‹s
;

298 
icmp
 +ð
symbÞ_size_š_by‹s
;

300 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

301 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

302 
icmp
 +ð
symbÞ_size_š_by‹s
;

304 
	`memýy
(
ocmp2
, 
icmp
, 
symbÞ_size_š_by‹s
);

305 
ocmp2
 +ð
symbÞ_size_š_by‹s
;

306 
icmp
 +ð
symbÞ_size_š_by‹s
;

308 
	`memýy
(
ocmp0
, 
icmp
, 
symbÞ_size_š_by‹s
);

309 
ocmp0
 +ð
symbÞ_size_š_by‹s
;

310 
icmp
 +ð
symbÞ_size_š_by‹s
;

313 
icmp
 = *
šput
;

314 *
šput
 = *
ouut
;

315 *
ouut
 = 
icmp
;

316 
	}
}

318 
	$deš‹¾—ve_v210
 ( ** 
šput
,

319 ** 
ouut
,

320 
F¿meFÜm©
 *
sourû
,

321 
symbÞ_size_š_by‹s


324 
i
;

326 *
icmp
 = *
šput
;

328 *
ui32cmp
 = (*è*
šput
;

329 *
ui16cmp0
 = (*è*
ouut
;

330 *
ui16cmp1
 = 
ui16cmp0
 + 
sourû
->
size_cmp
[0];

331 *
ui16cmp2
 = 
ui16cmp1
 + 
sourû
->
size_cmp
[1];

333 
i
 = 0; i < 
sourû
->
size_cmp
[
U_COMP
] / 3; i++)

338 *
ui16cmp2
 = (*
ui32cmp
 & 0x3FF00000)>>20;

339 *
ui16cmp0
 = (*
ui32cmp
 & 0xffc00)>>10;

340 *
ui16cmp1
 = (*(
ui32cmp
++) & 0x3FF);

345 *(
ui16cmp0
 + 2èð(*
ui32cmp
 & 0x3FF00000)>>20;

346 *(
ui16cmp1
 + 1èð(*
ui32cmp
 & 0xffc00)>>10;

347 *(
ui16cmp0
 + 1èð(*(
ui32cmp
++) & 0x3FF);

352 *(
ui16cmp1
 + 2èð(*
ui32cmp
 & 0x3FF00000)>>20;

353 *(
ui16cmp0
 + 3èð(*
ui32cmp
 & 0xffc00)>>10;

354 *(
ui16cmp2
 + 1èð(*(
ui32cmp
++) & 0x3FF);

359 *(
ui16cmp0
 + 5èð(*
ui32cmp
 & 0x3FF00000)>>20;

360 *(
ui16cmp2
 + 2èð(*
ui32cmp
 & 0xffc00)>>10;

361 *(
ui16cmp0
 + 4èð(*(
ui32cmp
++) & 0x3FF);

365 
ui16cmp0
 += 6;

366 
ui16cmp1
 += 3;

367 
ui16cmp2
 += 3;

370 
icmp
 = *
šput
;

371 *
šput
 = *
ouut
;

372 *
ouut
 = 
icmp
;

373 
	}
}

381 
	$deš‹¾—ve
 ( ** 
šput
,

382 ** 
ouut
,

383 
F¿meFÜm©
 *
sourû
,

384 
symbÞ_size_š_by‹s


387 ià(
sourû
->
yuv_fÜm©
 =ð
YUV420
)

389 
	`deš‹¾—ve_yuv420
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

391 ià(
sourû
->
yuv_fÜm©
 =ð
YUV422
)

393 ià(
sourû
->
pix–_fÜm©
 =ð
YUYV
 || sourû->pix–_fÜm© =ð
YUY2
)

395 
	`deš‹¾—ve_yuyv
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

397 ià(
sourû
->
pix–_fÜm©
 =ð
YVYU
)

399 
	`deš‹¾—ve_yvyu
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

401 ià(
sourû
->
pix–_fÜm©
 =ð
UYVY
)

403 
	`deš‹¾—ve_uyvy
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

405 ià(
sourû
->
pix–_fÜm©
 =ð
V210
)

407 
	`deš‹¾—ve_v210
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

410 
	`årštf
(
¡d”r
, "Unsupported…ixel format.\n");

411 
	`ex™
(
EXIT_FAILURE
);

414 ià(
sourû
->
yuv_fÜm©
 =ð
YUV444
)

415 
	`deš‹¾—ve_yuv444
(
šput
, 
ouut
, 
sourû
, 
symbÞ_size_š_by‹s
);

416 
	}
}

424 
	$buf2img_b™shiá
 ( 
img³l
** 
imgX
,

425 * 
buf
,

426 
size_x
,

427 
size_y
,

428 
o_size_x
,

429 
o_size_y
,

430 
symbÞ_size_š_by‹s
,

431 
b™shiá


434 
i
,
j
;

436 
ušt16
 
tmp16
, 
ui16
;

437 
tmp32
, 
ui32
;

440 ià(((
symbÞ_size_š_by‹s
 << 3è- 
b™shiá
è> ((
img³l
)<< 3))

442 
	`”rÜ
 ("Source…icture has higher bit depthhan imgpel dataype. \nPlease„ecompile with†arger dataype for imgpel.", 500);

445 ià(
	`‹¡EndŸn
())

447 ià(
size_x
 !ð
o_size_x
 || 
size_y
 !ð
o_size_y
)

449 
	`”rÜ
 ("Rescaling‚ot supported in bigƒndian‡rchitectures. ", 500);

453 
symbÞ_size_š_by‹s
)

457 
j
 = 0; j < 
o_size_y
; j++)

458 
i
 = 0; i < 
o_size_x
; i++)

460 
imgX
[
j
][
i
]ð(
img³l
è
	`rshiá_ºd
(
buf
[˜+ j*
size_x
], 
b™shiá
);

466 
j
 = 0; j < 
o_size_y
; j++)

467 
i
 = 0; i < 
o_size_x
; i++)

469 
	`memýy
(&
tmp16
, 
buf
 + ((
i
 + 
j
 * 
size_x
) * 2), 2);

470 
ui16
 = (
tmp16
 >> 8) | ((tmp16 & 0xFF) << 8);

471 
imgX
[
j
][
i
] = (
img³l
è
	`rshiá_ºd
(
ui16
, 
b™shiá
);

477 
j
 = 0; j < 
o_size_y
; j++)

478 
i
 = 0; i < 
o_size_x
; i++)

480 
	`memýy
(&
tmp32
, 
buf
 + ((
i
 + 
j
 * 
size_x
) * 4), 4);

481 
ui32
 = ((
tmp32
 & 0xFF00) << 8) | ((tmp32 & 0xFF)<<24) | ((tmp32 & 0xFF0000)>>8) | ((tmp32 & 0xFF000000)>>24);

482 
imgX
[
j
][
i
] = (
img³l
è
	`rshiá_ºd
(
ui32
, 
b™shiá
);

487 
	`”rÜ
 ("reading only from formats of 8, 16 or 32 bit‡llowed on bigƒndian‡rchitecture", 500);

495 
j_pos
;

496 ià(
size_x
 =ð
o_size_x
 && 
size_y
 =ð
o_size_y
)

498 
j
 = 0; j < 
o_size_y
; j++)

500 
j_pos
 = 
j
*
size_x
;

501 
i
 = 0; i < 
o_size_x
; i++)

503 
ui16
=0;

504 
	`memýy
(&(
ui16
), 
buf
 + ((
i
 + 
j_pos
è* 
symbÞ_size_š_by‹s
), symbol_size_in_bytes);

505 
imgX
[
j
][
i
] = (
img³l
è
	`rshiá_ºd
(
ui16
,
b™shiá
);

511 
imšwidth
 = 
	`imš
(
size_x
, 
o_size_x
);

512 
imšheight
 = 
	`imš
(
size_y
, 
o_size_y
);

513 
d¡_off£t_x
 = 0, 
d¡_off£t_y
 = 0;

514 
off£t_x
 = 0, 
off£t_y
 = 0;

517 iàÐ
o_size_x
 >ð
size_x
 )

518 
d¡_off£t_x
 = ( 
o_size_x
 - 
size_x
 ) >> 1;

520 ià(
o_size_y
 >ð
size_y
)

521 
d¡_off£t_y
 = ( 
o_size_y
 - 
size_y
 ) >> 1;

525 
imšwidth
 = ( (
off£t_x
 + imšwidth ) > 
size_x
 ) ? (size_x - offset_x) : iminwidth;

526 
imšheight
 = ( (
off£t_y
 + imšheightè> 
size_y
 ) ? (size_y - offset_y) : iminheight;

528 
imšwidth
 = ( (
d¡_off£t_x
 + imšwidth ) > 
o_size_x
 ) ? (o_size_x - dst_offset_x) : iminwidth;

529 
imšheight
 = ( (
d¡_off£t_y
 + imšheightè> 
o_size_y
 ) ? (o_size_y - dst_offset_y) : iminheight;

531 
j
=0; j < 
imšheight
; j++)

533 
j_pos
 = (
j
 + 
off£t_y
è* 
size_x
 + 
off£t_x
;

534 
i
=0; i < 
imšwidth
; i++)

536 
ui16
=0;

537 
	`memýy
(&(
ui16
), 
buf
 + ((
i
 + 
j_pos
è* 
symbÞ_size_š_by‹s
), symbol_size_in_bytes);

538 
imgX
[
j
 + 
d¡_off£t_y
][
i
 + 
d¡_off£t_x
] = (
img³l
è
	`rshiá_ºd
(
ui16
,
b™shiá
);

543 
	}
}

552 
	$buf2img_basic
 (
img³l
** 
imgX
,

553 * 
buf
,

554 
size_x
,

555 
size_y
,

556 
o_size_x
,

557 
o_size_y
,

558 
symbÞ_size_š_by‹s
,

559 
dummy


562 
i
,
j
;

563 * 
‹mp_buf
 = 
buf
;

565 ià(
symbÞ_size_š_by‹s
> (
img³l
))

567 
	`”rÜ
 ("Source…icture has higher bit depthhan imgpel dataype. \nPlease„ecompile with†arger dataype for imgpel.", 500);

570 ià(Ð (
img³l
è=ð
symbÞ_size_š_by‹s
))

573 ià(
size_x
 =ð
o_size_x
 && 
size_y
 =ð
o_size_y
)

574 
	`memýy
(&
imgX
[0][0], 
‹mp_buf
, 
size_x
 * 
size_y
 * (
img³l
));

577 
imšwidth
 = 
	`imš
(
size_x
, 
o_size_x
);

578 
imšheight
 = 
	`imš
(
size_y
, 
o_size_y
);

579 
d¡_off£t_x
 = 0, 
d¡_off£t_y
 = 0;

580 
off£t_x
 = 0, 
off£t_y
 = 0;

583 iàÐ
o_size_x
 >ð
size_x
 )

584 
d¡_off£t_x
 = ( 
o_size_x
 - 
size_x
 ) >> 1;

586 ià(
o_size_y
 >ð
size_y
)

587 
d¡_off£t_y
 = ( 
o_size_y
 - 
size_y
 ) >> 1;

591 
imšwidth
 = ( (
off£t_x
 + imšwidth ) > 
size_x
 ) ? (size_x - offset_x) : iminwidth;

592 
imšheight
 = ( (
off£t_y
 + imšheightè> 
size_y
 ) ? (size_y - offset_y) : iminheight;

594 
imšwidth
 = ( (
d¡_off£t_x
 + imšwidth ) > 
o_size_x
 ) ? (o_size_x - dst_offset_x) : iminwidth;

595 
imšheight
 = ( (
d¡_off£t_y
 + imšheightè> 
o_size_y
 ) ? (o_size_y - dst_offset_y) : iminheight;

597 
i
=0; i<
imšheight
;i++) {

598 
	`memýy
(&
imgX
[
i
 + 
d¡_off£t_y
][
d¡_off£t_x
], &(
‹mp_buf
[(˜+ 
off£t_y
è* 
size_x
 + 
off£t_x
]), 
imšwidth
 * (
img³l
));

604 
j_pos
;

605 
ušt16
 
ui16
;

606 ià(
size_x
 =ð
o_size_x
 && 
size_y
 =ð
o_size_y
)

608 
j
=0; j < 
o_size_y
; j++)

610 
j_pos
 = 
j
 * 
size_x
;

611 
i
=0; i < 
o_size_x
; i++)

613 
ui16
=0;

614 
	`memýy
(&(
ui16
), 
buf
 + ((
i
 + 
j_pos
è* 
symbÞ_size_š_by‹s
), symbol_size_in_bytes);

615 
imgX
[
j
][
i
]ð(
img³l
è
ui16
;

621 
imšwidth
 = 
	`imš
(
size_x
, 
o_size_x
);

622 
imšheight
 = 
	`imš
(
size_y
, 
o_size_y
);

623 
d¡_off£t_x
 = 0, 
d¡_off£t_y
 = 0;

624 
off£t_x
 = 0, 
off£t_y
 = 0;

627 iàÐ
o_size_x
 >ð
size_x
 )

628 
d¡_off£t_x
 = ( 
o_size_x
 - 
size_x
 ) >> 1;

630 ià(
o_size_y
 >ð
size_y
)

631 
d¡_off£t_y
 = ( 
o_size_y
 - 
size_y
 ) >> 1;

635 
imšwidth
 = ( (
off£t_x
 + imšwidth ) > 
size_x
 ) ? (size_x - offset_x) : iminwidth;

636 
imšheight
 = ( (
off£t_y
 + imšheightè> 
size_y
 ) ? (size_y - offset_y) : iminheight;

638 
imšwidth
 = ( (
d¡_off£t_x
 + imšwidth ) > 
o_size_x
 ) ? (o_size_x - dst_offset_x) : iminwidth;

639 
imšheight
 = ( (
d¡_off£t_y
 + imšheightè> 
o_size_y
 ) ? (o_size_y - dst_offset_y) : iminheight;

641 
j
 = 0; j < 
imšheight
; j++)

643 
	`memýy
(&
imgX
[
j
 + 
d¡_off£t_y
][
d¡_off£t_x
], &(
‹mp_buf
[(j + 
off£t_y
è* 
size_x
 + 
off£t_x
]), 
imšwidth
 * 
symbÞ_size_š_by‹s
);

645 
j
=0; j < 
imšheight
; j++)

647 
j_pos
 = (
j
 + 
off£t_y
è* 
size_x
 + 
off£t_x
;

648 
i
=0; i < 
imšwidth
; i++)

650 
ui16
 = 0;

651 
	`memýy
(&(
ui16
), 
buf
 + ((
i
 + 
j_pos
è* 
symbÞ_size_š_by‹s
), symbol_size_in_bytes);

652 
imgX
[
j
 + 
d¡_off£t_y
][
i
 + 
d¡_off£t_x
]ð(
img³l
è
ui16
;

657 
	}
}

665 
	$buf2img_’dŸn
 (
img³l
** 
imgX
,

666 * 
buf
,

667 
size_x
,

668 
size_y
,

669 
o_size_x
,

670 
o_size_y
,

671 
symbÞ_size_š_by‹s
,

672 
dummy


675 
i
,
j
;

677 
ušt16
 
tmp16
, 
ui16
;

678 
tmp32
, 
ui32
;

680 ià(
symbÞ_size_š_by‹s
 > (
img³l
))

682 
	`”rÜ
 ("Source…icture has higher bit depthhan imgpel dataype. \nPlease„ecompile with†arger dataype for imgpel.", 500);

685 ià(
size_x
 !ð
o_size_x
 || 
size_y
 !ð
o_size_y
)

687 
	`”rÜ
 ("Rescaling‚ot supported in bigƒndian‡rchitectures. ", 500);

691 
symbÞ_size_š_by‹s
)

695 
j
=0;j<
size_y
;j++)

697 
i
=0;i<
size_x
;i++)

699 
imgX
[
j
][
i
]ð(
img³l
è
buf
[˜+ j*
size_x
];

706 
j
=0;j<
size_y
;j++)

708 
i
=0;i<
size_x
;i++)

710 
	`memýy
(&
tmp16
, 
buf
+((
i
+
j
*
size_x
)*2), 2);

711 
ui16
 = (
tmp16
 >> 8) | ((tmp16&0xFF)<<8);

712 
imgX
[
j
][
i
] = (
img³l
è
ui16
;

719 
j
=0;j<
size_y
;j++)

721 
i
=0;i<
size_x
;i++)

723 
	`memýy
(&
tmp32
, 
buf
+((
i
+
j
*
size_x
)*4), 4);

724 
ui32
 = ((
tmp32
&0xFF00)<<8) | ((tmp32&0xFF)<<24) | ((tmp32&0xFF0000)>>8) | ((tmp32&0xFF000000)>>24);

725 
imgX
[
j
][
i
] = (
img³l
è
ui32
;

732 
	`”rÜ
 ("reading only from formats of 8, 16 or 32 bit‡llowed on bigƒndian‡rchitecture", 500);

736 
	}
}

745 
	$AÎoÿ‹F¿meMemÜy
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meFÜm©
 *
sourû
)

749 ià(
NULL
 =ð(
p_Vid
->
buf
 = 
	`m®loc
 (
sourû
->
size
 * sourû->
pic_un™_size_shiá3
)))

750 
	`no_mem_ex™
("AllocateFrameMemory:…_Vid->buf");

751 ià(
p_IÅ
->
šput_fže1
.
is_š‹¾—ved
)

753 ià(
NULL
 =ð(
p_Vid
->
ibuf
 = 
	`m®loc
 (
sourû
->
size
 * sourû->
pic_un™_size_shiá3
)))

754 
	`no_mem_ex™
("AllocateFrameMemory:…_Vid->ibuf");

756 
	}
}

765 
	$D–‘eF¿meMemÜy
 (
VideoP¬am‘”s
 *
p_Vid
)

767 ià(
p_Vid
->
buf
 !ð
NULL
)

768 
	`ä“
 (
p_Vid
->
buf
);

769 ià(
p_Vid
->
ibuf
 !ð
NULL
)

770 
	`ä“
 (
p_Vid
->
ibuf
);

771 
	}
}

792 
	$»ad_Úe_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, F¿meFÜm© *
ouut
, 
img³l
 **
pImage
[3])

794 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

795 
fže_»ad
 = 0;

796 
symbÞ_size_š_by‹s
 = 
sourû
->
pic_un™_size_shiá3
;

798 cÚ¡ 
by‹s_y
 = 
sourû
->
size_cmp
[0] * 
symbÞ_size_š_by‹s
;

799 cÚ¡ 
by‹s_uv
 = 
sourû
->
size_cmp
[1] * 
symbÞ_size_š_by‹s
;

800 
b™_sÿË
;

802 
BoÞ—n
 
rgb_šput
 = (BoÞ—nè(
sourû
->
cÞÜ_mod–
 =ð
CM_RGB
 && sourû->
yuv_fÜm©
 =ð
YUV444
);

804 ià(
šput_fže
->
is_cÚÿ‹Ç‹d
 == 0)

806 ià(
šput_fže
->
vdty³
 =ð
VIDEO_TIFF
)

808 
fže_»ad
 = 
	`R—dTIFFImage
 (
p_IÅ
, 
šput_fže
, 
F¿meNoInFže
, 
sourû
, 
p_Vid
->
buf
);

812 
fže_»ad
 = 
	`R—dF¿meS•¬©e
 (
p_IÅ
, 
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
sourû
, 
p_Vid
->
buf
);

817 
fže_»ad
 = 
	`R—dF¿meCÚÿ‹Ç‹d
 (
p_IÅ
, 
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
sourû
, 
p_Vid
->
buf
);

820 iàÐ!
fže_»ad
 )

826 ià(
šput_fže
->
is_š‹¾—ved
)

828 
	`deš‹¾—ve
 ( &
p_Vid
->
buf
, &p_Vid->
ibuf
, 
sourû
, 
symbÞ_size_š_by‹s
);

831 
b™_sÿË
 = 
sourû
->
b™_d•th
[0] - 
ouut
->bit_depth[0];

833 if(
rgb_šput
)

834 
p_Vid
->
	`buf2img
(
pImage
[0],…_Vid->
buf
 + 
by‹s_y
, 
sourû
->
width
[0], sourû->
height
[0], 
ouut
->width[0], ouut->height[0], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

836 
p_Vid
->
	`buf2img
(
pImage
[0],…_Vid->
buf
, 
sourû
->
width
[0], sourû->
height
[0], 
ouut
->width[0], ouut->height[0], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

838 #ià(
DEBUG_BITDEPTH
)

839 
	`MaskMSBs
(
pImage
[0], ((1 << 
ouut
->
b™_d•th
[0]è- 1), ouut->
width
[0], ouut->
height
[0]);

842 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

844 
b™_sÿË
 = 
sourû
->
b™_d•th
[1] - 
ouut
->bit_depth[1];

845 #ià(
ALLOW_GRAYSCALE
)

846 ià(!
p_IÅ
->
g¿ysÿË
)

849 if(
rgb_šput
)

850 
p_Vid
->
	`buf2img
(
pImage
[1],…_Vid->
buf
 + 
by‹s_y
 + 
by‹s_uv
, 
sourû
->
width
[1], sourû->
height
[1], 
ouut
->width[1], ouut->height[1], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

852 
p_Vid
->
	`buf2img
(
pImage
[1],…_Vid->
buf
 + 
by‹s_y
, 
sourû
->
width
[1], sourû->
height
[1], 
ouut
->width[1], ouut->height[1], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

854 
b™_sÿË
 = 
sourû
->
b™_d•th
[2] - 
ouut
->bit_depth[2];

855 if(
rgb_šput
)

856 
p_Vid
->
	`buf2img
(
pImage
[2],…_Vid->
buf
, 
sourû
->
width
[1], sourû->
height
[1], 
ouut
->width[1], ouut->height[1], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

858 
p_Vid
->
	`buf2img
(
pImage
[2],…_Vid->
buf
 + 
by‹s_y
 + 
by‹s_uv
, 
sourû
->
width
[1], sourû->
height
[1], 
ouut
->width[1], ouut->height[1], 
symbÞ_size_š_by‹s
, 
b™_sÿË
);

860 #ià(
DEBUG_BITDEPTH
)

861 
	`MaskMSBs
(
pImage
[1], ((1 << 
ouut
->
b™_d•th
[1]è- 1), ouut->
width
[1], ouut->
height
[1]);

862 
	`MaskMSBs
(
pImage
[2], ((1 << 
ouut
->
b™_d•th
[2]è- 1), ouut->
width
[1], ouut->
height
[1]);

866  
fže_»ad
;

867 
	}
}

889 
	$·d_bÜd”s
 (
F¿meFÜm©
 
ouut
, 
img_size_x
, 
img_size_y
, 
img_size_x_ü
, 
img_size_y_ü
, 
img³l
 **
pImage
[3])

891 
x
, 
y
;

895 ià(
ouut
.
width
[0] < 
img_size_x
)

896 
y
 = 0; y < 
ouut
.
height
[0]; y++)

897 
x
 = 
ouut
.
width
[0]; x < 
img_size_x
; x++)

898 
pImage
[0][
y
][
x
] =…Image[0][y][x-1];

901 ià(
ouut
.
height
[0] < 
img_size_y
)

902 
y
 = 
ouut
.
height
[0]; y<
img_size_y
; y++)

903 
	`memýy
(
pImage
[0][
y
],…Image[0][y - 1], 
img_size_x
 * (
img³l
));

906 ià(
ouut
.
yuv_fÜm©
 !ð
YUV400
)

908 
k
;

910 
k
 = 1; k < 3; k++)

913 ià(
ouut
.
width
[1] < 
img_size_x_ü
)

914 
y
=0; y < 
ouut
.
height
[1]; y++)

915 
x
 = 
ouut
.
width
[1]; x < 
img_size_x_ü
; x++)

916 
pImage
 [
k
][
y
][
x
] =…Image[k][y][x-1];

919 ià(
ouut
.
height
[1] < 
img_size_y_ü
)

920 
y
 = 
ouut
.
height
[1]; y < 
img_size_y_ü
; y++)

921 
	`memýy
(
pImage
[
k
][
y
],…Image[k][y - 1], 
img_size_x_ü
 * (
img³l
));

924 
	}
}

	@lcommon/src/io_raw.c

15 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"img_io.h
"

20 
	#FAST_READ
 1

	)

22 #ià
FAST_READ


23 
šlše
 
	$R—dD©a
 (
vfže
, 
F¿meFÜm©
 *
sourû
, *
buf
)

25 *
cur_buf
 = 
buf
;

26 
»ad_size
 = 
sourû
->
pic_un™_size_shiá3
 * sourû->
width
[0];

27 
i
, 
j
;

29 
i
 = 0; i < 
sourû
->
height
[0]; i++)

31 ià(
	`»ad
(
vfže
, 
cur_buf
, 
»ad_size
) !=„ead_size)

33 
	`´štf
 ("»ad_Úe_äame: cªnÙ„—d %d by‹ äom iÅuˆfže, uÃx³ùed EOF!\n", 
sourû
->
width
[0]);

36 
cur_buf
 +ð
»ad_size
;

39 ià(
sourû
->
yuv_fÜm©
 !ð
YUV400
)

41 
»ad_size
 = 
sourû
->
pic_un™_size_shiá3
 * sourû->
width
[1];

42 
j
 = 0; j < 2; j++)

44 
i
 = 0; i < 
sourû
->
height
[1]; i++)

46 ià(
	`»ad
(
vfže
, 
cur_buf
, 
»ad_size
) !=„ead_size)

48 
	`´štf
 ("»ad_Úe_äame: cªnÙ„—d %d by‹ äom iÅuˆfže, uÃx³ùed EOF!\n", 
sourû
->
width
[1]);

51 
cur_buf
 +ð
»ad_size
;

56 
	}
}

58 
šlše
 
	$R—dD©a
 (
vfže
, 
äamesize_š_by‹s
, *
buf
)

60 ià(
	`»ad
(
vfže
, 
buf
, (è
äamesize_š_by‹s
) != () framesize_in_bytes)

62 
	`´štf
 ("»ad_Úe_äame: cªnÙ„—d %d by‹ äom iÅuˆfže, uÃx³ùed EOF!\n", (è
äamesize_š_by‹s
);

69 
	}
}

72 
šlše
 
	$R—dD©aV210
 (
vfže
, 
äamesize_š_by‹s
, *
buf
)

74 ià(
	`»ad
(
vfže
, 
buf
, (è
äamesize_š_by‹s
) != () framesize_in_bytes)

76 
	`´štf
 ("»ad_Úe_äame: cªnÙ„—d %d by‹ äom iÅuˆfže, uÃx³ùed EOF!\n", (è
äamesize_š_by‹s
);

83 
	}
}

104 
	$R—dF¿meCÚÿ‹Ç‹d
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, *
buf
)

106 
fže_»ad
 = 0;

107 
vfže
 = 
šput_fže
->
f_num
;

108 
BoÞ—n
 
is_v210
 = (
šput_fže
->
is_š‹¾—ved
 && 
sourû
->
pix–_fÜm©
 =ð
V210
);

109 
symbÞ_size_š_by‹s
 = 
sourû
->
pic_un™_size_shiá3
;

111 cÚ¡ 
by‹s_y
 = 
sourû
->
size_cmp
[0] * 
symbÞ_size_š_by‹s
;

112 cÚ¡ 
by‹s_uv
 = 
sourû
->
size_cmp
[1] * 
symbÞ_size_š_by‹s
;

114 cÚ¡ 
št64
 
äamesize_š_by‹s
 = (
is_v210
 =ð
TRUE
è? 16 * (
sourû
->
size_cmp
[0] / 6è: 
by‹s_y
 + 2 * 
by‹s_uv
;

117 ià(
	`l£ek
 (
vfže
, 
H—d”Size
 + 
äamesize_š_by‹s
 * (
F¿meNoInFže
 + 
p_IÅ
->
¡¬t_äame
), 
SEEK_SET
) == -1)

119 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "»ad_Úe_äame: cªnÙ‡dvªû fžpoš‹¸š iÅuˆfžbeyÚd f¿m%d\n", 
p_IÅ
->
¡¬t_äame
 + 
F¿meNoInFže
);

120 
	`”rÜ
 (
”rÜ‹xt
,-1);

125 ià((
sourû
->
pic_un™_size_Ú_disk
 & 0x07) == 0)

127 ià(
is_v210
 =ð
TRUE
)

129 
fže_»ad
 = 
	`R—dD©aV210
(
vfže
, (è
äamesize_š_by‹s
, 
buf
);

133 #ià
FAST_READ


134 
fže_»ad
 = 
	`R—dD©a
 (
vfže
, 
sourû
, 
buf
);

136 
fže_»ad
 = 
	`R—dD©a
 (
vfže
, (è
äamesize_š_by‹s
, 
buf
);

142 
	`´štf
 ("read_one_frame (NOT IMPLEMENTED):…ic unit size on disk must be divisible by 8");

143 
	`ex™
 (-1);

145  
fže_»ad
;

146 
	}
}

166 
	$R—dF¿meS•¬©e
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
H—d”Size
, 
F¿meFÜm©
 *
sourû
, *
buf
)

168 
fže_»ad
 = 0;

169 
vfže
 = 
šput_fže
->
f_num
;

171 
	`O³nF¿meFže
Ð
šput_fže
, 
F¿meNoInFže
 + 
p_IÅ
->
¡¬t_äame
);

174 ià(
	`l£ek
 (
vfže
, 
H—d”Size
, 
SEEK_SET
) != HeaderSize)

176 
	`”rÜ
 ("read_one_frame: cannot fseeko (Header size) in input file", -1);

180 ià((
sourû
->
pic_un™_size_Ú_disk
 & 0x07) == 0)

182 #ià
FAST_READ


183 
fže_»ad
 = 
	`R—dD©a
 (
vfže
, 
sourû
, 
buf
);

185 
symbÞ_size_š_by‹s
 = 
sourû
->
pic_un™_size_shiá3
;

187 cÚ¡ 
by‹s_y
 = 
sourû
->
size_cmp
[0] * 
symbÞ_size_š_by‹s
;

188 cÚ¡ 
by‹s_uv
 = 
sourû
->
size_cmp
[1] * 
symbÞ_size_š_by‹s
;

189 cÚ¡ 
št64
 
äamesize_š_by‹s
 = 
by‹s_y
 + 2*
by‹s_uv
;

191 
fže_»ad
 = 
	`R—dD©a
 (
vfže
, (è
äamesize_š_by‹s
, 
buf
);

196 
	`´štf
 ("read_one_frame (NOT IMPLEMENTED):…ic unit size on disk must be divisible by 8");

197 
	`ex™
 (-1);

200 ià(
vfže
 != -1)

201 
	`þo£
(
vfže
);

203  
fže_»ad
;

204 
	}
}

	@lcommon/src/io_tiff.c

15 
	~"cÚŒibutÜs.h
"

16 
	~"»pÜt.h
"

17 
	~"io_tiff.h
"

21 
	#YRES
 1080

	)

26 
	eTiffTy³
 {

27 
	mT_BYTE
 = 1,

28 
	mT_ASCII
 = 2,

29 
	mT_SHORT
 = 3,

30 
	mT_LONG
 = 4,

31 
	mT_RATIONAL
 = 5,

32 
	mT_SBYTE
 = 6,

33 
	mT_UNDEFINED
 = 7,

34 
	mT_SSHORT
 = 8,

35 
	mT_SLONG
 = 9,

36 
	mT_SRATIONAL
 = 10,

37 
	mT_FLOAT
 = 11,

38 
	mT_DOUBLE
 = 12

39 } 
	tTiffTy³
;

42 
	sTiffDœeùÜyEÁry
 {

43 
ušt16
 
	mg
;

44 
ušt16
 
	mty³
;

45 
ušt32
 
	mcouÁ
;

46 
ušt32
 
	moff£t
;

47 } 
	tTiffDœeùÜyEÁry
;

51 
	sTiffIFD
 {

52 
ušt16
 
	mnEÁr›s
;

53 
TiffDœeùÜyEÁry
 *
	mdœeùÜyEÁry
;

54 } 
	tTiffIFD
;

57 
	sTiffImageFžeH—d”
 {

58 
ušt16
 
	mby‹Ord”
;

59 
ušt16
 
	m¬b™¿ryNumb”
;

60 
ušt32
 
	moff£t
;

61 } 
	tTiffImageFžeH—d”
;

65 
	sTiff
 {

66 
ušt16
 *
	mimg
;

67 
ušt8
 *
	mfžeInMemÜy
;

68 
ušt8
 *
	mmp
;

69 
	mË
;

70 
	mnSŒs
;

71 
TiffImageFžeH—d”
 
	mifh
;

73 
ušt16
 
	mOr›Á©iÚ
;

74 
ušt32


75 
	mB™sP”Sam¶e
[3],

76 
	mRowsP”SŒ
,

77 
	mImageL’gth
,

78 
	mImageWidth
,

79 
	mSŒBy‹CouÁs
[
YRES
],

80 
	mSŒOff£ts
[
YRES
],

81 
	mXResÞutiÚ
[2],

82 
	mYResÞutiÚ
[2];

84 
ušt32
 (*
g‘U16
è(
	mTiff
 *);

85 
ušt32
 (*
g‘U32
è(
	mTiff
 *);

86 } 
	tTiff
;

89 
	eVideoCode
 {

90 
	mVC_NULL
 = 0,

91 
	mVC_ITU_REC709
 = 1,

92 
	mVC_CCIR_601
 = 3,

93 
	mVC_FCC
 = 4,

94 
	mVC_ITU_REC624BG
 = 5,

95 
	mVC_SMPTE_170M
 = 6,

96 
	mVC_SMPTE_240M
 = 7,

97 
	mVC_SMPTE_260M
 = 7,

98 
	mVC_ITU_REC709_EXACT
 = 8,

99 
	mVC_MAX
 = 8

100 } 
	tVideoCode
;

103 cÚ¡ 
	gCÛf
[
VC_MAX
+1][3] = {

115 
	#CR
 
CÛf
[
videoCode
][0]

	)

116 
	#CG
 
CÛf
[
videoCode
][1]

	)

117 
	#CB
 
CÛf
[
videoCode
][2]

	)

118 
	#CU
 (0.5/(
CB
-1.0))

	)

119 
	#CV
 (0.5/(
CR
-1.0))

	)

122 
	#¡dSÿËY
 219.0

123 
	#¡dSÿËUV
 224.0

124 

	)

125 
	#INTEGER_SCALE
 16384

	)

126 
	#INTEGER_SHIFT
 14

	)

130 
	sRGB_YUV
 {

131 
ušt16


132 
	mpixMax
;

134 
	m¡dRªge
,

135 
	my
, 
	mu
, 
	mv
,

136 
	mr
, 
	mg
, 
	mb
,

137 
	myr
, 
	myg
, 
	myb
,

138 
	mur
, 
	mug
, 
	mub
,

139 
	mvr
, 
	mvg
, 
	mvb
,

140 
	moffy
, 
	moffuv
;

142 
	msy
, 
	msuv
;

143 } 
	tRGB_YUV
;

152 
	$cÚ¡ruùTiff
 (
Tiff
 * 
t
)

154 
t
->
fžeInMemÜy
 = 0;

155 
t
->
img
 = 0;

156 
t
->
mp
 = 0;

157 
	}
}

167 
	$de¡ruùTiff
 (
Tiff
 * 
t
)

169 
	`ä“_poš‹r
Ð
t
->
fžeInMemÜy
);

170 
	`ä“_poš‹r
Ð
t
->
img
);

171 
	}
}

183 
ušt32
 
	$g‘U16
 (
Tiff
 * 
t
)

186 
ušt8
 
š
[2];

187 
ušt16
 
out
;

188 } 
u
;

189 
u
.
š
[0] = *
t
->
mp
++;

190 
u
.
š
[1] = *
t
->
mp
++;

191  
u
.
out
;

192 
	}
}

202 
ušt32
 
	$g‘U32
 (
Tiff
 * 
t
)

205 
ušt8
 
š
[4];

206 
ušt32
 
out
;

207 } 
u
;

208 
u
.
š
[0] = *
t
->
mp
++;

209 
u
.
š
[1] = *
t
->
mp
++;

210 
u
.
š
[2] = *
t
->
mp
++;

211 
u
.
š
[3] = *
t
->
mp
++;

212  
u
.
out
;

213 
	}
}

225 
ušt32
 
	$g‘Sw­³dU16
 (
Tiff
 * 
t
)

228 
ušt8
 
š
[2];

229 
ušt16
 
out
;

230 } 
u
;

231 
u
.
š
[1] = *
t
->
mp
++;

232 
u
.
š
[0] = *
t
->
mp
++;

233  
u
.
out
;

234 
	}
}

244 
ušt32
 
	$g‘Sw­³dU32
 (
Tiff
 * 
t
)

247 
ušt8
 
š
[4];

248 
ušt32
 
out
;

249 } 
u
;

250 
u
.
š
[3] = *
t
->
mp
++;

251 
u
.
š
[2] = *
t
->
mp
++;

252 
u
.
š
[1] = *
t
->
mp
++;

253 
u
.
š
[0] = *
t
->
mp
++;

254  
u
.
out
;

255 
	}
}

265 
	$g‘IÁA¼ay
 (
Tiff
 * 
t
, 
ušt32
 
off£t
, 
TiffTy³
 
ty³
, ušt32 
a
[], 
n
)

267 
i
;

268 
ušt8
 *
mp
 = 
t
->mp;

270 
t
->
mp
 =->
fžeInMemÜy
 + 
off£t
;

271 
ty³
)

273 
T_SHORT
:

274 
i
=0; i < 
n
; ++i)

276 
a
[
i
] = 
	`g‘U16
Ð
t
);

279 
T_LONG
:

280 
i
=0; i < 
n
; ++i)

282 
a
[
i
] = 
	`g‘U32
Ð
t
);

285 
T_RATIONAL
:

286 
i
=0; i < 2*
n
; ++i)

288 
a
[
i
] = 
	`g‘U32
Ð
t
);

292 
	`as£¹
Ð
ty³
 =ð
T_SHORT
 ||y³ =ð
T_LONG
 ||y³ =ð
T_RATIONAL
);

294 
t
->
mp
 = mp;

295 
	}
}

305 
	$»adDœeùÜyEÁry
 (
Tiff
 * 
t
)

307 
ušt32
 
g
 = 
t
->
	`g‘U16
();

308 
TiffTy³
 
ty³
 = (TiffTy³è
t
->
	`g‘U16
();

309 
ušt32
 
couÁ
 = 
t
->
	`g‘U32
();

310 
ušt32
 
off£t
 = 
t
->
	`g‘U32
();

312 
g
)

315 
	`as£¹
Ð
couÁ
 == 1);

317 
t
->
ImageWidth
 = 
off£t
;

320 
	`as£¹
Ð
couÁ
 == 1);

322 
t
->
ImageL’gth
 = 
off£t
;

323 ià(
off£t
 > 
YRES
)

325 
	`årštf
Ð
¡d”r
, "»adDœeùÜyEÁry: ImageL’gth (%dèexûed bužtš maximum oà%d\n", 
off£t
, 
YRES
);

330 ià(
couÁ
 != 3)

332 
	`årštf
Ð
¡d”r
, "BitsPerSample (only [3] supported)\n");

335 
	`g‘IÁA¼ay
Ð
t
, 
off£t
, 
ty³
,->
B™sP”Sam¶e
, 3);

337 ià(
t
->
B™sP”Sam¶e
[0] !=->BitsPerSample[1] ||->BitsPerSample[0] !=->BitsPerSample[2])

339 
	`årštf
Ð
¡d”r
, "BitsPerSample must behe same for‡ll samples\n");

342 ià(
t
->
B™sP”Sam¶e
[0] != 8 &&->BitsPerSample[0] != 16)

344 
	`årštf
Ð
¡d”r
, "Only 8 or 16 BitsPerSample is supported\n");

349 
	`as£¹
Ð
couÁ
 == 1);

351 ià(
off£t
 != 1)

353 
	`årštf
Ð
¡d”r
, "Only uncompressed TIFF files supported\n");

358 
	`as£¹
Ð
couÁ
 == 1);

360 
	`as£¹
Ð
off£t
 == 2);

364 
	`g‘IÁA¼ay
Ð
t
, 
off£t
, 
ty³
,->
SŒOff£ts
, 
couÁ
);

365 
t
->
nSŒs
 = 
couÁ
;

368 
	`as£¹
Ð
couÁ
 == 1);

370 
t
->
Or›Á©iÚ
 = (
ušt16
è
off£t
;

371 ià(
t
->
Or›Á©iÚ
 != 1)

373 
	`årštf
Ð
¡d”r
, "Only Orientation 1 is supported\n");

378 
	`as£¹
Ð
couÁ
 == 1);

380 
	`as£¹
Ð
off£t
 == 3);

383 
	`as£¹
Ð
couÁ
 == 1);

385 
t
->
RowsP”SŒ
 = 
off£t
;

389 
	`g‘IÁA¼ay
Ð
t
, 
off£t
, 
ty³
,->
SŒBy‹CouÁs
, 
couÁ
);

392 
	`as£¹
Ð
couÁ
 == 1);

393 
	`g‘IÁA¼ay
Ð
t
, 
off£t
, 
ty³
,->
XResÞutiÚ
, 1);

397 
	`as£¹
Ð
couÁ
 == 1);

398 
	`g‘IÁA¼ay
Ð
t
, 
off£t
, 
ty³
,->
YResÞutiÚ
, 1);

402 
	`as£¹
Ð
couÁ
 == 1);

404 
	`as£¹
Ð
off£t
 == 1);

408 
	`as£¹
Ð
couÁ
 == 1);

419 
	}
}

431 
	$»adFžeIÁoMemÜy
 (
Tiff
 * 
t
, cÚ¡ * 
·th
)

434 
út
, 
»suÉ
;

435 
ušt16


436 
by‹Ord”
;

438 
’dŸn
 = 1,

439 
machšeL™ŽeEndŸn
 = (*Ð(*)(&
’dŸn
) ) == 1) ? 1 : 0,

440 
fd
;

442 
	`as£¹
Ð
t
);

443 
	`as£¹
Ð
·th
);

445 
fd
 = 
	`Ý’
Ð
·th
, 
OPENFLAGS_READ
);

446 ià(
fd
 == -1)

448 
	`årštf
Ð
¡d”r
, "Couldn'ˆÝ’Ø»ad: %s\n", 
·th
);

452 
út
 = (è
	`l£ek
Ð
fd
, 0, 
SEEK_END
);

453 ià(
út
 == -1L)

456 ià(
	`l£ek
Ð
fd
, 0, 
SEEK_SET
) == -1L)

459 
t
->
fžeInMemÜy
 = (
ušt8
 *è
	`»®loc
Ðt->fžeInMemÜy, 
út
);

460 ià(
t
->
fžeInMemÜy
 == 0)

462 
	`þo£
Ð
fd
);

466 
»suÉ
 = (è
	`»ad
Ð
fd
, 
t
->
fžeInMemÜy
, 
út
);

467 ià(
»suÉ
 !ð
út
)

469 
	`þo£
Ð
fd
);

473 
	`þo£
Ð
fd
);

475 
by‹Ord”
 = (
t
->
fžeInMemÜy
[0] << 8) |->fileInMemory[1];

476 
by‹Ord”
)

479 
t
->
Ë
 = 1;

483 
t
->
Ë
 = 0;

487 
	`årštf
Ð
¡d”r
, "Firstwo bytes indicate: Not‡ TIFF file\n");

488 
	`ä“_poš‹r
Ð
t
->
fžeInMemÜy
);

491 ià(
t
->
Ë
 =ð
machšeL™ŽeEndŸn
)

493 
t
->
g‘U16
 = getU16;

494 
t
->
g‘U32
 = getU32;

498 
t
->
g‘U16
 = 
g‘Sw­³dU16
;

499 
t
->
g‘U32
 = 
g‘Sw­³dU32
;

501 
t
->
mp
 =->
fžeInMemÜy
;

503 
	}
}

512 
	$»adImageD©a
 (
Tiff
 * 
t
)

514 
i
, 
j
, 
n
;

515 
ušt8
 *
mp
, *
s
;

516 
ušt16
 *
p
;

517 
ušt32
 
size
;

519 
	`as£¹
Ð
t
);

521 
size
 = 
t
->
ImageWidth
 *->
ImageL’gth
 * 3 * (
ušt16
);

522 
t
->
img
 = (
ušt16
 *è
	`»®loc
Ðt->img, 
size
);

523 ià(
t
->
img
 == 0)

526 
t
->
B™sP”Sam¶e
[0])

529 
p
 = 
t
->
img
;

530 
i
=0; i < 
t
->
nSŒs
; ++i)

532 
n
 = 
t
->
SŒBy‹CouÁs
[
i
];

533 
s
 = 
t
->
fžeInMemÜy
 +->
SŒOff£ts
[
i
];

534 
j
=0; j < 
n
; ++j)

536 *
p
++ = *
s
++;

541 
mp
 = 
t
->mp;

542 
p
 = 
t
->
img
;

543 
i
=0; i < 
t
->
nSŒs
; ++i)

545 
n
 = 
t
->
SŒBy‹CouÁs
[
i
] / 2;

546 
t
->
mp
 =->
fžeInMemÜy
 +->
SŒOff£ts
[
i
];

547 
j
=0; j < 
n
; ++j)

549 *
p
++ = (
ušt16
è
	`g‘U16
Ð
t
);

552 
t
->
mp
 = mp;

556 
	}
}

566 
	$»adImageFžeDœeùÜy
 (
Tiff
 * 
t
)

568 
ušt32
 
i
;

569 
ušt32
 
nEÁr›s
 = 
t
->
	`g‘U16
();

571 
i
=0; i < 
nEÁr›s
; ++i)

573 
	`»adDœeùÜyEÁry
Ð
t
);

576 
	}
}

586 
	$»adImageFžeH—d”
 (
Tiff
 * 
t
)

588 
t
->
ifh
.
by‹Ord”
 = (
ušt16
è
	`g‘U16
();

589 
t
->
ifh
.
¬b™¿ryNumb”
 = (
ušt16
è
	`g‘U16
();

590 
t
->
ifh
.
off£t
 = 
	`g‘U32
();

591 ià(
t
->
ifh
.
¬b™¿ryNumb”
 != 42)

593 
	`årštf
Ð
¡d”r
, "ImageFileHeader.arbitrary != 42\n");

596 
t
->
mp
 =->
fžeInMemÜy
 +->
ifh
.
off£t
;

598 
	}
}

607 
	$»adTiff
 (
Tiff
 * 
t
, * 
·th
) {

608 
	`as£¹
Ð
t
);

609 
	`as£¹
Ð
·th
);

611 ià(
	`»adFžeIÁoMemÜy
Ð
t
, 
·th
))

612 
E¼Ü
;

613 ià(
	`»adImageFžeH—d”
Ð
t
))

614 
E¼Ü
;

615 ià(
	`»adImageFžeDœeùÜy
Ð
t
))

616 
E¼Ü
;

617 ià(
	`»adImageD©a
Ð
t
))

618 
E¼Ü
;

621 
E¼Ü
:

622 
	`ä“_poš‹r
Ð
t
->
fžeInMemÜy
);

623 
	`ä“_poš‹r
Ð
t
->
img
);

625 
	}
}

634 
	$RGB_YUV_š™Ÿlize
 (
RGB_YUV
 * 
T
,

635 
VideoCode
 
videoCode
,

636 
¡dRªge
,

637 
ušt16
 
pixMax


640 
i
, 
pixSÿË
;

642 
videoCode
)

644 
VC_ITU_REC709
:

645 
VC_CCIR_601
:

648 
	`årštf
Ð
¡d”r
, "RGB_YUV_š™Ÿlize: UnsuµÜ‹d videoCod(%d)\n", 
videoCode
);

652 
T
->
¡dRªge
 = stdRange;

653 
T
->
pixMax
 =…ixMax;

655 
pixSÿË
 = ()
pixMax
 + (()pixMax & 1);

657 ià(
¡dRªge
)

659 
T
->
offy
 = ()(
INTEGER_SCALE
 * (
pixSÿË
 * 16 / 256.0 + 0.5));

660 
T
->
sy
 = 
INTEGER_SCALE
 * 
¡dSÿËY
 / 255.0;

661 
T
->
suv
 = 
INTEGER_SCALE
 * 
¡dSÿËUV
 / 255.0;

665 
T
->
offy
 = ()(
INTEGER_SCALE
 * 0.5);

666 
T
->
sy
 = 
INTEGER_SCALE
;

667 
T
->
suv
 = 
INTEGER_SCALE
;

669 
T
->
offuv
 = ()(
INTEGER_SCALE
 * (0.5 * 
pixSÿË
 + 0.5));

672 
T
->
yr
 = ()(T-> 
sy
*
CR
 +0.5); T->
yg
 = ()(T-> sy*
CG
 +0.5); T->
yb
 = ()(T-> sy*
CB
 +0.5);

673 
T
->
ur
 = ()(T->
suv
*
CR
*
CU
-0.5); T->
ug
 = ()(T->suv*
CG
*CU-0.5); T->
ub
 = ()(T->suv*0.5 +0.5);

674 
T
->
vr
 = ()(T->
suv
*0.5 +0.5); T->
vg
 = ()(T->suv*
CG
*
CV
-0.5); T->
vb
 = ()(T->suv*
CB
*CV-0.5);

676 
i
 = ()(
T
->
sy
 + 0.5);

677 ià(
T
->
yr
+T->
yg
+T->
yb
 !ð
i
)

679 
	`årštf
Ð
¡d”r
, "ERROR: RGB_YUV_š™Ÿlize: yr+yg+yb=%d sy=%u\n", 
T
->
yr
+T->
yg
+T->
yb
, 
i
);

682 ià(
T
->
ur
+T->
ug
+T->
ub
)

684 
	`årštf
Ð
¡d”r
, "ERROR: RGB_YUV_š™Ÿlize: ur+ug+ub=%d\n", 
T
->
ur
+T->
ug
+T->
ub
);

687 ià(
T
->
vr
+T->
vg
+T->
vb
)

689 
	`årštf
Ð
¡d”r
, "ERROR: RGB_YUV_š™Ÿlize: vr+vg+vb=%d\n", 
T
->
vr
+T->
vg
+T->
vb
);

694 
	}
}

703 
	$RGB_YUV_rgb_to_yuv
 (
RGB_YUV
 * 
T
,

704 
ušt16
 *
½
,

705 
ušt16
 *
gp
,

706 
ušt16
 *
bp
,

707 
x»s
,

708 
y»s
,

709 
rgb_¡ride
,

710 
ušt16
 *
yp
,

711 
ušt16
 *
up
,

712 
ušt16
 *
vp
,

713 
yuv_¡ride


716 
i
;

717 
couÁ
 = 
x»s
 * 
y»s
;

719 ià(
T
->
¡dRªge
)

721 
i
=0; i < 
couÁ
; ++i)

723 
T
->
r
 = (è*
½
;„°+ð
rgb_¡ride
;

724 
T
->
g
 = (è*
gp
; g°+ð
rgb_¡ride
;

725 
T
->
b
 = (è*
bp
; b°+ð
rgb_¡ride
;

727 *
yp
 = (
ušt16
)((
T
->
yr
*T->
r
 + T->
yg
*T->
g
 + T->
yb
*T->
b
 + T-> 
offy
è>> 
INTEGER_SHIFT
); y°+ð
yuv_¡ride
;

728 *
up
 = (
ušt16
)((
T
->
ur
*T->
r
 + T->
ug
*T->
g
 + T->
ub
*T->
b
 + T->
offuv
è>> 
INTEGER_SHIFT
); u°+ð
yuv_¡ride
;

729 *
vp
 = (
ušt16
)((
T
->
vr
*T->
r
 + T->
vg
*T->
g
 + T->
vb
*T->
b
 + T->
offuv
è>> 
INTEGER_SHIFT
); v°+ð
yuv_¡ride
;

734 
i
=0; i < 
couÁ
; ++i)

736 
T
->
r
 = (è*
½
;„°+ð
rgb_¡ride
;

737 
T
->
g
 = (è*
gp
; g°+ð
rgb_¡ride
;

738 
T
->
b
 = (è*
bp
; b°+ð
rgb_¡ride
;

742 
T
->
y
 = (T->
yr
*T->
r
 + T->
yg
*T->
g
 + T->
yb
*T->
b
 + T-> 
offy
è>> 
INTEGER_SHIFT
;

743 ià(
T
->
y
 < 0)

744 
T
->
y
 = 0;

745 ià(
T
->
y
 > T->
pixMax
)

746 
T
->
y
 = (èT->
pixMax
;

747 *
yp
 = (
ušt16
è
T
->
y
; y°+ð
yuv_¡ride
;

749 
T
->
u
 = (T->
ur
*T->
r
 + T->
ug
*T->
g
 + T->
ub
*T->
b
 + T->
offuv
è>> 
INTEGER_SHIFT
;

750 ià(
T
->
u
 < 0)

751 
T
->
u
 = 0;

752 ià(
T
->
u
 > T->
pixMax
)

753 
T
->
u
 = (èT->
pixMax
;

754 *
up
 = (
ušt16
è
T
->
u
; u°+ð
yuv_¡ride
;

756 
T
->
v
 = (T->
vr
*T->
r
 + T->
vg
*T->
g
 + T->
vb
*T->
b
 + T->
offuv
è>> 
INTEGER_SHIFT
;

757 ià(
T
->
v
 < 0)

758 
T
->
v
 = 0;

759 ià(
T
->
v
 > T->
pixMax
)

760 
T
->
v
 = (èT->
pixMax
;

761 *
vp
 = (
ušt16
è
T
->
v
; v°+ð
yuv_¡ride
;

764 
	}
}

798 
	$hÜizÚl_h®f_1chª_cos™e
 (
ušt16
 *
¤cPŒ
,

799 
¤cX»s
,

800 
y»s
,

801 
¤cZ»s
,

802 
ušt16
 *
d¡PŒ
,

803 
d¡Z»s
,

804 
pixMax


807 
x
, 
y
, 
lim™
, 
n7
, 
n5
, 
n3
, 
n1
;

808 
»suÉ
;

809 
ušt16
 *
¤c
 = 
¤cPŒ
;

810 
ušt16
 *
d¡
 = 
d¡PŒ
;

812 
y
=0; y < 
y»s
; y++)

814 
x
=0; x < 8; x+=2)

816 
n1
 = (
x
 >= 1) ? 1 : x;

817 
n3
 = (
x
 >= 3) ? 3 : x;

818 
n5
 = (
x
 >= 5) ? 5 : x;

819 
n7
 = (
x
 >= 7) ? 7 : x;

820 
»suÉ
 = ( 2048* *(
¤c
)

821 + 1228*Ð*(
¤c
-
n1
*
¤cZ»s
) + *(src+ srcZres) )

822 - 262*Ð*(
¤c
-
n3
*
¤cZ»s
) + *(src+3*srcZres) )

823 + 47*Ð*(
¤c
-
n5
*
¤cZ»s
) + *(src+5*srcZres) )

824 + 11*Ð*(
¤c
-
n7
*
¤cZ»s
) + *(src+7*srcZres) )+2048) / 4096;

825 ià(
»suÉ
 < 0)

826 
»suÉ
 = 0;

827 ià(
»suÉ
 > 
pixMax
)

828 
»suÉ
 = 
pixMax
;

829 *
d¡
 = (
ušt16
è
»suÉ
;

830 
d¡
 +ð
d¡Z»s
;

831 
¤c
 +ð2*
¤cZ»s
;

834 
lim™
 = 
¤cX»s
 - 8;

835 
x
=8; x < 
lim™
; x+=2)

837 
»suÉ
 = ( 2048* *(
¤c
)

838 + 1228*Ð*(
¤c
- 
¤cZ»s
) + *(src+ srcZres) )

839 - 262*Ð*(
¤c
-3*
¤cZ»s
) + *(src+3*srcZres) )

840 + 47*Ð*(
¤c
-5*
¤cZ»s
) + *(src+5*srcZres) )

841 + 11*Ð*(
¤c
-7*
¤cZ»s
) + *(src+7*srcZres) )+2048) / 4096;

842 ià(
»suÉ
 < 0)

843 
»suÉ
 = 0;

844 ià(
»suÉ
 > 
pixMax
)

845 
»suÉ
 = 
pixMax
;

846 *
d¡
 = (
ušt16
è
»suÉ
;

847 
d¡
 +ð
d¡Z»s
;

848 
¤c
 +ð2*
¤cZ»s
;

851 
lim™
 = 
¤cX»s
 - (srcXres & 1);

852 ; 
x
 < 
lim™
; x+=2)

854 
n1
 = (
x
 < 
¤cX»s
-1) ? 1 : 0;

855 
n3
 = (
x
 < 
¤cX»s
-3) ? 3 : (srcXres-1-x);

856 
n5
 = (
x
 < 
¤cX»s
-5) ? 5 : (srcXres-1-x);

857 
n7
 = (
x
 < 
¤cX»s
-7) ? 7 : (srcXres-1-x);

858 
»suÉ
 = ( 2048* *(
¤c
)

859 + 1228*Ð*(
¤c
- 
¤cZ»s
è+ *(¤c+
n1
*srcZres) )

860 - 262*Ð*(
¤c
-3*
¤cZ»s
è+ *(¤c+
n3
*srcZres) )

861 + 47*Ð*(
¤c
-5*
¤cZ»s
è+ *(¤c+
n5
*srcZres) )

862 + 11*Ð*(
¤c
-7*
¤cZ»s
è+ *(¤c+
n7
*srcZres) )+2048) / 4096;

863 ià(
»suÉ
 < 0)

864 
»suÉ
 = 0;

865 ià(
»suÉ
 > 
pixMax
)

866 
»suÉ
 = 
pixMax
;

867 *
d¡
 = (
ušt16
è
»suÉ
;

868 
d¡
 +ð
d¡Z»s
;

869 
¤c
 +ð2*
¤cZ»s
;

872 
	}
}

882 
	$v”tiÿl_h®f_1chª
 (
ušt16
 *
¤cPŒ
,

883 
x»s
,

884 
¤cY»s
,

885 
¤cZ»s
,

886 
ušt16
 *
d¡PŒ
,

887 
d¡Z»s
,

888 
pixMax


891 
x
, 
y
, 
lim™
, 
n6
, 
n5
, 
n4
, 
n3
, 
n2
, 
n1
;

892 
»suÉ
;

894 
¤cRowCouÁ
 = 
x»s
 * 
¤cZ»s
;

895 
ušt16
 *
¤c
 = 
¤cPŒ
;

896 
ušt16
 *
d¡
 = 
d¡PŒ
;

898 
y
=0; y < 6; y+=2)

900 
n1
 = (
y
 >= 1) ? 1 : y;

901 
n2
 = (
y
 >= 2) ? 2 : y;

902 
n3
 = (
y
 >= 3) ? 3 : y;

903 
n4
 = (
y
 >= 4) ? 4 : y;

905 
x
=0; x < 
x»s
; x++)

907 
»suÉ
 = (225*Ð*(
¤c
 ) + *(¤c+ 
¤cRowCouÁ
) )

908 +69*Ð*(
¤c
-
n1
*
¤cRowCouÁ
) + *(src+2*srcRowCount) )

909 -30*Ð*(
¤c
-
n2
*
¤cRowCouÁ
) + *(src+3*srcRowCount) )

910 -16*Ð*(
¤c
-
n3
*
¤cRowCouÁ
) + *(src+4*srcRowCount) )

911 + 6*Ð*(
¤c
-
n4
*
¤cRowCouÁ
) + *(src+5*srcRowCount) )

912 + 2*Ð*(
¤c
- 
y
*
¤cRowCouÁ
) + *(src+6*srcRowCount) )+256) / 512;

913 ià(
»suÉ
 < 0)

914 
»suÉ
 = 0;

915 ià(
»suÉ
 > 
pixMax
)

916 
»suÉ
 = 
pixMax
;

917 *
d¡
 = (
ušt16
è
»suÉ
;

918 
d¡
 +ð
d¡Z»s
;

919 
¤c
 +ð
¤cZ»s
;

921 
¤c
 +ð
¤cRowCouÁ
;

924 
lim™
 = 
¤cY»s
 - 6;

925 
y
=6; y < 
lim™
; y+=2)

927 
x
=0; x < 
x»s
; x++)

929 
»suÉ
 = (225*Ð*(
¤c
 ) + *(¤c+ 
¤cRowCouÁ
) )

930 +69*Ð*(
¤c
- 
¤cRowCouÁ
) + *(src+2*srcRowCount) )

931 -30*Ð*(
¤c
-2*
¤cRowCouÁ
) + *(src+3*srcRowCount) )

932 -16*Ð*(
¤c
-3*
¤cRowCouÁ
) + *(src+4*srcRowCount) )

933 + 6*Ð*(
¤c
-4*
¤cRowCouÁ
) + *(src+5*srcRowCount) )

934 + 2*Ð*(
¤c
-5*
¤cRowCouÁ
) + *(src+6*srcRowCount) )+256) / 512;

935 ià(
»suÉ
 < 0)

936 
»suÉ
 = 0;

937 ià(
»suÉ
 > 
pixMax
)

938 
»suÉ
 = 
pixMax
;

939 *
d¡
 = (
ušt16
è
»suÉ
;

940 
d¡
 +ð
d¡Z»s
;

941 
¤c
 +ð
¤cZ»s
;

943 
¤c
 +ð
¤cRowCouÁ
;

946 
lim™
 = 
¤cY»s
 - (srcYres & 1);

947 ; 
y
 < 
lim™
; y+=2)

949 
n1
 = (
y
 < 
¤cY»s
-1) ? 1 : 0;

950 
n2
 = (
y
 < 
¤cY»s
-2) ? 2 : (srcYres-1-y);

951 
n3
 = (
y
 < 
¤cY»s
-3) ? 3 : (srcYres-1-y);

952 
n4
 = (
y
 < 
¤cY»s
-4) ? 4 : (srcYres-1-y);

953 
n5
 = (
y
 < 
¤cY»s
-5) ? 5 : (srcYres-1-y);

954 
n6
 = (
y
 < 
¤cY»s
-6) ? 6 : (srcYres-1-y);

955 
x
=0; x < 
x»s
; x++)

957 
»suÉ
 = (225*Ð*(
¤c
 ) + *(¤c+
n1
*
¤cRowCouÁ
) )

958 +69*Ð*(
¤c
- 
¤cRowCouÁ
è+ *(¤c+
n2
*srcRowCount) )

959 -30*Ð*(
¤c
-2*
¤cRowCouÁ
è+ *(¤c+
n3
*srcRowCount) )

960 -16*Ð*(
¤c
-3*
¤cRowCouÁ
è+ *(¤c+
n4
*srcRowCount) )

961 + 6*Ð*(
¤c
-4*
¤cRowCouÁ
è+ *(¤c+
n5
*srcRowCount) )

962 + 2*Ð*(
¤c
-5*
¤cRowCouÁ
è+ *(¤c+
n6
*srcRowCount) )+256) / 512;

963 ià(
»suÉ
 < 0)

964 
»suÉ
 = 0;

965 ià(
»suÉ
 > 
pixMax
)

966 
»suÉ
 = 
pixMax
;

967 *
d¡
 = (
ušt16
è
»suÉ
;

968 
d¡
 +ð
d¡Z»s
;

969 
¤c
 +ð
¤cZ»s
;

971 
¤c
 +ð
¤cRowCouÁ
;

973 
	}
}

994 
	$R—dTIFFImage
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
, 
F¿meNoInFže
, 
F¿meFÜm©
 *
sourû
, *
buf
)

996 
Tiff
 
t
;

997 
·th
[
FILE_NAME_SIZE
];

998 
äameNumb”InFže
, 
n
, 
nCompÚ’ts
, 
height
, 
i
, 
width
, 
y
;

999 
RGB_YUV
 
rgb_yuv
;

1000 
ušt16


1001 *
img
, *
‹mp
 = 
NULL
, *
‹mp2
 = NULL,

1002 *
p
, *
yp
, *
up
, *
vp
;

1004 
	`as£¹
Ð
p_IÅ
);

1005 
	`as£¹
Ð
šput_fže
);

1006 
	`as£¹
Ð
sourû
);

1007 
	`as£¹
Ð
buf
);

1009 
width
 = 
sourû
->width[0];

1010 
height
 = 
sourû
->height[0];

1011 
	`as£¹
Ð(
width
 & 1è=ð0 && (
height
 & 1) == 0);

1013 ià(
sourû
->
cÞÜ_mod–
 =ð
CM_RGB
 && !
šput_fže
->
is_š‹¾—ved
)

1015 
	`årštf
Ð
¡d”r
, "ReadTIFFImage: RGB input file has‚ot been declared‡s interleaved but only interleaved is supported\n");

1016 
E¼Ü
;

1019 
äameNumb”InFže
 = 
F¿meNoInFže
 + 
p_IÅ
->
¡¬t_äame
;

1020 ià(
šput_fže
->
num_dig™s
 > 0)

1022 ià(
šput_fže
->
z”o_·d
)

1024 
n
 = 
	`¢´štf
Ð
·th
, Õ©h), "%s%0*d%s", 
šput_fže
->
fh—d
, iÅut_fže->
num_dig™s
, 
äameNumb”InFže
, iÅut_fže->
áaž
);

1028 
n
 = 
	`¢´štf
Ð
·th
, Õ©h), "%s%*d%s", 
šput_fže
->
fh—d
, iÅut_fže->
num_dig™s
, 
äameNumb”InFže
, iÅut_fže->
áaž
);

1030 ià(
n
 =ð
FILE_NAME_SIZE
 ||‚ == -1)

1032 
	`årštf
Ð
¡d”r
, "ReadTIFFImage: file‚ame isoo†arge\n");

1038 
	`¡rýy
Ð
·th
, 
šput_fže
->
âame
);

1041 ià(
	`»adTiff
Ð&
t
, 
·th
))

1043 
E¼Ü
;

1046 ià((è
t
.
ImageL’gth
 !ð
height
)

1048 
	`årštf
Ð
¡d”r
, "R—dTIFFImage: Tifàheighˆ(%uèdifã»Á fromƒncod” iÅuˆheighˆ(%dè. Ex™šg...\n", 
t
.
ImageL’gth
, 
height
);

1049 
E¼Ü
;

1051 ià((è
t
.
ImageWidth
 !ð
width
)

1053 
	`årštf
Ð
¡d”r
, "R—dTIFFImage: Tifàwidth (%uèdifã»Á fromƒncod” iÅuˆwidth (%dè. Ex™šg...\n", 
t
.
ImageWidth
, 
width
);

1054 
E¼Ü
;

1057 ià(
sourû
->
pic_un™_size_Ú_disk
 != 8 && source->pic_unit_size_on_disk != 16) {

1058 
	`årštf
Ð
¡d”r
, "R—dTIFFImagÚly suµÜt pic_un™_size_Ú_disk oà8 o¸16‚Ù %d\n", 
sourû
->
pic_un™_size_Ú_disk
);

1059 
E¼Ü
;

1064 
img
 = 
t
.img;

1065 
nCompÚ’ts
 = 
width
 * 
height
 * 3;

1067 ià(
sourû
->
cÞÜ_mod–
 =ð
CM_YUV
)

1069 ià(
	`RGB_YUV_š™Ÿlize
Ð&
rgb_yuv
, (
VideoCode
è
p_IÅ
->
videoCode
,…_IÅ->
¡dRªge
, 65535))

1070 
E¼Ü
;

1072 
	`RGB_YUV_rgb_to_yuv
Ð&
rgb_yuv
, 
img
, img+1, img+2, 
width
, 
height
, 3, img, img+1, img+2, 3);

1073 
sourû
->
yuv_fÜm©
)

1075 
YUV420
:

1077 
nCompÚ’ts
 = 
width
 * 
height
 * 3 / 2;

1078 
yp
 = 
‹mp
 = (
ušt16
 *è
	`m®loc
Ð
nCompÚ’ts
 * (uint16));

1079 
up
 = 
yp
 + 
width
 * 
height
;

1080 
vp
 = 
up
 + 
width
 * 
height
 / 4;

1082 
p
 = 
img
;

1083 
i
=0; i < 
width
*
height
; ++i)

1085 
yp
[
i
] = *
p
;… += 3;

1088 
‹mp2
 = (
ušt16
 *è
	`m®loc
Ð
height
 * 
width
 * (uint16) / 2);

1090 
	`hÜizÚl_h®f_1chª_cos™e
Ð
img
+1, 
width
, 
height
, 3, 
‹mp2
, 1, 65535);

1091 
	`v”tiÿl_h®f_1chª
Ð
‹mp2
, 
width
/2, 
height
, 1, 
up
, 1, 65535);

1093 
	`hÜizÚl_h®f_1chª_cos™e
Ð
img
+2, 
width
, 
height
, 3, 
‹mp2
, 1, 65535);

1094 
	`v”tiÿl_h®f_1chª
Ð
‹mp2
, 
width
/2, 
height
, 1, 
vp
, 1, 65535);

1095 
	`ä“_poš‹r
(
‹mp2
);

1096 
img
 = 
yp
;

1098 
YUV422
:

1100 
nCompÚ’ts
 = 
width
 * 
height
 * 2;

1101 
yp
 = 
‹mp
 = (
ušt16
 *è
	`m®loc
Ð
nCompÚ’ts
 * (uint16));

1102 
up
 = 
yp
 + 
width
*
height
;

1103 
vp
 = 
yp
 + 
width
*
height
/2;

1105 
p
 = 
img
;

1106 
i
=0; i < 
width
*
height
; ++i)

1108 
yp
[
i
] = *
p
;… += 3;

1111 
y
=0; y < 
height
; ++y) {

1112 
	`hÜizÚl_h®f_1chª_cos™e
Ð
img
 + 1 + 
y
*
width
*3, width, 1, 3, 
up
 + y * width/2, 1, 65535);

1113 
	`hÜizÚl_h®f_1chª_cos™e
Ð
img
 + 2 + 
y
*
width
*3, width, 1, 3, 
vp
 + y * width/2, 1, 65535);

1115 
img
 = 
yp
;

1117 
YUV444
:

1120 
	`årštf
Ð
¡d”r
, "R—dTIFFImage: UnsuµÜ‹d CÞÜFÜm© (%d)\n", 
sourû
->
yuv_fÜm©
);

1121 
E¼Ü
;

1125 
sourû
->
pic_un™_size_shiá3
)

1128 
i
=0; i < 
nCompÚ’ts
; ++i)

1130 
buf
[
i
] = (
ušt8
)(
img
[i] >> 8);

1134 
i
=0; i < 
nCompÚ’ts
; ++i)

1136 ((
ušt16
 *è
buf
)[
i
] = 
img
[i];

1140 
	`årštf
Ð
¡d”r
, "R—dTIFFImagÚly suµÜt pic_un™_size_shiá3 oà1 o¸2‚Ù %d\n", 
sourû
->
pic_un™_size_shiá3
);

1141 
E¼Ü
;

1144 
	`ä“_poš‹r
(
‹mp
);

1147 
E¼Ü
:

1149 
	`ä“_poš‹r
(
‹mp
);

1150 
	`»pÜt_¡©s_Ú_”rÜ
();

1153 
	}
}

	@lcommon/src/mbuffer_common.c

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

21 
	~"h—d”.h
"

22 
	~"image.h
"

23 
	~"mbufãr_commÚ.h
"

24 
	~"mbufãr.h
"

25 
	~"mem®loc.h
"

26 
	~"ouut.h
"

27 
	~"ç¡_memÜy.h
"

28 
	~"šput.h
"

30 
unm¬k_lÚg_‹rm_f›ld_fÜ_»ã»nû_by_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
Piùu»SŒuùu»
 
¡ruùu»
, 
lÚg_‹rm_äame_idx
, 
m¬k_cu¼’t
, 
cu¼_äame_num
, 
cu¼_pic_num
);

37 
	$is_shÜt_‹rm_»ã»nû
(
F¿meStÜe
* 
fs
)

40 ià(
fs
->
is_u£d
==3)

42 ià((
fs
->
äame
->
u£d_fÜ_»ã»nû
)&&(!fs->äame->
is_lÚg_‹rm
))

48 ià(
fs
->
is_u£d
 & 1)

50 ià(
fs
->
tÝ_f›ld
)

52 ià((
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
)&&(!fs->tÝ_f›ld->
is_lÚg_‹rm
))

59 ià(
fs
->
is_u£d
 & 2)

61 ià(
fs
->
bÙtom_f›ld
)

63 ià((
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
)&&(!fs->bÙtom_f›ld->
is_lÚg_‹rm
))

70 
	}
}

79 
	$is_lÚg_‹rm_»ã»nû
(
F¿meStÜe
* 
fs
)

82 ià(
fs
->
is_u£d
==3)

84 ià((
fs
->
äame
->
u£d_fÜ_»ã»nû
)&&(fs->äame->
is_lÚg_‹rm
))

90 ià(
fs
->
is_u£d
 & 1)

92 ià(
fs
->
tÝ_f›ld
)

94 ià((
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
)&&(fs->tÝ_f›ld->
is_lÚg_‹rm
))

101 ià(
fs
->
is_u£d
 & 2)

103 ià(
fs
->
bÙtom_f›ld
)

105 ià((
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
)&&(fs->bÙtom_f›ld->
is_lÚg_‹rm
))

112 
	}
}

121 
	$g’_pic_li¡_äom_äame_li¡
(
Piùu»SŒuùu»
 
cu¼SŒuùu»
, 
F¿meStÜe
 **
fs_li¡
, 
li¡_idx
, 
StÜabËPiùu»
 **
li¡
, *
li¡_size
, 
lÚg_‹rm
)

123 
tÝ_idx
 = 0;

124 
bÙ_idx
 = 0;

126 (*
is_»f
)(
StÜabËPiùu»
 *
s
èð(
lÚg_‹rm
è? 
is_lÚg_»f
 : 
is_shÜt_»f
;

129 ià(
cu¼SŒuùu»
 =ð
TOP_FIELD
)

131 (
tÝ_idx
<
li¡_idx
)||(
bÙ_idx
<list_idx))

133  ; 
tÝ_idx
<
li¡_idx
;op_idx++)

135 if(
fs_li¡
[
tÝ_idx
]->
is_u£d
 & 1)

137 if(
	`is_»f
(
fs_li¡
[
tÝ_idx
]->
tÝ_f›ld
))

140 
li¡
[(è*
li¡_size
] = 
fs_li¡
[
tÝ_idx
]->
tÝ_f›ld
;

141 (*
li¡_size
)++;

142 
tÝ_idx
++;

147  ; 
bÙ_idx
<
li¡_idx
; bot_idx++)

149 if(
fs_li¡
[
bÙ_idx
]->
is_u£d
 & 2)

151 if(
	`is_»f
(
fs_li¡
[
bÙ_idx
]->
bÙtom_f›ld
))

154 
li¡
[(è*
li¡_size
] = 
fs_li¡
[
bÙ_idx
]->
bÙtom_f›ld
;

155 (*
li¡_size
)++;

156 
bÙ_idx
++;

163 ià(
cu¼SŒuùu»
 =ð
BOTTOM_FIELD
)

165 (
tÝ_idx
<
li¡_idx
)||(
bÙ_idx
<list_idx))

167  ; 
bÙ_idx
<
li¡_idx
; bot_idx++)

169 if(
fs_li¡
[
bÙ_idx
]->
is_u£d
 & 2)

171 if(
	`is_»f
(
fs_li¡
[
bÙ_idx
]->
bÙtom_f›ld
))

174 
li¡
[(è*
li¡_size
] = 
fs_li¡
[
bÙ_idx
]->
bÙtom_f›ld
;

175 (*
li¡_size
)++;

176 
bÙ_idx
++;

181  ; 
tÝ_idx
<
li¡_idx
;op_idx++)

183 if(
fs_li¡
[
tÝ_idx
]->
is_u£d
 & 1)

185 if(
	`is_»f
(
fs_li¡
[
tÝ_idx
]->
tÝ_f›ld
))

188 
li¡
[(è*
li¡_size
] = 
fs_li¡
[
tÝ_idx
]->
tÝ_f›ld
;

189 (*
li¡_size
)++;

190 
tÝ_idx
++;

197 
	}
}

206 
StÜabËPiùu»
* 
	$g‘_lÚg_‹rm_pic
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
LÚg‹rmPicNum
)

208 
ušt32
 
i
;

210 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

212 ià(
cu¼Sliû
->
¡ruùu»
==
FRAME
)

214 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 == 3)

215 ià((
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_É»f[i]->äame->
lÚg_‹rm_pic_num
 =ð
LÚg‹rmPicNum
))

216  
p_Dpb
->
fs_É»f
[
i
]->
äame
;

220 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 & 1)

221 ià((
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_É»f[i]->tÝ_f›ld->
lÚg_‹rm_pic_num
 =ð
LÚg‹rmPicNum
))

222  
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
;

223 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 & 2)

224 ià((
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_É»f[i]->bÙtom_f›ld->
lÚg_‹rm_pic_num
 =ð
LÚg‹rmPicNum
))

225  
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
;

228  
NULL
;

229 
	}
}

238 
	$upd©e_»f_li¡
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

240 
i
, 
j
;

241 
i
=0, 
j
=0; i<
p_Dpb
->
u£d_size
; i++)

243 ià(
	`is_shÜt_‹rm_»ã»nû
(
p_Dpb
->
fs
[
i
]))

245 
p_Dpb
->
fs_»f
[
j
++]õ_Dpb->
fs
[
i
];

249 
p_Dpb
->
»f_äames_š_bufãr
 = 
j
;

251 
j
<
p_Dpb
->
size
)

253 
p_Dpb
->
fs_»f
[
j
++]=
NULL
;

255 
	}
}

267 
	$upd©e_É»f_li¡
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

269 
i
, 
j
;

270 
i
=0, 
j
=0; i<
p_Dpb
->
u£d_size
; i++)

272 ià(
	`is_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs
[
i
]))

274 
p_Dpb
->
fs_É»f
[
j
++] =…_Dpb->
fs
[
i
];

278 
p_Dpb
->
É»f_äames_š_bufãr
 = 
j
;

280 
j
<
p_Dpb
->
size
)

282 
p_Dpb
->
fs_É»f
[
j
++]=
NULL
;

284 
	}
}

292 
	$g‘_pic_num_x
 (
StÜabËPiùu»
 *
p
, 
difã»nû_of_pic_nums_mšus1
)

294 
cu¼PicNum
;

296 ià(
p
->
¡ruùu»
 =ð
FRAME
)

297 
cu¼PicNum
 = 
p
->
äame_num
;

299 
cu¼PicNum
 = 2 * 
p
->
äame_num
 + 1;

301  
cu¼PicNum
 - (
difã»nû_of_pic_nums_mšus1
 + 1);

302 
	}
}

310 
	$mm_unm¬k_shÜt_‹rm_fÜ_»ã»nû
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
difã»nû_of_pic_nums_mšus1
)

312 
picNumX
;

314 
ušt32
 
i
;

316 
picNumX
 = 
	`g‘_pic_num_x
(
p
, 
difã»nû_of_pic_nums_mšus1
);

318 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

320 ià(
p
->
¡ruùu»
 =ð
FRAME
)

322 ià((
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
==3è&& (p_Dpb->fs_»f[i]->
is_lÚg_‹rm
==0))

324 ià(
p_Dpb
->
fs_»f
[
i
]->
äame
->
pic_num
 =ð
picNumX
)

326 
	`unm¬k_fÜ_»ã»nû
(
p_Dpb
->
fs_»f
[
i
]);

333 ià((
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 1è&& (!Õ_Dpb->fs_»f[i]->
is_lÚg_‹rm
 & 1)))

335 ià(
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
pic_num
 =ð
picNumX
)

337 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

338 
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 &= 2;

339 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
 == 3)

341 
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
 = 0;

346 ià((
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 2è&& (!Õ_Dpb->fs_»f[i]->
is_lÚg_‹rm
 & 2)))

348 ià(
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
pic_num
 =ð
picNumX
)

350 
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

351 
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 &= 1;

352 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
 == 3)

354 
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
 = 0;

361 
	}
}

370 
	$mm_unm¬k_lÚg_‹rm_fÜ_»ã»nû
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
lÚg_‹rm_pic_num
)

372 
ušt32
 
i
;

373 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

375 ià(
p
->
¡ruùu»
 =ð
FRAME
)

377 ià((
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
==3è&& (p_Dpb->fs_É»f[i]->
is_lÚg_‹rm
==3))

379 ià(
p_Dpb
->
fs_É»f
[
i
]->
äame
->
lÚg_‹rm_pic_num
 ==†ong_term_pic_num)

381 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

387 ià((
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 & 1è&& (Õ_Dpb->fs_É»f[i]->
is_lÚg_‹rm
 & 1)))

389 ià(
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
->
lÚg_‹rm_pic_num
 ==†ong_term_pic_num)

391 
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

392 
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
 = 0;

393 
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 &= 2;

394 
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 &= 2;

395 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_u£d
 == 3)

397 
p_Dpb
->
fs_É»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
 = 0;

398 
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
 = 0;

403 ià((
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 & 2è&& (Õ_Dpb->fs_É»f[i]->
is_lÚg_‹rm
 & 2)))

405 ià(
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
->
lÚg_‹rm_pic_num
 ==†ong_term_pic_num)

407 
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

408 
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
->
is_lÚg_‹rm
 = 0;

409 
p_Dpb
->
fs_É»f
[
i
]->
is_»ã»nû
 &= 1;

410 
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 &= 1;

411 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_u£d
 == 3)

413 
p_Dpb
->
fs_É»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
 = 0;

414 
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
 = 0;

421 
	}
}

430 
	$unm¬k_lÚg_‹rm_äame_fÜ_»ã»nû_by_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
lÚg_‹rm_äame_idx
)

432 
ušt32
 
i
;

433 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

435 ià(
p_Dpb
->
fs_É»f
[
i
]->
lÚg_‹rm_äame_idx
 ==†ong_term_frame_idx)

436 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

438 
	}
}

448 
	$m¬k_pic_lÚg_‹rm
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
lÚg_‹rm_äame_idx
, 
picNumX
)

450 
ušt32
 
i
;

451 
add_tÝ
, 
add_bÙtom
;

453 ià(
p
->
¡ruùu»
 =ð
FRAME
)

455 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

457 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 == 3)

459 ià((!
p_Dpb
->
fs_»f
[
i
]->
äame
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->äame->
pic_num
 =ð
picNumX
))

461 
p_Dpb
->
fs_»f
[
i
]->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->
äame
->long_term_frame_idx

462 ð
lÚg_‹rm_äame_idx
;

463 
p_Dpb
->
fs_»f
[
i
]->
äame
->
lÚg_‹rm_pic_num
 = 
lÚg_‹rm_äame_idx
;

464 
p_Dpb
->
fs_»f
[
i
]->
äame
->
is_lÚg_‹rm
 = 1;

466 ià(
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
 &&…_Dpb->fs_»f[i]->
bÙtom_f›ld
)

468 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->
bÙtom_f›ld
->long_term_frame_idx

469 ð
lÚg_‹rm_äame_idx
;

470 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
lÚg_‹rm_pic_num
 = 
lÚg_‹rm_äame_idx
;

471 
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
lÚg_‹rm_pic_num
 = 
lÚg_‹rm_äame_idx
;

473 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
 =…_Dpb->fs_»f[i]->
bÙtom_f›ld
->is_long_term

477 
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
 = 3;

482 
	`´štf
 ("Warning:„eference frame for†ongerm marking‚ot found\n");

486 ià(
p
->
¡ruùu»
 =ð
TOP_FIELD
)

488 
add_tÝ
 = 1;

489 
add_bÙtom
 = 0;

493 
add_tÝ
 = 0;

494 
add_bÙtom
 = 1;

496 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

498 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 1)

500 ià((!
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->tÝ_f›ld->
pic_num
 =ð
picNumX
))

502 ià((
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
è&& (p_Dpb->fs_»f[i]->
lÚg_‹rm_äame_idx
 !=†ong_term_frame_idx))

504 
	`´štf
 ("Warning:‡ssigning†ong_term_frame_idx different from other field\n");

507 
p_Dpb
->
fs_»f
[
i
]->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->
tÝ_f›ld
->long_term_frame_idx

508 ð
lÚg_‹rm_äame_idx
;

509 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
lÚg_‹rm_pic_num
 = 2 * 
lÚg_‹rm_äame_idx
 + 
add_tÝ
;

510 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
 = 1;

511 
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
 |= 1;

512 ià(
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
 == 3)

514 
p_Dpb
->
fs_»f
[
i
]->
äame
->
is_lÚg_‹rm
 = 1;

515 
p_Dpb
->
fs_»f
[
i
]->
äame
->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->äame->
lÚg_‹rm_pic_num
 =†ong_term_frame_idx;

520 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 2)

522 ià((!
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->bÙtom_f›ld->
pic_num
 =ð
picNumX
))

524 ià((
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
è&& (p_Dpb->fs_»f[i]->
lÚg_‹rm_äame_idx
 !=†ong_term_frame_idx))

526 
	`´štf
 ("Warning:‡ssigning†ong_term_frame_idx different from other field\n");

529 
p_Dpb
->
fs_»f
[
i
]->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->
bÙtom_f›ld
->long_term_frame_idx

530 ð
lÚg_‹rm_äame_idx
;

531 
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
lÚg_‹rm_pic_num
 = 2 * 
lÚg_‹rm_äame_idx
 + 
add_bÙtom
;

532 
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
is_lÚg_‹rm
 = 1;

533 
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
 |= 2;

534 ià(
p_Dpb
->
fs_»f
[
i
]->
is_lÚg_‹rm
 == 3)

536 
p_Dpb
->
fs_»f
[
i
]->
äame
->
is_lÚg_‹rm
 = 1;

537 
p_Dpb
->
fs_»f
[
i
]->
äame
->
lÚg_‹rm_äame_idx
 =…_Dpb->fs_»f[i]->äame->
lÚg_‹rm_pic_num
 =†ong_term_frame_idx;

543 
	`´štf
 ("Warning:„eference field for†ongerm marking‚ot found\n");

545 
	}
}

554 
	$mm_assign_lÚg_‹rm_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
difã»nû_of_pic_nums_mšus1
, 
lÚg_‹rm_äame_idx
)

556 
picNumX
 = 
	`g‘_pic_num_x
(
p
, 
difã»nû_of_pic_nums_mšus1
);

559 ià(
p
->
¡ruùu»
 =ð
FRAME
)

561 
	`unm¬k_lÚg_‹rm_äame_fÜ_»ã»nû_by_äame_idx
(
p_Dpb
, 
lÚg_‹rm_äame_idx
);

565 
i
;

566 
Piùu»SŒuùu»
 
¡ruùu»
 = 
FRAME
;

568 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

570 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 1)

572 ià(
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
pic_num
 =ð
picNumX
)

574 
¡ruùu»
 = 
TOP_FIELD
;

578 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 2)

580 ià(
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
pic_num
 =ð
picNumX
)

582 
¡ruùu»
 = 
BOTTOM_FIELD
;

587 ià(
¡ruùu»
==
FRAME
)

589 
	`”rÜ
 ("field for†ongerm marking‚ot found",200);

592 
	`unm¬k_lÚg_‹rm_f›ld_fÜ_»ã»nû_by_äame_idx
(
p_Dpb
, 
¡ruùu»
, 
lÚg_‹rm_äame_idx
, 0, 0, 
picNumX
);

595 
	`m¬k_pic_lÚg_‹rm
(
p_Dpb
, 
p
, 
lÚg_‹rm_äame_idx
, 
picNumX
);

596 
	}
}

604 
	$mm_upd©e_max_lÚg_‹rm_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
max_lÚg_‹rm_äame_idx_¶us1
)

606 
ušt32
 
i
;

608 
p_Dpb
->
max_lÚg_‹rm_pic_idx
 = 
max_lÚg_‹rm_äame_idx_¶us1
 - 1;

611 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

613 ià(
p_Dpb
->
fs_É»f
[
i
]->
lÚg_‹rm_äame_idx
 >…_Dpb->
max_lÚg_‹rm_pic_idx
)

615 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

618 
	}
}

627 
	$mm_unm¬k_®l_lÚg_‹rm_fÜ_»ã»nû
 (
DecodedPiùu»Bufãr
 *
p_Dpb
)

629 
	`mm_upd©e_max_lÚg_‹rm_äame_idx
(
p_Dpb
, 0);

630 
	}
}

638 
	$mm_unm¬k_®l_shÜt_‹rm_fÜ_»ã»nû
 (
DecodedPiùu»Bufãr
 *
p_Dpb
)

640 
i
;

641 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

643 
	`unm¬k_fÜ_»ã»nû
(
p_Dpb
->
fs_»f
[
i
]);

645 
	`upd©e_»f_li¡
(
p_Dpb
);

646 
	}
}

655 
	$mm_m¬k_cu¼’t_piùu»_lÚg_‹rm
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 *
p
, 
lÚg_‹rm_äame_idx
)

658 ià(
p
->
¡ruùu»
 =ð
FRAME
)

660 
	`unm¬k_lÚg_‹rm_äame_fÜ_»ã»nû_by_äame_idx
(
p_Dpb
, 
lÚg_‹rm_äame_idx
);

664 
	`unm¬k_lÚg_‹rm_f›ld_fÜ_»ã»nû_by_äame_idx
(
p_Dpb
, 
p
->
¡ruùu»
, 
lÚg_‹rm_äame_idx
, 1,…->
pic_num
, 0);

667 
p
->
is_lÚg_‹rm
 = 1;

668 
p
->
lÚg_‹rm_äame_idx
 =†ong_term_frame_idx;

669 
	}
}

678 
	$is_u£d_fÜ_»ã»nû
(
F¿meStÜe
* 
fs
)

680 ià(
fs
->
is_»ã»nû
)

685 ià(
fs
->
is_u£d
 == 3)

687 ià(
fs
->
äame
->
u£d_fÜ_»ã»nû
)

693 ià(
fs
->
is_u£d
 & 1)

695 ià(
fs
->
tÝ_f›ld
)

697 ià(
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
)

704 ià(
fs
->
is_u£d
 & 2)

706 ià(
fs
->
bÙtom_f›ld
)

708 ià(
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
)

715 
	}
}

723 
	$g‘_sm®Ë¡_poc
(
DecodedPiùu»Bufãr
 *
p_Dpb
, *
poc
,* 
pos
)

725 
ušt32
 
i
;

727 ià(
p_Dpb
->
u£d_size
<1)

729 
	`”rÜ
("Cannot determine smallest POC, DPBƒmpty.",150);

732 *
pos
=-1;

733 *
poc
 = 
INT_MAX
;

734 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

736 ià((*
poc
 > 
p_Dpb
->
fs
[
i
]->poc)&&(!p_Dpb->fs[i]->
is_ouut
))

738 *
poc
 = 
p_Dpb
->
fs
[
i
]->poc;

739 *
pos
 = 
i
;

742 
	}
}

750 
	$»move_unu£d_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

752 
ušt32
 
i
;

755 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

757 ià(
p_Dpb
->
fs
[
i
]->
is_ouut
 && (!
	`is_u£d_fÜ_»ã»nû
(p_Dpb->fs[i])))

759 
	`»move_äame_äom_dpb
(
p_Dpb
, 
i
);

764 
	}
}

773 
	$unm¬k_lÚg_‹rm_f›ld_fÜ_»ã»nû_by_äame_idx
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
Piùu»SŒuùu»
 
¡ruùu»
, 
lÚg_‹rm_äame_idx
, 
m¬k_cu¼’t
, 
cu¼_äame_num
, 
cu¼_pic_num
)

775 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

776 
i
;

778 
	`as£¹
(
¡ruùu»
!=
FRAME
);

779 ià(
cu¼_pic_num
<0)

780 
cu¼_pic_num
 +ð(2 * 
p_Vid
->
max_äame_num
);

782 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

784 ià(
p_Dpb
->
fs_É»f
[
i
]->
lÚg_‹rm_äame_idx
 ==†ong_term_frame_idx)

786 ià(
¡ruùu»
 =ð
TOP_FIELD
)

788 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 == 3)

790 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

794 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 == 1)

796 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

800 ià(
m¬k_cu¼’t
)

802 ià(
p_Dpb
->
Ï¡_piùu»
)

804 iàÐÐ
p_Dpb
->
Ï¡_piùu»
 !ðp_Dpb->
fs_É»f
[
i
] )||…_Dpb->Ï¡_piùu»->
äame_num
 !ð
cu¼_äame_num
)

805 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

809 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

814 ià((
p_Dpb
->
fs_É»f
[
i
]->
äame_num
è!ð()(
cu¼_pic_num
 >> 1))

816 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

822 ià(
¡ruùu»
 =ð
BOTTOM_FIELD
)

824 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 == 3)

826 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

830 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 == 2)

832 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

836 ià(
m¬k_cu¼’t
)

838 ià(
p_Dpb
->
Ï¡_piùu»
)

840 iàÐÐ
p_Dpb
->
Ï¡_piùu»
 !ðp_Dpb->
fs_É»f
[
i
] )||…_Dpb->Ï¡_piùu»->
äame_num
 !ð
cu¼_äame_num
)

841 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

845 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

850 ià((
p_Dpb
->
fs_É»f
[
i
]->
äame_num
è!ð()(
cu¼_pic_num
 >> 1))

852 
	`unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
p_Dpb
->
fs_É»f
[
i
]);

860 
	}
}

	@lcommon/src/memalloc.c

18 
	~"glob®.h
"

19 
	~"mem®loc.h
"

30 
	$š™_tÝ_bÙ_¶ªes
(
img³l
 **
imgF¿me
, 
dim0
, img³È***
imgTÝF›ld
, img³È***
imgBÙF›ld
)

32 
i
;

34 if((*
imgTÝF›ld
 = (
img³l
**)
	`mem_m®loc
((
dim0
>>1è* (img³l*))è=ð
NULL
)

35 
	`no_mem_ex™
("init_top_bot_planes: imgTopField");

37 if((*
imgBÙF›ld
 = (
img³l
**)
	`mem_m®loc
((
dim0
>>1è* (img³l*))è=ð
NULL
)

38 
	`no_mem_ex™
("init_top_bot_planes: imgBotField");

40 
i
 = 0; i < (
dim0
>>1); i++)

42 (*
imgTÝF›ld
)[
i
] = 
imgF¿me
[2 * i ];

43 (*
imgBÙF›ld
)[
i
] = 
imgF¿me
[2 * i + 1];

46  
dim0
 * (
img³l
*);

47 
	}
}

57 
	$ä“_tÝ_bÙ_¶ªes
(
img³l
 **
imgTÝF›ld
, img³È**
imgBÙF›ld
)

59 
	`mem_ä“
 (
imgTÝF›ld
);

60 
	`mem_ä“
 (
imgBÙF›ld
);

61 
	}
}

72 
	$g‘_mem2Ddi¡
(
Di¡ÜtiÚD©a
 ***
¬¿y2D
, 
dim0
, 
dim1
)

74 
i
;

76 if((*
¬¿y2D
 = (
Di¡ÜtiÚD©a
**)
	`mem_m®loc
(
dim0
 * (Di¡ÜtiÚD©a*))è=ð
NULL
)

77 
	`no_mem_ex™
("get_mem2Ddist:‡rray2D");

78 if((*(*
¬¿y2D
èð(
Di¡ÜtiÚD©a
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(Di¡ÜtiÚD©¨))è=ð
NULL
)

79 
	`no_mem_ex™
("get_mem2Ddist:‡rray2D");

81 
i
 = 1 ; i < 
dim0
; i++)

82 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

84  
dim0
 * ((
Di¡ÜtiÚD©a
*è+ 
dim1
 * (DistortionData));

85 
	}
}

95 
	$g‘_mem2Dlm
(
LambdaP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
)

97 
i
;

99 if((*
¬¿y2D
 = (
LambdaP¬ams
**)
	`mem_m®loc
(
dim0
 * (LambdaP¬ams*))è=ð
NULL
)

100 
	`no_mem_ex™
("get_mem2Dlm:‡rray2D");

101 if((*(*
¬¿y2D
èð(
LambdaP¬ams
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(LambdaP¬am ))è=ð
NULL
)

102 
	`no_mem_ex™
("get_mem2Dlm:‡rray2D");

104 
i
 = 1 ; i < 
dim0
; i++)

105 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

107  
dim0
 * ((
LambdaP¬ams
*è+ 
dim1
 * (LambdaParams));

108 
	}
}

117 
	$ä“_mem2Ddi¡
(
Di¡ÜtiÚD©a
 **
¬¿y2D
)

119 ià(
¬¿y2D
)

121 ià(*
¬¿y2D
)

122 
	`mem_ä“
 (*
¬¿y2D
);

124 
	`”rÜ
 ("free_mem2Ddist:ryingo free unused memory",100);

126 
	`mem_ä“
 (
¬¿y2D
);

130 
	`”rÜ
 ("free_mem2Ddist:ryingo free unused memory",100);

132 
	}
}

141 
	$ä“_mem2Dlm
(
LambdaP¬ams
 **
¬¿y2D
)

143 ià(
¬¿y2D
)

145 ià(*
¬¿y2D
)

146 
	`mem_ä“
 (*
¬¿y2D
);

148 
	`”rÜ
 ("free_mem2Dlm:ryingo free unused memory",100);

150 
	`mem_ä“
 (
¬¿y2D
);

154 
	`”rÜ
 ("free_mem2Dlm:ryingo free unused memory",100);

156 
	}
}

166 
	$g‘_mem2Dmp
(
PicMÙiÚP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
)

168 
i
;

170 if((*
¬¿y2D
 = (
PicMÙiÚP¬ams
**)
	`mem_m®loc
(
dim0
 * (PicMÙiÚP¬ams*))è=ð
NULL
)

171 
	`no_mem_ex™
("get_mem2Dmp:‡rray2D");

172 if((*(*
¬¿y2D
èð(
PicMÙiÚP¬ams
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
, (PicMÙiÚP¬am ))è=ð
NULL
)

173 
	`no_mem_ex™
("get_mem2Dmp:‡rray2D");

175 
i
 = 1 ; i < 
dim0
; i++)

176 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

178  
dim0
 * ((
PicMÙiÚP¬ams
*è+ 
dim1
 * (PicMotionParams));

179 
	}
}

190 
	$g‘_mem3Dmp
(
PicMÙiÚP¬ams
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

192 
i
, 
mem_size
 = 
dim0
 * (
PicMÙiÚP¬ams
**);

194 if(((*
¬¿y3D
èð(
PicMÙiÚP¬ams
***)
	`mem_m®loc
(
dim0
 * (PicMÙiÚP¬ams**))è=ð
NULL
)

195 
	`no_mem_ex™
("get_mem3Dmp:‡rray3D");

197 
mem_size
 +ð
	`g‘_mem2Dmp
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

199 
i
 = 1; i < 
dim0
; i++)

200 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[˜- 1] + 
dim1
;

202  
mem_size
;

203 
	}
}

212 
	$ä“_mem2Dmp
(
PicMÙiÚP¬ams
 **
¬¿y2D
)

214 ià(
¬¿y2D
)

216 ià(*
¬¿y2D
)

217 
	`mem_ä“
 (*
¬¿y2D
);

219 
	`”rÜ
 ("free_mem2Dmp:ryingo free unused memory",100);

221 
	`mem_ä“
 (
¬¿y2D
);

225 
	`”rÜ
 ("free_mem2Dmp:ryingo free unused memory",100);

227 
	}
}

236 
	$ä“_mem3Dmp
(
PicMÙiÚP¬ams
 ***
¬¿y3D
)

238 ià(
¬¿y3D
)

240 
	`ä“_mem2Dmp
(*
¬¿y3D
);

241 
	`mem_ä“
 (
¬¿y3D
);

245 
	`”rÜ
 ("free_mem3Dmp:ryingo free unused memory",100);

247 
	}
}

257 
	$g‘_mem2Dquªt
(
Lev–QuªtP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
)

259 
i
;

261 if((*
¬¿y2D
 = (
Lev–QuªtP¬ams
**è
	`mem_m®loc
(
dim0
 * (Lev–QuªtP¬ams*))è=ð
NULL
)

262 
	`no_mem_ex™
("get_mem2Dquant:‡rray2D");

263 if((*(*
¬¿y2D
èð(
Lev–QuªtP¬ams
* ) 
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(Lev–QuªtP¬am ))è=ð
NULL
)

264 
	`no_mem_ex™
("get_mem2Dquant:‡rray2D");

266 
i
 = 1 ; i < 
dim0
; i++)

267 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

269  
dim0
 * ((
Lev–QuªtP¬ams
*è+ 
dim1
 * (LevelQuantParams));

270 
	}
}

281 
	$g‘_mem3Dquªt
(
Lev–QuªtP¬ams
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

283 
i
, 
mem_size
 = 
dim0
 * (
Lev–QuªtP¬ams
**);

285 if(((*
¬¿y3D
èð(
Lev–QuªtP¬ams
***)
	`mem_m®loc
(
dim0
 * (Lev–QuªtP¬ams**))è=ð
NULL
)

286 
	`no_mem_ex™
("get_mem3Dquant:‡rray3D");

288 
mem_size
 +ð
	`g‘_mem2Dquªt
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

290 
i
 = 1; i < 
dim0
; i++)

291 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[˜- 1] + 
dim1
;

293  
mem_size
;

294 
	}
}

305 
	$g‘_mem4Dquªt
(
Lev–QuªtP¬ams
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

307 
i
, 
mem_size
 = 
dim0
 * (
Lev–QuªtP¬ams
***);

309 if(((*
¬¿y4D
èð(
Lev–QuªtP¬ams
****)
	`mem_m®loc
(
dim0
 * (Lev–QuªtP¬ams***))è=ð
NULL
)

310 
	`no_mem_ex™
("get_mem4Dquant:‡rray4D");

312 
mem_size
 +ð
	`g‘_mem3Dquªt
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

314 
i
 = 1; i < 
dim0
; i++)

315 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[˜- 1] + 
dim1
;

317  
mem_size
;

318 
	}
}

329 
	$g‘_mem5Dquªt
(
Lev–QuªtP¬ams
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
)

331 
i
, 
mem_size
 = 
dim0
 * (
Lev–QuªtP¬ams
***);

333 if(((*
¬¿y5D
èð(
Lev–QuªtP¬ams
*****)
	`mem_m®loc
(
dim0
 * (Lev–QuªtP¬ams****))è=ð
NULL
)

334 
	`no_mem_ex™
("get_mem5Dquant:‡rray5D");

336 
mem_size
 +ð
	`g‘_mem4Dquªt
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
);

338 
i
 = 1; i < 
dim0
; i++)

339 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[˜- 1] + 
dim1
;

341  
mem_size
;

342 
	}
}

353 
	$g‘_mem2Dwp
(
WPP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
)

355 
i
;

357 if((*
¬¿y2D
 = (
WPP¬ams
**)
	`mem_m®loc
(
dim0
 * (WPP¬ams*))è=ð
NULL
)

358 
	`no_mem_ex™
("get_mem2Dwp:‡rray2D");

359 if((*(*
¬¿y2D
èð(
WPP¬ams
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(WPP¬am ))è=ð
NULL
)

360 
	`no_mem_ex™
("get_mem2Dwp:‡rray2D");

362 
i
 = 1 ; i < 
dim0
; i++)

363 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

365  
dim0
 * ((
WPP¬ams
*è+ 
dim1
 * (WPParams));

366 
	}
}

375 
	$ä“_mem2Dwp
(
WPP¬ams
 **
¬¿y2D
)

377 ià(
¬¿y2D
)

379 ià(*
¬¿y2D
)

380 
	`mem_ä“
 (*
¬¿y2D
);

382 
	`”rÜ
 ("free_mem2Dwp:ryingo free unused memory",100);

384 
	`mem_ä“
 (
¬¿y2D
);

388 
	`”rÜ
 ("free_mem2Dwp:ryingo free unused memory",100);

390 
	}
}

399 
	$ä“_mem2Dquªt
(
Lev–QuªtP¬ams
 **
¬¿y2D
)

401 ià(
¬¿y2D
)

403 ià(*
¬¿y2D
)

404 
	`mem_ä“
 (*
¬¿y2D
);

406 
	`”rÜ
 ("free_mem2Dquant:ryingo free unused memory",100);

408 
	`mem_ä“
 (
¬¿y2D
);

412 
	`”rÜ
 ("free_mem2Dquant:ryingo free unused memory",100);

414 
	}
}

424 
	$ä“_mem3Dquªt
(
Lev–QuªtP¬ams
 ***
¬¿y3D
)

426 ià(
¬¿y3D
)

428 
	`ä“_mem2Dquªt
(*
¬¿y3D
);

429 
	`mem_ä“
 (
¬¿y3D
);

433 
	`”rÜ
 ("free_mem3Dquant:ryingo free unused memory",100);

435 
	}
}

444 
	$ä“_mem4Dquªt
(
Lev–QuªtP¬ams
 ****
¬¿y4D
)

446 ià(
¬¿y4D
)

448 
	`ä“_mem3Dquªt
(*
¬¿y4D
);

449 
	`mem_ä“
 (
¬¿y4D
);

453 
	`”rÜ
 ("free_mem4Dquant:ryingo free unused memory",100);

455 
	}
}

464 
	$ä“_mem5Dquªt
(
Lev–QuªtP¬ams
 *****
¬¿y5D
)

466 ià(
¬¿y5D
)

468 
	`ä“_mem4Dquªt
(*
¬¿y5D
);

469 
	`mem_ä“
 (
¬¿y5D
);

473 
	`”rÜ
 ("free_mem5Dquant:ryingo free unused memory",100);

475 
	}
}

486 
	$g‘_mem2D_¥p
(
StÜabËPiùu»PŒ
 ***
¬¿y2D
, 
dim0
, 
dim1
)

488 
i
;

490 if((*
¬¿y2D
 = (
StÜabËPiùu»PŒ
**)
	`mem_m®loc
(
dim0
 * (StÜabËPiùu»PŒ*))è=ð
NULL
)

491 
	`no_mem_ex™
("get_mem2D_spp:‡rray2D");

492 if((*(*
¬¿y2D
èð(
StÜabËPiùu»PŒ
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(StÜabËPiùu»PŒ ))è=ð
NULL
)

493 
	`no_mem_ex™
("get_mem2D_spp:‡rray2D");

495 
i
 = 1 ; i < 
dim0
; i++)

496 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

498  
dim0
 * ((
StÜabËPiùu»PŒ
*è+ 
dim1
 * (StorablePicturePtr));

499 
	}
}

510 
	$g‘_mem3D_¥p
(
StÜabËPiùu»PŒ
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

512 
i
, 
mem_size
 = 
dim0
 * (
StÜabËPiùu»PŒ
**);

514 if(((*
¬¿y3D
èð(
StÜabËPiùu»PŒ
***)
	`mem_m®loc
(
dim0
 * (StÜabËPiùu»PŒ**))è=ð
NULL
)

515 
	`no_mem_ex™
("get_mem3D_spp:‡rray3D");

517 
mem_size
 +ð
	`g‘_mem2D_¥p
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

519 
i
 = 1; i < 
dim0
; i++)

520 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[˜- 1] + 
dim1
;

522  
mem_size
;

523 
	}
}

533 
	$g‘_mem2Dmv
(
MÙiÚVeùÜ
 ***
¬¿y2D
, 
dim0
, 
dim1
)

535 
i
;

537 if((*
¬¿y2D
 = (
MÙiÚVeùÜ
**)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ*))è=ð
NULL
)

538 
	`no_mem_ex™
("get_mem2Dmv:‡rray2D");

539 if((*(*
¬¿y2D
èð(
MÙiÚVeùÜ
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(MÙiÚVeùÜ ))è=ð
NULL
)

540 
	`no_mem_ex™
("get_mem2Dmv:‡rray2D");

542 
i
 = 1 ; i < 
dim0
; i++)

543 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

545  
dim0
 * ((
MÙiÚVeùÜ
*è+ 
dim1
 * (MotionVector));

546 
	}
}

557 
	$g‘_mem3Dmv
(
MÙiÚVeùÜ
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

559 
i
, 
mem_size
 = 
dim0
 * (
MÙiÚVeùÜ
**);

561 if(((*
¬¿y3D
èð(
MÙiÚVeùÜ
***)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ**))è=ð
NULL
)

562 
	`no_mem_ex™
("get_mem3Dmv:‡rray3D");

564 
mem_size
 +ð
	`g‘_mem2Dmv
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

566 
i
 = 1; i < 
dim0
; i++)

567 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[˜- 1] + 
dim1
;

569  
mem_size
;

570 
	}
}

581 
	$g‘_mem4Dmv
(
MÙiÚVeùÜ
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

583 
i
, 
mem_size
 = 
dim0
 * (
MÙiÚVeùÜ
***);

585 if(((*
¬¿y4D
èð(
MÙiÚVeùÜ
****)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ***))è=ð
NULL
)

586 
	`no_mem_ex™
("get_mem4Dpel:‡rray4D");

588 
mem_size
 +ð
	`g‘_mem3Dmv
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

590 
i
 = 1; i < 
dim0
; i++)

591 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[˜- 1] + 
dim1
;

593  
mem_size
;

594 
	}
}

605 
	$g‘_mem5Dmv
(
MÙiÚVeùÜ
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
)

607 
i
, 
mem_size
 = 
dim0
 * (
MÙiÚVeùÜ
***);

609 if(((*
¬¿y5D
èð(
MÙiÚVeùÜ
*****)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ****))è=ð
NULL
)

610 
	`no_mem_ex™
("get_mem5Dmv:‡rray5D");

612 
mem_size
 +ð
	`g‘_mem4Dmv
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
);

614 
i
 = 1; i < 
dim0
; i++)

615 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[˜- 1] + 
dim1
;

617  
mem_size
;

618 
	}
}

629 
	$g‘_mem6Dmv
(
MÙiÚVeùÜ
 *******
¬¿y6D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
)

631 
i
, 
mem_size
 = 
dim0
 * (
MÙiÚVeùÜ
*****);

633 if(((*
¬¿y6D
èð(
MÙiÚVeùÜ
******)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ*****))è=ð
NULL
)

634 
	`no_mem_ex™
("get_mem6Dmv:‡rray6D");

636 
mem_size
 +ð
	`g‘_mem5Dmv
(*
¬¿y6D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
);

638 
i
 = 1; i < 
dim0
; i++)

639 (*
¬¿y6D
)[
i
] = (*¬¿y6D)[˜- 1] + 
dim1
;

641  
mem_size
;

642 
	}
}

653 
	$g‘_mem7Dmv
(
MÙiÚVeùÜ
 ********
¬¿y7D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
)

655 
i
, 
mem_size
 = 
dim0
 * (
MÙiÚVeùÜ
*****);

657 if(((*
¬¿y7D
èð(
MÙiÚVeùÜ
*******)
	`mem_m®loc
(
dim0
 * (MÙiÚVeùÜ******))è=ð
NULL
)

658 
	`no_mem_ex™
("get_mem7Dmv:‡rray7D");

660 
mem_size
 +ð
	`g‘_mem6Dmv
(*
¬¿y7D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
);

662 
i
 = 1; i < 
dim0
; i++)

663 (*
¬¿y7D
)[
i
] = (*¬¿y7D)[˜- 1] + 
dim1
;

665  
mem_size
;

666 
	}
}

676 
	$ä“_mem2D_¥p
(
StÜabËPiùu»PŒ
 **
¬¿y2D
)

678 ià(
¬¿y2D
)

680 ià(*
¬¿y2D
)

681 
	`mem_ä“
 (*
¬¿y2D
);

683 
	`”rÜ
 ("free_mem2D_spp:ryingo free unused memory",100);

685 
	`mem_ä“
 (
¬¿y2D
);

689 
	`”rÜ
 ("free_mem2D_spp:ryingo free unused memory",100);

691 
	}
}

701 
	$ä“_mem3D_¥p
(
StÜabËPiùu»PŒ
 ***
¬¿y3D
)

703 ià(
¬¿y3D
)

705 
	`ä“_mem2D_¥p
(*
¬¿y3D
);

706 
	`mem_ä“
 (
¬¿y3D
);

710 
	`”rÜ
 ("free_mem3D_spp:ryingo free unused memory",100);

712 
	}
}

722 
	$ä“_mem2Dmv
(
MÙiÚVeùÜ
 **
¬¿y2D
)

724 ià(
¬¿y2D
)

726 ià(*
¬¿y2D
)

727 
	`mem_ä“
 (*
¬¿y2D
);

729 
	`”rÜ
 ("free_mem2Dmv:ryingo free unused memory",100);

731 
	`mem_ä“
 (
¬¿y2D
);

735 
	`”rÜ
 ("free_mem2Dmv:ryingo free unused memory",100);

737 
	}
}

747 
	$ä“_mem3Dmv
(
MÙiÚVeùÜ
 ***
¬¿y3D
)

749 ià(
¬¿y3D
)

751 
	`ä“_mem2Dmv
(*
¬¿y3D
);

752 
	`mem_ä“
 (
¬¿y3D
);

756 
	`”rÜ
 ("free_mem3Dmv:ryingo free unused memory",100);

758 
	}
}

767 
	$ä“_mem4Dmv
(
MÙiÚVeùÜ
 ****
¬¿y4D
)

769 ià(
¬¿y4D
)

771 
	`ä“_mem3Dmv
(*
¬¿y4D
);

772 
	`mem_ä“
 (
¬¿y4D
);

776 
	`”rÜ
 ("free_mem4Dmv:ryingo free unused memory",100);

778 
	}
}

787 
	$ä“_mem5Dmv
(
MÙiÚVeùÜ
 *****
¬¿y5D
)

789 ià(
¬¿y5D
)

791 
	`ä“_mem4Dmv
(*
¬¿y5D
);

792 
	`mem_ä“
 (
¬¿y5D
);

796 
	`”rÜ
 ("free_mem5Dmv:ryingo free unused memory",100);

798 
	}
}

807 
	$ä“_mem6Dmv
(
MÙiÚVeùÜ
 ******
¬¿y6D
)

809 ià(
¬¿y6D
)

811 
	`ä“_mem5Dmv
(*
¬¿y6D
);

812 
	`mem_ä“
 (
¬¿y6D
);

816 
	`”rÜ
 ("free_mem6Dmv:ryingo free unused memory",100);

818 
	}
}

827 
	$ä“_mem7Dmv
(
MÙiÚVeùÜ
 *******
¬¿y7D
)

829 ià(
¬¿y7D
)

831 
	`ä“_mem6Dmv
(*
¬¿y7D
);

832 
	`mem_ä“
 (
¬¿y7D
);

836 
	`”rÜ
 ("free_mem7Dmv:ryingo free unused memory",100);

838 
	}
}

848 
	$g‘_mem1D³l
(
img³l
 **
¬¿y1D
, 
dim0
)

850 if((*
¬¿y1D
 = (
img³l
*)
	`mem_ÿÎoc
(
dim0
, (img³l))è=ð
NULL
)

851 
	`no_mem_ex™
("get_mem1Dpel:‡rray1D");

853  ((
img³l
*è+ 
dim0
 * (imgpel));

854 
	}
}

864 
	$g‘_mem2D³l
(
img³l
 ***
¬¿y2D
, 
dim0
, 
dim1
)

866 
i
;

868 if((*
¬¿y2D
 = (
img³l
**)
	`mem_m®loc
(
dim0
 * (img³l*))è=ð
NULL
)

869 
	`no_mem_ex™
("get_mem2Dpel:‡rray2D");

870 if((*(*
¬¿y2D
èð(
img³l
* )
	`mem_m®loc
(
dim0
 * 
dim1
 * (img³È))è=ð
NULL
)

871 
	`no_mem_ex™
("get_mem2Dpel:‡rray2D");

873 
i
 = 1 ; i < 
dim0
; i++)

875 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

878  
dim0
 * ((
img³l
*è+ 
dim1
 * (imgpel));

879 
	}
}

881 
	$g‘_mem2D³l_·d
(
img³l
 ***
¬¿y2D
, 
dim0
, 
dim1
, 
iPadY
, 
iPadX
)

883 
i
;

884 
img³l
 *
cu¼
 = 
NULL
;

885 
iHeight
, 
iWidth
;

887 
iHeight
 = 
dim0
+2*
iPadY
;

888 
iWidth
 = 
dim1
+2*
iPadX
;

889 if((*
¬¿y2D
 = (
img³l
**)
	`mem_m®loc
(
iHeight
*(img³l*))è=ð
NULL
)

890 
	`no_mem_ex™
("get_mem2Dpel_pad:‡rray2D");

891 if((*(*
¬¿y2D
èð(
img³l
* )
	`mem_ÿÎoc
(
iHeight
 * 
iWidth
, (img³È))è=ð
NULL
)

892 
	`no_mem_ex™
("get_mem2Dpel_pad:‡rray2D");

894 (*
¬¿y2D
)[0] +ð
iPadX
;

895 
cu¼
 = (*
¬¿y2D
)[0];

896 
i
 = 1 ; i < 
iHeight
; i++)

898 
cu¼
 +ð
iWidth
;

899 (*
¬¿y2D
)[
i
] = 
cu¼
;

901 (*
¬¿y2D
èð&((*¬¿y2D)[
iPadY
]);

903  
iHeight
 * ((
img³l
*è+ 
iWidth
 * (imgpel));

904 
	}
}

916 
	$g‘_mem3D³l
(
img³l
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

918 
i
, 
mem_size
 = 
dim0
 * (
img³l
**);

920 if(((*
¬¿y3D
èð(
img³l
***)
	`m®loc
(
dim0
 * (img³l**))è=ð
NULL
)

921 
	`no_mem_ex™
("get_mem3Dpel:‡rray3D");

923 
mem_size
 +ð
	`g‘_mem2D³l
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

925 
i
 = 1; i < 
dim0
; i++)

926 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[˜- 1] + 
dim1
;

928  
mem_size
;

929 
	}
}

931 
	$g‘_mem3D³l_·d
(
img³l
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
, 
iPadY
, 
iPadX
)

933 
i
, 
mem_size
 = 
dim0
 * (
img³l
**);

935 if(((*
¬¿y3D
èð(
img³l
***)
	`mem_m®loc
(
dim0
*(img³l**))è=ð
NULL
)

936 
	`no_mem_ex™
("get_mem3Dpel_pad:‡rray3D");

938 
i
 = 0; i < 
dim0
; i++)

939 
mem_size
 +ð
	`g‘_mem2D³l_·d
((*
¬¿y3D
)+
i
, 
dim1
, 
dim2
, 
iPadY
, 
iPadX
);

941  
mem_size
;

942 
	}
}

954 
	$g‘_mem4D³l
(
img³l
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

956 
i
, 
mem_size
 = 
dim0
 * (
img³l
***);

958 if(((*
¬¿y4D
èð(
img³l
****)
	`mem_m®loc
(
dim0
 * (img³l***))è=ð
NULL
)

959 
	`no_mem_ex™
("get_mem4Dpel:‡rray4D");

961 
mem_size
 +ð
	`g‘_mem3D³l
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

963 
i
 = 1; i < 
dim0
; i++)

964 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[˜- 1] + 
dim1
;

966  
mem_size
;

967 
	}
}

970 
	$g‘_mem4D³l_·d
(
img³l
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
iPadY
, 
iPadX
)

972 
i
, 
mem_size
 = 
dim0
 * (
img³l
***);

974 if(((*
¬¿y4D
èð(
img³l
****)
	`mem_m®loc
(
dim0
 * (img³l***))è=ð
NULL
)

975 
	`no_mem_ex™
("get_mem4Dpel_pad:‡rray4D");

977 
mem_size
 +ð
	`g‘_mem3D³l_·d
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
iPadY
, 
iPadX
);

979 
i
 = 1; i < 
dim0
; i++)

980 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[˜- 1] + 
dim1
;

982  
mem_size
;

983 
	}
}

994 
	$g‘_mem5D³l
(
img³l
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
)

996 
i
, 
mem_size
 = 
dim0
 * (
img³l
****);

998 if(((*
¬¿y5D
èð(
img³l
*****)
	`mem_m®loc
(
dim0
 * (img³l****))è=ð
NULL
)

999 
	`no_mem_ex™
("get_mem5Dpel:‡rray5D");

1001 
mem_size
 +ð
	`g‘_mem4D³l
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
);

1003 
i
 = 1; i < 
dim0
; i++)

1004 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[˜- 1] + 
dim1
;

1006  
mem_size
;

1007 
	}
}

1009 
	$g‘_mem5D³l_·d
(
img³l
 ******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
iPadY
, 
iPadX
)

1011 
i
, 
mem_size
 = 
dim0
 * (
img³l
****);

1013 if(((*
¬¿y5D
èð(
img³l
*****)
	`mem_m®loc
(
dim0
 * (img³l****))è=ð
NULL
)

1014 
	`no_mem_ex™
("get_mem5Dpel_pad:‡rray5D");

1016 
mem_size
 +ð
	`g‘_mem4D³l_·d
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
iPadY
, 
iPadX
);

1018 
i
 = 1; i < 
dim0
; i++)

1019 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[˜- 1] + 
dim1
;

1021  
mem_size
;

1022 
	}
}

1031 
	$ä“_mem1D³l
(
img³l
 *
¬¿y1D
)

1033 ià(
¬¿y1D
)

1035 
	`mem_ä“
 (
¬¿y1D
);

1039 
	`”rÜ
 ("free_mem1Dpel:ryingo free unused memory",100);

1041 
	}
}

1050 
	$ä“_mem2D³l
(
img³l
 **
¬¿y2D
)

1052 ià(
¬¿y2D
)

1054 ià(*
¬¿y2D
)

1055 
	`mem_ä“
 (*
¬¿y2D
);

1057 
	`”rÜ
 ("free_mem2Dpel:ryingo free unused memory",100);

1059 
	`mem_ä“
 (
¬¿y2D
);

1063 
	`”rÜ
 ("free_mem2Dpel:ryingo free unused memory",100);

1065 
	}
}

1067 
	$ä“_mem2D³l_·d
(
img³l
 **
¬¿y2D
, 
iPadY
, 
iPadX
)

1069 ià(
¬¿y2D
)

1071 ià(*
¬¿y2D
)

1073 
	`mem_ä“
 (
¬¿y2D
[-
iPadY
]-
iPadX
);

1076 
	`”rÜ
 ("free_mem2Dpel_pad:ryingo free unused memory",100);

1078 
	`mem_ä“
 (&
¬¿y2D
[-
iPadY
]);

1082 
	`”rÜ
 ("free_mem2Dpel_pad:ryingo free unused memory",100);

1084 
	}
}

1093 
	$ä“_mem3D³l
(
img³l
 ***
¬¿y3D
)

1095 ià(
¬¿y3D
)

1097 
	`ä“_mem2D³l
(*
¬¿y3D
);

1098 
	`mem_ä“
 (
¬¿y3D
);

1102 
	`”rÜ
 ("free_mem3Dpel:ryingo free unused memory",100);

1104 
	}
}

1106 
	$ä“_mem3D³l_·d
(
img³l
 ***
¬¿y3D
, 
iDim12
, 
iPadY
, 
iPadX
)

1108 ià(
¬¿y3D
)

1110 
i
;

1111 
i
=0; i<
iDim12
; i++)

1112 if(
¬¿y3D
[
i
])

1114 
	`ä“_mem2D³l_·d
(
¬¿y3D
[
i
], 
iPadY
, 
iPadX
);

1115 
¬¿y3D
[
i
] = 
NULL
;

1117 
	`mem_ä“
 (
¬¿y3D
);

1121 
	`”rÜ
 ("free_mem3Dpel_pad:ryingo free unused memory",100);

1124 
	}
}

1133 
	$ä“_mem4D³l
(
img³l
 ****
¬¿y4D
)

1135 ià(
¬¿y4D
)

1137 
	`ä“_mem3D³l
(*
¬¿y4D
);

1138 
	`mem_ä“
 (
¬¿y4D
);

1142 
	`”rÜ
 ("free_mem4Dpel:ryingo free unused memory",100);

1144 
	}
}

1146 
	$ä“_mem4D³l_·d
(
img³l
 ****
¬¿y4D
, 
iF¿mes
, 
iPadY
, 
iPadX
)

1148 ià(
¬¿y4D
)

1150 
	`ä“_mem3D³l_·d
(*
¬¿y4D
, 
iF¿mes
, 
iPadY
, 
iPadX
);

1151 
	`mem_ä“
 (
¬¿y4D
);

1155 
	`”rÜ
 ("free_mem4Dpel_pad:ryingo free unused memory",100);

1157 
	}
}

1166 
	$ä“_mem5D³l
(
img³l
 *****
¬¿y5D
)

1168 ià(
¬¿y5D
)

1170 
	`ä“_mem4D³l
(*
¬¿y5D
);

1171 
	`mem_ä“
 (
¬¿y5D
);

1175 
	`”rÜ
 ("free_mem5Dpel:ryingo free unused memory",100);

1177 
	}
}

1179 
	$ä“_mem5D³l_·d
(
img³l
 *****
¬¿y5D
, 
iF¿mes
, 
iPadY
, 
iPadX
)

1181 ià(
¬¿y5D
)

1183 
	`ä“_mem4D³l_·d
(*
¬¿y5D
, 
iF¿mes
, 
iPadY
, 
iPadX
);

1184 
	`mem_ä“
(
¬¿y5D
);

1188 
	`”rÜ
 ("free_mem5Dpel_pad:ryingo free unused memory",100);

1190 
	}
}

1201 
by‹
** 
	$Ãw_mem2D
(
dim0
, 
dim1
)

1203 
i
;

1204 
by‹
 **
¬¿y2D
;

1206 if(Ð
¬¿y2D
 = (
by‹
**)
	`mem_m®loc
(
dim0
 * (by‹*))è=ð
NULL
)

1207 
	`no_mem_ex™
("get_mem2D:‡rray2D");

1208 if((*(
¬¿y2D
èð(
by‹
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(by‹ ))è=ð
NULL
)

1209 
	`no_mem_ex™
("get_mem2D:‡rray2D");

1211 
i
 = 1; i < 
dim0
; i++)

1212 
¬¿y2D
[
i
] =‡¼ay2D[i-1] + 
dim1
;

1214  (
¬¿y2D
);

1215 
	}
}

1225 
	$g‘_mem2D
(
by‹
 ***
¬¿y2D
, 
dim0
, 
dim1
)

1227 
i
;

1229 if(Ð*
¬¿y2D
 = (
by‹
**)
	`mem_m®loc
(
dim0
 * (by‹*))è=ð
NULL
)

1230 
	`no_mem_ex™
("get_mem2D:‡rray2D");

1231 if((*(*
¬¿y2D
èð(
by‹
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(by‹ ))è=ð
NULL
)

1232 
	`no_mem_ex™
("get_mem2D:‡rray2D");

1234 
i
 = 1; i < 
dim0
; i++)

1235 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

1237  
dim0
 * ((
by‹
*è+ 
dim1
 * (byte));

1238 
	}
}

1250 ** 
	$Ãw_mem2Dšt
(
dim0
, 
dim1
)

1252 
i
;

1253 **
¬¿y2D
;

1255 if((
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

1256 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

1257 if((*(
¬¿y2D
èð(* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
, ())è=ð
NULL
)

1258 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

1260 
i
 = 1 ; i < 
dim0
; i++)

1261 (
¬¿y2D
)[
i
] = (¬¿y2D)[i-1] + 
dim1
;

1263  (
¬¿y2D
);

1264 
	}
}

1275 
	$g‘_mem2Dšt
(***
¬¿y2D
, 
dim0
, 
dim1
)

1277 
i
;

1279 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

1280 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

1281 if((*(*
¬¿y2D
èð(* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
, ())è=ð
NULL
)

1282 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

1284 
i
 = 1 ; i < 
dim0
; i++)

1285 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

1287  
dim0
 * ((*è+ 
dim1
 * ());

1288 
	}
}

1290 
	$g‘_mem2Dšt_·d
(***
¬¿y2D
, 
dim0
, 
dim1
, 
iPadY
, 
iPadX
)

1292 
i
;

1293 *
cu¼
 = 
NULL
;

1294 
iHeight
, 
iWidth
;

1296 
iHeight
 = 
dim0
+2*
iPadY
;

1297 
iWidth
 = 
dim1
+2*
iPadX
;

1298 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
iHeight
*(*))è=ð
NULL
)

1299 
	`no_mem_ex™
("get_mem2Dint_pad:‡rray2D");

1300 if((*(*
¬¿y2D
èð(* )
	`mem_ÿÎoc
(
iHeight
 * 
iWidth
, ())è=ð
NULL
)

1301 
	`no_mem_ex™
("get_mem2Dint_pad:‡rray2D");

1303 (*
¬¿y2D
)[0] +ð
iPadX
;

1304 
cu¼
 = (*
¬¿y2D
)[0];

1305 
i
 = 1 ; i < 
iHeight
; i++)

1307 
cu¼
 +ð
iWidth
;

1308 (*
¬¿y2D
)[
i
] = 
cu¼
;

1310 (*
¬¿y2D
èð&((*¬¿y2D)[
iPadY
]);

1312  
iHeight
 * ((*è+ 
iWidth
 * ());

1313 
	}
}

1324 
	$g‘_mem2Dšt64
(
št64
 ***
¬¿y2D
, 
dim0
, 
dim1
)

1326 
i
;

1328 if((*
¬¿y2D
 = (
št64
**)
	`mem_m®loc
(
dim0
 * (št64*))è=ð
NULL
)

1329 
	`no_mem_ex™
("get_mem2Dint64:‡rray2D");

1330 if((*(*
¬¿y2D
èð(
št64
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(št64 ))è=ð
NULL
)

1331 
	`no_mem_ex™
("get_mem2Dint64:‡rray2D");

1333 
i
 = 1; i < 
dim0
; i++)

1334 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

1336  
dim0
 * ((
št64
*è+ 
dim1
 * (int64));

1337 
	}
}

1348 
	$g‘_mem3D
(
by‹
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

1350 
i
, 
mem_size
 = 
dim0
 * (
by‹
**);

1352 if(((*
¬¿y3D
èð(
by‹
***)
	`mem_m®loc
(
dim0
 * (by‹**))è=ð
NULL
)

1353 
	`no_mem_ex™
("get_mem3D:‡rray3D");

1355 
mem_size
 +ð
	`g‘_mem2D
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1357 
i
 = 1; i < 
dim0
; i++)

1358 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
;

1360  
mem_size
;

1361 
	}
}

1372 
	$g‘_mem4D
(
by‹
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1374 
i
, 
mem_size
 = 
dim0
 * (
by‹
***);

1376 if(((*
¬¿y4D
èð(
by‹
****)
	`mem_m®loc
(
dim0
 * (by‹***))è=ð
NULL
)

1377 
	`no_mem_ex™
("get_mem4D:‡rray4D");

1379 
mem_size
 +ð
	`g‘_mem3D
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1381 
i
 = 1; i < 
dim0
; i++)

1382 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1384  
mem_size
;

1385 
	}
}

1396 
	$g‘_mem3Dšt
(****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

1398 
i
, 
mem_size
 = 
dim0
 * (**);

1400 if(((*
¬¿y3D
èð(***)
	`mem_m®loc
(
dim0
 * (**))è=ð
NULL
)

1401 
	`no_mem_ex™
("get_mem3Dint:‡rray3D");

1403 
mem_size
 +ð
	`g‘_mem2Dšt
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1405 
i
 = 1; i < 
dim0
; i++)

1406 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
;

1408  
mem_size
;

1409 
	}
}

1420 
	$g‘_mem3Dšt64
(
št64
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

1422 
i
, 
mem_size
 = 
dim0
 * (
št64
**);

1424 if(((*
¬¿y3D
èð(
št64
***)
	`mem_m®loc
(
dim0
 * (št64**))è=ð
NULL
)

1425 
	`no_mem_ex™
("get_mem3Dint64:‡rray3D");

1427 
mem_size
 +ð
	`g‘_mem2Dšt64
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1429 
i
 = 1; i < 
dim0
; i++)

1430 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
;

1432  
mem_size
;

1433 
	}
}

1435 
	$g‘_mem2Ddi¡blk
(
di¡blk
 ***
¬¿y2D
, 
dim0
, 
dim1
)

1437 
i
;

1439 if((*
¬¿y2D
 = (
di¡blk
**)
	`mem_m®loc
(
dim0
 * (di¡blk*))è=ð
NULL
)

1440 
	`no_mem_ex™
("get_mem2Ddistblk:‡rray2D");

1441 if((*(*
¬¿y2D
èð(
di¡blk
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(di¡blk ))è=ð
NULL
)

1442 
	`no_mem_ex™
("get_mem2Ddistblk:‡rray2D");

1444 
i
 = 1; i < 
dim0
; i++)

1445 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

1447  
dim0
 * ((
di¡blk
*è+ 
dim1
 * (distblk));

1448 
	}
}

1450 
	$g‘_mem3Ddi¡blk
(
di¡blk
 ****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
)

1452 
i
, 
mem_size
 = 
dim0
 * (
di¡blk
**);

1454 if(((*
¬¿y3D
èð(
di¡blk
***)
	`mem_m®loc
(
dim0
 * (di¡blk**))è=ð
NULL
)

1455 
	`no_mem_ex™
("get_mem3Ddistblk:‡rray3D");

1457 
mem_size
 +ð
	`g‘_mem2Ddi¡blk
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1459 
i
 = 1; i < 
dim0
; i++)

1460 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
;

1462  
mem_size
;

1463 
	}
}

1465 
	$g‘_mem4Ddi¡blk
(
di¡blk
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1467 
i
, 
mem_size
 = 
dim0
 * (
di¡blk
***);

1469 if(((*
¬¿y4D
èð(
di¡blk
****)
	`mem_m®loc
(
dim0
 * (di¡blk***))è=ð
NULL
)

1470 
	`no_mem_ex™
("get_mem4Ddistblk:‡rray4D");

1472 
mem_size
 +ð
	`g‘_mem3Ddi¡blk
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1474 
i
 = 1; i < 
dim0
; i++)

1475 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1477  
mem_size
;

1478 
	}
}

1488 
	$g‘_mem4Dšt
(*****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1490 
i
, 
mem_size
 = 
dim0
 * (***);

1492 if(((*
¬¿y4D
èð(****)
	`mem_m®loc
(
dim0
 * (***))è=ð
NULL
)

1493 
	`no_mem_ex™
("get_mem4Dint:‡rray4D");

1495 
mem_size
 +ð
	`g‘_mem3Dšt
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1497 
i
 = 1; i < 
dim0
; i++)

1498 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1500  
mem_size
;

1501 
	}
}

1503 
	$g‘_mem4Dšt64
(
št64
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1505 
i
, 
mem_size
 = 
dim0
 * (
št64
***);

1507 if(((*
¬¿y4D
èð(
št64
****)
	`mem_m®loc
(
dim0
 * (št64***))è=ð
NULL
)

1508 
	`no_mem_ex™
("get_mem4Dint64:‡rray4D");

1510 
mem_size
 +ð
	`g‘_mem3Dšt64
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1512 
i
 = 1; i < 
dim0
; i++)

1513 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1515  
mem_size
;

1516 
	}
}

1527 
	$g‘_mem5Dšt
(******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
)

1529 
i
, 
mem_size
 = 
dim0
 * (****);

1531 if(((*
¬¿y5D
èð(*****)
	`mem_m®loc
(
dim0
 * (****))è=ð
NULL
)

1532 
	`no_mem_ex™
("get_mem5Dint:‡rray5D");

1534 
mem_size
 +ð
	`g‘_mem4Dšt
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
);

1536 
i
 = 1; i < 
dim0
; i++)

1537 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[i-1] + 
dim1
;

1539  
mem_size
;

1540 
	}
}

1550 
	$ä“_mem2D
(
by‹
 **
¬¿y2D
)

1552 ià(
¬¿y2D
)

1554 ià(*
¬¿y2D
)

1555 
	`mem_ä“
 (*
¬¿y2D
);

1557 
	`”rÜ
 ("free_mem2D:ryingo free unused memory",100);

1559 
	`mem_ä“
 (
¬¿y2D
);

1563 
	`”rÜ
 ("free_mem2D:ryingo free unused memory",100);

1565 
	}
}

1574 
	$ä“_mem2Dšt
(**
¬¿y2D
)

1576 ià(
¬¿y2D
)

1578 ià(*
¬¿y2D
)

1579 
	`mem_ä“
 (*
¬¿y2D
);

1581 
	`”rÜ
 ("free_mem2Dint:ryingo free unused memory",100);

1583 
	`mem_ä“
 (
¬¿y2D
);

1587 
	`”rÜ
 ("free_mem2Dint:ryingo free unused memory",100);

1589 
	}
}

1591 
	$ä“_mem2Dšt_·d
(**
¬¿y2D
, 
iPadY
, 
iPadX
)

1593 ià(
¬¿y2D
)

1595 ià(*
¬¿y2D
)

1596 
	`mem_ä“
 (
¬¿y2D
[-
iPadY
]-
iPadX
);

1598 
	`”rÜ
 ("free_mem2Dint_pad:ryingo free unused memory",100);

1600 
	`mem_ä“
 (&
¬¿y2D
[-
iPadY
]);

1604 
	`”rÜ
 ("free_mem2Dint_pad:ryingo free unused memory",100);

1606 
	}
}

1615 
	$ä“_mem2Dšt64
(
št64
 **
¬¿y2D
)

1617 ià(
¬¿y2D
)

1619 ià(*
¬¿y2D
)

1620 
	`mem_ä“
 (*
¬¿y2D
);

1622 
	`”rÜ
 ("free_mem2Dint64:ryingo free unused memory",100);

1623 
	`mem_ä“
 (
¬¿y2D
);

1627 
	`”rÜ
 ("free_mem2Dint64:ryingo free unused memory",100);

1629 
	}
}

1639 
	$ä“_mem3D
(
by‹
 ***
¬¿y3D
)

1641 ià(
¬¿y3D
)

1643 
	`ä“_mem2D
(*
¬¿y3D
);

1644 
	`mem_ä“
 (
¬¿y3D
);

1648 
	`”rÜ
 ("free_mem3D:ryingo free unused memory",100);

1650 
	}
}

1659 
	$ä“_mem4D
(
by‹
 ****
¬¿y4D
)

1661 ià(
¬¿y4D
)

1663 
	`ä“_mem3D
(*
¬¿y4D
);

1664 
	`mem_ä“
 (
¬¿y4D
);

1668 
	`”rÜ
 ("free_mem4D:ryingo free unused memory",100);

1670 
	}
}

1679 
	$ä“_mem3Dšt
(***
¬¿y3D
)

1681 ià(
¬¿y3D
)

1683 
	`ä“_mem2Dšt
(*
¬¿y3D
);

1684 
	`mem_ä“
 (
¬¿y3D
);

1688 
	`”rÜ
 ("free_mem3Dint:ryingo free unused memory",100);

1690 
	}
}

1700 
	$ä“_mem3Dšt64
(
št64
 ***
¬¿y3D
)

1702 ià(
¬¿y3D
)

1704 
	`ä“_mem2Dšt64
(*
¬¿y3D
);

1705 
	`mem_ä“
 (
¬¿y3D
);

1709 
	`”rÜ
 ("free_mem3Dint64:ryingo free unused memory",100);

1711 
	}
}

1713 
	$ä“_mem3Ddi¡blk
(
di¡blk
 ***
¬¿y3D
)

1715 ià(
¬¿y3D
)

1717 
	`ä“_mem2Ddi¡blk
(*
¬¿y3D
);

1718 
	`mem_ä“
 (
¬¿y3D
);

1722 
	`”rÜ
 ("free_mem3Ddistblk:ryingo free unused memory",100);

1724 
	}
}

1733 
	$ä“_mem4Dšt
(****
¬¿y4D
)

1735 ià(
¬¿y4D
)

1737 
	`ä“_mem3Dšt
Ð*
¬¿y4D
);

1738 
	`mem_ä“
 (
¬¿y4D
);

1741 
	`”rÜ
 ("free_mem4Dint:ryingo free unused memory",100);

1743 
	}
}

1745 
	$ä“_mem4Dšt64
(
št64
 ****
¬¿y4D
)

1747 ià(
¬¿y4D
)

1749 
	`ä“_mem3Dšt64
Ð*
¬¿y4D
);

1750 
	`mem_ä“
 (
¬¿y4D
);

1753 
	`”rÜ
 ("free_mem4Dint64:ryingo free unused memory",100);

1755 
	}
}

1757 
	$ä“_mem4Ddi¡blk
(
di¡blk
 ****
¬¿y4D
)

1759 ià(
¬¿y4D
)

1761 
	`ä“_mem3Ddi¡blk
Ð*
¬¿y4D
);

1762 
	`mem_ä“
 (
¬¿y4D
);

1765 
	`”rÜ
 ("free_mem4Ddistblk:ryingo free unused memory",100);

1767 
	}
}

1776 
	$ä“_mem5Dšt
(*****
¬¿y5D
)

1778 ià(
¬¿y5D
)

1780 
	`ä“_mem4Dšt
Ð*
¬¿y5D
);

1781 
	`mem_ä“
 (
¬¿y5D
);

1784 
	`”rÜ
 ("free_mem5Dint:ryingo free unused memory",100);

1786 
	}
}

1796 
	$no_mem_ex™
(*
wh”e
)

1798 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Could‚Ù‡Îoÿ‹ memÜy: %s",
wh”e
);

1799 
	`”rÜ
 (
”rÜ‹xt
, 100);

1800 
	}
}

1812 
ušt16
** 
	$Ãw_mem2Dušt16
(
dim0
, 
dim1
)

1814 
i
;

1815 
ušt16
 **
¬¿y2D
;

1817 if(Ð
¬¿y2D
 = (
ušt16
**)
	`mem_m®loc
(
dim0
 * (ušt16*))è=ð
NULL
)

1818 
	`no_mem_ex™
("get_mem2Duint16:‡rray2D");

1819 if((*
¬¿y2D
 = (
ušt16
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(ušt16 ))è=ð
NULL
)

1820 
	`no_mem_ex™
("get_mem2Duint16:‡rray2D");

1822 
i
 = 1; i < 
dim0
; i++)

1823 
¬¿y2D
[
i
] =‡¼ay2D[i-1] + 
dim1
;

1825  (
¬¿y2D
);

1826 
	}
}

1837 
	$g‘_mem2Dušt16
(
ušt16
 ***
¬¿y2D
, 
dim0
, 
dim1
)

1839 
i
;

1841 if(Ð*
¬¿y2D
 = (
ušt16
**)
	`mem_m®loc
(
dim0
 * (ušt16*))è=ð
NULL
)

1842 
	`no_mem_ex™
("get_mem2Duint16:‡rray2D");

1844 if((*(*
¬¿y2D
èð(
ušt16
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(ušt16 ))è=ð
NULL
)

1845 
	`no_mem_ex™
("get_mem2Duint16:‡rray2D");

1847 
i
 = 1; i < 
dim0
; i++)

1848 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

1850  
dim0
 * ((
ušt16
*è+ 
dim1
 * (uint16));

1851 
	}
}

1862 
	$g‘_mem3Dušt16
(
ušt16
 ****
¬¿y3D
,
dim0
, 
dim1
, 
dim2
)

1864 
i
, 
mem_size
 = 
dim0
 * (
ušt16
**);

1866 if(((*
¬¿y3D
èð(
ušt16
***)
	`mem_m®loc
(
dim0
 * (ušt16**))è=ð
NULL
)

1867 
	`no_mem_ex™
("get_mem3Duint16:‡rray3D");

1869 
mem_size
 +ð
	`g‘_mem2Dušt16
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1871 
i
 = 1; i < 
dim0
; i++)

1872 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
;

1874  
mem_size
;

1875 
	}
}

1887 
	$g‘_mem4Dušt16
(
ušt16
 *****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1889 
i
, 
mem_size
 = 
dim0
 * (
ušt16
***);

1891 if(((*
¬¿y4D
èð(
ušt16
****)
	`mem_m®loc
(
dim0
 * (ušt16***))è=ð
NULL
)

1892 
	`no_mem_ex™
("get_mem4Duint16:‡rray4D");

1894 
mem_size
 +ð
	`g‘_mem3Dušt16
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1896 
i
 = 1; i < 
dim0
; i++)

1897 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1899  
mem_size
;

1900 
	}
}

1911 
	$g‘_mem2DshÜt
(***
¬¿y2D
, 
dim0
, 
dim1
)

1913 
i
;

1914 *
cu¼
 = 
NULL
;

1916 if(Ð*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

1917 
	`no_mem_ex™
("get_mem2Dshort:‡rray2D");

1918 if((*(*
¬¿y2D
èð(* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,())è=ð
NULL
)

1919 
	`no_mem_ex™
("get_mem2Dshort:‡rray2D");

1921 
cu¼
 = (*
¬¿y2D
)[0];

1922 
i
 = 1; i < 
dim0
; i++)

1924 
cu¼
 +ð
dim1
;

1925 (*
¬¿y2D
)[
i
] = 
cu¼
;

1928  
dim0
 * ((*è+ 
dim1
 * ());

1929 
	}
}

1940 
	$g‘_mem3DshÜt
(****
¬¿y3D
,
dim0
, 
dim1
, 
dim2
)

1942 
i
, 
mem_size
 = 
dim0
 * (**);

1943 **
cu¼
 = 
NULL
;

1945 if(((*
¬¿y3D
èð(***)
	`mem_m®loc
(
dim0
 * (**))è=ð
NULL
)

1946 
	`no_mem_ex™
("get_mem3Dshort:‡rray3D");

1948 
mem_size
 +ð
	`g‘_mem2DshÜt
(*
¬¿y3D
, 
dim0
 * 
dim1
, 
dim2
);

1950 
cu¼
 = (*
¬¿y3D
)[0];

1951 
i
 = 1; i < 
dim0
; i++)

1953 
cu¼
 +ð
dim1
;

1954 (*
¬¿y3D
)[
i
] = 
cu¼
;

1957  
mem_size
;

1958 
	}
}

1970 
	$g‘_mem4DshÜt
(*****
¬¿y4D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
)

1972 
i
, 
mem_size
 = 
dim0
 * (***);

1974 if(((*
¬¿y4D
èð(****)
	`mem_m®loc
(
dim0
 * (***))è=ð
NULL
)

1975 
	`no_mem_ex™
("get_mem4Dshort:‡rray4D");

1977 
mem_size
 +ð
	`g‘_mem3DshÜt
(*
¬¿y4D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
);

1979 
i
 = 1; i < 
dim0
; i++)

1980 (*
¬¿y4D
)[
i
] = (*¬¿y4D)[i-1] + 
dim1
;

1982  
mem_size
;

1983 
	}
}

1994 
	$g‘_mem5DshÜt
(******
¬¿y5D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
)

1996 
i
, 
mem_size
 = 
dim0
 * (****);

1998 if(((*
¬¿y5D
èð(*****)
	`mem_m®loc
(
dim0
 * (****))è=ð
NULL
)

1999 
	`no_mem_ex™
("get_mem5Dshort:‡rray5D");

2001 
mem_size
 +ð
	`g‘_mem4DshÜt
(*
¬¿y5D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
);

2003 
i
 = 1; i < 
dim0
; i++)

2004 (*
¬¿y5D
)[
i
] = (*¬¿y5D)[i-1] + 
dim1
;

2006  
mem_size
;

2007 
	}
}

2018 
	$g‘_mem6DshÜt
(*******
¬¿y6D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
)

2020 
i
, 
mem_size
 = 
dim0
 * (*****);

2022 if(((*
¬¿y6D
èð(******)
	`mem_m®loc
(
dim0
 * (*****))è=ð
NULL
)

2023 
	`no_mem_ex™
("get_mem6Dshort:‡rray6D");

2025 
mem_size
 +ð
	`g‘_mem5DshÜt
(*
¬¿y6D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
);

2027 
i
 = 1; i < 
dim0
; i++)

2028 (*
¬¿y6D
)[
i
] = (*¬¿y6D)[i-1] + 
dim1
;

2030  
mem_size
;

2031 
	}
}

2042 
	$g‘_mem7DshÜt
(********
¬¿y7D
, 
dim0
, 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
)

2044 
i
, 
mem_size
 = 
dim0
 * (******);

2046 if(((*
¬¿y7D
èð(*******)
	`mem_m®loc
(
dim0
 * (******))è=ð
NULL
)

2047 
	`no_mem_ex™
("get_mem7Dshort:‡rray7D");

2049 
mem_size
 +ð
	`g‘_mem6DshÜt
(*
¬¿y7D
, 
dim0
 * 
dim1
, 
dim2
, 
dim3
, 
dim4
, 
dim5
, 
dim6
);

2051 
i
 = 1; i < 
dim0
; i++)

2052 (*
¬¿y7D
)[
i
] = (*¬¿y7D)[i-1] + 
dim1
;

2054  
mem_size
;

2055 
	}
}

2064 
	$ä“_mem2Dušt16
(
ušt16
 **
¬¿y2D
)

2066 ià(
¬¿y2D
)

2068 ià(*
¬¿y2D
)

2069 
	`mem_ä“
 (*
¬¿y2D
);

2070 
	`”rÜ
 ("free_mem2Duint16:ryingo free unused memory",100);

2072 
	`mem_ä“
 (
¬¿y2D
);

2076 
	`”rÜ
 ("free_mem2Duint16:ryingo free unused memory",100);

2078 
	}
}

2087 
	$ä“_mem3Dušt16
(
ušt16
 ***
¬¿y3D
)

2089 ià(
¬¿y3D
)

2091 
	`ä“_mem2Dušt16
(*
¬¿y3D
);

2092 
	`mem_ä“
 (
¬¿y3D
);

2096 
	`”rÜ
 ("free_mem3Duint16:ryingo free unused memory",100);

2098 
	}
}

2107 
	$ä“_mem4Dušt16
(
ušt16
 ****
¬¿y4D
)

2109 ià(
¬¿y4D
)

2111 
	`ä“_mem3Dušt16
Ð*
¬¿y4D
);

2112 
	`mem_ä“
 (
¬¿y4D
);

2116 
	`”rÜ
 ("free_mem4Duint16:ryingo free unused memory",100);

2118 
	}
}

2127 
	$ä“_mem2DshÜt
(**
¬¿y2D
)

2129 ià(
¬¿y2D
)

2131 ià(*
¬¿y2D
)

2132 
	`mem_ä“
 (*
¬¿y2D
);

2133 
	`”rÜ
 ("free_mem2Dshort:ryingo free unused memory",100);

2135 
	`mem_ä“
 (
¬¿y2D
);

2139 
	`”rÜ
 ("free_mem2Dshort:ryingo free unused memory",100);

2141 
	}
}

2150 
	$ä“_mem3DshÜt
(***
¬¿y3D
)

2152 ià(
¬¿y3D
)

2154 
	`ä“_mem2DshÜt
(*
¬¿y3D
);

2155 
	`mem_ä“
 (
¬¿y3D
);

2159 
	`”rÜ
 ("free_mem3Dshort:ryingo free unused memory",100);

2161 
	}
}

2170 
	$ä“_mem4DshÜt
(****
¬¿y4D
)

2172 ià(
¬¿y4D
)

2174 
	`ä“_mem3DshÜt
Ð*
¬¿y4D
);

2175 
	`mem_ä“
 (
¬¿y4D
);

2179 
	`”rÜ
 ("free_mem4Dshort:ryingo free unused memory",100);

2181 
	}
}

2190 
	$ä“_mem5DshÜt
(*****
¬¿y5D
)

2192 ià(
¬¿y5D
)

2194 
	`ä“_mem4DshÜt
Ð*
¬¿y5D
) ;

2195 
	`mem_ä“
 (
¬¿y5D
);

2199 
	`”rÜ
 ("free_mem5Dshort:ryingo free unused memory",100);

2201 
	}
}

2210 
	$ä“_mem6DshÜt
(******
¬¿y6D
)

2212 ià(
¬¿y6D
)

2214 
	`ä“_mem5DshÜt
Ð*
¬¿y6D
);

2215 
	`mem_ä“
 (
¬¿y6D
);

2219 
	`”rÜ
 ("free_mem6Dshort:ryingo free unused memory",100);

2221 
	}
}

2230 
	$ä“_mem7DshÜt
(*******
¬¿y7D
)

2232 ià(
¬¿y7D
)

2234 
	`ä“_mem6DshÜt
Ð*
¬¿y7D
);

2235 
	`mem_ä“
 (
¬¿y7D
);

2239 
	`”rÜ
 ("free_mem7Dshort:ryingo free unused memory",100);

2241 
	}
}

2252 
	$g‘_mem2DdoubË
(***
¬¿y2D
, 
dim0
, 
dim1
)

2254 
i
;

2256 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

2257 
	`no_mem_ex™
("get_mem2Ddouble:‡rray2D");

2259 if(((*
¬¿y2D
)[0] = (* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
, ())è=ð
NULL
)

2260 
	`no_mem_ex™
("get_mem2Ddouble:‡rray2D");

2262 
i
=1 ; i<
dim0
 ; i++)

2263 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
 ;

2265  
dim0
 * ((*è+ 
dim1
 * ());

2266 
	}
}

2278 
	$g‘_mem1DodoubË
(**
¬¿y1D
, 
dim0
, 
off£t
)

2280 if((*
¬¿y1D
 = (*)
	`mem_ÿÎoc
(
dim0
, ())è=ð
NULL
)

2281 
	`no_mem_ex™
("get_mem1Dodouble:‡rray2D");

2283 *
¬¿y1D
 +ð
off£t
;

2285  
dim0
 * ();

2286 
	}
}

2298 
	$g‘_mem2DodoubË
(***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
)

2300 
i
;

2302 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

2303 
	`no_mem_ex™
("get_mem2Dodouble:‡rray2D");

2304 if(((*
¬¿y2D
)[0] = (* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,())è=ð
NULL
)

2305 
	`no_mem_ex™
("get_mem2Dodouble:‡rray2D");

2307 (*
¬¿y2D
)[0] +ð
off£t
;

2309 
i
=1 ; i<
dim0
 ; i++)

2310 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
 ;

2312  
dim0
 * ((*è+ 
dim1
 * ());

2313 
	}
}

2324 
	$g‘_mem3DodoubË
(****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
, 
off£t
)

2326 
i
,
j
;

2328 if(((*
¬¿y3D
èð(***)
	`mem_m®loc
(
dim0
 * (**))è=ð
NULL
)

2329 
	`no_mem_ex™
("get_mem3Dodouble:‡rray3D");

2331 if(((*
¬¿y3D
)[0] = (** )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(*))è=ð
NULL
)

2332 
	`no_mem_ex™
("get_mem3Dodouble:‡rray3D");

2334 (*
¬¿y3D
è[0] +ð
off£t
;

2336 
i
=1 ; i<
dim0
 ; i++)

2337 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
 ;

2339 
i
 = 0; i < 
dim0
; i++)

2340 
j
 = -
off£t
; j < 
dim1
 - offset; j++)

2341 if(((*
¬¿y3D
)[
i
][
j
] = (* )
	`mem_ÿÎoc
(
dim2
, ())è=ð
NULL
)

2342 
	`no_mem_ex™
("get_mem3Dodouble:‡rray3D");

2344  
dim0
*Ð(**è+ 
dim1
 * ( (*è+ 
dim2
 * ()));

2345 
	}
}

2358 
	$g‘_off£t_mem2DshÜt
(***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t_y
, 
off£t_x
)

2360 
i
;

2362 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

2363 
	`no_mem_ex™
("get_offset_mem2Dshort:‡rray2D");

2365 if(((*
¬¿y2D
)[0] = (* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,())è=ð
NULL
)

2366 
	`no_mem_ex™
("get_offset_mem2Dshort:‡rray2D");

2367 (*
¬¿y2D
)[0] +ð
off£t_x
 + 
off£t_y
 * 
dim1
;

2369 
i
=-1 ; i > -
off£t_y
 - 1; i--)

2371 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i+1] - 
dim1
;

2374 
i
=1 ; i < 
dim1
 - 
off£t_y
; i++)

2375 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
;

2377  
dim0
 * ((*è+ 
dim1
 * ());

2378 
	}
}

2389 
	$g‘_mem3Došt
(****
¬¿y3D
, 
dim0
, 
dim1
, 
dim2
, 
off£t
)

2391 
i
,
j
;

2393 if(((*
¬¿y3D
èð(***)
	`mem_m®loc
(
dim0
 * (**))è=ð
NULL
)

2394 
	`no_mem_ex™
("get_mem3Doint:‡rray3D");

2396 if(((*
¬¿y3D
)[0] = (** )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,(*))è=ð
NULL
)

2397 
	`no_mem_ex™
("get_mem3Doint:‡rray3D");

2399 (*
¬¿y3D
è[0] +ð
off£t
;

2401 
i
=1 ; i<
dim0
 ; i++)

2402 (*
¬¿y3D
)[
i
] = (*¬¿y3D)[i-1] + 
dim1
 ;

2404 
i
 = 0; i < 
dim0
; i++)

2405 
j
 = -
off£t
; j < 
dim1
 - offset; j++)

2406 if(((*
¬¿y3D
)[
i
][
j
] = (* )
	`mem_ÿÎoc
(
dim2
,())è=ð
NULL
)

2407 
	`no_mem_ex™
("get_mem3Doint:‡rray3D");

2409  
dim0
 * ((**è+ 
dim1
 * ((*è+ 
dim2
 * ()));

2410 
	}
}

2422 
	$g‘_mem2Došt
(***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
)

2424 
i
;

2426 if((*
¬¿y2D
 = (**)
	`mem_m®loc
(
dim0
 * (*))è=ð
NULL
)

2427 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

2428 if(((*
¬¿y2D
)[0] = (* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
,())è=ð
NULL
)

2429 
	`no_mem_ex™
("get_mem2Dint:‡rray2D");

2431 (*
¬¿y2D
)[0] +ð
off£t
;

2433 
i
=1 ; i<
dim0
 ; i++)

2434 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
 ;

2436  
dim0
 * ((*è+ 
dim1
 * ());

2437 
	}
}

2447 
	$ä“_mem2DdoubË
(**
¬¿y2D
)

2449 ià(
¬¿y2D
)

2451 ià(*
¬¿y2D
)

2452 
	`mem_ä“
 (*
¬¿y2D
);

2454 
	`”rÜ
 ("free_mem2Ddouble:ryingo free unused memory",100);

2456 
	`mem_ä“
 (
¬¿y2D
);

2461 
	`”rÜ
 ("free_mem2Ddouble:ryingo free unused memory",100);

2463 
	}
}

2472 
	$ä“_mem1DodoubË
(*
¬¿y1D
, 
off£t
)

2474 ià(
¬¿y1D
)

2476 
¬¿y1D
 -ð
off£t
;

2477 
	`mem_ä“
 (
¬¿y1D
);

2481 
	`”rÜ
 ("free_mem1Dodouble:ryingo free unused memory",100);

2483 
	}
}

2493 
	$ä“_mem2DodoubË
(**
¬¿y2D
, 
off£t
)

2495 ià(
¬¿y2D
)

2497 
¬¿y2D
[0] -ð
off£t
;

2498 ià(
¬¿y2D
[0])

2499 
	`mem_ä“
 (
¬¿y2D
[0]);

2500 
	`”rÜ
 ("free_mem2Dodouble:ryingo free unused memory",100);

2502 
	`mem_ä“
 (
¬¿y2D
);

2506 
	`”rÜ
 ("free_mem2Dodouble:ryingo free unused memory",100);

2508 
	}
}

2516 
	$ä“_mem3DodoubË
(***
¬¿y3D
, 
dim0
, 
dim1
, 
off£t
)

2518 
i
, 
j
;

2520 ià(
¬¿y3D
)

2522 
i
 = 0; i < 
dim0
; i++)

2524 
j
 = -
off£t
; j < 
dim1
 - offset; j++)

2526 ià(
¬¿y3D
[
i
][
j
])

2527 
	`mem_ä“
 (
¬¿y3D
[
i
][
j
]);

2529 
	`”rÜ
 ("free_mem3Dodouble:ryingo free unused memory",100);

2532 
¬¿y3D
[0] -ð
off£t
;

2533 ià(
¬¿y3D
[0])

2534 
	`mem_ä“
 (
¬¿y3D
[0]);

2536 
	`”rÜ
 ("free_mem3Dodouble:ryingo free unused memory",100);

2537 
	`mem_ä“
 (
¬¿y3D
);

2541 
	`”rÜ
 ("free_mem3Dodouble:ryingo free unused memory",100);

2543 
	}
}

2551 
	$ä“_mem3Došt
(***
¬¿y3D
, 
dim0
, 
dim1
, 
off£t
)

2553 
i
, 
j
;

2555 ià(
¬¿y3D
)

2557 
i
 = 0; i < 
dim0
; i++)

2559 
j
 = -
off£t
; j < 
dim1
 - offset; j++)

2561 ià(
¬¿y3D
[
i
][
j
])

2562 
	`mem_ä“
 (
¬¿y3D
[
i
][
j
]);

2564 
	`”rÜ
 ("free_mem3Doint:ryingo free unused memory",100);

2567 
¬¿y3D
[0] -ð
off£t
;

2568 ià(
¬¿y3D
[0])

2569 
	`mem_ä“
 (
¬¿y3D
[0]);

2571 
	`”rÜ
 ("free_mem3Doint:ryingo free unused memory",100);

2572 
	`mem_ä“
 (
¬¿y3D
);

2576 
	`”rÜ
 ("free_mem3Doint:ryingo free unused memory",100);

2578 
	}
}

2588 
	$ä“_mem2Došt
(**
¬¿y2D
, 
off£t
)

2590 ià(
¬¿y2D
)

2592 
¬¿y2D
[0] -ð
off£t
;

2593 ià(
¬¿y2D
[0])

2594 
	`mem_ä“
 (
¬¿y2D
[0]);

2596 
	`”rÜ
 ("free_mem2Doint:ryingo free unused memory",100);

2598 
	`mem_ä“
 (
¬¿y2D
);

2603 
	`”rÜ
 ("free_mem2Doint:ryingo free unused memory",100);

2605 
	}
}

2614 
	$ä“_off£t_mem2DshÜt
(**
¬¿y2D
, 
dim1
, 
off£t_y
, 
off£t_x
)

2616 ià(
¬¿y2D
)

2618 
¬¿y2D
[0] -ð
off£t_x
 + 
off£t_y
 * 
dim1
;

2619 ià(
¬¿y2D
[0])

2620 
	`mem_ä“
 (
¬¿y2D
[0]);

2622 
	`”rÜ
 ("free_offset_mem2Dshort:ryingo free unused memory",100);

2624 
	`mem_ä“
 (
¬¿y2D
);

2629 
	`”rÜ
 ("free_offset_mem2Dshort:ryingo free unused memory",100);

2631 
	}
}

2640 
	$ä“_mem3DdoubË
(***
¬¿y3D
)

2642 ià(
¬¿y3D
)

2644 
	`ä“_mem2DdoubË
(*
¬¿y3D
);

2645 
	`mem_ä“
 (
¬¿y3D
);

2649 
	`”rÜ
 ("free_mem3D:ryingo free unused memory",100);

2651 
	}
}

2664 
	$g‘_mem2DÞm
(
LambdaP¬ams
 ***
¬¿y2D
, 
dim0
, 
dim1
, 
off£t
)

2666 
i
;

2668 if((*
¬¿y2D
 = (
LambdaP¬ams
**)
	`mem_m®loc
(
dim0
 * (LambdaP¬ams*))è=ð
NULL
)

2669 
	`no_mem_ex™
("get_mem2Dolm:‡rray2D");

2670 if(((*
¬¿y2D
)[0] = (
LambdaP¬ams
* )
	`mem_ÿÎoc
(
dim0
 * 
dim1
, (LambdaP¬ams))è=ð
NULL
)

2671 
	`no_mem_ex™
("get_mem2Dolm:‡rray2D");

2673 (*
¬¿y2D
)[0] +ð
off£t
;

2675 
i
=1 ; i<
dim0
 ; i++)

2676 (*
¬¿y2D
)[
i
] = (*¬¿y2D)[i-1] + 
dim1
 ;

2678  
dim0
 * ((
LambdaP¬ams
*è+ 
dim1
 * (LambdaParams));

2679 
	}
}

2689 
	$ä“_mem2DÞm
(
LambdaP¬ams
 **
¬¿y2D
, 
off£t
)

2691 ià(
¬¿y2D
)

2693 
¬¿y2D
[0] -ð
off£t
;

2694 ià(
¬¿y2D
[0])

2695 
	`mem_ä“
 (
¬¿y2D
[0]);

2697 
	`”rÜ
 ("free_mem2Dolm:ryingo free unused memory",100);

2699 
	`mem_ä“
 (
¬¿y2D
);

2704 
	`”rÜ
 ("free_mem2Dolm:ryingo free unused memory",100);

2706 
	}
}

2708 
	$ä“_mem2Ddi¡blk
(
di¡blk
 **
¬¿y2D
)

2710 ià(
¬¿y2D
)

2712 ià(*
¬¿y2D
)

2713 
	`mem_ä“
 (*
¬¿y2D
);

2715 
	`”rÜ
 ("free_mem2Ddistblk:ryingo free unused memory",100);

2716 
	`ä“
 (
¬¿y2D
);

2720 
	`”rÜ
 ("free_mem2Ddistblk:ryingo free unused memory",100);

2722 
	}
}

	@lcommon/src/mv_prediction.c

15 
	~"glob®.h
"

16 
	~"mbufãr.h
"

24 
	$G‘MÙiÚVeùÜP»diùÜMBAFF
 (
Maüoblock
 *
cu¼MB
,

25 
Pix–Pos
 *
block
,

26 
MÙiÚVeùÜ
 *
pmv
,

27 
»f_äame
,

28 
PicMÙiÚP¬ams
 **
mv_šfo
,

29 
li¡
,

30 
mb_x
,

31 
mb_y
,

32 
blocksh­e_x
,

33 
blocksh­e_y
)

35 
mv_a
, 
mv_b
, 
mv_c
, 
´ed_vec
=0;

36 
mvP»dTy³
, 
rF¿meL
, 
rF¿meU
, 
rF¿meUR
;

37 
hv
;

38 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

40 
mvP»dTy³
 = 
MVPRED_MEDIAN
;

43 ià(
cu¼MB
->
mb_f›ld
)

45 
rF¿meL
 = 
block
[0].
avažabË


46 ? (
p_Vid
->
mb_d©a
[
block
[0].
mb_addr
].
mb_f›ld


47 ? 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
]

48 : 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

49 
rF¿meU
 = 
block
[1].
avažabË


50 ? (
p_Vid
->
mb_d©a
[
block
[1].
mb_addr
].
mb_f›ld


51 ? 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
]

52 : 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

53 
rF¿meUR
 = 
block
[2].
avažabË


54 ? (
p_Vid
->
mb_d©a
[
block
[2].
mb_addr
].
mb_f›ld


55 ? 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
]

56 : 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

60 
rF¿meL
 = 
block
[0].
avažabË


61 ? (
p_Vid
->
mb_d©a
[
block
[0].
mb_addr
].
mb_f›ld


62 ? 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] >>1

63 : 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
]) : -1;

64 
rF¿meU
 = 
block
[1].
avažabË


65 ? (
p_Vid
->
mb_d©a
[
block
[1].
mb_addr
].
mb_f›ld


66 ? 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] >>1

67 : 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
]) : -1;

68 
rF¿meUR
 = 
block
[2].
avažabË


69 ? (
p_Vid
->
mb_d©a
[
block
[2].
mb_addr
].
mb_f›ld


70 ? 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] >>1

71 : 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
]) : -1;

78 if(
rF¿meL
 =ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 !=„ef_frame)

79 
mvP»dTy³
 = 
MVPRED_L
;

80 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 =ð»f_äam&& 
rF¿meUR
 !=„ef_frame)

81 
mvP»dTy³
 = 
MVPRED_U
;

82 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 ==„ef_frame)

83 
mvP»dTy³
 = 
MVPRED_UR
;

85 if(
blocksh­e_x
 =ð8 && 
blocksh­e_y
 == 16)

87 if(
mb_x
 == 0)

89 if(
rF¿meL
 =ð
»f_äame
)

90 
mvP»dTy³
 = 
MVPRED_L
;

94 ifÐ
rF¿meUR
 =ð
»f_äame
)

95 
mvP»dTy³
 = 
MVPRED_UR
;

98 if(
blocksh­e_x
 =ð16 && 
blocksh­e_y
 == 8)

100 if(
mb_y
 == 0)

102 if(
rF¿meU
 =ð
»f_äame
)

103 
mvP»dTy³
 = 
MVPRED_U
;

107 if(
rF¿meL
 =ð
»f_äame
)

108 
mvP»dTy³
 = 
MVPRED_L
;

112 
hv
=0; hv < 2; hv++)

114 ià(
hv
 == 0)

116 
mv_a
 = 
block
[0].
avažabË
 ? 
mv_šfo
[block[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

117 
mv_b
 = 
block
[1].
avažabË
 ? 
mv_šfo
[block[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

118 
mv_c
 = 
block
[2].
avažabË
 ? 
mv_šfo
[block[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

122 ià(
cu¼MB
->
mb_f›ld
)

124 
mv_a
 = 
block
[0].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[0].
mb_addr
].
mb_f›ld


125 ? 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
].
mv_y


126 : 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
].
mv_y
 / 2

128 
mv_b
 = 
block
[1].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[1].
mb_addr
].
mb_f›ld


129 ? 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
].
mv_y


130 : 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
].
mv_y
 / 2

132 
mv_c
 = 
block
[2].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[2].
mb_addr
].
mb_f›ld


133 ? 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
].
mv_y


134 : 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
].
mv_y
 / 2

139 
mv_a
 = 
block
[0].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[0].
mb_addr
].
mb_f›ld


140 ? 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
].
mv_y
 * 2

141 : 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
].
mv_y


143 
mv_b
 = 
block
[1].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[1].
mb_addr
].
mb_f›ld


144 ? 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
].
mv_y
 * 2

145 : 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
].
mv_y


147 
mv_c
 = 
block
[2].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[2].
mb_addr
].
mb_f›ld


148 ? 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
].
mv_y
 * 2

149 : 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
].
mv_y


154 
mvP»dTy³
)

156 
MVPRED_MEDIAN
:

157 if(!(
block
[1].
avažabË
 || block[2].available))

159 
´ed_vec
 = 
mv_a
;

163 
´ed_vec
 = 
	`imedŸn
(
mv_a
, 
mv_b
, 
mv_c
);

166 
MVPRED_L
:

167 
´ed_vec
 = 
mv_a
;

169 
MVPRED_U
:

170 
´ed_vec
 = 
mv_b
;

172 
MVPRED_UR
:

173 
´ed_vec
 = 
mv_c
;

179 ià(
hv
 == 0)

180 
pmv
->
mv_x
 = (è
´ed_vec
;

182 
pmv
->
mv_y
 = (è
´ed_vec
;

184 
	}
}

192 
	$G‘MÙiÚVeùÜP»diùÜNÜm®
 (
Maüoblock
 *
cu¼MB
,

193 
Pix–Pos
 *
block
,

194 
MÙiÚVeùÜ
 *
pmv
,

195 
»f_äame
,

196 
PicMÙiÚP¬ams
 **
mv_šfo
,

197 
li¡
,

198 
mb_x
,

199 
mb_y
,

200 
blocksh­e_x
,

201 
blocksh­e_y
)

203 
mvP»dTy³
 = 
MVPRED_MEDIAN
;

205 
rF¿meL
 = 
block
[0].
avažabË
 ? 
mv_šfo
[block[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] : -1;

206 
rF¿meU
 = 
block
[1].
avažabË
 ? 
mv_šfo
[block[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] : -1;

207 
rF¿meUR
 = 
block
[2].
avažabË
 ? 
mv_šfo
[block[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] : -1;

212 if(
rF¿meL
 =ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 !=„ef_frame)

213 
mvP»dTy³
 = 
MVPRED_L
;

214 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 =ð»f_äam&& 
rF¿meUR
 !=„ef_frame)

215 
mvP»dTy³
 = 
MVPRED_U
;

216 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 ==„ef_frame)

217 
mvP»dTy³
 = 
MVPRED_UR
;

220 if(
blocksh­e_x
 =ð8 && 
blocksh­e_y
 == 16)

222 if(
mb_x
 == 0)

224 if(
rF¿meL
 =ð
»f_äame
)

225 
mvP»dTy³
 = 
MVPRED_L
;

229 if(
rF¿meUR
 =ð
»f_äame
)

230 
mvP»dTy³
 = 
MVPRED_UR
;

233 if(
blocksh­e_x
 =ð16 && 
blocksh­e_y
 == 8)

235 if(
mb_y
 == 0)

237 if(
rF¿meU
 =ð
»f_äame
)

238 
mvP»dTy³
 = 
MVPRED_U
;

242 if(
rF¿meL
 =ð
»f_äame
)

243 
mvP»dTy³
 = 
MVPRED_L
;

247 
mvP»dTy³
)

249 
MVPRED_MEDIAN
:

250 if(!(
block
[1].
avažabË
 || block[2].available))

252 ià(
block
[0].
avažabË
)

254 *
pmv
 = 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
];

258 *
pmv
 = 
z”o_mv
;

263 
MÙiÚVeùÜ
 *
mv_a
 = 
block
[0].
avažabË
 ? &
mv_šfo
[block[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
] : (MÙiÚVeùÜ *è&
z”o_mv
;

264 
MÙiÚVeùÜ
 *
mv_b
 = 
block
[1].
avažabË
 ? &
mv_šfo
[block[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
] : (MÙiÚVeùÜ *è&
z”o_mv
;

265 
MÙiÚVeùÜ
 *
mv_c
 = 
block
[2].
avažabË
 ? &
mv_šfo
[block[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
] : (MÙiÚVeùÜ *è&
z”o_mv
;

267 
pmv
->
mv_x
 = (è
	`imedŸn
(
mv_a
->mv_x, 
mv_b
->mv_x, 
mv_c
->mv_x);

268 
pmv
->
mv_y
 = (è
	`imedŸn
(
mv_a
->mv_y, 
mv_b
->mv_y, 
mv_c
->mv_y);

271 
MVPRED_L
:

272 ià(
block
[0].
avažabË
)

274 *
pmv
 = 
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
];

278 *
pmv
 = 
z”o_mv
;

281 
MVPRED_U
:

282 ià(
block
[1].
avažabË
)

284 *
pmv
 = 
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
];

288 *
pmv
 = 
z”o_mv
;

291 
MVPRED_UR
:

292 ià(
block
[2].
avažabË
)

294 *
pmv
 = 
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
];

298 *
pmv
 = 
z”o_mv
;

304 
	}
}

306 
	$š™_mÙiÚ_veùÜ_´ediùiÚ
(
Maüoblock
 *
cu¼MB
, 
mb_aff_äame_æag
)

308 ià(
mb_aff_äame_æag
)

309 
cu¼MB
->
G‘MVP»diùÜ
 = 
G‘MÙiÚVeùÜP»diùÜMBAFF
;

311 
cu¼MB
->
G‘MVP»diùÜ
 = 
G‘MÙiÚVeùÜP»diùÜNÜm®
;

312 
	}
}

	@lcommon/src/nalucommon.c

15 
	~"glob®.h
"

16 
	~"ÇlucommÚ.h
"

17 
	~"mem®loc.h
"

31 
NALU_t
 *
	$AÎocNALU
(
bufãrsize
)

33 
NALU_t
 *
n
;

35 ià((
n
 = (
NALU_t
*)
	`ÿÎoc
 (1,  (NALU_t))è=ð
NULL
)

36 
	`no_mem_ex™
 ("AllocNALU:‚");

38 
n
->
max_size
=
bufãrsize
;

39 ià((
n
->
buf
 = (
by‹
*)
	`ÿÎoc
 (
bufãrsize
,  (by‹))è=ð
NULL
)

41 
	`ä“
 (
n
);

42 
	`no_mem_ex™
 ("AllocNALU:‚->buf");

45  
n
;

46 
	}
}

59 
	$F»eNALU
(
NALU_t
 *
n
)

61 ià(
n
 !ð
NULL
)

63 ià(
n
->
buf
 !ð
NULL
)

65 
	`ä“
(
n
->
buf
);

66 
n
->
buf
=
NULL
;

68 
	`ä“
 (
n
);

70 
	}
}

	@lcommon/src/parsetcommon.c

16 
	~"glob®.h
"

17 
	~"·r£tcommÚ.h
"

18 
	~"mem®loc.h
"

29 
pic_·¿m‘”_£t_rb¥_t
 *
	$AÎocPPS
 ()

31 
pic_·¿m‘”_£t_rb¥_t
 *
p
;

33 ià((
p
=
	`ÿÎoc
 (1,  (
pic_·¿m‘”_£t_rb¥_t
))è=ð
NULL
)

34 
	`no_mem_ex™
 ("AllocPPS: PPS");

35 
p
->
¦iû_group_id
 = 
NULL
;

36  
p
;

37 
	}
}

50 
£q_·¿m‘”_£t_rb¥_t
 *
	$AÎocSPS
 ()

52 
£q_·¿m‘”_£t_rb¥_t
 *
p
;

54 ià((
p
=
	`ÿÎoc
 (1,  (
£q_·¿m‘”_£t_rb¥_t
))è=ð
NULL
)

55 
	`no_mem_ex™
 ("AllocSPS: SPS");

56  
p
;

57 
	}
}

70 
	$F»ePPS
 (
pic_·¿m‘”_£t_rb¥_t
 *
µs
)

72 
	`as£¹
 (
µs
 !ð
NULL
);

73 ià(
µs
->
¦iû_group_id
 !ð
NULL
)

74 
	`ä“
 (
µs
->
¦iû_group_id
);

75 
	`ä“
 (
µs
);

76 
	}
}

89 
	$F»eSPS
 (
£q_·¿m‘”_£t_rb¥_t
 *
¥s
)

91 
	`as£¹
 (
¥s
 !ð
NULL
);

92 
	`ä“
 (
¥s
);

93 
	}
}

96 
	$¥s_is_equ®
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s1
, seq_·¿m‘”_£t_rb¥_ˆ*
¥s2
)

98 
i
;

99 
equ®
 = 1;

101 ià((!
¥s1
->
V®id
è|| (!
¥s2
->Valid))

104 
equ®
 &ð(
¥s1
->
´ofže_idc
 =ð
¥s2
->profile_idc);

105 
equ®
 &ð(
¥s1
->
cÚ¡¿šed_£t0_æag
 =ð
¥s2
->constrained_set0_flag);

106 
equ®
 &ð(
¥s1
->
cÚ¡¿šed_£t1_æag
 =ð
¥s2
->constrained_set1_flag);

107 
equ®
 &ð(
¥s1
->
cÚ¡¿šed_£t2_æag
 =ð
¥s2
->constrained_set2_flag);

108 
equ®
 &ð(
¥s1
->
Ëv–_idc
 =ð
¥s2
->level_idc);

109 
equ®
 &ð(
¥s1
->
£q_·¿m‘”_£t_id
 =ð
¥s2
->seq_parameter_set_id);

110 
equ®
 &ð(
¥s1
->
log2_max_äame_num_mšus4
 =ð
¥s2
->log2_max_frame_num_minus4);

111 
equ®
 &ð(
¥s1
->
pic_Üd”_út_ty³
 =ð
¥s2
->pic_order_cnt_type);

113 ià(!
equ®
) ƒqual;

115 ifÐ
¥s1
->
pic_Üd”_út_ty³
 == 0 )

117 
equ®
 &ð(
¥s1
->
log2_max_pic_Üd”_út_lsb_mšus4
 =ð
¥s2
->log2_max_pic_order_cnt_lsb_minus4);

120 ifÐ
¥s1
->
pic_Üd”_út_ty³
 == 1 )

122 
equ®
 &ð(
¥s1
->
d–_pic_Üd”_®ways_z”o_æag
 =ð
¥s2
->delta_pic_order_always_zero_flag);

123 
equ®
 &ð(
¥s1
->
off£t_fÜ_nÚ_»f_pic
 =ð
¥s2
->offset_for_non_ref_pic);

124 
equ®
 &ð(
¥s1
->
off£t_fÜ_tÝ_to_bÙtom_f›ld
 =ð
¥s2
->offset_for_top_to_bottom_field);

125 
equ®
 &ð(
¥s1
->
num_»f_äames_š_pic_Üd”_út_cyþe
 =ð
¥s2
->num_ref_frames_in_pic_order_cnt_cycle);

126 ià(!
equ®
) ƒqual;

128  
i
 = 0 ; i< 
¥s1
->
num_»f_äames_š_pic_Üd”_út_cyþe
 ;i ++)

129 
equ®
 &ð(
¥s1
->
off£t_fÜ_»f_äame
[
i
] =ð
¥s2
->offset_for_ref_frame[i]);

132 
equ®
 &ð(
¥s1
->
num_»f_äames
 =ð
¥s2
->num_ref_frames);

133 
equ®
 &ð(
¥s1
->
g­s_š_äame_num_v®ue_®lowed_æag
 =ð
¥s2
->gaps_in_frame_num_value_allowed_flag);

134 
equ®
 &ð(
¥s1
->
pic_width_š_mbs_mšus1
 =ð
¥s2
->pic_width_in_mbs_minus1);

135 
equ®
 &ð(
¥s1
->
pic_height_š_m­_un™s_mšus1
 =ð
¥s2
->pic_height_in_map_units_minus1);

136 
equ®
 &ð(
¥s1
->
äame_mbs_Úly_æag
 =ð
¥s2
->frame_mbs_only_flag);

138 ià(!
equ®
) ƒqual;

139 ifÐ!
¥s1
->
äame_mbs_Úly_æag
 )

140 
equ®
 &ð(
¥s1
->
mb_ad­tive_äame_f›ld_æag
 =ð
¥s2
->mb_adaptive_frame_field_flag);

142 
equ®
 &ð(
¥s1
->
dœeù_8x8_šã»nû_æag
 =ð
¥s2
->direct_8x8_inference_flag);

143 
equ®
 &ð(
¥s1
->
äame_üÝpšg_æag
 =ð
¥s2
->frame_cropping_flag);

144 ià(!
equ®
) ƒqual;

145 ià(
¥s1
->
äame_üÝpšg_æag
)

147 
equ®
 &ð(
¥s1
->
äame_üÝ_Ëá_off£t
 =ð
¥s2
->frame_crop_left_offset);

148 
equ®
 &ð(
¥s1
->
äame_üÝ_right_off£t
 =ð
¥s2
->frame_crop_right_offset);

149 
equ®
 &ð(
¥s1
->
äame_üÝ_tÝ_off£t
 =ð
¥s2
->frame_crop_top_offset);

150 
equ®
 &ð(
¥s1
->
äame_üÝ_bÙtom_off£t
 =ð
¥s2
->frame_crop_bottom_offset);

152 
equ®
 &ð(
¥s1
->
vui_·¿m‘”s_´e£Á_æag
 =ð
¥s2
->vui_parameters_present_flag);

154  
equ®
;

155 
	}
}

157 
	$µs_is_equ®
(
pic_·¿m‘”_£t_rb¥_t
 *
µs1
,…ic_·¿m‘”_£t_rb¥_ˆ*
µs2
)

159 
i
, 
j
;

160 
equ®
 = 1;

162 ià((!
µs1
->
V®id
è|| (!
µs2
->Valid))

165 
equ®
 &ð(
µs1
->
pic_·¿m‘”_£t_id
 =ð
µs2
->pic_parameter_set_id);

166 
equ®
 &ð(
µs1
->
£q_·¿m‘”_£t_id
 =ð
µs2
->seq_parameter_set_id);

167 
equ®
 &ð(
µs1
->
’ŒÝy_codšg_mode_æag
 =ð
µs2
->entropy_coding_mode_flag);

168 
equ®
 &ð(
µs1
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 =ð
µs2
->bottom_field_pic_order_in_frame_present_flag);

169 
equ®
 &ð(
µs1
->
num_¦iû_groups_mšus1
 =ð
µs2
->num_slice_groups_minus1);

171 ià(!
equ®
) ƒqual;

173 ià(
µs1
->
num_¦iû_groups_mšus1
>0)

175 
equ®
 &ð(
µs1
->
¦iû_group_m­_ty³
 =ð
µs2
->slice_group_map_type);

176 ià(!
equ®
) ƒqual;

177 ià(
µs1
->
¦iû_group_m­_ty³
 == 0)

179 
i
=0; i<=
µs1
->
num_¦iû_groups_mšus1
; i++)

180 
equ®
 &ð(
µs1
->
run_Ëngth_mšus1
[
i
] =ð
µs2
->run_length_minus1[i]);

182 ifÐ
µs1
->
¦iû_group_m­_ty³
 == 2 )

184 
i
=0; i<
µs1
->
num_¦iû_groups_mšus1
; i++)

186 
equ®
 &ð(
µs1
->
tÝ_Ëá
[
i
] =ð
µs2
->top_left[i]);

187 
equ®
 &ð(
µs1
->
bÙtom_right
[
i
] =ð
µs2
->bottom_right[i]);

190 ifÐ
µs1
->
¦iû_group_m­_ty³
 == 3 ||…ps1->slice_group_map_type==4 ||…ps1->slice_group_map_type==5 )

192 
equ®
 &ð(
µs1
->
¦iû_group_chªge_dœeùiÚ_æag
 =ð
µs2
->slice_group_change_direction_flag);

193 
equ®
 &ð(
µs1
->
¦iû_group_chªge_¿‹_mšus1
 =ð
µs2
->slice_group_change_rate_minus1);

195 ifÐ
µs1
->
¦iû_group_m­_ty³
 == 6 )

197 
equ®
 &ð(
µs1
->
pic_size_š_m­_un™s_mšus1
 =ð
µs2
->pic_size_in_map_units_minus1);

198 ià(!
equ®
) ƒqual;

199 
i
=0; i<=
µs1
->
pic_size_š_m­_un™s_mšus1
; i++)

200 
equ®
 &ð(
µs1
->
¦iû_group_id
[
i
] =ð
µs2
->slice_group_id[i]);

204 
equ®
 &ð(
µs1
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
 =ð
µs2
->num_ref_idx_l0_default_active_minus1);

205 
equ®
 &ð(
µs1
->
num_»f_idx_l1_deçuÉ_aùive_mšus1
 =ð
µs2
->num_ref_idx_l1_default_active_minus1);

206 
equ®
 &ð(
µs1
->
weigh‹d_´ed_æag
 =ð
µs2
->weighted_pred_flag);

207 
equ®
 &ð(
µs1
->
weigh‹d_b»d_idc
 =ð
µs2
->weighted_bipred_idc);

208 
equ®
 &ð(
µs1
->
pic_š™_qp_mšus26
 =ð
µs2
->pic_init_qp_minus26);

209 
equ®
 &ð(
µs1
->
pic_š™_qs_mšus26
 =ð
µs2
->pic_init_qs_minus26);

210 
equ®
 &ð(
µs1
->
chroma_qp_šdex_off£t
 =ð
µs2
->chroma_qp_index_offset);

211 
equ®
 &ð(
µs1
->
deblockšg_fž‹r_cÚŒÞ_´e£Á_æag
 =ð
µs2
->deblocking_filter_control_present_flag);

212 
equ®
 &ð(
µs1
->
cÚ¡¿šed_šŒa_´ed_æag
 =ð
µs2
->constrained_intra_pred_flag);

213 
equ®
 &ð(
µs1
->
»dundªt_pic_út_´e£Á_æag
 =ð
µs2
->redundant_pic_cnt_present_flag);

215 ià(!
equ®
) ƒqual;

219 
equ®
 &ð(
µs1
->
ŒªsfÜm_8x8_mode_æag
 =ð
µs2
->transform_8x8_mode_flag);

220 
equ®
 &ð(
µs1
->
pic_sÿlšg_m©rix_´e£Á_æag
 =ð
µs2
->pic_scaling_matrix_present_flag);

221 if(
µs1
->
pic_sÿlšg_m©rix_´e£Á_æag
)

223 
i
 = 0; i < (6 + (()
µs1
->
ŒªsfÜm_8x8_mode_æag
 << 1)); i++)

225 
equ®
 &ð(
µs1
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] =ð
µs2
->pic_scaling_list_present_flag[i]);

226 if(
µs1
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
])

228 if(
i
 < 6)

230 
j
 = 0; j < 16; j++)

231 
equ®
 &ð(
µs1
->
SÿlšgLi¡4x4
[
i
][
j
] =ð
µs2
->ScalingList4x4[i][j]);

235 
j
 = 0; j < 64; j++)

236 
equ®
 &ð(
µs1
->
SÿlšgLi¡8x8
[
i
-6][
j
] =ð
µs2
->ScalingList8x8[i-6][j]);

241 
equ®
 &ð(
µs1
->
£cÚd_chroma_qp_šdex_off£t
 =ð
µs2
->second_chroma_qp_index_offset);

243  
equ®
;

244 
	}
}

	@lcommon/src/resize.c

16 
	~"glob®.h
"

17 
	~"»size.h
"

28 
	#PD_FILTER
Ð
x0
, 
x1
, 
x2
, 
x3
, 
x4
 ) ((x2)*6+((x1)+(x3))*4+(x0)+(x4))

	)

35 
	#PD_LT
(
x0
,
x1
,
x2
è((x0)*6 + (x1)*8 + (x2)*2)

	)

40 
	#PD_RB
(
x0
,
x1
,
x2
,
x3
è((x0è+ ((x1è+ (x3))*4 + (x2)*7)

	)

45 
	#PD_SINGULAR
(
x0
,
x1
è(((x0è+ (x1))*8)

	)

47 
	#PD_SCALE_INT
(
x
è(((xè+ (1<<7)è>> 8)

	)

48 
	#PD_SCALE_FLT
(
x
è((x)*0.00390625f)

	)

50 
	#PD_SZ
 5

	)

62 
	#PU_FILTER
Ð
x0
, 
x1
, 
x2
 ) ((x1)*6 + (x0è+ (x2))

	)

67 
	#PU_FILTER_ZI
Ð
x0
, 
x1
 ) (((x0è+ (x1))*4)

	)

76 
	#PU_LT
Ð
x0
, 
x1
 ) ((x0)*6 + (x1)*2)

	)

80 
	#PU_LT_ZI
Ð
x0
, 
x1
 ) 
	`PU_FILTER_ZI
((x0),(x1))

	)

85 
	#PU_RB
Ð
x0
, 
x1
 ) ((x0è+ (x1)*7)

	)

90 
	#PU_RB_ZI
Ð
x0
 ) ((x0)*8)

	)

95 
	#PU_SINGULAR
Ð
x0
 ) 
	`PU_RB_ZI
((x0)è

	)

96 
	#PU_SINGULAR_ZI
Ð
x0
 ) 
	`PU_RB_ZI
((x0)è

	)

99 
	#PU_SCALE_INT
(
x
è(((xè+ (1<<5)è>> 6)

	)

100 
	#PU_SCALE_FLT
(
x
è((x)*0.015625f)

	)

102 
	#PU_SZ
 3

	)

104 
	twÜkty³
;

109 
	$PyrDownG5x5_U8CnR
ÐcÚ¡ 
img³l
* 
¤c
,

110 
¤c¡•
,

111 
width
,

112 
height
,

113 
img³l
* 
d¡
,

114 
d¡¡•
,

115 
Cs


118 
wÜkty³
 *
buf
=
NULL
;

119 
wÜkty³
 *
bufãr
;

120 
wÜkty³
 *
rows
[
PD_SZ
];

121 
y
, 
tÝ_row
 = 0;

122 
Wd
 = 
width
/2, 
Wdn
 = Wd*
Cs
;

123 
bufãr_¡•
 = 
Wdn
;

124 
pd_sz
 = (
PD_SZ
 + 1)*
bufãr_¡•
;

125 
f¡
 = 0, 
l¡
 = 
height
 <ð
PD_SZ
/2 ? height : PD_SZ/2 + 1;

127 
	`as£¹
Ð
Cs
 == 1 || Cs == 3 );

130 
buf
 = 
	`m®loc
((
width
&-2)*2*
Cs
*(
wÜkty³
)*(
PD_SZ
 + 1));

131 
bufãr
 = 
buf
;

133 
¤c¡•
 /ð(
¤c
[0]);

134 
d¡¡•
 /ð(
d¡
[0]);

137 
y
 = 0; y < 
height
; y +ð2, 
d¡
 +ð
d¡¡•
 )

140 
x
, 
y1
, 
k
 = 
tÝ_row
;

141 
x1
 = 
bufãr_¡•
;

142 
wÜkty³
 *
row01
, *
row23
, *
row4
;

145  
y1
 = 0; y1 < 
PD_SZ
; y1++)

147 
rows
[
y1
] = 
bufãr
 + 
k
;

148 
k
 +ð
bufãr_¡•
;

149 
k
 &ðk < 
pd_sz
 ? -1 : 0;

152 
row01
 = 
rows
[0];

153 
row23
 = 
rows
[2];

154 
row4
 = 
rows
[4];

157 ifÐ
Cs
 == 1 )

159 ifÐ
width
 > 
PD_SZ
/2 )

161  
y1
 = 
f¡
; y1 < 
l¡
; y1++, 
¤c
 +ð
¤c¡•
 )

163 
wÜkty³
 *
row
 = 
rows
[
y1
];

166 
row
[0] = 
	`PD_LT
Ð
¤c
[0], src[1], src[2] );

167 
row
[
Wd
-1] = 
	`PD_RB
Ð
¤c
[Wd*2-4], src[Wd*2-3], src[Wd*2-2], src[Wd*2-1]);

169  
x
 = 1; x < 
Wd
 - 1; x++ )

171 
row
[
x
] = 
	`PD_FILTER
Ð
¤c
[2*x-2], src[2*x-1], src[2*x], src[2*x+1], src[2*x+2] );

177  
y1
 = 
f¡
; y1 < 
l¡
; y1++, 
¤c
 +ð
¤c¡•
 )

179 
rows
[
y1
][0] = 
	`PD_SINGULAR
Ð
¤c
[0], src[1] );

185  
y1
 = 
f¡
; y1 < 
l¡
; y1++, 
¤c
 +ð
¤c¡•
 )

187 
wÜkty³
 *
row
 = 
rows
[
y1
];

188 ifÐ
width
 > 
PD_SZ
/2 )

190 
c
;

191  
c
 = 0; c < 3; c++ )

194 
row
[
c
] = 
	`PD_LT
Ð
¤c
[c], src[3+c], src[6+c] );

195 
row
[
Wdn
-3+
c
] = 
	`PD_RB
Ð
¤c
[Wdn*2-12+c], src[Wdn*2-9+c], src[Wdn*2-6+c], src[Wdn*2-3+c] );

198  
x
 = 3; x < 
Wdn
 - 3; x += 3 )

200 
row
[
x
] = 
	`PD_FILTER
Ð
¤c
[2*x-6], src[2*x-3], src[2*x], src[2*x+3], src[2*x+6] );

201 
row
[
x
+1] = 
	`PD_FILTER
Ð
¤c
[2*x-5], src[2*x-2], src[2*x+1], src[2*x+4], src[2*x+7] );

202 
row
[
x
+2] = 
	`PD_FILTER
Ð
¤c
[2*x-4], src[2*x-1], src[2*x+2], src[2*x+5], src[2*x+8] );

207 
row
[0] = 
	`PD_SINGULAR
Ð
¤c
[0], src[3] );

208 
row
[1] = 
	`PD_SINGULAR
Ð
¤c
[1], src[4] );

209 
row
[2] = 
	`PD_SINGULAR
Ð
¤c
[2], src[5] );

215 ifÐ
y
 > 0 )

217 ifÐ
y
 < 
height
 - 
PD_SZ
/2 )

219  
x
 = 0; x < 
Wdn
; x++, 
x1
++ )

221 
d¡
[
x
] = (
img³l
)
	`PD_SCALE_INT
Ð
	`PD_FILTER
Ð
row01
[x],„ow01[
x1
], 
row23
[x],„ow23[x1], 
row4
[x] ));

223 
tÝ_row
 +ð2*
bufãr_¡•
;

224 
tÝ_row
 &ðtÝ_row < 
pd_sz
 ? -1 : 0;

227  
x
 = 0; x < 
Wdn
; x++, 
x1
++ )

228 
d¡
[
x
] = (
img³l
)
	`PD_SCALE_INT
Ð
	`PD_RB
Ð
row01
[x],„ow01[
x1
], 
row23
[x],„ow23[x1]));

232 ifÐ
height
 > 
PD_SZ
/2 )

234  
x
 = 0; x < 
Wdn
; x++, 
x1
++ )

235 
d¡
[
x
] = (
img³l
)
	`PD_SCALE_INT
Ð
	`PD_LT
Ð
row01
[x],„ow01[
x1
], 
row23
[x] ));

239  
x
 = 0; x < 
Wdn
; x++, 
x1
++ )

240 
d¡
[
x
] = (
img³l
)
	`PD_SCALE_INT
Ð
	`PD_SINGULAR
Ð
row01
[x],„ow01[
x1
] ));

242 
f¡
 = 
PD_SZ
 - 2;

245 
l¡
 = 
y
 + 2 + 
PD_SZ
/2 < 
height
 ? PD_SZ : height - y;

248 if(
buf
)

250 
	`ä“
(
buf
);

251 
buf
 = 
NULL
;

255 
	}
}

	@lcommon/src/transform.c

16 
	~"glob®.h
"

17 
	~"ŒªsfÜm.h
"

20 
	$fÜw¬d4x4
(**
block
, **
tblock
, 
pos_y
, 
pos_x
)

22 
i
, 
ii
;

23 
tmp
[16];

24 *
pTmp
 = 
tmp
, *
pblock
;

25 
p0
,
p1
,
p2
,
p3
;

26 
t0
,
t1
,
t2
,
t3
;

29 
i
=
pos_y
; i <…os_y + 
BLOCK_SIZE
; i++)

31 
pblock
 = &
block
[
i
][
pos_x
];

32 
p0
 = *(
pblock
++);

33 
p1
 = *(
pblock
++);

34 
p2
 = *(
pblock
++);

35 
p3
 = *(
pblock
 );

37 
t0
 = 
p0
 + 
p3
;

38 
t1
 = 
p1
 + 
p2
;

39 
t2
 = 
p1
 - 
p2
;

40 
t3
 = 
p0
 - 
p3
;

42 *(
pTmp
++èð
t0
 + 
t1
;

43 *(
pTmp
++èð(
t3
 << 1è+ 
t2
;

44 *(
pTmp
++èð
t0
 - 
t1
;

45 *(
pTmp
++èð
t3
 - (
t2
 << 1);

49 
i
=0; i < 
BLOCK_SIZE
; i++)

51 
pTmp
 = 
tmp
 + 
i
;

52 
p0
 = *
pTmp
;

53 
p1
 = *(
pTmp
 +ð
BLOCK_SIZE
);

54 
p2
 = *(
pTmp
 +ð
BLOCK_SIZE
);

55 
p3
 = *(
pTmp
 +ð
BLOCK_SIZE
);

57 
t0
 = 
p0
 + 
p3
;

58 
t1
 = 
p1
 + 
p2
;

59 
t2
 = 
p1
 - 
p2
;

60 
t3
 = 
p0
 - 
p3
;

62 
ii
 = 
pos_x
 + 
i
;

63 
tblock
[
pos_y
 ][
ii
] = 
t0
 + 
t1
;

64 
tblock
[
pos_y
 + 1][
ii
] = 
t2
 + (
t3
 << 1);

65 
tblock
[
pos_y
 + 2][
ii
] = 
t0
 - 
t1
;

66 
tblock
[
pos_y
 + 3][
ii
] = 
t3
 - (
t2
 << 1);

68 
	}
}

70 
	$šv”£4x4
(**
tblock
, **
block
, 
pos_y
, 
pos_x
)

72 
i
, 
ii
;

73 
tmp
[16];

74 *
pTmp
 = 
tmp
, *
pblock
;

75 
p0
,
p1
,
p2
,
p3
;

76 
t0
,
t1
,
t2
,
t3
;

79 
i
 = 
pos_y
; i <…os_y + 
BLOCK_SIZE
; i++)

81 
pblock
 = &
tblock
[
i
][
pos_x
];

82 
t0
 = *(
pblock
++);

83 
t1
 = *(
pblock
++);

84 
t2
 = *(
pblock
++);

85 
t3
 = *(
pblock
 );

87 
p0
 = 
t0
 + 
t2
;

88 
p1
 = 
t0
 - 
t2
;

89 
p2
 = (
t1
 >> 1è- 
t3
;

90 
p3
 = 
t1
 + (
t3
 >> 1);

92 *(
pTmp
++èð
p0
 + 
p3
;

93 *(
pTmp
++èð
p1
 + 
p2
;

94 *(
pTmp
++èð
p1
 - 
p2
;

95 *(
pTmp
++èð
p0
 - 
p3
;

99 
i
 = 0; i < 
BLOCK_SIZE
; i++)

101 
pTmp
 = 
tmp
 + 
i
;

102 
t0
 = *
pTmp
;

103 
t1
 = *(
pTmp
 +ð
BLOCK_SIZE
);

104 
t2
 = *(
pTmp
 +ð
BLOCK_SIZE
);

105 
t3
 = *(
pTmp
 +ð
BLOCK_SIZE
);

107 
p0
 = 
t0
 + 
t2
;

108 
p1
 = 
t0
 - 
t2
;

109 
p2
 =(
t1
 >> 1è- 
t3
;

110 
p3
 = 
t1
 + (
t3
 >> 1);

112 
ii
 = 
i
 + 
pos_x
;

113 
block
[
pos_y
 ][
ii
] = 
p0
 + 
p3
;

114 
block
[
pos_y
 + 1][
ii
] = 
p1
 + 
p2
;

115 
block
[
pos_y
 + 2][
ii
] = 
p1
 - 
p2
;

116 
block
[
pos_y
 + 3][
ii
] = 
p0
 - 
p3
;

118 
	}
}

121 
	$hadam¬d4x4
(**
block
, **
tblock
)

123 
i
;

124 
tmp
[16];

125 *
pTmp
 = 
tmp
, *
pblock
;

126 
p0
,
p1
,
p2
,
p3
;

127 
t0
,
t1
,
t2
,
t3
;

130 
i
 = 0; i < 
BLOCK_SIZE
; i++)

132 
pblock
 = 
block
[
i
];

133 
p0
 = *(
pblock
++);

134 
p1
 = *(
pblock
++);

135 
p2
 = *(
pblock
++);

136 
p3
 = *(
pblock
 );

138 
t0
 = 
p0
 + 
p3
;

139 
t1
 = 
p1
 + 
p2
;

140 
t2
 = 
p1
 - 
p2
;

141 
t3
 = 
p0
 - 
p3
;

143 *(
pTmp
++èð
t0
 + 
t1
;

144 *(
pTmp
++èð
t3
 + 
t2
;

145 *(
pTmp
++èð
t0
 - 
t1
;

146 *(
pTmp
++èð
t3
 - 
t2
;

150 
i
 = 0; i < 
BLOCK_SIZE
; i++)

152 
pTmp
 = 
tmp
 + 
i
;

153 
p0
 = *
pTmp
;

154 
p1
 = *(
pTmp
 +ð
BLOCK_SIZE
);

155 
p2
 = *(
pTmp
 +ð
BLOCK_SIZE
);

156 
p3
 = *(
pTmp
 +ð
BLOCK_SIZE
);

158 
t0
 = 
p0
 + 
p3
;

159 
t1
 = 
p1
 + 
p2
;

160 
t2
 = 
p1
 - 
p2
;

161 
t3
 = 
p0
 - 
p3
;

163 
tblock
[0][
i
] = (
t0
 + 
t1
) >> 1;

164 
tblock
[1][
i
] = (
t2
 + 
t3
) >> 1;

165 
tblock
[2][
i
] = (
t0
 - 
t1
) >> 1;

166 
tblock
[3][
i
] = (
t3
 - 
t2
) >> 1;

168 
	}
}

171 
	$ihadam¬d4x4
(**
tblock
, **
block
)

173 
i
;

174 
tmp
[16];

175 *
pTmp
 = 
tmp
, *
pblock
;

176 
p0
,
p1
,
p2
,
p3
;

177 
t0
,
t1
,
t2
,
t3
;

180 
i
 = 0; i < 
BLOCK_SIZE
; i++)

182 
pblock
 = 
tblock
[
i
];

183 
t0
 = *(
pblock
++);

184 
t1
 = *(
pblock
++);

185 
t2
 = *(
pblock
++);

186 
t3
 = *(
pblock
 );

188 
p0
 = 
t0
 + 
t2
;

189 
p1
 = 
t0
 - 
t2
;

190 
p2
 = 
t1
 - 
t3
;

191 
p3
 = 
t1
 + 
t3
;

193 *(
pTmp
++èð
p0
 + 
p3
;

194 *(
pTmp
++èð
p1
 + 
p2
;

195 *(
pTmp
++èð
p1
 - 
p2
;

196 *(
pTmp
++èð
p0
 - 
p3
;

200 
i
 = 0; i < 
BLOCK_SIZE
; i++)

202 
pTmp
 = 
tmp
 + 
i
;

203 
t0
 = *
pTmp
;

204 
t1
 = *(
pTmp
 +ð
BLOCK_SIZE
);

205 
t2
 = *(
pTmp
 +ð
BLOCK_SIZE
);

206 
t3
 = *(
pTmp
 +ð
BLOCK_SIZE
);

208 
p0
 = 
t0
 + 
t2
;

209 
p1
 = 
t0
 - 
t2
;

210 
p2
 = 
t1
 - 
t3
;

211 
p3
 = 
t1
 + 
t3
;

213 
block
[0][
i
] = 
p0
 + 
p3
;

214 
block
[1][
i
] = 
p1
 + 
p2
;

215 
block
[2][
i
] = 
p1
 - 
p2
;

216 
block
[3][
i
] = 
p0
 - 
p3
;

218 
	}
}

220 
	$hadam¬d4x2
(**
block
, **
tblock
)

222 
i
;

223 
tmp
[8];

224 *
pTmp
 = 
tmp
;

225 
p0
,
p1
,
p2
,
p3
;

226 
t0
,
t1
,
t2
,
t3
;

229 *(
pTmp
++èð
block
[0][0] + block[1][0];

230 *(
pTmp
++èð
block
[0][1] + block[1][1];

231 *(
pTmp
++èð
block
[0][2] + block[1][2];

232 *(
pTmp
++èð
block
[0][3] + block[1][3];

234 *(
pTmp
++èð
block
[0][0] - block[1][0];

235 *(
pTmp
++èð
block
[0][1] - block[1][1];

236 *(
pTmp
++èð
block
[0][2] - block[1][2];

237 *(
pTmp
 ) = 
block
[0][3] - block[1][3];

240 
pTmp
 = 
tmp
;

241 
i
=0;i<2;i++)

243 
p0
 = *(
pTmp
++);

244 
p1
 = *(
pTmp
++);

245 
p2
 = *(
pTmp
++);

246 
p3
 = *(
pTmp
++);

248 
t0
 = 
p0
 + 
p3
;

249 
t1
 = 
p1
 + 
p2
;

250 
t2
 = 
p1
 - 
p2
;

251 
t3
 = 
p0
 - 
p3
;

253 
tblock
[
i
][0] = (
t0
 + 
t1
);

254 
tblock
[
i
][1] = (
t3
 + 
t2
);

255 
tblock
[
i
][2] = (
t0
 - 
t1
);

256 
tblock
[
i
][3] = (
t3
 - 
t2
);

258 
	}
}

260 
	$ihadam¬d4x2
(**
tblock
, **
block
)

262 
i
;

263 
tmp
[8];

264 *
pTmp
 = 
tmp
;

265 
p0
,
p1
,
p2
,
p3
;

266 
t0
,
t1
,
t2
,
t3
;

269 *(
pTmp
++èð
tblock
[0][0] +block[1][0];

270 *(
pTmp
++èð
tblock
[0][1] +block[1][1];

271 *(
pTmp
++èð
tblock
[0][2] +block[1][2];

272 *(
pTmp
++èð
tblock
[0][3] +block[1][3];

274 *(
pTmp
++èð
tblock
[0][0] -block[1][0];

275 *(
pTmp
++èð
tblock
[0][1] -block[1][1];

276 *(
pTmp
++èð
tblock
[0][2] -block[1][2];

277 *(
pTmp
 ) = 
tblock
[0][3] -block[1][3];

280 
pTmp
 = 
tmp
;

281 
i
 = 0; i < 2; i++)

283 
p0
 = *(
pTmp
++);

284 
p1
 = *(
pTmp
++);

285 
p2
 = *(
pTmp
++);

286 
p3
 = *(
pTmp
++);

288 
t0
 = 
p0
 + 
p2
;

289 
t1
 = 
p0
 - 
p2
;

290 
t2
 = 
p1
 - 
p3
;

291 
t3
 = 
p1
 + 
p3
;

294 
block
[0][
i
] = 
t0
 + 
t3
;

295 
block
[1][
i
] = 
t1
 + 
t2
;

296 
block
[2][
i
] = 
t1
 - 
t2
;

297 
block
[3][
i
] = 
t0
 - 
t3
;

299 
	}
}

302 
	$hadam¬d2x2
(**
block
, 
tblock
[4])

304 
p0
,
p1
,
p2
,
p3
;

306 
p0
 = 
block
[0][0] + block[0][4];

307 
p1
 = 
block
[0][0] - block[0][4];

308 
p2
 = 
block
[4][0] + block[4][4];

309 
p3
 = 
block
[4][0] - block[4][4];

311 
tblock
[0] = (
p0
 + 
p2
);

312 
tblock
[1] = (
p1
 + 
p3
);

313 
tblock
[2] = (
p0
 - 
p2
);

314 
tblock
[3] = (
p1
 - 
p3
);

315 
	}
}

317 
	$ihadam¬d2x2
(
tblock
[4], 
block
[4])

319 
t0
,
t1
,
t2
,
t3
;

321 
t0
 = 
tblock
[0] +block[1];

322 
t1
 = 
tblock
[0] -block[1];

323 
t2
 = 
tblock
[2] +block[3];

324 
t3
 = 
tblock
[2] -block[3];

326 
block
[0] = (
t0
 + 
t2
);

327 
block
[1] = (
t1
 + 
t3
);

328 
block
[2] = (
t0
 - 
t2
);

329 
block
[3] = (
t1
 - 
t3
);

330 
	}
}

353 
	$fÜw¬d8x8
(**
block
, **
tblock
, 
pos_y
, 
pos_x
)

355 
i
, 
ii
;

356 
tmp
[64];

357 *
pTmp
 = 
tmp
, *
pblock
;

358 
a0
, 
a1
, 
a2
, 
a3
;

359 
p0
, 
p1
, 
p2
, 
p3
, 
p4
, 
p5
 ,
p6
, 
p7
;

360 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
;

363 
i
=
pos_y
; i <…os_y + 
BLOCK_SIZE_8x8
; i++)

365 
pblock
 = &
block
[
i
][
pos_x
];

366 
p0
 = *(
pblock
++);

367 
p1
 = *(
pblock
++);

368 
p2
 = *(
pblock
++);

369 
p3
 = *(
pblock
++);

370 
p4
 = *(
pblock
++);

371 
p5
 = *(
pblock
++);

372 
p6
 = *(
pblock
++);

373 
p7
 = *(
pblock
 );

375 
a0
 = 
p0
 + 
p7
;

376 
a1
 = 
p1
 + 
p6
;

377 
a2
 = 
p2
 + 
p5
;

378 
a3
 = 
p3
 + 
p4
;

380 
b0
 = 
a0
 + 
a3
;

381 
b1
 = 
a1
 + 
a2
;

382 
b2
 = 
a0
 - 
a3
;

383 
b3
 = 
a1
 - 
a2
;

385 
a0
 = 
p0
 - 
p7
;

386 
a1
 = 
p1
 - 
p6
;

387 
a2
 = 
p2
 - 
p5
;

388 
a3
 = 
p3
 - 
p4
;

390 
b4
 = 
a1
 + 
a2
 + ((
a0
 >> 1) +‡0);

391 
b5
 = 
a0
 - 
a3
 - ((
a2
 >> 1) +‡2);

392 
b6
 = 
a0
 + 
a3
 - ((
a1
 >> 1) +‡1);

393 
b7
 = 
a1
 - 
a2
 + ((
a3
 >> 1) +‡3);

395 *(
pTmp
++èð
b0
 + 
b1
;

396 *(
pTmp
++èð
b4
 + (
b7
 >> 2);

397 *(
pTmp
++èð
b2
 + (
b3
 >> 1);

398 *(
pTmp
++èð
b5
 + (
b6
 >> 2);

399 *(
pTmp
++èð
b0
 - 
b1
;

400 *(
pTmp
++èð
b6
 - (
b5
 >> 2);

401 *(
pTmp
++èð(
b2
 >> 1è- 
b3
;

402 *(
pTmp
++èð(
b4
 >> 2è- 
b7
;

406 
i
=0; i < 
BLOCK_SIZE_8x8
; i++)

408 
pTmp
 = 
tmp
 + 
i
;

409 
p0
 = *
pTmp
;

410 
p1
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

411 
p2
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

412 
p3
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

413 
p4
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

414 
p5
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

415 
p6
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

416 
p7
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

418 
a0
 = 
p0
 + 
p7
;

419 
a1
 = 
p1
 + 
p6
;

420 
a2
 = 
p2
 + 
p5
;

421 
a3
 = 
p3
 + 
p4
;

423 
b0
 = 
a0
 + 
a3
;

424 
b1
 = 
a1
 + 
a2
;

425 
b2
 = 
a0
 - 
a3
;

426 
b3
 = 
a1
 - 
a2
;

428 
a0
 = 
p0
 - 
p7
;

429 
a1
 = 
p1
 - 
p6
;

430 
a2
 = 
p2
 - 
p5
;

431 
a3
 = 
p3
 - 
p4
;

433 
b4
 = 
a1
 + 
a2
 + ((
a0
 >> 1) +‡0);

434 
b5
 = 
a0
 - 
a3
 - ((
a2
 >> 1) +‡2);

435 
b6
 = 
a0
 + 
a3
 - ((
a1
 >> 1) +‡1);

436 
b7
 = 
a1
 - 
a2
 + ((
a3
 >> 1) +‡3);

438 
ii
 = 
pos_x
 + 
i
;

439 
tblock
[
pos_y
 ][
ii
] = 
b0
 + 
b1
;

440 
tblock
[
pos_y
 + 1][
ii
] = 
b4
 + (
b7
 >> 2);

441 
tblock
[
pos_y
 + 2][
ii
] = 
b2
 + (
b3
 >> 1);

442 
tblock
[
pos_y
 + 3][
ii
] = 
b5
 + (
b6
 >> 2);

443 
tblock
[
pos_y
 + 4][
ii
] = 
b0
 - 
b1
;

444 
tblock
[
pos_y
 + 5][
ii
] = 
b6
 - (
b5
 >> 2);

445 
tblock
[
pos_y
 + 6][
ii
] = (
b2
 >> 1è- 
b3
;

446 
tblock
[
pos_y
 + 7][
ii
] = (
b4
 >> 2è- 
b7
;

448 
	}
}

450 
	$šv”£8x8
(**
tblock
, **
block
, 
pos_x
)

452 
i
, 
ii
;

453 
tmp
[64];

454 *
pTmp
 = 
tmp
, *
pblock
;

455 
a0
, 
a1
, 
a2
, 
a3
;

456 
p0
, 
p1
, 
p2
, 
p3
, 
p4
, 
p5
 ,
p6
, 
p7
;

457 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
;

460 
i
=0; i < 
BLOCK_SIZE_8x8
; i++)

462 
pblock
 = &
tblock
[
i
][
pos_x
];

463 
p0
 = *(
pblock
++);

464 
p1
 = *(
pblock
++);

465 
p2
 = *(
pblock
++);

466 
p3
 = *(
pblock
++);

467 
p4
 = *(
pblock
++);

468 
p5
 = *(
pblock
++);

469 
p6
 = *(
pblock
++);

470 
p7
 = *(
pblock
 );

472 
a0
 = 
p0
 + 
p4
;

473 
a1
 = 
p0
 - 
p4
;

474 
a2
 = 
p6
 - (
p2
 >> 1);

475 
a3
 = 
p2
 + (
p6
 >> 1);

477 
b0
 = 
a0
 + 
a3
;

478 
b2
 = 
a1
 - 
a2
;

479 
b4
 = 
a1
 + 
a2
;

480 
b6
 = 
a0
 - 
a3
;

482 
a0
 = -
p3
 + 
p5
 - 
p7
 - (p7 >> 1);

483 
a1
 = 
p1
 + 
p7
 - 
p3
 - (p3 >> 1);

484 
a2
 = -
p1
 + 
p7
 + 
p5
 + (p5 >> 1);

485 
a3
 = 
p3
 + 
p5
 + 
p1
 + (p1 >> 1);

488 
b1
 = 
a0
 + (
a3
>>2);

489 
b3
 = 
a1
 + (
a2
>>2);

490 
b5
 = 
a2
 - (
a1
>>2);

491 
b7
 = 
a3
 - (
a0
>>2);

493 *(
pTmp
++èð
b0
 + 
b7
;

494 *(
pTmp
++èð
b2
 - 
b5
;

495 *(
pTmp
++èð
b4
 + 
b3
;

496 *(
pTmp
++èð
b6
 + 
b1
;

497 *(
pTmp
++èð
b6
 - 
b1
;

498 *(
pTmp
++èð
b4
 - 
b3
;

499 *(
pTmp
++èð
b2
 + 
b5
;

500 *(
pTmp
++èð
b0
 - 
b7
;

504 
i
=0; i < 
BLOCK_SIZE_8x8
; i++)

506 
pTmp
 = 
tmp
 + 
i
;

507 
p0
 = *
pTmp
;

508 
p1
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

509 
p2
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

510 
p3
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

511 
p4
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

512 
p5
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

513 
p6
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

514 
p7
 = *(
pTmp
 +ð
BLOCK_SIZE_8x8
);

516 
a0
 = 
p0
 + 
p4
;

517 
a1
 = 
p0
 - 
p4
;

518 
a2
 = 
p6
 - (
p2
>>1);

519 
a3
 = 
p2
 + (
p6
>>1);

521 
b0
 = 
a0
 + 
a3
;

522 
b2
 = 
a1
 - 
a2
;

523 
b4
 = 
a1
 + 
a2
;

524 
b6
 = 
a0
 - 
a3
;

526 
a0
 = -
p3
 + 
p5
 - 
p7
 - (p7 >> 1);

527 
a1
 = 
p1
 + 
p7
 - 
p3
 - (p3 >> 1);

528 
a2
 = -
p1
 + 
p7
 + 
p5
 + (p5 >> 1);

529 
a3
 = 
p3
 + 
p5
 + 
p1
 + (p1 >> 1);

532 
b1
 = 
a0
 + (
a3
 >> 2);

533 
b7
 = 
a3
 - (
a0
 >> 2);

534 
b3
 = 
a1
 + (
a2
 >> 2);

535 
b5
 = 
a2
 - (
a1
 >> 2);

537 
ii
 = 
i
 + 
pos_x
;

538 
block
[0][
ii
] = 
b0
 + 
b7
;

539 
block
[1][
ii
] = 
b2
 - 
b5
;

540 
block
[2][
ii
] = 
b4
 + 
b3
;

541 
block
[3][
ii
] = 
b6
 + 
b1
;

542 
block
[4][
ii
] = 
b6
 - 
b1
;

543 
block
[5][
ii
] = 
b4
 - 
b3
;

544 
block
[6][
ii
] = 
b2
 + 
b5
;

545 
block
[7][
ii
] = 
b0
 - 
b7
;

547 
	}
}

	@lcommon/src/win32.c

15 
	~"glob®.h
"

18 #ifdeà
_WIN32


20 
LARGE_INTEGER
 
	gäeq
;

22 
	$g‘time
(
TIME_T
* 
time
)

24 #iâdeà
TIMING_DISABLE


25 
	`Qu”yP”fÜmªûCouÁ”
(
time
);

27 
	}
}

29 
št64
 
	$timediff
(
TIME_T
* 
¡¬t
, TIME_T* 
’d
)

31 #iâdeà
TIMING_DISABLE


32  (
št64
)((
’d
->
QuadP¬t
 - 
¡¬t
->QuadPart));

36 
	}
}

38 
	$š™_time
()

40 
	`Qu”yP”fÜmªûF»qu’cy
(&
äeq
);

41 
	}
}

43 
št64
 
	$tim’Üm
(
št64
 
cur_time
)

45 #iâdeà
TIMING_DISABLE


46  (
št64
)(
cur_time
 * 1000 /(
äeq
.
QuadP¬t
));

50 
	}
}

54 
timezÚe
 
	gtz
;

56 
	$g‘time
(
TIME_T
* 
time
)

58 
	`g‘timeofday
(
time
, &
tz
);

59 
	}
}

61 
	$š™_time
()

63 
	}
}

65 
št64
 
	$timediff
(
TIME_T
* 
¡¬t
, TIME_T* 
’d
)

67 
t1
, 
t2
;

69 
t1
 = 
’d
->
tv_£c
 - 
¡¬t
->tv_sec;

70 
t2
 = 
’d
->
tv_u£c
 - 
¡¬t
->tv_usec;

71  (
št64
è
t2
 + (št64è
t1
 * (int64) 1000000;

72 
	}
}

74 
št64
 
	$tim’Üm
(
št64
 
cur_time
)

76  (
št64
)(
cur_time
 / (int64) 1000);

77 
	}
}

	@lencod/inc/annexb.h

15 #iâdeà
_ANNEXB_H_


16 
	#_ANNEXB_H_


	)

18 
	~"ÇlucommÚ.h
"

20 
Wr™eAÂexbNALU
 (
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
n
, 
FILE
 **
f_ªÃxb
);

21 
O³nAÂexbFže
 (*
â
, 
FILE
 **
f_ªÃxb
);

22 
Clo£AÂexbFže
(
FILE
 *
f_ªÃxb
);

	@lencod/inc/biariencode.h

23 #iâdeà
_BIARIENCOD_H_


24 
	#_BIARIENCOD_H_


	)

34 
	#B_BITS
 10

35 
	#BITS_TO_LOAD
 16

	)

36 
	#MAX_BITS
 26

37 
	#MASK_BITS
 18

38 
	#ONE
 0x04000000

39 
	#ONE_M1
 0x03FFFFFF

40 
	#HALF
 0x01FE

41 
	#QUARTER
 0x0100

42 
	#MIN_BITS_TO_GO
 0

	)

43 
	#B_LOAD_MASK
 0xFFFF

44 

	)

45 
g‘_pic_bš_couÁ
(
VideoP¬am‘”s
 *
p_Vid
);

46 
»£t_pic_bš_couÁ
(
VideoP¬am‘”s
 *
p_Vid
);

47 
£t_pic_bš_couÁ
 (
VideoP¬am‘”s
 *
p_Vid
, 
EncodšgEnvœÚm’tPŒ
 
“p
);

49 
¬›nco_¡¬t_’codšg
(
EncodšgEnvœÚm’tPŒ
 
“p
, *
code_bufãr
, *
code_Ën
);

50 
¬›nco_»£t_EC
 (
EncodšgEnvœÚm’tPŒ
 
“p
);

51 
¬›nco_dÚe_’codšg
 (
Maüoblock
 *
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p
);

52 
bŸri_š™_cÚ‹xt
 (
qp
, 
BiCÚ‹xtTy³PŒ
 
ùx
, cÚ¡ * 
ši
);

53 
bŸri_’code_symbÞ
 (
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
, 
BiCÚ‹xtTy³PŒ
 
bi_ù
 );

54 
bŸri_’code_symbÞ_eq_´ob
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
);

55 
bŸri_’code_symbÞ_fš®
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
);

63 
šlše
 
	$¬›nco_b™s_wr™‹n
(
EncodšgEnvœÚm’tPŒ
 
“p
)

65  (((*
“p
->
Ecode¡rm_Ën
è+ƒ•->
Epbuf
 + 1è<< 3è+ (“p->
Echunks_out¡ªdšg
 * 
BITS_TO_LOAD
è+ BITS_TO_LOAD -ƒ•->
Eb™s_to_go
;

66 
	}
}

	@lencod/inc/block.h

18 #iâdeà
_BLOCK_H_


19 
	#_BLOCK_H_


	)

22 
	~"glob®.h
"

24 
»sidu®_ŒªsfÜm_quªt_luma_4x4
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
, *
cÛff_co¡
, 
šŒa
);

26 cÚ¡ 
by‹
 
	gQP_SCALE_CR
[52]=

33 cÚ¡ 
	gsubblk_off£t_x
[3][8][4] =

68 cÚ¡ 
	gsubblk_off£t_y
[3][8][4] =

	@lencod/inc/cabac.h

20 #iâdeà
_CABAC_H_


21 
	#_CABAC_H_


	)

23 cÚ¡ 
by‹
 
	gmaxpos
 [] = {15, 14, 63, 31, 31, 15, 3, 14, 7, 15, 15, 14, 63, 31, 31, 15, 15, 14, 63, 31, 31, 15};

24 cÚ¡ 
by‹
 
	gc1isdc
 [] = { 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1};

26 cÚ¡ 
by‹
 
	gty³2ùx_bcbp
[] = { 0, 1, 2, 3, 3, 4, 5, 6, 5, 5, 10, 11, 12, 13, 13, 14, 16, 17, 18, 19, 19, 20};

27 cÚ¡ 
by‹
 
	gty³2ùx_m­
 [] = { 0, 1, 2, 3, 4, 5, 6, 7, 6, 6, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21};

28 cÚ¡ 
by‹
 
	gty³2ùx_Ï¡
[] = { 0, 1, 2, 3, 4, 5, 6, 7, 6, 6, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21};

29 cÚ¡ 
by‹
 
	gty³2ùx_Úe
 [] = { 0, 1, 2, 3, 3, 4, 5, 6, 5, 5, 10, 11, 12, 13, 13, 14, 16, 17, 18, 19, 19, 20};

30 cÚ¡ 
by‹
 
	gty³2ùx_abs
 [] = { 0, 1, 2, 3, 3, 4, 5, 6, 5, 5, 10, 11, 12, 13, 13, 14, 16, 17, 18, 19, 19, 20};

31 cÚ¡ 
by‹
 
	gmax_c2
 [] = { 4, 4, 4, 4, 4, 4, 3, 4, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4};

34 cÚ¡ 
by‹
* 
pos2ùx_m­
 [];

35 cÚ¡ 
by‹
* 
pos2ùx_m­_št
 [];

36 cÚ¡ 
by‹
* 
pos2ùx_Ï¡
 [];

39 
MÙiÚInfoCÚ‹xts
* 
ü—‹_cÚ‹xts_MÙiÚInfo
 ();

40 
Textu»InfoCÚ‹xts
* 
ü—‹_cÚ‹xts_Textu»Info
();

42 
d–‘e_cÚ‹xts_MÙiÚInfo
 (
MÙiÚInfoCÚ‹xts
 *
’co_ùx
);

43 
d–‘e_cÚ‹xts_Textu»Info
 (
Textu»InfoCÚ‹xts
 *
’co_ùx
);

44 
wr™eMB_I_ty³Info_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

45 
wr™eMB_B_ty³Info_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

46 
wr™eMB_P_ty³Info_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

47 
wr™eIÁ¿P»dMode_CABAC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

48 
wr™eB8_ty³Info_CABAC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

49 
wr™eB8_B_ty³Info_CABAC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

51 
wr™eRefPic_B_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

52 
wr™eRefPic_P_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

54 
wr™eMVD_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

55 
wr™eCBP_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

56 
wr™eDquªt_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

57 
wr™eRunLev–_CABAC
 (
Maüoblock
* 
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

58 
wr™eCIP»dMode_CABAC
 (
Maüoblock
* 
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

59 
´št_ùx_Textu»Info
 (
Textu»InfoCÚ‹xts
 *
’co_ùx
);

60 
wr™eMB_Psk_æagInfo_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

61 
wr™eMB_Bsk_æagInfo_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

62 
wr™eF›ldModeInfo_CABAC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

63 
wr™eCBP_BIT_CABAC
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b™
, 
cbp
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
Textu»InfoCÚ‹xts
 *
ùx
);

65 
CheckAvažabž™yOfNeighbÜsCABAC
 (
Maüoblock
* 
cu¼MB
);

66 
wr™eMB_ŒªsfÜm_size_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

68 
wr™e_ªd_¡Üe_CBP_block_b™_444
 (
Maüoblock
* 
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cbp_b™
, 
Textu»InfoCÚ‹xts
* 
‹x_ùx
);

69 
wr™e_ªd_¡Üe_CBP_block_b™
 (
Maüoblock
* 
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cbp_b™
, 
Textu»InfoCÚ‹xts
* 
‹x_ùx
);

	@lencod/inc/cconv_yuv2rgb.h

17 #iâdeà
_CCONV_YUV2RGB_H_


18 
	#_CCONV_YUV2RGB_H_


	)

20 
	~"img_di¡ÜtiÚ.h
"

22 
š™_YUVtoRGB
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

23 
YUVtoRGB
 (
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
YUV
, ImageSŒuùu» *
RGB
);

24 
ü—‹_RGB_memÜy
(
VideoP¬am‘”s
 *
p_Vid
);

25 
d–‘e_RGB_memÜy
(
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/configfile.h

11 
	~"fmo.h
"

13 #iâdeà
_CONFIGFILE_H_


14 
	#_CONFIGFILE_H_


	)

16 
	~"cÚfig_commÚ.h
"

18 
	#DEFAULTCONFIGFILENAME
 "’cod”.cfg"

	)

20 
	#PROFILE_IDC
 88

	)

21 
	#LEVEL_IDC
 21

	)

23 
IÅutP¬am‘”s
 
	gcfg·¿ms
;

26 #ifdeà
INCLUDED_BY_CONFIGFILE_C


32 
M­pšg
 
	gM­
[] = {

33 {"ProfžeIDC", &
cfg·¿ms
.
ProfžeIDC
, 0, (è
PROFILE_IDC
, 0, 0.0, 0.0, },

34 {"IÁ¿Profže", &
cfg·¿ms
.
IÁ¿Profže
, 0, 0.0, 1, 0.0, 1.0, },

35 {"Lev–IDC", &
cfg·¿ms
.
Lev–IDC
, 0, (è
LEVEL_IDC
, 0, 0.0, 0.0, },

36 {"F¿meR©e", &
cfg·¿ms
.
sourû
.
äame_¿‹
, 2, (è
INIT_FRAME_RATE
, 1, 0.0, 480.0, },

37 {"EÇbË32PuÎdown", &
cfg·¿ms
.
’abË_32_puÎdown
, 0, 0.0, 1, 0.0, 2.0, },

38 {"Re£ndSPS", &
cfg·¿ms
.
Re£ndSPS
, 0, 0.0, 1, 0.0, 3.0, },

39 {"S¹F¿me", &
cfg·¿ms
.
¡¬t_äame
, 0, 0.0, 2, 0.0, 0.0, },

40 {"IÁ¿P”iod", &
cfg·¿ms
.
šŒa_³riod
, 0, 0.0, 2, 0.0, 0.0, },

41 {"IDRP”iod", &
cfg·¿ms
.
idr_³riod
, 0, 0.0, 2, 0.0, 0.0, },

42 {"IÁ¿D–ay", &
cfg·¿ms
.
šŒa_d–ay
, 0, 0.0, 2, 0.0, 0.0, },

43 {"Ad­tiveIÁ¿P”iod", &
cfg·¿ms
.
ad­tive_šŒa_³riod
, 0, 0.0, 1, 0.0, 1.0, },

44 {"Ad­tiveIDRP”iod", &
cfg·¿ms
.
ad­tive_idr_³riod
, 0, 0.0, 1, 0.0, 2.0, },

45 {"EÇbËO³nGOP", &
cfg·¿ms
.
EÇbËO³nGOP
, 0, 0.0, 1, 0.0, 1.0, },

46 {"EÇbËIDRGOP", &
cfg·¿ms
.
EÇbËIDRGOP
, 0, 0.0, 1, 0.0, 1.0, },

47 {"F¿mesToBeEncoded", &
cfg·¿ms
.
no_äames
, 0, 1.0, 2, -1.0, 0.0, },

48 {"QPISliû", &
cfg·¿ms
.
qp
[
I_SLICE
], 0, 24.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

49 {"QPPSliû", &
cfg·¿ms
.
qp
[
P_SLICE
], 0, 24.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

50 {"QPBSliû", &
cfg·¿ms
.
qp
[
B_SLICE
], 0, 24.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

51 {"QPSPSliû", &
cfg·¿ms
.
qp
[
SP_SLICE
], 0, 24.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

52 {"QPSISliû", &
cfg·¿ms
.
qp
[
SI_SLICE
], 0, 24.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

53 {"ChªgeQPF¿me", &
cfg·¿ms
.
qp2äame
, 0, 0.0, 2, 0.0, 0.0, },

54 {"ChªgeQPI", &
cfg·¿ms
.
qp2off
[
I_SLICE
], 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

55 {"ChªgeQPP", &
cfg·¿ms
.
qp2off
[
P_SLICE
], 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

56 {"ChªgeQPB", &
cfg·¿ms
.
qp2off
[
B_SLICE
], 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

57 {"ChªgeQPSP", &
cfg·¿ms
.
qp2off
[
SP_SLICE
], 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

58 {"ChªgeQPSI", &
cfg·¿ms
.
qp2off
[
SI_SLICE
], 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

59 {"QPSP2Sliû", &
cfg·¿ms
.
qp¥
, 0, 0.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

60 {"F¿meSk", &
cfg·¿ms
.
äame_sk
, 0, 0.0, 2, 0.0, 0.0, },

61 {"Di§bËSub³lME", &
cfg·¿ms
.
Di§bËSub³lME
[0], 0, 0.0, 1, 0.0, 1.0, },

62 {"S—rchRªge", &
cfg·¿ms
.
£¬ch_¿nge
[0], 0, 16.0, 2, 0.0, 0.0, },

63 {"Numb”Reã»nûF¿mes", &
cfg·¿ms
.
num_»f_äames
, 0, 1.0, 1, 0.0, 16.0, },

64 {"PLi¡0Reã»nûs", &
cfg·¿ms
.
P_Li¡0_»fs
[0], 0, 0.0, 1, 0.0, 16.0, },

65 {"BLi¡0Reã»nûs", &
cfg·¿ms
.
B_Li¡0_»fs
[0], 0, 0.0, 1, 0.0, 16.0, },

66 {"BLi¡1Reã»nûs", &
cfg·¿ms
.
B_Li¡1_»fs
[0], 0, 1.0, 1, 0.0, 16.0, },

67 {"Numb”OfV›ws", &
cfg·¿ms
.
num_of_v›ws
, 0, 1.0, 1, 1.0, 2.0, },

68 #ià(
MVC_EXTENSION_ENABLE
)

69 {"V›w1CÚfigFže", &
cfg·¿ms
.
V›w1CÚfigName
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

71 {"Log2MaxFNumMšus4", &
cfg·¿ms
.
Log2MaxFNumMšus4
, 0, 0.0, 1, -1.0, 12.0, },

72 {"Log2MaxPOCLsbMšus4", &
cfg·¿ms
.
Log2MaxPOCLsbMšus4
, 0, 2.0, 1, -1.0, 12.0, },

73 {"G’”©eMuÉËPPS", &
cfg·¿ms
.
G’”©eMuÉËPPS
, 0, 0.0, 1, 0.0, 1.0, },

74 {"Re£ndPPS", &
cfg·¿ms
.
Re£ndPPS
, 0, 0.0, 1, 0.0, 1.0, },

75 {"S’dAUD", &
cfg·¿ms
.
S’dAUD
, 0, 0.0, 1, 0.0, 3.0, },

76 {"SourûWidth", &
cfg·¿ms
.
sourû
.
width
[0], 0, 176.0, 2, 0.0, 0.0, },

77 {"SourûHeight", &
cfg·¿ms
.
sourû
.
height
[0], 0, 144.0, 2, 0.0, 0.0, },

78 {"SourûResize", &
cfg·¿ms
.
¤c_»size
, 0, 0.0, 1, 0.0, 1.0, },

79 {"OuutWidth", &
cfg·¿ms
.
ouut
.
width
[0], 0, 176.0, 2, 16.0, 0.0, },

80 {"OuutHeight", &
cfg·¿ms
.
ouut
.
height
[0], 0, 144.0, 2, 16.0, 0.0, },

81 {"G¿ysÿË", &
cfg·¿ms
.
g¿ysÿË
, 0, 0.0, 0, 0.0, 1.0, },

82 {"MbLšeIÁ¿Upd©e", &
cfg·¿ms
.
šŒa_upd
, 0, 0.0, 1, 0.0, 1.0, },

83 {"SliûMode", &
cfg·¿ms
.
¦iû_mode
, 0, 0.0, 1, 0.0, 3.0, },

84 {"SliûArgum’t", &
cfg·¿ms
.
¦iû_¬gum’t
, 0, 1.0, 2, 1.0, 1.0, },

85 {"U£CÚ¡¿šedIÁ¿P»d", &
cfg·¿ms
.
U£CÚ¡¿šedIÁ¿P»d
, 0, 0.0, 1, 0.0, 1.0, },

86 {"IÅutFže", &
cfg·¿ms
.
šput_fže1
.
âame
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

87 {"IÅutH—d”L’gth", &
cfg·¿ms
.
šfže_h—d”
, 0, 0.0, 2, 0.0, 1.0, },

88 {"OuutFže", &
cfg·¿ms
.
outfže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

89 {"RecÚFže", &
cfg·¿ms
.
RecÚFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

90 {"T¿ûFže", &
cfg·¿ms
.
T¿ûFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

91 {"StsFže", &
cfg·¿ms
.
StsFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

92 {"Di¥o§bËP", &
cfg·¿ms
.
Di¥o§bËP
, 0, 0.0, 1, 0.0, 1.0, },

93 {"S‘Fœ¡AsLÚgT”m", &
cfg·¿ms
.
S‘Fœ¡AsLÚgT”m
, 0, 0.0, 1, 0.0, 1.0, },

94 {"MuÉiSourûD©a", &
cfg·¿ms
.
MuÉiSourûD©a
, 0, 0.0, 0, 0.0, 2.0, },

95 {"IÅutFže3", &
cfg·¿ms
.
šput_fže3
.
âame
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

96 {"SEIVUI32PuÎdown", &
cfg·¿ms
.
SEIVUI32PuÎdown
, 0, 0.0, 1, 0.0, 5.0, },

97 {"SEIFPATy³", &
cfg·¿ms
.
SEIFPATy³
, 0, -1, 1, -1, 7, },

99 {"ProûssIÅut", &
cfg·¿ms
.
ProûssIÅut
, 0, 0.0, 1, 0.0, 4.0, },

100 {"Di¥PQPOff£t", &
cfg·¿ms
.
Di¥PQPOff£t
, 0, 0.0, 0,-51.0, 51.0, },

101 {"Numb”BF¿mes", &
cfg·¿ms
.
Numb”BF¿mes
, 0, 0.0, 2, 0.0, 0.0, },

102 {"PR•ÏûBSliû", &
cfg·¿ms
.
PR•ÏûBSliû
, 0, 0.0, 1, 0.0, 1.0, },

103 {"BRefPicQPOff£t", &
cfg·¿ms
.
qpBRSOff£t
, 0, 0.0, 0,-51.0, 51.0, },

104 {"DœeùModeTy³", &
cfg·¿ms
.
dœeù_¥©Ÿl_mv_´ed_æag
, 0, 0.0, 1, 0.0, 1.0, },

105 {"DœeùInã»nûFÏg", &
cfg·¿ms
.
dœeùInã»nûFÏg
, 0, 1.0, 1, 0.0, 1.0, },

106 {"SPPiùu»P”iodic™y", &
cfg·¿ms
.
¥_³riodic™y
, 0, 0.0, 2, 0.0, 0.0, },

107 {"SI_FRAMES", &
cfg·¿ms
.
si_äame_šdiÿtÜ
, 0, 0.0, 1, 0.0, 1.0, },

108 {"SP_ouut", &
cfg·¿ms
.
¥_ouut_šdiÿtÜ
, 0, 0.0, 1, 0.0, 1.0, },

109 {"SP_ouut_Çme", &
cfg·¿ms
.
¥_ouut_fž’ame
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

110 {"SPSw™chP”iod", &
cfg·¿ms
.
¥_sw™ch_³riod
, 0, 0.0, 2, 0.0, 0.0, },

111 {"SP2_FRAMES", &
cfg·¿ms
.
¥2_äame_šdiÿtÜ
, 0, 0.0, 1, 0.0, 1.0, },

112 {"SP2_šput_Çme1", &
cfg·¿ms
.
¥2_šput_fž’ame1
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

113 {"SP2_šput_Çme2", &
cfg·¿ms
.
¥2_šput_fž’ame2
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

114 {"SymbÞMode", &
cfg·¿ms
.
symbÞ_mode
, 0, 0.0, 1, (è
CAVLC
, (è
CABAC
, },

115 {"OutFžeMode", &
cfg·¿ms
.
of_mode
, 0, 0.0, 1, 0.0, 1.0, },

116 {"P¬t™iÚMode", &
cfg·¿ms
.
·¹™iÚ_mode
, 0, 0.0, 1, 0.0, 1.0, },

117 {"PSliûSk", &
cfg·¿ms
.
IÁ”S—rch
[0][0][0], 0, 1.0, 1, 0.0, 1.0, },

118 {"PSliûS—rch16x16", &
cfg·¿ms
.
IÁ”S—rch
[0][0][1], 0, 1.0, 1, 0.0, 1.0, },

119 {"PSliûS—rch16x8", &
cfg·¿ms
.
IÁ”S—rch
[0][0][2], 0, 1.0, 1, 0.0, 1.0, },

120 {"PSliûS—rch8x16", &
cfg·¿ms
.
IÁ”S—rch
[0][0][3], 0, 1.0, 1, 0.0, 1.0, },

121 {"PSliûS—rch8x8", &
cfg·¿ms
.
IÁ”S—rch
[0][0][4], 0, 1.0, 1, 0.0, 1.0, },

122 {"PSliûS—rch8x4", &
cfg·¿ms
.
IÁ”S—rch
[0][0][5], 0, 1.0, 1, 0.0, 1.0, },

123 {"PSliûS—rch4x8", &
cfg·¿ms
.
IÁ”S—rch
[0][0][6], 0, 1.0, 1, 0.0, 1.0, },

124 {"PSliûS—rch4x4", &
cfg·¿ms
.
IÁ”S—rch
[0][0][7], 0, 1.0, 1, 0.0, 1.0, },

126 {"BSliûDœeù", &
cfg·¿ms
.
IÁ”S—rch
[0][1][0], 0, 1.0, 1, 0.0, 1.0, },

127 {"BSliûS—rch16x16", &
cfg·¿ms
.
IÁ”S—rch
[0][1][1], 0, 1.0, 1, 0.0, 1.0, },

128 {"BSliûS—rch16x8", &
cfg·¿ms
.
IÁ”S—rch
[0][1][2], 0, 1.0, 1, 0.0, 1.0, },

129 {"BSliûS—rch8x16", &
cfg·¿ms
.
IÁ”S—rch
[0][1][3], 0, 1.0, 1, 0.0, 1.0, },

130 {"BSliûS—rch8x8", &
cfg·¿ms
.
IÁ”S—rch
[0][1][4], 0, 1.0, 1, 0.0, 1.0, },

131 {"BSliûS—rch8x4", &
cfg·¿ms
.
IÁ”S—rch
[0][1][5], 0, 1.0, 1, 0.0, 1.0, },

132 {"BSliûS—rch4x8", &
cfg·¿ms
.
IÁ”S—rch
[0][1][6], 0, 1.0, 1, 0.0, 1.0, },

133 {"BSliûS—rch4x4", &
cfg·¿ms
.
IÁ”S—rch
[0][1][7], 0, 1.0, 1, 0.0, 1.0, },

135 {"BiP»dMÙiÚE¡im©iÚ", &
cfg·¿ms
.
BiP»dMÙiÚE¡im©iÚ
, 0, 0.0, 1, 0.0, 1.0, },

136 {"BiP»dS—rch16x16", &
cfg·¿ms
.
BiP»dS—rch
[0], 0, 1.0, 1, 0.0, 1.0, },

137 {"BiP»dS—rch16x8", &
cfg·¿ms
.
BiP»dS—rch
[1], 0, 0.0, 1, 0.0, 1.0, },

138 {"BiP»dS—rch8x16", &
cfg·¿ms
.
BiP»dS—rch
[2], 0, 0.0, 1, 0.0, 1.0, },

139 {"BiP»dS—rch8x8", &
cfg·¿ms
.
BiP»dS—rch
[3], 0, 0.0, 1, 0.0, 1.0, },

140 {"BiP»dMERefšem’ts", &
cfg·¿ms
.
BiP»dMERefšem’ts
, 0, 0.0, 1, 0.0, 5.0, },

141 {"BiP»dMES—rchRªge", &
cfg·¿ms
.
BiP»dMES—rchRªge
[0], 0, 8.0, 2, 0.0, 0.0, },

142 {"BiP»dMESubP–", &
cfg·¿ms
.
BiP»dMESubP–
, 0, 1.0, 1, 0.0, 2.0, },

143 {"Di§bËIÁ¿InIÁ”", &
cfg·¿ms
.
Di§bËIÁ¿InIÁ”
[0], 0, 0.0, 1, 0.0, 1.0, },

144 {"IÁ¿Di§bËIÁ”OÆy", &
cfg·¿ms
.
IÁ¿Di§bËIÁ”OÆy
, 0, 0.0, 1, 0.0, 1.0, },

145 {"Di§bËIÁ¿4x4", &
cfg·¿ms
.
Di§bËIÁ¿4x4
, 0, 0.0, 1, 0.0, 1.0, },

146 {"Di§bËIÁ¿16x16", &
cfg·¿ms
.
Di§bËIÁ¿16x16
, 0, 0.0, 1, 0.0, 1.0, },

147 {"IÁ¿4x4P¬Di§bË", &
cfg·¿ms
.
IÁ¿4x4P¬Di§bË
, 0, 0.0, 1, 0.0, 1.0, },

148 {"IÁ¿4x4DŸgDi§bË", &
cfg·¿ms
.
IÁ¿4x4DŸgDi§bË
, 0, 0.0, 1, 0.0, 1.0, },

149 {"IÁ¿4x4DœDi§bË", &
cfg·¿ms
.
IÁ¿4x4DœDi§bË
, 0, 0.0, 1, 0.0, 1.0, },

150 {"IÁ¿16x16P¬Di§bË", &
cfg·¿ms
.
IÁ¿16x16P¬Di§bË
, 0, 0.0, 1, 0.0, 1.0, },

151 {"IÁ¿16x16PÏÃDi§bË", &
cfg·¿ms
.
IÁ¿16x16PÏÃDi§bË
, 0, 0.0, 1, 0.0, 1.0, },

152 {"EÇbËIPCM", &
cfg·¿ms
.
EÇbËIPCM
, 0, 0.0, 1, 0.0, 2.0, },

153 {"ChromaIÁ¿Di§bË", &
cfg·¿ms
.
ChromaIÁ¿Di§bË
, 0, 0.0, 1, 0.0, 1.0, },

154 {"RDO±imiz©iÚ", &
cfg·¿ms
.
rdÝt
, 0, 0.0, 1, 0.0, 4.0, },

156 {"Di¡ÜtiÚE¡im©iÚ", &
cfg·¿ms
.
de
, 0, 1.0, 2, 0.0, 8.0, },

157 {"SubMBCodšgS‹", &
cfg·¿ms
.
subMBCodšgS‹
, 0, 2.0, 1, 0.0, 2.0, },

158 {"I16RDO±", &
cfg·¿ms
.
I16rdo
, 0, 0.0, 1, 0.0, 1.0, },

159 {"MDReã»nû", &
cfg·¿ms
.
MDReã»nû
[0], 0, 0.0, 1, 0.0, 1.0, },

160 {"EnhLay”MDReã»nû", &
cfg·¿ms
.
MDReã»nû
[1], 0, 0.0, 1, 0.0, 1.0, },

161 {"Di¡ÜtiÚSSIM", &
cfg·¿ms
.
Di¡ÜtiÚ
[
SSIM
], 0, 0.0, 1, 0.0, 1.0, },

162 {"Di¡ÜtiÚMS_SSIM", &
cfg·¿ms
.
Di¡ÜtiÚ
[
MS_SSIM
], 0, 0.0, 1, 0.0, 1.0, },

163 {"SSIMOv”ÏpSize", &
cfg·¿ms
.
SSIMOv”ÏpSize
, 0, 1.0, 2, 1.0, 1.0, },

164 {"Di¡ÜtiÚYUVtoRGB", &
cfg·¿ms
.
Di¡ÜtiÚYUVtoRGB
, 0, 0.0, 1, 0.0, 1.0, },

165 {"CtxAd±Lag¿ngeMuÉ", &
cfg·¿ms
.
CtxAd±Lag¿ngeMuÉ
, 0, 0.0, 1, 0.0, 1.0, },

166 {"Fa¡CrIÁ¿DecisiÚ", &
cfg·¿ms
.
Fa¡CrIÁ¿DecisiÚ
, 0, 0.0, 1, 0.0, 1.0, },

167 {"Di§bËTh»shÞdšg", &
cfg·¿ms
.
di¡h»s
, 0, 0.0, 1, 0.0, 2.0, },

168 {"Di§bËBSkRDO", &
cfg·¿ms
.
nobsk
, 0, 0.0, 1, 0.0, 1.0, },

169 {"BŸsSkRDO", &
cfg·¿ms
.
BŸsSkRDO
, 0, 0.0, 1, 0.0, 1.0, },

170 {"FÜûTrueR©eRDO", &
cfg·¿ms
.
FÜûTrueR©eRDO
, 0, 0.0, 1, 0.0, 2.0, },

171 {"LossR©eA", &
cfg·¿ms
.
LossR©eA
, 2, 0.0, 2, 0.0, 0.0, },

172 {"LossR©eB", &
cfg·¿ms
.
LossR©eB
, 2, 0.0, 2, 0.0, 0.0, },

173 {"LossR©eC", &
cfg·¿ms
.
LossR©eC
, 2, 0.0, 2, 0.0, 0.0, },

174 {"Fœ¡F¿meCÜ»ù", &
cfg·¿ms
.
Fœ¡F¿meCÜ»ù
, 0, 0.0, 2, 0.0, 0.0, },

175 {"Numb”OfDecod”s", &
cfg·¿ms
.
NoOfDecod”s
, 0, 0.0, 2, 0.0, 0.0, },

176 {"E¼ÜCÚû®m’t", &
cfg·¿ms
.
E¼ÜCÚû®m’t
, 0, 0.0, 2, 0.0, 0.0, },

177 {"Re¡riùRefF¿mes", &
cfg·¿ms
.
Re¡riùRef
 , 0, 0.0, 1, 0.0, 1.0, },

178 #ifdeà
_LEAKYBUCKET_


179 {"Numb”ofL—kyBuck‘s", &
cfg·¿ms
.
Numb”L—kyBuck‘s
, 0, 2.0, 1, 2.0, 255.0, },

180 {"L—kyBuck‘R©eFže", &
cfg·¿ms
.
L—kyBuck‘R©eFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

181 {"L—kyBuck‘P¬amFže", &
cfg·¿ms
.
L—kyBuck‘P¬amFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

183 {"PicIÁ”Ïû", &
cfg·¿ms
.
PicIÁ”Ïû
, 0, 0.0, 1, 0.0, 3.0, },

184 {"MbIÁ”Ïû", &
cfg·¿ms
.
MbIÁ”Ïû
, 0, 0.0, 1, 0.0, 3.0, },

186 {"IÁ¿BÙtom", &
cfg·¿ms
.
IÁ¿BÙtom
, 0, 0.0, 1, 0.0, 1.0, },

188 {"NumF¿mesInELay”SubSeq", &
cfg·¿ms
.
NumF¿mesInELSubSeq
, 0, 0.0, 2, 0.0, 0.0, },

189 {"RªdomIÁ¿MBReäesh", &
cfg·¿ms
.
RªdomIÁ¿MBReäesh
, 0, 0.0, 2, 0.0, 0.0, },

190 {"Weigh‹dP»diùiÚ", &
cfg·¿ms
.
Weigh‹dP»diùiÚ
, 0, 0.0, 1, 0.0, 1.0, },

191 {"Weigh‹dB»diùiÚ", &
cfg·¿ms
.
Weigh‹dB»diùiÚ
, 0, 0.0, 1, 0.0, 2.0, },

192 {"WPM‘hod", &
cfg·¿ms
.
WPM‘hod
, 0, 0.0, 1, 0.0, 3.0, },

193 {"WPI‹rMC", &
cfg·¿ms
.
WPI‹rMC
, 0, 0.0, 1, 0.0, 1.0, },

194 {"ChromaWeightSuµÜt", &
cfg·¿ms
.
ChromaWeightSuµÜt
, 0, 0.0, 1, 0.0, 1.0, },

195 {"EnhªûdBWeightSuµÜt", &
cfg·¿ms
.
EnhªûdBWeightSuµÜt
, 0, 0.0, 1, 0.0, 2.0, },

196 {"U£Weigh‹dReã»nûME", &
cfg·¿ms
.
U£Weigh‹dReã»nûME
, 0, 0.0, 1, 0.0, 1.0, },

197 {"RDPiùu»DecisiÚ", &
cfg·¿ms
.
RDPiùu»DecisiÚ
, 0, 0.0, 1, 0.0, 1.0, },

198 {"RDPSliûBTe¡", &
cfg·¿ms
.
RDPSliûBTe¡
, 0, 0.0, 1, 0.0, 1.0, },

199 {"RDPSliûITe¡", &
cfg·¿ms
.
RDPSliûITe¡
, 0, 1.0, 1, 0.0, 1.0, },

200 {"RDPiùu»MaxPassISliû", &
cfg·¿ms
.
RDPiùu»MaxPassISliû
, 0, 1.0, 1, 1.0, 3.0, },

201 {"RDPiùu»MaxPassPSliû", &
cfg·¿ms
.
RDPiùu»MaxPassPSliû
, 0, 2.0, 1, 1.0, 6.0, },

202 {"RDPiùu»MaxPassBSliû", &
cfg·¿ms
.
RDPiùu»MaxPassBSliû
, 0, 3.0, 1, 1.0, 6.0, },

203 {"RDPiùu»Deblockšg", &
cfg·¿ms
.
RDPiùu»Deblockšg
, 0, 0.0, 1, 0.0, 1.0, },

204 {"RDPiùu»DœeùMode", &
cfg·¿ms
.
RDPiùu»DœeùMode
, 0, 0.0, 1, 0.0, 1.0, },

205 {"RDPiùu»F¿meQPPSliû", &
cfg·¿ms
.
RDPiùu»F¿meQPPSliû
, 0, 0.0, 1, 0.0, 1.0, },

206 {"RDPiùu»F¿meQPBSliû", &
cfg·¿ms
.
RDPiùu»F¿meQPBSliû
, 0, 0.0, 1, 0.0, 1.0, },

207 {"SkIÁ¿InIÁ”Sliûs", &
cfg·¿ms
.
SkIÁ¿InIÁ”Sliûs
, 0, 0.0, 1, 0.0, 1.0, },

208 {"PSliûSkDecisiÚM‘hod", &
cfg·¿ms
.
PSliûSkDecisiÚM‘hod
, 0, 0.0, 1, 0.0, 5.0, },

209 {"BReã»nûPiùu»s", &
cfg·¿ms
.
BRefPiùu»s
, 0, 0.0, 1, 0.0, 2.0, },

210 {"H›¿rchiÿlCodšg", &
cfg·¿ms
.
H›¿rchiÿlCodšg
, 0, 0.0, 1, 0.0, 3.0, },

211 {"H›¿rchyLev–QPEÇbË", &
cfg·¿ms
.
H›¿rchyLev–QPEÇbË
, 0, 0.0, 1, 0.0, 1.0, },

212 {"Ex¶ic™H›¿rchyFÜm©", &
cfg·¿ms
.
Ex¶ic™H›¿rchyFÜm©
, 1, 0.0, 0, 0.0, 0.0, 
INPUT_TEXT_SIZE
,},

213 {"Ex¶ic™SeqCodšg", &
cfg·¿ms
.
Ex¶ic™SeqCodšg
, 0, 0.0, 1, 0.0, 3.0, },

214 {"Ex¶ic™SeqFže", &
cfg·¿ms
.
Ex¶ic™SeqFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

215 {"LowD–ay", &
cfg·¿ms
.
LowD–ay
, 0, 0.0, 1, 0.0, 1.0, },

216 {"Reã»nûReÜd”", &
cfg·¿ms
.
Reã»nûReÜd”
, 0, 0.0, 1, 0.0, 2.0, },

217 {"EÇbËReÜd”B¦iû", &
cfg·¿ms
.
EÇbËReÜd”B¦iû
, 0, 0.0, 1, 0.0, 1.0, },

218 {"U£Di¡ÜtiÚReÜd”", &
cfg·¿ms
.
U£Di¡ÜtiÚReÜd”
, 0, 0.0, 1, 0.0, 1.0, },

219 {"PocMemÜyMªagem’t", &
cfg·¿ms
.
PocMemÜyMªagem’t
, 0, 0.0, 1, 0.0, 2.0, },

222 {"DFP¬am‘”sFÏg", &
cfg·¿ms
.
DFS’dP¬am‘”s
, 0, 0.0, 1, 0.0, 1.0, },

223 {"DFDi§bËRefISliû", &
cfg·¿ms
.
DFDi§bËIdc
[1][
I_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

224 {"DFDi§bËNRefISliû", &
cfg·¿ms
.
DFDi§bËIdc
[0][
I_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

225 {"DFDi§bËRefPSliû", &
cfg·¿ms
.
DFDi§bËIdc
[1][
P_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

226 {"DFDi§bËNRefPSliû", &
cfg·¿ms
.
DFDi§bËIdc
[0][
P_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

227 {"DFDi§bËRefBSliû", &
cfg·¿ms
.
DFDi§bËIdc
[1][
B_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

228 {"DFDi§bËNRefBSliû", &
cfg·¿ms
.
DFDi§bËIdc
[0][
B_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

229 {"DFDi§bËRefSPSliû", &
cfg·¿ms
.
DFDi§bËIdc
[1][
SP_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

230 {"DFDi§bËNRefSPSliû", &
cfg·¿ms
.
DFDi§bËIdc
[0][
SP_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

231 {"DFDi§bËRefSISliû", &
cfg·¿ms
.
DFDi§bËIdc
[1][
SI_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

232 {"DFDi§bËNRefSISliû", &
cfg·¿ms
.
DFDi§bËIdc
[0][
SI_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

233 {"DFAÍhaRefISliû", &
cfg·¿ms
.
DFAÍha
[1][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

234 {"DFAÍhaNRefISliû", &
cfg·¿ms
.
DFAÍha
[0][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

235 {"DFAÍhaRefPSliû", &
cfg·¿ms
.
DFAÍha
[1][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

236 {"DFAÍhaNRefPSliû", &
cfg·¿ms
.
DFAÍha
[0][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

237 {"DFAÍhaRefBSliû", &
cfg·¿ms
.
DFAÍha
[1][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

238 {"DFAÍhaNRefBSliû", &
cfg·¿ms
.
DFAÍha
[0][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

239 {"DFAÍhaRefSPSliû", &
cfg·¿ms
.
DFAÍha
[1][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

240 {"DFAÍhaNRefSPSliû", &
cfg·¿ms
.
DFAÍha
[0][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

241 {"DFAÍhaRefSISliû", &
cfg·¿ms
.
DFAÍha
[1][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

242 {"DFAÍhaNRefSISliû", &
cfg·¿ms
.
DFAÍha
[0][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

243 {"DFB‘aRefISliû", &
cfg·¿ms
.
DFB‘a
[1][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

244 {"DFB‘aNRefISliû", &
cfg·¿ms
.
DFB‘a
[0][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

245 {"DFB‘aRefPSliû", &
cfg·¿ms
.
DFB‘a
[1][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

246 {"DFB‘aNRefPSliû", &
cfg·¿ms
.
DFB‘a
[0][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

247 {"DFB‘aRefBSliû", &
cfg·¿ms
.
DFB‘a
[1][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

248 {"DFB‘aNRefBSliû", &
cfg·¿ms
.
DFB‘a
[0][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

249 {"DFB‘aRefSPSliû", &
cfg·¿ms
.
DFB‘a
[1][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

250 {"DFB‘aNRefSPSliû", &
cfg·¿ms
.
DFB‘a
[0][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

251 {"DFB‘aRefSISliû", &
cfg·¿ms
.
DFB‘a
[1][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

252 {"DFB‘aNRefSISliû", &
cfg·¿ms
.
DFB‘a
[0][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

253 {"S·»Piùu»O±iÚ", &
cfg·¿ms
.
S·»Piùu»O±iÚ
, 0, 0.0, 1, 0.0, 1.0, },

254 {"S·»Piùu»D‘eùiÚThr", &
cfg·¿ms
.
SPD‘eùiÚTh»shÞd
, 0, 0.0, 2, 0.0, 0.0, },

255 {"S·»Piùu»P”ûÁageThr",&
cfg·¿ms
.
SPP”ûÁageTh»shÞd
, 0, 0.0, 2, 0.0, 100.0, },

257 {"num_¦iû_groups_mšus1", &
cfg·¿ms
.
num_¦iû_groups_mšus1
, 0, 0.0, 1, 0.0, ()
MAXSLICEGROUPIDS
 - 1 },

258 {"¦iû_group_m­_ty³", &
cfg·¿ms
.
¦iû_group_m­_ty³
, 0, 0.0, 1, 0.0, 6.0, },

259 {"¦iû_group_chªge_dœeùiÚ_æag", &
cfg·¿ms
.
¦iû_group_chªge_dœeùiÚ_æag
, 0, 0.0, 1, 0.0, 2.0, },

260 {"¦iû_group_chªge_¿‹_mšus1", &
cfg·¿ms
.
¦iû_group_chªge_¿‹_mšus1
, 0, 0.0, 2, 0.0, 1.0, },

261 {"SliûGroupCÚfigFžeName", &
cfg·¿ms
.
SliûGroupCÚfigFžeName
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

263 {"U£RedundªtPiùu»", &
cfg·¿ms
.
»dundªt_pic_æag
, 0, 0.0, 1, 0.0, 1.0, },

264 {"NumRedundªtH›¿rchy", &
cfg·¿ms
.
NumRedundªtH›¿rchy
, 0, 0.0, 1, 0.0, 4.0, },

265 {"Prim¬yGOPL’gth", &
cfg·¿ms
.
Prim¬yGOPL’gth
, 0, 1.0, 1, 1.0, 16.0, },

266 {"NumRefPrim¬y", &
cfg·¿ms
.
NumRefPrim¬y
, 0, 1.0, 1, 1.0, 16.0, },

268 {"PicOrd”CÁTy³", &
cfg·¿ms
.
pic_Üd”_út_ty³
, 0, 0.0, 1, 0.0, 2.0, },

270 {"CÚ‹xtIn™M‘hod", &
cfg·¿ms
.
cÚ‹xt_š™_m‘hod
, 0, 0.0, 1, 0.0, 1.0, },

271 {"FixedMod–Numb”", &
cfg·¿ms
.
mod–_numb”
, 0, 0.0, 1, 0.0, 2.0, },

273 {"R•ÜtF¿meSts", &
cfg·¿ms
.
R•ÜtF¿meSts
, 0, 0.0, 1, 0.0, 1.0, },

274 {"Di¥ÏyEncP¬ams", &
cfg·¿ms
.
Di¥ÏyEncP¬ams
, 0, 0.0, 1, 0.0, 1.0, },

275 {"V”bo£", &
cfg·¿ms
.
V”bo£
, 0, 1.0, 1, 0.0, 4.0, },

276 {"SkGlob®Sts", &
cfg·¿ms
.
sk_gl_¡©s
, 0, 0.0, 1, 0.0, 1.0, },

277 {"OnTheFlyF¿ùMCP", &
cfg·¿ms
.
OnTheFlyF¿ùMCP
, 0, 0.0, 1, 0.0, 3.0, },

278 {"ChromaMCBufãr", &
cfg·¿ms
.
ChromaMCBufãr
, 0, 0.0, 1, 0.0, 1.0, },

279 {"ChromaMEEÇbË", &
cfg·¿ms
.
ChromaMEEÇbË
, 0, 0.0, 1, 0.0, 2.0, },

280 {"ChromaMEWeight", &
cfg·¿ms
.
ChromaMEWeight
, 0, 1.0, 2, 0.0, 1.0, },

281 {"MESoá’SSEM‘ric", &
cfg·¿ms
.
MESoá’SSEM‘ric
, 0, 0.0, 1, 0.0, 1.0, },

282 {"MEDi¡ÜtiÚFP–", &
cfg·¿ms
.
MEE¼ÜM‘ric
[
F_PEL
], 0, 0.0, 1, 0.0, 3.0, },

283 {"MEDi¡ÜtiÚHP–", &
cfg·¿ms
.
MEE¼ÜM‘ric
[
H_PEL
], 0, 0.0, 1, 0.0, 3.0, },

284 {"MEDi¡ÜtiÚQP–", &
cfg·¿ms
.
MEE¼ÜM‘ric
[
Q_PEL
], 0, 2.0, 1, 0.0, 3.0, },

285 {"MDDi¡ÜtiÚ", &
cfg·¿ms
.
ModeDecisiÚM‘ric
, 0, 2.0, 1, 0.0, 2.0, },

286 {"SkDeBlockNÚRef", &
cfg·¿ms
.
SkDeBlockNÚRef
, 0, 0.0, 1, 0.0, 1.0, },

289 {"R©eCÚŒÞEÇbË", &
cfg·¿ms
.
RCEÇbË
, 0, 0.0, 1, 0.0, 1.0, },

290 {"B™¿‹", &
cfg·¿ms
.
b™_¿‹
, 0, 0.0, 2, 0.0, 0.0, },

291 {"In™ŸlQP", &
cfg·¿ms
.
Seš™ŸlQP
, 0, 0.0, 3, (è
MIN_QP
, (è
MAX_QP
, },

292 {"BasicUn™", &
cfg·¿ms
.
basicun™
, 0, 0.0, 2, 0.0, 0.0, },

293 {"ChªÃlTy³", &
cfg·¿ms
.
chªÃl_ty³
, 0, 0.0, 1, 0.0, 1.0, },

294 {"RCUpd©eMode", &
cfg·¿ms
.
RCUpd©eMode
, 0, 0.0, 1, 0.0, 4.0, },

295 {"RCISliûB™R©io", &
cfg·¿ms
.
RCISliûB™R©io
, 2, 1.0, 1, 0.0, 20.0, },

296 {"RCBSliûB™R©io0", &
cfg·¿ms
.
RCBSliûB™R©io
[0], 2, 0.5, 1, 0.0, 20.0, },

297 {"RCBSliûB™R©io1", &
cfg·¿ms
.
RCBSliûB™R©io
[1], 2, 0.25, 1, 0.0, 20.0, },

298 {"RCBSliûB™R©io2", &
cfg·¿ms
.
RCBSliûB™R©io
[2], 2, 0.25, 1, 0.0, 20.0, },

299 {"RCBSliûB™R©io3", &
cfg·¿ms
.
RCBSliûB™R©io
[3], 2, 0.25, 1, 0.0, 20.0, },

300 {"RCBSliûB™R©io4", &
cfg·¿ms
.
RCBSliûB™R©io
[4], 2, 0.25, 1, 0.0, 20.0, },

301 {"RCBov”PR©io", &
cfg·¿ms
.
RCBov”PR©io
, 2, 0.45, 1, 0.0, 1000.0, },

302 {"RCIov”PR©io", &
cfg·¿ms
.
RCIov”PR©io
, 2, 3.80, 1, 0.0, 1000.0, },

303 {"RCMšQPPSliû", &
cfg·¿ms
.
RCMšQP
[
P_SLICE
], 0, (è
MIN_QP
, 3, (èMIN_QP, (è
MAX_QP
, },

304 {"RCMaxQPPSliû", &
cfg·¿ms
.
RCMaxQP
[
P_SLICE
], 0, (è
MAX_QP
, 3, (è
MIN_QP
, () MAX_QP, },

305 {"RCMšQPBSliû", &
cfg·¿ms
.
RCMšQP
[
B_SLICE
], 0, (è
MIN_QP
, 3, (èMIN_QP, (è
MAX_QP
, },

306 {"RCMaxQPBSliû", &
cfg·¿ms
.
RCMaxQP
[
B_SLICE
], 0, (è
MAX_QP
, 3, (è
MIN_QP
, () MAX_QP, },

307 {"RCMšQPISliû", &
cfg·¿ms
.
RCMšQP
[
I_SLICE
], 0, (è
MIN_QP
, 3, (èMIN_QP, (è
MAX_QP
, },

308 {"RCMaxQPISliû", &
cfg·¿ms
.
RCMaxQP
[
I_SLICE
], 0, (è
MAX_QP
, 3, (è
MIN_QP
, () MAX_QP, },

309 {"RCMšQPSPSliû", &
cfg·¿ms
.
RCMšQP
[
SP_SLICE
], 0, (è
MIN_QP
, 3, (èMIN_QP, (è
MAX_QP
, },

310 {"RCMaxQPSPSliû", &
cfg·¿ms
.
RCMaxQP
[
SP_SLICE
], 0, (è
MAX_QP
, 3, (è
MIN_QP
, () MAX_QP, },

311 {"RCMšQPSISliû", &
cfg·¿ms
.
RCMšQP
[
SI_SLICE
], 0, (è
MIN_QP
, 3, (èMIN_QP, (è
MAX_QP
, },

312 {"RCMaxQPSISliû", &
cfg·¿ms
.
RCMaxQP
[
SI_SLICE
], 0, (è
MAX_QP
, 3, (è
MIN_QP
, () MAX_QP, },

313 {"RCMaxQPChªge", &
cfg·¿ms
.
RCMaxQPChªge
, 0, 4.0, 1, 0.0, 51.0, },

316 {"Qm©rixFže", &
cfg·¿ms
.
Qm©rixFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

317 {"SÿlšgM©rixP»£ÁFÏg", &
cfg·¿ms
.
SÿlšgM©rixP»£ÁFÏg
, 0, 0.0, 1, 0.0, 3.0, },

318 {"SÿlšgLi¡P»£ÁFÏg0", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[0], 0, 0.0, 1, 0.0, 3.0, },

319 {"SÿlšgLi¡P»£ÁFÏg1", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[1], 0, 0.0, 1, 0.0, 3.0, },

320 {"SÿlšgLi¡P»£ÁFÏg2", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[2], 0, 0.0, 1, 0.0, 3.0, },

321 {"SÿlšgLi¡P»£ÁFÏg3", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[3], 0, 0.0, 1, 0.0, 3.0, },

322 {"SÿlšgLi¡P»£ÁFÏg4", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[4], 0, 0.0, 1, 0.0, 3.0, },

323 {"SÿlšgLi¡P»£ÁFÏg5", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[5], 0, 0.0, 1, 0.0, 3.0, },

324 {"SÿlšgLi¡P»£ÁFÏg6", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[6], 0, 0.0, 1, 0.0, 3.0, },

325 {"SÿlšgLi¡P»£ÁFÏg7", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[7], 0, 0.0, 1, 0.0, 3.0, },

326 {"SÿlšgLi¡P»£ÁFÏg8", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[8], 0, 0.0, 1, 0.0, 3.0, },

327 {"SÿlšgLi¡P»£ÁFÏg9", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[9], 0, 0.0, 1, 0.0, 3.0, },

328 {"SÿlšgLi¡P»£ÁFÏg10", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[10], 0, 0.0, 1, 0.0, 3.0, },

329 {"SÿlšgLi¡P»£ÁFÏg11", &
cfg·¿ms
.
SÿlšgLi¡P»£ÁFÏg
[11], 0, 0.0, 1, 0.0, 3.0, },

332 {"ChromaQPOff£t", &
cfg·¿ms
.
chroma_qp_šdex_off£t
, 0, 0.0, 1,-51.0, 51.0, },

336 {"SourûB™D•thLuma", &
cfg·¿ms
.
sourû
.
b™_d•th
[0], 0, 8.0, 1, 8.0, 14.0, },

337 {"SourûB™D•thChroma", &
cfg·¿ms
.
sourû
.
b™_d•th
[1], 0, 8.0, 1, 8.0, 14.0, },

338 {"SourûB™D•thResÿË", &
cfg·¿ms
.
¤c_B™D•thResÿË
, 0, 0.0, 1, 0.0, 1.0, },

340 {"OuutB™D•thLuma", &
cfg·¿ms
.
ouut
.
b™_d•th
[0], 0, 8.0, 1, 8.0, 14.0, },

341 {"OuutB™D•thChroma", &
cfg·¿ms
.
ouut
.
b™_d•th
[1], 0, 8.0, 1, 8.0, 14.0, },

343 {"YUVFÜm©", &
cfg·¿ms
.
yuv_fÜm©
, 0, 1.0, 1, 0.0, 3.0, },

344 {"RGBIÅut", &
cfg·¿ms
.
sourû
.
cÞÜ_mod–
, 0, 0.0, 1, 0.0, 1.0, },

345 {"Pix–FÜm©", &
cfg·¿ms
.
sourû
.
pix–_fÜm©
, 0, 0.0, 1, 0.0, 4.0, },

346 {"IÁ”Ëaved", &
cfg·¿ms
.
šput_fže1
.
is_š‹¾—ved
 , 0, 0.0, 1, 0.0, 1.0, },

347 {"Snd¬dRªge", &
cfg·¿ms
.
¡dRªge
, 0, 0.0, 1, 0.0, 1.0, },

348 {"VideoCode", &
cfg·¿ms
.
videoCode
, 0, 1.0, 1, 0.0, 8.0, },

349 {"CbQPOff£t", &
cfg·¿ms
.
cb_qp_šdex_off£t
, 0, 0.0, 1,-51.0, 51.0, },

350 {"CrQPOff£t", &
cfg·¿ms
.
ü_qp_šdex_off£t
, 0, 0.0, 1,-51.0, 51.0, },

351 {"T¿nsfÜm8x8Mode", &
cfg·¿ms
.
T¿nsfÜm8x8Mode
, 0, 0.0, 1, 0.0, 2.0, },

353 {"Los¦essCodšg", &
cfg·¿ms
.
Los¦essCodšg
, 0, 0.0, 1, 0.0, 1.0, },

356 {"U£Ex¶ic™LambdaP¬ams", &
cfg·¿ms
.
U£Ex¶ic™LambdaP¬ams
, 0, 0.0, 1, 0.0, 3.0, },

357 {"Di§bËDi¡ªûLambdaSÿË", &
cfg·¿ms
.
Di§bËDi¡ªûLambdaSÿË
, 0, 0.0, 1, 0.0, 1.0, },

358 {"Upd©eLambdaChromaME", &
cfg·¿ms
.
Upd©eLambdaChromaME
, 0, 0.0, 1, 0.0, 1.0, },

359 {"FixedLambdaPSliû", &
cfg·¿ms
.
FixedLambda
[
P_SLICE
], 2, 0.1, 2, 0.0, 0.0, },

360 {"FixedLambdaBSliû", &
cfg·¿ms
.
FixedLambda
[
B_SLICE
], 2, 0.1, 2, 0.0, 0.0, },

361 {"FixedLambdaISliû", &
cfg·¿ms
.
FixedLambda
[
I_SLICE
], 2, 0.1, 2, 0.0, 0.0, },

362 {"FixedLambdaSPSliû", &
cfg·¿ms
.
FixedLambda
[
SP_SLICE
], 2, 0.1, 2, 0.0, 0.0, },

363 {"FixedLambdaSISliû", &
cfg·¿ms
.
FixedLambda
[
SI_SLICE
], 2, 0.1, 2, 0.0, 0.0, },

364 {"FixedLambdaRefBSliû", &
cfg·¿ms
.
FixedLambda
[5], 2, 0.1, 2, 0.0, 0.0, },

365 {"LambdaWeightPSliû", &
cfg·¿ms
.
LambdaWeight
[
P_SLICE
], 2, 0.68, 2, 0.0, 0.0, },

366 {"LambdaWeightBSliû", &
cfg·¿ms
.
LambdaWeight
[
B_SLICE
], 2, 2.00, 2, 0.0, 0.0, },

367 {"LambdaWeightISliû", &
cfg·¿ms
.
LambdaWeight
[
I_SLICE
], 2, 0.65, 2, 0.0, 0.0, },

368 {"LambdaWeightSPSliû", &
cfg·¿ms
.
LambdaWeight
[
SP_SLICE
], 2, 1.50, 2, 0.0, 0.0, },

369 {"LambdaWeightSISliû", &
cfg·¿ms
.
LambdaWeight
[
SI_SLICE
], 2, 0.65, 2, 0.0, 0.0, },

370 {"LambdaWeightRefBSliû", &
cfg·¿ms
.
LambdaWeight
[5], 2, 1.50, 2, 0.0, 0.0, },

372 {"QOff£tM©rixFže", &
cfg·¿ms
.
QOff£tM©rixFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

373 {"Off£tM©rixP»£ÁFÏg", &
cfg·¿ms
.
Off£tM©rixP»£ÁFÏg
, 0, 0.0, 1, 0.0, 1.0, },

374 {"Off£tM©rixFÏt", &
cfg·¿ms
.
Off£tM©rixFÏt
, 0, 0.0, 1, 0.0, 2.0, },

376 {"Ad­tiveRoundšg", &
cfg·¿ms
.
Ad­tiveRoundšg
, 0, 0.0, 1, 0.0, 1.0, },

377 {"Ad­tRoundšgFixed", &
cfg·¿ms
.
Ad­tRoundšgFixed
, 0, 1.0, 1, 0.0, 1.0, },

378 {"Ad­tRndP”iod", &
cfg·¿ms
.
Ad­tRndP”iod
, 0, 16.0, 2, 1.0, 0.0, },

379 {"Ad­tRndChroma", &
cfg·¿ms
.
Ad­tRndChroma
, 0, 0.0, 1, 0.0, 1.0, },

380 {"Ad­tRndWFaùÜIRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[1][
I_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

381 {"Ad­tRndWFaùÜPRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[1][
P_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

382 {"Ad­tRndWFaùÜBRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[1][
B_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

383 {"Ad­tRndWFaùÜINRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[0][
I_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

384 {"Ad­tRndWFaùÜPNRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[0][
P_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

385 {"Ad­tRndWFaùÜBNRef", &
cfg·¿ms
.
Ad­tRndWFaùÜ
[0][
B_SLICE
], 0, 4.0, 1, 0.0, 4096.0, },

387 {"Ad­tRndCrWFaùÜIRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[1][
I_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

388 {"Ad­tRndCrWFaùÜPRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[1][
P_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

389 {"Ad­tRndCrWFaùÜBRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[1][
B_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

390 {"Ad­tRndCrWFaùÜINRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[0][
I_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

391 {"Ad­tRndCrWFaùÜPNRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[0][
P_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

392 {"Ad­tRndCrWFaùÜBNRef", &
cfg·¿ms
.
Ad­tRndCrWFaùÜ
[0][
B_SLICE
],0, 4.0, 1, 0.0, 4096.0, },

395 {"P»ãrDi¥Ord”", &
cfg·¿ms
.
P»ãrDi¥Ord”
, 0, 1.0, 1, 0.0, 1.0, },

396 {"P»ãrPow”OfTwo", &
cfg·¿ms
.
P»ãrPow”OfTwo
, 0, 0.0, 1, 0.0, 1.0, },

397 {"FrmSŒuùBufãrL’gth", &
cfg·¿ms
.
FrmSŒuùBufãrL’gth
, 0, 16.0, 1, 1.0, 128.0, },

400 {"E¬lySkEÇbË", &
cfg·¿ms
.
E¬lySkEÇbË
, 0, 0.0, 1, 0.0, 1.0, },

401 {"S–eùiveIÁ¿EÇbË", &
cfg·¿ms
.
S–eùiveIÁ¿EÇbË
, 0, 0.0, 1, 0.0, 1.0, },

406 {"Re¡riùS—rchRªge", &
cfg·¿ms
.
fuÎ_£¬ch
, 0, 2.0, 1, 0.0, 2.0, },

408 {"U£MVLim™s", &
cfg·¿ms
.
U£MVLim™s
, 0, 0.0, 1, 0.0, 1.0, },

409 {"S‘MVXLim™", &
cfg·¿ms
.
S‘MVXLim™
, 0, 0.0, 1, 0.0, 2048.0, },

410 {"S‘MVYLim™", &
cfg·¿ms
.
S‘MVYLim™
, 0, 0.0, 1, 0.0, 512.0, },

412 {"S—rchMode", &
cfg·¿ms
.
S—rchMode
[0], 0, 0.0, 1, -1.0, 3.0, },

414 {"UMHexDSR", &
cfg·¿ms
.
UMHexDSR
, 0, 1.0, 1, 0.0, 1.0, },

415 {"UMHexSÿË", &
cfg·¿ms
.
UMHexSÿË
, 0, 1.0, 0, 0.0, 0.0, },

417 {"EPZSP©‹º", &
cfg·¿ms
.
EPZSP©‹º
, 0, 2.0, 1, 0.0, 5.0, },

418 {"EPZSDu®Refšem’t", &
cfg·¿ms
.
EPZSDu®
, 0, 3.0, 1, 0.0, 6.0, },

419 {"EPZSFixedP»diùÜs", &
cfg·¿ms
.
EPZSFixed
, 0, 3.0, 1, 0.0, 3.0, },

420 {"EPZSAgg»ssiveWšdow", &
cfg·¿ms
.
EPZSAgg»ssiveWšdow
, 0, 0.0, 1, 0.0, 1.0, },

421 #ià(
MVC_EXTENSION_ENABLE
)

422 {"EPZSTempÜ®", &
cfg·¿ms
.
EPZSTempÜ®
[0], 0, 1.0, 1, 0.0, 1.0, },

424 {"EPZSTempÜ®", &
cfg·¿ms
.
EPZSTempÜ®
, 0, 1.0, 1, 0.0, 1.0, },

426 {"EPZSS·tŸlMem", &
cfg·¿ms
.
EPZSS·tŸlMem
, 0, 1.0, 1, 0.0, 1.0, },

427 {"EPZSBlockTy³", &
cfg·¿ms
.
EPZSBlockTy³
, 0, 1.0, 1, 0.0, 1.0, },

428 #ià(
MVC_EXTENSION_ENABLE
)

429 {"EPZSMšTh»sSÿË", &
cfg·¿ms
.
EPZSMšTh»sSÿË
[0], 0, 0.0, 0, 0.0, 0.0, },

430 {"EPZSMaxTh»sSÿË", &
cfg·¿ms
.
EPZSMaxTh»sSÿË
[0], 0, 2.0, 0, 0.0, 0.0, },

431 {"EPZSMedTh»sSÿË", &
cfg·¿ms
.
EPZSMedTh»sSÿË
[0], 0, 1.0, 0, 0.0, 0.0, },

432 {"EPZSSubP–Th»sSÿË", &
cfg·¿ms
.
EPZSSubP–Th»sSÿË
[0], 0, 1.0, 0, 0.0, 0.0, },

434 {"EPZSMšTh»sSÿË", &
cfg·¿ms
.
EPZSMšTh»sSÿË
, 0, 0.0, 0, 0.0, 0.0, },

435 {"EPZSMaxTh»sSÿË", &
cfg·¿ms
.
EPZSMaxTh»sSÿË
, 0, 2.0, 0, 0.0, 0.0, },

436 {"EPZSMedTh»sSÿË", &
cfg·¿ms
.
EPZSMedTh»sSÿË
, 0, 1.0, 0, 0.0, 0.0, },

437 {"EPZSSubP–Th»sSÿË", &
cfg·¿ms
.
EPZSSubP–Th»sSÿË
, 0, 2.0, 0, 0.0, 0.0, },

439 {"EPZSSubP–ME", &
cfg·¿ms
.
EPZSSubP–ME
, 0, 1.0, 1, 0.0, 2.0, },

440 {"EPZSSubP–MEBiP»d", &
cfg·¿ms
.
EPZSSubP–MEBiP»d
, 0, 1.0, 1, 0.0, 2.0, },

441 {"EPZSSubP–Grid", &
cfg·¿ms
.
EPZSSubP–Grid
, 0, 0.0, 1, 0.0, 1.0, },

442 {"EPZSSubP–Th»sSÿË", &
cfg·¿ms
.
EPZSSubP–Th»sSÿË
, 0, 1.0, 0, 0.0, 0.0, },

443 {"EPZSU£HMEP»diùÜs", &
cfg·¿ms
.
EPZSU£HMEP»diùÜs
, 0, 0.0, 1, 0.0, 1.0, },

444 {"Di§bËMEP»diùiÚ", &
cfg·¿ms
.
Di§bËMEP»diùiÚ
, 0, 0.0, 1, 0.0, 1.0, },

445 {"HMEEÇbË", &
cfg·¿ms
.
HMEEÇbË
, 0, 0.0, 1, 0.0, 1.0, },

446 {"HMEDi§bËMMCO", &
cfg·¿ms
.
HMEDi§bËMMCO
, 0, 0.0, 1, 0.0, 1.0, },

447 {"Py¿midLev–s", &
cfg·¿ms
.
Py¿midLev–s
, 0, 0.0, 1, 0.0, 6.0, },

450 {"TÚeM­pšgSEIP»£ÁFÏg",&
cfg·¿ms
.
TÚeM­pšgSEIP»£ÁFÏg
, 0, 0.0, 1, 0.0, 1.0, },

451 {"TÚeM­pšgFže", &
cfg·¿ms
.
TÚeM­pšgFže
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

453 {"S•¬©eCÞourPÏÃ", &
cfg·¿ms
.
£·¿‹_cÞour_¶ªe_æag
, 0, 0.0, 1, 0.0, 1.0, },

454 {"WeightY", &
cfg·¿ms
.
WeightY
, 2, 1.00, 1, 0.0, 4.0, },

455 {"WeightCb", &
cfg·¿ms
.
WeightCb
, 2, 1.00, 1, 0.0, 4.0, },

456 {"WeightCr", &
cfg·¿ms
.
WeightCr
, 2, 1.00, 1, 0.0, 4.0, },

457 {"WPMCP»cisiÚ", &
cfg·¿ms
.
WPMCP»cisiÚ
, 0, 0.0, 1, 0.0, 2.0, },

458 {"WPMCP»cFuÎRef", &
cfg·¿ms
.
WPMCP»cFuÎRef
, 0, 0.0, 1, 0.0, 1.0, },

459 {"WPMCP»cBSliû", &
cfg·¿ms
.
WPMCP»cBSliû
, 0, 1.0, 1, 0.0, 2.0, },

460 {"RCCpbSize", &
cfg·¿ms
.
rc_ýb_size
, 0,1024.0, 2, 0.0, 0.0, },

461 {"MšIDRDi¡ªû", &
cfg·¿ms
.
MšIDRDi¡ªû
, 0, 10.0, 1, 0.0, 128.0, },

463 {"U£RDOQuªt", &
cfg·¿ms
.
U£RDOQuªt
, 0, 0.0, 1, 0.0, 1.0, },

464 {"RDOQ_DC", &
cfg·¿ms
.
RDOQ_DC
, 0, 1.0, 1, 0.0, 1.0, },

465 {"RDOQ_CR", &
cfg·¿ms
.
RDOQ_CR
, 0, 1.0, 1, 0.0, 1.0, },

466 {"RDOQ_DC_CR", &
cfg·¿ms
.
RDOQ_DC_CR
, 0, 1.0, 1, 0.0, 1.0, },

467 {"RDOQ_QP_Num", &
cfg·¿ms
.
RDOQ_QP_Num
, 0, 1.0, 1, 1.0, 9.0, },

468 {"RDOQ_CP_Mode", &
cfg·¿ms
.
RDOQ_CP_Mode
, 0, 0.0, 1, 0.0, 1.0, },

469 {"RDOQ_CP_MV", &
cfg·¿ms
.
RDOQ_CP_MV
, 0, 0.0, 1, 0.0, 1.0, },

470 {"RDOQ_Fa¡", &
cfg·¿ms
.
RDOQ_Fa¡
, 0, 0.0, 1, 0.0, 1.0, },

472 {"G’”©eSEIMes§ge", &
cfg·¿ms
.
G’”©eSEIMes§ge
, 0, 0.0, 1, 0.0, 1.0, },

473 {"EÇbËVUISuµÜt", &
cfg·¿ms
.
EÇbËVUISuµÜt
, 0, 0.0, 1, 0.0, 1.0, },

474 {"VUI_a¥eù_¿tio_šfo_´e£Á_æag", &
cfg·¿ms
.
VUI
.
a¥eù_¿tio_šfo_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

475 {"VUI_a¥eù_¿tio_idc", &
cfg·¿ms
.
VUI
.
a¥eù_¿tio_idc
, 0, 0.0, 1, 0.0, 255.0, },

476 {"VUI_§r_width", &
cfg·¿ms
.
VUI
.
§r_width
, 0, 0.0, 2, 0.0, 0.0, },

477 {"VUI_§r_height", &
cfg·¿ms
.
VUI
.
§r_height
, 0, 0.0, 2, 0.0, 0.0, },

478 {"VUI_ov”sÿn_šfo_´e£Á_æag", &
cfg·¿ms
.
VUI
.
ov”sÿn_šfo_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

479 {"VUI_ov”sÿn_­´ÝrŸ‹_æag", &
cfg·¿ms
.
VUI
.
ov”sÿn_­´ÝrŸ‹_æag
, 0, 0.0, 1, 0.0, 1.0, },

480 {"VUI_video_sigÇl_ty³_´e£Á_æag", &
cfg·¿ms
.
VUI
.
video_sigÇl_ty³_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

481 {"VUI_video_fÜm©", &
cfg·¿ms
.
VUI
.
video_fÜm©
, 0, 5.0, 1, 0.0, 7.0, },

482 {"VUI_video_fuÎ_¿nge_æag", &
cfg·¿ms
.
VUI
.
video_fuÎ_¿nge_æag
, 0, 0.0, 1, 0.0, 1.0, },

483 {"VUI_cÞour_desütiÚ_´e£Á_æag", &
cfg·¿ms
.
VUI
.
cÞour_desütiÚ_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

484 {"VUI_cÞour_´im¬›s", &
cfg·¿ms
.
VUI
.
cÞour_´im¬›s
, 0, 2.0, 1, 0.0, 255.0, },

485 {"VUI_Œªsãr_ch¬aù”i¡ics", &
cfg·¿ms
.
VUI
.
Œªsãr_ch¬aù”i¡ics
, 0, 2.0, 1, 0.0, 255.0, },

486 {"VUI_m©rix_cÛffic›Ás", &
cfg·¿ms
.
VUI
.
m©rix_cÛffic›Ás
, 0, 2.0, 1, 0.0, 255.0, },

487 {"VUI_chroma_loÿtiÚ_šfo_´e£Á_æag", &
cfg·¿ms
.
VUI
.
chroma_loÿtiÚ_šfo_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

488 {"VUI_chroma_§m¶e_loc_ty³_tÝ_f›ld", &
cfg·¿ms
.
VUI
.
chroma_§m¶e_loc_ty³_tÝ_f›ld
, 0, 0.0, 1, 0.0, 5.0, },

489 {"VUI_chroma_§m¶e_loc_ty³_bÙtom_f›ld",&
cfg·¿ms
.
VUI
.
chroma_§m¶e_loc_ty³_bÙtom_f›ld
,0, 0.0, 1, 0.0, 5.0, },

490 {"VUI_timšg_šfo_´e£Á_æag", &
cfg·¿ms
.
VUI
.
timšg_šfo_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

491 {"VUI_num_un™s_š_tick", &
cfg·¿ms
.
VUI
.
num_un™s_š_tick
, 0,1000.0, 2, 0.0, 0.0, },

492 {"VUI_time_sÿË", &
cfg·¿ms
.
VUI
.
time_sÿË
, 0,60000.0, 2, 0.0, 0.0, },

493 {"VUI_fixed_äame_¿‹_æag", &
cfg·¿ms
.
VUI
.
fixed_äame_¿‹_æag
, 0, 0.0, 1, 0.0, 1.0, },

494 {"VUI_Çl_hrd_·¿m‘”s_´e£Á_æag", &
cfg·¿ms
.
VUI
.
Çl_hrd_·¿m‘”s_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

495 {"VUI_Çl_ýb_út_mšus1", &
cfg·¿ms
.
VUI
.
Çl_ýb_út_mšus1
, 0, 0.0, 1, 0.0, 31.0, },

496 {"VUI_Çl_b™_¿‹_sÿË", &
cfg·¿ms
.
VUI
.
Çl_b™_¿‹_sÿË
, 0, 0.0, 2, 0.0, 0.0, },

497 {"VUI_Çl_ýb_size_sÿË", &
cfg·¿ms
.
VUI
.
Çl_ýb_size_sÿË
, 0, 0.0, 2, 0.0, 0.0, },

498 {"VUI_Çl_b™_¿‹_v®ue_mšus1", &
cfg·¿ms
.
VUI
.
Çl_b™_¿‹_v®ue_mšus1
, 0, 0.0, 2, 0.0, 0.0, },

499 {"VUI_Çl_ýb_size_v®ue_mšus1", &
cfg·¿ms
.
VUI
.
Çl_ýb_size_v®ue_mšus1
, 0, 0.0, 2, 0.0, 0.0, },

500 {"VUI_Çl_vbr_cbr_æag", &
cfg·¿ms
.
VUI
.
Çl_vbr_cbr_æag
, 0, 1.0, 1, 0.0, 1.0, },

501 {"VUI_Çl_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1", &
cfg·¿ms
.
VUI
.
Çl_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
, 0, 23.0, 2, 0.0, 0.0, },

502 {"VUI_Çl_ýb_»mov®_d–ay_Ëngth_mšus1",&
cfg·¿ms
.
VUI
.
Çl_ýb_»mov®_d–ay_Ëngth_mšus1
,0, 23.0, 2, 0.0, 0.0, },

503 {"VUI_Çl_dpb_ouut_d–ay_Ëngth_mšus1", &
cfg·¿ms
.
VUI
.
Çl_dpb_ouut_d–ay_Ëngth_mšus1
, 0, 23.0, 2, 0.0, 0.0, },

504 {"VUI_Çl_time_off£t_Ëngth", &
cfg·¿ms
.
VUI
.
Çl_time_off£t_Ëngth
, 0, 24.0, 2, 0.0, 0.0, },

505 {"VUI_vþ_hrd_·¿m‘”s_´e£Á_æag", &
cfg·¿ms
.
VUI
.
vþ_hrd_·¿m‘”s_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

506 {"VUI_vþ_ýb_út_mšus1", &
cfg·¿ms
.
VUI
.
vþ_ýb_út_mšus1
, 0, 0.0, 1, 0.0, 31.0, },

507 {"VUI_vþ_b™_¿‹_sÿË", &
cfg·¿ms
.
VUI
.
vþ_b™_¿‹_sÿË
, 0, 0.0, 2, 0.0, 0.0, },

508 {"VUI_vþ_ýb_size_sÿË", &
cfg·¿ms
.
VUI
.
vþ_ýb_size_sÿË
, 0, 0.0, 2, 0.0, 0.0, },

509 {"VUI_vþ_b™_¿‹_v®ue_mšus1", &
cfg·¿ms
.
VUI
.
vþ_b™_¿‹_v®ue_mšus1
, 0, 0.0, 2, 0.0, 0.0, },

510 {"VUI_vþ_ýb_size_v®ue_mšus1", &
cfg·¿ms
.
VUI
.
vþ_ýb_size_v®ue_mšus1
, 0, 0.0, 2, 0.0, 0.0, },

511 {"VUI_vþ_vbr_cbr_æag", &
cfg·¿ms
.
VUI
.
vþ_vbr_cbr_æag
, 0, 0.0, 1, 0.0, 1.0, },

512 {"VUI_vþ_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1", &
cfg·¿ms
.
VUI
.
vþ_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
, 0, 23.0, 2, 0.0, 0.0, },

513 {"VUI_vþ_ýb_»mov®_d–ay_Ëngth_mšus1",&
cfg·¿ms
.
VUI
.
vþ_ýb_»mov®_d–ay_Ëngth_mšus1
,0, 23.0, 2, 0.0, 0.0, },

514 {"VUI_vþ_dpb_ouut_d–ay_Ëngth_mšus1", &
cfg·¿ms
.
VUI
.
vþ_dpb_ouut_d–ay_Ëngth_mšus1
, 0, 23.0, 2, 0.0, 0.0, },

515 {"VUI_vþ_time_off£t_Ëngth", &
cfg·¿ms
.
VUI
.
vþ_time_off£t_Ëngth
, 0, 24.0, 2, 0.0, 0.0, },

516 {"VUI_low_d–ay_hrd_æag", &
cfg·¿ms
.
VUI
.
low_d–ay_hrd_æag
, 0, 0.0, 1, 0.0, 1.0, },

517 {"VUI_pic_¡ruù_´e£Á_æag", &
cfg·¿ms
.
VUI
.
pic_¡ruù_´e£Á_æag
, 0, 0.0, 1, 0.0, 1.0, },

518 {"VUI_b™¡»am_»¡riùiÚ_æag", &
cfg·¿ms
.
VUI
.
b™¡»am_»¡riùiÚ_æag
, 0, 0.0, 1, 0.0, 1.0, },

519 {"VUI_mÙiÚ_veùÜs_ov”_pic_bound¬›s_æag", &
cfg·¿ms
.
VUI
.
mÙiÚ_veùÜs_ov”_pic_bound¬›s_æag
, 0, 1.0, 1, 0.0, 1.0, },

520 {"VUI_max_by‹s_³r_pic_d’om", &
cfg·¿ms
.
VUI
.
max_by‹s_³r_pic_d’om
, 0, 2.0, 1, 0.0, 16.0, },

521 {"VUI_max_b™s_³r_mb_d’om", &
cfg·¿ms
.
VUI
.
max_b™s_³r_mb_d’om
, 0, 1.0, 1, 0.0, 16.0, },

522 {"VUI_log2_max_mv_Ëngth_v”tiÿl", &
cfg·¿ms
.
VUI
.
log2_max_mv_Ëngth_v”tiÿl
, 0, 16.0, 1, 0.0, 16.0, },

523 {"VUI_log2_max_mv_Ëngth_hÜizÚl", &
cfg·¿ms
.
VUI
.
log2_max_mv_Ëngth_hÜizÚl
, 0, 16.0, 1, 0.0, 16.0, },

524 {"VUI_num_»Üd”_äames", &
cfg·¿ms
.
VUI
.
num_»Üd”_äames
, 0, 16.0, 1, 0.0, 16.0, },

525 {"VUI_max_dec_äame_bufãršg", &
cfg·¿ms
.
VUI
.
max_dec_äame_bufãršg
, 0, 16.0, 1, 0.0, 16.0, },

526 {"SEIMes§geText", &
cfg·¿ms
.
SEIMes§geText
, 1, 0.0, 0, 0.0, 0.0, 
INPUT_TEXT_SIZE
,},

527 #ià
B0_MORE_REF


528 {"BLev–0MÜeRef", &
cfg·¿ms
.
BLev–0MÜeRef
, 0, 0.0, 1, 0.0, 1.0, },

530 #ià
KEEP_B_SAME_LIST


531 {"BId’tiÿlLi¡", &
cfg·¿ms
.
BId’tiÿlLi¡
, 0, 0.0, 1, 0.0, 2.0, },

533 #ià
CRA


534 {"CRA", &
cfg·¿ms
.
u£CRA
, 0, 0.0, 1, 0.0, 1.0, },

536 #ià
HM50_LIKE_MMCO


537 {"HM50RefSŒuùu»", &
cfg·¿ms
.
HM50RefSŒuùu»
, 0, 0.0, 1, 0.0, 1.0, },

539 #ià
LD_REF_SETTING


540 {"LDRefS‘tšg", &
cfg·¿ms
.
LDRefS‘tšg
, 0, 0.0, 1, 0.0, 1.0, },

541 {"UncÚ¡¿šedLDRef", &
cfg·¿ms
.
UncÚ¡¿šedLDRef
, 0, 0.0, 1, 0.0, 1.0, },

544 {
NULL
, NULL, -1, 0.0, 0, 0.0, 0.0, },

548 #ià(
MVC_EXTENSION_ENABLE
)

549 
M­pšg
 
	gM­V›w1
[] = {

550 {"IÅutFže", &
cfg·¿ms
.
šput_fže2
.
âame
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

551 {"RecÚFže", &
cfg·¿ms
.
RecÚFže2
, 1, 0.0, 0, 0.0, 0.0, 
FILE_NAME_SIZE
, },

552 {"S—rchRªge", &
cfg·¿ms
.
£¬ch_¿nge
[1], 0, 16.0, 2, 0.0, 0.0, },

553 {"Di§bËSub³lME", &
cfg·¿ms
.
Di§bËSub³lME
[1], 0, 0.0, 1, 0.0, 1.0, },

554 {"Di§bËIÁ¿InIÁ”", &
cfg·¿ms
.
Di§bËIÁ¿InIÁ”
[1], 0, 0.0, 1, 0.0, 1.0, },

555 {"MVCIÁ”V›wReÜd”", &
cfg·¿ms
.
MVCIÁ”V›wReÜd”
, 0, 0.0, 1, 0.0, 2.0, },

556 {"MVCFlV›ws", &
cfg·¿ms
.
MVCFlV›ws
, 0, 0.0, 1, 0.0, 1.0, },

557 {"QPOff£t", &
cfg·¿ms
.
V›w1QPOff£t
, 0, 0.0, 0, (è-
MAX_QP
, () MAX_QP, },

558 {"MVCIÁ”V›wFÜûB", &
cfg·¿ms
.
MVCIÁ”V›wFÜûB
, 0, 0.0, 1, 0.0, 1.0, },

559 {"MVCEÇbËIÁ”V›wFÏg", &
cfg·¿ms
.
’abË_š‹r_v›w_æag
, 0, 1.0, 1, 0.0, 1.0, },

560 {"S•V›wIÁ”S—rch", &
cfg·¿ms
.
S•V›wIÁ”S—rch
, 0, 0.0, 1, 0.0, 1.0, },

561 {"NoResidueRDO", &
cfg·¿ms
.
V›w1NoResidueRDO
, 0, 1.0, 1, 0.0, 1.0, },

562 {"PLi¡0Reã»nûs", &
cfg·¿ms
.
P_Li¡0_»fs
[1], 0, 0.0, 1, 0.0, 16.0, },

563 {"BLi¡0Reã»nûs", &
cfg·¿ms
.
B_Li¡0_»fs
[1], 0, 0.0, 1, 0.0, 16.0, },

564 {"BLi¡1Reã»nûs", &
cfg·¿ms
.
B_Li¡1_»fs
[1], 0, 1.0, 1, 0.0, 16.0, },

565 {"LambdaMuÉl›r", &
cfg·¿ms
.
’h_Ïy”_Ïmbda_muÉl›r
, 2, 1.0, 2, 0.0, 0.0, },

566 {"MELambdaMuÉl›r", &
cfg·¿ms
.
’h_Ïy”_me_Ïmbda_muÉl›r
, 2, 1.0, 2, 0.0, 0.0, },

567 {"PSliûSk", &
cfg·¿ms
.
IÁ”S—rch
[1][0][0], 0, 1.0, 1, 0.0, 1.0, },

568 {"PSliûS—rch16x16", &
cfg·¿ms
.
IÁ”S—rch
[1][0][1], 0, 1.0, 1, 0.0, 1.0, },

569 {"PSliûS—rch16x8", &
cfg·¿ms
.
IÁ”S—rch
[1][0][2], 0, 1.0, 1, 0.0, 1.0, },

570 {"PSliûS—rch8x16", &
cfg·¿ms
.
IÁ”S—rch
[1][0][3], 0, 1.0, 1, 0.0, 1.0, },

571 {"PSliûS—rch8x8", &
cfg·¿ms
.
IÁ”S—rch
[1][0][4], 0, 1.0, 1, 0.0, 1.0, },

572 {"PSliûS—rch8x4", &
cfg·¿ms
.
IÁ”S—rch
[1][0][5], 0, 1.0, 1, 0.0, 1.0, },

573 {"PSliûS—rch4x8", &
cfg·¿ms
.
IÁ”S—rch
[1][0][6], 0, 1.0, 1, 0.0, 1.0, },

574 {"PSliûS—rch4x4", &
cfg·¿ms
.
IÁ”S—rch
[1][0][7], 0, 1.0, 1, 0.0, 1.0, },

576 {"BSliûDœeù", &
cfg·¿ms
.
IÁ”S—rch
[1][1][0], 0, 1.0, 1, 0.0, 1.0, },

577 {"BSliûS—rch16x16", &
cfg·¿ms
.
IÁ”S—rch
[1][1][1], 0, 1.0, 1, 0.0, 1.0, },

578 {"BSliûS—rch16x8", &
cfg·¿ms
.
IÁ”S—rch
[1][1][2], 0, 1.0, 1, 0.0, 1.0, },

579 {"BSliûS—rch8x16", &
cfg·¿ms
.
IÁ”S—rch
[1][1][3], 0, 1.0, 1, 0.0, 1.0, },

580 {"BSliûS—rch8x8", &
cfg·¿ms
.
IÁ”S—rch
[1][1][4], 0, 1.0, 1, 0.0, 1.0, },

581 {"BSliûS—rch8x4", &
cfg·¿ms
.
IÁ”S—rch
[1][1][5], 0, 1.0, 1, 0.0, 1.0, },

582 {"BSliûS—rch4x8", &
cfg·¿ms
.
IÁ”S—rch
[1][1][6], 0, 1.0, 1, 0.0, 1.0, },

583 {"BSliûS—rch4x4", &
cfg·¿ms
.
IÁ”S—rch
[1][1][7], 0, 1.0, 1, 0.0, 1.0, },

584 {"BiP»dMES—rchRªge", &
cfg·¿ms
.
BiP»dMES—rchRªge
[1], 0, 8.0, 2, 0.0, 0.0, },

585 {"MDReã»nû", &
cfg·¿ms
.
MDReã»nû
[1], 0, 0.0, 1, 0.0, 1.0, },

586 {"DFDi§bËRefISliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[1][
I_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

587 {"DFDi§bËNRefISliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[0][
I_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

588 {"DFDi§bËRefPSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[1][
P_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

589 {"DFDi§bËNRefPSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[0][
P_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

590 {"DFDi§bËRefBSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[1][
B_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

591 {"DFDi§bËNRefBSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[0][
B_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

592 {"DFDi§bËRefSPSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[1][
SP_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

593 {"DFDi§bËNRefSPSliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[0][
SP_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

594 {"DFDi§bËRefSISliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[1][
SI_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

595 {"DFDi§bËNRefSISliû", &
cfg·¿ms
.
EnhLay”DFDi§bËIdc
[0][
SI_SLICE
], 0, 0.0, 1, 0.0, 2.0, },

596 {"DFAÍhaRefISliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[1][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

597 {"DFAÍhaNRefISliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[0][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

598 {"DFAÍhaRefPSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[1][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

599 {"DFAÍhaNRefPSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[0][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

600 {"DFAÍhaRefBSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[1][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

601 {"DFAÍhaNRefBSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[0][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

602 {"DFAÍhaRefSPSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[1][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

603 {"DFAÍhaNRefSPSliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[0][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

604 {"DFAÍhaRefSISliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[1][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

605 {"DFAÍhaNRefSISliû", &
cfg·¿ms
.
EnhLay”DFAÍha
[0][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

606 {"DFB‘aRefISliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[1][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

607 {"DFB‘aNRefISliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[0][
I_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

608 {"DFB‘aRefPSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[1][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

609 {"DFB‘aNRefPSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[0][
P_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

610 {"DFB‘aRefBSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[1][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

611 {"DFB‘aNRefBSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[0][
B_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

612 {"DFB‘aRefSPSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[1][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

613 {"DFB‘aNRefSPSliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[0][
SP_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

614 {"DFB‘aRefSISliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[1][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

615 {"DFB‘aNRefSISliû", &
cfg·¿ms
.
EnhLay”DFB‘a
[0][
SI_SLICE
], 0, 0.0, 1, -6.0, 6.0, },

616 {"S—rchMode", &
cfg·¿ms
.
S—rchMode
[1], 0, 0.0, 1, -1.0, 3.0, },

617 {"EPZSTempÜ®", &
cfg·¿ms
.
EPZSTempÜ®
[1], 0, 0.0, 1, 0.0, 1.0, },

618 {"EÇbËEPZSSÿËrs", &
cfg·¿ms
.
EÇbËEnhLay”EPZSSÿËrs
, 0, 0.0, 1, 0.0, 1.0, },

619 {"EPZSMšTh»sSÿË", &
cfg·¿ms
.
EPZSMšTh»sSÿË
[1], 0, 0.0, 0, 0.0, 0.0, },

620 {"EPZSMaxTh»sSÿË", &
cfg·¿ms
.
EPZSMaxTh»sSÿË
[1], 0, 2.0, 0, 0.0, 0.0, },

621 {"EPZSMedTh»sSÿË", &
cfg·¿ms
.
EPZSMedTh»sSÿË
[1], 0, 1.0, 0, 0.0, 0.0, },

622 {"EPZSSubP–Th»sSÿË", &
cfg·¿ms
.
EPZSSubP–Th»sSÿË
[1], 0, 1.0, 0, 0.0, 0.0, },

623 {
NULL
, NULL, -1, 0.0, 0, 0.0, 0.0, },

629 #iâdeà
INCLUDED_BY_CONFIGFILE_C


630 
M­pšg
 
M­
[];

631 
M­pšg
 
M­V›w1
[];

634 
CÚfigu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ac
, *
av
[]);

635 
g‘_numb”_of_äames
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
);

636 
»ad_¦iû_group_šfo
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

	@lencod/inc/conformance.h

15 #iâdeà
_CONFORMANCE_H_


16 
	#_CONFORMANCE_H_


	)

18 
BoÞ—n
 
is_v®id_Ëv–
 (
´ofžeIdc
, 
Ëv–Idc
);

19 
g‘_Ëv–_šdex
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
);

20 
´ofže_check
 (
IÅutP¬am‘”s
 *
p_IÅ
);

21 
Ëv–_check
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

22 
upd©e_mv_lim™s
 (
VideoP¬am‘”s
 *
p_Vid
, 
by‹
 
is_f›ld
);

23 
þ_mv_¿nge
 (
VideoP¬am‘”s
 *
p_Vid
, 
£¬ch_¿nge
, 
MÙiÚVeùÜ
 *
mv
, 
»s
);

24 
out_of_bounds_mvs
 (
VideoP¬am‘”s
 *
p_Vid
, cÚ¡ 
MÙiÚVeùÜ
 *
mv
);

25 
‹¡_þ_mvs
 (
VideoP¬am‘”s
 *
p_Vid
, 
MÙiÚVeùÜ
 *
mv
, 
BoÞ—n
 
wr™e_mb
);

26 
BoÞ—n
 
CheckP»diùiÚP¬ams
(
Maüoblock
 *
cu¼MB
, 
Block8x8Info
 *
b8x8šfo
, 
mode
);

28 
g‘MaxMBPS
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
);

29 
g‘MšCR
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
);

30 
g‘MaxBR
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
);

31 
g‘MaxCPB
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
);

34 
	mLEVEL_1
 = 0,

35 
	mLEVEL_1b
 = 1,

36 
	mLEVEL_1_1
 = 2,

37 
	mLEVEL_1_2
 = 3,

38 
	mLEVEL_1_3
 = 4,

39 
	mLEVEL_2
 = 5,

40 
	mLEVEL_2_1
 = 6,

41 
	mLEVEL_2_2
 = 7,

42 
	mLEVEL_3
 = 8,

43 
	mLEVEL_3_1
 = 9,

44 
	mLEVEL_3_2
 = 10,

45 
	mLEVEL_4
 = 11,

46 
	mLEVEL_4_1
 = 12,

47 
	mLEVEL_4_2
 = 13,

48 
	mLEVEL_5
 = 14,

49 
	mLEVEL_5_1
 = 15,

50 
	mLEVEL_5_2
 = 16,

51 
	mLEVEL_6
 = 17,

52 
	mLEVEL_6_1
 = 18,

53 
	mLEVEL_6_2
 = 19,

54 
	mLEVEL_UNCONSTRAINED
 = 20

55 } 
	tLev–Id
;

	@lencod/inc/context_ini.h

16 #iâdeà
_CONTEXT_INI_


17 
	#_CONTEXT_INI_


	)

19 
ü—‹_cÚ‹xt_memÜy
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

20 
ä“_cÚ‹xt_memÜy
 (
VideoP¬am‘”s
 *
p_Vid
);

21 
upd©e_f›ld_äame_cÚ‹xts
 (
VideoP¬am‘”s
 *
p_Vid
, );

22 
S‘CtxMod–Numb”
 (
Sliû
 *
cu¼Sliû
);

23 
š™_cÚ‹xts
 (
Sliû
 *
cu¼Sliû
);

24 
¡Üe_cÚ‹xts
 (
Sliû
 *
cu¼Sliû
);

	@lencod/inc/contributors.h

	@lencod/inc/defines.h

21 #iâdeà
_DEFINES_H_


22 
	#_DEFINES_H_


	)

24 #ià
defšed
 
_DEBUG


25 
	#TRACE
 0

26 #–£

	)

27 
	#TRACE
 0

29 

	)

30 
	#JM
 "19 (FRExt)"

	)

31 
	#VERSION
 "19.0"

	)

32 
	#EXT_VERSION
 "(FRExt)"

	)

34 
	#GET_METIME
 1

35 
	#DUMP_DPB
 0

36 
	#PRINTREFLIST
 0

37 
	#IMGTYPE
 1

38 
	#ENABLE_FIELD_CTX
 1

39 
	#ENABLE_HIGH444_CTX
 1

40 
	#DEBUG_BITDEPTH
 0

41 
	#ALLOW_GRAYSCALE
 1

42 
	#ZEROSNR
 1

43 
	#USE_RND_COST
 0

44 
	#JM_INT_DIVIDE
 1

	)

45 
	#JM_MEM_DISTORTION
 0

	)

46 
	#JCOST_CALC_SCALEUP
 1

47 
	#INTRA_RDCOSTCALC_ET
 1

48 
	#INTRA_RDCOSTCALC_NNZ
 1

49 
	#JCOST_OVERFLOWCHECK
 0

50 
	#JM_PARALLEL_DEBLOCK
 0

51 
	#SIMULCAST_ENABLE
 0

	)

53 
	#MVC_EXTENSION_ENABLE
 1

54 
	#EOS_OUTPUT
 0

	)

56 
	#EPZSREF
 1

	)

58 
	#MAX_RC_MODE
 3

	)

59 
	#RC_MAX_TEMPORAL_LEVELS
 5

	)

61 
	#SSE_MEMORY_ALIGNMENT
 16

	)

62 
	#MAX_NUM_DPB_LAYERS
 2

	)

66 
	#OUTPUT_REF_LIST
 0

67 

	)

68 
	#B0_MORE_REF
 1

69 
	#KEEP_B_SAME_LIST
 1

70 
	#CRA
 1

75 
	#HM50_LIKE_MMCO
 1

76 
	#LD_REF_SETTING
 1

77 

	)

81 
	mNO_PROFILE
 = 0,

82 
	mFREXT_CAVLC444
 = 44,

83 
	mBASELINE
 = 66,

84 
	mMAIN
 = 77,

85 
	mEXTENDED
 = 88,

86 
	mFREXT_HP
 = 100,

87 
	mFREXT_Hi10P
 = 110,

88 
	mFREXT_Hi422
 = 122,

89 
	mFREXT_Hi444
 = 244,

90 
	mMULTIVIEW_HIGH
 = 118,

91 
	mSTEREO_HIGH
 = 128

92 } 
	gProfžeIDC
;

95 
	~"ty³s.h
"

97 
	#FILE_NAME_SIZE
 255

	)

98 
	#INPUT_TEXT_SIZE
 1024

	)

100 
	#CAVLC_LEVEL_LIMIT
 2063

	)

102 #ià(
ENABLE_HIGH444_CTX
 == 1)

103 
	#NUM_BLOCK_TYPES
 22

	)

105 
	#NUM_BLOCK_TYPES
 10

	)

108 
	#_LEAKYBUCKET_


	)

114 
	#_LUMA_COEFF_COST_
 4

115 
	#_CHROMA_COEFF_COST_
 4

116 
	#_LUMA_MB_COEFF_COST_
 5

117 
	#_LUMA_8x8_COEFF_COST_
 5

118 

	)

121 
	#IMG_PAD_SIZE_X
 32

122 
	#IMG_PAD_SIZE_Y
 20

123 

	)

124 
	#MAX_VALUE
 999999

125 
	#INVALIDINDEX
 (-135792468)

	)

127 
	#DUMMY
 14

	)

128 
	#ET_SIZE
 300

129 

	)

130 
	#LAMBDA_ACCURACY_BITS
 5

	)

131 
	#LAMBDA_FACTOR
(
Ïmbda
è(()(()(1 << 
LAMBDA_ACCURACY_BITS
è*†ambd¨+ 0.5))

	)

133 #ià(
IMGTYPE
 == 0)

134 
	#DISTBLK_MAX
 
INT_MAX


	)

136 
	#DISTBLK_MAX
 ((
di¡blk
è
INT_MAX
 << 
LAMBDA_ACCURACY_BITS
)

	)

139 
	#MAXSLICEPERPICTURE
 100

	)

140 
	#MAX_REFERENCE_PICTURES
 32

	)

142 
	#BLOCK_SHIFT
 2

	)

143 
	#BLOCK_SIZE
 4

	)

144 
	#BLOCK_SIZE_8x8
 8

	)

145 
	#SMB_BLOCK_SIZE
 8

	)

146 
	#BLOCK_PIXELS
 16

	)

147 
	#MB_BLOCK_SIZE
 16

	)

148 
	#MB_PIXELS
 256

149 
	#MB_PIXELS_SHIFT
 8

150 
	#MB_BLOCK_SHIFT
 4

	)

151 
	#BLOCK_MULTIPLE
 4

152 
	#MB_BLOCK_PARTITIONS
 16

153 
	#BLOCK_CONTEXT
 64

155 
	#BLOCK_SIZE_SP
 16

156 
	#BLOCK_SIZE_8x8_SP
 32

157 

	)

159 
	#NUM_WAVELET_LEVEL
 4

	)

162 
	#MAX_PREC_COEFF
 25

	)

168 
	mPSKIP
 = 0,

169 
	mBSKIP_DIRECT
 = 0,

170 
	mP16x16
 = 1,

171 
	mP16x8
 = 2,

172 
	mP8x16
 = 3,

173 
	mSMB8x8
 = 4,

174 
	mSMB8x4
 = 5,

175 
	mSMB4x8
 = 6,

176 
	mSMB4x4
 = 7,

177 
	mP8x8
 = 8,

178 
	mI4MB
 = 9,

179 
	mI16MB
 = 10,

180 
	mIBLOCK
 = 11,

181 
	mSI4MB
 = 12,

182 
	mI8MB
 = 13,

183 
	mIPCM
 = 14,

184 
	mMAXMODE
 = 15

185 } 
	gMBModeTy³s
;

188 
	#NO_INTRA_PMODE
 9

	)

192 
	mDIR_TEMPORAL
 = 0,

193 
	mDIR_SPATIAL
 = 1

194 } 
	gDœeùModes
;

198 
	mLUMA
 = 0,

199 
	mLUMA_INTRA16x16DC
 = 1,

200 
	mLUMA_INTRA16x16AC
 = 2,

201 
	mCB
 = 3,

202 
	mCB_INTRA16x16DC
 = 4,

203 
	mCB_INTRA16x16AC
 = 5,

204 
	mCR
 = 8,

205 
	mCR_INTRA16x16DC
 = 9,

206 
	mCR_INTRA16x16AC
 = 10

207 } 
	gCAVLCBlockTy³s
;

211 
	mLUMA_16DC
 = 0,

212 
	mLUMA_16AC
 = 1,

213 
	mLUMA_8x8
 = 2,

214 
	mLUMA_8x4
 = 3,

215 
	mLUMA_4x8
 = 4,

216 
	mLUMA_4x4
 = 5,

217 
	mCHROMA_DC
 = 6,

218 
	mCHROMA_AC
 = 7,

219 
	mCHROMA_DC_2x4
 = 8,

220 
	mCHROMA_DC_4x4
 = 9,

221 
	mCB_16DC
 = 10,

222 
	mCB_16AC
 = 11,

223 
	mCB_8x8
 = 12,

224 
	mCB_8x4
 = 13,

225 
	mCB_4x8
 = 14,

226 
	mCB_4x4
 = 15,

227 
	mCR_16DC
 = 16,

228 
	mCR_16AC
 = 17,

229 
	mCR_8x8
 = 18,

230 
	mCR_8x4
 = 19,

231 
	mCR_4x8
 = 20,

232 
	mCR_4x4
 = 21

233 } 
	gCABACBlockTy³s
;

237 
	mY_COMP
 = 0,

238 
	mU_COMP
 = 1,

239 
	mV_COMP
 = 2,

240 
	mR_COMP
 = 3,

241 
	mG_COMP
 = 4,

242 
	mB_COMP
 = 5,

243 
	mT_COMP
 = 6

244 } 
	gCÞÜCompÚ’t
;

247 
	#LEVEL_NUM
 6

	)

248 
	#TOTRUN_NUM
 15

	)

249 
	#RUNBEFORE_NUM
 7

	)

250 
	#RUNBEFORE_NUM_M1
 6

	)

253 
	#MIN_QP
 0

	)

254 
	#MAX_QP
 51

	)

255 
	#SHIFT_QP
 12

	)

259 
	mVERT_PRED
 = 0,

260 
	mHOR_PRED
 = 1,

261 
	mDC_PRED
 = 2,

262 
	mDIAG_DOWN_LEFT_PRED
 = 3,

263 
	mDIAG_DOWN_RIGHT_PRED
 = 4,

264 
	mVERT_RIGHT_PRED
 = 5,

265 
	mHOR_DOWN_PRED
 = 6,

266 
	mVERT_LEFT_PRED
 = 7,

267 
	mHOR_UP_PRED
 = 8

268 } 
	gI4x4P»dModes
;

272 
	mVERT_PRED_16
 = 0,

273 
	mHOR_PRED_16
 = 1,

274 
	mDC_PRED_16
 = 2,

275 
	mPLANE_16
 = 3

276 } 
	gI16x16P»dModes
;

280 
	mDC_PRED_8
 = 0,

281 
	mHOR_PRED_8
 = 1,

282 
	mVERT_PRED_8
 = 2,

283 
	mPLANE_8
 = 3

284 } 
	gI8x8P»dModes
;

286 
	#INIT_FRAME_RATE
 30

	)

288 
	mEOS
 = 1,

289 
	mSOP
 = 2,

290 
	mSOS
 = 3

295 
	mMVPRED_MEDIAN
 = 0,

296 
	mMVPRED_L
 = 1,

297 
	mMVPRED_U
 = 2,

298 
	mMVPRED_UR
 = 3

299 } 
	gMVP»dTy³s
;

301 
	#MAX_SYMBOLS_PER_MB
 1200

303 

	)

305 
	#MAX_PART_NR
 3

	)

310 
	#ZEROBYTES_SHORTSTARTCODE
 2

311 

	)

312 
	#Q_BITS
 15

	)

313 
	#DQ_BITS
 6

	)

315 
	#Q_BITS_8
 16

	)

316 
	#DQ_BITS_8
 6

	)

319 
	#CALM_MF_FACTOR_THRESHOLD
 512.0

	)

321 
	#MAX_PLANE
 3

	)

323 
	#MAXSLICEGROUPIDS
 8

	)

326 
	#NUM_MB_TYPE_CTX
 11

	)

327 
	#NUM_B8_TYPE_CTX
 9

	)

328 
	#NUM_MV_RES_CTX
 10

	)

329 
	#NUM_REF_NO_CTX
 6

	)

330 
	#NUM_DELTA_QP_CTX
 4

	)

331 
	#NUM_MB_AFF_CTX
 4

	)

333 
	#NUM_TRANSFORM_SIZE_CTX
 3

	)

335 
	#NUM_IPR_CTX
 2

	)

336 
	#NUM_CIPR_CTX
 4

	)

337 
	#NUM_CBP_CTX
 4

	)

338 
	#NUM_BCBP_CTX
 4

	)

339 
	#NUM_MAP_CTX
 15

	)

340 
	#NUM_LAST_CTX
 15

	)

341 
	#NUM_ONE_CTX
 5

	)

342 
	#NUM_ABS_CTX
 5

	)

346 
	mOTF_L0
 = 0,

347 
	mOTF_L1
 = 1,

348 
	mOTF_L2
 = 2

349 } 
	gOTFMode
;

353 
	mOTF_ME
 = 0,

354 
	mOTF_MC
 = 1

355 } 
	gOTFFunùiÚ
;

357 #ià
IMGTYPE


358 #ià
JM_MEM_DISTORTION


359 #´agm¨
mes§ge
("JM_MEM_DISTORTION must be zero!")

	@lencod/inc/elements.h

22 #iâdeà
_ELEMENTS_H_


23 
	#_ELEMENTS_H_


	)

30 
	#MAXPARTITIONMODES
 2

31 

	)

84 cÚ¡ * 
assignSE2·¹™iÚ
[2];

85 cÚ¡ 
assignSE2·¹™iÚ_NoDP
[
SE_MAX_ELEMENTS
];

86 cÚ¡ 
assignSE2·¹™iÚ_DP
[
SE_MAX_ELEMENTS
];

	@lencod/inc/errdo.h

15 #iâdeà
_ERRDO_H_


16 
	#_ERRDO_H_


	)

21 
	mLLN
 = 0,

22 
	mROPE
 = 1,

23 
	mRMPC
 = 2,

24 } 
	tDE_Ty³
;

26 
	sdi¡ÜtiÚ_e¡im©iÚ


29 ** 
	m»s_cÚ_diff_Y
;

30 *** 
	m»s_cÚ_diff_UV
;

31 ** 
	mp_»s_cÚ_diff
[
MAX_PLANE
];

32 ** 
	mMV_cÚ_diff_Y
;

33 *** 
	mMV_cÚ_diff_UV
;

34 ** 
	mp_MV_cÚ_diff
[
MAX_PLANE
];

35 
by‹
 ** 
	m”rÜ_sign_æag_Y
;

36 
by‹
 ***
	m”rÜ_sign_æag_UV
;

37 
by‹
 ** 
	mp_”rÜ_sign_æag
[
MAX_PLANE
];

38 ** 
	mŒªsmissiÚ_di¡_Y
;

39 *** 
	mŒªsmissiÚ_di¡_UV
;

40 ** 
	mp_ŒªsmissiÚ_di¡
[
MAX_PLANE
];

41 ** 
	mŒªsmissiÚ_”r_Y
;

42 *** 
	mŒªsmissiÚ_”r_UV
;

43 ** 
	mp_ŒªsmissiÚ_”r
[
MAX_PLANE
];

46 
img³l
 *** 
	mdec_imgY
;

47 
img³l
 **** 
	mdec_imgUV
;

48 
img³l
 *** 
	mp_dec_img
[
MAX_PLANE
];

49 
by‹
 *** 
	mmb_”rÜ_m­
;

52 
img³l
 ** 
	mfœ¡_mom’t_Y
;

53 
img³l
 *** 
	mfœ¡_mom’t_UV
;

54 
img³l
 ** 
	mp_fœ¡_mom’t
[
MAX_PLANE
];

55 
ušt16
 ** 
	m£cÚd_mom’t_Y
;

56 
ušt16
 *** 
	m£cÚd_mom’t_UV
;

57 
ušt16
 ** 
	mp_£cÚd_mom’t
[
MAX_PLANE
];

62 
	sdecod”s


64 ***
	m»s_img
;

65 ***
	m»s_mb_be¡8x8
;

68 **
	mRCD_be¡Y_mb
;

69 ***
	mRCD_be¡Y_b8x8
;

70 **
	mMVCD_be¡Y_mb
;

71 ***
	mMVCD_be¡Y_b8x8
;

72 
by‹
 **
	mæag_be¡Y_mb
;

73 
by‹
 ***
	mæag_be¡Y_b8x8
;

74 
by‹
 **
	mæag_wo_»s
;

75 
by‹
 ***
	mæag_wo_»s_be¡Y_b8x8
;

76 **
	mŒªs_di¡_be¡Y_mb
;

77 ***
	mŒªs_di¡_be¡Y_b8x8
;

78 **
	mŒªs_di¡_wo_»s
;

79 ***
	mŒªs_di¡_wo_»s_be¡Y_b8x8
;

80 **
	mŒªs_”r_be¡Y_mb
;

81 ***
	mŒªs_”r_be¡Y_b8x8
;

82 **
	mŒªs_”r_wo_»s
;

83 ***
	mŒªs_”r_wo_»s_be¡Y_b8x8
;

86 
img³l
 ***
	mdec_mbY_be¡
;

87 
img³l
 ****
	mdec_mbY_be¡8x8
;

88 
img³l
 ****
	mdec_mb_´ed_be¡8x8
;

89 
img³l
 ***
	mdec_mb_´ed
;

90 
	m»c_ty³
;

93 
img³l
 **
	mfœ¡_mom’t_be¡Y_mb
;

94 
img³l
 ***
	mfœ¡_mom’t_be¡Y_b8x8
;

95 
img³l
 ***
	mfœ¡_mom’t_´ed_be¡Y_b8x8
;

96 
img³l
 **
	mfœ¡_mom’t_´ed
;

97 
ušt16
 **
	m£cÚd_mom’t_be¡Y_mb
;

98 
ušt16
 ***
	m£cÚd_mom’t_be¡Y_b8x8
;

99 
ušt16
 ***
	m£cÚd_mom’t_´ed_be¡Y_b8x8
;

100 
ušt16
 **
	m£cÚd_mom’t_´ed
;

103 
decod”s
 
	tDecod”s
;

107 
š™_”rÜ_cÚû®
 (
VideoP¬am‘”s
 *
p_Vid
, 
cÚû®m’t_ty³
);

108 
”rdo_compu‹_»sidue
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
imgY
, **
»s_img
, img³È**
mb_´ed
, 
b8block
, 
block_size
);

109 
®loÿ‹_”rdo_mem
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

110 
ä“_”rdo_mem
 (
VideoP¬am‘”s
 *
p_Vid
);

112 
š™_di¡ÜtiÚ_e¡im©iÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
de_®gÜ™hm
);

113 
”rdo_¡Üe_be¡_b8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

114 
”rdo_g‘_be¡_b8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

115 
”rdo_¡Üe_be¡_MB
(
Maüoblock
 *
cu¼MB
);

116 
”rdo_g‘_be¡_MB
(
Maüoblock
 *
cu¼MB
);

117 
”rdo_g‘_be¡_P8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
);

118 
”rdo_®loc_¡ÜabË_piùu»
(
StÜabËPiùu»
 *
s
, 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
size_x
, 
size_y
, 
size_x_ü
, 
size_y_ü
);

119 
”rdo_ä“_¡ÜabË_piùu»
(
StÜabËPiùu»
* 
p
);

120 
StÜabËPiùu»
* 
fšd_Ã¬e¡_»f_piùu»
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
poc
);

	@lencod/inc/errdo_dist_mhyp.h

14 #iâdeà
_ERRDO_DIST_MHYP_H_


15 
	#_ERRDO_DIST_MHYP_H_


	)

17 
”rdo_¡Üe_be¡_block_muÉihyp
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
*** 
mbY
, img³l*** 
dec_img
, 
block
, 
img_i
, 
img_j
, 
block_size
);

18 
”rdo_g‘_be¡_block_muÉihyp
 (
Maüoblock
 *
cu¼MB
, 
img³l
*** 
dec_img
, img³l*** 
mbY
, 
block
, 
block_size
);

19 
di¡blk
 
”rdo_di¡ÜtiÚ_e¡im©iÚ_muÉihyp
(
Maüoblock
 *
cu¼MB
, 
block
, 
block_size
, 
mode
, 
pdœ
, di¡blk 
mš_rdco¡
);

20 
cÝy_cÚû®_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
);

	@lencod/inc/explicit_gop.h

15 #iâdeà
_EXPLICIT_GOP_H_


16 
	#_EXPLICIT_GOP_H_


	)

19 
š™_gÝ_¡ruùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

20 
š‹½»t_gÝ_¡ruùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

21 
þ—r_gÝ_¡ruùu»
 (
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/explicit_seq.h

15 #iâdeà
_EXPLICIT_SEQ_H_


16 
	#_EXPLICIT_SEQ_H_


	)

21 
	m£q_numb”
;

22 
	m¦iû_ty³
;

23 
	mis_idr
;

24 
	m»ã»nû_idc
;

25 
	mäame_qp
;

26 
	mdeblockšg
;

27 
	mis_f›ld
;

28 } 
	tExpF¿meInfo
;

30 
	sexp_£q_šfo


32 
	mno_äames
;

33 
ExpF¿meInfo
 *
	mšfo
;

34 } 
	tExpSeqInfo
;

36 
R—dEx¶ic™SeqFže
 (
ExpSeqInfo
 *
£q_šfo
, 
FILE
 *
exp_fže
, 
codšg_šdex
);

37 
O³nEx¶ic™SeqFže
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

38 
Clo£Ex¶ic™SeqFže
 (
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/filehandle.h

16 #iâdeà
_FILEHANDLE_H_


17 
	#_FILEHANDLE_H_


	)

19 
»wr™e_·¿m£ts
 (
VideoP¬am‘”s
 *
p_Vid
);

20 
¡¬t_£qu’û
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

21 
‹rmš©e_£qu’û
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

22 
wr™e_PPS
 (
VideoP¬am‘”s
 *
p_Vid
, 
Ën
, 
PPS_id
);

23 
’d_of_¡»am
 (
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/fmo.h

17 #iâdeà
_FMO_H_


18 
	#_FMO_H_


	)

20 
FmoIn™
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
, 
£q_·¿m‘”_£t_rb¥_t
 * 
¥s
);

21 
FmoUnš™
 (
VideoP¬am‘”s
 *
p_Vid
);

22 
FmoFš™
 (
£q_·¿m‘”_£t_rb¥_t
 * 
¥s
);

23 
FmoMB2SliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb
);

24 
FmoG‘Fœ¡MBOfSliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
);

25 
FmoG‘Fœ¡MaüoblockInSliû
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroup
);

26 
FmoG‘NextMBNr
 (
VideoP¬am‘”s
 *
p_Vid
, 
Cu¼’tMbNr
);

27 
FmoG‘P»viousMBNr
 (
VideoP¬am‘”s
 *
p_Vid
, 
Cu¼’tMbNr
);

28 
FmoG‘La¡CodedMBOfSliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
);

29 
FmoS¹Piùu»
 (
VideoP¬am‘”s
 *
p_Vid
);

30 
FmoEndPiùu»
 ();

31 
FmoSliûGroupCom¶‘–yCoded
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
);

32 
FmoS‘La¡MaüoblockInSliû
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb
);

	@lencod/inc/get_block_otf.h

13 #iâdeà
_GET_BLOCK_OTF_H_


14 
	#_GET_BLOCK_OTF_H_


	)

16 
g‘_block_luma_Ùf_L2
Ð
VideoP¬am‘”s
 *
p_Vid
,

17 
img³l
* 
m´ed
,

18 * 
tmp_´ed
,

19 
pic_pix_x
,

20 
pic_pix_y
,

21 
block_size_x
,

22 
block_size_y
,

23 
StÜabËPiùu»
 *
»f
,

24 
¶


27 
g‘_block_luma_Ùf_L1
Ð
VideoP¬am‘”s
 *
p_Vid
,

28 
img³l
* 
m´ed
,

29 * 
tmp_´ed
,

30 
pic_pix_x
,

31 
pic_pix_y
,

32 
block_size_x
,

33 
block_size_y
,

34 
StÜabËPiùu»
 *
»f
,

35 
¶


39 
g‘_block_chroma_Ùf_L2
 ( 
VideoP¬am‘”s
 *
p_Vid
,

40 
img³l
* 
m´ed
,

41 * 
tmp_´ed
,

42 
pic_pix_x
,

43 
pic_pix_y
,

44 
block_size_x
,

45 
block_size_y
,

46 
StÜabËPiùu»
 *
»f
,

47 
uv


50 
me_g‘_block_chroma_Ùf_L1
 ( 
VideoP¬am‘”s
 *
p_Vid
,

51 
img³l
* 
m´ed
,

52 * 
tmp_´ed
,

53 
pic_pix_x
,

54 
pic_pix_y
,

55 
block_size_x
,

56 
block_size_y
,

57 
StÜabËPiùu»
 *
»f
,

58 
uv


61 
mc_g‘_block_chroma_Ùf_L1
 ( 
VideoP¬am‘”s
 *
p_Vid
,

62 
img³l
* 
m´ed
,

63 * 
tmp_´ed
,

64 
pic_pix_x
,

65 
pic_pix_y
,

66 
block_size_x
,

67 
block_size_y
,

68 
StÜabËPiùu»
 *
»f
,

69 
uv


90 
šlše
 
	$is_q³l
Ð
x
, 
y
, 
bx
, 
by
 )

92  ( ((
x
&
bx
)%2è|| ((
y
&
by
)%2) ) ? (1):(0) ;

93 
	}
}

	@lencod/inc/global.h

14 #iâdeà
_GLOBAL_H_


15 
	#_GLOBAL_H_


	)

17 
	~"defšes.h
"

18 
	~"wš32.h
"

19 
	~"ty³defs.h
"

20 
	~"·r£tcommÚ.h
"

21 
	~"ifunùiÚs.h
"

22 
	~"äame.h
"

23 
	~"io_video.h
"

24 
	~"io_image.h
"

25 
	~"ÇlucommÚ.h
"

26 
	~"·¿ms.h
"

27 
	~"di¡ÜtiÚ.h
"

28 
	~"Ïg¿ngŸn.h
"

29 
	~"quªt_·¿ms.h
"

30 
	~"rc_ty³s.h
"

32 
b™_¡»am_’c
 
	tB™¡»am
;

34 
	~"´ed_¡ruù_ty³s.h
"

41 
šp_·r_’c
 
	tIÅutP¬am‘”s
;

44 
	g¡ÜabË_piùu»
;

45 
	gcodšg_¡©e
;

46 
	gpic_mÙiÚ_·¿ms_Þd
;

47 
	gpic_mÙiÚ_·¿ms
;

49 
image_¡ruùu»
 
	tImageSŒuùu»
;

50 
šfo_8x8
 
	tInfo8x8
;

51 
£¬ch_wšdow
 
	tS—rchWšdow
;

52 
block_pos
 
	tBlockPos
;

53 
b™_couÁ”
 
	tB™CouÁ”
;

54 
’codšg_’vœÚm’t
 
	tEncodšgEnvœÚm’t
;

55 
EncodšgEnvœÚm’t
 *
	tEncodšgEnvœÚm’tPŒ
;

56 
bi_cÚ‹xt_ty³
 
	tBiCÚ‹xtTy³
;

57 
BiCÚ‹xtTy³
 *
	tBiCÚ‹xtTy³PŒ
;

59 
	simage_¡ruùu»


61 
F¿meFÜm©
 
	mfÜm©
;

62 
img³l
 **
	md©a
[3];

66 
	sšfo_8x8


68 
	mmode
;

69 
	mpdœ
;

70 
	m»f
[2];

71 
	mb»d
;

74 
	s£¬ch_wšdow
 {

75 
	mmš_x
;

76 
	mmax_x
;

77 
	mmš_y
;

78 
	mmax_y
;

81 
	sblock_pos


83 
	mx
;

84 
	my
;

88 
	sb™_couÁ”


90 
	mmb_tÙ®
;

91 
	mmb_mode
;

92 
	mmb_š‹r
;

93 
	mmb_cbp
;

94 
	mmb_d–_quªt
;

95 
	mmb_y_cÛff
;

96 
	mmb_uv_cÛff
;

97 
	mmb_cb_cÛff
;

98 
	mmb_ü_cÛff
;

99 
	mmb_¡uffšg
;

103 
	s’codšg_’vœÚm’t


105 
video_·r
 *
	mp_Vid
;

106 
	mElow
, 
	mE¿nge
;

107 
	mEbufãr
;

108 
	mEb™s_to_go
;

109 
	mEchunks_out¡ªdšg
;

110 
	mEpbuf
;

111 
by‹
 *
	mEcode¡rm
;

112 *
	mEcode¡rm_Ën
;

113 
	mC
;

114 
	mE
;

118 
	sbi_cÚ‹xt_ty³


120 
	mcouÁ
;

121 
by‹
 
	m¡©e
;

122 
	mMPS
;

134 
BiCÚ‹xtTy³
 
	mmb_ty³_cÚ‹xts
 [3][
NUM_MB_TYPE_CTX
];

135 
BiCÚ‹xtTy³
 
	mb8_ty³_cÚ‹xts
 [2][
NUM_B8_TYPE_CTX
];

136 
BiCÚ‹xtTy³
 
	mmv_»s_cÚ‹xts
 [2][
NUM_MV_RES_CTX
];

137 
BiCÚ‹xtTy³
 
	m»f_no_cÚ‹xts
 [2][
NUM_REF_NO_CTX
];

138 } 
	tMÙiÚInfoCÚ‹xts
;

142 
BiCÚ‹xtTy³
 
	mŒªsfÜm_size_cÚ‹xts
 [
NUM_TRANSFORM_SIZE_CTX
];

143 
BiCÚ‹xtTy³
 
	mr_cÚ‹xts
 [
NUM_IPR_CTX
];

144 
BiCÚ‹xtTy³
 
	mcr_cÚ‹xts
[
NUM_CIPR_CTX
];

145 
BiCÚ‹xtTy³
 
	mcbp_cÚ‹xts
 [3][
NUM_CBP_CTX
];

146 
BiCÚ‹xtTy³
 
	mbcbp_cÚ‹xts
[
NUM_BLOCK_TYPES
][
NUM_BCBP_CTX
];

147 
BiCÚ‹xtTy³
 
	md–_qp_cÚ‹xts
 [
NUM_DELTA_QP_CTX
];

148 
BiCÚ‹xtTy³
 
	mÚe_cÚ‹xts
 [
NUM_BLOCK_TYPES
][
NUM_ONE_CTX
];

149 
BiCÚ‹xtTy³
 
	mabs_cÚ‹xts
 [
NUM_BLOCK_TYPES
][
NUM_ABS_CTX
];

150 #ià
ENABLE_FIELD_CTX


151 
BiCÚ‹xtTy³
 
	mmb_aff_cÚ‹xts
 [
NUM_MB_AFF_CTX
];

152 
BiCÚ‹xtTy³
 
	mm­_cÚ‹xts
 [2][
NUM_BLOCK_TYPES
][
NUM_MAP_CTX
];

153 
BiCÚ‹xtTy³
 
	mÏ¡_cÚ‹xts
[2][
NUM_BLOCK_TYPES
][
NUM_LAST_CTX
];

155 
BiCÚ‹xtTy³
 
	mm­_cÚ‹xts
 [1][
NUM_BLOCK_TYPES
][
NUM_MAP_CTX
];

156 
BiCÚ‹xtTy³
 
	mÏ¡_cÚ‹xts
[1][
NUM_BLOCK_TYPES
][
NUM_LAST_CTX
];

158 } 
	tTextu»InfoCÚ‹xts
;

163 
	spix_pos


165 
	mavažabË
;

166 
	mmb_addr
;

167 
	mx
;

168 
	my
;

169 
	mpos_x
;

170 
	mpos_y
;

171 } 
	tPix–Pos
;

176 
	mmv_x
;

177 
	mmv_y
;

178 } 
	tMÙiÚVeùÜ
;

183 
	m»fIdx
[2];

184 
MÙiÚVeùÜ
 
	mmv
[2];

185 
di¡blk
 
	mdi¡
;

186 
di¡blk
 
	m§d
;

187 } 
	tBiP»dMVInfo
;

189 cÚ¡ 
MÙiÚVeùÜ
 
	gz”o_mv
 = {0, 0};

191 
	srd_8x8_d©a


193 
di¡blk
 
	mmb_p8x8_co¡
;

194 
di¡blk
 
	msmb_p8x8_co¡
[4];

195 
di¡blk
 
	msmb_p8x8_rdco¡
[4];

196 
Info8x8
 
	m·¹
[4];

198 
	mcbp8x8
;

199 
	mcbp_blk8x8
;

200 
	mút_nÚz_8x8
;

202 **
	mÌec
;

203 
img³l
 **
	mm´8x8
;

204 
img³l
 ***
	mm´8x8CbCr
;

205 
img³l
 **
	m»c_mbY8x8
;

206 
img³l
 ***
	m»c_mb8x8_ü
;

207 } 
	tRD_8x8DATA
;

209 
	srd_·¿ms


211 
	mÏmbda_md
;

213 
	mÏmbda_mdå
;

215 
	mÏmbda_me
[3];

216 
	mÏmbda_mf
[3];

217 
	mbe¡_mco¡
[2];

219 
	mv®id
[
MAXMODE
];

220 
	mcu¼_mb_f›ld
;

221 } 
	tRD_PARAMS
;

228 
	m¦iû_ty³
;

229 
	mdi¥Ïy_no
;

230 
	m»ã»nû_idc
;

231 
	m¦iû_qp_off
;

232 
	mh›¿rchy_Ïy”
;

233 
	mh›¿rchyPocD–
;

234 
	m‹mpÜ®_Ïy”
;

241 } 
	tGOP_DATA
;

244 
	sDecRefPicM¬kšg_s


246 
	mmemÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
;

247 
	mdifã»nû_of_pic_nums_mšus1
;

248 
	mlÚg_‹rm_pic_num
;

249 
	mlÚg_‹rm_äame_idx
;

250 
	mmax_lÚg_‹rm_äame_idx_¶us1
;

251 
DecRefPicM¬kšg_s
 *
	mNext
;

252 } 
	tDecRefPicM¬kšg_t
;

254 
	sme_block


256 
video_·r
 *
	mp_Vid
;

258 
	mpos_x_·dded
;

259 
	mpos_y_·dded
;

261 
	mblockty³
;

262 
	mblocksize_x
;

263 
	mblocksize_y
;

264 
	mblocksize_ü_x
;

265 
	mblocksize_ü_y
;

267 
	mblock_x
;

268 
	mblock_y
;

270 
	mpos_x
;

271 
	mpos_y
;

272 
	mpos_x2
;

273 
	mpos_y2
;

275 
	mpos_ü_x
;

276 
	mpos_ü_y
;

278 
	mhme_Ëv–
;

279 
	mhme_»f_size_y_·d
;

280 
	mhme_»f_size_x_·d
;

281 
	mhme_»f_size_y_max
;

282 
	mhme_»f_size_x_max
;

283 
	mli¡
;

284 
	m»f_idx
;

285 
MÙiÚVeùÜ
 
	mmv
[2];

286 
Pix–Pos
 
	mblock
[4];

287 
¦iû
 *
	mp_Sliû
;

288 
£¬ch_wšdow
 
	m£¬chRªge
;

289 
	mco¡
;

290 
img³l
 **
	mÜig_pic
;

291 
	mChromaMEEÇbË
;

292 
	mChromaMEWeight
;

294 
	m­¶y_weights
;

295 
	m­¶y_bi_weights
;

297 
	m‹¡8x8
;

299 
	mweight_luma
;

300 
	mweight_ü
[2];

301 
	moff£t_luma
;

302 
	moff£t_ü
[2];

305 
	mweight1
;

306 
	mweight2
;

307 
	moff£tBi
;

308 
	mweight1_ü
[2];

309 
	mweight2_ü
[2];

310 
	moff£tBi_ü
[2];

311 
	m£¬ch_pos2
;

312 
	m£¬ch_pos4
;

313 
	m™”©iÚ_no
;

316 
di¡blk
 (*
compu‹P»dFP–
è(
	m¡ÜabË_piùu»
 *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 * );

317 
di¡blk
 (*
compu‹P»dHP–
è(
	m¡ÜabË_piùu»
 *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 * );

318 
di¡blk
 (*
compu‹P»dQP–
è(
	m¡ÜabË_piùu»
 *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 * );

319 
di¡blk
 (*
compu‹BiP»dFP–
è(
	m¡ÜabË_piùu»
 *, ¡ÜabË_piùu» *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 *, MotionVector *);

320 
di¡blk
 (*
compu‹BiP»dHP–
è(
	m¡ÜabË_piùu»
 *, ¡ÜabË_piùu» *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 *, MotionVector *);

321 
di¡blk
 (*
compu‹BiP»dQP–
è(
	m¡ÜabË_piùu»
 *, ¡ÜabË_piùu» *, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 *, MotionVector *);

322 } 
	tMEBlock
;

325 
	ssyÁax–em’t_’c


327 
	mty³
;

328 
	mv®ue1
;

329 
	mv®ue2
;

330 
	mËn
;

331 
	mšf
;

332 
	mb™·‰”n
;

333 
	mcÚ‹xt
;

335 #ià
TRACE


336 
	#TRACESTRING_SIZE
 100

337 
Œaû¡ršg
[
TRACESTRING_SIZE
];

339 

	)

341 (*
	mm­pšg
)(
	mv®ue1
, 
	mv®ue2
, * 
	mËn_±r
, * 
	mšfo_±r
);

343 } 
	tSyÁaxEËm’t
;

345 
	swp_·¿ms


347 
	mweight
[3];

348 
	moff£t
[3];

349 } 
	tWPP¬ams
;

352 
	smaüoblock_’c


354 
¦iû
 *
	mp_Sliû
;

355 
video_·r
 *
	mp_Vid
;

356 
IÅutP¬am‘”s
 *
	mp_IÅ
;

357 
	mmbAddrX
;

358 
	mmb_ty³
;

359 
	m¦iû_Ä
;

360 
	mmb_x
;

361 
	mmb_y
;

362 
	mblock_x
;

363 
	mblock_y
;

365 
	mpix_x
;

366 
	mpix_y
;

367 
	mpix_c_x
;

368 
	mpix_c_y
;

370 
	mÝix_y
;

371 
	mÝix_c_y
;

373 
	msubblock_x
;

374 
	msubblock_y
;

376 
	mli¡_off£t
;

377 
BoÞ—n
 
	m´ev_»code_mb
;

378 
	mDeblockC®l
;

380 
	mmbAddrA
, 
	mmbAddrB
, 
	mmbAddrC
, 
	mmbAddrD
;

381 
by‹
 
	mmbAvažA
, 
	mmbAvažB
, 
	mmbAvažC
, 
	mmbAvažD
;

383 
	mqp
;

384 
	mqpc
[2];

385 
	mqp_sÿËd
[
MAX_PLANE
];

386 
	mqp¥
;

387 
	mcbp
;

388 
	m´ev_qp
;

389 
	m´ev_dqp
;

390 
	m´ev_cbp
;

391 
	mü_cbp
[3];

392 
	mc_nzCbCr
[3];

394 
	mi16off£t
;

396 
B™CouÁ”
 
	mb™s
;

398 
	m¬_mode
;

399 
	mmvd
[2][
BLOCK_MULTIPLE
][BLOCK_MULTIPLE][2];

400 
	mc_»d_mode
;

401 
	mi16mode
;

403 
Info8x8
 
	mb8x8
[4];

405 
img³l
 **
	mšŒa4x4_´ed
;

406 
img³l
 **
	mšŒa4x4_´ed_buf
[2];

407 
img³l
 **
	mšŒa8x8_´ed
;

408 
img³l
 **
	mšŒa8x8_´ed_buf
[2];

409 
img³l
 **
	mšŒa16x16_´ed
;

410 
img³l
 **
	mšŒa16x16_´ed_buf
[2];

412 
	mIÁ¿ChromaP»dModeFÏg
;

413 
by‹
 
	mmb_f›ld
;

414 
by‹
 
	mis_f›ld_mode
;

415 
by‹
 
	mluma_ŒªsfÜm_size_8x8_æag
;

416 
by‹
 
	m‹mp_ŒªsfÜm_size_8x8_æag
;

417 
by‹
 
	mNoMbP¬tLessThª8x8FÏg
;

418 
by‹
 
	mv®id_8x8
;

419 
by‹
 
	mv®id_4x4
;

420 
by‹
 
	mwr™e_mb
;

421 
by‹
 
	mis_šŒa_block
;

423 
	mDFDi§bËIdc
;

424 
	mDFAÍhaC0Off£t
;

425 
	mDFB‘aOff£t
;

427 
	msk_æag
;

429 
	mšŒa_´ed_modes
 [
MB_BLOCK_PARTITIONS
];

430 
	mšŒa_´ed_modes8x8
[
MB_BLOCK_PARTITIONS
];

432 
št64
 
	mcbp_blk
 ;

433 
št64
 
	mcbp_b™s
[3];

434 
št64
 
	mcbp_b™s_8x8
[3];

436 
di¡blk
 
	mmš_rdco¡
;

437 
di¡blk
 
	mmš_dco¡
;

438 
di¡blk
 
	mmš_¿‹
;

439 
	mmš_b™s
;

441 
	mbe¡_mode
;

442 
	mbe¡_i16off£t
;

443 
	mbe¡_i16mode
;

444 
	mbe¡_c_imode
;

445 
	mbe¡_cbp
;

448 
	mmode_DPCM
;

452 
maüoblock_’c
 *
	mmb_up
;

453 
maüoblock_’c
 *
	mmb_Ëá
;

454 
maüoblock_’c
 *
	mP»vMB
;

457 (*
	mG‘MVP»diùÜ
è(
maüoblock_’c
 *
	mcu¼MB
, 
Pix–Pos
 *
	mblock
, 
MÙiÚVeùÜ
 *
	mpmv
, 
	m»f_äame
,

458 
pic_mÙiÚ_·¿ms
 **
	mmv_šfo
, 
	mli¡
, 
	mmb_x
, 
	mmb_y
, 
	mblocksh­e_x
, 
	mblocksh­e_y
);

459 
di¡blk
 (*
IÁP–ME
è(
maüoblock_’c
 *
	mcu¼MB
, 
	mMÙiÚVeùÜ
 *, 
me_block
 *
	mmv_block
, 
	mdi¡blk
, );

460 
di¡blk
 (*
SubP–BiP»dME
è(
maüoblock_’c
 *
	mcu¼MB
, 
	mme_block
 *, 
	mli¡
,

461 
MÙiÚVeùÜ
 *
	m´ed_mv1
, MÙiÚVeùÜ *
	m´ed_mv2
, MÙiÚVeùÜ *
	mmv1
, MÙiÚVeùÜ *
	mmv2
, 
di¡blk
 
	mmš_mco¡
, * 
	mÏmbda_çùÜ
);

462 
di¡blk
 (*
SubP–ME
è(
maüoblock_’c
 *
	mcu¼MB
,

463 
MÙiÚVeùÜ
 *
	m´ed_mv
, 
me_block
 *
	mmv_block
, 
di¡blk
 
	mmš_mco¡
, * 
	mÏmbda_çùÜ
);

464 
di¡blk
 (*
BiP»dME
è(
maüoblock_’c
 *
	mcu¼MB
, , 
	mMÙiÚVeùÜ
 *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, 
	mme_block
 *, , 
	mdi¡blk
, );

465 (*
	m»sidu®_ŒªsfÜm_quªt_luma_4x4
è(
maüoblock_’c
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
, 
	mblock_x
, 
	mblock_y
, *
	mcÛff_co¡
, 
	mšŒa
);

466 (*
	m»sidu®_ŒªsfÜm_quªt_luma_16x16
è(
maüoblock_’c
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
);

467 (*
	m»sidu®_ŒªsfÜm_quªt_luma_8x8
è(
maüoblock_’c
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
, 
	mb8
, *
	mcÛff_co¡
, 
	mšŒa
);

468 (*
	m»sidu®_ŒªsfÜm_quªt_chroma_4x4
[2])(
maüoblock_’c
 *
	mcu¼MB
, 
	muv
,
	mi11
);

469 (*
	mp_S‘upFa¡FuÎP–S—rch
è(
	mmaüoblock_’c
 *, 
	mMEBlock
 *, ) ;

471 (*
	mcbp_lšfo_šŒa
)(
	mcbp
, 
	mdummy
, *
	mËn
,*
	mšfo
);

472 (*
	mcbp_lšfo_š‹r
)(
	mcbp
, 
	mdummy
, *
	mËn
,*
	mšfo
);

473 } 
	tMaüoblock
;

476 
	sb™_¡»am_’c


478 
	mbufãr_size
;

479 
	mby‹_pos
;

480 
	mb™s_to_go
;

482 
	m¡Üed_by‹_pos
;

483 
	m¡Üed_b™s_to_go
;

484 
	mby‹_pos_sk
;

485 
	mb™s_to_go_sk
;

486 
	mwr™e_æag
;

488 
by‹
 
	mby‹_buf
;

489 
by‹
 
	m¡Üed_by‹_buf
;

490 
by‹
 
	mby‹_buf_sk
;

491 
by‹
 *
	m¡»amBufãr
;

493 #ià
TRACE


494 
BoÞ—n
 
	mŒaû_’abËd
;

500 
	sd©­¬t™iÚ_’c


502 
¦iû
 *
	mp_Sliû
;

503 
video_·r
 *
	mp_Vid
;

504 
IÅutP¬am‘”s
 *
	mp_IÅ
;

505 
B™¡»am
 *
	mb™¡»am
;

506 
NALU_t
 *
	mÇl_un™
;

507 
EncodšgEnvœÚm’t
 
	m“_ÿbac
;

508 
EncodšgEnvœÚm’t
 
	m“_»code
;

509 } 
	tD©aP¬t™iÚ
;

513 
	srd_d©a


515 
	mmš_rdco¡
;

516 
	mmš_dco¡
;

517 
	mmš_¿‹
;

519 
img³l
 ***
	m»c_mb
;

520 ****
	mcofAC
;

521 ***
	mcofDC
;

522 *****
	mcofAC_Ãw
;

523 
	mmb_ty³
;

524 
št64
 
	mcbp_blk
;

525 
	mcbp
;

526 
	m´ev_cbp
;

527 
	mmode
;

528 
	mi16off£t
;

529 
	mi16mode
;

530 
BoÞ—n
 
	mNoMbP¬tLessThª8x8FÏg
;

532 
	mc_»d_mode
;

533 
	mqp
;

534 
	m´ev_qp
;

535 
	m´ev_dqp
;

536 
by‹
 
	mluma_ŒªsfÜm_size_8x8_æag
;

537 
Info8x8
 
	mblock
;

538 
Info8x8
 
	mb8x8
[4];

540 
MÙiÚVeùÜ
 *****
	m®l_mv
;

541 
MÙiÚVeùÜ
 ******
	mb»d_mv
;

543 
	mšŒa_´ed_modes
[16];

544 
	mšŒa_´ed_modes8x8
[16];

545 **
	m»dmode
;

546 ***
	m»çr
;

547 } 
	tRD_DATA
;

550 
	s¦iû


552 
video_·r
 *
	mp_Vid
;

553 
IÅutP¬am‘”s
 *
	mp_IÅ
;

554 
pic_·¿m‘”_£t_rb¥_t
 *
	maùive_µs
;

555 
£q_·¿m‘”_£t_rb¥_t
 *
	maùive_¥s
;

557 
decoded_piùu»_bufãr
 *
	mp_Dpb
;

559 
	mÏy”_id
;

560 
	mpiùu»_id
;

561 
	mqp
;

562 
	mqs
;

563 
	m¦iû_ty³
;

564 
	mäame_num
;

565 
	mmax_äame_num
;

566 sigÃd 
	mäam•oc
;

567 sigÃd 
	mThisPOC
;

568 
	m¦iû_Ä
;

569 
	mmod–_numb”
;

570 
	mcÞour_¶ªe_id
;

571 
	mlos¦ess_qµrime_æag
;

572 
	mP444_jošed
;

573 
	mdi¡h»s
;

574 
	mT¿nsfÜm8x8Mode
;

575 
	mrdoq_mÙiÚ_cÝy
;

578 
	mU£RDOQuªt
;

579 
	mRDOQ_QP_Num
;

581 
	mnum_»f_idx_aùive
[2];

582 
	m»f_pic_li¡_»Üd”šg_æag
[2];

583 *
	mmodifiÿtiÚ_of_pic_nums_idc
[2];

584 *
	mabs_diff_pic_num_mšus1
[2];

585 *
	mlÚg_‹rm_pic_idx
[2];

586 #ià(
MVC_EXTENSION_ENABLE
)

587 *
	mabs_diff_v›w_idx_mšus1
[2];

589 
	mv›w_id
;

590 
	mwidth_blk
;

591 
	mheight_blk
;

593 
Piùu»SŒuùu»
 
	m¡ruùu»
;

594 
BoÞ—n
 
	mmb_aff_äame_æag
;

596 
	m¡¬t_mb_Ä
;

597 
	mmax_·¹_Ä
;

598 
	mnum_mb
;

600 
	mcmp_cbp
[3];

601 
	mcu¼_cbp
[2];

602 
	msymbÞ_mode
;

603 
	mNoResidueDœeù
;

604 
	m·¹™iÚ_mode
;

605 
	midr_æag
;

606 
	mäame_no
;

607 
	mPicSizeInMbs
;

608 
	mnum_blk8x8_uv
;

609 
	mÇl_»ã»nû_idc
;

612 
	mb™d•th_luma
;

613 
	mb™d•th_chroma
;

614 
	mb™d•th_sÿË
[2];

615 
	mb™d•th_luma_qp_sÿË
;

616 
	mb™d•th_chroma_qp_sÿË
;

617 
	mb™d•th_Ïmbda_sÿË
;

619 
D©aP¬t™iÚ
 *
	m·¹A¼
;

620 
MÙiÚInfoCÚ‹xts
 *
	mmÙ_ùx
;

621 
Textu»InfoCÚ‹xts
 *
	m‹x_ùx
;

623 
	mmvsÿË
[6][
MAX_REFERENCE_PICTURES
];

624 
	mdœeù_¥©Ÿl_mv_´ed_æag
;

626 
	mDFDi§bËIdc
;

627 
	mDFAÍhaC0Off£t
;

628 
	mDFB‘aOff£t
;

630 
by‹
 
	mweigh‹d_´ediùiÚ
;

631 
by‹
 
	mweigh‹d_b»d_idc
;

633 
	mluma_log_weight_d’om
;

634 
	mchroma_log_weight_d’om
;

635 
	mwp_luma_round
;

636 
	mwp_chroma_round
;

638 
	mmax_num_»ã»nûs
;

641 
MÙiÚVeùÜ
 *****
	m®l_mv
;

642 
MÙiÚVeùÜ
 ******
	mb»d_mv
;

644 ***
	mwp_weight
;

645 ***
	mwp_off£t
;

646 ****
	mwbp_weight
;

648 *****
	mcofAC_Ãw
;

650 ****
	mcofAC
;

651 *** 
	mcofDC
;

654 
	mdiffy
[16][16];

656 
št64
 
	mcur_cbp_blk
[
MAX_PLANE
];

657 
	mcÛff_co¡_ü
[
MAX_PLANE
];

660 **
	mtblk16x16
;

661 **
	mtblk4x4
;

662 ****
	mi16blk4x4
;

664 
RD_DATA
 *
	mrdd©a
;

667 
RD_DATA
 
	mrdd©a_Œ–lis_be¡
;

668 
RD_DATA
 
	mrdd©a_Œ–lis_cu¼
;

670 
RD_DATA
 
	mrdd©a_tÝ_äame_mb
;

671 
RD_DATA
 
	mrdd©a_bÙ_äame_mb
;

672 
RD_DATA
 
	mrdd©a_tÝ_f›ld_mb
;

673 
RD_DATA
 
	mrdd©a_bÙ_f›ld_mb
;

675 
BoÞ—n
 
	msi_äame_šdiÿtÜ
;

676 
BoÞ—n
 
	m¥2_äame_šdiÿtÜ
;

678 ***
	mdœeù_»f_idx
;

679 **
	mdœeù_pdœ
;

681 
MÙiÚVeùÜ
 ****
	mtmp_mv8
;

682 
MÙiÚVeùÜ
 ****
	mtmp_mv4
;

684 
di¡blk
 ***
	mmÙiÚ_co¡8
;

685 
di¡blk
 ***
	mmÙiÚ_co¡4
;

686 
	md–QPTabË
[9];

689 
e¡_b™s_ÿbac
 *
	me¡B™sCabac
;

690 
	mnÜm_çùÜ_4x4
;

691 
	mnÜm_çùÜ_8x8
;

692 
	mnÜm_shiá_4x4
;

693 
	mnÜm_shiá_8x8
;

695 
img³l
 ****
	mm´_4x4
;

696 
img³l
 ****
	mm´_8x8
;

697 
img³l
 ****
	mm´_16x16
;

698 
img³l
 ***
	mmb_´ed
;

699 ***
	mmb_¼es
;

700 ***
	mmb_Ües
;

703 
	mb8_»dmode8x8
[4][4];

704 
	mb8_šŒa_´ed_modes8x8
[16];

705 
	mb4_»dmode
[16];

706 
	mb4_šŒa_´ed_modes
[16];

708 
rdo_¡ruùu»
 *
	mp_RDO
;

709 
•zs_·¿ms
 *
	mp_EPZS
;

712 
¡ÜabË_piùu»
 **
	mli¡X
[6];

713 
	mli¡Xsize
[6];

716 
	mcÛff
[64];

717 
	mcÛff_ùr
;

718 
	mpos
;

720 
	mdeçuÉ_pic_num
[2][
MAX_REFERENCE_PICTURES
];

721 
	mdeçuÉ_v›w_id
[2][
MAX_REFERENCE_PICTURES
];

724 (*
	mmode_decisiÚ_fÜ_I16x16_MB
è(
Maüoblock
 *
	mcu¼MB
, 
	mÏmbda
);

725 (*
	mmode_decisiÚ_fÜ_I4x4_blocks
è(
Maüoblock
 *
	mcu¼MB
, 
	mb8
, 
	mb4
, 
	mÏmbda
, 
di¡blk
* 
	mmš_co¡
);

726 (*
	mmode_decisiÚ_fÜ_I8x8_blocks
è(
Maüoblock
 *
	mcu¼MB
, 
	mb8
, 
	mÏmbda
, 
di¡blk
 *
	mmš_co¡
);

727 
di¡blk
 (*
rdco¡_fÜ_4x4_šŒa_blocks
è(
Maüoblock
 *
	mcu¼MB
, *
	mc_nz
, 
	mb8
, 
	mb4
, 
	mmode
, 
	mÏmbda
, 
	mmo¡ProbabËMode
, di¡blk 
	mmš_rdco¡
);

728 
di¡blk
 (*
rdco¡_fÜ_8x8_šŒa_blocks
è(
Maüoblock
 *
	mcu¼MB
, *
	mc_nz
, 
	mb8
, 
	mmode
, 
	mÏmbda
, di¡blk 
	mmš_rdco¡
, 
	mmo¡ProbabËMode
);

729 (*
	msubmaüoblock_mode_decisiÚ
è(
Maüoblock
 *
	mcu¼MB
, 
	mRD_PARAMS
 *, 
	mRD_8x8DATA
 *, ****, , 
	mdi¡blk
 *);

730 (*
	mšŒa_chroma_RD_decisiÚ
è(
Maüoblock
 *
	mcu¼MB
, 
	mRD_PARAMS
 *);

732 (*
	m£t_šŒ­»d_4x4
è(
Maüoblock
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
, 
	mimg_x
,
	mimg_y
, *
	mËá_avažabË
, *
	mup_avažabË
, *
	m®l_avažabË
);

733 (*
	m£t_šŒ­»d_8x8
è(
Maüoblock
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
, 
	mimg_x
,
	mimg_y
, *
	mËá_avažabË
, *
	mup_avažabË
, *
	m®l_avažabË
);

734 (*
	m£t_šŒ­»d_16x16
è(
Maüoblock
 *
	mcu¼MB
, 
CÞÜPÏÃ
 
	m¶
, *
	mËá_avažabË
, *
	mup_avažabË
, *
	m®l_avažabË
);

735 (*
	mšŒa_chroma_´ediùiÚ
è(
Maüoblock
 *
	mcu¼MB
, *, *, *);

736 (*
	mrdo_low_šŒa_chroma_decisiÚ
è(
Maüoblock
 *
	mcu¼MB
, 
	mmb_avažabË_up
, 
	mmb_avažabË_Ëá
[2], 
	mmb_avažabË_up_Ëá
);

738 (*
	mG‘_Dœeù_MÙiÚ_VeùÜs
è(
Maüoblock
 *
	mcu¼MB
);

739 
BoÞ—n
 (*
¦iû_too_big
è(
	mb™s_¦iû
);

740 (*
	m£t_mÙiÚ_veùÜs_mb
è(
Maüoblock
 *
	mcu¼MB
);

741 (*
	m’code_Úe_maüoblock
è(
Maüoblock
 *
	mcu¼MB
);

742 (*
	m£t_¡Üed_mb_·¿m‘”s
è(
Maüoblock
 *
	mcu¼MB
);

743 (*
	m£t_»f_ªd_mÙiÚ_veùÜs
è(
Maüoblock
 *
	mcu¼MB
, 
pic_mÙiÚ_·¿ms
 **
	mmÙiÚ
, 
Info8x8
 *
	m·¹
, 
	mblock
);

745 (*
	mluma_»sidu®_codšg
è(
Maüoblock
 *
	mcu¼MB
);

746 (*
	mluma_»sidu®_codšg_8x8
è(
Maüoblock
* 
	mcu¼MB
, *, 
	mšt64
*, , , [2], *);

747 (*
	mchroma_»sidu®_codšg
è(
Maüoblock
 *
	mcu¼MB
);

749 
di¡blk
 (*
compu‹_co¡8x8
è(
video_·r
 *
	mp_Vid
, 
img³l
 **
	mcur_img
, img³È**
	m´d_img
, 
	mpic_Ýix_x
, di¡blk 
	mmš_co¡
);

750 
di¡blk
 (*
compu‹_co¡4x4
è(
video_·r
 *
	mp_Vid
, 
img³l
 **
	mcur_img
, img³È**
	m´d_img
, 
	mpic_Ýix_x
, di¡blk 
	mmš_co¡
);

751 
di¡blk
 (*
fšd_§d_16x16
è(
Maüoblock
 *
	mcu¼MB
);

752 
di¡blk
 (*
di¡I16x16
è(
Maüoblock
 *
	mcu¼MB
, 
img³l
 **
	mimg_Üg
, img³È**
	m´ed_img
, di¡blk 
	mmš_co¡
);

754 (*
	m£t_Ïg¿ngŸn_muÉl›rs
è(
¦iû
 *
	mcu¼Sliû
);

756 (*
	m£t_modes_ªd_»fs_fÜ_blocks
è(
Maüoblock
 *
	mcu¼MB
, 
	mmode
);

757 (*
	m£t_cÛff_ªd_»cÚ_8x8
 ) (
Maüoblock
 *
	mcu¼MB
);

759 (*
	mwr™eMB_ty³Info
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

760 (*
	mwr™eMB_Sk
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

761 (*
	mwr™eIÁ¿P»dMode
è(
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

762 (*
	mwr™eB8_ty³Info
è(
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

763 (*
	mwr™eRefF¿me
[6]è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

764 (*
	mwr™eMÙiÚInfo2NAL
è(
Maüoblock
* 
	mcu¼MB
);

765 (*
	mwr™e_MB_Ïy”
è(
Maüoblock
 *
	mcu¼MB
, 
	mrdÝt
, *
	mcÛff_¿‹
);

766 (*
	mwr™eMVD
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

767 (*
	mwr™eCBP
è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

768 (*
	mwr™eDquªt
è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

769 (*
	mwr™eCIP»dMode
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

770 (*
	mwr™eF›ldModeInfo
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

771 (*
	mwr™eMB_ŒªsfÜm_size
)(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

772 (*
	mwr™eCÛff16x16
è(
Maüoblock
* 
	mcu¼MB
, 
	mCÞÜPÏÃ
);

773 (*
	mwr™eCÛff4x4_CAVLC
è(
Maüoblock
* 
	mcu¼MB
, 
	mblock_ty³
, 
	mb8
, 
	mb4
, 
	m·¿m
);

774 (*
	mwr™e_ªd_¡Üe_CBP_block_b™
è(
Maüoblock
* 
	mcu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
	m“p_dp
, 
	mty³
, 
	mcbp_b™
, 
Textu»InfoCÚ‹xts
* 
	m‹x_ùx
);

777 (*
	m»£t_codšg_¡©e
è(
Maüoblock
 *
	mcu¼MB
, 
	mcodšg_¡©e
 *);

778 (*
	m¡Üe_codšg_¡©e
è(
Maüoblock
 *
	mcu¼MB
, 
	mcodšg_¡©e
 *);

781 (*
	mš™_li¡s
 ) (
¦iû
 *
	mcu¼Sliû
);

782 (*
	m»Üd”_li¡s
 ) (
¦iû
 *
	mcu¼Sliû
);

783 (*
	mpoc_»f_pic_»Üd”_äame
è(
¦iû
 *
	mcu¼Sliû
, 
	mnum_»f_idx_lX_aùive
, 
	mli¡_no
 );

787 (*
	mquªt_4x4
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
);

788 (*
	mquªt_ac4x4ü
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
);

789 (*
	mquªt_dc4x4
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
	mqp
, * 
	mDCLev–
, * 
	mDCRun
, 
Lev–QuªtP¬ams
 *
	mq_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

790 (*
	mquªt_ac4x4
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
);

791 (*
	mquªt_8x8
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
);

792 (*
	mquªt_8x8ÿvlc
)(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
, *** 
	mcofAC
);

794 (*
	mquªt_dc_ü
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
	mqp
, * 
	mDCLev–
, * 
	mDCRun
,

795 
Lev–QuªtP¬ams
 *
	mq_·¿ms_4x4
, **
	mçdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

796 (*
	mrdoq_4x4
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
quªt_m‘hods
 *
	mq_m‘hod
, 
	mËv–T»Îis
[16]);

798 (*
	mrdoq_dc
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
	mqp_³r
, 
	mqp_»m
, 
Lev–QuªtP¬ams
 *
	mq_·¿ms_4x4
,

799 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
	mËv–T»Îis
[16], 
	mty³
);

801 (*
	mrdoq_ac4x4
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
 , 
quªt_m‘hods
 *
	mq_m‘hod
, 
	mËv–T»Îis
[16]);

803 (*
	mrdoq_dc_ü
è(
Maüoblock
 *
	mcu¼MB
, **
	mtblock
, 
	mqp_³r
, 
	mqp_»m
, 
Lev–QuªtP¬ams
 *
	mq_·¿ms_4x4
,

804 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
	mËv–T»Îis
[16], 
	mty³
);

806 (*
	m£t_modes_ªd_»äame
è(
Maüoblock
 *
	mcu¼MB
, 
	mb8
, * 
	mp_dœ
, 
	mli¡_mode
[2], *
	mli¡_»f_idx
);

807 (*
	m¡Üe_8x8_mÙiÚ_veùÜs
è(
¦iû
 *
	mcu¼Sliû
, 
	mdœ
, 
	mblock8x8
, 
Info8x8
 *
	mB8x8Info
);

808 
di¡blk
 (*
g‘Di¡ÜtiÚ
èÐ
Maüoblock
 *
	mcu¼MB
 );

810 } 
	tSliû
;

812 #ià(
MVC_EXTENSION_ENABLE
)

813 
	s´ev_codšg_¡©s


815 
	mäm_no_š_fže
;

816 
	mpic_ty³
[256];

817 
	mv›w_id
;

818 
	mcur_b™s
;

819 
	mwp_m‘hod
;

820 
	mAv”ageF¿meQP
;

821 
	mÏmbda
;

822 
	mp¢r_v®ue
[3];

823 
	mssim_v®ue
[3];

824 
	mtmp_time
;

825 
	mme_time
;

826 
	mæd_æag
;

827 
	mšŒas
;

828 
	mdœeù_mode
;

829 
	mnum_»f_idx_l0_aùive
;

830 
	mnum_»f_idx_l1_aùive
;

831 
	mrd_·ss
;

832 
	mÇl_»ã»nû_idc
;

834 } 
	tP»vCodšgSts
;

838 
	sdi¡ÜtiÚ_m‘ric


840 
	mv®ue
[3];

841 
	mav”age
[3];

842 
	mav¦iû
[
NUM_SLICE_TYPES
][3];

843 } 
	tDi¡M‘ric
;

845 
	sdi¡ÜtiÚ_·¿ms


847 
	mäame_ùr
;

848 
Di¡M‘ric
 
	mm‘ric
[
TOTAL_DIST_TYPES
];

849 #ià(
MVC_EXTENSION_ENABLE
)

850 
	mäame_ùr_v
[2];

851 
Di¡M‘ric
 
	mm‘ric_v
[2][
TOTAL_DIST_TYPES
];

853 } 
	tDi¡ÜtiÚP¬ams
;

855 
	spiùu»


857 
	mno_¦iûs
;

858 
	mb™s_³r_piùu»
;

859 
¦iû
 *
	m¦iûs
[
MAXSLICEPERPICTURE
];

861 
Di¡M‘ric
 
	mdi¡ÜtiÚ
;

862 
by‹
 
	midr_æag
;

863 } 
	tPiùu»
;

866 
	sblock_8x8_šfo


868 
Info8x8
 
	mbe¡
[
MAXMODE
][4];

869 } 
	tBlock8x8Info
;

871 
	scodšg_·r


873 
	mÏy”_id
;

874 
CÞÜFÜm©
 
	myuv_fÜm©
;

875 
	mP444_jošed
;

877 
	mb™d•th_luma
;

878 
	mb™d•th_chroma
;

879 
	mb™d•th_sÿË
[2];

880 
	mb™d•th_luma_qp_sÿË
;

881 
	mb™d•th_chroma_qp_sÿË
;

882 
	mb™d•th_Ïmbda_sÿË
;

884 
ušt32
 
	mdc_´ed_v®ue_comp
[
MAX_PLANE
];

885 
	mmax_³l_v®ue_comp
 [
MAX_PLANE
];

886 
	mmax_img³l_v®ue_comp_sq
 [
MAX_PLANE
];

888 
	mnum_blk8x8_uv
;

889 
	mnum_cdc_cÛff
;

891 
	mmb_ü_size_x
;

892 
	mmb_ü_size_y
;

893 
	mmb_size
[
MAX_PLANE
][2];

895 
	mmax_b™CouÁ
;

896 
	mwidth
;

897 
	mwidth_·dded
;

898 
	mwidth_blk
;

899 
	mwidth_ü
;

900 
	mheight
;

901 
	mheight_·dded
;

902 
	mheight_blk
;

903 
	mheight_ü
;

904 
	mheight_ü_äame
;

905 
	msize
;

906 
	msize_ü
;

908 
	m·dded_size_x
;

909 
	m·dded_size_x_m8x8
;

910 
	m·dded_size_x_m4x4
;

911 
	mü_·dded_size_x
;

912 
	mü_·dded_size_x_m8
;

913 
	mü_·dded_size_x2
;

914 
	mü_·dded_size_x4
;

916 
	m·d_size_uv_x
;

917 
	m·d_size_uv_y
;

918 
	mchroma_mask_mv_y
;

919 
	mchroma_mask_mv_x
;

920 
	mchroma_shiá_x
;

921 
	mchroma_shiá_y
;

922 
	mshiá_ü_x
;

923 
	mshiá_ü_y
;

925 
	mPicWidthInMbs
;

926 
	mPicHeightInM­Un™s
;

927 
	mF¿meHeightInMbs
;

928 
	mF¿meSizeInMbs
;

930 
	mäame_num
;

931 
	m´evF¿meNum
;

932 
	mF¿meNumOff£t
;

933 
	m´evF¿meNumOff£t
;

934 
	mÏ¡_»f_idc
;

938 
	mmd5SŒšg
[2][33];

939 }
	tCodšgP¬am‘”s
;

942 
	svideo_·r


944 
IÅutP¬am‘”s
 *
	mp_IÅ
;

945 
pic_·¿m‘”_£t_rb¥_t
 *
	maùive_µs
;

946 
£q_·¿m‘”_£t_rb¥_t
 *
	maùive_¥s
;

947 
£i_·¿ms
 *
	mp_SEI
;

948 
decod”s
 *
	mp_decs
;

949 
CodšgP¬am‘”s
 *
	mp_Cu¼EncodeP¬
;

950 
CodšgP¬am‘”s
 *
	mp_EncodeP¬
[
MAX_NUM_DPB_LAYERS
];

952 
	mnumb”
;

953 
	mLev–Index
;

954 
	mMaxVmvR
[6];

955 
	mMaxHmvR
[6];

956 
	mcu¼’t_mb_Ä
;

957 
	mcu¼’t_¦iû_Ä
;

958 
	mty³
;

959 
Piùu»SŒuùu»
 
	m¡ruùu»
;

960 
	mba£_di¡
;

961 
	mnum_»f_äames
;

962 
	mmax_num_»ã»nûs
;

963 
	mma¡”QP
;

964 
	mqp
;

965 
	mqp¥
;

967 
	m´ev_äame_no
;

968 
	mcÚ£cutive_nÚ_»ã»nû_piùu»s
;

971 
	mäm_¡ruù_bufãr
;

972 
	mÏ¡_idr_code_Üd”
;

973 
	mÏ¡_idr_di¥_Üd”
;

974 
	mÏ¡_mmco_5_code_Üd”
;

975 
	mÏ¡_mmco_5_di¥_Üd”
;

976 
	mcu¼_äm_idx
;

977 
	mF¿meNumOff£t
;

978 
	m´evF¿meNumOff£t
;

979 
	m´evF¿meNum
;

980 
SeqSŒuùu»
 *
	mp_´ed
;

981 
F¿meUn™SŒuù
 *
	mp_cu¼_äm_¡ruù
;

982 
PicSŒuùu»
 *
	mp_cu¼_pic
;

983 
SliûSŒuùu»
 *
	mp_cu¼_¦iû
;

984 
	mpic_¡ruù
;

985 
£¬ch_wšdow
 
	m£¬chRªge
;

988 
hme_šfo
 *
	mpHMEInfo
;

989 
	mis_hme
;

991 
ImageD©a
 
	mimgD©a
;

992 
ImageD©a
 
	mimgD©a0
;

993 
ImageD©a
 
	mimgD©a1
;

994 
ImageD©a
 
	mimgD©a2
;

995 
ImageD©a
 
	mimgD©a3
;

997 
ImageD©a
 
	mimgD©a32
;

998 
ImageD©a
 
	mimgD©a4
;

999 
ImageD©a
 
	mimgD©a5
;

1000 
ImageD©a
 
	mimgD©a6
;

1001 
ImageD©a
 
	mimgRefD©a
;

1002 
ImageD©a
 
	mÜigD©a0
;

1003 
ImageD©a
 
	mÜigD©a1
;

1005 
ImageD©a
 
	mimgD©aO±1
;

1006 
ImageD©a
 
	mimgD©aO±2
;

1009 
	mnum_¦iûs_wp
;

1010 
	mwp_·¿m‘”s_£t
;

1011 ****
	mwp_weights
;

1012 ****
	mwp_off£ts
;

1013 *****
	mwbp_weight
;

1015 
image_¡ruùu»
 
	mimgSRC
;

1016 
image_¡ruùu»
 
	mimgREF
;

1017 
image_¡ruùu»
 
	mimgREF0
;

1018 
image_¡ruùu»
 
	mimgREF1
;

1019 
image_¡ruùu»
 
	mimgRGB_¤c
;

1020 
image_¡ruùu»
 
	mimgRGB_»f
;

1021 **
	mimgY_sub_tmp
;

1022 
img³l
 **
	mimgY_com
;

1023 
img³l
 **
	mimgUV_com
[2];

1025 
img³l
 **
	mimgY_com_buf
[2];

1026 
img³l
 **
	mimgUV_com_buf
[2][2];

1028 
img³l
 **
	mpCurImg
;

1030 
img³l
 **
	mpImgOrg
[
MAX_PLANE
];

1032 
img³l
 **
	mpCurImgRef
;

1033 
img³l
 **
	mpImgOrgRef
[
MAX_PLANE
];

1035 
Piùu»
 *
	mp_äame_pic
;

1036 
Piùu»
 **
	mäame_pic
;

1037 #ià(
MVC_EXTENSION_ENABLE
)

1038 
Piùu»
 **
	mf›ld_pic_±r
;

1039 
Piùu»
 **
	mf›ld_pic1
;

1040 
Piùu»
 **
	mf›ld_pic2
;

1042 
Piùu»
 **
	mf›ld_pic
;

1045 
Piùu»
 *
	mäame_pic_si
;

1047 
by‹
 *
	mM­Un™ToSliûGroupM­
;

1049 
by‹
 *
	mbuf
;

1050 
by‹
 *
	mibuf
;

1052 #ifdeà
_LEAKYBUCKET_


1053 *
	mB™_Bufãr
;

1054 
	mtÙ®_äame_bufãr
;

1057 
	mlog2_max_äame_num_mšus4
;

1058 
	mlog2_max_pic_Üd”_út_lsb_mšus4
;

1059 
	mmax_äame_num
;

1060 
	mmax_pic_Üd”_út_lsb
;

1062 
št64
 
	mme_tÙ_time
;

1063 
št64
 
	mtÙ_time
;

1064 
št64
 
	mme_time
;

1066 
by‹
 
	mmixedModeEdgeFÏg
;

1068 *
	mReäeshP©‹º
;

1069 *
	mIÁ¿MBs
;

1070 
	mW®kAround
;

1071 
	mNumb”OfMBs
;

1072 
	mNumb”IÁ¿P”Piùu»
;

1074 
	m¡¬t_me_»fšem’t_hp
;

1075 
	m¡¬t_me_»fšem’t_qp
;

1078 
umhex_¡ruù
 *
	mp_UMHex
;

1079 
umhex_smp_¡ruù
 *
	mp_UMHexSMP
;

1080 
me_fuÎ_ç¡
 *
	mp_fç¡_me
;

1082 
£¬ch_wšdow
 *
	mp_£¬ch_wšdow
;

1085 
•zs_¡ruù
 *
	msdŸmÚd
;

1086 
•zs_¡ruù
 *
	msqu¬e
;

1087 
•zs_¡ruù
 *
	medŸmÚd
;

1088 
•zs_¡ruù
 *
	mldŸmÚd
;

1089 
•zs_¡ruù
 *
	msbdŸmÚd
;

1090 
•zs_¡ruù
 *
	mpmvç¡
;

1091 
•zs_¡ruù
 *
	m£¬ch_½u_squ¬e
;

1092 
•zs_¡ruù
 *
	mSP_M2DRPU
;

1093 
•zs_¡ruù
 *
	mSP_M2DRPU4MM
;

1096 
	m´eÿlcUÇryLev–Tab
[128][
MAX_PREC_COEFF
];

1097 
	mAd­tRndWeight
;

1098 
	mAd­tRndCrWeight
;

1104 
by‹
 
	mMBPaœIsF›ld
;

1107 
by‹
 **
	mpix–_m­
;

1108 
by‹
 **
	m»äesh_m­
;

1109 
	mšŒas
;

1110 
	miIÁ”V›wMBs
;

1111 
	mRCMšQP
;

1112 
	mRCMaxQP
;

1114 
	mäam”©e
;

1116 
	mis_v_block
;

1117 
	mmb_y_upd
;

1118 
	mmb_y_šŒa
;

1119 **
	m»dmode
;

1120 **
	m»dmode8x8
;

1122 **
	m»dmode4x4_lše
;

1123 **
	m»dmode8x8_lše
;

1125 
	mcod_couÁ”
;

1126 ***
	mnz_cÛff
;

1127 ***
	mnz_cÛff_buf
[2];

1128 
	mpix_x
;

1129 
	mpix_y
;

1132 
img³l
 
	mmš_IPCM_v®ue
;

1134 
	mpic_bš_couÁ
;

1137 ****
	mARCofAdj4x4
;

1138 ****
	mARCofAdj8x8
;

1140 
ImageD©a
 
	m‹mpD©a1
, 
	m‹mpD©a2
, 
	m‹mpD©a3
, 
	m‹mpD©a4
;

1141 
img³l
 **
	m‹mpImg
;

1143 
Piùu»
 *
	mcu¼’tPiùu»
;

1144 
¦iû
 *
	mcu¼’tSliû
;

1145 
Maüoblock
 *
	mmb_d©a
;

1146 
Block8x8Info
 *
	mb8x8šfo
;

1149 
	mmb_»åic_u£d
;

1150 
	m·»Á_·¹_»åic_u£d
;

1151 
	msubmb_·»Á_·¹_»åic_u£d
;

1153 *
	mšŒa_block
;

1155 
	mäame_no
;

1156 
	mæd_ty³
;

1157 
by‹
 
	mæd_æag
;

1158 
	mrd_·ss
;

1160 
	m»dundªt_codšg
;

1161 
	mkey_äame
;

1162 
	m»dundªt_»f_idx
;

1163 
	mäm_no_š_fže
;

1165 
	mDFDi§bËIdc
;

1166 
	mDFAÍhaC0Off£t
;

1167 
	mDFB‘aOff£t
;

1169 
	mdœeù_¥©Ÿl_mv_´ed_æag
;

1171 
	mshiá_ü_x2
;

1173 
	mnum_»f_idx_l0_aùive
;

1174 
	mnum_»f_idx_l1_aùive
;

1176 
BoÞ—n
 
	mf›ld_mode
;

1177 
BoÞ—n
 
	mtÝ_f›ld
;

1179 
	mÏy”
;

1181 
	mAd­tiveRoundšg
;

1183 
	m»dundªt_pic_út
;

1185 
BoÞ—n
 
	mmb_aff_äame_æag
;

1188 
	mpic_Üd”_út_ty³
;

1191 
BoÞ—n
 
	md–_pic_Üd”_®ways_z”o_æag
;

1192 
	moff£t_fÜ_nÚ_»f_pic
;

1193 
	moff£t_fÜ_tÝ_to_bÙtom_f›ld
;

1194 
	mnum_»f_äames_š_pic_Üd”_út_cyþe
;

1195 
	moff£t_fÜ_»f_äame
[1];

1199 
	mpic_Üd”_út_lsb
;

1200 
	md–_pic_Üd”_út_bÙtom
;

1202 
	md–_pic_Üd”_út
[2];

1204 
	mäm_™”
;

1206 
	mf›ld_piùu»
;

1207 sigÃd 
	mtÝpoc
;

1208 sigÃd 
	mbÙtompoc
;

1209 sigÃd 
	mäam•oc
;

1210 sigÃd 
	mThisPOC
;

1211 
	mäame_num
;

1213 
	mPicSizeInMbs
;

1216 
BoÞ—n
 
	mbÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
;

1220 
	mÇl_»ã»nû_idc
;

1222 
	mad­tive_»f_pic_bufãršg_æag
;

1223 
	mno_ouut_of_´iÜ_pics_æag
;

1224 
BoÞ—n
 
	mlÚg_‹rm_»ã»nû_æag
;

1226 
DecRefPicM¬kšg_t
 *
	mdec_»f_pic_m¬kšg_bufãr
;

1227 * 
	mmvb™s
;

1229 
	mmax_mvd
;

1230 * 
	m»fb™s
;

1233 
	mNumb”ofCodedMaüoBlocks
;

1234 
	mBasicUn™QP
;

1235 
	mNumb”ofMBTextu»B™s
;

1236 
	mNumb”ofMBH—d”B™s
;

1237 
	mBasicUn™
;

1238 
by‹
 
	mwr™e_maüoblock
;

1239 
by‹
 
	mbÙ_MB
;

1240 
	mwr™e_mbaff_äame
;

1242 
	mÏ¡_pic_bÙtom_f›ld
;

1243 
	mÏ¡_has_mmco_5
;

1244 
	m´e_äame_num
;

1246 
	m¦iû_group_chªge_cyþe
;

1248 
	mmax_qp_d–
;

1249 
	mmš_qp_d–
;

1252 
LambdaP¬ams
 **
	mÏmbda
;

1253 **
	mÏmbda_md
;

1254 ***
	mÏmbda_me
;

1255 ***
	mÏmbda_mf
;

1256 **
	mÏmbda_rdoq
;

1257 **
	mÏmbda_mf_çùÜ
;

1259 
LambdaP¬ams
 **
	mÏmbda_buf
[2];

1260 **
	mÏmbda_md_buf
[2];

1261 ***
	mÏmbda_me_buf
[2];

1262 ***
	mÏmbda_mf_buf
[2];

1263 **
	mÏmbda_rdoq_buf
[2];

1264 **
	mÏmbda_mf_çùÜ_buf
[2];

1266 
ušt32
 
	mdc_´ed_v®ue
;

1267 
	mmax_img³l_v®ue
;

1269 
edge_šfo
 *
	mp_edge
;

1271 
	mchroma_qp_off£t
[2];

1273 
	mauto_üÝ_right
;

1274 
	mauto_üÝ_bÙtom
;

1276 
	mcheck»f
;

1277 
	mÏ¡_v®id_»ã»nû
;

1278 
	mby‹s_š_piùu»
;

1280 
št64
 
	mÏ¡_b™_ùr_n
;

1282 
	mAv”ageF¿meQP
;

1283 
	mSumF¿meQP
;

1285 
	mChromaA¼ayTy³
;

1286 
Maüoblock
 *
	mmb_d©a_JV
[
MAX_PLANE
];

1287 
	mcÞour_¶ªe_id
;

1289 
	mÏ¡IÁ¿Numb”
;

1290 
	mÏ¡INTRA
;

1291 
	mÏ¡_»f_idc
;

1292 
	midr_»äesh
;

1294 
	mp_dec
;

1295 #ià(
MVC_EXTENSION_ENABLE
)

1296 
	mp_dec2
;

1298 
	mäame_¡©i¡ic_¡¬t
;

1299 
	mš™Ÿl_Bäames
;

1300 
	mÿbac_’codšg
;

1302 
	m´im¬y_pic_ty³
;

1304 
	mäameOff£tTÙ®
[2][
MAX_REFERENCE_PICTURES
];

1305 
	mäameOff£tCouÁ
[2][
MAX_REFERENCE_PICTURES
];

1306 
	mäameOff£t
[2][
MAX_REFERENCE_PICTURES
];

1307 
	mäameOff£tAvaž
;

1308 
	mv›w_id
;

1309 #ià(
MVC_EXTENSION_ENABLE
)

1310 
	m£c_v›w_fÜû_æd
;

1311 
	m´ev_v›w_is_ªchÜ
;

1313 
	m‹mp0_Çl_»ã»nû_idc
;

1314 
	m‹mp0_nÚ_idr_æag
[2];

1315 
	m‹mp0_´iÜ™y_id
;

1316 
	m‹mp0_v›w_id
;

1317 
	m‹mp0_‹mpÜ®_id
;

1318 
	m‹mp0_ªchÜ_pic_æag
[2];

1319 
	m‹mp0_š‹r_v›w_æag
[2];

1321 
	mnÚ_idr_æag
[2];

1322 
	m´iÜ™y_id
;

1323 
	m‹mpÜ®_id
;

1324 
	mªchÜ_pic_æag
[2];

1325 
	mš‹r_v›w_æag
[2];

1327 
P»vCodšgSts
 
	m´ev_cs
;

1328 
	mMVCIÁ”V›wReÜd”
;

1329 
¡ÜabË_piùu»
 *
	m´oc_piùu»
;

1332 *
	mmb16x16_co¡_äame
;

1333 
	mmb16x16_co¡
;

1335 **
	mÌec
;

1336 ***
	mÌec_uv
;

1337 
BoÞ—n
 
	m¥2_äame_šdiÿtÜ
;

1338 
	mnumb”_¥2_äames
;

1340 
BoÞ—n
 
	mgiRDO±_B8OÆyFÏg
;

1342 
	mäameNumšGOP
;

1344 
img³l
 **
	mimgY_tmp
;

1345 
img³l
 **
	mimgUV_tmp
[2];

1346 
img³l
 **
	mimgY_tmp_buf
[2];

1347 
img³l
 **
	mimgUV_tmp_buf
[2][2];

1352 
	mCbCr_´edmode_8x8
[4];

1353 
di¡blk
 ****
	mmÙiÚ_co¡
;

1354 *** 
	mš™Ÿlized
;

1355 *** 
	mmod–Numb”
;

1356 
	mb»d_’abËd
[
MAXMODE
];

1359 
	mnum_mb_³r_¦iû
;

1360 
	mnumb”_of_¦iûs
;

1362 
	mimg³l_abs_¿nge
;

1363 #ià(
JM_MEM_DISTORTION
)

1364 * 
	mimg³l_abs
;

1365 * 
	mimg³l_quad
;

1368 
GOP_DATA
 *
	mgÝ_¡ruùu»
;

1369 
by‹
 *
	mMBAm­
;

1370 
	mPicSizeInM­Un™s
;

1371 
	mFœ¡MBInSliû
[
MAXSLICEGROUPIDS
];

1373 
MÙiÚVeùÜ
* 
	m¥œ®_£¬ch
;

1374 
MÙiÚVeùÜ
* 
	m¥œ®_h³l_£¬ch
;

1375 
MÙiÚVeùÜ
* 
	m¥œ®_q³l_£¬ch
;

1378 
FILE
 *
	mp_log
;

1381 
FILE
 **
	mf_out
;

1383 
FILE
 *
	mf_ªÃxb
;

1385 
FILE
 *
	mf_¹p
;

1386 
	mCu¼’tRTPTime¡amp
;

1388 
ušt16
 
	mCu¼’tRTPSequ’ûNumb”
;

1395 
Di¡ÜtiÚP¬ams
 *
	mp_Di¡
;

1396 
¡©_·¿m‘”s
 *
	mp_Sts
;

1397 
pic_·¿m‘”_£t_rb¥_t
 *
	mPicP¬S‘
[
MAXPPS
];

1399 
decoded_piùu»_bufãr
 *
	mp_Dpb_Ïy”
[
MAX_NUM_DPB_LAYERS
];

1400 
äame_¡Üe
 *
	mout_bufãr
;

1401 
¡ÜabË_piùu»
 *
	m’c_piùu»
;

1402 
¡ÜabË_piùu»
 **
	m’c_äame_piùu»
;

1403 
¡ÜabË_piùu»
 **
	m’c_f›ld_piùu»
;

1404 
¡ÜabË_piùu»
 *
	m’c_äame_piùu»_JV
[
MAX_PLANE
];

1405 
quªt_·¿ms
 *
	mp_Quªt
;

1406 
sÿlšg_li¡
 *
	mp_QSÿË
;

1409 
RCG’”ic
 *
	mp_rc_g’
;

1410 
RCG’”ic
 *
	mp_rc_g’_š™
, *
	mp_rc_g’_be¡
;

1411 
RCQuad¿tic
 *
	mp_rc_quad
;

1412 
RCQuad¿tic
 *
	mp_rc_quad_š™
, *
	mp_rc_quad_be¡
;

1414 
	m’ŒÝy
[128];

1415 
	m’Üm
 [128];

1416 
	m´obabž™y
[128];

1419 
FILE
 *
	mexpSFže
;

1420 
exp_£q_šfo
 *
	mexpSeq
;

1422 
wpx_objeù
 *
	mpWPX
;

1425 ***
	mwavREF
[
NUM_WAVELET_LEVEL
+1];

1426 ***
	mwavSRC
[
NUM_WAVELET_LEVEL
+1];

1427 
	mJND
[
NUM_WAVELET_LEVEL
][4];

1428 *
	m‹mp_low
, *
	m‹mp_high
;

1430 #ifdeà
BEST_NZ_COEFF


1431 
	mg¯iMBAFF_NZCÛff
[4][12];

1435 
	moff£t_y
, 
	moff£t_ü
;

1436 
	mwka0
, 
	mwka1
, 
	mwka2
, 
	mwka3
, 
	mwka4
;

1437 
	mEv®u©eDBOff
;

1438 
	mTuºDBOff
;

1442 (*
	mupd©eQP
è(
video_·r
 *
	mp_Vid
, 
IÅutP¬am‘”s
 *
	mp_IÅ
, 
RCQuad¿tic
 *
	mp_quad
, 
RCG’”ic
 *
	mp_g’
, 
	mtÝf›ld
);

1443 (*
	mrc_upd©e_più_äame_±r
)(
video_·r
 *
	mp_Vid
, 
IÅutP¬am‘”s
 *
	mp_IÅ
, 
RCQuad¿tic
 *
	mp_quad
, 
RCG’”ic
 *
	mp_g’
, 
	mnb™s
);

1444 (*
	mrc_upd©e_piùu»_±r
è(
video_·r
 *
	mp_Vid
, 
IÅutP¬am‘”s
 *
	mp_IÅ
, 
	mb™s
);

1445 (*
	mrc_š™_più_±r
è(
video_·r
 *
	mp_Vid
, 
IÅutP¬am‘”s
 *
	mp_IÅ
, 
RCQuad¿tic
 *
	mp_quad
, 
RCG’”ic
 *
	mp_g’
, 
	mf›ldpic
, 
	mtÝf›ld
, 
	mrg‘computiÚ
, 
	mmuÉ
);

1448 (*
	mbuf2img
è(
img³l
** 
	mimgX
, * 
	mbuf
, 
	msize_x
, 
	msize_y
, 
	mo_size_x
, 
	mo_size_y
, 
	msymbÞ_size_š_by‹s
, 
	mb™shiá
);

1449 (*
	mg‘Neighbour
è(
Maüoblock
 *
	mcu¼MB
, 
	mxN
, 
	myN
, 
	mmb_size
[2], 
Pix–Pos
 *
	mpix
);

1450 (*
	mg‘_mb_block_pos
è(
BlockPos
 *
	mPicPos
, 
	mmb_addr
, *
	mx
, *
	my
);

1451 (*
	mWr™eNALU
è(
video_·r
 *
	mp_Vid
, 
NALU_t
 *
	mn
, 
FILE
 **
	mf_out
);

1452 (*
	m”rÜ_cÚû®_piùu»
)(
video_·r
 *
	mp_Vid
, 
¡ÜabË_piùu»
 *
	m’c_pic
, 
	mdecod”
);

1453 
di¡blk
 (*
e¡im©e_di¡ÜtiÚ
)(
Maüoblock
 *
	mcu¼MB
, 
	mblock
, 
	mblock_size
, 
	mmode
, 
	mpdœ
, di¡blk 
	mmš_rdco¡
);

1455 (*
	mOÃCompÚ’tChromaP»diùiÚ4x4
è(
Maüoblock
 *
	mcu¼MB
, 
	mimg³l
* , , , 
	mMÙiÚVeùÜ
 ** , 
¡ÜabË_piùu»
 *
	mli¡X
, );

1458 (*
	mG‘SŒ’gthV”
è(
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
, 
	mmvlim™
);

1459 (*
	mG‘SŒ’gthHÜ
è(
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
, 
	mmvlim™
);

1460 (*
	mEdgeLoÝLumaHÜ
è(
CÞÜPÏÃ
 
	m¶
, 
img³l
** 
	mImg
, 
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
, 
	mwidth
);

1461 (*
	mEdgeLoÝLumaV”
è(
CÞÜPÏÃ
 
	m¶
, 
img³l
** 
	mImg
, 
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
);

1462 (*
	mEdgeLoÝChromaV”
)(
img³l
** 
	mImg
, 
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
, 
	muv
);

1463 (*
	mEdgeLoÝChromaHÜ
)(
img³l
** 
	mImg
, 
by‹
 
	mSŒ’gth
[16], 
Maüoblock
 *
	mMbQ
, 
	medge
, 
	mwidth
, 
	muv
);

1466 (*
	mE¡im©eWPBSliû
è(
¦iû
 *
	mcu¼Sliû
);

1467 (*
	mE¡im©eWPPSliû
è(
¦iû
 *
	mcu¼Sliû
, 
	moff£t
);

1468 (*
	mTe¡WPPSliû
è(
¦iû
 *
	mcu¼Sliû
, 
	moff£t
);

1469 (*
	mTe¡WPBSliû
è(
¦iû
 *
	mcu¼Sliû
, 
	mm‘hod
);

1470 
di¡blk
 (*
di¡ÜtiÚ4x4
)(*, 
	mdi¡blk
);

1471 
di¡blk
 (*
di¡ÜtiÚ8x8
)(*, 
	mdi¡blk
);

1474 
di¡blk
 (*
compu‹UniP»d
[6]è(
¡ÜabË_piùu»
 *
	m»f1
, 
	mme_block
 *, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 * );

1475 
di¡blk
 (*
compu‹BiP»d1
[3]è(
¡ÜabË_piùu»
 *
	m»f1
, ¡ÜabË_piùu» *
	m»f2
, 
	mme_block
*, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 *, MotionVector *);

1476 
di¡blk
 (*
compu‹BiP»d2
[3]è(
¡ÜabË_piùu»
 *
	m»f1
, ¡ÜabË_piùu» *
	m»f2
, 
	mme_block
*, 
	mdi¡blk
 , 
	mMÙiÚVeùÜ
 *, MotionVector *);

1478 
£q_·¿m‘”_£t_rb¥_t
 *
	m¥s
[
MAX_NUM_DPB_LAYERS
];

1479 
F¿meFÜm©
 
	mouut_fÜm©
[
MAX_NUM_DPB_LAYERS
];

1480 
	mnum_of_Ïy”s
;

1481 
	mdpb_Ïy”_id
;

1483 
BlockPos
 *
	mPicPos
;

1486 
CÞÜFÜm©
 
	myuv_fÜm©
;

1487 
	mP444_jošed
;

1488 
	mb™d•th_luma
;

1489 
	mb™d•th_chroma
;

1490 
	mb™d•th_sÿË
[2];

1491 
	mb™d•th_luma_qp_sÿË
;

1492 
	mb™d•th_chroma_qp_sÿË
;

1493 
	mb™d•th_Ïmbda_sÿË
;

1494 
ušt32
 
	mdc_´ed_v®ue_comp
[
MAX_PLANE
];

1495 
	mmax_³l_v®ue_comp
 [
MAX_PLANE
];

1496 
	mmax_img³l_v®ue_comp_sq
 [
MAX_PLANE
];

1497 
	mnum_blk8x8_uv
;

1498 
	mnum_cdc_cÛff
;

1499 
	mmb_ü_size_x
;

1500 
	mmb_ü_size_y
;

1501 
	mmb_size
[
MAX_PLANE
][2];

1502 
	mmax_b™CouÁ
;

1503 
	mwidth
;

1504 
	mwidth_·dded
;

1505 
	mwidth_blk
;

1506 
	mwidth_ü
;

1507 
	mheight
;

1508 
	mheight_·dded
;

1509 
	mheight_blk
;

1510 
	mheight_ü
;

1511 
	mheight_ü_äame
;

1512 
	msize
;

1513 
	msize_ü
;

1514 
	m·dded_size_x
;

1515 
	m·dded_size_x_m8x8
;

1516 
	m·dded_size_x_m4x4
;

1517 
	mü_·dded_size_x
;

1518 
	mü_·dded_size_x_m8
;

1519 
	mü_·dded_size_x2
;

1520 
	mü_·dded_size_x4
;

1521 
	m·d_size_uv_x
;

1522 
	m·d_size_uv_y
;

1523 
	mchroma_mask_mv_y
;

1524 
	mchroma_mask_mv_x
;

1525 
	mchroma_shiá_y
, 
	mchroma_shiá_x
;

1526 
	mshiá_ü_x
, 
	mshiá_ü_y
;

1528 
	mPicWidthInMbs
;

1529 
	mPicHeightInM­Un™s
;

1530 
	mF¿meHeightInMbs
;

1531 
	mF¿meSizeInMbs
;

1533 } 
	tVideoP¬am‘”s
;

1536 
sÿlšg_li¡
 
	tSÿËP¬am‘”s
;

1537 
rdo_¡ruùu»
 
	tRDOPTSŒuùu»
;

1539 
	s’cod”_·¿ms


1541 
IÅutP¬am‘”s
 *
	mp_IÅ
;

1542 
VideoP¬am‘”s
 *
	mp_Vid
;

1543 
FILE
 *
	mp_Œaû
;

1544 
št64
 
	mbufãrSize
;

1545 } 
	tEncod”P¬ams
;

1547 
Encod”P¬ams
 *
p_Enc
;

1555 
cÝyblock_¥
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
pos_mb1
,
pos_mb2
);

1556 
»sidu®_ŒªsfÜm_quªt_chroma_4x4
 (
Maüoblock
 *
cu¼MB
, 
uv
, 
ü_cbp
);

1557 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
 (
Maüoblock
 *
cu¼MB
, 
uv
,
i11
);

1558 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
 (
Maüoblock
 *
cu¼MB
, 
uv
,
i11
);

1561 
di¡blk
 
G‘DœeùCo¡MB
 (
Maüoblock
 *
cu¼MB
);

1562 
di¡blk
 
G‘DœeùCo¡8x8
 (
Maüoblock
 *
cu¼MB
, , distblk*);

1564 
piùu»_codšg_decisiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
piùu»1
, Piùu» *
piùu»2
, 
qp
);

1566 
no_mem_ex™
 (*
wh”e
);

1567 
g‘_mem_ACcÛff_Ãw
 (****** 
cofAC
, 
chroma
);

1568 
g‘_mem_ACcÛff
 (
VideoP¬am‘”s
 *
p_Vid
, *****);

1569 
g‘_mem_DCcÛff
 (****);

1570 
ä“_mem_ACcÛff
 (****);

1571 
ä“_mem_ACcÛff_Ãw
 (***** 
cofAC
);

1572 
ä“_mem_DCcÛff
 (***);

1574 #ià
TRACE


1575 
Œaû2out
(
SyÁaxEËm’t
 *
£
);

1576 
Œaû2out_ÿbac
(
SyÁaxEËm’t
 *
£
);

1579 
”rÜ
(*
‹xt
, 
code
);

1580 
£t_mbaff_·¿m‘”s
(
Maüoblock
 *
cu¼MB
);

1583 
is_b»d_’abËd
 (
VideoP¬am‘”s
 *
p_Vid
, 
mode
);

1584 
upd©e_qp
 (
Maüoblock
 *
cu¼MB
);

1585 
£Ëù_¶ªe
 (
VideoP¬am‘”s
 *
p_Vid
, 
CÞÜPÏÃ
 
cÞÜ_¶ªe
);

1586 
£Ëù_ŒªsfÜm
 (
Maüoblock
 *
cu¼MB
);

1587 
£t_¦iû_ty³
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
¦iû_ty³
);

1588 
ä“_’cod”_memÜy
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1589 
ouut_SP_cÛffic›Ás
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1590 
»ad_SP_cÛffic›Ás
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1591 
š™_»dundªt_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1592 
£t_»dundªt_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1593 
’code_Úe_»dundªt_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

1599 
img³l
 ****
	mluma
;

1600 
img³l
 ****
	mücb
[2];

1601 } 
	tSubImageCÚš”
;

1604 
chªge_¶ªe_JV
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
ÅÏÃ
 );

1605 
make_äame_piùu»_JV
Ð
VideoP¬am‘”s
 *
p_Vid
 );

1609 
	g”rÜ‹xt
[
ET_SIZE
];

1610 
£tup_codšg_Ïy”
(
VideoP¬am‘”s
 *
p_Vid
);

1612 
šlše
 
	$is_FREXT_´ofže
(
´ofže_idc
)

1615  ( 
´ofže_idc
==
NO_PROFILE
 ||…rofže_idc==
FREXT_HP
 ||…rofže_idc==
FREXT_Hi10P
 ||…rofže_idc==
FREXT_Hi422
 ||…rofže_idc==
FREXT_Hi444
 ||…rofže_idø=ð
FREXT_CAVLC444
 );

1616 
	}
}

1619 
šlše
 
	$is_MVC_´ofže
(
´ofže_idc
)

1622 #ià(
MVC_EXTENSION_ENABLE
)

1623 || (
´ofže_idc
 =ð
MULTIVIEW_HIGH
è|| (´ofže_idø=ð
STEREO_HIGH
)

1626 
	}
}

1628 
šlše
 
	$is_šŒa
(
Maüoblock
 *
cu¼_MB
)

1630  ((
cu¼_MB
)->
mb_ty³
==
SI4MB
 || (cu¼_MB)->mb_ty³==
I4MB
 || (cu¼_MB)->mb_ty³==
I16MB
 || (cu¼_MB)->mb_ty³==
I8MB
 || (cu¼_MB)->mb_ty³==
IPCM
);

1631 
	}
}

	@lencod/inc/header.h

11 #iâdeà
_HEADER_H_


12 
	#_HEADER_H_


	)

14 
SliûH—d”
 (
Sliû
* 
cu¼Sliû
);

15 
P¬t™iÚ_BC_H—d”
(
Sliû
 *
cu¼Sliû
, 
P¬tNo
);

16 
wr™eERPS
 (
SyÁaxEËm’t
 *
sym
, 
D©aP¬t™iÚ
 *
·¹™iÚ
);

17 
dec_»f_pic_m¬kšg
(
B™¡»am
 *
b™¡»am
, 
DecRefPicM¬kšg_t
 *
p_d½m
, 
idr_æag
, 
no_ouut_of_´iÜ_pics_æag
, 
lÚg_‹rm_»ã»nû_æag
 );

	@lencod/inc/hme_distortion.h

18 #iâdeà
_HME_DISTORTION_H_


19 
	#_HME_DISTORTION_H_


	)

23 
šlše
 
img³l
 *
	$UMVLše4X_št_hme
(
StÜabËPiùu»
 *
»f
, 
MEBlock
 *
mv_block
, 
y
, 
x
)

25  &(
»f
->
pHmeImage
[
mv_block
->
hme_Ëv–
][
	`iCl3
(-
IMG_PAD_SIZE_Y
, mv_block->
hme_»f_size_y_max
, 
y
 >> 2)][iCl3(-
IMG_PAD_SIZE_X
, mv_block->
hme_»f_size_x_max
, 
x
 >> 2)]);

26 
	}
}

31 
di¡blk
 
compu‹SAD_hme
(
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

	@lencod/inc/image.h

17 #iâdeà
_IMAGE_H_


18 
	#_IMAGE_H_


	)

20 
	~"mbufãr.h
"

22 
	scodšg_šfo
 {

23 
	mty³
;

24 
	mšŒas
;

25 
	msumF¿meQP
;

26 
	mnum_»f_idx_l0
;

27 
	mnum_»f_idx_l1
;

28 
pic_·¿m‘”_£t_rb¥_t
 *
	maùive_µs
;

29 } 
	tCodšgInfo
;

31 
’code_Úe_äame
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

32 
BoÞ—n
 
dummy_¦iû_too_big
 ( 
b™s_¦iû
);

33 
cÝy_rdÝt_d©a
 ( 
Maüoblock
 *
cu¼MB
);

34 
Unif›dOÃFÜthPix
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
);

35 
G’”©eHMELay”s
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
);

37 
Unif›dOÃFÜthPix_JV
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
ÅÏÃ
, 
StÜabËPiùu»
 *
s
);

38 
äame_piùu»
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
äame
, 
ImageD©a
 *
imgD©a
, 
rd_·ss
);

39 
by‹
 
g‘_idr_æag
 ( 
VideoP¬am‘”s
 *
p_Vid
 );

40 
by‹
 
g‘_¿ndom_acûss_æag
Ð
VideoP¬am‘”s
 *
p_Vid
 );

41 
wr™e_nÚ_vþ_Çlu
 ( 
VideoP¬am‘”s
 *
p_Vid
);

42 
wr™e_nÚ_vþ_Çlu_bÙ_æd
Ð
VideoP¬am‘”s
 *
p_Vid
 );

43 #ià(
MVC_EXTENSION_ENABLE
)

44 
wr™e_nÚ_vþ_Çlu_mvc
Ð
VideoP¬am‘”s
 *
p_Vid
);

47 
äame_piùu»_mp
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

48 
»¡Üe_codšg_šfo
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
 );

49 
¡Üe_codšg_šfo
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
 );

50 
¡Üe_codšg_ªd_rc_šfo
Ð
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
 );

51 
sw­_äame_bufãr
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
a
, 
b
 );

52 
äame_piùu»_mp_ex™
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
 );

55 
G’”©eImagePy¿mid
(
VideoP¬am‘”s
 *
p_Vid
, 
size_x
, 
size_y
, 
img³l
 ***
pHmeImage
, 
off£t_x
, 
off£t_y
);

56 
G‘HMEIÁImagesLuma
Ð
VideoP¬am‘”s
 *
p_Vid
, 
size_x
, 
size_y
, 
img³l
 ***
cImgIÁ
);

58 
G’”©eHMEBufãrs
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
size_x
, 
size_y
, 
img³l
 ***
pHmeImage
, 
off£t_x
, 
off£t_y
);

59 
OuutImage
 ( *
pcP»fix
, 
iF¿meNo
, 
iLev–
, 
img³l
 **
pImg
, 
iWidth
, 
iHeight
, 
iXOff£t
, 
iYOff£t
);

60 
cÝy_·¿ms
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
’c_piùu»
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
);

61 
OtfCom·tibž™y_cÝyW™hPaddšg
 ( 
img³l
 **
d¡Img
, img³È**
¤cImg
, 
size_x
, 
size_y
, 
·ddšg_x
, 
·ddšg_y
 );

	@lencod/inc/img_chroma.h

18 #iâdeà
_IMG_CHROMA_H_


19 
	#_IMG_CHROMA_H_


	)

21 
g‘SubImagesChroma
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
 );

	@lencod/inc/img_dist_ms_ssim.h

19 #iâdeà
_IMG_DIST_MS_SSIM_H_


20 
	#_IMG_DIST_MS_SSIM_H_


	)

21 
	~"img_di¡ÜtiÚ.h
"

23 
fšd_ms_ssim
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ImageSŒuùu»
 *
imgREF
, ImageSŒuùu» *
imgSRC
, 
Di¡M‘ric
 
m‘ricMS_SSIM
[3]);

	@lencod/inc/img_dist_snr.h

17 #iâdeà
_IMG_DIST_SNR_H_


18 
	#_IMG_DIST_SNR_H_


	)

19 
	~"img_di¡ÜtiÚ.h
"

21 
fšd_¢r
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
imgREF
, ImageSŒuùu» *
imgSRC
, 
Di¡M‘ric
 
m‘ricSSE
[3], Di¡M‘riø
m‘ricPSNR
[3]);

	@lencod/inc/img_dist_ssim.h

19 #iâdeà
_IMG_DIST_SSIM_H_


20 
	#_IMG_DIST_SSIM_H_


	)

21 
	~"img_di¡ÜtiÚ.h
"

23 
fšd_ssim
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ImageSŒuùu»
 *
imgREF
, ImageSŒuùu» *
imgSRC
, 
Di¡M‘ric
 
m‘ricSSIM
[3]);

	@lencod/inc/img_distortion.h

17 #iâdeà
_IMG_DISTORTION_H_


18 
	#_IMG_DISTORTION_H_


	)

20 
accumuÏ‹_av¦iû
(
Di¡M‘ric
 
m‘ric
[3], 
¦iû_ty³
, 
äames
);

21 
accumuÏ‹_av”age
(
Di¡M‘ric
 
m‘ric
[3], 
äames
);

22 
fšd_di¡ÜtiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
);

23 
£Ëù_img
 (
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
imgSRC
, ImageSŒuùu» *
imgREF
, 
ImageD©a
 *
imgD©a
);

24 
compu‹_di¡ÜtiÚ
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
);

	@lencod/inc/img_luma.h

18 #iâdeà
_IMG_LUMA_H_


19 
	#_IMG_LUMA_H_


	)

21 cÚ¡ 
	gONE_FOURTH_TAP
[2][3] =

27 
g‘SubImagesLuma
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
 );

	@lencod/inc/intra16x16.h

17 #iâdeà
_INTRA16X16_H_


18 
	#_INTRA16X16_H_


	)

20 
di¡blk
 
di¡I16x16_§d
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, di¡blk 
mš_co¡
);

21 
di¡blk
 
di¡I16x16_s£
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, di¡blk 
mš_co¡
);

22 
di¡blk
 
di¡I16x16_§td
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, di¡blk 
mš_co¡
);

24 
di¡blk
 
fšd_§d_16x16_JM
 (
Maüoblock
 *
cu¼MB
);

26 
£t_šŒ­»d_16x16_mbaff
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
);

27 
£t_šŒ­»d_16x16
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
);

28 
g‘_šŒ­»d_16x16
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i16x16_mode
, 
Ëá_avažabË
, 
up_avažabË
);

	@lencod/inc/intra4x4.h

15 #iâdeà
_INTRA4x4_H_


16 
	#_INTRA4x4_H_


	)

19 
£t_šŒ­»d_4x4_mbaff
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
, 
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
);

20 
£t_šŒ­»d_4x4
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
, 
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
);

21 
g‘_šŒ­»d_4x4
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i4x4_mode
, 
img_x
, 
img_y
, 
Ëá_avažabË
, 
up_avažabË
);

24 
g’”©e_´ed_”rÜ_4x4
(
img³l
 **
cur_img
, img³È**
´d_img
, img³È**
cur_´d
, **
mb_¼es
, 
pic_Ýix_x
, 
block_x
);

	@lencod/inc/intra8x8.h

17 #iâdeà
_INTRA8X8_H_


18 
	#_INTRA8X8_H_


	)

20 
£t_šŒ­»d_8x8_mbaff
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
up_Ëá_avažabË
);

21 
£t_šŒ­»d_8x8
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
up_Ëá_avažabË
);

22 
g‘_šŒ­»d_8x8
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i8x8_mode
, 
Ëá_avažabË
, 
up_avažabË
);

23 
LowPassFÜIÁ¿8x8P»d
 (
img³l
 *
P»dP–
, 
block_up_Ëá
, 
block_up
, 
block_Ëá
);

25 
g’”©e_´ed_”rÜ_8x8
 (
img³l
 **
cur_img
, img³È**
´d_img
, img³È**
cur_´d
, **
mb_¼es
, 
pic_Ýix_x
, 
block_x
);

	@lencod/inc/intrarefresh.h

17 #iâdeà
_INTRAREFRESH_H_


18 
	#_INTRAREFRESH_H_


	)

20 
RªdomIÁ¿In™
(
VideoP¬am‘”s
 *
p_Vid
, 
xsize
, 
ysize
, 
»äesh
);

21 
RªdomIÁ¿Unš™
(
VideoP¬am‘”s
 *
p_Vid
);

22 
RªdomIÁ¿
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb
);

23 
RªdomIÁ¿NewPiùu»
 (
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/lambda.h

18 #iâdeà
_LAMBDA_H_


19 
	#_LAMBDA_H_


	)

21 
	~"glob®.h
"

23 
g‘_im¶ic™_Ïmbda_p_¦iû
 (
Sliû
 *
cu¼Sliû
);

24 
g‘_im¶ic™_Ïmbda_b_¦iû
 (
Sliû
 *
cu¼Sliû
);

25 
g‘_im¶ic™_Ïmbda_i_¦iû
 (
Sliû
 *
cu¼Sliû
);

26 
g‘_im¶ic™_Ïmbda_¥_¦iû
(
Sliû
 *
cu¼Sliû
);

27 
g‘_ex¶ic™_Ïmbda
 (
Sliû
 *
cu¼Sliû
);

28 
g‘_fixed_Ïmbda
 (
Sliû
 *
cu¼Sliû
);

29 
£t_rdoq_Ïmbda
 (
Sliû
 *
cu¼Sliû
);

	@lencod/inc/leaky_bucket.h

15 #iâdeà
_LEAKY_BUCKET_H_


16 
	#_LEAKY_BUCKET_H_


	)

20 #ifdeà
_LEAKYBUCKET_


21 
g‘_L—kyBuck‘R©e
(
IÅutP¬am‘”s
 *
p_IÅ
, 
Numb”L—kyBuck‘s
, *
Rmš
);

22 
PutBigDoubËWÜd
 (
dw
, 
FILE
 *
å
);

23 
wr™e_bufãr
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
Numb”L—kyBuck‘s
, 
Rmš
[], 
Bmš
[], 
Fmš
[]);

24 
SÜt
 (
Numb”L—kyBuck‘s
, *
Rmš
);

25 
ÿlc_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

	@lencod/inc/list_reorder.h

19 #iâdeà
_LIST_REORDER_H_


20 
	#_LIST_REORDER_H_


	)

22 
	~"glob®.h
"

23 
	~"mbufãr.h
"

25 
š™_»f_pic_li¡_»Üd”šg
Ð
Sliû
 *
cu¼Sliû
, 
»fReÜd”M‘hod
, 
u£Di¡ÜtiÚReÜd”šg
);

26 
»Üd”_li¡s
 ( 
Sliû
 *
cu¼Sliû
 );

27 
wp_mý»c_»Üd”_li¡s
 ( 
Sliû
 *
cu¼Sliû
 );

30 
poc_»f_pic_»Üd”_äame_deçuÉ
Ð
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

31 
poc_»f_pic_»Üd”_f›ld
 ( 
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

32 
poc_»f_pic_»Üd”_f›ld_’h
 ( 
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

34 
Žyr_»f_pic_»Üd”_äame_deçuÉ
 ( 
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

35 
»Üd”_agaš¡_deçuÉ_»f_pic_li¡s
Ð
Sliû
 *
cu¼Sliû
, 
cur_li¡
 );

36 
poc_»f_pic_»Üd”_äame_’h
 ( 
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

37 
m£_»f_pic_»Üd”_äame
 ( 
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
 );

38 
£t_deçuÉ_»f_pic_li¡s
Ð
Sliû
 *
cu¼Sliû
 );

	@lencod/inc/lln_mc_prediction.h

18 #iâdeà
_LLN_MC_PREDICTION_H_


19 
	#_LLN_MC_PREDICTION_H_


	)

21 
	~"glob®.h
"

22 
	~"mbufãr.h
"

25 
g‘_block_luma
 (
Maüoblock
 *
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
 *
dec_piùu»
, StÜabËPiùu» *
li¡
, 
x_pos
, 
y_pos
, 
block_size_y
, 
block_size_x
, 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE]);

26 
g‘_block_chroma
(
Maüoblock
 *
cu¼Mb
, 
decod”
, 
uv
, 
StÜabËPiùu»
 *
dec_piùu»
, StÜabËPiùu» *
li¡
, 
x_pos
, 
y_pos
, 
block_size_x
, 
block_size_y
, 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE]);

31 
³rfÜm_mc
 (
Maüoblock
* 
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
 *
dec_piùu»
, 
´ed_dœ
, 
l0_mode
, 
l1_mode
, 
PicMÙiÚP¬ams
 **
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
, 
b»d_me
);

32 
³rfÜm_mc_cÚû®m’t
(
Maüoblock
* 
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
 *
dec_piùu»
, 
´ed_dœ
, 
l0_mode
, 
l1_mode
, 
PicMÙiÚP¬ams
 **
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
);

	@lencod/inc/loop_filter.h

18 #iâdeà
_LOOP_FILTER_H_


19 
	#_LOOP_FILTER_H_


	)

21 
	~"glob®.h
"

23 
	#GROUP_SIZE
 1

	)

35 cÚ¡ 
by‹
 
	gALPHA_TABLE
[52] = {0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,4,4,5,6, 7,8,9,10,12,13,15,17, 20,22,25,28,32,36,40,45, 50,56,63,71,80,90,101,113, 127,144,162,182,203,226,255,255} ;

36 cÚ¡ 
by‹
 
	gBETA_TABLE
[52] = {0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,2,2,2,3, 3,3,3, 4, 4, 4, 6, 6, 7, 7, 8, 8, 9, 9,10,10, 11,11,12,12,13,13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18} ;

37 cÚ¡ 
by‹
 
	gCLIP_TAB
[52][5] =

48 cÚ¡ 
	gchroma_edge
[2][4][4] =

59 cÚ¡ 
	g³Êum_ü
[2][4] = {{0,8,16,16}, {0,8, 8,16}};

62 
šlše
 
	$com·»_mvs
(cÚ¡ 
MÙiÚVeùÜ
 *
mv0
, cÚ¡ MÙiÚVeùÜ *
mv1
, 
mvlim™
)

64  ((
	`Ÿbs
Ð
mv0
->
mv_x
 - 
mv1
->mv_xè>ð4è| (ŸbsÐmv0->
mv_y
 - mv1->mv_yè>ð
mvlim™
));

65 
	}
}

	@lencod/inc/macroblock.h

18 #iâdeà
_MACROBLOCK_H_


19 
	#_MACROBLOCK_H_


	)

21 
	~"block.h
"

22 
	~"maüoblock_p444.h
"

24 cÚ¡ 
	gblock8x8_idx
[3][4][4] =

46 cÚ¡ 
	g·¹_size
[8][2] =

58 cÚ¡ 
	gblock_size
[8][2] =

70 
Ãxt_maüoblock
 (
Maüoblock
* 
cu¼MB
);

71 
¡¬t_maüoblock
 (
Sliû
 *
cu¼Sliû
, 
Maüoblock
** 
cu¼MB
, 
mb_addr
, 
BoÞ—n
 
mb_f›ld
);

72 
»£t_maüoblock
 (
Maüoblock
 *
cu¼MB
);

73 
’d_maüoblock
 (
Maüoblock
* 
cu¼MB
, 
BoÞ—n
 *
’d_of_¦iû
, BoÞ—À*
»code_maüoblock
);

74 
wr™e_maüoblock
 (
Maüoblock
* 
cu¼MB
, 
eos_b™
);

77 
»£t_block
(
Maüoblock
* 
cu¼MB
, *
cbp
, 
št64
 *
cbp_blk
, 
block8x8
);

79 
luma_»sidu®_codšg_16x16
 (
Maüoblock
 *, , [2]);

80 
luma_»sidu®_codšg_8x8
 (
Maüoblock
 *, *, 
št64
*, , , [2], *);

81 
luma_»sidu®_codšg
 (
Maüoblock
 *);

82 
luma_»sidu®_codšg_¥
 (
Maüoblock
 *);

83 
chroma_»sidu®_codšg
 (
Maüoblock
 *);

84 
chroma_»sidu®_codšg_¥
 (
Maüoblock
 *);

85 
chroma_»sidu®_codšg_si
 (
Maüoblock
 *);

86 
šŒa_chroma_RD_decisiÚ
 (
Maüoblock
 *, 
RD_PARAMS
 *);

87 
šŒa_chroma_RD_decisiÚ_mbaff
 (
Maüoblock
 *, 
RD_PARAMS
 *);

89 
by‹
 
ŒªsfÜm_decisiÚ
 (
Maüoblock
 *, , 
di¡blk
*);

90 
B8Mode2V®ue
 (
Sliû
 *, , );

92 
wr™e_p_¦iû_MB_Ïy”
 (
Maüoblock
 *, , *);

93 
wr™e_b_¦iû_MB_Ïy”
 (
Maüoblock
 *, , *);

94 
wr™e_i_¦iû_MB_Ïy”
 (
Maüoblock
 *, , *);

96 
wr™e_‹rmš©šg_b™
 (
Sliû
* 
cu¼Sliû
, 
b™
);

98 
wr™eMÙiÚInfo2NAL
 (
Maüoblock
* 
cu¼MB
);

99 
wr™e_p_¦iû_mÙiÚ_šfo_to_NAL
 (
Maüoblock
* 
cu¼MB
);

100 
wr™e_b_¦iû_mÙiÚ_šfo_to_NAL
 (
Maüoblock
* 
cu¼MB
);

101 
wr™e_p_¦iû_mÙiÚ_šfo_to_NAL
 (
Maüoblock
* 
cu¼MB
);

102 
wr™eReã»nûF¿me
 (
Maüoblock
 *
cu¼MB
, 
i
, 
j
, 
li¡_idx
, 
»f
);

103 
wr™eMÙiÚVeùÜ8x8
 (
Maüoblock
 *
cu¼MB
, 
i0
, 
j0
, 
i1
, 
j1
, 
»fäame
, 
li¡_idx
, 
mv_mode
, 
b»d_me
);

105 
wr™eCÛff4x4_CABAC
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
, , , );

106 
wr™eCÛff8x8_CABAC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
, , );

107 
wr™eCÛff8x8
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
, , , );

108 
wr™eCÛff16x16_CABAC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
);

109 
wr™eCÛff16x16_CAVLC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
);

111 
wr™eCÛff4x4_CAVLC_nÜm®
 (
Maüoblock
* 
cu¼MB
, 
block_ty³
, 
b8
, 
b4
, 
·¿m
);

112 
wr™eCÛff4x4_CAVLC_444
 (
Maüoblock
* 
cu¼MB
, 
block_ty³
, 
b8
, 
b4
, 
·¿m
);

114 
´ediù_Âz
 (
Maüoblock
 *
cu¼MB
, 
block_ty³
, 
i
,
j
);

115 
´ediù_Âz_chroma
(
Maüoblock
 *
cu¼MB
, 
i
,
j
);

117 
£t_modes_ªd_»äame
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
);

118 
£t_modes_ªd_»äame_i_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
);

119 
£t_modes_ªd_»äame_b_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
);

120 
£t_modes_ªd_»äame_p_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
);

121 
Maüoblock
 *
®loc_mbs
(
VideoP¬am‘”s
 *
p_Vid
, 
mb_num
, 
Ïy”s
);

122 
ä“_mbs
(
Maüoblock
 *
pMBs
, 
mb_num
);

123 
£tup_mbs
(
Maüoblock
 *
pMBs
, 
mb_num
, 
Ïy”_id
);

	@lencod/inc/macroblock_p444.h

14 #iâdeà
_MACROBLOCK_P444_H_


15 
	#_MACROBLOCK_P444_H_


	)

17 
	~"block.h
"

19 
luma_»sidu®_codšg_p444_16x16
 (
Maüoblock
* 
cu¼MB
, , , [2], *);

20 
luma_»sidu®_codšg_p444_8x8
 (
Maüoblock
* 
cu¼MB
, *, 
št64
*, , , [2], *);

21 
luma_»sidu®_codšg_p444
 (
Maüoblock
 *
cu¼MB
);

	@lencod/inc/mbuffer.h

17 #iâdeà
_MBUFFERENC_H_


18 
	#_MBUFFERENC_H_


	)

20 
	~"glob®.h
"

21 
	~"’c_¡©i¡ics.h
"

23 
	#MAX_LIST_SIZE
 33

	)

25 
äame_¡Üe
 
	tF¿meStÜe
;

26 
di¡ÜtiÚ_e¡im©iÚ
 
	tDi¡_E¡m
;

27 
piùu»_¡©s
 
	tPiùu»Sts
;

28 
pic_mÙiÚ_·¿ms_Þd
 
	tPicMÙiÚP¬amsOld
;

30 
	spiùu»_¡©s


32 
	mdsum
[3];

33 
	mdv¬
[3];

38 
	spic_mÙiÚ_·¿ms_Þd


40 
by‹
 * 
	mmb_f›ld
;

45 
	spic_mÙiÚ_·¿ms


47 
¡ÜabË_piùu»
 *
	m»f_pic
[2];

48 
	m»f_idx
[2];

49 
MÙiÚVeùÜ
 
	mmv
[2];

50 
by‹
 
	mf›ld_äame
;

51 } 
	tPicMÙiÚP¬ams
;

55 
	s¡ÜabË_piùu»


57 
Piùu»SŒuùu»
 
	m¡ruùu»
;

59 
	mpoc
;

60 
	mtÝ_poc
;

61 
	mbÙtom_poc
;

62 
	mäame_poc
;

63 
	mÜd”_num
;

64 
	mäame_num
;

65 
	mpic_num
;

66 
	mlÚg_‹rm_pic_num
;

67 
	mlÚg_‹rm_äame_idx
;

68 
	m‹mpÜ®_Ïy”
;

70 
by‹
 
	mis_lÚg_‹rm
;

71 
	mu£d_fÜ_»ã»nû
;

72 
	mis_ouut
;

73 
	mnÚ_exi¡šg
;

75 
	msize_x
, 
	msize_y
, 
	msize_x_ü
, 
	msize_y_ü
;

76 
	msize_x_·dded
, 
	msize_y_·dded
;

77 
	msize_x_·d
, 
	msize_y_·d
;

78 
	msize_x_ü_·d
, 
	msize_y_ü_·d
;

79 
	m·d_size_uv_y
, 
	m·d_size_uv_x
;

80 
	mchroma_veùÜ_adju¡m’t
;

81 
	mcoded_äame
;

82 
	mmb_aff_äame_æag
;

84 
img³l
 ** 
	mimgY
;

85 
img³l
 **** 
	mimgY_sub
;

86 
img³l
 *** 
	mimgUV
;

87 
img³l
 *****
	mimgUV_sub
;

89 
img³l
 *** 
	mp_dec_img
[
MAX_PLANE
];

91 
img³l
 ** 
	mp_img
[
MAX_PLANE
];

92 
img³l
 **** 
	mp_img_sub
[
MAX_PLANE
];

93 
img³l
 ** 
	mp_cu¼_img
;

94 
img³l
 **** 
	mp_cu¼_img_sub
;

97 
img³l
 *** 
	mpHmeImage
;

98 * 
	mpHmeWidth
;

99 * 
	mpHmeHeight
;

101 
Di¡_E¡m
 * 
	mde_mem
;

103 
PicMÙiÚP¬ams
 **
	mmv_šfo
;

104 
PicMÙiÚP¬ams
 **
	mJVmv_šfo
[
MAX_PLANE
];

105 
PicMÙiÚP¬amsOld
 
	mmÙiÚ
;

106 
PicMÙiÚP¬amsOld
 
	mJVmÙiÚ
[
MAX_PLANE
];

108 
	mcÞour_¶ªe_id
;

110 
¡ÜabË_piùu»
 *
	mtÝ_f›ld
;

111 
¡ÜabË_piùu»
 *
	mbÙtom_f›ld
;

112 
¡ÜabË_piùu»
 *
	mäame
;

114 
	mchroma_fÜm©_idc
;

115 
	mchroma_mask_mv_x
;

116 
	mchroma_mask_mv_y
;

117 
	mchroma_shiá_y
;

118 
	mchroma_shiá_x
;

119 
	mäame_mbs_Úly_æag
;

120 
	mäame_üÝpšg_æag
;

121 
	mäame_üÝ_Ëá_off£t
;

122 
	mäame_üÝ_right_off£t
;

123 
	mäame_üÝ_tÝ_off£t
;

124 
	mäame_üÝ_bÙtom_off£t
;

126 
Piùu»Sts
 
	mp_¡©s
;

127 
StP¬am‘”s
 
	m¡©s
;

129 
	mty³
;

131 #ià(
MVC_EXTENSION_ENABLE
)

132 
	mv›w_id
;

133 
	mš‹r_v›w_æag
[2];

134 
	mªchÜ_pic_æag
[2];

137 
	mbIÁ”pÞ©ed
;

138 
	m»f_pic_Ç
[6];

139 
	mÙf_æag
;

141 } 
	tStÜabËPiùu»
;

143 
StÜabËPiùu»
 *
	tStÜabËPiùu»PŒ
;

146 
	säame_¡Üe


148 
	mis_u£d
;

149 
	mis_»ã»nû
;

150 
	mis_lÚg_‹rm
;

151 
	mis_Üig_»ã»nû
;

153 
	mis_nÚ_exi¡’t
;

155 
	mäame_num
;

156 
	mäame_num_w¿p
;

157 
	mlÚg_‹rm_äame_idx
;

158 
	mis_ouut
;

159 
	mpoc
;

161 
StÜabËPiùu»
 *
	mäame
;

162 
StÜabËPiùu»
 *
	mtÝ_f›ld
;

163 
StÜabËPiùu»
 *
	mbÙtom_f›ld
;

165 
BoÞ—n
 
	mis_š‹r_Ïy”
;

167 #ià(
MVC_EXTENSION_ENABLE
)

168 
	mv›w_id
;

169 
	mš‹r_v›w_æag
[2];

170 
	mªchÜ_pic_æag
[2];

177 
	sdecoded_piùu»_bufãr


179 
VideoP¬am‘”s
 *
	mp_Vid
;

180 
IÅutP¬am‘”s
 *
	mp_IÅ
;

181 
F¿meStÜe
 **
	mfs
;

182 
F¿meStÜe
 **
	mfs_»f
;

183 
F¿meStÜe
 **
	mfs_É»f
;

184 
F¿meStÜe
 **
	mfs_ž»f
;

185 
	mnum_»f_äames
;

186 
	msize
;

187 
	mu£d_size
;

188 
	m»f_äames_š_bufãr
;

189 
	mÉ»f_äames_š_bufãr
;

190 
	mÏ¡_ouut_poc
;

191 #ià(
MVC_EXTENSION_ENABLE
)

192 
	mÏ¡_ouut_v›w_id
;

194 
	mmax_lÚg_‹rm_pic_idx
;

196 
	mš™_dÚe
;

198 
F¿meStÜe
 *
	mÏ¡_piùu»
;

199 
	mÏy”_id
;

200 
	mu£d_size_ž
;

202 
F¿meFÜm©
 
	m¡Üage_fÜm©
;

204 (*
	mpf_G‘HMEIÁImagesLuma
)Ð
VideoP¬am‘”s
 *
	mp_Vid
, 
	msize_x
, 
	msize_y
, 
img³l
 ***
	mcImgIÁ
);

207 (*
	mpf_luma_´ediùiÚ
èÐ
Maüoblock
* 
	mcu¼MB
, , , , , , [2], *, );

208 (*
	mpf_luma_´ediùiÚ_bi
èÐ
Maüoblock
* 
	mcu¼MB
, , , , , , , , , );

209 (*
	mpf_chroma_´ediùiÚ
èÐ
Maüoblock
* 
	mcu¼MB
, , , , , , , , , , , );

210 (*
	mpf_g‘_block_luma
èÐ
	mvideo_·r
 *, 
	mimg³l
*, *, , , , , 
	m¡ÜabË_piùu»
*, );

211 (*
	mpf_g‘_block_chroma
[2]èÐ
	mvideo_·r
 *, 
	mimg³l
*, *, , , , , 
	m¡ÜabË_piùu»
*, );

212 (*
	mpf_OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
)(
Maüoblock
 *
	mcu¼MB
, 
	mimg³l
* , , , 
	mMÙiÚVeùÜ
 ** , 
StÜabËPiùu»
 *
	mli¡X
, );

213 (*
	mpf_OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
è(
Maüoblock
 *
	mcu¼MB
, 
	mimg³l
* , , , 
	mMÙiÚVeùÜ
 ** , 
StÜabËPiùu»
 *
	mli¡X
, );

214 
di¡blk
 (*
pf_compu‹SAD
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

215 
di¡blk
 (*
pf_compu‹SADWP
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

216 
di¡blk
 (*
pf_compu‹SATD
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

217 
di¡blk
 (*
pf_compu‹SATDWP
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

218 
di¡blk
 (*
pf_compu‹BiP»dSAD1
)(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

219 
di¡blk
 (*
pf_compu‹BiP»dSAD2
)(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

220 
di¡blk
 (*
pf_compu‹BiP»dSATD1
è(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

221 
di¡blk
 (*
pf_compu‹BiP»dSATD2
è(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

222 
di¡blk
 (*
pf_compu‹SSE
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

223 
di¡blk
 (*
pf_compu‹SSEWP
è(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

224 
di¡blk
 (*
pf_compu‹BiP»dSSE1
è(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

225 
di¡blk
 (*
pf_compu‹BiP»dSSE2
è(
StÜabËPiùu»
 *
	m»f1
, StÜabËPiùu» *
	m»f2
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *, MotionVector *);

226 }
	tDecodedPiùu»Bufãr
;

228 
š™_dpb
 (
VideoP¬am‘”s
 *
p_Vid
, 
DecodedPiùu»Bufãr
 *
dpb
);

229 
ä“_dpb
 (
DecodedPiùu»Bufãr
 *
p_Dpb
);

230 
F¿meStÜe
* 
®loc_äame_¡Üe
();

231 
ä“_äame_¡Üe
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
* 
f
);

232 
StÜabËPiùu»
* 
®loc_¡ÜabË_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»SŒuùu»
 
ty³
, 
size_x
, 
size_y
, 
size_x_ü
, 
size_y_ü
);

233 
ä“_¡ÜabË_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
* 
p
);

234 
¡Üe_piùu»_š_dpb
 (
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
);

235 
»¶aû_tÝ_pic_w™h_äame
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
);

236 
æush_dpb
 (
DecodedPiùu»Bufãr
 *
p_Dpb
, 
F¿meFÜm©
 *
ouut
);

237 
dpb_¥l™_f›ld
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
);

238 
dpb_combše_f›ld
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
);

239 
dpb_combše_f›ld_yuv
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
);

240 
š™_li¡s_p_¦iû
 (
Sliû
 *
cu¼Sliû
);

241 
š™_li¡s_b_¦iû
 (
Sliû
 *
cu¼Sliû
);

242 
š™_li¡s_i_¦iû
 (
Sliû
 *
cu¼Sliû
);

243 
upd©e_pic_num
 (
Sliû
 *
cu¼Sliû
);

244 
»Üd”_»f_pic_li¡
 (
Sliû
 *
cu¼Sliû
, 
cur_li¡
);

245 
š™_mbaff_li¡s
 (
Sliû
 *
cu¼Sliû
);

246 
®loc_»f_pic_li¡_»Üd”šg_bufãr
 (
Sliû
 *
cu¼Sliû
);

247 
ä“_»f_pic_li¡_»Üd”šg_bufãr
 (
Sliû
 *
cu¼Sliû
);

248 
fžl_äame_num_g­
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
ouut
);

249 
compu‹_cÞoÿ‹d
 (
Sliû
 *
cu¼Sliû
, 
StÜabËPiùu»
 **
li¡X
[6]);

250 
»Üd”_shÜt_‹rm
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cur_li¡
, 
picNumLX
, *
»fIdxLX
);

252 
unm¬k_fÜ_»ã»nû
(
F¿meStÜe
* 
fs
);

253 
unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
F¿meStÜe
* 
fs
);

254 
»move_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
pos
);

256 #ià(
MVC_EXTENSION_ENABLE
)

257 
check_num_»f
(
DecodedPiùu»Bufãr
 *
p_Dpb
);

258 
»¶aû_tÝ_´oc_pic_w™h_äame
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
);

259 
¡Üe_´oc_piùu»_š_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
);

	@lencod/inc/mc_prediction.h

18 #iâdeà
_MC_PREDICTION_H_


19 
	#_MC_PREDICTION_H_


	)

20 
	~"mbufãr.h
"

22 
luma_´ediùiÚ
 ( 
Maüoblock
* 
cu¼MB
, , , , , , [2], *, );

23 
luma_´ediùiÚ_bi
 ( 
Maüoblock
* 
cu¼MB
, , , , , , , , , );

24 
chroma_´ediùiÚ
 ( 
Maüoblock
* 
cu¼MB
, , , , , , , , , , , );

25 
chroma_´ediùiÚ_4x4
 ( 
Maüoblock
* 
cu¼MB
, , , , , , , , , );

27 
rdo_low_šŒa_chroma_decisiÚ
 (
Maüoblock
 *
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
[2], 
mb_avažabË_up_Ëá
);

28 
rdo_low_šŒa_chroma_decisiÚ_mbaff
 (
Maüoblock
 *
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
[2], 
mb_avažabË_up_Ëá
);

29 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
 (
Maüoblock
 *
cu¼MB
, 
img³l
* , , , 
MÙiÚVeùÜ
 ** , 
StÜabËPiùu»
 *
li¡X
, );

30 
OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
 (
Maüoblock
 *
cu¼MB
, 
img³l
* , , , 
MÙiÚVeùÜ
 ** , 
StÜabËPiùu»
 *
li¡X
, );

32 
šŒa_chroma_´ediùiÚ_mbaff
(
Maüoblock
 *
cu¼MB
, *, *, *);

33 
šŒa_chroma_´ediùiÚ
 (
Maüoblock
 *
cu¼MB
, *, *, *);

34 
IÁ¿ChromaP»diùiÚ4x4
 (
Maüoblock
* 
cu¼MB
, 
uv
, 
block_x
, 
block_y
);

35 
g‘_difã»nû_4x4
(
img³l
 **
¤c
, img³È**
´d
, *
diff
, 
pos_x
, 
block_x
);

	@lencod/inc/mc_prediction_otf.h

1 #iâdeà
_MC_PREDICTION_OTF_H_


2 
	#_MC_PREDICTION_OTF_H_


	)

4 
	~"glob®.h
"

6 
luma_´ediùiÚ_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

7 
block_x
,

8 
block_y
,

9 
block_size_x
,

10 
block_size_y
,

11 
p_dœ
,

12 
li¡_mode
[2],

13 *
»f_idx
,

14 
b»d_me


17 
luma_´ediùiÚ_bi_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

18 
block_x
,

19 
block_y
,

20 
block_size_x
,

21 
block_size_y
,

22 
l0_mode
,

23 
l1_mode
,

24 
l0_»f_idx
,

25 
l1_»f_idx
,

26 
li¡


29 
chroma_´ediùiÚ_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

30 
uv
,

31 
block_x
,

32 
block_y
,

33 
block_size_x
,

34 
block_size_y
,

35 
p_dœ
,

36 
l0_mode
,

37 
l1_mode
,

38 
l0_»f_idx
,

39 
l1_»f_idx
,

40 
b»d_me


	@lencod/inc/md_common.h

18 #iâdeà
_MD_COMMON_H_


19 
	#_MD_COMMON_H_


	)

20 
	~"mv_£¬ch.h
"

21 
	~"me_di¡ÜtiÚ.h
"

23 
S‘MÙiÚVeùÜsMBPSliû
 (
Maüoblock
* 
cu¼MB
);

24 
S‘MÙiÚVeùÜsMBBSliû
 (
Maüoblock
* 
cu¼MB
);

25 
S‘MÙiÚVeùÜsMBISliû
 (
Maüoblock
* 
cu¼MB
);

26 
cÝy_image_d©a
 (
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
, 
width
, 
height
);

27 
cÝy_image_d©a_16x16
 (
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
);

28 
cÝy_image_d©a_8x8
 (
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
);

29 
cÝy_image_d©a_4x4
 (
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
);

30 
Re£tRD8x8D©a
 (
VideoP¬am‘”s
 *
p_Vid
, 
RD_8x8DATA
 *
rd_d©a
);

31 
£t_chroma_´ed_mode
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 
’c_mb
, *
mb_avažabË
, 
chroma_´ed_mode_¿nge
[2]);

	@lencod/inc/md_distortion.h

17 #iâdeà
_MD_DISTORTION_H_


18 
	#_MD_DISTORTION_H_


	)

20 
	~"glob®.h
"

23 
£tupDi¡ÜtiÚ
 (
Sliû
 *
cu¼Sliû
);

24 
št64
 
compu‹_SSE
 (
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, 
ySize
, 
xSize
);

25 
di¡blk
 
compu‹_SSE_ü
 (
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, 
ySize
, 
xSize
);

26 
di¡blk
 
compu‹_SSE16x16
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
);

27 
di¡blk
 
compu‹_SSE8x8
 (
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
);

28 
di¡blk
 
compu‹_SSE4x4
 (
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
);

29 
di¡blk
 
compu‹_SSE16x16_th»s
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, di¡blk 
mš_co¡
);

	@lencod/inc/me_distortion.h

18 #iâdeà
_ME_DISTORTION_H_


19 
	#_ME_DISTORTION_H_


	)

21 
di¡blk
 
di¡ÜtiÚ4x4SAD
(* 
diff
, di¡blk 
mš_mco¡
);

22 
di¡blk
 
di¡ÜtiÚ4x4SSE
(* 
diff
, di¡blk 
mš_mco¡
);

23 
di¡blk
 
di¡ÜtiÚ4x4SATD
(* 
diff
, di¡blk 
mš_co¡
);

24 
di¡blk
 
di¡ÜtiÚ8x8SAD
(* 
diff
, di¡blk 
mš_mco¡
);

25 
di¡blk
 
di¡ÜtiÚ8x8SSE
(* 
diff
, di¡blk 
mš_mco¡
);

26 
di¡blk
 
di¡ÜtiÚ8x8SATD
(* 
diff
, di¡blk 
mš_co¡
);

28 
Hadam¬dSAD4x4
(* 
diff
);

29 
Hadam¬dSAD8x8
(* 
diff
);

31 
di¡blk
 
compu‹SAD
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

32 
di¡blk
 
compu‹SAD16x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

33 
di¡blk
 
compu‹SAD16x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

34 
di¡blk
 
compu‹SAD8x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

35 
di¡blk
 
compu‹SAD8x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

36 
di¡blk
 
compu‹SAD8x4
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

37 
di¡blk
 
compu‹SAD4x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

38 
di¡blk
 
compu‹SAD4x4
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

41 
di¡blk
 
compu‹SADWP
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

42 
di¡blk
 
compu‹SADWP16x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

43 
di¡blk
 
compu‹SADWP16x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

44 
di¡blk
 
compu‹SADWP8x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

45 
di¡blk
 
compu‹SADWP8x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

46 
di¡blk
 
compu‹SADWP8x4
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

47 
di¡blk
 
compu‹SADWP4x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

48 
di¡blk
 
compu‹SADWP4x4
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

51 
di¡blk
 
compu‹SATD
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

52 
di¡blk
 
compu‹SATDWP
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

53 
di¡blk
 
compu‹SAT8x8D16x16
(
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

54 
di¡blk
 
compu‹SAT4x4D16x16
(
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

55 
di¡blk
 
compu‹SAT8x8D16x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

56 
di¡blk
 
compu‹SAT4x4D16x8
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

57 
di¡blk
 
compu‹SAT8x8D8x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

58 
di¡blk
 
compu‹SAT4x4D8x16
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

59 
di¡blk
 
compu‹SAT8x8D
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

60 
di¡blk
 
compu‹SAT4x4D
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

63 
di¡blk
 
compu‹SSE
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

64 
di¡blk
 
compu‹SSEWP
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

67 
di¡blk
 
compu‹BiP»dSAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

68 
di¡blk
 
compu‹BiP»d16x16SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

69 
di¡blk
 
compu‹BiP»d16x8SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

70 
di¡blk
 
compu‹BiP»d8x16SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

71 
di¡blk
 
compu‹BiP»d8x8SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

72 
di¡blk
 
compu‹BiP»d8x4SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

73 
di¡blk
 
compu‹BiP»d4x8SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

74 
di¡blk
 
compu‹BiP»d4x4SAD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

75 
di¡blk
 
compu‹BiP»dSAD2
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

78 
di¡blk
 
compu‹BiP»dSATD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

79 
di¡blk
 
compu‹BiP»dSATD2
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

80 
di¡blk
 
compu‹BiP»d16x16SATD1
(
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

81 
di¡blk
 
compu‹BiP»d16x8SATD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

82 
di¡blk
 
compu‹BiP»d8x8SATD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

83 
di¡blk
 
compu‹BiP»d8x16SATD1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

86 
di¡blk
 
compu‹BiP»dSSE1
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

87 
di¡blk
 
compu‹BiP»dSSE2
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

89 
£Ëù_di¡ÜtiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

91 
ÿlcDifã»nû
(
img³l
 **
ÜigImg
, 
ox
, 
oy
, img³È**
´edImg
, 
px
, 
py
, 
width
, 
height
, *
diff
);

	@lencod/inc/me_distortion_otf.h

11 #iâdeà
_ME_DISTORTION_OTF_H_


12 
	#_ME_DISTORTION_OTF_H_


	)

15 
di¡blk
 
compu‹SAD_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

18 
di¡blk
 
compu‹SADWP_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

21 
di¡blk
 
compu‹SATD_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

22 
di¡blk
 
compu‹SATDWP_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

25 
di¡blk
 
compu‹SSE_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

26 
di¡blk
 
compu‹SSEWP_Ùf
 (
StÜabËPiùu»
 *
»f1
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *);

29 
di¡blk
 
compu‹BiP»dSAD1_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

30 
di¡blk
 
compu‹BiP»dSAD2_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

33 
di¡blk
 
compu‹BiP»dSATD1_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

34 
di¡blk
 
compu‹BiP»dSATD2_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

37 
di¡blk
 
compu‹BiP»dSSE1_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

38 
di¡blk
 
compu‹BiP»dSSE2_Ùf
 (
StÜabËPiùu»
 *
»f1
, StÜabËPiùu» *
»f2
, 
MEBlock
*, di¡blk, 
MÙiÚVeùÜ
 *, MotionVector *);

	@lencod/inc/me_epzs.h

19 #iâdeà
_ME_EPZS_H_


20 
	#_ME_EPZS_H_


	)

21 
	~"me_•zs_commÚ.h
"

23 cÚ¡ 
	gÃxt_¡¬t_pos
[5][5] =

32 cÚ¡ 
	gÃxt_’d_pos
[5][5] =

41 cÚ¡ 
MÙiÚVeùÜ
 
	g£¬ch_pošt_hp
[10] = {{0,0},{-2,0}, {0,2}, {2,0}, {0,-2}, {-2,2}, {2,2}, {2,-2}, {-2,-2}, {-2,2}};

42 cÚ¡ 
MÙiÚVeùÜ
 
	g£¬ch_pošt_qp
[10] = {{0,0},{-1,0}, {0,1}, {1,0}, {0,-1}, {-1,1}, {1,1}, {1,-1}, {-1,-1}, {-1,1}};

45 
di¡blk
 
EPZS_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

46 
di¡blk
 
EPZS_subMB_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

47 
di¡blk
 
EPZS_sub_³l_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, *);

48 
di¡blk
 
EPZS_sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MEBlock
 *, 
li¡
, 
MÙiÚVeùÜ
 *, MotionVector *, MotionVector *, MotionVector *, distblk, *);

49 
di¡blk
 
EPZS_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, , 
MÙiÚVeùÜ
 *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, 
MEBlock
 *, , distblk, );

	@lencod/inc/me_epzs_common.h

19 #iâdeà
_ME_EPZS_COMMON_H_


20 
	#_ME_EPZS_COMMON_H_


	)

25 
	mmb_ad­tive_äame_f›ld_æag
;

26 
	msize_x
, 
	msize_y
;

29 
MÙiÚVeùÜ
 ***
	mäame
;

31 
MÙiÚVeùÜ
 ***
	mtÝ
;

33 
MÙiÚVeùÜ
 ***
	mbÙ
;

34 } 
	tEPZSCÞocP¬ams
;

38 
MÙiÚVeùÜ
 
	mmÙiÚ
;

39 
	m¡¬t_nmbr
;

40 
	mÃxt_pošts
;

42 
	tSPošt
;

44 
	s•zs_¡ruù


46 
	m£¬chPošts
;

47 
SPošt
 *
	mpošt
;

48 
	m¡ÝS—rch
;

49 
	mÃxtLa¡
;

50 
•zs_¡ruù
 *
	mÃx©‹º
;

53 
•zs_¡ruù
 
	tEPZSSŒuùu»
;

57 
	mSDIAMOND
 = 0,

58 
	mSQUARE
 = 1,

59 
	mEDIAMOND
 = 2,

60 
	mLDIAMOND
 = 3,

61 
	mSBDIAMOND
 = 4

62 } 
	tEPZSP©‹ºs
;

64 
	s•zs_·¿ms
 {

65 
VideoP¬am‘”s
 *
	mp_Vid
;

66 
ušt16
 
	mBlkCouÁ
;

67 
	m£¬ch¬¿y
;

69 
di¡blk
 
	mmedth»s
[8];

70 
di¡blk
 
	mmaxth»s
[8];

71 
di¡blk
 
	mmšth»s
[8];

72 
di¡blk
 
	msubth»s
[8];

74 
	mmv_sÿË
 [6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES];

75 
	mmv_sÿË_upd©e
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES];

77 
ušt16
 **
	mEPZSM­
;

79 #ià
EPZSREF


80 
MÙiÚVeùÜ
 *****
	mp_mÙiÚ
;

82 
MÙiÚVeùÜ
 ****
	mp_mÙiÚ
;

84 
di¡blk
 ***
	mdi¡ÜtiÚ
;

85 
di¡blk
 ***
	mbi_di¡ÜtiÚ
;

86 
di¡blk
 ***
	mdi¡ÜtiÚ_h³l
;

89 
EPZSSŒuùu»
 *
	m£¬chP©‹º
;

90 
EPZSSŒuùu»
 *
	m£¬chP©‹ºD
;

91 
EPZSSŒuùu»
 *
	m´ediùÜ
;

93 
EPZSSŒuùu»
 *
	mwšdow_´ediùÜ
;

94 
EPZSSŒuùu»
 *
	mwšdow_´ediùÜ_ext
;

96 
EPZSCÞocP¬ams
 *
	mp_cÞoÿ‹d
;

97 } 
	tEPZSP¬am‘”s
;

100 
EPZSBlockTy³P»diùÜsMB
 (
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
SPošt
 *
pošt
, *
´ednum
);

101 
EPZS_¥©Ÿl_´ediùÜs
 (
EPZSP¬am‘”s
 *
p_EPZS
, 
MEBlock
 *
mv_block
, 
li¡
, 
li¡_off£t
, 
»f
, 
pic_mÙiÚ_·¿ms
 **
mv_šfo
);

102 
EPZS_‹mpÜ®_´ediùÜs
 (
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
»f_piùu»
, 
EPZSP¬am‘”s
 *
p_EPZS
, 
MEBlock
 *
mv_block
, *
´ednum
, 
di¡blk
 
¡ÝCr™”iÚ
, di¡blk 
mš_mco¡
);

103 
di¡blk
 
EPZSD‘”mšeStÝCr™”iÚ
(
EPZSP¬am‘”s
 *
p_EPZS
, di¡blk* 
´evSad
, 
MEBlock
 *
mv_block
 ,di¡blk 
Ïmbda_di¡
);

104 
EPZSBlockTy³P»diùÜs
 (
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
SPošt
 *
pošt
, *
´ednum
);

105 
EPZSWšdowP»diùÜs
 (
MÙiÚVeùÜ
 *
mv
, 
EPZSSŒuùu»
 *
´ediùÜ
, *
´ednum
, EPZSSŒuùu» *
wšdowP»d
);

106 
EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
EPZSP¬am‘”s
 *
p_EPZS
, 
MEBlock
 *
mv_block
, 
li¡
, *
´ednum
, 
img_width
);

107 
EPZS_h›¿rchiÿl_´ediùÜs
 (
EPZSP¬am‘”s
 * 
p_EPZS
, 
MEBlock
 * 
mv_block
, *
´ednum
, 
StÜabËPiùu»
 *
»f_piùu»
, 
Sliû
 *
cu¼Sliû
);

109 
EPZSD–‘e
 (
VideoP¬am‘”s
 *
p_Vid
);

110 
EPZSSŒuùD–‘e
 (
Sliû
 *
cu¼Sliû
);

111 
EPZSSliûIn™
 (
Sliû
 *
cu¼Sliû
);

112 
EPZSIn™
 (
VideoP¬am‘”s
 *
p_Vid
);

113 
EPZSSŒuùIn™
 (
Sliû
 *
cu¼Sliû
);

114 
EPZSOuutSts
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
FILE
 * 
¡©
, 
¡©s_fže
);

115 
EPZS_£tup_’gše
 (
Maüoblock
 *, 
IÅutP¬am‘”s
 *);

125 
šlše
 
	$add_´ediùÜ
(
MÙiÚVeùÜ
 *
cur_mv
, MÙiÚVeùÜ 
´d_mv
, 
mvSÿË
, 
shiá_mv
)

127 *
cur_mv
 = 
´d_mv
;

128 
cur_mv
->
mv_x
 = (è
	`rshiá_ºd_sf
((
mvSÿË
 * cur_mv->mv_x), 
shiá_mv
);

129 
cur_mv
->
mv_y
 = (è
	`rshiá_ºd_sf
((
mvSÿË
 * cur_mv->mv_y), 
shiá_mv
);

130  (*((*è
cur_mv
) != 0);

131 
	}
}

133 
šlše
 
	$sÿË_mv
(
MÙiÚVeùÜ
 *
out_mv
, 
sÿË
, cÚ¡ MÙiÚVeùÜ *
mv
, 
shiá_mv
)

135 
out_mv
->
mv_x
 = (è
	`rshiá_ºd_sf
((
sÿË
 * 
mv
->mv_x), 
shiá_mv
);

136 
out_mv
->
mv_y
 = (è
	`rshiá_ºd_sf
((
sÿË
 * 
mv
->mv_y), 
shiá_mv
);

137 
	}
}

139 
šlše
 
	$sÿË_mv_xy
(
MÙiÚVeùÜ
 *
out_mv
, *
sÿË
, cÚ¡ MÙiÚVeùÜ *
mv
, 
shiá_mv
)

141 
out_mv
->
mv_x
 = (è
	`rshiá_ºd_sf
((
sÿË
[0] * 
mv
->mv_x), 
shiá_mv
);

142 
out_mv
->
mv_y
 = (è
	`rshiá_ºd_sf
((
sÿË
[1] * 
mv
->mv_y), 
shiá_mv
);

143 
	}
}

145 
šlše
 
	$compu‹_sÿËd
(
MÙiÚVeùÜ
 *
MÙiÚVeùÜ0
, MÙiÚVeùÜ *
MÙiÚVeùÜ1
, 
‹mpmv_sÿË
[2], cÚ¡ MÙiÚVeùÜ *
mv
, 
švmv_´ecisiÚ
)

147 
MÙiÚVeùÜ0
->
mv_x
 = (è
	`iCl3
 (-32768, 32767, 
	`rshiá_ºd_sf
((
‹mpmv_sÿË
[
LIST_0
] * 
mv
->mv_x), 
švmv_´ecisiÚ
));

148 
MÙiÚVeùÜ0
->
mv_y
 = (è
	`iCl3
 (-32768, 32767, 
	`rshiá_ºd_sf
((
‹mpmv_sÿË
[
LIST_0
] * 
mv
->mv_y), 
švmv_´ecisiÚ
));

149 
MÙiÚVeùÜ1
->
mv_x
 = (è
	`iCl3
 (-32768, 32767, 
	`rshiá_ºd_sf
((
‹mpmv_sÿË
[
LIST_1
] * 
mv
->mv_x), 
švmv_´ecisiÚ
));

150 
MÙiÚVeùÜ1
->
mv_y
 = (è
	`iCl3
 (-32768, 32767, 
	`rshiá_ºd_sf
((
‹mpmv_sÿË
[
LIST_1
] * 
mv
->mv_y), 
švmv_´ecisiÚ
));

151 
	}
}

	@lencod/inc/me_epzs_int.h

19 #iâdeà
_ME_EPZS_INT_H_


20 
	#_ME_EPZS_INT_H_


	)

22 
	~"me_•zs.h
"

25 
di¡blk
 
EPZS_š‹g”_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

26 
di¡blk
 
EPZS_š‹g”_subMB_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

27 
di¡blk
 
EPZS_š‹g”_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, , 
MÙiÚVeùÜ
 *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, 
MEBlock
 *, , distblk, );

	@lencod/inc/me_fullfast.h

19 #iâdeà
_ME_FULLFAST_H_


20 
	#_ME_FULLFAST_H_


	)

21 
	sme_fuÎ_ç¡


23 **
	m£¬ch_£tup_dÚe
;

24 
MÙiÚVeùÜ
 **
	m£¬ch_ûÁ”
;

25 
MÙiÚVeùÜ
 **
	m£¬ch_ûÁ”_·dded
;

26 **
	mpos_00
;

27 
di¡³l
 *****
	mBlockSAD
;

28 **
	mmax_£¬ch_¿nge
;

29 } 
	tMEFuÎFa¡
;

31 
di¡blk
 
ç¡_fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
 ( 
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

32 
š™Ÿlize_ç¡_fuÎ_£¬ch
 ( 
VideoP¬am‘”s
 *, 
IÅutP¬am‘”s
 * );

33 
»£t_ç¡_fuÎ_£¬ch
 ( 
VideoP¬am‘”s
 * );

34 
þ—r_ç¡_fuÎ_£¬ch
 ( 
VideoP¬am‘”s
 * );

35 
£tup_ç¡_fuÎ_£¬ch
 ( 
Maüoblock
 *, 
MEBlock
 *, );

36 
upd©e_fuÎ_£¬ch_Ïrge_blocks
 ( 
MEFuÎFa¡
 *, , , );

	@lencod/inc/me_fullfast_otf.h

12 #iâdeà
_ME_FULLFAST_OTF_H_


13 
	#_ME_FULLFAST_OTF_H_


	)

15 
S‘upFa¡FuÎP–S—rch_Ùf
 (
Maüoblock
 *, 
MEBlock
 *, ) ;

	@lencod/inc/me_fullsearch.h

19 #iâdeà
_ME_FULLSEARCH_H_


20 
	#_ME_FULLSEARCH_H_


	)

21 
di¡blk
 
fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, );

22 
di¡blk
 
fuÎ_£¬ch_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, , 
MÙiÚVeùÜ
 *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, 
MEBlock
 *, , distblk, );

23 
di¡blk
 
sub_³l_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, *);

24 
di¡blk
 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MEBlock
 *, , 
MÙiÚVeùÜ
 *, MotionVector *, MotionVector *, MotionVector *, distblk, *);

25 
di¡blk
 
fuÎ_sub_³l_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MÙiÚVeùÜ
 *, 
MEBlock
 *, distblk, *);

26 
di¡blk
 
fuÎ_sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *, 
MEBlock
 *, , 
MÙiÚVeùÜ
 *, MotionVector *, MotionVector *, MotionVector *, distblk, *);

	@lencod/inc/me_hme.h

19 #iâdeà
_ME_HME_H_


20 
	#_ME_HME_H_


	)

21 
	~"defšes.h
"

25 
	mMECOST_CALC_RDNORM
 = 0,

26 
	mMECOST_CALC_RDN_PLUS_MVN
,

27 
	mMECOST_CALC_RDN_PLUS_MVN_FAST
,

28 
	mMECOST_CALC_RDN_PLUS_NP
,

29 
	mMECOST_CALC_RDN_PLUS_NP_FAST
,

30 } 
	tHMEMECo¡C®cM‘hod
;

32 
	shmeBlockInfo


34 
	m¶i¡
;

35 
	m»f
[2];

36 
MÙiÚVeùÜ
 
	mmv
[2];

39 
	mdi¡
;

40 
	m§d
;

41 } 
	tHmeBlockInfo_t
;

43 
	shme_šfo


45 
	miImageHeight
;

46 
	miImageWidth
;

47 
	miPy¿midLev–s
;

48 
	mHMEBlockSizeIdx
;

49 
	mcurLev–
;

50 
	miMaxRefNum
;

51 
	miMVCo¡Mtd
;

54 
	mimgty³
;

55 
img³l
 ***
	mp_Üig_img_poš‹r
;

56 
img³l
 ***
	mp_Üig_img_poš‹r_Ïy”s
[2];

59 
¡ÜabË_piùu»
 *
	mpTmpEncPic
;

60 
Sliû
* 
	mpTmpSliû
;

61 
S—rchWšdow
 *
	mp_HMESW
;

62 
S—rchWšdow
 *
	mp_HMESWMš
;

64 
MÙiÚVeùÜ
 *****
	mp_hme_mv
;

65 
di¡blk
 *****
	mp_hme_mco¡
;

66 
di¡blk
 *****
	mp_hme_mdi¡
;

68 
št64
 ***
	mhme_di¡ÜtiÚ
;

69 
št64
 ***
	mpoc
;

70 
št64
 
	mhme_tÙ_time
;

71 
št64
 
	mhme_time
;

74 
	mdi¡mš
;

75 
	mdi¡max
;

76 
	mdi¡m—n
;

77 
	mdi¡v¬
;

79 
	mMBLev–T¿nsfÜmS–eùiÚ
;

81 
	mS—rchMode
;

82 
	mT¿nsfÜm8x8Mode
;

83 
	miMaxBlkDi¡
;

87 
	m»fše_hme
;

88 
	mweigh‹d_b»d_idc_§ve
;

91 ***
	mhme_blk_good_¡Üe
;

92 ***
	mhme_blk_weight_¡Üe
, ***
	mhme_blk_off£t_¡Üe
;

93 ***
	mhme_blk_»s_DC_¡Üe
;

94 ***
	mhme_blk_£g_¡Üe
;

95 
	mhme_blk_good_út
[2];

96 
	mhme_blk_£g_út
[2][3];

97 
	mhme_blk_tÙ_út
;

98 
wp_»Üd”_ty³
 **
	mpWPReÜd”Ty³
;

99 ***
	m»f_idx_m­
;

100 ***
	mdup_»f_æag
;

101 ***
	mwp_»f_li¡
;

102 **
	mmo¡_u£d_»f
;

103 *
	m³rfÜm_»Üd”_·ss
;

105 
	mhme_»f_pic_»mov®_æag
[2][
MAX_REFERENCE_PICTURES
];

106 
	mhme_»f_pic_»mov®_út
[2];

109 
di¡blk
 (*
pf_compu‹SAD8x8_hme
)(
StÜabËPiùu»
 *
	m»f1
,

110 
MEBlock
 *
	mmv_block
,

111 
di¡blk
 
	mmš_mco¡
,

112 
MÙiÚVeùÜ
 *
	mÿnd


114 
di¡blk
 (*
pf_compu‹SAD16x16_hme
)(
StÜabËPiùu»
 *
	m»f1
,

115 
MEBlock
 *
	mmv_block
,

116 
di¡blk
 
	mmš_mco¡
,

117 
MÙiÚVeùÜ
 *
	mÿnd


119 
di¡blk
 (*
pf_compu‹SADWP8x8_hme
)(
StÜabËPiùu»
 *
	m»f1
,

120 
MEBlock
 *
	mmv_block
,

121 
di¡blk
 
	mmš_mco¡
,

122 
MÙiÚVeùÜ
 *
	mÿnd


124 
di¡blk
 (*
pf_compu‹SADWP16x16_hme
)(
StÜabËPiùu»
 *
	m»f1
,

125 
MEBlock
 *
	mmv_block
,

126 
di¡blk
 
	mmš_mco¡
,

127 
MÙiÚVeùÜ
 *
	mÿnd


129 
di¡blk
 (*
pf_compu‹SAD_hme
)(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

130 
di¡blk
 (*
pf_compu‹BiP»dSAD_hme
)(
StÜabËPiùu»
 *
	m»f1
,

131 
StÜabËPiùu»
 *
	m»f2
,

132 
MEBlock
 *
	mmv_block
,

133 
di¡blk
 
	mmš_mco¡
,

134 
MÙiÚVeùÜ
 *
	mÿnd1
,

135 
MÙiÚVeùÜ
 *
	mÿnd2
);

136 
di¡blk
 (*
pf_compu‹SADWP_hme
)(
StÜabËPiùu»
 *
	m»f1
, 
	mMEBlock
*, 
	mdi¡blk
, 
	mMÙiÚVeùÜ
 *);

137 
di¡blk
 (*
pf_compu‹BiP»dSADWP_hme
)(
StÜabËPiùu»
 *
	m»f1
,

138 
StÜabËPiùu»
 *
	m»f2
,

139 
MEBlock
 *
	mmv_block
,

140 
di¡blk
 
	mmš_mco¡
,

141 
MÙiÚVeùÜ
 *
	mÿnd1
,

142 
MÙiÚVeùÜ
 *
	mÿnd2
);

144 } 
	tHMEInfo_t
;

146 
švoke_HME
 (
VideoP¬am‘”s
 *
p_Vid
, 
pic_idx
);

147 
In™HMEInfo
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

148 
F»eHMEInfo
 (
VideoP¬am‘”s
 *
p_Vid
);

149 
S‘MELambda
(
VideoP¬am‘”s
 *
p_Vid
, *
Ïmbda_mf
);

150 
HMEIn™F¿me
 (
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
);

151 
HMEResizeS—rchRªge
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
);

152 
HMEStÜeInfo
 (
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
);

153 
HMERe¡ÜeInfo
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
);

154 
HMES—rch
 (
Sliû
 *
cu¼Sliû
);

155 
HMELev–MÙiÚS—rch
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
);

156 
hme_g‘_ÃighbÜs
(
Pix–Pos
 *
pBlkPos
, 
bx
, 
by
, 
iMaxBlkX
);

157 
hme_g‘_ÃighbÜs2
(
Pix–Pos
 *
pBlkPos
, 
bx
, 
by
, 
iMaxBlkX
, 
iMaxBlkY
);

158 
»duû_»f_pic_w™h_hme_šfo
(
Sliû
 *
cu¼Sliû
, 
HMEInfo_t
 *
pHMEInfo
, *
Ïmbda_çùÜ
);

161 
AÎocHMEMemÜy
 (
img³l
 ****
pHmeImage
, 
VideoP¬am‘”s
 *
p_Vid
, 
size_y
, 
size_x
, 
off£t_y
, 
off£t_x
, 
iS¹Lev–
);

162 
F»eHMEMemÜy
 (
img³l
 ****
pHmeImage
, 
VideoP¬am‘”s
 *
p_Vid
, 
iS¹Lev–
, 
iPadY
, 
iPadX
);

164 
AÎoÿ‹HMEMVInfo
 (
MÙiÚVeùÜ
 ******
p_hme_mv
, 
VideoP¬am‘”s
 *
p_Vid
);

165 
AÎoÿ‹HMEMECo¡
 (
di¡blk
 ******
p_hme_mco¡
, 
VideoP¬am‘”s
 *
p_Vid
);

166 
F»eHMEMVInfo
 (
MÙiÚVeùÜ
 ******
p_hme_mv
, 
VideoP¬am‘”s
 *
p_Vid
);

167 
F»eHMEMECo¡
 (
di¡blk
 ******
p_hme_mco¡
, 
VideoP¬am‘”s
 *
p_Vid
);

168 
AÎoÿ‹HMEMEDi¡
 (
di¡blk
 ******
p_hme_mdi¡
, 
VideoP¬am‘”s
 *
p_Vid
);

169 
F»eHMEMEDi¡
 (
di¡blk
 ******
p_hme_mdi¡
, 
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/me_umhex.h

23 #iâdeà
_ME_UMHEX_H_


24 
	#_ME_UMHEX_H_


	)

26 
	~"mbufãr.h
"

28 
	sumhex_¡ruù
 {

29 
	mAÍhaFou¹h_1
[8];

30 
	mAÍhaFou¹h_2
[8];

32 
	m´ed_MV_»f_æag
;

33 
	mBlockTy³_LUT
[4][4];

34 
di¡blk
 
	mMedŸn_P»d_Thd_MB
[8];

35 
di¡blk
 
	mBig_HexagÚ_Thd_MB
[8];

36 
di¡blk
 
	mMuÉi_Ref_Thd_MB
[8];

37 
di¡blk
 
	mTh»shÞd_DSR_MB
[8];

38 
by‹
 **
	mMco¡S‹
;

39 
by‹
 **
	mS—rchS‹
;

40 
di¡blk
 ****
	mç¡me_»f_co¡
;

41 
di¡blk
 ***
	mç¡me_l0_co¡
;

42 
di¡blk
 ***
	mç¡me_l1_co¡
;

43 
di¡blk
 **
	mç¡me_be¡_co¡
;

44 
di¡blk
 ***
	mç¡me_l0_co¡_b»d
;

45 
di¡blk
 ***
	mç¡me_l1_co¡_b»d
;

46 
di¡blk
 
	m´ed_SAD
;

47 
di¡blk
 
	mSAD_a
,
	mSAD_b
,
	mSAD_c
,
	mSAD_d
;

48 
	mb»d_æag
;

49 
	m´ed_MV_»f
[2], 
	m´ed_MV_u¶ay”
[2];

51 
	mUMHEX_blockty³
;

52 
	m´ediù_pošt
[5][2];

54 
	mBsize
[8];

56 
by‹
 *
	mæag_šŒa
;

57 
	mæag_šŒa_SAD
;

60 
umhex_¡ruù
 
	tUMHexSŒuù
;

62 
	#EARLY_TERMINATION
 \

	)

63 ià((
	gmš_mco¡
 - 
	gp_UMHex
->
	g´ed_SAD
)<p_UMHex->
´ed_SAD
 * 
	gb‘aFou¹h_2
) \

64 
	gfou¹h_2_¡•
; \

65 if((
	gmš_mco¡
 - 
	gp_UMHex
->
	g´ed_SAD
è<…_UMHex->
´ed_SAD
 * 
	gb‘aFou¹h_1
) \

66 
	gfou¹h_1_¡•
;

68 
	#SEARCH_ONE_PIXEL
 \

	)

69 if((
Ÿbs
(
ÿnd
.
mv_x
 - 
ûÁ”
.mv_x)>>2è< 
	g£¬ch_¿nge
 && (Ÿbs(ÿnd.
mv_y
 - center.mv_y)>>2)< search_range)\

71 if(!
	gp_UMHex
->
	gMco¡S‹
[((
ÿnd
.
mv_y
 - 
ûÁ”
.mv_yè>> 2)+ 
£¬ch_¿nge
][((ÿnd.
mv_x
-center.mv_x)>>2)+search_range]) \

73 
	gmco¡
 = 
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
); \

74 if(
	gmco¡
<
	gmš_mco¡
) \

76 
	gmco¡
 +ð
mv_block
->
compu‹P»dFP–
(
»f_piùu»
, mv_block, \

77 
mš_mco¡
 - 
mco¡
, &
ÿnd
); \

78 
	gp_UMHex
->
	gMco¡S‹
[((
ÿnd
.
mv_y
 - 
ûÁ”
.mv_yè>> 2è+ 
£¬ch_¿nge
][((ÿnd.
mv_x
 - center.mv_x) >> 2) + search_range] = 1; \

79 ià(
	gmco¡
 < 
	gmš_mco¡
) \

81 
	gbe¡
 = 
ÿnd
; \

82 
	gmš_mco¡
 = 
mco¡
; \

88 
	#SEARCH_ONE_PIXEL_BIPRED
 \

	)

89 if((
Ÿbs
(
ÿnd
.
mv_x
 - 
ûÁ”2
.mv_xè>> 2è< 
	g£¬ch_¿nge
 && (Ÿbs(ÿnd.
mv_y
 - center2.mv_y) >> 2) < search_range) \

91 if(!
	gp_UMHex
->
	gMco¡S‹
[((
ÿnd
.
mv_y
 - 
ûÁ”2
.mv_yè>> 2è+ 
£¬ch_¿nge
][((ÿnd.
mv_x
-center2.mv_x) >> 2)+search_range]) \

93 
	gmco¡
 = 
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ûÁ”1
, &
´ed1
); \

94 
	gmco¡
 +ð
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed2
); \

95 if(
	gmco¡
<
	gmš_mco¡
) \

97 
	gmco¡
 +ð
mv_block
->
compu‹BiP»dFP–
(
»f_piùu»1
, 
»f_piùu»2
, \

98 
mv_block
, 
mš_mco¡
 - 
mco¡
, &
ûÁ”1
, &
ÿnd
); \

99 
	gp_UMHex
->
	gMco¡S‹
[((
ÿnd
.
mv_y
 - 
ûÁ”2
.mv_yè>> 2è+ 
£¬ch_¿nge
][((ÿnd.
mv_x
 - center2.mv_x) >> 2) + search_range] = 1; \

100 ià(
	gmco¡
 < 
	gmš_mco¡
) \

102 
	gbe¡
 = 
ÿnd
; \

103 
	gmš_mco¡
 = 
mco¡
; \

110 
UMHEX_DefšeTh»shÞd
 (
VideoP¬am‘”s
 *
p_Vid
);

111 
UMHEX_DefšeTh»shÞdMB
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

112 
UMHEX_g‘_mem
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

113 
UMHEX_ä“_mem
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

115 
UMHEX_decide_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
);

116 
UMHEX_sk_šŒabk_SAD
 (
Maüoblock
 *
cu¼MB
, 
»f_max
);

117 
UMHEX_£tup
 (
Maüoblock
 *
cu¼MB
, 
»f
, 
li¡
, 
block_y
, 
block_x
, 
blockty³
, 
MÙiÚVeùÜ
 *****
®l_mv
);

119 
di¡blk


120 
UMHEXIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

121 
MÙiÚVeùÜ
 *
´ed
,

122 
MEBlock
 *
mv_block
,

123 
di¡blk
 
mš_mco¡
,

124 
Ïmbda_çùÜ


126 
di¡blk
 
UMHEXSubP–BlockME
 (

127 
Maüoblock
 *
cu¼MB
,

128 
MÙiÚVeùÜ
 *
´ed
,

129 
MEBlock
 *
mv_block
,

130 
di¡blk
 
mš_mco¡
,

131 * 
Ïmbda


133 
di¡blk
 
UMHEXSubP–BlockMÙiÚS—rch
 (

134 
Maüoblock
 *
cu¼MB
,

135 
MÙiÚVeùÜ
 *
´ed_mv
,

136 
MEBlock
 *
mv_block
,

137 
di¡blk
 
mš_mco¡
,

138 
Ïmbda_çùÜ


140 
di¡blk
 
UMHEXB»dIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *, ,

141 
MÙiÚVeùÜ
 *, MotionVector *, MotionVector *, MotionVector *,

142 
MEBlock
 *, , 
di¡blk
, );

144 
UMHEXS‘MÙiÚVeùÜP»diùÜ
 (
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 *
pmv
, 
pic_mÙiÚ_·¿ms
 **
mv_šfo
,

145 
»f_äame
, 
li¡
, 
mb_x
, 
mb_y
, 
bl_x
, 
bl_y
, 
MEBlock
 *
mv_block
);

	@lencod/inc/me_umhexsmp.h

26 #iâdeà
_ME_UMHEXSMP_H_


27 
	#_ME_UMHEXSMP_H_


	)

29 
	~"mbufãr.h
"

31 
	sumhex_smp_¡ruù
 {

32 
di¡blk
 
	mSymm‘riÿlCrossS—rchTh»shÞd1
;

33 
di¡blk
 
	mSymm‘riÿlCrossS—rchTh»shÞd2
;

34 
di¡blk
 
	mCÚv”geTh»shÞd
;

35 
di¡blk
 
	mSubP–Th»shÞd1
;

36 
di¡blk
 
	mSubP–Th»shÞd3
;

37 
by‹
 **
	mS—rchS‹
;

38 
di¡blk
 ***
	ml0_co¡
;

39 
di¡blk
 ***
	ml1_co¡
;

40 
di¡blk
 
	m´ed_SAD_u¶ay”
;

41 
by‹
 *
	mæag_šŒa
;

42 
	mæag_šŒa_SAD
;

44 
	m´ed_MV_u¶ay”_X
;

45 
	m´ed_MV_u¶ay”_Y
;

48 
umhex_smp_¡ruù
 
	tUMHexSMPSŒuù
;

50 
smpUMHEX_š™
 (
VideoP¬am‘”s
 *
p_Vid
);

51 
smpUMHEX_g‘_mem
 (
VideoP¬am‘”s
 *
p_Vid
);

52 
smpUMHEX_ä“_mem
 (
VideoP¬am‘”s
 *
p_Vid
);

53 
smpUMHEX_decide_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
);

54 
smpUMHEX_sk_šŒabk_SAD
 (
Maüoblock
 *
cu¼MB
);

55 
smpUMHEX_£tup
 (
Maüoblock
 *
cu¼MB
, , , , , , 
MÙiÚVeùÜ
 *****);

56 
di¡blk
 
smpUMHEXB»dIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *, , 
MÙiÚVeùÜ
 *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, MÙiÚVeùÜ *, 
MEBlock
 *, , distblk, );

57 
di¡blk
 
smpUMHEXIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 *
´ed_mv
, 
MEBlock
 *
mv_block
, di¡blk 
mš_mco¡
, 
Ïmbda_çùÜ
);

58 
di¡blk
 
smpUMHEXSubP–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 *
´ed_mv
, 
MEBlock
 *
mv_block
, di¡blk 
mš_mco¡
, 
Ïmbda_çùÜ
);

59 
di¡blk
 
smpUMHEXFuÎSubP–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 *
´ed_mv
, 
MEBlock
 *
mv_block
, di¡blk 
mš_mco¡
, 
Ïmbda_çùÜ
);

60 
di¡blk
 
smpUMHEXSubP–BlockME
 (
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 *
´ed_mv
, 
MEBlock
 *
mv_block
, di¡blk 
mš_mco¡
, *
Ïmbda
);

	@lencod/inc/mmco.h

15 #iâdeà
_MMCO_H_


16 
	#_MMCO_H_


	)

18 
mmco_lÚg_‹rm
(
VideoP¬am‘”s
 *
p_Vid
, 
cu¼’t_pic_num
);

19 
poc_ba£d_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
);

20 #ià
CRA


21 
üa_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
);

23 #ià
HM50_LIKE_MMCO


24 
hm50_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
);

26 #ià
LD_REF_SETTING


27 
low_d–ay_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
);

29 
poc_ba£d_»f_mªagem’t_f›ld_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
);

30 
Žyr_ba£d_»f_mªagem’t_äame_pic
(
VideoP¬am‘”s
 *
p_Vid
, 
cu¼’t_pic_num
);

	@lencod/inc/mode_decision.h

18 #iâdeà
_MODE_DECISION_H_


19 
	#_MODE_DECISION_H_


	)

22 cÚ¡ 
	gb8_mode_bË
[6] = {0, 4, 5, 6, 7};

23 cÚ¡ 
	gmb_mode_bË
[10] = {0, 1, 2, 3, 
P8x8
, 
I16MB
, 
I4MB
, 
I8MB
, 
IPCM
, 
SI4MB
};

24 cÚ¡ 
	gmb_mode_bË_upd©ed
[10] = {
P8x8
, 3, 2, 1, 0, 
I16MB
, 
I4MB
, 
I8MB
, 
IPCM
, 
SI4MB
};

25 
di¡blk
 
BIDP¬t™iÚCo¡
 (
Maüoblock
 *
cu¼MB
, , , [2], );

26 
di¡blk
 
BP»dP¬t™iÚCo¡
 (
Maüoblock
 *
cu¼MB
, , , , , , );

27 
StÜeMV8x8
 (
Sliû
 *
cu¼Sliû
, 
dœ
);

28 
Re¡ÜeMV8x8
 (
Sliû
 *
cu¼Sliû
, 
dœ
);

29 
¡Üe_maüoblock_·¿m‘”s
 (
Maüoblock
 *
cu¼MB
, );

30 
StÜeNewMÙiÚVeùÜsBlock8x8
 (
Sliû
 *
cu¼Sliû
, , , 
Info8x8
 *);

31 
assign_’c_piùu»_·¿ms
 (
Maüoblock
 *
cu¼MB
, 
mode
, 
Info8x8
 *
be¡
, 
block
);

32 
£t_subblock8x8_šfo
 (
Block8x8Info
*, , , 
RD_8x8DATA
*);

33 
£t_block8x8_šfo
 (
Block8x8Info
*, , , 
Info8x8
 *
be¡
);

34 
upd©e_»äesh_m­
 (
Maüoblock
 *
cu¼MB
, 
šŒa
, 
šŒa1
);

35 
g‘_b»d_co¡
 (
Maüoblock
 *
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, 
Info8x8
 *
be¡
, 
RD_PARAMS
 *
’c_mb
, 
di¡blk
 
bmco¡
[5]);

36 
I16Off£t
 (, );

37 
CheckR–Ÿbž™yOfRef
 (
Maüoblock
 *
cu¼MB
, 
block
, 
li¡_idx
, 
»f
, 
mode
);

38 
RDCo¡_fÜ_maüoblocks
 (
Maüoblock
 *
cu¼MB
, , );

39 
mode_decisiÚ_fÜ_I4x4_MB
 (
Maüoblock
 *
cu¼MB
, , 
di¡blk
*);

40 
di¡blk
 
rdco¡_fÜ_8x8blocks
 (
Maüoblock
 *
cu¼MB
, 
RD_8x8DATA
 *
d©aTr
, *, 
št64
*, , , , 
Info8x8
 *, distblk);

42 
rc_¡Üe_diff
 (
diff
[16][16], 
img³l
 **
p_curImg
, 
ýix_x
,img³È**
´ediùiÚ
);

44 
š™_’c_mb_·¿ms
 (
Maüoblock
* 
cu¼MB
, 
RD_PARAMS
 *
’c_mb
, 
šŒa
);

45 
li¡_´ediùiÚ_co¡
 (
Maüoblock
 *
cu¼MB
, 
li¡
, 
block
, 
mode
, 
RD_PARAMS
 *
’c_mb
, 
di¡blk
 
bmco¡
[5], 
be¡_»f
[2]);

46 
d‘”mše_´ediùiÚ_li¡
 (
di¡blk
 [5], 
Info8x8
 *, distblk *);

47 
compu‹_mode_RD_co¡
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *
’c_mb
, 
mode
, *
š‹r_sk
);

49 
ŒªsfÜm_‹rmš©iÚ_cÚŒÞ
 (
Maüoblock
* 
cu¼MB
, 
mode
);

50 
b¦iû_16x16_‹rmš©iÚ_cÚŒÞ
(
IÅutP¬am‘”s
 *
p_IÅ
, 
Block8x8Info
 *
b8x8šfo
, *
ùr16x16
, 
mode
, 
b¦iû
);

52 
di¡blk
 
di¡blkmš¬¿y
 ( di¡blk 
¬r
[], 
size
, *
mššd
 );

53 
imš¬¿y
 ( 
¬r
[], 
size
, *
mššd
 );

55 
upd©e_Ïmbda_co¡s
(
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *
’c_mb
, 
Ïmbda_mf
[3]);

57 
g‘_š™Ÿl_mb16x16_co¡
(
Maüoblock
 *
cu¼MB
);

58 
adju¡_mb16x16_co¡
 (
Maüoblock
 *
cu¼MB
, 
di¡blk
 
co¡
);

59 
»£t_ad­tive_roundšg
(
VideoP¬am‘”s
 *
p_Vid
);

61 
di¡blk
 
di¡ÜtiÚSSE
 ( 
Maüoblock
 *
cu¼MB
 );

	@lencod/inc/mode_decision_p8x8.h

18 #iâdeà
_MODE_DECISION_P8x8_H_


19 
	#_MODE_DECISION_P8x8_H_


	)

22 
submaüoblock_mode_decisiÚ_p_¦iû
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *, 
RD_8x8DATA
 *, ****, , 
di¡blk
 *);

23 
submaüoblock_mode_decisiÚ_b_¦iû
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *, 
RD_8x8DATA
 *, ****, , 
di¡blk
 *);

24 
submaüoblock_mode_decisiÚ_low
(
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *, 
RD_8x8DATA
 *, ****, *, , 
di¡blk
 *, distblk *, distblk *, );

25 
cÝy_·¹_šfo
(
Info8x8
 *
b8x8
, Info8x8 *
·¹
);

	@lencod/inc/mv_search.h

16 #iâdeà
_MV_SEARCH_H_


17 
	#_MV_SEARCH_H_


	)

20 
	#di¡_sÿË_f
(
x
è(
mš_mco¡
)

	)

22 
	#di¡_sÿË_f
(
x
è
	`di¡_sÿË
(x)

	)

26 
g‘_ÃighbÜs
(
Maüoblock
 *
cu¼MB
, 
Pix–Pos
 *
block
, 
mb_x
, 
mb_y
, 
blocksh­e_x
);

27 
£t_acûss_m‘hod
(*
acûss_m‘hod
, 
MÙiÚVeùÜ
 *
blk
, 
mš_x
, 
mš_y
, 
max_x
, 
max_y
);

29 
P»·»MEP¬ams
 (
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
ChromaMEEÇbË
, 
li¡
, 
»f
);

30 
P»·»BiP»dMEP¬ams
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
ChromaMEEÇbË
, 
li¡
, 
li¡_off£t
, 
»f
);

32 
š™_mÙiÚ_£¬ch_moduË
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

33 
þ—r_mÙiÚ_£¬ch_moduË
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

35 
P¬t™iÚMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, , , *);

36 
SubP¬t™iÚMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, , , *);

38 
G‘_Dœeù_MV_S·tŸl_MBAFF
 (
Maüoblock
 *
cu¼MB
);

39 
G‘_Dœeù_MV_S·tŸl_NÜm®
 (
Maüoblock
 *
cu¼MB
);

40 
G‘_Dœeù_MV_TempÜ®
 (
Maüoblock
 *
cu¼MB
);

42 
FšdSkModeMÙiÚVeùÜ
 (
Maüoblock
 *
cu¼MB
);

44 
š™_ME_’gše
 (
Maüoblock
 *
cu¼MB
);

45 
di¡blk
 
BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, ,, *);

46 
š™_mv_block
 (
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
blockty³
, 
li¡
, 
»f_idx
, 
mb_x
, 
mb_y
);

47 
g‘_Üigš®_block
(
VideoP¬am‘”s
 *
p_Vid
, 
MEBlock
 *
mv_block
);

48 
ä“_mv_block
 (
MEBlock
 *
mv_block
);

49 
upd©e_mv_block
 (
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
h
, 
v
);

50 
g‘_£¬ch_¿nge
(
MEBlock
 *
mv_block
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
»f
, 
blockty³
);

52 
šlše
 
	$add_mvs
(
MÙiÚVeùÜ
 *
mv0
, cÚ¡ MÙiÚVeùÜ *
mv1
)

54 
mv0
->
mv_x
 = (è(mv0->mv_x + 
mv1
->mv_x);

55 
mv0
->
mv_y
 = (è(mv0->mv_y + 
mv1
->mv_y);

56 
	}
}

58 
šlše
 
MÙiÚVeùÜ
 
	$add_MVs
(
MÙiÚVeùÜ
 
mv0
, cÚ¡ MÙiÚVeùÜ *
mv1
)

60 
mv0
.
mv_x
 = (è(mv0.mv_x + 
mv1
->mv_x);

61 
mv0
.
mv_y
 = (è(mv0.mv_y + 
mv1
->mv_y);

63  (
mv0
);

64 
	}
}

66 
šlše
 
MÙiÚVeùÜ
 
	$·d_MVs
(
MÙiÚVeùÜ
 
mv0
, 
MEBlock
 *
mv_block
)

68 
mv0
.
mv_x
 = (è(mv0.mv_x + 
mv_block
->
pos_x_·dded
);

69 
mv0
.
mv_y
 = (è(mv0.mv_y + 
mv_block
->
pos_y_·dded
);

71  (
mv0
);

72 
	}
}

74 
šlše
 
št64
 
	$ov”æow_weight_co¡
(
Ïmbda
, 
b™s
)

76 #ià
JCOST_CALC_SCALEUP


77  ( ((
št64
)
Ïmbda
è* ((št64)(
b™s
)) );

79 #ià(
USE_RND_COST
)

80  (
	`i64_rshiá_ºd_sf
(((
št64
)
Ïmbda
è* ((št64)(
b™s
)è, 
LAMBDA_ACCURACY_BITS
));

82  (((
št64
)
Ïmbda
è* ((št64)(
b™s
)è>> 
LAMBDA_ACCURACY_BITS
);

85 
	}
}

87 
šlše
 
di¡blk
 
	$weight_co¡
(
Ïmbda
, 
b™s
)

89 #ià
JCOST_CALC_SCALEUP


90  ( ((
di¡blk
)
Ïmbda
è* ((di¡blk)(
b™s
)) );

92 #ià(
USE_RND_COST
)

93  (
	`rshiá_ºd_sf
((
Ïmbda
è* (
b™s
), 
LAMBDA_ACCURACY_BITS
));

95  (((
Ïmbda
è* (
b™s
)è>> 
LAMBDA_ACCURACY_BITS
);

98 
	}
}

100 
šlše
 
di¡blk
 
	$mv_co¡
(cÚ¡ 
VideoP¬am‘”s
 *
p_Vid
, 
Ïmbda
, cÚ¡ 
MÙiÚVeùÜ
 *
mv
, cÚ¡ MÙiÚVeùÜ *
pmv
)

102 #ià
JCOST_CALC_SCALEUP


103 *
mvb™s
 = 
p_Vid
->mvbits;

104  ( ((
di¡blk
)
Ïmbda
è*((di¡blk)(
mvb™s
[
mv
->
mv_x
 - 
pmv
->mv_x] + mvb™s[mv->
mv_y
 -…mv->mv_y])) );

106 #ià(
USE_RND_COST
)

107  (
	`rshiá_ºd_sf
((
Ïmbda
 *(
p_Vid
->
mvb™s
[
mv
->
mv_x
 - 
pmv
->mv_x] +…_Vid->mvb™s[mv->
mv_y
 -…mv->mv_y])), 
LAMBDA_ACCURACY_BITS
));

109  ((
Ïmbda
 *(
p_Vid
->
mvb™s
[
mv
->
mv_x
 - 
pmv
->mv_x] +…_Vid->mvb™s[mv->
mv_y
 -…mv->mv_y]))>> 
LAMBDA_ACCURACY_BITS
);

112 
	}
}

114 
šlše
 
di¡blk
 
	$»f_co¡
(cÚ¡ 
Sliû
 *
cu¼Sliû
, 
Ïmbda
, 
»f
, 
li¡_off£t
)

116 ià(
cu¼Sliû
->
li¡Xsize
[
li¡_off£t
] <= 1)

120 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

121 #ià
JCOST_CALC_SCALEUP


122  ( ((
di¡blk
)
Ïmbda
è*((di¡blk)(
p_Vid
->
»fb™s
[(
»f
)])) );

124 #ià(
USE_RND_COST
)

125  (
	`rshiá_ºd_sf
((
Ïmbda
è* (
p_Vid
->
»fb™s
[(
»f
)]), 
LAMBDA_ACCURACY_BITS
));

127  ((
Ïmbda
 *(
p_Vid
->
»fb™s
[(
»f
)]))>> 
LAMBDA_ACCURACY_BITS
);

131 
	}
}

133 
šlše
 
	$G‘MaxMVD
(
MÙiÚVeùÜ
 *
pMV
, MÙiÚVeùÜ *
pRefMV
)

135 
i32MVx
 = 
	`Ÿbs
(
pMV
->
mv_x
 - 
pRefMV
->mv_x);

136 
i32MVy
 = 
	`Ÿbs
(
pMV
->
mv_y
 - 
pRefMV
->mv_y);

137  
	`imax
(
i32MVx
, 
i32MVy
);

138 
	}
}

	@lencod/inc/nal.h

18 #iâdeà
_NAL_H_


19 
	#_NAL_H_


	)

21 
	~"ÇlucommÚ.h
"

22 
	~"’c_¡©i¡ics.h
"

24 
addCabacZ”oWÜds
(
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
Çlu
, 
StP¬am‘”s
 *
cur_¡©s
);

25 
SODBtoRBSP
 (
B™¡»am
 *
cu¼SŒ—m
);

26 
RBSPtoEBSP
(
by‹
 *
N®uBufãr
, *
rb¥
, 
rb¥_size
);

	@lencod/inc/nalu.h

17 #iâdeà
_NALU_H_


18 
	#_NALU_H_


	)

20 
	~"ÇlucommÚ.h
"

22 
RBSPtoNALU
 (*
rb¥
, 
NALU_t
 *
Çlu
, 
rb¥_size
, 
Çl_un™_ty³
, 
Çl_»ã»nû_idc
, 
U£AÂexbLÚgS¹code
);

23 
Wr™e_AUD_NALU
Ð
VideoP¬am‘”s
 *
p_Vid
 );

24 
Wr™e_FžËr_D©a_NALU
Ð
VideoP¬am‘”s
 *
p_Vid
, 
num_by‹s
 );

	@lencod/inc/output.h

14 #iâdeà
_OUTPUT_H_


15 
	#_OUTPUT_H_


	)

17 
æush_dœeù_ouut
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
ouut
, 
p_out
);

18 
wr™e_out_piùu»
 ( 
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
);

19 
wr™e_¡Üed_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
, 
F¿meFÜm©
 *
ouut
, 
p_out
);

20 
dœeù_ouut
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
);

21 
dœeù_ouut_·ff
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
);

22 
š™_out_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
);

23 
unš™_out_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
);

	@lencod/inc/params.h

13 #iâdeà
_PARAMS_H_


14 
	#_PARAMS_H_


	)

16 
	~"defšes.h
"

17 
	~"ty³s.h
"

18 
	~"vui_·¿ms.h
"

19 
	~"äame.h
"

20 
	~"io_video.h
"

23 
	sšp_·r_’c


25 
	mProfžeIDC
;

26 
	mLev–IDC
;

27 
	mIÁ¿Profže
;

29 
	mno_äames
;

30 
	mqp
[
NUM_SLICE_TYPES
];

31 
	mqp2äame
;

32 
	mqp2off
[
NUM_SLICE_TYPES
];

33 
	mqp¥
;

34 
	mäame_sk
;

35 
	mjumpd
;

37 
	mDi§bËSub³lME
[2];

38 
	m£¬ch_¿nge
[2];

40 
	mnum_»f_äames
;

41 
	mP_Li¡0_»fs
[2];

42 
	mB_Li¡0_»fs
[2];

43 
	mB_Li¡1_»fs
[2];

44 
	mnum_»f_äames_Üg
;

45 
	mP_Li¡0_»fs_Üg
[2];

46 
	mB_Li¡0_»fs_Üg
[2];

47 
	mB_Li¡1_»fs_Üg
[2];

48 
	mLog2MaxFNumMšus4
;

49 
	mLog2MaxPOCLsbMšus4
;

52 
F¿meFÜm©
 
	msourû
;

53 
F¿meFÜm©
 
	mouut
;

54 
	mis_š‹¾—ved
;

55 
	m¤c_»size
;

56 
	m¤c_B™D•thResÿË
;

57 
	myuv_fÜm©
;

58 
	mšŒa_upd
;

63 
	m¦iû_mode
;

64 
	m¦iû_¬gum’t
;

65 
	mU£CÚ¡¿šedIÁ¿P»d
;

66 
	mS‘Fœ¡AsLÚgT”m
;

67 
	mšfže_h—d”
;

68 
	mMuÉiSourûD©a
;

69 
VideoD©aFže
 
	mšput_fže2
;

70 
VideoD©aFže
 
	mšput_fže3
;

71 
	mnum_of_v›ws
;

72 #ià(
MVC_EXTENSION_ENABLE
)

73 
	mV›w1CÚfigName
[
FILE_NAME_SIZE
];

74 
	mEnhLay”DFDi§bËIdc
[2][
NUM_SLICE_TYPES
];

75 
	mEnhLay”DFAÍha
 [2][
NUM_SLICE_TYPES
];

76 
	mEnhLay”DFB‘a
 [2][
NUM_SLICE_TYPES
];

77 
	mMVCIÁ”V›wReÜd”
;

78 
	mMVCFlV›ws
;

79 
	mMVCIÁ”V›wFÜûB
;

80 
	mV›w1QPOff£t
;

81 
	m’abË_š‹r_v›w_æag
;

82 
	m’h_Ïy”_Ïmbda_muÉl›r
;

83 
	m’h_Ïy”_me_Ïmbda_muÉl›r
;

86 
VideoD©aFže
 
	mšput_fže1
;

87 
	moutfže
 [
FILE_NAME_SIZE
];

88 
	mRecÚFže
 [
FILE_NAME_SIZE
];

89 
	mRecÚFže2
 [
FILE_NAME_SIZE
];

90 
	mT¿ûFže
 [
FILE_NAME_SIZE
];

91 
	mStsFže
 [
FILE_NAME_SIZE
];

92 
	mQm©rixFže
 [
FILE_NAME_SIZE
];

93 
	mProûssIÅut
;

94 
	mEÇbËO³nGOP
;

95 
	mEÇbËIDRGOP
;

96 
	mg¿ysÿË
;

98 
	midr_³riod
;

99 
	mšŒa_³riod
;

100 
	mšŒa_d–ay
;

101 
	mad­tive_idr_³riod
;

102 
	mad­tive_šŒa_³riod
;

104 
	m¡¬t_äame
;

106 
	m’abË_32_puÎdown
;

108 
	mG’”©eMuÉËPPS
;

109 
	mG’”©eSEIMes§ge
;

110 
	mSEIMes§geText
[
INPUT_TEXT_SIZE
];

112 
	mRe£ndSPS
;

113 
	mRe£ndPPS
;

115 
	mS’dAUD
;

116 
	msk_gl_¡©s
;

119 
	mNumb”BF¿mes
;

120 
	mPR•ÏûBSliû
;

121 
	mqpBRSOff£t
;

122 
	mdœeù_¥©Ÿl_mv_´ed_æag
;

123 
	mdœeùInã»nûFÏg
;

125 
	mBiP»dMÙiÚE¡im©iÚ
;

126 
	mBiP»dS—rch
[4];

127 
	mBiP»dMERefšem’ts
;

128 
	mBiP»dMES—rchRªge
[2];

129 
	mBiP»dMESubP–
;

132 
	m¥_³riodic™y
;

133 
	m¥_sw™ch_³riod
;

134 
	msi_äame_šdiÿtÜ
;

135 
	m¥2_äame_šdiÿtÜ
;

136 
	m¥_ouut_šdiÿtÜ
;

137 
	m¥_ouut_fž’ame
[
FILE_NAME_SIZE
];

138 
	m¥2_šput_fž’ame1
[
FILE_NAME_SIZE
];

139 
	m¥2_šput_fž’ame2
[
FILE_NAME_SIZE
];

142 
	mWeigh‹dP»diùiÚ
;

143 
	mWeigh‹dB»diùiÚ
;

144 
	mWPM‘hod
;

145 
	mWPI‹rMC
;

146 
	mWPMCP»cisiÚ
;

147 
	mWPMCP»cFuÎRef
;

148 
	mWPMCP»cBSliû
;

149 
	mEnhªûdBWeightSuµÜt
;

150 
	mChromaWeightSuµÜt
;

151 
	mU£Weigh‹dReã»nûME
;

152 
	mRDPiùu»DecisiÚ
;

153 
	mRDPSliûBTe¡
;

154 
	mRDPSliûITe¡
;

155 
	mRDPiùu»MaxPassISliû
;

156 
	mRDPiùu»MaxPassPSliû
;

157 
	mRDPiùu»MaxPassBSliû
;

158 
	mRDPiùu»Deblockšg
;

159 
	mRDPiùu»DœeùMode
;

160 
	mRDPiùu»F¿meQPPSliû
;

161 
	mRDPiùu»F¿meQPBSliû
;

163 
	mSkIÁ¿InIÁ”Sliûs
;

164 
	mPSliûSkDecisiÚM‘hod
;

165 
	mBRefPiùu»s
;

166 
	mH›¿rchiÿlCodšg
;

167 
	mH›¿rchyLev–QPEÇbË
;

168 
	mEx¶ic™H›¿rchyFÜm©
[
INPUT_TEXT_SIZE
];

170 
	mEx¶ic™SeqCodšg
;

171 
	mEx¶ic™SeqFže
[
FILE_NAME_SIZE
];

172 
	mLowD–ay
;

174 
	mReã»nûReÜd”
;

175 
	mEÇbËReÜd”B¦iû
;

176 
	mU£Di¡ÜtiÚReÜd”
;

177 
	mPocMemÜyMªagem’t
;

179 
	msymbÞ_mode
;

180 
	mof_mode
;

181 
	m·¹™iÚ_mode
;

184 
	mS•V›wIÁ”S—rch
;

185 
	mV›w1NoResidueRDO
;

187 
	mIÁ”S—rch
[2][2][8];

189 
	mDi§bËIÁ¿4x4
;

190 
	mDi§bËIÁ¿16x16
;

191 
	mFa¡MDEÇbË
;

192 
	mFa¡IÁ¿MD
;

193 
	mFa¡IÁ¿4x4
;

194 
	mFa¡IÁ¿16x16
;

195 
	mFa¡IÁ¿8x8
;

196 
	mFa¡IÁ¿Chroma
;

198 
	mDi§bËIÁ¿InIÁ”
[2];

199 
	mIÁ¿Di§bËIÁ”OÆy
;

200 
	mIÁ¿4x4P¬Di§bË
;

201 
	mIÁ¿4x4DŸgDi§bË
;

202 
	mIÁ¿4x4DœDi§bË
;

203 
	mIÁ¿16x16P¬Di§bË
;

204 
	mIÁ¿16x16PÏÃDi§bË
;

205 
	mChromaIÁ¿Di§bË
;

207 
	mEÇbËIPCM
;

209 
	mF¿meR©e
;

211 
	mchroma_qp_šdex_off£t
;

212 
	mfuÎ_£¬ch
;

214 
	mrdÝt
;

215 
	mde
;

216 
	mI16rdo
;

217 
	mMDReã»nû
[2];

218 
	msubMBCodšgS‹
;

219 
	mDi¡ÜtiÚ
[
TOTAL_DIST_TYPES
];

220 
	mVisu®ResWavPSNR
;

221 
	mSSIMOv”ÏpSize
;

222 
	mDi¡ÜtiÚYUVtoRGB
;

223 
	mCtxAd±Lag¿ngeMuÉ
;

224 
	mFa¡CrIÁ¿DecisiÚ
;

225 
	mdi¡h»s
;

226 
	mnobsk
;

227 
	mBŸsSkRDO
;

228 
	mFÜûTrueR©eRDO
;

230 #ifdeà
_LEAKYBUCKET_


231 
	mNumb”L—kyBuck‘s
;

232 
	mL—kyBuck‘R©eFže
[
FILE_NAME_SIZE
];

233 
	mL—kyBuck‘P¬amFže
[
FILE_NAME_SIZE
];

236 
	mPicIÁ”Ïû
;

237 
	mMbIÁ”Ïû
;

238 
	mIÁ¿BÙtom
;

241 
	mLossR©eA
;

242 
	mLossR©eB
;

243 
	mLossR©eC
;

244 
	mFœ¡F¿meCÜ»ù
;

245 
	mNoOfDecod”s
;

246 
	mE¼ÜCÚû®m’t
;

247 
	mRe¡riùRef
;

248 
	mNumF¿mesInELSubSeq
;

250 
	mRªdomIÁ¿MBReäesh
;

252 
	mOnTheFlyF¿ùMCP
;

255 
	mChromaMCBufãr
;

256 
	mChromaMEEÇbË
;

257 
	mChromaMEWeight
;

258 
	mMESoá’SSEM‘ric
;

259 
	mMEE¼ÜM‘ric
[3];

260 
	mModeDecisiÚM‘ric
;

261 
	mSkDeBlockNÚRef
;

264 
	mDFS’dP¬am‘”s
;

265 
	mDFDi§bËIdc
[2][
NUM_SLICE_TYPES
];

266 
	mDFAÍha
 [2][
NUM_SLICE_TYPES
];

267 
	mDFB‘a
 [2][
NUM_SLICE_TYPES
];

269 
	mS·»Piùu»O±iÚ
;

270 
	mSPD‘eùiÚTh»shÞd
;

271 
	mSPP”ûÁageTh»shÞd
;

274 
	mSliûGroupCÚfigFžeName
[
FILE_NAME_SIZE
];

275 
	mnum_¦iû_groups_mšus1
;

276 
	m¦iû_group_m­_ty³
;

278 *
	mtÝ_Ëá
;

279 *
	mbÙtom_right
;

280 
by‹
 *
	m¦iû_group_id
;

281 *
	mrun_Ëngth_mšus1
;

283 
	m¦iû_group_chªge_dœeùiÚ_æag
;

284 
	m¦iû_group_chªge_¿‹_mšus1
;

285 
	m¦iû_group_chªge_cyþe
;

287 
	m»dundªt_pic_æag
;

288 
	mpic_Üd”_út_ty³
;

290 
	mcÚ‹xt_š™_m‘hod
;

291 
	mmod–_numb”
;

292 
	mT¿nsfÜm8x8Mode
;

293 
	mR•ÜtF¿meSts
;

294 
	mDi¥ÏyEncP¬ams
;

295 
	mV”bo£
;

298 
	mRCEÇbË
;

299 
	mb™_¿‹
;

300 
	mSeš™ŸlQP
;

301 
	mbasicun™
;

302 
	mchªÃl_ty³
;

303 
	mRCUpd©eMode
;

304 
	mRCIov”PR©io
;

305 
	mRCBov”PR©io
;

306 
	mRCISliûB™R©io
;

307 
	mRCBSliûB™R©io
[
RC_MAX_TEMPORAL_LEVELS
];

308 
	mRCMšQP
[
NUM_SLICE_TYPES
];

309 
	mRCMaxQP
[
NUM_SLICE_TYPES
];

310 
	mRCMaxQPChªge
;

313 
	mU£MVLim™s
;

314 
	mS‘MVXLim™
;

315 
	mS‘MVYLim™
;

318 
S—rchTy³
 
	mS—rchMode
[2];

321 
	mUMHexDSR
;

322 
	mUMHexSÿË
;

325 
	mEPZSP©‹º
;

326 
	mEPZSDu®
;

327 
	mEPZSFixed
;

328 
	mEPZSAgg»ssiveWšdow
;

329 #ià(
MVC_EXTENSION_ENABLE
)

330 
	mEPZSTempÜ®
[2];

332 
	mEPZSTempÜ®
;

334 
	mEPZSS·tŸlMem
;

335 
	mEPZSBlockTy³
;

336 #ià(
MVC_EXTENSION_ENABLE
)

337 
	mEÇbËEnhLay”EPZSSÿËrs
;

338 
	mEPZSMšTh»sSÿË
[2];

339 
	mEPZSMaxTh»sSÿË
[2];

340 
	mEPZSMedTh»sSÿË
[2];

341 
	mEPZSSubP–Th»sSÿË
[2];

343 
	mEPZSMšTh»sSÿË
;

344 
	mEPZSMaxTh»sSÿË
;

345 
	mEPZSMedTh»sSÿË
;

346 
	mEPZSSubP–Th»sSÿË
;

348 
	mDi§bËMEP»diùiÚ
;

349 
	mEPZSSubP–Grid
;

350 
	mEPZSSubP–ME
;

351 
	mEPZSSubP–MEBiP»d
;

352 
	mEPZSU£HMEP»diùÜs
;

355 
	mHMEEÇbË
;

356 
	mHMEDi§bËMMCO
;

357 
	mPy¿midLev–s
;

361 
	mMšIDRDi¡ªû
;

363 
	mU£Ex¶ic™LambdaP¬ams
;

364 
	mDi§bËDi¡ªûLambdaSÿË
;

365 
	mUpd©eLambdaChromaME
;

366 
	mLambdaWeight
[6];

367 
	mFixedLambda
[6];

369 
	mQOff£tM©rixFže
[
FILE_NAME_SIZE
];

370 
	mOff£tM©rixP»£ÁFÏg
;

372 
	mAd­tiveRoundšg
;

373 
	mAd­tRoundšgFixed
;

374 
	mAd­tRndP”iod
;

375 
	mAd­tRndChroma
;

376 
	mAd­tRndWFaùÜ
 [2][
NUM_SLICE_TYPES
];

377 
	mAd­tRndCrWFaùÜ
[2][
NUM_SLICE_TYPES
];

378 
	mOff£tM©rixFÏt
;

382 
	mSÿlšgM©rixP»£ÁFÏg
;

383 
	mSÿlšgLi¡P»£ÁFÏg
[12];

385 
	mcb_qp_šdex_off£t
;

386 
	mü_qp_šdex_off£t
;

388 
	mLos¦essCodšg
;

391 
	mE¬lySkEÇbË
;

392 
	mS–eùiveIÁ¿EÇbË
;

393 
	mDi¥o§bËP
;

394 
	mDi¥PQPOff£t
;

397 
	mNumRedundªtH›¿rchy
;

398 
	mPrim¬yGOPL’gth
;

399 
	mNumRefPrim¬y
;

402 
	mTÚeM­pšgSEIP»£ÁFÏg
;

403 
	mTÚeM­pšgFže
[
FILE_NAME_SIZE
];

406 
	mP»ãrDi¥Ord”
;

407 
	mP»ãrPow”OfTwo
;

408 
	mFrmSŒuùBufãrL’gth
;

410 
	mrc_ýb_size
;

411 
	mSEIVUI32PuÎdown
;

412 
	mSEIFPATy³
;

414 
	m£·¿‹_cÞour_¶ªe_æag
;

415 
	mWeightY
;

416 
	mWeightCb
;

417 
	mWeightCr
;

418 
	mU£RDOQuªt
;

419 
	mRDOQ_DC
;

420 
	mRDOQ_CR
;

421 
	mRDOQ_DC_CR
;

422 
	mRDOQ_QP_Num
;

423 
	mRDOQ_CP_Mode
;

424 
	mRDOQ_CP_MV
;

425 
	mRDOQ_Fa¡
;

427 
	mEÇbËVUISuµÜt
;

429 
VUIP¬am‘”s
 
	mVUI
;

433 
	m¡dRªge
;

434 
	mvideoCode
;

436 #ià
B0_MORE_REF


437 
	mBLev–0MÜeRef
;

439 #ià
KEEP_B_SAME_LIST


440 
	mBId’tiÿlLi¡
;

442 #ià
CRA


443 
	mu£CRA
;

445 #ià
HM50_LIKE_MMCO


446 
	mHM50RefSŒuùu»
;

448 #ià
LD_REF_SETTING


449 
	mLDRefS‘tšg
;

450 
	mUncÚ¡¿šedLDRef
;

	@lencod/inc/parset.h

17 #iâdeà
_PARSET_H_


18 
	#_PARSET_H_


	)

20 
	~"·r£tcommÚ.h
"

21 
	~"Çlu.h
"

22 
	~"£i.h
"

24 
g’”©e_·¿m‘”_£ts
 (
VideoP¬am‘”s
 *
p_Vid
);

25 
F»eP¬am‘”S‘s
 (
VideoP¬am‘”s
 *
p_Vid
);

27 
NALU_t
 *
G’”©eSeq_·¿m‘”_£t_NALU
 (
VideoP¬am‘”s
 *
p_Vid
);

28 
NALU_t
 *
G’”©ePic_·¿m‘”_£t_NALU
 (
VideoP¬am‘”s
 *
p_Vid
, );

29 
NALU_t
 *
G’”©eSEImes§ge_NALU
(
IÅutP¬am‘”s
 *
p_IÅ
);

30 #ià(
MVC_EXTENSION_ENABLE
)

31 
NALU_t
 *
G’”©eSub£tSeq_·¿m‘”_£t_NALU
 (
VideoP¬am‘”s
 *
p_Vid
);

35 
G’”©eSequ’ûP¬am‘”S‘
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
VideoP¬am‘”s
 *
p_Vid
, 
SPS_id
);

36 
G’”©ePiùu»P¬am‘”S‘
Ð
pic_·¿m‘”_£t_rb¥_t
 *
µs
, 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
,

37 
VideoP¬am‘”s
 *
p_Vid
,

38 
IÅutP¬am‘”s
 *
p_IÅ
, 
PPS_id
,

39 
Weigh‹dP»diùiÚ
, 
Weigh‹dB»diùiÚ
,

40 
cb_qp_šdex_off£t
, 
ü_qp_šdex_off£t
);

42 
Sÿlšg_Li¡
(*
sÿlšgLi¡šput
, *
sÿlšgLi¡
, 
sizeOfSÿlšgLi¡
, *
U£DeçuÉSÿlšgM©rix
, 
B™¡»am
 *
b™¡»am
);

43 #ià(
MVC_EXTENSION_ENABLE
)

44 
G’”©eSeq_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
by‹
 *
buf
, 
Is_Sub£t
);

46 
G’”©eSeq_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
by‹
 *
buf
);

48 
G’”©ePic_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 *
µs
, 
by‹
 *
buf
);

49 
G’”©eSEImes§ge_rb¥
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
id
, 
by‹
 *
buf
);

50 
F»eSPS
 (
£q_·¿m‘”_£t_rb¥_t
 *
¥s
);

51 
F»ePPS
 (
pic_·¿m‘”_£t_rb¥_t
 *
µs
);

53 
Wr™eHRDP¬am‘”s
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
B™¡»am
 *
b™¡»am
);

54 
G’”©eVUIP¬am‘”s
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
IÅutP¬am‘”s
 *
p_IÅ
);

56 
pic_·¿m‘”_£t_rb¥_t
 *
AÎocPPS
 ();

57 
£q_·¿m‘”_£t_rb¥_t
 *
AÎocSPS
 ();

	@lencod/inc/pred_struct.h

17 #iâdeà
_PRED_STRUCT_H_


18 
	#_PRED_STRUCT_H_


	)

20 
	~"glob®.h
"

21 
	~"´ed_¡ruù_ty³s.h
"

22 
	~"ex¶ic™_£q.h
"

24 
g‘_poc_ty³_z”o
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
 );

25 
g‘_poc_ty³_Úe
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
 );

26 
š™_poc
(
VideoP¬am‘”s
 *
p_Vid
);

27 
SeqSŒuùu»
 * 
š™_£q_¡ruùu»
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, *
memÜy_size
 );

28 
ä“_£q_¡ruùu»
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 );

29 
pÝuÏ‹_äm_¡ruù
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_to_pÝuÏ‹
, 
š™_äames_to_code
 );

30 
pÝuÏ‹_äame_ex¶ic™
Ð
ExpF¿meInfo
 *
šfo
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_¦iûs
 );

31 
pÝuÏ‹_äame_¦iû_ty³
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
¦iû_ty³
, 
num_¦iûs
 );

32 
pÝuÏ‹_»g_pic
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
PicSŒuùu»
 *
p_pic
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_¦iûs
, 
is_bÙ_æd
 );

33 
pÝuÏ‹_äm_¡ruù_mvc
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
¡¬t
, 
’d
 );

	@lencod/inc/pred_struct_adapt.h

17 #iâdeà
_PRED_STRUCT_ADAPT_H_


18 
	#_PRED_STRUCT_ADAPT_H_


	)

20 
	~"glob®.h
"

	@lencod/inc/pred_struct_adapt_types.h

17 #iâdeà
_PRED_STRUCT_ADAPT_TYPES_H_


18 
	#_PRED_STRUCT_ADAPT_TYPES_H_


	)

	@lencod/inc/pred_struct_types.h

17 #iâdeà
_PRED_STRUCT_TYPES_H_


18 
	#_PRED_STRUCT_TYPES_H_


	)

35 
	mPOP_IDR
 = 1,

36 
	mPOP_INTRA
 = 2,

37 
	mPOP_SP
 = 3

38 } 
	tSliûTy³ToPÝ
;

41 
	s´ed_¡ruù_äm


43 
	mdi¥_off£t
;

44 
	m¦iû_ty³
;

45 
	mÇl_»f_idc
;

46 
	mÏy”
;

47 
	m¦iû_qp_off
;

48 
	m¿ndom_acûss
;

49 
	m‹mpÜ®_Ïy”
;

50 } 
	tP»dSŒuùFrm
;

53 
	s´ed_¡ruù_©om


55 
	mËngth
;

56 
	mgÝ_Ëv–s
;

57 
P»dSŒuùFrm
 *
	mp_äm
;

58 } 
	tP»dSŒuùAtom
;

61 
	s¦iû_¡ruù


63 
	mty³
;

64 
	mqp
;

65 
	mdeblock
;

66 
	mweigh‹d_´ed
;

67 
	mnum_»fs
;

68 } 
	tSliûSŒuùu»
;

71 
	spic_¡ruù


73 
	midr_æag
;

74 
	mÇl_»f_idc
;

75 
	m¿ndom_acûss
;

76 
	mnum_¦iûs
;

77 
SliûSŒuùu»
 *
	mp_Sliû
;

78 } 
	tPicSŒuùu»
;

81 
	säame_¡ruù


83 
	mty³
;

84 
	midr_æag
;

85 
	mÇl_»f_idc
;

86 
	mäame_no
;

87 
	mf›ld_pic_æag
;

88 
	mmod_qp
;

89 
	mqp
;

90 
	mÏy”
;

91 
	mnum_»fs
;

92 
	m¿ndom_acûss
;

93 
	m©om_idx
;

94 
	m‹mpÜ®_Ïy”
;

95 #ià(
MVC_EXTENSION_ENABLE
)

96 
	mv›w_id
;

98 
PicSŒuùu»
 *
	mp_äame_pic
;

99 
PicSŒuùu»
 *
	mp_tÝ_æd_pic
;

100 
PicSŒuùu»
 *
	mp_bÙ_æd_pic
;

101 
P»dSŒuùAtom
 *
	mp_©om
;

102 } 
	tF¿meUn™SŒuù
;

105 
	s£q_¡ruù


107 
	mnum_äames
;

108 
	mnum_´ds
;

109 
	mnum_gÝs
;

110 
	mnum_šŒa_gÝs
;

113 
	mÏ¡_¿ndom_acûss_äame
;

114 
	mÏ¡_idr_äame
;

115 
	mÏ¡_šŒa_äame
;

116 
	mÏ¡_mmco_5_äame
;

117 
	mÏ¡_¥_äame
;

119 
	mÏ¡_¿nd_acûss_di¥
;

120 
	mÏ¡_idr_di¥
;

121 
	mÏ¡_šŒa_di¥
;

122 
	mÏ¡_¥_di¥
;

123 
	mÏ¡_bl_äm_di¥o§bË
;

125 
	mcu¼_num_to_pÝuÏ‹
;

126 
	mpÝ_¡¬t_äame
;

128 
	mmax_num_¦iûs
;

129 
	mpÝ_æag
;

131 #ià(
MVC_EXTENSION_ENABLE
)

132 
	mnum_äames_mvc
;

133 
F¿meUn™SŒuù
 *
	mp_äm_mvc
;

136 
F¿meUn™SŒuù
 *
	mp_äm
;

138 
P»dSŒuùAtom
 *
	mp_´d
;

139 
P»dSŒuùAtom
 *
	mp_gÝ
;

140 
P»dSŒuùAtom
 *
	mp_šŒa_gÝ
;

141 } 
	tSeqSŒuùu»
;

	@lencod/inc/q_around.h

14 #iâdeà
_Q_AROUND_H_


15 
	#_Q_AROUND_H_


	)

17 
upd©e_ad­tive_roundšg_8x8
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RD_8x8DATA
* 
d©aTr
, **** 
ARCofAdj
);

18 
¡Üe_ad­tive_roundšg_4x4
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
, 
mode
, 
block_y
, 
block_x
);

19 
upd©e_ad­tive_roundšg_4x4
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
 , 
mode
, 
block_y
, 
block_x
);

20 
upd©e_ad­tive_roundšg_16x16
(
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
 , 
mode
);

21 
¡Üe_ad­tive_roundšg_16x16
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
, 
mode
);

22 
»£t_ad­tive_roundšg_dœeù
(
VideoP¬am‘”s
 *
p_Vid
);

23 
upd©e_off£t_·¿ms
 (
Maüoblock
 *
cu¼MB
, 
mode
, 
by‹
 
luma_ŒªsfÜm_size_8x8_æag
);

	@lencod/inc/q_matrix.h

15 #iâdeà
_Q_MATRIX_H_


16 
	#_Q_MATRIX_H_


	)

18 
	ssÿlšg_li¡
 {

19 
	mSÿlšgLi¡4x4šput
[6][16];

20 
	mSÿlšgLi¡8x8šput
[6][64];

21 
	mSÿlšgLi¡4x4
[6][16];

22 
	mSÿlšgLi¡8x8
[6][64];

24 
	mU£DeçuÉSÿlšgM©rix4x4FÏg
[6];

25 
	mU£DeçuÉSÿlšgM©rix8x8FÏg
[6];

28 
š™_qm©rix
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

29 
C®cuÏ‹Quªt4x4P¬am
 (
VideoP¬am‘”s
 *
p_Vid
);

30 
C®cuÏ‹Quªt8x8P¬am
 (
VideoP¬am‘”s
 *
p_Vid
);

31 
ä“_QM©rix
(
QuªtP¬am‘”s
 *
p_Quªt
);

	@lencod/inc/q_offsets.h

15 #iâdeà
_Q_OFFSETS_H_


16 
	#_Q_OFFSETS_H_


	)

18 cÚ¡ 
	gOff£tB™s
 = 11;

20 
š™_qoff£t
 (
VideoP¬am‘”s
 *
p_Vid
);

21 
C®cuÏ‹Off£t4x4P¬am
 (
VideoP¬am‘”s
 *
p_Vid
);

22 
C®cuÏ‹Off£t8x8P¬am
 (
VideoP¬am‘”s
 *
p_Vid
);

23 
ä“_QOff£ts
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
);

24 
In™Off£tP¬am
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
);

	@lencod/inc/quant4x4.h

16 #iâdeà
_QUANT4x4_H_


17 
	#_QUANT4x4_H_


	)

19 
š™_quªt_4x4
 (
Sliû
 *
cu¼Sliû
);

21 
quªt_4x4_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

22 
quªt_4x4_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

23 
quªt_4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

24 
quªt_dc4x4_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

25 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

27 
quªt_dc4x4_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

28 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

30 
quªt_dc4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

31 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

33 
quªt_ac4x4_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

34 
quªt_ac4x4_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

35 
quªt_ac4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

37 
rdoq_4x4_CAVLC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[16]);

39 
rdoq_4x4_CABAC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[16]);

41 
rdoq_dc_CAVLC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
,

42 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[16], 
ty³
);

44 
rdoq_dc_CABAC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
,

45 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[16], 
ty³
);

47 
rdoq_ac4x4_CAVLC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[16]);

49 
rdoq_ac4x4_CABAC
 (
Maüoblock
 *
cu¼MB
, **
tblock
 , 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[16]);

	@lencod/inc/quant8x8.h

15 #iâdeà
_QUANT8x8_H_


16 
	#_QUANT8x8_H_


	)

18 
š™_quªt_8x8
 (
Sliû
 *
cu¼Sliû
);

20 
quªt_8x8_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

21 
quªt_8x8_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

22 
quªt_8x8_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
);

24 
quªt_8x8ÿvlc_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
);

25 
quªt_8x8ÿvlc_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
);

26 
quªt_8x8ÿvlc_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
);

	@lencod/inc/quantChroma.h

16 #iâdeà
_QUANT_CR_H_


17 
	#_QUANT_CR_H_


	)

19 
š™_quªt_Chroma
(
Sliû
 *
cu¼Sliû
);

21 
quªt_dc2x2_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

22 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡2x2
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

24 
quªt_dc2x2_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

25 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡2x2
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

27 
quªt_dc2x2_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

28 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

30 
quªt_dc4x2_nÜm®
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

31 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

33 
quªt_dc4x2_¬ound
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

34 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

36 
quªt_dc4x2_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

37 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2]);

39 
rdoq_dc_ü_CAVLC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

40 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
,

41 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[16], 
ty³
);

43 
rdoq_dc_ü_CABAC
 (
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

44 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[16], 
ty³
);

	@lencod/inc/ratectl.h

19 #iâdeà
_RATE_CTL_H_


20 
	#_RATE_CTL_H_


	)

22 
	~"glob®.h
"

23 
	~"rc_quad¿tic.h
"

27 
Q¡•2QP
 ( 
Q¡•
, 
qp_off£t
 );

28 
QP2Q¡•
 ( 
QP
 );

29 
Compu‹MBMAD
 ( 
diff
[16][16] );

30 
Compu‹F¿meMAD
 ( 
VideoP¬am‘”s
 *
p_Vid
 );

31 
rc_¡Üe_mad
 ( 
Maüoblock
 *
cu¼MB
 );

35 
rc_®loc_g’”ic
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
RCG’”ic
 **
p_quad
 );

36 
rc_ä“_g’”ic
 ( 
RCG’”ic
 **
p_quad
 );

37 
rc_cÝy_g’”ic
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
RCG’”ic
 *
d¡
, RCG’”iø*
¤c
 );

38 
rc_š™_gÝ_·¿ms
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

39 
rc_š™_äame
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

40 
rc_š™_£qu’û
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

41 
rc_¡Üe_¦iû_h—d”_b™s
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
Ën
);

	@lencod/inc/rc_quadratic.h

19 #iâdeà
_RC_QUADRATIC_H_


20 
	#_RC_QUADRATIC_H_


	)

22 
	~"rc_ty³s.h
"

26 
rc_®loc_quad¿tic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 **
p_quad
 );

27 
rc_ä“_quad¿tic
 ( 
RCQuad¿tic
 **
p_quad
 );

28 
rc_cÝy_quad¿tic
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
d¡
, RCQuad¿tiø*
¤c
 );

31 
rc_š™_£q
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
);

32 
rc_š™_GOP
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
Å
, 
nb
);

33 
rc_upd©e_più_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
nb™s
);

34 
rc_š™_più
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
,

35 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
f›ldpic
, 
tÝf›ld
, 
rg‘computiÚ
, 
muÉ
);

36 
rc_upd©e_più
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
nb™s
);

37 
rc_upd©e_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
b™s
);

39 
upd©eQPRC0
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
);

40 
upd©eQPRC1
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
);

41 
upd©eQPRC2
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
);

42 
upd©eQPRC3
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
);

45 
upd©eQPIÁ”Ïû
 ( 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 );

46 
upd©eQPNÚPicAFF
 ( 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
, 
RCQuad¿tic
 *
p_quad
 );

47 
upd©eBÙtomF›ld
 ( 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
 );

48 
upd©eFœ¡P
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 );

49 
upd©eNeg©iveT¬g‘
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
, 
m_Qp
 );

50 
upd©eFœ¡BU
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 );

51 
upd©eLa¡BU
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 );

52 
´ediùCu¼PicMAD
 ( 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 );

53 
upd©eMod–QPBU
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
m_Qp
 );

54 
upd©eQPIÁ”ÏûBU
 ( 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 );

55 
upd©eMod–QPF¿me
 ( 
RCQuad¿tic
 *
p_quad
, 
m_B™s
 );

57 
upd©eRCMod–
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
);

58 
upd©eMADMod–
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
);

59 
RCMod–E¡im©Ü
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
n_wšdowSize
, 
BoÞ—n
 *
m_rgRejeùed
);

60 
MADMod–E¡im©Ü
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
n_wšdowSize
, 
BoÞ—n
 *
Piùu»Rejeùed
);

61 
upd©eCom¶ex™y
 (
VideoP¬am‘”s
 *
p_Vid
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
BoÞ—n
 
is_upd©ed
, 
nb™s
 );

62 
upd©eP·¿ms
 (
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
com¶ex™y
 );

63 
upd©eB·¿ms
 (
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
com¶ex™y
 );

66 
rc_hªdË_mb
 ( 
Maüoblock
 *
cu¼MB
, 
´ev_mb
);

67 
rc_š™_tÝ_f›ld
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

68 
rc_š™_bÙtom_f›ld
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
TÝF›ldB™s
 );

69 
rc_š™_äame_rdpic
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
¿‹R©io
 );

70 
rc_®loÿ‹_memÜy
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

71 
rc_ä“_memÜy
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

72 
rc_upd©e_mb_¡©s
 ( 
Maüoblock
 *
cu¼MB
);

73 
rc_§ve_¡©e
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

74 
rc_»¡Üe_¡©e
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

	@lencod/inc/rc_types.h

20 #iâdeà
_RC_TYPES_H_


21 
	#_RC_TYPES_H_


	)

23 
	#RC_MODEL_HISTORY
 21

	)

26 
	src_g’”ic


29 
	mTÝF›ldFÏg
;

30 
	mF›ldCÚŒÞ
;

31 
	mF›ldF¿me
;

32 
	mNoG¿nuÏrF›ldRC
;

34 
	mNumb”ofH—d”B™s
;

35 
	mNumb”ofTextu»B™s
;

36 
	mNumb”ofBasicUn™H—d”B™s
;

37 
	mNumb”ofBasicUn™Textu»B™s
;

39 
	mNumb”ofGOP
;

40 
	mNumb”ofCodedBF¿me
;

42 
št64
 
	mTÙ®MADBasicUn™
;

43 *
	mMADofMB
;

45 
št64
 
	mCu¼’tBufãrFuÎÃss
;

46 
št64
 
	mRemaššgB™s
;

48 
	mRCPSliûB™s
;

49 
	mRCISliûB™s
;

50 
	mRCBSliûB™s
[
RC_MAX_TEMPORAL_LEVELS
];

51 
	m‹mpÜ®_Ëv–s
;

52 
	mh›rNb
[
RC_MAX_TEMPORAL_LEVELS
];

53 
	mNPSliû
;

54 
	mNISliû
;

55 } 
	tRCG’”ic
;

57 
	src_quad¿tic


59 
	mb™_¿‹
;

60 
	mäame_¿‹
;

61 
	mP»vB™R©e
;

62 
	mGAMMAP
;

63 
	mBETAP
;

64 
	mGOPT¬g‘BufãrLev–
;

65 
	mT¬g‘BufãrLev–
;

66 
	mAveWp
;

67 
	mAveWb
;

68 
	mMyIn™ŸlQp
;

69 
	mPAv”ageQp
;

70 
	mP»viousPiùu»MAD
;

71 
	mMADPiùu»C1
;

72 
	mMADPiùu»C2
;

73 
	mPMADPiùu»C1
;

74 
	mPMADPiùu»C2
;

75 
	mPPiùu»MAD
 [
RC_MODEL_HISTORY
];

76 
	mPiùu»MAD
 [
RC_MODEL_HISTORY
];

77 
	mReã»nûMAD
[
RC_MODEL_HISTORY
];

78 
	mm_rgQp
 [
RC_MODEL_HISTORY
];

79 
	mm_rgRp
 [
RC_MODEL_HISTORY
];

80 
	mPm_rgQp
 [
RC_MODEL_HISTORY
];

81 
	mPm_rgRp
 [
RC_MODEL_HISTORY
];

83 
	mm_X1
;

84 
	mm_X2
;

85 
	mPm_X1
;

86 
	mPm_X2
;

87 
	mPm_Qp
;

88 
	mPm_Hp
;

90 
	mMADm_wšdowSize
;

91 
	mm_wšdowSize
;

92 
	mm_Qc
;

94 
	mPP»H—d”
;

95 
	mP»vLa¡QP
;

96 
	mCu¼La¡QP
;

97 
	mNumb”ofBF¿mes
;

99 
	mTÙ®F¿meQP
;

100 
	mNumb”ofBasicUn™
;

101 
	mPAveH—d”B™s1
;

102 
	mPAveH—d”B™s2
;

103 
	mPAveH—d”B™s3
;

104 
	mPAveF¿meQP
;

105 
	mTÙ®Numb”ofBasicUn™
;

106 
	mCodedBasicUn™
;

108 
	mNumb”ofCodedPF¿me
;

109 
	mTÙ®QpfÜPPiùu»
;

110 
	mNumb”ofPPiùu»
;

112 
	mCu¼’tF¿meMAD
;

113 
	mCu¼’tBUMAD
;

114 
	mTÙ®BUMAD
;

115 
	mP»viousF¿meMAD
;

116 
	mP»viousWhÞeF¿meMAD
;

118 
	mDDquªt
;

119 
	mMBP”Row
;

120 
	mQPLa¡PF¿me
;

121 
	mQPLa¡GOP
;

124 
	mF›ldQPBufãr
;

125 
	mF¿meQPBufãr
;

126 
	mF¿meAveH—d”B™s
;

127 
	mF›ldAveH—d”B™s
;

128 *
	mBUPFMAD
;

129 *
	mBUCFMAD
;

130 *
	mFCBUCFMAD
;

131 *
	mFCBUPFMAD
;

133 
BoÞ—n
 
	mGOPOv”due
;

134 
št64
 
	mP´ev_b™s
;

137 
	mXp
, 
	mXb
;

138 
	mT¬g‘
;

139 
	mT¬g‘F›ld
;

140 
	mNp
, 
	mNb
, 
	mb™s_tÝf›ld
;

142 
	mUµ”Bound1
, 
	mUµ”Bound2
, 
	mLow”Bound
;

143 
	mWp
, 
	mWb
;

144 
	mD–P
;

145 
	mTÙ®PF¿me
;

146 
	mPMaxQpChªge
;

148 
	mb™d•th_qp_sÿË
;

151 
	m’c_buf_cu¼
;

153 } 
	tRCQuad¿tic
;

	@lencod/inc/rd_intra_jm.h

17 #iâdeà
_RD_INTRA_JM_H_


18 
	#_RD_INTRA_JM_H_


	)

20 
mode_decisiÚ_fÜ_I16x16_MB_RDO
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
);

21 
mode_decisiÚ_fÜ_I16x16_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
);

22 
mode_decisiÚ_fÜ_I4x4_blocks_JM_High
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
);

23 
mode_decisiÚ_fÜ_I4x4_blocks_JM_Low
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
);

24 
fšd_be¡_mode_I16x16_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
, 
di¡blk
 
mš_co¡
);

	@lencod/inc/rd_intra_jm444.h

17 #iâdeà
_RD_INTRA_JM444_H_


18 
	#_RD_INTRA_JM444_H_


	)

20 
mode_decisiÚ_fÜ_I16x16_MB_444
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
);

21 
mode_decisiÚ_fÜ_I4x4_blocks_JM_High444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
);

22 
mode_decisiÚ_fÜ_I4x4_blocks_JM_Low444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
);

	@lencod/inc/rdopt.h

17 #iâdeà
_RDO_H_


18 
	#_RDO_H_


	)

20 
	~"glob®.h
"

21 
	~"rdÝt_codšg_¡©e.h
"

26 
	mrdco¡
;

27 
	mdco¡
;

28 
	m¿‹
;

29 
	mcbp
;

30 
di¡blk
 
	mco¡
;

31 
	mc_imode
;

32 
	mi16off£t
;

33 
by‹
 
	mmode
;

34 } 
	tBe¡Mode
;

36 
	srdo_¡ruùu»


38 
RD_8x8DATA
 *
	mŒ4x4
;

39 
RD_8x8DATA
 *
	mŒ8x8
;

40 
img³l
 ***
	m»c8x8
;

41 
img³l
 ***
	m»c4x4
;

42 
img³l
 **
	m´ed
;

43 
img³l
 ***
	m»c_mb
;

44 **
	mÌec_»c
;

45 ***
	mÌec_»c_uv
;

47 ****
	mcofAC
;

48 ***
	mcofDC
;

49 **
	mcofAC4x4
;

50 ****
	mcofAC4x4š‹º
;

52 
MÙiÚVeùÜ
 ****
	m®l_mv8x8
;

54 *****
	mcofAC4x4CbCrš‹º
;

55 *****
	mcofAC8x8ts
;

56 *****
	mcÛfAC8x8
;

57 *****
	mcÛfAC8x8šŒa
;

58 **
	mcofAC4x4CbCr
[2];

61 
	mcbp
;

62 **
	ml0_»fäame
;

63 **
	ml1_»fäame
;

65 
Info8x8
 
	mbe¡8x8
[4];

67 
CSobj
 *
	mcs_mb
;

68 
CSobj
 *
	mcs_b8
;

69 
CSobj
 *
	mcs_cm
;

70 
CSobj
 *
	mcs_tmp
;

72 
Be¡Mode
 
	mmode_be¡
;

75 
	mÏmbda_mf_çùÜ
;

79 
by‹
 
f›ld_æag_šã»nû
 (
Maüoblock
 *
cu¼MB
);

80 
v®id_šŒa_mode
(
Sliû
 *
cu¼Sliû
, 
mode
);

82 
š™_md_be¡
(
Be¡Mode
 *
be¡
);

85 
þ—r_rdÝt
 (
Sliû
 *
cu¼Sliû
);

86 
š™_rdÝt
 (
Sliû
 *
cu¼Sliû
);

88 
Upd©ePix–M­
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

90 
upd©e_qp_cbp
 (
Maüoblock
 *
cu¼MB
);

91 
upd©e_qp_cbp_tmp
 (
Maüoblock
 *
cu¼MB
, 
cbp
);

93 
®loc_rd8x8d©a
 (
RD_8x8DATA
 *
rd_d©a
);

94 
ä“_rd8x8d©a
 (
RD_8x8DATA
 *
rd_d©a
);

96 
»¡Üe_nz_cÛff
(
Maüoblock
 *
cu¼MB
);

98 
’d_’code_Úe_maüoblock
(
Maüoblock
 *
cu¼MB
);

100 
’code_Úe_maüoblock_low
 (
Maüoblock
 *
cu¼MB
);

101 
’code_Úe_maüoblock_high
 (
Maüoblock
 *
cu¼MB
);

102 
’code_Úe_maüoblock_high_upd©ed
 (
Maüoblock
 *
cu¼MB
);

103 
’code_Úe_maüoblock_highç¡
 (
Maüoblock
 *
cu¼MB
);

104 
’code_Úe_maüoblock_highloss
 (
Maüoblock
 *
cu¼MB
);

106 
¡Üe_8x8_mÙiÚ_veùÜs_p_¦iû
 (
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
Info8x8
 *
B8x8Info
);

107 
¡Üe_8x8_mÙiÚ_veùÜs_b_¦iû
 (
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
Info8x8
 *
B8x8Info
);

109 
£t_modes_ªd_»fs_fÜ_blocks_p_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
);

110 
£t_modes_ªd_»fs_fÜ_blocks_b_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
);

111 
£t_modes_ªd_»fs_fÜ_blocks_i_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
);

113 
£t_cÛff_ªd_»cÚ_8x8_p_¦iû
 (
Maüoblock
* 
cu¼MB
);

114 
£t_cÛff_ªd_»cÚ_8x8_b_¦iû
 (
Maüoblock
* 
cu¼MB
);

116 
Info8x8
 
š™_šfo_8x8_¡ruù
();

124 
šlše
 
	$cÝy_4x4block
(
img³l
 **
oblock
, img³È**
iblock
, 
o_xoff£t
, 
i_xoff£t
)

126 
y
;

127 
y
 = 0; y < 
BLOCK_SIZE
; y++)

129 
	`memýy
(&
oblock
[
y
][
o_xoff£t
],&
iblock
[y][
i_xoff£t
], 
BLOCK_SIZE
 * (
img³l
));

131 
	}
}

	@lencod/inc/rdopt_coding_state.h

19 #iâdeà
_RD_OPT_CS_H_


20 
	#_RD_OPT_CS_H_


	)

22 
	scodšg_¡©e
 {

25 
	mno_·¹
;

26 
B™¡»am
 *
	mb™¡»am
;

27 
EncodšgEnvœÚm’t
 *
	m’ûnv
;

30 
MÙiÚInfoCÚ‹xts
 *
	mmÙ_ùx
;

31 
Textu»InfoCÚ‹xts
 *
	m‹x_ùx
;

34 
B™CouÁ”
 
	mb™s
;

37 
	mmvd
[2][
BLOCK_MULTIPLE
][BLOCK_MULTIPLE][2];

38 
št64
 
	mcbp_b™s
[3];

39 
št64
 *
	mcbp_b™s_8x8
;

42 
codšg_¡©e
 
	tCSobj
;

44 
d–‘e_codšg_¡©e
 (
CSobj
 *);

45 
CSobj
 *
ü—‹_codšg_¡©e
 (
IÅutP¬am‘”s
 *
p_IÅ
);

47 
š™_codšg_¡©e_m‘hods
(
Sliû
 *
cu¼Sliû
);

49 
¡Üe_codšg_¡©e_ÿvlc
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
);

50 
»£t_codšg_¡©e_ÿvlc
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
);

	@lencod/inc/rdoq.h

17 #iâdeà
_RDOQ_H_


18 
	#_RDOQ_H_


	)

20 
	~<m©h.h
>

23 
	#SIGN_BITS
 1

	)

25 cÚ¡ 
	ge¡E¼4x4
[6][4][4] =

65 cÚ¡ 
	ge¡E¼8x8
[6][8][8]={

129 
	se¡_b™s_ÿbac


131 
	msignifiÿÁB™s
[16][2];

132 
	mÏ¡B™s
[16][2];

133 
	mg»©”OÃB™s
[2][5][2];

134 
	mg»©”OÃS‹
[5];

135 
	mblockCbpB™s
[4][2];

137 
e¡_b™s_ÿbac
 
	te¡B™sCabacSŒuù
;

139 
	sËv–_d©a_¡ruù


141 
	mËv–
[3];

142 
	mËv–DoubË
;

143 
	m”rLev–
[3];

144 
	mnoLev–s
;

145 
	mcÛff_ùr
;

146 
	m´e_Ëv–
;

147 
	msign
;

148 } 
	tËv–D©aSŒuù
;

151 
š™_rdoq_¦iû
(
Sliû
 *
cu¼Sliû
);

154 
e¡_RunLev–_CAVLC
(
Maüoblock
 *
cu¼MB
, 
Ëv–D©aSŒuù
 *
Ëv–D©a
, *
Ëv–T»Îis
, 
block_ty³
,

155 
b8
, 
b4
, 
cÛff_num
, 
Ïmbda
);

156 
e¡_CAVLC_b™s
 (
VideoP¬am‘”s
 *
p_Vid
, 
Ëv–_to_’c
[16], 
sign_to_’c
[16], 
Âz
, 
block_ty³
);

159 
´eÿlcuÏ‹_uÇry_exp_gÞomb_Ëv–
(
VideoP¬am‘”s
 *
p_Vid
);

160 
e¡_uÇry_exp_gÞomb_Ëv–_b™s
(
symbÞ
, 
b™s0
, 
b™s1
);

161 
e¡_exp_gÞomb_’code_eq_´ob
 (
symbÞ
);

163 
e¡RunLev–_CABAC
 (
Maüoblock
* 
cu¼MB
, 
cÚ‹xt
);

167 
e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
Maüoblock
* 
cu¼MB
, 
ty³
);

168 
e¡_wr™eRunLev–_CABAC
(
Maüoblock
 *
cu¼MB
, 
Ëv–D©aSŒuù
 
Ëv–D©a
[], 
Ëv–TabMš
[], 
ty³
, 
Ïmbda
, 
kS¹
,

169 
kStÝ
, 
noCÛff
, 
e¡CBP
);

170 
š™_Œ–lis_d©a_4x4_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
,

171 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
, cÚ¡ 
by‹
 *
p_sÿn
,

172 
Ëv–D©aSŒuù
 *
d©aLev–
, 
ty³
);

173 
š™_Œ–lis_d©a_4x4_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
,

174 
quªt_m‘hods
 *
q_m‘hod
, cÚ¡ 
by‹
 *
p_sÿn
,

175 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
, 
ty³
);

176 
š™_Œ–lis_d©a_8x8_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
,

177 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
, cÚ¡ 
by‹
 *
p_sÿn
,

178 
Ëv–D©aSŒuù
 
Ëv–D©a
[4][16]);

179 
š™_Œ–lis_d©a_8x8_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
,

180 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
, cÚ¡ 
by‹
 *
p_sÿn
,

181 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
);

182 
š™_Œ–lis_d©a_DC_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

183 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 *
p_sÿn
,

184 
Ëv–D©aSŒuù
 *
d©aLev–
);

185 
š™_Œ–lis_d©a_DC_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

186 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 *
p_sÿn
,

187 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
);

188 
š™_Œ–lis_d©a_DC_ü_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

189 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 *
p_sÿn
,

190 
Ëv–D©aSŒuù
 *
d©aLev–
);

191 
š™_Œ–lis_d©a_DC_ü_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

192 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 *
p_sÿn
,

193 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
);

195 
RDOQ_upd©e_mode
 (
Sliû
 *
cu¼Sliû
, 
RD_PARAMS
 *
’c_mb
);

196 
cÝy_rdd©a_Œ–lis
 (
Maüoblock
 *
cu¼MB
, 
RD_DATA
 *
de¡
, RD_DATA *
¤c
);

197 
upd©eMV_mp
 (
Maüoblock
 *
cu¼MB
, 
di¡blk
 *
m_co¡
, 
»f
, 
li¡
, 
h
, 
v
, 
blockty³
, 
block8x8
);

198 
Œ–lis_codšg
 (
Maüoblock
 *
cu¼MB
);

199 
g‘_dQP_bË
 (
Sliû
 *
cu¼Sliû
);

	@lencod/inc/refbuf.h

10 #iâdeà
_REBUF_H_


11 
	#_REBUF_H_


	)

13 
	~"mbufãr.h
"

22 
šlše
 
img³l
 *
	$UMVLše4X
 (
StÜabËPiùu»
 *
»f
, 
y
, 
x
)

25  &(
»f
->
p_cu¼_img_sub
[(
y
 & 0x03)][(
x
 & 0x03)][
	`iCl3
Ð-
IMG_PAD_SIZE_Y
,„ef->
size_y_·d
, y >> 2)][iCl3(-
IMG_PAD_SIZE_X
,„ef->
size_x_·d
, x >> 2)]);

26 
	}
}

35 
šlše
 
img³l
 *
	$UMVLše4Xü
 (
StÜabËPiùu»
 *
»f
, 
cmp
, 
y
, 
x
)

38  &(
»f
->
p_img_sub
[
cmp
][(
y
 & 0x03)][(
x
 & 0x03)][
	`iCl3
(-»f->
·d_size_uv_y
,„ef->
size_y_ü_·d
, y >> 2)][iCl3(-»f->
·d_size_uv_x
,„ef->
size_x_ü_·d
, x >> 2)]);

39 
	}
}

48 
šlše
 
img³l
 *
	$Fa¡Lše4X
 (
StÜabËPiùu»
 *
»f
, 
y
, 
x
)

50  &(
»f
->
p_cu¼_img_sub
[(
y
 & 0x03)][(
x
 & 0x03)][y >> 2][x >> 2]);

51 
	}
}

61 
šlše
 
img³l
 *
	$UMVLše8X_chroma
 (
StÜabËPiùu»
 *
»f
, 
cmp
, 
y
, 
x
)

64  &(
»f
->
p_img_sub
[
cmp
][
y
 &„ef->
chroma_mask_mv_y
][
x
 &„ef->
chroma_mask_mv_x
][
	`iCl3
 (-»f->
·d_size_uv_y
,„ef->
size_y_ü_·d
, y >>„ef->
chroma_shiá_y
)][iCl3 (-»f->
·d_size_uv_x
,„ef->
size_x_ü_·d
, x >>„ef->
chroma_shiá_x
)]);

65 
	}
}

75 
šlše
 
img³l
 *
	$Fa¡Lše8X_chroma
 (
StÜabËPiùu»
 *
»f
, 
cmp
, 
y
, 
x
)

77  &(
»f
->
p_img_sub
[
cmp
][
y
 &„ef->
chroma_mask_mv_y
][
x
 &„ef->
chroma_mask_mv_x
][y >>„ef->
chroma_shiá_y
][x >>„ef->
chroma_shiá_x
]);

78 
	}
}

	@lencod/inc/refbuf_otf.h

10 #iâdeà
_REBUF_OTF_H_


11 
	#_REBUF_OTF_H_


	)

13 
	~"mbufãr.h
"

15 
šlše
 
img³l
 *
	$UMVLše4X_Ùf
 (
StÜabËPiùu»
 *
»f
, 
y
, 
x
 )

17  &(
»f
->
p_cu¼_img_sub
[(
y
 & 0x03)>>1][(
x
 & 0x03)>>1][
	`iCl3
Ð-
IMG_PAD_SIZE_Y
,„ef->
size_y_·d
, y >> 2)][iCl3(-
IMG_PAD_SIZE_X
,„ef->
size_x_·d
, x >> 2)]);

18 
	}
}

20 
šlše
 
img³l
 *
	$UMVLše4Xü_Ùf
 (
StÜabËPiùu»
 *
»f
, 
cmp
, 
y
, 
x
)

22  &(
»f
->
p_img_sub
[
cmp
][(
y
 & 0x03)>>1][(
x
 & 0x03)>>1][
	`iCl3
(-»f->
·d_size_uv_y
,„ef->
size_y_ü_·d
, y >> 2)][iCl3(-»f->
·d_size_uv_x
,„ef->
size_x_ü_·d
, x >> 2)]);

23 
	}
}

25 
šlše
 
img³l
 *
	$UMVLše8X_chroma_Ùf
 (
StÜabËPiùu»
 *
»f
, 
cmp
, 
y
, 
x
)

27  &(
»f
->
p_img_sub
[
cmp
][(
y
 &„ef->
chroma_mask_mv_y
)>>1][(
x
 &„ef->
chroma_mask_mv_x
)>>1][
	`iCl3
 (-»f->
·d_size_uv_y
,„ef->
size_y_ü_·d
, y >>„ef->
chroma_shiá_y
)][iCl3 (-»f->
·d_size_uv_x
,„ef->
size_x_ü_·d
, x >>„ef->
chroma_shiá_x
)]);

28 
	}
}

	@lencod/inc/rtp.h

18 #iâdeà
_RTP_H_


19 
	#_RTP_H_


	)

21 
	~"Çlu.h
"

23 
	#MAXRTPPAYLOADLEN
 (65536 - 40)

24 
	#MAXRTPPACKETSIZE
 (65536 - 28)

25 
	#H264PAYLOADTYPE
 105

26 
	#H264SSRC
 0x12345678

27 
	#RTP_TR_TIMESTAMP_MULT
 1000

28 

	)

31 
	mv
;

32 
	mp
;

33 
	mx
;

34 
	mcc
;

36 
	mm
;

37 
	m±
;

38 
	m£q
;

40 
	mtime¡amp
;

41 
	ms¤c
;

42 
by‹
 * 
	m·ylßd
;

43 
	m·yËn
;

44 
by‹
 * 
	m·ck‘
;

45 
	m·ckËn
;

46 } 
	tRTP·ck‘_t
;

48 
RTPUpd©eTime¡amp
 (
VideoP¬am‘”s
 *
p_Vid
, 
Œ
);

49 
O³nRTPFže
 (*
Fž’ame
, 
FILE
 **
f_¹p
);

50 
Clo£RTPFže
 (
FILE
 *
f_¹p
);

51 
Wr™eRTPNALU
 (
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
n
, 
FILE
 **
f_¹p
);

	@lencod/inc/sei.h

15 #iâdeà
SEI_H


16 
	#SEI_H


	)

18 
	#MAX_LAYER_NUMBER
 2

	)

19 
	#MAX_DEPENDENT_SUBSEQ
 5

	)

21 
	#MAX_CODED_BIT_DEPTH
 12

	)

22 
	#MAX_SEI_BIT_DEPTH
 12

	)

23 
	#MAX_NUM_PIVOTS
 (1<<
MAX_CODED_BIT_DEPTH
)

	)

26 
	#MAX_CPB_CNT_MINUS1
 31

	)

27 
	#MAX_PIC_STRUCT_VALUE
 16

	)

28 
	#MAX_FN
 256

	)

30 
	#AGGREGATION_PACKET_TYPE
 4

	)

31 
	#SEI_PACKET_TYPE
 5

32 

	)

33 
	#NORMAL_SEI
 0

	)

34 
	#AGGREGATION_SEI
 1

	)

39 
	mSEI_BUFFERING_PERIOD
 = 0,

40 
	mSEI_PIC_TIMING
,

41 
	mSEI_PAN_SCAN_RECT
,

42 
	mSEI_FILLER_PAYLOAD
,

43 
	mSEI_USER_DATA_REGISTERED_ITU_T_T35
,

44 
	mSEI_USER_DATA_UNREGISTERED
,

45 
	mSEI_RECOVERY_POINT
,

46 
	mSEI_DEC_REF_PIC_MARKING_REPETITION
,

47 
	mSEI_SPARE_PIC
,

48 
	mSEI_SCENE_INFO
,

49 
	mSEI_SUB_SEQ_INFO
,

50 
	mSEI_SUB_SEQ_LAYER_CHARACTERISTICS
,

51 
	mSEI_SUB_SEQ_CHARACTERISTICS
,

52 
	mSEI_FULL_FRAME_FREEZE
,

53 
	mSEI_FULL_FRAME_FREEZE_RELEASE
,

54 
	mSEI_FULL_FRAME_SNAPSHOT
,

55 
	mSEI_PROGRESSIVE_REFINEMENT_SEGMENT_START
,

56 
	mSEI_PROGRESSIVE_REFINEMENT_SEGMENT_END
,

57 
	mSEI_MOTION_CONSTRAINED_SLICE_GROUP_SET
,

58 
	mSEI_FILM_GRAIN_CHARACTERISTICS
,

59 
	mSEI_DEBLOCKING_FILTER_DISPLAY_PREFERENCE
,

60 
	mSEI_STEREO_VIDEO_INFO
,

61 
	mSEI_POST_FILTER_HINTS
,

62 
	mSEI_TONE_MAPPING
,

63 
	mSEI_SCALABILITY_INFO
,

64 
	mSEI_SUB_PIC_SCALABLE_LAYER
,

65 
	mSEI_NON_REQUIRED_LAYER_REP
,

66 
	mSEI_PRIORITY_LAYER_INFO
,

67 
	mSEI_LAYERS_NOT_PRESENT
,

68 
	mSEI_LAYER_DEPENDENCY_CHANGE
,

69 
	mSEI_SCALABLE_NESTING
,

70 
	mSEI_BASE_LAYER_TEMPORAL_HRD
,

71 
	mSEI_QUALITY_LAYER_INTEGRITY_CHECK
,

72 
	mSEI_REDUNDANT_PIC_PROPERTY
,

73 
	mSEI_TL0_DEP_REP_INDEX
,

74 
	mSEI_TL_SWITCHING_POINT
,

75 
	mSEI_PARALLEL_DECODING_INFO
,

76 
	mSEI_MVC_SCALABLE_NESTING
,

77 
	mSEI_VIEW_SCALABILITY_INFO
,

78 
	mSEI_MULTIVIEW_SCENE_INFO
,

79 
	mSEI_MULTIVIEW_ACQUISITION_INFO
,

80 
	mSEI_NON_REQUIRED_VIEW_COMPONENT
,

81 
	mSEI_VIEW_DEPENDENCY_CHANGE
,

82 
	mSEI_OPERATION_POINTS_NOT_PRESENT
,

83 
	mSEI_BASE_VIEW_TEMPORAL_HRD
,

84 
	mSEI_FRAME_PACKING_ARRANGEMENT
,

86 
	mSEI_MAX_ELEMENTS


87 } 
	tSEI_ty³
;

91 
	m£q_·¿m‘”_£t_id
;

92 
	mÇl_š™Ÿl_ýb_»mov®_d–ay
[
MAX_CPB_CNT_MINUS1
+1];

93 
	mÇl_š™Ÿl_ýb_»mov®_d–ay_off£t
[
MAX_CPB_CNT_MINUS1
+1];

94 
	mvþ_š™Ÿl_ýb_»mov®_d–ay
[
MAX_CPB_CNT_MINUS1
+1];

95 
	mvþ_š™Ÿl_ýb_»mov®_d–ay_off£t
[
MAX_CPB_CNT_MINUS1
+1];

97 
B™¡»am
 *
	md©a
;

98 
	m·ylßdSize
;

99 } 
	tbufãršg³riod_šfÜm©iÚ_¡ruù
;

104 
BoÞ—n
 
	mavažabË
;

105 
	m·ylßdSize
;

106 
	msubPack‘Ty³
;

107 
by‹
* 
	md©a
;

108 } 
	t£i_¡ruù
;

113 
	mrg‘_äame_num
;

114 
	mnum_¥¬e_pics
;

115 
	m·ylßdSize
;

116 
B™¡»am
* 
	md©a
;

117 } 
	t¥¬e_piùu»_¡ruù
;

122 
	msub£q_Ïy”_num
;

123 
	msub£q_id
;

124 
	mÏ¡_piùu»_æag
;

125 
	m¡Üed_äame_út
;

127 
	m·ylßdSize
;

128 
B™¡»am
* 
	md©a
;

129 } 
	tsub£q_šfÜm©iÚ_¡ruù
;

134 
ušt16
 
	mb™_¿‹
[
MAX_LAYER_NUMBER
];

135 
ušt16
 
	mäame_¿‹
[
MAX_LAYER_NUMBER
];

136 
by‹
 
	md©a
[4*
MAX_LAYER_NUMBER
];

137 
	mÏy”_numb”
;

138 
	m·ylßdSize
;

139 } 
	tsub£q_Ïy”_šfÜm©iÚ_¡ruù
;

144 
	msub£q_Ïy”_num
;

145 
	msub£q_id
;

146 
	mdu¿tiÚ_æag
;

147 
	msub£q_du¿tiÚ
;

148 
	mav”age_¿‹_æag
;

149 
	mav”age_b™_¿‹
;

150 
	mav”age_äame_¿‹
;

151 
	mnum_»ã»nûd_sub£qs
;

152 
	m»f_sub£q_Ïy”_num
[
MAX_DEPENDENT_SUBSEQ
];

153 
	m»f_sub£q_id
[
MAX_DEPENDENT_SUBSEQ
];

155 
B™¡»am
* 
	md©a
;

156 
	m·ylßdSize
;

157 } 
	tsub£q_ch¬_šfÜm©iÚ_¡ruù
;

161 
	msûÃ_id
;

162 
	msûÃ_Œªs™iÚ_ty³
;

163 
	m£cÚd_sûÃ_id
;

165 
B™¡»am
* 
	md©a
;

166 
	m·ylßdSize
;

167 } 
	tsûÃ_šfÜm©iÚ_¡ruù
;

172 
	m·n_sÿn_»ù_id
;

173 
	m·n_sÿn_»ù_ÿnûl_æag
;

174 
	m·n_sÿn_út_mšus1
;

175 
	m·n_sÿn_»ù_Ëá_off£t
[3];

176 
	m·n_sÿn_»ù_right_off£t
[3];

177 
	m·n_sÿn_»ù_tÝ_off£t
[3];

178 
	m·n_sÿn_»ù_bÙtom_off£t
[3];

179 
	m·c_sÿn_»ù_»³t™iÚ_³riod
;

181 
B™¡»am
 *
	md©a
;

182 
	m·ylßdSize
;

183 } 
	t·nsÿÄeù_šfÜm©iÚ_¡ruù
;

187 *
	mby‹
;

188 
	mtÙ®_by‹
;

189 
B™¡»am
 *
	md©a
;

190 
	m·ylßdSize
;

191 } 
	tu£r_d©a_uÄegi¡”ed_šfÜm©iÚ_¡ruù
;

196 *
	mby‹
;

197 
	mtÙ®_by‹
;

198 
	m™u_t_t35_couÁry_code
;

199 
	m™u_t_t35_couÁry_code_ex‹nsiÚ_by‹
;

200 
B™¡»am
 *
	md©a
;

201 
	m·ylßdSize
;

202 } 
	tu£r_d©a_»gi¡”ed_™u_t_t35_šfÜm©iÚ_¡ruù
;

207 
	m»cov”y_äame_út
;

208 
	mexaù_m©ch_æag
;

209 
	mbrok’_lšk_æag
;

210 
	mchªgšg_¦iû_group_idc
;

212 
B™¡»am
 *
	md©a
;

213 
	m·ylßdSize
;

214 } 
	t»cov”y_pošt_šfÜm©iÚ_¡ruù
;

219 
	mýb_»mov®_d–ay
;

220 
	mdpb_ouut_d–ay
;

221 
	mpic_¡ruù
;

222 
BoÞ—n
 
	mþock_time¡amp_æag
[
MAX_PIC_STRUCT_VALUE
];

223 
	mù_ty³
;

224 
BoÞ—n
 
	mnu™_f›ld_ba£d_æag
;

225 
	mcouÁšg_ty³
;

226 
BoÞ—n
 
	mfuÎ_time¡amp_æag
;

227 
BoÞ—n
 
	mdiscÚtšu™y_æag
;

228 
BoÞ—n
 
	mút_drÝ³d_æag
;

229 
	mn_äames
;

230 
	m£cÚds_v®ue
;

231 
	mmšu‹s_v®ue
;

232 
	mhours_v®ue
;

233 
BoÞ—n
 
	m£cÚds_æag
;

234 
BoÞ—n
 
	mmšu‹s_æag
;

235 
BoÞ—n
 
	mhours_æag
;

236 
	mtime_off£t
;

238 
B™¡»am
 *
	md©a
;

239 
	m·ylßdSize
;

240 } 
	tpiùimšg_šfÜm©iÚ_¡ruù
;

246 
BoÞ—n
 
	mÜigš®_idr_æag
;

247 
	mÜigš®_äame_num
;

248 
BoÞ—n
 
	mÜigš®_f›ld_pic_æag
;

249 
BoÞ—n
 
	mÜigš®_bÙtom_f›ld_æag
;

250 
DecRefPicM¬kšg_t
 *
	mdec_»f_pic_m¬kšg_bufãr_§ved
;

252 
B™¡»am
 *
	md©a
;

253 
	m·ylßdSize
;

254 } 
	td½m_»³t™iÚ_šfÜm©iÚ_¡ruù
;

260 
	mäame_·ckšg_¬¿ngem’t_id
;

261 
BoÞ—n
 
	mäame_·ckšg_¬¿ngem’t_ÿnûl_æag
;

262 
	mäame_·ckšg_¬¿ngem’t_ty³
;

263 
BoÞ—n
 
	mqušcunx_§m¶šg_æag
;

264 
	mcÚ‹Á_š‹½»tiÚ_ty³
;

265 
BoÞ—n
 
	m¥©Ÿl_æpšg_æag
;

266 
BoÞ—n
 
	mäame0_æ³d_æag
;

267 
BoÞ—n
 
	mf›ld_v›ws_æag
;

268 
BoÞ—n
 
	mcu¼’t_äame_is_äame0_æag
;

269 
BoÞ—n
 
	mäame0_£lf_cÚšed_æag
;

270 
BoÞ—n
 
	mäame1_£lf_cÚšed_æag
;

271 
	mäame0_grid_pos™iÚ_x
;

272 
	mäame0_grid_pos™iÚ_y
;

273 
	mäame1_grid_pos™iÚ_x
;

274 
	mäame1_grid_pos™iÚ_y
;

275 
	mäame_·ckšg_¬¿ngem’t_»£rved_by‹
;

276 
	mäame_·ckšg_¬¿ngem’t_»³t™iÚ_³riod
;

277 
BoÞ—n
 
	mäame_·ckšg_¬¿ngem’t_ex‹nsiÚ_æag
;

279 
B™¡»am
 *
	md©a
;

280 
	m·ylßdSize
;

281 } 
	täame_·ckšg_¬¿ngem’t_šfÜm©iÚ_¡ruù
;

287 
	mfž‹r_hšt_size_y
;

288 
	mfž‹r_hšt_size_x
;

289 
	mfž‹r_hšt_ty³
;

290 ***
	mfž‹r_hšt
;

291 
	madd™iÚ®_ex‹nsiÚ_æag
;

293 
B™¡»am
 *
	md©a
;

294 
	m·ylßdSize
;

295 } 
	tpo¡_fž‹r_šfÜm©iÚ_¡ruù
;

299 
	mtÚe_m­_id
;

300 
	mtÚe_m­_ÿnûl_æag
;

301 
	mtÚe_m­_»³t™iÚ_³riod
;

302 
	mcoded_d©a_b™_d•th
;

303 
	m£i_b™_d•th
;

304 
	mmod–_id
;

306 
	mmš_v®ue
;

307 
	mmax_v®ue
;

309 
	msigmoid_midpošt
;

310 
	msigmoid_width
;

312 
	m¡¬t_of_coded_š‹rv®
[1<<
MAX_SEI_BIT_DEPTH
];

314 
	mnum_pivÙs
;

315 
	mcoded_pivÙ_v®ue
[
MAX_NUM_PIVOTS
];

316 
	m£i_pivÙ_v®ue
[
MAX_NUM_PIVOTS
];

318 
B™¡»am
 *
	md©a
;

319 
	m·ylßdSize
;

320 } 
	tTÚeM­pšgSEI
;

323 
	s£i_·¿ms
 {

324 
BoÞ—n
 
	m£iHasDRPMR•‘™iÚ_šfo
;

325 
d½m_»³t™iÚ_šfÜm©iÚ_¡ruù
 
	m£iDRPMR•‘™iÚ
;

329 
£i_¡ruù
 
	m£i_mes§ge
[2];

330 
BoÞ—n
 
	m£iHasS·»Piùu»
;

332 
¥¬e_piùu»_¡ruù
 
	m£iS·»Piùu»Paylßd
;

333 
BoÞ—n
 
	m£iHasSub£qInfo
;

334 
sub£q_šfÜm©iÚ_¡ruù
 
	m£iSub£qInfo
[
MAX_LAYER_NUMBER
];

335 
BoÞ—n
 
	m£iHasSub£qLay”Info
;

336 
sub£q_Ïy”_šfÜm©iÚ_¡ruù
 
	m£iSub£qLay”Info
;

337 
BoÞ—n
 
	m£iHasSub£qCh¬
;

338 
sub£q_ch¬_šfÜm©iÚ_¡ruù
 
	m£iSub£qCh¬
;

339 
BoÞ—n
 
	m£iHasSûÃInfÜm©iÚ
;

340 
sûÃ_šfÜm©iÚ_¡ruù
 
	m£iSûÃInfÜm©iÚ
;

341 
BoÞ—n
 
	m£iHasPªSÿnReùInfo
;

342 
·nsÿÄeù_šfÜm©iÚ_¡ruù
 
	m£iPªSÿnReùInfo
;

343 
BoÞ—n
 
	m£iHasU£r_d©a_uÄegi¡”ed_šfo
;

344 
u£r_d©a_uÄegi¡”ed_šfÜm©iÚ_¡ruù
 
	m£iU£r_d©a_uÄegi¡”ed
;

345 
BoÞ—n
 
	m£iHasU£r_d©a_»gi¡”ed_™u_t_t35_šfo
;

346 
u£r_d©a_»gi¡”ed_™u_t_t35_šfÜm©iÚ_¡ruù
 
	m£iU£r_d©a_»gi¡”ed_™u_t_t35
;

347 
BoÞ—n
 
	m£iHasRecov”yPošt_šfo
;

348 
»cov”y_pošt_šfÜm©iÚ_¡ruù
 
	m£iRecov”yPošt
;

349 
BoÞ—n
 
	m£iHasBufãršgP”iod_šfo
;

350 
bufãršg³riod_šfÜm©iÚ_¡ruù
 
	m£iBufãršgP”iod
;

351 
BoÞ—n
 
	m£iHasPicTimšg_šfo
;

352 
piùimšg_šfÜm©iÚ_¡ruù
 
	m£iPicTimšg
;

353 
BoÞ—n
 
	m£iHasF¿mePackšgA¼ªgem’t_šfo
;

354 
äame_·ckšg_¬¿ngem’t_šfÜm©iÚ_¡ruù
 
	m£iF¿mePackšgA¼ªgem’t
;

356 
BoÞ—n
 
	m£iHasTÚe_m­pšg
;

357 
TÚeM­pšgSEI
 
	m£iTÚeM­pšg
;

358 
BoÞ—n
 
	m£iHasPo¡Fž‹rHšts_šfo
;

359 
po¡_fž‹r_šfÜm©iÚ_¡ruù
 
	m£iPo¡Fž‹rHšts
;

361 
BoÞ—n
 
	m£iHasTempÜ®_»ã»nû
;

362 
BoÞ—n
 
	m£iHasClock_time¡amp
;

363 
BoÞ—n
 
	m£iHasPªsÿn_»ù
;

364 
BoÞ—n
 
	m£iHasHrd_piùu»
;

365 
BoÞ—n
 
	m£iHasFžËr_·ylßd
;

366 
BoÞ—n
 
	m£iHasU£r_d©a_»gi¡”ed_™u_t_t35
;

367 
BoÞ—n
 
	m£iHasU£r_d©a_uÄegi¡”ed
;

368 
BoÞ—n
 
	m£iHasRef_pic_bufãr_mªagem’t_»³t™iÚ
;

369 
BoÞ—n
 
	m£iHasS·»_piùu»
;

370 
BoÞ—n
 
	m£iHasSub£q_šfÜm©iÚ
;

371 
BoÞ—n
 
	m£iHasSub£q_Ïy”_ch¬aù”i¡ics
;

372 
BoÞ—n
 
	m£iHasSub£q_ch¬aù”i¡ics
;

376 
£i_·¿ms
 
	tSEIP¬am‘”s
;

379 
In™SEIMes§ges
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

380 
Clo£SEIMes§ges
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

381 
BoÞ—n
 
HaveAgg»g©iÚSEI
(
VideoP¬am‘”s
 *
p_Vid
);

383 
þ—r_£i_mes§ge
 (
SEIP¬am‘”s
 *
p_SEI
, 
id
);

384 
Aµ’dTmpb™s2Buf
 ( 
B™¡»am
* 
de¡
, B™¡»am* 
sourû
 );

385 
P»·»Agg»g©iÚSEIMes§ge
(
VideoP¬am‘”s
 *
p_Vid
);

386 
C®cuÏ‹S·»Piùu»
();

387 
BoÞ—n
 
Com´essS·»MBM­
(
VideoP¬am‘”s
 *
p_Vid
, **
m­_¥
, 
B™¡»am
 *
b™¡»am
);

389 
In™Sub£qInfo
(
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
);

390 
Upd©eSub£qInfo
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
cu¼Lay”
);

391 
Clo£Sub£qInfo
 (
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
);

392 
Clo£Sub£qLay”Info
();

393 
Upd©eSub£qCh¬
(
VideoP¬am‘”s
 *
p_Vid
);

395 
In™SûÃInfÜm©iÚ
 (
SEIP¬am‘”s
 *
p_SEI
);

396 
Clo£SûÃInfÜm©iÚ
 (
SEIP¬am‘”s
 *
p_SEI
);

397 
Upd©eSûÃInfÜm©iÚ
 (
SEIP¬am‘”s
 *
p_SEI
, 
BoÞ—n
 
HasSûÃInfÜm©iÚ
, 
sûÃID
, 
sûÃT¿nsTy³
, 
£cÚdSûÃID
);

398 
Fš®izeSûÃInfÜm©iÚ
 (
SEIP¬am‘”s
 *
p_SEI
);

399 
Upd©ePªSÿnReùInfo
 (
VideoP¬am‘”s
 *
p_Vid
);

400 
CË¬PªSÿnReùInfoPaylßd
 (
SEIP¬am‘”s
 *
p_SEI
);

402 
Upd©eU£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
);

403 
Upd©eU£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
);

405 
CË¬RªdomAcûss
(
SEIP¬am‘”s
 *
p_SEI
);

406 
Upd©eRªdomAcûss
(
VideoP¬am‘”s
 *
p_Vid
);

408 
Upd©eTÚeM­pšg
(
SEIP¬am‘”s
 *
p_SEI
);

410 
š™_£i
(
SEIP¬am‘”s
 *
p_SEI
);

411 
Wr™e_SEI_NALU
(
VideoP¬am‘”s
 *
p_Vid
, 
Ën
);

413 
In™BufãršgP”iod
 (
VideoP¬am‘”s
 *
p_Vid
);

414 
CË¬BufãršgP”iod
 (
SEIP¬am‘”s
 *
p_SEI
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
);

415 
Upd©eBufãršgP”iod
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

417 
CË¬PicTimšg
(
SEIP¬am‘”s
 *
p_SEI
);

418 
Upd©ePicTimšg
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

420 
CË¬DRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
);

421 
Upd©eDRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
);

422 
ä“_d½m_bufãr
Ð
DecRefPicM¬kšg_t
 *
pDRPM
 );

424 
Upd©ePo¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
);

426 
Compo£S·»Piùu»Mes§ge
 (
SEIP¬am‘”s
 *
p_SEI
, 
d–_¥¬e_äame_num
, 
»f_¬—_šdiÿtÜ
, 
B™¡»am
 *
tmpB™¡»am
);

428 
CË¬F¿mePackšgA¼ªgem’t
(
SEIP¬am‘”s
 *
p_SEI
);

429 
Upd©eF¿mePackšgA¼ªgem’t
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

	@lencod/inc/slice.h

20 #iâdeà
_SLICE_H_


21 
	#_SLICE_H_


	)

23 
	~"glob®.h
"

24 
	~"mbufãr.h
"

25 
	~"rdÝt_codšg_¡©e.h
"

27 cÚ¡ 
	gQP2QUANT
[40]=

37 
’code_Úe_¦iû
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupId
, 
TÙ®CodedMBs
 );

38 
’code_Úe_¦iû_MBAFF
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupId
, 
TÙ®CodedMBs
 );

39 
š™_¦iû
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 **
cu¼Sliû
, 
¡¬t_mb_addr
 );

40 
š™_¦iû_l™e
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 **
cu¼Sliû
, 
¡¬t_mb_addr
 );

41 
ä“_¦iû_li¡
 ( 
Piùu»
 *
cu¼Pic
 );

43 
S‘Lag¿ngŸnMuÉl›rsOn
 (
Sliû
 *
cu¼Sliû
);

44 
S‘Lag¿ngŸnMuÉl›rsOff
(
Sliû
 *
cu¼Sliû
);

45 
ä“_¦iû
 (
Sliû
 *
cu¼Sliû
);

	@lencod/inc/symbol.h

16 
	swr™eMB
 {

17 (*
	mwr™eMB_ty³Info
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

18 (*
	mwr™eIÁ¿P»dMode
è(
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

19 (*
	mwr™eB8_ty³Info
è(
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

20 (*
	mwr™eRefF¿me
[6]è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

21 (*
	mwr™eMVD
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

22 (*
	mwr™eCBP
è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

23 (*
	mwr™eDquªt
è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

24 (*
	mwr™eCIP»dMode
è(
Maüoblock
* 
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

25 (*
	mwr™eF›ldModeInfo
è(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

26 (*
	mwr™eMB_ŒªsfÜm_size
)(
Maüoblock
 *
	mcu¼MB
, 
SyÁaxEËm’t
 *
	m£
, 
D©aP¬t™iÚ
 *
	mdP
);

	@lencod/inc/transform8x8.h

18 #iâdeà
_TRANSFORM8X8_H_


19 
	#_TRANSFORM8X8_H_


	)

20 
mode_decisiÚ_fÜ_I8x8_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
);

21 
mode_decisiÚ_fÜ_I8x8_blocks_JM_Low
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
);

22 
mode_decisiÚ_fÜ_I8x8_blocks_JM_High
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
);

23 
mode_decisiÚ_fÜ_I8x8_blocks_JM_Low444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
);

24 
mode_decisiÚ_fÜ_I8x8_blocks_JM_High444
(
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
);

26 
di¡blk
 
rdco¡_fÜ_8x8_šŒa_blocks
 (
Maüoblock
 *
cu¼MB
, *
c_nz
, 
b8
, 
mode
, 
Ïmbda
, di¡blk 
mš_rdco¡
, 
mo¡ProbabËMode
);

27 
di¡blk
 
rdco¡_fÜ_8x8_šŒa_blocks_444
 (
Maüoblock
 *
cu¼MB
, *
c_nz
, 
b8
, 
mode
, 
Ïmbda
, di¡blk 
mš_rdco¡
, 
mo¡ProbabËMode
);

28 
di¡blk
 
compu‹_§td8x8_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

29 
di¡blk
 
compu‹_s£8x8_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

30 
di¡blk
 
compu‹_§d8x8_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

31 
di¡blk
 
compu‹_comp8x8_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

33 
»sidu®_ŒªsfÜm_quªt_luma_8x8
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
);

34 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
);

35 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ls
 (
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
);

	@lencod/inc/vlc.h

13 #iâdeà
_VLC_H_


14 
	#_VLC_H_


	)

16 
	~"’c_¡©i¡ics.h
"

18 
BoÞ—n
 
wr™e_u_1
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
);

19 
wr™e_£_v
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
);

20 
wr™e_ue_v
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
);

21 
wr™e_u_v
 (
n
, *
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
);

23 
Ëvrun_lšfo_c2x2
(
Ëv–
,
run
,*
Ën
,*
šfo
);

24 
Ëvrun_lšfo_š‹r
(
Ëv–
,
run
,*
Ën
,*
šfo
);

26 
wr™eSE_Fix
 (
SyÁaxEËm’t
 *
£
, 
B™¡»am
 *
b™¡»am
);

27 
wr™eSE_UVLC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

28 
wr™eSE_SVLC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

29 
wr™eSE_FÏg
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

30 
wr™eSE_švFÏg
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

31 
wr™eSE_Dummy
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

33 
wr™eRefPic_NRef_CAVLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

34 
wr™eRefPic_2Ref_CAVLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

35 
wr™eRefPic_Dummy
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

37 
wr™eCBP_VLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

38 
wr™eIÁ¿P»dMode_CAVLC
 (
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

39 
wr™eSyÁaxEËm’t2Buf_UVLC
 (
SyÁaxEËm’t
 *
£
, 
B™¡»am
* 
this_¡»amBufãr
 );

40 
wr™eUVLC2bufãr
 (
SyÁaxEËm’t
 *
£
, 
B™¡»am
 *
cu¼SŒ—m
);

41 
wr™eVlcBy‹Align
 (
VideoP¬am‘”s
 *
p_Vid
, 
B™¡»am
* 
cu¼SŒ—m
, 
StP¬am‘”s
 *
cur_¡©s
);

42 
wr™eSyÁaxEËm’t2Buf_Fixed
(
SyÁaxEËm’t
 *
£
, 
B™¡»am
* 
this_¡»amBufãr
 );

43 
symbÞ2uvlc
 (
SyÁaxEËm’t
 *
£
);

44 
ue_lšfo
 (
n
, 
dummy
, *
Ën
,*
šfo
);

45 
£_lšfo
 (
mvd
, 
dummy
, *
Ën
,*
šfo
);

46 
cbp_lšfo_šŒa_nÜm®
(
cbp
, 
dummy
, *
Ën
,*
šfo
);

47 
cbp_lšfo_šŒa_Ùh”
 (
cbp
, 
dummy
, *
Ën
,*
šfo
);

48 
cbp_lšfo_š‹r_nÜm®
(
cbp
, 
dummy
, *
Ën
,*
šfo
);

49 
cbp_lšfo_š‹r_Ùh”
 (
cbp
, 
dummy
, *
Ën
,*
šfo
);

51 
wr™eSyÁaxEËm’t_VLC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

52 
wr™eSyÁaxEËm’t_TÙ®Z”os
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

53 
wr™eSyÁaxEËm’t_TÙ®Z”osChromaDC
(
VideoP¬am‘”s
 *
p_Vid
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

54 
wr™eSyÁaxEËm’t_Run
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

55 
wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃs
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

56 
wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃsChromaDC
(
VideoP¬am‘”s
 *
p_Vid
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
);

57 
wr™eSyÁaxEËm’t_Lev–_VLC1
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
, 
´ofže_idc
);

58 
wr™eSyÁaxEËm’t_Lev–_VLCN
(
SyÁaxEËm’t
 *
£
, 
vlc
, 
D©aP¬t™iÚ
 *
this_d©aP¬t
, 
´ofže_idc
);

60 
wr™eUVLC_CAVLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

61 
wr™eSVLC_CAVLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

62 
wr™eFÏg_CAVLC
 (
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
);

64 
»£t_mb_nz_cÛff
(
VideoP¬am‘”s
 *
p_Vid
, 
mb_numb”
);

65 
bs_b™Ëngth
(
B™¡»am
 *
b™¡»am
);

66 
G‘B™s
(
by‹
 *
bufãr
,

67 
tÙb™off£t
,

68 *
šfo
,

69 
b™couÁ
,

70 
numb™s
);

	@lencod/inc/wp.h

17 #iâdeà
_WP_H_


18 
	#_WP_H_


	)

20 
	~"wp_lms.h
"

21 
	~"wp_mý»c.h
"

22 
	~"wp_mc™”.h
"

23 
	~"wp_¿ndom.h
"

24 
	~"wp_³riodic.h
"

26 
	#DEBUG_WP
 0

	)

28 
In™WP
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
fÜû_wp_m‘hod
);

29 
Re£tWP
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

31 
E¡im©eWPBSliûAlg0
 (
Sliû
 *
cu¼Sliû
);

32 
E¡im©eWPPSliûAlg0
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

33 
Te¡WPPSliûAlg0
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

34 
Te¡WPBSliûAlg0
 (
Sliû
 *
cu¼Sliû
, 
m‘hod
);

35 
Compu‹ImgSum
 (
img³l
 **
Cu¼’tImage
, 
height
, 
width
);

36 
Compu‹ImgSumBlockBa£d
(
img³l
 **
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
¡¬t_blk
, 
’d_blk
, *
dc
);

37 
št64
 
Compu‹SumBlockBa£d
 (
img³l
 **
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
¡¬t_blk
, 
’d_blk
);

39 
Compu‹Im¶ic™Weights
 (
Sliû
 *
cu¼Sliû
,

40 
deçuÉ_weight
[3],

41 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3]);

	@lencod/inc/wp_lms.h

17 #iâdeà
_WP_LMS_H_


18 
	#_WP_LMS_H_


	)

20 
E¡im©eWPPSliûAlg1
(
Sliû
 *
cu¼Sliû
, 
off£t
);

21 
E¡im©eWPBSliûAlg1
(
Sliû
 *
cu¼Sliû
);

22 
Te¡WPPSliûAlg1
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

23 
Te¡WPBSliûAlg1
 (
Sliû
 *
cu¼Sliû
, 
m‘hod
);

24 
Compu‹Ex¶ic™WPP¬amsLMS
(
Sliû
 *
cu¼Sliû
,

25 
£Ëù_off£t
,

26 
¡¬t_mb
,

27 
’d_mb
,

28 
deçuÉ_weight
[3],

29 
weight
[6][
MAX_REFERENCE_PICTURES
][3],

30 
off£t
[6][
MAX_REFERENCE_PICTURES
][3]);

31 
Compu‹Ex¶ic™WPP¬amsJNT
(
Sliû
 *
cu¼Sliû
,

32 
¡¬t_mb
,

33 
’d_mb
,

34 
deçuÉ_weight
[3],

35 
weight
[6][
MAX_REFERENCE_PICTURES
][3],

36 
off£t
[6][
MAX_REFERENCE_PICTURES
][3]);

	@lencod/inc/wp_mciter.h

17 #iâdeà
_WP_MCITERM_H_


18 
	#_WP_MCITERM_H_


	)

21 
E¡im©eWPBSliûAlg2
(
Sliû
 *
cu¼Sliû
);

22 
E¡im©eWPPSliûAlg2
(
Sliû
 *
cu¼Sliû
, 
off£t
);

23 
Te¡WPPSliûAlg2
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

24 
Te¡WPBSliûAlg2
 (
Sliû
 *
cu¼Sliû
, 
m‘hod
);

26 
compu‹_off£t
 (
Sliû
 *
cu¼Sliû
);

	@lencod/inc/wp_mcprec.h

18 #iâdeà
_WP_MCPREC_H_


19 
	#_WP_MCPREC_H_


	)

23 
	mPicNum
;

24 
	mPOCNum
;

26 
	tWeigh‹dP»dRefX
;

30 
	m®gÜ™hm
;

32 
	tWPXPass
;

34 
	swpx_objeù


36 
	mnum_wp_»f_li¡
[2];

37 
Weigh‹dP»dRefX
 *
	mwp_»f_li¡
[2];

38 
WPXPass
 *
	mcu¼_wp_rd_·ss
;

39 
WPXPass
 
	mwp_rd_·s£s
[3];

41 
	tWPXObjeù
;

43 
wpxIn™WPXObjeù
Ð
VideoP¬am‘”s
 *
p_Vid
 );

44 
wpxF»eWPXObjeù
Ð
VideoP¬am‘”s
 *
p_Vid
 );

45 
wpxIn™WPXPas£s
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 );

46 
wpxModifyRefPicLi¡
Ð
Sliû
 *
cu¼Sliû
 );

49 
wpxD‘”mšeWP
Ð
Sliû
 *
cu¼Sliû
, 
þi¡
, 
n
 );

50 
wpxAd­tRefNum
Ð
Sliû
 *
cu¼Sliû
 );

	@lencod/inc/wp_periodic.h

17 #iâdeà
_WP_PERIODIC_H_


18 
	#_WP_PERIODIC_H_


	)

20 
E¡im©eWPPSliûP”iodic
(
Sliû
 *
cu¼Sliû
, 
off£t
);

21 
E¡im©eWPBSliûP”iodic
(
Sliû
 *
cu¼Sliû
);

22 
Te¡WPPSliûP”iodic
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

23 
Te¡WPBSliûP”iodic
 (
Sliû
 *
cu¼Sliû
, 
m‘hod
);

	@lencod/inc/wp_random.h

17 #iâdeà
_WP_RANDOM_H_


18 
	#_WP_RANDOM_H_


	)

20 
E¡im©eWPPSliûRªdom
(
Sliû
 *
cu¼Sliû
, 
off£t
);

21 
E¡im©eWPBSliûRªdom
(
Sliû
 *
cu¼Sliû
);

22 
Te¡WPPSliûRªdom
 (
Sliû
 *
cu¼Sliû
, 
off£t
);

23 
Te¡WPBSliûRªdom
 (
Sliû
 *
cu¼Sliû
, 
m‘hod
);

	@lencod/src/annexb.c

15 
	~"glob®.h
"

16 
	~"ÇlucommÚ.h
"

28 
	$Wr™eAÂexbNALU
 (
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
n
, 
FILE
 **
f_ªÃxb
)

30 
B™sWr™‹n
 = 0;

31 
off£t
 = 0;

32 
Ëngth
 = 4;

33 cÚ¡ 
by‹
 
¡¬tcode
[] = {0,0,0,1};

34 
by‹
 
fœ¡_by‹
;

36 
	`as£¹
 (
n
 !ð
NULL
);

37 
	`as£¹
 (
n
->
fÜbidd’_b™
 == 0);

38 
	`as£¹
 ((*
f_ªÃxb
è!ð
NULL
);

39 
	`as£¹
 (
n
->
¡¬tcod•»fix_Ën
 == 3 ||‚->startcodeprefix_len == 4);

42 ià(
n
->
¡¬tcod•»fix_Ën
 < 4)

44 
off£t
 = 1;

45 
Ëngth
 = 3;

48 iàÐ
Ëngth
 !ð(è
	`fwr™e
 (
¡¬tcode
+
off£t
, 1,†’gth, *
f_ªÃxb
))

50 
	`´štf
 ("F©®: cªnÙ wr™%d by‹ tØb™¡»am fže,ƒx™ (-1)\n", 
Ëngth
);

51 
	`ex™
 (-1);

54 
B™sWr™‹n
 = (
Ëngth
) << 3;

56 
fœ¡_by‹
 = (è((
n
->
fÜbidd’_b™
 << 7è| (n->
Çl_»ã»nû_idc
 << 5è|‚->
Çl_un™_ty³
);

58 iàÐ1 !ð
	`fwr™e
 (&
fœ¡_by‹
, 1, 1, *
f_ªÃxb
))

60 
	`´štf
 ("Fatal: cannot write %d byteso bitstream file,ƒxit (-1)\n", 1);

61 
	`ex™
 (-1);

64 
B™sWr™‹n
 += 8;

67 #ià(
MVC_EXTENSION_ENABLE
)

68 if(
n
->
Çl_un™_ty³
==
NALU_TYPE_PREFIX
 ||‚->Çl_un™_ty³==
NALU_TYPE_SLC_EXT
)

70 
v›w_id
 = 
p_Vid
->
p_IÅ
->
MVCFlV›ws
 ? !(
n
->view_id) :‚->view_id;

72 
fœ¡_by‹
 = (è((
n
->
svc_ex‹nsiÚ_æag
 << 7è| (n->
nÚ_idr_æag
 << 6è|‚->
´iÜ™y_id
);

73 iàÐ1 !ð
	`fwr™e
 (&
fœ¡_by‹
, 1, 1, *
f_ªÃxb
))

75 
	`´štf
 ("Fatal: cannot write %d byteso bitstream file,ƒxit (-1)\n", 1);

76 
	`ex™
 (-1);

78 
B™sWr™‹n
 += 8;

80 
fœ¡_by‹
 = (è(
v›w_id
 >> 2);

81 iàÐ1 !ð
	`fwr™e
 (&
fœ¡_by‹
, 1, 1, *
f_ªÃxb
))

83 
	`´štf
 ("Fatal: cannot write %d byteso bitstream file,ƒxit (-1)\n", 1);

84 
	`ex™
 (-1);

86 
B™sWr™‹n
 += 8;

88 
fœ¡_by‹
 = (è(((
v›w_id
&3è<< 6è| (
n
->
‹mpÜ®_id
 << 3è| (n->
ªchÜ_pic_æag
 << 2è| (n->
š‹r_v›w_æag
 << 1è|‚->
»£rved_Úe_b™
);

89 iàÐ1 !ð
	`fwr™e
 (&
fœ¡_by‹
, 1, 1, *
f_ªÃxb
))

91 
	`´štf
 ("Fatal: cannot write %d byteso bitstream file,ƒxit (-1)\n", 1);

92 
	`ex™
 (-1);

94 
B™sWr™‹n
 += 8;

98 ià(
n
->
Ën
 !ð
	`fwr™e
 (n->
buf
, 1,‚->Ën, *
f_ªÃxb
))

100 
	`´štf
 ("F©®: cªnÙ wr™%d by‹ tØb™¡»am fže,ƒx™ (-1)\n", 
n
->
Ën
);

101 
	`ex™
 (-1);

103 
B™sWr™‹n
 +ð
n
->
Ën
 * 8;

105 
	`fæush
 (*
f_ªÃxb
);

106 #ià
TRACE


109 
	`årštf
 (
p_Enc
->
p_Œaû
, "\nAÂex B NALU w/ % ¡¬tcode,†’ %d,", 
n
->
¡¬tcod•»fix_Ën
 =ð4?"lÚg":"shÜt",‚->
Ën
 + 1);

110 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À fÜbidd’_b™ %d,", 
n
->
fÜbidd’_b™
);

111 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À‚®_»ã»nû_idø %d,", 
n
->
Çl_»ã»nû_idc
);

112 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À‚®_un™_ty³ %d ", 
n
->
Çl_un™_ty³
);

113 #ià(
MVC_EXTENSION_ENABLE
)

114 if(
n
->
Çl_un™_ty³
==
NALU_TYPE_PREFIX
 ||‚->Çl_un™_ty³==
NALU_TYPE_SLC_EXT
)

116 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À svc_ex‹nsiÚ_æag %d ", 
n
->
svc_ex‹nsiÚ_æag
);

117 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À‚Ú_idr_æag %d ", 
n
->
nÚ_idr_æag
);

118 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À…riÜ™y_id %d ", 
n
->
´iÜ™y_id
);

120 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À v›w_id %d ", 
p_Vid
->
p_IÅ
->
MVCFlV›ws
 ? !(
n
->
v›w_id
) :‚->view_id);

121 
	`årštf
 (
p_Enc
->
p_Œaû
, "\ÀempÜ®_id %d ", 
n
->
‹mpÜ®_id
);

122 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À‡nchÜ_pic_æag %d ", 
n
->
ªchÜ_pic_æag
);

123 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À iÁ”_v›w_æag %d ", 
n
->
š‹r_v›w_æag
);

124 
	`årštf
 (
p_Enc
->
p_Œaû
, "\À„e£rved_Úe_b™ %d ", 
n
->
»£rved_Úe_b™
);

127 
	`årštf
 (
p_Enc
->
p_Œaû
, "\n----------------------------------------------------------------------------\n\n\n");

128 
	`fæush
 (
p_Enc
->
p_Œaû
);

130  
B™sWr™‹n
;

131 
	}
}

149 
	$O³nAÂexbFže
 (*
Fž’ame
, 
FILE
 **
f_ªÃxb
)

151 ià(((*
f_ªÃxb
èð
	`fÝ’
 (
Fž’ame
, "wb")è=ð
NULL
)

153 
	`´štf
 ("F©®: cªnÙ o³ÀAÂex B by‹¡»am fž'%s',ƒx™ (-1)\n", 
Fž’ame
);

154 
	`ex™
 (-1);

156 
	}
}

168 
	$Clo£AÂexbFže
(
FILE
 *
f_ªÃxb
)

170 ià(
	`fþo£
 (
f_ªÃxb
))

172 
	`´štf
 ("Fatal: cannot close Annex B bytestream file,ƒxit (-1)\n");

173 
	`ex™
 (-1);

175 
	}
}

	@lencod/src/biariencode.c

20 
	~"glob®.h
"

21 
	~"bŸr›ncode.h
"

24 cÚ¡ 
by‹
 
	g»nÜm_bË_32
[32]={6,5,4,4,3,3,3,3,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1};

27 
	$»£t_pic_bš_couÁ
(
VideoP¬am‘”s
 *
p_Vid
)

29 
p_Vid
->
pic_bš_couÁ
 = 0;

30 
	}
}

32 
	$g‘_pic_bš_couÁ
(
VideoP¬am‘”s
 *
p_Vid
)

34  
p_Vid
->
pic_bš_couÁ
;

35 
	}
}

43 
EncodšgEnvœÚm’tPŒ
 
	$¬›nco_ü—‹_’codšg_’vœÚm’t
()

45 
EncodšgEnvœÚm’tPŒ
 
“p
;

47 iàÐ(
“p
 = (
EncodšgEnvœÚm’tPŒ
è
	`ÿÎoc
(1,(
EncodšgEnvœÚm’t
))è=ð
NULL
)

48 
	`no_mem_ex™
("arienco_create_encoding_environment:ƒep");

50  
“p
;

51 
	}
}

59 
	$¬›nco_d–‘e_’codšg_’vœÚm’t
(
EncodšgEnvœÚm’tPŒ
 
“p
)

61 
	`ä“_poš‹r
(
“p
);

62 
	}
}

70 
šlše
 
	$put_Úe_by‹_fš®
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
b
)

72 
“p
->
Ecode¡rm
[(*“p->
Ecode¡rm_Ën
)++] = (
by‹
è
b
;

73 
	}
}

75 
fÜûšlše
 
	$put_bufãr
(
EncodšgEnvœÚm’tPŒ
 
“p
)

77 
“p
->
Epbuf
>=0)

79 
“p
->
Ecode¡rm
[(*“p->
Ecode¡rm_Ën
)++] = (
by‹
è(Ó•->
Ebufãr
>>(Ó•->
Epbuf
--)<<3))&0xFF);

81 
“p
->
C
 > 7)

83 
“p
->
C
-=8;

84 ++(
“p
->
E
);

86 
“p
->
Ebufãr
 = 0;

87 
	}
}

89 
šlše
 
	$put_Úe_by‹
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
b
)

91 if(
“p
->
Epbuf
 == 3)

93 
	`put_bufãr
(
“p
);

95 
“p
->
Ebufãr
 <<= 8;

96 
“p
->
Ebufãr
 +ð(
b
);

98 ++(
“p
->
Epbuf
);

99 
	}
}

101 
šlše
 
	$put_Úe_wÜd
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
b
)

103 ià(
“p
->
Epbuf
 >= 3)

105 
	`put_bufãr
(
“p
);

107 
“p
->
Ebufãr
 <<= 16;

108 
“p
->
Ebufãr
 +ð(
b
);

110 
“p
->
Epbuf
 += 2;

111 
	}
}

113 
fÜûšlše
 
	$´Ýag©e_ÿ¼y
(
EncodšgEnvœÚm’tPŒ
 
“p
)

115 ++(
“p
->
Ebufãr
);

116 
“p
->
Echunks_out¡ªdšg
 > 0)

118 
	`put_Úe_wÜd
(
“p
, 0);

119 --(
“p
->
Echunks_out¡ªdšg
);

121 
	}
}

123 
šlše
 
	$put_Ï¡_chunk_¶us_out¡ªdšg
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
l
)

125 
“p
->
Echunks_out¡ªdšg
 > 0)

127 
	`put_Úe_wÜd
(
“p
, 0xFFFF);

128 --(
“p
->
Echunks_out¡ªdšg
);

130 
	`put_Úe_wÜd
(
“p
, 
l
);

131 
	}
}

133 
šlše
 
	$put_Ï¡_chunk_¶us_out¡ªdšg_fš®
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
l
)

135 
“p
->
Echunks_out¡ªdšg
 > 0)

137 
	`put_Úe_wÜd
(
“p
, 0xFFFF);

138 --(
“p
->
Echunks_out¡ªdšg
);

140 
	`put_Úe_by‹
(
“p
, 
l
);

141 
	}
}

149 
	$¬›nco_»£t_EC
(
EncodšgEnvœÚm’tPŒ
 
“p
)

151 
“p
->
E
 = 0;

152 
“p
->
C
 = 0;

153 
	}
}

161 
	$¬›nco_¡¬t_’codšg
(
EncodšgEnvœÚm’tPŒ
 
“p
,

162 *
code_bufãr
,

163 *
code_Ën
 )

165 
“p
->
Elow
 = 0;

166 
“p
->
Echunks_out¡ªdšg
 = 0;

167 
“p
->
Ebufãr
 = 0;

168 
“p
->
Epbuf
 = -1;

169 
“p
->
Eb™s_to_go
 = 
BITS_TO_LOAD
 + 1;

171 
“p
->
Ecode¡rm
 = 
code_bufãr
;

172 
“p
->
Ecode¡rm_Ën
 = 
code_Ën
;

174 
“p
->
E¿nge
 = 
HALF
;

175 
	}
}

184 
	$£t_pic_bš_couÁ
(
VideoP¬am‘”s
 *
p_Vid
, 
EncodšgEnvœÚm’tPŒ
 
“p
)

186 
p_Vid
->
pic_bš_couÁ
 +ð(
“p
->
E
 << 3è+ƒ•->
C
;

187 
	}
}

195 
	$¬›nco_dÚe_’codšg
(
Maüoblock
 *
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p
)

197 
low
 = 
“p
->
Elow
;

198 
»maššg_b™s
 = 
BITS_TO_LOAD
 - 
“p
->
Eb™s_to_go
;

199 
mask
;

200 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

204 ià(
»maššg_b™s
 <= 5)

206 
mbB™s
->
mb_¡uffšg
 +ð(5 - 
»maššg_b™s
);

207 
mask
 = (è(255 - ((1 << (6 - 
»maššg_b™s
)) - 1));

208 
low
 = (low >> (
MASK_BITS
)è& 
mask
;

209 
low
 +ð(32 >> 
»maššg_b™s
);

211 
	`put_Ï¡_chunk_¶us_out¡ªdšg_fš®
(
“p
, 
low
);

212 
	`put_bufãr
(
“p
);

214 if(
»maššg_b™s
 <= 13)

216 
mbB™s
->
mb_¡uffšg
 +ð(13 - 
»maššg_b™s
);

217 
	`put_Ï¡_chunk_¶us_out¡ªdšg_fš®
(
“p
, ((
low
 >> (
MASK_BITS
)) & 0xFF));

219 
	`put_bufãr
(
“p
);

220 ià(
»maššg_b™s
 > 6)

222 
mask
 = (è(255 - ((1 << (14 - 
»maššg_b™s
)) - 1));

223 
low
 = (low >> (
B_BITS
)è& 
mask
;

224 
low
 +ð(0x2000 >> 
»maššg_b™s
);

225 
	`put_Úe_by‹_fš®
(
“p
, 
low
);

229 
	`put_Úe_by‹_fš®
(
“p
, 128);

234 
	`put_Ï¡_chunk_¶us_out¡ªdšg
(
“p
, ((
low
 >> 
B_BITS
è& 
B_LOAD_MASK
));

235 
	`put_bufãr
(
“p
);

236 
mbB™s
->
mb_¡uffšg
 +ð(21 - 
»maššg_b™s
);

238 ià(
»maššg_b™s
 > 14)

240 
mask
 = (è(255 - ((1 << (22 - 
»maššg_b™s
)) - 1));

241 
low
 = (low >> (
MAX_BITS
 - 24)è& 
mask
;

242 
low
 +ð(0x200000 >> 
»maššg_b™s
);

243 
	`put_Úe_by‹_fš®
(
“p
, 
low
);

247 
	`put_Úe_by‹_fš®
(
“p
, 128);

250 
“p
->
Eb™s_to_go
 = 8;

251 
	}
}

261 
	$bŸri_’code_symbÞ
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
, 
BiCÚ‹xtTy³PŒ
 
bi_ù
 )

263 cÚ¡ 
by‹
 
rLPS_bË_64x4
[64][4]=

330 cÚ¡ 
by‹
 
AC_Ãxt_¡©e_MPS_64
[64] =

341 cÚ¡ 
by‹
 
AC_Ãxt_¡©e_LPS_64
[64] =

352 
low
 = 
“p
->
Elow
;

353 
¿nge
 = 
“p
->
E¿nge
;

354 
bl
 = 
“p
->
Eb™s_to_go
;

355 
rLPS
 = 
rLPS_bË_64x4
[
bi_ù
->
¡©e
][(
¿nge
>>6) & 3];

357 
¿nge
 -ð
rLPS
;

359 ++(
“p
->
C
);

360 
bi_ù
->
couÁ
 +ð
“p
->
p_Vid
->
ÿbac_’codšg
;

367 ià((
symbÞ
 !ð0è=ð
bi_ù
->
MPS
)

369 
bi_ù
->
¡©e
 = 
AC_Ãxt_¡©e_MPS_64
[bi_ct->state];

371 ifÐ
¿nge
 >ð
QUARTER
 )

373 
“p
->
E¿nge
 = 
¿nge
;

378 
¿nge
<<=1;

379 ifÐ--
bl
 > 
MIN_BITS_TO_GO
 )

381 
“p
->
E¿nge
 = 
¿nge
;

382 
“p
->
Eb™s_to_go
 = 
bl
;

389 
»nÜm
 = 
»nÜm_bË_32
[(
rLPS
 >> 3) & 0x1F];

391 
low
 +ð
¿nge
 << 
bl
;

392 
¿nge
 = (
rLPS
 << 
»nÜm
);

393 
bl
 -ð
»nÜm
;

395 ià(!
bi_ù
->
¡©e
)

396 
bi_ù
->
MPS
 ^= 0x01;

398 
bi_ù
->
¡©e
 = 
AC_Ãxt_¡©e_LPS_64
[bi_ct->state];

400 ià(
low
 >ð
ONE
)

402 
low
 -ð
ONE
;

403 
	`´Ýag©e_ÿ¼y
(
“p
);

406 ifÐ
bl
 > 
MIN_BITS_TO_GO
 )

408 
“p
->
Elow
 = 
low
;

409 
“p
->
E¿nge
 = 
¿nge
;

410 
“p
->
Eb™s_to_go
 = 
bl
;

416 
“p
->
Elow
 = (
low
 << 
BITS_TO_LOAD
 )& (
ONE_M1
);

417 
low
 = (low >> 
B_BITS
è& 
B_LOAD_MASK
;

419 ià(
low
 < 
B_LOAD_MASK
)

421 
	`put_Ï¡_chunk_¶us_out¡ªdšg
(
“p
, 
low
);

425 ++(
“p
->
Echunks_out¡ªdšg
);

427 
“p
->
E¿nge
 = 
¿nge
;

428 
“p
->
Eb™s_to_go
 = 
bl
 + 
BITS_TO_LOAD
;

429 
	}
}

438 
	$bŸri_’code_symbÞ_eq_´ob
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
)

440 
low
 = 
“p
->
Elow
;

441 --(
“p
->
Eb™s_to_go
);

442 ++(
“p
->
C
);

444 ià(
symbÞ
 != 0)

446 
low
 +ð
“p
->
E¿nge
 <<ƒ•->
Eb™s_to_go
;

447 ià(
low
 >ð
ONE
)

449 
low
 -ð
ONE
;

450 
	`´Ýag©e_ÿ¼y
(
“p
);

453 if(
“p
->
Eb™s_to_go
 =ð
MIN_BITS_TO_GO
)

455 
“p
->
Elow
 = (
low
 << 
BITS_TO_LOAD
 )& (
ONE_M1
);

456 
low
 = (low >> 
B_BITS
è& 
B_LOAD_MASK
;

457 ià(
low
 < 
B_LOAD_MASK
)

459 
	`put_Ï¡_chunk_¶us_out¡ªdšg
(
“p
, 
low
);}

462 ++(
“p
->
Echunks_out¡ªdšg
);

465 
“p
->
Eb™s_to_go
 = 
BITS_TO_LOAD
;

470 
“p
->
Elow
 = 
low
;

473 
	}
}

481 
	$bŸri_’code_symbÞ_fš®
(
EncodšgEnvœÚm’tPŒ
 
“p
, 
symbÞ
)

483 
¿nge
 = 
“p
->
E¿nge
 - 2;

484 
low
 = 
“p
->
Elow
;

485 
bl
 = 
“p
->
Eb™s_to_go
;

487 ++(
“p
->
C
);

489 ià(
symbÞ
 == 0)

491 ifÐ
¿nge
 >ð
QUARTER
 )

493 
“p
->
E¿nge
 = 
¿nge
;

498 
¿nge
<<=1;

499 ifÐ--
bl
 > 
MIN_BITS_TO_GO
 )

501 
“p
->
E¿nge
 = 
¿nge
;

502 
“p
->
Eb™s_to_go
 = 
bl
;

509 
low
 +ð(
¿nge
 << 
bl
);

510 
¿nge
 = 2;

512 ià(
low
 >ð
ONE
)

514 
low
 -ð
ONE
;

515 
	`´Ýag©e_ÿ¼y
(
“p
);

517 
bl
 -= 7;

519 
¿nge
 <<= 7;

520 ifÐ
bl
 > 
MIN_BITS_TO_GO
 )

522 
“p
->
E¿nge
 = 
¿nge
;

523 
“p
->
Elow
 = 
low
;

524 
“p
->
Eb™s_to_go
 = 
bl
;

531 
“p
->
Elow
 = (
low
 << 
BITS_TO_LOAD
 ) & (
ONE_M1
);

532 
low
 = (low >> 
B_BITS
è& 
B_LOAD_MASK
;

533 ià(
low
 < 
B_LOAD_MASK
)

535 
	`put_Ï¡_chunk_¶us_out¡ªdšg
(
“p
, 
low
);

539 ++(
“p
->
Echunks_out¡ªdšg
);

542 
“p
->
E¿nge
 = 
¿nge
;

543 
bl
 +ð
BITS_TO_LOAD
;

544 
“p
->
Eb™s_to_go
 = 
bl
;

545 
	}
}

553 
	$bŸri_š™_cÚ‹xt
 (
qp
, 
BiCÚ‹xtTy³PŒ
 
ùx
, cÚ¡ * 
ši
)

555 
p¡©e
 = ((
ši
[0]* 
qp
) >> 4) + ini[1];

557 iàÐ
p¡©e
 >= 64 )

559 
p¡©e
 = 
	`imš
(126,…state);

560 
ùx
->
¡©e
 = (
ušt8
è(
p¡©e
 - 64);

561 
ùx
->
MPS
 = 1;

565 
p¡©e
 = 
	`imax
(1,…state);

566 
ùx
->
¡©e
 = (
ušt8
è(63 - 
p¡©e
);

567 
ùx
->
MPS
 = 0;

570 
ùx
->
couÁ
 = 0;

571 
	}
}

	@lencod/src/block.c

23 
	~"cÚŒibutÜs.h
"

25 
	~<m©h.h
>

27 
	~"glob®.h
"

28 
	~"blk_´ediùiÚ.h
"

29 
	~"’c_¡©i¡ics.h
"

30 
	~"mem®loc.h
"

31 
	~"image.h
"

32 
	~"mb_acûss.h
"

33 
	~"block.h
"

34 
	~"vlc.h
"

35 
	~"ŒªsfÜm.h
"

36 
	~"mc_´ediùiÚ.h
"

37 
	~"q_off£ts.h
"

38 
	~"q_m©rix.h
"

39 
	~"quªt4x4.h
"

40 
	~"quªtChroma.h
"

41 
	~"md_commÚ.h
"

42 
	~"ŒªsfÜm8x8.h
"

57 
	#P_X
 (
P»dP–
[0])

	)

58 
	#P_A
 (
P»dP–
[1])

	)

59 
	#P_B
 (
P»dP–
[2])

	)

60 
	#P_C
 (
P»dP–
[3])

	)

61 
	#P_D
 (
P»dP–
[4])

	)

62 
	#P_E
 (
P»dP–
[5])

	)

63 
	#P_F
 (
P»dP–
[6])

	)

64 
	#P_G
 (
P»dP–
[7])

	)

65 
	#P_H
 (
P»dP–
[8])

	)

66 
	#P_I
 (
P»dP–
[9])

	)

67 
	#P_J
 (
P»dP–
[10])

	)

68 
	#P_K
 (
P»dP–
[11])

	)

69 
	#P_L
 (
P»dP–
[12])

	)

72 cÚ¡ 
by‹
 
	gCOEFF_COST4x4
[3][16] =

79 cÚ¡ 
by‹
 
	gSCAN_YUV420
 [4][2] =

88 cÚ¡ 
by‹
 
	gSCAN_YUV422
 [8][2] =

97 cÚ¡ 
	ghÜ_off£t
[4][4][4] = {

124 cÚ¡ 
	gv”_off£t
[4][4][4] = {

151 cÚ¡ 
	gA
[4][4] = {

158 cÚ¡ 
	gcbp_blk_chroma
[8][4] = {

170 cÚ¡ 
by‹
 
	gSNGL_SCAN
[16][2] =

179 cÚ¡ 
by‹
 
	gFIELD_SCAN
[16][2] =

189 
Residu®_DPCM_16x16
(**
mb_Ües
, 
mode
);

190 
Inv_Residu®_DPCM_16x16
(**
mb_Ües
, 
mode
);

191 
Residu®_DPCM_4x4
(
mode
, **
mb_Ües
, **
mb_¼es
, 
block_y
, 
block_x
);

192 
Inv_Residu®_DPCM_4x4
 (
Maüoblock
 *
cu¼MB
, **
m7
, 
block_y
, 
block_x
);

193 
Residu®_DPCM_Chroma
(
mode
, **
Ües
, **
¼es
, 
width
, 
height
);

194 
Inv_Residu®_DPCM_Chroma
(
mode
, **
m7
, 
width
, 
height
);

208 
	$»sidu®_ŒªsfÜm_quªt_luma_16x16
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
)

210 
i
,
j
;

211 
ii
,
jj
;

213 
ac_cÛf
 = 0;

214 
img³l
 *
img_Y
, *
´edY
;

215 
nÚz”o
 = 
FALSE
;

217 
jpos
, 
os
;

218 
b8
, 
b4
;

221 
¶_off
 = 
¶
<<2;

222 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

223 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

224 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

226 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
¶
][0];

227 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
¶
][1];

228 ****
cofAC
 = &
cu¼Sliû
->cofAC[
¶_off
];

229 
cÛff_co¡
;

230 
Ãw_šŒa_mode
 = 
cu¼MB
->
i16mode
;

231 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

232 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

233 
qp
 = (
p_Vid
->
yuv_fÜm©
==
YUV444
 && !
cu¼Sliû
->
P444_jošed
)? 
cu¼MB
->
qp_sÿËd
[()Õ_Vid->
cÞour_¶ªe_id
)]: cu¼MB->qp_sÿËd[
¶
];

234 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

235 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
¶
];

237 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

242 
QuªtM‘hods
 
quªt_m‘hods
;

245 
quªt_m‘hods
.
qp
 = qp;

246 
quªt_m‘hods
.
q_·¿ms
 = 
p_Quªt
->
q_·¿ms_4x4
[
¶
][1][
qp
];

247 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj4x4
[
¶
][
I16MB
][0]): 
NULL
;

248 
quªt_m‘hods
.
pos_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

249 
quªt_m‘hods
.
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

250 
quªt_m‘hods
.
cÛff_co¡
 = &coeff_cost;

251 
quªt_m‘hods
.
ty³
 = 
LUMA_16AC
;

254 
j
 = 0; j < 16; ++j)

256 
´edY
 = 
cu¼_m´_16x16
[
Ãw_šŒa_mode
][
j
];

257 
img_Y
 = &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
j
][cu¼MB->
pix_x
];

258 
i
 = 0; i < 16; ++i)

260 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 
img_Y
[i] - 
´edY
[i];

265 
j
 = 0; j < 16; j+=4)

267 
i
 = 0;i < 16; i+=4)

269 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, cu¼Sliû->tblk16x16, 
j
, 
i
);

274 
j
 = 0; j < 4; ++j)

275 
i
 = 0; i < 4; ++i)

276 
cu¼Sliû
->
tblk4x4
[
j
][
i
]ðcu¼Sliû->
tblk16x16
[j << 2][i << 2];

279 
	`hadam¬d4x4
(
cu¼Sliû
->
tblk4x4
, currSlice->tblk4x4);

281 
nÚz”o
 = 
cu¼Sliû
->
	`quªt_dc4x4
(
cu¼MB
, &cu¼Sliû->
tblk4x4
[0], 
qp
, 
DCLev–
, 
DCRun
, &
quªt_m‘hods
.
q_·¿ms
[0][0], 
pos_sÿn
);

285 ià(
nÚz”o
)

287 
	`ihadam¬d4x4
(
cu¼Sliû
->
tblk4x4
, currSlice->tblk4x4);

290 
j
 = 0; j < 
MB_BLOCK_SIZE
; j +ð
BLOCK_SIZE
)

292 
i
 = 0; i < 
MB_BLOCK_SIZE
;˜+ð
BLOCK_SIZE
)

294 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 
	`rshiá_ºd_sf
(((cu¼Sliû->
tblk4x4
[j>>2][i>>2]è* 
quªt_m‘hods
.
q_·¿ms
[0][0].
InvSÿËComp
è<< 
qp_³r
, 6);

300 
j
 = 0; j < 
MB_BLOCK_SIZE
; j +ð
BLOCK_SIZE
)

302 
i
 = 0; i < 
MB_BLOCK_SIZE
; i +ð
BLOCK_SIZE
)

304 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 0;

310 
jj
=0;jj<4;++jj)

312 
jpos
 = (
jj
 << 2);

313 
cu¼MB
->
subblock_y
 = (è
jpos
;

314 
ii
=0;ii<4;++ii)

316 
os
 = (
ii
 << 2);

317 
cu¼MB
->
subblock_x
 = (è
os
;

319 
b8
 = 2*(
jj
 >> 1è+ (
ii
 >> 1);

320 
b4
 = 2*(
jj
 & 0x01è+ (
ii
 & 0x01);

321 
quªt_m‘hods
.
block_x
 = 
os
;

322 
quªt_m‘hods
.
block_y
 = 
jpos
;

324 
quªt_m‘hods
.
ACLev–
 = 
cofAC
[
b8
][
b4
][0];

325 
quªt_m‘hods
.
ACRun
 = 
cofAC
[
b8
][
b4
][1];

328 
nÚz”o
 = 
cu¼Sliû
->
	`quªt_ac4x4
(
cu¼MB
, &cu¼Sliû->
tblk16x16
[
jpos
], &
quªt_m‘hods
);

330 ià(
nÚz”o
)

331 
ac_cÛf
 = 15;

334 ià(
cu¼Sliû
->
tblk16x16
[
jpos
][
os
]!ð0 || 
nÚz”o
)

335 
	`šv”£4x4
(
cu¼Sliû
->
tblk16x16
, cu¼Sliû->tblk16x16, 
jpos
, 
os
);

341 
	`§m¶e_»cÚ¡ruù
 (&
img_’c
[
cu¼MB
->
pix_y
], 
cu¼_m´_16x16
[
Ãw_šŒa_mode
], 
cu¼Sliû
->
tblk16x16
, 0, cu¼MB->
pix_x
, 16, 16, 
max_img³l_v®ue
, 
DQ_BITS
);

343 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

345 
j
 = 
cu¼MB
->
pix_y
; j < currMB->pix_y + 16;++j)

346 
i
 = 
cu¼MB
->
pix_x
; i < currMB->pix_x + 16;++i)

347 
p_Vid
->
Ìec
[
j
][
i
]=-16;

350  
ac_cÛf
;

351 
	}
}

353 
	$Residu®_DPCM_16x16
(**
m7
, 
mode
)

355 
i
,
j
;

356 
‹mp
[16][16];

358 if(
mode
==
VERT_PRED_16
)

360 
i
=1; i<16; ++i)

361 
j
=0; j<16; ++j)

362 
‹mp
[
i
][
j
] = 
m7
[i][j] - m7[i-1][j];

364 
i
=1; i<16; ++i)

365 
j
=0; j<16; ++j)

366 
m7
[
i
][
j
] = 
‹mp
[i][j];

370 
i
=0; i<16; ++i)

371 
j
=1; j<16; ++j)

372 
‹mp
[
i
][
j
] = 
m7
[i][j] - m7[i][j-1];

374 
i
=0; i<16; ++i)

375 
j
=1; j<16; ++j)

376 
m7
[
i
][
j
] = 
‹mp
[i][j];

379 
	}
}

381 
	$Inv_Residu®_DPCM_16x16
(**
m7
, 
mode
)

383 
i
;

384 
‹mp
[16][16];

386 if(
mode
==
VERT_PRED_16
)

388 
i
=0; i<16; ++i)

390 
‹mp
[0][
i
] = 
m7
[0][i];

391 
‹mp
[1][
i
] = 
m7
[1][i] +emp[0][i];

392 
‹mp
[2][
i
] = 
m7
[2][i] +emp[1][i];

393 
‹mp
[3][
i
] = 
m7
[3][i] +emp[2][i];

394 
‹mp
[4][
i
] = 
m7
[4][i] +emp[3][i];

395 
‹mp
[5][
i
] = 
m7
[5][i] +emp[4][i];

396 
‹mp
[6][
i
] = 
m7
[6][i] +emp[5][i];

397 
‹mp
[7][
i
] = 
m7
[7][i] +emp[6][i];

398 
‹mp
[8][
i
] = 
m7
[8][i] +emp[7][i];

399 
‹mp
[9][
i
] = 
m7
[9][i] +emp[8][i];

400 
‹mp
[10][
i
] = 
m7
[10][i] +emp[9][i];

401 
‹mp
[11][
i
] = 
m7
[11][i] +emp[10][i];

402 
‹mp
[12][
i
] = 
m7
[12][i] +emp[11][i];

403 
‹mp
[13][
i
] = 
m7
[13][i] +emp[12][i];

404 
‹mp
[14][
i
] = 
m7
[14][i] +emp[13][i];

405 
‹mp
[15][
i
] = 
m7
[15][i] +emp[14][i];

408 
i
=0; i<16; ++i)

410 
m7
[1][
i
] = 
‹mp
[1][i];

411 
m7
[2][
i
] = 
‹mp
[2][i];

412 
m7
[3][
i
] = 
‹mp
[3][i];

413 
m7
[4][
i
] = 
‹mp
[4][i];

414 
m7
[5][
i
] = 
‹mp
[5][i];

415 
m7
[6][
i
] = 
‹mp
[6][i];

416 
m7
[7][
i
] = 
‹mp
[7][i];

417 
m7
[8][
i
] = 
‹mp
[8][i];

418 
m7
[9][
i
] = 
‹mp
[9][i];

419 
m7
[10][
i
] = 
‹mp
[10][i];

420 
m7
[11][
i
] = 
‹mp
[11][i];

421 
m7
[12][
i
] = 
‹mp
[12][i];

422 
m7
[13][
i
] = 
‹mp
[13][i];

423 
m7
[14][
i
] = 
‹mp
[14][i];

424 
m7
[15][
i
] = 
‹mp
[15][i];

429 
i
=0; i<16; ++i)

431 
‹mp
[
i
][0] = 
m7
[i][0];

432 
‹mp
[
i
][1] = 
m7
[i][1] +emp[i][0];

433 
‹mp
[
i
][2] = 
m7
[i][2] +emp[i][1];

434 
‹mp
[
i
][3] = 
m7
[i][3] +emp[i][2];

435 
‹mp
[
i
][4] = 
m7
[i][4] +emp[i][3];

436 
‹mp
[
i
][5] = 
m7
[i][5] +emp[i][4];

437 
‹mp
[
i
][6] = 
m7
[i][6] +emp[i][5];

438 
‹mp
[
i
][7] = 
m7
[i][7] +emp[i][6];

439 
‹mp
[
i
][8] = 
m7
[i][8] +emp[i][7];

440 
‹mp
[
i
][9] = 
m7
[i][9] +emp[i][8];

441 
‹mp
[
i
][10] = 
m7
[i][10] +emp[i][9];

442 
‹mp
[
i
][11] = 
m7
[i][11] +emp[i][10];

443 
‹mp
[
i
][12] = 
m7
[i][12] +emp[i][11];

444 
‹mp
[
i
][13] = 
m7
[i][13] +emp[i][12];

445 
‹mp
[
i
][14] = 
m7
[i][14] +emp[i][13];

446 
‹mp
[
i
][15] = 
m7
[i][15] +emp[i][14];

448 
i
=0; i<16; ++i)

450 
m7
[
i
][1] = 
‹mp
[i][1];

451 
m7
[
i
][2] = 
‹mp
[i][2];

452 
m7
[
i
][3] = 
‹mp
[i][3];

453 
m7
[
i
][4] = 
‹mp
[i][4];

454 
m7
[
i
][5] = 
‹mp
[i][5];

455 
m7
[
i
][6] = 
‹mp
[i][6];

456 
m7
[
i
][7] = 
‹mp
[i][7];

457 
m7
[
i
][8] = 
‹mp
[i][8];

458 
m7
[
i
][9] = 
‹mp
[i][9];

459 
m7
[
i
][10] = 
‹mp
[i][10];

460 
m7
[
i
][11] = 
‹mp
[i][11];

461 
m7
[
i
][12] = 
‹mp
[i][12];

462 
m7
[
i
][13] = 
‹mp
[i][13];

463 
m7
[
i
][14] = 
‹mp
[i][14];

464 
m7
[
i
][15] = 
‹mp
[i][15];

468 
	}
}

483 
	$»sidu®_ŒªsfÜm_quªt_luma_16x16_ls
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
)

485 
i
,
j
;

486 
ii
,
jj
;

488 
run
,
sÿn_pos
,
cÛff_ùr
;

489 
ac_cÛf
 = 0;

490 
img³l
 *
img_Y
, *
´edY
;

492 
b8
, 
b4
;

495 
¶_off
 = 
¶
<<2;

496 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

497 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

498 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

499 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
¶
][0];

500 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
¶
][1];

501 * 
ACLev–
;

502 * 
ACRun
;

503 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

504 *
m7
;

505 
Ãw_šŒa_mode
 = 
cu¼MB
->
i16mode
;

507 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

508 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
¶
];

510 
j
 = 0; j < 16; ++j)

512 
´edY
 = 
cu¼_m´_16x16
[
Ãw_šŒa_mode
][
j
];

513 
img_Y
 = &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
j
][cu¼MB->
pix_x
];

514 
i
 = 0; i < 16; ++i)

516 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 
img_Y
[i] - 
´edY
[i];

520 ià(
Ãw_šŒa_mode
 < 2)

522 
	`Residu®_DPCM_16x16
(
cu¼Sliû
->
tblk16x16
, 
Ãw_šŒa_mode
);

526 
j
 = 0; j < 4;++j)

527 
i
 = 0; i < 4;++i)

528 
cu¼Sliû
->
tblk4x4
[
j
][
i
]ðcu¼Sliû->
tblk16x16
[j << 2][i << 2];

530 
run
=-1;

531 
sÿn_pos
=0;

533 
cÛff_ùr
=0;coeff_ctr<16;++coeff_ctr)

535 
i
=
pos_sÿn
[
cÛff_ùr
][0];

536 
j
=
pos_sÿn
[
cÛff_ùr
][1];

538 ++
run
;

540 
m7
 = &
cu¼Sliû
->
tblk4x4
[
j
][
i
];

542 ià(*
m7
 != 0)

544 ià(
is_ÿvlc
)

545 *
m7
 = 
	`iCl3
(-
CAVLC_LEVEL_LIMIT
, CAVLC_LEVEL_LIMIT, *m7);

547 
DCLev–
[
sÿn_pos
 ] = *
m7
;

548 
DCRun
 [
sÿn_pos
++] = 
run
;

549 
run
=-1;

552 
DCLev–
[
sÿn_pos
]=0;

555 
j
 = 0; j < 4;++j)

556 
i
 = 0; i < 4;++i)

557 
cu¼Sliû
->
tblk16x16
[
j
 << 2][
i
 << 2] = cu¼Sliû->
tblk4x4
[j][i];

560 
jj
 = 0; jj < 4; ++jj)

562 
ii
 = 0; ii < 4; ++ii)

564 
j
=0;j<4;++j)

566 
	`memýy
(
cu¼Sliû
->
tblk4x4
[
j
],&cu¼Sliû->
tblk16x16
[(
jj
<<2)+j][(
ii
<<2)], 
BLOCK_SIZE
 * ());

569 
run
 = -1;

570 
sÿn_pos
 = 0;

571 
b8
 = 2*(
jj
 >> 1è+ (
ii
 >> 1);

572 
b4
 = 2*(
jj
 & 0x01è+ (
ii
 & 0x01);

573 
ACLev–
 = 
cu¼Sliû
->
cofAC
 [
b8
+
¶_off
][
b4
][0];

574 
ACRun
 = 
cu¼Sliû
->
cofAC
 [
b8
+
¶_off
][
b4
][1];

576 
cÛff_ùr
=1;coeff_ctr<16;coeff_ctr++)

578 
i
=
pos_sÿn
[
cÛff_ùr
][0];

579 
j
=
pos_sÿn
[
cÛff_ùr
][1];

581 
run
++;

582 
m7
 = &
cu¼Sliû
->
tblk4x4
[
j
][
i
];

584 ià(*
m7
 != 0)

586 ià(
is_ÿvlc
)

587 *
m7
 = 
	`iCl3
(-
CAVLC_LEVEL_LIMIT
, CAVLC_LEVEL_LIMIT, *m7);

589 
ac_cÛf
 = 15;

590 
ACLev–
[
sÿn_pos
 ] = *
m7
;

591 
ACRun
 [
sÿn_pos
++] = 
run
;

592 
run
=-1;

596 
ACLev–
[
sÿn_pos
] = 0;

598 
j
=0;j<4;++j)

599 
	`memýy
(&
cu¼Sliû
->
tblk16x16
[(
jj
<<2)+
j
][(
ii
<<2)],cu¼Sliû->
tblk4x4
[j], 
BLOCK_SIZE
 * ());

603 ià(
Ãw_šŒa_mode
 < 2)

605 
	`Inv_Residu®_DPCM_16x16
(
cu¼Sliû
->
tblk16x16
, 
Ãw_šŒa_mode
);

609 
j
 = 0; j < 16; ++j)

611 
img_Y
 = &
img_’c
[
cu¼MB
->
pix_y
 + 
j
][cu¼MB->
pix_x
];

612 
´edY
 = 
cu¼_m´_16x16
[
Ãw_šŒa_mode
][
j
];

613 
i
 = 0; i < 16; ++i)

614 
img_Y
[
i
]=(
img³l
)(
cu¼Sliû
->
tblk16x16
[
j
][i] + 
´edY
[i]);

617 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

619 
j
 = 
cu¼MB
->
pix_y
; j < currMB->pix_y + 16;++j)

620 
i
 = 
cu¼MB
->
pix_x
; i < currMB->pix_x + 16;++i)

621 
p_Vid
->
Ìec
[
j
][
i
]=-16;

624  
ac_cÛf
;

625 
	}
}

627 
šlše
 
	$check_z”o
(**
mb_Ües
, 
block_x
)

629 
i
, 
j
, 
k
 = 0;

631 
j
 = 0; (j < 
BLOCK_SIZE
è&& (
k
 == 0); ++j)

633 
i
 = 
block_x
; (i< block_x + 
BLOCK_SIZE
è&& (
k
 == 0); ++i)

636 
k
 |ð
mb_Ües
[
j
][
i
];

639  
k
;

640 
	}
}

661 
	$»sidu®_ŒªsfÜm_quªt_luma_4x4
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
, *
cÛff_co¡
, 
šŒa
)

663 
nÚz”o
 = 
FALSE
;

665 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

666 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

667 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1è+ (
¶
<<2);

668 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

669 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

670 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

672 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

673 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

674 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

676 ià(
	`check_z”o
(&
mb_Ües
[
block_y
], 
block_x
) != 0)

678 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

679 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

680 
qp
 = (
p_Vid
->
yuv_fÜm©
==
YUV444
 && !
cu¼Sliû
->
P444_jošed
)? 
cu¼MB
->
qp_sÿËd
[()Õ_Vid->
cÞour_¶ªe_id
)]: cu¼MB->qp_sÿËd[
¶
];

681 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

682 
QuªtM‘hods
 
quªt_m‘hods
;

683 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

684 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

686 
quªt_m‘hods
.
block_x
 = block_x;

687 
quªt_m‘hods
.
block_y
 = block_y;

688 
quªt_m‘hods
.
qp
 = qp;

689 
quªt_m‘hods
.
q_·¿ms
 = 
p_Quªt
->
q_·¿ms_4x4
[
¶
][
šŒa
][
qp
];

690 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj4x4
[
¶
][
cu¼MB
->
¬_mode
][
block_y
]è: 
NULL
;

691 
quªt_m‘hods
.
cÛff_co¡
 = coeff_cost;

692 
quªt_m‘hods
.
pos_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

693 
quªt_m‘hods
.
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

695 
cu¼MB
->
subblock_x
 = ((
b8
&0x1)==0è? (((
b4
&0x1)==0)? 0: 4) : (((b4&0x1)==0)? 8: 12);

696 
cu¼MB
->
subblock_y
 = (
b8
<2è? ((
b4
<2) ? 0: 4) : ((b4<2) ? 8: 12);

699 
	`fÜw¬d4x4
(
mb_Ües
, 
cu¼Sliû
->
tblk16x16
, 
block_y
, 
block_x
);

702 
nÚz”o
 = 
cu¼Sliû
->
	`quªt_4x4
(
cu¼MB
, &cu¼Sliû->
tblk16x16
[
block_y
], &
quªt_m‘hods
);

705 ià(
nÚz”o
)

708 
	`šv”£4x4
(
cu¼Sliû
->
tblk16x16
, 
mb_¼es
, 
block_y
, 
block_x
);

711 
	`§m¶e_»cÚ¡ruù
 (&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], &
mb_¼es
[block_y], 
block_x
, cu¼MB->
pix_x
 + block_x, 
BLOCK_SIZE
, BLOCK_SIZE, 
max_img³l_v®ue
, 
DQ_BITS
);

715 
	`cÝy_image_d©a_4x4
(&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], cu¼MB->
pix_x
 + 
block_x
, block_x);

720 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0][0] = 0;

721 
	`cÝy_image_d©a_4x4
(&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], cu¼MB->
pix_x
 + 
block_x
, block_x);

724  
nÚz”o
;

725 
	}
}

749 
	$»sidu®_ŒªsfÜm_quªt_luma_4x4_ls
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
,*
cÛff_co¡
, 
šŒa
)

751 
i
,
j
, 
cÛff_ùr
;

752 
run
 = -1;

753 
nÚz”o
 = 
FALSE
;

755 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

756 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

757 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1è+ (
¶
<<2);

758 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

760 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

761 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

762 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

763 * 
ACL
 = &
cu¼Sliû
->
cofAC
[
b8
][
b4
][0][0];

764 * 
ACR
 = &
cu¼Sliû
->
cofAC
[
b8
][
b4
][1][0];

766 
pix_y
, 
pix_x
;

767 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

768 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

769 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

770 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

771 *
m7
;

773 cÚ¡ 
by‹
 *
p_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? &
FIELD_SCAN
[0][0] : &
SNGL_SCAN
[0][0];

776 **
çdju¡4x4
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj4x4
[
¶
][
cu¼MB
->
¬_mode
][
block_y
]è: 
NULL
;

778 ifÐ(
cu¼MB
->
mode_DPCM
 < 2è&& (
šŒa
))

780 
	`Residu®_DPCM_4x4
(
cu¼MB
->
mode_DPCM
, 
mb_Ües
, 
mb_¼es
, 
block_y
, 
block_x
);

784 
j
=
block_y
; j < block_y + 
BLOCK_SIZE
; ++j)

785 
i
=
block_x
; i < block_x + 
BLOCK_SIZE
; ++i)

786 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j][i];

789 
cÛff_ùr
=0;coeff_ctr < 16;coeff_ctr++)

791 
i
 = *
p_sÿn
++;

792 
j
 = *
p_sÿn
++;

794 
run
++;

796 
m7
 = &
mb_¼es
[
block_y
 + 
j
][
block_x
 + 
i
];

798 ià(
p_Vid
->
Ad­tiveRoundšg
)

799 
çdju¡4x4
[
j
][
block_x
+
i
] = 0;

801 ià(*
m7
 != 0)

803 ià(
is_ÿvlc
)

804 *
m7
 = 
	`iCl3
(-
CAVLC_LEVEL_LIMIT
, CAVLC_LEVEL_LIMIT, *m7);

806 
nÚz”o
=
TRUE
;

807 *
cÛff_co¡
 +ð
MAX_VALUE
;

808 *
ACL
++ = *
m7
;

809 *
ACR
++ = 
run
;

810 
run
=-1;

813 *
ACL
 = 0;

815 ifÐ(
cu¼MB
->
mode_DPCM
 < 2è&& (
šŒa
))

817 
	`Inv_Residu®_DPCM_4x4
(
cu¼MB
, 
mb_¼es
, 
block_y
, 
block_x
);

820 
j
=0; j < 
BLOCK_SIZE
; ++j)

822 
pix_y
 = 
cu¼MB
->pix_y + 
block_y
 + 
j
;

823 
pix_x
 = 
cu¼MB
->pix_x+
block_x
;

824 
i
=0; i < 
BLOCK_SIZE
; ++i)

826 
img_’c
[
pix_y
][
pix_x
+
i
] = (
img³l
è(
mb_¼es
[
j
+
block_y
][i+
block_x
] + 
mb_´ed
[j+block_y][i+block_x]);

830  
nÚz”o
;

831 
	}
}

842 
	$Residu®_DPCM_4x4
(
mode
, **
mb_Ües
, **
mb_¼es
, 
block_y
, 
block_x
)

844 
i
;

845 
‹mp
[4][4];

847 if(
mode
==
VERT_PRED
)

849 
i
=0; i<4; ++i)

851 
‹mp
[0][
i
] = 
mb_Ües
[
block_y
 + 0][
block_x
 + i];

852 
‹mp
[1][
i
] = 
mb_Ües
[
block_y
 + 1][
block_x
 + i] - mb_ores[block_y ][block_x + i];

853 
‹mp
[2][
i
] = 
mb_Ües
[
block_y
 + 2][
block_x
 + i] - mb_ores[block_y + 1][block_x + i];

854 
‹mp
[3][
i
] = 
mb_Ües
[
block_y
 + 3][
block_x
 + i] - mb_ores[block_y + 2][block_x + i];

857 
i
 = 0; i < 4; ++i)

859 
mb_¼es
[
block_y
 + 0][
block_x
 + 
i
] = 
‹mp
[0][i];

860 
mb_¼es
[
block_y
 + 1][
block_x
 + 
i
] = 
‹mp
[1][i];

861 
mb_¼es
[
block_y
 + 2][
block_x
 + 
i
] = 
‹mp
[2][i];

862 
mb_¼es
[
block_y
 + 3][
block_x
 + 
i
] = 
‹mp
[3][i];

867 
i
=0; i<4; ++i)

869 
‹mp
[
i
][0] = 
mb_Ües
[
block_y
 + i][
block_x
];

870 
‹mp
[
i
][1] = 
mb_Ües
[
block_y
 + i][
block_x
 + 1] - mb_ores[block_y + i][block_x ];

871 
‹mp
[
i
][2] = 
mb_Ües
[
block_y
 + i][
block_x
 + 2] - mb_ores[block_y + i][block_x + 1];

872 
‹mp
[
i
][3] = 
mb_Ües
[
block_y
 + i][
block_x
 + 3] - mb_ores[block_y + i][block_x + 2];

875 
i
=0; i<4; ++i)

877 
mb_¼es
[
block_y
 + 
i
][
block_x
 + 0] = 
‹mp
[i][0];

878 
mb_¼es
[
block_y
 + 
i
][
block_x
 + 1] = 
‹mp
[i][1];

879 
mb_¼es
[
block_y
 + 
i
][
block_x
 + 2] = 
‹mp
[i][2];

880 
mb_¼es
[
block_y
 + 
i
][
block_x
 + 3] = 
‹mp
[i][3];

884 
	}
}

896 
	$Inv_Residu®_DPCM_4x4
(
Maüoblock
 *
cu¼MB
, **
m7
, 
block_y
, 
block_x
)

898 
i
;

899 
‹mp
[4][4];

901 if(
cu¼MB
->
mode_DPCM
 =ð
VERT_PRED
)

903 
i
=0; i<4; ++i)

905 
‹mp
[0][
i
] = 
m7
[
block_y
 + 0][
block_x
 + i];

906 
‹mp
[1][
i
] = 
m7
[
block_y
 + 1][
block_x
 + i] +emp[0][i];

907 
‹mp
[2][
i
] = 
m7
[
block_y
 + 2][
block_x
 + i] +emp[1][i];

908 
‹mp
[3][
i
] = 
m7
[
block_y
 + 3][
block_x
 + i] +emp[2][i];

910 
i
=0; i<4; ++i)

912 
m7
[
block_y
 + 0][
block_x
 + 
i
] = 
‹mp
[0][i];

913 
m7
[
block_y
 + 1][
block_x
 + 
i
] = 
‹mp
[1][i];

914 
m7
[
block_y
 + 2][
block_x
 + 
i
] = 
‹mp
[2][i];

915 
m7
[
block_y
 + 3][
block_x
 + 
i
] = 
‹mp
[3][i];

920 
i
=0; i<4; ++i)

922 
‹mp
[
i
][0] = 
m7
[
block_y
 + i][
block_x
 + 0];

923 
‹mp
[
i
][1] = 
m7
[
block_y
 + i][
block_x
 + 1] +emp[i][0];

924 
‹mp
[
i
][2] = 
m7
[
block_y
 + i][
block_x
 + 2] +emp[i][1];

925 
‹mp
[
i
][3] = 
m7
[
block_y
 + i][
block_x
 + 3] +emp[i][2];

927 
i
=0; i<4; ++i)

929 
m7
[
block_y
+
i
][
block_x
 ] = 
‹mp
[i][0];

930 
m7
[
block_y
+
i
][
block_x
+1] = 
‹mp
[i][1];

931 
m7
[
block_y
+
i
][
block_x
+2] = 
‹mp
[i][2];

932 
m7
[
block_y
+
i
][
block_x
+3] = 
‹mp
[i][3];

936 
	}
}

954 
	$»sidu®_ŒªsfÜm_quªt_chroma_4x4
(
Maüoblock
 *
cu¼MB
, 
uv
, 
ü_cbp
)

956 
i
, 
j
, 
n2
, 
n1
, 
cÛff_ùr
;

957 *
m1
;

958 
cÛff_co¡
 = 0;

959 
ü_cbp_tmp
 = 0;

960 
DCz”o
 = 
FALSE
;

961 
nÚz”o
[4][4] = {{
FALSE
}};

962 
nÚez”o
 = 
FALSE
;

964 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

965 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

966 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

968 
b4
;

969 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
uv
+1][0];

970 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
uv
+1][1];

971 
šŒa
 = 
	`is_šŒa
 (
cu¼MB
);

972 
uv_sÿË
 = 
uv
 * (
p_Vid
->
num_blk8x8_uv
 >> 1);

975 cÚ¡ 
št64
 
cbpblk_·‰”n
[4]={0, 0xf0000, 0xff0000, 0xffff0000};

976 
yuv
 = 
p_Vid
->
yuv_fÜm©
;

977 
b8
;

979 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

980 
cur_qp
 = 
cu¼MB
->
qpc
[
uv
] + 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
;

982 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

984 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
uv
 + 1];

985 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
uv
 + 1];

986 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
uv
 + 1];

988 
QuªtM‘hods
 
quªt_m‘hods
;

990 
quªt_m‘hods
.
qp
 = 
cur_qp
;

991 
quªt_m‘hods
.
q_·¿ms
 = 
p_Quªt
->
q_·¿ms_4x4
[
uv
 + 1][
šŒa
][
cur_qp
];

992 
quªt_m‘hods
.
ty³
 = 
CHROMA_AC
;

993 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
 && cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
)

996 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ?…_Vid->
ARCofAdj4x4
[
uv
 + 1][4] : 
NULL
;

1000 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ?…_Vid->
ARCofAdj4x4
[
uv
 + 1][
cu¼MB
->
¬_mode
] : 
NULL
;

1003 
quªt_m‘hods
.
pos_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

1004 
quªt_m‘hods
.
c_co¡
 = (
cu¼Sliû
->
di¡h»s
 =ð2 && 
šŒa
 ) ? 
COEFF_COST4x4
[1] : COEFF_COST4x4[currSlice->disthres];

1005 
quªt_m‘hods
.
cÛff_co¡
 = &coeff_cost;

1008 
p_Vid
->
is_v_block
 = 
uv
;

1011 
n2
=0;‚2 < 
p_Vid
->
mb_ü_size_y
;‚2 +ð
BLOCK_SIZE
)

1013 
n1
=0;‚1 < 
p_Vid
->
mb_ü_size_x
;‚1 +ð
BLOCK_SIZE
)

1015 ià(
	`check_z”o
(&
mb_Ües
[
n2
], 
n1
) == 0)

1017 
j
 = 
n2
; j <‚2 + 
BLOCK_SIZE
; j++)

1018 
i
 = 
n1
; i <‚1 + 
BLOCK_SIZE
; i++)

1019 
mb_¼es
[
j
][
i
] = 0;

1023 
	`fÜw¬d4x4
(
mb_Ües
, 
mb_¼es
, 
n2
, 
n1
);

1029 ià(
yuv
 =ð
YUV420
)

1031 **
çdju¡2x2
 = 
NULL
;

1033 
m1
 = 
cu¼Sliû
->
tblk4x4
[0];

1037 
	`hadam¬d2x2
(
mb_¼es
, 
m1
);

1040 
DCz”o
 = 
cu¼Sliû
->
	`quªt_dc_ü
(
cu¼MB
, &
m1
, 
cur_qp
, 
DCLev–
, 
DCRun
, &
quªt_m‘hods
.
q_·¿ms
[0][0], 
çdju¡2x2
, 
SCAN_YUV420
);

1042 ià(
DCz”o
)

1044 
cu¼MB
->
cbp_blk
 |ð0xf0000 << (
uv
 << 2) ;

1045 
ü_cbp
=
	`imax
(1,cr_cbp);

1049 
	`ihadam¬d2x2
(
m1
, m1);

1051 
mb_¼es
[0][0] = 
m1
[0] >> 5;

1052 
mb_¼es
[0][4] = 
m1
[1] >> 5;

1053 
mb_¼es
[4][0] = 
m1
[2] >> 5;

1054 
mb_¼es
[4][4] = 
m1
[3] >> 5;

1056 ià(
yuv
 =ð
YUV422
)

1058 **
çdju¡4x2
 = 
NULL
;

1060 
cur_qp_dc
 = 
cu¼MB
->
qpc
[
uv
] + 3 + 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
;

1062 
Lev–QuªtP¬ams
 **
quªt_·¿msDC
 = 
p_Quªt
->
q_·¿ms_4x4
[
uv
 + 1][
šŒa
][
cur_qp_dc
];

1066 
j
=0; j < 
p_Vid
->
mb_ü_size_y
; j+=
BLOCK_SIZE
)

1068 
i
=0; i < 
p_Vid
->
mb_ü_size_x
; i+=
BLOCK_SIZE
)

1069 
cu¼Sliû
->
tblk4x4
[
i
>>2][
j
>>2]ð
mb_¼es
[j][i];

1073 
	`hadam¬d4x2
(
cu¼Sliû
->
tblk4x4
, currSlice->tblk4x4);

1076 
DCz”o
 = 
cu¼Sliû
->
	`quªt_dc_ü
(
cu¼MB
, cu¼Sliû->
tblk4x4
, 
cur_qp_dc
, 
DCLev–
, 
DCRun
, &
quªt_·¿msDC
[0][0], 
çdju¡4x2
, 
SCAN_YUV422
);

1078 ià(
DCz”o
)

1080 
cu¼MB
->
cbp_blk
 |ð0xff0000 << (
uv
 << 3) ;

1081 
ü_cbp
=
	`imax
(1,cr_cbp);

1085 
	`ihadam¬d4x2
(
cu¼Sliû
->
tblk4x4
, currSlice->tblk4x4);

1088 
j
 = 0; j < 4; ++j)

1090 
mb_¼es
[
j
 << 2 ][0] = 
	`rshiá_ºd_sf
(
cu¼Sliû
->
tblk4x4
[j][0], 6);

1091 
mb_¼es
[
j
 << 2 ][4] = 
	`rshiá_ºd_sf
(
cu¼Sliû
->
tblk4x4
[j][1], 6);

1096 
b8
=0; b8 < (
p_Vid
->
num_blk8x8_uv
 >> 1); b8++)

1098 
b4
=0; b4 < 4; b4++)

1100 
št64
 
uv_cbpblk
 = ((št64)1è<< 
cbp_blk_chroma
[
b8
 + 
uv_sÿË
][
b4
];

1101 
n1
 = 
hÜ_off£t
[
yuv
][
b8
][
b4
];

1102 
n2
 = 
v”_off£t
[
yuv
][
b8
][
b4
];

1103 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][0];

1104 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][1];

1105 
quªt_m‘hods
.
block_x
 = 
n1
;

1106 
quªt_m‘hods
.
block_y
 = 
n2
;

1108 
cu¼MB
->
subblock_y
 = 
subblk_off£t_y
[
p_Vid
->
yuv_fÜm©
 - 1][
b8
][
b4
];

1109 
cu¼MB
->
subblock_x
 = 
subblk_off£t_x
[
p_Vid
->
yuv_fÜm©
 - 1][
b8
][
b4
];

1110 ià(
p_Vid
->
Ad­tiveRoundšg
)

1112 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
 && cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
)

1115 
quªt_m‘hods
.
çdju¡
 = &
p_Vid
->
ARCofAdj4x4
[
uv
 + 1][4][
n2
];

1119 
quªt_m‘hods
.
çdju¡
 = &
p_Vid
->
ARCofAdj4x4
[
uv
 + 1][
cu¼MB
->
¬_mode
][
n2
];

1124 
quªt_m‘hods
.
çdju¡
 = 
NULL
;

1128 
nÚz”o
[
n2
>>2][
n1
>>2] = 
cu¼Sliû
->
	`quªt_ac4x4ü
(
cu¼MB
, &
mb_¼es
[n2], &
quªt_m‘hods
);

1130 ià(
nÚz”o
[
n2
>>2][
n1
>>2])

1132 
cu¼MB
->
cbp_blk
 |ð
uv_cbpblk
;

1133 
ü_cbp_tmp
 = 2;

1134 
nÚez”o
 = 
TRUE
;

1141 if(
nÚez”o
 && 
cÛff_co¡
 < 
_CHROMA_COEFF_COST_
)

1143 
št64
 
uv_cbpblk
 = ((št64)
cbpblk_·‰”n
[
yuv
] << (
uv
 << (1+yuv)));

1144 
ü_cbp_tmp
 = 0;

1146 
b8
 = 0; b8 < (
p_Vid
->
num_blk8x8_uv
 >> 1); b8++)

1148 
b4
 = 0; b4 < 4; b4++)

1150 
n1
 = 
hÜ_off£t
[
yuv
][
b8
][
b4
];

1151 
n2
 = 
v”_off£t
[
yuv
][
b8
][
b4
];

1152 ià(
nÚz”o
[
n2
>>2][
n1
>>2] =ð
TRUE
)

1154 
nÚz”o
[
n2
>>2][
n1
>>2] = 
FALSE
;

1155 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][0];

1156 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][1];

1158 ià(
DCz”o
 == 0)

1159 
cu¼MB
->
cbp_blk
 &ð~(
uv_cbpblk
);

1161 
quªt_m‘hods
.
ACLev–
[0] = 0;

1163 
cÛff_ùr
=1; coeff_ctr < 16; coeff_ctr++)

1165 
mb_¼es
[
n2
 + 
pos_sÿn
[
cÛff_ùr
][1]][
n1
 +…os_scan[coeff_ctr][0]] = 0;

1166 
quªt_m‘hods
.
ACLev–
[
cÛff_ùr
] = 0;

1175 if(
ü_cbp_tmp
 == 2)

1176 
ü_cbp
 = 2;

1178 
nÚez”o
 = 
FALSE
;

1179 
n2
=0;‚2 < 
p_Vid
->
mb_ü_size_y
;‚2 +ð
BLOCK_SIZE
)

1181 
n1
=0;‚1 < 
p_Vid
->
mb_ü_size_x
;‚1 +ð
BLOCK_SIZE
)

1183 ià(
mb_¼es
[
n2
][
n1
] !ð0 || 
nÚz”o
[n2>>2][n1>>2] =ð
TRUE
)

1185 
	`šv”£4x4
(
mb_¼es
, mb_¼es, 
n2
, 
n1
);

1186 
nÚez”o
 = 
TRUE
;

1192 ià(
nÚez”o
 =ð
TRUE
)

1194 
	`§m¶e_»cÚ¡ruù
 (&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
], 
mb_´ed
, 
mb_¼es
, 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
, 
max_img³l_v®ue_uv
, 
DQ_BITS
);

1198 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
], 
mb_´ed
, cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1201  
ü_cbp
;

1202 
	}
}

1204 
	$Residu®_DPCM_Chroma
(
mode
, **
Ües
, **
¼es
, 
width
, 
height
)

1206 
i
,
j
;

1207 
‹mp
[16][16];

1209 if(
mode
==
VERT_PRED_8
)

1211 
j
=0; j<
width
; j++)

1212 
‹mp
[0][
j
] = 
Ües
[0][j];

1214 
j
=0; j<
width
; j++)

1215 
i
=1; i<
height
; i++)

1216 
‹mp
[
i
][
j
] = 
Ües
[i][j] - ores[i-1][j];

1218 
i
 = 0; i < 
height
; i++)

1219 
j
 = 0; j < 
width
; j++)

1220 
¼es
[
i
][
j
] = 
‹mp
[i][j];

1224 
i
=0; i<
height
; i++)

1225 
‹mp
[
i
][0] = 
Ües
[i][0];

1227 
i
=0; i<
height
; i++)

1228 
j
=1; j<
width
; j++)

1229 
‹mp
[
i
][
j
] = 
Ües
[i][j] - ores[i][j-1];

1231 
i
=0; i<
height
; i++)

1232 
j
=0; j<
width
; j++)

1233 
¼es
[
i
][
j
] = 
‹mp
[i][j];

1237 
	}
}

1239 
	$Inv_Residu®_DPCM_Chroma
(
mode
, **
m7
, 
width
, 
height
)

1241 
i
, 
j
;

1242 
‹mp
[16][16];

1244 if(
mode
 =ð
VERT_PRED_8
)

1246 
i
=0; i<
width
; i++)

1248 
‹mp
[0][
i
] = 
m7
[0][i];

1249 
j
=1; j<
height
; j++)

1251 
‹mp
[
j
][
i
] =emp[j-1][i] + 
m7
[j][i];

1254 
i
=0; i<
height
; i++)

1256 
j
 = 0; j < 
width
; j++)

1258 
m7
[
i
][
j
] = 
‹mp
[i][j];

1264 
i
=0; i<
height
; i++)

1266 
‹mp
[
i
][0] = 
m7
[i][0];

1267 
j
 = 1; j < 
width
; j++)

1269 
‹mp
[
i
][
j
] =emp[i][j-1] + 
m7
[i][j];

1272 
i
=0; i<
height
; i++)

1274 
j
 = 0; j < 
width
; j++)

1276 
m7
[
i
][
j
] = 
‹mp
[i][j];

1281 
	}
}

1299 
	$»sidu®_ŒªsfÜm_quªt_chroma_4x4_ls
(
Maüoblock
 *
cu¼MB
, 
uv
, 
ü_cbp
)

1301 
i
,
j
,
n2
,
n1
,
cÛff_ùr
,
Ëv–
 ,
sÿn_pos
,
run
;

1302 
m1
[
BLOCK_SIZE
];

1303 
cÛff_co¡
;

1304 
img³l
 *
Üig_img
, *
´ed_img
;

1306 
b4
;

1307 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1308 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1309 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

1310 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
uv
+1][0];

1311 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
uv
+1][1];

1312 * 
ACLev–
;

1313 * 
ACRun
;

1314 
uv_sÿË
 = 
uv
 * (
p_Vid
->
num_blk8x8_uv
 >> 1);

1317 
yuv
 = 
p_Vid
->
yuv_fÜm©
;

1318 
b8
;

1319 *
m7
;

1320 
m3
[4][4];

1322 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

1323 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
uv
 + 1];

1324 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
uv
 + 1];

1325 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
uv
 + 1];

1326 **
çdju¡4x4
;

1328 
šŒa
 = ((
cu¼MB
->
mb_ty³
 =ð
I4MB
è|| (cu¼MB->mb_ty³ =ð
I8MB
è|| (cu¼MB->mb_ty³ =ð
I16MB
));

1331 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
 && cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
)

1334 
çdju¡4x4
 = 
p_Vid
->
Ad­tiveRoundšg
 ?…_Vid->
ARCofAdj4x4
[
uv
 + 1][4] : 
NULL
;

1338 
çdju¡4x4
 = 
p_Vid
->
Ad­tiveRoundšg
 ?…_Vid->
ARCofAdj4x4
[
uv
 + 1][
cu¼MB
->
¬_mode
] : 
NULL
;

1341 if((
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 || cu¼MB->c_»d_mod=ð
VERT_PRED_8
è&& (
šŒa
))

1343 
	`Residu®_DPCM_Chroma
(
cu¼MB
->
c_»d_mode
, 
mb_Ües
, 
mb_¼es
, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1347 
j
=0; j < 
p_Vid
->
mb_ü_size_y
; j++)

1349 
i
=0; i < 
p_Vid
->
mb_ü_size_x
; i++)

1351 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j][i];

1356 ià(
yuv
 =ð
YUV420
)

1360 
run
=-1;

1361 
sÿn_pos
=0;

1362 
m1
[0] = 
mb_¼es
[0][0] ;

1363 
m1
[1] = 
mb_¼es
[0][4] ;

1364 
m1
[2] = 
mb_¼es
[4][0] ;

1365 
m1
[3] = 
mb_¼es
[4][4] ;

1367 
cÛff_ùr
=0; coeff_ctr < 4; coeff_ctr++)

1369 
run
++;

1371 
Ëv–
 =
	`Ÿbs
(
m1
[
cÛff_ùr
]);

1373 ià(
Ëv–
 != 0)

1375 ià(
is_ÿvlc
)

1376 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

1378 
cu¼MB
->
cbp_blk
 |ð0xf0000 << (
uv
 << 2) ;

1379 
ü_cbp
=
	`imax
(1, cr_cbp);

1380 
Ëv–
 = 
	`isigÇb
Öev–, 
m1
[
cÛff_ùr
]);

1381 
DCLev–
[
sÿn_pos
 ] = 
Ëv–
;

1382 
DCRun
 [
sÿn_pos
++] = 
run
;

1383 
run
=-1;

1386 
DCLev–
[
sÿn_pos
] = 0;

1388 if(
yuv
 =ð
YUV422
)

1395 
j
=0; j < 
p_Vid
->
mb_ü_size_y
; j+=
BLOCK_SIZE
)

1397 
i
=0; i < 
p_Vid
->
mb_ü_size_x
; i+=
BLOCK_SIZE
)

1399 
m3
[
i
>>2][
j
>>2] = 
mb_¼es
[j][i];

1404 
run
=-1;

1405 
sÿn_pos
=0;

1408 
cÛff_ùr
=0;coeff_ctr<8;coeff_ctr++)

1410 
i
=
SCAN_YUV422
[
cÛff_ùr
][0];

1411 
j
=
SCAN_YUV422
[
cÛff_ùr
][1];

1413 
run
++;

1415 
Ëv–
 = 
	`Ÿbs
(
m3
[
i
][
j
]);

1416 
cu¼Sliû
->
tblk4x4
[
i
][
j
]=
m3
[i][j];

1418 ià(
Ëv–
 != 0)

1421 
cu¼MB
->
cbp_blk
 |ð0xff0000 << (
uv
 << 3) ;

1422 
ü_cbp
=
	`imax
(1,cr_cbp);

1424 
DCLev–
[
sÿn_pos
 ] = 
	`isigÇb
(
Ëv–
,
cu¼Sliû
->
tblk4x4
[
i
][
j
]);

1425 
DCRun
 [
sÿn_pos
++] = 
run
;

1426 
run
=-1;

1429 
DCLev–
[
sÿn_pos
]=0;

1436 
cÛff_co¡
=0;

1438 
b8
=0; b8 < (
p_Vid
->
num_blk8x8_uv
 >> 1); b8++)

1440 
b4
=0; b4 < 4; b4++)

1442 
št64
 
uv_cbpblk
 = ((št64)1è<< 
cbp_blk_chroma
[
b8
 + 
uv_sÿË
][
b4
];

1443 
n1
 = 
hÜ_off£t
[
yuv
][
b8
][
b4
];

1444 
n2
 = 
v”_off£t
[
yuv
][
b8
][
b4
];

1445 
ACLev–
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][0];

1446 
ACRun
 = 
cu¼Sliû
->
cofAC
[4 + 
b8
 + 
uv_sÿË
][
b4
][1];

1447 
run
=-1;

1448 
sÿn_pos
=0;

1450 
cÛff_ùr
=1; coeff_ctr < 16; coeff_ctr++)

1452 
i
=
pos_sÿn
[
cÛff_ùr
][0];

1453 
j
=
pos_sÿn
[
cÛff_ùr
][1];

1455 ++
run
;

1457 
Ëv–
 = 
	`Ÿbs
(
mb_¼es
[
n2
+
j
][
n1
+
i
]);

1459 ià(
p_Vid
->
Ad­tiveRoundšg
)

1461 
çdju¡4x4
[
n2
+
j
][
n1
+
i
] = 0;

1464 ià(
Ëv–
 != 0)

1466 
ü_cbp
=
	`imax
(2, cr_cbp);

1468 
cu¼MB
->
cbp_blk
 |ð
uv_cbpblk
;

1469 
cÛff_co¡
 +ð
MAX_VALUE
;

1471 
ACLev–
[
sÿn_pos
 ] = 
	`isigÇb
(
Ëv–
, 
mb_¼es
[
n2
+
j
][
n1
+
i
]);

1472 
ACRun
 [
sÿn_pos
++] = 
run
;

1473 
run
=-1;

1475 
Ëv–
 = 
	`isigÇb
Öev–, 
mb_¼es
[
n2
+
j
][
n1
+
i
]);

1478 
ACLev–
[
sÿn_pos
] = 0;

1482 if((
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 || cu¼MB->c_»d_mod=ð
VERT_PRED_8
è&& 
šŒa
)

1484 
	`Inv_Residu®_DPCM_Chroma
(
cu¼MB
->
c_»d_mode
, 
mb_¼es
, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
) ;

1487 
j
=0; j < 
p_Vid
->
mb_ü_size_y
; ++j)

1489 
Üig_img
 = &
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
 + 
j
][cu¼MB->
pix_c_x
];

1490 
m7
 = 
mb_¼es
[
j
];

1491 
´ed_img
 = 
mb_´ed
[
j
];

1492 
i
=0; i < 
p_Vid
->
mb_ü_size_x
; ++i)

1494 
Üig_img
[
i
] = (
img³l
è
m7
[i] + 
´ed_img
[i];

1498  
ü_cbp
;

1499 
	}
}

1518 
	$»sidu®_ŒªsfÜm_quªt_luma_4x4_¥
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
,*
cÛff_co¡
, 
šŒa
)

1520 
i
,
j
,
cÛff_ùr
;

1521 
qp_cÚ¡
,
žev
, 
Ëv–
,
sÿn_pos
 = 0,
run
 = -1;

1522 
nÚz”o
 = 
FALSE
;

1523 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1524 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1526 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

1527 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

1528 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

1529 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

1530 
c_”r
,
qp_cÚ¡2
;

1532 
qp
 = 
cu¼MB
->
qp_sÿËd
[
¶
];

1533 
qp_¥
 = (
cu¼MB
->
qp¥
);

1535 cÚ¡ 
by‹
 *
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

1536 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

1538 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

1539 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

1540 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1);

1541 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

1542 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

1543 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

1546 
c_”r1
, 
c_”r2
, 
Ëv–1
, 
Ëv–2
;

1547 
D_dis1
, 
D_dis2
;

1548 
Ën
, 
šfo
;

1549 
Ïmbda_mode
 = 0.85 * 
	`pow
 (2, (
qp
 - 
SHIFT_QP
)/3.0) * 4;

1551 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

1553 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

1554 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

1555 
qp_³r_¥
 = 
p_Quªt
->
qp_³r_m©rix
[
qp_¥
];

1556 
q_b™s_¥
 = 
Q_BITS
 + 
qp_³r_¥
;

1558 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
p_Quªt
->q_·¿ms_4x4[
¶
][
šŒa
][
qp
];

1559 
Lev–QuªtP¬ams
 **
quªt_·¿ms_¥
 = 
p_Quªt
->
q_·¿ms_4x4
[
¶
][
šŒa
][
qp_¥
];

1561 
qp_cÚ¡
 = (1<<
q_b™s
)/6;

1562 
qp_cÚ¡2
 = (1<<
q_b™s_¥
)>>1;

1565 
j
=
block_y
; j< block_y + 
BLOCK_SIZE
; ++j)

1567 
i
=
block_x
; i< block_x + 
BLOCK_SIZE
; ++i)

1569 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j][i];

1570 
mb_¼es
[
j
][
i
]+=
mb_´ed
[j][i];

1571 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 
mb_´ed
[j][i];

1576 
	`fÜw¬d4x4
(
mb_¼es
, mb_¼es, 
block_y
, 
block_x
);

1577 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, cu¼Sliû->tblk16x16, 
block_y
, 
block_x
);

1579 
cÛff_ùr
 = 0;coeff_ctr < 16;coeff_ctr++)

1581 
i
 = 
pos_sÿn
[
cÛff_ùr
][0];

1582 
j
 = 
pos_sÿn
[
cÛff_ùr
][1];

1584 
run
++;

1585 
žev
=0;

1590 
Ëv–1
 = (
	`Ÿbs
 (
cu¼Sliû
->
tblk16x16
[
j
+
block_y
][
i
+
block_x
]è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
;

1591 
Ëv–1
 = (Ëv–1 << 
q_b™s_¥
è/ 
quªt_·¿ms_¥
[
j
][
i
].
SÿËComp
;

1592 
c_”r1
 = 
mb_¼es
[
j
+
block_y
][
i
+
block_x
] - 
	`isigÇb
(
Ëv–1
, 
cu¼Sliû
->
tblk16x16
[j+block_y][i+block_x]);

1593 
Ëv–1
 = (
	`Ÿbs
 (
c_”r1
è* 
q_·¿ms_4x4
[
j
][
i
].
SÿËComp
 + 
qp_cÚ¡
è>> 
q_b™s
;

1596 
c_”r2
 = 
mb_¼es
[
j
+
block_y
][
i
+
block_x
] - 
cu¼Sliû
->
tblk16x16
[j+block_y][i+block_x];

1597 
Ëv–2
 = (
	`Ÿbs
 (
c_”r2
è* 
q_·¿ms_4x4
[
j
][
i
].
SÿËComp
 + 
qp_cÚ¡
è>> 
q_b™s
;

1600 ià((
Ëv–1
 !ð
Ëv–2
) && (level1 != 0) && (level2 != 0))

1602 
D_dis1
 = 
mb_¼es
[
j
+
block_y
][
i
+
block_x
] -

1603 ((
	`isigÇb
(
Ëv–1
,
c_”r1
è* (
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
 >> 4è* 
A
[j][i]<< 
qp_³r
) >>6)

1604 - 
cu¼Sliû
->
tblk16x16
[
j
+
block_y
][
i
+
block_x
];

1605 
	`Ëvrun_lšfo_š‹r
(
Ëv–1
, 
run
, &
Ën
, &
šfo
);

1606 
D_dis1
 = D_dis1 * D_dis1 + 
Ïmbda_mode
 * 
Ën
;

1608 
D_dis2
 = 
mb_¼es
[
j
+
block_y
][
i
+
block_x
] -

1609 ((
	`isigÇb
(
Ëv–2
,
c_”r2
)* (
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
 >> 4)* 
A
[j][i]<< 
qp_³r
) >>6)

1610 - 
cu¼Sliû
->
tblk16x16
[
j
+
block_y
][
i
+
block_x
];

1611 
	`Ëvrun_lšfo_š‹r
(
Ëv–2
, 
run
, &
Ën
, &
šfo
);

1612 
D_dis2
 = D_dis2 * D_dis2 + 
Ïmbda_mode
 * 
Ën
;

1614 ià(
D_dis1
 =ð
D_dis2
)

1615 
Ëv–
 = (
	`Ÿbs
(
Ëv–1
è< iabs(
Ëv–2
)) ?†evel1 :†evel2;

1616 ià(
D_dis1
 < 
D_dis2
)

1617 
Ëv–
 = 
Ëv–1
;

1619 
Ëv–
 = 
Ëv–2
;

1621 
c_”r
 = (
Ëv–
 =ð
Ëv–1
è? 
c_”r1
 : 
c_”r2
;

1623 ià(
Ëv–1
 =ð
Ëv–2
)

1625 
Ëv–
 = 
Ëv–1
;

1626 
c_”r
 = 
c_”r1
;

1630 
Ëv–
 = (
Ëv–1
 =ð0è?†ev–1 : 
Ëv–2
;

1631 
c_”r
 = (
Ëv–1
 =ð0è? 
c_”r1
 : 
c_”r2
;

1634 ià(
Ëv–
 != 0)

1636 
nÚz”o
 = 
TRUE
;

1638 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

1640 
Ëv–
 = 
	`isigÇb
Öev–,
c_”r
);

1641 
ACLev–
[
sÿn_pos
] = 
Ëv–
;

1642 
ACRun
 [
sÿn_pos
] = 
run
;

1643 ++
sÿn_pos
;

1644 
run
=-1;

1645 
žev
=((
Ëv–
 * (
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
 >> 4)* 
A
[j][i] << 
qp_³r
) >>6);

1648 
žev
 +ð
cu¼Sliû
->
tblk16x16
[
j
+
block_y
][
i
+
block_x
];

1650 if(
cu¼Sliû
->
¦iû_ty³
 !ð
SI_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1652 
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
block_y
+
j
][cu¼MB->
pix_x
+
block_x
+
i
]=

1653 
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[
j
][
i
].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
, ilev);

1657 
mb_¼es
[
j
+
block_y
][
i
+
block_x
] = 
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
)>> 
q_b™s_¥
, iËvè* (quªt_·¿ms_¥[j][i].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

1659 
ACLev–
[
sÿn_pos
] = 0;

1662 
	`šv”£4x4
(
mb_¼es
, mb_¼es, 
block_y
, 
block_x
);

1664 
j
=
block_y
; j < block_y+
BLOCK_SIZE
; ++j)

1666 
i
=
block_x
; i < block_x+
BLOCK_SIZE
; ++i)

1668 
mb_¼es
[
j
][
i
] = 
	`iCl1
 (
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(mb_¼es[j][i], 
DQ_BITS
));

1673 
j
=0; j < 
BLOCK_SIZE
; ++j)

1675 
i
=0; i < 
BLOCK_SIZE
; ++i)

1677 
img_’c
[
cu¼MB
->
pix_y
+
block_y
+
j
][cu¼MB->
pix_x
+
block_x
+
i
]ð(
img³l
è
mb_¼es
[block_y+j][block_x+i];

1681  
nÚz”o
;

1682 
	}
}

1700 
	$»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
(
Maüoblock
 *
cu¼MB
, 
uv
,
ü_cbp
)

1702 
i
,
j
,
žev
,
n2
,
n1
,
cÛff_ùr
,
c_”r
,
Ëv–
 ,
sÿn_pos
,
run
;

1703 
m1
[
BLOCK_SIZE
];

1704 
cÛff_co¡
;

1705 
ü_cbp_tmp
;

1706 
mp1
[
BLOCK_SIZE
];

1707 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1708 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1709 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

1710 cÚ¡ 
by‹
 *
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

1711 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

1713 
šŒa
 = 
	`is_šŒa
 (
cu¼MB
);

1715 
b4
;

1716 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
uv
+1][0];

1717 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
uv
+1][1];

1719 
c_”r1
, 
c_”r2
, 
Ëv–1
, 
Ëv–2
;

1720 
Ën
, 
šfo
;

1721 
D_dis1
, 
D_dis2
;

1722 
Ïmbda_mode
 = 0.85 * 
	`pow
 (2, (
cu¼MB
->
qp
 -
SHIFT_QP
)/3.0) * 4;

1723 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

1725 
qpChroma
 = 
cu¼MB
->
qpc
[
uv
] + 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
;

1726 
qpc_¥
 = 
	`iCl3
(-
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
, 51, 
cu¼MB
->
qp¥
 + 
p_Vid
->
aùive_µs
->
chroma_qp_šdex_off£t
);

1727 
qpChromaSP
 = 
qpc_¥
 < 0 ? qpc_¥ : 
QP_SCALE_CR
[qpc_sp];

1729 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
uv
 + 1];

1730 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
uv
 + 1];

1731 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
uv
 + 1];

1733 
QuªtM‘hods
 
quªt_m‘hods
;

1734 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

1736 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qpChroma
];

1737 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

1738 
qp_cÚ¡
 = (1<<
q_b™s
)/6;

1739 
qp_³r_¥
 = 
p_Quªt
->
qp_³r_m©rix
[
qpChromaSP
];

1740 
q_b™s_¥
 = 
Q_BITS
 + 
qp_³r_¥
;

1741 
qp_cÚ¡2
 = (1<<
q_b™s_¥
)>>1;

1743 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
p_Quªt
->q_·¿ms_4x4[
uv
 + 1][
šŒa
][
qpChroma
];

1745 
Lev–QuªtP¬ams
 **
quªt_·¿ms_¥
 = 
p_Quªt
->
q_·¿ms_4x4
[
uv
 + 1][
šŒa
][
qpChromaSP
];

1747 
quªt_m‘hods
.
ty³
 = 
CHROMA_AC
;

1749 
j
=0; j < 
p_Vid
->
mb_ü_size_y
; ++j)

1751 
i
=0; i < 
p_Vid
->
mb_ü_size_x
; ++i)

1753 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j][i];

1754 
mb_¼es
[
j
][
i
] +ð
mb_´ed
[j][i];

1755 
cu¼Sliû
->
tblk16x16
[
j
][
i
] = 
mb_´ed
[j][i];

1759 
n2
=0;‚2 < 
p_Vid
->
mb_ü_size_y
;‚2 +ð
BLOCK_SIZE
)

1761 
n1
=0;‚1 < 
p_Vid
->
mb_ü_size_x
;‚1 +ð
BLOCK_SIZE
)

1763 
	`fÜw¬d4x4
(
mb_¼es
, mb_¼es, 
n2
, 
n1
);

1764 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, cu¼Sliû->tblk16x16, 
n2
, 
n1
);

1769 
	`hadam¬d2x2
(
mb_¼es
, 
m1
);

1770 
	`hadam¬d2x2
(
cu¼Sliû
->
tblk16x16
, 
mp1
);

1772 
run
=-1;

1773 
sÿn_pos
=0;

1775 
cÛff_ùr
 = 0; coeff_ctr < 4; coeff_ctr++)

1777 
run
++;

1778 
žev
=0;

1781 
c_”r1
 = (
	`Ÿbs
 (
mp1
[
cÛff_ùr
]è* 
quªt_·¿ms_¥
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡2
è>> (
q_b™s_¥
 + 1);

1782 
c_”r1
 = (c_”r1 << (
q_b™s_¥
 + 1)è/ 
quªt_·¿ms_¥
[0][0].
SÿËComp
;

1783 
c_”r1
 = 
m1
[
cÛff_ùr
] - 
	`isigÇb
(c_”r1, 
mp1
[coeff_ctr]);

1784 
Ëv–1
 = (
	`Ÿbs
(
c_”r1
è* 
q_·¿ms_4x4
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡
è>> (
q_b™s
+1);

1787 
c_”r2
 = 
m1
[
cÛff_ùr
] - 
mp1
[coeff_ctr];

1788 
Ëv–2
 = (
	`Ÿbs
(
c_”r2
è* 
q_·¿ms_4x4
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡
è>> (
q_b™s
+1);

1790 ià(
Ëv–1
 !ð
Ëv–2
 &&†evel1 != 0 &&†evel2 != 0)

1792 
D_dis1
 = 
m1
[
cÛff_ùr
] - ((
	`isigÇb
(
Ëv–1
,
c_”r1
)* (
q_·¿ms_4x4
[0][0].
InvSÿËComp
 >> 4è* 
A
[0][0]<< 
qp_³r
è>>5)- 
mp1
[coeff_ctr];

1793 
	`Ëvrun_lšfo_c2x2
(
Ëv–1
, 
run
, &
Ën
, &
šfo
);

1794 
D_dis1
 = D_dis1 * D_dis1 + 
Ïmbda_mode
 * 
Ën
;

1796 
D_dis2
 = 
m1
[
cÛff_ùr
] - ((
	`isigÇb
(
Ëv–2
,
c_”r2
)* (
q_·¿ms_4x4
[0][0].
InvSÿËComp
 >> 4è* 
A
[0][0]<< 
qp_³r
è>>5)- 
mp1
[coeff_ctr];

1797 
	`Ëvrun_lšfo_c2x2
(
Ëv–2
, 
run
, &
Ën
, &
šfo
);

1798 
D_dis2
 = D_dis2 * D_dis2 + 
Ïmbda_mode
 * 
Ën
;

1800 ià(
D_dis1
 =ð
D_dis2
)

1801 
Ëv–
 = (
	`Ÿbs
(
Ëv–1
è< iabs(
Ëv–2
)) ?†evel1 :†evel2;

1802 ià(
D_dis1
 < 
D_dis2
)

1803 
Ëv–
 = 
Ëv–1
;

1805 
Ëv–
 = 
Ëv–2
;

1807 
c_”r
 = (
Ëv–
 =ð
Ëv–1
è? 
c_”r1
 : 
c_”r2
;

1809 ià(
Ëv–1
 =ð
Ëv–2
)

1811 
Ëv–
 = 
Ëv–1
;

1812 
c_”r
 = 
c_”r1
;

1816 
Ëv–
 = (
Ëv–1
 =ð0è?†ev–1 : 
Ëv–2
;

1817 
c_”r
 = (
Ëv–1
 =ð0è? 
c_”r1
 : 
c_”r2
;

1820 ià(
Ëv–
 != 0)

1822 ià(
is_ÿvlc
)

1823 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

1825 
cu¼MB
->
cbp_blk
 |ð0xf0000 << (
uv
 << 2) ;

1826 
ü_cbp
 = 
	`imax
(1, cr_cbp);

1827 
DCLev–
[
sÿn_pos
 ] = 
	`isigÇb
(
Ëv–
 ,
c_”r
);

1828 
DCRun
 [
sÿn_pos
++] = 
run
;

1829 
run
=-1;

1830 
žev
=((
	`isigÇb
(
Ëv–
,
c_”r
)* (
q_·¿ms_4x4
[0][0].
InvSÿËComp
*
A
[0][0] >> 4è<< 
qp_³r
) >>5);

1833 
žev
+ð
mp1
[
cÛff_ùr
];

1834 
m1
[
cÛff_ùr
]=
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡2
è>> (
q_b™s_¥
+1), iËvè* (quªt_·¿ms_¥[0][0].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

1835 if(
cu¼Sliû
->
¦iû_ty³
 !ð
SI_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1836 
p_Vid
->
Ìec_uv
[
uv
][
cu¼MB
->
pix_c_y
 + 4*(
cÛff_ùr
 & 0x01)][cu¼MB->
pix_c_x
 + 4*(cÛff_ùr>>1)]=
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡2
è>> (
q_b™s_¥
+1), ilev);

1838 
DCLev–
[
sÿn_pos
] = 0;

1841 
	`ihadam¬d2x2
(
m1
, m1);

1843 
mb_¼es
[0][0]=(
m1
[0])>>1;

1844 
mb_¼es
[0][4]=(
m1
[1])>>1;

1845 
mb_¼es
[4][0]=(
m1
[2])>>1;

1846 
mb_¼es
[4][4]=(
m1
[3])>>1;

1849 
cÛff_co¡
=0;

1850 
ü_cbp_tmp
=0;

1852 
n2
=0;‚2 <ð
BLOCK_SIZE
;‚2 += BLOCK_SIZE)

1854 
n1
=0;‚1 <ð
BLOCK_SIZE
;‚1 += BLOCK_SIZE)

1856 
b4
 = 2*(
n2
 >> 2è+ (
n1
 >> 2);

1857 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[
uv
+4][
b4
][0];

1858 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[
uv
+4][
b4
][1];

1860 
run
 = -1;

1861 
sÿn_pos
 = 0;

1863 
cÛff_ùr
=1; coeff_ctr < 16; coeff_ctr++)

1865 
i
=
pos_sÿn
[
cÛff_ùr
][0];

1866 
j
=
pos_sÿn
[
cÛff_ùr
][1];

1868 ++
run
;

1869 
žev
=0;

1872 
c_”r1
 = (
	`Ÿbs
(
cu¼Sliû
->
tblk16x16
[
n2
+
j
][
n1
+
i
]è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
;

1873 
c_”r1
 = (c_”r1 << 
q_b™s_¥
è/ 
quªt_·¿ms_¥
[
j
][
i
].
SÿËComp
;

1874 
c_”r1
 = 
mb_¼es
[
n2
+
j
][
n1
+
i
] - 
	`isigÇb
(c_”r1, 
cu¼Sliû
->
tblk16x16
[n2+j][n1+i]);

1875 
Ëv–1
 = (
	`Ÿbs
(
c_”r1
è* 
q_·¿ms_4x4
[
j
][
i
].
SÿËComp
 + 
qp_cÚ¡
è>> 
q_b™s
;

1878 
c_”r2
 = 
mb_¼es
[
n2
+
j
][
n1
+
i
] - 
cu¼Sliû
->
tblk16x16
[n2+j][n1+i];

1879 
Ëv–2
 = (
	`Ÿbs
(
c_”r2
è* 
q_·¿ms_4x4
[
j
][
i
].
SÿËComp
 + 
qp_cÚ¡
è>> 
q_b™s
;

1881 ià(
Ëv–1
 !ð
Ëv–2
 &&†evel1 != 0 &&†evel2 != 0)

1883 
D_dis1
 = 
mb_¼es
[
n2
+
j
][
n1
+
i
] - ((
	`isigÇb
(
Ëv–1
,
c_”r1
è* (
q_·¿ms_4x4
[j][i].
InvSÿËComp
 >> 4è* 
A
[j][i]<< 
qp_³r
è>>6è- 
cu¼Sliû
->
tblk16x16
[n2+j][n1+i];

1885 
	`Ëvrun_lšfo_š‹r
(
Ëv–1
, 
run
, &
Ën
, &
šfo
);

1886 
D_dis1
 = D_dis1 * D_dis1 + 
Ïmbda_mode
 * 
Ën
;

1888 
D_dis2
 = 
mb_¼es
[
n2
+
j
][
n1
+
i
] - ((
	`isigÇb
(
Ëv–2
,
c_”r2
)* (
q_·¿ms_4x4
[j][i].
InvSÿËComp
*
A
[j][i] >> 4è<< 
qp_³r
è>>6è- 
cu¼Sliû
->
tblk16x16
[n2+j][n1+i];

1889 
	`Ëvrun_lšfo_š‹r
(
Ëv–2
, 
run
, &
Ën
, &
šfo
);

1890 
D_dis2
 = D_dis2 * D_dis2 + 
Ïmbda_mode
 * 
Ën
;

1892 ià(
D_dis1
 =ð
D_dis2
)

1893 
Ëv–
 = (
	`Ÿbs
(
Ëv–1
è< iabs(
Ëv–2
)) ?†evel1 :†evel2;

1896 ià(
D_dis1
 < 
D_dis2
)

1897 
Ëv–
 = 
Ëv–1
;

1899 
Ëv–
 = 
Ëv–2
;

1901 
c_”r
 = (
Ëv–
 =ð
Ëv–1
è? 
c_”r1
 : 
c_”r2
;

1903 ià(
Ëv–1
 =ð
Ëv–2
)

1905 
Ëv–
 = 
Ëv–1
;

1906 
c_”r
 = 
c_”r1
;

1910 
Ëv–
 = (
Ëv–1
 =ð0è?†ev–1 : 
Ëv–2
;

1911 
c_”r
 = (
Ëv–1
 =ð0è? 
c_”r1
 : 
c_”r2
;

1914 ià(
Ëv–
 != 0)

1916 
cu¼MB
->
cbp_blk
 |ð(
št64
)1 << (16 + (
uv
 << 2è+ ((
n2
 >> 1è+ (
n1
 >> 2))) ;

1918 
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

1920 
ü_cbp_tmp
=2;

1921 
Ëv–
 = 
	`isigÇb
Öev–,
c_”r
);

1922 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 
Ëv–
;

1923 
quªt_m‘hods
.
ACRun
 [
sÿn_pos
] = 
run
;

1924 ++
sÿn_pos
;

1925 
run
=-1;

1926 
žev
=((
Ëv–
 * (
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
*
A
[j][i] >> 4è<< 
qp_³r
) >>6);

1928 
žev
+=
cu¼Sliû
->
tblk16x16
[
n2
+
j
][
n1
+
i
];

1929 if(
cu¼Sliû
->
¦iû_ty³
 !ð
SI_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1930 if(!Ð((
n2
+
j
è& 0x03)==0 && ((
n1
+
i
) & 0x03) ==0 ))

1931 
p_Vid
->
Ìec_uv
[
uv
][
cu¼MB
->
pix_c_y
 + 
n2
+
j
][cu¼MB->
pix_c_x
 + 
n1
 + 
i
]=
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
,ilev);

1932 
mb_¼es
[
n2
+
j
][
n1
+
i
] = 
	`isigÇb
((
	`Ÿbs
(
žev
è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
,ževè* (quªt_·¿ms_¥[j][i].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

1934 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 0;

1940 if(
ü_cbp_tmp
==2)

1941 
ü_cbp
=2;

1945 
n2
=0;‚2 <ð
BLOCK_SIZE
;‚2 += BLOCK_SIZE)

1947 
n1
=0;‚1 <ð
BLOCK_SIZE
;‚1 += BLOCK_SIZE)

1949 
	`šv”£4x4
(
mb_¼es
, mb_¼es, 
n2
, 
n1
);

1951 
j
=0; j < 
BLOCK_SIZE
; ++j)

1952 
i
=0; i < 
BLOCK_SIZE
; ++i)

1954 
mb_¼es
[
n2
+
j
][
n1
+
i
] = 
	`iCl1
 (
max_img³l_v®ue_uv
,
	`rshiá_ºd_sf
(mb_¼es[n2+j][n1+i], 
DQ_BITS
));

1960 
j
=0; j < 
BLOCK_SIZE
*2; ++j)

1961 
i
=0; i < 
BLOCK_SIZE
*2; ++i)

1963 
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
 + 
j
][cu¼MB->
pix_c_x
 + 
i
]ð(
img³l
è
mb_¼es
[j][i];

1966  
ü_cbp
;

1967 
	}
}

1985 
	$cÝyblock_¥
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
)

1987 
i
, 
j
;

1989 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1990 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1991 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

1992 
cur_qp
 = 
cu¼MB
->
qp¥
 + 
p_Vid
->
b™d•th_luma_qp_sÿË
;

1993 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
cur_qp
];

1994 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

1995 
qp_cÚ¡2
 = (1 << 
q_b™s
) >> 1;

1996 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

1997 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

1998 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

1999 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

2001 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
p_Quªt
->q_·¿ms_4x4[
¶
][0][
cur_qp
];

2004 
j
=0; j< 
BLOCK_SIZE
; ++j)

2006 
i
=0; i< 
BLOCK_SIZE
; ++i)

2008 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j+
block_y
][i+
block_x
];

2009 
cu¼Sliû
->
tblk16x16
[
j
][
i
]=
mb_´ed
[j+
block_y
][i+
block_x
];

2013 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, currSlice->tblk16x16, 0, 0);

2016 
j
=0;j < 
BLOCK_SIZE
; ++j)

2018 
i
=0; i < 
BLOCK_SIZE
; ++i)

2020 
mb_¼es
[
j
][
i
]=
	`isigÇb
((
	`Ÿbs
(
cu¼Sliû
->
tblk16x16
[j][i])* 
q_·¿ms_4x4
[j][i].
SÿËComp
+
qp_cÚ¡2
)>> 
q_b™s
,

2021 
cu¼Sliû
->
tblk16x16
[
j
][
i
]è* (
q_·¿ms_4x4
[j][i].
InvSÿËComp
 >> 4è<<
qp_³r
;

2022 if(
cu¼Sliû
->
¦iû_ty³
 !ð
SI_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

2024 
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
block_y
+
j
][cu¼MB->
pix_x
+
block_x
+
i
] =

2025 
	`isigÇb
((
	`Ÿbs
(
cu¼Sliû
->
tblk16x16
[
j
][
i
]è* 
q_·¿ms_4x4
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s
, currSlice->tblk16x16[j][i]);

2032 
	`šv”£4x4
(
mb_¼es
, mb_rres, 0, 0);

2035 
j
=0; j < 
BLOCK_SIZE
; ++j)

2037 
i
=0; i < 
BLOCK_SIZE
; ++i)

2039 
mb_¼es
[
j
][
i
] = 
	`iCl1
 (
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(mb_¼es[j][i], 
DQ_BITS
));

2040 
img_’c
[
cu¼MB
->
pix_y
+
block_y
+
j
][cu¼MB->
pix_x
+
block_x
+
i
]=(
img³l
è
mb_¼es
[j][i];

2044 
	}
}

2068 
	$»sidu®_ŒªsfÜm_quªt_luma_4x4_¥2
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block_x
,
block_y
,*
cÛff_co¡
, 
šŒa
)

2070 
i
,
j
,
žev
,
cÛff_ùr
;

2071 
Ëv–
,
sÿn_pos
 = 0,
run
 = -1;

2072 
nÚz”o
 = 
FALSE
;

2074 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2075 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

2076 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

2077 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

2078 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

2080 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

2081 
c_”r
,
qp_cÚ¡2
;

2083 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

2084 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

2085 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1);

2086 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

2087 cÚ¡ 
by‹
 *
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

2088 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

2090 
Ëv–1
;

2092 
qp_¥
 = (
cu¼MB
->
qp¥
);

2094 
qp_³r_¥
 = 
p_Quªt
->
qp_³r_m©rix
[
qp_¥
];

2095 
q_b™s_¥
 = 
Q_BITS
 + 
qp_³r_¥
;

2098 
Lev–QuªtP¬ams
 **
quªt_·¿ms_¥
 = 
p_Quªt
->
q_·¿ms_4x4
[
¶
][
šŒa
][
qp_¥
];

2099 
QuªtM‘hods
 
quªt_m‘hods
;

2101 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

2102 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

2104 
qp_cÚ¡2
=(1<<
q_b™s_¥
)>>1;

2106 
j
=0; j< 
BLOCK_SIZE
; ++j)

2108 
i
=0; i< 
BLOCK_SIZE
; ++i)

2111 
mb_¼es
[
j
][
i
] = 
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
block_y
+j][cu¼MB->
pix_x
+
block_x
+i];

2113 
cu¼Sliû
->
tblk16x16
[
j
][
i
]=
mb_´ed
[j+
block_y
][i+
block_x
];

2117 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, currSlice->tblk16x16, 0, 0);

2119 
cÛff_ùr
=0;coeff_ctr < 16;coeff_ctr++)

2122 
i
=
pos_sÿn
[
cÛff_ùr
][0];

2123 
j
=
pos_sÿn
[
cÛff_ùr
][1];

2125 
run
++;

2126 
žev
=0;

2129 
Ëv–1
 = (
	`Ÿbs
 (
cu¼Sliû
->
tblk16x16
[
j
][
i
]è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
;

2131 
c_”r
 = 
mb_¼es
[
j
][
i
]-
	`isigÇb
(
Ëv–1
, 
cu¼Sliû
->
tblk16x16
[j][i]);

2133 
Ëv–
 = 
	`Ÿbs
(
c_”r
);

2134 ià(
Ëv–
 != 0)

2136 
nÚz”o
=
TRUE
;

2138 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

2140 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 
	`isigÇb
(
Ëv–
,
c_”r
);

2141 
quªt_m‘hods
.
ACRun
 [
sÿn_pos
] = 
run
;

2142 ++
sÿn_pos
;

2143 
run
=-1;

2146 
žev
=
c_”r
 + 
	`isigÇb
(
Ëv–1
,
cu¼Sliû
->
tblk16x16
[
j
][
i
]) ;

2147 
mb_¼es
[
j
][
i
] = 
žev
 * (
quªt_·¿ms_¥
[j][i].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

2149 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 0;

2152 
	`šv”£4x4
(
mb_¼es
, mb_rres, 0, 0);

2154 
j
=0; j < 
BLOCK_SIZE
; ++j)

2156 
i
=0; i < 
BLOCK_SIZE
; ++i)

2158 
img_’c
[
cu¼MB
->
pix_y
+
block_y
+
j
][cu¼MB->
pix_x
+
block_x
+
i
] = (
img³l
è
	`iCl3
 (0, 
p_Vid
->
max_img³l_v®ue
,
	`rshiá_ºd_sf
(
mb_¼es
[j][i], 
DQ_BITS
));

2162  
nÚz”o
;

2163 
	}
}

2185 
	$»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
(
Maüoblock
 *
cu¼MB
, 
uv
,
ü_cbp
)

2187 
i
,
j
,
žev
,
n2
,
n1
,
cÛff_ùr
,
c_”r
,
Ëv–
 ,
sÿn_pos
 = 0,
run
 = -1;

2188 
m1
[
BLOCK_SIZE
];

2189 
cÛff_co¡
;

2190 
ü_cbp_tmp
;

2191 
mp1
[
BLOCK_SIZE
];

2192 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2193 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

2194 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

2195 
QuªtM‘hods
 
quªt_m‘hods
;

2196 cÚ¡ 
by‹
 *
c_co¡
 = 
COEFF_COST4x4
[
cu¼Sliû
->
di¡h»s
];

2197 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN
 : 
SNGL_SCAN
;

2199 
b4
;

2200 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
uv
+1][0];

2201 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
uv
+1][1];

2202 
Ëv–1
;

2203 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
uv
 + 1];

2204 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
uv
 + 1];

2205 
šŒa
 = 
	`is_šŒa
 (
cu¼MB
);

2207 
qpChroma
 = 
cu¼MB
->
qpc
[
uv
] + 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
;

2209 
qpc_¥
 = 
	`iCl3
(-
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
, 51, 
cu¼MB
->
qp¥
 + 
p_Vid
->
aùive_µs
->
chroma_qp_šdex_off£t
);

2211 
qpChromaSP
 = 
qpc_¥
 < 0 ? qpc_¥ : 
QP_SCALE_CR
[qpc_sp];

2213 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qpChroma
];

2215 
qp_³r_¥
 = 
p_Quªt
->
qp_³r_m©rix
[
qpChromaSP
];

2216 
q_b™s_¥
 = 
Q_BITS
 + 
qp_³r
;

2217 
qp_cÚ¡2
 = (1 << 
q_b™s_¥
)>>1;

2220 
Lev–QuªtP¬ams
 **
quªt_·¿ms_¥
 = 
p_Quªt
->
q_·¿ms_4x4
[
uv
 + 1][
šŒa
][
qpChromaSP
];

2222 
j
=0; j < 
MB_BLOCK_SIZE
>>1; ++j)

2224 
i
=0; i < 
MB_BLOCK_SIZE
>>1; ++i)

2226 
cu¼Sliû
->
tblk16x16
[
j
][
i
]=
mb_´ed
[j][i];

2227 
mb_¼es
[
j
][
i
]=
p_Vid
->
Ìec_uv
[
uv
][
cu¼MB
->
pix_c_y
 + j][cu¼MB->
pix_c_x
 + i];

2232 
n2
=0;‚2 <ð
BLOCK_SIZE
;‚2 += BLOCK_SIZE)

2234 
n1
=0;‚1 <ð
BLOCK_SIZE
;‚1 += BLOCK_SIZE)

2236 
	`fÜw¬d4x4
(
cu¼Sliû
->
tblk16x16
, cu¼Sliû->tblk16x16, 
n2
, 
n1
);

2241 
m1
[0]ð
mb_¼es
[0][0];

2242 
m1
[1]ð
mb_¼es
[0][4];

2243 
m1
[2]ð
mb_¼es
[4][0];

2244 
m1
[3]ð
mb_¼es
[4][4];

2247 
	`hadam¬d2x2
(
cu¼Sliû
->
tblk16x16
, 
mp1
);

2249 
cÛff_ùr
=0; coeff_ctr < 4; coeff_ctr++)

2251 
run
++;

2252 
žev
=0;

2255 
Ëv–1
 = (
	`Ÿbs
 (
mp1
[
cÛff_ùr
]è* 
quªt_·¿ms_¥
[0][0].
SÿËComp
 + 2 * 
qp_cÚ¡2
è>> (
q_b™s_¥
 + 1);

2257 
c_”r
 = 
m1
[
cÛff_ùr
] - 
	`isigÇb
(
Ëv–1
, 
mp1
[coeff_ctr]);

2258 
Ëv–
 = 
	`Ÿbs
(
c_”r
);

2260 ià(
Ëv–
 != 0)

2262 
cu¼MB
->
cbp_blk
 |ð0xf0000 << (
uv
 << 2) ;

2263 
ü_cbp
=
	`imax
(1,cr_cbp);

2264 
DCLev–
[
sÿn_pos
] = 
	`isigÇb
(
Ëv–
 ,
c_”r
);

2265 
DCRun
 [
sÿn_pos
] = 
run
;

2266 
sÿn_pos
++;

2267 
run
=-1;

2271 
žev
 = 
c_”r
 + 
	`isigÇb
(
Ëv–1
,
mp1
[
cÛff_ùr
]) ;

2273 
m1
[
cÛff_ùr
]ð
žev
 * (
quªt_·¿ms_¥
[0][0].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

2276 
DCLev–
[
sÿn_pos
] = 0;

2279 
	`ihadam¬d2x2
(
m1
, m1);

2281 
mb_¼es
[0][0]=
m1
[0]>>1;

2282 
mb_¼es
[0][4]=
m1
[1]>>1;

2283 
mb_¼es
[4][0]=
m1
[2]>>1;

2284 
mb_¼es
[4][4]=
m1
[3]>>1;

2287 
cÛff_co¡
=0;

2288 
ü_cbp_tmp
=0;

2290 
n2
=0;‚2 <ð
BLOCK_SIZE
;‚2 += BLOCK_SIZE)

2292 
n1
=0;‚1 <ð
BLOCK_SIZE
;‚1 += BLOCK_SIZE)

2294 
b4
 = 2*(
n2
 >> 2è+ (
n1
 >> 2);

2295 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[
uv
+4][
b4
][0];

2296 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[
uv
+4][
b4
][1];

2298 
run
 = -1;

2299 
sÿn_pos
 = 0;

2301 
cÛff_ùr
=1; coeff_ctr < 16; coeff_ctr++)

2304 
i
=
pos_sÿn
[
cÛff_ùr
][0];

2305 
j
=
pos_sÿn
[
cÛff_ùr
][1];

2307 ++
run
;

2308 
žev
=0;

2310 
Ëv–1
 = (
	`Ÿbs
(
cu¼Sliû
->
tblk16x16
[
n2
+
j
][
n1
+
i
]è* 
quªt_·¿ms_¥
[j][i].
SÿËComp
 + 
qp_cÚ¡2
è>> 
q_b™s_¥
;

2312 
c_”r
 = 
mb_¼es
[
n2
+
j
][
n1
+
i
] - 
	`isigÇb
(
Ëv–1
, 
cu¼Sliû
->
tblk16x16
[n2+j][n1+i]);

2313 
Ëv–
 = 
	`Ÿbs
(
c_”r
) ;

2315 ià(
Ëv–
 != 0)

2317 
cu¼MB
->
cbp_blk
 |ð(
št64
)1 << (16 + (
uv
 << 2è+ ((
n2
 >> 1è+ (
n1
 >> 2))) ;

2319 
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

2321 
ü_cbp_tmp
=2;

2322 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 
	`isigÇb
(
Ëv–
,
c_”r
);

2323 
quªt_m‘hods
.
ACRun
 [
sÿn_pos
] = 
run
;

2324 ++
sÿn_pos
;

2325 
run
=-1;

2329 
žev
=
c_”r
 + 
	`isigÇb
(
Ëv–1
,
cu¼Sliû
->
tblk16x16
[
n2
+
j
][
n1
+
i
]);

2330 
mb_¼es
[
n2
+
j
][
n1
+
i
] = 
žev
 * (
quªt_·¿ms_¥
[j][i].
InvSÿËComp
 >> 4è<< 
qp_³r_¥
;

2332 
quªt_m‘hods
.
ACLev–
[
sÿn_pos
] = 0;

2337 if(
ü_cbp_tmp
==2)

2338 
ü_cbp
=2;

2342 
n2
=0;‚2 <ð
BLOCK_SIZE
;‚2 += BLOCK_SIZE)

2344 
n1
=0;‚1 <ð
BLOCK_SIZE
;‚1 += BLOCK_SIZE)

2346 
	`šv”£4x4
(
mb_¼es
, mb_¼es, 
n2
, 
n1
);

2349 
j
=0; j < 
BLOCK_SIZE
; ++j)

2351 
i
=0; i < 
BLOCK_SIZE
; ++i)

2353 
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
 + 
j
 + 
n2
][cu¼MB->
pix_c_x
 + 
i
 + 
n1
 ] =

2354 (
img³l
è
	`iCl3
 (0, 
p_Vid
->
max_img³l_v®ue
,
	`rshiá_ºd_sf
(
mb_¼es
[
n2
+
j
][
n1
+
i
], 
DQ_BITS
));

2360  
ü_cbp
;

2361 
	}
}

2364 
	$£Ëù_ŒªsfÜm
(
Maüoblock
 *
cu¼MB
)

2366 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2368 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

2370 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2371 ià(
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 1)

2373 ià(
cu¼MB
->
qp_sÿËd
[(è
p_Vid
->
cÞour_¶ªe_id
] == 0)

2375 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_4x4
 = 
»sidu®_ŒªsfÜm_quªt_luma_4x4_ls
;

2376 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_16x16
 = 
»sidu®_ŒªsfÜm_quªt_luma_16x16_ls
;

2377 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 = 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ls
;

2381 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_4x4
 =„esidual_transform_quant_luma_4x4;

2382 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_16x16
 =„esidual_transform_quant_luma_16x16;

2383 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

2384 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 = 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
;

2386 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 =„esidual_transform_quant_luma_8x8;

2387 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[0] =„esidual_transform_quant_chroma_4x4;

2388 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[1] =„esidual_transform_quant_chroma_4x4;

2391 ià(
cu¼MB
->
qp_sÿËd
[
PLANE_U
] == 0)

2393 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[0] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_ls
;

2395 ià(
cu¼MB
->
qp_sÿËd
[
PLANE_V
] == 0)

2397 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[1] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_ls
;

2402 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_4x4
 =„esidual_transform_quant_luma_4x4;

2403 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_16x16
 =„esidual_transform_quant_luma_16x16;

2404 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

2405 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 = 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
;

2407 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 =„esidual_transform_quant_luma_8x8;

2409 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[0] =„esidual_transform_quant_chroma_4x4;

2410 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[1] =„esidual_transform_quant_chroma_4x4;

2413 if(
cu¼Sliû
->
¦iû_ty³
 !ð
SI_SLICE
 && !cu¼Sliû->
¥2_äame_šdiÿtÜ
)

2415 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_4x4
 = 
»sidu®_ŒªsfÜm_quªt_luma_4x4_¥
;

2416 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_16x16
 =„esidual_transform_quant_luma_16x16;

2417 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

2418 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 = 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
;

2420 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 =„esidual_transform_quant_luma_8x8;

2422 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[0] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
;

2423 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[1] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
;

2427 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_4x4
 = 
»sidu®_ŒªsfÜm_quªt_luma_4x4_¥2
;

2428 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_16x16
 =„esidual_transform_quant_luma_16x16;

2429 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

2430 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 = 
»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
;

2432 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_luma_8x8
 =„esidual_transform_quant_luma_8x8;

2434 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[0] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
;

2435 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[1] = 
»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
;

2437 
	}
}

	@lencod/src/cabac.c

14 
	~"glob®.h
"

16 
	~"ÿbac.h
"

17 
	~"bŸr›ncode.h
"

18 
	~"image.h
"

19 
	~"mb_acûss.h
"

21 #ià
TRACE


22 
	#CABAC_TRACE
 ià(
dp
->
b™¡»am
->
Œaû_’abËd
è
	`Œaû2out_ÿbac
 (
£
)

	)

24 
	#CABAC_TRACE


	)

36 cÚ¡ 
by‹
 
	gpos2ùx_m­8x8
 [] = {

43 cÚ¡ 
by‹
 
	gpos2ùx_m­8x4
 [] = {

48 cÚ¡ 
by‹
 
	gpos2ùx_m­4x4
 [] = {

52 cÚ¡ 
by‹
 
	gpos2ùx_m­2x4c
[] = {

56 cÚ¡ 
by‹
 
	gpos2ùx_m­4x4c
[] = {

60 cÚ¡ 
by‹
* 
	gpos2ùx_m­
 [] = {

61 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8
, 
pos2ùx_m­8x4
,

62 
pos2ùx_m­8x4
, 
pos2ùx_m­4x4
,…os2ctx_map4x4,…os2ctx_map4x4,

63 
pos2ùx_m­2x4c
, 
pos2ùx_m­4x4c
,

64 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8
,
pos2ùx_m­8x4
,

65 
pos2ùx_m­8x4
, 
pos2ùx_m­4x4
,

66 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8
,
pos2ùx_m­8x4
,

67 
pos2ùx_m­8x4
,
pos2ùx_m­4x4


72 cÚ¡ 
by‹
 
	gpos2ùx_m­8x8i
[] = {

79 cÚ¡ 
by‹
 
	gpos2ùx_m­8x4i
[] = {

84 cÚ¡ 
by‹
 
	gpos2ùx_m­4x8i
[] = {

89 cÚ¡ 
by‹
* 
	gpos2ùx_m­_št
[] = {

90 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8i
,
pos2ùx_m­8x4i
,

91 
pos2ùx_m­4x8i
,
pos2ùx_m­4x4
,…os2ctx_map4x4,…os2ctx_map4x4,

92 
pos2ùx_m­2x4c
, 
pos2ùx_m­4x4c
,

94 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8i
,
pos2ùx_m­8x4i
,

95 
pos2ùx_m­8x4i
,
pos2ùx_m­4x4
,

96 
pos2ùx_m­4x4
,…os2ùx_m­4x4, 
pos2ùx_m­8x8i
,
pos2ùx_m­8x4i
,

97 
pos2ùx_m­8x4i
,
pos2ùx_m­4x4


102 cÚ¡ 
by‹
 
	gpos2ùx_Ï¡8x8
 [] = {

109 cÚ¡ 
by‹
 
	gpos2ùx_Ï¡8x4
 [] = {

114 cÚ¡ 
by‹
 
	gpos2ùx_Ï¡4x4
 [] = {

118 cÚ¡ 
by‹
 
	gpos2ùx_Ï¡2x4c
[] = {

122 cÚ¡ 
by‹
 
	gpos2ùx_Ï¡4x4c
[] = {

126 cÚ¡ 
by‹
* 
	gpos2ùx_Ï¡
 [] = {

127 
pos2ùx_Ï¡4x4
,…os2ùx_Ï¡4x4, 
pos2ùx_Ï¡8x8
, 
pos2ùx_Ï¡8x4
,

128 
pos2ùx_Ï¡8x4
, 
pos2ùx_Ï¡4x4
,…os2ctx_last4x4,…os2ctx_last4x4,

129 
pos2ùx_Ï¡2x4c
, 
pos2ùx_Ï¡4x4c
,

130 
pos2ùx_Ï¡4x4
,…os2ùx_Ï¡4x4, 
pos2ùx_Ï¡8x8
,
pos2ùx_Ï¡8x4
,

131 
pos2ùx_Ï¡8x4
, 
pos2ùx_Ï¡4x4
,

132 
pos2ùx_Ï¡4x4
,…os2ùx_Ï¡4x4, 
pos2ùx_Ï¡8x8
,
pos2ùx_Ï¡8x4
,

133 
pos2ùx_Ï¡8x4
, 
pos2ùx_Ï¡4x4


148 
	$exp_gÞomb_’code_eq_´ob
Ð
EncodšgEnvœÚm’tPŒ
 
“p_dp
,

149 
symbÞ
,

150 
k
)

154 ià(
symbÞ
 >ð()(1<<
k
))

156 
	`bŸri_’code_symbÞ_eq_´ob
(
“p_dp
, 1);

157 
symbÞ
 = symbÞ - (1<<
k
);

158 
k
++;

162 
	`bŸri_’code_symbÞ_eq_´ob
(
“p_dp
, 0);

163 
k
--)

164 
	`bŸri_’code_symbÞ_eq_´ob
(
“p_dp
, ((
symbÞ
>>
k
)&1));

168 
	}
}

178 
	$uÇry_bš_’code
(
EncodšgEnvœÚm’tPŒ
 
“p_dp
,

179 
symbÞ
,

180 
BiCÚ‹xtTy³PŒ
 
ùx
,

181 
ùx_off£t
)

183 ià(
symbÞ
==0)

185 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
 );

190 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
 );

191 
ùx
 +ð
ùx_off£t
;

192 (--
symbÞ
) > 0)

193 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
);

194 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
);

196 
	}
}

207 
	$uÇry_bš_max_’code
(
EncodšgEnvœÚm’tPŒ
 
“p_dp
,

208 
symbÞ
,

209 
BiCÚ‹xtTy³PŒ
 
ùx
,

210 
ùx_off£t
,

211 
max_symbÞ
)

213 ià(
symbÞ
==0)

215 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
 );

220 
l
 = 
symbÞ
;

221 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
 );

223 
ùx
 +ð
ùx_off£t
;

224 (--
l
)>0)

225 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
);

226 ià(
symbÞ
 < 
max_symbÞ
)

227 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
);

229 
	}
}

237 
	$uÇry_exp_gÞomb_Ëv–_’code
Ð
EncodšgEnvœÚm’tPŒ
 
“p_dp
,

238 
symbÞ
,

239 
BiCÚ‹xtTy³PŒ
 
ùx
)

241 ià(
symbÞ
==0)

243 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
 );

248 
l
=
symbÞ
;

249 
k
 = 1;

251 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
 );

252 ((--
l
)>0è&& (++
k
 <= 13))

253 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
);

254 ià(
symbÞ
 < 13)

255 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
);

257 
	`exp_gÞomb_’code_eq_´ob
(
“p_dp
,
symbÞ
 - 13, 0);

259 
	}
}

268 
	$uÇry_exp_gÞomb_mv_’code
(
EncodšgEnvœÚm’tPŒ
 
“p_dp
,

269 
symbÞ
,

270 
BiCÚ‹xtTy³PŒ
 
ùx
,

271 
max_bš
)

273 ià(
symbÞ
==0)

275 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
 );

280 
bš
 = 1;

281 
l
 = 
symbÞ
, 
k
 = 1;

282 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
++ );

284 ((--
l
)>0è&& (++
k
 <= 8))

286 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
 );

287 ià((++
bš
) == 2)

288 ++
ùx
;

289 ià(
bš
 =ð
max_bš
)

290 ++
ùx
;

292 ià(
symbÞ
 < 8)

293 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
);

295 
	`exp_gÞomb_’code_eq_´ob
(
“p_dp
, 
symbÞ
 - 8, 3);

297 
	}
}

306 
	$CheckAvažabž™yOfNeighbÜsCABAC
(
Maüoblock
 *
cu¼MB
)

308 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

309 
Pix–Pos
 
up
, 
Ëá
;

310 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

312 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 0, 
mb_size
, &
Ëá
);

313 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1, 
mb_size
, &
up
);

315 ià(
up
.
avažabË
)

316 
cu¼MB
->
mb_up
 = &
p_Vid
->
mb_d©a
[
up
.
mb_addr
];

318 
cu¼MB
->
mb_up
 = 
NULL
;

320 ià(
Ëá
.
avažabË
)

321 
cu¼MB
->
mb_Ëá
 = &
p_Vid
->
mb_d©a
[
Ëá
.
mb_addr
];

323 
cu¼MB
->
mb_Ëá
 = 
NULL
;

324 
	}
}

333 
MÙiÚInfoCÚ‹xts
* 
	$ü—‹_cÚ‹xts_MÙiÚInfo
()

335 
MÙiÚInfoCÚ‹xts
* 
’co_ùx
;

337 
’co_ùx
 = (
MÙiÚInfoCÚ‹xts
*è
	`ÿÎoc
(1, (MotionInfoContexts) );

338 ifÐ
’co_ùx
 =ð
NULL
 )

339 
	`no_mem_ex™
("create_contexts_MotionInfo:ƒnco_ctx");

341  
’co_ùx
;

342 
	}
}

352 
Textu»InfoCÚ‹xts
* 
	$ü—‹_cÚ‹xts_Textu»Info
()

354 
Textu»InfoCÚ‹xts
* 
’co_ùx
 = (Textu»InfoCÚ‹xts*è
	`ÿÎoc
(1, (TextureInfoContexts) );

355 ifÐ
’co_ùx
 =ð
NULL
 )

356 
	`no_mem_ex™
("create_contexts_TextureInfo:ƒnco_ctx");

358  
’co_ùx
;

359 
	}
}

368 
	$d–‘e_cÚ‹xts_MÙiÚInfo
(
MÙiÚInfoCÚ‹xts
 *
’co_ùx
)

370 
	`ä“_poš‹r
Ð
’co_ùx
 );

371 
	}
}

380 
	$d–‘e_cÚ‹xts_Textu»Info
(
Textu»InfoCÚ‹xts
 *
’co_ùx
)

382 
	`ä“_poš‹r
Ð
’co_ùx
 );

383 
	}
}

393 
	$wr™eF›ldModeInfo_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

395 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

396 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

397 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

398 
Maüoblock
 *
mb_d©a
 = 
p_Vid
->mb_data;

400 
a
 = 
cu¼MB
->
mbAvažA
 ? 
mb_d©a
[cu¼MB->
mbAddrA
].
mb_f›ld
 : 0;

401 
b
 = 
cu¼MB
->
mbAvažB
 ? 
mb_d©a
[cu¼MB->
mbAddrB
].
mb_f›ld
 : 0;

403 
aù_ùx
 = 
a
 + 
b
;

405 #ià
ENABLE_FIELD_CTX


406 
Textu»InfoCÚ‹xts
 *
ùx
 = 
dp
->
p_Sliû
->
‹x_ùx
;

408 
	`bŸri_’code_symbÞ
(
“p_dp
, (
£
->
v®ue1
 !ð0), &
ùx
->
mb_aff_cÚ‹xts
[
aù_ùx
]);

411 
£
->
cÚ‹xt
 = 
aù_ùx
;

413 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

414 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

415 
CABAC_TRACE
;

416 
	}
}

424 
	$wr™eMB_Psk_æagInfo_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

426 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

427 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

428 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

429 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
mÙ_ùx
;

430 
cu¼_mb_ty³
 = 
£
->
v®ue1
;

431 
a
 = (
cu¼MB
->
mb_Ëá
 !ð
NULL
 && (cu¼MB->mb_Ëá->
sk_æag
 == 0)) ? 1 : 0;

432 
b
 = (
cu¼MB
->
mb_up
 !ð
NULL
 && (cu¼MB->mb_u°->
sk_æag
 == 0)) ? 1 : 0;

433 
aù_ùx
 = 
a
 + 
b
;

435 ià(
cu¼_mb_ty³
==0)

436 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, &
ùx
->
mb_ty³_cÚ‹xts
[1][
aù_ùx
]);

438 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, &
ùx
->
mb_ty³_cÚ‹xts
[1][
aù_ùx
]);

440 
cu¼MB
->
sk_æag
 = (
cu¼_mb_ty³
==0) ? 1 : 0;

442 
£
->
cÚ‹xt
 = 
aù_ùx
;

443 
£
->
v®ue1
 = 1 - 
cu¼MB
->
sk_æag
;

445 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

446 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

447 
CABAC_TRACE
;

448 
	}
}

456 
	$wr™eMB_Bsk_æagInfo_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

458 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

459 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

460 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

461 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
mÙ_ùx
;

462 
a
 = (
cu¼MB
->
mb_Ëá
 !ð
NULL
 && (cu¼MB->mb_Ëá->
sk_æag
 == 0)) ? 1 : 0;

463 
b
 = (
cu¼MB
->
mb_up
 !ð
NULL
 && (cu¼MB->mb_u°->
sk_æag
 == 0)) ? 1 : 0;

464 
aù_ùx
 = 
a
 + 
b
;

466 
aù_ùx
 += 7;

468 ià(
£
->
v®ue1
==0 && se->
v®ue2
==0)

469 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
ùx
->
mb_ty³_cÚ‹xts
[2][
aù_ùx
]);

471 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
ùx
->
mb_ty³_cÚ‹xts
[2][
aù_ùx
]);

473 
cu¼MB
->
sk_æag
 = (
£
->
v®ue1
==0 && se->
v®ue2
==0) ? 1 : 0;

475 
£
->
cÚ‹xt
 = 
aù_ùx
;

476 
£
->
v®ue1
 = 1 - 
cu¼MB
->
sk_æag
;

478 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

479 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

480 
CABAC_TRACE
;

481 
	}
}

491 
	$wr™eMB_ŒªsfÜm_size_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

493 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

494 
Textu»InfoCÚ‹xts
 *
ùx
 = (
dp
->
p_Sliû
)->
‹x_ùx
;

496 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

497 
aù_sym
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

500 
b
 = (
cu¼MB
->
mb_up
 =ð
NULL
è? 0 : cu¼MB->mb_up->
luma_ŒªsfÜm_size_8x8_æag
;

501 
a
 = (
cu¼MB
->
mb_Ëá
 =ð
NULL
è? 0 :cu¼MB->mb_Ëá->
luma_ŒªsfÜm_size_8x8_æag
;

502 
aù_ùx
 = 
a
 + 
b
;

504 
£
->
cÚ‹xt
 = 
aù_ùx
;

505 
	`bŸri_’code_symbÞ
(
“p_dp
, (
aù_sym
 !ð0), 
ùx
->
ŒªsfÜm_size_cÚ‹xts
 + 
aù_ùx
 );

507 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

508 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

509 
CABAC_TRACE
;

510 
	}
}

520 
	$wr™eMB_P_ty³Info_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

522 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

523 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

525 
BiCÚ‹xtTy³
 *
mb_ty³_cÚ‹xts
 = 
dp
->
p_Sliû
->
mÙ_ùx
->mb_type_contexts[1];

527 
aù_ùx
 = 0;

528 
mode_sym
 = 0;

529 
aù_sym
 = 
£
->
v®ue1
;

530 
mode16x16
 = 7;

532 ià(
aù_sym
 >ð
mode16x16
)

534 
mode_sym
 = 
aù_sym
 - 
mode16x16
;

535 
aù_sym
 = 
mode16x16
;

538 
aù_sym
)

543 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[4]);

544 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[5]);

545 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[6]);

548 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[4]);

549 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[5]);

550 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[7]);

553 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[4]);

554 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[5]);

555 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[7]);

559 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[4]);

560 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[5]);

561 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[6]);

564 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[4]);

565 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[7]);

568 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[4]);

569 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[7]);

572 
	`´štf
 ("Unsupported MB-MODE in writeMB_I_typeInfo_CABAC!\n");

573 
	`ex™
 (1);

576 if(
aù_sym
 =ð
mode16x16
)

578 ifÐ
mode_sym
 == 24 )

580 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 1 );

581 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

582 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

583 
CABAC_TRACE
;

586 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 0 );

588 
aù_ùx
 = 8;

589 
aù_sym
 = 
mode_sym
/12;

590 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

591 
mode_sym
 = mode_sym % 12;

593 
aù_sym
 = 
mode_sym
 >> 2;

594 
aù_ùx
 = 9;

595 ià(
aù_sym
==0)

597 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

601 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

602 
	`bŸri_’code_symbÞ
(
“p_dp
, (
aù_sym
!=1), 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

605 
mode_sym
 = mode_sym & 0x03;

606 
aù_ùx
 = 10;

607 
aù_sym
 = 
mode_sym
 >> 1;

608 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

609 
aù_sym
 = (
mode_sym
 & 0x01);

610 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

613 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

614 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

615 
CABAC_TRACE
;

616 
	}
}

626 
	$wr™eMB_B_ty³Info_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

628 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

629 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

631 
csym
;

632 
aù_sym
 = 
£
->
v®ue1
;

634 
mode_sym
 = 0;

635 
mode16x16
 = 24;

637 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
dp
->
p_Sliû
->
mÙ_ùx
;

638 
BiCÚ‹xtTy³
 *
mb_ty³_cÚ‹xts
 = 
ùx
->mb_type_contexts[2];

640 
a
 = (
cu¼MB
->
mb_Ëá
 =ð
NULL
è? 0 : ((cu¼MB->mb_Ëá->
mb_ty³
 != 0) ? 1 : 0 );

641 
b
 = (
cu¼MB
->
mb_up
 =ð
NULL
è? 0 : ((cu¼MB->mb_up->
mb_ty³
 != 0) ? 1 : 0 );

642 
aù_ùx
 = 
a
 + 
b
;

643 
£
->
cÚ‹xt
 = 
aù_ùx
;

645 ià(
aù_sym
 >ð
mode16x16
)

647 
mode_sym
 = 
aù_sym
 - 
mode16x16
;

648 
aù_sym
 = 
mode16x16
;

651 ià(
aù_sym
==0)

653 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[
aù_ùx
]);

655 ià(
aù_sym
<=2)

657 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[
aù_ùx
]);

658 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[4]);

659 
csym
 = (
aù_sym
-1 != 0);

660 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

662 ià(
aù_sym
<=10)

664 
‹mp_sym
 = 
aù_sym
 - 3;

665 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[
aù_ùx
]);

666 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[4]);

667 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
mb_ty³_cÚ‹xts
[5]);

668 
csym
 = ((
‹mp_sym
 >> 2)&0x01) != 0;

669 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

670 
csym
 = ((
‹mp_sym
 >> 1)&0x01) != 0;

671 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

672 
csym
 = (
‹mp_sym
 & 0x01) != 0;

673 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

675 ià(
aù_sym
==11 ||‡ct_sym==22)

677 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[
aù_ùx
]);

678 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[4]);

679 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[5]);

680 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[6]);

681 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[6]);

682 
csym
 = (
aù_sym
 != 11);

683 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

687 
‹mp_sym
 = (
aù_sym
 > 22) ?‡ct_sym - 13 :‡ct_sym - 12;

688 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[
aù_ùx
]);

689 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[4]);

690 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
mb_ty³_cÚ‹xts
[5]);

691 
csym
 = ((
‹mp_sym
 >> 3)&0x01) != 0;

692 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

693 
csym
 = ((
‹mp_sym
 >> 2)&0x01) != 0;

694 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

695 
csym
 = ((
‹mp_sym
 >> 1)&0x01) != 0;

696 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

697 
csym
 = (
‹mp_sym
 & 0x01) != 0;

698 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
mb_ty³_cÚ‹xts
[6]);

702 if(
aù_sym
 =ð
mode16x16
)

704 
mb_ty³_cÚ‹xts
 = 
ùx
->mb_type_contexts[1];

705 ifÐ
mode_sym
 == 24 )

707 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 1 );

708 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

709 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

710 
CABAC_TRACE
;

713 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 0 );

715 
aù_ùx
 = 8;

716 
aù_sym
 = 
mode_sym
/12;

717 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

718 
mode_sym
 = mode_sym % 12;

720 
aù_sym
 = 
mode_sym
 >> 2;

721 
aù_ùx
 = 9;

722 ià(
aù_sym
==0)

724 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

728 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

729 
	`bŸri_’code_symbÞ
(
“p_dp
, (
aù_sym
!=1), 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

732 
mode_sym
 = mode_sym & 0x03;

733 
aù_ùx
 = 10;

734 
aù_sym
 = 
mode_sym
 >> 1;

735 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

736 
aù_sym
 = (
mode_sym
 & 0x01);

737 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
mb_ty³_cÚ‹xts
 + 
aù_ùx
 );

740 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

741 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

742 
CABAC_TRACE
;

743 
	}
}

752 
	$wr™eMB_I_ty³Info_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

754 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

755 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

756 
a
, 
b
;

757 
aù_ùx
 = 0;

758 
aù_sym
;

759 
Sliû
 *
cu¼Sliû
 = 
dp
->
p_Sliû
;

760 
mode_sym
 = 0;

762 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
mÙ_ùx
;

764 ià(
cu¼MB
->
mb_up
 =ð
NULL
)

765 
b
 = 0;

767 
b
 = ((
cu¼MB
->
mb_up
->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_up->mb_ty³ !ð
I8MB
) ? 1 : 0 );

769 ià(
cu¼MB
->
mb_Ëá
 =ð
NULL
)

770 
a
 = 0;

772 
a
 = ((
cu¼MB
->
mb_Ëá
->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_Ëá->mb_ty³ !ð
I8MB
) ? 1 : 0 );

774 
aù_ùx
 = 
a
 + 
b
;

775 
aù_sym
 = 
£
->
v®ue1
;

776 
£
->
cÚ‹xt
 = 
aù_ùx
;

778 ià(
aù_sym
==0)

780 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

782 ifÐ
aù_sym
 == 25 )

784 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

785 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 1);

789 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

791 
	`bŸri_’code_symbÞ_fš®
(
“p_dp
, 0);

793 
mode_sym
 = 
aù_sym
-1;

794 
aù_ùx
 = 4;

795 
aù_sym
 = 
mode_sym
/12;

796 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

797 
mode_sym
 = mode_sym % 12;

798 
aù_sym
 = 
mode_sym
 / 4;

799 
aù_ùx
 = 5;

800 ià(
aù_sym
==0)

802 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

806 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

807 
aù_ùx
=6;

808 
	`bŸri_’code_symbÞ
(
“p_dp
, (
aù_sym
!=1), 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

810 
mode_sym
 = mode_sym & 0x03;

811 
aù_sym
 = 
mode_sym
 >> 1;

812 
aù_ùx
 = 7;

813 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

814 
aù_ùx
 = 8;

815 
aù_sym
 = 
mode_sym
 & 0x01;

816 
	`bŸri_’code_symbÞ
(
“p_dp
, 
aù_sym
, 
ùx
->
mb_ty³_cÚ‹xts
[0] + 
aù_ùx
 );

819 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

820 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

821 
CABAC_TRACE
;

822 
	}
}

831 
	$wr™eB8_B_ty³Info_CABAC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

833 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

834 
BiCÚ‹xtTy³
 *
b8_ty³_cÚ‹xts
 = 
dp
->
p_Sliû
->
mÙ_ùx
->b8_type_contexts[1];

835 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

836 
aù_sym
 = 
£
->
v®ue1
;

837 sigÃd 
csym
;

839 ià(
aù_sym
==0)

841 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[0]);

842 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

843 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

844 
CABAC_TRACE
;

849 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[0]);

850 
aù_sym
--;

853 ià(
aù_sym
 < 2)

855 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[1]);

856 
	`bŸri_’code_symbÞ
 (
“p_dp
, (
aù_sym
!=0), &
b8_ty³_cÚ‹xts
[3]);

858 ià(
aù_sym
 < 6)

860 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[1]);

861 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[2]);

862 
csym
 = (è(((
aù_sym
 - 2) >> 1) & 0x01) != 0;

863 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
b8_ty³_cÚ‹xts
[3]);

864 
csym
 = (è((
aù_sym
 - 2) & 0x01) != 0;

865 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
b8_ty³_cÚ‹xts
[3]);

869 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[1]);

870 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[2]);

871 
csym
 = (è(((
aù_sym
 - 6)>> 2) & 0x01);

872 ià(
csym
)

874 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[3]);

875 
csym
 = (è((
aù_sym
 - 6) & 0x01) != 0;

876 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
b8_ty³_cÚ‹xts
[3]);

880 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[3]);

881 
csym
 = (è(((
aù_sym
 - 6) >> 1) & 0x01) != 0;

882 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
b8_ty³_cÚ‹xts
[3]);

883 
csym
 = (è((
aù_sym
 - 6) & 0x01) != 0;

884 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
csym
, &
b8_ty³_cÚ‹xts
[3]);

888 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

889 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

890 
CABAC_TRACE
;

891 
	}
}

900 
	$wr™eB8_ty³Info_CABAC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

902 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

903 
	`BiCÚ‹xtTy³
 (*
b8_ty³_cÚ‹xts
èð
dp
->
p_Sliû
->
mÙ_ùx
->b8_type_contexts[0];

904 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

906 
£
->
v®ue1
)

909 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[1]);

912 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[1]);

913 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[3]);

916 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[1]);

917 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[3]);

918 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[4]);

921 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[1]);

922 
	`bŸri_’code_symbÞ
 (
“p_dp
, 1, &
b8_ty³_cÚ‹xts
[3]);

923 
	`bŸri_’code_symbÞ
 (
“p_dp
, 0, &
b8_ty³_cÚ‹xts
[4]);

927 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

928 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

929 
CABAC_TRACE
;

930 
	}
}

939 
	$wr™eIÁ¿P»dMode_CABAC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

941 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

942 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

943 
BiCÚ‹xtTy³
 *
r_cÚ‹xts
 = (
dp
->
p_Sliû
)->
‹x_ùx
->ipr_contexts;

946 ià(
£
->
v®ue1
 == -1)

947 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
r_cÚ‹xts
);

950 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
r_cÚ‹xts
);

953 
	`bŸri_’code_symbÞ
(
“p_dp
, ( 
£
->
v®ue1
 & 0x1 ), 
r_cÚ‹xts
+1);

954 
	`bŸri_’code_symbÞ
(
“p_dp
, ((
£
->
v®ue1
 & 0x2)>>1), 
r_cÚ‹xts
+1);

955 
	`bŸri_’code_symbÞ
(
“p_dp
, ((
£
->
v®ue1
 & 0x4)>>2), 
r_cÚ‹xts
+1);

958 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

959 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

960 
CABAC_TRACE
;

961 
	}
}

970 
	$wr™eRefPic_P_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

972 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

973 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

974 
Sliû
 *
cu¼Sliû
 = 
dp
->
p_Sliû
;

975 
VideoP¬am‘”s
 *
p_Vid
 = 
dp
->p_Vid;

976 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

977 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
mÙ_ùx
;

979 
addùx
 = 0;

981 
a
 = 0, 
b
 = 0;

982 
aù_ùx
;

983 
aù_sym
;

984 
li¡
 = 
£
->
v®ue2
;

986 
Pix–Pos
 
block_a
, 
block_b
;

987 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

989 
	`g‘4x4Neighbour
(
cu¼MB
, cu¼MB->
subblock_x
 - 1, cu¼MB->
subblock_y
 , 
mb_size
, &
block_a
);

990 
	`g‘4x4Neighbour
(
cu¼MB
, cu¼MB->
subblock_x
, cu¼MB->
subblock_y
 - 1, 
mb_size
, &
block_b
);

992 ià(
block_b
.
avažabË
)

994 ià(
p_Vid
->
mb_aff_äame_æag
 && (
cu¼MB
->
mb_f›ld
 =ð
FALSE
è&& (p_Vid->
mb_d©a
[
block_b
.
mb_addr
].mb_f›ld =ð
TRUE
))

995 
b
 = (
mÙiÚ
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] > 1 ? 2 : 0);

997 
b
 = (
mÙiÚ
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] > 0 ? 2 : 0);

1000 ià(
block_a
.
avažabË
)

1002 ià(
p_Vid
->
mb_aff_äame_æag
 && (
cu¼MB
->
mb_f›ld
 =ð
FALSE
è&& (p_Vid->
mb_d©a
[
block_a
.
mb_addr
].mb_f›ld =ð
TRUE
))

1003 
a
 = (
mÙiÚ
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] > 1 ? 1 : 0);

1005 
a
 = (
mÙiÚ
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] > 0 ? 1 : 0);

1008 
aù_ùx
 = 
a
 + 
b
;

1009 
£
->
cÚ‹xt
 = 
aù_ùx
;

1010 
aù_sym
 = 
£
->
v®ue1
;

1012 ià(
aù_sym
==0)

1014 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
 );

1018 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
);

1019 
aù_sym
--;

1020 
aù_ùx
=4;

1021 
	`uÇry_bš_’code
(
“p_dp
, 
aù_sym
, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
, 1);

1024 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1025 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1026 
CABAC_TRACE
;

1027 
	}
}

1036 
	$wr™eRefPic_B_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1038 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1039 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1040 
Sliû
 *
cu¼Sliû
 = 
dp
->
p_Sliû
;

1041 
VideoP¬am‘”s
 *
p_Vid
 = 
dp
->p_Vid;

1042 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1043 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
mÙ_ùx
;

1044 
addùx
 = 0;

1046 
a
 = 0, 
b
 = 0;

1047 
aù_ùx
;

1048 
aù_sym
;

1049 
li¡
 = 
£
->
v®ue2
;

1051 
b8a
, 
b8b
;

1053 
Pix–Pos
 
block_a
, 
block_b
;

1054 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

1056 
	`g‘4x4Neighbour
(
cu¼MB
, cu¼MB->
subblock_x
 - 1, cu¼MB->
subblock_y
 , 
mb_size
, &
block_a
);

1057 
	`g‘4x4Neighbour
(
cu¼MB
, cu¼MB->
subblock_x
, cu¼MB->
subblock_y
 - 1, 
mb_size
, &
block_b
);

1059 ià(
block_b
.
avažabË
)

1061 
b8b
=((
block_b
.
x
 >> 1è& 0x01)+2*((block_b.
y
 >> 1) & 0x01);

1063 ià(((
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
 =ð0è&& !p_Vid->
giRDO±_B8OÆyFÏg
è|| (p_Vid->mb_d©a[block_b.mb_addr].
b8x8
[
b8b
].
mode
==0))

1064 
b
=0;

1067 ià(
p_Vid
->
mb_aff_äame_æag
 && (
cu¼MB
->
mb_f›ld
 =ð
FALSE
è&& (p_Vid->
mb_d©a
[
block_b
.
mb_addr
].mb_f›ld =ð
TRUE
))

1068 
b
 = (
mÙiÚ
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] > 1 ? 1 : 0);

1070 
b
 = (
mÙiÚ
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] > 0 ? 1 : 0);

1074 ià(
block_a
.
avažabË
)

1076 
b8a
=((
block_a
.
x
 >> 1è& 0x01)+2*((block_a.
y
 >> 1) & 0x01);

1077 ià(((
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
 =ð0è&& !p_Vid->
giRDO±_B8OÆyFÏg
è|| (p_Vid->mb_d©a[block_a.mb_addr].
b8x8
[
b8a
].
mode
 ==0))

1078 
a
=0;

1081 ià(
p_Vid
->
mb_aff_äame_æag
 && (
cu¼MB
->
mb_f›ld
 =ð
FALSE
è&& (p_Vid->
mb_d©a
[
block_a
.
mb_addr
].mb_f›ld =ð
TRUE
))

1082 
a
 = (
mÙiÚ
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] > 1 ? 1 : 0);

1084 
a
 = (
mÙiÚ
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] > 0 ? 1 : 0);

1088 
aù_ùx
 = 
a
 + 2*
b
;

1089 
£
->
cÚ‹xt
 = 
aù_ùx
;

1090 
aù_sym
 = 
£
->
v®ue1
;

1092 ià(
aù_sym
==0)

1094 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
 );

1098 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
);

1099 
aù_sym
--;

1100 
aù_ùx
=4;

1101 
	`uÇry_bš_’code
(
“p_dp
, 
aù_sym
, 
ùx
->
»f_no_cÚ‹xts
[
addùx
] + 
aù_ùx
, 1);

1104 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1105 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1106 
CABAC_TRACE
;

1107 
	}
}

1116 
	$wr™eDquªt_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1118 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1119 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1121 
Textu»InfoCÚ‹xts
 *
ùx
 = 
dp
->
p_Sliû
->
‹x_ùx
;

1123 
dquªt
 = 
£
->
v®ue1
;

1124 
sign
 = (
dquªt
 <= 0) ? 0 : -1;

1125 
aù_sym
 = (
	`Ÿbs
(
dquªt
è<< 1è+ 
sign
;

1126 
aù_ùx
 = ((
cu¼MB
->
´ev_dqp
 != 0) ? 1 : 0);

1128 ià(
aù_sym
 == 0)

1130 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
d–_qp_cÚ‹xts
 + 
aù_ùx
 );

1134 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
d–_qp_cÚ‹xts
 + 
aù_ùx
);

1135 
aù_ùx
=2;

1136 
aù_sym
--;

1137 
	`uÇry_bš_’code
(
“p_dp
, 
aù_sym
,
ùx
->
d–_qp_cÚ‹xts
+
aù_ùx
,1);

1140 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1141 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1142 
CABAC_TRACE
;

1143 
	}
}

1152 
	$wr™eMVD_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1154 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1155 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1157 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1158 
MÙiÚInfoCÚ‹xts
 *
ùx
 = 
dp
->
p_Sliû
->
mÙ_ùx
;

1160 
i
 = 
cu¼MB
->
subblock_x
;

1161 
j
 = 
cu¼MB
->
subblock_y
;

1162 
a
, 
b
;

1163 
aù_ùx
;

1164 
aù_sym
;

1165 
mv_´ed_»s
;

1166 
mv_loÿl_”r
;

1167 
mv_sign
;

1168 
li¡_idx
 = 
£
->
v®ue2
 & 0x01;

1169 
k
 = (
£
->
v®ue2
>>1);

1171 
Pix–Pos
 
block_a
, 
block_b
;

1173 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

1175 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
mb_size
, &
block_a
);

1176 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 , 
j
 - 1, 
mb_size
, &
block_b
);

1178 ià(
block_b
.
avažabË
)

1180 
b
 = 
	`Ÿbs
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mvd
[
li¡_idx
][block_b.
y
][block_b.
x
][
k
]);

1181 ià(
p_Vid
->
mb_aff_äame_æag
 && (
k
==1))

1183 ià((
cu¼MB
->
mb_f›ld
==0è&& (
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].mb_field==1))

1184 
b
 *= 2;

1185 ià((
cu¼MB
->
mb_f›ld
==1è&& (
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].mb_field==0))

1186 
b
 /= 2;

1190 
b
=0;

1192 ià(
block_a
.
avažabË
)

1194 
a
 = 
	`Ÿbs
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mvd
[
li¡_idx
][block_a.
y
][block_a.
x
][
k
]);

1195 ià(
p_Vid
->
mb_aff_äame_æag
 && (
k
==1))

1197 ià((
cu¼MB
->
mb_f›ld
==0è&& (
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].mb_field==1))

1198 
a
 *= 2;

1199 ià((
cu¼MB
->
mb_f›ld
==1è&& (
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].mb_field==0))

1200 
a
 /= 2;

1204 
a
 = 0;

1206 ià((
mv_loÿl_”r
 = 
a
 + 
b
)<3)

1207 
aù_ùx
 = 5 * 
k
;

1210 ià(
mv_loÿl_”r
>32)

1211 
aù_ùx
 = 5 * 
k
 + 3;

1213 
aù_ùx
 = 5 * 
k
 + 2;

1216 
mv_´ed_»s
 = 
£
->
v®ue1
;

1217 
£
->
cÚ‹xt
 = 
aù_ùx
;

1219 
aù_sym
 = 
	`Ÿbs
(
mv_´ed_»s
);

1221 ià(
aù_sym
 == 0)

1222 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, &
ùx
->
mv_»s_cÚ‹xts
[0][
aù_ùx
] );

1225 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, &
ùx
->
mv_»s_cÚ‹xts
[0][
aù_ùx
] );

1226 
aù_sym
--;

1227 
aù_ùx
=5*
k
;

1228 
	`uÇry_exp_gÞomb_mv_’code
(
“p_dp
,
aù_sym
,
ùx
->
mv_»s_cÚ‹xts
[1]+
aù_ùx
,3);

1229 
mv_sign
 = (
mv_´ed_»s
<0) ? 1: 0;

1230 
	`bŸri_’code_symbÞ_eq_´ob
(
“p_dp
, 
mv_sign
);

1233 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1234 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1235 
CABAC_TRACE
;

1236 
	}
}

1246 
	$wr™eCIP»dMode_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1248 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1249 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1250 
Textu»InfoCÚ‹xts
 *
ùx
 = 
dp
->
p_Sliû
->
‹x_ùx
;

1252 
aù_sym
 = 
£
->
v®ue1
;

1254 
Maüoblock
 *
MbUp
 = 
cu¼MB
->
mb_up
;

1255 
Maüoblock
 *
MbLeá
 = 
cu¼MB
->
mb_Ëá
;

1257 
b
 = (
MbUp
 !ð
NULL
è? (((MbUp->
c_»d_mode
 !ð0è&& (MbUp->
mb_ty³
 !ð
IPCM
)) ? 1 : 0) : 0;

1258 
a
 = (
MbLeá
 !ð
NULL
è? (((MbLeá->
c_»d_mode
 !ð0è&& (MbLeá->
mb_ty³
 !ð
IPCM
)) ? 1 : 0) : 0;

1260 
aù_ùx
 = 
a
 + 
b
;

1262 ià(
aù_sym
==0)

1263 
	`bŸri_’code_symbÞ
(
“p_dp
, 0, 
ùx
->
cr_cÚ‹xts
 + 
aù_ùx
 );

1266 
	`bŸri_’code_symbÞ
(
“p_dp
, 1, 
ùx
->
cr_cÚ‹xts
 + 
aù_ùx
 );

1267 
	`uÇry_bš_max_’code
(
“p_dp
,(è(
aù_sym
-1),
ùx
->
cr_cÚ‹xts
 + 3,0,2);

1270 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1271 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1272 
CABAC_TRACE
;

1273 
	}
}

1283 
	$wr™eCBP_BIT_CABAC
 (
Maüoblock
* 
cu¼MB
, 
b8
, 
b™
, 
cbp
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
Textu»InfoCÚ‹xts
 *
ùx
)

1285 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1286 
Pix–Pos
 
block_a
;

1287 
a
 = 0, 
b
 = 0;

1289 
mb_x
=(
b8
 & 0x01)<<1;

1290 
mb_y
=(
b8
 >> 1)<<1;

1292 ià(
mb_y
 == 0)

1294 ià(!((
cu¼MB
->
mb_up
 =ð
NULL
è|| ((cu¼MB->mb_up)->
mb_ty³
==
IPCM
)))

1296 
b
 = (Ð((
cu¼MB
->
mb_up
)->
cbp
 & (1<<(2+(
mb_x
>>1)))) == 0) ? 1 : 0);

1301 
b
 = ( ((
cbp
 & (1<<(
mb_x
 >> 1))) == 0) ? 1: 0);

1303 ià(
mb_x
 == 0)

1305 
	`g‘4x4Neighbour
(
cu¼MB
, (
mb_x
 << 2è- 1, (
mb_y
 << 2), 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_a
);

1307 ià(
block_a
.
avažabË
 && (!(
p_Vid
->
mb_d©a
[block_a.
mb_addr
].
mb_ty³
==
IPCM
)))

1309 
a
 = (Ð(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp
 & (1<<(2*(block_a.
y
>>1)+1))) == 0) ? 1 : 0);

1313 
a
 = ( ((
cbp
 & (1<<
mb_y
)) == 0) ? 1: 0);

1316 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
b™
, 
ùx
->
cbp_cÚ‹xts
[0] + 
a
+2*
b
);

1317 
	}
}

1326 
	$wr™eCBP_CABAC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1328 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1329 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1330 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1331 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1332 
Textu»InfoCÚ‹xts
 *
ùx
 = 
cu¼Sliû
->
‹x_ùx
;

1334 
a0
 = 0, 
a1
 = 0, 
b0
 = 0, 
b1
 = 0;

1335 
cu¼_cbp_ùx
;

1336 
cbp
 = 
£
->
v®ue1
;

1337 
cbp_b™
;

1338 
b8
;

1340 
b8
=0; b8<4; ++b8)

1342 
	`wr™eCBP_BIT_CABAC
 (
cu¼MB
, 
b8
, 
cbp
&(1<<b8), cbp, 
“p_dp
, 
ùx
);

1345 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (p_Vid->yuv_fÜm© !ð
YUV444
) )

1348 ià(
cu¼MB
->
mb_up
 !ð
NULL
)

1350 if((
cu¼MB
->
mb_up
)->
mb_ty³
 =ð
IPCM
 || ((cu¼MB->mb_up)->
cbp
 > 15))

1351 
b0
 = 2;

1354 ià(
cu¼MB
->
mb_Ëá
 !ð
NULL
)

1356 if((
cu¼MB
->
mb_Ëá
)->
mb_ty³
==
IPCM
 || ((cu¼MB->mb_Ëá)->
cbp
 > 15))

1357 
a0
 = 1;

1360 
cu¼_cbp_ùx
 = 
a0
 + 
b0
;

1361 
cbp_b™
 = (
cbp
 > 15 ) ? 1 : 0;

1362 
	`bŸri_’code_symbÞ
(
“p_dp
, 
cbp_b™
, 
ùx
->
cbp_cÚ‹xts
[1] + 
cu¼_cbp_ùx
 );

1364 ià(
cbp
 > 15)

1366 ià(
cu¼MB
->
mb_up
 !ð
NULL
)

1368 if((
cu¼MB
->
mb_up
)->
mb_ty³
 =ð
IPCM
 ||

1369 (((
cu¼MB
->
mb_up
)->
cbp
 > 15) && ( ((currMB->mb_up)->cbp >> 4) == 2)))

1370 
b1
 = 2;

1373 ià(
cu¼MB
->
mb_Ëá
 !ð
NULL
)

1375 if((
cu¼MB
->
mb_Ëá
)->
mb_ty³
==
IPCM
 ||

1376 (((
cu¼MB
->
mb_Ëá
)->
cbp
 > 15) && ( ((currMB->mb_left)->cbp >> 4) == 2)))

1377 
a1
 = 1;

1380 
cu¼_cbp_ùx
 = 
a1
 + 
b1
;

1381 
cbp_b™
 = ((
cbp
>>4) == 2) ? 1 : 0;

1382 
	`bŸri_’code_symbÞ
(
“p_dp
, 
cbp_b™
, 
ùx
->
cbp_cÚ‹xts
[2] + 
cu¼_cbp_ùx
 );

1386 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1387 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1388 
CABAC_TRACE
;

1389 
	}
}

1397 
	$wr™e_ªd_¡Üe_CBP_block_b™_444
 (
Maüoblock
* 
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cbp_b™
, 
Textu»InfoCÚ‹xts
* 
‹x_ùx
)

1399 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1400 
Maüoblock
 *
mb_d©a
 = 
p_Vid
->mb_data;

1402 
y_ac
 = (
ty³
==
LUMA_16AC
 ||y³==
LUMA_8x8
 ||y³==
LUMA_8x4
 ||y³==
LUMA_4x8
 ||y³==
LUMA_4x4


1403 || 
ty³
==
CB_16AC
 ||y³==
CB_8x8
 ||y³==
CB_8x4
 ||y³==
CB_4x8
 ||y³==
CB_4x4


1404 || 
ty³
==
CR_16AC
 ||y³==
CR_8x8
 ||y³==
CR_8x4
 ||y³==
CR_4x8
 ||y³==
CR_4x4
);

1405 
y_dc
 = (
ty³
==
LUMA_16DC
 ||y³==
CB_16DC
 ||y³==
CR_16DC
);

1406 
u_ac
 = (
ty³
==
CHROMA_AC
 && !
p_Vid
->
is_v_block
);

1407 
v_ac
 = (
ty³
==
CHROMA_AC
 && 
p_Vid
->
is_v_block
);

1408 
chroma_dc
 = (
ty³
==
CHROMA_DC
 ||y³==
CHROMA_DC_2x4
 ||y³==
CHROMA_DC_4x4
);

1409 
u_dc
 = (
chroma_dc
 && !
p_Vid
->
is_v_block
);

1410 
v_dc
 = (
chroma_dc
 && 
p_Vid
->
is_v_block
);

1411 
j
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_y
 : 0);

1412 
i
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_x
 : 0);

1413 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 : 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 : 23);

1414 
deçuÉ_b™
 = (
cu¼MB
->
is_šŒa_block
 ? 1 : 0);

1415 
uµ”_b™
 = 
deçuÉ_b™
;

1416 
Ëá_b™
 = 
deçuÉ_b™
;

1417 
ùx
;

1419 
b™_pos_a
 = 0;

1420 
b™_pos_b
 = 0;

1422 
Pix–Pos
 
block_a
, 
block_b
;

1424 ià(
y_ac
 || 
y_dc
)

1426 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_a
);

1427 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 -1, 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_b
);

1428 ià(
y_ac
)

1430 ià(
block_a
.
avažabË
)

1431 
b™_pos_a
 = (
block_a
.
y
 << 2è+ block_a.
x
;

1432 ià(
block_b
.
avažabË
)

1433 
b™_pos_b
 = (
block_b
.
y
 << 2è+ block_b.
x
;

1438 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_a
);

1439 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 - 1, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_b
);

1440 ià(
u_ac
||
v_ac
)

1442 ià(
block_a
.
avažabË
)

1443 
b™_pos_a
 = (
block_a
.
y
 << 2è+ block_a.
x
;

1444 ià(
block_b
.
avažabË
)

1445 
b™_pos_b
 = (
block_b
.
y
 << 2è+ block_b.
x
;

1449 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 + 
j
 + (
i
 >> 2è: 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 + j + (i >> 2): 35 + j + (i >> 2));

1451 ià(
cbp_b™
)

1453 ià(
ty³
==
LUMA_8x8
)

1455 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x33 << 
b™
);

1457 ià(
p_Vid
->
’c_piùu»
->
chroma_fÜm©_idc
 =ð
YUV444
)

1459 
cu¼MB
->
cbp_b™s_8x8
[0] |ð((
št64
è0x33 << 
b™
);

1462 ià(
ty³
==
CB_8x8
)

1464 
cu¼MB
->
cbp_b™s_8x8
[1] |ð((
št64
è0x33 << 
b™
);

1465 
cu¼MB
->
cbp_b™s
[1] |ð((
št64
è0x33 << 
b™
);

1467 ià(
ty³
==
CR_8x8
)

1469 
cu¼MB
->
cbp_b™s_8x8
[2] |ð((
št64
è0x33 << 
b™
);

1470 
cu¼MB
->
cbp_b™s
[2] |ð((
št64
è0x33 << 
b™
);

1472 ià(
ty³
==
LUMA_8x4
)

1474 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x03 << 
b™
);

1476 ià(
ty³
==
LUMA_4x8
)

1478 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x11 << 
b™
);

1480 ià(
ty³
==
CB_8x4
)

1482 
cu¼MB
->
cbp_b™s
[1] |ð((
št64
è0x03 << 
b™
);

1484 ià(
ty³
==
CR_8x4
)

1486 
cu¼MB
->
cbp_b™s
[2] |ð((
št64
è0x03 << 
b™
);

1488 ià(
ty³
==
CB_4x8
)

1490 
cu¼MB
->
cbp_b™s
[1] |ð((
št64
è0x11 << 
b™
);

1492 ià(
ty³
==
CR_4x8
)

1494 
cu¼MB
->
cbp_b™s
[2] |ð((
št64
è0x11 << 
b™
);

1496 ià((
ty³
==
CB_4x4
)||Ñy³==
CB_16AC
)||Ñy³==
CB_16DC
))

1498 
cu¼MB
->
cbp_b™s
[1] |ð((
št64
è0x01 << 
b™
);

1500 ià((
ty³
 =ð
CR_4x4
)||Ñy³ =ð
CR_16AC
)||Ñy³ =ð
CR_16DC
))

1502 
cu¼MB
->
cbp_b™s
[2] |ð((
št64
è0x01 << 
b™
);

1506 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x01 << 
b™
);

1510 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 : 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 : 35);

1512 ià(
p_Vid
->
’c_piùu»
->
chroma_fÜm©_idc
!=
YUV444
)

1514 ià(
ty³
!=
LUMA_8x8
)

1516 ià(
block_b
.
avažabË
)

1518 if(
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
==
IPCM
)

1519 
uµ”_b™
 = 1;

1521 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0],
b™
+
b™_pos_b
);

1525 ià(
block_a
.
avažabË
)

1527 if(
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
 =ð
IPCM
)

1528 
Ëá_b™
 = 1;

1530 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_a
);

1533 
ùx
 = (
uµ”_b™
 << 1è+ 
Ëá_b™
;

1536 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
cbp_b™
, 
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]] + 
ùx
);

1539 ifÐ(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1541 ià(
ty³
!=
LUMA_8x8
)

1543 ià(
block_b
.
avažabË
)

1545 if(
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
==
IPCM
)

1546 
uµ”_b™
 = 1;

1548 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0],
b™
+
b™_pos_b
);

1552 ià(
block_a
.
avažabË
)

1554 if(
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
 =ð
IPCM
)

1555 
Ëá_b™
 = 1;

1557 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_a
);

1560 
ùx
 = (
uµ”_b™
 << 1è+ 
Ëá_b™
;

1563 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
cbp_b™
, 
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]] + 
ùx
);

1568 ià(
block_b
.
avažabË
)

1570 if(
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
 =ð
IPCM
)

1572 
uµ”_b™
=1;

1574 if((
ty³
==
LUMA_8x8
 ||y³==
CB_8x8
 ||y³==
CR_8x8
) &&

1575 !
mb_d©a
[
block_b
.
mb_addr
].
luma_ŒªsfÜm_size_8x8_æag
)

1577 
uµ”_b™
=0;

1581 if(
ty³
==
LUMA_8x8
)

1582 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[0], 
b™
 + 
b™_pos_b
);

1583 ià(
ty³
==
CB_8x8
)

1584 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[1], 
b™
 + 
b™_pos_b
);

1585 ià(
ty³
==
CR_8x8
)

1586 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[2], 
b™
 + 
b™_pos_b
);

1587 ià((
ty³
==
CB_4x4
)||Ñy³==
CB_4x8
)||Ñy³==
CB_8x4
)||Ñy³==
CB_16AC
)||Ñy³==
CB_16DC
))

1588 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[1], 
b™
 + 
b™_pos_b
);

1589 ià((
ty³
==
CR_4x4
)||Ñy³==
CR_4x8
)||Ñy³==
CR_8x4
)||Ñy³==
CR_16AC
)||Ñy³==
CR_16DC
))

1590 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[2], 
b™
 + 
b™_pos_b
);

1592 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_b
);

1596 ià(
block_a
.
avažabË
)

1598 if(
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
==
IPCM
)

1600 
Ëá_b™
 = 1;

1602 if((
ty³
==
LUMA_8x8
 ||y³==
CB_8x8
 ||y³==
CR_8x8
) &&

1603 !
mb_d©a
[
block_a
.
mb_addr
].
luma_ŒªsfÜm_size_8x8_æag
)

1605 
Ëá_b™
 = 0;

1609 if(
ty³
==
LUMA_8x8
)

1610 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[0],
b™
 + 
b™_pos_a
);

1611 ià(
ty³
==
CB_8x8
)

1612 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[1],
b™
 + 
b™_pos_a
);

1613 ià(
ty³
==
CR_8x8
)

1614 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[2],
b™
 + 
b™_pos_a
);

1615 ià((
ty³
==
CB_4x4
)||Ñy³==
CB_4x8
)||Ñy³==
CB_8x4
)||Ñy³==
CB_16AC
)||Ñy³==
CB_16DC
))

1616 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[1],
b™
 + 
b™_pos_a
);

1617 ià((
ty³
==
CR_4x4
)||Ñy³==
CR_4x8
)||Ñy³==
CR_8x4
)||Ñy³==
CR_16AC
)||Ñy³==
CR_16DC
))

1618 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[2],
b™
 + 
b™_pos_a
);

1620 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0],
b™
 + 
b™_pos_a
);

1624 
ùx
 = 2*
uµ”_b™
+
Ëá_b™
;

1627 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
cbp_b™
, 
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]]+
ùx
);

1629 
	}
}

1638 
	$wr™e_ªd_¡Üe_CBP_block_b™
 (
Maüoblock
* 
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cbp_b™
, 
Textu»InfoCÚ‹xts
* 
‹x_ùx
)

1640 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1641 
Maüoblock
 *
mb_d©a
 = 
p_Vid
->mb_data;

1642 
y_ac
 = (
ty³
==
LUMA_16AC
 ||y³==
LUMA_8x8
 ||y³==
LUMA_8x4
 ||y³==
LUMA_4x8
 ||y³==
LUMA_4x4
);

1643 
y_dc
 = (
ty³
==
LUMA_16DC
);

1644 
u_ac
 = (
ty³
==
CHROMA_AC
 && !
p_Vid
->
is_v_block
);

1645 
v_ac
 = (
ty³
==
CHROMA_AC
 && 
p_Vid
->
is_v_block
);

1646 
chroma_dc
 = (
ty³
==
CHROMA_DC
 ||y³==
CHROMA_DC_2x4
 ||y³==
CHROMA_DC_4x4
);

1647 
u_dc
 = (
chroma_dc
 && !
p_Vid
->
is_v_block
);

1648 
v_dc
 = (
chroma_dc
 && 
p_Vid
->
is_v_block
);

1649 
j
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_y
 : 0);

1650 
i
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_x
 : 0);

1651 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 : 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 : 23);

1652 
deçuÉ_b™
 = (
cu¼MB
->
is_šŒa_block
 ? 1 : 0);

1653 
uµ”_b™
 = 
deçuÉ_b™
;

1654 
Ëá_b™
 = 
deçuÉ_b™
;

1655 
ùx
;

1657 
b™_pos_a
 = 0;

1658 
b™_pos_b
 = 0;

1660 
Pix–Pos
 
block_a
, 
block_b
;

1662 ià(
y_ac
 || 
y_dc
)

1664 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_a
);

1665 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 -1, 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_b
);

1666 ià(
y_ac
)

1668 ià(
block_a
.
avažabË
)

1669 
b™_pos_a
 = 4*
block_a
.
y
 + block_a.
x
;

1670 ià(
block_b
.
avažabË
)

1671 
b™_pos_b
 = 4*
block_b
.
y
 + block_b.
x
;

1676 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_a
);

1677 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 - 1, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_b
);

1678 ià(
u_ac
||
v_ac
)

1680 ià(
block_a
.
avažabË
)

1681 
b™_pos_a
 = (
block_a
.
y
 << 2è+ block_a.
x
;

1682 ià(
block_b
.
avažabË
)

1683 
b™_pos_b
 = (
block_b
.
y
 << 2è+ block_b.
x
;

1687 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 + 
j
 + (
i
 >> 2): 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 + j + (i >> 2): 35 + j + (i >> 2));

1689 ià(
cbp_b™
)

1691 ià(
ty³
==
LUMA_8x8
)

1693 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x33 << 
b™
);

1695 ià(
ty³
==
LUMA_8x4
)

1697 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x03 << 
b™
);

1699 ià(
ty³
==
LUMA_4x8
)

1701 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x11 << 
b™
);

1705 
cu¼MB
->
cbp_b™s
[0] |ð((
št64
è0x01 << 
b™
);

1709 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 : 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 : 35);

1711 ià(
ty³
!=
LUMA_8x8
)

1713 ià(
block_b
.
avažabË
)

1715 if(
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
==
IPCM
)

1716 
uµ”_b™
 = 1;

1718 
uµ”_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0],
b™
+
b™_pos_b
);

1722 ià(
block_a
.
avažabË
)

1724 if(
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
 =ð
IPCM
)

1725 
Ëá_b™
 = 1;

1727 
Ëá_b™
 = 
	`g‘_b™
(
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_a
);

1730 
ùx
 = (
uµ”_b™
 << 1è+ 
Ëá_b™
;

1733 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
cbp_b™
, 
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]] + 
ùx
);

1735 
	}
}

1743 
	$wr™e_signifiÿnû_m­
 (
Maüoblock
* 
cu¼MB
, 
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cÛff
[], 
cÛff_ùr
, 
Textu»InfoCÚ‹xts
* 
‹x_ùx
)

1745 
k
;

1746 
sig
, 
Ï¡
;

1747 
k0
 = 0;

1748 
k1
 = 
maxpos
[
ty³
];

1750 #ià
ENABLE_FIELD_CTX


1751 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1752 
æd
 = ( 
p_Vid
->
¡ruùu»
!=
FRAME
 || 
cu¼MB
->
mb_f›ld
 );

1754 
æd
 = 0;

1756 
BiCÚ‹xtTy³PŒ
 
m­_ùx
 = 
‹x_ùx
->
m­_cÚ‹xts
 [
æd
][
ty³2ùx_m­
 [
ty³
]];

1757 
BiCÚ‹xtTy³PŒ
 
Ï¡_ùx
 = 
‹x_ùx
->
Ï¡_cÚ‹xts
[
æd
][
ty³2ùx_Ï¡
[
ty³
]];

1758 cÚ¡ 
by‹
 *
pos2ùxm­
 = 
æd
 ? 
pos2ùx_m­_št
 [
ty³
] : 
pos2ùx_m­
 [type];

1759 cÚ¡ 
by‹
 *
pos2ùxÏ¡
 = 
pos2ùx_Ï¡
[
ty³
];

1761 ià(!
c1isdc
[
ty³
])

1763 ++
k0
;

1764 ++
k1
;

1765 --
cÛff
;

1768 
k
=
k0
; k<
k1
; ++k)

1770 
sig
 = (
cÛff
[
k
] != 0);

1771 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
sig
, 
m­_ùx
 + 
pos2ùxm­
[
k
]);

1772 ià(
sig
)

1774 
Ï¡
 = (--
cÛff_ùr
 == 0);

1776 
	`bŸri_’code_symbÞ
(
“p_dp
, 
Ï¡
, 
Ï¡_ùx
 + 
pos2ùxÏ¡
[
k
]);

1777 ià(
Ï¡
)

1781 
	}
}

1790 
	$wr™e_signifiÿÁ_cÛffic›Ás
 (
EncodšgEnvœÚm’tPŒ
 
“p_dp
, 
ty³
, 
cÛff
[], 
Textu»InfoCÚ‹xts
* 
‹x_ùx
, 
cÛff_út
)

1792 
BiCÚ‹xtTy³
 *
Úe_cÚ‹xts
 = 
‹x_ùx
->Úe_cÚ‹xts[
ty³2ùx_Úe
[
ty³
]];

1793 
BiCÚ‹xtTy³
 *
abs_cÚ‹xts
 = 
‹x_ùx
->abs_cÚ‹xts[
ty³2ùx_abs
[
ty³
]];

1794 
absLev–
;

1795 
ùx
;

1796 
sign
;

1797 
g»©”_Úe
;

1798 
c1
 = 1;

1799 
c2
 = 0;

1800 
i
;

1802 
i
=
maxpos
[
ty³
]; (i>=0è&& (
cÛff_út
); i--)

1804 ià(
cÛff
[
i
]!=0)

1806 
cÛff_út
--;

1808 ià(
cÛff
[
i
] > 0)

1810 
absLev–
 = 
cÛff
[
i
];

1811 
sign
 = 0;

1815 
absLev–
 = -
cÛff
[
i
];

1816 
sign
 = 1;

1819 
g»©”_Úe
 = (
absLev–
 > 1);

1822 
ùx
 = 
	`imš
(
c1
, 4);

1823 
	`bŸri_’code_symbÞ
 (
“p_dp
, 
g»©”_Úe
, 
Úe_cÚ‹xts
 + 
ùx
);

1825 ià(
g»©”_Úe
)

1827 
ùx
 = 
	`imš
(
c2
++, 
max_c2
[
ty³
]);

1828 
	`uÇry_exp_gÞomb_Ëv–_’code
(
“p_dp
, 
absLev–
 - 2, 
abs_cÚ‹xts
 + 
ùx
);

1829 
c1
 = 0;

1831 ià(
c1
)

1833 
c1
++;

1835 
	`bŸri_’code_symbÞ_eq_´ob
 (
“p_dp
, 
sign
);

1838 
	}
}

1848 
	$wr™eRunLev–_CABAC
 (
Maüoblock
* 
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1850 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1851 
EncodšgEnvœÚm’tPŒ
 
“p_dp
 = &(
dp
->
“_ÿbac
);

1852 
cu¼_Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p_dp
);

1855 ià(
£
->
v®ue1
 != 0)

1857 
cu¼Sliû
->
pos
 +ð
£
->
v®ue2
;

1858 
cu¼Sliû
->
cÛff
[cu¼Sliû->
pos
++] = 
£
->
v®ue1
;

1859 ++
cu¼Sliû
->
cÛff_ùr
;

1863 
Textu»InfoCÚ‹xts
 *
‹x_ùx
 = 
cu¼Sliû
->tex_ctx;

1865 ià(
cu¼Sliû
->
cÛff_ùr
 > 0)

1867 
cu¼Sliû
->
	`wr™e_ªd_¡Üe_CBP_block_b™
 (
cu¼MB
, 
“p_dp
, 
£
->
cÚ‹xt
, 1, 
‹x_ùx
);

1869 
	`wr™e_signifiÿnû_m­
 (
cu¼MB
, 
“p_dp
, 
£
->
cÚ‹xt
, 
cu¼Sliû
->
cÛff
, cu¼Sliû->
cÛff_ùr
, 
‹x_ùx
);

1871 
	`wr™e_signifiÿÁ_cÛffic›Ás
 (
“p_dp
, 
£
->
cÚ‹xt
, 
cu¼Sliû
->
cÛff
, 
‹x_ùx
, cu¼Sliû->
cÛff_ùr
);

1873 
	`mem£t
(
cu¼Sliû
->
cÛff
, 0 , 64 * ());

1876 
cu¼Sliû
->
	`wr™e_ªd_¡Üe_CBP_block_b™
 (
cu¼MB
, 
“p_dp
, 
£
->
cÚ‹xt
, 0, 
‹x_ùx
);

1879 
cu¼Sliû
->
pos
 = cu¼Sliû->
cÛff_ùr
 = 0;

1882 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1883 
£
->
Ën
 = (
	`¬›nco_b™s_wr™‹n
(
“p_dp
è- 
cu¼_Ën
);

1884 
CABAC_TRACE
;

1885 
	}
}

	@lencod/src/cconv_yuv2rgb.c

14 
	~"cÚŒibutÜs.h
"

15 
	~"glob®.h
"

16 
	~"mem®loc.h
"

17 
	~"img_di¡ÜtiÚ.h
"

19 
	#YUV2RGB_YOFFSET


	)

22 #ifdeà
YUV2RGB_YOFFSET


23 
	#OFFSET_Y
 16

	)

24 cÚ¡ 
	gK0
 = 1.164f;

25 cÚ¡ 
	gK1
 = 1.596f;

26 cÚ¡ 
	gK2
 = 0.391f;

27 cÚ¡ 
	gK3
 = 0.813f;

28 cÚ¡ 
	gK4
 = 2.018f;

30 cÚ¡ 
	gK0
 = 1.000f;

31 cÚ¡ 
	gK1
 = 1.402f;

32 cÚ¡ 
	gK2
 = 0.34414f;

33 cÚ¡ 
	gK3
 = 0.71414f;

34 cÚ¡ 
	gK4
 = 1.772f;

37 
	$ü—‹_RGB_memÜy
(
VideoP¬am‘”s
 *
p_Vid
)

39 
memÜy_size
 = 0;

40 
j
;

41  
j
 = 0; j < 3; j++ )

43 
memÜy_size
 +ð
	`g‘_mem2D³l
 (&
p_Vid
->
imgRGB_¤c
.
d©a
[
j
],…_Vid->
height
,…_Vid->
width
);

45  
j
 = 0; j < 3; j++ )

47 
memÜy_size
 +ð
	`g‘_mem2D³l
 (&
p_Vid
->
imgRGB_»f
.
d©a
[
j
],…_Vid->
height
,…_Vid->
width
);

50  
memÜy_size
;

51 
	}
}

53 
	$d–‘e_RGB_memÜy
(
VideoP¬am‘”s
 *
p_Vid
)

55 
i
;

56  
i
 = 0; i < 3; i++ )

58 
	`ä“_mem2D³l
(
p_Vid
->
imgRGB_¤c
.
d©a
[
i
]);

60  
i
 = 0; i < 3; i++ )

62 
	`ä“_mem2D³l
(
p_Vid
->
imgRGB_»f
.
d©a
[
i
]);

64 
	}
}

66 
	$š™_YUVtoRGB
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

68 
cÚv_sÿË
 = () (65536.0f);

70 
p_Vid
->
wka0
 = 
	`æßt2št
Ð
cÚv_sÿË
 * 
K0
);

71 
p_Vid
->
wka1
 = 
	`æßt2št
Ð
cÚv_sÿË
 * 
K1
);

72 
p_Vid
->
wka2
 = 
	`æßt2št
Ð-
cÚv_sÿË
 * 
K2
);

73 
p_Vid
->
wka3
 = 
	`æßt2št
Ð-
cÚv_sÿË
 * 
K3
);

74 
p_Vid
->
wka4
 = 
	`æßt2št
Ð
cÚv_sÿË
 * 
K4
);

76 #ifdeà
YUV2RGB_YOFFSET


77 
p_Vid
->
off£t_y
 = 
OFFSET_Y
 << (
p_IÅ
->
ouut
.
b™_d•th
[0] - 8);

78 
p_Vid
->
off£t_ü
 = 1 << (
p_IÅ
->
ouut
.
b™_d•th
[0] - 1);

80 
	}
}

91 
	$YUVtoRGB
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
YUV
, ImageSŒuùu» *
RGB
)

93 
i
, 
j
, 
j_ü
, 
i_ü
;

94 
sy
, 
su
, 
sv
;

95 
wbuv
, 
wguv
, 
wruv
;

96 
img³l
 *
Y
, *
U
, *
V
, *
R
, *
G
, *
B
;

97 
F¿meFÜm©
 
fÜm©
 = 
YUV
->format;

98 
width
 = 
fÜm©
.width[0];

99 
height
 = 
fÜm©
.height[0];

100 
max_v®ue
 = 
fÜm©
.max_value[0];

103 
j
 = 0; j < 
height
; j++)

105 
j_ü
 = 
j
 >> 
p_Vid
->
shiá_ü_y
;

106 
Y
 = 
YUV
->
d©a
[0][
j
];

107 
U
 = 
YUV
->
d©a
[1][
j_ü
];

108 
V
 = 
YUV
->
d©a
[2][
j_ü
];

109 
R
 = 
RGB
->
d©a
[0][
j
];

110 
G
 = 
RGB
->
d©a
[1][
j
];

111 
B
 = 
RGB
->
d©a
[2][
j
];

113 
i
 = 0; i < 
width
; i++)

115 
i_ü
 = 
i
 >> 
p_Vid
->
shiá_ü_x
;

117 
su
 = 
U
[
i_ü
] - 
p_Vid
->
off£t_ü
;

118 
sv
 = 
V
[
i_ü
] - 
p_Vid
->
off£t_ü
;

120 
wruv
 = 
p_Vid
->
wka1
 * 
sv
;

121 
wguv
 = 
p_Vid
->
wka2
 * 
su
 +…_Vid->
wka3
 * 
sv
;

122 
wbuv
 = 
p_Vid
->
wka4
 * 
su
;

124 #ifdeà
YUV2RGB_YOFFSET


125 
sy
 = 
p_Vid
->
wka0
 * (
Y
[
i
] -…_Vid->
off£t_y
);

127 
sy
 = 
p_Vid
->
wka0
 * 
Y
[
i
];

130 
R
[
i
] = (
img³l
è
	`iCl1
Ð
max_v®ue
, 
	`rshiá_ºd
(
sy
 + 
wruv
, 16));

131 
G
[
i
] = (
img³l
è
	`iCl1
Ð
max_v®ue
, 
	`rshiá_ºd
(
sy
 + 
wguv
, 16));

132 
B
[
i
] = (
img³l
è
	`iCl1
Ð
max_v®ue
, 
	`rshiá_ºd
(
sy
 + 
wbuv
, 16));

136 
RGB
->
fÜm©
 = format;

137 
RGB
->
fÜm©
.
yuv_fÜm©
 = 
YUV444
;

138 
RGB
->
fÜm©
.
cÞÜ_mod–
 = 
CM_RGB
;

139 
RGB
->
fÜm©
.
pix–_fÜm©
 = 
BGR
;

140 
RGB
->
fÜm©
.
height
[1] = format.height[0];

141 
RGB
->
fÜm©
.
width
[1] = format.width[0];

142 
i
 = 1; i < 3; i++)

144 
RGB
->
fÜm©
.
size_cmp
[
i
] = format.size_cmp[0];

145 
RGB
->
fÜm©
.
b™_d•th
[
i
] = format.bit_depth[0];

146 
RGB
->
fÜm©
.
max_v®ue
[
i
] = max_value;

147 
RGB
->
fÜm©
.
max_v®ue_sq
[
i
] = format.max_value_sq[0];

149 
	}
}

	@lencod/src/configfile.c

59 
	#INCLUDED_BY_CONFIGFILE_C


	)

61 
	~<sys/¡©.h
>

63 
	~"glob®.h
"

64 
	~"cÚfig_commÚ.h
"

65 
	~"cÚfigfže.h
"

66 
	~"fmo.h
"

67 
	~"cÚfÜmªû.h
"

68 
	~"mc_´ediùiÚ.h
"

69 
	~"mv_£¬ch.h
"

70 
	~"img_io.h
"

71 
	~"¿‹ùl.h
"

73 
P©chIÅ
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

74 
Te¡Encod”P¬ams
 (
M­pšg
 *
M­
, 
b™d•th_qp_sÿË
[3]);

75 
Di¥ÏyEncod”P¬ams
 (
M­pšg
 *
M­
);

77 cÚ¡ 
	gmb_width_ü
[4] = {0,8, 8,16};

78 cÚ¡ 
	gmb_height_ü
[4]= {0,8,16,16};

80 
	#MAX_ITEMS_TO_PARSE
 10000

	)

82 
	~"£i.h
"

83 
S‘VUISÿËAndTicks
(
IÅutP¬am‘”s
 *
p_IÅ
, 
äame_¿‹
);

92 
	$£t_jm_vui_·¿ms
Ð
IÅutP¬am‘”s
 *
p_IÅ
 )

94 
	`S‘VUISÿËAndTicks
(
p_IÅ
, 1.25 *…_IÅ->
ouut
.
äame_¿‹
);

96 
p_IÅ
->
EÇbËVUISuµÜt
 = 1;

98 
p_IÅ
->
VUI
.
Çl_hrd_·¿m‘”s_´e£Á_æag
 = 0;

99 
p_IÅ
->
VUI
.
vþ_hrd_·¿m‘”s_´e£Á_æag
 = 0;

100 
p_IÅ
->
VUI
.
timšg_šfo_´e£Á_æag
 = 1;

101 
p_IÅ
->
VUI
.
pic_¡ruù_´e£Á_æag
 = 1;

102 
p_IÅ
->
VUI
.
fixed_äame_¿‹_æag
 = 1;

103 
	}
}

111 
	$JMH–pEx™
 ()

113 
	`årštf
Ð
¡d”r
, "\n†encod [-h] [-d defenc.cfg] {[-f curenc1.cfg]...[-f curencN.cfg]}"

148 
	`ex™
(-1);

149 
	}
}

158 
št64
 
	$g‘VideoFžeSize
(
video_fže
)

160 
št64
 
fsize
;

162 
	`l£ek
(
video_fže
, 0, 
SEEK_END
);

163 
fsize
 = 
	`‹Î
((è
video_fže
);

164 
	`l£ek
(
video_fže
, 0, 
SEEK_SET
);

166  
fsize
;

167 
	}
}

176 
	$g‘_numb”_of_äames
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
VideoD©aFže
 *
šput_fže
)

178 
št64
 
fsize
 = 
	`g‘VideoFžeSize
(
šput_fže
->
f_num
);

180 
št64
 
isize
 = (št64è
p_IÅ
->
sourû
.
size
;

181 
maxB™D•th
 = 
	`imax
(
p_IÅ
->
sourû
.
b™_d•th
[0],…_Inp->source.bit_depth[1]);

183 
isize
 <<ð(
maxB™D•th
 > 8)? 1: 0;

184 
p_IÅ
->
no_äames
 = (è(((
fsize
 -…_IÅ->
šfže_h—d”
)/ 
isize
è-…_IÅ->
¡¬t_äame
);

185 
	}
}

194 
	$upd©eMaxV®ue
(
F¿meFÜm©
 *
fÜm©
)

196 
fÜm©
->
max_v®ue
[0] = (1 << fÜm©->
b™_d•th
[0]) - 1;

197 
fÜm©
->
max_v®ue_sq
[0] = fÜm©->
max_v®ue
[0] * format->max_value[0];

198 
fÜm©
->
max_v®ue
[1] = (1 << fÜm©->
b™_d•th
[1]) - 1;

199 
fÜm©
->
max_v®ue_sq
[1] = fÜm©->
max_v®ue
[1] * format->max_value[1];

200 
fÜm©
->
max_v®ue
[2] = (1 << fÜm©->
b™_d•th
[2]) - 1;

201 
fÜm©
->
max_v®ue_sq
[2] = fÜm©->
max_v®ue
[2] * format->max_value[2];

202 
	}
}

211 
	$upd©eOutFÜm©
(
IÅutP¬am‘”s
 *
p_IÅ
)

213 
F¿meFÜm©
 *
ouut
 = &
p_IÅ
->output;

214 
F¿meFÜm©
 *
sourû
 = &
p_IÅ
->source;

215 
ouut
->
yuv_fÜm©
 = (
CÞÜFÜm©
è
p_IÅ
->yuv_format;

216 
sourû
->
yuv_fÜm©
 = (
CÞÜFÜm©
è
p_IÅ
->yuv_format;

218 ià(
p_IÅ
->
¤c_»size
 == 0)

220 
ouut
->
width
[0] = 
sourû
->width[0];

221 
ouut
->
height
[0] = 
sourû
->height[0];

224 ià(
p_IÅ
->
yuv_fÜm©
 =ð
YUV400
)

226 
sourû
->
b™_d•th
[1] = 8;

227 
ouut
->
b™_d•th
[1] = 8;

228 
sourû
->
width
[1] = 0;

229 
sourû
->
width
[2] = 0;

230 
sourû
->
height
[1] = 0;

231 
sourû
->
height
[2] = 0;

232 
ouut
->
width
[1] = 0;

233 
ouut
->
width
[2] = 0;

234 
ouut
->
height
[1] = 0;

235 
ouut
->
height
[2] = 0;

239 
sourû
->
width
[1] = (sourû->width[0] * 
mb_width_ü
 [
ouut
->
yuv_fÜm©
]) >> 4;

240 
sourû
->
width
[2] = source->width[1];

241 
sourû
->
height
[1] = (sourû->height[0] * 
mb_height_ü
[
ouut
->
yuv_fÜm©
]) >> 4;

242 
sourû
->
height
[2] = source->height[1];

243 
ouut
->
width
[1] = (ouut->width[0] * 
mb_width_ü
 [ouut->
yuv_fÜm©
]) >> 4;

244 
ouut
->
width
[2] = output->width[1];

245 
ouut
->
height
[1] = (ouut->height[0] * 
mb_height_ü
[ouut->
yuv_fÜm©
]) >> 4;

246 
ouut
->
height
[2] = output->height[1];

250 
sourû
->
size_cmp
[0] = sourû->
width
[0] * sourû->
height
[0];

251 
sourû
->
size_cmp
[1] = sourû->
width
[1] * sourû->
height
[1];

252 
sourû
->
size_cmp
[2] = source->size_cmp[1];

253 
sourû
->
size
 = sourû->
size_cmp
[0] + source->size_cmp[1] + source->size_cmp[2];

254 
sourû
->
mb_width
 = sourû->
width
[0] / 
MB_BLOCK_SIZE
;

255 
sourû
->
mb_height
 = sourû->
height
[0] / 
MB_BLOCK_SIZE
;

256 
sourû
->
pic_un™_size_Ú_disk
 = (
	`imax
(sourû->
b™_d•th
[0], source->bit_depth[1]) > 8) ? 16 : 8;

257 
sourû
->
pic_un™_size_shiá3
 = sourû->
pic_un™_size_Ú_disk
 >> 3;

261 
ouut
->
size_cmp
[0] = ouut->
width
[0] * ouut->
height
[0];

262 
ouut
->
size_cmp
[1] = ouut->
width
[1] * ouut->
height
[1];

263 
ouut
->
size_cmp
[2] = output->size_cmp[1];

264 
ouut
->
size
 = ouut->
size_cmp
[0] + output->size_cmp[1] + output->size_cmp[2];

265 
ouut
->
mb_width
 = ouut->
width
[0] / 
MB_BLOCK_SIZE
;

266 
ouut
->
mb_height
 = ouut->
height
[0] / 
MB_BLOCK_SIZE
;

270 
sourû
->
b™_d•th
[2] = source->bit_depth[1];

271 
ouut
->
b™_d•th
[2] = output->bit_depth[1];

274 ià(
p_IÅ
->
¤c_B™D•thResÿË
 == 0)

276 
ouut
->
b™_d•th
[0] = 
sourû
->bit_depth[0];

277 
ouut
->
b™_d•th
[1] = 
sourû
->bit_depth[1];

278 
ouut
->
b™_d•th
[2] = 
sourû
->bit_depth[2];

280 
ouut
->
pic_un™_size_Ú_disk
 = (
	`imax
(ouut->
b™_d•th
[0], output->bit_depth[1]) > 8) ? 16 : 8;

281 
ouut
->
pic_un™_size_shiá3
 = ouut->
pic_un™_size_Ú_disk
 >> 3;

283 ià(
p_IÅ
->
’abË_32_puÎdown
)

285 
sourû
->
äame_¿‹
 = source->frame_rate * 5 / 4;

286 
p_IÅ
->
idr_³riod
 =…_Inp->idr_period * 5 / 4;

287 
p_IÅ
->
šŒa_³riod
 =…_Inp->intra_period * 5 / 4;

288 
p_IÅ
->
no_äames
 =…_Inp->no_frames * 5 / 4;

291 
ouut
->
äame_¿‹
 = 
sourû
->äame_¿‹ / (
p_IÅ
->
äame_sk
 + 1);

292 
ouut
->
cÞÜ_mod–
 = 
sourû
->color_model;

293 
ouut
->
pix–_fÜm©
 = 
sourû
->pixel_format;

295 
	`upd©eMaxV®ue
(
sourû
);

296 
	`upd©eMaxV®ue
(
ouut
);

297 
	}
}

314 
	$CÚfigu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ac
, *
av
[])

316 *
cÚ‹Á
 = 
NULL
;

317 
CLcouÁ
, 
CÚ‹ÁL’
, 
Numb”P¬ams
;

318 *
fž’ame
=
DEFAULTCONFIGFILENAME
;

320 ià(
ac
==2)

322 ià(0 =ð
	`¡ºcmp
 (
av
[1], "-v", 2))

324 
	`´štf
("JM-" 
VERSION
 "\n");

325 
	`ex™
(0);

327 ià(0 =ð
	`¡ºcmp
 (
av
[1], "-V", 2))

329 
	`´štf
("JM " 
JM
 ": compžed " 
__DATE__
 " " 
__TIME__
 "\n");

330 #iàÐ
IMGTYPE
 == 0 )

331 
	`´štf
("support for morehan 8 bits/pel disabled\n");

333 #iàÐ
ENABLE_FIELD_CTX
 == 0 )

334 
	`´štf
("CABAC field coding disabled\n");

336 #iàÐ
ENABLE_HIGH444_CTX
 == 0 )

337 
	`´štf
("CABAC High 4:4:4…rofile coding disabled\n");

339 
	`ex™
(0);

342 ià(0 =ð
	`¡ºcmp
 (
av
[1], "-h", 2))

344 
	`JMH–pEx™
();

348 
	`mem£t
 (&
cfg·¿ms
, 0,  (
IÅutP¬am‘”s
));

350 
	`´štf
 ("Setting Default Parameters...\n");

351 
	`In™P¬ams
(
M­
);

354 
CLcouÁ
 = 1;

356 ià(
ac
>=3)

358 ià(0 =ð
	`¡ºcmp
 (
av
[1], "-d", 2))

360 
fž’ame
=
av
[2];

361 
CLcouÁ
 = 3;

363 ià(0 =ð
	`¡ºcmp
 (
av
[1], "-h", 2))

365 
	`JMH–pEx™
();

368 
	`´štf
 ("P¬sšg CÚfigfž%s", 
fž’ame
);

369 
cÚ‹Á
 = 
	`G‘CÚfigFžeCÚ‹Á
 (
fž’ame
);

370 ià(
NULL
==
cÚ‹Á
)

371 
	`”rÜ
 (
”rÜ‹xt
, 300);

372 
	`P¬£CÚ‹Á
 (
p_IÅ
, 
M­
, 
cÚ‹Á
, (è
	`¡¾’
(content));

373 
	`´štf
 ("\n");

374 
	`ä“
 (
cÚ‹Á
);

378 
CLcouÁ
 < 
ac
)

380 ià(0 =ð
	`¡ºcmp
 (
av
[
CLcouÁ
], "-h", 2))

382 
	`JMH–pEx™
();

385 ià(0 =ð
	`¡ºÿ£cmp
 (
av
[
CLcouÁ
], "-f", 2))

387 
cÚ‹Á
 = 
	`G‘CÚfigFžeCÚ‹Á
 (
av
[
CLcouÁ
+1]);

388 ià(
NULL
==
cÚ‹Á
)

389 
	`”rÜ
 (
”rÜ‹xt
, 300);

390 
	`´štf
 ("P¬sšg CÚfigfž%s", 
av
[
CLcouÁ
+1]);

391 
	`P¬£CÚ‹Á
 (
p_IÅ
, 
M­
, 
cÚ‹Á
, (è
	`¡¾’
 (content));

392 
	`´štf
 ("\n");

393 
	`ä“
 (
cÚ‹Á
);

394 
CLcouÁ
 += 2;

398 ià(0 =ð
	`¡ºÿ£cmp
 (
av
[
CLcouÁ
], "-p", 2))

403 ++
CLcouÁ
;

404 
CÚ‹ÁL’
 = 0;

405 
Numb”P¬ams
 = 
CLcouÁ
;

408 
Numb”P¬ams
 < 
ac
 && 
av
[NumberParams][0] != '-')

409 
CÚ‹ÁL’
 +ð(è
	`¡¾’
 (
av
[
Numb”P¬ams
++]);

410 
CÚ‹ÁL’
 += 1000;

413 ià((
cÚ‹Á
 = 
	`m®loc
 (
CÚ‹ÁL’
))==
NULL
è
	`no_mem_ex™
("Configure: content");;

414 
cÚ‹Á
[0] = '\0';

418 
CLcouÁ
 < 
Numb”P¬ams
)

420 *
sourû
 = &
av
[
CLcouÁ
][0];

421 *
de¡š
 = &
cÚ‹Á
[(è
	`¡¾’
 (content)];

423 *
sourû
 != '\0')

425 ià(*
sourû
 == '=')

427 *
de¡š
++=' '; *destin++='='; *destin++=' ';

430 *
de¡š
++=*
sourû
;

431 
sourû
++;

433 *
de¡š
 = '\0';

434 
CLcouÁ
++;

436 
	`´štf
 ("P¬sšg commªd†š¡ršg '%s'", 
cÚ‹Á
);

437 
	`P¬£CÚ‹Á
 (
p_IÅ
, 
M­
, 
cÚ‹Á
, (è
	`¡¾’
(content));

438 
	`ä“
 (
cÚ‹Á
);

439 
	`´štf
 ("\n");

443 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀcommªd†še,‡ø%d,‡round sŒšg '%s', missšg -àÜ -°·¿m‘”s?", 
CLcouÁ
, 
av
[CLcount]);

444 
	`”rÜ
 (
”rÜ‹xt
, 300);

448 
	`´štf
 ("\n");

450 #ià(
MVC_EXTENSION_ENABLE
)

451 ià(
p_IÅ
->
num_of_v›ws
 > 1)

453 
	`´štf
 ("P¬sšg SecÚd V›w CÚfigfž%s", 
p_IÅ
->
V›w1CÚfigName
 );

454 
cÚ‹Á
 = 
	`G‘CÚfigFžeCÚ‹Á
 ( 
p_IÅ
->
V›w1CÚfigName
 );

455 ià(
NULL
==
cÚ‹Á
)

456 
	`”rÜ
 (
”rÜ‹xt
, 300);

457 
	`P¬£CÚ‹Á
 (
p_IÅ
, 
M­V›w1
, 
cÚ‹Á
, (è
	`¡¾’
(content));

458 
	`´štf
 ("\n");

459 
	`ä“
 (
cÚ‹Á
);

463 
	`P©chIÅ
(
p_Vid
, 
p_IÅ
);

465 
cfg·¿ms
 = *
p_IÅ
;

467 ià(
p_IÅ
->
Di¥ÏyEncP¬ams
)

468 
	`Di¥ÏyEncod”P¬ams
(
M­
);

469 
	}
}

482 
	$Te¡Encod”P¬ams
(
M­pšg
 *
M­
, 
b™d•th_qp_sÿË
[3])

484 
i
 = 0;

486 
M­
[
i
].
Tok’Name
 !ð
NULL
)

488 ià(
M­
[
i
].
·¿m_lim™s
 == 1)

490 ià(
M­
[
i
].
Ty³
 == 0)

492 iàÐ* (*è(
M­
[
i
].
PÏû
è< (èM­[i].
mš_lim™
 || * (*è(M­[i].PÏûè> (èM­[i].
max_lim™
 )

494 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%d, %d]„ªge.", 
M­
[
i
].
Tok’Name
, (èM­[i].
mš_lim™
,()M­[i].
max_lim™
 );

495 
	`”rÜ
 (
”rÜ‹xt
, 400);

499 ià(
M­
[
i
].
Ty³
 == 2)

501 iàÐ* (*è(
M­
[
i
].
PÏû
è< M­[i].
mš_lim™
 || * (*è(M­[i].PÏûè> M­[i].
max_lim™
 )

503 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%.2f, %.2f]„ªge.", 
M­
[
i
].
Tok’Name
,M­[i].
mš_lim™
 ,M­[i].
max_lim™
 );

504 
	`”rÜ
 (
”rÜ‹xt
, 400);

508 ià(
M­
[
i
].
·¿m_lim™s
 == 2)

510 ià(
M­
[
i
].
Ty³
 == 0)

512 iàÐ* (*è(
M­
[
i
].
PÏû
è< (èM­[i].
mš_lim™
 )

514 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould‚Ù bsm®Ë¸thª %d.", 
M­
[
i
].
Tok’Name
, (èM­[i].
mš_lim™
);

515 
	`”rÜ
 (
”rÜ‹xt
, 400);

518 ià(
M­
[
i
].
Ty³
 == 2)

520 iàÐ* (*è(
M­
[
i
].
PÏû
è< M­[i].
mš_lim™
 )

522 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould‚Ù bsm®Ë¸thª %2.f.", 
M­
[
i
].
Tok’Name
,M­[i].
mš_lim™
);

523 
	`”rÜ
 (
”rÜ‹xt
, 400);

527 ià(
M­
[
i
].
·¿m_lim™s
 == 3)

530 ià(
M­
[
i
].
Ty³
 == 0)

532 
cur_qp
 = * (*è(
M­
[
i
].
PÏû
);

533 
mš_qp
 = (è(
M­
[
i
].
mš_lim™
 - 
b™d•th_qp_sÿË
[0]);

534 
max_qp
 = (è
M­
[
i
].
max_lim™
;

536 ià(Ð
cur_qp
 < 
mš_qp
 ) || ( cur_q°> 
max_qp
 ))

538 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü iÀšpuˆ·¿m‘” %s. Check cÚfigu¿tiÚ fže. V®ushould bš [%d, %d]„ªge.", 
M­
[
i
].
Tok’Name
, 
mš_qp
, 
max_qp
 );

539 
	`”rÜ
 (
”rÜ‹xt
, 400);

544 
i
++;

547 
	}
}

559 
	$Di¥ÏyEncod”P¬ams
(
M­pšg
 *
M­
)

561 
i
 = 0;

563 
	`´štf
("******************************************************\n");

564 
	`´štf
("* Encoder Parameters *\n");

565 
	`´štf
("******************************************************\n");

566 
M­
[
i
].
Tok’Name
 !ð
NULL
)

568 ià(
M­
[
i
].
Ty³
 == 0)

569 
	`´štf
("P¬am‘” % ð%d\n",
M­
[
i
].
Tok’Name
,* (*è(M­[i].
PÏû
));

570 ià(
M­
[
i
].
Ty³
 == 1)

571 
	`´štf
("P¬am‘” % ð""%s""\n",
M­
[
i
].
Tok’Name
,(*è(M­[i].
PÏû
));

572 ià(
M­
[
i
].
Ty³
 == 2)

573 
	`´štf
("P¬am‘” % ð%.2f\n",
M­
[
i
].
Tok’Name
,* (*è(M­[i].
PÏû
));

574 
i
++;

576 
	`´štf
("******************************************************\n");

578 
	}
}

587 
	$»ad_¦iû_group_šfo
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

589 
FILE
 * 
sgfže
=
NULL
;

590 
i
;

591 
»t
;

592 
PicSizeInM­Un™s
;

594 ià((
p_IÅ
->
¦iû_group_m­_ty³
 != 0) && (p_Inp->slice_group_map_type != 2) && (p_Inp->slice_group_map_type != 6))

601 ià((è
	`¡¾’
 (
p_IÅ
->
SliûGroupCÚfigFžeName
) <= 1)

602 
	`”rÜ
 ("No slice group config file‚ame specified", 500);

605 
sgfže
 = 
	`fÝ’
(
p_IÅ
->
SliûGroupCÚfigFžeName
,"r");

607 iàÐ
NULL
==
sgfže
 )

609 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³nšg sliû grou°fž%s", 
p_IÅ
->
SliûGroupCÚfigFžeName
);

610 
	`”rÜ
 (
”rÜ‹xt
, 500);

613 
p_IÅ
->
¦iû_group_m­_ty³
)

616 
p_IÅ
->
run_Ëngth_mšus1
=(*)
	`m®loc
(()*Õ_IÅ->
num_¦iû_groups_mšus1
+1));

617 iàÐ
NULL
==
p_IÅ
->
run_Ëngth_mšus1
 )

619 
	`fþo£
(
sgfže
);

620 
	`no_mem_ex™
("read_slice_group_info:…_Inp->run_length_minus1");

624 
i
=0; i <ð
p_IÅ
->
num_¦iû_groups_mšus1
;i++)

626 
»t
 = 
	`fsÿnf
(
sgfže
,"%d",(
p_IÅ
->
run_Ëngth_mšus1
+
i
));

627 iàÐ1!=
»t
 )

629 
	`fþo£
(
sgfže
);

630 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü whž»adšg sliû grou°cÚfig fžÖš%d)", 
i
+1);

631 
	`”rÜ
 (
”rÜ‹xt
, 500);

634 
»t
 = 
	`fsÿnf
(
sgfže
,"%*[^\n]");

640 
PicSizeInM­Un™s
 = (
p_IÅ
->
ouut
.
width
[0] >> 4è* (p_IÅ->ouut.
height
[0] >> 4);

641 ià(
p_IÅ
->
MbIÁ”Ïû
||p_IÅ->
PicIÁ”Ïû
)

642 
PicSizeInM­Un™s
 >>= 1;

644 
p_IÅ
->
tÝ_Ëá
 = (*)
	`m®loc
(()*p_IÅ->
num_¦iû_groups_mšus1
);

645 
p_IÅ
->
bÙtom_right
 = (*)
	`m®loc
(()*p_IÅ->
num_¦iû_groups_mšus1
);

647 ià(
NULL
==
p_IÅ
->
tÝ_Ëá
)

649 
	`fþo£
(
sgfže
);

650 
	`no_mem_ex™
("PatchInp:…_Inp->top_left");

653 ià(
NULL
==
p_IÅ
->
bÙtom_right
)

655 
	`fþo£
(
sgfže
);

656 
	`no_mem_ex™
("PatchInp:…_Inp->bottom_right");

660 
i
=0;i<
p_IÅ
->
num_¦iû_groups_mšus1
;i++)

662 
»t
 = 
	`fsÿnf
(
sgfže
,"%ud",(
p_IÅ
->
tÝ_Ëá
+
i
));

663 iàÐ1!=
»t
 )

665 
	`fþo£
(
sgfže
);

666 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü whž»adšg sliû grou°cÚfig fžÖš%d)", 2*
i
 +1);

667 
	`”rÜ
 (
”rÜ‹xt
, 500);

669 ià(
p_IÅ
->
tÝ_Ëá
[
i
] > 
PicSizeInM­Un™s
)

671 
	`årštf
(
¡d”r
, "W¬nšg: sliû grou°# %dÝ_Ëáƒxûed piùu» siz(wžÈbþ³d)\n", 
i
);

674 
»t
 = 
	`fsÿnf
(
sgfže
,"%*[^\n]");

675 
»t
 = 
	`fsÿnf
(
sgfže
,"%ud",(
p_IÅ
->
bÙtom_right
+
i
));

676 iàÐ1!=
»t
 )

678 
	`fþo£
(
sgfže
);

679 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü whž»adšg sliû grou°cÚfig fžÖš%d)", 2*
i
 + 2);

680 
	`”rÜ
 (
”rÜ‹xt
, 500);

682 ià(
p_IÅ
->
bÙtom_right
[
i
] > 
PicSizeInM­Un™s
)

684 
	`årštf
(
¡d”r
, "W¬nšg: sliû grou°# %d bÙtom_righˆexûed piùu» siz(wžÈbþ³d)\n", 
i
);

687 
»t
 = 
	`fsÿnf
(
sgfže
,"%*[^\n]");

692 
tmp
;

693 
äame_mb_Úly
;

694 
mb_width
, 
mb_height
, 
m­un™_height
;

696 
äame_mb_Úly
 = !(
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
);

697 
mb_width
 = (
p_IÅ
->
ouut
.
width
[0] + 
p_Vid
->
auto_üÝ_right
)>>4;

698 
mb_height
 = (
p_IÅ
->
ouut
.
height
[0] + 
p_Vid
->
auto_üÝ_bÙtom
)>>4;

699 
m­un™_height
 = 
mb_height
 / (2-
äame_mb_Úly
);

701 
p_IÅ
->
¦iû_group_id
=(
by‹
 * ) 
	`m®loc
((by‹)*
m­un™_height
*
mb_width
);

702 ià(
NULL
==
p_IÅ
->
¦iû_group_id
)

704 
	`fþo£
(
sgfže
);

705 
	`no_mem_ex™
("PatchInp:…_Inp->slice_group_id");

709 
i
=0;i<
m­un™_height
*
mb_width
;i++)

711 
»t
 = 
	`fsÿnf
(
sgfže
,"%d", &
tmp
);

712 
p_IÅ
->
¦iû_group_id
[
i
]ð(
by‹
è
tmp
;

713 iàÐ1!=
»t
 )

715 
	`fþo£
(
sgfže
);

716 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü whž»adšg sliû grou°cÚfig fžÖš%d)", 
i
 + 1);

717 
	`”rÜ
 (
”rÜ‹xt
, 500);

719 iàÐ*(
p_IÅ
->
¦iû_group_id
+
i
è>…_IÅ->
num_¦iû_groups_mšus1
 )

721 
	`fþo£
(
sgfže
);

722 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü whž»adšg sliû grou°cÚfig fže: sliû_group_id‚Ù‡Îowed (lš%d)", 
i
 + 1);

723 
	`”rÜ
 (
”rÜ‹xt
, 500);

726 
»t
 = 
	`fsÿnf
(
sgfže
,"%*[^\n]");

732 
	`”rÜ
 ("Wrong slice groupype while„eading config file", 500);

737 
	`fþo£
(
sgfže
);

738 
	}
}

746 
	$P©chIÅ
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

748 
i
;

749 
b™d•th_qp_sÿË
[3];

751 ià(
p_IÅ
->
¤c_B™D•thResÿË
)

753 
b™d•th_qp_sÿË
 [0] = 6*(
p_IÅ
->
ouut
.
b™_d•th
[0] - 8);

754 
b™d•th_qp_sÿË
 [1] = 6*(
p_IÅ
->
ouut
.
b™_d•th
[1] - 8);

755 
b™d•th_qp_sÿË
 [2] = 6*(
p_IÅ
->
ouut
.
b™_d•th
[2] - 8);

759 
b™d•th_qp_sÿË
 [0] = 6*(
p_IÅ
->
sourû
.
b™_d•th
[0] - 8);

760 
b™d•th_qp_sÿË
 [1] = 6*(
p_IÅ
->
sourû
.
b™_d•th
[1] - 8);

761 
b™d•th_qp_sÿË
 [2] = 6*(
p_IÅ
->
sourû
.
b™_d•th
[2] - 8);

764 
	`Te¡Encod”P¬ams
(
M­
, 
b™d•th_qp_sÿË
);

766 ià(
p_IÅ
->
sourû
.
äame_¿‹
 == 0.0)

767 
p_IÅ
->
sourû
.
äame_¿‹
 = (è
INIT_FRAME_RATE
;

769 
	`P¬£VideoTy³
(&
p_IÅ
->
šput_fže1
);

770 
	`P¬£F¿meNoFÜm©FromSŒšg
 (&
p_IÅ
->
šput_fže1
);

772 #ià(
MVC_EXTENSION_ENABLE
)

773 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

775 
	`P¬£VideoTy³
(&
p_IÅ
->
šput_fže2
);

776 
	`P¬£F¿meNoFÜm©FromSŒšg
 (&
p_IÅ
->
šput_fže2
);

780 if(
p_IÅ
->
sourû
.
b™_d•th
[0] >8)

782 if(!
IMGTYPE
)

784 
	`”rÜ
("IMGTYPE should be 1 when bitdepth is greaterhan 8", 600);

788 ià(
p_IÅ
->
sourû
.
width
[0] =ð0 ||…_IÅ->sourû.
height
[0] == 0)

790 ià(
	`P¬£SizeFromSŒšg
 (&
p_IÅ
->
šput_fže1
, &Õ_IÅ->
sourû
.
width
[0]), &Õ_IÅ->sourû.
height
[0]), &Õ_IÅ->sourû.
äame_¿‹
)) == 0)

792 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "File‚ame does‚ot contain„esolution information.");

793 
	`”rÜ
 (
”rÜ‹xt
, 500);

797 #ià(!
ENABLE_FIELD_CTX
)

798 iàÐ(
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
è&&…_IÅ->
symbÞ_mode
 )

800 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Recompile with ENABLE_FIELD_CTX seto oneoƒnable interlaced coding with CABAC.");

801 
	`”rÜ
 (
”rÜ‹xt
, 500);

805 #ià(!
ENABLE_HIGH444_CTX
)

806 iàÐ(
p_IÅ
->
ProfžeIDC
 =ð
FREXT_Hi444
 ||…_IÅ->ProfžeIDC =ð
NO_PROFILE
 )&&…_IÅ->
symbÞ_mode
 )

808 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Recompile with ENABLE_HIGH444_CTX seto oneoƒnablehe High 4:4:4 Profile with CABAC.");

809 
	`”rÜ
 (
”rÜ‹xt
, 500);

814 
p_IÅ
->
šput_fže1
.
fÜm©
 =…_IÅ->
sourû
;

817 ià(
p_IÅ
->
idr_³riod
 &&…_IÅ->
šŒa_d–ay
 &&…_Inp->idr_period <=…_Inp->intra_delay)

819 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, " IntraDelay cannot be†argerhan orƒqualo IDRPeriod.");

820 
	`”rÜ
 (
”rÜ‹xt
, 500);

824 iàÐ
p_IÅ
->
idr_³riod
 > 0 && (p_IÅ->
Numb”BF¿mes
 + 1 +…_IÅ->
šŒa_d–ay
) >…_Inp->idr_period )

826 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, " Setting NumberBFrames = IDRPeriod - 1 - IntraDelay.");

827 
p_IÅ
->
Numb”BF¿mes
 =…_IÅ->
idr_³riod
 - 1 -…_IÅ->
šŒa_d–ay
;

828 iàÐ
p_IÅ
->
Numb”BF¿mes
 < 0 )

830 
p_IÅ
->
Numb”BF¿mes
 =…_IÅ->
idr_³riod
 - 1;

831 
p_IÅ
->
šŒa_d–ay
 = 0;

833 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 )

835 
p_IÅ
->
H›¿rchiÿlCodšg
 = 2;

838 iàÐ
p_IÅ
->
šŒa_³riod
 > 0 && (p_IÅ->
Numb”BF¿mes
 + 1 +…_IÅ->
šŒa_d–ay
) >…_Inp->intra_period )

840 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, " Setting NumberBFrames = IntraPeriod - 1 - IntraDelay.");

841 
p_IÅ
->
Numb”BF¿mes
 =…_IÅ->
šŒa_³riod
 - 1 -…_IÅ->
šŒa_d–ay
;

842 iàÐ
p_IÅ
->
Numb”BF¿mes
 < 0 )

844 
p_IÅ
->
Numb”BF¿mes
 =…_IÅ->
šŒa_³riod
 - 1;

845 
p_IÅ
->
šŒa_d–ay
 = 0;

847 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 )

849 
p_IÅ
->
H›¿rchiÿlCodšg
 = 2;

853 ià(
p_IÅ
->
šŒa_d–ay
 &&…_IÅ->
Numb”BF¿mes
 > 0 &&…_IÅ->
EÇbËO³nGOP
)

854 
p_IÅ
->
PocMemÜyMªagem’t
 = 1;

857 
p_IÅ
->
jumpd
 = (p_IÅ->
Numb”BF¿mes
 + 1è* (p_IÅ->
äame_sk
 + 1) - 1;

860 
	`upd©eOutFÜm©
(
p_IÅ
);

862 iàÐ
p_IÅ
->
SEIVUI32PuÎdown
 &&…_IÅ->
’abË_32_puÎdown
 )

864 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "SEIVUI32Pulldown‡nd Enable32Pulldown cannot be set‡the sameime.");

865 
	`”rÜ
 (
”rÜ‹xt
, 500);

867 iàÐ
p_IÅ
->
SEIVUI32PuÎdown
 )

869 
	`£t_jm_vui_·¿ms
Ð
p_IÅ
 );

872 ià(
p_IÅ
->
no_äames
 == -1)

874 
	`O³nFžes
(&
p_IÅ
->
šput_fže1
);

875 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže1
);

876 
	`Clo£Fžes
(&
p_IÅ
->
šput_fže1
);

879 ià(
p_IÅ
->
no_äames
 < 1)

881 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "NÙƒnough f¿me tØ’cod(%d)", 
p_IÅ
->
no_äames
);

882 
	`”rÜ
 (
”rÜ‹xt
, 500);

886 ià(
p_IÅ
->
IÁ¿Profže
)

888 if(
p_IÅ
->
Numb”BF¿mes
)

890 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Use of B slices‚ot supported with Intra Profiles. Set NumberBFrameso 0.");

891 
	`”rÜ
 (
”rÜ‹xt
, 400);

894 ià(
p_IÅ
->
PocMemÜyMªagem’t
)

896 
	`´štf
("Warning: PocMemoryManagement‚ot supported for Intra Profiles. Process Disabled.\n");

897 
p_IÅ
->
PocMemÜyMªagem’t
 = 0;

899 ià(
p_IÅ
->
Reã»nûReÜd”
)

901 
	`´štf
("Warning: ReferenceReorder‚ot supported for Intra Profiles. Process Disabled.\n");

902 
p_IÅ
->
Reã»nûReÜd”
 = 0;

907 if(
p_IÅ
->
Numb”BF¿mes
 &&…_IÅ->
dœeù_¥©Ÿl_mv_´ed_æag
 !ð
DIR_SPATIAL
 &&…_IÅ->dœeù_¥©Ÿl_mv_´ed_æag !ð
DIR_TEMPORAL
)

909 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "UnsuµÜ‹d dœeù mode=%d, u£ TEMPORAL=0 o¸SPATIAL=1", 
p_IÅ
->
dœeù_¥©Ÿl_mv_´ed_æag
);

910 
	`”rÜ
 (
”rÜ‹xt
, 400);

913 ià(
p_IÅ
->
PicIÁ”Ïû
>0 ||…_IÅ->
MbIÁ”Ïû
>0)

915 ià(
p_IÅ
->
dœeùInã»nûFÏg
==0)

916 
	`´štf
("\nWarning: DirectInferenceFlag seto 1 dueo interlace coding.");

917 
p_IÅ
->
dœeùInã»nûFÏg
 = 1;

920 if(
p_IÅ
->
PicIÁ”Ïû
 > 0 ||…_IÅ->
MbIÁ”Ïû
 > 0)

922 
	`´štf
("\nWarning: WPMCPredicions is seto 0 dueo interlace coding.\n");

923 
p_IÅ
->
WPMCP»cisiÚ
 = 0;

925 #ià
TRACE


926 ià((è
	`¡¾’
 (
p_IÅ
->
T¿ûFže
è> 0 && (
p_Enc
->
p_Œaû
 = 
	`fÝ’
Õ_IÅ->T¿ûFže,"w"))==
NULL
)

928 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³Àfž%s", 
p_IÅ
->
T¿ûFže
);

929 
	`”rÜ
 (
”rÜ‹xt
, 500);

935 ià((
p_IÅ
->
¦iû_mode
 =ð1)&&Õ_IÅ->
MbIÁ”Ïû
 != 0))

937 ià((
p_IÅ
->
¦iû_¬gum’t
 & 0x01)!=0)

939 
	`årštf
 ( 
¡d”r
, "Warning: slice border within macroblock…air. ");

940 ià(
p_IÅ
->
¦iû_¬gum’t
 > 1)

942 
p_IÅ
->
¦iû_¬gum’t
--;

946 
p_IÅ
->
¦iû_¬gum’t
++;

948 
	`årštf
 ( 
¡d”r
, "Usšg %d MB ³¸¦iû.\n", 
p_IÅ
->
¦iû_¬gum’t
);

952 ià(
p_IÅ
->
WPMCP»cisiÚ
 && (p_IÅ->
RDPiùu»DecisiÚ
 !ð1 ||…_IÅ->
G’”©eMuÉËPPS
 != 1) )

954 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "WPMCPrecision„equires both RDPictureDecision=1‡nd GenerateMultiplePPS=1.\n");

955 
	`”rÜ
 (
”rÜ‹xt
, 400);

957 
p_IÅ
->
num_»f_äames_Üg
 =…_IÅ->
num_»f_äames
;

958 
p_IÅ
->
P_Li¡0_»fs_Üg
[0] =…_IÅ->
P_Li¡0_»fs
[0];

959 
p_IÅ
->
B_Li¡0_»fs_Üg
[0] =…_IÅ->
B_Li¡0_»fs
[0];

960 
p_IÅ
->
B_Li¡1_»fs_Üg
[0] =…_IÅ->
B_Li¡1_»fs
[0];

961 
p_IÅ
->
P_Li¡0_»fs_Üg
[1] =…_IÅ->
P_Li¡0_»fs
[1];

962 
p_IÅ
->
B_Li¡0_»fs_Üg
[1] =…_IÅ->
B_Li¡0_»fs
[1];

963 
p_IÅ
->
B_Li¡1_»fs_Üg
[1] =…_IÅ->
B_Li¡1_»fs
[1];

965 ià(
p_IÅ
->
WPMCP»cisiÚ
 &&…_IÅ->
WPMCP»cFuÎRef
 &&…_IÅ->
num_»f_äames
 < 16 )

967 
p_IÅ
->
num_»f_äames
++;

968 iàÐ
p_IÅ
->
P_Li¡0_»fs
[0] )

970 
p_IÅ
->
P_Li¡0_»fs
[0]++;

974 
p_IÅ
->
P_Li¡0_»fs
[0] =…_IÅ->
num_»f_äames
;

976 iàÐ
p_IÅ
->
B_Li¡0_»fs
[0] )

978 
p_IÅ
->
B_Li¡0_»fs
[0]++;

982 
p_IÅ
->
B_Li¡0_»fs
[0] =…_IÅ->
num_»f_äames
;

984 iàÐ
p_IÅ
->
B_Li¡1_»fs
[0] )

986 
p_IÅ
->
B_Li¡1_»fs
[0]++;

990 
p_IÅ
->
B_Li¡1_»fs
[0] =…_IÅ->
num_»f_äames
;

992 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

994 iàÐ
p_IÅ
->
P_Li¡0_»fs
[1] )

996 
p_IÅ
->
P_Li¡0_»fs
[1]++;

1000 
p_IÅ
->
P_Li¡0_»fs
[1] =…_IÅ->
num_»f_äames
;

1002 iàÐ
p_IÅ
->
B_Li¡0_»fs
[1] )

1004 
p_IÅ
->
B_Li¡0_»fs
[1]++;

1008 
p_IÅ
->
B_Li¡0_»fs
[1] =…_IÅ->
num_»f_äames
;

1010 iàÐ
p_IÅ
->
B_Li¡1_»fs
[1] )

1012 
p_IÅ
->
B_Li¡1_»fs
[1]++;

1016 
p_IÅ
->
B_Li¡1_»fs
[1] =…_IÅ->
num_»f_äames
;

1020 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 &&…_IÅ->
WPMCP»cFuÎRef
 )

1022 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "WPMCPrecFullRef„equires NumberReferenceFrames < 16.\n");

1023 
	`”rÜ
 (
”rÜ‹xt
, 400);

1026 ià(
p_IÅ
->
PicIÁ”Ïû
)

1028 ià(
p_IÅ
->
Reã»nûReÜd”
 == 2)

1030 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "ReferenceReorder = 2‡re‚ot supported with fieldƒncoding\n");

1031 
	`”rÜ
 (
”rÜ‹xt
, 400);

1033 ià(
p_IÅ
->
PocMemÜyMªagem’t
 == 2)

1035 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "PocMemoryManagement = 2 is‚ot supported with fieldƒncoding\n");

1036 
	`”rÜ
 (
”rÜ‹xt
, 400);

1040 iàÐ
p_IÅ
->
Reã»nûReÜd”
 &&…_IÅ->
MbIÁ”Ïû
 )

1042 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "ReferenceReorder is‚ot supported with MBAFF\n");

1043 
	`”rÜ
 (
”rÜ‹xt
, 400);

1046 iàÐ
p_IÅ
->
S‘Fœ¡AsLÚgT”m
 && (…_IÅ->
Reã»nûReÜd”
 != 0 ) )

1048 
	`´štf
("SetFirstAsLongTerm is set. ReferenceReorder is‚ot supported‡ndherefore disabled. \n");

1049 
p_IÅ
->
Reã»nûReÜd”
 = 0;

1052 ià(
p_IÅ
->
PocMemÜyMªagem’t
 &&…_IÅ->
MbIÁ”Ïû
 )

1054 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "PocMemoryManagement is‚ot supported with MBAFF\n");

1055 
	`”rÜ
 (
”rÜ‹xt
, 400);

1058 if(
p_IÅ
->
MbIÁ”Ïû
 &&…_IÅ->
RDPiùu»DecisiÚ
 &&…_IÅ->
G’”©eMuÉËPPS
)

1060 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "RDPictureDecision+GenerateMultiplePPS‚ot supported with MBAFF. RDPictureDecisionherefore disabled\n");

1061 
p_IÅ
->
RDPiùu»DecisiÚ
 = 0;

1064 ià((!
p_IÅ
->
rdÝt
)&&Õ_IÅ->
MbIÁ”Ïû
==2))

1066 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "MB AFF is‚ot compatible with‚on-rd-optimized coding.");

1067 
	`”rÜ
 (
”rÜ‹xt
, 500);

1073 iàÐ
p_IÅ
->
NumF¿mesInELSubSeq
 >…_IÅ->
num_»f_äames
 ||…_Inp->NumFramesInELSubSeq < 0 )

1075 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "NumF¿mesInELSubSeq (%dèi ouˆoà¿ng[0,%d).", 
p_IÅ
->
NumF¿mesInELSubSeq
,…_IÅ->
num_»f_äames
);

1076 
	`”rÜ
 (
”rÜ‹xt
, 500);

1079 iàÐ
p_IÅ
->
NumF¿mesInELSubSeq
 > 0 )

1081 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Enhanced GOP is‚ot…roperly supported yet.");

1082 
	`”rÜ
 (
”rÜ‹xt
, 500);

1086 ià((
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
è&&…_IÅ->
S·»Piùu»O±iÚ
 =ð
TRUE
)

1088 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "AFF is‚ot compatible with spare…icture.");

1089 
	`”rÜ
 (
”rÜ‹xt
, 500);

1093 ià(
p_IÅ
->
of_mode
 !ð
PAR_OF_RTP
 &&…_IÅ->
S·»Piùu»O±iÚ
 =ð
TRUE
)

1095 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Only RTP output mode is compatible with spare…icture features.");

1096 
	`”rÜ
 (
”rÜ‹xt
, 500);

1099 ifÐ(
p_IÅ
->
Weigh‹dP»diùiÚ
 > 0 ||…_IÅ->
Weigh‹dB»diùiÚ
 > 0è&& (p_IÅ->
MbIÁ”Ïû
))

1101 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Weighted…rediction coding is‚ot supported for MB AFF currently.");

1102 
	`”rÜ
 (
”rÜ‹xt
, 500);

1104 ifÐ(
p_IÅ
->
Weigh‹dP»diùiÚ
 > 0 ||…_IÅ->
Weigh‹dB»diùiÚ
 > 0è&& (p_IÅ->
yuv_fÜm©
==3))

1106 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Weighted…rediction coding is‚ot supported for 4:4:4ƒncoding.");

1107 
	`”rÜ
 (
”rÜ‹xt
, 500);

1109 iàÐ
p_IÅ
->
NumF¿mesInELSubSeq
 > 0 &&…_IÅ->
Weigh‹dP»diùiÚ
 > 0)

1111 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Enhanced GOP is‚ot supported in weighted…rediction coding mode yet.");

1112 
	`”rÜ
 (
”rÜ‹xt
, 500);

1116 if(
p_IÅ
->
RCEÇbË
)

1118 iàÐ
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 &&

1119 !Ð(
p_IÅ
->
šŒa_³riod
 =ð1 ||…_IÅ->
idr_³riod
 =ð1 ||…_IÅ->
BRefPiùu»s
 =ð2 ) && !p_IÅ->
Numb”BF¿mes
 ) )

1121 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Use RCUpdateMode = 1 only for‡ll intra or‡ll B-slice coding.");

1122 
	`”rÜ
 (
”rÜ‹xt
, 500);

1124 iàÐ(
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_0
 ||…_IÅ->RCUpd©eMod=ð
RC_MODE_2
 ||…_IÅ->RCUpd©eMod=ð
RC_MODE_3
) &&

1125 (
p_IÅ
->
PR•ÏûBSliû
 &&…_IÅ->
Numb”BF¿mes
 ) )

1127 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "PReplaceBSlice is‚ot supported with RCUpdateMode=0,2,3.");

1128 
	`”rÜ
 (
”rÜ‹xt
, 500);

1131 iàÐ
p_IÅ
->
BRefPiùu»s
 =ð2 &&…_IÅ->
šŒa_³riod
 =ð0 &&…_IÅ->
RCUpd©eMode
 !ð
RC_MODE_1
 )

1133 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Use RCUpdateMode = 1 for‡ll B-slice coding.");

1134 
	`”rÜ
 (
”rÜ‹xt
, 500);

1137 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 &&…_IÅ->
RCUpd©eMode
 !ð
RC_MODE_2
 &&…_IÅ->RCUpd©eMod!ð
RC_MODE_3
 )

1139 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Use RCUpdateMode = 2 or 3 for hierarchical B-picture coding.");

1140 
	`”rÜ
 (
”rÜ‹xt
, 500);

1142 iàÐ(
p_IÅ
->
RCUpd©eMode
 !ð
RC_MODE_1
è&& (p_IÅ->
šŒa_³riod
 == 1) )

1144 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Use RCUpdateMode = 1 for‡ll intra coding.");

1145 
	`”rÜ
 (
”rÜ‹xt
, 500);

1149 ià((
p_IÅ
->
Numb”BF¿mes
)&&Õ_IÅ->
BRefPiùu»s
)&&Õ_IÅ->
idr_³riod
)&&Õ_IÅ->
pic_Üd”_út_ty³
!=0))

1151 
	`”rÜ
("Stored B…ictures combined with IDR…ictures only supported in Picture Order Countype 0\n",-1000);

1154 ifÐ!
p_IÅ
->
dœeù_¥©Ÿl_mv_´ed_æag
 &&…_IÅ->
num_»f_äames
<2 &&…_IÅ->
Numb”BF¿mes
 >0)

1155 
	`”rÜ
("temporal direct‚eeds‡t†east 2„ef frames\n",-1000);

1157 #ià(
MVC_EXTENSION_ENABLE
)

1158 ià(
p_IÅ
->
S•V›wIÁ”S—rch
 &&…_IÅ->
S—rchMode
[1] =ð
FAST_FULL_SEARCH
 &&…_IÅ->
MEE¼ÜM‘ric
[
F_PEL
] > 
ERROR_SSE
)

1160 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nOnly SAD‡nd SSE distortion computation supported with Fast Full Search.");

1161 
	`”rÜ
 (
”rÜ‹xt
, 500);

1165 ià(
p_IÅ
->
S—rchMode
[0] =ð
FAST_FULL_SEARCH
 &&…_IÅ->
MEE¼ÜM‘ric
[
F_PEL
] > 
ERROR_SSE
)

1167 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nOnly SAD‡nd SSE distortion computation supported with Fast Full Search.");

1168 
	`”rÜ
 (
”rÜ‹xt
, 500);

1171 ià(
p_IÅ
->
rdÝt
 == 0)

1173 ià(
p_IÅ
->
Di§bËSub³lME
[0] ||…_Inp->DisableSubpelME[1])

1175 ià(
p_IÅ
->
MEE¼ÜM‘ric
[
F_PEL
] !ðp_IÅ->
ModeDecisiÚM‘ric
)

1177 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nLa¡„efšem’ˆËv– (FP–èdi¡ÜtiÚ‚Ùh§ma ModdecisiÚ di¡ÜtiÚ.\nPËa£ upd©MEDi¡ÜtiÚFP– (%dèªd/Ü MDDi¡ÜtiÚ(%d).", 
p_IÅ
->
MEE¼ÜM‘ric
[
F_PEL
],…_IÅ->
ModeDecisiÚM‘ric
);

1178 
	`”rÜ
 (
”rÜ‹xt
, 500);

1181 ià(
p_IÅ
->
MEE¼ÜM‘ric
[
Q_PEL
] !ðp_IÅ->
ModeDecisiÚM‘ric
)

1183 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nLa¡„efšem’ˆËv– (QP–èdi¡ÜtiÚ‚Ùh§ma ModdecisiÚ di¡ÜtiÚ.\nPËa£ upd©MEDi¡ÜtiÚQP– (%dèªd/Ü MDDi¡ÜtiÚ(%d).", 
p_IÅ
->
MEE¼ÜM‘ric
[
Q_PEL
],…_IÅ->
ModeDecisiÚM‘ric
);

1184 
	`”rÜ
 (
”rÜ‹xt
, 500);

1188 if(
p_IÅ
->
T¿nsfÜm8x8Mode
 &&…_IÅ->
¥_³riodic™y
 )

1190 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nThe‚ew 8x8 mode is‚ot implemented for sp-frames.");

1191 
	`”rÜ
 (
”rÜ‹xt
, 500);

1194 ià(
p_IÅ
->
Di§bËIÁ¿4x4
 =ð1 &&…_IÅ->
Di§bËIÁ¿16x16
 =ð1 &&…_IÅ->
EÇbËIPCM
 =ð0 &&…_IÅ->
T¿nsfÜm8x8Mode
 == 0)

1196 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nAt†east one intra…rediction mode‚eedso beƒnabled.");

1197 
	`”rÜ
 (
”rÜ‹xt
, 500);

1200 ià(
p_IÅ
->
Numb”BF¿mes
 && (Õ_IÅ->
BiP»dMÙiÚE¡im©iÚ
è&& (p_IÅ->
£¬ch_¿nge
[0] <…_IÅ->
BiP»dMES—rchRªge
[0])))

1202 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nBiPredMESearchRange must be smaller orƒqual SearchRange.");

1203 
	`”rÜ
 (
”rÜ‹xt
, 500);

1205 #ià(
MVC_EXTENSION_ENABLE
)

1206 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

1208 ià(
p_IÅ
->
Numb”BF¿mes
 && (Õ_IÅ->
BiP»dMÙiÚE¡im©iÚ
è&& (p_IÅ->
£¬ch_¿nge
[1] <…_IÅ->
BiP»dMES—rchRªge
[1])))

1210 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nView1BiPredMESearchRange must be smaller orƒqual View1SearchRange.");

1211 
	`”rÜ
 (
”rÜ‹xt
, 500);

1216 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
)

1218 
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 = 0;

1219 
i
 = 0 ; i < 4; i++)

1220 
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 |ðp_IÅ->
BiP»dS—rch
[
i
];

1224 
i
 = 0 ; i < 4; i++)

1225 
p_IÅ
->
BiP»dS—rch
[
i
] = 0;

1229 iàÐ
p_IÅ
->
ChromaMEEÇbË
 && !Õ_IÅ->
ChromaMCBufãr
) )

1231 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nChromaMCBuffer must be seto 1 if ChromaMEEnable is set.");

1232 
	`”rÜ
 (
”rÜ‹xt
, 500);

1235 iàÐ
p_IÅ
->
ChromaMEEÇbË
 &&…_IÅ->
yuv_fÜm©
 =ð
YUV400
)

1237 
	`årštf
(
¡d”r
, "Warning: ChromaMEEnable cannot be used with monochrome color format, disabling ChromaMEEnable.\n");

1238 
p_IÅ
->
ChromaMEEÇbË
 = 
FALSE
;

1241 iàÐ(
p_IÅ
->
ChromaMCBufãr
 =ð0è&& (Ðp_IÅ->
yuv_fÜm©
 =ð
YUV444
è&& (!p_IÅ->
£·¿‹_cÞour_¶ªe_æag
)) )

1243 
	`årštf
(
¡d”r
, "Warning: Enabling ChromaMCBuffer for 4:4:4 combined color coding.\n");

1244 
p_IÅ
->
ChromaMCBufãr
 = 1;

1247 ià(
p_IÅ
->
EÇbËO³nGOP
 &&…_IÅ->
Reã»nûReÜd”
 != 1)

1249 
	`´štf
("If OpenGOP isƒnabledhan ReferenceReorder is seto 1. \n");

1252 ià(
p_IÅ
->
EÇbËO³nGOP
)

1253 
p_IÅ
->
Reã»nûReÜd”
 = 1;

1255 ià(
p_IÅ
->
S—rchMode
[0] !ð
EPZS


1256 #ià(
MVC_EXTENSION_ENABLE
)

1257 && (!
p_IÅ
->
S•V›wIÁ”S—rch
 ||…_IÅ->
S—rchMode
[1] !ð
EPZS
 )

1260 
p_IÅ
->
EPZSSubP–Grid
 = 0;

1262 ià(
p_IÅ
->
»dundªt_pic_æag
)

1264 ià(
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
)

1266 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Redundant…ictures cannot be used with interlacedools.");

1267 
	`”rÜ
 (
”rÜ‹xt
, 500);

1269 ià(
p_IÅ
->
RDPiùu»DecisiÚ
)

1271 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Redundant…ictures cannot be used with RDPictureDecision.");

1272 
	`”rÜ
 (
”rÜ‹xt
, 500);

1274 ià(
p_IÅ
->
Numb”BF¿mes
)

1276 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Redundant…ictures cannot be used with B frames.");

1277 
	`”rÜ
 (
”rÜ‹xt
, 500);

1279 ià(
p_IÅ
->
Prim¬yGOPL’gth
 < (1 <<…_IÅ->
NumRedundªtH›¿rchy
))

1281 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "PrimaryGOPLength must beƒqual or greaterhan 2^NumRedundantHierarchy.");

1282 
	`”rÜ
 (
”rÜ‹xt
, 500);

1284 ià(
p_IÅ
->
num_»f_äames
 <…_IÅ->
Prim¬yGOPL’gth
)

1286 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "NumberReferenceFrames must be greaterhan orƒqualo PrimaryGOPLength.");

1287 
	`”rÜ
 (
”rÜ‹xt
, 500);

1291 ià(
p_IÅ
->
num_»f_äames
 =ð1 &&…_IÅ->
Numb”BF¿mes
)

1293 
	`årštf
Ð
¡d”r
, "\nWarning: B slices used but only one„eference‡llocated within„eference buffer.\n");

1294 
	`årštf
Ð
¡d”r
, " Performance may be considerably compromised! \n");

1295 
	`årštf
Ð
¡d”r
, " 2 or more„eferences„ecommended for use with B slices.\n");

1297 ià((
p_IÅ
->
H›¿rchiÿlCodšg
 ||…_IÅ->
BRefPiùu»s
è&&…_IÅ->
Numb”BF¿mes
)

1299 
	`årštf
Ð
¡d”r
, "\nWarning: Hierarchical coding or Referenced B slices used.\n");

1300 
	`årštf
Ð
¡d”r
, " Make surehat you have‡llocatedƒnough„eferences\n");

1301 
	`årštf
Ð
¡d”r
, " in„eference buffero‡chieve best…erformance.\n");

1304 ià(
p_IÅ
->
Fa¡MDEÇbË
 == 0)

1306 
p_IÅ
->
Fa¡IÁ¿MD
 = 0;

1307 
p_IÅ
->
Fa¡IÁ¿16x16
 = 0;

1308 
p_IÅ
->
Fa¡IÁ¿4x4
 = 0;

1309 
p_IÅ
->
Fa¡IÁ¿8x8
 = 0;

1310 
p_IÅ
->
Fa¡IÁ¿Chroma
 = 0;

1314 ià(
p_IÅ
->
U£RDOQuªt
 == 1)

1316 ià(
p_IÅ
->
rdÝt
 == 0)

1318 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "RDO Quantization‚ot supported with†ow complexity RDO.");

1319 
	`”rÜ
 (
”rÜ‹xt
, 500);

1322 ià(
p_IÅ
->
MbIÁ”Ïû
 != 0)

1324 
	`´štf
("RDO Quantization currently‚ot supported with MBAFF. Option disabled.\n");

1325 
p_IÅ
->
U£RDOQuªt
 = 0;

1326 
p_IÅ
->
RDOQ_QP_Num
 = 1;

1327 
p_IÅ
->
RDOQ_CP_MV
 = 0;

1328 
p_IÅ
->
RDOQ_CP_Mode
 = 0;

1332 
p_IÅ
->
Ad­tiveRoundšg
 = 0;

1333 
	`´štf
("AdaptiveRounding is disabled when RDO Quantization is used\n");

1334 ià(
p_IÅ
->
RDOQ_QP_Num
 < 2)

1336 
p_IÅ
->
RDOQ_CP_MV
 = 0;

1337 
p_IÅ
->
RDOQ_CP_Mode
 = 0;

1343 
p_IÅ
->
RDOQ_QP_Num
 = 1;

1344 
p_IÅ
->
RDOQ_CP_MV
 = 0;

1345 
p_IÅ
->
RDOQ_CP_Mode
 = 0;

1348 if(
p_IÅ
->
num_¦iû_groups_mšus1
 > 0 && (p_IÅ->
G’”©eMuÉËPPS
 ==1 &&…_IÅ->
RDPiùu»DecisiÚ
 == 1))

1350 
	`´štf
("Warning: Weighted Prediction may‚ot function correctly for multiple slices\n");

1353 #ià
KEEP_B_SAME_LIST


1354 iàÐ
p_IÅ
->
BId’tiÿlLi¡
 > 0 &&…_IÅ->
Reã»nûReÜd”
 != 1 )

1356 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Setwo†ists of B…icture identical can only be used when ReferenceReorder is 1");

1357 
	`”rÜ
 (
”rÜ‹xt
, 500);

1361 #ià
CRA


1362 iàÐ
p_IÅ
->
u£CRA
 =ð1 &&…_IÅ->
šŒa_³riod
 == 0 )

1364 
	`´štf
("Warning: CRA can only be used for IntraPeriod > 0, set CRAo 0\n");

1365 
p_IÅ
->
u£CRA
 = 0;

1367 iàÐ
p_IÅ
->
u£CRA
 =ð1 &&…_IÅ->
LowD–ay
 == 1 )

1369 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "CRA cannot be used when LowDelay is 1");

1370 
	`”rÜ
 (
”rÜ‹xt
, 500);

1372 iàÐ(
p_IÅ
->
u£CRA
 =ð1è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

1374 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "HM5†ike configuration options (CRA) cannot be usedogether with PicInterlace");

1375 
	`”rÜ
 (
”rÜ‹xt
, 500);

1379 #ià
HM50_LIKE_MMCO


1380 iàÐ
p_IÅ
->
HM50RefSŒuùu»
 == 1 )

1382 
	`´štf
("Warning: HM50RefStructure can only be used for„andom‡ccess case with GOP sizeƒqualo 8‡nd HM-5.0 coding order\n");

1383 
	`´štf
(" If it used for other coding structure,he…erformance may†oss\n");

1385 iàÐ
p_IÅ
->
HM50RefSŒuùu»
 =ð1 &&…_IÅ->
Numb”BF¿mes
 != 7 )

1387 
	`´štf
("Warning: HM50RefStructure can only be used for„andom‡ccess case with NumberBFramesƒqualo 7,urn it off\n");

1388 
p_IÅ
->
HM50RefSŒuùu»
 = 0;

1390 iàÐ
p_IÅ
->
HM50RefSŒuùu»
 =ð1 &&…_IÅ->
LowD–ay
 == 1 )

1392 
	`´štf
("Warning: HM50RefStructure cannot be used for†ow delay,urn it off\n");

1393 
p_IÅ
->
HM50RefSŒuùu»
 = 0;

1395 iàÐ(
p_IÅ
->
HM50RefSŒuùu»
 =ð1è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

1397 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "HM5†ike configuration options (HM50RefStructure) cannot be usedogether with PicInterlace");

1398 
	`”rÜ
 (
”rÜ‹xt
, 500);

1402 #ià
LD_REF_SETTING


1403 iàÐ
p_IÅ
->
LDRefS‘tšg
 == 1 )

1405 
	`´štf
("Warning: LDRefSetting can only be used for†ow delay case with GOP sizeƒqualo 4‡nd 4„eference frames‡s HM-5.0†ow delay\n");

1406 
	`´štf
(" If other GOP size or‚umber of„eference frames‡re used,he…erformance may be†oss with LDRefSetting\n");

1408 iàÐ
p_IÅ
->
LDRefS‘tšg
 =ð1 &&…_IÅ->
LowD–ay
 == 0 )

1410 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "LDRefSetting can only be used when LowDelay is 1");

1411 
	`”rÜ
 (
”rÜ‹xt
, 500);

1413 iàÐ(
p_IÅ
->
LDRefS‘tšg
 =ð1è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

1415 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "HM5†ike configuration options (LDRefSetting) cannot be usedogether with PicInterlace");

1416 
	`”rÜ
 (
”rÜ‹xt
, 500);

1419 #ià
B0_MORE_REF


1420 iàÐ(
p_IÅ
->
BLev–0MÜeRef
 =ð1è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

1422 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "HM5†ike configuration options (BLevel0MoreRef) cannot be usedogether with PicInterlace");

1423 
	`”rÜ
 (
”rÜ‹xt
, 500);

1426 #ià
KEEP_B_SAME_LIST


1427 iàÐ(
p_IÅ
->
BId’tiÿlLi¡
 =ð1è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

1429 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "HM5†ike configuration options (BIdenticalList) cannot be usedogether with PicInterlace");

1430 
	`”rÜ
 (
”rÜ‹xt
, 500);

1434 
	`´ofže_check
(
p_IÅ
);

1436 if(!
p_IÅ
->
RDPiùu»DecisiÚ
)

1438 
p_IÅ
->
RDPiùu»MaxPassISliû
 = 1;

1439 
p_IÅ
->
RDPiùu»MaxPassPSliû
 = 1;

1440 
p_IÅ
->
RDPiùu»MaxPassBSliû
 = 1;

1441 
p_IÅ
->
RDPiùu»Deblockšg
 = 0;

1442 
p_IÅ
->
RDPiùu»DœeùMode
 = 0;

1443 
p_IÅ
->
RDPiùu»F¿meQPPSliû
 = 0;

1444 
p_IÅ
->
RDPiùu»F¿meQPBSliû
 = 0;

1446 
	}
}

1455 
	$S‘VUISÿËAndTicks
(
IÅutP¬am‘”s
 *
p_IÅ
, 
äame_¿‹
)

1457 
äame_¿‹_š‹g”
 = ()
	`ûž
Ð
äame_¿‹
 );

1459 iàÐ
äame_¿‹_š‹g”
 !ð
äame_¿‹
 )

1463 
Ãw_äame_¿‹
 = 1.001 * 
äame_¿‹
;

1465 iàÐ
	`dabs
Ð
Ãw_äame_¿‹
 - 
äame_¿‹_š‹g”
 ) < dabsÐ
äame_¿‹
 - frame_rate_integer ) )

1467 
p_IÅ
->
VUI
.
num_un™s_š_tick
 = 1001;

1468 
p_IÅ
->
VUI
.
time_sÿË
 = ()
	`æoÜ
Ð
äame_¿‹_š‹g”
 * (1000 << 1) );

1472 
p_IÅ
->
VUI
.
num_un™s_š_tick
 = 1000;

1473 
p_IÅ
->
VUI
.
time_sÿË
 = ()
	`æoÜ
Ð
äame_¿‹
 * (p_IÅ->VUI.
num_un™s_š_tick
 << 1) + 0.5 );

1479 
p_IÅ
->
VUI
.
num_un™s_š_tick
 = 1000;

1480 
p_IÅ
->
VUI
.
time_sÿË
 = ()
	`æoÜ
Ð
äame_¿‹
 * (p_IÅ->VUI.
num_un™s_š_tick
 << 1) );

1482 
	}
}

	@lencod/src/conformance.c

16 
	~"glob®.h
"

17 
	~"cÚfÜmªû.h
"

21 cÚ¡ 
	gMaxFs
 [] = { 99, 99, 396, 396, 396, 396, 792, 1620, 1620, 3600, 5120, 8192, 8192, 8704, 22080, 36864, 36864, 139264, 139264, 139264, 
UINT_MAX
 };

23 cÚ¡ 
	gMšCR
 [] = { 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 2, 0 };

25 cÚ¡ 
	gMaxBR
 [] = { 64, 128, 192, 384, 768, 2000, 4000, 4000, 10000, 14000, 20000, 20000, 50000, 50000, 135000, 240000, 240000, 240000, 480000, 800000, 
UINT_MAX
 };

27 cÚ¡ 
	gMaxCPB
[] = { 175, 350, 500, 1000, 2000, 2000, 4000, 4000, 10000, 14000, 20000, 25000, 62500, 62500, 135000, 240000, 240000, 240000, 480000, 800000, 
UINT_MAX
 };

30 cÚ¡ 
	gMaxMBPS
[] = { 1485, 1485, 3000, 6000, 11880, 11880, 19800, 20250, 40500, 108000, 216000, 245760, 245760, 522240, 589824, 983040, 2073600, 4177920, 8355840, 16711680, 
UINT_MAX
 };

37 cÚ¡ 
	gLEVELVMVLIMIT
[21][6] =

63 cÚ¡ 
	gLEVELHMVLIMIT
[2][6] =

69 
BoÞ—n
 
	$is_v®id_Ëv–
(
´ofžeIdc
, 
Ëv–Idc
)

72 
Ëv–Idc
)

75  (
	`is_FREXT_´ofže
(
´ofžeIdc
));

99 
	}
}

102 
	$g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

104 
Ëv–_idc
)

109  
LEVEL_1b
;

112  
LEVEL_1
;

115 ià(!
	`is_FREXT_´ofže
(
´ofže_idc
è&& (
cÚ¡¿šed_£t3_æag
 == 0))

116  
LEVEL_1_1
;

118  
LEVEL_1b
;

121  
LEVEL_1_2
;

124  
LEVEL_1_3
;

127  
LEVEL_2
;

130  
LEVEL_2_1
;

133  
LEVEL_2_2
;

136  
LEVEL_3
;

139  
LEVEL_3_1
;

142  
LEVEL_3_2
;

145  
LEVEL_4
;

148  
LEVEL_4_1
;

151  
LEVEL_4_2
;

154  
LEVEL_5
;

157  
LEVEL_5_1
;

160  
LEVEL_5_2
;

163  
LEVEL_6
;

166  
LEVEL_6_1
;

169  
LEVEL_6_2
;

172  
LEVEL_UNCONSTRAINED
;

175 
	`årštf
 ( 
¡d”r
, "Warning: unknown LevelIDC, settingo (mostly) unconstrained\n" );

179 
	}
}

188 
	$g‘MaxFs
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

190 iàÐ!
	`is_v®id_Ëv–
(
´ofže_idc
, 
Ëv–_idc
))

192 
	`”rÜ
 ("getMaxFs: Unknown LevelIdc", 500);

195  
MaxFs
[
	`g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)];

196 
	}
}

204 
	$g‘MaxMBPS
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

206 iàÐ!
	`is_v®id_Ëv–
(
´ofže_idc
, 
Ëv–_idc
))

208 
	`”rÜ
 ("getMaxMBPS: Unknown LevelIdc", 500);

211  
MaxMBPS
[
	`g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)];

212 
	}
}

220 
	$g‘MšCR
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

222 iàÐ!
	`is_v®id_Ëv–
(
´ofže_idc
, 
Ëv–_idc
))

224 
	`”rÜ
 ("getMinCR: Unknown LevelIdc", 500);

227  
MšCR
[
	`g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)];

228 
	}
}

236 
	$g‘MaxBR
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

238 iàÐ!
	`is_v®id_Ëv–
(
´ofže_idc
, 
Ëv–_idc
))

240 
	`”rÜ
 ("getMaxBR: Unknown LevelIdc", 500);

243  
MaxBR
[
	`g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)];

244 
	}
}

252 
	$g‘MaxCPB
 (
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)

254 iàÐ!
	`is_v®id_Ëv–
(
´ofže_idc
, 
Ëv–_idc
))

256 
	`”rÜ
 ("getMaxCPB: Unknown LevelIdc", 500);

259  
MaxCPB
[
	`g‘_Ëv–_šdex
(
´ofže_idc
, 
Ëv–_idc
, 
cÚ¡¿šed_£t3_æag
)];

260 
	}
}

268 
	$´ofže_check
(
IÅutP¬am‘”s
 *
p_IÅ
)

270 if((
p_IÅ
->
ProfžeIDC
 !ð
BASELINE
 ) &&

271 (
p_IÅ
->
ProfžeIDC
 !ð
MAIN
 ) &&

272 (
p_IÅ
->
ProfžeIDC
 !ð
EXTENDED
 ) &&

273 (
p_IÅ
->
ProfžeIDC
 !ð
FREXT_HP
 ) &&

274 (
p_IÅ
->
ProfžeIDC
 !ð
FREXT_Hi10P
 ) &&

275 #ià(
MVC_EXTENSION_ENABLE
)

276 (
p_IÅ
->
ProfžeIDC
 !ð
MULTIVIEW_HIGH
 ) &&

277 (
p_IÅ
->
ProfžeIDC
 !ð
STEREO_HIGH
 ) &&

279 (
p_IÅ
->
ProfžeIDC
 !ð
FREXT_Hi422
 ) &&

280 (
p_IÅ
->
ProfžeIDC
 !ð
FREXT_Hi444
 ) &&

281 (
p_IÅ
->
ProfžeIDC
 !ð
FREXT_CAVLC444
 )&&

282 (
p_IÅ
->
ProfžeIDC
 !ð
NO_PROFILE
))

284 #ià(
MVC_EXTENSION_ENABLE
)

285 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Profile must be in\n\n 66 (Baseline),\n 77 (Main),\n 88 (Extended),\n 100 (High),\n 110 (High 10 or High 10 Intra)\n"

288 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Profile must be in\n\n 66 (Baseline),\n 77 (Main),\n 88 (Extended),\n 100 (High),\n 110 (High 10 or High 10 Intra)\n"

291 
	`”rÜ
 (
”rÜ‹xt
, 500);

293 ià(
p_IÅ
->
ProfžeIDC
 =ð
NO_PROFILE
)

295 
	`´štf
("WARNING: ProfileIDCƒqualo 0 disables…rofile checking. \nThis‡llowsƒxperimental coding, but will create‚on-conforming streams!\n");

299 ià((
p_IÅ
->
·¹™iÚ_mode
è&& (p_IÅ->
symbÞ_mode
==
CABAC
))

301 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Data…artitioning‡nd CABAC is‚ot supported in‡ny…rofile.");

302 
	`”rÜ
 (
”rÜ‹xt
, 500);

305 ià(
p_IÅ
->
»dundªt_pic_æag
)

307 ià(
p_IÅ
->
ProfžeIDC
 !ð
BASELINE
)

309 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Redundant…ictures‡re only‡llowed in Baseline…rofile (ProfileIDC = 66).");

310 
	`”rÜ
 (
”rÜ‹xt
, 500);

314 ià((
p_IÅ
->
·¹™iÚ_mode
è&& (p_IÅ->
ProfžeIDC
!=
EXTENDED
))

316 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Data…artitioning is only‡llowed in Extended…rofile (ProfileIDC = 88).");

317 
	`”rÜ
 (
”rÜ‹xt
, 500);

320 ià(
p_IÅ
->
ChromaIÁ¿Di§bË
 &&…_IÅ->
Fa¡CrIÁ¿DecisiÚ
)

322 
	`årštf
Ð
¡d”r
, "\n Warning: ChromaIntraDisable‡nd FastCrIntraDecision cannot be combinedogether.\n Using only Chroma Intra DC mode.\n");

323 
p_IÅ
->
Fa¡CrIÁ¿DecisiÚ
=0;

326 ià((
p_IÅ
->
¥_³riodic™y
è&& (p_IÅ->
ProfžeIDC
 !ð
EXTENDED
 ))

328 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "SP…ictures‡re only‡llowed in Extended…rofile (ProfileIDC = 88).");

329 
	`”rÜ
 (
”rÜ‹xt
, 500);

333 ià(
p_IÅ
->
ProfžeIDC
 =ð
BASELINE
 )

335 ià((
p_IÅ
->
Numb”BF¿mes
 ||…_IÅ->
BRefPiùu»s
==2è&&…_IÅ->
PR•ÏûBSliû
 == 0)

337 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "B slices‡re‚ot‡llowed in Baseline…rofile (ProfileIDC = 66).");

338 
	`”rÜ
 (
”rÜ‹xt
, 500);

340 ià(
p_IÅ
->
Weigh‹dP»diùiÚ
)

342 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Weighted…rediction is‚ot‡llowed in Baseline…rofile (ProfileIDC = 66).");

343 
	`”rÜ
 (
”rÜ‹xt
, 500);

345 ià(
p_IÅ
->
Weigh‹dB»diùiÚ
)

347 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Weighted…rediction is‚ot‡llowed in Baseline…rofile (ProfileIDC = 66).");

348 
	`”rÜ
 (
”rÜ‹xt
, 500);

350 ià(
p_IÅ
->
symbÞ_mode
 =ð
CABAC
)

352 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "CABAC is‚ot‡llowed in Baseline…rofile (ProfileIDC = 66).");

353 
	`”rÜ
 (
”rÜ‹xt
, 500);

355 ià((
p_IÅ
->
PicIÁ”Ïû
è||Õ_IÅ->
MbIÁ”Ïû
))

357 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Interlaceools‡re‚ot‡llowed in Baseline…rofile (ProfileIDC = 66).");

358 
	`”rÜ
 (
”rÜ‹xt
, 500);

360 ià(
p_IÅ
->
G’”©eMuÉËPPS
 != 0)

362 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "GenerateMultiplePPS is‚ot supported for Baseline…rofile because it„equiresƒnabling Weighted…rediction.\n");

363 
	`”rÜ
 (
”rÜ‹xt
, 400);

368 ià(
p_IÅ
->
ProfžeIDC
 =ð
MAIN
 )

370 ià(
p_IÅ
->
num_¦iû_groups_mšus1
)

372 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "num_slice_groups_minus1>0 (FMO) is‚ot‡llowed in Main…rofile (ProfileIDC = 77).");

373 
	`”rÜ
 (
”rÜ‹xt
, 500);

378 ià(
p_IÅ
->
ProfžeIDC
 =ð
EXTENDED
 )

380 ià(!
p_IÅ
->
dœeùInã»nûFÏg
)

382 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "direct_8x8_inference flag must beƒqualo 1 in Extended…rofile (ProfileIDC = 88).");

383 
	`”rÜ
 (
”rÜ‹xt
, 500);

386 ià(
p_IÅ
->
symbÞ_mode
 =ð
CABAC
)

388 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "CABAC is‚ot‡llowed in Extended…rofile (ProfileIDC = 88).");

389 
	`”rÜ
 (
”rÜ‹xt
, 500);

394 iàÐ
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 )

396 ifÐ
p_IÅ
->
yuv_fÜm©
!=3 )

398 
	`årštf
Ð
¡d”r
, "\nWarning: SeparateColourPlane has onlyƒffect in 4:4:4 chroma mode (YUVFormat=3),\n disabling SeparateColourPlane.");

399 
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 = 0;

402 iàÐ
p_IÅ
->
ChromaMEEÇbË
 )

404 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nChromaMEEnable is‚ot‡llowed when SeparateColourPlane isƒnabled.");

405 
	`”rÜ
 (
”rÜ‹xt
, 500);

410 iàÐ
p_IÅ
->
ProfžeIDC
 =ð
FREXT_CAVLC444
 )

412 iàÐ
p_IÅ
->
symbÞ_mode
 !ð
CAVLC
 )

414 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nCABAC is‚ot‡llowed in CAVLC 4:4:4 Intra…rofile (ProfileIDC = 44).");

415 
	`”rÜ
 (
”rÜ‹xt
, 500);

417 iàÐ!
p_IÅ
->
IÁ¿Profže
 )

419 
	`årštf
 (
¡d”r
, "\nWarning: ProfileIDCƒqualo 44 implies‡n Intra only…rofile, setting IntraProfile = 1.");

420 
p_IÅ
->
IÁ¿Profže
 = 1;

425 ià(
p_IÅ
->
IÁ¿Profže
 && ( !
	`is_FREXT_´ofže
Õ_IÅ->
ProfžeIDC
)))

427 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nIntraProfile is‡llowed only with FRExt…rofiles.");

428 
	`”rÜ
 (
”rÜ‹xt
, 500);

431 ià(
p_IÅ
->
IÁ¿Profže
 && !p_IÅ->
idr_³riod
)

433 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nIntraProfile„equires IDRPeriod >= 1.");

434 
	`”rÜ
 (
”rÜ‹xt
, 500);

437 ià(
p_IÅ
->
IÁ¿Profže
 &&…_IÅ->
šŒa_³riod
 != 1)

439 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nIntraProfile„equires IntraPeriodƒqual 1.");

440 
	`”rÜ
 (
”rÜ‹xt
, 500);

443 ià(
p_IÅ
->
IÁ¿Profže
 &&…_IÅ->
num_»f_äames
)

445 
	`årštf
Ð
¡d”r
, "\nWarning: Setting NumberReferenceFrameso 0 in IntraProfile.");

446 
p_IÅ
->
num_»f_äames
 = 0;

449 ià(
p_IÅ
->
IÁ¿Profže
 =ð0 &&…_IÅ->
num_»f_äames
 == 0)

451 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nProfiles otherhan IntraProfile„equire NumberReferenceFrames > 0.");

452 
	`”rÜ
 (
”rÜ‹xt
, 500);

455 if(
p_IÅ
->
T¿nsfÜm8x8Mode
 && ( !
	`is_FREXT_´ofže
 (p_IÅ->
ProfžeIDC
)))

457 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nTransform8x8Mode may be used only with FRExt…rofiles.");

458 
	`”rÜ
 (
”rÜ‹xt
, 500);

461 if(
p_IÅ
->
SÿlšgM©rixP»£ÁFÏg
 && ( !
	`is_FREXT_´ofže
Õ_IÅ->
ProfžeIDC
) ))

463 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nScalingMatrixPresentFlag may be used only with FRExt…rofiles.");

464 
	`”rÜ
 (
”rÜ‹xt
, 500);

467 if(
p_IÅ
->
yuv_fÜm©
==
YUV422
 && (…_IÅ->
ProfžeIDC
 !ð
FREXT_Hi422
 &&…_IÅ->ProfžeIDC !=
FREXT_Hi444
 &&…_IÅ->ProfžeIDC!=
FREXT_CAVLC444
 ))

469 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nFRExˆProfže(YUV FÜm©èE¼Ü!\nYUV422 cª bu£d oÆy w™h ProfžeIDC %d o¸%d o¸%d\n",
FREXT_Hi422
, 
FREXT_Hi444
, 
FREXT_CAVLC444
);

470 
	`”rÜ
 (
”rÜ‹xt
, 500);

472 if(
p_IÅ
->
yuv_fÜm©
==
YUV444
 && (…_IÅ->
ProfžeIDC
 !ð
FREXT_Hi444
 &&…_IÅ->ProfžeIDC!=
FREXT_CAVLC444
 ))

474 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nFRExˆProfže(YUV FÜm©èE¼Ü!\nYUV444 cª bu£d oÆy w™h ProfžeIDC %d o¸%d.\n",
FREXT_Hi444
, 
FREXT_CAVLC444
);

475 
	`”rÜ
 (
”rÜ‹xt
, 500);

479 ià(
p_IÅ
->
rdÝt
==2 && ( 
	`is_FREXT_´ofže
Õ_IÅ->
ProfžeIDC
)))

481 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Fast Mode Decision methods‚ot supported in FREX Profiles");

482 
	`”rÜ
 (
”rÜ‹xt
, 500);

485 #ià(
MVC_EXTENSION_ENABLE
)

486 ifÐ
	`is_MVC_´ofže
(
p_IÅ
->
ProfžeIDC
è&&…_IÅ->
num_of_v›ws
 != 2)

488 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "NumberOfViews must bewo if ProfileIDC is seto 118 (Multiview High Profile). Otherwise (for‡ single view)…lease select‡‚on-multiview…rofile such‡s 100.");

489 
	`”rÜ
 (
”rÜ‹xt
, 500);

498 if(
p_IÅ
->
MVCIÁ”V›wReÜd”
)

500 iàÐ!
	`is_MVC_´ofže
(
p_IÅ
->
ProfžeIDC
) )

502 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "ProfileIDC must be 118, 128, 134, or 135o use MVCInterViewReorder=1.");

503 
	`”rÜ
 (
”rÜ‹xt
, 500);

506 iàÐ
	`is_MVC_´ofže
(
p_IÅ
->
ProfžeIDC
) )

508 ià(
p_IÅ
->
Reã»nûReÜd”
 > 1)

510 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "ReferenceReorder > 1 is‚ot supported withhe Multiview (118) or Stereo High (128)…rofiles‡nd isherefore disabled. \n");

511 
p_IÅ
->
Reã»nûReÜd”
 = 0;

513 iàÐ(
p_IÅ
->
PocMemÜyMªagem’t
è&& (p_IÅ->
PicIÁ”Ïû
 > 0) )

515 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "PocMemoryManagement>0 is‚ot supported withhe Multiview (118) or Stereo High (128)…rofiles‡nd isherefore disabled. \n");

516 
p_IÅ
->
PocMemÜyMªagem’t
 = 0;

520 ià(
p_IÅ
->
of_mode
 =ð
PAR_OF_RTP
 && ( 
	`is_MVC_´ofže
Ðp_IÅ->
ProfžeIDC
 ) ))

522 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "RTP output mode is‚ot compatible with MVC…rofiles.");

523 
	`”rÜ
 (
”rÜ‹xt
, 500);

528 
	}
}

536 
	$Ëv–_check
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

538 
PicSizeInMbs
 = ( (
p_IÅ
->
ouut
.
width
[0] + 
p_Vid
->
auto_üÝ_right
è* (p_IÅ->ouut.
height
[0] +…_Vid->
auto_üÝ_bÙtom
) ) >> 8;

539 
MBProûssšgR©e
 = (è(
PicSizeInMbs
 * 
p_IÅ
->
ouut
.
äame_¿‹
 + 0.5);

540 
ýbBrFaùÜ
 = ( 
p_IÅ
->
ProfžeIDC
 >ð
FREXT_HP
 ) ? 1500 : 1200;

542 ià(
p_IÅ
->
Lev–IDC
 == 0)

544 
	`´štf
("WARNING: LevelIDCƒqualo 0 disables†evel checking. \nThis‡llowsƒxperimental coding, but will create‚on-conforming streams!\n");

548 ià(!
	`is_v®id_Ëv–
((
p_IÅ
)->
ProfžeIDC
, (p_IÅ)->
Lev–IDC
))

550 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nSpecified LevelIDC value is undefined. Please check your settings.\n");

551 
	`”rÜ
 (
”rÜ‹xt
, 500);

554 iàÐ(
p_IÅ
->
Lev–IDC
>=30è&& (p_IÅ->
dœeùInã»nûFÏg
==0))

556 
	`årštf
Ð
¡d”r
, "\nWarning: LevelIDC 3.0‡nd‡bove„equire direct_8x8_inferenceo be seto 1. Please check your settings.\n");

557 
p_IÅ
->
dœeùInã»nûFÏg
=1;

559 iàÐ((
p_IÅ
->
Lev–IDC
<21è|| (p_IÅ->Lev–IDC>41)è&& (p_IÅ->
PicIÁ”Ïû
 > 0 ||…_IÅ->
MbIÁ”Ïû
 > 0) )

561 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nInterlace modes only supported for LevelIDC inhe„ange of 21‡nd 41. Please check your settings.\n");

562 
	`”rÜ
 (
”rÜ‹xt
, 500);

565 iàÐ
PicSizeInMbs
 > 
	`g‘MaxFs
(
p_IÅ
->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0) )

567 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nPicSizeInMb exûed maximum‡Îowed siz© s³cif›d Lev–Idø%.1f\n", (è
p_IÅ
->
Lev–IDC
 / 10.0);

568 
	`”rÜ
 (
”rÜ‹xt
, 500);

571 ià(
p_IÅ
->
IÁ¿Profže
 && (
PicSizeInMbs
 > 1620è&&…_IÅ->
¦iû_mode
 != 1)

573 
	`”rÜ
 ("\nIntraProfile with PicSizeInMbs > 1620„equires SliceModeƒqual 1.", 500);

576 ià(
p_IÅ
->
IÁ¿Profže
 && (
PicSizeInMbs
 > 1620è&& ((í_IÅ->
¦iû_¬gum’t
 > ( 
	`g‘MaxFs
Õ_IÅ->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0) >> 2 ) ) )

579 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nIÁ¿Profž»quœe SliûArgum’ˆsm®Ë¸Üƒqu®Ø1/4 MaxF © s³cif›d Lev–Idø%d.", 
p_IÅ
->
Lev–IDC
);

580 
	`”rÜ
 (
”rÜ‹xt
, 500);

583 iàÐ
MBProûssšgR©e
 > 
	`g‘MaxMBPS
(
p_IÅ
->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0) )

585 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nMB Processing Rate (%d)ƒxceeds maximum‡llowed…rocessing„ate (%d)‡t specified LevelIdc %.1f\n",

586 
MBProûssšgR©e
, 
	`g‘MaxMBPS
(
p_IÅ
->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0), ()…_Inp->LevelIDC / 10.0);

587 
	`”rÜ
 (
”rÜ‹xt
, 500);

590 iàÐ
p_IÅ
->
b™_¿‹
 > ()(
ýbBrFaùÜ
 * 
	`g‘MaxBR
Õ_IÅ->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0)) )

592 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "\nBit Rate (%d)ƒxceeds maximum‡llowed bit„ate (%d)‡t specified LevelIdc %.1f for NAL HRD\n",

593 
p_IÅ
->
b™_¿‹
, 
ýbBrFaùÜ
 * 
	`g‘MaxBR
Õ_IÅ->
ProfžeIDC
,…_IÅ->
Lev–IDC
, 0), ()…_Inp->LevelIDC / 10.0);

594 
	`”rÜ
 (
”rÜ‹xt
, 500);

596 
	}
}

604 
	$upd©e_mv_lim™s
(
VideoP¬am‘”s
 *
p_Vid
, 
by‹
 
is_f›ld
)

606 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

607 
	`memýy
(
p_Vid
->
MaxVmvR
, 
LEVELVMVLIMIT
[p_Vid->
Lev–Index
], 6 * ());

608 
	`memýy
(
p_Vid
->
MaxHmvR
, 
LEVELHMVLIMIT
[p_Vid->
Lev–Index
<17 ? 0 : 1], 6 * ());

609 ià(
is_f›ld
)

611 
i
;

612 
i
 = 0; i < 6; i++)

613 
p_Vid
->
MaxVmvR
[
i
] = 
	`rshiá_ºd
(p_Vid->MaxVmvR[i], 1);

615 ià(
p_IÅ
->
U£MVLim™s
)

617 
p_Vid
->
MaxVmvR
[0] = 
	`imax
Õ_Vid->MaxVmvR[0], -(
p_IÅ
->
S‘MVYLim™
));

618 
p_Vid
->
MaxVmvR
[1] = 
	`imš
Õ_Vid->MaxVmvR[1], (
p_IÅ
->
S‘MVYLim™
));

619 
p_Vid
->
MaxVmvR
[2] = 
	`imax
Õ_Vid->MaxVmvR[2], -(
p_IÅ
->
S‘MVYLim™
 << 1));

620 
p_Vid
->
MaxVmvR
[3] = 
	`imš
Õ_Vid->MaxVmvR[3], (
p_IÅ
->
S‘MVYLim™
 << 1));

621 
p_Vid
->
MaxVmvR
[4] = 
	`imax
Õ_Vid->MaxVmvR[4], -(
p_IÅ
->
S‘MVYLim™
 << 2));

622 
p_Vid
->
MaxVmvR
[5] = 
	`imš
Õ_Vid->MaxVmvR[5], (
p_IÅ
->
S‘MVYLim™
 << 2));

624 
p_Vid
->
MaxHmvR
[0] = 
	`imax
Õ_Vid->MaxHmvR[0], -(
p_IÅ
->
S‘MVXLim™
));

625 
p_Vid
->
MaxHmvR
[1] = 
	`imš
Õ_Vid->MaxHmvR[1], (
p_IÅ
->
S‘MVXLim™
));

626 
p_Vid
->
MaxHmvR
[2] = 
	`imax
Õ_Vid->MaxHmvR[2], -(
p_IÅ
->
S‘MVXLim™
 << 1));

627 
p_Vid
->
MaxHmvR
[3] = 
	`imš
Õ_Vid->MaxHmvR[3], (
p_IÅ
->
S‘MVXLim™
 << 1));

628 
p_Vid
->
MaxHmvR
[4] = 
	`imax
Õ_Vid->MaxHmvR[4], -(
p_IÅ
->
S‘MVXLim™
 << 2));

629 
p_Vid
->
MaxHmvR
[5] = 
	`imš
Õ_Vid->MaxHmvR[5], (
p_IÅ
->
S‘MVXLim™
 << 2));

631 
	}
}

640 
	$þ_mv_¿nge
(
VideoP¬am‘”s
 *
p_Vid
, 
£¬ch_¿nge
, 
MÙiÚVeùÜ
 *
mv
, 
»s
)

642 
»s
 <<= 1;

644 
mv
->
mv_x
 = (è
	`iCl3
Ð
p_Vid
->
MaxHmvR
[0 + 
»s
] + 
£¬ch_¿nge
,…_Vid->MaxHmvR[1 +„es] - search_range, mv->mv_x);

645 
mv
->
mv_y
 = (è
	`iCl3
Ð
p_Vid
->
MaxVmvR
[0 + 
»s
] + 
£¬ch_¿nge
,…_Vid->MaxVmvR[1 +„es] - search_range, mv->mv_y);

646 
	}
}

654 
	$‹¡_þ_mvs
(
VideoP¬am‘”s
 *
p_Vid
, 
MÙiÚVeùÜ
 *
mv
, 
BoÞ—n
 
wr™e_mb
)

656 ià((
mv
->
mv_x
 < 
p_Vid
->
MaxHmvR
[4]è|| (mv->mv_x >…_Vid->MaxHmvR[5]è|| (mv->
mv_y
 <…_Vid->
MaxVmvR
[4]) || (mv->mv_y >…_Vid->MaxVmvR[5]))

658 ià(
wr™e_mb
 =ð
TRUE
)

659 
	`´štf
("W¬nšg MV (%d %dèw”ouˆoà¿ngx(%d %dèy(%d %d). Clpšg mv befÜwr™šg\n", 
mv
->
mv_x
, mv->
mv_y
, 
p_Vid
->
MaxHmvR
[4],…_Vid->MaxHmvR[5],…_Vid->
MaxVmvR
[4],…_Vid->MaxVmvR[5]);

660 
mv
->
mv_x
 = (è
	`iCl3
Ð
p_Vid
->
MaxHmvR
[4],…_Vid->MaxHmvR[5], mv->mv_x);

661 
mv
->
mv_y
 = (è
	`iCl3
Ð
p_Vid
->
MaxVmvR
[4],…_Vid->MaxVmvR[5], mv->mv_y);

663 
	}
}

671 
	$out_of_bounds_mvs
(
VideoP¬am‘”s
 *
p_Vid
, cÚ¡ 
MÙiÚVeùÜ
 *
mv
)

673  ((
mv
->
mv_x
 < 
p_Vid
->
MaxHmvR
[4]è|| (mv->mv_x >…_Vid->MaxHmvR[5]è|| (mv->
mv_y
 <…_Vid->
MaxVmvR
[4]) || (mv->mv_y >…_Vid->MaxVmvR[5]));

674 
	}
}

676 
	$Inv®idWeightsFÜBiP»diùiÚ
(
Sliû
 *
cu¼Sliû
, 
Block8x8Info
* 
b8x8šfo
, 
mode
)

678 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
cu¼Sliû
->active_sps;

679 
cur_blk
, 
cur_comp
;

680 
be¡8x8l0»f
, 
be¡8x8l1»f
;

681 
weight_sum
 = 0;

682 
šv®id_mode
 = 0;

683 *
wbp0
, *
wbp1
;

684 
cur_blk
 = 0; cur_blk < 4; cur_blk ++)

686 ià(
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
pdœ
 == 2)

688 
be¡8x8l0»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_0
];

689 
be¡8x8l1»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_1
];

690 
wbp0
 = &
cu¼Sliû
->
wbp_weight
[
LIST_0
][
be¡8x8l0»f
][
be¡8x8l1»f
][0];

691 
wbp1
 = &
cu¼Sliû
->
wbp_weight
[
LIST_1
][
be¡8x8l0»f
][
be¡8x8l1»f
][0];

693 
cur_comp
 = 0; cur_com°< (
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV400
 ? 1 : 3) ; cur_comp ++)

695 
weight_sum
 = *
wbp0
++ + *
wbp1
++;

697 ià(
weight_sum
 < -128 || weight_sum > 127)

699 
šv®id_mode
 = 1;

703 ià(
šv®id_mode
 == 1)

707  
šv®id_mode
;

708 
	}
}

710 
	$Inv®idMÙiÚVeùÜs
(
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 *
cu¼Sliû
, 
Block8x8Info
* 
b8x8šfo
, 
mode
)

712 
cur_blk
;

713 
l0»f
, 
l1»f
;

714 
šv®id_mode
 = 0;

715 
i
, 
j
;

717 ià(
mode
 > 
P8x8
)

718  
šv®id_mode
;

721 
cur_blk
 = 0; cur_blk < 4; cur_blk ++)

723 
i
 = (
cur_blk
 & 0x01) << 1;

724 
j
 = (
cur_blk
 >> 1) << 1;

725 
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
pdœ
)

728 
l0»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_0
];

729 ià(
	`out_of_bounds_mvs
(
p_Vid
, &
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0»f
][
mode
][
j
][
i
]))

731 
šv®id_mode
 = 1;

732  
šv®id_mode
;

736 
l1»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_1
];

737 ià(
	`out_of_bounds_mvs
(
p_Vid
, &
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1»f
][
mode
][
j
][
i
]))

739 
šv®id_mode
 = 1;

740  
šv®id_mode
;

744 
l0»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_0
];

745 
l1»f
 = (è
b8x8šfo
->
be¡
[
mode
][
cur_blk
].
»f
[
LIST_1
];

746 ià(
	`out_of_bounds_mvs
(
p_Vid
, &
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0»f
][
mode
][
j
][
i
]))

748 
šv®id_mode
 = 1;

749  
šv®id_mode
;

751 ià(
	`out_of_bounds_mvs
(
p_Vid
, &
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1»f
][
mode
][
j
][
i
]))

753 
šv®id_mode
 = 1;

754  
šv®id_mode
;

762  
šv®id_mode
;

763 
	}
}

765 
BoÞ—n
 
	$CheckP»diùiÚP¬ams
(
Maüoblock
 *
cu¼MB
, 
Block8x8Info
 *
b8x8šfo
, 
mode
)

767 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

769 ià(
mode
 =ð
P8x8
 && 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 =ð
TRUE
)

771 
i
;

773 
i
 = 0; i < 4; i++)

775 ià(
b8x8šfo
->
be¡
[
P8x8
][
i
].
mode
 != 4 && b8x8info->best[P8x8][i].mode != 0)

777  
FALSE
;

782 ià(
	`Inv®idMÙiÚVeùÜs
(
cu¼Sliû
->
p_Vid
, cu¼Sliû, 
b8x8šfo
, 
mode
))

783  
FALSE
;

785 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

788 ià(
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1 && 
mode
 < 
P8x8
)

790 ià(
	`Inv®idWeightsFÜBiP»diùiÚ
(
cu¼Sliû
, 
b8x8šfo
, 
mode
))

791  
FALSE
;

795 ià(
mode
==0)

797 
i
, 
j
;

798 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4;j++)

800 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

802 ià(
cu¼Sliû
->
dœeù_pdœ
[
j
][
i
] < 0)

803  
FALSE
;

810  
TRUE
;

811 
	}
}

	@lencod/src/context_ini.c

16 
	#CONTEXT_INI_C


	)

18 
	~<m©h.h
>

20 
	~"glob®.h
"

22 
	~"ùx_bËs.h
"

23 
	~"bŸr›ncode.h
"

24 
	~"mem®loc.h
"

26 
	#DEFAULT_CTX_MODEL
 0

	)

27 
	#RELIABLE_COUNT
 32.0

	)

28 
	#FRAME_TYPES
 4

	)

29 
	#FIXED
 0

	)

32 cÚ¡ 
	g´obabž™›s
[64] =

44 
	$ü—‹_cÚ‹xt_memÜy
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

46 
k
;

47 
num_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

48 
log2
 = 
	`log
(2.0);

50 
p_Vid
->
num_mb_³r_¦iû
 = (
p_IÅ
->
¦iû_mode
 =ð1 ?…_IÅ->
¦iû_¬gum’t
 : 
num_mb
);

51 
p_Vid
->
numb”_of_¦iûs
 = (
num_mb
 +…_Vid->
num_mb_³r_¦iû
 - 1) /…_Vid->num_mb_per_slice;

52 
	`g‘_mem3Dšt
(&
p_Vid
->
š™Ÿlized
, 3, 
FRAME_TYPES
,…_Vid->
numb”_of_¦iûs
);

54 
	`mem£t
(&
p_Vid
->
š™Ÿlized
[0][0][0], 0, 3 * 
FRAME_TYPES
 *…_Vid->
numb”_of_¦iûs
 * ());

55 
	`g‘_mem3Dšt
(&
p_Vid
->
mod–Numb”
, 3, 
FRAME_TYPES
,…_Vid->
numb”_of_¦iûs
);

58  
k
=0; k<64; k++ )

60 
p_Vid
->
´obabž™y
[
k
 + 64] = 
´obabž™›s
[k];

61 
p_Vid
->
´obabž™y
[
k
] = 1.0 - 
´obabž™›s
[63 - k];

62 
p_Vid
->
’ŒÝy
 [
k
] = 
	`log
Ðp_Vid->
´obabž™y
[ k] ) / 
log2
;

63 
p_Vid
->
’ŒÝy
[127-
k
] = 
	`log
Ð
´obabž™›s
[63 - k] ) / 
log2
;

64 
p_Vid
->
’Üm
 [
k
] =…_Vid->
’ŒÝy
[k] -…_Vid->entropy[127-k];

65 
p_Vid
->
’Üm
[127 - 
k
] = -p_Vid->enorm[k];

67 
	}
}

69 
	$ä“_cÚ‹xt_memÜy
 (
VideoP¬am‘”s
 *
p_Vid
)

71 
	`ä“_mem3Dšt
(
p_Vid
->
š™Ÿlized
);

72 
	`ä“_mem3Dšt
(
p_Vid
->
mod–Numb”
);

73 
	}
}

75 
	#BIARI_CTX_INIT2
(
qp
, 
ii
,
jj
,
ùx
,
b
è\

	)

77 
	gi
=0; i<
	gii
; i++) \

78 
	gj
=0; j<
	gjj
; j++) \

80 
bŸri_š™_cÚ‹xt
 (
qp
, &(
ùx
[
i
][
j
]), &(
b
[i][j][0])); \

85 
šlše
 
	$bš¬y_cÚ‹xt_š™1
(
qp
, 
jj
, 
BiCÚ‹xtTy³
 *
ùx
, cÚ¡ 
bË
[][2])

87 
j
;

88 
j
=0; j<
jj
; j++)

90 
	`bŸri_š™_cÚ‹xt
 (
qp
, &(
ùx
[
j
]), &(
bË
[j][0]));

92 
	}
}

94 
šlše
 
	$bš¬y_cÚ‹xt_š™2
(
qp
, 
ii
, 
jj
, 
BiCÚ‹xtTy³
 
ùx
[][11], cÚ¡ 
bË
[][11][2])

96 
i
, 
j
;

97 
i
 = 0; i < 
ii
; i++)

99 
j
 = 0; j < 
jj
; j++)

101 
	`bŸri_š™_cÚ‹xt
 (
qp
, &(
ùx
[
i
][
j
]), &(
bË
[i][j][0]));

104 
	}
}

106 
	$S‘CtxMod–Numb”
 (
Sliû
 *
cu¼Sliû
)

108 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

109 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

111 
äame_f›ld
 = 
p_Vid
->
f›ld_piùu»
;

112 
img_ty³
 = 
cu¼Sliû
->
¦iû_ty³
;

113 
ùx_numb”
 = 
cu¼Sliû
->
¡¬t_mb_Ä
 / 
p_Vid
->
num_mb_³r_¦iû
;

115 if(
img_ty³
 =ð
I_SLICE
)

117 
cu¼Sliû
->
mod–_numb”
=
DEFAULT_CTX_MODEL
;

121 if(
p_IÅ
->
cÚ‹xt_š™_m‘hod
==
FIXED
)

123 
cu¼Sliû
->
mod–_numb”
 = 
p_IÅ
->model_number;

127 ià(
p_Vid
->
š™Ÿlized
 [
äame_f›ld
][
img_ty³
][
ùx_numb”
])

129 
cu¼Sliû
->
mod–_numb”
 = 
p_Vid
->
mod–Numb”
[
äame_f›ld
][
img_ty³
][
ùx_numb”
];

131 ià(
ùx_numb”
 && 
p_Vid
->
š™Ÿlized
[
äame_f›ld
][
img_ty³
][ctx_number-1])

133 
cu¼Sliû
->
mod–_numb”
 = 
p_Vid
->
mod–Numb”
[
äame_f›ld
][
img_ty³
][
ùx_numb”
-1];

137 
cu¼Sliû
->
mod–_numb”
 = 
DEFAULT_CTX_MODEL
;

139 
	}
}

141 
	$š™_cÚ‹xts
 (
Sliû
 *
cu¼Sliû
)

143 
MÙiÚInfoCÚ‹xts
* 
mc
 = 
cu¼Sliû
->
mÙ_ùx
;

144 
Textu»InfoCÚ‹xts
* 
tc
 = 
cu¼Sliû
->
‹x_ùx
;

145 
mod–_numb”
 = 
cu¼Sliû
->model_number;

146 
qp
 = 
	`imax
(0, 
cu¼Sliû
->qp);

147 
i
, 
j
;

149 ià((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
))

152 
	`BIARI_CTX_INIT2
 (
qp
, 3, 
NUM_MB_TYPE_CTX
, 
mc
->
mb_ty³_cÚ‹xts
, 
INIT_MB_TYPE_I
[
mod–_numb”
]);

155 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_TRANSFORM_SIZE_CTX
, 
tc
->
ŒªsfÜm_size_cÚ‹xts
, 
INIT_TRANSFORM_SIZE_I
[
mod–_numb”
][0]);

156 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_IPR_CTX
, 
tc
->
r_cÚ‹xts
, 
INIT_IPR_I
[
mod–_numb”
][0]);

157 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_CIPR_CTX
, 
tc
->
cr_cÚ‹xts
, 
INIT_CIPR_I
[
mod–_numb”
][0]);

158 
	`BIARI_CTX_INIT2
 (
qp
, 3, 
NUM_CBP_CTX
, 
tc
->
cbp_cÚ‹xts
, 
INIT_CBP_I
[
mod–_numb”
]);

159 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_BCBP_CTX
, 
tc
->
bcbp_cÚ‹xts
, 
INIT_BCBP_I
[
mod–_numb”
]);

160 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_DELTA_QP_CTX
, 
tc
->
d–_qp_cÚ‹xts
,
INIT_DELTA_QP_I
[
mod–_numb”
][0]);

161 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[0], 
INIT_MAP_I
[
mod–_numb”
]);

162 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[0], 
INIT_LAST_I
[
mod–_numb”
]);

163 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_ONE_CTX
, 
tc
->
Úe_cÚ‹xts
, 
INIT_ONE_I
[
mod–_numb”
]);

164 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_ABS_CTX
, 
tc
->
abs_cÚ‹xts
, 
INIT_ABS_I
[
mod–_numb”
]);

165 #ià
ENABLE_FIELD_CTX


166 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_MB_AFF_CTX
, 
tc
->
mb_aff_cÚ‹xts
, 
INIT_MB_AFF_I
[
mod–_numb”
][0]);

167 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[1], 
INIT_FLD_MAP_I
[
mod–_numb”
]);

168 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[1], 
INIT_FLD_LAST_I
[
mod–_numb”
]);

174 
	`BIARI_CTX_INIT2
 (
qp
, 3, 
NUM_MB_TYPE_CTX
, 
mc
->
mb_ty³_cÚ‹xts
, 
INIT_MB_TYPE_P
[
mod–_numb”
]);

175 
	`BIARI_CTX_INIT2
 (
qp
, 2, 
NUM_B8_TYPE_CTX
, 
mc
->
b8_ty³_cÚ‹xts
, 
INIT_B8_TYPE_P
[
mod–_numb”
]);

176 
	`BIARI_CTX_INIT2
 (
qp
, 2, 
NUM_MV_RES_CTX
, 
mc
->
mv_»s_cÚ‹xts
, 
INIT_MV_RES_P
[
mod–_numb”
]);

177 
	`BIARI_CTX_INIT2
 (
qp
, 2, 
NUM_REF_NO_CTX
, 
mc
->
»f_no_cÚ‹xts
, 
INIT_REF_NO_P
[
mod–_numb”
]);

180 
	`bš¬y_cÚ‹xt_š™1
(
qp
, 
NUM_TRANSFORM_SIZE_CTX
, 
tc
->
ŒªsfÜm_size_cÚ‹xts
, 
INIT_TRANSFORM_SIZE_P
[
mod–_numb”
][0]);

181 
	`bš¬y_cÚ‹xt_š™1
(
qp
, 
NUM_IPR_CTX
, 
tc
->
r_cÚ‹xts
, 
INIT_IPR_P
[
mod–_numb”
][0]);

182 
	`bš¬y_cÚ‹xt_š™1
(
qp
, 
NUM_CIPR_CTX
, 
tc
->
cr_cÚ‹xts
, 
INIT_CIPR_P
[
mod–_numb”
][0]);

183 
	`BIARI_CTX_INIT2
 (
qp
, 3, 
NUM_CBP_CTX
, 
tc
->
cbp_cÚ‹xts
, 
INIT_CBP_P
[
mod–_numb”
]);

184 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_BCBP_CTX
, 
tc
->
bcbp_cÚ‹xts
, 
INIT_BCBP_P
[
mod–_numb”
]);

185 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_DELTA_QP_CTX
, 
tc
->
d–_qp_cÚ‹xts
,
INIT_DELTA_QP_P
[
mod–_numb”
][0]);

186 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[0], 
INIT_MAP_P
[
mod–_numb”
]);

187 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[0], 
INIT_LAST_P
[
mod–_numb”
]);

188 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_ONE_CTX
, 
tc
->
Úe_cÚ‹xts
, 
INIT_ONE_P
[
mod–_numb”
]);

189 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_ABS_CTX
, 
tc
->
abs_cÚ‹xts
, 
INIT_ABS_P
[
mod–_numb”
]);

190 #ià
ENABLE_FIELD_CTX


191 
	`bš¬y_cÚ‹xt_š™1
 (
qp
, 
NUM_MB_AFF_CTX
, 
tc
->
mb_aff_cÚ‹xts
, 
INIT_MB_AFF_P
[
mod–_numb”
][0]);

192 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[1], 
INIT_FLD_MAP_P
[
mod–_numb”
]);

193 
	`BIARI_CTX_INIT2
 (
qp
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[1], 
INIT_FLD_LAST_P
[
mod–_numb”
]);

196 
	}
}

199 
	$XR©e
 (
VideoP¬am‘”s
 *
p_Vid
, 
BiCÚ‹xtTy³PŒ
 
ùx
, cÚ¡ * 
mod–
)

201 
ùx_¡©e
, 
mod_¡©e
;

202 
weight
, 
xr
 = 0.0;

203 
qp
 = 
	`imax
(0, 
p_Vid
->qp);

205 
weight
 = 
	`dmš
 (1.0, ()
ùx
->
couÁ
/()
RELIABLE_COUNT
);

207 
mod_¡©e
 = ((
mod–
[0]*
qp
)>>4)+model[1];

208 
mod_¡©e
 = 
	`iCl3
(0, 127, mod_state);

209 
ùx_¡©e
 = (
ùx
->
MPS
 ? 64 + ctx->
¡©e
 : 63 - ctx->state);

211 
xr
 -ð
weight
 * (
p_Vid
->
´obabž™y
[
ùx_¡©e
] *…_Vid->
’Üm
[
mod_¡©e
] +…_Vid->
’ŒÝy
[127 - mod_state]);

213  
xr
;

214 
	}
}

228 
	#ADD_XRATE2
(
p_Vid
, 
ii
,
jj
,
ùx
,
b
è\

	)

230 
	gi
=0; i<
	gii
; i++) \

231 
	gj
=0; j<
	gjj
; j++) \

233 
	gxr
 +ð
XR©e
 (
p_Vid
, &(
ùx
[
i
][
j
]), &(
b
[i][j][0])); \

237 
	#ADD_XRATE1
(
p_Vid
, 
jj
,
ùx
,
b
è\

	)

239 
	gj
=0; j<
	gjj
; j++) \

241 
	gxr
 +ð
XR©e
 (
p_Vid
, &(
ùx
[
j
]), &(
b
[j][0])); \

245 
	$G‘CtxMod–Numb”
 (
Sliû
 *
cu¼Sliû
, * 
mnumb”
, 
MÙiÚInfoCÚ‹xts
* 
mc
, 
Textu»InfoCÚ‹xts
* 
tc
)

247 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

248 
mod–
, 
j
, 
i
;

249 
xr
, 
mš_xr
 = 1e30;

251 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
)

253 
mod–
 = 0; mod– < 
NUM_CTX_MODELS_I
; model++)

255 
xr
 = 0.0;

257 
	`ADD_XRATE2
 (
p_Vid
, 3, 
NUM_MB_TYPE_CTX
, 
mc
->
mb_ty³_cÚ‹xts
, 
INIT_MB_TYPE_I
 [
mod–
]);

260 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_TRANSFORM_SIZE_CTX
, 
tc
->
ŒªsfÜm_size_cÚ‹xts
, 
INIT_TRANSFORM_SIZE_I
[
mod–
][0]);

261 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_IPR_CTX
, 
tc
->
r_cÚ‹xts
, 
INIT_IPR_I
 [
mod–
][0]);

262 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_CIPR_CTX
, 
tc
->
cr_cÚ‹xts
, 
INIT_CIPR_I
[
mod–
][0]);

263 
	`ADD_XRATE2
 (
p_Vid
, 3, 
NUM_CBP_CTX
, 
tc
->
cbp_cÚ‹xts
, 
INIT_CBP_I
 [
mod–
]);

264 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_BCBP_CTX
, 
tc
->
bcbp_cÚ‹xts
, 
INIT_BCBP_I
[
mod–
]);

265 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_DELTA_QP_CTX
, 
tc
->
d–_qp_cÚ‹xts
, 
INIT_DELTA_QP_I
[
mod–
][0]);

266 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[0], 
INIT_MAP_I
 [
mod–
]);

267 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[0], 
INIT_LAST_I
[
mod–
]);

268 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_ONE_CTX
, 
tc
->
Úe_cÚ‹xts
, 
INIT_ONE_I
 [
mod–
]);

269 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_ABS_CTX
, 
tc
->
abs_cÚ‹xts
, 
INIT_ABS_I
 [
mod–
]);

270 #ià
ENABLE_FIELD_CTX


271 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_MB_AFF_CTX
, 
tc
->
mb_aff_cÚ‹xts
, 
INIT_MB_AFF_I
 [
mod–
][0]);

272 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[1], 
INIT_FLD_MAP_I
 [
mod–
]);

273 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[1], 
INIT_FLD_LAST_I
[
mod–
]);

276 ià(
xr
 < 
mš_xr
)

278 
mš_xr
 = 
xr
;

279 *
mnumb”
 = 
mod–
;

285 
mod–
=0; mod–<
NUM_CTX_MODELS_P
; model++)

287 
xr
 = 0.0;

289 
	`ADD_XRATE2
 (
p_Vid
, 3, 
NUM_MB_TYPE_CTX
, 
mc
->
mb_ty³_cÚ‹xts
, 
INIT_MB_TYPE_P
 [
mod–
]);

290 
	`ADD_XRATE2
 (
p_Vid
, 2, 
NUM_B8_TYPE_CTX
, 
mc
->
b8_ty³_cÚ‹xts
, 
INIT_B8_TYPE_P
 [
mod–
]);

291 
	`ADD_XRATE2
 (
p_Vid
, 2, 
NUM_MV_RES_CTX
, 
mc
->
mv_»s_cÚ‹xts
, 
INIT_MV_RES_P
 [
mod–
]);

292 
	`ADD_XRATE2
 (
p_Vid
, 2, 
NUM_REF_NO_CTX
, 
mc
->
»f_no_cÚ‹xts
, 
INIT_REF_NO_P
 [
mod–
]);

295 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_TRANSFORM_SIZE_CTX
, 
tc
->
ŒªsfÜm_size_cÚ‹xts
, 
INIT_TRANSFORM_SIZE_P
[
mod–
][0]);

296 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_IPR_CTX
, 
tc
->
r_cÚ‹xts
, 
INIT_IPR_P
 [
mod–
][0]);

297 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_CIPR_CTX
, 
tc
->
cr_cÚ‹xts
, 
INIT_CIPR_P
 [
mod–
][0]);

298 
	`ADD_XRATE2
 (
p_Vid
, 3, 
NUM_CBP_CTX
, 
tc
->
cbp_cÚ‹xts
, 
INIT_CBP_P
 [
mod–
]);

299 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_BCBP_CTX
, 
tc
->
bcbp_cÚ‹xts
, 
INIT_BCBP_P
 [
mod–
]);

300 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_DELTA_QP_CTX
, 
tc
->
d–_qp_cÚ‹xts
, 
INIT_DELTA_QP_P
[
mod–
][0]);

301 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[0], 
INIT_MAP_P
 [
mod–
]);

302 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[0], 
INIT_LAST_P
 [
mod–
]);

303 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_ONE_CTX
, 
tc
->
Úe_cÚ‹xts
, 
INIT_ONE_P
 [
mod–
]);

304 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_ABS_CTX
, 
tc
->
abs_cÚ‹xts
, 
INIT_ABS_P
 [
mod–
]);

305 #ià
ENABLE_FIELD_CTX


306 
	`ADD_XRATE1
 (
p_Vid
, 
NUM_MB_AFF_CTX
, 
tc
->
mb_aff_cÚ‹xts
, 
INIT_MB_AFF_P
 [
mod–
][0]);

307 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_MAP_CTX
, 
tc
->
m­_cÚ‹xts
[1], 
INIT_FLD_MAP_P
 [
mod–
]);

308 
	`ADD_XRATE2
 (
p_Vid
, 
NUM_BLOCK_TYPES
, 
NUM_LAST_CTX
, 
tc
->
Ï¡_cÚ‹xts
[1], 
INIT_FLD_LAST_P
 [
mod–
]);

311 ià(
xr
 < 
mš_xr
)

313 
mš_xr
 = 
xr
;

314 *
mnumb”
 = 
mod–
;

318 
	}
}

320 #undeà
ADD_XRATE2


321 #undeà
ADD_XRATE1


324 
	$¡Üe_cÚ‹xts
 (
Sliû
 *
cu¼Sliû
)

326 ifÐ
cu¼Sliû
->
p_IÅ
->
cÚ‹xt_š™_m‘hod
 )

328 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

329 
äame_f›ld
 = 
p_Vid
->
f›ld_piùu»
;

330 
img_ty³
 = 
cu¼Sliû
->
¦iû_ty³
;

331 
ùx_numb”
 = 
cu¼Sliû
->
¡¬t_mb_Ä
 / 
p_Vid
->
num_mb_³r_¦iû
;

333 
p_Vid
->
š™Ÿlized
 [
äame_f›ld
][
img_ty³
][
ùx_numb”
] = 1;

334 
	`G‘CtxMod–Numb”
 (
cu¼Sliû
, 
p_Vid
->
mod–Numb”
[
äame_f›ld
][
img_ty³
] + 
ùx_numb”
, cu¼Sliû->
mÙ_ùx
, cu¼Sliû->
‹x_ùx
);

340 
	}
}

343 
	$upd©e_f›ld_äame_cÚ‹xts
 (
VideoP¬am‘”s
 *
p_Vid
, 
f›ld
)

345 
i
, 
j
;

347 ià(
f›ld
)

350 
j
=0; j<
FRAME_TYPES
; j++)

352 
i
=0; i<
p_Vid
->
numb”_of_¦iûs
; i++)

354 
p_Vid
->
š™Ÿlized
 [0][
j
][
i
] =…_Vid->initialized [1][j][i>>1];

355 
p_Vid
->
mod–Numb”
[0][
j
][
i
] =…_Vid->modelNumber[1][j][i>>1];

362 
j
=0; j<
FRAME_TYPES
; j++)

364 
i
=0; i<((
p_Vid
->
numb”_of_¦iûs
+1)>>1); i++)

366 
p_Vid
->
š™Ÿlized
 [1][
j
][
i
] =…_Vid->initialized [0][j][i<<1];

367 
p_Vid
->
mod–Numb”
[1][
j
][
i
] =…_Vid->modelNumber[0][j][i<<1];

371 
	}
}

	@lencod/src/errdo.c

24 
	~"glob®.h
"

25 
	~"mem®loc.h
"

26 
	~"»fbuf.h
"

27 
	~"image.h
"

28 
	~"md_commÚ.h
"

29 
	~"”rdo.h
"

30 
	~"”rdo_di¡_mhyp.h
"

38 
	$®loÿ‹_”rdo_mem
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

40 
memÜy_size
 = 0;

43 
p_Vid
->
p_decs
 = (
Decod”s
 *è
	`m®loc
((Decoders));

44 
memÜy_size
 +ð
	`g‘_mem3Dšt
(&
p_Vid
->
p_decs
->
»s_img
, 
MAX_PLANE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

45 
memÜy_size
 +ð
	`g‘_mem3Dšt
(&
p_Vid
->
p_decs
->
»s_mb_be¡8x8
, 
MAX_PLANE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

47 
p_Vid
->
p_decs
->
RCD_be¡Y_mb
 = 
NULL
;

48 
p_Vid
->
p_decs
->
RCD_be¡Y_b8x8
 = 
NULL
;

49 
p_Vid
->
p_decs
->
MVCD_be¡Y_mb
 = 
NULL
;

50 
p_Vid
->
p_decs
->
MVCD_be¡Y_b8x8
 = 
NULL
;

51 
p_Vid
->
p_decs
->
æag_be¡Y_mb
 = 
NULL
;

52 
p_Vid
->
p_decs
->
æag_be¡Y_b8x8
 = 
NULL
;

53 
p_Vid
->
p_decs
->
æag_wo_»s
 = 
NULL
;

54 
p_Vid
->
p_decs
->
æag_wo_»s_be¡Y_b8x8
 = 
NULL
;

55 
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_mb
 = 
NULL
;

56 
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_b8x8
 = 
NULL
;

57 
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s
 = 
NULL
;

58 
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s_be¡Y_b8x8
 = 
NULL
;

59 
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_mb
 = 
NULL
;

60 
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_b8x8
 = 
NULL
;

61 
p_Vid
->
p_decs
->
Œªs_”r_wo_»s
 = 
NULL
;

62 
p_Vid
->
p_decs
->
Œªs_”r_wo_»s_be¡Y_b8x8
 = 
NULL
;

63 
p_Vid
->
p_decs
->
dec_mb_´ed
 = 
NULL
;

64 
p_Vid
->
p_decs
->
dec_mbY_be¡
 = 
NULL
;

65 
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
 = 
NULL
;

66 
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
 = 
NULL
;

67 
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_mb
 = 
NULL
;

68 
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_b8x8
 = 
NULL
;

69 
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed_be¡Y_b8x8
 = 
NULL
;

70 
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed
 = 
NULL
;

71 
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_mb
 = 
NULL
;

72 
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_b8x8
 = 
NULL
;

73 
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed_be¡Y_b8x8
 = 
NULL
;

74 
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed
 = 
NULL
;

77 
p_IÅ
->
de
)

79 
LLN
:

81 
memÜy_size
 +ð
	`g‘_mem3D³l
(&
p_Vid
->
p_decs
->
dec_mb_´ed
, 
p_IÅ
->
NoOfDecod”s
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

82 
memÜy_size
 +ð
	`g‘_mem3D³l
(&
p_Vid
->
p_decs
->
dec_mbY_be¡
, 
p_IÅ
->
NoOfDecod”s
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

83 
memÜy_size
 +ð
	`g‘_mem4D³l
(&
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
, 2, 
p_IÅ
->
NoOfDecod”s
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

84 
memÜy_size
 +ð
	`g‘_mem4D³l
(&
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
, 2, 
p_IÅ
->
NoOfDecod”s
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

89  
memÜy_size
;

90 
	}
}

98 
	$ä“_”rdo_mem
(
VideoP¬am‘”s
 *
p_Vid
)

101 ià(
p_Vid
->
p_decs
->
»s_img
)

103 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
»s_img
);

104 
p_Vid
->
p_decs
->
»s_img
 = 
NULL
;

106 ià(
p_Vid
->
p_decs
->
»s_mb_be¡8x8
)

108 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
»s_mb_be¡8x8
);

109 
p_Vid
->
p_decs
->
»s_mb_be¡8x8
 = 
NULL
;

113 ià(
p_Vid
->
p_decs
->
RCD_be¡Y_mb
)

115 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
RCD_be¡Y_mb
);

116 
p_Vid
->
p_decs
->
RCD_be¡Y_mb
 = 
NULL
;

118 ià(
p_Vid
->
p_decs
->
RCD_be¡Y_b8x8
)

120 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
RCD_be¡Y_b8x8
);

121 
p_Vid
->
p_decs
->
RCD_be¡Y_b8x8
 = 
NULL
;

123 ià(
p_Vid
->
p_decs
->
MVCD_be¡Y_mb
)

125 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
MVCD_be¡Y_mb
);

126 
p_Vid
->
p_decs
->
MVCD_be¡Y_mb
 = 
NULL
;

128 ià(
p_Vid
->
p_decs
->
MVCD_be¡Y_b8x8
)

130 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
MVCD_be¡Y_b8x8
);

131 
p_Vid
->
p_decs
->
MVCD_be¡Y_b8x8
 = 
NULL
;

133 ià(
p_Vid
->
p_decs
->
æag_be¡Y_mb
)

135 
	`ä“_mem2D
(
p_Vid
->
p_decs
->
æag_be¡Y_mb
);

136 
p_Vid
->
p_decs
->
æag_be¡Y_mb
 = 
NULL
;

138 ià(
p_Vid
->
p_decs
->
æag_be¡Y_b8x8
)

140 
	`ä“_mem3D
(
p_Vid
->
p_decs
->
æag_be¡Y_b8x8
);

141 
p_Vid
->
p_decs
->
æag_be¡Y_b8x8
 = 
NULL
;

143 ià(
p_Vid
->
p_decs
->
æag_wo_»s
)

145 
	`ä“_mem2D
(
p_Vid
->
p_decs
->
æag_wo_»s
);

146 
p_Vid
->
p_decs
->
æag_wo_»s
 = 
NULL
;

148 ià(
p_Vid
->
p_decs
->
æag_wo_»s_be¡Y_b8x8
)

150 
	`ä“_mem3D
(
p_Vid
->
p_decs
->
æag_wo_»s_be¡Y_b8x8
);

151 
p_Vid
->
p_decs
->
æag_wo_»s_be¡Y_b8x8
 = 
NULL
;

153 ià(
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_mb
)

155 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_mb
);

156 
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_mb
 = 
NULL
;

158 ià(
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_b8x8
)

160 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_b8x8
);

161 
p_Vid
->
p_decs
->
Œªs_di¡_be¡Y_b8x8
 = 
NULL
;

163 ià(
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s
)

165 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s
);

166 
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s
 = 
NULL
;

168 ià(
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s_be¡Y_b8x8
)

170 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s_be¡Y_b8x8
);

171 
p_Vid
->
p_decs
->
Œªs_di¡_wo_»s_be¡Y_b8x8
 = 
NULL
;

173 ià(
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_mb
)

175 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_mb
);

176 
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_mb
 = 
NULL
;

178 ià(
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_b8x8
)

180 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_b8x8
);

181 
p_Vid
->
p_decs
->
Œªs_”r_be¡Y_b8x8
 = 
NULL
;

183 ià(
p_Vid
->
p_decs
->
Œªs_”r_wo_»s
)

185 
	`ä“_mem2Dšt
(
p_Vid
->
p_decs
->
Œªs_”r_wo_»s
);

186 
p_Vid
->
p_decs
->
Œªs_”r_wo_»s
 = 
NULL
;

188 ià(
p_Vid
->
p_decs
->
Œªs_”r_wo_»s_be¡Y_b8x8
)

190 
	`ä“_mem3Dšt
(
p_Vid
->
p_decs
->
Œªs_”r_wo_»s_be¡Y_b8x8
);

191 
p_Vid
->
p_decs
->
Œªs_”r_wo_»s_be¡Y_b8x8
 = 
NULL
;

195 ià(
p_Vid
->
p_decs
->
dec_mb_´ed
)

197 
	`ä“_mem3D³l
(
p_Vid
->
p_decs
->
dec_mb_´ed
);

198 
p_Vid
->
p_decs
->
dec_mb_´ed
 = 
NULL
;

200 ià(
p_Vid
->
p_decs
->
dec_mbY_be¡
)

202 
	`ä“_mem3D³l
(
p_Vid
->
p_decs
->
dec_mbY_be¡
);

203 
p_Vid
->
p_decs
->
dec_mbY_be¡
 = 
NULL
;

205 ià(
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
)

207 
	`ä“_mem4D³l
(
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
);

208 
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
 = 
NULL
;

210 ià(
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
)

212 
	`ä“_mem4D³l
(
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
);

213 
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
 = 
NULL
;

217 ià(
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_mb
)

219 
	`ä“_mem2D³l
(
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_mb
);

220 
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_mb
 = 
NULL
;

222 ià(
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_b8x8
)

224 
	`ä“_mem3D³l
(
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_b8x8
);

225 
p_Vid
->
p_decs
->
fœ¡_mom’t_be¡Y_b8x8
 = 
NULL
;

227 ià(
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed_be¡Y_b8x8
)

229 
	`ä“_mem3D³l
(
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed_be¡Y_b8x8
);

230 
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed_be¡Y_b8x8
 = 
NULL
;

232 ià(
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed
)

234 
	`ä“_mem2D³l
(
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed
);

235 
p_Vid
->
p_decs
->
fœ¡_mom’t_´ed
 = 
NULL
;

237 ià(
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_mb
)

239 
	`ä“_mem2Dušt16
(
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_mb
);

240 
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_mb
 = 
NULL
;

242 ià(
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_b8x8
)

244 
	`ä“_mem3Dušt16
(
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_b8x8
);

245 
p_Vid
->
p_decs
->
£cÚd_mom’t_be¡Y_b8x8
 = 
NULL
;

247 ià(
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed_be¡Y_b8x8
)

249 
	`ä“_mem3Dušt16
(
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed_be¡Y_b8x8
);

250 
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed_be¡Y_b8x8
 = 
NULL
;

252 ià(
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed
)

254 
	`ä“_mem2Dušt16
(
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed
);

255 
p_Vid
->
p_decs
->
£cÚd_mom’t_´ed
 = 
NULL
;

258 
	`ä“_poš‹r
Ð
p_Vid
->
p_decs
 );

259 
	}
}

270 
	$š™_”rÜ_cÚû®
(
VideoP¬am‘”s
 *
p_Vid
, 
cÚû®m’t_ty³
)

272 
p_Vid
->
”rÜ_cÚû®_piùu»
 = 
cÝy_cÚû®_piùu»
;

273 
	}
}

282 
StÜabËPiùu»
* 
	$fšd_Ã¬e¡_»f_piùu»
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
poc
)

284 
i
;

285 
mš_poc_diff
 = 1000;

286 
poc_diff
;

287 
StÜabËPiùu»
* 
»fPic
 = 
NULL
;

289 
i
 = 0; i < 
p_Dpb
->
»f_äames_š_bufãr
; i++)

291 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3)

293 ià((
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

295 
poc_diff
 = 
	`Ÿbs
(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 -…oc);

296 ià(
poc_diff
 < 
mš_poc_diff
)

298 
»fPic
 = 
p_Dpb
->
fs_»f
[
i
]->
äame
;

299 
mš_poc_diff
 = 
poc_diff
;

304  
»fPic
;

305 
	}
}

313 
	$”rdo_compu‹_»sidue
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
imgY
, **
»s_img
, img³È**
mb_´ed
, 
b8block
, 
block_size
)

315 
i
,
j
;

316 
i0
 = (
b8block
 & 0x01)<<3, 
i1
 = i0+
block_size
;

317 
j0
 = (
b8block
 >> 1)<<3, 
j1
 = j0+
block_size
;

319 
i
 = 
i0
; i < 
i1
; i++)

321 
j
 = 
j0
; j < 
j1
; j++)

323 
»s_img
[
j
][
i
] = ()
imgY
[j][
cu¼MB
->
pix_x
 + i] - 
mb_´ed
[j][i];

326 
	}
}

341 
	$”rdo_¡Üe_be¡_b8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
, 
block
)

343 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

344 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

346 
p_IÅ
->
de
)

348 
LLN
:

349 
	`”rdo_¡Üe_be¡_block_muÉihyp
(
p_IÅ
, 
p_Vid
->
p_decs
->
dec_mbY_be¡8x8
[
ŒªsfÜm8x8
],…_Vid->
’c_piùu»
->
de_mem
->
p_dec_img
[0], 
block
, 
cu¼MB
->
pix_x
, cu¼MB->
pix_y
, 
BLOCK_SIZE_8x8
);

350 
	`”rdo_¡Üe_be¡_block_muÉihyp
(
p_IÅ
, 
p_Vid
->
p_decs
->
dec_mb_´ed_be¡8x8
[
ŒªsfÜm8x8
],…_Vid->p_decs->
dec_mb_´ed
, 
block
, 0, 0, 
BLOCK_SIZE_8x8
);

355 
	}
}

371 
	$”rdo_g‘_be¡_b8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
, 
block
)

373 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

374 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

376 
p_IÅ
->
de
)

378 
LLN
:

379 
	`”rdo_g‘_be¡_block_muÉihyp
(
cu¼MB
, 
p_Vid
->
’c_piùu»
->
de_mem
->
p_dec_img
[0],…_Vid->
p_decs
->
dec_mbY_be¡8x8
[
ŒªsfÜm8x8
], 
block
, 
BLOCK_SIZE_8x8
);

385 
	}
}

398 
	$”rdo_¡Üe_be¡_MB
(
Maüoblock
 *
cu¼MB
)

400 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

401 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

403 
p_IÅ
->
de
)

405 
LLN
:

406 
	`”rdo_¡Üe_be¡_block_muÉihyp
(
p_IÅ
, 
p_Vid
->
p_decs
->
dec_mbY_be¡
,…_Vid->
’c_piùu»
->
de_mem
->
p_dec_img
[0], 0, 
cu¼MB
->
pix_x
, cu¼MB->
pix_y
, 
MB_BLOCK_SIZE
);

411 
	}
}

424 
	$”rdo_g‘_be¡_MB
(
Maüoblock
 *
cu¼MB
)

426 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

427 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

429 
p_IÅ
->
de
)

431 
LLN
:

432 
	`”rdo_g‘_be¡_block_muÉihyp
(
cu¼MB
, 
p_Vid
->
’c_piùu»
->
de_mem
->
p_dec_img
[0],…_Vid->
p_decs
->
dec_mbY_be¡
, 0, 
MB_BLOCK_SIZE
);

438 
	}
}

451 
	$”rdo_g‘_be¡_P8x8
(
Maüoblock
 *
cu¼MB
, 
ŒªsfÜm8x8
)

453 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

454 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

456 
p_IÅ
->
de
)

458 
LLN
:

459 ià(
p_Vid
->
p_decs
->
»c_ty³
 == 0)

461 
	`”rdo_g‘_be¡_block_muÉihyp
(
cu¼MB
, 
p_Vid
->
’c_piùu»
->
de_mem
->
p_dec_img
[0],…_Vid->
p_decs
->
dec_mb_´ed_be¡8x8
[
ŒªsfÜm8x8
], 0, 
MB_BLOCK_SIZE
);

465 
	`”rdo_g‘_be¡_block_muÉihyp
(
cu¼MB
, 
p_Vid
->
’c_piùu»
->
de_mem
->
p_dec_img
[0],…_Vid->
p_decs
->
dec_mbY_be¡8x8
[
ŒªsfÜm8x8
], 0, 
MB_BLOCK_SIZE
);

471 
	}
}

481 
	$š™_di¡ÜtiÚ_e¡im©iÚ
(
VideoP¬am‘”s
 *
p_Vid
, 
de_®gÜ™hm
)

483 
de_®gÜ™hm
)

485 
LLN
:

486 
p_Vid
->
e¡im©e_di¡ÜtiÚ
 = 
”rdo_di¡ÜtiÚ_e¡im©iÚ_muÉihyp
;

491 
	}
}

501 
	$”rdo_®loc_¡ÜabË_piùu»
(
StÜabËPiùu»
 *
p
, 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
size_x
, 
size_y
, 
size_x_ü
, 
size_y_ü
)

503 
Di¡_E¡m
 *
s
;

504 
dec
, 
ndec
, 
ÅÏÃ
;

506 
p
->
de_mem
 = (
Di¡_E¡m
 *)
	`m®loc
( (Dist_Estm) );

507 
s
 = 
p
->
de_mem
;

509 
s
->
»s_cÚ_diff_Y
 = 
NULL
;

510 
s
->
»s_cÚ_diff_UV
 = 
NULL
;

511 
s
->
MV_cÚ_diff_Y
 = 
NULL
;

512 
s
->
MV_cÚ_diff_UV
 = 
NULL
;

513 
s
->
”rÜ_sign_æag_Y
 = 
NULL
;

514 
s
->
”rÜ_sign_æag_UV
 = 
NULL
;

515 
s
->
ŒªsmissiÚ_di¡_Y
 = 
NULL
;

516 
s
->
ŒªsmissiÚ_di¡_UV
 = 
NULL
;

517 
s
->
ŒªsmissiÚ_”r_Y
 = 
NULL
;

518 
s
->
ŒªsmissiÚ_”r_UV
 = 
NULL
;

519 
s
->
dec_imgY
 = 
NULL
;

520 
s
->
dec_imgUV
 = 
NULL
;

521 
s
->
mb_”rÜ_m­
 = 
NULL
;

522 
s
->
fœ¡_mom’t_Y
 = 
NULL
;

523 
s
->
fœ¡_mom’t_UV
 = 
NULL
;

524 
s
->
£cÚd_mom’t_Y
 = 
NULL
;

525 
s
->
£cÚd_mom’t_UV
 = 
NULL
;

526 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

528 
s
->
p_»s_cÚ_diff
[
ÅÏÃ
] = 
NULL
;

529 
s
->
p_MV_cÚ_diff
[
ÅÏÃ
] = 
NULL
;

530 
s
->
p_”rÜ_sign_æag
[
ÅÏÃ
] = 
NULL
;

531 
s
->
p_ŒªsmissiÚ_di¡
[
ÅÏÃ
] = 
NULL
;

532 
s
->
p_ŒªsmissiÚ_”r
[
ÅÏÃ
] = 
NULL
;

533 
s
->
p_dec_img
[
ÅÏÃ
] = 
NULL
;

534 
s
->
p_fœ¡_mom’t
[
ÅÏÃ
] = 
NULL
;

535 
s
->
p_£cÚd_mom’t
[
ÅÏÃ
] = 
NULL
;

538 
p_IÅ
->
de
)

540 
LLN
:

541 
ndec
 = 
p_IÅ
->
NoOfDecod”s
;

543 ià(
ndec
 == 0)

545 
	`´štf
("Number of decoders cannot be zero for LLN‡nd fast LLN‡lgorithms,„esettingo 30");

546 
ndec
 = 30;

548 
	`g‘_mem3D
(&(
s
->
mb_”rÜ_m­
), 
ndec
, 
size_y
/
MB_BLOCK_SIZE
, 
size_x
/MB_BLOCK_SIZE);

549 
	`g‘_mem3D³l
(&(
s
->
dec_imgY
), 
ndec
, 
size_y
, 
size_x
);

552 ià((
s
->
p_dec_img
[0] = (
img³l
***)
	`ÿÎoc
(
ndec
,(img³l**))è=ð
NULL
)

554 
	`no_mem_ex™
("errdo.c:…_dec_img[0]");

557 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

559 
	`g‘_mem4D³l
(&(
s
->
dec_imgUV
), 
ndec
, 2, 
size_y_ü
, 
size_x_ü
);

560 ià((
s
->
p_dec_img
[1] = (
img³l
***)
	`ÿÎoc
(
ndec
,(img³l**))è=ð
NULL
)

562 
	`no_mem_ex™
("errdo.c:…_dec_img[1]");

564 ià((
s
->
p_dec_img
[2] = (
img³l
***)
	`ÿÎoc
(
ndec
,(img³l**))è=ð
NULL
)

566 
	`no_mem_ex™
("errdo.c:…_dec_img[2]");

570 
dec
 = 0; deø< 
ndec
; dec++)

572 
s
->
p_dec_img
[0][
dec
] = s->
dec_imgY
[dec];

575 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

577 
dec
 = 0; deø< 
ndec
; dec++)

579 
s
->
p_dec_img
[1][
dec
] = s->
dec_imgUV
[dec][0];

580 
s
->
p_dec_img
[2][
dec
] = s->
dec_imgUV
[dec][1];

588 
	}
}

598 
	$”rdo_ä“_¡ÜabË_piùu»
(
StÜabËPiùu»
* 
s
)

600 
ÅÏÃ
;

601 
Di¡_E¡m
 *
p
 = 
s
->
de_mem
;

603 ià(
p
->
»s_cÚ_diff_Y
)

605 
	`ä“_mem2Dšt
(
p
->
»s_cÚ_diff_Y
);

606 
p
->
»s_cÚ_diff_Y
 = 
NULL
;

608 ià(
p
->
»s_cÚ_diff_UV
)

610 
	`ä“_mem3Dšt
(
p
->
»s_cÚ_diff_UV
);

611 
p
->
»s_cÚ_diff_UV
 = 
NULL
;

613 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

615 
p
->
p_»s_cÚ_diff
[
ÅÏÃ
] = 
NULL
;

618 ià(
p
->
MV_cÚ_diff_Y
)

620 
	`ä“_mem2Dšt
(
p
->
MV_cÚ_diff_Y
);

621 
p
->
MV_cÚ_diff_Y
 = 
NULL
;

623 ià(
p
->
MV_cÚ_diff_UV
)

625 
	`ä“_mem3Dšt
(
p
->
MV_cÚ_diff_UV
);

626 
p
->
MV_cÚ_diff_UV
 = 
NULL
;

628 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

630 
p
->
p_MV_cÚ_diff
[
ÅÏÃ
] = 
NULL
;

633 ià(
p
->
”rÜ_sign_æag_Y
)

635 
	`ä“_mem2D
(
p
->
”rÜ_sign_æag_Y
);

636 
p
->
”rÜ_sign_æag_Y
 = 
NULL
;

638 ià(
p
->
”rÜ_sign_æag_UV
)

640 
	`ä“_mem3D
(
p
->
”rÜ_sign_æag_UV
);

641 
p
->
”rÜ_sign_æag_UV
 = 
NULL
;

643 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

645 
p
->
p_”rÜ_sign_æag
[
ÅÏÃ
] = 
NULL
;

648 ià(
p
->
ŒªsmissiÚ_di¡_Y
)

650 
	`ä“_mem2Dšt
(
p
->
ŒªsmissiÚ_di¡_Y
);

651 
p
->
ŒªsmissiÚ_di¡_Y
 = 
NULL
;

653 ià(
p
->
ŒªsmissiÚ_di¡_UV
)

655 
	`ä“_mem3Dšt
(
p
->
ŒªsmissiÚ_di¡_UV
);

656 
p
->
ŒªsmissiÚ_di¡_UV
 = 
NULL
;

658 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

660 
p
->
p_ŒªsmissiÚ_di¡
[
ÅÏÃ
] = 
NULL
;

663 ià(
p
->
ŒªsmissiÚ_”r_Y
)

665 
	`ä“_mem2Dšt
(
p
->
ŒªsmissiÚ_”r_Y
);

666 
p
->
ŒªsmissiÚ_”r_Y
 = 
NULL
;

668 ià(
p
->
ŒªsmissiÚ_”r_UV
)

670 
	`ä“_mem3Dšt
(
p
->
ŒªsmissiÚ_”r_UV
);

671 
p
->
ŒªsmissiÚ_”r_UV
 = 
NULL
;

673 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

675 
p
->
p_ŒªsmissiÚ_”r
[
ÅÏÃ
] = 
NULL
;

679 ià(
p
->
dec_imgY
)

681 
	`ä“_mem3D³l
(
p
->
dec_imgY
);

682 
p
->
dec_imgY
 = 
NULL
;

684 ià(
p
->
dec_imgUV
)

686 
	`ä“_mem4D³l
(
p
->
dec_imgUV
);

687 
p
->
dec_imgUV
 = 
NULL
;

689 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

691 
	`ä“_poš‹r
(
p
->
p_dec_img
[
ÅÏÃ
]);

693 ià(
p
->
mb_”rÜ_m­
)

695 
	`ä“_mem3D
(
p
->
mb_”rÜ_m­
);

696 
p
->
mb_”rÜ_m­
 = 
NULL
;

701 ià(
p
->
fœ¡_mom’t_Y
)

703 
	`ä“_mem2D³l
(
p
->
fœ¡_mom’t_Y
);

704 
p
->
fœ¡_mom’t_Y
 = 
NULL
;

706 ià(
p
->
fœ¡_mom’t_UV
)

708 
	`ä“_mem3D³l
(
p
->
fœ¡_mom’t_UV
);

709 
p
->
fœ¡_mom’t_UV
 = 
NULL
;

711 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

713 
p
->
p_fœ¡_mom’t
[
ÅÏÃ
] = 
NULL
;

715 ià(
p
->
£cÚd_mom’t_Y
)

717 
	`ä“_mem2Dušt16
(
p
->
£cÚd_mom’t_Y
);

718 
p
->
£cÚd_mom’t_Y
 = 
NULL
;

720 ià(
p
->
£cÚd_mom’t_UV
)

722 
	`ä“_mem3Dušt16
(
p
->
£cÚd_mom’t_UV
);

723 
p
->
£cÚd_mom’t_UV
 = 
NULL
;

725 
ÅÏÃ
 = 0;‚plane < 3;‚plane++)

727 
p
->
p_£cÚd_mom’t
[
ÅÏÃ
] = 
NULL
;

730 
	`ä“_poš‹r
(
s
->
de_mem
);

731 
	}
}

	@lencod/src/errdo_dist_mhyp.c

24 
	~"glob®.h
"

25 
	~"mbufãr.h
"

26 
	~"”rdo.h
"

27 
	~"md_di¡ÜtiÚ.h
"

28 
	~"md_commÚ.h
"

29 
	~"În_mc_´ediùiÚ.h
"

31 
add_»sidue
 (
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
¶
, 
block8x8
, 
x_size
, 
y_size
);

32 
Bužd_Stus_M­
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
by‹
 **
s_m­
);

33 
g‘_´ediùed_mb
(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
);

34 
cÝy_cÚû®_mb
 (
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
mb_”rÜ
, StÜabËPiùu»* 
»fPic
);

35 
decode_Úe_b8block
 (
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
block8x8
, 
mv_mode
, 
´ed_dœ
);

36 
decode_Úe_mb
 (
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
 *
’c
, 
decod”
);

38 
Upd©eDecod”s
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StÜabËPiùu»
 *
’c_pic
);

39 
DeblockF¿me
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **, imgpel ***);

48 
di¡blk
 
	$”rdo_di¡ÜtiÚ_e¡im©iÚ_muÉihyp
(
Maüoblock
 *
cu¼MB
, 
block
, 
block_size
, 
mode
, 
pdœ
, 
di¡blk
 
mš_rdco¡
)

50 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

51 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

52 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

53 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

55 
·x
 = 8*(
block
 & 0x01);

56 
·y
 = 8*(
block
 >> 1);

57 
di¡blk
 
di¡ÜtiÚ
=0;

58 
di¡blk
 
‹mp_di¡
, 
ddi¡ÜtiÚ
 = 0;

59 
k
;

65 ià(
mode
 >= 4 && mode <= 7)

70 
	`”rdo_compu‹_»sidue
 (
cu¼MB
, &
p_Vid
->
’c_piùu»
->
p_img
[0][cu¼MB->
pix_y
],…_Vid->
p_decs
->
»s_img
[0], 
cu¼Sliû
->
mb_´ed
[0], 
block
, 8);

83 
k
 = 0; k < 
p_IÅ
->
NoOfDecod”s
; k++)

85 
	`decode_Úe_b8block
 (
cu¼MB
, 
p_Vid
->
’c_piùu»
, 
k
, 
block
, 
mode
, 
pdœ
);

86 
ddi¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
·y
], &p_Vid->
’c_piùu»
->
de_mem
->
p_dec_img
[0][
k
][cu¼MB->Ýix_y +…ay], cu¼MB->
pix_x
 + 
·x
, currMB->pix_x +…ax);

89 
‹mp_di¡
 = 
mš_rdco¡
 * 
p_IÅ
->
NoOfDecod”s
;

91 ià(
ddi¡ÜtiÚ
 > 
‹mp_di¡
)

94  
DISTBLK_MAX
;

98 
di¡ÜtiÚ
 = (
di¡blk
è(
ddi¡ÜtiÚ
 / 
p_IÅ
->
NoOfDecod”s
);

100 ià(
mode
 !ð
P8x8
)

102 
	`”rdo_compu‹_»sidue
 (
cu¼MB
, &
p_Vid
->
’c_piùu»
->
p_cu¼_img
[cu¼MB->
pix_y
],…_Vid->
p_decs
->
»s_img
[0], 
mode
 =ð
I16MB
 ? 
cu¼Sliû
->
m´_16x16
[0][ (ècu¼MB->
i16mode
] : cu¼Sliû->
mb_´ed
[0], 0, 16);

103 
k
 = 0; k<
p_IÅ
->
NoOfDecod”s
 ;k++)

105 
	`decode_Úe_mb
 (
cu¼MB
, 
p_Vid
->
’c_piùu»
, 
k
);

106 
ddi¡ÜtiÚ
 +ð
	`compu‹_SSE16x16
(&
p_Vid
->
pImgOrg
[0][
cu¼MB
->
Ýix_y
], &p_Vid->
’c_piùu»
->
de_mem
->
p_dec_img
[0][
k
][cu¼MB->
pix_y
], cu¼MB->
pix_x
, currMB->pix_x);

109 ià(
mš_rdco¡
 < 
DISTBLK_MAX
)

112 
‹mp_di¡
 = 
mš_rdco¡
 * 
p_IÅ
->
NoOfDecod”s
;

116 
‹mp_di¡
 = 
DISTBLK_MAX
;

118 ià(
ddi¡ÜtiÚ
 > 
‹mp_di¡
)

121  
DISTBLK_MAX
;

125 
di¡ÜtiÚ
 = (
di¡blk
è(
ddi¡ÜtiÚ
 / 
p_IÅ
->
NoOfDecod”s
);

127 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV444
))

130 
di¡ÜtiÚ
 +ð
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

131 
di¡ÜtiÚ
 +ð
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

136 
k
 = 0; k<
p_IÅ
->
NoOfDecod”s
 ;k++)

138 
ddi¡ÜtiÚ
 +ð
	`compu‹_SSE16x16
(&
p_Vid
->
pImgOrg
[0][
cu¼MB
->
Ýix_y
], &p_Vid->
’c_piùu»
->
de_mem
->
p_dec_img
[0][
k
][cu¼MB->
pix_y
], cu¼MB->
pix_x
, currMB->pix_x);

141 ià(
mš_rdco¡
 < 
DISTBLK_MAX
)

144 
‹mp_di¡
 = 
mš_rdco¡
 * 
p_IÅ
->
NoOfDecod”s
;

148 
‹mp_di¡
 = 
DISTBLK_MAX
;

150 ià(
ddi¡ÜtiÚ
 > 
‹mp_di¡
)

153  
DISTBLK_MAX
;

156 
di¡ÜtiÚ
 = (
di¡blk
è(
ddi¡ÜtiÚ
 / 
p_IÅ
->
NoOfDecod”s
);

158 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV444
))

161 
di¡ÜtiÚ
 +ð
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

162 
di¡ÜtiÚ
 +ð
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

166  
di¡ÜtiÚ
;

167 
	}
}

177 
	$Upd©eDecod”s
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StÜabËPiùu»
 *
’c_pic
)

179 
k
;

180 
k
 = 0; k < 
p_IÅ
->
NoOfDecod”s
; k++)

182 
	`Bužd_Stus_M­
(
p_Vid
, 
p_IÅ
, 
’c_pic
->
de_mem
->
mb_”rÜ_m­
[
k
]);

183 
p_Vid
->
	`”rÜ_cÚû®_piùu»
Õ_Vid, 
’c_pic
, 
k
);

184 
	`DeblockF¿me
 (
p_Vid
, 
’c_pic
->
de_mem
->
p_dec_img
[0][
k
], 
NULL
);

186 
	}
}

200 
	$Bužd_Stus_M­
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
by‹
 **
s_m­
)

202 
i
,
j
,
¦iû
=-1,
mb
=0,
jj
,
ii
;

203 
by‹
 
·ck‘_lo¡
=0;

205 
jj
 = 
p_Vid
->
height
/
MB_BLOCK_SIZE
;

206 
ii
 = 
p_Vid
->
width
/
MB_BLOCK_SIZE
;

208 
j
 = 0; j < 
jj
; j++)

210 
i
 = 0; i < 
ii
; i++)

212 ià(!
p_IÅ
->
¦iû_mode
 || 
p_Vid
->
mb_d©a
[
mb
].
¦iû_Ä
 !ð
¦iû
)

214 
·ck‘_lo¡
=0;

215 ià(()
	`¿nd
()/()
RAND_MAX
*100 < 
p_IÅ
->
LossR©eC
è
·ck‘_lo¡
 += 3;

216 ià(()
	`¿nd
()/()
RAND_MAX
*100 < 
p_IÅ
->
LossR©eB
è
·ck‘_lo¡
 += 2;

217 ià(()
	`¿nd
()/()
RAND_MAX
*100 < 
p_IÅ
->
LossR©eA
è
·ck‘_lo¡
 = 1;

218 
¦iû
++;

220 ià(!
·ck‘_lo¡
)

222 
s_m­
[
j
][
i
]=0;

226 
s_m­
[
j
][
i
] = 
·ck‘_lo¡
;

227 if(
p_IÅ
->
·¹™iÚ_mode
 =ð0è
s_m­
[
j
][
i
]=1;

229 
mb
++;

232 
	}
}

241 
	$”rdo_¡Üe_be¡_block_muÉihyp
(
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
*** 
mbY
, img³l*** 
dec_img
, 
block
, 
img_i
, 
img_j
, 
block_size
)

243 
i0
 = ((
block
&0x01)<<3);

244 
j0
 = ((
block
>>1)<<3);

245 
j
, 
k
;

246 
j1
 = 
j0
 + 
block_size
;

248 
k
 = 0; k < 
p_IÅ
->
NoOfDecod”s
; k++)

250 
j
 = 
j0
; j < 
j1
; j++)

252 
	`memýy
(&
mbY
[
k
][
j
][
i0
], &
dec_img
[k][
img_j
+j][
img_i
+i0], 
block_size
 * (
img³l
));

255 
	}
}

263 
	$”rdo_g‘_be¡_block_muÉihyp
(
Maüoblock
 *
cu¼MB
, 
img³l
*** 
dec_img
, img³l*** 
mbY
, 
block
, 
block_size
)

265 
i0
 = ((
block
&0x01)<<3);

266 
j0
 = ((
block
>>1)<<3);

267 
j
, 
k
;

268 
j1
 = 
j0
 + 
block_size
;

270 
k
 = 0; k < 
cu¼MB
->
p_IÅ
->
NoOfDecod”s
; k++)

272 
j
 = 
j0
; j < 
j1
; j++)

274 
	`memýy
(&
dec_img
[
k
][
cu¼MB
->
pix_y
 + 
j
][cu¼MB->
pix_x
+
i0
], &
mbY
[k][j][i0], 
block_size
 * (
img³l
));

277 
	}
}

290 
	$decode_Úe_mb
 (
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
)

292 
i0
, 
j
;

293 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

294 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

295 
img³l
** 
curComp
;

296 
img³l
** 
ÞdComp
;

299 ià(
cu¼MB
->
mb_ty³
 > 
P8x8
)

301 
curComp
 = &
’c_pic
->
de_mem
->
p_dec_img
[0][
decod”
][
cu¼MB
->
pix_y
];

302 
ÞdComp
 = &
’c_pic
->
p_cu¼_img
[
cu¼MB
->
pix_y
];

303 
i0
 = 
cu¼MB
->
pix_x
;

304 
	`cÝy_image_d©a_16x16
(
curComp
, 
ÞdComp
, 
i0
, i0);

306 ià((
cu¼MB
->
mb_ty³
 =ð0è&& (
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
))

308 
	`g‘_´ediùed_mb
(
cu¼MB
, 
’c_pic
, 
decod”
);

309 
curComp
 = &
’c_pic
->
de_mem
->
p_dec_img
[0][
decod”
][
cu¼MB
->
pix_y
];

310 
j
 = 0; j < 
p_Vid
->
mb_size
[0][1]; j++)

312 
	`memýy
(&(
curComp
[
j
][
cu¼MB
->
pix_x
]), &(
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][j][0]),…_Vid->
mb_size
[0][0] * (
img³l
));

317 
	`g‘_´ediùed_mb
(
cu¼MB
, 
’c_pic
, 
decod”
);

318 
	`add_»sidue
(
cu¼MB
, 
’c_pic
, 
decod”
, 
PLANE_Y
, 0, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

320 
	}
}

329 
	$g‘_´ediùed_mb
(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
)

331 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

332 
i
,
j
,
k
;

333 
block_size_x
, 
block_size_y
;

334 
mv_mode
, 
´ed_dœ
;

335 cÚ¡ 
by‹
 
decode_block_sÿn
[16] = {0,1,4,5,2,3,6,7,8,9,12,13,10,11,14,15};

336 
block8x8
;

337 
k_¡¬t
, 
k_’d
, 
k_šc
;

339 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 && !
cu¼MB
->
mb_ty³
)

341 
block_size_x
 = 
MB_BLOCK_SIZE
;

342 
block_size_y
 = 
MB_BLOCK_SIZE
;

343 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
LIST_0
, 0, 0,ƒnc_pic->
mv_šfo
, 0, 0, 
block_size_x
, 
block_size_y
, 0);

345 ià(
cu¼MB
->
mb_ty³
 == 1)

347 
block_size_x
 = 
MB_BLOCK_SIZE
;

348 
block_size_y
 = 
MB_BLOCK_SIZE
;

349 
´ed_dœ
 = 
cu¼MB
->
b8x8
[0].
pdœ
;

350 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 1, 1,ƒnc_pic->
mv_šfo
, 0, 0, 
block_size_x
, 
block_size_y
, cu¼MB->
b8x8
[0].
b»d
);

352 ià(
cu¼MB
->
mb_ty³
 == 2)

354 
block_size_x
 = 
MB_BLOCK_SIZE
;

355 
block_size_y
 = 8;

357 
block8x8
 = 0; block8x8 < 4; block8x8 += 2)

359 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

360 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 2, 2,ƒnc_pic->
mv_šfo
, 0, 
block8x8
, 
block_size_x
, 
block_size_y
, cu¼MB->
b8x8
[block8x8].
b»d
);

363 ià(
cu¼MB
->
mb_ty³
 == 3)

365 
block_size_x
 = 8;

366 
block_size_y
 = 16;

368 
block8x8
 = 0; block8x8 < 2; block8x8++)

370 
i
 = 
block8x8
<<1;

371 
j
 = 0;

372 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

373 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 3, 3,ƒnc_pic->
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
, cu¼MB->
b8x8
[
block8x8
].
b»d
);

378 
block8x8
 = 0; block8x8 < 4; block8x8++)

380 
mv_mode
 = 
cu¼MB
->
b8x8
[
block8x8
].
mode
;

381 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

383 
k_¡¬t
 = (
block8x8
 << 2);

384 
k_šc
 = (
mv_mode
 == 5) ? 2 : 1;

386 ià(
mv_mode
 == 0)

388 
k_’d
 = 
k_¡¬t
 + 1;

389 
block_size_x
 = 8;

390 
block_size_y
 = 8;

394 
k_’d
 = (
mv_mode
 =ð4è? 
k_¡¬t
 + 1 : ((mv_mod=ð7è? k_¡¬ˆ+ 4 : k_¡¬ˆ+ 
k_šc
 + 1);

395 
block_size_x
 = ( 
mv_mode
 == 5 || mv_mode == 4 ) ? 8 : 4;

396 
block_size_y
 = ( 
mv_mode
 == 6 || mv_mode == 4 ) ? 8 : 4;

399 
k
 = 
k_¡¬t
; k < 
k_’d
; k +ð
k_šc
)

401 
i
 = (
decode_block_sÿn
[
k
] & 3);

402 
j
 = ((
decode_block_sÿn
[
k
] >> 2) & 3);

403 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 
mv_mode
, mv_mode,ƒnc_pic->
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
, cu¼MB->
b8x8
[
block8x8
].
b»d
);

407 
	}
}

421 
	$decode_Úe_b8block
 (
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
block8x8
, 
mv_mode
, 
´ed_dœ
)

423 
i
,
j
,
k
;

424 
block_size_x
, 
block_size_y
;

425 
i0
 = (
block8x8
 & 0x01)<<3;

426 
j0
 = (
block8x8
 >> 1)<<3, 
j1
 = j0+8;

428 
img³l
 **
curComp
;

429 
img³l
 **
ÞdComp
;

430 
k_¡¬t
, 
k_’d
, 
k_šc
;

431 cÚ¡ 
by‹
 
decode_block_sÿn
[16] = {0,1,4,5,2,3,6,7,8,9,12,13,10,11,14,15};

433 ià(
mv_mode
 > 8)

435 
j
 = 
j0
; j < 
j1
; j++)

437 
curComp
 = &
’c_pic
->
de_mem
->
p_dec_img
[0][
decod”
][
cu¼MB
->
pix_y
];

438 
ÞdComp
 = &
’c_pic
->
p_cu¼_img
[
cu¼MB
->
pix_y
];

439 
	`memýy
(&(
curComp
[
j
][
i0
]), &(
ÞdComp
[j][i0]), (
img³l
)*8);

444 
k_¡¬t
 = (
block8x8
 << 2);

446 ià(
mv_mode
 == 0)

448 
k_šc
 = 1;

449 
k_’d
 = 
k_¡¬t
+1;

450 
block_size_x
 = 8;

451 
block_size_y
 = 8;

456 
k_šc
 = (
mv_mode
 == 5) ? 2 : 1;

457 
k_’d
 = (
mv_mode
 =ð4è? 
k_¡¬t
 + 1 : ((mv_mod=ð7è? k_¡¬ˆ+ 4 : k_¡¬ˆ+ 
k_šc
 + 1);

459 
block_size_x
 = ( 
mv_mode
 == 5 || mv_mode == 4 ) ? 8 : 4;

460 
block_size_y
 = ( 
mv_mode
 == 6 || mv_mode == 4 ) ? 8 : 4;

463 
k
 = 
k_¡¬t
; k < 
k_’d
; k +ð
k_šc
)

465 
i
 = (
decode_block_sÿn
[
k
] & 3);

466 
j
 = ((
decode_block_sÿn
[
k
] >> 2) & 3);

467 
	`³rfÜm_mc
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 
mv_mode
, mv_mode,ƒnc_pic->
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
, cu¼MB->
b8x8
[
block8x8
].
b»d
);

470 
	`add_»sidue
(
cu¼MB
, 
’c_pic
, 
decod”
, 
PLANE_Y
, 
block8x8
, 8, 8);

472 
	}
}

480 
	$add_»sidue
 (
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
¶
, 
block8x8
, 
x_size
, 
y_size
)

482 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

483 
max_³l_v®ue
 = 
cu¼MB
->
p_Vid
->
max_³l_v®ue_comp
[
¶
];

484 
i
,
j
;

485 
i0
 = (
block8x8
 & 0x01)<<3, 
i1
 = i0 + 
x_size
;

486 
j0
 = (
block8x8
 >> 1)<<3, 
j1
 = j0 + 
y_size
;

488 
img³l
 **
p_dec_img
 = &
’c_pic
->
de_mem
->p_dec_img[
¶
][
decod”
][
cu¼MB
->
pix_y
];

489 **
»s_img
 = 
p_Vid
->
p_decs
->res_img[0];

490 
img³l
** 
m´
 = 
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
];

492 
j
 = 
j0
; j < 
j1
; j++)

494 
i
 = 
i0
; i < 
i1
; i++)

496 
p_dec_img
[
j
][
cu¼MB
->
pix_x
 + 
i
] = (
img³l
è
	`iCl3
(0, 
max_³l_v®ue
, (
m´
[j][i] + 
»s_img
[j][i]));

499 
	}
}

511 
	$g‘_´ediùed_cÚû®m’t_mb
(
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
* 
’c_pic
, 
decod”
)

513 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

514 
i
,
j
,
k
;

515 
block_size_x
, 
block_size_y
;

516 
mv_mode
, 
´ed_dœ
;

517 cÚ¡ 
by‹
 
decode_block_sÿn
[16] = {0,1,4,5,2,3,6,7,8,9,12,13,10,11,14,15};

518 
block8x8
;

519 
k_¡¬t
, 
k_’d
, 
k_šc
;

521 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 && !
cu¼MB
->
mb_ty³
)

523 
block_size_x
 = 
MB_BLOCK_SIZE
;

524 
block_size_y
 = 
MB_BLOCK_SIZE
;

525 
	`³rfÜm_mc_cÚû®m’t
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
LIST_0
, 0, 0,ƒnc_pic->
mv_šfo
, 0, 0, 
block_size_x
, 
block_size_y
);

527 ià(
cu¼MB
->
mb_ty³
 == 1)

529 
block_size_x
 = 
MB_BLOCK_SIZE
;

530 
block_size_y
 = 
MB_BLOCK_SIZE
;

531 
´ed_dœ
 = 
cu¼MB
->
b8x8
[0].
pdœ
;

532 
	`³rfÜm_mc_cÚû®m’t
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 1, 1,ƒnc_pic->
mv_šfo
, 0, 0, 
block_size_x
, 
block_size_y
);

534 ià(
cu¼MB
->
mb_ty³
 == 2)

536 
block_size_x
 = 
MB_BLOCK_SIZE
;

537 
block_size_y
 = 8;

539 
block8x8
 = 0; block8x8 < 4; block8x8 += 2)

541 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

542 
	`³rfÜm_mc_cÚû®m’t
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 2, 2,ƒnc_pic->
mv_šfo
, 0, 
block8x8
, 
block_size_x
, 
block_size_y
);

545 ià(
cu¼MB
->
mb_ty³
 == 3)

547 
block_size_x
 = 8;

548 
block_size_y
 = 16;

550 
block8x8
 = 0; block8x8 < 2; block8x8++)

552 
i
 = 
block8x8
<<1;

553 
j
 = 0;

554 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

555 
	`³rfÜm_mc_cÚû®m’t
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 3, 3,ƒnc_pic->
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
);

560 
block8x8
 = 0; block8x8 < 4; block8x8++)

562 
mv_mode
 = 
cu¼MB
->
b8x8
[
block8x8
].
mode
;

563 
´ed_dœ
 = 
cu¼MB
->
b8x8
[
block8x8
].
pdœ
;

565 
k_¡¬t
 = (
block8x8
 << 2);

566 
k_šc
 = (
mv_mode
 == 5) ? 2 : 1;

568 ià(
mv_mode
 == 0)

570 
k_’d
 = 
k_¡¬t
 + 1;

571 
block_size_x
 = 8;

572 
block_size_y
 = 8;

576 
k_’d
 = (
mv_mode
 =ð4è? 
k_¡¬t
 + 1 : ((mv_mod=ð7è? k_¡¬ˆ+ 4 : k_¡¬ˆ+ 
k_šc
 + 1);

577 
block_size_x
 = ( 
mv_mode
 == 5 || mv_mode == 4 ) ? 8 : 4;

578 
block_size_y
 = ( 
mv_mode
 == 6 || mv_mode == 4 ) ? 8 : 4;

581 
k
 = 
k_¡¬t
; k < 
k_’d
; k +ð
k_šc
)

583 
i
 = (
decode_block_sÿn
[
k
] & 3);

584 
j
 = ((
decode_block_sÿn
[
k
] >> 2) & 3);

585 
	`³rfÜm_mc_cÚû®m’t
(
cu¼MB
, 
decod”
, 
PLANE_Y
, 
’c_pic
, 
´ed_dœ
, 
mv_mode
, mv_mode,ƒnc_pic->
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
);

589 
	}
}

601 
	$cÝy_cÚû®_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
)

603 
mb
;

604 
Maüoblock
* 
cu¼MB
;

605 
mb_”rÜ
;

606 
by‹
** 
mb_”rÜ_m­
 = 
’c_pic
->
de_mem
->mb_”rÜ_m­[
decod”
];

607 
StÜabËPiùu»
* 
»fPic
;

608 
BlockPos
 *
PicPos
 = 
p_Vid
->PicPos;

610 
»fPic
 = 
	`fšd_Ã¬e¡_»f_piùu»
(
p_Vid
->
p_Dpb_Ïy”
[0], 
’c_pic
->
poc
);

611 
mb
 = 0; mb < 
p_Vid
->
PicSizeInMbs
; mb++)

613 
cu¼MB
 = &
p_Vid
->
mb_d©a
[
mb
];

614 
cu¼MB
->
mb_x
 = 
PicPos
[
mb
].
x
;

615 
cu¼MB
->
mb_y
 = 
PicPos
[
mb
].
y
;

616 
mb_”rÜ
 = 
mb_”rÜ_m­
[
cu¼MB
->
mb_y
][cu¼MB->
mb_x
];

617 ià(
mb_”rÜ
)

619 
cu¼MB
->
block_x
 = cu¼MB ->
mb_x
 << 2;

620 
cu¼MB
->
block_y
 = cu¼MB->
mb_y
 << 2;

621 
cu¼MB
->
pix_x
 = cu¼MB->
block_x
 << 2;

622 
cu¼MB
->
pix_y
 = cu¼MB->
block_y
 << 2;

623 
	`cÝy_cÚû®_mb
(
cu¼MB
, 
’c_pic
, 
decod”
, 
mb_”rÜ
, 
»fPic
);

626 
	}
}

634 
	$cÝy_cÚû®_mb
(
Maüoblock
* 
cu¼MB
, 
StÜabËPiùu»
 *
’c_pic
, 
decod”
, 
mb_”rÜ
, StÜabËPiùu»* 
»fPic
)

636 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

637 
j
, 
i
, 
i0
 = 
cu¼MB
->
pix_x
;

638 
img³l
** 
cÚû®ed_img
 = &(
’c_pic
->
de_mem
->
p_dec_img
[0][
decod”
][
cu¼MB
->
pix_y
]);

639 
img³l
** 
»f_img
;

641 ià(
mb_”rÜ
 =ð1 || (mb_”rÜ !ð3 && 
cu¼MB
->
mb_ty³
 > 
P8x8
))

643 ià(
»fPic
 !ð
NULL
)

645 
»f_img
 = &(
»fPic
->
de_mem
->
p_dec_img
[0][
decod”
][
cu¼MB
->
pix_y
]);

646 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

648 
	`memýy
(&(
cÚû®ed_img
[
j
][
i0
]), &(
»f_img
[j][i0]), (
img³l
)*
MB_BLOCK_SIZE
);

653 
j
=0; j<
MB_BLOCK_SIZE
; j++)

655 
i
=
i0
; i<i0+
MB_BLOCK_SIZE
; i++)

657 
cÚû®ed_img
[
j
][
i
] = 128;

662 ià(
mb_”rÜ
 !ð2 && 
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && 
cu¼MB
->
mb_ty³
 < 
P8x8
)

664 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

665 
	`g‘_´ediùed_cÚû®m’t_mb
(
cu¼MB
, 
’c_pic
, 
decod”
);

666 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

668 
	`memýy
(&(
cÚû®ed_img
[
j
][
i0
]), &(
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][j][0]), 
MB_BLOCK_SIZE
 * (
img³l
));

671 
	}
}

	@lencod/src/explicit_gop.c

14 
	~"cÚŒibutÜs.h
"

16 
	~<ùy³.h
>

17 
	~<lim™s.h
>

18 
	~"glob®.h
"

20 
	~"ex¶ic™_gÝ.h
"

21 
	~"image.h
"

22 
	~"ÇlucommÚ.h
"

23 
	~"»pÜt.h
"

32 
	$š™_gÝ_¡ruùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

34 
max_gÝsize
 = 
p_IÅ
->
Numb”BF¿mes
;

36 
p_Vid
->
gÝ_¡ruùu»
 = 
	`ÿÎoc
(
	`imax
(10,
max_gÝsize
),  (
GOP_DATA
));

37 ià(
NULL
==
p_Vid
->
gÝ_¡ruùu»
)

38 
	`no_mem_ex™
("init_gop_structure: gop_structure");

39 
	}
}

48 
	$þ—r_gÝ_¡ruùu»
(
VideoP¬am‘”s
 *
p_Vid
)

50 ià(
p_Vid
->
gÝ_¡ruùu»
)

51 
	`ä“
(
p_Vid
->
gÝ_¡ruùu»
);

52 
	}
}

61 
	$š‹½»t_gÝ_¡ruùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

63 
nL’gth
 = (è
	`¡¾’
(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
);

64 
i
 =0, 
k
, 
dqp
, 
di¥Ïy_no
;

65 
¦iû_»ad
 =0, 
Üd”_»ad
 = 0, 
¡Üed_»ad
 = 0, 
qp_»ad
 =0;

66 
coded_äame
 = 0;

67 
Žyr
, 
‹mpÜ®_Ïy”_»ad
 = 0;

69 ià(
nL’gth
 > 0)

72 
i
 = 0; i < 
nL’gth
 ; i++)

75 ià(
¦iû_»ad
 == 0)

77 
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
[
i
])

81 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
¦iû_ty³
 = 
P_SLICE
;

85 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
¦iû_ty³
 = 
B_SLICE
;

89 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
¦iû_ty³
 = 
I_SLICE
;

92 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Slice Type invalid in ExplicitHierarchyFormat…aram. Please check configuration file.");

93 
	`”rÜ
 (
”rÜ‹xt
, 400);

96 
¦iû_»ad
 = 1;

101 ià(
Üd”_»ad
 == 0)

103 ià(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
))))

105 
	`ssÿnf
(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
,"%d",&
di¥Ïy_no
);

106 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
di¥Ïy_no
 = display_no;

107 
Üd”_»ad
 = 1;

108 ià(
di¥Ïy_no
 < 0 || di¥Ïy_nØ>ð
p_IÅ
->
Numb”BF¿mes
)

110 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Inv®id F¿mOrd” v®ue. F¿mpos™iÚ‚“d tØbš [0,%d]„ªge.",
p_IÅ
->
Numb”BF¿mes
 - 1);

111 
	`”rÜ
 (
”rÜ‹xt
, 400);

113 
k
=0;k<
coded_äame
;k++)

115 ià(
p_Vid
->
gÝ_¡ruùu»
[
k
].
di¥Ïy_no
 == display_no)

117 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "F¿mOrd” v®u%d iÀäam%d‡Ì—dy u£d fÜƒnhªûm’ˆäam%d.",
di¥Ïy_no
,
coded_äame
,
k
);

118 
	`”rÜ
 (
”rÜ‹xt
, 400);

124 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Slice Type‚eedso be followed by Display Order. Please check configuration file.");

125 
	`”rÜ
 (
”rÜ‹xt
, 400);

128 ià(
Üd”_»ad
 == 1)

130 ià(
¡Üed_»ad
 =ð0 && !(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
)))))

132 
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
[
i
])

136 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
»ã»nû_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

137 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
h›¿rchy_Ïy”
 = 0;

141 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
»ã»nû_idc
ð
NALU_PRIORITY_LOW
;

142 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
h›¿rchy_Ïy”
 = 1;

145 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Reference_IDC invalid in ExplicitHierarchyFormat…aram. Please check configuration file.");

146 
	`”rÜ
 (
”rÜ‹xt
, 400);

149 
¡Üed_»ad
 = 1;

151 ià(
¡Üed_»ad
 =ð1 && 
qp_»ad
 == 0)

153 ià(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
))))

155 
	`ssÿnf
(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
,"%d",&
dqp
);

157 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
¦iû_qp_off
 = 
	`iCl3
(-p_Vid->
b™d•th_luma_qp_sÿË
, 51, 
dqp
);

158 
qp_»ad
 = 1;

162 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Reference_IDC‚eedso be followed by QP. Please check configuration file.");

163 
	`”rÜ
 (
”rÜ‹xt
, 400);

166 ià(
¡Üed_»ad
 =ð1 && 
qp_»ad
 =ð1 && 
‹mpÜ®_Ïy”_»ad
 == 0)

168 ià(!(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
)))))

170 ià(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
[
i
] == 't' ||…_Inp->ExplicitHierarchyFormat[i] == 'T')

172 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
‹mpÜ®_Ïy”
 = 0;

173 ià(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
+1))))

175 
	`ssÿnf
(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
+1,"%d",&
Žyr
);

177 
p_Vid
->
gÝ_¡ruùu»
[
coded_äame
].
‹mpÜ®_Ïy”
 = 
Žyr
;

178 
i
++;

183 
i
--;

186 
‹mpÜ®_Ïy”_»ad
 = 1;

188 ià(
¡Üed_»ad
 =ð1 && 
qp_»ad
 =ð1 && 
‹mpÜ®_Ïy”_»ad
 =ð1 && !(
	`isdig™
(()(*(
p_IÅ
->
Ex¶ic™H›¿rchyFÜm©
+
i
)))è&& (˜< 
nL’gth
 - 3))

191 
¡Üed_»ad
 =0;

192 
qp_»ad
=0;

193 
Üd”_»ad
=0;

194 
¦iû_»ad
=0;

195 
‹mpÜ®_Ïy”_»ad
=0;

196 
i
--;

197 
coded_äame
 ++;

198 ià(
coded_äame
 >ð
p_IÅ
->
Numb”BF¿mes
 )

200 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Total‚umber of frames in Enhancement GOP‚eedo be fewer orƒqualo NumberBFrames…arameter.");

201 
	`”rÜ
 (
”rÜ‹xt
, 400);

210 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "ExplicitHierarchyFormat isƒmpty. Please check configuration file.");

211 
	`”rÜ
 (
”rÜ‹xt
, 400);

214 
p_IÅ
->
Numb”BF¿mes
 = 
coded_äame
 + 1;

215 
	}
}

	@lencod/src/explicit_seq.c

14 
	~"cÚŒibutÜs.h
"

15 
	~"glob®.h
"

16 
	~"»pÜt.h
"

17 
	~"ex¶ic™_£q.h
"

25 
	$R—dTextF›ld
(
FILE
 *
expSeqFže
, * 
keywÜd
)

27 
»adlše
 [100];

28 
wÜd
[64];

29 
”r
 = -1;

30 
»ad_lše
 = 0;

33 
»ad_lše
++;

35 ià(
NULL
 =ð
	`fg‘s
(
»adlše
, 100, 
expSeqFže
))

36 
	`”rÜ
 ("error…arsingƒxplicit sequence file", 500);

37 
”r
 = 
	`ssÿnf
(
»adlše
,"%s",
wÜd
);

38 ià(
”r
 == -1)

40 ià(
	`¡rÿ£cmp
(
wÜd
, 
keywÜd
) != 0)

41 
”r
 = - 1;

43 ià(
	`ãof
(
expSeqFže
))

46 
”r
 =ð- 1 && 
»ad_lše
 < 6);

56  
”r
;

57 
	}
}

65 
	$R—dIÁF›ld
(
FILE
 *
expSeqFže
, * 
fÜm©
, * 
keywÜd
, * 
v®ue
)

67 
»adlše
 [100];

68 
wÜd
[64];

69 
”r
 = -1;

70 
»ad_lše
 = 0;

74 
»ad_lše
++;

75 ià(
NULL
 =ð
	`fg‘s
(
»adlše
, 100, 
expSeqFže
))

76 
	`”rÜ
 ("error…arsingƒxplicit sequence file", 500);

77 
”r
 = 
	`ssÿnf
(
»adlše
, 
fÜm©
, 
wÜd
, 
v®ue
);

78 ià(
	`ãof
(
expSeqFže
))

81 
	`¡rÿ£cmp
(
wÜd
, 
keywÜd
è!ð0 && 
»ad_lše
 < 6);

83 ià(
”r
 !ð2 || 
	`¡rÿ£cmp
(
wÜd
, 
keywÜd
) != 0)

85 
	`´štf
("E¼Ü whž»adšg %s.\n", 
keywÜd
);

86 
	`»pÜt_¡©s_Ú_”rÜ
();

88 
	}
}

96 
	$R—dCh¬F›ld
(
FILE
 *
expSeqFže
, * 
fÜm©
, * 
keywÜd
, * 
v®ue
)

98 
»adlše
 [100];

99 
wÜd
[64];

100 
”r
 = -1;

101 
»ad_lše
 = 0;

105 
»ad_lše
++;

106 ià(
NULL
 =ð
	`fg‘s
(
»adlše
, 100, 
expSeqFže
))

107 
	`”rÜ
 ("error…arsingƒxplicit sequence file", 500);

108 
”r
 = 
	`ssÿnf
(
»adlše
, 
fÜm©
, 
wÜd
, 
v®ue
);

110 !
	`ãof
(
expSeqFže
))

113 
	`¡rÿ£cmp
(
wÜd
, 
keywÜd
è!ð0 && 
»ad_lše
 < 6);

115 ià(
”r
 !ð2 || 
	`¡rÿ£cmp
(
wÜd
, 
keywÜd
) != 0)

117 
	`´štf
("E¼Ü whž»adšg %s.\n", 
keywÜd
);

118 
	`»pÜt_¡©s_Ú_”rÜ
();

120 
	}
}

123 
	$P¬£SliûTy³
(*
¦iû_ty³
, 
ExpF¿meInfo
 *
šfo
, 
codšg_šdex
)

125 iàÐ
	`¡rÿ£cmp
(
¦iû_ty³
, "P") == 0 )

127 
šfo
->
¦iû_ty³
 = 
P_SLICE
;

129 iàÐ
	`¡rÿ£cmp
(
¦iû_ty³
, "B") == 0 )

131 
šfo
->
¦iû_ty³
 = 
B_SLICE
;

133 iàÐ
	`¡rÿ£cmp
(
¦iû_ty³
, "I") == 0 )

135 
šfo
->
¦iû_ty³
 = 
I_SLICE
;

137 iàÐ
	`¡rÿ£cmp
(
¦iû_ty³
, "SP") == 0 )

139 
šfo
->
¦iû_ty³
 = 
SP_SLICE
;

141 iàÐ
	`¡rÿ£cmp
(
¦iû_ty³
, "SI") == 0 )

143 
šfo
->
¦iû_ty³
 = 
SI_SLICE
;

147 
	`´štf
("ReadExplicitSeqFile : invalid sliceype\n");

148 
	`»pÜt_¡©s_Ú_”rÜ
();

151 ià(
codšg_šdex
 =ð0 && 
šfo
->
¦iû_ty³
 !ð
I_SLICE
)

153 
	`´štf
("ReadExplicitSeqFile : First coded…icture‚eedso be Intra.\n");

154 
	`»pÜt_¡©s_Ú_”rÜ
();

156 
	}
}

158 
	$P¬£Reã»nûIDC
(
»ã»nû_idc
, 
codšg_šdex
)

160 iàÐ
»ã»nû_idc
 < 
NALU_PRIORITY_DISPOSABLE
 ||„eã»nû_idø> 
NALU_PRIORITY_HIGHEST
)

162 
	`´štf
("ReadExplicitSeqFile : Invalid„eference indicator \n");

163 
	`»pÜt_¡©s_Ú_”rÜ
();

166 ià(
codšg_šdex
 =ð0 && 
»ã»nû_idc
 =ð
NALU_PRIORITY_DISPOSABLE
)

168 
	`´štf
("ReadExplicitSeqFile : First coded…icture‚eedso be‡„eference…icture.\n");

169 
	`»pÜt_¡©s_Ú_”rÜ
();

171 
	}
}

174 
	$P¬£SeqNumb”
(
£q_numb”
, 
ExpSeqInfo
 *
£q_šfo
, 
codšg_šdex
)

176 
i
;

177 
i
 = 0; i < 
	`imš
(
codšg_šdex
, 
£q_šfo
->
no_äames
); i++)

179 ià(
£q_šfo
->
šfo
[
i
].
£q_numb”
 == seq_number)

181 
	`´štf
("ReadExplicitSeqFile : SeqNumber used for current frame‡lready used. Terminating\n");

182 
	`»pÜt_¡©s_Ú_”rÜ
();

185 
	}
}

193 
	$R—dF¿meD©a
(
FILE
 *
expSeqFže
, 
ExpSeqInfo
 *
£q_šfo
, 
codšg_šdex
)

195 
BoÞ—n
 
¦iû_ty³_´e£Á
 = 
FALSE
;

196 
BoÞ—n
 
£q_numb”_´e£Á
 = 
FALSE
;

197 
»adlše
 [100];

198 
wÜd
[64], 
v®ue
[64];

199 
”r
 = -1;

200 
ExpF¿meInfo
 *
šfo
 = &
£q_šfo
->šfo[
codšg_šdex
 % seq_šfo->
no_äames
];

202 
šfo
->
»ã»nû_idc
 = 
NALU_PRIORITY_HIGHEST
;

204 
	`R—dTextF›ld
 (
expSeqFže
, "{");

208 ià(
NULL
 =ð
	`fg‘s
(
»adlše
, 100, 
expSeqFže
))

209 
	`”rÜ
 ("error…arsingƒxplicit sequence file", 500);

211 
”r
 = 
	`ssÿnf
(
»adlše
, "% : %s", 
wÜd
, 
v®ue
);

212 ià(
”r
 == 1)

214 ià(
	`¡rÿ£cmp
(
wÜd
, "}") == 0)

216 ià(
	`¡rÿ£cmp
(
wÜd
, "{") == 0)

218 
	`´štf
("Invalid \"{\" character found. Terminating\n");

219 
	`»pÜt_¡©s_Ú_”rÜ
();

222 ià(
”r
 == 2)

224 ià(
	`¡rÿ£cmp
(
wÜd
, "SeqNumber") == 0)

226 
šfo
->
£q_numb”
 = 
	`©oi
(
v®ue
);

227 
	`P¬£SeqNumb”
(
šfo
->
£q_numb”
, 
£q_šfo
, 
codšg_šdex
);

228 
£q_numb”_´e£Á
 = 
TRUE
;

230 ià(
	`¡rÿ£cmp
(
wÜd
, "SliceType") == 0)

232 
	`P¬£SliûTy³
(
v®ue
, 
šfo
, 
codšg_šdex
);

233 
¦iû_ty³_´e£Á
 = 
TRUE
;

235 ià(
	`¡rÿ£cmp
(
wÜd
, "IDRPicture") == 0)

236 
šfo
->
is_idr
 = 
	`©oi
(
v®ue
);

237 ià(
	`¡rÿ£cmp
(
wÜd
, "Reference") == 0)

239 
šfo
->
»ã»nû_idc
 = 
	`©oi
(
v®ue
);

240 
	`P¬£Reã»nûIDC
(
šfo
->
»ã»nû_idc
, 
codšg_šdex
);

244 !
	`ãof
(
expSeqFže
));

246 ià(
¦iû_ty³_´e£Á
 =ð
FALSE
 || 
£q_numb”_´e£Á
 == FALSE)

248 
	`´štf
("Sequence info file does‚ot contain‡ll mandatory info (SeqNumber or SliceType). Terminating.\n");

249 
	`»pÜt_¡©s_Ú_”rÜ
();

251 
	}
}

259 
	$R—dEx¶ic™SeqFže
(
ExpSeqInfo
 *
£q_šfo
, 
FILE
 *
expSFže
, 
codšg_šdex
)

261 
äm_h—d”
 = 
	`R—dTextF›ld
(
expSFže
, "Frame");

263 ià(
äm_h—d”
 != -1)

265 
	`R—dF¿meD©a
 (
expSFže
, 
£q_šfo
, 
codšg_šdex
);

269 
	`´štf
("ReadExplicitSeqFile : No more data. \n");

270 
	`»pÜt_¡©s_Ú_”rÜ
();

272 
	}
}

280 
	$O³nEx¶ic™SeqFže
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

282 
äm_couÁ
 = 0;

283 
p_Vid
->
expSFže
 = 
	`fÝ’
(
p_IÅ
->
Ex¶ic™SeqFže
, "r");

284 ià(
p_Vid
->
expSFže
 =ð
NULL
)

286 
	`´štf
("ERROR while openingheƒxplicit sequence information file.\n");

287 
	`»pÜt_¡©s_Ú_”rÜ
();

290 ià(
	`R—dTextF›ld
(
p_Vid
->
expSFže
, "Sequence") == -1)

292 
	`´štf
("Sequence info file is of invalid format. Terminating\n");

293 
	`»pÜt_¡©s_Ú_”rÜ
();

297 
	`R—dIÁF›ld
 (
p_Vid
->
expSFže
, "% : %d", "F¿meCouÁ", &
äm_couÁ
);

298 ià(
äm_couÁ
 > 0)

300 
p_Vid
->
expSeq
 = (
ExpSeqInfo
 *è
	`m®loc
((ExpSeqInfo));

301 
p_Vid
->
expSeq
->
no_äames
 = 
äm_couÁ
;

302 
p_Vid
->
expSeq
->
šfo
 = (
ExpF¿meInfo
 *è
	`ÿÎoc
(
äm_couÁ
, (ExpFrameInfo));

306 
	`´štf
("Invalid FrameCount in Sequence info file. Terminating\n");

307 
	`»pÜt_¡©s_Ú_”rÜ
();

310 
	}
}

318 
	$Clo£Ex¶ic™SeqFže
(
VideoP¬am‘”s
 *
p_Vid
)

320 ià(
p_Vid
->
expSFže
 !ð
NULL
)

321 
	`fþo£
(
p_Vid
->
expSFže
);

322 ià(
p_Vid
->
expSeq
 !ð
NULL
)

324 
	`ä“
(
p_Vid
->
expSeq
->
šfo
);

325 
	`ä“
(
p_Vid
->
expSeq
);

327 
	}
}

	@lencod/src/filehandle.c

15 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"’c_¡©i¡ics.h
"

20 
	~"¹p.h
"

21 
	~"ªÃxb.h
"

22 
	~"·r£t.h
"

23 
	~"mbufãr.h
"

37 
	$”rÜ
(*
‹xt
, 
code
)

39 
	`årštf
(
¡d”r
, "%s\n", 
‹xt
);

40 
	`æush_dpb
(
p_Enc
->
p_Vid
->
p_Dpb_Ïy”
[0], &p_Enc->
p_IÅ
->
ouut
);

41 
	`æush_dpb
(
p_Enc
->
p_Vid
->
p_Dpb_Ïy”
[1], &p_Enc->
p_IÅ
->
ouut
);

42 
	`ex™
(
code
);

43 
	}
}

52 
	$wr™e_PPS
(
VideoP¬am‘”s
 *
p_Vid
, 
Ën
, 
PPS_id
)

54 
NALU_t
 *
Çlu
;

55 
Çlu
 = 
NULL
;

56 
Çlu
 = 
	`G’”©ePic_·¿m‘”_£t_NALU
 (
p_Vid
, 
PPS_id
);

57 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

58 
	`F»eNALU
 (
Çlu
);

60  
Ën
;

61 
	}
}

70 
	$¡¬t_£qu’û
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

72 
i
,
Ën
=0, 
tÙ®_µs
 = (
p_IÅ
->
G’”©eMuÉËPPS
) ? 3 : 1;

73 
NALU_t
 *
Çlu
;

75 
p_IÅ
->
of_mode
)

77 
PAR_OF_ANNEXB
:

78 
p_Vid
->
Wr™eNALU
 = 
Wr™eAÂexbNALU
;

79 
p_Vid
->
f_out
 = &p_Vid->
f_ªÃxb
;

80 
	`O³nAÂexbFže
 (
p_IÅ
->
outfže
, 
p_Vid
->
f_out
);

82 
PAR_OF_RTP
:

83 
p_Vid
->
Wr™eNALU
 = 
Wr™eRTPNALU
;

84 
p_Vid
->
f_out
 = &p_Vid->
f_¹p
;

85 
	`O³nRTPFže
 (
p_IÅ
->
outfže
, 
p_Vid
->
f_out
);

88 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "OuuˆFžMod%d‚Ù suµÜ‹d", 
p_IÅ
->
of_mode
);

89 
	`”rÜ
(
”rÜ‹xt
,1);

93 iàÐ
p_IÅ
->
S’dAUD
 )

95 
Ën
 +ð
	`Wr™e_AUD_NALU
(
p_Vid
);

103 
Çlu
 = 
NULL
;

104 
Çlu
 = 
	`G’”©eSeq_·¿m‘”_£t_NALU
 (
p_Vid
);

105 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

106 
	`F»eNALU
 (
Çlu
);

108 #ià(
MVC_EXTENSION_ENABLE
)

109 if(
p_Vid
->
num_of_Ïy”s
==2)

111 
b™s
;

112 
Çlu
 = 
NULL
;

113 
Çlu
 = 
	`G’”©eSub£tSeq_·¿m‘”_£t_NALU
 (
p_Vid
);

114 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

115 
Ën
 +ð
b™s
;

116 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1] = 
b™s
;

117 
	`F»eNALU
 (
Çlu
);

121 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1] = 0;

126 
i
=0;i<
tÙ®_µs
;i++)

128 
Ën
 = 
	`wr™e_PPS
(
p_Vid
,†’, 
i
);

131 ià(
p_IÅ
->
G’”©eSEIMes§ge
)

133 
Çlu
 = 
NULL
;

134 
Çlu
 = 
	`G’”©eSEImes§ge_NALU
(
p_IÅ
);

135 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

136 
	`F»eNALU
 (
Çlu
);

139 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 
Ën
;

140 #ià(
MVC_EXTENSION_ENABLE
)

141 if(
p_IÅ
->
num_of_v›ws
==2)

143 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[0] = 
Ën
 -…_Vid->p_Stats->bit_ctr_parametersets_n_v[1];

147 
	}
}

149 
	$’d_of_¡»am
(
VideoP¬am‘”s
 *
p_Vid
)

151 
b™s
;

152 
NALU_t
 *
Çlu
;

154 
Çlu
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

155 
Çlu
->
¡¬tcod•»fix_Ën
 = 4;

156 
Çlu
->
fÜbidd’_b™
 = 0;

157 
Çlu
->
Çl_»ã»nû_idc
 = 0;

158 
Çlu
->
Çl_un™_ty³
 = 
NALU_TYPE_EOSTREAM
;

159 
Çlu
->
Ën
 = 0;

160 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

162 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts
 +ð
b™s
;

163 
	`F»eNALU
 (
Çlu
);

164  
b™s
;

165 
	}
}

174 
	$»wr™e_·¿m£ts
(
VideoP¬am‘”s
 *
p_Vid
)

176 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

177 
i
,
Ën
=0, 
tÙ®_µs
 = (
p_IÅ
->
G’”©eMuÉËPPS
) ? 3 : 1;

178 
NALU_t
 *
Çlu
;

181 iàÐ
p_IÅ
->
S’dAUD
 )

183 
Ën
 +ð
	`Wr™e_AUD_NALU
(
p_Vid
);

191 
Çlu
 = 
NULL
;

192 
Çlu
 = 
	`G’”©eSeq_·¿m‘”_£t_NALU
 (
p_Vid
);

193 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

194 
	`F»eNALU
 (
Çlu
);

196 #ià(
MVC_EXTENSION_ENABLE
)

197 if(
p_Vid
->
num_of_Ïy”s
==2)

199 
b™s
;

200 
Çlu
 = 
	`G’”©eSub£tSeq_·¿m‘”_£t_NALU
 (
p_Vid
);

201 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

202 
Ën
 +ð
b™s
;

203 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1] = 
b™s
;

204 
	`F»eNALU
 (
Çlu
);

209 
i
=0;i<
tÙ®_µs
;i++)

211 
Ën
 = 
	`wr™e_PPS
(
p_Vid
,†’, 
i
);

214 ià(
p_IÅ
->
G’”©eSEIMes§ge
)

216 
Çlu
 = 
NULL
;

217 
Çlu
 = 
	`G’”©eSEImes§ge_NALU
(
p_IÅ
);

218 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

219 
	`F»eNALU
 (
Çlu
);

222 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 
Ën
;

223 #ià(
MVC_EXTENSION_ENABLE
)

224 if(
p_IÅ
->
num_of_v›ws
==2)

226 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[0] = 
Ën
 -…_Vid->p_Stats->bit_ctr_parametersets_n_v[1];

230 
	}
}

239 
	$‹rmš©e_£qu’û
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

246 
p_IÅ
->
of_mode
)

248 
PAR_OF_ANNEXB
:

249 
	`Clo£AÂexbFže
(*
p_Vid
->
f_out
);

251 
PAR_OF_RTP
:

252 
	`Clo£RTPFže
(*
p_Vid
->
f_out
);

255 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "OuuˆFžMod%d‚Ù suµÜ‹d", 
p_IÅ
->
of_mode
);

256 
	`”rÜ
(
”rÜ‹xt
,1);

259 
	}
}

	@lencod/src/fmo.c

53 
	~"glob®.h
"

55 
	~"fmo.h
"

58 
FmoG’”©eTy³0M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

59 
FmoG’”©eTy³1M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

60 
FmoG’”©eTy³2M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

61 
FmoG’”©eTy³3M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

62 
FmoG’”©eTy³4M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

63 
FmoG’”©eTy³5M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

64 
FmoG’”©eTy³6M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

67 
FmoG’”©eM­Un™ToSliûGroupM­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
);

68 
FmoG’”©eMBAm­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
* 
¥s
);

83 
	$FmoG’”©eM­Un™ToSliûGroupM­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
)

85 
p_Vid
->
PicSizeInM­Un™s
 =…_Vid->
PicHeightInM­Un™s
 *…_Vid->
PicWidthInMbs
;

88 ià(
µs
->
¦iû_group_m­_ty³
 == 6)

90 ià((
µs
->
pic_size_š_m­_un™s_mšus1
+1è!ð
p_Vid
->
PicSizeInM­Un™s
)

92 
	`”rÜ
 ("wrong…ps->pic_size_in_map_units_minus1 for used SPS‡nd FMOype 6", 500);

97 ià(
p_Vid
->
M­Un™ToSliûGroupM­
)

98 
	`ä“
 (
p_Vid
->
M­Un™ToSliûGroupM­
);

100 ià((
p_Vid
->
M­Un™ToSliûGroupM­
 = 
	`m®loc
 (Õ_Vid->
PicSizeInM­Un™s
è*  (
by‹
))è=ð
NULL
)

102 
	`´štf
 ("ÿÂÙ‡Îoÿ‹d %d by‹ fÜ…_Vid->M­Un™ToSliûGroupM­ ,ƒx™\n", (èÐ
p_Vid
->
PicSizeInM­Un™s
 *  (
by‹
)));

103 
	`ex™
 (-1);

106 ià(
µs
->
num_¦iû_groups_mšus1
 == 0)

108 
	`mem£t
 (
p_Vid
->
M­Un™ToSliûGroupM­
, 0,…_Vid->
PicSizeInM­Un™s
 *  (
by‹
));

112 
µs
->
¦iû_group_m­_ty³
)

115 
	`FmoG’”©eTy³0M­Un™M­
 (
p_Vid
, 
µs
);

118 
	`FmoG’”©eTy³1M­Un™M­
 (
p_Vid
, 
µs
);

121 
	`FmoG’”©eTy³2M­Un™M­
 (
p_Vid
, 
µs
);

124 
	`FmoG’”©eTy³3M­Un™M­
 (
p_Vid
, 
µs
);

127 
	`FmoG’”©eTy³4M­Un™M­
 (
p_Vid
, 
µs
);

130 
	`FmoG’”©eTy³5M­Un™M­
 (
p_Vid
, 
µs
);

133 
	`FmoG’”©eTy³6M­Un™M­
 (
p_Vid
, 
µs
);

136 
	`´štf
 ("IÎeg® sliû_group_m­_ty³ %d ,ƒx™ \n", 
µs
->
¦iû_group_m­_ty³
);

137 
	`ex™
 (-1);

140 
	}
}

155 
	$FmoG’”©eMBAm­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
* 
¥s
)

157 
i
;

160 ià(
p_Vid
->
MBAm­
)

161 
	`ä“
 (
p_Vid
->
MBAm­
);

164 ià((
p_Vid
->
MBAm­
 = 
	`m®loc
 (Õ_Vid->
PicSizeInMbs
è*  (
by‹
))è=ð
NULL
)

166 
	`´štf
 ("ÿÂÙ‡Îoÿ‹d %d by‹ fÜ…_Vid->MBAm­,ƒx™\n", (è((
p_Vid
->
PicSizeInMbs
è*  (
by‹
)));

167 
	`ex™
 (-1);

170 ià((
¥s
->
äame_mbs_Úly_æag
è|| 
p_Vid
->
f›ld_piùu»
)

172 
i
=0; i<
p_Vid
->
PicSizeInMbs
; i++)

174 
p_Vid
->
MBAm­
[
i
] =…_Vid->
M­Un™ToSliûGroupM­
 [i];

178 ià(
¥s
->
mb_ad­tive_äame_f›ld_æag
 && (! 
p_Vid
->
f›ld_piùu»
))

180 
i
=0; i<
p_Vid
->
PicSizeInMbs
; i++)

182 
p_Vid
->
MBAm­
[
i
] =…_Vid->
M­Un™ToSliûGroupM­
 [i >> 1];

187 
i
=0; i<
p_Vid
->
PicSizeInMbs
; i++)

189 
p_Vid
->
MBAm­
[
i
] =…_Vid->
M­Un™ToSliûGroupM­
 [(i/(2*p_Vid->
PicWidthInMbs
))*p_Vid->PicWidthInMbs+(i%p_Vid->PicWidthInMbs)];

193 
	}
}

209 
	$FmoIn™
(
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
, 
£q_·¿m‘”_£t_rb¥_t
 * 
¥s
)

212 #ifdeà
PRINT_FMO_MAPS


213 
i
,
j
;

214 
bÙtom
;

217 
k
;

218 
k
 = 0; k < 
MAXSLICEGROUPIDS
; k++)

219 
p_Vid
->
Fœ¡MBInSliû
[
k
] = -1;

221 
	`FmoG’”©eM­Un™ToSliûGroupM­
(
p_Vid
, 
µs
);

222 
	`FmoG’”©eMBAm­
(
p_Vid
, 
¥s
);

224 #ifdeà
PRINT_FMO_MAPS


225 
	`´štf
("\n");

226 
	`´štf
("FMO Map (Units):\n");

228 
j
=0; j<
p_Vid
->
PicHeightInM­Un™s
; j++)

230 
i
=0; i<
p_Vid
->
PicWidthInMbs
; i++)

232 
	`´štf
("%d ",
p_Vid
->
M­Un™ToSliûGroupM­
 [
i
+
j
*p_Vid->
PicWidthInMbs
]);

234 
	`´štf
("\n");

236 
	`´štf
("\n");

238 if(
¥s
->
mb_ad­tive_äame_f›ld_æag
==0)

240 
	`´štf
("FMO Map (Mb):\n");

241 
j
=0; j<(
p_Vid
->
PicSizeInMbs
/p_Vid->
PicWidthInMbs
); j++)

243 
i
=0; i<
p_Vid
->
PicWidthInMbs
; i++)

245 
	`´štf
("%d ",
p_Vid
->
MBAm­
[
i
+
j
*p_Vid->
PicWidthInMbs
]);

247 
	`´štf
("\n");

249 
	`´štf
("\n");

253 
	`´štf
("FMO Map (Mb in scan order for MBAFF):\n");

254 
j
=0; j<(
p_Vid
->
PicSizeInMbs
/p_Vid->
PicWidthInMbs
); j++)

256 
i
=0; i<
p_Vid
->
PicWidthInMbs
; i++)

258 
bÙtom
=(
j
 & 0x01);

259 
	`´štf
("%d ",
p_Vid
->
MBAm­
[(
j
-
bÙtom
)*p_Vid->
PicWidthInMbs
+
i
*2+bottom]);

261 
	`´štf
("\n");

264 
	`´štf
("\n");

271 
	}
}

280 
	$FmoUnš™
(
VideoP¬am‘”s
 *
p_Vid
)

282 ià(
p_Vid
->
MBAm­
)

284 
	`ä“
 (
p_Vid
->
MBAm­
);

285 
p_Vid
->
MBAm­
 = 
NULL
;

287 ià(
p_Vid
->
M­Un™ToSliûGroupM­
 )

289 
	`ä“
 (
p_Vid
->
M­Un™ToSliûGroupM­
 );

290 
p_Vid
->
M­Un™ToSliûGroupM­
 = 
NULL
;

293 
	}
}

307 
	$FmoG’”©eTy³0M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

309 
iGroup
, 
j
;

310 
i
 = 0;

314  
iGroup
 = 0;

315 (
iGroup
 <ð
µs
->
num_¦iû_groups_mšus1
è&& (
i
 < 
p_Vid
->
PicSizeInM­Un™s
);

316 
i
 +ð
µs
->
run_Ëngth_mšus1
[
iGroup
++] + 1)

318  
j
 = 0; j <ð
µs
->
run_Ëngth_mšus1
[ 
iGroup
 ] && 
i
 + j < 
p_Vid
->
PicSizeInM­Un™s
; j++ )

319 
p_Vid
->
M­Un™ToSliûGroupM­
 [
i
+
j
] = (
by‹
è
iGroup
;

322  
i
 < 
p_Vid
->
PicSizeInM­Un™s
 );

323 
	}
}

337 
	$FmoG’”©eTy³1M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

339 
i
;

340  
i
 = 0; i < 
p_Vid
->
PicSizeInM­Un™s
; i++ )

342 
p_Vid
->
M­Un™ToSliûGroupM­
 [
i
] = (
by‹
è(((i%p_Vid->
PicWidthInMbs
)+(((i/p_Vid->PicWidthInMbs)*(
µs
->
num_¦iû_groups_mšus1
+1))>>1))

343 %(
µs
->
num_¦iû_groups_mšus1
+1));

345 
	}
}

358 
	$FmoG’”©eTy³2M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

360 
iGroup
;

361 
i
, 
x
, 
y
;

362 
yTÝLeá
, 
xTÝLeá
, 
yBÙtomRight
, 
xBÙtomRight
;

364  
i
 = 0; i < 
p_Vid
->
PicSizeInM­Un™s
; i++ )

365 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 ] = (
by‹
è
µs
->
num_¦iû_groups_mšus1
;

367  
iGroup
 = 
µs
->
num_¦iû_groups_mšus1
 - 1 ; iGroup >= 0; iGroup-- )

369 
yTÝLeá
 = 
µs
->
tÝ_Ëá
[ 
iGroup
 ] / 
p_Vid
->
PicWidthInMbs
;

370 
xTÝLeá
 = 
µs
->
tÝ_Ëá
[ 
iGroup
 ] % 
p_Vid
->
PicWidthInMbs
;

371 
yBÙtomRight
 = 
µs
->
bÙtom_right
[ 
iGroup
 ] / 
p_Vid
->
PicWidthInMbs
;

372 
xBÙtomRight
 = 
µs
->
bÙtom_right
[ 
iGroup
 ] % 
p_Vid
->
PicWidthInMbs
;

373  
y
 = 
yTÝLeá
; y <ð
yBÙtomRight
; y++ )

374  
x
 = 
xTÝLeá
; x <ð
xBÙtomRight
; x++ )

375 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
y
 *…_Vid->
PicWidthInMbs
 + 
x
 ] = (
by‹
è
iGroup
;

377 
	}
}

391 
	$FmoG’”©eTy³3M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

393 
i
, 
k
;

394 
ËáBound
, 
tÝBound
, 
rightBound
, 
bÙtomBound
;

395 
x
, 
y
, 
xDœ
, 
yDœ
;

396 
m­Un™VaÿÁ
;

398 
m­Un™sInSliûGroup0
 = 
	`imš
((
µs
->
¦iû_group_chªge_¿‹_mšus1
 + 1è* 
p_Vid
->
¦iû_group_chªge_cyþe
,…_Vid->
PicSizeInM­Un™s
);

400  
i
 = 0; i < 
p_Vid
->
PicSizeInM­Un™s
; i++ )

401 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 ] = 2;

403 
x
 = ( 
p_Vid
->
PicWidthInMbs
 - 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 ) / 2;

404 
y
 = ( 
p_Vid
->
PicHeightInM­Un™s
 - 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 ) / 2;

406 
ËáBound
 = 
x
;

407 
tÝBound
 = 
y
;

408 
rightBound
 = 
x
;

409 
bÙtomBound
 = 
y
;

411 
xDœ
 = 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 - 1;

412 
yDœ
 = 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
;

414  
k
 = 0; k < 
p_Vid
->
PicSizeInM­Un™s
; k +ð
m­Un™VaÿÁ
 )

416 
m­Un™VaÿÁ
 = ( 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
y
 *…_Vid->
PicWidthInMbs
 + 
x
 ] == 2 );

417 ifÐ
m­Un™VaÿÁ
 )

418 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
y
 *…_Vid->
PicWidthInMbs
 + 
x
 ] = (
by‹
èÐ
k
 >ð
m­Un™sInSliûGroup0
 );

420 ifÐ
xDœ
 =ð-1 && 
x
 =ð
ËáBound
 )

422 
ËáBound
 = 
	`imax
(†eftBound - 1, 0 );

423 
x
 = 
ËáBound
;

424 
xDœ
 = 0;

425 
yDœ
 = 2 * 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 - 1;

428 ifÐ
xDœ
 =ð1 && 
x
 =ð
rightBound
 )

430 
rightBound
 = 
	`imš
ÐrightBound + 1, ()
p_Vid
->
PicWidthInMbs
 - 1 );

431 
x
 = 
rightBound
;

432 
xDœ
 = 0;

433 
yDœ
 = 1 - 2 * 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
;

436 ifÐ
yDœ
 =ð-1 && 
y
 =ð
tÝBound
 )

438 
tÝBound
 = 
	`imax
(opBound - 1, 0 );

439 
y
 = 
tÝBound
;

440 
xDœ
 = 1 - 2 * 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
;

441 
yDœ
 = 0;

444 ifÐ
yDœ
 =ð1 && 
y
 =ð
bÙtomBound
 )

446 
bÙtomBound
 = 
	`imš
ÐbÙtomBound + 1, ()
p_Vid
->
PicHeightInM­Un™s
 - 1 );

447 
y
 = 
bÙtomBound
;

448 
xDœ
 = 2 * 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 - 1;

449 
yDœ
 = 0;

453 
x
 = x + 
xDœ
;

454 
y
 = y + 
yDœ
;

458 
	}
}

471 
	$FmoG’”©eTy³4M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

474 
m­Un™sInSliûGroup0
 = 
	`imš
((
µs
->
¦iû_group_chªge_¿‹_mšus1
 + 1è* 
p_Vid
->
¦iû_group_chªge_cyþe
,…_Vid->
PicSizeInM­Un™s
);

475 
sizeOfUµ”LeáGroup
 = 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 ? ( 
p_Vid
->
PicSizeInM­Un™s
 - 
m­Un™sInSliûGroup0
 ) : mapUnitsInSliceGroup0;

477 
i
;

479  
i
 = 0; i < 
p_Vid
->
PicSizeInM­Un™s
; i++ )

480 ifÐ
i
 < 
sizeOfUµ”LeáGroup
 )

481 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 ] = (
by‹
è
µs
->
¦iû_group_chªge_dœeùiÚ_æag
;

483 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 ] = (
by‹
è(1 - 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
);

485 
	}
}

498 
	$FmoG’”©eTy³5M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

501 
m­Un™sInSliûGroup0
 = 
	`imš
((
µs
->
¦iû_group_chªge_¿‹_mšus1
 + 1è* 
p_Vid
->
¦iû_group_chªge_cyþe
,…_Vid->
PicSizeInM­Un™s
);

502 
sizeOfUµ”LeáGroup
 = 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 ? ( 
p_Vid
->
PicSizeInM­Un™s
 - 
m­Un™sInSliûGroup0
 ) : mapUnitsInSliceGroup0;

504 
i
,
j
, 
k
 = 0;

506  
j
 = 0; j < 
p_Vid
->
PicWidthInMbs
; j++ )

507  
i
 = 0; i < 
p_Vid
->
PicHeightInM­Un™s
; i++ )

508 ifÐ
k
++ < 
sizeOfUµ”LeáGroup
 )

509 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 *…_Vid->
PicWidthInMbs
 + 
j
 ] = (
by‹
è
µs
->
¦iû_group_chªge_dœeùiÚ_æag
;

511 
p_Vid
->
M­Un™ToSliûGroupM­
 [ 
i
 *…_Vid->
PicWidthInMbs
 + 
j
 ] = (
by‹
è(1 - 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
);

513 
	}
}

526 
	$FmoG’”©eTy³6M­Un™M­
 (
VideoP¬am‘”s
 * 
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 * 
µs
 )

528 
i
;

529 
i
=0; i<
p_Vid
->
PicSizeInM­Un™s
; i++)

531 
p_Vid
->
M­Un™ToSliûGroupM­
 [
i
] = (
by‹
è
µs
->
¦iû_group_id
[i];

533 
	}
}

544 
	$FmoS¹Piùu»
 (
VideoP¬am‘”s
 *
p_Vid
)

546 
i
;

548 
	`as£¹
 (
p_Vid
->
MBAm­
 !ð
NULL
);

550 
i
=0; i<
MAXSLICEGROUPIDS
; i++)

551 
p_Vid
->
Fœ¡MBInSliû
[
i
] = 
	`FmoG‘Fœ¡MBOfSliûGroup
 (p_Vid, i);

553 
	}
}

567 
	$FmoEndPiùu»
 ()

571 
	}
}

583 
	$FmoMB2SliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb
)

585 
	`as£¹
 (
mb
 < ()
p_Vid
->
PicSizeInMbs
);

586 
	`as£¹
 (
p_Vid
->
MBAm­
 !ð
NULL
);

587  
p_Vid
->
MBAm­
[
mb
];

588 
	}
}

600 
	$FmoG‘NextMBNr
 (
VideoP¬am‘”s
 *
p_Vid
, 
Cu¼’tMbNr
)

603 
SliûGroupID
 = 
	`FmoMB2SliûGroup
 (
p_Vid
, 
Cu¼’tMbNr
);

605 ++
Cu¼’tMbNr
<()
p_Vid
->
PicSizeInMbs
 &&…_Vid->
MBAm­
[Cu¼’tMbNr] !ð
SliûGroupID
)

608 ià(
Cu¼’tMbNr
 >ð()
p_Vid
->
PicSizeInMbs
)

611  
Cu¼’tMbNr
;

612 
	}
}

625 
	$FmoG‘P»viousMBNr
 (
VideoP¬am‘”s
 *
p_Vid
, 
Cu¼’tMbNr
)

628 
SliûGroupID
 = 
	`FmoMB2SliûGroup
 (
p_Vid
, 
Cu¼’tMbNr
);

629 
Cu¼’tMbNr
--;

630 
Cu¼’tMbNr
>=0 && 
p_Vid
->
MBAm­
[Cu¼’tMbNr] !ð
SliûGroupID
)

631 
Cu¼’tMbNr
--;

633 ià(
Cu¼’tMbNr
 < 0)

636  
Cu¼’tMbNr
;

637 
	}
}

650 
	$FmoG‘Fœ¡MBOfSliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
)

652 
i
 = 0;

653 (
i
<()
p_Vid
->
PicSizeInMbs
è&& (
	`FmoMB2SliûGroup
 (p_Vid, iè!ð
SliûGroupID
))

654 
i
++;

656 ià(
i
 < ()
p_Vid
->
PicSizeInMbs
)

657  
i
;

660 
	}
}

676 
	$FmoG‘La¡CodedMBOfSliûGroup
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
)

678 
i
;

679 
La¡MB
 = -1;

681 
i
=0; i<()
p_Vid
->
PicSizeInMbs
; i++)

682 ià(
	`FmoMB2SliûGroup
 (
p_Vid
, 
i
è=ð
SliûGroupID
)

683 
La¡MB
 = 
i
;

684  
La¡MB
;

685 
	}
}

688 
	$FmoS‘La¡MaüoblockInSliû
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
mb
)

694 
cu¼SliûGroup
 = 
	`FmoMB2SliûGroup
 (
p_Vid
, 
mb
);

695 
	`as£¹
 (
mb
 >= 0);

696 
mb
 = 
	`FmoG‘NextMBNr
 (
p_Vid
, mb);

697 
p_Vid
->
Fœ¡MBInSliû
[
cu¼SliûGroup
] = 
mb
;

698 
	}
}

700 
	$FmoG‘Fœ¡MaüoblockInSliû
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroup
)

702  
p_Vid
->
Fœ¡MBInSliû
[
SliûGroup
];

705 
	}
}

708 
	$FmoSliûGroupCom¶‘–yCoded
Ð
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupID
)

710 ià(
	`FmoG‘Fœ¡MaüoblockInSliû
 (
p_Vid
, 
SliûGroupID
) < 0)

711  
TRUE
;

713  
FALSE
;

714 
	}
}

	@lencod/src/get_block_otf.c

12 
	~"glob®.h
"

13 
	~"block.h
"

15 
	~"maüoblock.h
"

16 
	~"image.h
"

17 
	~"mb_acûss.h
"

18 
	~"g‘_block_Ùf.h
"

19 
	~"»fbuf_Ùf.h
"

29 
	$g‘_block_00
(
img³l
 *
block
, img³È*
cur_img
, 
block_size_y
, 
block_size_x
, 
shiá_x
)

31 
j
;

33 
j
 = 0; j < 
block_size_y
; j += 1)

35 
	`memýy
(
block
, 
cur_img
, 
block_size_x
 * (
img³l
));

36 
block
 +ð
block_size_x
 ;

37 
cur_img
 +ð
shiá_x
;

39 
	}
}

47 
	$g‘_luma_10
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
 , 
max_img³l_v®ue
)

49 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

50 
img³l
 *
Üig_lše
, *
cur_lše
;

51 
i
, 
j
;

52 
»suÉ
;

54 
j
 = 0; j < 
block_size_y
; j++)

56 
cur_lše
 = &(
cur_imgY
[
j
][
x_pos
]);

57 
p0
 = &
cur_imgY
[
j
][
x_pos
 - 2];

58 
p1
 = 
p0
 + 1;

59 
p2
 = 
p1
 + 1;

60 
p3
 = 
p2
 + 1;

61 
p4
 = 
p3
 + 1;

62 
p5
 = 
p4
 + 1;

63 
Üig_lše
 = 
block
+
j
*
block_size_x
;

65 
i
 = 0; i < 
block_size_x
; i++)

67 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

69 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

70 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lše
++) + 1 ) >> 1);

71 
Üig_lše
++;

74 
	}
}

82 
	$g‘_luma_20
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
 , 
max_img³l_v®ue
)

84 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

85 
img³l
 *
Üig_lše
;

86 
i
, 
j
;

87 
»suÉ
;

89 
j
 = 0; j < 
block_size_y
; j++)

91 
p0
 = &
cur_imgY
[
j
][
x_pos
 - 2];

92 
p1
 = 
p0
 + 1;

93 
p2
 = 
p1
 + 1;

94 
p3
 = 
p2
 + 1;

95 
p4
 = 
p3
 + 1;

96 
p5
 = 
p4
 + 1;

97 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

99 
i
 = 0; i < 
block_size_x
; i++)

101 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

103 *
Üig_lše
++ = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

106 
	}
}

114 
	$g‘_luma_30
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
 , 
max_img³l_v®ue
)

116 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

117 
img³l
 *
Üig_lše
, *
cur_lše
;

118 
i
, 
j
;

119 
»suÉ
;

121 
j
 = 0; j < 
block_size_y
; j++)

123 
cur_lše
 = &(
cur_imgY
[
j
][
x_pos
 + 1]);

124 
p0
 = &
cur_imgY
[
j
][
x_pos
 - 2];

125 
p1
 = 
p0
 + 1;

126 
p2
 = 
p1
 + 1;

127 
p3
 = 
p2
 + 1;

128 
p4
 = 
p3
 + 1;

129 
p5
 = 
p4
 + 1;

130 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

132 
i
 = 0; i < 
block_size_x
; i++)

134 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

136 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

137 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lše
++) + 1 ) >> 1);

138 
Üig_lše
++;

141 
	}
}

150 
	$g‘_luma_01
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

152 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

153 
img³l
 *
Üig_lše
, *
cur_lše
;

154 
i
, 
j
;

155 
»suÉ
;

156 
jj
 = 0;

157 
p0
 = &(
cur_imgY
[ - 2][
x_pos
]);

158 
j
 = 0; j < 
block_size_y
; j++)

160 
p1
 = 
p0
 + 
shiá_x
;

161 
p2
 = 
p1
 + 
shiá_x
;

162 
p3
 = 
p2
 + 
shiá_x
;

163 
p4
 = 
p3
 + 
shiá_x
;

164 
p5
 = 
p4
 + 
shiá_x
;

165 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

166 
cur_lše
 = &(
cur_imgY
[
jj
++][
x_pos
]);

168 
i
 = 0; i < 
block_size_x
; i++)

170 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

172 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

173 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lše
++) + 1 ) >> 1);

174 
Üig_lše
++;

176 
p0
 = 
p1
 - 
block_size_x
;

178 
	}
}

186 
	$g‘_luma_02
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

188 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

189 
img³l
 *
Üig_lše
;

190 
i
, 
j
;

191 
»suÉ
;

192 
p0
 = &(
cur_imgY
[ - 2][
x_pos
]);

193 
j
 = 0; j < 
block_size_y
; j++)

195 
p1
 = 
p0
 + 
shiá_x
;

196 
p2
 = 
p1
 + 
shiá_x
;

197 
p3
 = 
p2
 + 
shiá_x
;

198 
p4
 = 
p3
 + 
shiá_x
;

199 
p5
 = 
p4
 + 
shiá_x
;

200 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

202 
i
 = 0; i < 
block_size_x
; i++)

204 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

206 *
Üig_lše
++ = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

208 
p0
 = 
p1
 - 
block_size_x
;

210 
	}
}

219 
	$g‘_luma_03
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

221 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

222 
img³l
 *
Üig_lše
, *
cur_lše
;

223 
i
, 
j
;

224 
»suÉ
;

225 
jj
 = 1;

227 
p0
 = &(
cur_imgY
[ -2][
x_pos
]);

228 
j
 = 0; j < 
block_size_y
; j++)

230 
p1
 = 
p0
 + 
shiá_x
;

231 
p2
 = 
p1
 + 
shiá_x
;

232 
p3
 = 
p2
 + 
shiá_x
;

233 
p4
 = 
p3
 + 
shiá_x
;

234 
p5
 = 
p4
 + 
shiá_x
;

235 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

236 
cur_lše
 = &(
cur_imgY
[
jj
++][
x_pos
]);

238 
i
 = 0; i < 
block_size_x
; i++)

240 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

242 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

243 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lše
++) + 1 ) >> 1);

244 
Üig_lše
++;

246 
p0
 = 
p1
 - 
block_size_x
;

248 
	}
}

256 
	$g‘_luma_21
(
img³l
 *
block
, img³È**
cur_imgY
, *
tmp_»s
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
max_img³l_v®ue
)

258 
i
, 
j
;

260 *
tmp_lše
;

261 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

262 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

263 
img³l
 *
Üig_lše
;

264 
»suÉ
;

266 
jj
 = -2;

268 
j
 = 0; j < 
block_size_y
 + 5; j++)

270 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

271 
p1
 = 
p0
 + 1;

272 
p2
 = 
p1
 + 1;

273 
p3
 = 
p2
 + 1;

274 
p4
 = 
p3
 + 1;

275 
p5
 = 
p4
 + 1;

276 
tmp_lše
 = 
tmp_»s
 + 
j
*
block_size_x
 ;

278 
i
 = 0; i < 
block_size_x
; i++)

280 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

284 
jj
 = 2;

285 
j
 = 0; j < 
block_size_y
; j++)

287 
tmp_lše
 = 
tmp_»s
+ 
jj
*
block_size_x
; jj++;

288 
x0
 = 
tmp_»s
 + 
j
*
block_size_x
 ;

289 
x1
 = 
tmp_»s
 + (
j
 + 1)*
block_size_x
;

290 
x2
 = 
tmp_»s
 + (
j
 + 2)*
block_size_x
;

291 
x3
 = 
tmp_»s
 + (
j
 + 3)*
block_size_x
;

292 
x4
 = 
tmp_»s
 + (
j
 + 4)*
block_size_x
;

293 
x5
 = 
tmp_»s
 + (
j
 + 5)*
block_size_x
;

294 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

296 
i
 = 0; i < 
block_size_x
; i++)

298 
»suÉ
 = (*
x0
++ + *
x5
++è- 5 * (*
x1
++ + *
x4
++è+ 20 * (*
x2
++ + *
x3
++);

300 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

301 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16) >> 5)) + 1 )>> 1);

302 
Üig_lše
++;

305 
	}
}

313 
	$g‘_luma_22
(
img³l
 *
block
, img³È**
cur_imgY
, *
tmp_»s
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
max_img³l_v®ue
)

315 
i
, 
j
;

317 *
tmp_lše
;

318 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

319 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

320 
img³l
 *
Üig_lše
;

321 
»suÉ
;

323 
jj
 = - 2;

325 
j
 = 0; j < 
block_size_y
 + 5; j++)

327 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

328 
p1
 = 
p0
 + 1;

329 
p2
 = 
p1
 + 1;

330 
p3
 = 
p2
 + 1;

331 
p4
 = 
p3
 + 1;

332 
p5
 = 
p4
 + 1;

333 
tmp_lše
 = 
tmp_»s
 + 
j
*
block_size_x
;

335 
i
 = 0; i < 
block_size_x
; i++)

337 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

341 
j
 = 0; j < 
block_size_y
; j++)

343 
x0
 = 
tmp_»s
 + 
j
*
block_size_x
 ;

344 
x1
 = 
tmp_»s
 + (
j
 + 1)*
block_size_x
;

345 
x2
 = 
tmp_»s
 + (
j
 + 2)*
block_size_x
;

346 
x3
 = 
tmp_»s
 + (
j
 + 3)*
block_size_x
;

347 
x4
 = 
tmp_»s
 + (
j
 + 4)*
block_size_x
;

348 
x5
 = 
tmp_»s
 + (
j
 + 5)*
block_size_x
;

349 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

351 
i
 = 0; i < 
block_size_x
; i++)

353 
»suÉ
 = (*
x0
++ + *
x5
++è- 5 * (*
x1
++ + *
x4
++è+ 20 * (*
x2
++ + *
x3
++);

355 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

358 
	}
}

366 
	$g‘_luma_23
(
img³l
 *
block
, img³È**
cur_imgY
, *
tmp_»s
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
max_img³l_v®ue
)

368 
i
, 
j
;

370 *
tmp_lše
;

371 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

372 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

373 
img³l
 *
Üig_lše
;

374 
»suÉ
;

376 
jj
 = -2;

378 
j
 = 0; j < 
block_size_y
 + 5; j++)

380 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

381 
p1
 = 
p0
 + 1;

382 
p2
 = 
p1
 + 1;

383 
p3
 = 
p2
 + 1;

384 
p4
 = 
p3
 + 1;

385 
p5
 = 
p4
 + 1;

386 
tmp_lše
 = 
tmp_»s
 + 
j
*
block_size_x
;

388 
i
 = 0; i < 
block_size_x
; i++)

390 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

394 
jj
 = 3;

395 
j
 = 0; j < 
block_size_y
; j++)

397 
tmp_lše
 = 
tmp_»s
+ 
jj
*
block_size_x
; jj++;

398 
x0
 = 
tmp_»s
 + 
j
*
block_size_x
 ;

399 
x1
 = 
tmp_»s
 + (
j
 + 1)*
block_size_x
;

400 
x2
 = 
tmp_»s
 + (
j
 + 2)*
block_size_x
;

401 
x3
 = 
tmp_»s
 + (
j
 + 3)*
block_size_x
;

402 
x4
 = 
tmp_»s
 + (
j
 + 4)*
block_size_x
;

403 
x5
 = 
tmp_»s
 + (
j
 + 5)*
block_size_x
;

404 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

406 
i
 = 0; i < 
block_size_x
; i++)

408 
»suÉ
 = (*
x0
++ + *
x5
++è- 5 * (*
x1
++ + *
x4
++è+ 20 * (*
x2
++ + *
x3
++);

410 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

411 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16) >> 5)) + 1 )>> 1);

412 
Üig_lše
++;

415 
	}
}

423 
	$g‘_luma_12
(
img³l
 *
block
, img³È**
cur_imgY
, *
tmp_»s
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

425 
i
, 
j
;

426 *
tmp_lše
;

427 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

428 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

429 
img³l
 *
Üig_lše
;

430 
»suÉ
;

432 
p0
 = &(
cur_imgY
[ -2][
x_pos
 - 2]);

433 
j
 = 0; j < 
block_size_y
; j++)

435 
p1
 = 
p0
 + 
shiá_x
;

436 
p2
 = 
p1
 + 
shiá_x
;

437 
p3
 = 
p2
 + 
shiá_x
;

438 
p4
 = 
p3
 + 
shiá_x
;

439 
p5
 = 
p4
 + 
shiá_x
;

440 
tmp_lše
 = 
tmp_»s
 + 
j
*(
block_size_x
+5);

442 
i
 = 0; i < 
block_size_x
 + 5; i++)

444 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

446 
p0
 = 
p1
 - (
block_size_x
 + 5);

449 
j
 = 0; j < 
block_size_y
; j++)

451 
tmp_lše
 = 
tmp_»s
 + 
j
*(
block_size_x
+5) + 2 ;

452 
Üig_lše
 = 
block
 + 
j
*
block_size_x
 ;

453 
x0
 = 
tmp_»s
 + 
j
*(
block_size_x
+5) ;

454 
x1
 = 
x0
 + 1;

455 
x2
 = 
x1
 + 1;

456 
x3
 = 
x2
 + 1;

457 
x4
 = 
x3
 + 1;

458 
x5
 = 
x4
 + 1;

460 
i
 = 0; i < 
block_size_x
; i++)

462 
»suÉ
 = (*(
x0
++è+ *(
x5
++)è- 5 * (*(
x1
++è+ *(
x4
++)è+ 20 * (*(
x2
++è+ *(
x3
++));

464 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

465 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16)>>5))+1)>>1);

466 
Üig_lše
 ++;

469 
	}
}

477 
	$g‘_luma_32
(
img³l
 *
block
, img³È**
cur_imgY
, *
tmp_»s
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

479 
i
, 
j
;

480 *
tmp_lše
;

481 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

482 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

483 
img³l
 *
Üig_lše
;

484 
»suÉ
;

486 
p0
 = &(
cur_imgY
[ -2][
x_pos
 - 2]);

487 
j
 = 0; j < 
block_size_y
; j++)

489 
p1
 = 
p0
 + 
shiá_x
;

490 
p2
 = 
p1
 + 
shiá_x
;

491 
p3
 = 
p2
 + 
shiá_x
;

492 
p4
 = 
p3
 + 
shiá_x
;

493 
p5
 = 
p4
 + 
shiá_x
;

494 
tmp_lše
 = 
tmp_»s
 + 
j
*(
block_size_x
+5);

496 
i
 = 0; i < 
block_size_x
 + 5; i++)

498 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

500 
p0
 = 
p1
 - (
block_size_x
 + 5);

503 
j
 = 0; j < 
block_size_y
; j++)

505 
tmp_lše
 = 
tmp_»s
 + 
j
*(
block_size_x
+5) + 3;

506 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

507 
x0
 = 
tmp_»s
 + 
j
*(
block_size_x
+5);

508 
x1
 = 
x0
 + 1;

509 
x2
 = 
x1
 + 1;

510 
x3
 = 
x2
 + 1;

511 
x4
 = 
x3
 + 1;

512 
x5
 = 
x4
 + 1;

514 
i
 = 0; i < 
block_size_x
; i++)

516 
»suÉ
 = (*(
x0
++è+ *(
x5
++)è- 5 * (*(
x1
++è+ *(
x4
++)è+ 20 * (*(
x2
++è+ *(
x3
++));

518 *
Üig_lše
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

519 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16)>>5))+1)>>1);

520 
Üig_lše
 ++;

523 
	}
}

531 
	$g‘_luma_33
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

533 
i
, 
j
;

534 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

535 
img³l
 *
Üig_lše
;

536 
»suÉ
;

538 
jj
 = 1;

540 
j
 = 0; j < 
block_size_y
; j++)

542 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

543 
p1
 = 
p0
 + 1;

544 
p2
 = 
p1
 + 1;

545 
p3
 = 
p2
 + 1;

546 
p4
 = 
p3
 + 1;

547 
p5
 = 
p4
 + 1;

549 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

551 
i
 = 0; i < 
block_size_x
; i++)

553 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

555 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

559 
p0
 = &(
cur_imgY
[-2][
x_pos
 + 1]);

560 
j
 = 0; j < 
block_size_y
; j++)

562 
p1
 = 
p0
 + 
shiá_x
;

563 
p2
 = 
p1
 + 
shiá_x
;

564 
p3
 = 
p2
 + 
shiá_x
;

565 
p4
 = 
p3
 + 
shiá_x
;

566 
p5
 = 
p4
 + 
shiá_x
;

567 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

569 
i
 = 0; i < 
block_size_x
; i++)

571 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

573 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16) >> 5)) + 1) >> 1);

574 
Üig_lše
++;

576 
p0
 = 
p1
 - 
block_size_x
 ;

578 
	}
}

587 
	$g‘_luma_11
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

589 
i
, 
j
;

590 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

591 
img³l
 *
Üig_lše
;

592 
»suÉ
;

594 
jj
 = 0;

596 
j
 = 0; j < 
block_size_y
; j++)

598 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

599 
p1
 = 
p0
 + 1;

600 
p2
 = 
p1
 + 1;

601 
p3
 = 
p2
 + 1;

602 
p4
 = 
p3
 + 1;

603 
p5
 = 
p4
 + 1;

605 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

607 
i
 = 0; i < 
block_size_x
; i++)

609 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

611 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

615 
p0
 = &(
cur_imgY
[-2][
x_pos
]);

616 
j
 = 0; j < 
block_size_y
; j++)

618 
p1
 = 
p0
 + 
shiá_x
;

619 
p2
 = 
p1
 + 
shiá_x
;

620 
p3
 = 
p2
 + 
shiá_x
;

621 
p4
 = 
p3
 + 
shiá_x
;

622 
p5
 = 
p4
 + 
shiá_x
;

623 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

625 
i
 = 0; i < 
block_size_x
; i++)

627 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

629 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16) >> 5)) + 1) >> 1);

630 
Üig_lše
++;

632 
p0
 = 
p1
 - 
block_size_x
 ;

634 
	}
}

642 
	$g‘_luma_13
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

645 
i
, 
j
;

646 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

647 
img³l
 *
Üig_lše
;

648 
»suÉ
;

650 
jj
 = 1;

652 
j
 = 0; j < 
block_size_y
; j++)

654 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

655 
p1
 = 
p0
 + 1;

656 
p2
 = 
p1
 + 1;

657 
p3
 = 
p2
 + 1;

658 
p4
 = 
p3
 + 1;

659 
p5
 = 
p4
 + 1;

661 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

663 
i
 = 0; i < 
block_size_x
; i++)

665 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

667 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

671 
p0
 = &(
cur_imgY
[-2][
x_pos
]);

672 
j
 = 0; j < 
block_size_y
; j++)

674 
p1
 = 
p0
 + 
shiá_x
;

675 
p2
 = 
p1
 + 
shiá_x
;

676 
p3
 = 
p2
 + 
shiá_x
;

677 
p4
 = 
p3
 + 
shiá_x
;

678 
p5
 = 
p4
 + 
shiá_x
;

679 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

681 
i
 = 0; i < 
block_size_x
; i++)

683 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

685 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16) >> 5)) + 1) >> 1);

686 
Üig_lše
++;

688 
p0
 = 
p1
 - 
block_size_x
 ;

690 
	}
}

698 
	$g‘_luma_31
(
img³l
 *
block
, img³È**
cur_imgY
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
shiá_x
, 
max_img³l_v®ue
)

701 
i
, 
j
;

702 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

703 
img³l
 *
Üig_lše
;

704 
»suÉ
;

706 
jj
 = 0;

708 
j
 = 0; j < 
block_size_y
; j++)

710 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

711 
p1
 = 
p0
 + 1;

712 
p2
 = 
p1
 + 1;

713 
p3
 = 
p2
 + 1;

714 
p4
 = 
p3
 + 1;

715 
p5
 = 
p4
 + 1;

717 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

719 
i
 = 0; i < 
block_size_x
; i++)

721 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

723 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

727 
p0
 = &(
cur_imgY
[-2][
x_pos
 + 1]);

728 
j
 = 0; j < 
block_size_y
; j++)

730 
p1
 = 
p0
 + 
shiá_x
;

731 
p2
 = 
p1
 + 
shiá_x
;

732 
p3
 = 
p2
 + 
shiá_x
;

733 
p4
 = 
p3
 + 
shiá_x
;

734 
p5
 = 
p4
 + 
shiá_x
;

735 
Üig_lše
 = 
block
 + 
j
*
block_size_x
;

737 
i
 = 0; i < 
block_size_x
; i++)

739 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è- 5 * (*(
p1
++è+ *(
p4
++)è+ 20 * (*(
p2
++è+ *(
p3
++));

741 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16) >> 5)) + 1) >> 1);

742 
Üig_lše
++;

744 
p0
 = 
p1
 - 
block_size_x
 ;

746 
	}
}

755 
šlše
 
	$g‘_block_luma_Ùf
Ð
VideoP¬am‘”s
 *
p_Vid
,

756 
img³l
* 
m´ed
,

757 * 
tmp_´ed
,

758 
pic_pix_x
,

759 
pic_pix_y
,

760 
block_size_x
,

761 
block_size_y
,

762 
StÜabËPiùu»
 *
»f
,

763 
¶


766 
img³l
 **
»f_block
 = (
p_Vid
->
P444_jošed
 && 
¶
>
PLANE_Y
)? 
»f
->
imgUV
[¶-1] :„ef->
imgY
;

767 
dx
 = (
pic_pix_x
 & 0x03);

768 
dy
 = (
pic_pix_y
 & 0x03);

769 
x_pos
 = 
	`iCl3
(-
IMG_PAD_SIZE_X
+2, 
»f
->
size_x_·d
-2, 
pic_pix_x
>>2);

770 
y_pos
 = 
	`iCl3
(-
IMG_PAD_SIZE_Y
+2, 
»f
->
size_y_·d
-2, 
pic_pix_y
>>2);

772 ià(
dx
 =ð0 && 
dy
 == 0)

773 
	`g‘_block_00
(
m´ed
, &(
»f_block
[
y_pos
][
x_pos
]), 
block_size_y
, 
block_size_x
, 
p_Vid
->
·dded_size_x
);

776 ià(
dy
 == 0)

778 ià(
dx
 == 1)

779 
	`g‘_luma_10
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

780 ià(
dx
 == 2)

781 
	`g‘_luma_20
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

783 
	`g‘_luma_30
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

785 ià(
dx
 == 0)

787 ià(
dy
 == 1)

788 
	`g‘_luma_01
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

789 ià(
dy
 == 2)

790 
	`g‘_luma_02
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

792 
	`g‘_luma_03
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

794 ià(
dx
 == 2)

796 ià(
dy
 == 1)

797 
	`g‘_luma_21
(
m´ed
, &
»f_block
[
y_pos
], 
tmp_´ed
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

798 ià(
dy
 == 2)

799 
	`g‘_luma_22
(
m´ed
, &
»f_block
[
y_pos
], 
tmp_´ed
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

801 
	`g‘_luma_23
(
m´ed
, &
»f_block
[
y_pos
], 
tmp_´ed
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
max_img³l_v®ue
);

803 ià(
dy
 == 2)

805 ià(
dx
 == 1)

806 
	`g‘_luma_12
(
m´ed
, &
»f_block
[
y_pos
], 
tmp_´ed
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

808 
	`g‘_luma_32
(
m´ed
, &
»f_block
[
y_pos
], 
tmp_´ed
, 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

812 ià(
dx
 == 1)

814 ià(
dy
 == 1)

815 
	`g‘_luma_11
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

817 
	`g‘_luma_13
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

821 ià(
dy
 == 1)

822 
	`g‘_luma_31
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

824 
	`g‘_luma_33
(
m´ed
, &
»f_block
[
y_pos
], 
block_size_y
, 
block_size_x
, 
x_pos
, 
p_Vid
->
·dded_size_x
,…_Vid->
max_img³l_v®ue
);

828 
	}
}

830 
	$g‘_block_luma_Ùf_L2
Ð
VideoP¬am‘”s
 *
p_Vid
,

831 
img³l
* 
m´ed
,

832 * 
tmp_´ed
,

833 
pic_pix_x
,

834 
pic_pix_y
,

835 
block_size_x
,

836 
block_size_y
,

837 
StÜabËPiùu»
 *
»f
,

838 
¶


841 
	`g‘_block_luma_Ùf
Ð
p_Vid
, 
m´ed
, 
tmp_´ed
, 
pic_pix_x
, 
pic_pix_y
, 
block_size_x
, 
block_size_y
, 
»f
, 
¶
 ) ;

842 
	}
}

844 
	$g‘_block_luma_Ùf_L1
Ð
VideoP¬am‘”s
 *
p_Vid
,

845 
img³l
* 
m´ed
,

846 * 
tmp_´ed
,

847 
pic_pix_x
,

848 
pic_pix_y
,

849 
block_size_x
,

850 
block_size_y
,

851 
StÜabËPiùu»
 *
»f
,

852 
¶


855 ifÐ
	`is_q³l
Ð
pic_pix_x
, 
pic_pix_y
, 0x03, 0x03 ) )

857 
	`g‘_block_luma_Ùf
Ð
p_Vid
, 
m´ed
, 
tmp_´ed
, 
pic_pix_x
, 
pic_pix_y
, 
block_size_x
, 
block_size_y
, 
»f
, 
¶
 ) ;

861 
j
;

862 
img³l
 *
»f_lše
 ;

863 
»f
->
p_cu¼_img_sub
 = (
p_Vid
->
P444_jošed
 && 
¶
>
PLANE_Y
è? (»f->
imgUV_sub
[¶-1]):Ôef->
imgY_sub
);

864 
»f_lše
 = 
	`UMVLše4X_Ùf
 ( 
»f
, 
pic_pix_y
, 
pic_pix_x
 ) ;

865 
j
 = 0; j < 
block_size_y
; j++)

867 
	`memýy
(
m´ed
, 
»f_lše
, 
block_size_x
 * (
img³l
));

868 
»f_lše
 +ð
p_Vid
->
·dded_size_x
;

869 
m´ed
 +ð
block_size_x
;

872 
	}
}

880 
	$g‘_chroma_0X
(
img³l
 *
block
, img³È*
cur_img
, 
¥ª
, 
block_size_y
, 
block_size_x
, 
w00
, 
w01
, 
tÙ®_sÿË
)

882 
img³l
 *
cur_row
 = 
cur_img
;

883 
img³l
 *
nxt_row
 = 
cur_img
 + 
¥ª
;

886 
img³l
 *
cur_lše
, *
cur_lše_p1
;

887 
img³l
 *
blk_lše
;

888 
»suÉ
;

889 
i
, 
j
;

890 
j
 = 0; j < 
block_size_y
; j++)

892 
cur_lše
 = 
cur_row
;

893 
cur_lše_p1
 = 
nxt_row
;

894 
blk_lše
 = 
block
;

895 
block
 +ð
block_size_x
 ;

896 
cur_row
 = 
nxt_row
;

897 
nxt_row
 +ð
¥ª
;

898 
i
 = 0; i < 
block_size_x
; i++)

900 
»suÉ
 = (
w00
 * *
cur_lše
++ + 
w01
 * *
cur_lše_p1
++);

901 *(
blk_lše
++èð(
img³l
è
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
);

904 
	}
}

912 
	$g‘_chroma_X0
(
img³l
 *
block
, img³È*
cur_img
, 
¥ª
, 
block_size_y
, 
block_size_x
, 
w00
, 
w10
, 
tÙ®_sÿË
)

914 
img³l
 *
cur_row
 = 
cur_img
;

915 
img³l
 *
cur_lše
, *
cur_lše_p1
;

916 
img³l
 *
blk_lše
;

917 
»suÉ
;

918 
i
, 
j
;

919 
j
 = 0; j < 
block_size_y
; j++)

921 
cur_lše
 = 
cur_row
;

922 
cur_lše_p1
 = 
cur_lše
 + 1;

923 
blk_lše
 = 
block
;

924 
block
 +ð
block_size_x
 ;

925 
cur_row
 +ð
¥ª
;

926 
i
 = 0; i < 
block_size_x
; i++)

928 
»suÉ
 = (
w00
 * *
cur_lše
++ + 
w10
 * *
cur_lše_p1
++);

930 *(
blk_lše
++èð(
img³l
è
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
);

933 
	}
}

942 
	$g‘_chroma_XX
(
img³l
 *
block
, img³È*
cur_img
, 
¥ª
, 
block_size_y
, 
block_size_x
, 
w00
, 
w01
, 
w10
, 
w11
, 
tÙ®_sÿË
)

944 
img³l
 *
cur_row
 = 
cur_img
;

945 
img³l
 *
nxt_row
 = 
cur_img
 + 
¥ª
;

946 
img³l
 *
cur_lše
, *
cur_lše_p1
;

947 
img³l
 *
blk_lše
;

948 
»suÉ
;

949 
i
, 
j
;

950 
j
 = 0; j < 
block_size_y
; j++)

952 
cur_lše
 = 
cur_row
;

953 
cur_lše_p1
 = 
nxt_row
;

954 
blk_lše
 = 
block
;

955 
block
 +ð
block_size_x
 ;

956 
cur_row
 = 
nxt_row
;

957 
nxt_row
 +ð
¥ª
;

958 
i
 = 0; i < 
block_size_x
; i++)

960 
»suÉ
 = (
w00
 * *(
cur_lše
++è+ 
w01
 * *(
cur_lše_p1
++));

961 
»suÉ
 +ð(
w10
 * *(
cur_lše
 ) + 
w11
 * *(
cur_lše_p1
 ));

962 *(
blk_lše
++èð(
img³l
è
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
);

966 
	}
}

968 
šlše
 
	$g‘_block_chroma_Ùf
 ( 
VideoP¬am‘”s
 *
p_Vid
,

969 
img³l
* 
m´ed
,

970 * 
tmp_´ed
,

971 
pic_pix_x
,

972 
pic_pix_y
,

973 
block_size_x
,

974 
block_size_y
,

975 
StÜabËPiùu»
 *
»f
,

976 
uv
 )

978 
dx
 = (
pic_pix_x
 & 
p_Vid
->
chroma_mask_mv_x
) ;

979 
dy
 = (
pic_pix_y
 & 
p_Vid
->
chroma_mask_mv_y
) ;

980 
x_pos
 = 
	`iCl3
(-
»f
->
·d_size_uv_x
+1,„ef->
size_x_ü_·d
-1, 
pic_pix_x
 >> 
p_Vid
->
chroma_shiá_x
) ;

981 
y_pos
 = 
	`iCl3
(-
»f
->
·d_size_uv_y
+1,„ef->
size_y_ü_·d
-1, 
pic_pix_y
 >> 
p_Vid
->
chroma_shiá_y
) ;

982 
tÙ®_sÿË
 = 
p_Vid
->
chroma_shiá_x
 +…_Vid->
chroma_shiá_y
 ;

985 
img³l
 *
»f_lše
 = &(
»f
->
imgUV
[ 
uv
-1 ][
y_pos
][
x_pos
]) ;

987 ià(
dx
 =ð0 && 
dy
 == 0)

989 
	`g‘_block_00
(
m´ed
, 
»f_lše
, 
block_size_y
, 
block_size_x
, 
p_Vid
->
ü_·dded_size_x
);

993 
dxcur
 = (è(
p_Vid
->
chroma_mask_mv_x
 + 1 - 
dx
);

994 
dycur
 = (è(
p_Vid
->
chroma_mask_mv_y
 + 1 - 
dy
);

995 
w00
 = 
dxcur
 * 
dycur
;

996 ià(
dx
 == 0)

998 
w01
 = 
dxcur
 * 
dy
;

999 
	`g‘_chroma_0X
(
m´ed
, 
»f_lše
, 
p_Vid
->
ü_·dded_size_x
, 
block_size_y
, 
block_size_x
, 
w00
, 
w01
, 
tÙ®_sÿË
);

1001 ià(
dy
 == 0)

1003 
w10
 = 
dx
 * 
dycur
;

1004 
	`g‘_chroma_X0
(
m´ed
, 
»f_lše
, 
p_Vid
->
ü_·dded_size_x
, 
block_size_y
, 
block_size_x
, 
w00
, 
w10
, 
tÙ®_sÿË
);

1008 
w01
 = 
dxcur
 * 
dy
;

1009 
w10
 = 
dx
 * 
dycur
;

1010 
w11
 = 
dx
 * 
dy
;

1011 
	`g‘_chroma_XX
(
m´ed
, 
»f_lše
, 
p_Vid
->
ü_·dded_size_x
, 
block_size_y
, 
block_size_x
, 
w00
, 
w01
, 
w10
, 
w11
, 
tÙ®_sÿË
);

1014 
	}
}

1017 
	$g‘_block_chroma_Ùf_L2
 ( 
VideoP¬am‘”s
 *
p_Vid
,

1018 
img³l
* 
m´ed
,

1019 * 
tmp_´ed
,

1020 
pic_pix_x
,

1021 
pic_pix_y
,

1022 
block_size_x
,

1023 
block_size_y
,

1024 
StÜabËPiùu»
 *
»f
,

1025 
uv
 )

1027 
	`g‘_block_chroma_Ùf
 ( 
p_Vid
, 
m´ed
, 
tmp_´ed
, 
pic_pix_x
, 
pic_pix_y
, 
block_size_x
, 
block_size_y
, 
»f
, 
uv
 );

1028 
	}
}

1031 
	$me_g‘_block_chroma_Ùf_L1
 ( 
VideoP¬am‘”s
 *
p_Vid
,

1032 
img³l
* 
m´ed
,

1033 * 
tmp_´ed
,

1034 
pic_pix_x
,

1035 
pic_pix_y
,

1036 
block_size_x
,

1037 
block_size_y
,

1038 
StÜabËPiùu»
 *
»f
,

1039 
uv
 )

1041 ifÐ
	`is_q³l
Ð
pic_pix_x
, 
pic_pix_y
, 
»f
->
chroma_mask_mv_x
,„ef->
chroma_mask_mv_y
) )

1043 
	`g‘_block_chroma_Ùf
 ( 
p_Vid
, 
m´ed
, 
tmp_´ed
, 
pic_pix_x
, 
pic_pix_y
, 
block_size_x
, 
block_size_y
, 
»f
, 
uv
 );

1047 
j
;

1048 
img³l
 *
»f_lše
 = 
	`UMVLše8X_chroma_Ùf
 (
»f
, 
uv
, 
pic_pix_y
, 
pic_pix_x
);

1049 
j
 = 0; j < 
block_size_y
; j++)

1051 
	`memýy
(
m´ed
, 
»f_lše
, 
block_size_x
 * (
img³l
));

1052 
»f_lše
 +ð
p_Vid
->
ü_·dded_size_x
;

1053 
m´ed
 +ð
block_size_x
;

1056 
	}
}

1058 
	$mc_g‘_block_chroma_Ùf_L1
 ( 
VideoP¬am‘”s
 *
p_Vid
,

1059 
img³l
* 
m´ed
,

1060 * 
tmp_´ed
,

1061 
pic_pix_x
,

1062 
pic_pix_y
,

1063 
block_size_x
,

1064 
block_size_y
,

1065 
StÜabËPiùu»
 *
»f
,

1066 
uv
 )

1068 ifÐ
	`is_q³l
Ð
pic_pix_x
, 
pic_pix_y
, 
»f
->
chroma_mask_mv_x
,„ef->
chroma_mask_mv_y
 ) )

1070 
	`g‘_block_chroma_Ùf
 ( 
p_Vid
, 
m´ed
, 
tmp_´ed
, 
pic_pix_x
, 
pic_pix_y
, 
block_size_x
, 
block_size_y
, 
»f
, 
uv
 );

1074 
j
;

1075 
img³l
 *
»f_lše
 = 
	`UMVLše4Xü_Ùf
 (
»f
, 
uv
, 
pic_pix_y
, 
pic_pix_x
);

1076 
j
 = 0; j < 
block_size_y
; j++)

1078 
	`memýy
(
m´ed
, 
»f_lše
, 
block_size_x
 * (
img³l
));

1079 
»f_lše
 +ð
p_Vid
->
ü_·dded_size_x
;

1080 
m´ed
 +ð
block_size_x
;

1083 
	}
}

	@lencod/src/header.c

15 
	~<m©h.h
>

17 
	~"glob®.h
"

19 
	~"–em’ts.h
"

20 
	~"h—d”.h
"

21 
	~"¹p.h
"

22 
	~"mbufãr.h
"

23 
	~"vlc.h
"

24 
	~"·r£t.h
"

25 
	~"li¡_»Üd”.h
"

28 #ià
TRACE


29 
	#SYMTRACESTRING
(
s
è
	`¡ºýy
(
sym
.
Œaû¡ršg
,s,
TRACESTRING_SIZE
)

	)

31 
	#SYMTRACESTRING
(
s
)

33 

	)

34 cÚ¡ * 
	gassignSE2·¹™iÚ
[2] ;

35 cÚ¡ 
	gassignSE2·¹™iÚ_NoDP
[
SE_MAX_ELEMENTS
] =

37 cÚ¡ 
	gassignSE2·¹™iÚ_DP
[
SE_MAX_ELEMENTS
] =

41 #ià(
MVC_EXTENSION_ENABLE
)

42 
mvc_»f_pic_li¡_»Üd”šg
(
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
);

44 
»f_pic_li¡_»Üd”šg
(
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
);

45 
´ed_weight_bË
 (
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
);

46 
g‘_piùu»_ty³
 (
Sliû
 *
cu¼Sliû
);

56 
	$SliûH—d”
(
Sliû
* 
cu¼Sliû
)

58 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

59 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
cu¼Sliû
->active_sps;

60 
pic_·¿m‘”_£t_rb¥_t
 *
aùive_µs
 = 
cu¼Sliû
->active_pps;

62 
dP_Ä
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
][
SE_HEADER
];

63 
B™¡»am
 *
b™¡»am
 = 
cu¼Sliû
->
·¹A¼
[
dP_Ä
].bitstream;

64 
Ën
 = 0;

65 
f›ld_pic_æag
 = 0;

66 
by‹
 
bÙtom_f›ld_æag
 = 0;

68 
num_b™s_¦iû_group_chªge_cyþe
;

69 
numtmp
;

71 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

72 
Ën
 = 
	`wr™e_ue_v
("SH: fœ¡_mb_š_¦iû", 
p_Vid
->
cu¼’t_mb_Ä
 >> 1, 
b™¡»am
);

74 
Ën
 = 
	`wr™e_ue_v
("SH: fœ¡_mb_š_¦iû", 
p_Vid
->
cu¼’t_mb_Ä
, 
b™¡»am
);

76 
Ën
 +ð
	`wr™e_ue_v
("SH: sliû_ty³", 
	`g‘_piùu»_ty³
 (
cu¼Sliû
), 
b™¡»am
);

78 
Ën
 +ð
	`wr™e_ue_v
("SH:…ic_·¿m‘”_£t_id" , 
aùive_µs
->
pic_·¿m‘”_£t_id
 ,
b™¡»am
);

80 ifÐ
aùive_¥s
->
£·¿‹_cÞour_¶ªe_æag
 == 1 )

81 
Ën
 +ð
	`wr™e_u_v
Ð2, "SH: cÞour_¶ªe_id", 
p_Vid
->
cÞour_¶ªe_id
, 
b™¡»am
 );

83 #ià(
MVC_EXTENSION_ENABLE
)

87 
Ën
 +ð
	`wr™e_u_v
 (
p_Vid
->
log2_max_äame_num_mšus4
 + 4,"SH: f¿me_num",…_Vid->
äame_num
, 
b™¡»am
);

89 
Ën
 +ð
	`wr™e_u_v
 (
p_Vid
->
log2_max_äame_num_mšus4
 + 4,"SH: f¿me_num",…_Vid->
äame_num
, 
b™¡»am
);

92 ià(!
cu¼Sliû
->
aùive_¥s
->
äame_mbs_Úly_æag
)

95 
f›ld_pic_æag
 = (
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
 || cu¼Sliû->¡ruùu» ==
BOTTOM_FIELD
)?1:0;

96 
	`as£¹
Ð
f›ld_pic_æag
 =ð
p_Vid
->
æd_æag
 );

97 
Ën
 +ð
	`wr™e_u_1
("SH: f›ld_pic_æag", 
f›ld_pic_æag
, 
b™¡»am
);

99 ià(
f›ld_pic_æag
)

102 
bÙtom_f›ld_æag
 = (
by‹
è(
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
);

103 
Ën
 +ð
	`wr™e_u_1
("SH: bÙtom_f›ld_æag" , 
bÙtom_f›ld_æag
 ,
b™¡»am
);

107 #ià(
MVC_EXTENSION_ENABLE
)

108 ià(
cu¼Sliû
->
idr_æag
 || (
p_Vid
->
v›w_id
 && !p_Vid->
nÚ_idr_æag
[cu¼Sliû->
¡ruùu»
 =ð
BOTTOM_FIELD
 ? 1 : 0]) )

110 ià(
cu¼Sliû
->
idr_æag
)

114 
Ën
 +ð
	`wr™e_ue_v
 ("SH: idr_pic_id", (
p_Vid
->
numb”
 & 0x01), 
b™¡»am
);

117 ià(
p_Vid
->
pic_Üd”_út_ty³
 == 0)

119 ià(
aùive_¥s
->
äame_mbs_Úly_æag
)

121 
p_Vid
->
pic_Üd”_út_lsb
 = (p_Vid->
tÝpoc
 & ~(((()(-1)è<< (p_Vid->
log2_max_pic_Üd”_út_lsb_mšus4
+4))) );

125 ià(!
f›ld_pic_æag
 || 
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

126 
p_Vid
->
pic_Üd”_út_lsb
 = (p_Vid->
tÝpoc
 & ~(((()(-1)è<< (p_Vid->
log2_max_pic_Üd”_út_lsb_mšus4
+4))) );

127 iàÐ
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
 )

128 
p_Vid
->
pic_Üd”_út_lsb
 = (p_Vid->
bÙtompoc
 & ~(((()(-1)è<< (p_Vid->
log2_max_pic_Üd”_út_lsb_mšus4
+4))) );

131 
Ën
 +ð
	`wr™e_u_v
 (
p_Vid
->
log2_max_pic_Üd”_út_lsb_mšus4
+4, "SH:…ic_Üd”_út_lsb",…_Vid->
pic_Üd”_út_lsb
, 
b™¡»am
);

133 ià(
p_Vid
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 && !
f›ld_pic_æag
)

135 
Ën
 +ð
	`wr™e_£_v
 ("SH: d–_pic_Üd”_út_bÙtom", 
p_Vid
->
d–_pic_Üd”_út_bÙtom
, 
b™¡»am
);

138 ià(
p_Vid
->
pic_Üd”_út_ty³
 =ð1 && !p_Vid->
d–_pic_Üd”_®ways_z”o_æag
)

140 
Ën
 +ð
	`wr™e_£_v
 ("SH: d–_pic_Üd”_út[0]", 
p_Vid
->
d–_pic_Üd”_út
[0], 
b™¡»am
);

142 ià(
p_Vid
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 && !
f›ld_pic_æag
)

144 
Ën
 +ð
	`wr™e_£_v
 ("SH: d–_pic_Üd”_út[1]", 
p_Vid
->
d–_pic_Üd”_út
[1], 
b™¡»am
);

148 ià(
aùive_µs
->
»dundªt_pic_út_´e£Á_æag
)

150 
Ën
 +ð
	`wr™e_ue_v
 ("SH:„edundªt_pic_út", 
p_Vid
->
»dundªt_pic_út
, 
b™¡»am
);

154 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

156 
Ën
 +ð
	`wr™e_u_1
 ("SH: dœeù_¥©Ÿl_mv_´ed_æag", 
p_Vid
->
dœeù_¥©Ÿl_mv_´ed_æag
, 
b™¡»am
);

159 ià((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
B_SLICE
è|| cu¼Sliû->¦iû_ty³==
SP_SLICE
)

161 
ov”ride_æag
;

162 ià((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
))

164 
ov”ride_æag
 = (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] !ð(
aùive_µs
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
 +1)) ? 1 : 0;

168 
ov”ride_æag
 = ((
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] !ð(
aùive_µs
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
 +1))

169 || (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] !ð(
aùive_µs
->
num_»f_idx_l1_deçuÉ_aùive_mšus1
 +1))) ? 1 : 0;

172 
Ën
 +ð
	`wr™e_u_1
 ("SH:‚um_»f_idx_aùive_ov”ride_æag", 
ov”ride_æag
, 
b™¡»am
);

174 ià(
ov”ride_æag
)

176 
Ën
 +ð
	`wr™e_ue_v
 ("SH:‚um_»f_idx_l0_aùive_mšus1", 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
]-1, 
b™¡»am
);

177 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

179 
Ën
 +ð
	`wr™e_ue_v
 ("SH:‚um_»f_idx_l1_aùive_mšus1", 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
]-1, 
b™¡»am
);

186 #ià(
MVC_EXTENSION_ENABLE
)

187 if(
cu¼Sliû
->
Ïy”_id
 > 0)

188 
Ën
 +ð
	`mvc_»f_pic_li¡_»Üd”šg
(
cu¼Sliû
, 
b™¡»am
);

191 
Ën
 +ð
	`»f_pic_li¡_»Üd”šg
(
cu¼Sliû
, 
b™¡»am
);

193 ià(((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
è&& 
aùive_µs
->
weigh‹d_´ed_æag
) ||

194 ((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& cu¼Sliû->
weigh‹d_´ediùiÚ
 == 1))

196 
Ën
 +ð
	`´ed_weight_bË
(
cu¼Sliû
, 
b™¡»am
);

199 ià(
p_Vid
->
Çl_»ã»nû_idc
)

201 
p_Vid
->
ad­tive_»f_pic_bufãršg_æag
 = (p_Vid->
dec_»f_pic_m¬kšg_bufãr
 !ð
NULL
);

202 
Ën
 +ð
	`dec_»f_pic_m¬kšg
(
b™¡»am
,

203 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
,

204 #ià(
MVC_EXTENSION_ENABLE
)

205 (
cu¼Sliû
->
idr_æag
 || (
p_Vid
->
v›w_id
 && !p_Vid->
nÚ_idr_æag
[cu¼Sliû->
¡ruùu»
 =ð
BOTTOM_FIELD
 ? 1 : 0]) ) ? 1 : 0,

207 
cu¼Sliû
->
idr_æag
,

209 
p_Vid
->
no_ouut_of_´iÜ_pics_æag
,

210 
p_Vid
->
lÚg_‹rm_»ã»nû_æag
 );

213 if(
cu¼Sliû
->
symbÞ_mode
==
CABAC
 && cu¼Sliû->
¦iû_ty³
!=
I_SLICE
 )

215 
Ën
 +ð
	`wr™e_ue_v
("SH: cabac_š™_idc", 
cu¼Sliû
->
mod–_numb”
, 
b™¡»am
);

218 
Ën
 +ð
	`wr™e_£_v
("SH: sliû_qp_d–", (
cu¼Sliû
->
qp
 - 26 - 
aùive_µs
->
pic_š™_qp_mšus26
), 
b™¡»am
);

220 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

222 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

224 
Ën
 +ð
	`wr™e_u_1
 ("SH: sp_fÜ_sw™ch_æag", 
cu¼Sliû
->
¥2_äame_šdiÿtÜ
, 
b™¡»am
);

226 
Ën
 +ð
	`wr™e_£_v
 ("SH: sliû_qs_d–", (
p_Vid
->
qp¥
 - 26), 
b™¡»am
 );

229 ià(
aùive_µs
->
deblockšg_fž‹r_cÚŒÞ_´e£Á_æag
)

231 
Ën
 +ð
	`wr™e_ue_v
("SH: di§bË_deblockšg_fž‹r_idc",
cu¼Sliû
->
DFDi§bËIdc
, 
b™¡»am
);

233 ià(
cu¼Sliû
->
DFDi§bËIdc
!=1)

235 
Ën
 +ð
	`wr™e_£_v
 ("SH: sliû_®pha_c0_off£t_div2", 
cu¼Sliû
->
DFAÍhaC0Off£t
 / 2, 
b™¡»am
);

236 
Ën
 +ð
	`wr™e_£_v
 ("SH: sliû_b‘a_off£t_div2 ", 
cu¼Sliû
->
DFB‘aOff£t
 / 2, 
b™¡»am
);

240 iàÐ
aùive_µs
->
num_¦iû_groups_mšus1
 > 0 &&

241 
aùive_µs
->
¦iû_group_m­_ty³
 >= 3 &&‡ctive_pps->slice_group_map_type <= 5)

243 
numtmp
=
p_Vid
->
PicHeightInM­Un™s
*p_Vid->
PicWidthInMbs
/()(
aùive_µs
->
¦iû_group_chªge_¿‹_mšus1
+1)+1;

244 
num_b™s_¦iû_group_chªge_cyþe
 = ()
	`ûž
(
	`log
(
numtmp
)/log(2));

247 
Ën
 +ð
	`wr™e_u_v
 (
num_b™s_¦iû_group_chªge_cyþe
, "SH: sliû_group_chªge_cyþe", 
p_Vid
->
¦iû_group_chªge_cyþe
, 
b™¡»am
);

253 if(
cu¼Sliû
->
·¹™iÚ_mode
 && !cu¼Sliû->
idr_æag
)

255 
Ën
 +ð
	`wr™e_ue_v
("DPA: sliû_id", 
cu¼Sliû
->
¦iû_Ä
, 
b™¡»am
);

258  
Ën
;

259 
	}
}

271 
	$»f_pic_li¡_»Üd”šg
(
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
)

273 
li¡
;

274 
i
, 
Ën
=0;

276 
li¡
 = 
LIST_0
;†i¡ <ð
LIST_1
;†ist++)

278 if(
cu¼Sliû
->
num_»f_idx_aùive
[
li¡
]==0)

281 
	`»Üd”_agaš¡_deçuÉ_»f_pic_li¡s
(
cu¼Sliû
, 
li¡
);

283 ià(
cu¼Sliû
->
¦iû_ty³
!=
I_SLICE
 && cu¼Sliû->¦iû_ty³!=
SI_SLICE
)

285 
Ën
 +ð
	`wr™e_u_1
 ("SH:„ef_pic_li¡_»Üd”šg_æag", 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
li¡
], 
b™¡»am
);

286 ià(
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
li¡
])

288 
i
=-1;

291 
i
++;

292 
Ën
 +ð
	`wr™e_ue_v
 ("SH: modifiÿtiÚ_of_pic_nums_idc", 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
], 
b™¡»am
);

293 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] == 0 || currSlice->modification_of_pic_nums_idc[list][i] == 1)

295 
Ën
 +ð
	`wr™e_ue_v
 ("SH:‡bs_diff_pic_num_mšus1", 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
li¡
][
i
], 
b™¡»am
);

297 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] == 2)

299 
Ën
 +ð
	`wr™e_ue_v
 ("SH:†Úg_‹rm_pic_idx", 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
li¡
][
i
], 
b™¡»am
);

301 } 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] != 3);

306  
Ën
;

307 
	}
}

309 #ià(
MVC_EXTENSION_ENABLE
)

321 
	$mvc_»f_pic_li¡_»Üd”šg
(
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
)

323 
li¡
;

324 
i
, 
Ën
=0;

326 
li¡
 = 
LIST_0
;†i¡ <ð
LIST_1
;†ist++)

328 if(
cu¼Sliû
->
num_»f_idx_aùive
[
li¡
]==0)

331 
	`»Üd”_agaš¡_deçuÉ_»f_pic_li¡s
(
cu¼Sliû
, 
li¡
);

333 ià(
cu¼Sliû
->
¦iû_ty³
!=
I_SLICE
 && cu¼Sliû->¦iû_ty³!=
SI_SLICE
)

335 
Ën
 +ð
	`wr™e_u_1
 ("SH:„ef_pic_li¡_»Üd”šg_æag", 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
li¡
], 
b™¡»am
);

336 ià(
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
li¡
])

338 
i
=-1;

341 
i
++;

342 
Ën
 +ð
	`wr™e_ue_v
 ("SH: modifiÿtiÚ_of_pic_nums_idc", 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
], 
b™¡»am
);

343 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] == 0 || currSlice->modification_of_pic_nums_idc[list][i] == 1)

345 
Ën
 +ð
	`wr™e_ue_v
 ("SH:‡bs_diff_pic_num_mšus1", 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
li¡
][
i
], 
b™¡»am
);

347 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] == 2)

349 
Ën
 +ð
	`wr™e_ue_v
 ("SH:†Úg_‹rm_pic_idx", 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
li¡
][
i
], 
b™¡»am
);

351 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] == 4 || currSlice->modification_of_pic_nums_idc[list][i] == 5)

353 
Ën
 +ð
	`wr™e_ue_v
 ("SH:‡bs_diff_v›w_idx_mšus1", 
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
li¡
][
i
], 
b™¡»am
);

355 } 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
li¡
][
i
] != 3);

360  
Ën
;

361 
	}
}

373 
	$dec_»f_pic_m¬kšg
(
B™¡»am
 *
b™¡»am
, 
DecRefPicM¬kšg_t
 *
p_d½m
, 
idr_æag
, 
no_ouut_of_´iÜ_pics_æag
, 
lÚg_‹rm_»ã»nû_æag
 )

375 
DecRefPicM¬kšg_t
 *
tmp_d½m
;

377 
v®
, 
Ën
=0;

378 
ad­tive_»f_pic_bufãršg_æag
;

380 ià(
idr_æag
)

382 
Ën
 +ð
	`wr™e_u_1
("SH:‚o_ouut_of_´iÜ_pics_æag", 
no_ouut_of_´iÜ_pics_æag
, 
b™¡»am
);

383 
Ën
 +ð
	`wr™e_u_1
("SH:†Úg_‹rm_»ã»nû_æag", 
lÚg_‹rm_»ã»nû_æag
, 
b™¡»am
);

387 
ad­tive_»f_pic_bufãršg_æag
 = (
p_d½m
 !ð
NULL
);

389 
Ën
 +ð
	`wr™e_u_1
("SH:‡d­tive_»f_pic_bufãršg_æag", 
ad­tive_»f_pic_bufãršg_æag
, 
b™¡»am
);

391 ià(
ad­tive_»f_pic_bufãršg_æag
)

393 
tmp_d½m
 = 
p_d½m
;

397 ià(
tmp_d½m
==
NULL
è
	`”rÜ
 ("Errorƒncoding MMCO commands", 500);

399 
v®
 = 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
;

400 
Ën
 +ð
	`wr™e_ue_v
("SH: memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ", 
v®
, 
b™¡»am
);

402 ià((
v®
==1)||(val==3))

404 
Ën
 +ð1 + 
	`wr™e_ue_v
("SH: difã»nû_of_pic_nums_mšus1", 
tmp_d½m
->
difã»nû_of_pic_nums_mšus1
, 
b™¡»am
);

406 ià(
v®
==2)

408 
Ën
+ð
	`wr™e_ue_v
("SH:†Úg_‹rm_pic_num", 
tmp_d½m
->
lÚg_‹rm_pic_num
, 
b™¡»am
);

410 ià((
v®
==3)||(val==6))

412 
Ën
+ð
	`wr™e_ue_v
("SH:†Úg_‹rm_äame_idx", 
tmp_d½m
->
lÚg_‹rm_äame_idx
, 
b™¡»am
);

414 ià(
v®
==4)

416 
Ën
 +ð
	`wr™e_ue_v
("SH: max_lÚg_‹rm_pic_idx_¶us1", 
tmp_d½m
->
max_lÚg_‹rm_äame_idx_¶us1
, 
b™¡»am
);

419 
tmp_d½m
ñmp_d½m->
Next
;

421 } 
v®
 != 0);

425  
Ën
;

426 
	}
}

438 
	$´ed_weight_bË
(
Sliû
 *
cu¼Sliû
, 
B™¡»am
 *
b™¡»am
)

440 
Ën
 = 0;

441 
i
,
j
;

443 
Ën
 +ð
	`wr™e_ue_v
("SH:†uma_log_weight_d’om", 
cu¼Sliû
->
luma_log_weight_d’om
, 
b™¡»am
);

445 iàÐ0 !ð
cu¼Sliû
->
aùive_¥s
->
chroma_fÜm©_idc
)

447 
Ën
 +ð
	`wr™e_ue_v
("SH: chroma_log_weight_d’om", 
cu¼Sliû
->
chroma_log_weight_d’om
, 
b™¡»am
);

450 
i
=0; i< 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
]; i++)

452 iàÐ(
cu¼Sliû
->
wp_weight
[0][
i
][0] !ð1<<cu¼Sliû->
luma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[0][i][0] != 0) )

454 
Ën
 +ð
	`wr™e_u_1
 ("SH:†uma_weight_æag_l0", 1, 
b™¡»am
);

455 
Ën
 +ð
	`wr™e_£_v
 ("SH:†uma_weight_l0", 
cu¼Sliû
->
wp_weight
[0][
i
][0], 
b™¡»am
);

456 
Ën
 +ð
	`wr™e_£_v
 ("SH:†uma_off£t_l0", (
cu¼Sliû
->
wp_off£t
[0][
i
][0]>>(cu¼Sliû->
b™d•th_luma
 - 8)), 
b™¡»am
);

460 
Ën
 +ð
	`wr™e_u_1
 ("SH:†uma_weight_æag_l0", 0, 
b™¡»am
);

463 ià(
cu¼Sliû
->
aùive_¥s
->
chroma_fÜm©_idc
!=0)

465 iàÐ(
cu¼Sliû
->
wp_weight
[0][
i
][1] !ð1<<cu¼Sliû->
chroma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[0][i][1] != 0) ||

466 (
cu¼Sliû
->
wp_weight
[0][
i
][2] !ð1<<cu¼Sliû->
chroma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[0][i][2] != 0) )

468 
Ën
 +ð
	`wr™e_u_1
 ("chroma_weight_æag_l0", 1, 
b™¡»am
);

469 
j
=1; j<3; j++)

471 
Ën
 +ð
	`wr™e_£_v
 ("chroma_weight_l0", 
cu¼Sliû
->
wp_weight
[0][
i
][
j
] ,
b™¡»am
);

472 
Ën
 +ð
	`wr™e_£_v
 ("chroma_off£t_l0", (
cu¼Sliû
->
wp_off£t
[0][
i
][
j
]>>(cu¼Sliû->
b™d•th_chroma
-8)è,
b™¡»am
);

477 
Ën
 +ð
	`wr™e_u_1
 ("chroma_weight_æag_l0", 0, 
b™¡»am
);

482 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

484 
i
=0; i< 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
]; i++)

486 iàÐ(
cu¼Sliû
->
wp_weight
[1][
i
][0] !ð1<<cu¼Sliû->
luma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[1][i][0] != 0) )

488 
Ën
 +ð
	`wr™e_u_1
 ("SH:†uma_weight_æag_l1", 1, 
b™¡»am
);

489 
Ën
 +ð
	`wr™e_£_v
 ("SH:†uma_weight_l1", 
cu¼Sliû
->
wp_weight
[1][
i
][0], 
b™¡»am
);

490 
Ën
 +ð
	`wr™e_£_v
 ("SH:†uma_off£t_l1", (
cu¼Sliû
->
wp_off£t
[1][
i
][0]>>(cu¼Sliû->
b™d•th_luma
-8)), 
b™¡»am
);

494 
Ën
 +ð
	`wr™e_u_1
 ("SH:†uma_weight_æag_l1", 0, 
b™¡»am
);

497 ià(
cu¼Sliû
->
aùive_¥s
->
chroma_fÜm©_idc
!=0)

499 iàÐ(
cu¼Sliû
->
wp_weight
[1][
i
][1] !ð1<<cu¼Sliû->
chroma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[1][i][1] != 0) ||

500 (
cu¼Sliû
->
wp_weight
[1][
i
][2] !ð1<<cu¼Sliû->
chroma_log_weight_d’om
è|| (cu¼Sliû->
wp_off£t
[1][i][2] != 0) )

502 
Ën
 +ð
	`wr™e_u_1
 ("chroma_weight_æag_l1", 1, 
b™¡»am
);

503 
j
=1; j<3; j++)

505 
Ën
 +ð
	`wr™e_£_v
 ("chroma_weight_l1", 
cu¼Sliû
->
wp_weight
[1][
i
][
j
] ,
b™¡»am
);

506 
Ën
 +ð
	`wr™e_£_v
 ("chroma_off£t_l1", (
cu¼Sliû
->
wp_off£t
[1][
i
][
j
]>>(cu¼Sliû->
b™d•th_chroma
-8)è,
b™¡»am
);

511 
Ën
 +ð
	`wr™e_u_1
 ("chroma_weight_æag_l1", 0, 
b™¡»am
);

516  
Ën
;

517 
	}
}

529 
	$g‘_piùu»_ty³
(
Sliû
 *
cu¼Sliû
)

533 
§me_¦iûty³_fÜ_whÞe_äame
 = 5;

535 #ià(
MVC_EXTENSION_ENABLE
)

536 if(
cu¼Sliû
->
p_IÅ
->
num_of_v›ws
==2)

538 
§me_¦iûty³_fÜ_whÞe_äame
 = 0;

542 
cu¼Sliû
->
¦iû_ty³
)

544 
I_SLICE
:

545  2 + 
§me_¦iûty³_fÜ_whÞe_äame
;

547 
P_SLICE
:

548  0 + 
§me_¦iûty³_fÜ_whÞe_äame
;

550 
B_SLICE
:

551  1 + 
§me_¦iûty³_fÜ_whÞe_äame
;

553 
SP_SLICE
:

554  3 + 
§me_¦iûty³_fÜ_whÞe_äame
;

556 
SI_SLICE
:

557  4 + 
§me_¦iûty³_fÜ_whÞe_äame
;

560 
	`”rÜ
("Picture Type‚ot supported!",1);

565 
	}
}

596 
	$P¬t™iÚ_BC_H—d”
(
Sliû
 *
cu¼Sliû
, 
P¬tNo
)

598 
D©aP¬t™iÚ
 *
·¹™iÚ
 = &((
cu¼Sliû
)->
·¹A¼
[
P¬tNo
]);

599 
SyÁaxEËm’t
 
sym
;

601 
	`as£¹
 (
P¬tNo
 > 0 && P¬tNØ< 
cu¼Sliû
->
max_·¹_Ä
);

603 
sym
.
ty³
 = 
SE_HEADER
;

604 
sym
.
v®ue2
 = 0;

606 
	`SYMTRACESTRING
("RTP-PH: Slice ID");

607 
sym
.
v®ue1
 = 
cu¼Sliû
->
¦iû_Ä
;

608 
	`wr™eSE_UVLC
 (&
sym
, 
·¹™iÚ
);

610  
sym
.
Ën
;

611 
	}
}

	@lencod/src/hme_distortion.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

21 
	~"image.h
"

22 
	~"mem®loc.h
"

23 
	~"mb_acûss.h
"

24 
	~"»fbuf.h
"

25 
	~"mv_£¬ch.h
"

26 
	~"me_di¡ÜtiÚ.h
"

27 
	~"hme_di¡ÜtiÚ.h
"

36 
di¡blk
 
	$compu‹SAD_hme
(
StÜabËPiùu»
 *
»f1
,

37 
MEBlock
 *
mv_block
,

38 
di¡blk
 
mš_mco¡
,

39 
MÙiÚVeùÜ
 *
ÿnd
)

41 
mco¡
 = 0;

42 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

43 
y
,
x
;

44 
blocksize_x
 = 
mv_block
->blocksize_x;

45 
blocksize_y
 = 
mv_block
->blocksize_y;

47 
·d_size_x
 = 
mv_block
->
hme_»f_size_x_·d
 - 
blocksize_x
;

49 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

50 
img³l
 *
»f_lše
 = 
	`UMVLše4X_št_hme
 (
»f1
, 
mv_block
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

52 
y
=0; y<
blocksize_y
; y++)

54 
x
 = 0; x < 
blocksize_x
; x+=4)

56 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

57 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

58 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

59 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

61 if(
mco¡
 > 
imš_co¡
)

62  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

63 
»f_lše
 +ð
·d_size_x
;

66  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

67 
	}
}

75 
di¡blk
 
	$compu‹SADWP_hme
(
StÜabËPiùu»
 *
»f1
,

76 
MEBlock
 *
mv_block
,

77 
di¡blk
 
mš_mco¡
,

78 
MÙiÚVeùÜ
 *
ÿnd


81 
mco¡
 = 0;

82 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

83 
y
, 
x
;

84 
weigh‹d_³l
;

85 
blocksize_x
 = 
mv_block
->blocksize_x;

86 
blocksize_y
 = 
mv_block
->blocksize_y;

88 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

89 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

90 
·d_size_x
 = 
mv_block
->
hme_»f_size_x_·d
 - 
blocksize_x
;

91 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

92 
weight
 = 
mv_block
->
weight_luma
;

93 
off£t
 = 
mv_block
->
off£t_luma
;

95 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

96 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

98 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

99 
img³l
 *
»f_lše
 = 
	`UMVLše4X_št_hme
 (
»f1
, 
mv_block
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

101 
y
=0; y<
blocksize_y
; y++)

103 
x
 = 0; x < 
blocksize_x
; x+=4)

105 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

106 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

107 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

108 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

109 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

110 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

111 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

112 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

114 if(
mco¡
 > 
imš_co¡
)

115  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

116 
»f_lše
 +ð
·d_size_x
;

119  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

120 
	}
}

	@lencod/src/hme_luma.c

16 
	~"cÚŒibutÜs.h
"

17 
	~<lim™s.h
>

19 
	~"glob®.h
"

20 
	~"image.h
"

21 
	~"img_luma.h
"

22 
	~"me_hme.h
"

32 
	$fžlHMEIÁImageM¬gš
(
img³l
 **
d¡Img
, 
size_x
, 
size_y
, 
off£t_x
, 
off£t_y
)

34 
i
, 
j
;

35 
size_x_mšus1
 = 
size_x
 - 1;

36 
size_x_·dded
 = 
size_x
+2*
off£t_x
;

37 
size_y_·dded
 = 
size_y
+2*
off£t_y
;

39 
img³l
 *
wBufSrc
, *
wBufD¡
;

42 
wBufD¡
 = 
d¡Img
[-
off£t_y
]-
off£t_x
;

43 
wBufSrc
 = 
d¡Img
[0];

45 
i
 = 0; i < 
off£t_x
; i++)

46 *(
wBufD¡
++èð*
wBufSrc
;

48 
	`memýy
(
wBufD¡
, 
wBufSrc
, 
size_x
 * (
img³l
));

49 
wBufD¡
 +ð
size_x
;

51 
i
 = 0; i < 
off£t_x
; i++)

52 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

55 
wBufSrc
 = 
d¡Img
[-
off£t_y
]-
off£t_x
;

56 
j
 = 1-
off£t_y
; j < 0; j++)

58 
	`memýy
(
d¡Img
[
j
]-
off£t_x
, 
wBufSrc
, 
size_x_·dded
 * (
img³l
));

61 
j
 = 0; j < 
size_y
; j++)

63 
wBufD¡
 = 
d¡Img
[
j
]-
off£t_x
;

64 
wBufSrc
 = 
d¡Img
[
j
];

66 
i
 = 0; i < 
off£t_x
; i++)

67 *(
wBufD¡
++èð
wBufSrc
[0];

68 
wBufD¡
 +ð
size_x
;

70 
i
 = 0; i < 
off£t_x
; i++)

71 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

75 
wBufSrc
 = 
d¡Img
[
size_y
-1]-
off£t_x
;

76 
j
 = 
size_y
; j < 
size_y_·dded
-
off£t_y
; j++)

78 
	`memýy
(
d¡Img
[
j
]-
off£t_x
, 
wBufSrc
, 
size_x_·dded
 * (
img³l
));

80 
	}
}

84 
	$G‘HMEIÁImagesLuma
Ð
VideoP¬am‘”s
 *
p_Vid
, 
size_x
, 
size_y
, 
img³l
 ***
cImgIÁ
)

86 
iLev–
, 
iWidth
, 
iHeight
;

87 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

89 
iLev–
=0; iLev–<
iPy¿midLev–s
; iLevel++)

91 
iWidth
 = 
size_x
>>
iLev–
;

92 
iHeight
 = 
size_y
>>
iLev–
;

94 
	`fžlHMEIÁImageM¬gš
(
cImgIÁ
[
iLev–
], 
iWidth
, 
iHeight
, 
IMG_PAD_SIZE_X
, 
IMG_PAD_SIZE_Y
);

96 
	}
}

	@lencod/src/image.c

28 
	~"cÚŒibutÜs.h
"

30 
	~<m©h.h
>

31 
	~<time.h
>

33 
	~"glob®.h
"

35 
	~"fžehªdË.h
"

36 
	~"mbufãr.h
"

37 
	~"img_luma.h
"

38 
	~"img_chroma.h
"

39 
	~"img_di¡ÜtiÚ.h
"

40 
	~"šŒ¬eäesh.h
"

41 
	~"¦iû.h
"

42 
	~"fmo.h
"

43 
	~"£i.h
"

44 
	~"mem®loc.h
"

45 
	~"ç¡_memÜy.h
"

46 
	~"Çlu.h
"

47 
	~"¿‹ùl.h
"

48 
	~"mb_acûss.h
"

49 
	~"cÚ‹xt_ši.h
"

50 
	~"bŸr›ncode.h
"

51 
	~"’c_¡©i¡ics.h
"

52 
	~"cÚfÜmªû.h
"

53 
	~"»pÜt.h
"

55 
	~"q_m©rix.h
"

56 
	~"q_off£ts.h
"

57 
	~"wp.h
"

58 
	~"šput.h
"

59 
	~"image.h
"

60 
	~"”rdo.h
"

61 
	~"img_´oûss.h
"

62 
	~"rdÝt.h
"

63 
	~"£i.h
"

64 
	~"cÚfigfže.h
"

65 
	~"mbufãr.h
"

67 
	~"»size.h
"

68 
	~"md_commÚ.h
"

69 
	~"me_•zs_commÚ.h
"

70 
	~"me_hme.h
"

72 
Upd©eDecod”s
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StÜabËPiùu»
 *
’c_pic
);

74 
DeblockF¿me
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **, imgpel ***);

76 
code_a_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
);

77 
f›ld_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
tÝ
, Piùu» *
bÙtom
);

78 
´•¬e_’c_äame_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 **
¡Üed_pic
);

79 #ià(
MVC_EXTENSION_ENABLE
)

80 
wr™eout_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
, 
is_bÙtom
);

82 
wr™eout_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
);

84 
by‹
 
piùu»_¡ruùu»_decisiÚ
(
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
äame
, Piùu» *
tÝ
, Piùu» *
bÙ
);

85 
di¡ÜtiÚ_æd
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
Piùu»
 *
f›ld_pic
, 
ImageD©a
 *
imgD©a
);

87 
f›ld_mode_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
);

88 
äame_mode_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
);

89 
š™_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

90 
š™_f›ld
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

91 
put_bufãr_äame
 (
VideoP¬am‘”s
 *
p_Vid
);

92 
put_bufãr_tÝ
 (
VideoP¬am‘”s
 *
p_Vid
);

93 
put_bufãr_bÙ
 (
VideoP¬am‘”s
 *
p_Vid
);

95 
R•ÜtFœ¡äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
);

96 
R•ÜtI
 (
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
);

97 
R•ÜtP
 (
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
);

98 
R•ÜtB
 (
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
);

99 
R•ÜtNALNÚVLCB™s
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
);

101 
rd_piùu»_codšg
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

103 
	$MbAffPo¡Proc
(
VideoP¬am‘”s
 *
p_Vid
)

105 
img³l
 
‹mp
[32][16];

107 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

108 
img³l
 ** 
imgY
 = 
p_Enc_Pic
->imgY;

109 
img³l
 ***
imgUV
 = 
p_Enc_Pic
->imgUV;

110 
i
, 
y
, 
x0
, 
y0
, 
uv
;

112 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

114 
i
=0; i<()
p_Vid
->
PicSizeInMbs
; i+=2)

116 ià(
p_Enc_Pic
->
mÙiÚ
.
mb_f›ld
[
i
])

118 
	`g‘_mb_pos
(
p_Vid
, 
i
,…_Vid->
mb_size
[
IS_LUMA
], &
x0
, &
y0
);

119 
y
=0; y<(2*
MB_BLOCK_SIZE
);y++)

120 
	`memýy
(&
‹mp
[
y
],&
imgY
[
y0
+y][
x0
], 
MB_BLOCK_SIZE
 * (
img³l
));

122 
y
=0; y<
MB_BLOCK_SIZE
;y++)

124 
	`memýy
(&
imgY
[
y0
+(2*
y
)][
x0
],
‹mp
[y], 
MB_BLOCK_SIZE
 * (
img³l
));

125 
	`memýy
(&
imgY
[
y0
+(2*
y
 + 1)][
x0
],
‹mp
[y+ 
MB_BLOCK_SIZE
], MB_BLOCK_SIZE * (
img³l
));

128 
x0
 = x0 / (16/
p_Vid
->
mb_ü_size_x
);

129 
y0
 = y0 / (16/
p_Vid
->
mb_ü_size_y
);

131 
uv
=0; uv<2; uv++)

133 
y
=0; y < (2 * 
p_Vid
->
mb_ü_size_y
); y++)

134 
	`memýy
(&
‹mp
[
y
],&
imgUV
[
uv
][
y0
+y][
x0
], 
p_Vid
->
mb_ü_size_x
 * (
img³l
));

136 
y
=0; y<
p_Vid
->
mb_ü_size_y
;y++)

138 
	`memýy
(&
imgUV
[
uv
][
y0
+(2*
y
)][
x0
],
‹mp
[y], 
p_Vid
->
mb_ü_size_x
 * (
img³l
));

139 
	`memýy
(&
imgUV
[
uv
][
y0
+(2*
y
 + 1)][
x0
],
‹mp
[y+ 
p_Vid
->
mb_ü_size_y
],…_Vid->
mb_ü_size_x
 * (
img³l
));

147 
i
=0; i<()
p_Vid
->
PicSizeInMbs
; i+=2)

149 ià(
p_Enc_Pic
->
mÙiÚ
.
mb_f›ld
[
i
])

151 
	`g‘_mb_pos
(
p_Vid
, 
i
,…_Vid->
mb_size
[
IS_LUMA
], &
x0
, &
y0
);

152 
y
=0; y<(2*
MB_BLOCK_SIZE
);y++)

153 
	`memýy
(&
‹mp
[
y
],&
imgY
[
y0
+y][
x0
], 
MB_BLOCK_SIZE
 * (
img³l
));

155 
y
=0; y<
MB_BLOCK_SIZE
;y++)

157 
	`memýy
(&
imgY
[
y0
+(2*
y
)][
x0
],
‹mp
[y], 
MB_BLOCK_SIZE
 * (
img³l
));

158 
	`memýy
(&
imgY
[
y0
+(2*
y
 + 1)][
x0
],
‹mp
[y+ 
MB_BLOCK_SIZE
], MB_BLOCK_SIZE * (
img³l
));

163 
	}
}

172 
	$£t_¦iû_ty³
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
¦iû_ty³
)

174 
p_Vid
->
ty³
 = (è
¦iû_ty³
;

175 
p_Vid
->
RCMšQP
 = 
p_IÅ
->RCMšQP[p_Vid->
ty³
];

176 
p_Vid
->
RCMaxQP
 = 
p_IÅ
->RCMaxQP[p_Vid->
ty³
];

177 
	}
}

179 
	$code_a_¶ªe
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

181 
Numb”OfCodedMBs
 = 0;

182 
SliûGroup
 = 0;

183 
Di¡M‘ric
 
di¡ÜtiÚ
;

187 
p_Vid
->
¦iû_group_chªge_cyþe
=1;

188 
	`FmoIn™
(
p_Vid
,…_Vid->
aùive_µs
,…_Vid->
aùive_¥s
);

189 
	`FmoS¹Piùu»
 (
p_Vid
);

191 
	`C®cuÏ‹Quªt4x4P¬am
 (
p_Vid
);

192 
	`C®cuÏ‹Off£t4x4P¬am
(
p_Vid
);

194 if(
p_IÅ
->
T¿nsfÜm8x8Mode
)

196 
	`C®cuÏ‹Quªt8x8P¬am
 (
p_Vid
);

197 
	`C®cuÏ‹Off£t8x8P¬am
(
p_Vid
);

200 
	`»£t_pic_bš_couÁ
(
p_Vid
);

201 
p_Vid
->
by‹s_š_piùu»
 = 0;

203 
Numb”OfCodedMBs
 < 
p_Vid
->
PicSizeInMbs
)

206 !
	`FmoSliûGroupCom¶‘–yCoded
 (
p_Vid
, 
SliûGroup
))

209 ià(!
p_Vid
->
mb_aff_äame_æag
)

210 
Numb”OfCodedMBs
 +ð
	`’code_Úe_¦iû
 (
p_Vid
, 
SliûGroup
, NumberOfCodedMBs);

212 
Numb”OfCodedMBs
 +ð
	`’code_Úe_¦iû_MBAFF
 (
p_Vid
, 
SliûGroup
, NumberOfCodedMBs);

214 
	`FmoS‘La¡MaüoblockInSliû
 (
p_Vid
,…_Vid->
cu¼’t_mb_Ä
);

216 
p_Vid
->
cu¼’t_¦iû_Ä
++;

217 
p_Vid
->
p_Sts
->
b™_¦iû
 = 0;

220 
SliûGroup
++;

222 
	`FmoEndPiùu»
 ();

224 ià((
p_IÅ
->
SkDeBlockNÚRef
 =ð0è|| (
p_Vid
->
Çl_»ã»nû_idc
 != 0))

226 if(
p_IÅ
->
RDPiùu»Deblockšg
 && !
p_Vid
->
TuºDBOff
)

228 
	`fšd_di¡ÜtiÚ
(
p_Vid
, &p_Vid->
imgD©a
);

229 
di¡ÜtiÚ
.
v®ue
[0] = 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].value[0];

230 
di¡ÜtiÚ
.
v®ue
[1] = 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].value[1];

231 
di¡ÜtiÚ
.
v®ue
[2] = 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].value[2];

234 
di¡ÜtiÚ
.
v®ue
[0] = distortion.value[1] = distortion.value[2] = 0;

236 
	`DeblockF¿me
 (
p_Vid
,…_Vid->
’c_piùu»
->
imgY
,…_Vid->’c_piùu»->
imgUV
);

238 if(
p_IÅ
->
RDPiùu»Deblockšg
 && !
p_Vid
->
TuºDBOff
)

240 
	`fšd_di¡ÜtiÚ
(
p_Vid
, &p_Vid->
imgD©a
);

241 if(
di¡ÜtiÚ
.
v®ue
[0]+distortion.value[1]+distortion.value[2] <

242 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[0]+

243 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[1]+

244 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[2])

246 
p_Vid
->
Ev®u©eDBOff
 = 1;

251 
	}
}

263 
	$code_a_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
)

265 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

266 
¶
;

268 
p_Vid
->
cu¼’tPiùu»
 = 
pic
;

269 
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 = 
	`g‘_idr_æag
(p_Vid);

271 
pic
->
no_¦iûs
 = 0;

273 
	`RªdomIÁ¿NewPiùu»
 (
p_Vid
);

274 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

276  
¶
=0;…l<
MAX_PLANE
;…l++ )

278 
p_Vid
->
cu¼’t_mb_Ä
 = 0;

279 
p_Vid
->
cu¼’t_¦iû_Ä
 = 0;

280 
p_Vid
->
SumF¿meQP
 = 0;

281 
p_Vid
->
num_»f_idx_l0_aùive
 = 0;

282 
p_Vid
->
num_»f_idx_l1_aùive
 = 0;

284 
p_Vid
->
cÞour_¶ªe_id
 = (è
¶
;

286 
	`code_a_¶ªe
(
p_Vid
, 
p_IÅ
);

291 
	`code_a_¶ªe
(
p_Vid
, 
p_IÅ
);

294 ià(
p_Vid
->
mb_aff_äame_æag
)

295 
	`MbAffPo¡Proc
(
p_Vid
);

297 
	}
}

305 
by‹
 
	$g‘_idr_æag
Ð
VideoP¬am‘”s
 *
p_Vid
 )

307 
idr_æag
;

308 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

310  
p_Vid
->
¡ruùu»
 )

313 
FRAME
:

314 
idr_æag
 = 
p_cur_äm
->
p_äame_pic
->idr_flag;

316 
TOP_FIELD
:

317 
idr_æag
 = 
p_cur_äm
->
p_tÝ_æd_pic
->idr_flag;

319 
BOTTOM_FIELD
:

320 
idr_æag
 = 
p_cur_äm
->
p_bÙ_æd_pic
->idr_flag;

324  (
by‹
è
idr_æag
;

325 
	}
}

333 
by‹
 
	$g‘_¿ndom_acûss_æag
Ð
VideoP¬am‘”s
 *
p_Vid
 )

335 
¿ndom_acûss
;

336 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

338  
p_Vid
->
¡ruùu»
 )

341 
FRAME
:

342 
¿ndom_acûss
 = 
p_cur_äm
->
p_äame_pic
->random_access;

344 
TOP_FIELD
:

345 
¿ndom_acûss
 = 
p_cur_äm
->
p_tÝ_æd_pic
->random_access;

347 
BOTTOM_FIELD
:

348 
¿ndom_acûss
 = 
p_cur_äm
->
p_bÙ_æd_pic
->random_access;

352  (
by‹
è
¿ndom_acûss
;

353 
	}
}

361 
	$upd©e_glob®_¡©s
(
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
gl_¡©s
, StP¬am‘” *
cur_¡©s
)

363 
i
, 
j
, 
k
;

365 ià(
p_IÅ
->
sk_gl_¡©s
 == 0)

367 
i
 = 0; i < 4; i++)

369 
gl_¡©s
->
šŒa_chroma_mode
[
i
] +ð
cur_¡©s
->intra_chroma_mode[i];

372 
i
 = 0; i < 5; i++)

374 
gl_¡©s
->
quªt
[
i
] +ð
cur_¡©s
->quant[i];

375 
gl_¡©s
->
num_maüoblocks
[
i
] +ð
cur_¡©s
->num_macroblocks[i];

376 
gl_¡©s
->
b™_u£_mb_ty³
 [
i
] +ð
cur_¡©s
->bit_use_mb_type[i];

377 
gl_¡©s
->
b™_u£_h—d”
 [
i
] +ð
cur_¡©s
->bit_use_header[i];

378 
gl_¡©s
->
tmp_b™_u£_cbp
 [
i
] +ð
cur_¡©s
->tmp_bit_use_cbp[i];

379 
gl_¡©s
->
b™_u£_cÛffC
 [
i
] +ð
cur_¡©s
->bit_use_coeffC[i];

380 
gl_¡©s
->
b™_u£_cÛff
[0][
i
] +ð
cur_¡©s
->bit_use_coeff[0][i];

381 
gl_¡©s
->
b™_u£_cÛff
[1][
i
] +ð
cur_¡©s
->bit_use_coeff[1][i];

382 
gl_¡©s
->
b™_u£_cÛff
[2][
i
] +ð
cur_¡©s
->bit_use_coeff[2][i];

383 
gl_¡©s
->
b™_u£_d–_quªt
[
i
] +ð
cur_¡©s
->bit_use_delta_quant[i];

384 
gl_¡©s
->
b™_u£_¡uffšg_b™s
[
i
] +ð
cur_¡©s
->bit_use_stuffing_bits[i];

386 
k
 = 0; k < 2; k++)

387 
gl_¡©s
->
b8_mode_0_u£
[
i
][
k
] +ð
cur_¡©s
->b8_mode_0_use[i][k];

389 
j
 = 0; j < 15; j++)

391 
gl_¡©s
->
mode_u£
[
i
][
j
] +ð
cur_¡©s
->mode_use[i][j];

392 
gl_¡©s
->
b™_u£_mode
[
i
][
j
] +ð
cur_¡©s
->bit_use_mode[i][j];

393 
k
 = 0; k < 2; k++)

394 
gl_¡©s
->
mode_u£_ŒªsfÜm
[
i
][
j
][
k
] +ð
cur_¡©s
->mode_use_transform[i][j][k];

398 
	}
}

400 
	$¡ÜeRedundªtF¿me
(
VideoP¬am‘”s
 *
p_Vid
)

402 
j
, 
k
;

403 if(
p_Vid
->
key_äame
)

405 
j
=0; j<
p_Vid
->
height
; j++)

407 
	`memýy
(
p_Vid
->
imgY_tmp
[
j
],…_Vid->
’c_äame_piùu»
[0]->
imgY
[j],…_Vid->
width
 * (
img³l
));

410 
k
 = 0; k < 2; k++)

412 
j
=0; j<
p_Vid
->
height_ü
; j++)

414 
	`memýy
(
p_Vid
->
imgUV_tmp
[
k
][
j
],…_Vid->
’c_äame_piùu»
[0]->
imgUV
[k][j],…_Vid->
width_ü
 * (
img³l
));

419 if(
p_Vid
->
»dundªt_codšg
)

421 
j
=0; j<
p_Vid
->
height
; j++)

423 
	`memýy
(
p_Vid
->
’c_äame_piùu»
[0]->
imgY
[
j
],…_Vid->
imgY_tmp
[j],…_Vid->
width
 * (
img³l
));

425 
k
 = 0; k < 2; k++)

427 
j
=0; j<
p_Vid
->
height_ü
; j++)

429 
	`memýy
(
p_Vid
->
’c_äame_piùu»
[0]->
imgUV
[
k
][
j
],…_Vid->
imgUV_tmp
[k][j],…_Vid->
width_ü
 * (
img³l
));

433 
	}
}

440 
	$ä“_piùu»s
(
VideoP¬am‘”s
 *
p_Vid
, 
dummy
)

442 
i
;

443 
i
 = 0; i < 6; i++)

445 if(
p_Vid
->
’c_piùu»
 !ðp_Vid->
’c_äame_piùu»
[
i
])

446 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»
[
i
]);

448 
	}
}

450 #ià(
MVC_EXTENSION_ENABLE
)

457 
	$wr™e_–_f›ld_vþ_Çlu
(
VideoP¬am‘”s
 *
p_Vid
)

459 
‹mp1_Çl_»ã»nû_idc
;

460 
‹mp1_nÚ_idr_æag
[2];

461 
‹mp1_´iÜ™y_id
;

462 
‹mp1_v›w_id
;

463 
‹mp1_‹mpÜ®_id
;

464 
‹mp1_ªchÜ_pic_æag
[2];

465 
‹mp1_š‹r_v›w_æag
[2];

467 if(
p_Vid
->
v›w_id
 == 1)

469 
‹mp_v›w_id
 = 
p_Vid
->
v›w_id
;

471 
p_Vid
->
v›w_id
 = 0;

472 
p_Vid
->
¡ruùu»
 = 
TOP_FIELD
;

473 
	`wr™e_nÚ_vþ_Çlu_mvc
(
p_Vid
);

476 
‹mp1_Çl_»ã»nû_idc
 = 
p_Vid
->
Çl_»ã»nû_idc
;

477 
‹mp1_nÚ_idr_æag
[0] = 
p_Vid
->
nÚ_idr_æag
[0];

478 
‹mp1_nÚ_idr_æag
[1] = 
p_Vid
->
nÚ_idr_æag
[1];

479 
‹mp1_´iÜ™y_id
 = 
p_Vid
->
´iÜ™y_id
;

480 
‹mp1_v›w_id
 = 
‹mp_v›w_id
;

481 
‹mp1_‹mpÜ®_id
 = 
p_Vid
->
‹mpÜ®_id
;

482 
‹mp1_ªchÜ_pic_æag
[0] = 
p_Vid
->
ªchÜ_pic_æag
[0];

483 
‹mp1_ªchÜ_pic_æag
[1] = 
p_Vid
->
ªchÜ_pic_æag
[1];

484 
‹mp1_š‹r_v›w_æag
[0] = 
p_Vid
->
š‹r_v›w_æag
[0];

485 
‹mp1_š‹r_v›w_æag
[1] = 
p_Vid
->
š‹r_v›w_æag
[1];

488 
p_Vid
->
Çl_»ã»nû_idc
 =…_Vid->
‹mp0_Çl_»ã»nû_idc
;

489 
p_Vid
->
nÚ_idr_æag
[0] =…_Vid->
‹mp0_nÚ_idr_æag
[0];

490 
p_Vid
->
nÚ_idr_æag
[1] =…_Vid->
‹mp0_nÚ_idr_æag
[1];

491 
p_Vid
->
´iÜ™y_id
 =…_Vid->
‹mp0_´iÜ™y_id
;

492 
p_Vid
->
v›w_id
 =…_Vid->
‹mp0_v›w_id
;

493 
p_Vid
->
‹mpÜ®_id
 =…_Vid->
‹mp0_‹mpÜ®_id
;

494 
p_Vid
->
ªchÜ_pic_æag
[0] =…_Vid->
‹mp0_ªchÜ_pic_æag
[0];

495 
p_Vid
->
ªchÜ_pic_æag
[1] =…_Vid->
‹mp0_ªchÜ_pic_æag
[1];

496 
p_Vid
->
š‹r_v›w_æag
[0] =…_Vid->
‹mp0_š‹r_v›w_æag
[0];

497 
p_Vid
->
š‹r_v›w_æag
[1] =…_Vid->
‹mp0_š‹r_v›w_æag
[1];

498 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic1
[0], 0);

501 
p_Vid
->
Çl_»ã»nû_idc
 = 
‹mp1_Çl_»ã»nû_idc
;

502 
p_Vid
->
nÚ_idr_æag
[0] = 
‹mp1_nÚ_idr_æag
[0];

503 
p_Vid
->
nÚ_idr_æag
[1] = 
‹mp1_nÚ_idr_æag
[1];

504 
p_Vid
->
´iÜ™y_id
 = 
‹mp1_´iÜ™y_id
;

505 
p_Vid
->
v›w_id
 = 
‹mp1_v›w_id
;

506 
p_Vid
->
‹mpÜ®_id
 = 
‹mp1_‹mpÜ®_id
;

507 
p_Vid
->
ªchÜ_pic_æag
[0] = 
‹mp1_ªchÜ_pic_æag
[0];

508 
p_Vid
->
ªchÜ_pic_æag
[1] = 
‹mp1_ªchÜ_pic_æag
[1];

509 
p_Vid
->
š‹r_v›w_æag
[0] = 
‹mp1_š‹r_v›w_æag
[0];

510 
p_Vid
->
š‹r_v›w_æag
[1] = 
‹mp1_š‹r_v›w_æag
[1];

511 
	`wr™e_nÚ_vþ_Çlu_mvc
Ð
p_Vid
 );

512 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic2
[0], 0);

515 
p_Vid
->
Çl_»ã»nû_idc
 =…_Vid->
‹mp0_Çl_»ã»nû_idc
;

516 
p_Vid
->
nÚ_idr_æag
[0] =…_Vid->
‹mp0_nÚ_idr_æag
[0];

517 
p_Vid
->
nÚ_idr_æag
[1] =…_Vid->
‹mp0_nÚ_idr_æag
[1];

518 
p_Vid
->
´iÜ™y_id
 =…_Vid->
‹mp0_´iÜ™y_id
;

519 
p_Vid
->
v›w_id
 =…_Vid->
‹mp0_v›w_id
;

520 
p_Vid
->
‹mpÜ®_id
 =…_Vid->
‹mp0_‹mpÜ®_id
;

521 
p_Vid
->
ªchÜ_pic_æag
[0] =…_Vid->
‹mp0_ªchÜ_pic_æag
[0];

522 
p_Vid
->
ªchÜ_pic_æag
[1] =…_Vid->
‹mp0_ªchÜ_pic_æag
[1];

523 
p_Vid
->
š‹r_v›w_æag
[0] =…_Vid->
‹mp0_š‹r_v›w_æag
[0];

524 
p_Vid
->
š‹r_v›w_æag
[1] =…_Vid->
‹mp0_š‹r_v›w_æag
[1];

525 
p_Vid
->
¡ruùu»
 = 
BOTTOM_FIELD
;

526 
	`wr™e_nÚ_vþ_Çlu_mvc
Ð
p_Vid
 );

527 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic1
[1], 1);

530 
p_Vid
->
Çl_»ã»nû_idc
 = 
‹mp1_Çl_»ã»nû_idc
;

531 
p_Vid
->
nÚ_idr_æag
[0] = 
‹mp1_nÚ_idr_æag
[0];

532 
p_Vid
->
nÚ_idr_æag
[1] = 
‹mp1_nÚ_idr_æag
[1];

533 
p_Vid
->
´iÜ™y_id
 = 
‹mp1_´iÜ™y_id
;

534 
p_Vid
->
v›w_id
 = 
‹mp1_v›w_id
;

535 
p_Vid
->
‹mpÜ®_id
 = 
‹mp1_‹mpÜ®_id
;

536 
p_Vid
->
ªchÜ_pic_æag
[0] = 
‹mp1_ªchÜ_pic_æag
[0];

537 
p_Vid
->
ªchÜ_pic_æag
[1] = 
‹mp1_ªchÜ_pic_æag
[1];

538 
p_Vid
->
š‹r_v›w_æag
[0] = 
‹mp1_š‹r_v›w_æag
[0];

539 
p_Vid
->
š‹r_v›w_æag
[1] = 
‹mp1_š‹r_v›w_æag
[1];

540 
	`wr™e_nÚ_vþ_Çlu_mvc
Ð
p_Vid
 );

541 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic2
[1], 1);

545 
p_Vid
->
‹mp0_Çl_»ã»nû_idc
 =…_Vid->
Çl_»ã»nû_idc
;

546 
p_Vid
->
‹mp0_nÚ_idr_æag
[0] =…_Vid->
nÚ_idr_æag
[0];

547 
p_Vid
->
‹mp0_nÚ_idr_æag
[1] =…_Vid->
nÚ_idr_æag
[1];

548 
p_Vid
->
‹mp0_´iÜ™y_id
 =…_Vid->
´iÜ™y_id
;

549 
p_Vid
->
‹mp0_v›w_id
 =…_Vid->
v›w_id
;

550 
p_Vid
->
‹mp0_‹mpÜ®_id
 =…_Vid->
‹mpÜ®_id
;

551 
p_Vid
->
‹mp0_ªchÜ_pic_æag
[0] =…_Vid->
ªchÜ_pic_æag
[0];

552 
p_Vid
->
‹mp0_ªchÜ_pic_æag
[1] =…_Vid->
ªchÜ_pic_æag
[1];

553 
p_Vid
->
‹mp0_š‹r_v›w_æag
[0] =…_Vid->
š‹r_v›w_æag
[0];

554 
p_Vid
->
‹mp0_š‹r_v›w_æag
[1] =…_Vid->
š‹r_v›w_æag
[1];

556 
	}
}

564 
	$wr™e_äame_piùu»
(
VideoP¬am‘”s
 *
p_Vid
)

566 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

568 ià(
p_Vid
->
æd_æag
)

570 
	`f›ld_mode_bufãr
 (
p_Vid
);

572 if(
p_IÅ
->
num_of_v›ws
==1)

574 
p_Vid
->
¡ruùu»
 = 
TOP_FIELD
;

575 
	`wr™e_nÚ_vþ_Çlu
(
p_Vid
);

576 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic1
[0], 0);

577 
p_Vid
->
¡ruùu»
 = 
BOTTOM_FIELD
;

578 
	`wr™e_nÚ_vþ_Çlu_bÙ_æd
(
p_Vid
);

579 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic1
[1], 1);

583 
	`wr™e_–_f›ld_vþ_Çlu
(
p_Vid
);

588 
	`äame_mode_bufãr
 (
p_Vid
);

589 
p_Vid
->
¡ruùu»
 = 
FRAME
;

591 #ià(
MVC_EXTENSION_ENABLE
)

592 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

594 
	`wr™e_nÚ_vþ_Çlu_mvc
(
p_Vid
);

598 
	`wr™e_nÚ_vþ_Çlu
(
p_Vid
);

599 ià(
p_Vid
->
ty³
==
SI_SLICE
)

601 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
äame_pic_si
, 0);

605 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
p_äame_pic
, 0);

608 
	}
}

610 
	$wr™e_äame_piùu»
(
VideoP¬am‘”s
 *
p_Vid
)

612 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

613 ià(
p_Vid
->
æd_æag
)

615 
p_Vid
->
¡ruùu»
 = 
TOP_FIELD
;

616 
	`f›ld_mode_bufãr
 (
p_Vid
);

617 
	`wr™e_nÚ_vþ_Çlu
(
p_Vid
);

618 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic
[0]);

619 
p_Vid
->
¡ruùu»
 = 
BOTTOM_FIELD
;

620 
	`wr™e_nÚ_vþ_Çlu_bÙ_æd
(
p_Vid
);

621 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic
[1]);

625 
	`äame_mode_bufãr
 (
p_Vid
);

627 
	`wr™e_nÚ_vþ_Çlu
(
p_Vid
);

628 ià(
p_Vid
->
ty³
==
SI_SLICE
)

630 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
äame_pic_si
);

634 
	`wr™eout_piùu»
 (
p_Vid
,…_Vid->
p_äame_pic
);

637 
	}
}

647 
	$»ad_šput_d©a_32puÎdown
(
VideoP¬am‘”s
 *
p_Vid
)

649 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

650 
fže_»ad
 = 0;

651 
äm_no_š_fže_fœ¡
 = 0;

652 
äm_no_š_fže_£cÚd
 = 0;

653 
puÎ_down_off£t
 = 
p_IÅ
->
’abË_32_puÎdown
 == 1 ? 1 : 2;

655 #ià(
MVC_EXTENSION_ENABLE
)

656 if(
p_IÅ
->
num_of_v›ws
==2 && 
p_Vid
->
v›w_id
 == 1)

658 
äm_no_š_fže_fœ¡
 = ((
p_Vid
->
äm_no_š_fže
 * 4 + 
puÎ_down_off£t
)/ 5);

659 
äm_no_š_fže_£cÚd
 = ((
p_Vid
->
äm_no_š_fže
 * 4 + 3)/ 5);

662 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže2
, 
äm_no_š_fže_fœ¡
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a0
.
äm_d©a
);

663 iàÐ!
fže_»ad
 )

666 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže2
);

667 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

670 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a0
.
äm_d©a
);

673 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže2
, 
äm_no_š_fže_£cÚd
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a4
.
äm_d©a
);

674 iàÐ!
fže_»ad
 )

677 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže2
);

678 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

681 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a4
.
äm_d©a
);

686 
äm_no_š_fže_fœ¡
 = ((
p_Vid
->
äm_no_š_fže
 * 4 + 
puÎ_down_off£t
)/ 5);

687 
äm_no_š_fže_£cÚd
 = ((
p_Vid
->
äm_no_š_fže
 * 4 + 3)/ 5);

690 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže1
, 
äm_no_š_fže_fœ¡
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a0
.
äm_d©a
);

691 iàÐ!
fže_»ad
 )

694 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže1
);

695 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

698 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a0
.
äm_d©a
);

701 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže1
, 
äm_no_š_fže_£cÚd
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a4
.
äm_d©a
);

702 iàÐ!
fže_»ad
 )

705 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže1
);

706 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

709 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a4
.
äm_d©a
);

714 
	}
}

716 
	$»ad_šput_d©a
(
VideoP¬am‘”s
 *
p_Vid
)

718 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

719 
fže_»ad
 = 0;

721 #ià(
MVC_EXTENSION_ENABLE
)

722 if(
p_IÅ
->
num_of_v›ws
==2 && 
p_Vid
->
v›w_id
 == 1)

724 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže2
,…_Vid->
äm_no_š_fže
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a0
.
äm_d©a
);

725 iàÐ!
fže_»ad
 )

728 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže2
);

729 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

732 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a0
.
äm_d©a
);

737 
fže_»ad
 = 
	`»ad_Úe_äame
 (
p_Vid
, &
p_IÅ
->
šput_fže1
,…_Vid->
äm_no_š_fže
,…_IÅ->
šfže_h—d”
, &p_IÅ->
sourû
, &p_IÅ->
ouut
,…_Vid->
imgD©a0
.
äm_d©a
);

738 iàÐ!
fže_»ad
 )

741 
	`g‘_numb”_of_äames
 (
p_IÅ
, &p_IÅ->
šput_fže1
);

742 
	`årštf
(
¡dout
, "\nIncÜ»ù F¿mesToBeEncoded:‡ùu®‚umb” i %6d f¿mes!\n", 
p_IÅ
->
no_äames
 );

745 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a0
.
äm_d©a
);

749 
	}
}

751 
	$³rfÜm_’code_f›ld
(
VideoP¬am‘”s
 *
p_Vid
)

753 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

756 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

757 
p_Vid
->
p_rc_g’
->
F›ldCÚŒÞ
 = 1;

759 
p_Vid
->
f›ld_piùu»
 = 1;

761 #ià(
MVC_EXTENSION_ENABLE
)

762 
	`f›ld_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic_±r
[0],…_Vid->field_pic_ptr[1]);

764 
	`f›ld_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic
[0],…_Vid->field_pic[1]);

766 
p_Vid
->
æd_æag
 = 
TRUE
;

767 
	}
}

769 
	$³rfÜm_’code_äame
(
VideoP¬am‘”s
 *
p_Vid
)

771 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

772 
tmpF¿meQP
 = 0;

773 
num_»f_idx_l0
 = 0;

774 
num_»f_idx_l1
 = 0;

776 
äame_ty³
;

779 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

780 
p_Vid
->
p_rc_g’
->
F›ldCÚŒÞ
 = 0;

782 
p_Vid
->
f›ld_piùu»
 = 0;

785 if(
p_IÅ
->
RCEÇbË
)

786 
	`rc_š™_äame
(
p_Vid
, 
p_IÅ
);

788 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

790 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[0];

793 if(
p_IÅ
->
HMEEÇbË
)

795 ià(
p_Vid
->
ty³
!=
I_SLICE
 &&…_Vid->ty³!=
SI_SLICE
)

796 
	`švoke_HME
(
p_Vid
, 0);

799 #ià(
MVC_EXTENSION_ENABLE
)

800 if(
p_Vid
->
v›w_id
!=1 || !p_Vid->
£c_v›w_fÜû_æd
)

803 ià((
p_Vid
->
ty³
 =ð
B_SLICE
 ||…_Vid->ty³ =ð
P_SLICE
 ||…_Vid->ty³==
I_SLICE
è&& 
p_IÅ
->
RDPiùu»DecisiÚ
)

805 
	`äame_piùu»_mp
 (
p_Vid
, 
p_IÅ
);

809 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[0], &p_Vid->
imgD©a
, 0);

810 
p_Vid
->
p_äame_pic
 =…_Vid->
äame_pic
[0];

813 
tmpF¿meQP
 = 
p_Vid
->
SumF¿meQP
;

814 
num_»f_idx_l0
 = 
p_Vid
->
num_»f_idx_l0_aùive
;

815 
num_»f_idx_l1
 = 
p_Vid
->
num_»f_idx_l1_aùive
;

817 ià(
p_Vid
->
p_cu¼_äm_¡ruù
->
ty³
 =ð
SI_SLICE
)

820 
	`£t_¦iû_ty³
Ð
p_Vid
, 
p_IÅ
, 
SI_SLICE
 );

821 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic_si
, &p_Vid->
imgD©a
, 0);

824 ià((
p_Vid
->
ty³
 =ð
SP_SLICE
è&& (
p_IÅ
->
¥_ouut_šdiÿtÜ
))

827 
	`ouut_SP_cÛffic›Ás
(
p_Vid
, 
p_IÅ
);

829 #ià(
MVC_EXTENSION_ENABLE
)

833 #ià(
MVC_EXTENSION_ENABLE
)

834 ià((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è&& (!
	`is_MVC_´ofže
(
p_Vid
->
aùive_¥s
->
´ofže_idc
) ||

835 Ð((
p_Vid
->
v›w_id
 =ð0è|| (p_Vid->v›w_id =ð1 &&…_Vid->
£c_v›w_fÜû_æd
)))))

837 ià(
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
)

840 
DecRefPicM¬kšg_t
 *
tmp_d½m
;

842 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

843 
p_Vid
->
p_rc_g’
->
F›ldCÚŒÞ
=1;

844 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

845 
p_Vid
->
bÙ_MB
 = 
FALSE
;

847 
äame_ty³
 = 
p_Vid
->
ty³
;

849 
p_Vid
->
f›ld_piùu»
 = 1;

852 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
)

854 
tmp_d½m
 = 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
;

855 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m
->
Next
;

856 
	`ä“
(
tmp_d½m
);

859 #ià(
MVC_EXTENSION_ENABLE
)

860 
	`f›ld_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic_±r
[0],…_Vid->field_pic_ptr[1]);

862 if(
p_IÅ
->
num_of_v›ws
==1 || 
p_Vid
->
v›w_id
==0)

864 if(
p_Vid
->
rd_·ss
 == 0)

865 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[0],…_Vid->
f›ld_pic_±r
[0],…_Vid->field_pic_ptr[1]);

866 if(
p_Vid
->
rd_·ss
 == 1)

867 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[1],…_Vid->
f›ld_pic_±r
[0],…_Vid->field_pic_ptr[1]);

869 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[2],…_Vid->
f›ld_pic_±r
[0],…_Vid->field_pic_ptr[1]);

871 
p_Vid
->
£c_v›w_fÜû_æd
 =…_Vid->
æd_æag
;

875 
p_Vid
->
æd_æag
 = (
by‹
èp_Vid->
£c_v›w_fÜû_æd
;

878 
	`f›ld_piùu»
 (
p_Vid
,…_Vid->
f›ld_pic
[0],…_Vid->field_pic[1]);

880 if(
p_Vid
->
rd_·ss
 == 0)

881 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[0],…_Vid->
f›ld_pic
[0],…_Vid->field_pic[1]);

882 if(
p_Vid
->
rd_·ss
 == 1)

883 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[1],…_Vid->
f›ld_pic
[0],…_Vid->field_pic[1]);

885 
p_Vid
->
æd_æag
 = 
	`piùu»_¡ruùu»_decisiÚ
 (p_Vid,…_Vid->
äame_pic
[2],…_Vid->
f›ld_pic
[0],…_Vid->field_pic[1]);

888 iàÐ
p_Vid
->
æd_æag
 )

890 
tmpF¿meQP
 = 
p_Vid
->
SumF¿meQP
;

891 
num_»f_idx_l0
 = 
p_Vid
->
num_»f_idx_l0_aùive
;

892 
num_»f_idx_l1
 = 
p_Vid
->
num_»f_idx_l1_aùive
;

895 iàÐ
p_Vid
->
æd_æag
==0 )

897 
p_Vid
->
ty³
 = (è
äame_ty³
;

900 
	`upd©e_f›ld_äame_cÚ‹xts
 (
p_Vid
,…_Vid->
æd_æag
);

903 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

904 
p_Vid
->
p_rc_g’
->
F›ldF¿me
 = !Õ_Vid->
æd_æag
) ? 1 : 0;

907 
p_Vid
->
æd_æag
 = 
FALSE
;

909 
p_Vid
->
SumF¿meQP
 = 
tmpF¿meQP
;

910 
p_Vid
->
num_»f_idx_l0_aùive
 = 
num_»f_idx_l0
;

911 
p_Vid
->
num_»f_idx_l1_aùive
 = 
num_»f_idx_l1
;

914 
	`ä“_¦iû_d©a
(
VideoP¬am‘”s
 *
p_Vid
)

916 
i
;

918 ià(
p_Vid
->
äame_pic_si
)

920 
	`ä“_¦iû_li¡
(
p_Vid
->
äame_pic_si
);

923 
i
 = 0; i < 
p_Vid
->
äm_™”
; i++)

925 ià(
p_Vid
->
äame_pic
[
i
])

927 
	`ä“_¦iû_li¡
(
p_Vid
->
äame_pic
[
i
]);

931 #ià(
MVC_EXTENSION_ENABLE
)

932 iàÐ
p_Vid
->
f›ld_pic_±r
 && (p_Vid->
p_IÅ
->
num_of_v›ws
==1 ||…_Vid->
v›w_id
==1) )

934 
i
 = 0; i < 2; i++)

936 ià(
p_Vid
->
f›ld_pic1
[
i
])

937 
	`ä“_¦iû_li¡
(
p_Vid
->
f›ld_pic1
[
i
]);

938 ià(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2 &&…_Vid->
f›ld_pic2
)

940 ià(
p_Vid
->
f›ld_pic2
[
i
])

941 
	`ä“_¦iû_li¡
(
p_Vid
->
f›ld_pic2
[
i
]);

946 ià(
p_Vid
->
f›ld_pic
)

948 
i
 = 0; i < 2; i++)

950 ià(
p_Vid
->
f›ld_pic
[
i
])

951 
	`ä“_¦iû_li¡
(
p_Vid
->
f›ld_pic
[
i
]);

957 
	`¡Üe_coded_piùu»
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

959 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

960 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

961 
´ofže_idc
 = 
p_Vid
->
aùive_¥s
->profile_idc;

963 #ià(
MVC_EXTENSION_ENABLE
)

964 iàÐ(
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è&& ((
p_Dpb
->
Ïy”_id
 =ð0 ) || !
	`is_MVC_´ofže
(
´ofže_idc
)))

966 iàÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 )

969 ià(
p_Vid
->
æd_æag
)

971 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_f›ld_piùu»
[0]->
¡©s
);

972 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_f›ld_piùu»
[1]->
¡©s
);

974 
	`¡Üe_piùu»_š_dpb
 (
p_Dpb
, 
p_Vid
->
’c_f›ld_piùu»
[1], &
p_IÅ
->
ouut
);

975 #ià(
MVC_EXTENSION_ENABLE
)

976 iàÐ
p_Vid
->
´oc_piùu»
 && 
	`is_MVC_´ofže
(
´ofže_idc
) )

978 
	`¡Üe_´oc_piùu»_š_dpb
 (
p_Vid
->
p_Dpb_Ïy”
[1],…_Vid->
´oc_piùu»
, &
p_IÅ
->
ouut
);

979 
p_Vid
->
´oc_piùu»
 = 
NULL
;

982 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»
[0]);

983 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»
[1]);

984 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»
[2]);

988 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_äame_piùu»
[p_Vid->
rd_·ss
]->
¡©s
);

990 ià(
p_Vid
->
rd_·ss
==2)

992 
	`»¶aû_tÝ_pic_w™h_äame
(
p_Dpb
, 
p_Vid
->
’c_äame_piùu»
[2], &
p_IÅ
->
ouut
);

993 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[0]);

994 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[1]);

996 ià(
p_Vid
->
rd_·ss
==1)

998 
	`»¶aû_tÝ_pic_w™h_äame
(
p_Dpb
, 
p_Vid
->
’c_äame_piùu»
[1], &
p_IÅ
->
ouut
);

999 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[0]);

1000 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[2]);

1004 if(
p_IÅ
->
»dundªt_pic_æag
==0 || (
p_Vid
->
key_äame
==0))

1006 
	`»¶aû_tÝ_pic_w™h_äame
(
p_Dpb
, 
p_Vid
->
’c_äame_piùu»
[0], &
p_IÅ
->
ouut
);

1007 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[1]);

1008 
	`ä“_¡ÜabË_piùu»
 (
p_Vid
,…_Vid->
’c_äame_piùu»
[2]);

1011 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_f›ld_piùu»
[1]);

1016 ià(
p_Vid
->
æd_æag
)

1018 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_f›ld_piùu»
[0]->
¡©s
);

1019 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_f›ld_piùu»
[1]->
¡©s
);

1020 
	`¡Üe_piùu»_š_dpb
(
p_Dpb
, 
p_Vid
->
’c_f›ld_piùu»
[1], &
p_IÅ
->
ouut
);

1021 #ià(
MVC_EXTENSION_ENABLE
)

1022 iàÐ
	`is_MVC_´ofže
(
´ofže_idc
è&& 
p_Vid
->
´oc_piùu»
)

1024 
	`¡Üe_´oc_piùu»_š_dpb
 (
p_Vid
->
p_Dpb_Ïy”
[1],…_Vid->
´oc_piùu»
, &
p_IÅ
->
ouut
);

1025 
p_Vid
->
´oc_piùu»
 = 
NULL
;

1031 ià((
p_IÅ
->
»dundªt_pic_æag
 !ð1è|| (
p_Vid
->
key_äame
 == 0))

1033 
	`upd©e_glob®_¡©s
(
p_IÅ
, 
p_Vid
->
p_Sts
, &p_Vid->
’c_piùu»
->
¡©s
);

1034 
	`¡Üe_piùu»_š_dpb
 (
p_Dpb
, 
p_Vid
->
’c_piùu»
, &
p_IÅ
->
ouut
);

1036 #ià(
MVC_EXTENSION_ENABLE
)

1037 iàÐ
	`is_MVC_´ofže
(
´ofže_idc
è&& 
p_Vid
->
´oc_piùu»
)

1039 
	`¡Üe_´oc_piùu»_š_dpb
 (
p_Vid
->
p_Dpb_Ïy”
[1],…_Vid->
´oc_piùu»
, &
p_IÅ
->
ouut
);

1040 
p_Vid
->
´oc_piùu»
 = 
NULL
;

1043 
	`ä“_piùu»s
(
p_Vid
, -1);

1049 
	`upd©e_b™couÁ”_¡©s
(
VideoP¬am‘”s
 *
p_Vid
)

1051 
p_Vid
->
p_Sts
->
b™_ùr_n
 =…_Vid->p_Sts->
b™_ùr
;

1052 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 0;

1053 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n
 =…_Vid->p_Sts->
b™_ùr_fžËr_d©a
;

1055 #ià(
MVC_EXTENSION_ENABLE
)

1056 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

1058 iàÐ
p_Vid
->
æd_æag
 )

1060 iàÐ
p_Vid
->
v›w_id
 == 1 )

1062 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[0] +ðp_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[0];

1063 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[1] +ðp_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[1];

1064 
p_Vid
->
p_Sts
->
b™_ùr_n_v
[0] =…_Vid->p_Sts->
b™_ùr_v
[0];

1065 
p_Vid
->
p_Sts
->
b™_ùr_n_v
[1] =…_Vid->p_Sts->
b™_ùr_v
[1];

1066 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[0] = 0;

1067 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1] = 0;

1068 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n_v
[0] =…_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[0];

1069 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n_v
[1] =…_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[1];

1074 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[p_Vid->
v›w_id
] +ðp_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->view_id];

1075 
p_Vid
->
p_Sts
->
b™_ùr_n_v
[p_Vid->
v›w_id
] =…_Vid->p_Sts->
b™_ùr_v
[p_Vid->view_id];

1076 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] = 0;

1077 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n_v
[p_Vid->
v›w_id
] =…_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[p_Vid->view_id];

1083 
	`upd©e_idr_Üd”_¡©s
(
VideoP¬am‘”s
 *
p_Vid
)

1085 iàÐ
p_Vid
->
æd_æag
 )

1088 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_tÝ_æd_pic
->
p_Sliû
[0].
ty³
 =ð
I_SLICE
 &&…_Vid->p_cu¼_äm_¡ruù->p_tÝ_æd_pic->
Çl_»f_idc
)

1090 
p_Vid
->
Ï¡INTRA
 = 
	`imax
Õ_Vid->Ï¡INTRA,…_Vid->
äame_no
);

1091 
p_Vid
->
Ï¡IÁ¿Numb”
 =…_Vid->
cu¼_äm_idx
;

1092 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_tÝ_æd_pic
->
idr_æag
 )

1094 
p_Vid
->
Ï¡_idr_di¥_Üd”
 = 
	`imax
Ðp_Vid->
äame_no
,…_Vid->last_idr_disp_order );

1095 
p_Vid
->
Ï¡_idr_code_Üd”
 =…_Vid->
cu¼_äm_idx
;

1099 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_bÙ_æd_pic
->
p_Sliû
[0].
ty³
 =ð
I_SLICE
 &&…_Vid->p_cu¼_äm_¡ruù->p_bÙ_æd_pic->
Çl_»f_idc
)

1101 
p_Vid
->
Ï¡INTRA
 = 
	`imax
Õ_Vid->Ï¡INTRA,…_Vid->
äame_no
);

1102 
p_Vid
->
Ï¡IÁ¿Numb”
 =…_Vid->
cu¼_äm_idx
;

1103 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_bÙ_æd_pic
->
idr_æag
 )

1105 
p_Vid
->
Ï¡_idr_di¥_Üd”
 = 
	`imax
Ðp_Vid->
äame_no
,…_Vid->last_idr_disp_order );

1106 
p_Vid
->
Ï¡_idr_code_Üd”
 =…_Vid->
cu¼_äm_idx
;

1113 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_äame_pic
->
p_Sliû
[0].
ty³
 =ð
I_SLICE
 &&…_Vid->p_cu¼_äm_¡ruù->p_äame_pic->
Çl_»f_idc
)

1115 
p_Vid
->
Ï¡INTRA
 = 
	`imax
Õ_Vid->Ï¡INTRA,…_Vid->
äame_no
);

1116 
p_Vid
->
Ï¡IÁ¿Numb”
 =…_Vid->
cu¼_äm_idx
;

1117 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
p_äame_pic
->
idr_æag
 )

1119 
p_Vid
->
Ï¡_idr_di¥_Üd”
 = 
	`imax
Ðp_Vid->
äame_no
,…_Vid->last_idr_disp_order );

1120 
p_Vid
->
Ï¡_idr_code_Üd”
 =…_Vid->
cu¼_äm_idx
;

1126 
	`upd©e_video_¡©s
(
VideoP¬am‘”s
 *
p_Vid
)

1128 
b™s
 = 0;

1129 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1132 if(
p_IÅ
->
RCEÇbË
)

1134 ià((!
p_IÅ
->
PicIÁ”Ïû
è&& (!p_IÅ->
MbIÁ”Ïû
))

1136 
b™s
 = (è(
p_Vid
->
p_Sts
->
b™_ùr
 -…_Vid->p_Sts->
b™_ùr_n
)

1137 + ()Ð
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n
 );

1139 iàÐ
p_IÅ
->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

1141 
b™s
 = ()(
p_Vid
->
p_Sts
->
b™_ùr
 - (p_Vid->
p_rc_quad
->
P´ev_b™s
))

1142 + ()Ð
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n
 );

1143 
p_Vid
->
p_rc_quad
->
P´ev_b™s
 =…_Vid->
p_Sts
->
b™_ùr
 +…_Vid->p_Sts->
b™_ùr_fžËr_d©a
;

1147 
b™s
 = (è(
p_Vid
->
p_Sts
->
b™_ùr
 -…_Vid->p_Sts->
b™_ùr_n
)

1148 + ()Ð
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n
 );

1152 
p_Vid
->
p_Sts
->
b™_couÁ”
[p_Vid->
ty³
] +ðp_Vid->p_Sts->
b™_ùr
 -…_Vid->p_Sts->
b™_ùr_n
;

1154 #ià(
MVC_EXTENSION_ENABLE
)

1155 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

1157 iàÐ
p_Vid
->
æd_æag
 )

1159 iàÐ
p_Vid
->
v›w_id
 == 1 )

1161 
´ev_ty³
 = (
p_Vid
->
p_´ed
->
p_äm_mvc
 + ( (p_Vid->
cu¼_äm_idx
 << 1è%…_Vid->p_´ed->
num_äames_mvc
 ))->
ty³
;

1163 
p_Vid
->
p_Sts
->
b™_couÁ”_v
[0][
´ev_ty³
] +ðp_Vid->p_Sts->
b™_ùr_v
[0] -…_Vid->p_Sts->
b™_ùr_n_v
[0];

1164 
p_Vid
->
p_Sts
->
b™_couÁ”_v
[1][p_Vid->
ty³
] +ðp_Vid->p_Sts->
b™_ùr_v
[1] -…_Vid->p_Sts->
b™_ùr_n_v
[1];

1169 
p_Vid
->
p_Sts
->
b™_couÁ”_v
[p_Vid->
v›w_id
][p_Vid->
ty³
] +ðp_Vid->p_Sts->
b™_ùr_v
[p_Vid->v›w_id] -…_Vid->p_Sts->
b™_ùr_n_v
[p_Vid->view_id];

1174  
b™s
;

1183 
	`’code_Úe_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1185 
i
;

1186 
ÅÏÃ
;

1189 
b™s
 = 0;

1191 
TIME_T
 
¡¬t_time
;

1192 
TIME_T
 
’d_time
;

1193 
št64
 
tmp_time
;

1195 
p_Vid
->
me_time
 = 0;

1196 
p_Vid
->
rd_·ss
 = 0;

1198 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1200  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ ){

1201 
p_Vid
->
’c_äame_piùu»_JV
[
ÅÏÃ
] = 
NULL
;

1205 
i
 = 0; i < 6; i++)

1206 
p_Vid
->
’c_äame_piùu»
[
i
] = 
NULL
;

1208 
	`g‘time
(&
¡¬t_time
);

1211 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

1224 
	`put_bufãr_äame
 (
p_Vid
);

1226 
	`š™_äame
 (
p_Vid
, 
p_IÅ
);

1228 ià(
p_IÅ
->
’abË_32_puÎdown
)

1230 iàÐ!
	`»ad_šput_d©a_32puÎdown
 (
p_Vid
) )

1237 iàÐ!
	`»ad_šput_d©a
 (
p_Vid
) )

1243 
	`´oûss_image
(
p_Vid
, 
p_IÅ
);

1244 
	`·d_bÜd”s
 (
p_IÅ
->
ouut
, 
p_Vid
->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
,…_Vid->
imgD©a
.
äm_d©a
);

1246 #ià(
MVC_EXTENSION_ENABLE
)

1247 if(
p_IÅ
->
num_of_v›ws
==1 || 
p_Vid
->
v›w_id
==0)

1249 
p_Vid
->
f›ld_pic_±r
 =…_Vid->
f›ld_pic1
;

1253 
p_Vid
->
f›ld_pic_±r
 =…_Vid->
f›ld_pic2
;

1260 
p_Vid
->
p_Di¡
->
äame_ùr
++;

1261 #ià(
MVC_EXTENSION_ENABLE
)

1262 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1264 
p_Vid
->
p_Di¡
->
äame_ùr_v
[p_Vid->
v›w_id
]++;

1268 if(
p_Vid
->
ty³
 =ð
SP_SLICE
)

1270 if(
p_IÅ
->
¥2_äame_šdiÿtÜ
)

1272 
p_Vid
->
¥2_äame_šdiÿtÜ
 = 
TRUE
;

1273 
	`»ad_SP_cÛffic›Ás
(
p_Vid
, 
p_IÅ
);

1278 
p_Vid
->
¥2_äame_šdiÿtÜ
 = 
FALSE
;

1281 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

1283 
	`wpxIn™WPXPas£s
(
p_Vid
, 
p_IÅ
);

1284 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
 =…_Vid->pWPX->
wp_rd_·s£s
;

1285 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 = 
WP_REGULAR
;

1288 ià(
p_IÅ
->
PicIÁ”Ïû
 =ð
FIELD_CODING
)

1289 
	`³rfÜm_’code_f›ld
(
p_Vid
);

1291 
	`³rfÜm_’code_äame
(
p_Vid
);

1293 
p_Vid
->
p_Sts
->
äame_couÁ”
++;

1294 
p_Vid
->
p_Sts
->
äame_ùr
[p_Vid->
ty³
]++;

1298 
	`wr™e_äame_piùu»
(
p_Vid
);

1300 #ià(
MVC_EXTENSION_ENABLE
)

1301 if(
p_IÅ
->
num_of_v›ws
==2)

1304 if((
p_Vid
->
ªchÜ_pic_æag
[0]==1è&& (p_Vid->
v›w_id
&1)==0)

1306 
p_Vid
->
´ev_v›w_is_ªchÜ
 = 1;

1310 
p_Vid
->
´ev_v›w_is_ªchÜ
 = 0;

1316 ià(
p_IÅ
->
PicIÁ”Ïû
 =ð
FRAME_CODING
)

1318 ià((
p_IÅ
->
rdÝt
 =ð3è&& (p_IÅ->
de
 =ð
LLN
è&& (
p_Vid
->
Çl_»ã»nû_idc
 != 0))

1320 
	`Upd©eDecod”s
 (
p_Vid
, 
p_IÅ
,…_Vid->
’c_piùu»
);

1323 ià(
p_IÅ
->
Re¡riùRef
)

1324 
	`Upd©ePix–M­
 (
p_Vid
, 
p_IÅ
);

1327 #ià
OUTPUT_REF_LIST


1329 
i
;

1330 
	`´štf
( " [L0]: " );

1331  
i
 = 0; i<
p_Vid
->
cu¼’tSliû
->
li¡Xsize
[0]; i++ )

1333 
	`´štf
Ð"%d ", 
p_Vid
->
cu¼’tSliû
->
li¡X
[0][
i
]->
poc
 / 2 );

1335 
	`´štf
( " [L1]: " );

1336  
i
 = 0; i<
p_Vid
->
cu¼’tSliû
->
li¡Xsize
[1]; i++ )

1338 
	`´štf
Ð"%d ", 
p_Vid
->
cu¼’tSliû
->
li¡X
[1][
i
]->
poc
 / 2 );

1340 
	`´štf
("\n");

1344 
	`ä“_¦iû_d©a
(
p_Vid
);

1347 iàÐ
p_IÅ
->
RCEÇbË
 )

1350 
b™s
 = ()Ð
p_Vid
->
p_Sts
->
b™_ùr
 -…_Vid->p_Sts->
b™_ùr_n
 )

1351 + ()Ð
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n
 );

1353 iàÐ
p_IÅ
->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

1354 
p_Vid
->
	`rc_upd©e_più_äame_±r
Õ_Vid, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_g’
, 
b™s
);

1358 
	`compu‹_di¡ÜtiÚ
(
p_Vid
, &p_Vid->
imgD©a
);

1361 if(
p_IÅ
->
»dundªt_pic_æag
)

1363 
	`¡ÜeRedundªtF¿me
(
p_Vid
);

1367 
	`¡Üe_coded_piùu»
(
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
v›w_id
]);

1370 
p_Vid
->
Av”ageF¿meQP
 = 
	`isign
Õ_Vid->
SumF¿meQP
è* ((
	`Ÿbs
Õ_Vid->SumF¿meQPè+ (èÕ_Vid->
F¿meSizeInMbs
 >> 1))/ ()…_Vid->FrameSizeInMbs);

1372 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 && 
p_Vid
->
ty³
 !ð
B_SLICE
 &&…_IÅ->
basicun™
 <…_Vid->
F¿meSizeInMbs
 )

1373 
p_Vid
->
p_rc_quad
->
Cu¼La¡QP
 =…_Vid->
Av”ageF¿meQP
 +…_Vid->p_rc_quad->
b™d•th_qp_sÿË
;

1375 #ifdeà
_LEAKYBUCKET_


1377 ià(!
p_Vid
->
»dundªt_codšg
)

1379 
p_Vid
->
B™_Bufãr
[p_Vid->
tÙ®_äame_bufãr
++] = (èÕ_Vid->
p_Sts
->
b™_ùr
 -…_Vid->p_Sts->
b™_ùr_n
)

1380 + ()Ð
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n
 );

1386 ià(
p_Vid
->
pic_Üd”_út_ty³
 == 2)

1388 ià(!
p_Vid
->
Çl_»ã»nû_idc
)

1389 
p_Vid
->
cÚ£cutive_nÚ_»ã»nû_piùu»s
++;

1391 
p_Vid
->
cÚ£cutive_nÚ_»ã»nû_piùu»s
 = 0;

1393 ià(
p_Vid
->
äame_no
 <…_Vid->
´ev_äame_no
 ||…_Vid->
cÚ£cutive_nÚ_»ã»nû_piùu»s
>1)

1394 
	`”rÜ
("POCype 2 cannot be‡pplied forhe coding…attern whereheƒncoding /decoding order of…ictures‡re different fromhe output order.\n", -1);

1395 
p_Vid
->
´ev_äame_no
 =…_Vid->
äame_no
;

1398 
	`g‘time
(&
’d_time
);

1399 
tmp_time
 = 
	`timediff
(&
¡¬t_time
, &
’d_time
);

1400 
p_Vid
->
tÙ_time
 +ð
tmp_time
;

1401 
tmp_time
 = 
	`tim’Üm
(tmp_time);

1402 
p_Vid
->
me_time
 = 
	`tim’Üm
(p_Vid->me_time);

1403 ià(
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
!=0 && 
p_IÅ
->
V”bo£
 != 3)

1404 
	`R•ÜtNALNÚVLCB™s
(
p_Vid
, 
tmp_time
);

1406 #ià(
MVC_EXTENSION_ENABLE
)

1407 ià(
p_Vid
->
cu¼_äm_idx
 =ð0 && !p_Vid->
v›w_id
)

1409 ià(
p_Vid
->
cu¼_äm_idx
 == 0)

1411 
	`R•ÜtFœ¡äame
(
p_Vid
, 
tmp_time
);

1414 
b™s
 = 
	`upd©e_video_¡©s
(
p_Vid
);

1416 
p_Vid
->
ty³
)

1418 
I_SLICE
:

1419 
SI_SLICE
:

1420 
	`R•ÜtI
(
p_Vid
, 
tmp_time
);

1422 
B_SLICE
:

1423 
	`R•ÜtB
(
p_Vid
, 
tmp_time
);

1425 
SP_SLICE
:

1426 
	`R•ÜtP
(
p_Vid
, 
tmp_time
);

1428 
P_SLICE
:

1430 
	`R•ÜtP
(
p_Vid
, 
tmp_time
);

1434 ià(
p_IÅ
->
V”bo£
 == 0)

1439 
	`´štf
("Com¶‘ed Encodšg F¿m%05d.\r", 
p_Vid
->
äame_no
);

1442 
	`fæush
(
¡dout
);

1445 if(
p_IÅ
->
RCEÇbË
)

1446 
p_Vid
->
	`rc_upd©e_piùu»_±r
Ðp_Vid, 
p_IÅ
, 
b™s
 );

1449 
	`upd©e_b™couÁ”_¡©s
(
p_Vid
);

1451 
	`upd©e_idr_Üd”_¡©s
(
p_Vid
);

1467 #ià(
MVC_EXTENSION_ENABLE
)

1468 
	`wr™eout_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
, 
is_bÙtom
)

1470 
·¹™iÚ
, 
¦iû
, 
b™s
;

1471 
Sliû
 *
cu¼Sliû
;

1472 
NALU_t
 *
Çlu
 = 
NULL
;

1474 
p_Vid
->
cu¼’tPiùu»
 = 
pic
;

1477 
¦iû
=0; sliû < 
pic
->
no_¦iûs
; slice++)

1479 
cu¼Sliû
 = 
pic
->
¦iûs
[
¦iû
];

1482 
·¹™iÚ
=0;…¬t™iÚ < 
cu¼Sliû
->
max_·¹_Ä
;…artition++)

1485 iàÐ
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
b™¡»am
->
wr™e_æag
 )

1487 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2 &&…_Vid->
v›w_id
==0)

1489 
Çlu
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

1490 
Çlu
->
¡¬tcod•»fix_Ën
 = 4;

1491 
Çlu
->
Çl_un™_ty³
 = 
NALU_TYPE_PREFIX
;

1492 
Çlu
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_HIGHEST
;

1493 
Çlu
->
svc_ex‹nsiÚ_æag
 = 0;

1494 
Çlu
->
nÚ_idr_æag
 = 
p_Vid
->nÚ_idr_æag[
is_bÙtom
];

1495 
Çlu
->
´iÜ™y_id
 = 
p_Vid
->priority_id;

1496 
Çlu
->
v›w_id
 = 
p_Vid
->view_id;

1497 
Çlu
->
‹mpÜ®_id
 = 
p_Vid
->temporal_id;

1498 
Çlu
->
ªchÜ_pic_æag
 = 
p_Vid
->ªchÜ_pic_æag[
is_bÙtom
];

1499 
Çlu
->
š‹r_v›w_æag
 = 
p_Vid
->š‹r_v›w_æag[
is_bÙtom
];

1500 
Çlu
->
»£rved_Úe_b™
 = 1;

1502 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

1503 
p_Vid
->
p_Sts
->
b™_ùr
 +ð
b™s
;

1504 
p_Vid
->
p_Sts
->
b™_ùr_v
[0] +ð
b™s
;

1505 
	`F»eNALU
(
Çlu
);

1508 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
Çl_un™
,…_Vid->
f_out
);

1509 
p_Vid
->
p_Sts
->
b™_ùr
 +ð
b™s
;

1510 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

1512 
p_Vid
->
p_Sts
->
b™_ùr_v
[p_Vid->
v›w_id
] +ð
b™s
;

1519 
	`wr™eout_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
pic
)

1521 
·¹™iÚ
, 
¦iû
, 
b™s
;

1522 
Sliû
 *
cu¼Sliû
;

1524 
p_Vid
->
cu¼’tPiùu»
 = 
pic
;

1527 
¦iû
=0; sliû < 
pic
->
no_¦iûs
; slice++)

1529 
cu¼Sliû
 = 
pic
->
¦iûs
[
¦iû
];

1532 
·¹™iÚ
=0;…¬t™iÚ < 
cu¼Sliû
->
max_·¹_Ä
;…artition++)

1535 ià(
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
b™¡»am
->
wr™e_æag
 )

1537 
b™s
 = 
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
Çl_un™
,…_Vid->
f_out
);

1538 
p_Vid
->
p_Sts
->
b™_ùr
 +ð
b™s
;

1546 
	`cÝy_·¿ms
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
’c_piùu»
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
)

1548 
’c_piùu»
->
äame_mbs_Úly_æag
 = 
aùive_¥s
->frame_mbs_only_flag;

1549 
’c_piùu»
->
äame_üÝpšg_æag
 = 
aùive_¥s
->frame_cropping_flag;

1550 
’c_piùu»
->
chroma_fÜm©_idc
 = 
aùive_¥s
->chroma_format_idc;

1551 
’c_piùu»
->
chroma_mask_mv_x
 = 
p_Vid
->chroma_mask_mv_x;

1552 
’c_piùu»
->
chroma_mask_mv_y
 = 
p_Vid
->chroma_mask_mv_y;

1553 
’c_piùu»
->
chroma_shiá_y
 = 
p_Vid
->chroma_shift_y;

1554 
’c_piùu»
->
chroma_shiá_x
 = 
p_Vid
->chroma_shift_x;

1555 
’c_piùu»
->
Ùf_æag
 = 
p_Vid
->
p_IÅ
->
OnTheFlyF¿ùMCP
;

1557 ià(
aùive_¥s
->
äame_üÝpšg_æag
)

1559 
’c_piùu»
->
äame_üÝ_Ëá_off£t
 = 
aùive_¥s
->frame_crop_left_offset;

1560 
’c_piùu»
->
äame_üÝ_right_off£t
 = 
aùive_¥s
->frame_crop_right_offset;

1561 
’c_piùu»
->
äame_üÝ_tÝ_off£t
 = 
aùive_¥s
->frame_crop_top_offset;

1562 
’c_piùu»
->
äame_üÝ_bÙtom_off£t
 = 
aùive_¥s
->frame_crop_bottom_offset;

1566 
’c_piùu»
->
äame_üÝ_Ëá_off£t
 = 0;

1567 
’c_piùu»
->
äame_üÝ_right_off£t
 = 0;

1568 
’c_piùu»
->
äame_üÝ_tÝ_off£t
 = 0;

1569 
’c_piùu»
->
äame_üÝ_bÙtom_off£t
 = 0;

1579 
	`´•¬e_’c_äame_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 **
¡Üed_pic
)

1581 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1582 (*
¡Üed_pic
èð
	`®loc_¡ÜabË_piùu»
 (
p_Vid
, (
Piùu»SŒuùu»
èp_Vid->
¡ruùu»
,…_Vid->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
);

1584 
p_Vid
->
ThisPOC
 =…_Vid->
äam•oc
;

1585 (*
¡Üed_pic
)->
poc
 = 
p_Vid
->
äam•oc
;

1586 (*
¡Üed_pic
)->
tÝ_poc
 = 
p_Vid
->
tÝpoc
;

1587 (*
¡Üed_pic
)->
bÙtom_poc
 = 
p_Vid
->
bÙtompoc
;

1588 (*
¡Üed_pic
)->
äame_poc
 = 
p_Vid
->
äam•oc
;

1589 (*
¡Üed_pic
)->
pic_num
 = 
p_Vid
->
äame_num
;

1590 (*
¡Üed_pic
)->
äame_num
 = 
p_Vid
->frame_num;

1591 (*
¡Üed_pic
)->
coded_äame
 = 1;

1592 (*
¡Üed_pic
)->
mb_aff_äame_æag
 = 
p_Vid
->mb_aff_äame_æag = (
BoÞ—n
è(
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_CODING
);

1594 
p_Vid
->
g‘_mb_block_pos
 =…_Vid->
mb_aff_äame_æag
 ? 
g‘_mb_block_pos_mbaff
 : 
g‘_mb_block_pos_nÜm®
;

1595 
p_Vid
->
g‘Neighbour
 =…_Vid->
mb_aff_äame_æag
 ? 
g‘AffNeighbour
 : 
g‘NÚAffNeighbour
;

1596 
p_Vid
->
’c_piùu»
 = *
¡Üed_pic
;

1598 
	`cÝy_·¿ms
(
p_Vid
,…_Vid->
’c_piùu»
,…_Vid->
aùive_¥s
);

1601 
	`ÿlc_piùu»_b™s
(
Piùu»
 *
äame
)

1603 
i
, 
j
;

1604 
Sliû
 *
thisSliû
 = 
NULL
;

1606 
äame
->
b™s_³r_piùu»
 = 0;

1608  
i
 = 0; i < 
äame
->
no_¦iûs
; i++ )

1610 
thisSliû
 = 
äame
->
¦iûs
[
i
];

1612  
j
 = 0; j < 
thisSliû
->
max_·¹_Ä
; j++ )

1613 
äame
->
b™s_³r_piùu»
 +ð8 * ((
thisSliû
->
·¹A¼
[
j
]).
b™¡»am
)->
by‹_pos
;

1623 
	`äame_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
äame
, 
ImageD©a
 *
imgD©a
, 
rd_·ss
)

1625 
ÅÏÃ
;

1626 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1627 
p_Vid
->
rd_·ss
 =„d_pass;

1628 
p_Vid
->
SumF¿meQP
 = 0;

1629 
p_Vid
->
num_»f_idx_l0_aùive
 = 0;

1630 
p_Vid
->
num_»f_idx_l1_aùive
 = 0;

1631 
p_Vid
->
p_cu¼_pic
 =…_Vid->
p_cu¼_äm_¡ruù
->
p_äame_pic
;

1632 
p_Vid
->
¡ruùu»
 = 
FRAME
;

1633 
p_Vid
->
PicSizeInMbs
 =…_Vid->
F¿meSizeInMbs
;

1635 
	`upd©e_mv_lim™s
(
p_Vid
, 
FALSE
);

1637 
	`In™WP
(
p_Vid
, 
p_IÅ
, 0);

1638 if(
rd_·ss
 =ð0 && 
p_Vid
->
wp_·¿m‘”s_£t
 == 0)

1639 
	`Re£tWP
(
p_Vid
, 
p_IÅ
);

1641 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1643  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

1645 
	`´•¬e_’c_äame_piùu»
Ð
p_Vid
, &p_Vid->
’c_äame_piùu»_JV
[
ÅÏÃ
] );

1650 
	`´•¬e_’c_äame_piùu»
Ð
p_Vid
, &p_Vid->
’c_äame_piùu»
[
rd_·ss
] );

1653 
p_Vid
->
æd_æag
 = 
FALSE
;

1654 
	`code_a_piùu»
(
p_Vid
, 
äame
);

1656 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1658 
	`make_äame_piùu»_JV
(
p_Vid
);

1661 
	`ÿlc_piùu»_b™s
(
äame
);

1663 ià(
p_Vid
->
¡ruùu»
==
FRAME
)

1665 
	`fšd_di¡ÜtiÚ
 (
p_Vid
, 
imgD©a
);

1666 
äame
->
di¡ÜtiÚ
 = 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
];

1677 
	`f›ld_piùu»
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
tÝ
, Piùu» *
bÙtom
)

1679 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1681 
TÝF›ldB™s
;

1683 
p_Vid
->
SumF¿meQP
 = 0;

1684 
p_Vid
->
num_»f_idx_l0_aùive
 = 0;

1685 
p_Vid
->
num_»f_idx_l1_aùive
 = 0;

1688 
	`upd©e_mv_lim™s
(
p_Vid
, 
TRUE
);

1690 
p_Vid
->
height
 = (
p_IÅ
->
ouut
.height[0] +…_Vid->
auto_üÝ_bÙtom
) >> 1;

1691 
p_Vid
->
height_ü
 =…_Vid->
height_ü_äame
 >> 1;

1692 
p_Vid
->
æd_æag
 = 
TRUE
;

1693 
p_Vid
->
PicSizeInMbs
 =…_Vid->
F¿meSizeInMbs
 >> 1;

1696 
p_Vid
->
’c_f›ld_piùu»
[0] = 
	`®loc_¡ÜabË_piùu»
 (p_Vid, (
Piùu»SŒuùu»
èp_Vid->
¡ruùu»
,…_Vid->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
);

1697 
p_Vid
->
’c_f›ld_piùu»
[0]->
poc
 =…_Vid->
tÝpoc
;

1698 
p_Vid
->
’c_f›ld_piùu»
[0]->
äame_poc
 =…_Vid->
tÝpoc
;

1700 
p_Vid
->
’c_f›ld_piùu»
[0]->
pic_num
 =…_Vid->
äame_num
;

1701 
p_Vid
->
’c_f›ld_piùu»
[0]->
äame_num
 =…_Vid->frame_num;

1702 
p_Vid
->
’c_f›ld_piùu»
[0]->
coded_äame
 = 0;

1703 
p_Vid
->
’c_f›ld_piùu»
[0]->
mb_aff_äame_æag
 =…_Vid->mb_aff_äame_æag = 
FALSE
;

1704 
p_Vid
->
g‘_mb_block_pos
 = 
g‘_mb_block_pos_nÜm®
;

1705 
p_Vid
->
g‘Neighbour
 = 
g‘NÚAffNeighbour
;

1706 
p_Vid
->
ThisPOC
 =…_Vid->
tÝpoc
;

1708 
p_Vid
->
p_cu¼_pic
 =…_Vid->
p_cu¼_äm_¡ruù
->
p_tÝ_æd_pic
;

1709 
p_Vid
->
¡ruùu»
 = 
TOP_FIELD
;

1710 
p_Vid
->
’c_piùu»
 =…_Vid->
’c_f›ld_piùu»
[0];

1711 
	`cÝy_·¿ms
(
p_Vid
,…_Vid->
’c_piùu»
,…_Vid->
aùive_¥s
);

1713 
	`put_bufãr_tÝ
 (
p_Vid
);

1714 
	`š™_f›ld
 (
p_Vid
, 
p_IÅ
);

1715 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
,…_Vid->
p_cu¼_pic
->
p_Sliû
[0].
ty³
);

1717 
p_Vid
->
æd_æag
 = 
TRUE
;

1720 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

1721 
	`rc_š™_tÝ_f›ld
(
p_Vid
, 
p_IÅ
);

1723 
	`code_a_piùu»
(
p_Vid
, 
tÝ
);

1724 
p_Vid
->
’c_piùu»
->
¡ruùu»
 = 
TOP_FIELD
;

1725 
	`¡Üe_piùu»_š_dpb
(
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
v›w_id
],…_Vid->
’c_f›ld_piùu»
[0], &
p_IÅ
->
ouut
);

1727 #ià(
MVC_EXTENSION_ENABLE
)

1728 iàÐ
	`is_MVC_´ofže
(
p_Vid
->
aùive_¥s
->
´ofže_idc
è&&…_Vid->
´oc_piùu»
)

1730 
	`¡Üe_´oc_piùu»_š_dpb
 (
p_Vid
->
p_Dpb_Ïy”
[1],…_Vid->
´oc_piùu»
, &
p_IÅ
->
ouut
);

1731 
p_Vid
->
´oc_piùu»
 = 
NULL
;

1734 
	`ÿlc_piùu»_b™s
(
tÝ
);

1737 
TÝF›ldB™s
=
tÝ
->
b™s_³r_piùu»
;

1740 
p_Vid
->
’c_f›ld_piùu»
[1] = 
	`®loc_¡ÜabË_piùu»
 (p_Vid, (
Piùu»SŒuùu»
èp_Vid->
¡ruùu»
,…_Vid->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
);

1741 
p_Vid
->
’c_f›ld_piùu»
[1]->
poc
õ_Vid->
bÙtompoc
;

1742 
p_Vid
->
’c_f›ld_piùu»
[1]->
äame_poc
 =…_Vid->
bÙtompoc
;

1743 
p_Vid
->
’c_f›ld_piùu»
[1]->
pic_num
 =…_Vid->
äame_num
;

1744 
p_Vid
->
’c_f›ld_piùu»
[1]->
äame_num
 =…_Vid->frame_num;

1745 
p_Vid
->
’c_f›ld_piùu»
[1]->
coded_äame
 = 0;

1746 
p_Vid
->
’c_f›ld_piùu»
[1]->
mb_aff_äame_æag
 =…_Vid->mb_aff_äame_æag = 
FALSE
;

1747 
p_Vid
->
g‘_mb_block_pos
 = 
g‘_mb_block_pos_nÜm®
;

1748 
p_Vid
->
g‘Neighbour
 = 
g‘NÚAffNeighbour
;

1750 
p_Vid
->
ThisPOC
 =…_Vid->
bÙtompoc
;

1751 
p_Vid
->
p_cu¼_pic
 =…_Vid->
p_cu¼_äm_¡ruù
->
p_bÙ_æd_pic
;

1752 
p_Vid
->
¡ruùu»
 = 
BOTTOM_FIELD
;

1753 
p_Vid
->
’c_piùu»
 =…_Vid->
’c_f›ld_piùu»
[1];

1754 
	`cÝy_·¿ms
(
p_Vid
,…_Vid->
’c_piùu»
,…_Vid->
aùive_¥s
);

1755 
	`put_bufãr_bÙ
 (
p_Vid
);

1757 
	`š™_f›ld
 (
p_Vid
, 
p_IÅ
);

1758 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
,…_Vid->
p_cu¼_pic
->
p_Sliû
[0].
ty³
);

1760 
p_Vid
->
æd_æag
 = 
TRUE
;

1763 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

1764 
	`rc_š™_bÙtom_f›ld
Ð
p_Vid
, 
p_IÅ
, 
TÝF›ldB™s
 );

1766 
p_Vid
->
’c_piùu»
->
¡ruùu»
 = 
BOTTOM_FIELD
;

1767 
	`code_a_piùu»
(
p_Vid
, 
bÙtom
);

1769 
	`ÿlc_piùu»_b™s
(
bÙtom
);

1773 
	`di¡ÜtiÚ_æd
 (
p_Vid
, 
p_IÅ
, 
tÝ
, &p_Vid->
imgD©a
);

1782 
	`combše_f›ld
(
VideoP¬am‘”s
 *
p_Vid
)

1784 
i
, 
k
;

1786 
i
 = 0; i < (
p_Vid
->
height
 >> 1); i++)

1788 
	`memýy
(
p_Vid
->
imgY_com
[
i
*2],…_Vid->
’c_f›ld_piùu»
[0]->
imgY
[i],…_Vid->
width
*(
img³l
));

1789 
	`memýy
(
p_Vid
->
imgY_com
[
i
*2 + 1],…_Vid->
’c_f›ld_piùu»
[1]->
imgY
[i],…_Vid->
width
*(
img³l
));

1792 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

1794 
k
 = 0; k < 2; k++)

1796 
i
 = 0; i < (
p_Vid
->
height_ü
 >> 1); i++)

1798 
	`memýy
(
p_Vid
->
imgUV_com
[
k
][
i
 * 2],…_Vid->
’c_f›ld_piùu»
[0]->
imgUV
[k][i],…_Vid->
width_ü
*(
img³l
));

1799 
	`memýy
(
p_Vid
->
imgUV_com
[
k
][
i
 * 2 + 1],…_Vid->
’c_f›ld_piùu»
[1]->
imgUV
[k][i],…_Vid->
width_ü
*(
img³l
));

1811 
	`di¡ÜtiÚ_æd
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
Piùu»
 *
f›ld_pic
, 
ImageD©a
 *
imgD©a
)

1813 
p_Vid
->
height
 = (
p_IÅ
->
ouut
.height[0] +…_Vid->
auto_üÝ_bÙtom
);

1814 
p_Vid
->
height_ü
 =…_Vid->
height_ü_äame
;

1816 
	`combše_f›ld
 (
p_Vid
);

1818 
p_Vid
->
pCurImg
 = 
imgD©a
->
äm_d©a
[0];

1819 
p_Vid
->
pImgOrg
[0] = 
imgD©a
->
äm_d©a
[0];

1821 ià(
p_IÅ
->
ouut
.
yuv_fÜm©
 !ð
YUV400
)

1823 
p_Vid
->
pImgOrg
[1] = 
imgD©a
->
äm_d©a
[1];

1824 
p_Vid
->
pImgOrg
[2] = 
imgD©a
->
äm_d©a
[2];

1827 
	`fšd_di¡ÜtiÚ
 (
p_Vid
, 
imgD©a
);

1828 
f›ld_pic
->
di¡ÜtiÚ
 = 
p_Vid
->
p_Di¡
->
m‘ric
[
SSE
];

1838 
by‹
 
	`decide_æd_äame
(
¢r_äame_Y
, 
¢r_f›ld_Y
, 
b™_f›ld
, 
b™_äame
, 
Ïmbda_piùu»
)

1840 
co¡_äame
, 
co¡_f›ld
;

1842 
co¡_äame
 = 
b™_äame
 * 
Ïmbda_piùu»
 + 
¢r_äame_Y
;

1843 
co¡_f›ld
 = 
b™_f›ld
 * 
Ïmbda_piùu»
 + 
¢r_f›ld_Y
;

1845 ià(
co¡_f›ld
 > 
co¡_äame
)

1846  
FALSE
;

1848  
TRUE
;

1857 
by‹
 
	`piùu»_¡ruùu»_decisiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
äame
, Piùu» *
tÝ
, Piùu» *
bÙ
)

1859 
Ïmbda_piùu»
;

1860 
s£_äame
, 
s£_f›ld
;

1861 
b™_äame
, 
b™_f›ld
;

1863 
Ïmbda_piùu»
 = 0.68 * 
	`pow
 (2, 
p_Vid
->
b™d•th_Ïmbda_sÿË
 + (Õ_Vid->
qp
 - 
SHIFT_QP
è/ 3.0)è* (Õ_Vid->
ty³
 =ð
B_SLICE
) ? 1 : 1);

1865 
s£_äame
 = 
äame
->
di¡ÜtiÚ
.
v®ue
[0] + frame->distortion.value[1] + frame->distortion.value[2];

1867 
s£_f›ld
 = 
tÝ
->
di¡ÜtiÚ
.
v®ue
[0] +op->distortion.value[1] +op->distortion.value[2];

1869 
b™_f›ld
 = 
tÝ
->
b™s_³r_piùu»
 + 
bÙ
->bits_per_picture;

1870 
b™_äame
 = 
äame
->
b™s_³r_piùu»
;

1871  
	`decide_æd_äame
 (
s£_äame
, 
s£_f›ld
, 
b™_f›ld
, 
b™_äame
, 
Ïmbda_piùu»
);

1881 
	`f›ld_mode_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
)

1883 
	`put_bufãr_äame
 (
p_Vid
);

1893 
	`äame_mode_bufãr
 (
VideoP¬am‘”s
 *
p_Vid
)

1895 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1896 
	`put_bufãr_äame
 (
p_Vid
);

1898 ià((
p_IÅ
->
PicIÁ”Ïû
 !ð
FRAME_CODING
)||Õ_IÅ->
MbIÁ”Ïû
 != FRAME_CODING))

1900 
p_Vid
->
height
 =…_Vid->height / 2;

1901 
p_Vid
->
height_ü
 =…_Vid->height_cr / 2;

1903 
	`put_bufãr_tÝ
 (
p_Vid
);

1905 
	`put_bufãr_bÙ
 (
p_Vid
);

1907 
p_Vid
->
height
 = (
p_IÅ
->
ouut
.height[0] +…_Vid->
auto_üÝ_bÙtom
);

1908 
p_Vid
->
height_ü
 =…_Vid->
height_ü_äame
;

1910 
	`put_bufãr_äame
 (
p_Vid
);

1921 
	`š™_dec_»f_pic_m¬kšg_bufãr
(
VideoP¬am‘”s
 *
p_Vid
)

1923 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
=
NULL
;

1933 
šlše
 
	`š™_fixed_qp_i_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_cur_äm
 )

1936 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

1938 ià(
p_Vid
->
»dundªt_codšg
)

1941 
p_Vid
->
qp
 = 
	`imš
(p_Vid->qp + 5, 51);

1952 
šlše
 
	`š™_fixed_qp_pb_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_cur_äm
, 
ty³
 )

1955 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

1966 
šlše
 
	`š™_fixed_qp_¥_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_cur_äm
 )

1968 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

1969 
p_Vid
->
qp¥
 = 
p_IÅ
->qpsp;

1980 
	`š™_fixed_qp
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1982 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

1984 ià(
p_cur_äm
->
Ïy”
 == 0)

1986  
p_cur_äm
->
ty³
 )

1989 
I_SLICE
:

1990 
	`š™_fixed_qp_i_¦iû
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
 );

1992 
P_SLICE
:

1993 
B_SLICE
:

1994 
	`š™_fixed_qp_pb_¦iû
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
,…_cur_äm->
ty³
 );

1996 
SP_SLICE
:

1997 
SI_SLICE
:

1998 
	`š™_fixed_qp_¥_¦iû
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
 );

2002 
p_Vid
->
mb_y_šŒa
 =…_Vid->
mb_y_upd
;

2004 ià(
p_IÅ
->
šŒa_upd
 > 0)

2006 
p_Vid
->
mb_y_upd
 = (p_Vid->
cu¼_äm_idx
 / 
p_IÅ
->
šŒa_upd
è% (p_Vid->
height
 / 
MB_BLOCK_SIZE
);

2011 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

2015 iàÐ
p_IÅ
->
qp2äame
 &&…_IÅ->qp2äam< 
p_Vid
->
äame_no
 )

2017 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ð
	`iCl3
Ð-p_Vid->
b™d•th_luma_qp_sÿË
, 
MAX_QP
,…_Vid->q°+ 
p_IÅ
->
qp2off
[
p_cur_äm
->
ty³
] );

2028 
	`š™_mb_lše_šŒa_up
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2030 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

2032 ià(
p_cur_äm
->
Ïy”
 == 0)

2034 
p_Vid
->
mb_y_šŒa
 =…_Vid->
mb_y_upd
;

2036 ià(
p_IÅ
->
šŒa_upd
 > 0)

2038 
p_Vid
->
mb_y_upd
 = (p_Vid->
cu¼_äm_idx
 / 
p_IÅ
->
šŒa_upd
è% (p_Vid->
width
 / 
MB_BLOCK_SIZE
);

2049 
	`š™_äame
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2051 
i
, 
j
;

2053 
p_Vid
->
cu¼’t_mb_Ä
 = 0;

2054 
p_Vid
->
cu¼’t_¦iû_Ä
 = 0;

2055 
p_Vid
->
p_Sts
->
b™_¦iû
 = 0;

2060 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2062  
j
 = 0; j < 
MAX_PLANE
; j++ ){

2063 
i
 = 0; i < ((è(
p_Vid
->
F¿meSizeInMbs
));i++)

2064 
p_Vid
->
mb_d©a_JV
[
j
][
i
].
¦iû_Ä
 = -1;

2069 
i
 = 0; i < ((è(
p_Vid
->
F¿meSizeInMbs
)); i++)

2070 
p_Vid
->
mb_d©a
[
i
].
¦iû_Ä
 = -1;

2073 iàÐ!(
p_IÅ
->
RCEÇbË
) )

2075 
	`š™_fixed_qp
(
p_Vid
, 
p_IÅ
);

2077 
	`š™_mb_lše_šŒa_up
(
p_Vid
, 
p_IÅ
);

2079 
p_Vid
->
no_ouut_of_´iÜ_pics_æag
 = 0;

2080 
p_Vid
->
lÚg_‹rm_»ã»nû_æag
 = 
FALSE
;

2082 
	`š™_dec_»f_pic_m¬kšg_bufãr
(
p_Vid
);

2084 if(
p_IÅ
->
WPI‹rMC
)

2085 
p_Vid
->
äameOff£tAvaž
 = 0;

2089 
p_Vid
->
dœeù_¥©Ÿl_mv_´ed_æag
 = (è
p_IÅ
->direct_spatial_mv_pred_flag;

2090 #ià(
MVC_EXTENSION_ENABLE
)

2091 iàÐ(
p_IÅ
->
num_of_v›ws
 =ð1è|| (
p_Vid
->
v›w_id
 == 0) )

2094 
p_Vid
->
DFDi§bËIdc
 = (è
p_IÅ
->DFDi§bËIdc[p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2095 
p_Vid
->
DFAÍhaC0Off£t
 = (è
p_IÅ
->
DFAÍha
 [p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2096 
p_Vid
->
DFB‘aOff£t
 = (è
p_IÅ
->
DFB‘a
 [p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2098 #ià(
MVC_EXTENSION_ENABLE
)

2101 
p_Vid
->
DFDi§bËIdc
 = (è
p_IÅ
->
EnhLay”DFDi§bËIdc
[p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2102 
p_Vid
->
DFAÍhaC0Off£t
 = (è
p_IÅ
->
EnhLay”DFAÍha
 [p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2103 
p_Vid
->
DFB‘aOff£t
 = (è
p_IÅ
->
EnhLay”DFB‘a
 [p_Vid->
Çl_»ã»nû_idc
 > 0][p_Vid->
ty³
];

2106 
p_Vid
->
Ad­tiveRoundšg
 = 
p_IÅ
->AdaptiveRounding;

2115 
	`š™_f›ld
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2117 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

2119 
p_Vid
->
cu¼’t_mb_Ä
 = 0;

2120 
p_Vid
->
cu¼’t_¦iû_Ä
 = 0;

2121 
p_Vid
->
p_Sts
->
b™_¦iû
 = 0;

2123 ià(!
p_cur_äm
->
Ïy”
)

2125 if(!
p_IÅ
->
RCEÇbË
)

2127 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

2128 ià(
p_Vid
->
ty³
 =ð
SP_SLICE
 ||…_Vid->ty³ =ð
SI_SLICE
)

2130 
p_Vid
->
qp¥
 = 
p_IÅ
->qpsp;

2133 
	`š™_mb_lše_šŒa_up
Ð
p_Vid
, 
p_IÅ
 );

2137 if(!
p_IÅ
->
RCEÇbË
)

2139 
p_Vid
->
qp
 = 
p_cur_äm
->qp;

2144 
	`G’”©eImagePy¿mid
(
VideoP¬am‘”s
 *
p_Vid
, 
size_x
, 
size_y
, 
img³l
 ***
p_hme_img
, 
off£t_x
, 
off£t_y
)

2146 
i
, 
iP»vWidth
, 
iP»vHeight
,
iCu¼Width
, 
iCu¼Height
;

2147 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

2149 
iP»vWidth
 = 
size_x
;

2150 
iP»vHeight
 = 
size_y
;

2152 
i
=1; i < 
pHMEInfo
->
iPy¿midLev–s
; i++)

2154 
iCu¼Width
 = 
iP»vWidth
 >>1;

2155 
iCu¼Height
 = 
iP»vHeight
 >>1;

2157 
	`PyrDownG5x5_U8CnR
((cÚ¡ 
img³l
 *è*(
p_hme_img
[
i
-1]), (è(Õ_hme_img[i-1][1]-p_hme_img[i-1][0])*(img³l)), 
iP»vWidth
, 
iP»vHeight
, *(p_hme_img[i]), () ((p_hme_img[i][1]-p_hme_img[i][0])*(imgpel)), 1);

2160 
iP»vWidth
 = 
iCu¼Width
;

2161 
iP»vHeight
 = 
iCu¼Height
;

2166 
	`G’”©eHMELay”s
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
)

2169 
s
->
pHmeImage
[0] = s->
p_cu¼_img
;

2170 
	`G’”©eImagePy¿mid
(
p_Vid
, 
s
->
size_x
, s->
size_y
, s->
pHmeImage
, 
IMG_PAD_SIZE_X
, 
IMG_PAD_SIZE_Y
);

2172 
	`G‘HMEIÁImagesLuma
(
p_Vid
, 
s
->
size_x
, s->
size_y
, s->
pHmeImage
);

2187 
	`Unif›dOÃFÜthPix
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
)

2189 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2190 if(
s
->
bIÁ”pÞ©ed
)

2192 
s
->
bIÁ”pÞ©ed
 = 1;

2194 
s
->
p_img_sub
[0] = s->
imgY_sub
;

2195 
s
->
p_cu¼_img_sub
 = s->
imgY_sub
;

2196 
s
->
p_cu¼_img
 = s->
imgY
;

2201 iàÐ(!
p_IÅ
->
OnTheFlyF¿ùMCP
è|| (p_IÅ->OnTheFlyF¿ùMCP==
OTF_L1
) )

2203 
	`g‘SubImagesLuma
 ( 
p_Vid
, 
s
 );

2205 iàÐ((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
ChromaMCBufãr
)è||…_Vid->
P444_jošed
 )

2207 ià(
p_Vid
->
P444_jošed
)

2209 
img³l
 **** 
p_cu¼_img_sub
 = 
s
->p_curr_img_sub;

2210 
img³l
 ** 
p_cu¼_img
 = 
s
->p_curr_img;

2212 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

2213 
s
->
p_cu¼_img_sub
 = s->
imgUV_sub
[0];

2214 
s
->
p_cu¼_img
 = s->
imgUV
[0];

2215 
	`g‘SubImagesLuma
 (
p_Vid
, 
s
);

2217 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

2218 
s
->
p_cu¼_img_sub
 = s->
imgUV_sub
[1];

2219 
s
->
p_cu¼_img
 = s->
imgUV
[1];

2220 
	`g‘SubImagesLuma
 (
p_Vid
, 
s
);

2222 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

2223 
s
->
p_cu¼_img_sub
 =…_curr_img_sub;

2224 
s
->
p_cu¼_img
 =…_curr_img;

2228 
	`g‘SubImagesChroma
Ð
p_Vid
, 
s
 );

2235 
	`OtfCom·tibž™y_cÝyW™hPaddšg
Ð
s
->
imgY
, s->imgY, s->
size_x
, s->
size_y
, 
IMG_PAD_SIZE_X
, 
IMG_PAD_SIZE_Y
 ) ;

2236 
	`OtfCom·tibž™y_cÝyW™hPaddšg
Ð
s
->
imgUV
[0], s->imgUV[0], s->
size_x_ü
, s->
size_y_ü
, 
p_Vid
->
·d_size_uv_x
,p_Vid->
·d_size_uv_y
 ) ;

2237 
	`OtfCom·tibž™y_cÝyW™hPaddšg
Ð
s
->
imgUV
[1], s->imgUV[1], s->
size_x_ü
, s->
size_y_ü
, 
p_Vid
->
·d_size_uv_x
,…_Vid->
·d_size_uv_y
 ) ;

2251 
	`Unif›dOÃFÜthPix_JV
 (
VideoP¬am‘”s
 *
p_Vid
, 
ÅÏÃ
, 
StÜabËPiùu»
 *
s
)

2253 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2255 ifÐ
ÅÏÃ
 == 0 )

2257 if(
s
->
bIÁ”pÞ©ed
)

2259 
s
->
bIÁ”pÞ©ed
 = 1;

2260 
s
->
p_img
[0] = s->
imgY
;

2261 
s
->
p_img
[1] = s->
imgUV
[0];

2262 
s
->
p_img
[2] = s->
imgUV
[1];

2264 iàÐ(!
p_IÅ
->
OnTheFlyF¿ùMCP
è|| (p_IÅ->OnTheFlyF¿ùMCP==
OTF_L1
) )

2266 
s
->
p_img_sub
[0] = s->
imgY_sub
;

2267 
s
->
p_img_sub
[1] = s->
imgUV_sub
[0];

2268 
s
->
p_img_sub
[2] = s->
imgUV_sub
[1];

2273 
s
->
cÞour_¶ªe_id
 = 
ÅÏÃ
;

2274 
s
->
p_cu¼_img
 = s->
p_img
[
ÅÏÃ
];

2275 
s
->
p_cu¼_img_sub
 = s->
p_img_sub
[
ÅÏÃ
];

2277 ifÐ(!
p_IÅ
->
OnTheFlyF¿ùMCP
è|| (p_IÅ->OnTheFlyF¿ùMCP==
OTF_L1
) )

2279 
	`g‘SubImagesLuma
 ( 
p_Vid
, 
s
 );

2284 
	`OtfCom·tibž™y_cÝyW™hPaddšg
Ð
s
->
p_img
[
ÅÏÃ
], s->p_img[ÅÏÃ], s->
size_x
, s->
size_y
, 
IMG_PAD_SIZE_X
, 
IMG_PAD_SIZE_Y
 ) ;

2294 
BoÞ—n
 
	`dummy_¦iû_too_big
 (
b™s_¦iû
)

2296  
FALSE
;

2299 
	`R•ÜtSim¶e
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
Di¡M‘ric
 *
m‘ric
, 
tmp_time
)

2301 #ià(
MVC_EXTENSION_ENABLE
)

2302 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2304 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 0 )

2306 
p_Vid
->
´ev_cs
.
äm_no_š_fže
 =…_Vid->frm_no_in_file;

2307 
p_Vid
->
´ev_cs
.
v›w_id
 =…_Vid->view_id;

2308 
p_Vid
->
´ev_cs
.
cur_b™s
 = cur_bits;

2309 
	`¡rýy
Ð
p_Vid
->
´ev_cs
.
pic_ty³
,…ic_type );

2310 
p_Vid
->
´ev_cs
.
Av”ageF¿meQP
 =…_Vid->AverageFrameQP;

2311 
p_Vid
->
´ev_cs
.
Ïmbda
 = 0;

2312 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0] = 
m‘ric
->
v®ue
[0];

2313 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[1] = 
m‘ric
->
v®ue
[1];

2314 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[2] = 
m‘ric
->
v®ue
[2];

2315 
p_Vid
->
´ev_cs
.
ssim_v®ue
[0] = 0;

2316 
p_Vid
->
´ev_cs
.
ssim_v®ue
[1] = 0;

2317 
p_Vid
->
´ev_cs
.
ssim_v®ue
[2] = 0;

2318 
p_Vid
->
´ev_cs
.
tmp_time
 =mp_time;

2319 
p_Vid
->
´ev_cs
.
me_time
 = ()p_Vid->me_time;

2320 
p_Vid
->
´ev_cs
.
æd_æag
 =…_Vid->fld_flag;

2321 
p_Vid
->
´ev_cs
.
šŒas
 =…_Vid->intras;

2322 
p_Vid
->
´ev_cs
.
dœeù_mode
 = 0;

2323 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
 =…_Vid->num_ref_idx_l0_active;

2324 
p_Vid
->
´ev_cs
.
num_»f_idx_l1_aùive
 =…_Vid->num_ref_idx_l1_active;

2325 
p_Vid
->
´ev_cs
.
rd_·ss
 =…_Vid->rd_pass;

2326 
p_Vid
->
´ev_cs
.
Çl_»ã»nû_idc
 =…_Vid->nal_reference_idc;

2328 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 1 )

2330 
	`´štf
 ("%05d(%3s) %1d %8d %2d %7.3f %7.3f %7.3f %9d %7d %3s %d\n",

2331 
p_Vid
->
´ev_cs
.
äm_no_š_fže
,…_Vid->´ev_cs.
pic_ty³
,…_Vid->´ev_cs.
v›w_id
,

2332 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[0] -…_Vid->p_Sts->
b™_ùr_n_v
[0]è+ ()Õ_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[0] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[0]),

2333 
p_Vid
->
´ev_cs
.
Av”ageF¿meQP
,

2334 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0],…_Vid->prev_cs.psnr_value[1],…_Vid->prev_cs.psnr_value[2],

2335 
p_Vid
->
´ev_cs
.
tmp_time
, (èp_Vid->´ev_cs.
me_time
,

2336 
p_Vid
->
´ev_cs
.
æd_æag
 ? "FLD" : "FRM",

2337 
p_Vid
->
´ev_cs
.
Çl_»ã»nû_idc
);

2338 
	`´štf
 ("%05d(%3s) %1d %8d %2d %7.3f %7.3f %7.3f %9d %7d %3s %d\n",

2339 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
,

2340 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[1] -…_Vid->p_Sts->
b™_ùr_n_v
[1]è+ ()Õ_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[1] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[1]),

2341 
p_Vid
->
Av”ageF¿meQP
,

2342 
m‘ric
->
v®ue
[0], metric->value[1], metric->value[2],

2343 
tmp_time
, (è
p_Vid
->
me_time
,

2344 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",

2345 
p_Vid
->
Çl_»ã»nû_idc
);

2349 
	`´štf
 ("%05d(%3s) %1d %8d %2d %7.3f %7.3f %7.3f %9d %7d %3s %d\n",

2350 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
,

2351 
p_Vid
->
Av”ageF¿meQP
,

2352 
m‘ric
->
v®ue
[0], metric->value[1], metric->value[2],

2353 
tmp_time
, (è
p_Vid
->
me_time
,

2354 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",

2355 
p_Vid
->
Çl_»ã»nû_idc
);

2360 
	`´štf
 ("%05d(%3s)%8d %2d %7.3f %7.3f %7.3f %9d %7d %3s %d\n",

2361 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
,

2362 
p_Vid
->
Av”ageF¿meQP
,

2363 
m‘ric
->
v®ue
[0], metric->value[1], metric->value[2],

2364 
tmp_time
, (è
p_Vid
->
me_time
,

2365 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",

2366 
p_Vid
->
Çl_»ã»nû_idc
);

2369 
	`R•ÜtV”bo£
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, 
tmp_time
, 
dœeù_mode
)

2371 #ià(
MVC_EXTENSION_ENABLE
)

2372 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2374 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 0 )

2376 
p_Vid
->
´ev_cs
.
äm_no_š_fže
 =…_Vid->frm_no_in_file;

2377 
p_Vid
->
´ev_cs
.
v›w_id
 =…_Vid->view_id;

2378 
p_Vid
->
´ev_cs
.
cur_b™s
 = cur_bits;

2379 
	`¡rýy
Ð
p_Vid
->
´ev_cs
.
pic_ty³
,…ic_type );

2380 
p_Vid
->
´ev_cs
.
Av”ageF¿meQP
 =…_Vid->AverageFrameQP;

2381 
p_Vid
->
´ev_cs
.
Ïmbda
 = 0;

2382 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0] = 
mPSNR
->
v®ue
[0];

2383 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[1] = 
mPSNR
->
v®ue
[1];

2384 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[2] = 
mPSNR
->
v®ue
[2];

2385 
p_Vid
->
´ev_cs
.
ssim_v®ue
[0] = 0;

2386 
p_Vid
->
´ev_cs
.
ssim_v®ue
[1] = 0;

2387 
p_Vid
->
´ev_cs
.
ssim_v®ue
[2] = 0;

2388 
p_Vid
->
´ev_cs
.
tmp_time
 =mp_time;

2389 
p_Vid
->
´ev_cs
.
me_time
 = ()p_Vid->me_time;

2390 
p_Vid
->
´ev_cs
.
æd_æag
 =…_Vid->fld_flag;

2391 
p_Vid
->
´ev_cs
.
šŒas
 =…_Vid->intras;

2392 
p_Vid
->
´ev_cs
.
dœeù_mode
 = direct_mode;

2393 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
 =…_Vid->num_ref_idx_l0_active;

2394 
p_Vid
->
´ev_cs
.
num_»f_idx_l1_aùive
 =…_Vid->num_ref_idx_l1_active;

2395 
p_Vid
->
´ev_cs
.
rd_·ss
 =…_Vid->rd_pass;

2396 
p_Vid
->
´ev_cs
.
Çl_»ã»nû_idc
 =…_Vid->nal_reference_idc;

2398 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 1 )

2400 
	`´štf
 ("%05d(%3s) %1d %8d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2401 
p_Vid
->
´ev_cs
.
äm_no_š_fže
,…_Vid->´ev_cs.
pic_ty³
,…_Vid->´ev_cs.
v›w_id
,

2402 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[0] -…_Vid->p_Sts->
b™_ùr_n_v
[0]è+ ()Õ_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[0] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[0]),

2403 
p_Vid
->
´ev_cs
.
wp_m‘hod
,…_Vid->´ev_cs.
Av”ageF¿meQP
,…_Vid->´ev_cs.
Ïmbda
,

2404 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0],…_Vid->prev_cs.psnr_value[1],…_Vid->prev_cs.psnr_value[2],

2405 
p_Vid
->
´ev_cs
.
tmp_time
, (èp_Vid->´ev_cs.
me_time
,

2406 
p_Vid
->
´ev_cs
.
æd_æag
 ? "FLD" : "FRM",…_Vid->´ev_cs.
šŒas
,…_Vid->´ev_cs.
dœeù_mode
,

2407 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
,…_Vid->´ev_cs.
num_»f_idx_l1_aùive
,…_Vid->´ev_cs.
rd_·ss
,…_Vid->´ev_cs.
Çl_»ã»nû_idc
);

2408 
	`´štf
 ("%05d(%3s) %1d %8d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2409 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
,

2410 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[1] -…_Vid->p_Sts->
b™_ùr_n_v
[1]è+ ()Õ_Vid->p_Sts->
b™_ùr_fžËr_d©a_v
[1] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[1]), 
wp_m‘hod
,

2411 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2412 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2413 
tmp_time
, (è
p_Vid
->
me_time
,

2414 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2415 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2419 
	`´štf
 ("%05d(%3s) %1d %8d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2420 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
wp_m‘hod
,

2421 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2422 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2423 
tmp_time
, (è
p_Vid
->
me_time
,

2424 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2425 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2431 
	`´štf
 ("%05d(%3s)%8d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2432 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
wp_m‘hod
,

2433 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2434 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2435 
tmp_time
, (è
p_Vid
->
me_time
,

2436 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2437 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2441 
	`R•ÜtV”bo£NVB
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, 
tmp_time
, 
dœeù_mode
)

2443 #ià(
MVC_EXTENSION_ENABLE
)

2444 iàÐ
p_Vid
->
num_of_Ïy”s
 == 2 )

2446 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 0 )

2448 
p_Vid
->
´ev_cs
.
äm_no_š_fže
 =…_Vid->frm_no_in_file;

2449 
p_Vid
->
´ev_cs
.
v›w_id
 =…_Vid->view_id;

2450 
p_Vid
->
´ev_cs
.
cur_b™s
 = cur_bits;

2451 
	`¡rýy
Ð
p_Vid
->
´ev_cs
.
pic_ty³
,…ic_type );

2452 
p_Vid
->
´ev_cs
.
Av”ageF¿meQP
 =…_Vid->AverageFrameQP;

2453 
p_Vid
->
´ev_cs
.
Ïmbda
 = 0;

2454 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0] = 
mPSNR
->
v®ue
[0];

2455 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[1] = 
mPSNR
->
v®ue
[1];

2456 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[2] = 
mPSNR
->
v®ue
[2];

2457 
p_Vid
->
´ev_cs
.
ssim_v®ue
[0] = 0;

2458 
p_Vid
->
´ev_cs
.
ssim_v®ue
[1] = 0;

2459 
p_Vid
->
´ev_cs
.
ssim_v®ue
[2] = 0;

2460 
p_Vid
->
´ev_cs
.
tmp_time
 =mp_time;

2461 
p_Vid
->
´ev_cs
.
me_time
 = ()p_Vid->me_time;

2462 
p_Vid
->
´ev_cs
.
æd_æag
 =…_Vid->fld_flag;

2463 
p_Vid
->
´ev_cs
.
šŒas
 =…_Vid->intras;

2464 
p_Vid
->
´ev_cs
.
dœeù_mode
 = direct_mode;

2465 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
 =…_Vid->num_ref_idx_l0_active;

2466 
p_Vid
->
´ev_cs
.
num_»f_idx_l1_aùive
 =…_Vid->num_ref_idx_l1_active;

2467 
p_Vid
->
´ev_cs
.
rd_·ss
 =…_Vid->rd_pass;

2468 
p_Vid
->
´ev_cs
.
Çl_»ã»nû_idc
 =…_Vid->nal_reference_idc;

2470 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 1 )

2472 
	`´štf
 ("%05d(%3s) %1d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2473 
p_Vid
->
´ev_cs
.
äm_no_š_fže
,…_Vid->´ev_cs.
pic_ty³
,…_Vid->´ev_cs.
v›w_id
,

2474 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[0] -…_Vid->p_Sts->
b™_ùr_n_v
[0])

2475 + ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[0] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[0]è+…_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[0],

2476 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[0],…_Vid->
´ev_cs
.
wp_m‘hod
,…_Vid->´ev_cs.
Av”ageF¿meQP
,…_Vid->´ev_cs.
Ïmbda
,

2477 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0],…_Vid->prev_cs.psnr_value[1],…_Vid->prev_cs.psnr_value[2],

2478 
p_Vid
->
´ev_cs
.
tmp_time
, (èp_Vid->´ev_cs.
me_time
,

2479 
p_Vid
->
´ev_cs
.
æd_æag
 ? "FLD" : "FRM",…_Vid->´ev_cs.
šŒas
,…_Vid->´ev_cs.
dœeù_mode
,

2480 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
,…_Vid->´ev_cs.
num_»f_idx_l1_aùive
,…_Vid->´ev_cs.
rd_·ss
,…_Vid->´ev_cs.
Çl_»ã»nû_idc
);

2481 
	`´štf
 ("%05d(%3s) %1d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2482 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
,

2483 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[1] -…_Vid->p_Sts->
b™_ùr_n_v
[1])

2484 + ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[1] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[1]è+…_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[1],

2485 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1], 
wp_m‘hod
,

2486 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2487 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2488 
tmp_time
, (è
p_Vid
->
me_time
,

2489 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2490 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2494 
	`´štf
 ("%05d(%3s) %1d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d %d\n",

2495 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2496 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2497 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2498 
tmp_time
, (è
p_Vid
->
me_time
,

2499 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2500 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
,…_Vid->
iIÁ”V›wMBs
);

2506 
	`´štf
 ("%05d(%3s)%8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2507 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2508 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2509 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2510 
tmp_time
, (è
p_Vid
->
me_time
,

2511 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2512 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2517 
	`R•ÜtV”bo£FDN
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, 
tmp_time
, 
dœeù_mode
)

2519 #ià(
MVC_EXTENSION_ENABLE
)

2520 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2522 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 0 )

2524 
p_Vid
->
´ev_cs
.
äm_no_š_fže
 =…_Vid->frm_no_in_file;

2525 
p_Vid
->
´ev_cs
.
v›w_id
 =…_Vid->view_id;

2526 
p_Vid
->
´ev_cs
.
cur_b™s
 = cur_bits;

2527 
	`¡rýy
Ð
p_Vid
->
´ev_cs
.
pic_ty³
,…ic_type );

2528 
p_Vid
->
´ev_cs
.
Av”ageF¿meQP
 =…_Vid->AverageFrameQP;

2529 
p_Vid
->
´ev_cs
.
Ïmbda
 = 0;

2530 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0] = 
mPSNR
->
v®ue
[0];

2531 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[1] = 
mPSNR
->
v®ue
[1];

2532 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[2] = 
mPSNR
->
v®ue
[2];

2533 
p_Vid
->
´ev_cs
.
ssim_v®ue
[0] = 0;

2534 
p_Vid
->
´ev_cs
.
ssim_v®ue
[1] = 0;

2535 
p_Vid
->
´ev_cs
.
ssim_v®ue
[2] = 0;

2536 
p_Vid
->
´ev_cs
.
tmp_time
 =mp_time;

2537 
p_Vid
->
´ev_cs
.
me_time
 = ()p_Vid->me_time;

2538 
p_Vid
->
´ev_cs
.
æd_æag
 =…_Vid->fld_flag;

2539 
p_Vid
->
´ev_cs
.
šŒas
 =…_Vid->intras;

2540 
p_Vid
->
´ev_cs
.
dœeù_mode
 = direct_mode;

2541 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
 =…_Vid->num_ref_idx_l0_active;

2542 
p_Vid
->
´ev_cs
.
num_»f_idx_l1_aùive
 =…_Vid->num_ref_idx_l1_active;

2543 
p_Vid
->
´ev_cs
.
rd_·ss
 =…_Vid->rd_pass;

2544 
p_Vid
->
´ev_cs
.
Çl_»ã»nû_idc
 =…_Vid->nal_reference_idc;

2546 iàÐ
p_Vid
->
æd_æag
 &&…_Vid->
v›w_id
 == 1 )

2548 
	`´štf
 ("%05d(%3s) %1d %8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2549 
p_Vid
->
´ev_cs
.
äm_no_š_fže
,…_Vid->´ev_cs.
pic_ty³
,…_Vid->´ev_cs.
v›w_id
,

2550 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[0] -…_Vid->p_Sts->
b™_ùr_n_v
[0])

2551 + ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[0] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[0]è+…_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[0],

2552 ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[0] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[0]),

2553 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[0],

2554 
p_Vid
->
´ev_cs
.
wp_m‘hod
,…_Vid->´ev_cs.
Av”ageF¿meQP
,…_Vid->´ev_cs.
Ïmbda
,

2555 
p_Vid
->
´ev_cs
.
p¢r_v®ue
[0],…_Vid->prev_cs.psnr_value[1],…_Vid->prev_cs.psnr_value[2],

2556 
p_Vid
->
´ev_cs
.
tmp_time
, (èp_Vid->´ev_cs.
me_time
,

2557 
p_Vid
->
´ev_cs
.
æd_æag
 ? "FLD" : "FRM",…_Vid->´ev_cs.
šŒas
,…_Vid->´ev_cs.
dœeù_mode
,

2558 
p_Vid
->
´ev_cs
.
num_»f_idx_l0_aùive
,…_Vid->´ev_cs.
num_»f_idx_l1_aùive
,…_Vid->´ev_cs.
rd_·ss
,…_Vid->´ev_cs.
Çl_»ã»nû_idc
);

2559 
	`´štf
 ("%05d(%3s) %1d %8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2560 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
,

2561 ()(
p_Vid
->
p_Sts
->
b™_ùr_v
[1] -…_Vid->p_Sts->
b™_ùr_n_v
[1])

2562 + ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[1] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[1]è+…_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n_v
[1],

2563 ()(
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[1] -…_Vid->p_Sts->
b™_ùr_fžËr_d©a_n_v
[1]),

2564 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[1],

2565 
wp_m‘hod
,

2566 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2567 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2568 
tmp_time
, (è
p_Vid
->
me_time
,

2569 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2570 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2574 
	`´štf
 ("%05d(%3s) %1d %8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2575 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2576 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2577 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2578 
tmp_time
, (è
p_Vid
->
me_time
,

2579 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2580 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2586 
	`´štf
 ("%05d(%3s)%8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2587 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2588 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2589 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2590 
tmp_time
, (è
p_Vid
->
me_time
,

2591 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2592 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2596 
	`R•ÜtV”bo£SSIM
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, Di¡M‘riø*
mSSIM
,
tmp_time
, 
dœeù_mode
)

2598 #ià(
MVC_EXTENSION_ENABLE
)

2599 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2601 
	`´štf
 ("%05d(%3s) %1d %8d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2602 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
wp_m‘hod
,

2603 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2604 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2605 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2606 
tmp_time
, (è
p_Vid
->
me_time
,

2607 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2608 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,p_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2613 
	`´štf
 ("%05d(%3s)%8d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2614 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
wp_m‘hod
,

2615 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2616 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2617 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2618 
tmp_time
, (è
p_Vid
->
me_time
,

2619 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2620 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,p_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2624 
	`R•ÜtV”bo£NVBSSIM
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, Di¡M‘riø*
mSSIM
,
tmp_time
, 
dœeù_mode
)

2626 #ià(
MVC_EXTENSION_ENABLE
)

2627 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2629 
	`´štf
 ("%05d(%3s) %1d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2630 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2631 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2632 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2633 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2634 
tmp_time
, (è
p_Vid
->
me_time
,

2635 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2636 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2641 
	`´štf
 ("%05d(%3s)%8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2642 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2643 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2644 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2645 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2646 
tmp_time
, (è
p_Vid
->
me_time
,

2647 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2648 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2652 
	`R•ÜtV”bo£FDNSSIM
(
VideoP¬am‘”s
 *
p_Vid
, *
pic_ty³
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
, 
Ïmbda
, 
Di¡M‘ric
 *
mPSNR
, Di¡M‘riø*
mSSIM
,
tmp_time
, 
dœeù_mode
)

2654 #ià(
MVC_EXTENSION_ENABLE
)

2655 iàÐ
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2 )

2657 
	`´štf
 ("%05d(%3s) %1d %8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2658 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
,…_Vid->
v›w_id
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2659 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2660 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2661 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2662 
tmp_time
, (è
p_Vid
->
me_time
,

2663 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2664 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2669 
	`´štf
 ("%05d(%3s)%8d %8d %3d %1d %2d %4d %7.3f %7.3f %7.3f %7.4f %7.4f %7.4f %9d %7d %3s %5d %1d %2d %2d %d %d\n",

2670 
p_Vid
->
äm_no_š_fže
, 
pic_ty³
, 
cur_b™s
, 
fdn_b™s
, 
nvb_b™s
, 
wp_m‘hod
,

2671 
p_Vid
->
Av”ageF¿meQP
, 
Ïmbda
,

2672 
mPSNR
->
v®ue
[0], mPSNR->value[1], mPSNR->value[2],

2673 
mSSIM
->
v®ue
[0], mSSIM->value[1], mSSIM->value[2],

2674 
tmp_time
, (è
p_Vid
->
me_time
,

2675 
p_Vid
->
æd_æag
 ? "FLD" : "FRM",…_Vid->
šŒas
, 
dœeù_mode
,

2676 
p_Vid
->
num_»f_idx_l0_aùive
,…_Vid->
num_»f_idx_l1_aùive
,…_Vid->
rd_·ss
,…_Vid->
Çl_»ã»nû_idc
);

2681 
	`R•ÜtNALNÚVLCB™s
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
)

2683 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2684 
StP¬am‘”s
 *
p_Sts
 = 
p_Vid
->p_Stats;

2687 #ià(
MVC_EXTENSION_ENABLE
)

2688 ià(
p_IÅ
->
num_of_v›ws
 == 2)

2690 ià(
p_IÅ
->
V”bo£
 != 0)

2691 
	`´štf
 ("%05d(NVBè %8d \n", 
p_Vid
->
äame_no
, 
p_Sts
->
b™_ùr_·¿m‘”£ts_n
);

2696 ià(
p_IÅ
->
V”bo£
 != 0)

2697 
	`´štf
 ("%05d(NVB)%8d \n", 
p_Vid
->
äame_no
, 
p_Sts
->
b™_ùr_·¿m‘”£ts_n
);

2701 
	`R•ÜtFœ¡äame
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
)

2703 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2704 
StP¬am‘”s
 *
¡©s
 = 
p_Vid
->
p_Sts
;

2706 
cur_b™s
 = ()(
¡©s
->
b™_ùr
 - sts->
b™_ùr_n
)

2707 + ()(
¡©s
->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
);

2709 ià(
p_IÅ
->
V”bo£
 == 1)

2711 
	`R•ÜtSim¶e
(
p_Vid
, "IDR", 
cur_b™s
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
);

2713 ià(
p_IÅ
->
V”bo£
 == 2)

2715 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2716 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2717 
	`R•ÜtV”bo£SSIM
(
p_Vid
, "IDR", 
cur_b™s
, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2719 
	`R•ÜtV”bo£
(
p_Vid
, "IDR", 
cur_b™s
, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2721 ià(
p_IÅ
->
V”bo£
 == 3)

2723 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2724 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2725 
	`R•ÜtV”bo£NVBSSIM
(
p_Vid
, "IDR", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2727 
	`R•ÜtV”bo£NVB
(
p_Vid
, "IDR", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2729 ià(
p_IÅ
->
V”bo£
 == 4)

2731 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2732 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2733 
	`R•ÜtV”bo£FDNSSIM
(
p_Vid
, "IDR", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2735 
	`R•ÜtV”bo£FDN
(
p_Vid
, "IDR", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2738 
¡©s
->
b™_couÁ”
[
I_SLICE
] = sts->
b™_ùr
;

2739 #ià(
MVC_EXTENSION_ENABLE
)

2740 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

2742 iàÐ!
p_Vid
->
æd_æag
 )

2744 
¡©s
->
b™_couÁ”_v
[
p_Vid
->
v›w_id
][
I_SLICE
] = sts->
b™_ùr
;

2746 
¡©s
->
b™_ùr_v
[0] = 0;

2747 
¡©s
->
b™_ùr_v
[1] = 0;

2750 
¡©s
->
b™_ùr
 = 0;

2753 
	`R•ÜtI
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
)

2755 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2756 
StP¬am‘”s
 *
¡©s
 = 
p_Vid
->
p_Sts
;

2757 
pic_ty³
[4];

2758 
cur_b™s
 = ()(
¡©s
->
b™_ùr
 - sts->
b™_ùr_n
)

2759 + ()(
¡©s
->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
);

2761 ià((
p_IÅ
->
»dundªt_pic_æag
 =ð0è|| !
p_Vid
->
»dundªt_codšg
 )

2763 ià(
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 =ð
TRUE
)

2764 
	`¡rýy
(
pic_ty³
,"IDR");

2765 iàÐ
p_Vid
->
ty³
 =ð
SI_SLICE
 )

2766 
	`¡rýy
(
pic_ty³
,"SI ");

2768 
	`¡rýy
(
pic_ty³
," I ");

2771 
	`¡rýy
(
pic_ty³
,"R");

2773 ià(
p_IÅ
->
V”bo£
 == 1)

2775 
	`R•ÜtSim¶e
(
p_Vid
, 
pic_ty³
, 
cur_b™s
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
);

2777 ià(
p_IÅ
->
V”bo£
 == 2)

2779 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2780 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2782 
	`R•ÜtV”bo£SSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2786 
	`R•ÜtV”bo£
(
p_Vid
, 
pic_ty³
, 
cur_b™s
, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2789 ià(
p_IÅ
->
V”bo£
 == 3)

2791 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2792 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2794 
	`R•ÜtV”bo£NVBSSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2798 
	`R•ÜtV”bo£NVB
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2801 ià(
p_IÅ
->
V”bo£
 == 4)

2803 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
I_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2804 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2806 
	`R•ÜtV”bo£FDNSSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2810 
	`R•ÜtV”bo£FDN
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n, 0, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2815 
	`R•ÜtB
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
)

2817 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2818 
StP¬am‘”s
 *
¡©s
 = 
p_Vid
->
p_Sts
;

2820 
cur_b™s
 = ()(
¡©s
->
b™_ùr
 - sts->
b™_ùr_n
)

2821 + ()(
¡©s
->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
);

2823 ià(
p_IÅ
->
V”bo£
 == 1)

2825 
	`R•ÜtSim¶e
(
p_Vid
, " B ", 
cur_b™s
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
);

2827 ià(
p_IÅ
->
V”bo£
 == 2)

2829 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
B_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2830 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2831 
	`R•ÜtV”bo£SSIM
(
p_Vid
, " B ", 
cur_b™s
,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2833 
	`R•ÜtV”bo£
(
p_Vid
, " B ", 
cur_b™s
,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2835 ià(
p_IÅ
->
V”bo£
 == 3)

2837 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
B_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2838 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2839 
	`R•ÜtV”bo£NVBSSIM
(
p_Vid
, " B ", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2841 
	`R•ÜtV”bo£NVB
(
p_Vid
, " B ", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2843 ià(
p_IÅ
->
V”bo£
 == 4)

2845 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
B_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2846 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2847 
	`R•ÜtV”bo£FDNSSIM
(
p_Vid
, " B ", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2849 
	`R•ÜtV”bo£FDN
(
p_Vid
, " B ", 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_b»d_idc
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
,…_Vid->
dœeù_¥©Ÿl_mv_´ed_æag
);

2853 
	`R•ÜtP
(
VideoP¬am‘”s
 *
p_Vid
, 
št64
 
tmp_time
)

2855 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2856 
StP¬am‘”s
 *
¡©s
 = 
p_Vid
->
p_Sts
;

2858 
pic_ty³
[4];

2859 
cur_b™s
 = ()(
¡©s
->
b™_ùr
 - sts->
b™_ùr_n
)

2860 + ()(
¡©s
->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
);

2862 ià(
p_Vid
->
ty³
 =ð
SP_SLICE
)

2863 
	`¡rýy
(
pic_ty³
,"SP ");

2864 ià((
p_IÅ
->
»dundªt_pic_æag
 =ð0è|| !
p_Vid
->
»dundªt_codšg
 )

2865 
	`¡rýy
(
pic_ty³
," P ");

2867 
	`¡rýy
(
pic_ty³
," R ");

2869 ià(
p_IÅ
->
V”bo£
 == 1)

2871 
	`R•ÜtSim¶e
(
p_Vid
, 
pic_ty³
, 
cur_b™s
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
);

2873 ià(
p_IÅ
->
V”bo£
 == 2)

2875 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
P_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2876 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2877 
	`R•ÜtV”bo£SSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2879 
	`R•ÜtV”bo£
(
p_Vid
, 
pic_ty³
, 
cur_b™s
,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2881 ià(
p_IÅ
->
V”bo£
 == 3)

2883 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
P_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2884 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2885 
	`R•ÜtV”bo£NVBSSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2887 
	`R•ÜtV”bo£NVB
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2889 ià(
p_IÅ
->
V”bo£
 == 4)

2891 
Ïmbda
 = (è
p_Vid
->
Ïmbda_me
[
P_SLICE
][p_Vid->
ma¡”QP
][
F_PEL
];

2892 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

2893 
	`R•ÜtV”bo£FDNSSIM
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], &p_Vid->p_Di¡->m‘ric[
SSIM
], (è
tmp_time
, 0);

2895 
	`R•ÜtV”bo£FDN
(
p_Vid
, 
pic_ty³
, 
cur_b™s
 + 
¡©s
->
b™_ùr_·¿m‘”£ts_n
, ()(¡©s->
b™_ùr_fžËr_d©a
 - sts->
b™_ùr_fžËr_d©a_n
), sts->b™_ùr_·¿m‘”£ts_n,…_Vid->
aùive_µs
->
weigh‹d_´ed_æag
, 
Ïmbda
, &p_Vid->
p_Di¡
->
m‘ric
[
PSNR
], (è
tmp_time
, 0);

2905 
	`put_bufãr_äame
(
VideoP¬am‘”s
 *
p_Vid
)

2907 
p_Vid
->
pCurImg
 =…_Vid->
imgD©a
.
äm_d©a
[0];

2908 
p_Vid
->
pImgOrg
[0] =…_Vid->
imgD©a
.
äm_d©a
[0];

2910 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2912 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
äm_d©a
[1];

2913 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
äm_d©a
[2];

2916 ià(
p_Vid
->
p_IÅ
->
MDReã»nû
[0] ||…_Vid->p_Inp->MDReference[1])

2918 
p_Vid
->
pCurImgRef
 =…_Vid->
imgRefD©a
.
äm_d©a
[0];

2919 
p_Vid
->
pImgOrgRef
[0] =…_Vid->
imgRefD©a
.
äm_d©a
[0];

2921 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2923 
p_Vid
->
pImgOrgRef
[1] =…_Vid->
imgRefD©a
.
äm_d©a
[1];

2924 
p_Vid
->
pImgOrgRef
[2] =…_Vid->
imgRefD©a
.
äm_d©a
[2];

2935 
	`put_bufãr_tÝ
(
VideoP¬am‘”s
 *
p_Vid
)

2937 
p_Vid
->
æd_ty³
 = 0;

2939 
p_Vid
->
pCurImg
 =…_Vid->
imgD©a
.
tÝ_d©a
[0];

2940 
p_Vid
->
pImgOrg
[0] =…_Vid->
imgD©a
.
tÝ_d©a
[0];

2942 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2944 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
tÝ_d©a
[1];

2945 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
tÝ_d©a
[2];

2948 iàÐ
p_Vid
->
p_IÅ
->
MDReã»nû
[0] ||…_Vid->p_Inp->MDReference[1] )

2950 
p_Vid
->
pCurImgRef
 =…_Vid->
imgRefD©a
.
tÝ_d©a
[0];

2951 
p_Vid
->
pImgOrgRef
[0] =…_Vid->
imgRefD©a
.
tÝ_d©a
[0];

2953 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2955 
p_Vid
->
pImgOrgRef
[1] =…_Vid->
imgRefD©a
.
tÝ_d©a
[1];

2956 
p_Vid
->
pImgOrgRef
[2] =…_Vid->
imgRefD©a
.
tÝ_d©a
[2];

2967 
	`put_bufãr_bÙ
(
VideoP¬am‘”s
 *
p_Vid
)

2969 
p_Vid
->
æd_ty³
 = 1;

2971 
p_Vid
->
pCurImg
 =…_Vid->
imgD©a
.
bÙ_d©a
[0];

2972 
p_Vid
->
pImgOrg
[0] =…_Vid->
imgD©a
.
bÙ_d©a
[0];

2974 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2976 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
bÙ_d©a
[1];

2977 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
bÙ_d©a
[2];

2980 iàÐ
p_Vid
->
p_IÅ
->
MDReã»nû
[0] ||…_Vid->p_Inp->MDReference[1] )

2982 
p_Vid
->
pCurImgRef
 =…_Vid->
imgRefD©a
.
bÙ_d©a
[0];

2983 
p_Vid
->
pImgOrgRef
[0] =…_Vid->
imgRefD©a
.
bÙ_d©a
[0];

2985 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2987 
p_Vid
->
pImgOrgRef
[1] =…_Vid->
imgRefD©a
.
bÙ_d©a
[1];

2988 
p_Vid
->
pImgOrgRef
[2] =…_Vid->
imgRefD©a
.
bÙ_d©a
[2];

2999 
	`ouut_SP_cÛffic›Ás
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

3001 
i
,
k
;

3002 
FILE
 *
SP_cÛff_fže
;

3003 
»t
;

3004 if(
p_Vid
->
numb”_¥2_äames
==0)

3006 ià((
SP_cÛff_fže
 = 
	`fÝ’
(
p_IÅ
->
¥_ouut_fž’ame
,"wb")è=ð
NULL
)

3008 
	`´štf
 ("F©®: cªnÙ o³ÀSP ouuˆfž'%s',ƒx™ (-1)\n", 
p_IÅ
->
¥_ouut_fž’ame
);

3009 
	`ex™
 (-1);

3011 
p_Vid
->
numb”_¥2_äames
++;

3015 ià((
SP_cÛff_fže
 = 
	`fÝ’
(
p_IÅ
->
¥_ouut_fž’ame
,"ab")è=ð
NULL
)

3017 
	`´štf
 ("F©®: cªnÙ o³ÀSP ouuˆfž'%s',ƒx™ (-1)\n", 
p_IÅ
->
¥_ouut_fž’ame
);

3018 
	`ex™
 (-1);

3022 
i
=0;i<
p_Vid
->
height
;i++)

3024 
»t
 = (è
	`fwr™e
(
p_Vid
->
Ìec
[
i
], (),…_Vid->
width
, 
SP_cÛff_fže
);

3025 ià(
»t
 !ð
p_Vid
->
width
)

3027 
	`”rÜ
 ("cannot writeo SP output file", -1);

3031 
k
=0;k<2;k++)

3033 
i
=0;i<
p_Vid
->
height_ü
;i++)

3035 
»t
 = (è
	`fwr™e
(
p_Vid
->
Ìec_uv
[
k
][
i
], (),…_Vid->
width_ü
, 
SP_cÛff_fže
);

3036 ià(
»t
 !ð
p_Vid
->
width_ü
)

3038 
	`”rÜ
 ("cannot writeo SP output file", -1);

3042 
	`fþo£
(
SP_cÛff_fže
);

3051 
	`»ad_SP_cÛffic›Ás
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

3053 
i
,
k
;

3054 
FILE
 *
SP_cÛff_fže
;

3056 iàÐ
p_IÅ
->
¥_sw™ch_³riod
 > 0 && ( 
p_Vid
->
numb”_¥2_äames
 % (p_Inp->sp_switch_period << 1) ) >=…_Inp->sp_switch_period )

3058 ià((
SP_cÛff_fže
 = 
	`fÝ’
(
p_IÅ
->
¥2_šput_fž’ame1
,"rb")è=ð
NULL
)

3060 
	`´štf
 ("F©®: cªnÙ o³ÀSP iÅuˆfž'%s',ƒx™ (-1)\n", 
p_IÅ
->
¥2_šput_fž’ame2
);

3061 
	`ex™
 (-1);

3066 ià((
SP_cÛff_fže
 = 
	`fÝ’
(
p_IÅ
->
¥2_šput_fž’ame2
,"rb")è=ð
NULL
)

3068 
	`´štf
 ("F©®: cªnÙ o³ÀSP iÅuˆfž'%s',ƒx™ (-1)\n", 
p_IÅ
->
¥2_šput_fž’ame1
);

3069 
	`ex™
 (-1);

3073 ià(0 !ð
	`f£ek
 (
SP_cÛff_fže
, 
p_Vid
->
size
 * 3/2*p_Vid->
numb”_¥2_äames
*(), 
SEEK_SET
))

3075 
	`´štf
 ("Fatal: cannot seek in SP input file,ƒxit (-1)\n");

3076 
	`ex™
 (-1);

3078 
p_Vid
->
numb”_¥2_äames
++;

3080 
i
=0;i<
p_Vid
->
height
;i++)

3082 if(
p_Vid
->
width
!=()
	`ä—d
Õ_Vid->
Ìec
[
i
],(),p_Vid->width,
SP_cÛff_fže
))

3084 
	`´štf
 ("Fatal: cannot„ead in SP input file,ƒxit (-1)\n");

3085 
	`ex™
 (-1);

3089 
k
=0;k<2;k++)

3091 
i
=0;i<
p_Vid
->
height_ü
;i++)

3093 if(
p_Vid
->
width_ü
!=()
	`ä—d
Õ_Vid->
Ìec_uv
[
k
][
i
],(),p_Vid->width_ü,
SP_cÛff_fže
))

3095 
	`´štf
 ("Fatal: cannot„ead in SP input file,ƒxit (-1)\n");

3096 
	`ex™
 (-1);

3100 
	`fþo£
(
SP_cÛff_fže
);

3110 
	`£Ëù_¶ªe
(
VideoP¬am‘”s
 *
p_Vid
, 
CÞÜPÏÃ
 
cÞÜ_¶ªe
)

3112 
p_Vid
->
pCurImg
 =…_Vid->
pImgOrg
[
cÞÜ_¶ªe
];

3113 
p_Vid
->
’c_piùu»
->
p_cu¼_img
 =…_Vid->’c_piùu»->
p_img
[
cÞÜ_¶ªe
];

3114 
p_Vid
->
’c_piùu»
->
p_cu¼_img_sub
 =…_Vid->’c_piùu»->
p_img_sub
[
cÞÜ_¶ªe
];

3115 
p_Vid
->
max_img³l_v®ue
 = (èp_Vid->
max_³l_v®ue_comp
[
cÞÜ_¶ªe
];

3116 
p_Vid
->
dc_´ed_v®ue
 =…_Vid->
dc_´ed_v®ue_comp
[
cÞÜ_¶ªe
];

3125 
	`is_gÝ_fœ¡_un™
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

3127  ( 
	`g‘_idr_æag
(
p_Vid
è|| (…_Vid->
ty³
 =ð
I_SLICE
 && 
p_IÅ
->
EÇbËO³nGOP
 && 
	`g‘_¿ndom_acûss_æag
(p_Vid) ) );

3136 
	`wr™e_nÚ_vþ_Çlu
Ð
VideoP¬am‘”s
 *
p_Vid
 )

3138 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

3141 ià(
p_IÅ
->
Re£ndSPS
 =ð3 && 
	`is_gÝ_fœ¡_un™
(
p_Vid
,…_IÅè&&…_Vid->
numb”
)

3143 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3145 ià(
p_IÅ
->
Re£ndSPS
 =ð2 && 
	`g‘_idr_æag
(
p_Vid
è&&…_Vid->
numb”
)

3147 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3149 ià(
p_IÅ
->
Re£ndSPS
 =ð1 && 
p_Vid
->
ty³
 =ð
I_SLICE
 &&…_Vid->
cu¼_äm_idx
 != 0)

3151 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3154 iàÐ
p_IÅ
->
Re£ndPPS
 && 
p_Vid
->
cu¼_äm_idx
 != 0 )

3156 
i
, 
tÙ®_µs
 = 
p_IÅ
->
G’”©eMuÉËPPS
 ? 3 : 1;

3158 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 0;

3160 iàÐ
p_IÅ
->
S’dAUD
 )

3162 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 
	`Wr™e_AUD_NALU
(p_Vid);

3164  
i
 = 0; i < 
tÙ®_µs
; i++ )

3166 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`wr™e_PPS
Õ_Vid, 0, 
i
);

3170 iàÐ
p_IÅ
->
S’dAUD
 && 
p_Vid
->
cu¼_äm_idx
 != 0 )

3172 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`Wr™e_AUD_NALU
(p_Vid);

3175 
	`Upd©eSub£qInfo
 (
p_Vid
, 
p_IÅ
,…_Vid->
Ïy”
);

3176 
	`Upd©eSûÃInfÜm©iÚ
 (
p_Vid
->
p_SEI
, 
FALSE
, 0, 0, -1);

3177 
	`Upd©eF¿mePackšgA¼ªgem’t
 (
p_Vid
, 
p_IÅ
);

3183 ià(
p_IÅ
->
TÚeM­pšgSEIP»£ÁFÏg
)

3185 
	`Upd©eTÚeM­pšg
(
p_Vid
->
p_SEI
);

3189 
	`CË¬PicTimšg
(
p_Vid
->
p_SEI
);

3190 iàÐ
p_IÅ
->
SEIVUI32PuÎdown
 )

3192 
	`Upd©ePicTimšg
(
p_Vid
, 
p_IÅ
);

3193 
	`P»·»Agg»g©iÚSEIMes§ge
(
p_Vid
);

3194 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`Wr™e_SEI_NALU
(p_Vid, 0);

3195 
	`CË¬PicTimšg
(
p_Vid
->
p_SEI
);

3197 
	`þ—r_£i_mes§ge
(
p_Vid
->
p_SEI
, 
AGGREGATION_SEI
);

3201 
	`P»·»Agg»g©iÚSEIMes§ge
(
p_Vid
);

3204 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`Wr™e_SEI_NALU
(p_Vid, 0);

3207 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts
 +ðp_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n
;

3216 
	`wr™e_nÚ_vþ_Çlu_bÙ_æd
Ð
VideoP¬am‘”s
 *
p_Vid
 )

3218 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

3219 
š™_·¿m_£t_b™s
 = 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
;

3222 ià(
p_IÅ
->
Re£ndSPS
 =ð1 && 
p_Vid
->
ty³
 =ð
I_SLICE
)

3224 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3227 iàÐ
p_IÅ
->
Re£ndPPS
 )

3229 
i
, 
tÙ®_µs
 = 
p_IÅ
->
G’”©eMuÉËPPS
 ? 3 : 1;

3231 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 0;

3233 iàÐ
p_IÅ
->
S’dAUD
 )

3235 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 
	`Wr™e_AUD_NALU
(p_Vid);

3237  
i
 = 0; i < 
tÙ®_µs
; i++ )

3239 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`wr™e_PPS
Õ_Vid, 0, 
i
);

3243 iàÐ
p_IÅ
->
S’dAUD
 )

3245 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`Wr™e_AUD_NALU
(p_Vid);

3248 
	`Upd©eSub£qInfo
 (
p_Vid
, 
p_IÅ
,…_Vid->
Ïy”
);

3249 
	`Upd©eSûÃInfÜm©iÚ
 (
p_Vid
->
p_SEI
, 
FALSE
, 0, 0, -1);

3250 
	`Upd©eF¿mePackšgA¼ªgem’t
 (
p_Vid
, 
p_IÅ
);

3256 ià(
p_IÅ
->
TÚeM­pšgSEIP»£ÁFÏg
)

3258 
	`Upd©eTÚeM­pšg
(
p_Vid
->
p_SEI
);

3261 
	`P»·»Agg»g©iÚSEIMes§ge
(
p_Vid
);

3263 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
	`Wr™e_SEI_NALU
(p_Vid, 0);

3266 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts
 +ðÕ_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n
 - 
š™_·¿m_£t_b™s
);

3269 
	`OtfCom·tibž™y_cÝyW™hPaddšg
 ( 
img³l
 **
d¡Img
, img³È**
¤cImg
, 
size_x
, 
size_y
, 
·ddšg_x
, 
·ddšg_y
 )

3271 
i
, 
j
;

3272 
size_x_mšus1
 = 
size_x
 - 1;

3274 
img³l
 *
wBufSrc
, *
wBufD¡
;

3277 
wBufD¡
 = &Ð
d¡Img
[-
·ddšg_y
][-
·ddšg_x
] );

3278 
wBufSrc
 = 
¤cImg
[0];

3280 
i
 = 0; i < 
·ddšg_x
; ++i)

3281 *(
wBufD¡
++èð
wBufSrc
[0];

3283 
	`memýy
(
wBufD¡
, 
wBufSrc
, 
size_x
 * (
img³l
));

3284 
wBufD¡
 +ð
size_x
;

3286 
i
 = 0; i < 
·ddšg_x
; ++i)

3287 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

3290 
j
 = -
·ddšg_y
+1; j < 0; ++j)

3292 
	`memýy
(
d¡Img
[
j
]-
·ddšg_x
, d¡Img[j - 1]-·ddšg_x, (
size_x
+2*·ddšg_xè* (
img³l
));

3295 
j
 = 0; j < 
size_y
; ++j)

3297 
wBufD¡
 = &Ð
d¡Img
[
j
][-
·ddšg_x
] );

3298 
wBufSrc
 = 
¤cImg
[
j
];

3300 
i
 = 0; i < 
·ddšg_x
; ++i)

3301 *(
wBufD¡
++èð
wBufSrc
[0];

3304 
wBufD¡
 +ð
size_x
;

3306 
i
 = 0; i < 
·ddšg_x
; ++i)

3307 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

3311 
j
 = 
size_y
; j < size_y+
·ddšg_y
; ++j)

3313 
	`memýy
(
d¡Img
[
j
]-
·ddšg_x
, d¡Img[j - 1]-·ddšg_x, (
size_x
+2*·ddšg_xè* (
img³l
));

3318 #ià(
MVC_EXTENSION_ENABLE
)

3325 
	`wr™e_nÚ_vþ_Çlu_mvc
Ð
VideoP¬am‘”s
 *
p_Vid
 )

3327 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

3328 
b™s
;

3330 iàÐ
p_Vid
->
v›w_id
 )

3332 iàÐ
p_IÅ
->
S’dAUD
 == 2 )

3334 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
b™s
 = 
	`Wr™e_AUD_NALU
(p_Vid);

3335 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3341 ià(
p_IÅ
->
Re£ndSPS
 =ð3 && 
	`is_gÝ_fœ¡_un™
(
p_Vid
,…_IÅè&&…_Vid->
numb”
 &&…_Vid->
¡ruùu»
 !ð
BOTTOM_FIELD
)

3343 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3345 ià(
p_IÅ
->
Re£ndSPS
 =ð2 && 
	`g‘_idr_æag
(
p_Vid
è&&…_Vid->
numb”
 &&…_Vid->
¡ruùu»
 !ð
BOTTOM_FIELD
)

3347 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3349 ià(
p_IÅ
->
Re£ndSPS
 =ð1 && 
p_Vid
->
ty³
 =ð
I_SLICE
 &&…_Vid->
cu¼_äm_idx
 !ð0 &&…_Vid->
¡ruùu»
 !ð
BOTTOM_FIELD
)

3351 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`»wr™e_·¿m£ts
(p_Vid);

3354 iàÐ
p_IÅ
->
Re£ndPPS
 && 
p_Vid
->
cu¼_äm_idx
 != 0 )

3356 
i
, 
tÙ®_µs
 = 
p_IÅ
->
G’”©eMuÉËPPS
 ? 3 : 1;

3358 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 0;

3360 iàÐ
p_IÅ
->
S’dAUD
 )

3362 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 = 
b™s
 = 
	`Wr™e_AUD_NALU
(p_Vid);

3363 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3364  
i
 = 0; i < 
tÙ®_µs
; i++ )

3366 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
b™s
 = 
	`wr™e_PPS
Õ_Vid, 0, 
i
);

3367 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3372  
i
 = 0; i < 
tÙ®_µs
; i++ )

3374 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
b™s
 = 
	`wr™e_PPS
Õ_Vid, 0, 
i
);

3375 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3380 iàÐ
p_IÅ
->
S’dAUD
 && (
p_Vid
->
cu¼_äm_idx
 !ð0 ||…_Vid->
¡ruùu»
 =ð
BOTTOM_FIELD
) )

3382 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
b™s
 = 
	`Wr™e_AUD_NALU
(p_Vid);

3383 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3387 
	`Upd©eSub£qInfo
 (
p_Vid
, 
p_IÅ
,…_Vid->
Ïy”
);

3388 
	`Upd©eSûÃInfÜm©iÚ
 (
p_Vid
->
p_SEI
, 
FALSE
, 0, 0, -1);

3394 ià(
p_IÅ
->
TÚeM­pšgSEIP»£ÁFÏg
)

3396 
	`Upd©eTÚeM­pšg
(
p_Vid
->
p_SEI
);

3399 
	`P»·»Agg»g©iÚSEIMes§ge
(
p_Vid
);

3401 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n
 +ð
b™s
 = 
	`Wr™e_SEI_NALU
(p_Vid, 0);

3402 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_n_v
[p_Vid->
v›w_id
] +ð
b™s
;

3405 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts
 +ðp_Vid->p_Sts->
b™_ùr_·¿m‘”£ts_n
;

	@lencod/src/image_mp.c

14 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"rc_quad¿tic.h
"

19 
	~"wp.h
"

20 
	~"´ed_¡ruù.h
"

21 
	~"¦iû.h
"

23 
	#DBG_IMAGE_MP
 0

	)

27 
	mREGULAR
 = 0,

28 
	mEXP_WP
 = 1,

29 
	mIMP_WP
 = 2,

30 
	mFRAME_TYPE
 = 2,

31 
	mFRAME_QP
 = 3,

32 
	mALT_DIRECT
 = 4,

33 
	mALT_ENTROPY
 = 5,

34 
	mDB_OFF
 = 6,

35 } 
	tF¿meCodšgM‘hod
;

37 
äame_piùu»_mp_i_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

38 
äame_piùu»_mp_p_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

39 
äame_piùu»_mp_b_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

41 
	$¡Üe_codšg_šfo
(
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
)

43 
codšg_šfo
->
ty³
 = 
p_Vid
->type;

44 
codšg_šfo
->
šŒas
 = 
p_Vid
->intras;

45 
codšg_šfo
->
sumF¿meQP
 = 
p_Vid
->
SumF¿meQP
;

46 
codšg_šfo
->
num_»f_idx_l0
 = 
p_Vid
->
num_»f_idx_l0_aùive
;

47 
codšg_šfo
->
num_»f_idx_l1
 = 
p_Vid
->
num_»f_idx_l1_aùive
;

48 
codšg_šfo
->
aùive_µs
 = 
p_Vid
->active_pps;

49 
	}
}

51 
	$¡Üe_codšg_ªd_rc_šfo
(
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
)

53 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

55 
	`¡Üe_codšg_šfo
Ð
p_Vid
, 
codšg_šfo
 );

57 iàÐ
p_IÅ
->
RCEÇbË
 )

59 
	`rc_§ve_¡©e
Ð
p_Vid
, 
p_IÅ
 );

61 
	}
}

63 
	$»¡Üe_codšg_šfo
(
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
)

65 
p_Vid
->
ty³
 = 
codšg_šfo
->type;

66 
p_Vid
->
šŒas
 = 
codšg_šfo
->intras;

67 
p_Vid
->
SumF¿meQP
 = 
codšg_šfo
->
sumF¿meQP
;

68 
p_Vid
->
num_»f_idx_l0_aùive
 = 
codšg_šfo
->
num_»f_idx_l0
;

69 
p_Vid
->
num_»f_idx_l1_aùive
 = 
codšg_šfo
->
num_»f_idx_l1
;

70 
p_Vid
->
aùive_µs
 = 
codšg_šfo
->active_pps;

71 
	}
}

73 
	$sw­_äame_bufãr
(
VideoP¬am‘”s
 *
p_Vid
, 
a
, 
b
)

75 
StÜabËPiùu»
 *
s
;

76 
Piùu»
 *
p
;

78 
p
 = 
p_Vid
->
äame_pic
[
a
];

79 
p_Vid
->
äame_pic
[
a
] =…_Vid->äame_pic[
b
];

80 
p_Vid
->
äame_pic
[
b
] = 
p
;

82 
s
 = 
p_Vid
->
’c_äame_piùu»
[
a
];

83 
p_Vid
->
’c_äame_piùu»
[
a
] =…_Vid->’c_äame_piùu»[
b
];

84 
p_Vid
->
’c_äame_piùu»
[
b
] = 
s
;

85 
	}
}

88 
	$äame_piùu»_mp_ex™
(
VideoP¬am‘”s
 *
p_Vid
, 
CodšgInfo
 *
codšg_šfo
)

90 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

92 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

93 
p_Vid
->
’c_piùu»
õ_Vid->
’c_äame_piùu»
[0];

94 
p_Vid
->
p_äame_pic
 =…_Vid->
äame_pic
[0];

95 
	`»¡Üe_codšg_šfo
(
p_Vid
, 
codšg_šfo
);

97 iàÐ
p_IÅ
->
RCEÇbË
 )

99 
	`rc_»¡Üe_¡©e
(
p_Vid
, 
p_IÅ
);

101 
	}
}

104 
	$äame_piùu»_mp_p_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

106 
rd_·ss
 = 0;

107 
rd_qp
 = 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
;

108 
¿‹R©io
 = 1.0F;

109 
wp_·ss
=0;

110 
äame_ty³_·ss
 = 0;

111 
CodšgInfo
 
codšg_šfo
;

112 
F¿meCodšgM‘hod
 
be¡_m‘hod
 = 
REGULAR
;

113 
äame_ty³
 = 
P_SLICE
;

114 
­¶y_wp
 = 0;

115 
£ËùiÚ
;

117 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

118 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

120 if(
p_IÅ
->
WPI‹rMC
)

121 
p_Vid
->
äameOff£tAvaž
 = 1;

123 #ià(
DBG_IMAGE_MP
)

124 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

125 
p_Vid
->
äame_pic
[0]->
b™s_³r_piùu»
,

126 
p_Vid
->
äame_pic
[0]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[0]->distortion.value[1],…_Vid->frame_pic[0]->distortion.value[2]);

129 
rd_·ss
++;

130 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassPSliû
)

132 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

137 
wp_·ss
 = 0;

138 ià(
p_IÅ
->
G’”©eMuÉËPPS
)

140 
Sliû
 *
dummy_¦iû
 = 
NULL
;

142 
	`In™WP
(
p_Vid
, 
p_IÅ
, 0);

143 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

144 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
 =…_Vid->pWPX->
wp_rd_·s£s
 + 1;

145 
	`š™_¦iû_l™e
(
p_Vid
, &
dummy_¦iû
, 0);

147 ià(
p_Vid
->
	`Te¡WPPSliû
(
dummy_¦iû
, 0) == 1)

150 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

151 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

152 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 = 
WP_REGULAR
;

153 
wp_·ss
 = 1;

155 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

158 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

159 
wp_·ss
 = 1;

164 if(
wp_·ss
)

166 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

167 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

168 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

169 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

170 #ià(
DBG_IMAGE_MP
)

171 
	`´štf
("rd_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

173 #ià(
DBG_IMAGE_MP
)

174 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

175 
p_Vid
->
äame_pic
[
rd_·ss
]->
b™s_³r_piùu»
,

176 
p_Vid
->
äame_pic
[
rd_·ss
]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[rd_pass]->distortion.value[1],…_Vid->frame_pic[rd_pass]->distortion.value[2]);

179 ià(
£ËùiÚ
)

181 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

182 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

183 
be¡_m‘hod
 = 
EXP_WP
;

184 
­¶y_wp
 = 1;

187 if(
p_IÅ
->
WPM‘hod
 =ð0 ||…_IÅ->
WPMCP»cisiÚ
)

189 
wp_·ss
 = 0;

190 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

191 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
 =…_Vid->pWPX->
wp_rd_·s£s
 + 2;

192 ià(
p_IÅ
->
WPM‘hod
 =ð0 && 
p_Vid
->
	`Te¡WPPSliû
(
dummy_¦iû
, 1) == 1)

195 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

196 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

197 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 = 
WP_REGULAR
;

198 
wp_·ss
 = 1;

200 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

203 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

204 
wp_·ss
 = 1;

207 if(
wp_·ss
)

209 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

210 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

211 
	`ä“_¦iû_li¡
(
p_Vid
->
äame_pic
[
rd_·ss
]);

212 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»
[
rd_·ss
]);

213 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

214 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

215 #ià(
DBG_IMAGE_MP
)

216 
	`´štf
("rd_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

218 #ià(
DBG_IMAGE_MP
)

219 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

220 
p_Vid
->
äame_pic
[
rd_·ss
]->
b™s_³r_piùu»
,

221 
p_Vid
->
äame_pic
[
rd_·ss
]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[rd_pass]->distortion.value[1],…_Vid->frame_pic[rd_pass]->distortion.value[2]);

224 ià(
£ËùiÚ
)

226 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

227 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

228 
be¡_m‘hod
 = 
EXP_WP
;

229 
­¶y_wp
 = 1;

234 
rd_·ss
++;

237 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassPSliû
)

239 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

240 
	`ä“_¦iû
(
dummy_¦iû
);

244 
	`ä“_¦iû
(
dummy_¦iû
);

249 
äame_ty³_·ss
 = 0;

250 if(
p_IÅ
->
RDPSliûITe¡
 && (
codšg_šfo
.
šŒas
 * 100/
p_Vid
->
F¿meSizeInMbs
) >= 75)

252 
äame_ty³
 = 
I_SLICE
;

253 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
, 
I_SLICE
);

254 
	`pÝuÏ‹_äame_¦iû_ty³
Ð
p_IÅ
, 
p_Vid
->
p_cu¼_äm_¡ruù
, 
I_SLICE
,…_Vid->
p_´ed
->
max_num_¦iûs
 );

255 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[0];

256 
äame_ty³_·ss
 = 1;

258 ià(
p_IÅ
->
RDPSliûBTe¡
 && 
p_Vid
->
aùive_¥s
->
´ofže_idc
 !ð
BASELINE
)

261 
äame_ty³
 = 
B_SLICE
;

262 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
, 
B_SLICE
 );

263 
	`pÝuÏ‹_äame_¦iû_ty³
Ð
p_IÅ
, 
p_Vid
->
p_cu¼_äm_¡ruù
, 
B_SLICE
,…_Vid->
p_´ed
->
max_num_¦iûs
 );

264 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[0];

265 
äame_ty³_·ss
 = 1;

268 if(
äame_ty³_·ss
)

270 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

271 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

272 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

273 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

274 #ià(
DBG_IMAGE_MP
)

275 
	`´štf
("rd_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

278 ià(
£ËùiÚ
)

280 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

281 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

282 
be¡_m‘hod
 = 
FRAME_TYPE
;

286 
äame_ty³
 = 
P_SLICE
;

288 
rd_·ss
++;

289 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassPSliû
)

291 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

296 if(
p_Vid
->
Ev®u©eDBOff
)

299 
p_Vid
->
aùive_µs
 = (
be¡_m‘hod
 =ð
EXP_WP
?p_Vid->
PicP¬S‘
[1]:p_Vid->PicParSet[0]);

300 if(
äame_ty³
 !ð
P_SLICE
)

302 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
, 
äame_ty³
);

303 
	`pÝuÏ‹_äame_¦iû_ty³
Ð
p_IÅ
, 
p_Vid
->
p_cu¼_äm_¡ruù
, 
äame_ty³
,…_Vid->
p_´ed
->
max_num_¦iûs
 );

305 
p_Vid
->
TuºDBOff
 = 1;

306 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

307 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

308 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

309 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

310 #ià(
DBG_IMAGE_MP
)

311 
	`´štf
("DB OFF,„d_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

314 ià(
£ËùiÚ
)

316 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

317 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

318 
be¡_m‘hod
 = 
DB_OFF
;

321 
rd_·ss
++;

322 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassPSliû
)

324 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

329 if(
p_IÅ
->
RDPiùu»F¿meQPPSliû
)

332 
p_Vid
->
aùive_µs
 = (
­¶y_wp
?p_Vid->
PicP¬S‘
[1]:p_Vid->PicParSet[0]);

333 if(
äame_ty³
 !ð
P_SLICE
)

335 
	`£t_¦iû_ty³
(
p_Vid
, 
p_IÅ
, 
äame_ty³
);

336 
	`pÝuÏ‹_äame_¦iû_ty³
Ð
p_IÅ
, 
p_Vid
->
p_cu¼_äm_¡ruù
, 
I_SLICE
,…_Vid->
p_´ed
->
max_num_¦iûs
 );

338 
p_Vid
->
qp
 = (p_Vid->
Çl_»ã»nû_idc
==0 ? 
rd_qp
+1:rd_qp-1);

339 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

340 iàÐ
p_IÅ
->
RCEÇbË
 )

342 
¿‹R©io
 = 
p_Vid
->
Çl_»ã»nû_idc
 ? 1.15F : 0.85F;

343 
	`rc_š™_äame_rdpic
Ð
p_Vid
, 
p_IÅ
, 
¿‹R©io
 );

345 
p_Vid
->
TuºDBOff
 = 0;

346 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

347 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

348 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

349 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

350 #ià(
DBG_IMAGE_MP
)

351 
	`´štf
("rd_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

354 ià(
£ËùiÚ
)

356 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

357 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

358 
be¡_m‘hod
 = 
FRAME_QP
;

361 
rd_·ss
++;

362 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassPSliû
)

364 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

369 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

370 
	}
}

372 
	$äame_piùu»_mp_i_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

374 
rd_·ss
 = 0;

375 
qp
 = 
p_Vid
->qp;

376 
¿‹R©io
 = 1.0F;

377 
CodšgInfo
 
codšg_šfo
;

378 
£ËùiÚ
;

381 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

382 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

384 
rd_·ss
++;

385 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassISliû
)

387 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

393 
qp
 = 
p_Vid
->qp;

394 
p_Vid
->
qp
 = qp - 1;

395 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

396 iàÐ
p_IÅ
->
RCEÇbË
 )

398 
¿‹R©io
 = 1.15F;

399 
	`rc_š™_äame_rdpic
Ð
p_Vid
, 
p_IÅ
, 
¿‹R©io
 );

402 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

403 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

404 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

405 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
qp
);

407 ià(
£ËùiÚ
)

409 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

410 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

413 
rd_·ss
++;

414 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassISliû
)

416 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

421 
p_Vid
->
qp
 = (qp + 1);

422 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

423 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

425 iàÐ
p_IÅ
->
RCEÇbË
 )

427 
¿‹R©io
 = 1.0F;

428 
	`rc_š™_äame_rdpic
Ð
p_Vid
, 
p_IÅ
, 
¿‹R©io
 );

431 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

432 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

433 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

434 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
qp
);

436 iàÐ
£ËùiÚ
 )

438 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

439 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

442 
rd_·ss
++;

443 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassISliû
)

445 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

450 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

451 
	}
}

453 
	$äame_piùu»_mp_b_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

455 
rd_·ss
 = 0;

456 
rd_qp
 = 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
;

457 
¿‹R©io
 = 1.0F;

458 
wp_·ss
 = 0;

459 
CodšgInfo
 
codšg_šfo
;

460 
F¿meCodšgM‘hod
 
be¡_m‘hod
 = 
REGULAR
;

461 
­¶y_wp
 = 0;

462 
£ËùiÚ
;

463 
Sliû
 *
dummy_¦iû
 = 
NULL
;

465 #ià(
DBG_IMAGE_MP
)

466 
	`´štf
("·ss0_w°ð%d\n", 
p_Vid
->
·ss0_wp
);

469 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

470 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

472 if(
p_IÅ
->
WPI‹rMC
)

473 
p_Vid
->
äameOff£tAvaž
 = 1;

475 
rd_·ss
++;

476 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassBSliû
)

478 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

482 
	`š™_¦iû_l™e
(
p_Vid
, &
dummy_¦iû
, 0);

484 #ià(
DBG_IMAGE_MP
)

485 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

486 
p_Vid
->
äame_pic
[0]->
b™s_³r_piùu»
,

487 
p_Vid
->
äame_pic
[0]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[0]->distortion.value[1],…_Vid->frame_pic[0]->distortion.value[2]);

491 
wp_·ss
 = 0;

493 ià(
p_IÅ
->
G’”©eMuÉËPPS
)

495 
	`In™WP
(
p_Vid
, 
p_IÅ
, 0);

496 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

497 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
 =…_Vid->pWPX->
wp_rd_·s£s
 + 1;

499 ià(
p_Vid
->
	`Te¡WPBSliû
(
dummy_¦iû
, 1) == 1)

502 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[2];

503 if(
p_IÅ
->
WPMCP»cisiÚ
)

504 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 = 
WP_REGULAR
;

505 
wp_·ss
 = 1;

509 if(
wp_·ss
)

511 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

512 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

513 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

514 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

515 #ià(
DBG_IMAGE_MP
)

516 
	`´štf
("IMP WP,„d_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

517 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

518 
p_Vid
->
äame_pic
[
rd_·ss
]->
b™s_³r_piùu»
,

519 
p_Vid
->
äame_pic
[
rd_·ss
]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[rd_pass]->distortion.value[1],…_Vid->frame_pic[rd_pass]->distortion.value[2]);

522 ià(
£ËùiÚ
)

524 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

525 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

526 
be¡_m‘hod
 = 
IMP_WP
;

527 
­¶y_wp
 = 
IMP_WP
;

530 
rd_·ss
++;

531 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassBSliû
)

533 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

534 
	`ä“_¦iû
(
dummy_¦iû
);

540 
wp_·ss
 = 0;

541 ià(
p_IÅ
->
G’”©eMuÉËPPS
)

543 
	`In™WP
(
p_Vid
, 
p_IÅ
, 0);

544 ifÐ
p_IÅ
->
WPMCP»cisiÚ
 )

545 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
 =…_Vid->pWPX->
wp_rd_·s£s
 + 1;

547 ià(
p_Vid
->
	`Te¡WPBSliû
(
dummy_¦iû
, 0) == 1)

550 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

551 ifÐ
p_IÅ
->
WPMCP»cisiÚ
 )

552 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 = 
WP_REGULAR
;

553 
wp_·ss
 = 1;

555 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 =ð2 && (p_IÅ->
WPMCP»cBSliû
 =ð2 || (p_IÅ->WPMCP»cBSliû =ð1 && 
p_Vid
->
Çl_»ã»nû_idc
) ) )

557 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[1];

558 
wp_·ss
 = 1;

562 if(
wp_·ss
)

564 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

565 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

566 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

567 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

568 #ià(
DBG_IMAGE_MP
)

569 
	`´štf
("EXP WP,„d_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

570 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

571 
p_Vid
->
äame_pic
[
rd_·ss
]->
b™s_³r_piùu»
,

572 
p_Vid
->
äame_pic
[
rd_·ss
]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[rd_pass]->distortion.value[1],…_Vid->frame_pic[rd_pass]->distortion.value[2]);

575 ià(
£ËùiÚ
)

577 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

578 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

579 
be¡_m‘hod
 = 
EXP_WP
;

580 
­¶y_wp
 = 
EXP_WP
;

583 
rd_·ss
++;

584 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassBSliû
)

586 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

587 
	`ä“_¦iû
(
dummy_¦iû
);

593 if(
p_IÅ
->
RDPiùu»F¿meQPBSliû
)

596 
p_Vid
->
aùive_µs
 = 
be¡_m‘hod
 =ð
EXP_WP
 ?…_Vid->
PicP¬S‘
[1]:be¡_m‘hod==
IMP_WP
?p_Vid->PicParSet[2]:p_Vid->PicParSet[0];

598 
p_Vid
->
qp
 = (p_Vid->
Çl_»ã»nû_idc
==0 ? 
rd_qp
 + 1 :„d_qp );

599 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

600 iàÐ
p_IÅ
->
RCEÇbË
 )

602 
¿‹R©io
 = 
p_Vid
->
Çl_»ã»nû_idc
 ? 1.15F : 0.85F;

603 
	`rc_š™_äame_rdpic
Ð
p_Vid
, 
p_IÅ
, 
¿‹R©io
 );

606 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

607 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

608 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

609 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

610 #ià(
DBG_IMAGE_MP
)

611 
	`´štf
("äamQP,„d_·s ð%d, s–eùiÚ = %d \n", 
rd_·ss
, 
£ËùiÚ
);

612 
	`´štf
("rd_·s ð%d: %d (%.0f, %.0f, %.0f)\n", 
rd_·ss
,

613 
p_Vid
->
äame_pic
[
rd_·ss
]->
b™s_³r_piùu»
,

614 
p_Vid
->
äame_pic
[
rd_·ss
]->
di¡ÜtiÚ
.
v®ue
[0],…_Vid->frame_pic[rd_pass]->distortion.value[1],…_Vid->frame_pic[rd_pass]->distortion.value[2]);

617 ià(
£ËùiÚ
)

619 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

620 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

621 
be¡_m‘hod
 = 
FRAME_QP
;

624 
rd_·ss
++;

625 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassBSliû
)

627 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

628 
	`ä“_¦iû
(
dummy_¦iû
);

634 if(
p_IÅ
->
RDPiùu»DœeùMode
)

637 
p_Vid
->
aùive_µs
 = 
­¶y_wp
 =ð
IMP_WP
 ?…_Vid->
PicP¬S‘
[1]:­¶y_wp==
EXP_WP
?p_Vid->PicParSet[2]:p_Vid->PicParSet[0];

638 if(
be¡_m‘hod
 =ð
FRAME_QP
)

639 
p_Vid
->
qp
 = (p_Vid->
Çl_»ã»nû_idc
==0 ? 
rd_qp
+1:rd_qp-1);

641 
p_Vid
->
qp
 = 
rd_qp
;

642 
p_Vid
->
qp
 = 
	`iCl3
Ðp_Vid->
RCMšQP
,…_Vid->
RCMaxQP
,…_Vid->qp );

644 
p_Vid
->
dœeù_¥©Ÿl_mv_´ed_æag
 = 1-p_Vid->direct_spatial_mv_pred_flag;

645 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

646 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->qp;

647 
	`äame_piùu»
 (
p_Vid
,…_Vid->
äame_pic
[
rd_·ss
], &p_Vid->
imgD©a
,„d_pass);

648 
£ËùiÚ
 = 
	`piùu»_codšg_decisiÚ
(
p_Vid
,…_Vid->
äame_pic
[0],…_Vid->äame_pic[
rd_·ss
], 
rd_qp
);

649 #ià(
DBG_IMAGE_MP
)

650 
	`´štf
("®‹º©dœeù mode,„d_·s ð%d, s–eùiÚ = %d\n", 
rd_·ss
, 
£ËùiÚ
);

653 ià(
£ËùiÚ
)

655 
	`sw­_äame_bufãr
(
p_Vid
, 0, 
rd_·ss
);

656 
	`¡Üe_codšg_ªd_rc_šfo
(
p_Vid
, &
codšg_šfo
);

657 
be¡_m‘hod
 = 
ALT_DIRECT
;

660 
rd_·ss
++;

661 if(
rd_·ss
 >ð
p_IÅ
->
RDPiùu»MaxPassBSliû
)

663 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

664 
	`ä“_¦iû
(
dummy_¦iû
);

668 
	`äame_piùu»_mp_ex™
(
p_Vid
, &
codšg_šfo
);

669 
	`ä“_¦iû
(
dummy_¦iû
);

671 
	}
}

673 
	$äame_piùu»_mp
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

675 
p_Vid
->
Ev®u©eDBOff
 = 0;

676 
p_Vid
->
TuºDBOff
 = 0;

677 if(
p_Vid
->
ty³
 =ð
I_SLICE
)

679 
	`äame_piùu»_mp_i_¦iû
(
p_Vid
, 
p_IÅ
);

681 if(
p_Vid
->
ty³
 =ð
P_SLICE
)

683 
	`äame_piùu»_mp_p_¦iû
(
p_Vid
, 
p_IÅ
);

685 if(
p_Vid
->
ty³
 =ð
B_SLICE
)

687 
	`äame_piùu»_mp_b_¦iû
(
p_Vid
, 
p_IÅ
);

689 
p_Vid
->
rd_·ss
 = 0;

690 
	}
}

	@lencod/src/img_chroma.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"img_chroma.h
"

26 
	$g’”©eChroma00
Ð
VideoP¬am‘”s
 *
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
img³l
 **
wImgD¡
, img³È**
imgUV
)

28 
i
;

29 
j·d
 = -
p_Vid
->
·d_size_uv_y
;

30 
img³l
 *
wBufD¡
;

31 
img³l
 *
wBufSrc0
;

33 
wBufD¡
 = 
wImgD¡
[
j·d
++]-
p_Vid
->
·d_size_uv_x
;

34 
wBufSrc0
 = 
imgUV
[0];

36 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

38 *
wBufD¡
++ = *
wBufSrc0
;

41 
	`memýy
(
wBufD¡
, 
wBufSrc0
, 
size_x_mšus1
 * (
img³l
));

42 
wBufD¡
 +ð
size_x_mšus1
;

43 
wBufSrc0
 +ð
size_x_mšus1
;

45 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

47 *
wBufD¡
++ = *
wBufSrc0
;

50 ; 
j·d
 < 0; jpad++)

52 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

55 
j·d
 = 0; j·d < 
size_y_mšus1
+1; jpad++)

57 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

58 
wBufSrc0
 = 
imgUV
[
j·d
];

60 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

62 *
wBufD¡
++ = *
wBufSrc0
;

66 
wBufD¡
 +ð
size_x_mšus1
+1;

67 
wBufSrc0
 +ð
size_x_mšus1
;

69 
i
 = 0; i < 
p_Vid
->
·d_size_uv_x
; i++)

71 *
wBufD¡
++ = *
wBufSrc0
;

75 
j·d
 = 
size_y_mšus1
+1; j·d < size_y_mšus1+1+
p_Vid
->
·d_size_uv_y
; jpad++)

77 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

79 
	}
}

87 
	$g’”©eChroma01
Ð
VideoP¬am‘”s
 *
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight01
, 
img³l
 **
wImgD¡
, img³È**
imgUV
)

89 
i
;

90 
j·d
 = -
p_Vid
->
·d_size_uv_y
;

91 
cur_v®ue
;

92 
img³l
 *
wBufD¡
;

93 
img³l
 *
wBufSrc0
;

95 
wBufD¡
 = 
wImgD¡
[
j·d
++]-
p_Vid
->
·d_size_uv_x
;

96 
wBufSrc0
 = 
imgUV
[0];

98 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

100 *(
wBufD¡
++èð*
wBufSrc0
;

103 
i
 = 0; i < 
size_x_mšus1
; i++)

105 
cur_v®ue
 = 
weight00
 * (*
wBufSrc0
++);

106 
cur_v®ue
 +ð
weight01
 * (*
wBufSrc0
 );

107 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

110 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

112 *(
wBufD¡
++èð*
wBufSrc0
;

115 ; 
j·d
 < 1; jpad++)

117 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

120 
j·d
 = 1; j·d < 
size_y_mšus1
+1; jpad++)

122 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

123 
wBufSrc0
 = 
imgUV
[
j·d
];

125 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

127 *(
wBufD¡
++èð*
wBufSrc0
;

130 
i
 = 0; i < 
size_x_mšus1
; i++)

132 
cur_v®ue
 = 
weight00
 * (*
wBufSrc0
++);

133 
cur_v®ue
 +ð
weight01
 * (*
wBufSrc0
 );

134 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

137 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

139 *(
wBufD¡
++èð*
wBufSrc0
;

143 
j·d
 = 
size_y_mšus1
+1; j·d < size_y_mšus1+1+
p_Vid
->
·d_size_uv_y
; jpad++)

145 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

147 
	}
}

155 
	$g’”©eChroma10
(
VideoP¬am‘”s
 *
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight10
, 
img³l
 **
wImgD¡
, img³È**
imgUV
)

157 
i
;

158 
j·d
 = -
p_Vid
->
·d_size_uv_y
;

159 
cur_v®ue
;

160 
img³l
 *
wBufD¡
;

161 
img³l
 *
wBufSrc0
, *
wBufSrc1
;

163 
wBufD¡
 = 
wImgD¡
[
j·d
++]-
p_Vid
->
·d_size_uv_x
;

164 
wBufSrc0
 = 
imgUV
[0];

167 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

169 *(
wBufD¡
++èð*
wBufSrc0
;

172 
	`memýy
(
wBufD¡
, 
wBufSrc0
, 
size_x_mšus1
 * (
img³l
));

173 
wBufD¡
 +ð
size_x_mšus1
;

174 
wBufSrc0
 +ð
size_x_mšus1
;

176 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

178 *(
wBufD¡
++èð*
wBufSrc0
;

181 ;
j·d
 < 0; jpad++)

183 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

186 
j·d
 = 0; j·d < 
size_y_mšus1
; jpad++)

188 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

189 
wBufSrc0
 = 
imgUV
[
j·d
];

190 
wBufSrc1
 = 
imgUV
[
j·d
+1];

192 
cur_v®ue
 = 
	`rshiá_ºd_sf
(
weight00
 * (*
wBufSrc0
è+ 
weight10
 * (*
wBufSrc1
), 6 );

193 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

195 *(
wBufD¡
++èð(
img³l
è
cur_v®ue
;

198 
i
 = 0; i < 
size_x_mšus1
; i++)

200 
cur_v®ue
 = 
weight00
 * (*
wBufSrc0
++è+ 
weight10
 * (*
wBufSrc1
++);

201 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

204 
cur_v®ue
 = 
	`rshiá_ºd_sf
(
weight00
 * (*
wBufSrc0
è+ 
weight10
 * (*
wBufSrc1
), 6 );

205 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

207 *(
wBufD¡
++èð(
img³l
è
cur_v®ue
;

211 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

212 
wBufSrc0
 = 
imgUV
[
size_y_mšus1
];

214 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

216 *(
wBufD¡
++èð*
wBufSrc0
;

219 
	`memýy
(
wBufD¡
, 
wBufSrc0
, 
size_x_mšus1
 * (
img³l
));

220 
wBufD¡
 +ð
size_x_mšus1
;

221 
wBufSrc0
 +ð
size_x_mšus1
;

223 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

225 *(
wBufD¡
++èð*
wBufSrc0
;

228 
j·d
 = 
size_y_mšus1
+1; j·d < size_y_mšus1+1+
p_Vid
->
·d_size_uv_y
; jpad++)

230 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

232 
	}
}

240 
	$g’”©eChromaXX
Ð
VideoP¬am‘”s
 *
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight01
, 
weight10
, 
weight11
, 
img³l
 **
wImgD¡
, img³È**
imgUV
)

242 
i
;

243 
j·d
 = -
p_Vid
->
·d_size_uv_y
;

244 
cur_v®ue
;

245 
img³l
 *
wBufD¡
;

246 
img³l
 *
wBufSrc0
, *
wBufSrc1
;

247 
weight0001
 = 
weight00
 + 
weight01
;

248 
weight1011
 = 
weight10
 + 
weight11
;

249 
weight0010
 = 
weight00
 + 
weight10
;

250 
weight0111
 = 
weight01
 + 
weight11
;

252 
wBufD¡
 = 
wImgD¡
[
j·d
++]-
p_Vid
->
·d_size_uv_x
;

253 
wBufSrc0
 = 
imgUV
[0];

255 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

257 *(
wBufD¡
++èð*
wBufSrc0
;

260 
i
 = 0; i < 
size_x_mšus1
; i++)

262 
cur_v®ue
 = 
weight0010
 * (*
wBufSrc0
++);

263 
cur_v®ue
 +ð
weight0111
 * (*
wBufSrc0
 );

264 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

267 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

269 *(
wBufD¡
++èð*
wBufSrc0
;

272 ; 
j·d
 < 0; jpad++)

274 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

277 
j·d
 = 0; j·d < 
size_y_mšus1
; jpad++)

279 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

280 
wBufSrc0
 = 
imgUV
[
j·d
];

281 
wBufSrc1
 = 
imgUV
[
j·d
 + 1];

283 
cur_v®ue
 = 
	`rshiá_ºd_sf
(
weight0001
 * (*
wBufSrc0
è+ 
weight1011
 * (*
wBufSrc1
), 6 );

284 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

286 *(
wBufD¡
++èð(
img³l
è
cur_v®ue
;

289 
i
 = 0; i < 
size_x_mšus1
; i++)

291 
cur_v®ue
 = 
weight00
 * (*
wBufSrc0
++è+ 
weight10
 * (*
wBufSrc1
++);

292 
cur_v®ue
 +ð
weight01
 * (*
wBufSrc0
 ) + 
weight11
 * (*
wBufSrc1
 );

293 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

296 
cur_v®ue
 = 
	`rshiá_ºd_sf
(
weight0001
 * (*
wBufSrc0
è+ 
weight1011
 * (*
wBufSrc1
), 6 );

297 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

299 *(
wBufD¡
++èð(
img³l
è
cur_v®ue
;

303 
wBufD¡
 = 
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
;

304 
wBufSrc0
 = 
imgUV
[
size_y_mšus1
];

306 
i
 = -
p_Vid
->
·d_size_uv_x
; i < 0; i++)

308 *(
wBufD¡
++èð*
wBufSrc0
;

311 
i
 = 0; i < 
size_x_mšus1
; i++)

313 
cur_v®ue
 = 
weight0010
 * (*
wBufSrc0
++);

314 
cur_v®ue
 +ð
weight0111
 * (*
wBufSrc0
 );

315 *(
wBufD¡
++èð(
img³l
è
	`rshiá_ºd_sf
(
cur_v®ue
, 6);

318 
i
 = -1; i < 
p_Vid
->
·d_size_uv_x
; i++)

320 *(
wBufD¡
++èð*
wBufSrc0
;

323 
j·d
 = 
size_y_mšus1
+1; j·d < size_y_mšus1+1+
p_Vid
->
·d_size_uv_y
; jpad++)

325 
	`memýy
(
wImgD¡
[
j·d
]-
p_Vid
->
·d_size_uv_x
, wImgD¡[j·d - 1]-p_Vid->·d_size_uv_x, (2 *…_Vid->·d_size_uv_x + 
size_x_mšus1
+1è* (
img³l
));

327 
	}
}

338 
	$g‘SubImagesChroma
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
 )

340 
uv
, 
k
, 
l
, 
m
;

341 
weight00
, 
weight01
, 
weight10
, 
weight11
;

342 
subimages_y
, 
subimages_x
, 
subx
, 
suby
;

343 
size_x_mšus1
, 
size_y_mšus1
;

344 
img³l
 ****
cu¼_img_sub
;

345 
img³l
 **
cu¼_img
;

348 
mul_x
, 
mul_y
;

349 
mm
, 
kk
;

351 
size_x_mšus1
 = 
s
->
size_x_ü
 - 1;

352 
size_y_mšus1
 = 
s
->
size_y_ü
 - 1;

354 ifÐ
p_Vid
->
p_IÅ
->
OnTheFlyF¿ùMCP
 =ð
OTF_L1
 )

356 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 )

358 
subimages_x
 = 4;

359 
subimages_y
 = 4;

360 
mul_x
 = 
mul_y
 = 2;

362 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV422
 )

364 
subimages_x
 = 4;

365 
subimages_y
 = 2;

366 
mul_y
 = 4;

367 
mul_x
 = 2;

371 
subimages_x
 = 2;

372 
subimages_y
 = 2;

373 
mul_x
 = 
mul_y
 = 4;

378 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 )

380 
subimages_x
 = 8;

381 
subimages_y
 = 8;

382 
mul_x
 = 
mul_y
 = 1;

384 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV422
 )

386 
subimages_x
 = 8;

387 
subimages_y
 = 4;

388 
mul_y
 = 2;

389 
mul_x
 = 1;

393 
subimages_x
 = 4;

394 
subimages_y
 = 4;

395 
mul_x
 = 
mul_y
 = 2;

400  
uv
 = 0; uv < 2; uv++ )

402 
cu¼_img
 = 
s
->
imgUV
[
uv
];

403 
cu¼_img_sub
 = 
s
->
p_img_sub
[
uv
 + 1];

405  
suby
 = 0, 
k
 = 0; suby < 
subimages_y
; suby++, k +ð
mul_y
 )

407 
m
 = (8 - 
k
);

408 
mm
 = 
m
 << 3;

409 
kk
 = 
k
 << 3;

410  
subx
 = 0, 
l
 = 0; subx < 
subimages_x
; subx++,† +ð
mul_x
 )

412 
weight01
 = 
m
 * 
l
;

413 
weight00
 = 
mm
 - 
weight01
;

414 
weight11
 = 
k
 * 
l
;

415 
weight10
 = 
kk
 - 
weight11
;

418 ià(
weight01
 =ð0 && 
weight10
 =ð0 && 
weight11
 == 0)

420 
	`g’”©eChroma00
Ð
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
cu¼_img_sub
[
suby
][
subx
], 
cu¼_img
);

422 ià(
weight10
 =ð0 && 
weight11
 == 0)

424 
	`g’”©eChroma01
Ð
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight01
, 
cu¼_img_sub
[
suby
][
subx
], 
cu¼_img
);

426 ià(
weight01
 =ð0 && 
weight11
 == 0)

428 
	`g’”©eChroma10
Ð
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight10
, 
cu¼_img_sub
[
suby
][
subx
], 
cu¼_img
);

432 
	`g’”©eChromaXX
Ð
p_Vid
, 
size_x_mšus1
, 
size_y_mšus1
, 
weight00
, 
weight01
, 
weight10
, 
weight11
, 
cu¼_img_sub
[
suby
][
subx
], 
cu¼_img
);

437 
	}
}

	@lencod/src/img_dist_ms_ssim.c

17 
	~"cÚŒibutÜs.h
"

18 
	~"glob®.h
"

19 
	~"img_di¡ÜtiÚ.h
"

20 
	~"’c_¡©i¡ics.h
"

21 
	~"mem®loc.h
"

22 
	~"m©h.h
"

24 #iâdeà
UNBIASED_VARIANCE


25 
	#UNBIASED_VARIANCE


27 

	)

28 
	#MS_SSIM_PAD
 6

	)

29 
	#MS_SSIM_PAD2
 3

	)

31 
	#MS_SSIM_BETA0
 0.0448

	)

32 
	#MS_SSIM_BETA1
 0.2856

	)

33 
	#MS_SSIM_BETA2
 0.3001

	)

34 
	#MS_SSIM_BETA3
 0.2363

	)

35 
	#MS_SSIM_BETA4
 0.1333

	)

37 
	#MAX_SSIM_LEVELS
 5

	)

40 
	$compu‹_¡ruùu¿l_compÚ’ts
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
 **
»fImg
, img³È**
’cImg
, 
height
, 
width
, 
wš_height
, 
wš_width
, 
comp
)

42 cÚ¡ 
K2
 = 0.03f;

43 
max_pix_v®ue_sqd
;

44 
C2
;

45 
wš_pix–s
 = (è(
wš_width
 * 
wš_height
);

46 #ifdeà
UNBIASED_VARIANCE


47 
wš_pix–s_bŸs
 = 
wš_pix–s
 - 1;

49 
wš_pix–s_bŸs
 = 
wš_pix–s
;

51 
mb_ssim
, 
m—nOrg
, 
m—nEnc
;

52 
v¬Org
, 
v¬Enc
, 
covOrgEnc
;

53 
im—nOrg
, 
im—nEnc
, 
iv¬Org
, 
iv¬Enc
, 
icovOrgEnc
;

54 
cur_di¡ÜtiÚ
 = 0.0;

55 
i
, 
j
, 
n
, 
m
, 
wš_út
 = 0;

56 
ov”ÏpSize
 = 
p_IÅ
->
SSIMOv”ÏpSize
;

58 
max_pix_v®ue_sqd
 = (è(
p_Vid
->
max_³l_v®ue_comp
[
comp
] *…_Vid->max_pel_value_comp[comp]);

59 
C2
 = 
K2
 * K2 * 
max_pix_v®ue_sqd
;

61 
j
 = 0; j <ð
height
 - 
wš_height
; j +ð
ov”ÏpSize
)

63 
i
 = 0; i <ð
width
 - 
wš_width
; i +ð
ov”ÏpSize
)

65 
im—nOrg
 = 0;

66 
im—nEnc
 = 0;

67 
iv¬Org
 = 0;

68 
iv¬Enc
 = 0;

69 
icovOrgEnc
 = 0;

71  
n
 = 
j
;À< j + 
wš_height
;n ++)

73 
m
 = 
i
;m < i + 
wš_width
;m ++)

75 
im—nOrg
 +ð
»fImg
[
n
][
m
];

76 
im—nEnc
 +ð
’cImg
[
n
][
m
];

77 
iv¬Org
 +ð
»fImg
[
n
][
m
] *„efImg[n][m];

78 
iv¬Enc
 +ð
’cImg
[
n
][
m
] *ƒncImg[n][m];

79 
icovOrgEnc
 +ð
»fImg
[
n
][
m
] * 
’cImg
[n][m];

83 
m—nOrg
 = (è
im—nOrg
 / 
wš_pix–s
;

84 
m—nEnc
 = (è
im—nEnc
 / 
wš_pix–s
;

86 
v¬Org
 = ((è
iv¬Org
 - ((è
im—nOrg
è* 
m—nOrg
è/ 
wš_pix–s_bŸs
;

87 
v¬Enc
 = ((è
iv¬Enc
 - ((è
im—nEnc
è* 
m—nEnc
è/ 
wš_pix–s_bŸs
;

88 
covOrgEnc
 = ((è
icovOrgEnc
 - ((è
im—nOrg
è* 
m—nEnc
è/ 
wš_pix–s_bŸs
;

90 
mb_ssim
 = (è(2.0 * 
covOrgEnc
 + 
C2
);

91 
mb_ssim
 /ð(è(
v¬Org
 + 
v¬Enc
 + 
C2
);

93 
cur_di¡ÜtiÚ
 +ð
mb_ssim
;

94 
wš_út
++;

98 
cur_di¡ÜtiÚ
 /ð(è
wš_út
;

100 ià(
cur_di¡ÜtiÚ
 >= 1.0 && cur_distortion < 1.01)

101 
cur_di¡ÜtiÚ
 = 1.0;

103  
cur_di¡ÜtiÚ
;

104 
	}
}

106 
	$compu‹_lumšªû_compÚ’t
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
 **
»fImg
, img³È**
’cImg
, 
height
, 
width
, 
wš_height
, 
wš_width
, 
comp
)

108 cÚ¡ 
K1
 = 0.01f;

109 
max_pix_v®ue_sqd
;

110 
C1
;

111 
wš_pix–s
 = (è(
wš_width
 * 
wš_height
);

112 
mb_ssim
, 
m—nOrg
, 
m—nEnc
;

113 
im—nOrg
, 
im—nEnc
;

114 
cur_di¡ÜtiÚ
 = 0.0;

115 
i
, 
j
, 
n
, 
m
, 
wš_út
 = 0;

116 
ov”ÏpSize
 = 
p_IÅ
->
SSIMOv”ÏpSize
;

118 
max_pix_v®ue_sqd
 = (è(
p_Vid
->
max_³l_v®ue_comp
[
comp
] *…_Vid->max_pel_value_comp[comp]);

119 
C1
 = 
K1
 * K1 * 
max_pix_v®ue_sqd
;

121 
j
 = 0; j <ð
height
 - 
wš_height
; j +ð
ov”ÏpSize
)

123 
i
 = 0; i <ð
width
 - 
wš_width
; i +ð
ov”ÏpSize
)

125 
im—nOrg
 = 0;

126 
im—nEnc
 = 0;

128  
n
 = 
j
;À< j + 
wš_height
;n ++)

130 
m
 = 
i
;m < i + 
wš_width
;m ++)

132 
im—nOrg
 +ð
»fImg
[
n
][
m
];

133 
im—nEnc
 +ð
’cImg
[
n
][
m
];

137 
m—nOrg
 = (è
im—nOrg
 / 
wš_pix–s
;

138 
m—nEnc
 = (è
im—nEnc
 / 
wš_pix–s
;

140 
mb_ssim
 = (è(2.0 * 
m—nOrg
 * 
m—nEnc
 + 
C1
);

141 
mb_ssim
 /ð(è(
m—nOrg
 * m—nOrg + 
m—nEnc
 * m—nEnø+ 
C1
);

143 
cur_di¡ÜtiÚ
 +ð
mb_ssim
;

144 
wš_út
++;

148 
cur_di¡ÜtiÚ
 /ð(è
wš_út
;

150 ià(
cur_di¡ÜtiÚ
 >= 1.0 && cur_distortion < 1.01)

151 
cur_di¡ÜtiÚ
 = 1.0;

153  
cur_di¡ÜtiÚ
;

154 
	}
}

156 
	$hÜizÚl_symm‘ric_ex‹nsiÚ
(**
bufãr
, 
width
, 
height
 )

158 
j
;

159 * 
buf
;

161 
height_¶us_·d2
 = 
height
 + 
MS_SSIM_PAD2
;

162 
width_¶us_·d2_mšus_Úe
 = 
width
 + 
MS_SSIM_PAD2
 - 1;

165 
j
 = 
MS_SSIM_PAD2
; j < 
height_¶us_·d2
; j++ ) {

167 
buf
 = &
bufãr
[
j
][
MS_SSIM_PAD2
];

168 
buf
[-1] = buf[1];

169 
buf
[-2] = buf[2];

172 
buf
 = &
bufãr
[
j
][
width_¶us_·d2_mšus_Úe
];

173 
buf
[1] = buf[-1];

174 
buf
[2] = buf[-2];

175 
buf
[3] = buf[-3];

177 
	}
}

179 
	$v”tiÿl_symm‘ric_ex‹nsiÚ
(**
bufãr
, 
width
, 
height
)

181 
i
;

183 *
bufmšus1
 = &
bufãr
[
MS_SSIM_PAD2
-1][MS_SSIM_PAD2];

184 *
bufmšus2
 = &
bufãr
[
MS_SSIM_PAD2
-2][MS_SSIM_PAD2];

185 *
buålus1
 = &
bufãr
[
MS_SSIM_PAD2
+1][MS_SSIM_PAD2];

186 *
buålus2
 = &
bufãr
[
MS_SSIM_PAD2
+2][MS_SSIM_PAD2];

188 *
bufhmšus1
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
-2][MS_SSIM_PAD2];

189 *
bufhmšus2
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
-3][MS_SSIM_PAD2];

190 *
bufhmšus3
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
-4][MS_SSIM_PAD2];

191 *
bufh¶us1
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
][MS_SSIM_PAD2];

192 *
bufh¶us2
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
+1][MS_SSIM_PAD2];

193 *
bufh¶us3
 = &
bufãr
[
height
 + 
MS_SSIM_PAD2
+2][MS_SSIM_PAD2];

195 
i
 = 0; i < 
width
; i++)

198 
bufmšus1
[
i
] = 
buålus1
[i];

199 
bufmšus2
[
i
] = 
buålus2
[i];

201 
bufh¶us1
[
i
] = 
bufhmšus1
[i];

202 
bufh¶us2
[
i
] = 
bufhmšus2
[i];

203 
bufh¶us3
[
i
] = 
bufhmšus3
[i];

205 
	}
}

207 
	$img³l_to_·dded_št
(
img³l
** 
¤c
, **
bufãr
, 
width
, 
height
)

209 
i
, 
j
;

210 * 
tmpD¡
;

211 
img³l
* 
tmpSrc
;

213 
tmpD¡
 = 
bufãr
[
MS_SSIM_PAD2
];

214 
j
 = 0; j < 
height
; j++)

216 
tmpSrc
 = 
¤c
[
j
];

217 
tmpD¡
 = &
bufãr
[
j
 + 
MS_SSIM_PAD2
][MS_SSIM_PAD2];

218 
i
 = 0; i < 
width
; i++)

220 
tmpD¡
[
i
] = ()
tmpSrc
[i];

223 
	}
}

225 
	$down§m¶e
(
img³l
** 
¤c
, img³l** 
out
, 
height
, 
width
)

227 
height2
 = 
height
 >> 1;

228 
width2
 = 
width
 >> 1;

229 
i
, 
j
;

230 
ii
, 
jj
;

231 
iD¡
;

232 
tmp
, 
tmp1
, 
tmp2
;

233 * 
tmpD¡
;

234 * 
tmpSrc
;

236 ** 
™emp
;

237 ** 
de¡
;

239 
	`g‘_mem2Dšt
(&
™emp
, 
height
 + 
MS_SSIM_PAD
, 
width
 + MS_SSIM_PAD);

240 
	`g‘_mem2Dšt
(&
de¡
, 
height
 + 
MS_SSIM_PAD
, 
width2
 + MS_SSIM_PAD);

242 
	`img³l_to_·dded_št
(
¤c
, 
™emp
, 
width
, 
height
);

243 
	`hÜizÚl_symm‘ric_ex‹nsiÚ
(
™emp
, 
width
, 
height
);

245 
j
 = 0; j < 
height
; j++)

247 
tmpD¡
 = 
de¡
[
j
+
MS_SSIM_PAD2
];

248 
tmpSrc
 = 
™emp
[
j
+
MS_SSIM_PAD2
];

249 
iD¡
 = 
MS_SSIM_PAD2
;

250 
i
 = 0; i < 
width2
; i++, 
iD¡
++)

252 
ii
 = (
i
 << 1è+ 
MS_SSIM_PAD2
;

253 
tmp1
 = 
tmpSrc
[
ii
-1] +mpSrc[ii+2];

254 
tmp2
 = 
tmpSrc
[
ii
] +mpSrc[ii+1];

255 
tmpD¡
[
iD¡
] = 
tmpSrc
[
ii
-2] +mpSrc[ii+3] + (
tmp1
 << 1è+mp1 + (
tmp2
 << 5) - (tmp2 << 2);

256 
tmpD¡
[
iD¡
] >>= 6;

261 
	`v”tiÿl_symm‘ric_ex‹nsiÚ
(
de¡
, 
width2
, 
height
);

263 
i
 = 0; i < 
width2
; i++)

265 
ii
 = 
i
 + 
MS_SSIM_PAD2
;

266 
j
 = 0; j < 
height2
; j++)

268 
jj
 = (
j
 << 1è+ 
MS_SSIM_PAD2
;

269 
tmp1
 = 
de¡
[
jj
-1][
ii
] + dest[jj+2][ii];

270 
tmp2
 = 
de¡
[
jj
][
ii
] + dest[jj+1][ii];

271 
tmp
 = 
de¡
[
jj
-2][
ii
] + de¡[jj+3][ii] + (
tmp1
 << 1è+mp1 + (
tmp2
 << 5) - (tmp2 << 2);

272 
out
[
j
][
i
] = (è(
tmp
 >> 6);

275 
	`ä“_mem2Dšt
(
™emp
);

276 
	`ä“_mem2Dšt
(
de¡
);

277 
	}
}

279 
	$compu‹_ms_ssim
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
 **
»fImg
, img³È**
’cImg
, 
height
, 
width
, 
wš_height
, 
wš_width
, 
comp
)

281 
¡ruùu¿l
[
MAX_SSIM_LEVELS
];

282 
cur_di¡ÜtiÚ
;

283 
lumšªû
;

284 
img³l
** 
dsRef
;

285 
img³l
** 
dsEnc
;

286 
m
;

287 cÚ¡ 
max_ssim_Ëv–s_mšus_Úe
 = 
MAX_SSIM_LEVELS
 - 1;

288 cÚ¡ 
expÚ’t
[5] = {()
MS_SSIM_BETA0
, ()
MS_SSIM_BETA1
, ()
MS_SSIM_BETA2
, ()
MS_SSIM_BETA3
, ()
MS_SSIM_BETA4
};

290 
dsRef
 = 
NULL
;

291 
dsEnc
 = 
NULL
;

292 
	`g‘_mem2D³l
(&
dsRef
, 
height
>>1, 
width
>>1);

293 
	`g‘_mem2D³l
(&
dsEnc
, 
height
>>1, 
width
>>1);

295 
¡ruùu¿l
[0] = 
	`compu‹_¡ruùu¿l_compÚ’ts
(
p_Vid
, 
p_IÅ
, 
»fImg
, 
’cImg
, 
height
, 
width
, 
wš_height
, 
wš_width
, 
comp
);

296 
cur_di¡ÜtiÚ
 = ()
	`pow
(
¡ruùu¿l
[0], 
expÚ’t
[0]);

298 
	`down§m¶e
(
»fImg
, 
dsRef
, 
height
, 
width
);

299 
	`down§m¶e
(
’cImg
, 
dsEnc
, 
height
, 
width
);

301 
m
 = 1; m < 
MAX_SSIM_LEVELS
; m++)

303 
height
 >>= 1;

304 
width
 >>= 1;

305 
¡ruùu¿l
[
m
] = 
	`compu‹_¡ruùu¿l_compÚ’ts
(
p_Vid
, 
p_IÅ
, 
dsRef
, 
dsEnc
, 
height
, 
width
, 
	`imš
(
wš_height
,height), imš(
wš_width
,width), 
comp
);

306 
cur_di¡ÜtiÚ
 *ð()
	`pow
(
¡ruùu¿l
[
m
], 
expÚ’t
[m]);

307 ià(
m
 < 
max_ssim_Ëv–s_mšus_Úe
)

309 
	`down§m¶e
(
dsRef
, dsRef, 
height
, 
width
);

310 
	`down§m¶e
(
dsEnc
, dsEnc, 
height
, 
width
);

314 
lumšªû
 = 
	`compu‹_lumšªû_compÚ’t
(
p_Vid
, 
p_IÅ
, 
dsRef
, 
dsEnc
, 
height
, 
width
, 
	`imš
(
wš_height
,height), imš(
wš_width
,width), 
comp
);

315 
cur_di¡ÜtiÚ
 *ð()
	`pow
(
lumšªû
, 
expÚ’t
[
m
]);

318 
	`ä“_mem2D³l
(
dsRef
);

319 
	`ä“_mem2D³l
(
dsEnc
);

320 
dsRef
 = 
NULL
;

321 
dsEnc
 = 
NULL
;

323  
cur_di¡ÜtiÚ
;

324 
	}
}

332 
	$fšd_ms_ssim
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ImageSŒuùu»
 *
»f
, ImageSŒuùu» *
¤c
, 
Di¡M‘ric
 *
m‘ricSSIM
)

334 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

335 
F¿meFÜm©
 *
fÜm©
 = &
»f
->format;

337 
m‘ricSSIM
->
v®ue
[0] = 
	`compu‹_ms_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[0], 
¤c
->d©a[0], 
fÜm©
->
height
[0], fÜm©->
width
[0], 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 0);

339 ià(
fÜm©
->
yuv_fÜm©
 !ð
YUV400
)

341 
m‘ricSSIM
->
v®ue
[1] = 
	`compu‹_ms_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[1], 
¤c
->d©a[1], 
fÜm©
->
height
[1], fÜm©->
width
[1],…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
, 1);

342 
m‘ricSSIM
->
v®ue
[2] = 
	`compu‹_ms_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[2], 
¤c
->d©a[2], 
fÜm©
->
height
[1], fÜm©->
width
[1],…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
, 2);

346 
	`accumuÏ‹_av”age
(
m‘ricSSIM
, 
p_Di¡
->
äame_ùr
);

347 
	`accumuÏ‹_av¦iû
(
m‘ricSSIM
, 
p_Vid
->
ty³
,…_Vid->
p_Sts
->
äame_ùr
[p_Vid->type]);

349 
	}
}

	@lencod/src/img_dist_snr.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<m©h.h
>

19 
	~"’c_¡©i¡ics.h
"

20 
	~"glob®.h
"

21 
	~"img_di¡ÜtiÚ.h
"

22 
	~"md_di¡ÜtiÚ.h
"

30 
	$fšd_¢r
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
imgREF
, ImageSŒuùu» *
imgSRC
, 
Di¡M‘ric
 *
m‘ricSSE
, Di¡M‘riø*
m‘ricPSNR
)

32 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

33 
F¿meFÜm©
 *
fÜm©
 = &
imgREF
->format;

35 
m‘ricSSE
 ->
v®ue
[0] = (è
	`compu‹_SSE
(
imgREF
->
d©a
[0], 
imgSRC
->d©a[0], 0, 0, 
fÜm©
->
height
[0], fÜm©->
width
[0]);

36 
m‘ricPSNR
->
v®ue
[0] = 
	`p¢r
(
fÜm©
->
max_v®ue_sq
[0], fÜm©->
size_cmp
[0], 
m‘ricSSE
->value[0]);

38 ià(
fÜm©
->
yuv_fÜm©
 !ð
YUV400
)

40 
m‘ricSSE
 ->
v®ue
[1] = (è
	`compu‹_SSE
(
imgREF
->
d©a
[1], 
imgSRC
->d©a[1], 0, 0, 
fÜm©
->
height
[1], fÜm©->
width
[1]);

41 
m‘ricPSNR
->
v®ue
[1] = 
	`p¢r
(
fÜm©
->
max_v®ue_sq
[1], fÜm©->
size_cmp
[1], 
m‘ricSSE
->value[1]);

42 
m‘ricSSE
 ->
v®ue
[2] = (è
	`compu‹_SSE
(
imgREF
->
d©a
[2], 
imgSRC
->d©a[2], 0, 0, 
fÜm©
->
height
[1], fÜm©->
width
[1]);

43 
m‘ricPSNR
->
v®ue
[2] = 
	`p¢r
(
fÜm©
->
max_v®ue_sq
[2], fÜm©->
size_cmp
[2], 
m‘ricSSE
->value[2]);

45 #ià(
MVC_EXTENSION_ENABLE
)

46 ià(
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2)

49 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
SSE
].
v®ue
[0] = 
m‘ricSSE
 ->value[0];

50 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
PSNR
].
v®ue
[0] = 
m‘ricPSNR
->value[0];

52 ià(
fÜm©
->
yuv_fÜm©
 !ð
YUV400
)

54 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
SSE
].
v®ue
[1] = 
m‘ricSSE
 ->value[1];

55 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
PSNR
].
v®ue
[1] = 
m‘ricPSNR
->value[1];

56 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
SSE
].
v®ue
[2] = 
m‘ricSSE
 ->value[2];

57 
p_Vid
->
p_Di¡
->
m‘ric_v
[p_Vid->
v›w_id
][
PSNR
].
v®ue
[2] = 
m‘ricPSNR
->value[2];

63 
	`accumuÏ‹_av”age
(
m‘ricSSE
, 
p_Di¡
->
äame_ùr
);

64 
	`accumuÏ‹_av”age
(
m‘ricPSNR
, 
p_Di¡
->
äame_ùr
);

66 
	`accumuÏ‹_av¦iû
(
m‘ricSSE
, 
p_Vid
->
ty³
,…_Vid->
p_Sts
->
äame_ùr
[p_Vid->type]);

67 
	`accumuÏ‹_av¦iû
(
m‘ricPSNR
, 
p_Vid
->
ty³
,…_Vid->
p_Sts
->
äame_ùr
[p_Vid->type]);

68 #ià(
MVC_EXTENSION_ENABLE
)

69 ià(
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2)

71 
	`accumuÏ‹_av”age
(&
p_Di¡
->
m‘ric_v
[
p_Vid
->
v›w_id
][
SSE
],…_Di¡->
äame_ùr_v
[p_Vid->view_id]);

72 
	`accumuÏ‹_av”age
(&
p_Di¡
->
m‘ric_v
[
p_Vid
->
v›w_id
][
PSNR
],…_Di¡->
äame_ùr_v
[p_Vid->view_id]);

76 
	}
}

	@lencod/src/img_dist_ssim.c

16 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"img_di¡ÜtiÚ.h
"

19 
	~"’c_¡©i¡ics.h
"

23 
	$compu‹_ssim
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
img³l
 **
»fImg
, img³È**
’cImg
, 
height
, 
width
, 
wš_height
, 
wš_width
, 
comp
)

26 cÚ¡ 
K1
 = 0.01f, 
K2
 = 0.03f;

27 
max_pix_v®ue_sqd
;

28 
C1
, 
C2
;

29 
wš_pix–s
 = (è(
wš_width
 * 
wš_height
);

30 #ifdeà
UNBIASED_VARIANCE


31 
wš_pix–s_bŸs
 = 
wš_pix–s
 - 1;

33 
wš_pix–s_bŸs
 = 
wš_pix–s
;

35 
mb_ssim
, 
m—nOrg
, 
m—nEnc
;

36 
v¬Org
, 
v¬Enc
, 
covOrgEnc
;

37 
im—nOrg
, 
im—nEnc
, 
iv¬Org
, 
iv¬Enc
, 
icovOrgEnc
;

38 
cur_di¡ÜtiÚ
 = 0.0;

39 
i
, 
j
, 
n
, 
m
, 
wš_út
 = 0;

40 
ov”ÏpSize
 = 
p_IÅ
->
SSIMOv”ÏpSize
;

42 
max_pix_v®ue_sqd
 = (è(
p_Vid
->
max_³l_v®ue_comp
[
comp
] *…_Vid->max_pel_value_comp[comp]);

43 
C1
 = 
K1
 * K1 * 
max_pix_v®ue_sqd
;

44 
C2
 = 
K2
 * K2 * 
max_pix_v®ue_sqd
;

46 
j
 = 0; j <ð
height
 - 
wš_height
; j +ð
ov”ÏpSize
)

48 
i
 = 0; i <ð
width
 - 
wš_width
; i +ð
ov”ÏpSize
)

50 
im—nOrg
 = 0;

51 
im—nEnc
 = 0;

52 
iv¬Org
 = 0;

53 
iv¬Enc
 = 0;

54 
icovOrgEnc
 = 0;

56  
n
 = 
j
;À< j + 
wš_height
;n ++)

58 
m
 = 
i
;m < i + 
wš_width
;m ++)

60 
im—nOrg
 +ð
»fImg
[
n
][
m
];

61 
im—nEnc
 +ð
’cImg
[
n
][
m
];

62 
iv¬Org
 +ð
»fImg
[
n
][
m
] *„efImg[n][m];

63 
iv¬Enc
 +ð
’cImg
[
n
][
m
] *ƒncImg[n][m];

64 
icovOrgEnc
 +ð
»fImg
[
n
][
m
] * 
’cImg
[n][m];

68 
m—nOrg
 = (è
im—nOrg
 / 
wš_pix–s
;

69 
m—nEnc
 = (è
im—nEnc
 / 
wš_pix–s
;

71 
v¬Org
 = ((è
iv¬Org
 - ((è
im—nOrg
è* 
m—nOrg
è/ 
wš_pix–s_bŸs
;

72 
v¬Enc
 = ((è
iv¬Enc
 - ((è
im—nEnc
è* 
m—nEnc
è/ 
wš_pix–s_bŸs
;

73 
covOrgEnc
 = ((è
icovOrgEnc
 - ((è
im—nOrg
è* 
m—nEnc
è/ 
wš_pix–s_bŸs
;

75 
mb_ssim
 = (è((2.0 * 
m—nOrg
 * 
m—nEnc
 + 
C1
è* (2.0 * 
covOrgEnc
 + 
C2
));

76 
mb_ssim
 /ð(è(
m—nOrg
 * m—nOrg + 
m—nEnc
 * m—nEnø+ 
C1
è* (
v¬Org
 + 
v¬Enc
 + 
C2
);

78 
cur_di¡ÜtiÚ
 +ð
mb_ssim
;

79 
wš_út
++;

83 
cur_di¡ÜtiÚ
 /ð(è
wš_út
;

85 ià(
cur_di¡ÜtiÚ
 >= 1.0 && cur_distortion < 1.01)

86 
cur_di¡ÜtiÚ
 = 1.0;

88  
cur_di¡ÜtiÚ
;

89 
	}
}

97 
	$fšd_ssim
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
ImageSŒuùu»
 *
»f
, ImageSŒuùu» *
¤c
, 
Di¡M‘ric
 *
m‘ricSSIM
)

99 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

100 
F¿meFÜm©
 *
fÜm©
 = &
»f
->format;

102 
m‘ricSSIM
->
v®ue
[0] = 
	`compu‹_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[0], 
¤c
->d©a[0], 
fÜm©
->
height
[0], fÜm©->
width
[0], 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 0);

104 ià(
fÜm©
->
yuv_fÜm©
 !ð
YUV400
)

106 
m‘ricSSIM
->
v®ue
[1] = 
	`compu‹_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[1], 
¤c
->d©a[1], 
fÜm©
->
height
[1], fÜm©->
width
[1],…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
, 1);

107 
m‘ricSSIM
->
v®ue
[2] = 
	`compu‹_ssim
 (
p_Vid
, 
p_IÅ
, 
»f
->
d©a
[2], 
¤c
->d©a[2], 
fÜm©
->
height
[1], fÜm©->
width
[1],…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
, 2);

111 
	`accumuÏ‹_av”age
(
m‘ricSSIM
, 
p_Di¡
->
äame_ùr
);

112 
	`accumuÏ‹_av¦iû
(
m‘ricSSIM
, 
p_Vid
->
ty³
,…_Vid->
p_Sts
->
äame_ùr
[p_Vid->type]);

114 
	}
}

	@lencod/src/img_distortion.c

16 
	~<m©h.h
>

17 
	~<time.h
>

19 
	~"glob®.h
"

21 
	~"»fbuf.h
"

22 
	~"mbufãr.h
"

23 
	~"img_luma.h
"

24 
	~"img_chroma.h
"

25 
	~"šŒ¬eäesh.h
"

26 
	~"fmo.h
"

27 
	~"£i.h
"

28 
	~"mem®loc.h
"

29 
	~"Çlu.h
"

30 
	~"¿‹ùl.h
"

31 
	~"mb_acûss.h
"

32 
	~"md_di¡ÜtiÚ.h
"

33 
	~"ouut.h
"

34 
	~"cÚ‹xt_ši.h
"

35 
	~"cÚfÜmªû.h
"

36 
	~"’c_¡©i¡ics.h
"

38 
	~"q_m©rix.h
"

39 
	~"q_off£ts.h
"

40 
	~"quªt4x4.h
"

41 
	~"quªt8x8.h
"

42 
	~"wp.h
"

43 
	~"šput.h
"

44 
	~"image.h
"

45 
	~"img_di¡ÜtiÚ.h
"

46 
	~"img_di¡_¢r.h
"

47 
	~"img_di¡_ssim.h
"

48 
	~"img_di¡_ms_ssim.h
"

49 
	~"ccÚv_yuv2rgb.h
"

58 
	$accumuÏ‹_m‘ric
(*
ave_m‘ric
, 
cur_m‘ric
, 
äames
)

60 *
ave_m‘ric
 = (è(*ave_m‘riø* (
äames
 - 1è+ 
cur_m‘ric
) / frames;

61 
	}
}

69 
	$accumuÏ‹_av”age
(
Di¡M‘ric
 *
m‘ric
, 
äames
)

71 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av”age
[0], m‘ric->
v®ue
[0], 
äames
);

72 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av”age
[1], m‘ric->
v®ue
[1], 
äames
);

73 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av”age
[2], m‘ric->
v®ue
[2], 
äames
);

74 
	}
}

82 
	$accumuÏ‹_av¦iû
(
Di¡M‘ric
 *
m‘ric
, 
¦iû_ty³
, 
äames
)

84 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av¦iû
[
¦iû_ty³
][0], m‘ric->
v®ue
[0], 
äames
);

85 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av¦iû
[
¦iû_ty³
][1], m‘ric->
v®ue
[1], 
äames
);

86 
	`accumuÏ‹_m‘ric
(&
m‘ric
->
av¦iû
[
¦iû_ty³
][2], m‘ric->
v®ue
[2], 
äames
);

87 
	}
}

95 
	$fšd_di¡ÜtiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
)

97 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

98 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

99 
št64
 
diff_cmp
[3] = {0};

102 ià(
p_Vid
->
¡ruùu»
!=
FRAME
)

105 
diff_cmp
[0] +ð
	`compu‹_SSE
(
p_Vid
->
pCurImg
,…_Vid->
imgY_com
, 0, 0, 
p_IÅ
->
ouut
.
height
[0],…_IÅ->ouut.
width
[0]);

108 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

110 
diff_cmp
[1] +ð
	`compu‹_SSE
(
p_Vid
->
pImgOrg
[1],…_Vid->
imgUV_com
[0], 0, 0, 
p_IÅ
->
ouut
.
height
[1],…_IÅ->ouut.
width
[1]);

111 
diff_cmp
[2] +ð
	`compu‹_SSE
(
p_Vid
->
pImgOrg
[2],…_Vid->
imgUV_com
[1], 0, 0, 
p_IÅ
->
ouut
.
height
[1],…_IÅ->ouut.
width
[1]);

116 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

118 
p_Vid
->
’c_piùu»
 =…_Vid->
’c_äame_piùu»
[0];

120 
p_Vid
->
pCurImg
 = 
imgD©a
->
äm_d©a
[0];

121 
p_Vid
->
pImgOrg
[0] = 
imgD©a
->
äm_d©a
[0];

124 
diff_cmp
[0] +ð
	`compu‹_SSE
(
p_Vid
->
pImgOrg
[0],…_Vid->
’c_piùu»
->
imgY
, 0, 0, 
p_IÅ
->
ouut
.
height
[0],…_IÅ->ouut.
width
[0]);

127 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

129 
p_Vid
->
pImgOrg
[1] = 
imgD©a
->
äm_d©a
[1];

130 
p_Vid
->
pImgOrg
[2] = 
imgD©a
->
äm_d©a
[2];

132 
diff_cmp
[1] +ð
	`compu‹_SSE
(
p_Vid
->
pImgOrg
[1],…_Vid->
’c_piùu»
->
imgUV
[0], 0, 0, 
p_IÅ
->
ouut
.
height
[1],…_IÅ->ouut.
width
[1]);

133 
diff_cmp
[2] +ð
	`compu‹_SSE
(
p_Vid
->
pImgOrg
[2],…_Vid->
’c_piùu»
->
imgUV
[1], 0, 0, 
p_IÅ
->
ouut
.
height
[1],…_IÅ->ouut.
width
[1]);

138 
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[0] = (è
diff_cmp
[0];

139 
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[1] = (è
diff_cmp
[1];

140 
p_Di¡
->
m‘ric
[
SSE
].
v®ue
[2] = (è
diff_cmp
[2];

141 
	}
}

143 
	$£Ëù_img
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageSŒuùu»
 *
imgSRC
, ImageSŒuùu» *
imgREF
, 
ImageD©a
 *
imgD©a
)

145 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

146 ià(
p_Vid
->
æd_æag
 !ð
FALSE
)

148 
imgSRC
->
fÜm©
 = 
p_IÅ
->
ouut
;

149 
imgREF
->
fÜm©
 = 
p_IÅ
->
ouut
;

151 
imgREF
->
d©a
[0] = 
p_Vid
->
pCurImg
;

152 
imgSRC
->
d©a
[0] = 
p_Vid
->
imgY_com
;

154 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

156 
imgREF
->
d©a
[1] = 
p_Vid
->
pImgOrg
[1];

157 
imgREF
->
d©a
[2] = 
p_Vid
->
pImgOrg
[2];

158 
imgSRC
->
d©a
[1] = 
p_Vid
->
imgUV_com
[0];

159 
imgSRC
->
d©a
[2] = 
p_Vid
->
imgUV_com
[1];

164 
imgSRC
->
fÜm©
 = 
p_IÅ
->
ouut
;

165 
imgREF
->
fÜm©
 = 
p_IÅ
->
ouut
;

167 
imgREF
->
d©a
[0] = 
imgD©a
->
äm_d©a
[0];

169 ià((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
£·¿‹_cÞour_¶ªe_æag
 != 0))

171 
p_Vid
->
’c_piùu»
 =…_Vid->
’c_äame_piùu»
[0];

173 
imgSRC
->
d©a
[0] = 
p_Vid
->
’c_piùu»
->
imgY
;

175 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

177 
imgREF
->
d©a
[1] = 
imgD©a
->
äm_d©a
[1];

178 
imgREF
->
d©a
[2] = 
imgD©a
->
äm_d©a
[2];

180 
imgSRC
->
d©a
[1] = 
p_Vid
->
’c_piùu»
->
imgUV
[0];

181 
imgSRC
->
d©a
[2] = 
p_Vid
->
’c_piùu»
->
imgUV
[1];

184 
	}
}

186 
	$compu‹_di¡ÜtiÚ
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
)

188 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

189 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

190 ià(
p_IÅ
->
V”bo£
 != 0)

192 
	`£Ëù_img
(
p_Vid
, &p_Vid->
imgSRC
, &p_Vid->
imgREF
, 
imgD©a
);

194 
	`fšd_¢r
 (
p_Vid
, &p_Vid->
imgREF
, &p_Vid->
imgSRC
, &
p_Di¡
->
m‘ric
[
SSE
], &p_Di¡->m‘ric[
PSNR
]);

195 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

196 
	`fšd_ssim
 (
p_Vid
, 
p_IÅ
, &p_Vid->
imgREF
, &p_Vid->
imgSRC
, &
p_Di¡
->
m‘ric
[
SSIM
]);

197 ià(
p_IÅ
->
Di¡ÜtiÚ
[
MS_SSIM
] == 1)

198 
	`fšd_ms_ssim
(
p_Vid
, 
p_IÅ
, &p_Vid->
imgREF
, &p_Vid->
imgSRC
, &
p_Di¡
->
m‘ric
[
MS_SSIM
]);

200 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
 == 1)

202 
	`YUVtoRGB
(
p_Vid
, &p_Vid->
imgREF
, &p_Vid->
imgRGB_»f
);

203 
	`YUVtoRGB
(
p_Vid
, &p_Vid->
imgSRC
, &p_Vid->
imgRGB_¤c
);

204 
	`fšd_¢r
 (
p_Vid
, &p_Vid->
imgRGB_»f
, &p_Vid->
imgRGB_¤c
, &
p_Di¡
->
m‘ric
[
SSE_RGB
], &p_Di¡->m‘ric[
PSNR_RGB
]);

205 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

206 
	`fšd_ssim
 (
p_Vid
, 
p_IÅ
, &p_Vid->
imgRGB_»f
, &p_Vid->
imgRGB_¤c
, &
p_Di¡
->
m‘ric
[
SSIM_RGB
]);

207 ià(
p_IÅ
->
Di¡ÜtiÚ
[
MS_SSIM
] == 1)

208 
	`fšd_ms_ssim
(
p_Vid
, 
p_IÅ
, &p_Vid->
imgRGB_»f
, &p_Vid->
imgRGB_¤c
, &
p_Di¡
->
m‘ric
[
MS_SSIM_RGB
]);

211 
	}
}

	@lencod/src/img_luma.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"img_luma.h
"

24 
	~"mem®loc.h
"

40 
	$g‘SubImageIÁeg”
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImg
)

42 
i
, 
j
;

43 
size_x_mšus1
 = 
s
->
size_x
 - 1;

45 
img³l
 *
wBufSrc
, *
wBufD¡
;

48 
wBufD¡
 = &Ð
d¡Img
[-
IMG_PAD_SIZE_Y
][-
IMG_PAD_SIZE_X
] );

49 
wBufSrc
 = 
¤cImg
[0];

51 
i
 = 0; i < 
IMG_PAD_SIZE_X
; i++)

52 *(
wBufD¡
++èð
wBufSrc
[0];

54 
	`memýy
(
wBufD¡
, 
wBufSrc
, 
s
->
size_x
 * (
img³l
));

55 
wBufD¡
 +ð
s
->
size_x
;

57 
i
 = 0; i < 
IMG_PAD_SIZE_X
; i++)

58 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

61 
j
 = -
IMG_PAD_SIZE_Y
+1; j < 1; ++j)

63 
	`memýy
(
d¡Img
[
j
]-
IMG_PAD_SIZE_X
, d¡Img[j - 1]-IMG_PAD_SIZE_X, 
s
->
size_x_·dded
 * (
img³l
));

66 
j
 = 1; j < 
s
->
size_y
; j++)

68 
wBufD¡
 = &Ð
d¡Img
[
j
][-
IMG_PAD_SIZE_X
] );

69 
wBufSrc
 = 
¤cImg
[
j
];

71 
i
 = 0; i < 
IMG_PAD_SIZE_X
; i++)

72 *(
wBufD¡
++èð
wBufSrc
[0];

74 
	`memýy
(
wBufD¡
, 
wBufSrc
, 
s
->
size_x
 * (
img³l
));

75 
wBufD¡
 +ð
s
->
size_x
;

77 
i
 = 0; i < 
IMG_PAD_SIZE_X
; i++)

78 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

82 
j
 = 
s
->
size_y
; j < s->size_y+
IMG_PAD_SIZE_Y
; j++)

84 
	`memýy
(
d¡Img
[
j
]-
IMG_PAD_SIZE_X
, d¡Img[j - 1]-IMG_PAD_SIZE_X, 
s
->
size_x_·dded
 * (
img³l
));

86 
	}
}

88 
	$g‘SubImageIÁeg”_s
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImg
)

90 
i
, 
j
;

91 
size_x_mšus1
 = 
s
->
size_x
 - 1;

93 
img³l
 *
wBufSrc
, *
wBufD¡
;

96 
wBufD¡
 = &Ð
d¡Img
[-
IMG_PAD_SIZE_Y
][-
IMG_PAD_SIZE_X
] );

97 
wBufSrc
 = 
¤cImg
[0];

99 
i
 = 0; i < 
IMG_PAD_SIZE_X
; ++i)

100 *(
wBufD¡
++èð
wBufSrc
[0];

102 
	`memýy
(
wBufD¡
, 
wBufSrc
, 
s
->
size_x
 * (
img³l
));

103 
wBufD¡
 +ð
s
->
size_x
;

105 
i
 = 0; i < 
IMG_PAD_SIZE_X
; ++i)

106 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

109 
j
 = -
IMG_PAD_SIZE_Y
+1; j < 1; ++j)

111 
	`memýy
(
d¡Img
[
j
]-
IMG_PAD_SIZE_X
, d¡Img[j - 1]-IMG_PAD_SIZE_X, 
s
->
size_x_·dded
 * (
img³l
));

114 
j
 = 1; j < 
s
->
size_y
; ++j)

116 
wBufD¡
 = &Ð
d¡Img
[
j
][-
IMG_PAD_SIZE_X
] );

117 
wBufSrc
 = 
¤cImg
[
j
];

119 
i
 = 0; i < 
IMG_PAD_SIZE_X
; ++i)

120 *(
wBufD¡
++èð
wBufSrc
[0];

123 
wBufD¡
 +ð
s
->
size_x
;

125 
i
 = 0; i < 
IMG_PAD_SIZE_X
; ++i)

126 *(
wBufD¡
++èð
wBufSrc
[
size_x_mšus1
];

130 
j
 = 
s
->
size_y
; j < s->size_y+
IMG_PAD_SIZE_Y
; ++j)

132 
	`memýy
(
d¡Img
[
j
]-
IMG_PAD_SIZE_X
, d¡Img[j - 1]-IMG_PAD_SIZE_X, 
s
->
size_x_·dded
 * (
img³l
));

134 
	}
}

151 
	$g‘HÜSubImageSixT­
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImg
)

153 
is
, 
j·d
, 
ad
;

154 
y·dded_size
 = 
s
->
size_y_·dded
;

155 
x·dded_size
 = 
s
->
size_x_·dded
;

157 
img³l
 *
wBufSrc
, *
wBufD¡
;

158 
img³l
 *
¤cImgA
, *
¤cImgB
, *
¤cImgC
, *
¤cImgD
, *
¤cImgE
, *
¤cImgF
;

159 *
iBufD¡
;

160 cÚ¡ 
p0
 = 
ONE_FOURTH_TAP
[0][0];

161 cÚ¡ 
p1
 = 
ONE_FOURTH_TAP
[0][1];

162 cÚ¡ 
p2
 = 
ONE_FOURTH_TAP
[0][2];

164 
j·d
 = -
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
-IMG_PAD_SIZE_Y; jpad++)

166 
wBufSrc
 = 
¤cImg
[
j·d
]-
IMG_PAD_SIZE_X
;

167 
wBufD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

168 
iBufD¡
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
]-
IMG_PAD_SIZE_X
;

170 
¤cImgA
 = &
wBufSrc
[0];

171 
¤cImgB
 = &
wBufSrc
[0];

172 
¤cImgC
 = &
wBufSrc
[0];

173 
¤cImgD
 = &
wBufSrc
[1];

174 
¤cImgE
 = &
wBufSrc
[2];

175 
¤cImgF
 = &
wBufSrc
[3];

178 
is
 =

179 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

180 
p1
 * (*
¤cImgB
 + *
¤cImgE
++) +

181 
p2
 * (*
¤cImgC
 + *
¤cImgF
++));

183 *
iBufD¡
++ = 
is
;

184 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

186 
is
 =

187 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

188 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

189 
p2
 * (*
¤cImgC
 + *
¤cImgF
++));

191 *
iBufD¡
++ = 
is
;

192 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

195 
ad
 = 2; i·d < 
x·dded_size
 - 4; ipad++)

197 
is
 =

198 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

199 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

200 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

202 *
iBufD¡
++ = 
is
;

203 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

206 
is
 = (

207 
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

208 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

209 
p2
 * (*
¤cImgC
++ + *
¤cImgF
 ));

211 *
iBufD¡
++ = 
is
;

212 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

215 
is
 = (

216 
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

217 
p1
 * (*
¤cImgB
++ + *
¤cImgE
) +

218 
p2
 * (*
¤cImgC
++ + *
¤cImgF
));

220 *
iBufD¡
++ = 
is
;

221 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

223 
is
 = (

224 
p0
 * (*
¤cImgA
++ + *
¤cImgD
) +

225 
p1
 * (*
¤cImgB
++ + *
¤cImgE
) +

226 
p2
 * (*
¤cImgC
++ + *
¤cImgF
));

228 *
iBufD¡
++ = 
is
;

229 *
wBufD¡
++ = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

231 
is
 = (

232 
p0
 * (*
¤cImgA
 + *
¤cImgD
) +

233 
p1
 * (*
¤cImgB
 + *
¤cImgE
) +

234 
p2
 * (*
¤cImgC
 + *
¤cImgF
));

236 *
iBufD¡
 = 
is
;

237 *
wBufD¡
 = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

240 
	}
}

257 
	$g‘V”SubImageSixT­
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImg
)

259 
is
, 
j·d
, 
ad
;

260 
y·dded_size
 = 
s
->
size_y_·dded
;

261 
x·dded_size
 = 
s
->
size_x_·dded
;

262 
maxy
 = 
y·dded_size
 - 1-
IMG_PAD_SIZE_Y
;

264 
img³l
 *
wxLšeD¡
;

265 
img³l
 *
¤cImgA
, *
¤cImgB
, *
¤cImgC
, *
¤cImgD
, *
¤cImgE
, *
¤cImgF
;

266 cÚ¡ 
p0
 = 
ONE_FOURTH_TAP
[0][0];

267 cÚ¡ 
p1
 = 
ONE_FOURTH_TAP
[0][1];

268 cÚ¡ 
p2
 = 
ONE_FOURTH_TAP
[0][2];

272 
j·d
 = -
IMG_PAD_SIZE_Y
; jpad < 2-IMG_PAD_SIZE_Y; jpad++)

274 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

275 
¤cImgA
 = 
¤cImg
[
j·d
 ]-
IMG_PAD_SIZE_X
;

276 
¤cImgB
 = 
¤cImg
[0-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

277 
¤cImgC
 = 
¤cImg
[0-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

278 
¤cImgD
 = 
¤cImg
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

279 
¤cImgE
 = 
¤cImg
[
j·d
 + 2]-
IMG_PAD_SIZE_X
;

280 
¤cImgF
 = 
¤cImg
[
j·d
 + 3]-
IMG_PAD_SIZE_X
;

281 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

283 
is
 =

284 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

285 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

286 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

288 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 (
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

292 
j·d
 = 2-
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
 - 3-IMG_PAD_SIZE_Y; jpad++)

294 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

295 
¤cImgA
 = 
¤cImg
[
j·d
 ]-
IMG_PAD_SIZE_X
;

296 
¤cImgB
 = 
¤cImg
[
j·d
 - 1]-
IMG_PAD_SIZE_X
;

297 
¤cImgC
 = 
¤cImg
[
j·d
 - 2]-
IMG_PAD_SIZE_X
;

298 
¤cImgD
 = 
¤cImg
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

299 
¤cImgE
 = 
¤cImg
[
j·d
 + 2]-
IMG_PAD_SIZE_X
;

300 
¤cImgF
 = 
¤cImg
[
j·d
 + 3]-
IMG_PAD_SIZE_X
;

301 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

303 
is
 =

304 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

305 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

306 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

308 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

313 
j·d
 = 
y·dded_size
 - 3-
IMG_PAD_SIZE_Y
; jpad < ypadded_size-IMG_PAD_SIZE_Y; jpad++)

315 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

316 
¤cImgA
 = 
¤cImg
[
j·d
 ]-
IMG_PAD_SIZE_X
;

317 
¤cImgB
 = 
¤cImg
[
j·d
 - 1]-
IMG_PAD_SIZE_X
;

318 
¤cImgC
 = 
¤cImg
[
j·d
 - 2]-
IMG_PAD_SIZE_X
;

319 
¤cImgD
 = 
¤cImg
[
	`imš
 (
maxy
, 
j·d
 + 1)]-
IMG_PAD_SIZE_X
;

320 
¤cImgE
 = 
¤cImg
[
maxy
]-
IMG_PAD_SIZE_X
;

321 
¤cImgF
 = 
¤cImg
[
maxy
]-
IMG_PAD_SIZE_X
;

322 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

324 
is
 =

325 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

326 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

327 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

329 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 5 ) );

332 
	}
}

347 
	$g‘V”SubImageSixT­Tmp
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
)

349 
is
, 
j·d
, 
ad
;

350 
y·dded_size
 = 
s
->
size_y_·dded
;

351 
x·dded_size
 = 
s
->
size_x_·dded
;

352 
maxy
 = 
y·dded_size
 - 1-
IMG_PAD_SIZE_Y
;

354 
img³l
 *
wxLšeD¡
;

355 *
¤cImgA
, *
¤cImgB
, *
¤cImgC
, *
¤cImgD
, *
¤cImgE
, *
¤cImgF
;

356 cÚ¡ 
p0
 = 
ONE_FOURTH_TAP
[0][0];

357 cÚ¡ 
p1
 = 
ONE_FOURTH_TAP
[0][1];

358 cÚ¡ 
p2
 = 
ONE_FOURTH_TAP
[0][2];

361 
j·d
 = -
IMG_PAD_SIZE_Y
; jpad < 2-IMG_PAD_SIZE_Y; jpad++)

363 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

364 
¤cImgA
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 ]-
IMG_PAD_SIZE_X
;

365 
¤cImgB
 = 
p_Vid
->
imgY_sub_tmp
[0-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

366 
¤cImgC
 = 
p_Vid
->
imgY_sub_tmp
[0-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

367 
¤cImgD
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

368 
¤cImgE
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 2]-
IMG_PAD_SIZE_X
;

369 
¤cImgF
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 3]-
IMG_PAD_SIZE_X
;

371 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

373 
is
 =

374 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

375 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

376 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

378 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 10 ) );

383 
j·d
 = 2-
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
 - 3-IMG_PAD_SIZE_Y; jpad++)

385 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

386 
¤cImgA
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 ]-
IMG_PAD_SIZE_X
;

387 
¤cImgB
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 - 1]-
IMG_PAD_SIZE_X
;

388 
¤cImgC
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 - 2]-
IMG_PAD_SIZE_X
;

389 
¤cImgD
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

390 
¤cImgE
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 2]-
IMG_PAD_SIZE_X
;

391 
¤cImgF
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 + 3]-
IMG_PAD_SIZE_X
;

392 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

394 
is
 =

395 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

396 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

397 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

399 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 10 ) );

404 
j·d
 = 
y·dded_size
 - 3-
IMG_PAD_SIZE_Y
; jpad < ypadded_size-IMG_PAD_SIZE_Y; jpad++)

406 
wxLšeD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

407 
¤cImgA
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 ]-
IMG_PAD_SIZE_X
;

408 
¤cImgB
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 - 1]-
IMG_PAD_SIZE_X
;

409 
¤cImgC
 = 
p_Vid
->
imgY_sub_tmp
[
j·d
 - 2]-
IMG_PAD_SIZE_X
;

410 
¤cImgD
 = 
p_Vid
->
imgY_sub_tmp
[
	`imš
 (
maxy
, 
j·d
 + 1)]-
IMG_PAD_SIZE_X
;

411 
¤cImgE
 = 
p_Vid
->
imgY_sub_tmp
[
maxy
]-
IMG_PAD_SIZE_X
;

412 
¤cImgF
 = 
p_Vid
->
imgY_sub_tmp
[
maxy
]-
IMG_PAD_SIZE_X
;

413 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

415 
is
 =

416 (
p0
 * (*
¤cImgA
++ + *
¤cImgD
++) +

417 
p1
 * (*
¤cImgB
++ + *
¤cImgE
++) +

418 
p2
 * (*
¤cImgC
++ + *
¤cImgF
++));

420 
wxLšeD¡
[
ad
] = (
img³l
è
	`iCl1
 ( 
p_Vid
->
max_img³l_v®ue
, 
	`rshiá_ºd_sf
Ð
is
, 10 ) );

423 
	}
}

440 
	$g‘SubImageBiLš—r
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImgL
, img³È**
¤cImgR
)

442 
j·d
, 
ad
;

443 
y·dded_size
 = 
s
->
size_y_·dded
;

444 
x·dded_size
 = 
s
->
size_x_·dded
;

446 
img³l
 *
wBufSrcL
, *
wBufSrcR
, *
wBufD¡
;

448 
j·d
 = -
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
-IMG_PAD_SIZE_Y; jpad++)

450 
wBufSrcL
 = 
¤cImgL
[
j·d
]-
IMG_PAD_SIZE_X
;

451 
wBufSrcR
 = 
¤cImgR
[
j·d
]-
IMG_PAD_SIZE_X
;

452 
wBufD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

454 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

456 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
Ð*
wBufSrcL
++ + *
wBufSrcR
++, 1 );

459 
	}
}

477 
	$g‘HÜSubImageBiLš—r
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImgL
, img³È**
¤cImgR
)

479 
j·d
, 
ad
;

480 
y·dded_size
 = 
s
->
size_y_·dded
;

481 
x·dded_size
 = 
s
->
size_x_·dded
 - 1;

483 
img³l
 *
wBufSrcL
, *
wBufSrcR
, *
wBufD¡
;

485 
j·d
 = -
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
-IMG_PAD_SIZE_Y; jpad++)

487 
wBufSrcL
 = 
¤cImgL
[
j·d
]-
IMG_PAD_SIZE_X
;

488 
wBufSrcR
 = &
¤cImgR
[
j·d
][1-
IMG_PAD_SIZE_X
];

489 
wBufD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

492 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

494 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
Ð*
wBufSrcL
++ + *
wBufSrcR
++, 1 );

497 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
Ð*
wBufSrcL
++ + 
wBufSrcR
[-1], 1 );

499 
	}
}

517 
	$g‘V”SubImageBiLš—r
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImgT
, img³È**
¤cImgB
)

519 
j·d
, 
ad
;

520 
y·dded_size
 = 
s
->
size_y_·dded
 - 1;

521 
x·dded_size
 = 
s
->
size_x_·dded
;

523 
img³l
 *
wBufSrcT
, *
wBufSrcB
, *
wBufD¡
;

526 
j·d
 = -
IMG_PAD_SIZE_Y
; j·d < 
y·dded_size
-IMG_PAD_SIZE_Y; jpad++)

528 
wBufSrcT
 = 
¤cImgT
[
j·d
]-
IMG_PAD_SIZE_X
;

529 
wBufD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

530 
wBufSrcB
 = 
¤cImgB
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

532 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

534 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcT
++ + *
wBufSrcB
++, 1);

538 
wBufSrcT
 = 
¤cImgT
[
y·dded_size
-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

539 
wBufD¡
 = 
d¡Img
[
y·dded_size
-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

540 
wBufSrcB
 = 
¤cImgB
[
y·dded_size
-
IMG_PAD_SIZE_Y
]-
IMG_PAD_SIZE_X
;

542 
ad
 = 0; i·d < 
x·dded_size
; ipad++)

544 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcT
++ + *
wBufSrcB
++, 1);

546 
	}
}

564 
	$g‘DŸgSubImageBiLš—r
Ð
StÜabËPiùu»
 *
s
, 
img³l
 **
d¡Img
, img³È**
¤cImgT
, img³È**
¤cImgB
 )

566 
j·d
, 
ad
;

567 
maxx
 = 
s
->
size_x_·dded
 - 1-
IMG_PAD_SIZE_X
;

568 
maxy
 = 
s
->
size_y_·dded
 - 1-
IMG_PAD_SIZE_Y
;

570 
img³l
 *
wBufSrcL
, *
wBufSrcR
, *
wBufD¡
;

572 
j·d
 = -
IMG_PAD_SIZE_Y
; j·d < 
maxy
; jpad++)

574 
wBufSrcL
 = 
¤cImgT
[
j·d
 + 1]-
IMG_PAD_SIZE_X
;

575 
wBufSrcR
 = &
¤cImgB
[
j·d
][1-
IMG_PAD_SIZE_X
];

576 
wBufD¡
 = 
d¡Img
[
j·d
]-
IMG_PAD_SIZE_X
;

578 
ad
 = -
IMG_PAD_SIZE_X
; i·d < 
maxx
; ipad++)

580 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcL
++ + *
wBufSrcR
++, 1);

583 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcL
++ + 
wBufSrcR
[-1], 1);

586 
wBufSrcL
 = 
¤cImgT
[
maxy
]-
IMG_PAD_SIZE_X
;

587 
wBufSrcR
 = &
¤cImgB
[
maxy
][1-
IMG_PAD_SIZE_X
];

588 
wBufD¡
 = 
d¡Img
[
maxy
]-
IMG_PAD_SIZE_X
;

590 
ad
 = -
IMG_PAD_SIZE_X
; i·d < 
maxx
; ipad++)

592 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcL
++ + *
wBufSrcR
++, 1);

595 *
wBufD¡
++ = (
img³l
è
	`rshiá_ºd_sf
(*
wBufSrcL
++ + 
wBufSrcR
[-1], 1);

596 
	}
}

611 
	$g‘SubImagesLuma
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
 )

613 
img³l
 ****
cImgSub
 = 
s
->
p_cu¼_img_sub
;

614 
Ùf_shiá
 = ( 
p_Vid
->
p_IÅ
->
OnTheFlyF¿ùMCP
 =ð
OTF_L1
 ) ? (1) : (0) ;

625 ià(
cImgSub
[0][0][0] !ð
s
->
p_cu¼_img
[0])

627 
	`g‘SubImageIÁeg”
Ð
s
, 
cImgSub
[0][0], s->
p_cu¼_img
);

631 
	`g‘SubImageIÁeg”_s
Ð
s
, 
cImgSub
[0][0], s->
p_cu¼_img
);

638 
	`g‘HÜSubImageSixT­
Ð
p_Vid
, 
s
, 
cImgSub
[0][2>>
Ùf_shiá
], cImgSub[0][0] );

642 
	`g‘V”SubImageSixT­
Ð
p_Vid
, 
s
, 
cImgSub
[2>>
Ùf_shiá
][0], cImgSub[0][0]);

646 
	`g‘V”SubImageSixT­Tmp
Ð
p_Vid
, 
s
, 
cImgSub
[2>>
Ùf_shiá
][2>>otf_shift]);

648 ifÐ!
p_Vid
->
p_IÅ
->
OnTheFlyF¿ùMCP
 )

653 
	`g‘SubImageBiLš—r
 ( 
s
, 
cImgSub
[0][1], cImgSub[0][0], cImgSub[0][2]);

655 
	`g‘SubImageBiLš—r
 ( 
s
, 
cImgSub
[1][0], cImgSub[0][0], cImgSub[2][0]);

657 
	`g‘SubImageBiLš—r
 ( 
s
, 
cImgSub
[1][1], cImgSub[0][2], cImgSub[2][0]);

659 
	`g‘SubImageBiLš—r
 ( 
s
, 
cImgSub
[1][2], cImgSub[0][2], cImgSub[2][2]);

661 
	`g‘SubImageBiLš—r
 ( 
s
, 
cImgSub
[2][1], cImgSub[2][0], cImgSub[2][2]);

664 
	`g‘HÜSubImageBiLš—r
 ( 
s
, 
cImgSub
[0][3], cImgSub[0][2], cImgSub[0][0]);

666 
	`g‘HÜSubImageBiLš—r
 ( 
s
, 
cImgSub
[1][3], cImgSub[0][2], cImgSub[2][0]);

668 
	`g‘HÜSubImageBiLš—r
 ( 
s
, 
cImgSub
[2][3], cImgSub[2][2], cImgSub[2][0]);

671 
	`g‘V”SubImageBiLš—r
 ( 
s
, 
cImgSub
[3][0], cImgSub[2][0], cImgSub[0][0]);

673 
	`g‘V”SubImageBiLš—r
 ( 
s
, 
cImgSub
[3][1], cImgSub[2][0], cImgSub[0][2]);

675 
	`g‘V”SubImageBiLš—r
 ( 
s
, 
cImgSub
[3][2], cImgSub[2][2], cImgSub[0][2]);

678 
	`g‘DŸgSubImageBiLš—r
Ð
s
, 
cImgSub
[3][3], cImgSub[0][2], cImgSub[2][0]);

680 
	}
}

	@lencod/src/intra16x16.c

14 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"mb_acûss.h
"

19 
	~"ŒªsfÜm.h
"

20 
	~"mem®loc.h
"

28 
šlše
 
	$g‘_i16x16_v”tiÿl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

30 
j
;

31 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

32 
	`memýy
(
cur_´ed
[
j
], &
P»dP–
[1], 
MB_BLOCK_SIZE
 * (
img³l
));

33 
	}
}

42 
šlše
 
	$g‘_i16x16_hÜizÚl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

44 
i
, 
j
;

45 
img³l
 *
´ediùiÚ
 = &
P»dP–
[16];

47 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

49 
´ediùiÚ
++;

50 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

52 
cur_´ed
[
j
][
i
] = *
´ediùiÚ
;

55 
	}
}

63 
šlše
 
	$g‘_i16x16_dc
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
)

65 
i
, 
j
, 
s0
 = 0, 
s1
 = 0, 
s2
 = 0;

67 ià(
up_avažabË
)

69 
i
 = 1; i < 
MB_BLOCK_SIZE
 + 1; ++i)

70 
s1
 +ð
P»dP–
[
i
];

73 ià(
Ëá_avažabË
)

75 
i
 = 17; i < 33; ++i)

76 
s2
 +ð
P»dP–
[
i
];

79 ià(
up_avažabË
)

81 
s0
 = 
Ëá_avažabË


82 ? 
	`rshiá_ºd_sf
((
s1
 + 
s2
),(
MB_BLOCK_SHIFT
 + 1))

83 : 
	`rshiá_ºd_sf
(
s1
, 
MB_BLOCK_SHIFT
);

87 
s0
 = 
Ëá_avažabË


88 ? 
	`rshiá_ºd_sf
(
s2
, 
MB_BLOCK_SHIFT
)

89 : 
P»dP–
[1];

92 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

94 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

95 
cur_´ed
[
j
][
i
] = (
img³l
è
s0
;

97 
	}
}

105 
šlše
 
	$g‘_i16x16_¶ªe
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
max_img³l_v®ue
)

107 
i
, 
j
;

109 
ih
=0, 
iv
=0;

110 
ib
, 
ic
, 
Ÿa
;

111 
img³l
 *
t_´ed
 = &
P»dP–
[25];

112 
img³l
 *
u_´ed
 = &
P»dP–
[8];

113 
img³l
 *
b_´ed
 = &
P»dP–
[23];

115 
i
 = 1; i < 8;++i)

117 
ih
 +ð
i
*(*(
u_´ed
 + i) - *(u_pred - i));

118 
iv
 +ð
i
*(*
t_´ed
++ - *
b_´ed
--);

120 
ih
 +ð8 * (*(
u_´ed
 + 8è- 
P»dP–
[0]);

121 
iv
 +ð8 * (*
t_´ed
++ - 
P»dP–
[0]);

123 
ib
 = (5 * 
ih
 + 32) >> 6;

124 
ic
 = (5 * 
iv
 + 32) >> 6;

126 
Ÿa
=16 * (
P»dP–
[16] + PredPel[32]);

128 
j
=0;j< 
MB_BLOCK_SIZE
;++j)

130 
i
=0;i< 
MB_BLOCK_SIZE
;++i)

132 
cur_´ed
[
j
][
i
]ð(
img³l
è
	`iCl1
Ð
max_img³l_v®ue
, 
	`rshiá_ºd_sf
((
Ÿa
 + (˜- 7è* 
ib
 + (j - 7è* 
ic
), 5));

135 
	}
}

148 
	$£t_šŒ­»d_16x16
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

150 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

151 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

153 
i
;

154 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa16x16_´ed
[
¶
];

155 
img³l
 **
img_’c
 = (
cu¼MB
->
p_Sliû
->
P444_jošed
)? 
p_Vid
->
’c_piùu»
->
p_img
[
¶
]:…_Vid->’c_piùu»->
p_cu¼_img
;

157 
Pix–Pos
 
pix_b
;

158 
Pix–Pos
 
pix_a
;

159 
Pix–Pos
 
pix_d
;

161 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

163 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, -1, 
mb_size
, &
pix_d
);

164 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 0, 
mb_size
, &
pix_a
);

165 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1, 
mb_size
, &
pix_b
);

167 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 == 0)

169 *
up_avažabË
 = 
pix_b
.
avažabË
;

170 *
Ëá_avažabË
 = 
pix_a
.
avažabË
;

171 *
®l_avažabË
 = 
pix_d
.
avažabË
;

175 *
up_avažabË
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

176 *
Ëá_avažabË
 = 
pix_a
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a.
mb_addr
] : 0;

177 *
®l_avažabË
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_d.
mb_addr
] : 0;

181 ià(*
up_avažabË
)

183 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
MB_BLOCK_SIZE
 * (
img³l
));

187 
i
 = 1; i < 17; ++i)

188 
P»dP–
[
i
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

191 ià(*
Ëá_avažabË
)

193 
pos_y
 = 
pix_a
.pos_y;

194 
pos_x
 = 
pix_a
.pos_x;

196 
i
 = 1; i < 
MB_BLOCK_SIZE
 + 1; ++i)

197 
P»dP–
[
i
 + 16] = 
img_’c
[
pos_y
++][
pos_x
];

201 
i
 = 17; i < 33; ++i)

202 
P»dP–
[
i
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

205 ià(*
®l_avažabË
)

207 
P»dP–
[0] = 
img_’c
[
pix_d
.
pos_y
][pix_d.
pos_x
];

211 
P»dP–
[0] = 
p_Vid
->
dc_´ed_v®ue
;

213 
	}
}

227 
	$£t_šŒ­»d_16x16_mbaff
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

229 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

230 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

232 
i
;

233 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa16x16_´ed
[
¶
];

234 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

236 
Pix–Pos
 
pix_b
;

237 
Pix–Pos
 
pix_a
[17];

239 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

241 
i
 = 0; i < 17; ++i)

243 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 
i
 - 1, 
mb_size
, &
pix_a
[i]);

246 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1, 
mb_size
, &
pix_b
);

248 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 == 0)

250 *
up_avažabË
 = 
pix_b
.
avažabË
;

251 *
Ëá_avažabË
 = 
pix_a
[1].
avažabË
;

252 *
®l_avažabË
 = 
pix_a
[0].
avažabË
;

256 *
up_avažabË
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

257 
i
=1, *
Ëá_avažabË
=1; i<17;++i)

258 *
Ëá_avažabË
 &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

259 *
®l_avažabË
 = 
pix_a
[0].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[0].
mb_addr
]: 0;

263 ià(*
up_avažabË
)

265 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
MB_BLOCK_SIZE
 * (
img³l
));

269 
i
 = 1; i < 17; ++i)

270 
P»dP–
[
i
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

273 ià(*
Ëá_avažabË
)

275 
i
 = 1; i < 
MB_BLOCK_SIZE
 + 1; ++i)

276 
P»dP–
[
i
 + 16] = 
img_’c
[
pix_a
[i].
pos_y
][pix_a[i].
pos_x
];

280 
i
 = 17; i < 33; ++i)

281 
P»dP–
[
i
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

284 ià(*
®l_avažabË
)

286 
P»dP–
[0] = 
img_’c
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
];

290 
P»dP–
[0] = 
p_Vid
->
dc_´ed_v®ue
;

292 
	}
}

307 
	$g‘_šŒ­»d_16x16
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i16x16_mode
, 
Ëá_avažabË
, 
up_avažabË
)

309 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa16x16_´ed
[
¶
];

310 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼MB
->
p_Sliû
->
m´_16x16
[
¶
];

312 
i16x16_mode
)

314 
VERT_PRED_16
 :

315 
	`g‘_i16x16_v”tiÿl
(
cu¼_m´_16x16
[
VERT_PRED_16
], 
P»dP–
);

317 
HOR_PRED_16
 :

318 
	`g‘_i16x16_hÜizÚl
(
cu¼_m´_16x16
[
HOR_PRED_16
], 
P»dP–
);

320 
DC_PRED_16
 :

321 
	`g‘_i16x16_dc
(
cu¼_m´_16x16
[
DC_PRED_16
], 
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
);

323 
PLANE_16
 :

324 
	`g‘_i16x16_¶ªe
(
cu¼_m´_16x16
[
PLANE_16
], 
P»dP–
, 
cu¼MB
->
p_Vid
->
max_img³l_v®ue
);

327 
	`´štf
("invalid…rediction mode \n");

330 
	}
}

332 
di¡blk
 
	$di¡I16x16_§td
(
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, 
di¡blk
 
mš_co¡
)

334 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

335 **
M7
 = 
NULL
;

336 **
tblk4x4
 = 
cu¼Sliû
->tblk4x4;

337 ****
i16blk4x4
 = 
cu¼Sliû
->i16blk4x4;

338 
img³l
 *
cur_img
, *
´d_img
;

339 
di¡blk
 
cu¼’t_šŒa_§d_2
 = 0;

340 
ii
, 
jj
, 
i
, 
j
, 
i32Co¡
 = 0;

341 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

343 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

345 
cur_img
 = &
img_Üg
[
cu¼MB
->
Ýix_y
 + 
j
][cu¼MB->
pix_x
];

346 
´d_img
 = 
´ed_img
[
j
];

347 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

349 
i16blk4x4
[
j
 >> 2][
i
 >> 2][j & 0x03][˜& 0x03] = 
cur_img
[i] - 
´d_img
[i];

353 
jj
 = 0; jj < 4; jj++)

355 
ii
 = 0; ii < 4;ii++)

357 
M7
 = 
i16blk4x4
[
jj
][
ii
];

358 
	`hadam¬d4x4
(
M7
, M7);

359 
i32Co¡
 +ð
	`Ÿbs
(
M7
[0][1]);

360 
i32Co¡
 +ð
	`Ÿbs
(
M7
[0][2]);

361 
i32Co¡
 +ð
	`Ÿbs
(
M7
[0][3]);

363 ià(
i32Co¡
 > 
imš_co¡
)

364  (
mš_co¡
);

366 
j
 = 1; j < 4; j++)

369 
i32Co¡
 +ð
	`Ÿbs
(
M7
[
j
][0]);

370 
i32Co¡
 +ð
	`Ÿbs
(
M7
[
j
][1]);

371 
i32Co¡
 +ð
	`Ÿbs
(
M7
[
j
][2]);

372 
i32Co¡
 +ð
	`Ÿbs
(
M7
[
j
][3]);

374 ià(
i32Co¡
 > 
imš_co¡
)

375  (
mš_co¡
);

380 
j
 = 0; j < 4;j++)

382 
tblk4x4
[
j
][0] = (
i16blk4x4
[j][0][0][0] >> 1);

383 
tblk4x4
[
j
][1] = (
i16blk4x4
[j][1][0][0] >> 1);

384 
tblk4x4
[
j
][2] = (
i16blk4x4
[j][2][0][0] >> 1);

385 
tblk4x4
[
j
][3] = (
i16blk4x4
[j][3][0][0] >> 1);

389 
	`hadam¬d4x4
(
tblk4x4
,blk4x4);

391 
j
 = 0; j < 4; j++)

393 
i32Co¡
 +ð
	`Ÿbs
(
tblk4x4
[
j
][0]);

394 
i32Co¡
 +ð
	`Ÿbs
(
tblk4x4
[
j
][1]);

395 
i32Co¡
 +ð
	`Ÿbs
(
tblk4x4
[
j
][2]);

396 
i32Co¡
 +ð
	`Ÿbs
(
tblk4x4
[
j
][3]);

398 ià(
i32Co¡
 > 
imš_co¡
)

399  (
mš_co¡
);

402 
cu¼’t_šŒa_§d_2
 +ð(
	`di¡_sÿË
((
di¡blk
)
i32Co¡
));

403  
cu¼’t_šŒa_§d_2
;

404 
	}
}

406 
di¡blk
 
	$di¡I16x16_§d
(
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, 
di¡blk
 
mš_co¡
)

408 
img³l
 *
cur_img
, *
´d_img
;

409 
i32Co¡
 = 0;

410 
i
, 
j
;

411 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

413 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

415 
cur_img
 = &
img_Üg
[
cu¼MB
->
Ýix_y
 + 
j
][cu¼MB->
pix_x
];

416 
´d_img
 = 
´ed_img
[
j
];

417 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

419 
i32Co¡
 +ð
	`Ÿbs
Ð*
cur_img
++ - *
´d_img
++ );

422 ià(
i32Co¡
 > 
imš_co¡
)

423  (
mš_co¡
);

426  (
	`di¡_sÿË
((
di¡blk
è
i32Co¡
));

427 
	}
}

429 
di¡blk
 
	$di¡I16x16_s£
(
Maüoblock
 *
cu¼MB
, 
img³l
 **
img_Üg
, img³È**
´ed_img
, 
di¡blk
 
mš_co¡
)

431 
img³l
 *
cur_img
, *
´d_img
;

432 
i
, 
j
, 
i32Co¡
 = 0;

433 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

435 
j
 = 0; j < 
MB_BLOCK_SIZE
;j++)

437 
cur_img
 = &
img_Üg
[
cu¼MB
->
Ýix_y
 + 
j
][cu¼MB->
pix_x
];

438 
´d_img
 = 
´ed_img
[
j
];

439 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

441 
i32Co¡
 +ð
	`Ÿbs2
Ð*
cur_img
++ - *
´d_img
++ );

444 ià(
i32Co¡
 > 
imš_co¡
)

445  (
mš_co¡
);

448  (
	`di¡_sÿË
((
di¡blk
è
i32Co¡
));

449 
	}
}

463 
di¡blk
 
	$fšd_§d_16x16_JM
(
Maüoblock
 *
cu¼MB
)

465 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

466 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

467 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

468 
di¡blk
 
cu¼’t_šŒa_§d_2
, 
be¡_šŒa_§d2
 = 
DISTBLK_MAX
;

469 
k
;

470 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[0];

472 
up_avaž
, 
Ëá_avaž
, 
Ëá_up_avaž
;

474 
cu¼MB
->
i16mode
 = 
DC_PRED_16
;

476 
cu¼Sliû
->
	`£t_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_Y
, &
Ëá_avaž
, &
up_avaž
, &
Ëá_up_avaž
);

478 ià(
cu¼Sliû
->
P444_jošed
)

480 
cu¼Sliû
->
	`£t_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_U
, &
Ëá_avaž
, &
up_avaž
, &
Ëá_up_avaž
);

481 
cu¼Sliû
->
	`£t_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_V
, &
Ëá_avaž
, &
up_avaž
, &
Ëá_up_avaž
);

484 
k
 = 
VERT_PRED_16
; k <ð
PLANE_16
; k++)

486 ià(
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
 =ð0 || (
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
) )

488 ià(
p_IÅ
->
IÁ¿16x16P¬Di§bË
 && (
k
 =ð
VERT_PRED_16
||k =ð
HOR_PRED_16
))

491 ià(
p_IÅ
->
IÁ¿16x16PÏÃDi§bË
 && 
k
 =ð
PLANE_16
)

495 ià(!((
k
 =ð
VERT_PRED_16
 && !
up_avaž
è|| (k =ð
HOR_PRED_16
 && !
Ëá_avaž
è|| (k =ð
PLANE_16
 && (!Ëá_avaž || !up_avaž || !
Ëá_up_avaž
))))

497 
	`g‘_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_Y
, 
k
, 
Ëá_avaž
, 
up_avaž
);

498 
cu¼’t_šŒa_§d_2
 = 
cu¼Sliû
->
	`di¡I16x16
(
cu¼MB
, 
p_Vid
->
pCurImg
, 
cu¼_m´_16x16
[
k
], 
be¡_šŒa_§d2
);

499 ià(
cu¼Sliû
->
P444_jošed
)

501 
	`g‘_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_U
, 
k
, 
Ëá_avaž
, 
up_avaž
);

502 
cu¼’t_šŒa_§d_2
 +ð
cu¼Sliû
->
	`di¡I16x16
(
cu¼MB
, 
p_Vid
->
pImgOrg
[1], cu¼Sliû->
m´_16x16
[1][
k
], 
be¡_šŒa_§d2
);

503 
	`g‘_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_V
, 
k
, 
Ëá_avaž
, 
up_avaž
);

504 
cu¼’t_šŒa_§d_2
 +ð
cu¼Sliû
->
	`di¡I16x16
(
cu¼MB
, 
p_Vid
->
pImgOrg
[2], cu¼Sliû->
m´_16x16
[2][
k
], 
be¡_šŒa_§d2
);

507 ià(
cu¼’t_šŒa_§d_2
 < 
be¡_šŒa_§d2
)

509 
be¡_šŒa_§d2
 = 
cu¼’t_šŒa_§d_2
;

510 
cu¼MB
->
i16mode
 = (è
k
;

515  
be¡_šŒa_§d2
;

516 
	}
}

	@lencod/src/intra4x4.c

15 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"image.h
"

19 
	~"mb_acûss.h
"

21 
	$g’”©e_´ed_”rÜ_4x4
(
img³l
 **
cur_img
, img³È**
´d_img
, img³È**
cur_´d
, **
m7
, 
pic_Ýix_x
, 
block_x
)

23 
j
, 
i
, *
m7_lše
;

24 
img³l
 *
cur_lše
, *
´d_lše
;

26 
j
 = 0; j < 
BLOCK_SIZE
; j++)

28 
m7_lše
 = &
m7
[
j
][
block_x
];

29 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

30 
´d_lše
 = 
´d_img
[
j
];

31 
	`memýy
(&
cur_´d
[
j
][
block_x
], 
´d_lše
, 
BLOCK_SIZE
 * (
img³l
));

33 
i
 = 0; i < 
BLOCK_SIZE
; i++)

35 *
m7_lše
++ = (è(*
cur_lše
++ - *
´d_lše
++);

38 
	}
}

52 
	#P_X
 (
P»dP–
[0])

	)

53 
	#P_A
 (
P»dP–
[1])

	)

54 
	#P_B
 (
P»dP–
[2])

	)

55 
	#P_C
 (
P»dP–
[3])

	)

56 
	#P_D
 (
P»dP–
[4])

	)

57 
	#P_E
 (
P»dP–
[5])

	)

58 
	#P_F
 (
P»dP–
[6])

	)

59 
	#P_G
 (
P»dP–
[7])

	)

60 
	#P_H
 (
P»dP–
[8])

	)

61 
	#P_I
 (
P»dP–
[9])

	)

62 
	#P_J
 (
P»dP–
[10])

	)

63 
	#P_K
 (
P»dP–
[11])

	)

64 
	#P_L
 (
P»dP–
[12])

	)

72 
šlše
 
	$g‘_i4x4_v”tiÿl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

74 
	`memýy
(
cur_´ed
[0], &
P»dP–
[1], 
BLOCK_SIZE
 * (
img³l
));

75 
	`memýy
(
cur_´ed
[1], &
P»dP–
[1], 
BLOCK_SIZE
 * (
img³l
));

76 
	`memýy
(
cur_´ed
[2], &
P»dP–
[1], 
BLOCK_SIZE
 * (
img³l
));

77 
	`memýy
(
cur_´ed
[3], &
P»dP–
[1], 
BLOCK_SIZE
 * (
img³l
));

78 
	}
}

86 
šlše
 
	$g‘_i4x4_hÜizÚl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

88 
i
;

90 
i
=0; i < 
BLOCK_SIZE
; i++)

92 
cur_´ed
[
i
][0] =

93 
cur_´ed
[
i
][1] =

94 
cur_´ed
[
i
][2] =

95 
cur_´ed
[
i
][3] = (
img³l
è(&
P_I
)[i];

97 
	}
}

105 
šlše
 
	$g‘_i4x4_dc
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
)

107 
i
, 
j
, 
s0
 = 0;

108 ià(
up_avažabË
 && 
Ëá_avažabË
)

111 
s0
 = (
P_A
 + 
P_B
 + 
P_C
 + 
P_D
 + 
P_I
 + 
P_J
 + 
P_K
 + 
P_L
 + 4è>> (
BLOCK_SHIFT
 + 1);

113 ià(!
up_avažabË
 && 
Ëá_avažabË
)

116 
s0
 = (
P_I
 + 
P_J
 + 
P_K
 + 
P_L
 + 2è>> 
BLOCK_SHIFT
;;

118 ià(
up_avažabË
 && !
Ëá_avažabË
)

121 
s0
 = (
P_A
 + 
P_B
 + 
P_C
 + 
P_D
 + 2è>> 
BLOCK_SHIFT
;

126 
s0
 = 
P_A
;

129 
j
=0; j < 
BLOCK_SIZE
; j++)

131 
i
=0; i < 
BLOCK_SIZE
; i++)

132 
cur_´ed
[
j
][
i
] = (
img³l
è
s0
;

134 
	}
}

142 
šlše
 
	$g‘_i4x4_dowÆeá
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

144 
cur_´ed
[0][0] = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

145 
cur_´ed
[0][1] =

146 
cur_´ed
[1][0] = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

147 
cur_´ed
[0][2] =

148 
cur_´ed
[1][1] =

149 
cur_´ed
[2][0] = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

150 
cur_´ed
[0][3] =

151 
cur_´ed
[1][2] =

152 
cur_´ed
[2][1] =

153 
cur_´ed
[3][0] = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

154 
cur_´ed
[1][3] =

155 
cur_´ed
[2][2] =

156 
cur_´ed
[3][1] = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
)<<1) + 2) >> 2);

157 
cur_´ed
[2][3] =

158 
cur_´ed
[3][2] = (
img³l
è((
P_F
 + 
P_H
 + ((
P_G
)<<1) + 2) >> 2);

159 
cur_´ed
[3][3] = (
img³l
è((
P_G
 + 3*(
P_H
) + 2) >> 2);

160 
	}
}

168 
šlše
 
	$g‘_i4x4_dowÄight
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

170 
cur_´ed
[3][0] = (
img³l
è((
P_L
 + 2*
P_K
 + 
P_J
 + 2) >> 2);

171 
cur_´ed
[2][0] =

172 
cur_´ed
[3][1] = (
img³l
è((
P_K
 + 2*
P_J
 + 
P_I
 + 2) >> 2);

173 
cur_´ed
[1][0] =

174 
cur_´ed
[2][1] =

175 
cur_´ed
[3][2] = (
img³l
è((
P_J
 + 2*
P_I
 + 
P_X
 + 2) >> 2);

176 
cur_´ed
[0][0] =

177 
cur_´ed
[1][1] =

178 
cur_´ed
[2][2] =

179 
cur_´ed
[3][3] = (
img³l
è((
P_I
 + 2*
P_X
 + 
P_A
 + 2) >> 2);

180 
cur_´ed
[0][1] =

181 
cur_´ed
[1][2] =

182 
cur_´ed
[2][3] = (
img³l
è((
P_X
 + 2*
P_A
 + 
P_B
 + 2) >> 2);

183 
cur_´ed
[0][2] =

184 
cur_´ed
[1][3] = (
img³l
è((
P_A
 + 2*
P_B
 + 
P_C
 + 2) >> 2);

185 
cur_´ed
[0][3] = (
img³l
è((
P_B
 + 2*
P_C
 + 
P_D
 + 2) >> 2);

186 
	}
}

195 
šlše
 
	$g‘_i4x4_v”Žeá
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

197 
cur_´ed
[0][0] = (
img³l
è((
P_A
 + 
P_B
 + 1) >> 1);

198 
cur_´ed
[0][1] =

199 
cur_´ed
[2][0] = (
img³l
è((
P_B
 + 
P_C
 + 1) >> 1);

200 
cur_´ed
[0][2] =

201 
cur_´ed
[2][1] = (
img³l
è((
P_C
 + 
P_D
 + 1) >> 1);

202 
cur_´ed
[0][3] =

203 
cur_´ed
[2][2] = (
img³l
è((
P_D
 + 
P_E
 + 1) >> 1);

204 
cur_´ed
[2][3] = (
img³l
è((
P_E
 + 
P_F
 + 1) >> 1);

205 
cur_´ed
[1][0] = (
img³l
è((
P_A
 + ((
P_B
)<<1è+ 
P_C
 + 2) >> 2);

206 
cur_´ed
[1][1] =

207 
cur_´ed
[3][0] = (
img³l
è((
P_B
 + ((
P_C
)<<1è+ 
P_D
 + 2) >> 2);

208 
cur_´ed
[1][2] =

209 
cur_´ed
[3][1] = (
img³l
è((
P_C
 + ((
P_D
)<<1è+ 
P_E
 + 2) >> 2);

210 
cur_´ed
[1][3] =

211 
cur_´ed
[3][2] = (
img³l
è((
P_D
 + ((
P_E
)<<1è+ 
P_F
 + 2) >> 2);

212 
cur_´ed
[3][3] = (
img³l
è((
P_E
 + ((
P_F
)<<1è+ 
P_G
 + 2) >> 2);

213 
	}
}

221 
šlše
 
	$g‘_i4x4_v”Œight
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

223 
cur_´ed
[0][0] =

224 
cur_´ed
[2][1] = (
img³l
è((
P_X
 + 
P_A
 + 1) >> 1);

225 
cur_´ed
[0][1] =

226 
cur_´ed
[2][2] = (
img³l
è((
P_A
 + 
P_B
 + 1) >> 1);

227 
cur_´ed
[0][2] =

228 
cur_´ed
[2][3] = (
img³l
è((
P_B
 + 
P_C
 + 1) >> 1);

229 
cur_´ed
[0][3] = (
img³l
è((
P_C
 + 
P_D
 + 1) >> 1);

230 
cur_´ed
[1][0] =

231 
cur_´ed
[3][1] = (
img³l
è((
P_I
 + 2*
P_X
 + 
P_A
 + 2) >> 2);

232 
cur_´ed
[1][1] =

233 
cur_´ed
[3][2] = (
img³l
è((
P_X
 + 2*
P_A
 + 
P_B
 + 2) >> 2);

234 
cur_´ed
[1][2] =

235 
cur_´ed
[3][3] = (
img³l
è((
P_A
 + 2*
P_B
 + 
P_C
 + 2) >> 2);

236 
cur_´ed
[1][3] = (
img³l
è((
P_B
 + 2*
P_C
 + 
P_D
 + 2) >> 2);

237 
cur_´ed
[2][0] = (
img³l
è((
P_X
 + 2*
P_I
 + 
P_J
 + 2) >> 2);

238 
cur_´ed
[3][0] = (
img³l
è((
P_I
 + 2*
P_J
 + 
P_K
 + 2) >> 2);

239 
	}
}

247 
šlše
 
	$g‘_i4x4_hÜdown
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

249 
cur_´ed
[0][0] =

250 
cur_´ed
[1][2] = (
img³l
è((
P_X
 + 
P_I
 + 1) >> 1);

251 
cur_´ed
[0][1] =

252 
cur_´ed
[1][3] = (
img³l
è((
P_I
 + 2*
P_X
 + 
P_A
 + 2) >> 2);

253 
cur_´ed
[0][2] = (
img³l
è((
P_X
 + 2*
P_A
 + 
P_B
 + 2) >> 2);

254 
cur_´ed
[0][3] = (
img³l
è((
P_A
 + 2*
P_B
 + 
P_C
 + 2) >> 2);

255 
cur_´ed
[1][0] =

256 
cur_´ed
[2][2] = (
img³l
è((
P_I
 + 
P_J
 + 1) >> 1);

257 
cur_´ed
[1][1] =

258 
cur_´ed
[2][3] = (
img³l
è((
P_X
 + 2*
P_I
 + 
P_J
 + 2) >> 2);

259 
cur_´ed
[2][0] =

260 
cur_´ed
[3][2] = (
img³l
è((
P_J
 + 
P_K
 + 1) >> 1);

261 
cur_´ed
[2][1] =

262 
cur_´ed
[3][3] = (
img³l
è((
P_I
 + 2*
P_J
 + 
P_K
 + 2) >> 2);

263 
cur_´ed
[3][0] = (
img³l
è((
P_K
 + 
P_L
 + 1) >> 1);

264 
cur_´ed
[3][1] = (
img³l
è((
P_J
 + 2*
P_K
 + 
P_L
 + 2) >> 2);

265 
	}
}

274 
šlše
 
	$g‘_i4x4_hÜup
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

276 
cur_´ed
[0][0] = (
img³l
è((
P_I
 + 
P_J
 + 1) >> 1);

277 
cur_´ed
[0][1] = (
img³l
è((
P_I
 + 2*
P_J
 + 
P_K
 + 2) >> 2);

278 
cur_´ed
[0][2] =

279 
cur_´ed
[1][0] = (
img³l
è((
P_J
 + 
P_K
 + 1) >> 1);

280 
cur_´ed
[0][3] =

281 
cur_´ed
[1][1] = (
img³l
è((
P_J
 + 2*
P_K
 + 
P_L
 + 2) >> 2);

282 
cur_´ed
[1][2] =

283 
cur_´ed
[2][0] = (
img³l
è((
P_K
 + 
P_L
 + 1) >> 1);

284 
cur_´ed
[1][3] =

285 
cur_´ed
[2][1] = (
img³l
è((
P_K
 + 2*
P_L
 + P_L + 2) >> 2);

286 
cur_´ed
[3][0] =

287 
cur_´ed
[2][2] =

288 
cur_´ed
[2][3] =

289 
cur_´ed
[3][1] =

290 
cur_´ed
[3][2] =

291 
cur_´ed
[3][3] = (
img³l
è
P_L
;

292 
	}
}

310 
	$£t_šŒ­»d_4x4_mbaff
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

312 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

313 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

315 
i
;

316 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa4x4_´ed
[
¶
];

317 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

319 
ioff
 = (
img_x
 & 15);

320 
joff
 = (
img_y
 & 15);

322 
Pix–Pos
 
pix_a
[4];

323 
Pix–Pos
 
pix_b
, 
pix_c
, 
pix_d
;

325 
block_avažabË_up
;

326 
block_avažabË_Ëá
;

327 
block_avažabË_up_Ëá
;

328 
block_avažabË_up_right
;

329 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

331 
i
 = 0; i < 4; i++)

333 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 -1 , 
joff
 + 
i
 , 
mb_size
, &
pix_a
[i]);

336 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 , 
joff
 -1 , 
mb_size
, &
pix_b
);

337 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 + 4 , 
joff
 -1 , 
mb_size
, &
pix_c
);

338 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1 , 
joff
 -1 , 
mb_size
, &
pix_d
);

340 
pix_c
.
avažabË
 =…ix_c.avažabË && !((
ioff
==4è&& ((
joff
==4)||(joff==12)));

342 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

344 
i
=0, 
block_avažabË_Ëá
=1; i<4;i++)

345 
block_avažabË_Ëá
 &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

346 
block_avažabË_up
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_b.
mb_addr
] : 0;

347 
block_avažabË_up_right
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_c.
mb_addr
] : 0;

348 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_d.
mb_addr
] : 0;

352 
block_avažabË_Ëá
 = 
pix_a
[0].
avažabË
;

353 
block_avažabË_up
 = 
pix_b
.
avažabË
;

354 
block_avažabË_up_right
 = 
pix_c
.
avažabË
;

355 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
;

358 *
Ëá_avažabË
 = 
block_avažabË_Ëá
;

359 *
up_avažabË
 = 
block_avažabË_up
;

360 *
®l_avažabË
 = 
block_avažabË_up
 && 
block_avažabË_Ëá
 && 
block_avažabË_up_Ëá
;

362 
i
 = (
img_x
 & 15);

365 ià(
block_avažabË_up
)

367 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
BLOCK_SIZE
 * (
img³l
));

371 
P_A
 = 
P_B
 = 
P_C
 = 
P_D
 = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

374 ià(
block_avažabË_up_right
)

376 
	`memýy
(&
P»dP–
[5], &
img_’c
[
pix_c
.
pos_y
][pix_c.
pos_x
], 
BLOCK_SIZE
 * (
img³l
));

380 
P_E
 = 
P_F
 = 
P_G
 = 
P_H
 = 
P_D
;

383 ià(
block_avažabË_Ëá
)

385 
P_I
 = 
img_’c
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
];

386 
P_J
 = 
img_’c
[
pix_a
[1].
pos_y
][pix_a[1].
pos_x
];

387 
P_K
 = 
img_’c
[
pix_a
[2].
pos_y
][pix_a[2].
pos_x
];

388 
P_L
 = 
img_’c
[
pix_a
[3].
pos_y
][pix_a[3].
pos_x
];

392 
P_I
 = 
P_J
 = 
P_K
 = 
P_L
 = 
p_Vid
->
dc_´ed_v®ue
;

395 ià(
block_avažabË_up_Ëá
)

397 
P_X
 = 
img_’c
[
pix_d
.
pos_y
][pix_d.
pos_x
];

401 
P_X
 = 
p_Vid
->
dc_´ed_v®ue
;

403 
	}
}

421 
	$£t_šŒ­»d_4x4
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

423 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

424 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

426 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa4x4_´ed
[
¶
];

427 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

429 
ioff
 = (
img_x
 & 15);

430 
joff
 = (
img_y
 & 15);

432 
Pix–Pos
 
pix_a
, 
pix_b
, 
pix_c
, 
pix_d
;

434 
block_avažabË_up
;

435 
block_avažabË_Ëá
;

436 
block_avažabË_up_Ëá
;

437 
block_avažabË_up_right
;

438 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

440 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 , 
mb_size
, &
pix_a
);

441 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 , 
joff
 - 1, 
mb_size
, &
pix_b
);

442 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 + 4, 
joff
 - 1, 
mb_size
, &
pix_c
);

443 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 - 1, 
mb_size
, &
pix_d
);

445 
pix_c
.
avažabË
 =…ix_c.avažabË && !((
ioff
==4è&& ((
joff
==4)||(joff==12)));

447 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

449 
block_avažabË_Ëá
 = 
pix_a
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_a.
mb_addr
]: 0;

450 
block_avažabË_up
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_b.
mb_addr
] : 0;

451 
block_avažabË_up_right
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_c.
mb_addr
] : 0;

452 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_d.
mb_addr
] : 0;

456 
block_avažabË_Ëá
 = 
pix_a
.
avažabË
;

457 
block_avažabË_up
 = 
pix_b
.
avažabË
;

458 
block_avažabË_up_right
 = 
pix_c
.
avažabË
;

459 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
;

462 *
Ëá_avažabË
 = 
block_avažabË_Ëá
;

463 *
up_avažabË
 = 
block_avažabË_up
;

464 *
®l_avažabË
 = 
block_avažabË_up
 && 
block_avažabË_Ëá
 && 
block_avažabË_up_Ëá
;

467 ià(
block_avažabË_up
)

469 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
BLOCK_SIZE
 * (
img³l
));

473 
P_A
 = 
P_B
 = 
P_C
 = 
P_D
 = (
img³l
è
p_Vid
->
dc_´ed_v®ue
;

476 ià(
block_avažabË_up_right
)

478 
	`memýy
(&
P»dP–
[5], &
img_’c
[
pix_c
.
pos_y
][pix_c.
pos_x
], 
BLOCK_SIZE
 * (
img³l
));

482 
P_E
 = 
P_F
 = 
P_G
 = 
P_H
 = 
P_D
;

485 ià(
block_avažabË_Ëá
)

487 
pos_y
 = 
pix_a
.pos_y;

488 
pos_x
 = 
pix_a
.pos_x;

489 
P_I
 = 
img_’c
[
pos_y
++][
pos_x
];

490 
P_J
 = 
img_’c
[
pos_y
++][
pos_x
];

491 
P_K
 = 
img_’c
[
pos_y
++][
pos_x
];

492 
P_L
 = 
img_’c
[
pos_y
 ][
pos_x
];

496 
P_I
 = 
P_J
 = 
P_K
 = 
P_L
 = 
p_Vid
->
dc_´ed_v®ue
;

499 ià(
block_avažabË_up_Ëá
)

501 
P_X
 = 
img_’c
[
pix_d
.
pos_y
][pix_d.
pos_x
];

505 
P_X
 = 
p_Vid
->
dc_´ed_v®ue
;

507 
	}
}

521 
	$g‘_šŒ­»d_4x4
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i4x4_mode
, 
img_x
, 
img_y
, 
Ëá_avažabË
, 
up_avažabË
)

523 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa4x4_´ed
[
¶
];

524 
img³l
 ***
cu¼_m´_4x4
 = 
cu¼MB
->
p_Sliû
->
m´_4x4
[
¶
];

528 
i4x4_mode
)

530 
VERT_PRED
 :

531 
	`g‘_i4x4_v”tiÿl
(
cu¼_m´_4x4
[
VERT_PRED
], 
P»dP–
);

533 
HOR_PRED
 :

534 
	`g‘_i4x4_hÜizÚl
(
cu¼_m´_4x4
[
HOR_PRED
], 
P»dP–
);

536 
DC_PRED
 :

537 
	`g‘_i4x4_dc
(
cu¼_m´_4x4
[
DC_PRED
], 
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
);

539 
DIAG_DOWN_LEFT_PRED
 :

540 
	`g‘_i4x4_dowÆeá
(
cu¼_m´_4x4
[
DIAG_DOWN_LEFT_PRED
], 
P»dP–
);

542 
DIAG_DOWN_RIGHT_PRED
 :

543 
	`g‘_i4x4_dowÄight
(
cu¼_m´_4x4
[
DIAG_DOWN_RIGHT_PRED
], 
P»dP–
);

545 
VERT_RIGHT_PRED
 :

546 
	`g‘_i4x4_v”Œight
(
cu¼_m´_4x4
[
VERT_RIGHT_PRED
], 
P»dP–
);

548 
HOR_DOWN_PRED
 :

549 
	`g‘_i4x4_hÜdown
(
cu¼_m´_4x4
[
HOR_DOWN_PRED
], 
P»dP–
);

551 
VERT_LEFT_PRED
 :

552 
	`g‘_i4x4_v”Žeá
(
cu¼_m´_4x4
[
VERT_LEFT_PRED
], 
P»dP–
);

554 
HOR_UP_PRED
 :

555 
	`g‘_i4x4_hÜup
(
cu¼_m´_4x4
[
HOR_UP_PRED
], 
P»dP–
);

558 
	`´štf
("invalid…rediction mode \n");

561 
	}
}

	@lencod/src/intra8x8.c

14 
	~"glob®.h
"

15 
	~"image.h
"

16 
	~"mb_acûss.h
"

17 
	~"šŒa8x8.h
"

34 
	#P_Z
 (
P»dP–
[0])

	)

35 
	#P_A
 (
P»dP–
[1])

	)

36 
	#P_B
 (
P»dP–
[2])

	)

37 
	#P_C
 (
P»dP–
[3])

	)

38 
	#P_D
 (
P»dP–
[4])

	)

39 
	#P_E
 (
P»dP–
[5])

	)

40 
	#P_F
 (
P»dP–
[6])

	)

41 
	#P_G
 (
P»dP–
[7])

	)

42 
	#P_H
 (
P»dP–
[8])

	)

43 
	#P_I
 (
P»dP–
[9])

	)

44 
	#P_J
 (
P»dP–
[10])

	)

45 
	#P_K
 (
P»dP–
[11])

	)

46 
	#P_L
 (
P»dP–
[12])

	)

47 
	#P_M
 (
P»dP–
[13])

	)

48 
	#P_N
 (
P»dP–
[14])

	)

49 
	#P_O
 (
P»dP–
[15])

	)

50 
	#P_P
 (
P»dP–
[16])

	)

51 
	#P_Q
 (
P»dP–
[17])

	)

52 
	#P_R
 (
P»dP–
[18])

	)

53 
	#P_S
 (
P»dP–
[19])

	)

54 
	#P_T
 (
P»dP–
[20])

	)

55 
	#P_U
 (
P»dP–
[21])

	)

56 
	#P_V
 (
P»dP–
[22])

	)

57 
	#P_W
 (
P»dP–
[23])

	)

58 
	#P_X
 (
P»dP–
[24])

	)

60 
	$g’”©e_´ed_”rÜ_8x8
(
img³l
 **
cur_img
, img³È**
´d_img
, img³È**
cur_´d
,

61 **
m7
, 
pic_Ýix_x
, 
block_x
)

63 
j
, 
i
, *
m7_lše
;

64 
img³l
 *
cur_lše
, *
´d_lše
;

66 
j
=0; j < 
BLOCK_SIZE_8x8
; j++)

68 
´d_lše
 = 
´d_img
[
j
];

69 
	`memýy
(&
cur_´d
[
j
][
block_x
], 
´d_lše
, 
BLOCK_SIZE_8x8
 * (
img³l
));

70 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

71 
m7_lše
 = &
m7
[
j
][
block_x
];

72 
i
 = 0; i < 
BLOCK_SIZE_8x8
; i++)

74 *
m7_lše
++ = (è(*
cur_lše
++ - *
´d_lše
++);

77 
	}
}

85 
	$LowPassFÜIÁ¿8x8P»d
(
img³l
 *
P»dP–
, 
block_up_Ëá
, 
block_up
, 
block_Ëá
)

87 
i
;

88 
img³l
 
LoÝA¼ay
[25];

90 
	`memýy
(
LoÝA¼ay
,
P»dP–
, 25 * (
img³l
));

92 if(
block_up
)

94 if(
block_up_Ëá
)

96 
LoÝA¼ay
[1] = (
img³l
è((
P»dP–
[0] + (PredPel[1]<<1) + PredPel[2] + 2) >> 2);

99 
LoÝA¼ay
[1] = (
img³l
è((
P»dP–
[1] + (PredPel[1]<<1) + PredPel[2] + 2) >> 2);

102 
i
 = 2; i <16; i++)

104 
LoÝA¼ay
[
i
] = (
img³l
è((
P»dP–
[i-1] + (PredPel[i]<<1) + PredPel[i+1] + 2) >> 2);

106 
LoÝA¼ay
[16] = (
img³l
è((
P»dP–
[15] + PredPel[16] + (PredPel[16]<<1) + 2) >> 2);

109 if(
block_up_Ëá
)

111 if(
block_up
 && 
block_Ëá
)

113 
LoÝA¼ay
[0] = (
img³l
è(((
P»dP–
[0] << 1) + PredPel[1] + PredPel[17] + 2) >> 2);

117 if(
block_up
)

118 
LoÝA¼ay
[0] = (
img³l
è((
P»dP–
[0] + (PredPel[0] << 1) + PredPel[1] + 2) >> 2);

120 if(
block_Ëá
)

121 
LoÝA¼ay
[0] = (
img³l
è((
P»dP–
[0] + (PredPel[0] << 1) + PredPel[17] + 2) >> 2);

125 if(
block_Ëá
)

127 if(
block_up_Ëá
)

128 
LoÝA¼ay
[17] = (
img³l
è((
P»dP–
[0] + (PredPel[17] << 1) + PredPel[18] + 2) >> 2);

130 
LoÝA¼ay
[17] = (
img³l
è((
P»dP–
[17] + (PredPel[17] << 1) + PredPel[18] + 2) >> 2);

132 
i
 = 18; i <24; i++)

134 
LoÝA¼ay
[
i
] = (
img³l
è((
P»dP–
[i-1] + (PredPel[i]<<1) + PredPel[i+1] + 2) >> 2);

136 
LoÝA¼ay
[24] = (
img³l
è((
P»dP–
[23] + (PredPel[24] << 1) + PredPel[24] + 2) >> 2);

139 
	`memýy
(
P»dP–
, 
LoÝA¼ay
, 25 * (
img³l
));

140 
	}
}

148 
šlše
 
	$g‘_i8x8_v”tiÿl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

150 
j
;

151 
j
=0; j < 
BLOCK_SIZE_8x8
; j++)

152 
	`memýy
(
cur_´ed
[
j
], &
P_A
, 
BLOCK_SIZE_8x8
 * (
img³l
));

153 
	}
}

161 
šlše
 
	$g‘_i8x8_hÜizÚl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

163 
i
;

164 
i
=0; i < 
BLOCK_SIZE_8x8
; i++)

166 
cur_´ed
[
i
][0] =

167 
cur_´ed
[
i
][1] =

168 
cur_´ed
[
i
][2] =

169 
cur_´ed
[
i
][3] =

170 
cur_´ed
[
i
][4] =

171 
cur_´ed
[
i
][5] =

172 
cur_´ed
[
i
][6] =

173 
cur_´ed
[
i
][7] = (
img³l
è(&
P_Q
)[i];

175 
	}
}

183 
šlše
 
	$g‘_i8x8_dc
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
)

185 
i
, 
j
, 
s0
 = 0;

186 ià(
up_avažabË
 && 
Ëá_avažabË
)

189 
s0
 = 
	`rshiá_ºd_sf
((
P_A
 + 
P_B
 + 
P_C
 + 
P_D
 + 
P_E
 + 
P_F
 + 
P_G
 + 
P_H
 + 
P_Q
 + 
P_R
 + 
P_S
 + 
P_T
 + 
P_U
 + 
P_V
 + 
P_W
 + 
P_X
), 4);

191 ià(!
up_avažabË
 && 
Ëá_avažabË
)

194 
s0
 = 
	`rshiá_ºd_sf
((
P_Q
 + 
P_R
 + 
P_S
 + 
P_T
 + 
P_U
 + 
P_V
 + 
P_W
 + 
P_X
), 3);

196 ià(
up_avažabË
 && !
Ëá_avažabË
)

199 
s0
 = 
	`rshiá_ºd_sf
((
P_A
 + 
P_B
 + 
P_C
 + 
P_D
 + 
P_E
 + 
P_F
 + 
P_G
 + 
P_H
), 3);

204 
s0
 = 
P_A
;

208 
i
=0; i < 
BLOCK_SIZE_8x8
; i++)

210 
cur_´ed
[0][
i
] = (
img³l
è
s0
;

213 
j
=0; j < 
BLOCK_SIZE_8x8
 - 1; j++)

215 
	`memýy
 (
cur_´ed
[
j
 + 1], cur_´ed[j], 
BLOCK_SIZE_8x8
 * (
img³l
));

217 
	}
}

225 
šlše
 
	$g‘_i8x8_dowÆeá
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

227 
img³l
 
P»dA¼ay
[16];

228 
img³l
 *
P»d
 = &
P»dA¼ay
[0];

231 *
P»d
++ = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

232 *
P»d
++ = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

233 *
P»d
++ = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

234 *
P»d
++ = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

235 *
P»d
++ = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
) << 1) + 2) >> 2);

236 *
P»d
++ = (
img³l
è((
P_F
 + 
P_H
 + ((
P_G
) << 1) + 2) >> 2);

237 *
P»d
++ = (
img³l
è((
P_G
 + 
P_I
 + ((
P_H
) << 1) + 2) >> 2);

238 *
P»d
++ = (
img³l
è((
P_H
 + 
P_J
 + ((
P_I
) << 1) + 2) >> 2);

239 *
P»d
++ = (
img³l
è((
P_I
 + 
P_K
 + ((
P_J
) << 1) + 2) >> 2);

240 *
P»d
++ = (
img³l
è((
P_J
 + 
P_L
 + ((
P_K
) << 1) + 2) >> 2);

241 *
P»d
++ = (
img³l
è((
P_K
 + 
P_M
 + ((
P_L
) << 1) + 2) >> 2);

242 *
P»d
++ = (
img³l
è((
P_L
 + 
P_N
 + ((
P_M
) << 1) + 2) >> 2);

243 *
P»d
++ = (
img³l
è((
P_M
 + 
P_O
 + ((
P_N
) << 1) + 2) >> 2);

244 *
P»d
++ = (
img³l
è((
P_N
 + 
P_P
 + ((
P_O
) << 1) + 2) >> 2);

245 *
P»d
 = (
img³l
è((
P_O
 + 
P_P
 + ((P_P) << 1) + 2) >> 2);

247 
P»d
 = &
P»dA¼ay
[ 0];

249 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

250 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

251 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

252 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

253 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

254 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

255 
	`memýy
(*
cur_´ed
++, 
P»d
++, 8 * (
img³l
));

256 
	`memýy
(*
cur_´ed
 , 
P»d
 , 8 * (
img³l
));

257 
	}
}

265 
šlše
 
	$g‘_i8x8_dowÄight
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

267 
img³l
 
P»dA¼ay
[16];

268 
img³l
 *
P»d
 = &
P»dA¼ay
[0];

271 *
P»d
++ = (
img³l
è((
P_X
 + 
P_V
 + ((
P_W
) << 1) + 2) >> 2);

272 *
P»d
++ = (
img³l
è((
P_W
 + 
P_U
 + ((
P_V
) << 1) + 2) >> 2);

273 *
P»d
++ = (
img³l
è((
P_V
 + 
P_T
 + ((
P_U
) << 1) + 2) >> 2);

274 *
P»d
++ = (
img³l
è((
P_U
 + 
P_S
 + ((
P_T
) << 1) + 2) >> 2);

275 *
P»d
++ = (
img³l
è((
P_T
 + 
P_R
 + ((
P_S
) << 1) + 2) >> 2);

276 *
P»d
++ = (
img³l
è((
P_S
 + 
P_Q
 + ((
P_R
) << 1) + 2) >> 2);

277 *
P»d
++ = (
img³l
è((
P_R
 + 
P_Z
 + ((
P_Q
) << 1) + 2) >> 2);

278 *
P»d
++ = (
img³l
è((
P_Q
 + 
P_A
 + ((
P_Z
) << 1) + 2) >> 2);

279 *
P»d
++ = (
img³l
è((
P_Z
 + 
P_B
 + ((
P_A
) << 1) + 2) >> 2);

280 *
P»d
++ = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

281 *
P»d
++ = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

282 *
P»d
++ = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

283 *
P»d
++ = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

284 *
P»d
++ = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
) << 1) + 2) >> 2);

285 *
P»d
 = (
img³l
è((
P_F
 + 
P_H
 + ((
P_G
) << 1) + 2) >> 2);

287 
P»d
 = &
P»dA¼ay
[7];

289 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

290 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

291 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

292 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

293 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

294 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

295 
	`memýy
(*
cur_´ed
++, 
P»d
--, 8 * (
img³l
));

296 
	`memýy
(*
cur_´ed
 , 
P»d
 , 8 * (
img³l
));

297 
	}
}

305 
šlše
 
	$g‘_i8x8_v”Žeá
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

307 
img³l
 
P»dA¼ay
[22];

308 
img³l
 *
P»d
 = &
P»dA¼ay
[0];

310 *
P»d
++ = (
img³l
è((
P_A
 + 
P_B
 + 1) >> 1);

311 *
P»d
++ = (
img³l
è((
P_B
 + 
P_C
 + 1) >> 1);

312 *
P»d
++ = (
img³l
è((
P_C
 + 
P_D
 + 1) >> 1);

313 *
P»d
++ = (
img³l
è((
P_D
 + 
P_E
 + 1) >> 1);

314 *
P»d
++ = (
img³l
è((
P_E
 + 
P_F
 + 1) >> 1);

315 *
P»d
++ = (
img³l
è((
P_F
 + 
P_G
 + 1) >> 1);

316 *
P»d
++ = (
img³l
è((
P_G
 + 
P_H
 + 1) >> 1);

317 *
P»d
++ = (
img³l
è((
P_H
 + 
P_I
 + 1) >> 1);

318 *
P»d
++ = (
img³l
è((
P_I
 + 
P_J
 + 1) >> 1);

319 *
P»d
++ = (
img³l
è((
P_J
 + 
P_K
 + 1) >> 1);

320 *
P»d
++ = (
img³l
è((
P_K
 + 
P_L
 + 1) >> 1);

321 *
P»d
++ = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

322 *
P»d
++ = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

323 *
P»d
++ = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

324 *
P»d
++ = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

325 *
P»d
++ = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
) << 1) + 2) >> 2);

326 *
P»d
++ = (
img³l
è((
P_F
 + 
P_H
 + ((
P_G
) << 1) + 2) >> 2);

327 *
P»d
++ = (
img³l
è((
P_G
 + 
P_I
 + ((
P_H
) << 1) + 2) >> 2);

328 *
P»d
++ = (
img³l
è((
P_H
 + 
P_J
 + ((
P_I
) << 1) + 2) >> 2);

329 *
P»d
++ = (
img³l
è((
P_I
 + 
P_K
 + ((
P_J
) << 1) + 2) >> 2);

330 *
P»d
++ = (
img³l
è((
P_J
 + 
P_L
 + ((
P_K
) << 1) + 2) >> 2);

331 *
P»d
 = (
img³l
è((
P_K
 + 
P_M
 + ((
P_L
) << 1) + 2) >> 2);

333 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 0], 8 * (
img³l
));

334 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[11], 8 * (
img³l
));

335 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 1], 8 * (
img³l
));

336 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[12], 8 * (
img³l
));

337 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 2], 8 * (
img³l
));

338 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[13], 8 * (
img³l
));

339 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 3], 8 * (
img³l
));

340 
	`memýy
(*
cur_´ed
 , &
P»dA¼ay
[14], 8 * (
img³l
));

341 
	}
}

350 
šlše
 
	$g‘_i8x8_v”Œight
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

352 
img³l
 
P»dA¼ay
[22];

353 
img³l
 *
P»d
 = &
P»dA¼ay
[0];

355 *
P»d
++ = (
img³l
è((
P_V
 + 
P_T
 + ((
P_U
) << 1) + 2) >> 2);

356 *
P»d
++ = (
img³l
è((
P_T
 + 
P_R
 + ((
P_S
) << 1) + 2) >> 2);

357 *
P»d
++ = (
img³l
è((
P_R
 + 
P_Z
 + ((
P_Q
) << 1) + 2) >> 2);

358 *
P»d
++ = (
img³l
è((
P_Z
 + 
P_A
 + 1) >> 1);

359 *
P»d
++ = (
img³l
è((
P_A
 + 
P_B
 + 1) >> 1);

360 *
P»d
++ = (
img³l
è((
P_B
 + 
P_C
 + 1) >> 1);

361 *
P»d
++ = (
img³l
è((
P_C
 + 
P_D
 + 1) >> 1);

362 *
P»d
++ = (
img³l
è((
P_D
 + 
P_E
 + 1) >> 1);

363 *
P»d
++ = (
img³l
è((
P_E
 + 
P_F
 + 1) >> 1);

364 *
P»d
++ = (
img³l
è((
P_F
 + 
P_G
 + 1) >> 1);

365 *
P»d
++ = (
img³l
è((
P_G
 + 
P_H
 + 1) >> 1);

367 *
P»d
++ = (
img³l
è((
P_W
 + 
P_U
 + ((
P_V
) << 1) + 2) >> 2);

368 *
P»d
++ = (
img³l
è((
P_U
 + 
P_S
 + ((
P_T
) << 1) + 2) >> 2);

369 *
P»d
++ = (
img³l
è((
P_S
 + 
P_Q
 + ((
P_R
) << 1) + 2) >> 2);

370 *
P»d
++ = (
img³l
è((
P_Q
 + 
P_A
 + ((
P_Z
) << 1) + 2) >> 2);

371 *
P»d
++ = (
img³l
è((
P_Z
 + 
P_B
 + ((
P_A
) << 1) + 2) >> 2);

372 *
P»d
++ = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

373 *
P»d
++ = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

374 *
P»d
++ = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

375 *
P»d
++ = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

376 *
P»d
++ = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
) << 1) + 2) >> 2);

377 *
P»d
 = (
img³l
è((
P_F
 + 
P_H
 + ((
P_G
) << 1) + 2) >> 2);

379 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 3], 8 * (
img³l
));

380 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[14], 8 * (
img³l
));

381 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 2], 8 * (
img³l
));

382 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[13], 8 * (
img³l
));

383 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 1], 8 * (
img³l
));

384 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[12], 8 * (
img³l
));

385 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 0], 8 * (
img³l
));

386 
	`memýy
(*
cur_´ed
 , &
P»dA¼ay
[11], 8 * (
img³l
));

387 
	}
}

395 
šlše
 
	$g‘_i8x8_hÜdown
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

397 
img³l
 
P»dA¼ay
[22];

398 
img³l
 *
P»d
 = &
P»dA¼ay
[0];

400 *
P»d
++ = (
img³l
è((
P_X
 + 
P_W
 + 1) >> 1);

401 *
P»d
++ = (
img³l
è((
P_V
 + 
P_X
 + (
P_W
 << 1) + 2) >> 2);

402 *
P»d
++ = (
img³l
è((
P_W
 + 
P_V
 + 1) >> 1);

403 *
P»d
++ = (
img³l
è((
P_U
 + 
P_W
 + ((
P_V
) << 1) + 2) >> 2);

404 *
P»d
++ = (
img³l
è((
P_V
 + 
P_U
 + 1) >> 1);

405 *
P»d
++ = (
img³l
è((
P_T
 + 
P_V
 + ((
P_U
) << 1) + 2) >> 2);

406 *
P»d
++ = (
img³l
è((
P_U
 + 
P_T
 + 1) >> 1);

407 *
P»d
++ = (
img³l
è((
P_S
 + 
P_U
 + ((
P_T
) << 1) + 2) >> 2);

408 *
P»d
++ = (
img³l
è((
P_T
 + 
P_S
 + 1) >> 1);

409 *
P»d
++ = (
img³l
è((
P_R
 + 
P_T
 + ((
P_S
) << 1) + 2) >> 2);

410 *
P»d
++ = (
img³l
è((
P_S
 + 
P_R
 + 1) >> 1);

411 *
P»d
++ = (
img³l
è((
P_Q
 + 
P_S
 + ((
P_R
) << 1) + 2) >> 2);

412 *
P»d
++ = (
img³l
è((
P_R
 + 
P_Q
 + 1) >> 1);

413 *
P»d
++ = (
img³l
è((
P_Z
 + 
P_R
 + ((
P_Q
) << 1) + 2) >> 2);

414 *
P»d
++ = (
img³l
è((
P_Q
 + 
P_Z
 + 1) >> 1);

415 *
P»d
++ = (
img³l
è((
P_Q
 + 
P_A
 + ((
P_Z
) << 1) + 2) >> 2);

416 *
P»d
++ = (
img³l
è((
P_Z
 + 
P_B
 + ((
P_A
) << 1) + 2) >> 2);

417 *
P»d
++ = (
img³l
è((
P_A
 + 
P_C
 + ((
P_B
) << 1) + 2) >> 2);

418 *
P»d
++ = (
img³l
è((
P_B
 + 
P_D
 + ((
P_C
) << 1) + 2) >> 2);

419 *
P»d
++ = (
img³l
è((
P_C
 + 
P_E
 + ((
P_D
) << 1) + 2) >> 2);

420 *
P»d
++ = (
img³l
è((
P_D
 + 
P_F
 + ((
P_E
) << 1) + 2) >> 2);

421 *
P»d
 = (
img³l
è((
P_E
 + 
P_G
 + ((
P_F
) << 1) + 2) >> 2);

423 
P»d
 = &
P»dA¼ay
[14];

424 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

425 
P»d
 -= 2;

426 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

427 
P»d
 -= 2;

428 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

429 
P»d
 -= 2;

430 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

431 
P»d
 -= 2;

432 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

433 
P»d
 -= 2;

434 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

435 
P»d
 -= 2;

436 
	`memýy
(*
cur_´ed
++, 
P»d
, 8 * (
img³l
));

437 
P»d
 -= 2;

438 
	`memýy
(*
cur_´ed
 , 
P»d
, 8 * (
img³l
));

439 
	}
}

448 
šlše
 
	$g‘_i8x8_hÜup
(
img³l
 **
cur_´ed
, img³È*
P»dP–
)

450 
img³l
 
P»dA¼ay
[22];

451 
P»dA¼ay
[ 0] = (
img³l
è((
P_Q
 + 
P_R
 + 1) >> 1);

452 
P»dA¼ay
[ 1] = (
img³l
è((
P_S
 + 
P_Q
 + ((
P_R
) << 1) + 2) >> 2);

453 
P»dA¼ay
[ 2] = (
img³l
è((
P_R
 + 
P_S
 + 1) >> 1);

454 
P»dA¼ay
[ 3] = (
img³l
è((
P_T
 + 
P_R
 + ((
P_S
) << 1) + 2) >> 2);

455 
P»dA¼ay
[ 4] = (
img³l
è((
P_S
 + 
P_T
 + 1) >> 1);

456 
P»dA¼ay
[ 5] = (
img³l
è((
P_U
 + 
P_S
 + ((
P_T
) << 1) + 2) >> 2);

457 
P»dA¼ay
[ 6] = (
img³l
è((
P_T
 + 
P_U
 + 1) >> 1);

458 
P»dA¼ay
[ 7] = (
img³l
è((
P_V
 + 
P_T
 + ((
P_U
) << 1) + 2) >> 2);

459 
P»dA¼ay
[ 8] = (
img³l
è((
P_U
 + 
P_V
 + 1) >> 1);

460 
P»dA¼ay
[ 9] = (
img³l
è((
P_W
 + 
P_U
 + ((
P_V
) << 1) + 2) >> 2);

461 
P»dA¼ay
[10] = (
img³l
è((
P_V
 + 
P_W
 + 1) >> 1);

462 
P»dA¼ay
[11] = (
img³l
è((
P_X
 + 
P_V
 + ((
P_W
) << 1) + 2) >> 2);

463 
P»dA¼ay
[12] = (
img³l
è((
P_W
 + 
P_X
 + 1) >> 1);

464 
P»dA¼ay
[13] = (
img³l
è((
P_W
 + 
P_X
 + ((P_X) << 1) + 2) >> 2);

465 
P»dA¼ay
[14] = (
img³l
è
P_X
;

466 
P»dA¼ay
[15] = (
img³l
è
P_X
;

467 
P»dA¼ay
[16] = (
img³l
è
P_X
;

468 
P»dA¼ay
[17] = (
img³l
è
P_X
;

469 
P»dA¼ay
[18] = (
img³l
è
P_X
;

470 
P»dA¼ay
[19] = (
img³l
è
P_X
;

471 
P»dA¼ay
[20] = (
img³l
è
P_X
;

472 
P»dA¼ay
[21] = (
img³l
è
P_X
;

474 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 0], 8 * (
img³l
));

475 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 2], 8 * (
img³l
));

476 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 4], 8 * (
img³l
));

477 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 6], 8 * (
img³l
));

478 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[ 8], 8 * (
img³l
));

479 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[10], 8 * (
img³l
));

480 
	`memýy
(*
cur_´ed
++, &
P»dA¼ay
[12], 8 * (
img³l
));

481 
	`memýy
(*
cur_´ed
 , &
P»dA¼ay
[14], 8 * (
img³l
));

482 
	}
}

497 
	$£t_šŒ­»d_8x8
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

499 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

500 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

502 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa8x8_´ed
[
¶
];

503 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

504 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

506 
ioff
 = (
img_x
 & 15);

507 
joff
 = (
img_y
 & 15);

509 
Pix–Pos
 
pix_a
, 
pix_b
, 
pix_c
, 
pix_d
;

511 
block_avažabË_up
;

512 
block_avažabË_Ëá
;

513 
block_avažabË_up_Ëá
;

514 
block_avažabË_up_right
;

516 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 , 
mb_size
, &
pix_a
);

517 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 , 
joff
 - 1, 
mb_size
, &
pix_b
);

518 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 + 8, 
joff
 - 1, 
mb_size
, &
pix_c
);

519 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 - 1, 
mb_size
, &
pix_d
);

521 
pix_c
.
avažabË
 =…ix_c.avažabË &&!(
ioff
 =ð8 && 
joff
 == 8);

523 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

525 
block_avažabË_Ëá
 = 
pix_a
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_a.
mb_addr
]: 0;

526 
block_avažabË_up
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_b.
mb_addr
] : 0;

527 
block_avažabË_up_right
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_c.
mb_addr
] : 0;

528 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_d.
mb_addr
] : 0;

532 
block_avažabË_Ëá
 = 
pix_a
.
avažabË
;

533 
block_avažabË_up
 = 
pix_b
.
avažabË
;

534 
block_avažabË_up_right
 = 
pix_c
.
avažabË
;

535 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
;

538 *
Ëá_avažabË
 = 
block_avažabË_Ëá
;

539 *
up_avažabË
 = 
block_avažabË_up
;

540 *
®l_avažabË
 = 
block_avažabË_up
 && 
block_avažabË_Ëá
 && 
block_avažabË_up_Ëá
;

543 ià(
block_avažabË_up
)

545 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 8 * (
img³l
));

549 
P_A
 = 
P_B
 = 
P_C
 = 
P_D
 = 
P_E
 = 
P_F
 = 
P_G
 = 
P_H
 = 
p_Vid
->
dc_´ed_v®ue
;

552 ià(
block_avažabË_up_right
)

554 
	`memýy
(&
P»dP–
[9], &
img_’c
[
pix_c
.
pos_y
][pix_c.
pos_x
], 8 * (
img³l
));

558 
P_I
 = 
P_J
 = 
P_K
 = 
P_L
 = 
P_M
 = 
P_N
 = 
P_O
 = 
P_P
 = 
P_H
;

561 ià(
block_avažabË_Ëá
)

563 
pos_y
 = 
pix_a
.pos_y;

564 
pos_x
 = 
pix_a
.pos_x;

565 
P_Q
 = 
img_’c
[
pos_y
++][
pos_x
];

566 
P_R
 = 
img_’c
[
pos_y
++][
pos_x
];

567 
P_S
 = 
img_’c
[
pos_y
++][
pos_x
];

568 
P_T
 = 
img_’c
[
pos_y
++][
pos_x
];

569 
P_U
 = 
img_’c
[
pos_y
++][
pos_x
];

570 
P_V
 = 
img_’c
[
pos_y
++][
pos_x
];

571 
P_W
 = 
img_’c
[
pos_y
++][
pos_x
];

572 
P_X
 = 
img_’c
[
pos_y
 ][
pos_x
];

576 
P_Q
 = 
P_R
 = 
P_S
 = 
P_T
 = 
P_U
 = 
P_V
 = 
P_W
 = 
P_X
 = 
p_Vid
->
dc_´ed_v®ue
;

579 ià(
block_avažabË_up_Ëá
)

581 
P_Z
 = 
img_’c
[
pix_d
.
pos_y
][pix_d.
pos_x
];

585 
P_Z
 = 
p_Vid
->
dc_´ed_v®ue
;

588 
	`LowPassFÜIÁ¿8x8P»d
(
P»dP–
, 
block_avažabË_up_Ëá
, 
block_avažabË_up
, 
block_avažabË_Ëá
);

589 
	}
}

604 
	$£t_šŒ­»d_8x8_mbaff
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
img_x
,
img_y
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

606 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

607 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

609 
i
;

610 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa8x8_´ed
[
¶
];

611 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

612 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

614 
ioff
 = (
img_x
 & 15);

615 
joff
 = (
img_y
 & 15);

617 
Pix–Pos
 
pix_a
[8];

618 
Pix–Pos
 
pix_b
, 
pix_c
, 
pix_d
;

620 
block_avažabË_up
;

621 
block_avažabË_Ëá
;

622 
block_avažabË_up_Ëá
;

623 
block_avažabË_up_right
;

625 
i
=0;i<8;i++)

627 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 + 
i
 , 
mb_size
, &
pix_a
[i]);

630 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 , 
joff
 - 1, 
mb_size
, &
pix_b
);

631 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 + 8, 
joff
 - 1, 
mb_size
, &
pix_c
);

632 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 
ioff
 - 1, 
joff
 - 1, 
mb_size
, &
pix_d
);

634 
pix_c
.
avažabË
 =…ix_c.avažabË &&!(
ioff
 =ð8 && 
joff
 == 8);

636 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

638 
i
=0, 
block_avažabË_Ëá
=1; i<8;i++)

639 
block_avažabË_Ëá
 &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

641 
block_avažabË_up
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_b.
mb_addr
] : 0;

642 
block_avažabË_up_right
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_c.
mb_addr
] : 0;

643 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
 [pix_d.
mb_addr
] : 0;

647 
block_avažabË_Ëá
 = 
pix_a
[0].
avažabË
;

648 
block_avažabË_up
 = 
pix_b
.
avažabË
;

649 
block_avažabË_up_right
 = 
pix_c
.
avažabË
;

650 
block_avažabË_up_Ëá
 = 
pix_d
.
avažabË
;

653 *
Ëá_avažabË
 = 
block_avažabË_Ëá
;

654 *
up_avažabË
 = 
block_avažabË_up
;

655 *
®l_avažabË
 = 
block_avažabË_up
 && 
block_avažabË_Ëá
 && 
block_avažabË_up_Ëá
;

658 ià(
block_avažabË_up
)

660 
	`memýy
(&
P»dP–
[1], &
img_’c
[
pix_b
.
pos_y
][pix_b.
pos_x
], 8 * (
img³l
));

664 
P_A
 = 
P_B
 = 
P_C
 = 
P_D
 = 
P_E
 = 
P_F
 = 
P_G
 = 
P_H
 = 
p_Vid
->
dc_´ed_v®ue
;

667 ià(
block_avažabË_up_right
)

669 
	`memýy
(&
P»dP–
[9], &
img_’c
[
pix_c
.
pos_y
][pix_c.
pos_x
], 8 * (
img³l
));

673 
P_I
 = 
P_J
 = 
P_K
 = 
P_L
 = 
P_M
 = 
P_N
 = 
P_O
 = 
P_P
 = 
P_H
;

676 ià(
block_avažabË_Ëá
)

678 
P_Q
 = 
img_’c
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
];

679 
P_R
 = 
img_’c
[
pix_a
[1].
pos_y
][pix_a[1].
pos_x
];

680 
P_S
 = 
img_’c
[
pix_a
[2].
pos_y
][pix_a[2].
pos_x
];

681 
P_T
 = 
img_’c
[
pix_a
[3].
pos_y
][pix_a[3].
pos_x
];

682 
P_U
 = 
img_’c
[
pix_a
[4].
pos_y
][pix_a[4].
pos_x
];

683 
P_V
 = 
img_’c
[
pix_a
[5].
pos_y
][pix_a[5].
pos_x
];

684 
P_W
 = 
img_’c
[
pix_a
[6].
pos_y
][pix_a[6].
pos_x
];

685 
P_X
 = 
img_’c
[
pix_a
[7].
pos_y
][pix_a[7].
pos_x
];

689 
P_Q
 = 
P_R
 = 
P_S
 = 
P_T
 = 
P_U
 = 
P_V
 = 
P_W
 = 
P_X
 = 
p_Vid
->
dc_´ed_v®ue
;

692 ià(
block_avažabË_up_Ëá
)

694 
P_Z
 = 
img_’c
[
pix_d
.
pos_y
][pix_d.
pos_x
];

698 
P_Z
 = 
p_Vid
->
dc_´ed_v®ue
;

701 
	`LowPassFÜIÁ¿8x8P»d
(
P»dP–
, 
block_avažabË_up_Ëá
, 
block_avažabË_up
, 
block_avažabË_Ëá
);

702 
	}
}

716 
	$g‘_šŒ­»d_8x8
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
i8x8_mode
, 
Ëá_avažabË
, 
up_avažabË
)

718 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa8x8_´ed
[
¶
];

719 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

720 
img³l
 ***
cu¼_m´_8x8
 = 
cu¼Sliû
->
m´_8x8
[
¶
];

722 
i8x8_mode
)

724 
VERT_PRED
 :

725 
	`g‘_i8x8_v”tiÿl
(
cu¼_m´_8x8
[
VERT_PRED
], 
P»dP–
);

727 
HOR_PRED
 :

728 
	`g‘_i8x8_hÜizÚl
(
cu¼_m´_8x8
[
HOR_PRED
], 
P»dP–
);

730 
DC_PRED
 :

731 
	`g‘_i8x8_dc
(
cu¼_m´_8x8
[
DC_PRED
], 
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
);

733 
DIAG_DOWN_LEFT_PRED
 :

734 
	`g‘_i8x8_dowÆeá
(
cu¼_m´_8x8
[
DIAG_DOWN_LEFT_PRED
], 
P»dP–
);

736 
DIAG_DOWN_RIGHT_PRED
 :

737 
	`g‘_i8x8_dowÄight
(
cu¼_m´_8x8
[
DIAG_DOWN_RIGHT_PRED
], 
P»dP–
);

739 
VERT_RIGHT_PRED
 :

740 
	`g‘_i8x8_v”Œight
(
cu¼_m´_8x8
[
VERT_RIGHT_PRED
], 
P»dP–
);

742 
HOR_DOWN_PRED
 :

743 
	`g‘_i8x8_hÜdown
(
cu¼_m´_8x8
[
HOR_DOWN_PRED
], 
P»dP–
);

745 
VERT_LEFT_PRED
 :

746 
	`g‘_i8x8_v”Žeá
(
cu¼_m´_8x8
[
VERT_LEFT_PRED
], 
P»dP–
);

748 
HOR_UP_PRED
 :

749 
	`g‘_i8x8_hÜup
(
cu¼_m´_8x8
[
HOR_UP_PRED
], 
P»dP–
);

752 
	`´štf
("invalid…rediction mode \n");

755 
	}
}

	@lencod/src/intra_chroma.c

14 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"mb_acûss.h
"

19 
	~"block.h
"

20 
	~"mv_£¬ch.h
"

22 
	$g‘_difã»nû_4x4
(
img³l
 **
¤c
, img³È**
´d
, *
diff
, 
pos_x
, 
block_x
)

24 
i
, 
j
;

25 *
p_diff
 = 
diff
;

26 
img³l
 *
img_´d
, *
img_¤c
;

27 
j
 = 0; j < 
BLOCK_SIZE
; j++)

29 
img_¤c
 = &
¤c
[
j
][
pos_x
 + 
block_x
];

30 
img_´d
 = &
´d
[
j
][
block_x
];

32 
i
 = 0; i < 
BLOCK_SIZE
; i++)

33 *
p_diff
++ = 
img_¤c
[
i
] - 
img_´d
[i];

35 
	}
}

43 
šlše
 
	$g‘_iChroma_v”tiÿl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
ü_MB_x
, 
ü_MB_y
)

45 
j
;

46 
j
 = 0; j < 
ü_MB_y
; j++)

47 
	`memýy
(
cur_´ed
[
j
], &
P»dP–
[1], 
ü_MB_x
 * (
img³l
));

48 
	}
}

57 
šlše
 
	$g‘_iChroma_hÜizÚl
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
ü_MB_x
, 
ü_MB_y
)

59 
i
, 
j
;

60 
img³l
 *
´ediùiÚ
 = &
P»dP–
[16];

62 
j
 = 0; j < 
ü_MB_y
; j++)

64 
´ediùiÚ
++;

65 
i
 = 0; i < 
ü_MB_x
; i++)

67 
cur_´ed
[
j
][
i
] = *
´ediùiÚ
;

70 
	}
}

78 
šlše
 
	$g‘_iChroma_dc
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
)

80 
i
, 
j
, 
s0
 = 0, 
s1
 = 0, 
s2
 = 0;

82 ià(
up_avažabË
)

84 
i
 = 1; i < 
MB_BLOCK_SIZE
 + 1; ++i)

85 
s1
 +ð
P»dP–
[
i
];

88 ià(
Ëá_avažabË
)

90 
i
 = 17; i < 33; ++i)

91 
s2
 +ð
P»dP–
[
i
];

94 ià(
up_avažabË
)

96 
s0
 = 
Ëá_avažabË


97 ? 
	`rshiá_ºd_sf
((
s1
 + 
s2
),(
MB_BLOCK_SHIFT
 + 1))

98 : 
	`rshiá_ºd_sf
(
s1
, 
MB_BLOCK_SHIFT
);

102 
s0
 = 
Ëá_avažabË


103 ? 
	`rshiá_ºd_sf
(
s2
, 
MB_BLOCK_SHIFT
)

104 : 
P»dP–
[1];

107 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

109 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

110 
cur_´ed
[
j
][
i
] = (
img³l
è
s0
;

112 
	}
}

120 
šlše
 
	$g‘_iChroma_¶ªe
(
img³l
 **
cur_´ed
, img³È*
P»dP–
, 
max_img³l_v®ue
)

122 
i
, 
j
;

124 
ih
=0, 
iv
=0;

125 
ib
, 
ic
, 
Ÿa
;

126 
img³l
 *
t_´ed
 = &
P»dP–
[25];

127 
img³l
 *
u_´ed
 = &
P»dP–
[8];

128 
img³l
 *
b_´ed
 = &
P»dP–
[23];

130 
i
 = 1; i < 8;++i)

132 
ih
 +ð
i
*(*(
u_´ed
 + i) - *(u_pred - i));

133 
iv
 +ð
i
*(*
t_´ed
++ - *
b_´ed
--);

135 
ih
 +ð8 * (*(
u_´ed
 + 8è- 
P»dP–
[0]);

136 
iv
 +ð8 * (*
t_´ed
++ - 
P»dP–
[0]);

138 
ib
 = (5 * 
ih
 + 32) >> 6;

139 
ic
 = (5 * 
iv
 + 32) >> 6;

141 
Ÿa
=16 * (
P»dP–
[16] + PredPel[32]);

143 
j
=0;j< 
MB_BLOCK_SIZE
;++j)

145 
i
=0;i< 
MB_BLOCK_SIZE
;++i)

147 
cur_´ed
[
j
][
i
]ð(
img³l
è
	`iCl1
Ð
max_img³l_v®ue
, 
	`rshiá_ºd_sf
((
Ÿa
 + (˜- 7è* 
ib
 + (j - 7è* 
ic
), 5));

150 
	}
}

163 
	$£t_šŒ­»d_chroma
(
Maüoblock
 *
cu¼MB
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

165 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

166 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

168 
i
;

169 
img³l
 *
P»dP–U
 = 
cu¼MB
->
šŒa16x16_´ed
[
PLANE_U
];

170 
img³l
 *
P»dP–V
 = 
cu¼MB
->
šŒa16x16_´ed
[
PLANE_V
];

171 
img³l
 **
img_’c_u
 = 
p_Vid
->
’c_piùu»
->
imgUV
[0];

172 
img³l
 **
img_’c_v
 = 
p_Vid
->
’c_piùu»
->
imgUV
[1];

174 
Pix–Pos
 
pix_b
;

175 
Pix–Pos
 
pix_a
;

176 
Pix–Pos
 
pix_d
;

177 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

178 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

180 
img³l
 
dc_´ed_v®ue_chroma
 = 
p_Vid
->
dc_´ed_v®ue_comp
[1];

182 *
mb_size
 = 
p_Vid
->mb_size[
IS_CHROMA
];

184 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, -1, 
mb_size
, &
pix_d
);

185 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 0, 
mb_size
, &
pix_a
);

186 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1, 
mb_size
, &
pix_b
);

188 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 == 0)

190 *
up_avažabË
 = 
pix_b
.
avažabË
;

191 *
Ëá_avažabË
 = 
pix_a
.
avažabË
;

192 *
®l_avažabË
 = 
pix_d
.
avažabË
;

196 *
up_avažabË
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

197 *
Ëá_avažabË
 = 
pix_a
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a.
mb_addr
] : 0;

198 *
®l_avažabË
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_d.
mb_addr
] : 0;

202 ià(*
up_avažabË
)

204 
	`memýy
(&
P»dP–U
[1], &
img_’c_u
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
ü_MB_x
 * (
img³l
));

205 
	`memýy
(&
P»dP–V
[1], &
img_’c_v
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
ü_MB_x
 * (
img³l
));

209 
i
 = 1; i < 
ü_MB_x
 + 1; ++i)

210 
P»dP–U
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

211 
i
 = 1; i < 
ü_MB_x
 + 1; ++i)

212 
P»dP–V
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

215 ià(*
Ëá_avažabË
)

217 
pos_y
 = 
pix_a
.pos_y;

218 
pos_x
 = 
pix_a
.pos_x;

220 
i
 = 1; i < 
ü_MB_y
 + 1; ++i)

222 
P»dP–U
[
i
 + 
ü_MB_x
] = 
img_’c_u
[
pos_y
 ][
pos_x
];

223 
P»dP–V
[
i
 + 
ü_MB_x
] = 
img_’c_v
[
pos_y
++][
pos_x
];

228 
i
 = 
ü_MB_x
 + 1; i < cr_MB_x + 
ü_MB_y
 + 1; ++i)

229 
P»dP–U
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

230 
i
 = 
ü_MB_x
 + 1; i < cr_MB_x + 
ü_MB_y
 + 1; ++i)

231 
P»dP–V
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

234 ià(*
®l_avažabË
)

236 
P»dP–U
[0] = 
img_’c_u
[
pix_d
.
pos_y
][pix_d.
pos_x
];

237 
P»dP–V
[0] = 
img_’c_v
[
pix_d
.
pos_y
][pix_d.
pos_x
];

241 
P»dP–U
[0] = 
dc_´ed_v®ue_chroma
;

242 
P»dP–V
[0] = 
dc_´ed_v®ue_chroma
;

244 
	}
}

258 
	$£t_šŒ­»d_chroma_mbaff
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, *
Ëá_avažabË
, *
up_avažabË
, *
®l_avažabË
)

260 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

261 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

263 
i
;

264 
img³l
 *
P»dP–U
 = 
cu¼MB
->
šŒa16x16_´ed
[
PLANE_U
];

265 
img³l
 *
P»dP–V
 = 
cu¼MB
->
šŒa16x16_´ed
[
PLANE_V
];

266 
img³l
 **
img_’c_u
 = 
p_Vid
->
’c_piùu»
->
imgUV
[0];

267 
img³l
 **
img_’c_v
 = 
p_Vid
->
’c_piùu»
->
imgUV
[1];

269 
Pix–Pos
 
pix_b
;

270 
Pix–Pos
 
pix_a
[17];

271 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

272 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

274 
img³l
 
dc_´ed_v®ue_chroma
 = 
p_Vid
->
dc_´ed_v®ue_comp
[1];

276 *
mb_size
 = 
p_Vid
->mb_size[
IS_CHROMA
];

278 
i
 = 0; i < 
ü_MB_y
 + 1; ++i)

280 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 
i
 - 1, 
mb_size
, &
pix_a
[i]);

283 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1, 
mb_size
, &
pix_b
);

285 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 == 0)

287 *
up_avažabË
 = 
pix_b
.
avažabË
;

288 *
Ëá_avažabË
 = 
pix_a
[1].
avažabË
;

289 *
®l_avažabË
 = 
pix_a
[0].
avažabË
;

293 *
up_avažabË
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

294 
i
=1, *
Ëá_avažabË
=1; i<17;++i)

295 *
Ëá_avažabË
 &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

296 *
®l_avažabË
 = 
pix_a
[0].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[0].
mb_addr
]: 0;

300 ià(*
up_avažabË
)

302 
	`memýy
(&
P»dP–U
[1], &
img_’c_u
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
ü_MB_x
 * (
img³l
));

303 
	`memýy
(&
P»dP–V
[1], &
img_’c_v
[
pix_b
.
pos_y
][pix_b.
pos_x
], 
ü_MB_x
 * (
img³l
));

307 
i
 = 1; i < 
ü_MB_x
 + 1; ++i)

308 
P»dP–U
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

309 
i
 = 1; i < 
ü_MB_x
 + 1; ++i)

310 
P»dP–V
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

313 ià(*
Ëá_avažabË
)

315 
i
 = 1; i < 
ü_MB_y
 + 1; ++i)

316 
P»dP–U
[
i
 + 
ü_MB_x
] = 
img_’c_u
[
pix_a
[i].
pos_y
][pix_a[i].
pos_x
];

317 
i
 = 1; i < 
ü_MB_y
 + 1; ++i)

318 
P»dP–V
[
i
 + 
ü_MB_x
] = 
img_’c_v
[
pix_a
[i].
pos_y
][pix_a[i].
pos_x
];

322 
i
 = 
ü_MB_x
 + 1; i < cr_MB_x + 
ü_MB_y
 + 1; ++i)

323 
P»dP–U
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

324 
i
 = 
ü_MB_x
 + 1; i < cr_MB_x + 
ü_MB_y
 + 1; ++i)

325 
P»dP–V
[
i
] = (
img³l
è
dc_´ed_v®ue_chroma
;

328 ià(*
®l_avažabË
)

330 
P»dP–U
[0] = 
img_’c_u
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
];

331 
P»dP–V
[0] = 
img_’c_v
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
];

335 
P»dP–U
[0] = 
dc_´ed_v®ue_chroma
;

336 
P»dP–V
[0] = 
dc_´ed_v®ue_chroma
;

338 
	}
}

353 
	$g‘_šŒ­»d_chroma
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
iChroma_mode
, 
Ëá_avažabË
, 
up_avažabË
)

355 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

356 
img³l
 *
P»dP–
 = 
cu¼MB
->
šŒa16x16_´ed
[
¶
];

357 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼MB
->
p_Sliû
->
m´_16x16
[
¶
];

358 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

359 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

361 
iChroma_mode
)

363 
VERT_PRED_8
 :

364 
	`g‘_iChroma_v”tiÿl
(
cu¼_m´_16x16
[
VERT_PRED_16
], 
P»dP–
, 
ü_MB_x
, 
ü_MB_y
);

366 
HOR_PRED_8
 :

367 
	`g‘_iChroma_hÜizÚl
(
cu¼_m´_16x16
[
HOR_PRED_16
], 
P»dP–
, 
ü_MB_x
, 
ü_MB_y
);

369 
DC_PRED_8
 :

370 
	`g‘_iChroma_dc
(
cu¼_m´_16x16
[
DC_PRED_16
], 
P»dP–
, 
Ëá_avažabË
, 
up_avažabË
);

372 
PLANE_8
 :

373 
	`g‘_iChroma_¶ªe
(
cu¼_m´_16x16
[
PLANE_16
], 
P»dP–
, 
cu¼MB
->
p_Vid
->
max_img³l_v®ue
);

376 
	`´štf
("invalid…rediction mode \n");

379 
	}
}

381 
	$rdo_low_šŒa_chroma_decisiÚ_mbaff
(
Maüoblock
 *
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
[2], 
mb_avažabË_up_Ëá
)

383 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

384 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

385 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

386 
i
, 
j
, 
uv
;

387 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

388 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

389 
block_x
, 
block_y
;

390 
Pix–Pos
 
pix_a
[17];

391 
img³l
 **
image
 = 
NULL
;

392 
img³l
 ***
cu¼_m´_16x16
 = 
NULL
;

395 
diff
 [16];

396 *
p_diff
;

397 
di¡blk
 
co¡
, 
mš_co¡
 = 
DISTBLK_MAX
;

398 
mode
;

399 
be¡_mode
 = 
DC_PRED_8
;

400 
img³l
 *
img_Üg
 = 
NULL
, *
img_´d
 = NULL;

402 
i
=0;i<
ü_MB_y
;i++)

404 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , 
i
,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
[i]);

407 iàÐ
p_Vid
->
mb_aff_äame_æag
 &&…_Vid->
f›ld_mode
 )

409 
i
=0;i<
ü_MB_y
;i++)

411 
pix_a
[
i
].
pos_y
 =…ix_a[i].pos_y >> 1;

415 
mode
=
DC_PRED_8
; mode<=
PLANE_8
; mode++)

417 ià(((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
è|| !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
mode
!=
DC_PRED_8
)

420 ià((
mode
==
VERT_PRED_8
 && !
mb_avažabË_up
) ||

421 (
mode
==
HOR_PRED_8
 && (!
mb_avažabË_Ëá
[0] || !mb_available_left[1])) ||

422 (
mode
==
PLANE_8
 && (!
mb_avažabË_Ëá
[0] || !mb_avažabË_Ëá[1] || !
mb_avažabË_up
 || !
mb_avažabË_up_Ëá
)))

425 
co¡
 = 0;

426 
uv
 = 1; uv < 3; uv++)

428 
image
 = 
p_Vid
->
pImgOrg
[
uv
];

429 
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
];

431 
block_y
 = 0; block_y < 
ü_MB_y
; block_y += 4)

433 
block_x
 = 0; block_x < 
ü_MB_x
; block_x += 4)

435 
p_diff
 = &
diff
[0];

436 
j
 = 
block_y
; j < block_y + 4; j++)

438 
img_´d
 = 
cu¼_m´_16x16
[
mode
][
j
];

439 
img_Üg
 = &
image
[
pix_a
[
j
].
pos_y
][pix_a[j].
pos_x
];

440 
i
 = 
block_x
; i < block_x + 4; i++)

441 *
p_diff
++ = 
img_Üg
[
i
] - 
img_´d
[i];

443 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
(
diff
, 
mš_co¡
);

444 ià(
co¡
 > 
mš_co¡
) ;

446 ià(
co¡
 > 
mš_co¡
) ;

448 ià(
co¡
 > 
mš_co¡
) ;

450 ià(
co¡
 < 
mš_co¡
)

452 
be¡_mode
 = 
mode
;

453 
mš_co¡
 = 
co¡
;

456 
cu¼MB
->
c_»d_mode
 = (è
be¡_mode
;

457 
	}
}

460 
	$rdo_low_šŒa_chroma_decisiÚ
(
Maüoblock
 *
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
[2], 
mb_avažabË_up_Ëá
)

462 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

463 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

464 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

465 
uv
;

466 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

467 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

468 
block_x
, 
block_y
;

469 
Pix–Pos
 
pix_a
;

471 
img³l
 **
image
 = 
NULL
;

472 
img³l
 ***
cu¼_m´_16x16
 = 
NULL
;

474 
diff
 [16];

476 
di¡blk
 
co¡
, 
mš_co¡
 = 
DISTBLK_MAX
;

477 
mode
;

478 
be¡_mode
 = 
DC_PRED_8
;

480 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , 0,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
);

482 
mode
 = 
DC_PRED_8
; mod<ð
PLANE_8
; mode++)

484 ià(((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
è|| !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
mode
!=
DC_PRED_8
)

487 ià((
mode
==
VERT_PRED_8
 && !
mb_avažabË_up
) ||

488 (
mode
==
HOR_PRED_8
 && (!
mb_avažabË_Ëá
[0] || !mb_available_left[1])) ||

489 (
mode
==
PLANE_8
 && (!
mb_avažabË_Ëá
[0] || !mb_avažabË_Ëá[1] || !
mb_avažabË_up
 || !
mb_avažabË_up_Ëá
)))

492 
co¡
 = 0;

494 
uv
 = 1; uv < 3; uv++)

496 
pos_x
 = 
pix_a
.pos_x;

497 
pos_y
 = 
pix_a
.pos_y;

498 
image
 = 
p_Vid
->
pImgOrg
[
uv
];

499 
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
];

501 
block_y
 = 0; block_y < 
ü_MB_y
; block_y +ð
BLOCK_SIZE
)

503 
block_x
 = 0; block_x < 
ü_MB_x
; block_x +ð
BLOCK_SIZE
)

505 
	`g‘_difã»nû_4x4
(&
image
[
pos_y
 + 
block_y
], &
cu¼_m´_16x16
[
mode
][block_y], 
diff
, 
pos_x
, 
block_x
);

506 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
(
diff
, 
mš_co¡
);

507 ià(
co¡
 > 
mš_co¡
) ;

509 ià(
co¡
 > 
mš_co¡
) ;

511 ià(
co¡
 > 
mš_co¡
) ;

514 ià(
co¡
 < 
mš_co¡
)

516 
be¡_mode
 = 
mode
;

517 
mš_co¡
 = 
co¡
;

520 
cu¼MB
->
c_»d_mode
 = (è
be¡_mode
;

521 
	}
}

530 
	$šŒa_chroma_´ediùiÚ
 (
Maüoblock
 *
cu¼MB
, *
mb_up
, *
mb_Ëá
, *
mb_up_Ëá
)

532 
s
, 
i
, 
j
;

534 
uv
;

535 
b8
, 
b4
;

536 
img³l
 
vlše
[16];

538 
mb_avažabË_up
;

539 
mb_avažabË_Ëá
[2];

540 
mb_avažabË_up_Ëá
;

542 
Pix–Pos
 
pix_c
;

543 
Pix–Pos
 
pix_d
;

544 
Pix–Pos
 
pix_a
;

546 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

547 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

548 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

549 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

550 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

551 
img³l
 **
cur_´ed
 = 
NULL
;

553 
img³l
 *
hlše
 = 
NULL
;

555 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

556 
dc_´ed_v®ue_chroma
 = 
p_Vid
->
dc_´ed_v®ue_comp
[1];

557 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

559 cÚ¡ 
block_pos
[3][4][4]=

566 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, -1,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_d
);

567 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1, 0,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
);

568 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, -1,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_c
);

570 
mb_avažabË_up
 = 
pix_c
.
avažabË
;

571 
mb_avažabË_up_Ëá
 = 
pix_d
.
avažabË
;

572 
mb_avažabË_Ëá
[0] = mb_avažabË_Ëá[1] = 
pix_a
.
avažabË
;

574 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

576 
mb_avažabË_up
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_c.
mb_addr
] : 0;

577 
mb_avažabË_Ëá
[0] = mb_avažabË_Ëá[1] = 
pix_a
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a.
mb_addr
] : 0;

578 
mb_avažabË_up_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_d.
mb_addr
] : 0;

581 ià(
mb_up
)

582 *
mb_up
 = 
mb_avažabË_up
;

583 ià(
mb_Ëá
)

584 *
mb_Ëá
 = 
mb_avažabË_Ëá
[0];

585 ià(
mb_up_Ëá
)

586 *
mb_up_Ëá
 = 
mb_avažabË_up_Ëá
;

589 
uv
=0; uv<2; uv++)

591 
img³l
 **
image
 = 
p_Vid
->
’c_piùu»
->
imgUV
[
uv
];

592 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
 + 1];

595 
b8
=0; b8<
p_Vid
->
num_blk8x8_uv
 >> 1;b8++)

597 
b4
 = 0; b4 < 4; b4++)

599 
block_y
 = 
subblk_off£t_y
[
yuv
][
b8
][
b4
];

600 
block_x
 = 
subblk_off£t_x
[
yuv
][
b8
][
b4
];

601 
blk_x
 = 
block_x
;

603 
s
 = 
dc_´ed_v®ue_chroma
;

606 
block_pos
[
yuv
][
b8
][
b4
])

610 
s0
 = 0, 
s2
 = 0;

611 ià(
mb_avažabË_up
)

613 
pos_x
 = 
pix_c
.pos_x + 
blk_x
;

614 
pos_y
 = 
pix_c
.pos_y;

616 
i
 = 0; i < 
BLOCK_SIZE
; i++)

617 
s0
 +ð
image
[
pos_y
][
pos_x
++];

619 ià(
mb_avažabË_Ëá
[0])

621 
pos_x
 = 
pix_a
.pos_x;

622 
pos_y
 = 
pix_a
.pos_y + 
block_y
;

624 
i
 = 0; i < 
BLOCK_SIZE
;i++)

625 
s2
 +ð
image
[
pos_y
++][
pos_x
];

627 ià(
mb_avažabË_up
 && 
mb_avažabË_Ëá
[0])

628 
s
 = (
s0
 + 
s2
 + 4) >> 3;

629 ià(
mb_avažabË_up
)

630 
s
 = (
s0
 + 2) >> 2;

631 ià(
mb_avažabË_Ëá
[0])

632 
s
 = (
s2
 + 2) >> 2;

637 
s1
 = 0, 
s2
 = 0;

638 ià(
mb_avažabË_up
)

640 
pos_x
 = 
pix_c
.pos_x + 
blk_x
;

641 
pos_y
 = 
pix_c
.pos_y;

642 
i
 = 0; i < 
BLOCK_SIZE
; i++)

643 
s1
 +ð
image
[
pos_y
][
pos_x
++];

645 ià(
mb_avažabË_Ëá
[0])

647 
pos_x
 = 
pix_a
.pos_x;

648 
pos_y
 = 
pix_a
.pos_y + 
block_y
;

650 
i
 = 0; i < 
BLOCK_SIZE
; i++)

651 
s2
 +ð
image
[
pos_y
++][
pos_x
];

653 ià(
mb_avažabË_up
)

654 
s
 = (
s1
 +2) >> 2;

655 ià(
mb_avažabË_Ëá
[0])

656 
s
 = (
s2
 +2) >> 2;

660 ià(
mb_avažabË_Ëá
[0])

662 
pos_x
 = 
pix_a
.pos_x;

663 
pos_y
 = 
pix_a
.pos_y + 
block_y
;

664 
s3
 = 0;

666 
i
 = 0; i < 
BLOCK_SIZE
; i++)

667 
s3
 +ð
image
[
pos_y
++][
pos_x
];

668 
s
 = (
s3
 + 2) >> 2;

670 ià(
mb_avažabË_up
)

672 
pos_x
 = 
pix_c
.pos_x + 
blk_x
;

673 
pos_y
 = 
pix_c
.pos_y;

675 
s0
 = 0;

676 
i
 = 0; i < 
BLOCK_SIZE
; i++)

677 
s0
 +ð
image
[
pos_y
][
pos_x
++];

678 
s
 = (
s0
 + 2) >> 2;

683 
s1
 = 0, 
s3
 = 0;

684 ià(
mb_avažabË_up
)

685 
i
=
blk_x
;i<(blk_x+4);i++)

686 
s1
 +ð
image
[
pix_c
.
pos_y
][pix_c.
pos_x
 + 
i
];

687 ià(
mb_avažabË_Ëá
[0])

689 
pos_x
 = 
pix_a
.pos_x;

690 
pos_y
 = 
pix_a
.pos_y + 
block_y
;

691 
i
 = 0; i < 
BLOCK_SIZE
;i++)

692 
s3
 +ð
image
[
pos_y
++][
pos_x
];

694 ià(
mb_avažabË_up
 && 
mb_avažabË_Ëá
[0])

695 
s
 = (
s1
 + 
s3
 + 4) >> 3;

696 ià(
mb_avažabË_up
)

697 
s
 = (
s1
 + 2) >> 2;

698 ià(
mb_avažabË_Ëá
[0])

699 
s
 = (
s3
 + 2) >> 2;

705 
cur_´ed
 = 
cu¼_m´_16x16
[
DC_PRED_8
];

706 
j
 = 
block_y
; j < block_y+4; j++)

708 
i
 = 
block_x
; i < block_x+4; i++)

710 
cur_´ed
[
j
][
i
] = (
img³l
è
s
;

717 ià(
mb_avažabË_up
)

719 
cur_´ed
 = 
cu¼_m´_16x16
[
VERT_PRED_8
];

720 
hlše
 = &
image
[
pix_c
.
pos_y
][pix_c.
pos_x
];

721 
j
=0; j<
ü_MB_y
; j++)

722 
	`memýy
(
cur_´ed
[
j
], 
hlše
, 
ü_MB_x
 * (
img³l
));

726 ià(
mb_avažabË_Ëá
[0])

728 
pos_x
 = 
pix_a
.pos_x;

729 
pos_y
 = 
pix_a
.pos_y;

730 
cur_´ed
 = 
cu¼_m´_16x16
[
HOR_PRED_8
];

731 
i
=0; i<
ü_MB_y
; i++)

732 
vlše
[
i
] = 
image
[
pos_y
++][
pos_x
];

734 
j
=0; j<
ü_MB_y
; j++)

736 
´ediùÜ
 = 
vlše
[
j
];

737 
i
 = 0; i < 
ü_MB_x
; i++)

738 
cur_´ed
[
j
][
i
] = (
img³l
è
´ediùÜ
;

743 ià(
mb_avažabË_Ëá
[0] && 
mb_avažabË_up
 && 
mb_avažabË_up_Ëá
)

745 
ü_x
 = (
ü_MB_x
 >> 1);

746 
ü_y
 = (
ü_MB_y
 >> 1);

748 
Ÿa
, 
iv
, 
ib
, 
ic
;

749 
ih
 = 
ü_x
 * (
hlše
[
ü_MB_x
-1] - 
image
[
pix_d
.
pos_y
][pix_d.
pos_x
]);

751 
i
 = 0; i < 
ü_x
 - 1; i++)

752 
ih
 +ð(
i
 + 1)*(
hlše
[
ü_x
 + i] - hline[cr_x - 2 - i]);

754 
iv
 = 
ü_y
 * (
vlše
[
ü_MB_y
-1] - 
image
[
pix_d
.
pos_y
][pix_d.
pos_x
]);

755 
i
 = 0; i < 
ü_y
 - 1; i++)

756 
iv
 +ð(
i
 + 1è* (
vlše
[
ü_y
 + i] - vline[cr_y - 2 - i]);

758 ià(
ü_MB_x
 == 8)

759 
ib
 = (17 * 
ih
 + 2 * 
ü_MB_x
) >> 5;

761 
ib
 = ( 5 * 
ih
 + 2 * 
ü_MB_x
) >> 6;

763 ià(
ü_MB_y
 == 8)

764 
ic
 = (17 * 
iv
 + 2 * 
ü_MB_y
) >> 5;

766 
ic
 = ( 5 * 
iv
 + 2 * 
ü_MB_y
) >> 6;

768 
Ÿa
 = 16 * (
hlše
[
ü_MB_x
 - 1] + 
vlše
[
ü_MB_y
 - 1]);

769 
cur_´ed
 = 
cu¼_m´_16x16
[
PLANE_8
];

770 
Ÿa
 +ð(1 - 
ü_x
è* 
ib
 + (1 - 
ü_y
è* 
ic
;

771 
j
 = 0; j < 
ü_MB_y
; j++)

772 
i
 = 0; i < 
ü_MB_x
; i++)

773 
cur_´ed
[
j
][
i
]ð(
img³l
è
	`iCl1
Ð
max_img³l_v®ue_uv
, (
Ÿa
 + i * 
ib
 + j * 
ic
 + 16)>>5);

777 ià(!
p_IÅ
->
rdÝt
)

779 
cu¼Sliû
->
	`rdo_low_šŒa_chroma_decisiÚ
(
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
, 
mb_avažabË_up_Ëá
);

781 
	}
}

789 
	$šŒa_chroma_´ediùiÚ_mbaff
(
Maüoblock
 *
cu¼MB
, *
mb_up
, *
mb_Ëá
, *
mb_up_Ëá
)

791 
s
, 
i
, 
j
;

793 
uv
;

794 
b8
,
b4
;

795 
img³l
 
vlše
[16];

797 
mb_avažabË_up
;

798 
mb_avažabË_Ëá
[2];

799 
mb_avažabË_up_Ëá
;

801 
Pix–Pos
 
pix_b
;

802 
Pix–Pos
 
pix_a
[17];

804 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

805 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

806 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

807 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

808 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

809 
img³l
 **
cur_´ed
 = 
NULL
;

810 
img³l
 ***
cu¼_m´_16x16
 = 
NULL
;

811 
img³l
 *
hlše
 = 
NULL
;

813 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

814 
dc_´ed_v®ue_chroma
 = 
p_Vid
->
dc_´ed_v®ue_comp
[1];

815 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

816 *
mb_size
 = 
p_Vid
->mb_size[
IS_CHROMA
];

818 cÚ¡ 
block_pos
[3][4][4]=

825 
i
 = 0; i < 
ü_MB_y
 + 1; ++i)

827 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , 
i
-1 , 
mb_size
, &
pix_a
[i]);

830 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , -1 , 
mb_size
, &
pix_b
);

832 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 == 0)

834 
mb_avažabË_up
 = 
pix_b
.
avažabË
;

835 
mb_avažabË_up_Ëá
 = 
pix_a
[0].
avažabË
;

836 
mb_avažabË_Ëá
[0] = mb_avažabË_Ëá[1] = 
pix_a
[1].
avažabË
;

840 
mb_avažabË_up
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

841 
i
=0, 
mb_avažabË_Ëá
[0] = 1; i < (
ü_MB_y
 >> 1); i++)

842 
mb_avažabË_Ëá
[0] &ð
pix_a
[
i
 + 1].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i+1].
mb_addr
]: 0;

843 
i
=(
ü_MB_y
>>1), 
mb_avažabË_Ëá
[1]=1; i<cr_MB_y;i++)

844 
mb_avažabË_Ëá
[1] &ð
pix_a
[
i
+1].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i+1].
mb_addr
]: 0;

845 
mb_avažabË_up_Ëá
 = 
pix_a
[0].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[0].
mb_addr
]: 0;

848 ià(
mb_up
)

849 *
mb_up
 = 
mb_avažabË_up
;

850 ià(
mb_Ëá
)

851 *
mb_Ëá
 = 
mb_avažabË_Ëá
[0] && mb_available_left[1];

852 ià(
mb_up_Ëá
)

853 *
mb_up_Ëá
 = 
mb_avažabË_up_Ëá
;

857 
uv
=0; uv<2; uv++)

859 
img³l
 **
image
 = 
p_Vid
->
’c_piùu»
->
imgUV
[
uv
];

860 
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
 + 1];

863 
b8
=0; b8<
p_Vid
->
num_blk8x8_uv
 >> 1;b8++)

865 
b4
 = 0; b4 < 4; b4++)

867 
block_y
 = 
subblk_off£t_y
[
yuv
][
b8
][
b4
];

868 
block_x
 = 
subblk_off£t_x
[
yuv
][
b8
][
b4
];

869 
blk_x
 = 
block_x
;

870 
blk_y
 = 
block_y
 + 1;

872 
s
 = 
dc_´ed_v®ue_chroma
;

875 
block_pos
[
yuv
][
b8
][
b4
])

879 
s0
 = 0, 
s2
 = 0;

880 ià(
mb_avažabË_up
)

881 
i
 = 
blk_x
; i < (blk_x + 4); i++)

882 
s0
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

883 ià(
mb_avažabË_Ëá
[0])

884 
i
 = 
blk_y
; i < (blk_y + 4);i++)

885 
s2
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

886 ià(
mb_avažabË_up
 && 
mb_avažabË_Ëá
[0])

887 
s
 = (
s0
 + 
s2
 + 4) >> 3;

888 ià(
mb_avažabË_up
)

889 
s
 = (
s0
 + 2) >> 2;

890 ià(
mb_avažabË_Ëá
[0])

891 
s
 = (
s2
 + 2) >> 2;

896 
s1
 = 0, 
s2
 = 0;

897 ià(
mb_avažabË_up
)

898 
i
=
blk_x
;i<(blk_x+4);i++)

899 
s1
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

900 ià(
mb_avažabË_Ëá
[0])

901 
i
=
blk_y
;i<(blk_y+4);i++)

902 
s2
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

903 ià(
mb_avažabË_up
)

904 
s
 = (
s1
 +2) >> 2;

905 ià(
mb_avažabË_Ëá
[0])

906 
s
 = (
s2
 +2) >> 2;

910 ià(
mb_avažabË_Ëá
[0])

912 
s3
 = 0;

913 
i
=
blk_y
;i<(blk_y+4);i++)

914 
s3
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

915 
s
 = (
s3
 + 2) >> 2;

917 ià(
mb_avažabË_up
)

919 
s0
 = 0;

920 
i
=
blk_x
;i<(blk_x+4);i++)

921 
s0
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

922 
s
 = (
s0
 + 2) >> 2;

927 
s1
 = 0, 
s3
 = 0;

928 ià(
mb_avažabË_up
)

929 
i
=
blk_x
;i<(blk_x+4);i++)

930 
s1
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

931 ià(
mb_avažabË_Ëá
[0])

932 
i
=
blk_y
;i<(blk_y+4);i++)

933 
s3
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

934 ià(
mb_avažabË_up
 && 
mb_avažabË_Ëá
[0])

935 
s
 = (
s1
 + 
s3
 + 4) >> 3;

936 ià(
mb_avažabË_up
)

937 
s
 = (
s1
 + 2) >> 2;

938 ià(
mb_avažabË_Ëá
[0])

939 
s
 = (
s3
 + 2) >> 2;

944 ià(
mb_avažabË_Ëá
[1])

946 
s3
 = 0;

947 
i
=
blk_y
;i<(blk_y+4);i++)

948 
s3
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

949 
s
 = (
s3
 + 2) >> 2;

951 ià(
mb_avažabË_up
)

953 
s0
 = 0;

954 
i
=
blk_x
;i<(blk_x+4);i++)

955 
s0
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

956 
s
 = (
s0
 + 2) >> 2;

961 
s1
 = 0, 
s3
 = 0;

962 ià(
mb_avažabË_up
)

963 
i
=
blk_x
;i<(blk_x+4);i++)

964 
s1
 +ð
image
[
pix_b
.
pos_y
][pix_b.
pos_x
 + 
i
];

965 ià(
mb_avažabË_Ëá
[1])

966 
i
=
blk_y
;i<(blk_y+4);i++)

967 
s3
 +ð
image
[
pix_a
[
i
].
pos_y
][pix_a[i].
pos_x
];

968 ià(
mb_avažabË_up
 && 
mb_avažabË_Ëá
[1])

969 
s
 = (
s1
 + 
s3
 + 4) >> 3;

970 ià(
mb_avažabË_up
)

971 
s
 = (
s1
 + 2) >> 2;

972 ià(
mb_avažabË_Ëá
[1])

973 
s
 = (
s3
 + 2) >> 2;

979 
cur_´ed
 = 
cu¼_m´_16x16
[
DC_PRED_8
];

980 
j
 = 
block_y
; j < block_y+4; j++)

982 
i
 = 
block_x
; i < block_x+4; i++)

984 
cur_´ed
[
j
][
i
] = (
img³l
è
s
;

991 ià(
mb_avažabË_up
)

993 
cur_´ed
 = 
cu¼_m´_16x16
[
VERT_PRED_8
];

994 
hlše
 = &
image
[
pix_b
.
pos_y
][pix_b.
pos_x
];

995 
j
=0; j<
ü_MB_y
; j++)

996 
	`memýy
(
cur_´ed
[
j
], 
hlše
, 
ü_MB_x
 * (
img³l
));

1000 ià(
mb_avažabË_Ëá
[0] && mb_available_left[1])

1002 
cur_´ed
 = 
cu¼_m´_16x16
[
HOR_PRED_8
];

1003 
i
=0; i<
ü_MB_y
; i++)

1004 
vlše
[
i
] = 
image
[
pix_a
[i+1].
pos_y
][pix_a[i+1].
pos_x
];

1005 
j
=0; j<
ü_MB_y
; j++)

1007 
´ediùÜ
 = 
vlše
[
j
];

1008 
i
=0; i<
ü_MB_x
; i++)

1009 
cur_´ed
[
j
][
i
] = (
img³l
è
´ediùÜ
;

1014 ià(
mb_avažabË_Ëá
[0] && mb_avažabË_Ëá[1] && 
mb_avažabË_up
 && 
mb_avažabË_up_Ëá
)

1016 
ü_x
 = (
ü_MB_x
 >> 1);

1017 
ü_y
 = (
ü_MB_y
 >> 1);

1019 
Ÿa
, 
iv
, 
ib
, 
ic
;

1020 
ih
 = 
ü_x
 * (
hlše
[
ü_MB_x
-1] - 
image
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
]);

1021 
i
 = 0; i < 
ü_x
 - 1; i++)

1022 
ih
 +ð(
i
+1)*(
hlše
[
ü_x
 + i] - hline[cr_x - 2 - i]);

1024 
iv
 = 
ü_y
 * (
vlše
[
ü_MB_y
-1] - 
image
[
pix_a
[0].
pos_y
][pix_a[0].
pos_x
]);

1025 
i
 = 0; i < 
ü_y
 - 1; i++)

1026 
iv
 +ð(
i
 + 1è* (
vlše
[
ü_y
 + i] - vline[cr_y - 2 - i]);

1028 ià(
ü_MB_x
 == 8)

1029 
ib
 = (17 * 
ih
 + 2 * 
ü_MB_x
) >> 5;

1031 
ib
 = ( 5 * 
ih
 + 2 * 
ü_MB_x
) >> 6;

1032 ià(
ü_MB_y
 == 8)

1033 
ic
 = (17 * 
iv
 + 2 * 
ü_MB_y
) >> 5;

1035 
ic
 = ( 5 * 
iv
 + 2 * 
ü_MB_y
) >> 6;

1037 
Ÿa
 = 16 * (
hlše
[
ü_MB_x
 - 1] + 
vlše
[
ü_MB_y
 - 1]);

1038 
cur_´ed
 = 
cu¼_m´_16x16
[
PLANE_8
];

1039 
Ÿa
 +ð(1 - 
ü_x
è* 
ib
 + (1 - 
ü_y
è* 
ic
;

1040 
j
 = 0; j < 
ü_MB_y
; j++)

1041 
i
 = 0; i < 
ü_MB_x
; i++)

1042 
cur_´ed
[
j
][
i
]ð(
img³l
è
	`iCl1
Ð
max_img³l_v®ue_uv
, (
Ÿa
 + i * 
ib
 + j * 
ic
 + 16)>>5);

1046 ià(!
p_IÅ
->
rdÝt
)

1048 
cu¼Sliû
->
	`rdo_low_šŒa_chroma_decisiÚ
(
cu¼MB
, 
mb_avažabË_up
, 
mb_avažabË_Ëá
, 
mb_avažabË_up_Ëá
);

1050 
	}
}

1058 
	$šŒa_chroma_RD_decisiÚ
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *
’c_mb
)

1060 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1061 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1062 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1063 
img³l
** 
image
;

1064 
block_x
, 
block_y
;

1065 
mb_avažabË_up
;

1066 
mb_avažabË_Ëá
;

1067 
mb_avažabË_up_Ëá
;

1068 
uv
;

1069 
mode
;

1070 
be¡_mode
 = 
DC_PRED_8
;

1071 
di¡blk
 
co¡
;

1073 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

1075 
Pix–Pos
 
pix_a
;

1076 
Pix–Pos
 
pix_b
;

1077 
Pix–Pos
 
pix_c
;

1078 
Pix–Pos
 
pix_d
;

1079 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

1080 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

1081 
img³l
 ***
cu¼_m´_16x16
;

1083 
diff
 [16];

1085 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , -1 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_b
);

1086 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , 0 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_d
);

1087 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , -1 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_c
);

1088 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , 0 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
);

1090 
mb_avažabË_up
 = 
pix_c
.
avažabË
;

1091 
mb_avažabË_up_Ëá
 = 
pix_b
.
avažabË
;

1092 
mb_avažabË_Ëá
 = 
pix_d
.
avažabË
;

1094 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

1096 
mb_avažabË_up
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_c.
mb_addr
] : 0;

1097 
mb_avažabË_Ëá
 = 
pix_d
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_d.
mb_addr
] : 0;

1098 
mb_avažabË_up_Ëá
 = 
pix_b
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_b.
mb_addr
] : 0;

1102 
mode
 = 
DC_PRED_8
; mod<ð
PLANE_8
; ++mode)

1104 ià((
mode
==
VERT_PRED_8
 && !
mb_avažabË_up
) ||

1105 (
mode
==
HOR_PRED_8
 && (!
mb_avažabË_Ëá
)) ||

1106 (
mode
==
PLANE_8
 && (!
mb_avažabË_Ëá
 || !
mb_avažabË_up
 || !
mb_avažabË_up_Ëá
)))

1109 
co¡
 = 
	`weight_co¡
(
’c_mb
->
Ïmbda_mf
[
Q_PEL
], 
p_Vid
->
mvb™s
[ 
mode
 ]);

1111 
uv
 = 1; uv < 3; ++uv)

1113 
pos_x
 = 
pix_a
.pos_x;

1114 
pos_y
 = 
pix_a
.pos_y;

1115 
image
 = 
p_Vid
->
pImgOrg
[
uv
];

1116 
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
];

1118 
block_y
=0; block_y<
ü_MB_y
; block_y+=4)

1120 
block_x
=0; block_x<
ü_MB_x
; block_x+=4)

1122 
	`g‘_difã»nû_4x4
(&
image
[
pos_y
 + 
block_y
], &
cu¼_m´_16x16
[
mode
][block_y], 
diff
, 
pos_x
, 
block_x
);

1123 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
(
diff
, 
mš_co¡
);

1124 ià(
co¡
 > 
mš_co¡
) ;

1126 ià(
co¡
 > 
mš_co¡
) ;

1128 ià(
co¡
 > 
mš_co¡
) ;

1131 ià(
co¡
 < 
mš_co¡
)

1133 
be¡_mode
 = 
mode
;

1134 
mš_co¡
 = 
co¡
;

1137 
cu¼MB
->
c_»d_mode
 = (è
be¡_mode
;

1138 
	}
}

1146 
	$šŒa_chroma_RD_decisiÚ_mbaff
 (
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *
’c_mb
)

1148 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1149 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1150 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1151 
i
, 
j
, 
k
;

1152 
img³l
** 
image
;

1153 
block_x
, 
block_y
;

1154 
mb_avažabË_up
;

1155 
mb_avažabË_Ëá
[2];

1156 
mb_avažabË_up_Ëá
;

1157 
uv
;

1158 
mode
;

1159 
be¡_mode
 = 
DC_PRED_8
;

1160 
di¡blk
 
co¡
;

1162 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

1164 
Pix–Pos
 
pix_c
;

1165 
Pix–Pos
 
pix_a
[17];

1166 
ü_MB_x
 = 
p_Vid
->
mb_ü_size_x
;

1167 
ü_MB_y
 = 
p_Vid
->
mb_ü_size_y
;

1168 
img³l
 *
img_Üg
, *
img_´d
;

1169 
img³l
 ***
cu¼_m´_16x16
;

1170 
diff
 [16];

1172 
i
=0;i<
ü_MB_y
+1;++i)

1174 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , 
i
-1 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
[i]);

1176 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , -1 ,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_c
);

1178 
mb_avažabË_up
 = 
pix_c
.
avažabË
;

1179 
mb_avažabË_up_Ëá
 = 
pix_a
[0].
avažabË
;

1180 
mb_avažabË_Ëá
[0] = mb_avažabË_Ëá[1] = 
pix_a
[1].
avažabË
;

1182 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

1184 
mb_avažabË_up
 = 
pix_c
.
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_c.
mb_addr
] : 0;

1185 
i
=1, 
mb_avažabË_Ëá
[0] = 1; i < (
ü_MB_y
>>1) + 1; ++i)

1186 
mb_avažabË_Ëá
[0] &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

1188 
i
=(
ü_MB_y
>>1è+ 1, 
mb_avažabË_Ëá
[1]=1; i < cr_MB_y + 1;++i)

1189 
mb_avažabË_Ëá
[1] &ð
pix_a
[
i
].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[i].
mb_addr
]: 0;

1191 
mb_avažabË_up_Ëá
 = 
pix_a
[0].
avažabË
 ? 
p_Vid
->
šŒa_block
[pix_a[0].
mb_addr
]: 0;

1194 
i
=0;i<
ü_MB_y
;++i)

1196 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0, 
i
,…_Vid->
mb_size
[
IS_CHROMA
], &
pix_a
[i]);

1198 iàÐ
cu¼Sliû
->
mb_aff_äame_æag
 && 
p_Vid
->
f›ld_mode
 )

1200 
i
=0;i<
ü_MB_y
;++i)

1202 
pix_a
[
i
].
pos_y
 =…ix_a[i].pos_y >> 1;

1206 
mode
=
DC_PRED_8
; mode<=
PLANE_8
; ++mode)

1208 ià((
mode
==
VERT_PRED_8
 && !
mb_avažabË_up
) ||

1209 (
mode
==
HOR_PRED_8
 && (!
mb_avažabË_Ëá
[0] || !mb_available_left[1])) ||

1210 (
mode
==
PLANE_8
 && (!
mb_avažabË_Ëá
[0] || !mb_avažabË_Ëá[1] || !
mb_avažabË_up
 || !
mb_avažabË_up_Ëá
)))

1213 
co¡
 = 0;

1214 
uv
 = 1; uv < 3; ++uv)

1216 
image
 = 
p_Vid
->
pImgOrg
[
uv
];

1217 
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
];

1218 
block_y
=0; block_y<
ü_MB_y
; block_y+=4)

1220 
block_x
=0; block_x<
ü_MB_x
; block_x+=4)

1222 
k
=0,
j
=
block_y
; j<block_y+4; ++j)

1224 
img_´d
 = 
cu¼_m´_16x16
[
mode
][
j
];

1225 
img_Üg
 = &
image
[
pix_a
[
j
].
pos_y
][pix_a[j].
pos_x
];

1227 
i
 = 
block_x
; i < block_x + 4; ++i)

1228 
diff
[
k
++] = 
img_Üg
[
i
] - 
img_´d
[i];

1231 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
(
diff
, 
mš_co¡
);

1232 ià(
co¡
 > 
mš_co¡
) ;

1234 ià(
co¡
 > 
mš_co¡
) ;

1236 ià(
co¡
 > 
mš_co¡
) ;

1240 
co¡
 +ð
	`weight_co¡
(
’c_mb
->
Ïmbda_mf
[
Q_PEL
], 
p_Vid
->
mvb™s
[ 
mode
 ]);

1242 ià(
co¡
 < 
mš_co¡
)

1244 
be¡_mode
 = 
mode
;

1245 
mš_co¡
 = 
co¡
;

1248 
cu¼MB
->
c_»d_mode
 = (è
be¡_mode
;

1249 
	}
}

	@lencod/src/intrarefresh.c

17 
	~"glob®.h
"

34 
	$RªdomIÁ¿In™
(
VideoP¬am‘”s
 *
p_Vid
, 
xsize
, 
ysize
, 
»äesh
)

36 
i
, 
pos
;

38 
	`¤ªd
 (1);

39 
p_Vid
->
Numb”OfMBs
 = 
xsize
 * 
ysize
;

40 
p_Vid
->
Numb”IÁ¿P”Piùu»
 = 
»äesh
;

42 ià(
»äesh
 != 0)

44 
p_Vid
->
ReäeshP©‹º
 = 
	`m®loc
 ( (è*…_Vid->
Numb”OfMBs
);

45 ià(
p_Vid
->
ReäeshP©‹º
 =ð
NULL
è
	`no_mem_ex™
("RandomIntraInit:…_Vid->RefreshPattern");

47 
p_Vid
->
IÁ¿MBs
 = 
	`m®loc
 ( (è* 
»äesh
);

48 ià(
p_Vid
->
IÁ¿MBs
 =ð
NULL
è
	`no_mem_ex™
("RandomIntraInit:…_Vid->IntraMBs");

50 
i
ð0; i<
p_Vid
->
Numb”OfMBs
; i++)

51 
p_Vid
->
ReäeshP©‹º
[
i
] = -1;

53 
i
=0; i<
p_Vid
->
Numb”OfMBs
; i++)

57 
pos
 = 
	`¿nd
(è% 
p_Vid
->
Numb”OfMBs
;

58 } 
p_Vid
->
ReäeshP©‹º
 [
pos
] != -1);

59 
p_Vid
->
ReäeshP©‹º
 [
pos
] = 
i
;

68 
p_Vid
->
ReäeshP©‹º
 = 
NULL
;

69 
p_Vid
->
IÁ¿MBs
 = 
NULL
;

71 
	}
}

87 
	$RªdomIÁ¿
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb
)

89 
i
;

91 
i
=0; i<
p_Vid
->
Numb”IÁ¿P”Piùu»
; i++)

92 ià(
p_Vid
->
IÁ¿MBs
[
i
] =ð
mb
)

95 
	}
}

109 
	$RªdomIÁ¿NewPiùu»
 (
VideoP¬am‘”s
 *
p_Vid
)

111 
i
, 
j
;

113 
p_Vid
->
W®kAround
 +ðp_Vid->
Numb”IÁ¿P”Piùu»
;

114 
j
=0, 
i
 = 
p_Vid
->
W®kAround
; j<p_Vid->
Numb”IÁ¿P”Piùu»
; j++, i++)

115 
p_Vid
->
IÁ¿MBs
[
j
] =…_Vid->
ReäeshP©‹º
 [
i
%p_Vid->
Numb”OfMBs
];

116 
	}
}

118 
	$RªdomIÁ¿Unš™
(
VideoP¬am‘”s
 *
p_Vid
)

120 ià(
p_Vid
->
Numb”IÁ¿P”Piùu»
 >0 )

122 
	`ä“
(
p_Vid
->
ReäeshP©‹º
);

123 
	`ä“
(
p_Vid
->
IÁ¿MBs
);

125 
	}
}

	@lencod/src/lambda.c

16 
	~"glob®.h
"

17 
	~"¦iû.h
"

19 
	$S‘Lambda
(
VideoP¬am‘”s
 *
p_Vid
, 
j
, 
qp
, 
Ïmbda_sÿË
)

21 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

22 
k
;

23 
p_Vid
->
Ïmbda_md
[
j
][
qp
] *ð
Ïmbda_sÿË
;

25 
k
 = 
F_PEL
; k <ð
Q_PEL
; k++)

29 
p_Vid
->
Ïmbda_me
[
j
][
qp
][
k
] = (
p_IÅ
->
MEE¼ÜM‘ric
[k] =ð
ERROR_SSE
 &&…_IÅ->
MESoá’SSEM‘ric
 =ð0è?…_Vid->
Ïmbda_md
[j][qp] : 
	`sq¹
(p_Vid->lambda_md[j][qp]);

30 
p_Vid
->
Ïmbda_mf
[
j
][
qp
][
k
] = 
	`LAMBDA_FACTOR
 (p_Vid->
Ïmbda_me
[j][qp][k]);

32 
	}
}

34 
	$C®cMaxLamdaMD
(
VideoP¬am‘”s
 *
p_Vid
, *
p_Ïmbda_md
)

36 
max_Ïmbda_md
;

37 
iB™s
;

39 if(
p_Vid
->
p_IÅ
->
ProfžeIDC
 >ð
FREXT_HP
)

40 
iB™s
=128;

42 
iB™s
=80;

44 if(
p_Vid
->
yuv_fÜm©
 =ð
YUV420
)

45 
iB™s
 += 3072;

46 if(
p_Vid
->
yuv_fÜm©
 =ð
YUV422
)

47 
iB™s
 += 4096;

48 if(
p_Vid
->
yuv_fÜm©
 =ð
YUV444
)

49 
iB™s
 += 6144;

50 if(
p_Vid
->
yuv_fÜm©
 =ð
YUV400
)

51 
iB™s
 += 2048;

53 
max_Ïmbda_md
 = 
	`æoÜ
((()
DISTBLK_MAX
)/
iB™s
/(1<<
LAMBDA_ACCURACY_BITS
));

54 #ià
JCOST_OVERFLOWCHECK


56 
di¡blk
 
co¡
 = 
	`weight_co¡
(
	`LAMBDA_FACTOR
(
max_Ïmbda_md
), 
iB™s
);

57 
	`as£¹
(
co¡
>=0 && co¡<=
DISTBLK_MAX
);

60 *
p_Ïmbda_md
 = 
max_Ïmbda_md
;

61 
	}
}

63 
	$ClLambda
(*
p_Ïmbda_max
, *
p_Ïmbda
)

65 if(*
p_Ïmbda
 > *
p_Ïmbda_max
)

68 *
p_Ïmbda
 = *
p_Ïmbda_max
;

70 
	}
}

72 
	$£t_rdoq_Ïmbda
Ð
Sliû
 *
cu¼Sliû
 )

74 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

75 
qp
, 
j
 = 
cu¼Sliû
->
¦iû_ty³
;

77 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

79 
p_Vid
->
Ïmbda_rdoq
[
j
][
qp
] =…_Vid->
Ïmbda_md
[j][qp];

81 
	}
}

83 
	$g‘_im¶ic™_Ïmbda_p_¦iû
(
Sliû
 *
cu¼Sliû
)

85 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

86 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

87 
qp
;

88 
qp_‹mp
;

89 
Ïmbda_md
;

90 
Ïmbda_sÿË
 = 
p_IÅ
->
Di§bËDi¡ªûLambdaSÿË
 ? 1.0 : 1.0 - 
	`dCl3
(0.0,0.5,0.05 * (èp_IÅ->
jumpd
);

92 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

93 
dMaxLambdaMD
 =0;

95 if(
bLim™sLambdaMD
)

96 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

98 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

100 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

102 ià(
p_IÅ
->
Numb”BF¿mes
 > 0)

104 
Ïmbda_md
 = 0.68 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

107 
Ïmbda_md
 = 0.85 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

110 
Ïmbda_md
 = ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95) *†ambda_md;

111 
p_Vid
->
Ïmbda_md
[
P_SLICE
][
qp
] = 
Ïmbda_sÿË
 *†ambda_md;

114 if(
bLim™sLambdaMD
)

115 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
P_SLICE
][
qp
]);

117 
	`S‘Lambda
(
p_Vid
, 
P_SLICE
, 
qp
, 1.0);

119 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

121 
Ïmbda_qp
 = (
qp
 >ð32 && !
p_IÅ
->
RCEÇbË
è? 
	`imax
(0, qp - 4) : imax(0, qp - 6);

122 
p_Vid
->
Ïmbda_mf_çùÜ
[
P_SLICE
][
qp
] = 
	`log
 (p_Vid->
Ïmbda_me
[P_SLICE][
Ïmbda_qp
][
Q_PEL
] + 1.0) /†og (2.0);

125 
	}
}

127 
	$g‘_im¶ic™_Ïmbda_b_¦iû
(
Sliû
 *
cu¼Sliû
)

129 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

130 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

131 
qp
;

132 
qp_‹mp
;

133 
Ïmbda_md
;

134 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

136 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

137 
dMaxLambdaMD
 =0;

139 if(
bLim™sLambdaMD
)

140 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

142 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

144 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

146 ià(
p_IÅ
->
Numb”BF¿mes
 > 0)

148 
Ïmbda_md
 = 0.68 * 
	`pow
 (2.0, 
qp_‹mp
/3.0)

149 * (
p_cur_äm
->
Ïy”
 !ð0 ? 
	`dCl3
(2.00, 4.00, (
qp_‹mp
 / 6.0)) : 1.0);

152 
Ïmbda_md
 = 0.85 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

155 
Ïmbda_md
 = ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95) *†ambda_md;

157 ià(
p_cur_äm
->
Ïy”
 !ð0 && 
cu¼Sliû
->
Çl_»ã»nû_idc
)

159 ià(
p_IÅ
->
H›¿rchiÿlCodšg
 == 2)

160 
Ïmbda_md
 *ð(1.0 - 
	`dmš
(0.4, 0.2 * (è(
p_cur_äm
->
p_©om
->
gÝ_Ëv–s
 -…_cur_äm->
Ïy”
)));

162 
Ïmbda_md
 *= 0.80;

164 
p_Vid
->
Ïmbda_md
[
B_SLICE
][
qp
] =†ambda_md;

167 if(
bLim™sLambdaMD
)

168 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
B_SLICE
][
qp
]);

170 
	`S‘Lambda
(
p_Vid
, 
B_SLICE
, 
qp
, 1.0);

172 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

174 
Ïmbda_qp
 = (
qp
 >ð32 && !
p_IÅ
->
RCEÇbË
è? 
	`imax
(0, qp - 4) : imax(0, qp - 6);

175 
p_Vid
->
Ïmbda_mf_çùÜ
[
B_SLICE
][
qp
] = 
	`log
 (p_Vid->
Ïmbda_me
[B_SLICE][
Ïmbda_qp
][
Q_PEL
] + 1.0) /†og (2.0);

178 
	}
}

180 
	$g‘_im¶ic™_Ïmbda_i_¦iû
(
Sliû
 *
cu¼Sliû
)

182 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

183 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

184 
qp
;

185 
qp_‹mp
;

186 
Ïmbda_md
;

187 
Ïmbda_sÿË
 = 
p_IÅ
->
Di§bËDi¡ªûLambdaSÿË
 ? 1.0 : 1.0 - 
	`dCl3
(0.0,0.5,0.05 * (èp_IÅ->
jumpd
);

189 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

190 
dMaxLambdaMD
 =0;

192 if(
bLim™sLambdaMD
)

193 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

195 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

197 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

199 if(
p_IÅ
->
U£RDOQuªt
 && 
p_Vid
->
qp
==qp)

200 
Ïmbda_md
 = 0.57 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

201 ià(
p_IÅ
->
Numb”BF¿mes
 > 0)

203 
Ïmbda_md
 = 0.68 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

206 
Ïmbda_md
 = 0.85 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

209 
Ïmbda_md
 = ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95) *†ambda_md;

210 
p_Vid
->
Ïmbda_md
[
I_SLICE
][
qp
] = 
Ïmbda_sÿË
 *†ambda_md;

213 if(
bLim™sLambdaMD
)

214 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
I_SLICE
][
qp
]);

216 
	`S‘Lambda
(
p_Vid
, 
I_SLICE
, 
qp
, 1.0);

218 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

220 
Ïmbda_qp
 = (
qp
 >ð32 && !
p_IÅ
->
RCEÇbË
è? 
	`imax
(0, qp - 4) : imax(0, qp - 6);

221 
p_Vid
->
Ïmbda_mf_çùÜ
[
I_SLICE
][
qp
] = 
	`log
 (p_Vid->
Ïmbda_me
[I_SLICE][
Ïmbda_qp
][
Q_PEL
] + 1.0) /†og (2.0);

224 
	}
}

226 
	$g‘_im¶ic™_Ïmbda_¥_¦iû
(
Sliû
 *
cu¼Sliû
)

228 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

229 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

230 
qp
;

231 
qp_‹mp
;

232 
Ïmbda_md
;

233 
Ïmbda_sÿË
 = 
p_IÅ
->
Di§bËDi¡ªûLambdaSÿË
 ? 1.0 : 1.0 - 
	`dCl3
(0.0,0.5,0.05 * (èp_IÅ->
jumpd
);

235 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

236 
dMaxLambdaMD
 =0;

238 
¦iû_šdex
 = 
cu¼Sliû
->
¦iû_ty³
;

240 if(
bLim™sLambdaMD
)

241 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

243 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

245 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

247 if(
p_IÅ
->
U£RDOQuªt
 && 
p_Vid
->
ty³
 =ð
I_SLICE
 &&…_Vid->
qp
==qp)

248 
Ïmbda_md
 = 0.57 * 
	`pow
 (2.0, 
qp_‹mp
/3.0);

249 ià(
p_IÅ
->
Numb”BF¿mes
 > 0)

251 
Ïmbda_md
 = 0.68 * 
	`pow
 (2.0, 
qp_‹mp
/3.0è* 
	`dCl3
(1.4,3.0,(qp_temp / 12.0));

254 
Ïmbda_md
 = 0.85 * 
	`pow
 (2.0, 
qp_‹mp
/3.0è* 
	`dCl3
(1.4, 3.0,(qp_temp / 12.0));

257 
Ïmbda_md
 = ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95) *†ambda_md;

259 
p_Vid
->
Ïmbda_md
[
¦iû_šdex
][
qp
] = 
Ïmbda_sÿË
 *†ambda_md;

262 if(
bLim™sLambdaMD
)

263 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
¦iû_šdex
][
qp
]);

265 
	`S‘Lambda
(
p_Vid
, 
¦iû_šdex
, 
qp
, 1.0);

267 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

269 
Ïmbda_qp
 = (
qp
 >ð32 && !
p_IÅ
->
RCEÇbË
è? 
	`imax
(0, qp - 4) : imax(0, qp - 6);

270 
p_Vid
->
Ïmbda_mf_çùÜ
[
¦iû_šdex
][
qp
] = 
	`log
 (p_Vid->
Ïmbda_me
[¦iû_šdex][
Ïmbda_qp
][
Q_PEL
] + 1.0) /†og (2.0);

273 
	}
}

275 
	$g‘_ex¶ic™_Ïmbda
(
Sliû
 *
cu¼Sliû
)

277 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

278 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

279 
qp
;

280 
qp_‹mp
;

281 
Ïmbda_sÿË
 = 
p_IÅ
->
Di§bËDi¡ªûLambdaSÿË
 ? 1.0 : 1.0 - 
	`dCl3
(0.0,0.5,0.05 * (èp_IÅ->
jumpd
);

283 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

284 
dMaxLambdaMD
 =0;

285 #ià(
MVC_EXTENSION_ENABLE
)

286 
tmp_Ïmbda_md
 = 0.0;

289 
j
 = 
cu¼Sliû
->
¦iû_ty³
;

291 if(
bLim™sLambdaMD
)

292 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

294 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

296 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

298 ià(
j
 =ð
B_SLICE
 && 
cu¼Sliû
->
Çl_»ã»nû_idc
)

299 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
p_IÅ
->
LambdaWeight
[5] * 
	`pow
 (2, 
qp_‹mp
/3.0);

301 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
p_IÅ
->
LambdaWeight
[j] * 
	`pow
 (2, 
qp_‹mp
/3.0);

303 #ià(
MVC_EXTENSION_ENABLE
)

304 
tmp_Ïmbda_md
 = 
p_Vid
->
Ïmbda_md
[
j
][
qp
];

306 ià(
cu¼Sliû
->
v›w_id
)

308 
p_Vid
->
Ïmbda_md
[
j
][
qp
] =…_Vid->Ïmbda_md[j][qp] * 
p_IÅ
->
’h_Ïy”_me_Ïmbda_muÉl›r
;

313 if(
bLim™sLambdaMD
)

314 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
j
][
qp
]);

316 
	`S‘Lambda
(
p_Vid
, 
j
, 
qp
, ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95));

318 #ià(
MVC_EXTENSION_ENABLE
)

319 ià(
cu¼Sliû
->
v›w_id
)

321 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
tmp_Ïmbda_md
 * 
p_IÅ
->
’h_Ïy”_Ïmbda_muÉl›r
;

323 if(
bLim™sLambdaMD
)

324 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
j
][
qp
]);

325 
p_Vid
->
Ïmbda_md
[
j
][
qp
] *ð((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95);

330 ià(
j
 !ð
B_SLICE
)

332 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

333 
p_Vid
->
Ïmbda_md
[
j
][
qp
] *ð
Ïmbda_sÿË
;

335 
	}
}

338 
	$g‘_fixed_Ïmbda
(
Sliû
 *
cu¼Sliû
)

340 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

341 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

342 
qp
;

344 
bLim™sLambdaMD
 = ((
p_IÅ
->
EÇbËIPCM
 > 0è&& (
IMGTYPE
==0));

345 
dMaxLambdaMD
 =0;

347 
j
 = 
cu¼Sliû
->
¦iû_ty³
;

349 if(
bLim™sLambdaMD
)

350 
	`C®cMaxLamdaMD
(
p_Vid
, &
dMaxLambdaMD
);

352 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

354 ià(
j
 =ð
B_SLICE
 && 
cu¼Sliû
->
Çl_»ã»nû_idc
)

355 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
p_IÅ
->
FixedLambda
[5];

357 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
p_IÅ
->
FixedLambda
[j];

359 if(
bLim™sLambdaMD
)

360 
	`ClLambda
(&
dMaxLambdaMD
, &
p_Vid
->
Ïmbda_md
[
j
][
qp
]);

362 
	`S‘Lambda
(
p_Vid
, 
j
, 
qp
, ((
p_IÅ
->
MEE¼ÜM‘ric
[
H_PEL
] =ð
ERROR_SATD
 &&…_IÅ->MEE¼ÜM‘ric[
Q_PEL
] == ERROR_SATD) ? 1.00 : 0.95));

364 
	}
}

	@lencod/src/leaky_bucket.c

15 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

18 #ifdeà
_LEAKYBUCKET_


42 
	$g‘_L—kyBuck‘R©e
(
IÅutP¬am‘”s
 *
p_IÅ
, 
Numb”L—kyBuck‘s
, *
Rmš
)

44 
FILE
 *
f
;

45 
i
, 
buf
;

47 if((
f
 = 
	`fÝ’
(
p_IÅ
->
L—kyBuck‘R©eFže
, "r")è=ð
NULL
)

49 
	`´štf
(" LeakyBucketRate File does‚otƒxist. Using„ate calculated from‡vg.„ate \n");

53 
i
=0; i<
Numb”L—kyBuck‘s
; i++)

55 if(1 !ð
	`fsÿnf
(
f
, "%lu", &
buf
))

57 
	`´štf
(" Leaky BucketRateFile does‚ot have validƒntries.\n Using„ate calculated from‡vg.„ate \n");

58 
	`fþo£
 (
f
);

61 
Rmš
[
i
] = 
buf
;

63 
	`fþo£
 (
f
);

65 
	}
}

85 
	$PutBigDoubËWÜd
(
dw
, 
FILE
 *
å
)

87 
	`åutc
((
dw
 >> 0x18è& 0xFF, 
å
);

88 
	`åutc
((
dw
 >> 0x10è& 0xFF, 
å
);

89 
	`åutc
((
dw
 >> 0x08è& 0xFF, 
å
);

90 
	`åutc
(
dw
 & 0xFF, 
å
);

91 
	}
}

119 
	$wr™e_bufãr
(
IÅutP¬am‘”s
 *
p_IÅ
, 
Numb”L—kyBuck‘s
, 
Rmš
[], 
Bmš
[], 
Fmš
[])

121 
FILE
 *
outf
;

122 
iBuck‘
;

124 ià((
outf
 = 
	`fÝ’
(
p_IÅ
->
L—kyBuck‘P¬amFže
,"wb"))==
NULL
)

126 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³Àfžlk %  \n",
p_IÅ
->
L—kyBuck‘P¬amFže
);

127 
	`”rÜ
(
”rÜ‹xt
,1);

130 
	`PutBigDoubËWÜd
(
Numb”L—kyBuck‘s
, 
outf
);

131 ià(
p_IÅ
->
V”bo£
 != 0)

132 
	`´štf
(" Numb” L—ky Buck‘s: %ld \À Rmš Bmš Fmš \n", 
Numb”L—kyBuck‘s
);

133 
iBuck‘
 =0; iBuck‘ < 
Numb”L—kyBuck‘s
; iBucket++)

138 
	`PutBigDoubËWÜd
(
Rmš
[
iBuck‘
], 
outf
);

139 
	`PutBigDoubËWÜd
(
Bmš
[
iBuck‘
], 
outf
);

140 
	`PutBigDoubËWÜd
(
Fmš
[
iBuck‘
], 
outf
);

141 ià(
p_IÅ
->
V”bo£
 != 0)

142 
	`´štf
(" %8ld %8ld %8ld \n", 
Rmš
[
iBuck‘
], 
Bmš
[iBuck‘], 
Fmš
[iBucket]);

144 
	`fþo£
(
outf
);

145 
	}
}

165 
	$SÜt
(
Numb”L—kyBuck‘s
, *
Rmš
)

167 
i
, 
j
;

168 
‹mp
;

169 
i
=0; i< 
Numb”L—kyBuck‘s
-1; i++)

171 
j
=
i
+1; j<
Numb”L—kyBuck‘s
; j++)

173 if(
Rmš
[
i
] > Rmš[
j
])

175 
‹mp
 = 
Rmš
[
i
];

176 
Rmš
[
i
] = Rmš[
j
];

177 
Rmš
[
j
] = 
‹mp
;

181 
	}
}

198 
	$ÿlc_bufãr
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

200 
AvgR©e
, 
TÙ®R©e
, 
Numb”L—kyBuck‘s
;

201 *
bufãr_äame
, 
mšB
;

202 
iBuck‘
, 
iF¿me
, 
F¿meIndex
 = 0;

203 
maxBufãr
, 
aùu®Bufãr
, 
In™FuÎÃss
, 
iChªÃlR©e
;

204 *
Rmš
, *
Bmš
, *
Fmš
;

206 
p_IÅ
->
V”bo£
)

209 
	`årštf
(
¡dout
,"-------------------------------------------------------------------------------\n");

212 
	`årštf
(
¡dout
,"------------------------------------------------------------------------------------------------\n");

215 
	`årštf
(
¡dout
,"-------------------------------------------------------------------------------------------------------\n");

219 
	`årštf
(
¡dout
,"\n-------------------------------------------------------------------------------\n");

222 
	`´štf
(" TÙ® F¿mes: %ld \n", 
p_Vid
->
tÙ®_äame_bufãr
);

223 
Numb”L—kyBuck‘s
 = (è
p_IÅ
->NumberLeakyBuckets;

224 
bufãr_äame
 = 
	`ÿÎoc
(
p_Vid
->
tÙ®_äame_bufãr
 + 1, ());

225 if(!
bufãr_äame
)

226 
	`no_mem_ex™
("init_buffer: buffer_frame");

227 
Rmš
 = 
	`ÿÎoc
(
Numb”L—kyBuck‘s
, ());

228 if(!
Rmš
)

229 
	`no_mem_ex™
("init_buffer: Rmin");

230 
Bmš
 = 
	`ÿÎoc
(
Numb”L—kyBuck‘s
, ());

231 if(!
Bmš
)

232 
	`no_mem_ex™
("init_buffer: Bmin");

233 
Fmš
 = 
	`ÿÎoc
(
Numb”L—kyBuck‘s
, ());

234 if(!
Fmš
)

235 
	`no_mem_ex™
("init_buffer: Fmin");

237 
TÙ®R©e
 = 0;

238 
iF¿me
=0; iF¿m< 
p_Vid
->
tÙ®_äame_bufãr
; iFrame++)

240 
TÙ®R©e
 +ð(è
p_Vid
->
B™_Bufãr
[
iF¿me
];

242 
AvgR©e
 = (è((è
TÙ®R©e
/ 
p_Vid
->
tÙ®_äame_bufãr
);

244 if(1 !ð
	`g‘_L—kyBuck‘R©e
(
p_IÅ
, 
Numb”L—kyBuck‘s
, 
Rmš
))

246 
iBuck‘
=0; iBuck‘ < 
Numb”L—kyBuck‘s
; iBucket++)

248 if(
iBuck‘
 == 0)

249 
Rmš
[
iBuck‘
] = ()((è
AvgR©e
 * 
p_Vid
->
äam”©e
);

251 
Rmš
[
iBuck‘
] = (è((èRmš[iBuck‘-1] + (
AvgR©e
/4è* (
p_Vid
->
äam”©e
));

254 
	`SÜt
(
Numb”L—kyBuck‘s
, 
Rmš
);

256 
maxBufãr
 = 
AvgR©e
 * 20;

257 
iBuck‘
=0; iBuck‘< 
Numb”L—kyBuck‘s
; iBucket++)

259 
iChªÃlR©e
 = (è(
Rmš
[
iBuck‘
] / (
p_Vid
->
äam”©e
));

261 
In™FuÎÃss
 = 
maxBufãr
;

262 
bufãr_äame
[0] = 
In™FuÎÃss
;

263 
mšB
 = 
maxBufãr
;

265 
iF¿me
=0; iF¿m< 
p_Vid
->
tÙ®_äame_bufãr
 ; iFrame++)

267 
bufãr_äame
[
iF¿me
] = bufãr_äame[iF¿me] - 
p_Vid
->
B™_Bufãr
[iFrame];

268 if(
bufãr_äame
[
iF¿me
] < 
mšB
)

270 
mšB
 = 
bufãr_äame
[
iF¿me
];

271 
F¿meIndex
 = 
iF¿me
;

274 iàÐ
iF¿me
 < 
p_Vid
->
tÙ®_äame_bufãr
 )

276 
bufãr_äame
[
iF¿me
+1] = bufãr_äame[iF¿me] + 
iChªÃlR©e
;

277 if(
bufãr_äame
[
iF¿me
+1] > 
maxBufãr
)

278 
bufãr_äame
[
iF¿me
+1] = 
maxBufãr
;

281 
aùu®Bufãr
 = (
maxBufãr
 - 
mšB
);

284 
In™FuÎÃss
 = 
p_Vid
->
B™_Bufãr
[0];

285 
bufãr_äame
[0] = 
In™FuÎÃss
;

286 
iF¿me
=0; iF¿m< 
F¿meIndex
+1; iFrame++)

288 
bufãr_äame
[
iF¿me
] = bufãr_äame[iF¿me] - 
p_Vid
->
B™_Bufãr
[iFrame];

289 if(
bufãr_äame
[
iF¿me
] < 0)

291 
In™FuÎÃss
 -ð
bufãr_äame
[
iF¿me
];

292 
bufãr_äame
[
iF¿me
] = 0;

294 iàÐ
iF¿me
 < 
p_Vid
->
tÙ®_äame_bufãr
 )

296 
bufãr_äame
[
iF¿me
+1] = bufãr_äame[iF¿me] + 
iChªÃlR©e
;

297 if(
bufãr_äame
[
iF¿me
+1] > 
aùu®Bufãr
)

301 
Bmš
[
iBuck‘
] = (è
aùu®Bufãr
;

302 
Fmš
[
iBuck‘
] = (è
In™FuÎÃss
;

305 
	`wr™e_bufãr
(
p_IÅ
, 
Numb”L—kyBuck‘s
, 
Rmš
, 
Bmš
, 
Fmš
);

307 
	`ä“_poš‹r
(
bufãr_äame
);

308 
	`ä“_poš‹r
(
Rmš
);

309 
	`ä“_poš‹r
(
Bmš
);

310 
	`ä“_poš‹r
(
Fmš
);

312 
	}
}

	@lencod/src/lencod.c

46 
	~"cÚŒibutÜs.h
"

48 
	~<time.h
>

49 
	~<m©h.h
>

51 
	~"wš32.h
"

52 
	~"glob®.h
"

53 
	~"ccÚv_yuv2rgb.h
"

54 
	~"cÚfigfže.h
"

55 
	~"cÚfÜmªû.h
"

56 
	~"cÚ‹xt_ši.h
"

57 
	~"ex¶ic™_gÝ.h
"

58 
	~"ex¶ic™_£q.h
"

59 
	~"fžehªdË.h
"

60 
	~"image.h
"

61 
	~"šput.h
"

62 
	~"img_io.h
"

63 
	~"¦iû.h
"

64 
	~"šŒ¬eäesh.h
"

65 
	~"Ëaky_buck‘.h
"

66 
	~"mc_´ediùiÚ.h
"

67 
	~"mc_´ediùiÚ_Ùf.h
"

68 
	~"mem®loc.h
"

69 
	~"me_•zs_commÚ.h
"

70 
	~"me_•zs_št.h
"

71 
	~"me_umhex.h
"

72 
	~"me_umhexsmp.h
"

73 
	~"me_hme.h
"

74 
	~"ouut.h
"

75 
	~"·r£t.h
"

76 
	~"q_m©rix.h
"

77 
	~"q_off£ts.h
"

78 
	~"¿‹ùl.h
"

79 
	~"»pÜt.h
"

80 
	~"rdoq.h
"

81 
	~"”rdo.h
"

82 
	~"rdÝt.h
"

83 
	~"wp_mý»c.h
"

84 
	~"mv_£¬ch.h
"

85 
	~"img_´oûss.h
"

86 
	~"q_off£ts.h
"

87 
	~"´ed_¡ruù.h
"

88 
	~"blk_´ediùiÚ.h
"

89 
	~"img_luma.h
"

90 
	~"img_chroma.h
"

91 
	~"mc_´ediùiÚ.h
"

92 
	~"me_di¡ÜtiÚ.h
"

93 
	~"me_di¡ÜtiÚ_Ùf.h
"

94 
	~"md_di¡ÜtiÚ.h
"

95 
	~"mode_decisiÚ.h
"

96 
	~"ŒªsfÜm8x8.h
"

97 
	~"šŒa16x16.h
"

98 
	~"šŒa4x4.h
"

99 
	~"šŒa8x8.h
"

101 
	~"md_commÚ.h
"

102 
	~"maüoblock.h
"

103 
	~"g‘_block_Ùf.h
"

105 
	~"wp.h
"

108 #ià!
IMGTYPE


109 #ià
JCOST_CALC_SCALEUP
 && (
LAMBDA_ACCURACY_BITS
>8)

113 cÚ¡ 
	gmb_width_ü
[4] = {0, 8, 8,16};

114 cÚ¡ 
	gmb_height_ü
[4]= {0, 8,16,16};

116 
Encod”P¬ams
 *
	gp_Enc
 = 
NULL
;

118 
£t_Ëv–_šdiûs
 (
VideoP¬am‘”s
 *
p_Vid
);

119 
chroma_mc_£tup
 (
VideoP¬am‘”s
 *
p_Vid
);

120 
š™_img
 (
VideoP¬am‘”s
 *
p_Vid
);

121 
š™_’cod”
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

122 
š™_glob®_bufãrs
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

123 
ä“_glob®_bufãrs
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

124 
ä“_img
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

125 
ä“_·¿ms
 (
IÅutP¬am‘”s
 *
p_IÅ
);

127 
’code_£qu’û
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

130 
g’”©e_’code_·¿m‘”s
(
VideoP¬am‘”s
 *
p_Vid
);

131 
ä“_’code_·¿m‘”s
(
VideoP¬am‘”s
 *
p_Vid
);

134 
	$š™_¡©s
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
)

136 
	`mem£t
(
p_Sts
, 0, (
StP¬am‘”s
));

137 
p_Sts
->
Numb”BF¿mes
 = 
p_IÅ
->NumberBFrames;

138 
	}
}

140 
	$š™_d¡©s
 (
Di¡ÜtiÚP¬ams
 *
p_Di¡
)

142 
p_Di¡
->
äame_ùr
 = 0;

143 
	`mem£t
(
p_Di¡
->
m‘ric
, 0, 
TOTAL_DIST_TYPES
 * (
Di¡M‘ric
));

144 
	}
}

154 
	$®loc_video_·¿ms
Ð
VideoP¬am‘”s
 **
p_Vid
)

156 ià((*
p_Vid
 = (
VideoP¬am‘”s
 *è
	`ÿÎoc
(1, (VideoP¬am‘”s)))==
NULL
)

157 
	`no_mem_ex™
("alloc_video_params:…_Vid");

158 ià((((*
p_Vid
)->
p_Di¡
èð(
Di¡ÜtiÚP¬ams
 *è
	`ÿÎoc
(1, (Di¡ÜtiÚP¬ams)))==
NULL
)

159 
	`no_mem_ex™
("alloc_video_params:…_Dist");

160 ià((((*
p_Vid
)->
p_Sts
èð(
StP¬am‘”s
 *è
	`ÿÎoc
(1, (StP¬am‘”s)))==
NULL
)

161 
	`no_mem_ex™
("alloc_video_params:…_Stats");

162 ià(((*
p_Vid
)->
p_Dpb_Ïy”
[0] = (
DecodedPiùu»Bufãr
 *è
	`ÿÎoc
(
MAX_NUM_DPB_LAYERS
, (DecodedPiùu»Bufãr)))==
NULL
)

163 
	`no_mem_ex™
("alloc_video_params:…_Dpb_layer");

165 
i
;

166 
i
=1; i<
MAX_NUM_DPB_LAYERS
; i++)

168 (*
p_Vid
)->
p_Dpb_Ïy”
[
i
] = (*p_Vid)->p_Dpb_layer[i-1] + 1;

169 (*
p_Vid
)->
p_Dpb_Ïy”
[
i
]->
Ïy”_id
 = i;

172 ià((((*
p_Vid
)->
p_Quªt
èð(
QuªtP¬am‘”s
 *è
	`ÿÎoc
(1, (QuªtP¬am‘”s)))==
NULL
)

173 
	`no_mem_ex™
("alloc_video_params:…_Quant");

174 ià((((*
p_Vid
)->
p_QSÿË
èð(
SÿËP¬am‘”s
 *è
	`ÿÎoc
(1, (SÿËP¬am‘”s)))==
NULL
)

175 
	`no_mem_ex™
("alloc_video_params:…_QScale");

176 ià((((*
p_Vid
)->
p_SEI
èð(
SEIP¬am‘”s
 *è
	`ÿÎoc
(1, (SEIP¬am‘”s)))==
NULL
)

177 
	`no_mem_ex™
("alloc_video_params:…_SEI");

180 (*
p_Vid
)->
p_dec
 = -1;

181 #ià(
MVC_EXTENSION_ENABLE
)

182 (*
p_Vid
)->
p_dec2
 = -1;

184 (*
p_Vid
)->
p_log
 = 
NULL
;

185 (*
p_Vid
)->
f_ªÃxb
 = 
NULL
;

187 (*
p_Vid
)->
f_¹p
 = 
NULL
;

188 (*
p_Vid
)->
Cu¼’tRTPTime¡amp
 = 0;

189 (*
p_Vid
)->
Cu¼’tRTPSequ’ûNumb”
 = 0;

190 
	}
}

200 
	$®loc_·¿ms
Ð
IÅutP¬am‘”s
 **
p_IÅ
 )

202 ià((*
p_IÅ
 = (
IÅutP¬am‘”s
 *è
	`ÿÎoc
(1, (IÅutP¬am‘”s)))==
NULL
)

203 
	`no_mem_ex™
("alloc_params:…_Inp");

205 (*
p_IÅ
)->
tÝ_Ëá
 = 
NULL
;

206 (*
p_IÅ
)->
bÙtom_right
 = 
NULL
;

207 (*
p_IÅ
)->
¦iû_group_id
 = 
NULL
;

208 (*
p_IÅ
)->
run_Ëngth_mšus1
 = 
NULL
;

209 
	}
}

220 
	$®loc_’cod”
Ð
Encod”P¬ams
 **
p_Enc
)

222 ià((*
p_Enc
 = (
Encod”P¬ams
 *è
	`ÿÎoc
(1, (Encod”P¬ams)))==
NULL
)

223 
	`no_mem_ex™
("alloc_encoder:…_Enc");

225 
	`®loc_video_·¿ms
(&((*
p_Enc
)->
p_Vid
));

226 
	`®loc_·¿ms
(&((*
p_Enc
)->
p_IÅ
));

227 (*
p_Enc
)->
p_Œaû
 = 
NULL
;

228 (*
p_Enc
)->
bufãrSize
 = 0;

229 
	}
}

237 
	$ä“_’cod”
 (
Encod”P¬ams
 *
p_Enc
)

239 
	`ä“_poš‹r
Ð
p_Enc
 );

240 
	}
}

254 
	$maš
(
¬gc
, **
¬gv
)

256 
	`š™_time
();

257 #ià
MEMORY_DEBUG


258 
	`_C¹S‘DbgFÏg
 ( 
_CRTDBG_ALLOC_MEM_DF
 | 
_CRTDBG_LEAK_CHECK_DF
 );

261 
	`®loc_’cod”
(&
p_Enc
);

263 
	`CÚfigu»
 (
p_Enc
->
p_Vid
,…_Enc->
p_IÅ
, 
¬gc
, 
¬gv
);

266 
	`š™_’cod”
(
p_Enc
->
p_Vid
,…_Enc->
p_IÅ
);

269 
	`’code_£qu’û
(
p_Enc
->
p_Vid
,…_Enc->
p_IÅ
);

272 
	`ä“_’cod”_memÜy
(
p_Enc
->
p_Vid
,…_Enc->
p_IÅ
);

274 
	`ä“_·¿ms
 (
p_Enc
->
p_IÅ
);

275 
	`ä“_’cod”
(
p_Enc
);

278 
	}
}

287 
	$CežLog2
Ð
uiV®
)

289 
uiTmp
 = 
uiV®
-1;

290 
uiR‘
 = 0;

292  
uiTmp
 != 0 )

294 
uiTmp
 >>= 1;

295 
uiR‘
++;

297  
uiR‘
;

298 
	}
}

300 
	$£t_dpb_Ïy”_id
(
VideoP¬am‘”s
 *
p_Vid
, 
idx
)

302 
	`as£¹
(
idx
>=0 && idx<2);

303 
p_Vid
->
dpb_Ïy”_id
 = 
idx
;

304 
	}
}

306 
	$£tup_dpb_Ïy”
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

309  
p_IÅ
->
OnTheFlyF¿ùMCP
 )

311 
OTF_L1
:

312 
p_Dpb
->
pf_compu‹SAD
 = 
compu‹SAD_Ùf
;

313 
p_Dpb
->
pf_compu‹SADWP
 = 
compu‹SADWP_Ùf
;

314 
p_Dpb
->
pf_compu‹SATD
 = 
compu‹SATD_Ùf
;

315 
p_Dpb
->
pf_compu‹SATDWP
 = 
compu‹SATDWP_Ùf
;

316 
p_Dpb
->
pf_compu‹BiP»dSAD1
 = 
compu‹BiP»dSAD1_Ùf
;

317 
p_Dpb
->
pf_compu‹BiP»dSAD2
 = 
compu‹BiP»dSAD2_Ùf
;

318 
p_Dpb
->
pf_compu‹BiP»dSATD1
 = 
compu‹BiP»dSATD1_Ùf
;

319 
p_Dpb
->
pf_compu‹BiP»dSATD2
 = 
compu‹BiP»dSATD2_Ùf
;

320 
p_Dpb
->
pf_compu‹SSE
 = 
compu‹SSE_Ùf
;

321 
p_Dpb
->
pf_compu‹SSEWP
 = 
compu‹SSEWP_Ùf
;

322 
p_Dpb
->
pf_compu‹BiP»dSSE1
 = 
compu‹BiP»dSSE1_Ùf
;

323 
p_Dpb
->
pf_compu‹BiP»dSSE2
 = 
compu‹BiP»dSSE2_Ùf
;

324 
p_Dpb
->
pf_luma_´ediùiÚ
 = 
luma_´ediùiÚ_Ùf
 ;

325 
p_Dpb
->
pf_luma_´ediùiÚ_bi
 = 
luma_´ediùiÚ_bi_Ùf
 ;

326 
p_Dpb
->
pf_chroma_´ediùiÚ
 = 
chroma_´ediùiÚ_Ùf
 ;

327 
p_Dpb
->
pf_g‘_block_luma
 = 
g‘_block_luma_Ùf_L1
 ;

328 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
] = (
p_Vid
->
P444_jošed
è? ( 
g‘_block_luma_Ùf_L1
 ) : ( 
me_g‘_block_chroma_Ùf_L1
 ) ;

329 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_MC
] = (
p_Vid
->
P444_jošed
è? ( 
g‘_block_luma_Ùf_L1
 ) : ( 
mc_g‘_block_chroma_Ùf_L1
 ) ;

330 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

331 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

333 
OTF_L2
:

334 
p_Dpb
->
pf_compu‹SAD
 = 
compu‹SAD_Ùf
;

335 
p_Dpb
->
pf_compu‹SADWP
 = 
compu‹SADWP_Ùf
;

336 
p_Dpb
->
pf_compu‹SATD
 = 
compu‹SATD_Ùf
;

337 
p_Dpb
->
pf_compu‹SATDWP
 = 
compu‹SATDWP_Ùf
;

338 
p_Dpb
->
pf_compu‹BiP»dSAD1
 = 
compu‹BiP»dSAD1_Ùf
;

339 
p_Dpb
->
pf_compu‹BiP»dSAD2
 = 
compu‹BiP»dSAD2_Ùf
;

340 
p_Dpb
->
pf_compu‹BiP»dSATD1
 = 
compu‹BiP»dSATD1_Ùf
;

341 
p_Dpb
->
pf_compu‹BiP»dSATD2
 = 
compu‹BiP»dSATD2_Ùf
;

342 
p_Dpb
->
pf_compu‹SSE
 = 
compu‹SSE_Ùf
;

343 
p_Dpb
->
pf_compu‹SSEWP
 = 
compu‹SSEWP_Ùf
;

344 
p_Dpb
->
pf_compu‹BiP»dSSE1
 = 
compu‹BiP»dSSE1_Ùf
;

345 
p_Dpb
->
pf_compu‹BiP»dSSE2
 = 
compu‹BiP»dSSE2_Ùf
;

346 
p_Dpb
->
pf_luma_´ediùiÚ
 = 
luma_´ediùiÚ_Ùf
 ;

347 
p_Dpb
->
pf_luma_´ediùiÚ_bi
 = 
luma_´ediùiÚ_bi_Ùf
 ;

348 
p_Dpb
->
pf_chroma_´ediùiÚ
 = 
chroma_´ediùiÚ_Ùf
 ;

349 
p_Dpb
->
pf_g‘_block_luma
 = 
g‘_block_luma_Ùf_L2
 ;

350 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
] =…_Dpb->pf_g‘_block_chroma[
OTF_MC
] = (
p_Vid
->
P444_jošed
è? ( 
g‘_block_luma_Ùf_L2
 ) : ( 
g‘_block_chroma_Ùf_L2
 ) ;

351 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

352 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

355 
p_Dpb
->
pf_compu‹SAD
 = 
compu‹SAD
;

356 
p_Dpb
->
pf_compu‹SADWP
 = 
compu‹SADWP
;

357 
p_Dpb
->
pf_compu‹SATD
 = 
compu‹SATD
;

358 
p_Dpb
->
pf_compu‹SATDWP
 = 
compu‹SATDWP
;

359 
p_Dpb
->
pf_compu‹BiP»dSAD1
 = 
compu‹BiP»dSAD1
;

360 
p_Dpb
->
pf_compu‹BiP»dSAD2
 = 
compu‹BiP»dSAD2
;

361 
p_Dpb
->
pf_compu‹BiP»dSATD1
 = 
compu‹BiP»dSATD1
;

362 
p_Dpb
->
pf_compu‹BiP»dSATD2
 = 
compu‹BiP»dSATD2
;

363 
p_Dpb
->
pf_compu‹SSE
 = 
compu‹SSE
;

364 
p_Dpb
->
pf_compu‹SSEWP
 = 
compu‹SSEWP
;

365 
p_Dpb
->
pf_compu‹BiP»dSSE1
 = 
compu‹BiP»dSSE1
;

366 
p_Dpb
->
pf_compu‹BiP»dSSE2
 = 
compu‹BiP»dSSE2
;

367 
p_Dpb
->
pf_luma_´ediùiÚ
 = 
luma_´ediùiÚ
;

368 
p_Dpb
->
pf_luma_´ediùiÚ_bi
 = 
luma_´ediùiÚ_bi
;

369 
p_Dpb
->
pf_chroma_´ediùiÚ
 = 
chroma_´ediùiÚ
;

370 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

371 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
 = 
OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
;

374 
	}
}

376 
	$£t_¡Üage_fÜm©
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
p_¤c
, F¿meFÜm© *
p_d¡
)

378 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

379 *
p_d¡
 = *
p_¤c
;

380 
p_d¡
->
width
[0] = (
p_IÅ
->
ouut
.width[0] + 
p_Vid
->
auto_üÝ_right
);

381 
p_d¡
->
height
[0] = (
p_IÅ
->
ouut
.height[0] + 
p_Vid
->
auto_üÝ_bÙtom
);

382 
p_d¡
->
width
[1] =…_d¡->width[2] =…_d¡->width[0] * 
mb_width_ü
 [p_d¡->
yuv_fÜm©
] / 16;

383 
p_d¡
->
height
[1]ðp_d¡->height[2] =…_d¡->height[0] * 
mb_height_ü
[p_d¡->
yuv_fÜm©
] / 16;

384 
p_d¡
->
size_cmp
[0] =…_d¡->
width
[0] *…_d¡->
height
[0];

385 
p_d¡
->
size_cmp
[2] =…_d¡->size_cmp[1] =…_d¡->
width
[1] *…_d¡->
height
[1];

386 
p_d¡
->
size
 =…_d¡->
size_cmp
[0] +…_dst->size_cmp[1] +…_dst->size_cmp[2];

387 
	}
}

395 
	$š™_’cod”
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

397 
i
;

398 
p_Vid
->
p_IÅ
 =…_Inp;

399 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

400 
p_Vid
->
p_log
 = 
NULL
;

403 
p_Vid
->
num_of_Ïy”s
 = 
p_IÅ
->
num_of_v›ws
;

405 
p_Vid
->
ÿbac_’codšg
 = 0;

406 
p_Vid
->
äame_¡©i¡ic_¡¬t
 = 1;

408 ià(
p_IÅ
->
Log2MaxFNumMšus4
 == -1)

410 
p_Vid
->
log2_max_äame_num_mšus4
 = 
	`iCl3
(0,12, (è(
	`CežLog2
(
p_IÅ
->
no_äames
) - 4));

413 
p_Vid
->
log2_max_äame_num_mšus4
 = 
p_IÅ
->
Log2MaxFNumMšus4
;

415 ià(
p_Vid
->
log2_max_äame_num_mšus4
 =ð0 && 
p_IÅ
->
num_»f_äames
 == 16)

417 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, " Numb”Reã»nûF¿mes=%d‡nd Log2MaxFNumMšus4=%d may†—dØª inv®id v®uoàäame_num.", 
p_IÅ
->
num_»f_äames
,…_IÅ-> 
Log2MaxFNumMšus4
);

418 
	`”rÜ
 (
”rÜ‹xt
, 500);

422 ià(
p_IÅ
->
Log2MaxPOCLsbMšus4
 == - 1)

423 
p_Vid
->
log2_max_pic_Üd”_út_lsb_mšus4
 = 
	`iCl3
(0,12, (è(
	`CežLog2
Ð
	`imax
Ð
p_IÅ
->
no_äames
, (p_IÅ->
Numb”BF¿mes
 + 1) << 1 ) << 1 ) - 4));

425 
p_Vid
->
log2_max_pic_Üd”_út_lsb_mšus4
 = 
p_IÅ
->
Log2MaxPOCLsbMšus4
;

427 ià(((1<<(
p_Vid
->
log2_max_pic_Üd”_út_lsb_mšus4
 + 3)è< 
p_IÅ
->
jumpd
 * 4è&&…_IÅ->
Log2MaxPOCLsbMšus4
 != -1)

428 
	`”rÜ
("log2_max_pic_order_cnt_lsb_minus4 might‚ot be sufficient forƒncoding. Increase value.",400);

430 ià(
	`¡¾’
 (
p_IÅ
->
RecÚFže
è> 0 && (
p_Vid
->
p_dec
 = 
	`Ý’
Õ_IÅ->RecÚFže, 
OPENFLAGS_WRITE
, 
OPEN_PERMISSIONS
))==-1)

432 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³Àfž%s", 
p_IÅ
->
RecÚFže
);

433 
	`”rÜ
 (
”rÜ‹xt
, 500);

436 #ià(
MVC_EXTENSION_ENABLE
)

437 if(
p_Vid
->
num_of_Ïy”s
 == 2)

439 ià(
	`¡¾’
 (
p_IÅ
->
RecÚFže2
è> 0 && (
p_Vid
->
p_dec2
 = 
	`Ý’
Õ_IÅ->RecÚFže2, 
OPENFLAGS_WRITE
, 
OPEN_PERMISSIONS
))==-1)

441 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³Àfž%s", 
p_IÅ
->
RecÚFže2
);

442 
	`”rÜ
 (
”rÜ‹xt
, 500);

446 ià((
p_IÅ
->
ouut
.
width
[0] & 0x0F) != 0)

448 
p_Vid
->
auto_üÝ_right
 = 16 - (
p_IÅ
->
ouut
.
width
[0] & 0x0F);

452 
p_Vid
->
auto_üÝ_right
 = 0;

455 ià(
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
)

457 ià((
p_IÅ
->
ouut
.
height
[0] & 0x01) != 0)

459 
	`”rÜ
 ("even‚umber of†ines„equired for interlaced coding", 500);

462 ià((
p_IÅ
->
ouut
.
height
[0] & 0x1F) != 0)

464 
p_Vid
->
auto_üÝ_bÙtom
 = 32 - (
p_IÅ
->
ouut
.
height
[0] & 0x1F);

468 
p_Vid
->
auto_üÝ_bÙtom
=0;

473 ià((
p_IÅ
->
ouut
.
height
[0] & 0x0F) != 0)

475 
p_Vid
->
auto_üÝ_bÙtom
 = 16 - (
p_IÅ
->
ouut
.
height
[0] & 0x0F);

479 
p_Vid
->
auto_üÝ_bÙtom
 = 0;

482 ià(
p_Vid
->
auto_üÝ_bÙtom
 ||…_Vid->
auto_üÝ_right
)

484 
	`årštf
 (
¡d”r
, "Warning: Automatic cropping‡ctivated: Coded frame Size: %dx%d\n",

485 
p_IÅ
->
ouut
.
width
[0] + 
p_Vid
->
auto_üÝ_right
,…_IÅ->ouut.
height
[0] +…_Vid->
auto_üÝ_bÙtom
);

489 iàÐ0 !ð
p_IÅ
->
num_¦iû_groups_mšus1
 )

491 
	`»ad_¦iû_group_šfo
(
p_Vid
, 
p_IÅ
);

494 if(
p_IÅ
->
num_¦iû_groups_mšus1
 > 0)

496 ifÐ(
p_IÅ
->
¦iû_group_m­_ty³
 >= 3) && (p_Inp->slice_group_map_type<=5) )

497 
p_IÅ
->
num_¦iû_groups_mšus1
 = 1;

500 if(
p_IÅ
->
RCEÇbË
)

502 ià(
p_IÅ
->
basicun™
 == 0)

503 
p_IÅ
->
basicun™
 = (p_IÅ->
ouut
.
height
[0] + 
p_Vid
->
auto_üÝ_bÙtom
)*Õ_IÅ->ouut.
width
[0] +…_Vid->
auto_üÝ_right
)/256;

505 iàÐ((
p_IÅ
->
ouut
.
height
[0] + 
p_Vid
->
auto_üÝ_bÙtom
)*Õ_IÅ->ouut.
width
[0] +…_Vid->
auto_üÝ_right
)/256è%…_IÅ->
basicun™
 != 0)

507 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Frame size in macroblocks must be‡ multiple of BasicUnit.");

508 
	`”rÜ
 (
”rÜ‹xt
, 500);

512 
	`Ëv–_check
(
p_Vid
, 
p_IÅ
);

515 
	`O³nFžes
(&
p_IÅ
->
šput_fže1
);

516 #ià(
MVC_EXTENSION_ENABLE
)

517 if(
p_Vid
->
num_of_Ïy”s
==2)

519 
	`O³nFžes
(&
p_IÅ
->
šput_fže2
);

521 
p_Vid
->
´ev_v›w_is_ªchÜ
 = 0;

522 
p_Vid
->
v›w_id
 = 0;

523 
	`£t_dpb_Ïy”_id
(
p_Vid
,…_Vid->
v›w_id
);

527 
p_Vid
->
ouut_fÜm©
[0] = 
p_IÅ
->
ouut
;

528 
	`£t_¡Üage_fÜm©
(
p_Vid
, &(
p_IÅ
->
sourû
), &Õ_Vid->
p_Dpb_Ïy”
[0]->
¡Üage_fÜm©
));

529 if(
p_Vid
->
num_of_Ïy”s
 == 2)

532 
p_Vid
->
ouut_fÜm©
[1] = 
p_IÅ
->
ouut
;

533 
	`£t_¡Üage_fÜm©
(
p_Vid
, &(
p_IÅ
->
sourû
), &Õ_Vid->
p_Dpb_Ïy”
[1]->
¡Üage_fÜm©
));

538 
	`š™_qm©rix
(
p_Vid
, 
p_IÅ
);

539 
	`š™_qoff£t
(
p_Vid
);

541 
	`š™_poc
(
p_Vid
);

542 
	`g’”©e_·¿m‘”_£ts
(
p_Vid
);

543 
	`g’”©e_’code_·¿m‘”s
(
p_Vid
);

544 
	`£t_Ëv–_šdiûs
(
p_Vid
);

546 
	`š™_img
 (
p_Vid
);

548 ià(
p_IÅ
->
rdÝt
 == 3)

550 
	`š™_”rÜ_cÚû®
(
p_Vid
,
p_IÅ
->
E¼ÜCÚû®m’t
);

552 
	`š™_di¡ÜtiÚ_e¡im©iÚ
(
p_Vid
,
p_IÅ
->
de
);

555 #ifdeà
_LEAKYBUCKET_


556 
p_Vid
->
š™Ÿl_Bäames
 = 0;

557 #ià(
MVC_EXTENSION_ENABLE
)

558 if(
p_Vid
->
num_of_Ïy”s
 == 2)

559 
p_Vid
->
B™_Bufãr
 = (*)
	`m®loc
(((
p_IÅ
->
no_äames
 << 1) + 1) * ());

561 
p_Vid
->
B™_Bufãr
 = (*)
	`m®loc
((
p_IÅ
->
no_äames
 + 1) * ());

563 
p_Vid
->
B™_Bufãr
 = (*)
	`m®loc
((
p_IÅ
->
no_äames
 + 1) * ());

565 
p_Vid
->
tÙ®_äame_bufãr
 = 0;

570 ià(
p_IÅ
->
Numb”BF¿mes
 &&…_IÅ->
H›¿rchiÿlCodšg
 == 3)

572 
	`š™_gÝ_¡ruùu»
(
p_Vid
, 
p_IÅ
);

573 
	`š‹½»t_gÝ_¡ruùu»
(
p_Vid
, 
p_IÅ
);

577 
i
=0; i<
MAX_NUM_DPB_LAYERS
; i++)

579 
p_Vid
->
p_Dpb_Ïy”
[
i
]->
š™_dÚe
 = 0;

581 
i
=0; i<
	`imš
(
p_Vid
->
num_of_Ïy”s
, 
MAX_NUM_DPB_LAYERS
); i++)

583 
	`š™_dpb
(
p_Vid
,…_Vid->
p_Dpb_Ïy”
[
i
]);

586 
	`š™_out_bufãr
(
p_Vid
);

587 
	`š™_¡©s
 (
p_IÅ
, 
p_Vid
->
p_Sts
);

588 
	`š™_d¡©s
(
p_Vid
->
p_Di¡
);

590 #ià(
MVC_EXTENSION_ENABLE
)

591 if(
p_Vid
->
num_of_Ïy”s
 == 2)

593 
p_Vid
->
p_Di¡
->
äame_ùr_v
[0] = 0;

594 
p_Vid
->
p_Di¡
->
äame_ùr_v
[1] = 0;

595 
	`mem£t
(
p_Vid
->
p_Di¡
->
m‘ric_v
[0], 0, 
TOTAL_DIST_TYPES
 * (
Di¡M‘ric
));

596 
	`mem£t
(
p_Vid
->
p_Di¡
->
m‘ric_v
[1], 0, 
TOTAL_DIST_TYPES
 * (
Di¡M‘ric
));

600 
p_Vid
->
’c_piùu»
 = 
NULL
;

602 
	`š™_glob®_bufãrs
(
p_Vid
, 
p_IÅ
);

604 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

605 
	`wpxIn™WPXPas£s
(
p_Vid
, 
p_IÅ
);

607 
	`š™_mÙiÚ_£¬ch_moduË
 (
p_Vid
, 
p_IÅ
);

608 
	`šfÜm©iÚ_š™
(
p_Vid
, 
p_IÅ
,…_Vid->
p_Sts
);

610 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
)

611 
	`š™_YUVtoRGB
(
p_Vid
, 
p_IÅ
);

614 ià(
p_IÅ
->
RCEÇbË
)

615 
	`rc_š™_£qu’û
(
p_Vid
, 
p_IÅ
);

617 
p_Vid
->
Ï¡_v®id_»ã»nû
 = 0;

618 
p_Vid
->
tÙ_time
 = 0;

619 
p_Vid
->
Ï¡_b™_ùr_n
 = 0;

621 
p_Vid
->
š™Ÿl_Bäames
 = 
p_IÅ
->
Numb”BF¿mes
;

623 
p_Vid
->
ty³
 = 
I_SLICE
;

625 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a
 = 0;

626 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n
 = 0;

627 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts
 = 0;

629 #ià(
MVC_EXTENSION_ENABLE
)

630 iàÐ
p_Vid
->
num_of_Ïy”s
 == 2 )

632 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[0] = 0;

633 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_v
[1] = 0;

634 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n_v
[0] = 0;

635 
p_Vid
->
p_Sts
->
b™_ùr_fžËr_d©a_n_v
[1] = 0;

636 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[0] = 0;

637 
p_Vid
->
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[1] = 0;

641 
p_Vid
->
p_Sts
->
b™_¦iû
 = 
	`¡¬t_£qu’û
Õ_Vid, 
p_IÅ
);

643 ià(
p_IÅ
->
U£RDOQuªt
)

644 
	`´eÿlcuÏ‹_uÇry_exp_gÞomb_Ëv–
(
p_Vid
);

646 ià(
p_IÅ
->
Ex¶ic™SeqCodšg
)

647 
	`O³nEx¶ic™SeqFže
(
p_Vid
, 
p_IÅ
);

649 
p_Vid
->
£¬chRªge
.
mš_x
 = -
p_IÅ
->
£¬ch_¿nge
[0] << 2;

650 
p_Vid
->
£¬chRªge
.
max_x
 = 
p_IÅ
->
£¬ch_¿nge
[0] << 2;

651 
p_Vid
->
£¬chRªge
.
mš_y
 = -
p_IÅ
->
£¬ch_¿nge
[0] << 2;

652 
p_Vid
->
£¬chRªge
.
max_y
 = 
p_IÅ
->
£¬ch_¿nge
[0] << 2;

655 if(
p_IÅ
->
HMEEÇbË
)

656 
	`In™HMEInfo
(
p_Vid
, 
p_IÅ
);

658 
p_Vid
->
pHMEInfo
 = 
NULL
;

660 
p_Vid
->
is_hme
 = 0;

662  
i
 = 0; i < 
p_Vid
->
num_of_Ïy”s
; i++ )

664 
	`£tup_dpb_Ïy”
(
p_Vid
->
p_Dpb_Ïy”
[
i
],…_Vid, 
p_IÅ
);

666 
	}
}

668 
	$£tup_codšg_Ïy”
(
VideoP¬am‘”s
 *
p_Vid
)

671 
i
;

672 
dpb_Ïy”_id
 = 
p_Vid
->dpb_layer_id;

673 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

674 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[
dpb_Ïy”_id
];

676 
p_Vid
->
aùive_¥s
 =…_Vid->
¥s
[
dpb_Ïy”_id
];

677 
p_Vid
->
p_Cu¼EncodeP¬
 =…_Vid->
p_EncodeP¬
[
dpb_Ïy”_id
];

679 ià(
p_Vid
->
p_Cu¼EncodeP¬
->
Ï¡_»f_idc
 == 1)

681 
p_Vid
->
p_Cu¼EncodeP¬
->
äame_num
++;

682 
p_Vid
->
p_Cu¼EncodeP¬
->
äame_num
 %ðp_Vid->
max_äame_num
;

684 
p_Vid
->
äame_num
 =…_Vid->
p_Cu¼EncodeP¬
->frame_num;

687 if(
p_Vid
->
num_of_Ïy”s
 >1)

690 
CodšgP¬am‘”s
 *
ýs
 = 
p_Vid
->
p_Cu¼EncodeP¬
;

692 
p_Vid
->
yuv_fÜm©
 = 
ýs
->yuv_format;

693 
p_Vid
->
P444_jošed
 = 
ýs
->P444_joined;

694 
p_Vid
->
b™d•th_luma
 = 
ýs
->bitdepth_luma;

695 
p_Vid
->
b™d•th_sÿË
[0] = 
ýs
->bitdepth_scale[0];

696 
p_Vid
->
b™d•th_Ïmbda_sÿË
 = 
ýs
->bitdepth_lambda_scale;

697 
p_Vid
->
b™d•th_luma_qp_sÿË
 = 
ýs
->bitdepth_luma_qp_scale;

698 
p_Vid
->
dc_´ed_v®ue_comp
[0] = 
ýs
->dc_pred_value_comp[0];

700 
p_Vid
->
max_³l_v®ue_comp
[0] = 
ýs
->max_pel_value_comp[0];

701 
p_Vid
->
max_img³l_v®ue_comp_sq
[0] = 
ýs
->max_imgpel_value_comp_sq[0];

702 
p_Vid
->
mb_size
[0][0] =…_Vid->mb_size[0][1] = 
ýs
->mb_size[0][0];

704 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

706 
p_Vid
->
chroma_qp_off£t
[0] =…_Vid->
aùive_µs
->
cb_qp_šdex_off£t
;

707 
p_Vid
->
chroma_qp_off£t
[1] =…_Vid->
aùive_µs
->
ü_qp_šdex_off£t
;

711 
p_Vid
->
chroma_qp_off£t
[0] = 0;

712 
p_Vid
->
chroma_qp_off£t
[1] = 0;

714 
p_Vid
->
b™d•th_chroma
 = 
ýs
->bitdepth_chroma;

715 
p_Vid
->
b™d•th_sÿË
[1] = 
ýs
->bitdepth_scale[1];

716 
p_Vid
->
dc_´ed_v®ue_comp
[2] =…_Vid->dc_´ed_v®ue_comp[1] = 
ýs
->dc_pred_value_comp[1];

717 
p_Vid
->
max_³l_v®ue_comp
[2] =…_Vid->max_³l_v®ue_comp[1] = 
ýs
->max_pel_value_comp[1];

718 
p_Vid
->
max_img³l_v®ue_comp_sq
[1] = 
ýs
->max_imgpel_value_comp_sq[1];

719 
p_Vid
->
max_img³l_v®ue_comp_sq
[2] = 
ýs
->max_imgpel_value_comp_sq[2];

720 
p_Vid
->
num_blk8x8_uv
 = 
ýs
->num_blk8x8_uv;

721 
p_Vid
->
num_cdc_cÛff
 = 
ýs
->num_cdc_coeff;

722 
p_Vid
->
mb_size
[1][0] =…_Vid->mb_size[2][0] =…_Vid->
mb_ü_size_x
 = 
ýs
->mb_cr_size_x;

723 
p_Vid
->
mb_size
[1][1] =…_Vid->mb_size[2][1] =…_Vid->
mb_ü_size_y
 = 
ýs
->mb_cr_size_y;

724 
p_Vid
->
b™d•th_chroma_qp_sÿË
 = 
ýs
->bitdepth_chroma_qp_scale;

725 
p_Vid
->
max_b™CouÁ
 = 
ýs
->max_bitCount;

729 
p_Vid
->
·d_size_uv_x
 = 
ýs
->pad_size_uv_x;

730 
p_Vid
->
·d_size_uv_y
 = 
ýs
->pad_size_uv_y;

731 
p_Vid
->
chroma_mask_mv_y
 = 
ýs
->chroma_mask_mv_y;

732 
p_Vid
->
chroma_mask_mv_x
 = 
ýs
->chroma_mask_mv_x;

733 
p_Vid
->
chroma_shiá_y
 = 
ýs
->chroma_shift_y;

734 
p_Vid
->
chroma_shiá_x
 = 
ýs
->chroma_shift_x;

735 
p_Vid
->
shiá_ü_y
 = 
ýs
->shift_cr_y;

736 
p_Vid
->
shiá_ü_x
 = 
ýs
->shift_cr_x;

738 
p_Vid
->
·dded_size_x
 = 
ýs
->padded_size_x;

739 
p_Vid
->
·dded_size_x_m8x8
 = 
ýs
->padded_size_x_m8x8;

740 
p_Vid
->
·dded_size_x_m4x4
 = 
ýs
->padded_size_x_m4x4;

741 
p_Vid
->
ü_·dded_size_x
 = 
ýs
->cr_padded_size_x;

742 
p_Vid
->
ü_·dded_size_x2
 = 
ýs
->cr_padded_size_x2;

743 
p_Vid
->
ü_·dded_size_x4
 = 
ýs
->cr_padded_size_x4;

744 
p_Vid
->
ü_·dded_size_x_m8
 = 
ýs
->cr_padded_size_x_m8;

747 
p_Vid
->
dc_´ed_v®ue
 =…_Vid->
dc_´ed_v®ue_comp
[0];

748 
p_Vid
->
max_img³l_v®ue
 = (èp_Vid->
max_³l_v®ue_comp
[0];

750 
p_Vid
->
Ïmbda
 =…_Vid->
Ïmbda_buf
[
dpb_Ïy”_id
];

751 
p_Vid
->
Ïmbda_md
 =…_Vid->
Ïmbda_md_buf
[
dpb_Ïy”_id
];

752 
p_Vid
->
Ïmbda_me
 =…_Vid->
Ïmbda_me_buf
[
dpb_Ïy”_id
];

753 
p_Vid
->
Ïmbda_mf
 =…_Vid->
Ïmbda_mf_buf
[
dpb_Ïy”_id
];

754 iàÐ
p_IÅ
->
U£RDOQuªt
 )

756 
p_Vid
->
Ïmbda_rdoq
 =…_Vid->
Ïmbda_rdoq_buf
[
dpb_Ïy”_id
];

758 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

760 
p_Vid
->
Ïmbda_mf_çùÜ
 =…_Vid->
Ïmbda_mf_çùÜ_buf
[
dpb_Ïy”_id
];

763 
	`£tup_mbs
(
p_Vid
->
mb_d©a
,…_Vid->
F¿meSizeInMbs
, 
dpb_Ïy”_id
);

764 
p_Vid
->
nz_cÛff
 =…_Vid->
nz_cÛff_buf
[
dpb_Ïy”_id
];

767 if(
p_Vid
->
imgY_com_buf
[0])

769 
p_Vid
->
imgY_com
 =…_Vid->
imgY_com_buf
[
dpb_Ïy”_id
];

770 
p_Vid
->
imgUV_com
[0] =…_Vid->
imgUV_com_buf
[
dpb_Ïy”_id
][0];

771 
p_Vid
->
imgUV_com
[1] =…_Vid->
imgUV_com_buf
[
dpb_Ïy”_id
][1];

773 if(
p_Vid
->
imgY_tmp_buf
[0])

775 
p_Vid
->
imgY_tmp
 =…_Vid->
imgY_tmp_buf
[
dpb_Ïy”_id
];

776 
p_Vid
->
imgUV_tmp
[0] =…_Vid->
imgUV_tmp_buf
[
dpb_Ïy”_id
][0];

777 
p_Vid
->
imgUV_tmp
[1] =…_Vid->
imgUV_tmp_buf
[
dpb_Ïy”_id
][1];

779 iàÐ
p_IÅ
->
ChromaMCBufãr
 )

780 
p_Vid
->
OÃCompÚ’tChromaP»diùiÚ4x4
 = 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
;

782 
p_Vid
->
OÃCompÚ’tChromaP»diùiÚ4x4
 = 
p_Dpb
->
pf_OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
;

784 
	`£Ëù_di¡ÜtiÚ
(
p_Vid
, 
p_IÅ
);

786 
i
=0; i<3; i++)

788 
p_IÅ
->
MEE¼ÜM‘ric
[
i
])

790 
ERROR_SAD
:

791 
p_Vid
->
compu‹UniP»d
[
i
] = 
p_Dpb
->
pf_compu‹SAD
;

792 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
p_Dpb
->
pf_compu‹SADWP
;

793 
p_Vid
->
compu‹BiP»d1
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSAD1
;

794 
p_Vid
->
compu‹BiP»d2
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSAD2
;

796 
ERROR_SSE
:

797 
p_Vid
->
compu‹UniP»d
[
i
] = 
p_Dpb
->
pf_compu‹SSE
;

798 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
p_Dpb
->
pf_compu‹SSEWP
;

799 
p_Vid
->
compu‹BiP»d1
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSSE1
;

800 
p_Vid
->
compu‹BiP»d2
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSSE2
;

802 
ERROR_SATD
 :

804 
p_Vid
->
compu‹UniP»d
[
i
] = 
p_Dpb
->
pf_compu‹SATD
;

805 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
p_Dpb
->
pf_compu‹SATDWP
;

806 
p_Vid
->
compu‹BiP»d1
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSATD1
;

807 
p_Vid
->
compu‹BiP»d2
[
i
] = 
p_Dpb
->
pf_compu‹BiP»dSATD2
;

812 
	}
}

820 
	$´•¬e_äame_·¿ms
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
cu¼_äame_to_code
)

822 
SeqSŒuùu»
 *
p_£q_¡ruù
 = 
p_Vid
->
p_´ed
;

823 
F¿meUn™SŒuù
 *
p_cur_äm
 = 
p_Vid
->
p_cu¼_äm_¡ruù
;

824 
i
;

826 
	`£tup_codšg_Ïy”
(
p_Vid
);

828 iàÐ
p_IÅ
->
Ex¶ic™SeqCodšg
 )

830 
ExpF¿meInfo
 *
šfo
 = &
p_Vid
->
expSeq
->šfo[
cu¼_äame_to_code
 %…_Vid->expSeq->
no_äames
];

831 
	`R—dEx¶ic™SeqFže
(
p_Vid
->
expSeq
,…_Vid->
expSFže
, 
cu¼_äame_to_code
);

833 
	`pÝuÏ‹_äame_ex¶ic™
Ð
šfo
, 
p_IÅ
, 
p_cur_äm
, 
p_£q_¡ruù
->
max_num_¦iûs
 );

837 
p_Vid
->
äame_no
 = 
p_cur_äm
->frame_no;

838 
p_Vid
->
äm_no_š_fže
 = (1 + 
p_IÅ
->
äame_sk
è*…_Vid->
äame_no
;

839 iàÐ
p_cur_äm
->
ty³
 =ð
SI_SLICE
 )

841 
	`£t_¦iû_ty³
Ð
p_Vid
, 
p_IÅ
, 
SP_SLICE
 );

845 
	`£t_¦iû_ty³
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
->
ty³
 );

847 
p_Vid
->
Çl_»ã»nû_idc
 = 
p_cur_äm
->
Çl_»f_idc
;

848  
p_Vid
->
pic_Üd”_út_ty³
 )

851 
	`g‘_poc_ty³_z”o
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
 );

854 
	`g‘_poc_ty³_Úe
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
 );

858 
	`g‘_poc_ty³_z”o
Ð
p_Vid
, 
p_IÅ
, 
p_cur_äm
 );

862 ià(
p_cur_äm
->
idr_æag
 == 1)

864 
i
 = 0; i < 
p_Vid
->
num_of_Ïy”s
; i++)

866 
p_Vid
->
p_EncodeP¬
[
i
]->
äame_num
 = 0;

868 
p_Vid
->
äame_num
 = 0;

872 ià(
p_IÅ
->
RCEÇbË
 && 
p_Vid
->
ty³
 =ð
I_SLICE
)

873 
	`rc_š™_gÝ_·¿ms
(
p_Vid
, 
p_IÅ
);

876 
p_Vid
->
Ïy”
 = (Õ_Vid->
cu¼_äm_idx
 -…_Vid->
Ï¡_idr_code_Üd”
è% (
p_IÅ
->
NumF¿mesInELSubSeq
 + 1)) ? 0 : 1;

877 
	}
}

885 
	$’code_£qu’û
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

887 
cu¼_äame_to_code
;

888 
äames_to_code
;

889 
äame_num_bak
 = 0, 
äame_coded
;

890 
äm_¡ruù_bufãr
;

891 
SeqSŒuùu»
 *
p_£q_¡ruù
 = 
p_Vid
->
p_´ed
;

892 
F¿meUn™SŒuù
 *
p_äm
;

894 #ià(
MVC_EXTENSION_ENABLE
)

895 
tmp_¿‹_cÚŒÞ_’abË
 = 
p_IÅ
->
RCEÇbË
;

897 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

899 
äames_to_code
 = 
p_IÅ
->
no_äames
 << 1;

900 
p_äm
 = 
p_£q_¡ruù
->
p_äm_mvc
;

901 
äm_¡ruù_bufãr
 = 
p_£q_¡ruù
->
num_äames_mvc
;

906 
äames_to_code
 = 
p_IÅ
->
no_äames
;

907 
p_äm
 = 
p_£q_¡ruù
->p_frm;

908 
äm_¡ruù_bufãr
 = 
p_Vid
->frm_struct_buffer;

911 
cu¼_äame_to_code
 = 0; cu¼_äame_to_cod< 
äames_to_code
; curr_frame_to_code++)

913 #ià(
MVC_EXTENSION_ENABLE
)

914 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

916 iàÐ(
cu¼_äame_to_code
 & 1) == 0 )

919 iàÐ(
cu¼_äame_to_code
 >> 1è>ð
p_Vid
->
p_´ed
->
pÝ_¡¬t_äame
 )

921 
¡¬t
 = 
p_£q_¡ruù
->
pÝ_¡¬t_äame
, 
’d
;

923 
	`pÝuÏ‹_äm_¡ruù
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
,…_IÅ->
FrmSŒuùBufãrL’gth
, 
äames_to_code
 >> 1 );

924 
’d
 = 
p_£q_¡ruù
->
pÝ_¡¬t_äame
;

925 
	`pÝuÏ‹_äm_¡ruù_mvc
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
¡¬t
, 
’d
 );

929 
p_Vid
->
cu¼_äm_idx
 = 
cu¼_äame_to_code
;

930 
p_Vid
->
p_cu¼_äm_¡ruù
 = 
p_äm
 + (…_Vid->
cu¼_äm_idx
 % 
äm_¡ruù_bufãr
 );

931 
p_Vid
->
numb”
 = 
cu¼_äame_to_code
;

933 
p_Vid
->
v›w_id
 =…_Vid->
p_cu¼_äm_¡ruù
->view_id;

934 
	`£t_dpb_Ïy”_id
(
p_Vid
,…_Vid->
v›w_id
);

935 iàÐ
p_Vid
->
v›w_id
 == 1 )

937 
p_Vid
->
cu¼_äm_idx
 =…_Vid->
numb”
 = (
cu¼_äame_to_code
 - 1) >> 1;

938 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ð
	`iCl3
Ð-p_Vid->
b™d•th_luma_qp_sÿË
, 
MAX_QP
,…_Vid->
Av”ageF¿meQP
 + 
p_IÅ
->
V›w1QPOff£t
 );

942 
p_Vid
->
cu¼_äm_idx
 =…_Vid->
numb”
 = 
cu¼_äame_to_code
 >> 1;

944 iàÐ
p_Vid
->
v›w_id
 =ð1 && 
tmp_¿‹_cÚŒÞ_’abË
 )

946 
p_IÅ
->
RCEÇbË
 = 0;

950 
p_IÅ
->
RCEÇbË
 = 
tmp_¿‹_cÚŒÞ_’abË
;

957 iàÐ
cu¼_äame_to_code
 >ð
p_Vid
->
p_´ed
->
pÝ_¡¬t_äame
 )

959 
	`pÝuÏ‹_äm_¡ruù
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
,…_IÅ->
FrmSŒuùBufãrL’gth
, 
äames_to_code
 );

961 
p_Vid
->
cu¼_äm_idx
 = 
cu¼_äame_to_code
;

962 
p_Vid
->
p_cu¼_äm_¡ruù
 = 
p_äm
 + (…_Vid->
cu¼_äm_idx
 % 
äm_¡ruù_bufãr
 );

963 
p_Vid
->
numb”
 = 
cu¼_äame_to_code
;

967 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
äame_no
 >ð
p_IÅ
->
no_äames
 )

973 
äame_num_bak
 = 
p_Vid
->
p_EncodeP¬
[p_Vid->
dpb_Ïy”_id
]->
äame_num
;

975 
	`´•¬e_äame_·¿ms
(
p_Vid
, 
p_IÅ
, 
cu¼_äame_to_code
);

978 ià(
p_IÅ
->
»dundªt_pic_æag
)

980 
	`š™_»dundªt_äame
(
p_Vid
, 
p_IÅ
);

981 
	`£t_»dundªt_äame
(
p_Vid
, 
p_IÅ
);

984 
äame_coded
 = 
	`’code_Úe_äame
(
p_Vid
, 
p_IÅ
);

985 iàÐ!
äame_coded
 )

987 
p_Vid
->
äame_num
 =…_Vid->
p_Cu¼EncodeP¬
->äame_num = 
äame_num_bak
;

991 
p_Vid
->
p_Cu¼EncodeP¬
->
Ï¡_»f_idc
 =…_Vid->
Çl_»ã»nû_idc
 ? 1 : 0;

994 ià(
p_IÅ
->
»dundªt_pic_æag
 && 
p_Vid
->
key_äame
)

996 
	`’code_Úe_»dundªt_äame
(
p_Vid
, 
p_IÅ
);

999 ià(
p_IÅ
->
EÇbËO³nGOP
 && 
p_Vid
->
p_cu¼_äm_¡ruù
->
¿ndom_acûss
)

1001 ià(
p_IÅ
->
PicIÁ”Ïû
)

1003 ià(
p_Vid
->
p_cu¼_äm_¡ruù
->
p_tÝ_æd_pic
->
p_Sliû
[0].
ty³
 =ð
I_SLICE
 &&…_Vid->p_cu¼_äm_¡ruù->
¿ndom_acûss
)

1005 
p_Vid
->
Ï¡_v®id_»ã»nû
 =…_Vid->
ThisPOC
 & (~( (signed )1 ));

1009 ià(
p_Vid
->
ty³
 =ð
I_SLICE
)

1011 
p_Vid
->
Ï¡_v®id_»ã»nû
 =…_Vid->
ThisPOC
;

1016 ià(
p_IÅ
->
R•ÜtF¿meSts
)

1018 
	`»pÜt_äame_¡©i¡ic
(
p_Vid
, 
p_IÅ
);

1023 #ià
EOS_OUTPUT


1024 
	`’d_of_¡»am
(
p_Vid
);

1027 #ià(
MVC_EXTENSION_ENABLE
)

1028 if(
p_IÅ
->
num_of_v›ws
 == 2)

1030 
p_IÅ
->
RCEÇbË
 = 
tmp_¿‹_cÚŒÞ_’abË
;

1033 
	}
}

1043 
	$ä“_’cod”_memÜy
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1045 
	`‹rmš©e_£qu’û
(
p_Vid
, 
p_IÅ
);

1046 
	`æush_dpb
(
p_Vid
->
p_Dpb_Ïy”
[0], &
p_IÅ
->
ouut
);

1047 
	`æush_dpb
(
p_Vid
->
p_Dpb_Ïy”
[1], &
p_IÅ
->
ouut
);

1048 
	`Clo£Fžes
(&
p_IÅ
->
šput_fže1
);

1050 ià(-1 !ð
p_Vid
->
p_dec
)

1051 
	`þo£
(
p_Vid
->
p_dec
);

1053 #ià(
MVC_EXTENSION_ENABLE
)

1054 if(
p_Vid
->
num_of_Ïy”s
==2)

1055 
	`Clo£Fžes
(&
p_IÅ
->
šput_fže2
);

1056 ià(-1 !ð
p_Vid
->
p_dec2
)

1057 
	`þo£
(
p_Vid
->
p_dec2
);

1060 ià(
p_Enc
->
p_Œaû
)

1061 
	`fþo£
(
p_Enc
->
p_Œaû
);

1063 
	`þ—r_mÙiÚ_£¬ch_moduË
 (
p_Vid
, 
p_IÅ
);

1065 
	`RªdomIÁ¿Unš™
(
p_Vid
);

1066 
	`FmoUnš™
(
p_Vid
);

1068 ià(
p_IÅ
->
Numb”BF¿mes
 &&…_IÅ->
H›¿rchiÿlCodšg
 == 3)

1070 
	`þ—r_gÝ_¡ruùu»
 (
p_Vid
);

1073 #ifdeà
_LEAKYBUCKET_


1074 
	`ÿlc_bufãr
(
p_Vid
, 
p_IÅ
);

1078 
	`»pÜt
(
p_Vid
, 
p_IÅ
,…_Vid->
p_Sts
);

1080 #ifdeà
_LEAKYBUCKET_


1081 
	`ä“_poš‹r
(
p_Vid
->
B™_Bufãr
);

1083 
	`ä“_dpb
(
p_Vid
->
p_Dpb_Ïy”
[0]);

1084 
	`ä“_dpb
(
p_Vid
->
p_Dpb_Ïy”
[1]);

1085 
	`unš™_out_bufãr
(
p_Vid
);

1087 
	`ä“_glob®_bufãrs
(
p_Vid
, 
p_IÅ
);

1089 
	`F»eP¬am‘”S‘s
(
p_Vid
);

1091 ià(
p_IÅ
->
Ex¶ic™SeqCodšg
)

1092 
	`Clo£Ex¶ic™SeqFže
(
p_Vid
);

1095 
	`ä“_img
 (
p_Vid
, 
p_IÅ
);

1096 
	}
}

1108 
	$š™_img
Ð
VideoP¬am‘”s
 *
p_Vid
)

1110 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1111 
i
, 
j
;

1113 
p_Vid
->
numb”
 = -1;

1115 
p_Vid
->
Ï¡_idr_code_Üd”
 = 0;

1116 
p_Vid
->
Ï¡_idr_di¥_Üd”
 = 0;

1117 
p_Vid
->
Ï¡_mmco_5_code_Üd”
 = -1;

1118 
p_Vid
->
Ï¡_mmco_5_di¥_Üd”
 = -1;

1120 
p_Vid
->
yuv_fÜm©
 = 
p_IÅ
->
ouut
.yuv_format;

1121 
p_Vid
->
P444_jošed
 = (p_Vid->
yuv_fÜm©
 =ð
YUV444
 && (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0));

1124 
p_Vid
->
b™d•th_luma
 = (è
p_IÅ
->
ouut
.
b™_d•th
[0];

1125 
p_Vid
->
b™d•th_sÿË
[0] = 1 << (p_Vid->
b™d•th_luma
 - 8);

1126 
p_Vid
->
b™d•th_Ïmbda_sÿË
 = 2 * (p_Vid->
b™d•th_luma
 - 8);

1127 
p_Vid
->
b™d•th_luma_qp_sÿË
 = 3 *…_Vid->
b™d•th_Ïmbda_sÿË
;

1128 
p_Vid
->
dc_´ed_v®ue_comp
[0] = (
img³l
è(1<<Õ_Vid->
b™d•th_luma
 - 1));

1129 
p_Vid
->
max_³l_v®ue_comp
[0] = (1<<p_Vid->
b™d•th_luma
) - 1;

1130 
p_Vid
->
max_img³l_v®ue_comp_sq
[0] =…_Vid->
max_³l_v®ue_comp
[0] *…_Vid->max_pel_value_comp[0];

1132 
p_Vid
->
dc_´ed_v®ue
 =…_Vid->
dc_´ed_v®ue_comp
[0];

1133 
p_Vid
->
max_img³l_v®ue
 = (èp_Vid->
max_³l_v®ue_comp
[0];

1134 
p_Vid
->
mb_size
[0][0] =…_Vid->mb_size[0][1] = 
MB_BLOCK_SIZE
;

1137 
p_Vid
->
RCMšQP
 = 
p_IÅ
->RCMšQP[
P_SLICE
];

1138 
p_Vid
->
RCMaxQP
 = 
p_IÅ
->RCMaxQP[
P_SLICE
];

1140 
p_Vid
->
W®kAround
 = 0;

1141 
p_Vid
->
Numb”OfMBs
 = 0;

1145 ià(
p_Vid
->
aùive_¥s
->
´ofže_idc
 =ð
BASELINE
 ||…_Vid->aùive_¥s->´ofže_idø=ð
MAIN
 ||…_Vid->aùive_¥s->´ofže_idø=ð
EXTENDED
)

1146 
p_Vid
->
mš_IPCM_v®ue
 = 1;

1148 
p_Vid
->
mš_IPCM_v®ue
 = 0;

1150 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

1152 
p_Vid
->
b™d•th_chroma
 = (è
p_IÅ
->
ouut
.
b™_d•th
[1];

1153 
p_Vid
->
b™d•th_sÿË
[1] = 1 << (p_Vid->
b™d•th_chroma
 - 8);

1154 
p_Vid
->
dc_´ed_v®ue_comp
[1] = (
img³l
è(1<<Õ_Vid->
b™d•th_chroma
 - 1));

1155 
p_Vid
->
dc_´ed_v®ue_comp
[2] =…_Vid->dc_pred_value_comp[1];

1156 
p_Vid
->
max_³l_v®ue_comp
[1] = (1<<p_Vid->
b™d•th_chroma
) - 1;

1157 
p_Vid
->
max_³l_v®ue_comp
[2] =…_Vid->max_pel_value_comp[1];

1158 
p_Vid
->
max_img³l_v®ue_comp_sq
[1] =…_Vid->
max_³l_v®ue_comp
[1] *…_Vid->max_pel_value_comp[1];

1159 
p_Vid
->
max_img³l_v®ue_comp_sq
[2] =…_Vid->
max_³l_v®ue_comp
[2] *…_Vid->max_pel_value_comp[2];

1160 
p_Vid
->
num_blk8x8_uv
 = (1<<p_Vid->
yuv_fÜm©
)&(~(0x1));

1161 
p_Vid
->
num_cdc_cÛff
 =…_Vid->
num_blk8x8_uv
 << 1;

1163 
p_Vid
->
mb_size
[1][0] =…_Vid->mb_size[2][0] =…_Vid->
mb_ü_size_x
 = (p_Vid->
yuv_fÜm©
 =ð
YUV420
 ||…_Vid->yuv_fÜm© =ð
YUV422
) ? 8 : 16;

1164 
p_Vid
->
mb_size
[1][1] =…_Vid->mb_size[2][1] =…_Vid->
mb_ü_size_y
 = (p_Vid->
yuv_fÜm©
 =ð
YUV444
 ||…_Vid->yuv_fÜm© =ð
YUV422
) ? 16 : 8;

1166 
p_Vid
->
b™d•th_chroma_qp_sÿË
 = 6*Õ_Vid->
b™d•th_chroma
 - 8);

1168 
p_Vid
->
chroma_qp_off£t
[0] =…_Vid->
aùive_µs
->
cb_qp_šdex_off£t
;

1169 
p_Vid
->
chroma_qp_off£t
[1] =…_Vid->
aùive_µs
->
ü_qp_šdex_off£t
;

1173 
p_Vid
->
b™d•th_chroma
 = 0;

1174 
p_Vid
->
b™d•th_sÿË
[1] = 0;

1175 
p_Vid
->
max_³l_v®ue_comp
[1] = 0;

1176 
p_Vid
->
max_³l_v®ue_comp
[2] =…_Vid->max_pel_value_comp[1];

1177 
p_Vid
->
max_img³l_v®ue_comp_sq
[1] =…_Vid->
max_³l_v®ue_comp
[1] *…_Vid->max_pel_value_comp[1];

1178 
p_Vid
->
max_img³l_v®ue_comp_sq
[2] =…_Vid->
max_³l_v®ue_comp
[2] *…_Vid->max_pel_value_comp[2];

1179 
p_Vid
->
num_blk8x8_uv
 = 0;

1180 
p_Vid
->
num_cdc_cÛff
 = 0;

1181 
p_Vid
->
mb_size
[1][0] =…_Vid->mb_size[2][0] =…_Vid->
mb_ü_size_x
 = 0;

1182 
p_Vid
->
mb_size
[1][1] =…_Vid->mb_size[2][1] =…_Vid->
mb_ü_size_y
 = 0;

1184 
p_Vid
->
b™d•th_chroma_qp_sÿË
 = 0;

1186 
p_Vid
->
chroma_qp_off£t
[0] = 0;

1187 
p_Vid
->
chroma_qp_off£t
[1] = 0;

1190 
p_Vid
->
max_b™CouÁ
 = 128 + 256 *…_Vid->
b™d•th_luma
 + 2 *…_Vid->
mb_ü_size_y
 *…_Vid->
mb_ü_size_x
 *…_Vid->
b™d•th_chroma
;

1193 
p_Vid
->
max_qp_d–
 = (25 + (p_Vid->
b™d•th_luma_qp_sÿË
>>1));

1194 
p_Vid
->
mš_qp_d–
 =…_Vid->
max_qp_d–
 + 1;

1196 
p_Vid
->
num_»f_äames
 =…_Vid->
aùive_¥s
->num_ref_frames;

1197 
p_Vid
->
max_num_»ã»nûs
 =…_Vid->
aùive_¥s
->
äame_mbs_Úly_æag
 ?…_Vid->aùive_¥s->
num_»f_äames
 : 2 *…_Vid->active_sps->num_ref_frames;

1199 #ià(
MVC_EXTENSION_ENABLE
)

1200 
p_Vid
->
£c_v›w_fÜû_æd
 = 0;

1203 
p_Vid
->
ba£_di¡
 = 
p_IÅ
->
jumpd
 + 1;

1206 
p_Vid
->
Ï¡IÁ¿Numb”
 = 0;

1207 
p_Vid
->
Ï¡INTRA
 = 0;

1208 
p_Vid
->
Ï¡_»f_idc
 = 0;

1209 
p_Vid
->
idr_»äesh
 = 0;

1211 
p_Vid
->
äam”©e
 = (è
p_IÅ
->
ouut
.
äame_¿‹
;

1213 ià(
p_IÅ
->
Ad­tiveRoundšg
)

1215 ià(
p_Vid
->
yuv_fÜm©
 != 0)

1217 
	`g‘_mem4Dšt
(&(
p_Vid
->
ARCofAdj4x4
), 3, 
MAXMODE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1218 
	`g‘_mem4Dšt
(&(
p_Vid
->
ARCofAdj8x8
),…_Vid->
P444_jošed
 ? 3 : 1, 
MAXMODE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1222 
	`g‘_mem4Dšt
(&(
p_Vid
->
ARCofAdj4x4
), 1, 
MAXMODE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1223 
	`g‘_mem4Dšt
(&(
p_Vid
->
ARCofAdj8x8
), 1, 
MAXMODE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1227 
p_Vid
->
width
 = (
p_IÅ
->
ouut
.width[0] +…_Vid->
auto_üÝ_right
);

1228 
p_Vid
->
height
 = (
p_IÅ
->
ouut
.height[0] +…_Vid->
auto_üÝ_bÙtom
);

1229 
p_Vid
->
width_blk
 =…_Vid->
width
 / 
BLOCK_SIZE
;

1230 
p_Vid
->
height_blk
 =…_Vid->
height
 / 
BLOCK_SIZE
;

1231 
p_Vid
->
width_·dded
 =…_Vid->
width
 + 2 * 
IMG_PAD_SIZE_X
;

1232 
p_Vid
->
height_·dded
 =…_Vid->
height
 + 2 * 
IMG_PAD_SIZE_Y
;

1234 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

1236 
p_Vid
->
width_ü
 =…_Vid->
width
 * 
mb_width_ü
 [p_Vid->
yuv_fÜm©
] / 16;

1237 
p_Vid
->
height_ü
ðp_Vid->
height
 * 
mb_height_ü
[p_Vid->
yuv_fÜm©
] / 16;

1241 
p_Vid
->
width_ü
 = 0;

1242 
p_Vid
->
height_ü
= 0;

1245 
p_Vid
->
height_ü_äame
 =…_Vid->
height_ü
;

1247 
p_Vid
->
size
 =…_Vid->
width
 *…_Vid->
height
;

1248 
p_Vid
->
size_ü
 =…_Vid->
width_ü
 *…_Vid->
height_ü
;

1250 
p_Vid
->
PicWidthInMbs
 =…_Vid->
width
 / 
MB_BLOCK_SIZE
;

1251 
p_Vid
->
F¿meHeightInMbs
 =…_Vid->
height
 / 
MB_BLOCK_SIZE
;

1252 
p_Vid
->
F¿meSizeInMbs
 =…_Vid->
PicWidthInMbs
 *…_Vid->
F¿meHeightInMbs
;

1254 
p_Vid
->
PicHeightInM­Un™s
 = (…_Vid->
aùive_¥s
->
äame_mbs_Úly_æag
 ?…_Vid->
F¿meHeightInMbs
 :…_Vid->FrameHeightInMbs >> 1 );

1256 ià((
p_Vid
->
b8x8šfo
 = (
Block8x8Info
 *è
	`ÿÎoc
(1, (Block8x8Info))è=ð
NULL
)

1257 
	`no_mem_ex™
("init_img:…_Vid->block8x8info");

1259 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1261  
i
 = 0; i < 
MAX_PLANE
; i++ ){

1263 if((
p_Vid
->
mb_d©a_JV
[
i
] = 
	`®loc_mbs
Õ_Vid,…_Vid->
F¿meSizeInMbs
,…_Vid->
num_of_Ïy”s
)è=ð
NULL
)

1264 
	`no_mem_ex™
("init_img:…_Vid->mb_data_JV");

1266 
p_Vid
->
mb_d©a
 = 
NULL
;

1271 ià((
p_Vid
->
mb_d©a
 = 
	`®loc_mbs
Õ_Vid,…_Vid->
F¿meSizeInMbs
,…_Vid->
num_of_Ïy”s
)è=ð
NULL
)

1272 
	`no_mem_ex™
("init_img:…_Vid->mb_data");

1275 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

1277 ià((
p_Vid
->
šŒa_block
 = (*è
	`ÿÎoc
Õ_Vid->
F¿meSizeInMbs
, ())è=ð
NULL
)

1278 
	`no_mem_ex™
("init_img:…_Vid->intra_block");

1281 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

1283 ià((
p_Vid
->
mb16x16_co¡_äame
 = (*)
	`ÿÎoc
Õ_Vid->
F¿meSizeInMbs
, ())è=ð
NULL
)

1285 
	`no_mem_ex™
("init…_Vid->mb16x16_cost_frame");

1288 
	`g‘_mem2D
((
by‹
***)&(
p_Vid
->
»dmode
),…_Vid->
height_blk
,…_Vid->
width_blk
);

1289 
	`g‘_mem2D
((
by‹
***)&(
p_Vid
->
»dmode8x8
),…_Vid->
height_blk
,…_Vid->
width_blk
);

1290 
	`mem£t
(&(
p_Vid
->
»dmode
[0][0]è, -1,…_Vid->
height_blk
 *…_Vid->
width_blk
 *());

1291 
	`mem£t
(&(
p_Vid
->
»dmode8x8
[0][0]), -1,…_Vid->
height_blk
 *…_Vid->
width_blk
 *());

1295 if(
p_Vid
->
num_of_Ïy”s
>1)

1297 
	`g‘_mem3Dšt
(&(
p_Vid
->
nz_cÛff_buf
[0]),…_Vid->
F¿meSizeInMbs
, 4, 4+p_Vid->
num_blk8x8_uv
);

1298 if(
p_Vid
->
p_Dpb_Ïy”
[1]->
¡Üage_fÜm©
.
yuv_fÜm©
 !ð
YUV400
 &&…_Vid->p_Dpb_layer[1]->storage_format.yuv_format !=…_Vid->p_Dpb_layer[0]->storage_format.yuv_format)

1300 
num_blk8x8_uv
 = (1<<
p_Vid
->
p_Dpb_Ïy”
[1]->
¡Üage_fÜm©
.
yuv_fÜm©
)&(~(0x1));

1301 
	`g‘_mem3Dšt
(&(
p_Vid
->
nz_cÛff_buf
[1]),…_Vid->
F¿meSizeInMbs
, 4, 4+
num_blk8x8_uv
);

1304 
p_Vid
->
nz_cÛff_buf
[1] =…_Vid->nz_coeff_buf[0];

1305 
p_Vid
->
nz_cÛff
 =…_Vid->
nz_cÛff_buf
[0];

1309 
	`g‘_mem3Dšt
(&(
p_Vid
->
nz_cÛff_buf
[0]),…_Vid->
F¿meSizeInMbs
, 4, 4+p_Vid->
num_blk8x8_uv
);

1310 
p_Vid
->
nz_cÛff
 =…_Vid->
nz_cÛff_buf
[0];

1311 
p_Vid
->
nz_cÛff_buf
[1] = 
NULL
;

1314 
	`g‘_mem2DÞm
 (&(
p_Vid
->
Ïmbda_buf
[0]è, 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

1315 
p_Vid
->
Ïmbda
 =…_Vid->
Ïmbda_buf
[0];

1316 
	`g‘_mem2DodoubË
 (&(
p_Vid
->
Ïmbda_md_buf
[0]), 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

1317 
p_Vid
->
Ïmbda_md
 =…_Vid->
Ïmbda_md_buf
[0];

1318 
	`g‘_mem3DodoubË
 (&(
p_Vid
->
Ïmbda_me_buf
[0]), 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
, 3,…_Vid->bitdepth_luma_qp_scale);

1319 
p_Vid
->
Ïmbda_me
 =…_Vid->
Ïmbda_me_buf
[0];

1320 
	`g‘_mem3Došt
 (&(
p_Vid
->
Ïmbda_mf_buf
[0]), 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
, 3,…_Vid->bitdepth_luma_qp_scale);

1321 
p_Vid
->
Ïmbda_mf
 =…_Vid->
Ïmbda_mf_buf
[0];

1322 iàÐ
p_IÅ
->
U£RDOQuªt
 )

1324 
	`g‘_mem2DodoubË
 (&(
p_Vid
->
Ïmbda_rdoq_buf
[0]), 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

1325 
p_Vid
->
Ïmbda_rdoq
 =…_Vid->
Ïmbda_rdoq_buf
[0];

1327 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

1329 
	`g‘_mem2DodoubË
(&(
p_Vid
->
Ïmbda_mf_çùÜ_buf
[0]), 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

1330 
p_Vid
->
Ïmbda_mf_çùÜ
 =…_Vid->
Ïmbda_mf_çùÜ_buf
[0];

1332 if(
p_Vid
->
num_of_Ïy”s
>1)

1334 
p_Vid
->
Ïmbda_buf
[1] =…_Vid->lambda_buf[0];

1335 
p_Vid
->
Ïmbda_md_buf
[1] =…_Vid->lambda_md_buf[0];

1336 
p_Vid
->
Ïmbda_me_buf
[1] =…_Vid->lambda_me_buf[0];

1337 
p_Vid
->
Ïmbda_mf_buf
[1] =…_Vid->lambda_mf_buf[0];

1338 
p_Vid
->
Ïmbda_rdoq_buf
[1] =…_Vid->lambda_rdoq_buf[0];

1339 
p_Vid
->
Ïmbda_mf_çùÜ_buf
[1] =…_Vid->lambda_mf_factor_buf[0];

1342 
p_Vid
->
mb_y_upd
 = 0;

1344 if(((
p_IÅ
->
RDPiùu»DecisiÚ
è&&…_IÅ->
G’”©eMuÉËPPS
è|| (p_IÅ->
Weigh‹dP»diùiÚ
 ||…_IÅ->
Weigh‹dB»diùiÚ
))

1346 
num_¦iûs
;

1348 if(
p_IÅ
->
¦iû_mode
 == 1)

1350 
num_¦iûs
 = 
p_Vid
->
F¿meSizeInMbs
/
p_IÅ
->
¦iû_¬gum’t
;

1351 if(()(
num_¦iûs
 * 
p_IÅ
->
¦iû_¬gum’t
è< 
p_Vid
->
F¿meSizeInMbs
)

1352 
num_¦iûs
++;

1355 
num_¦iûs
 = 1;

1359 
p_Vid
->
num_¦iûs_wp
 = 
num_¦iûs
;

1360 
	`g‘_mem4DshÜt
(&(
p_Vid
->
wp_weights
), 3, 2, 
MAX_REFERENCE_PICTURES
, 
num_¦iûs
);

1361 
	`g‘_mem4DshÜt
(&(
p_Vid
->
wp_off£ts
), 3, 2, 
MAX_REFERENCE_PICTURES
, 
num_¦iûs
);

1362 
	`g‘_mem5DshÜt
(&(
p_Vid
->
wbp_weight
), 3, 2, 
MAX_REFERENCE_PICTURES
, MAX_REFERENCE_PICTURES, 
num_¦iûs
);

1366 
p_Vid
->
num_¦iûs_wp
 = 0;

1367 
p_Vid
->
wp_weights
 = 
NULL
;

1368 
p_Vid
->
wp_off£ts
 = 
NULL
;

1369 
p_Vid
->
wbp_weight
 = 
NULL
;

1372 
	`RªdomIÁ¿In™
 (
p_Vid
,…_Vid->
PicWidthInMbs
,…_Vid->
F¿meHeightInMbs
, 
p_IÅ
->
RªdomIÁ¿MBReäesh
);

1374 
	`In™SEIMes§ges
(
p_Vid
, 
p_IÅ
);

1376 
	`š™IÅut
(
p_Vid
, &
p_IÅ
->
sourû
, &p_IÅ->
ouut
);

1379 
	`AÎoÿ‹F¿meMemÜy
(
p_Vid
, 
p_IÅ
, &p_IÅ->
sourû
);

1384 ià(
p_IÅ
->
DFS’dP¬am‘”s
)

1386 
j
 = 0; j < 2; j++)

1388 
i
 = 0; i < 
NUM_SLICE_TYPES
; i++)

1390 
p_IÅ
->
DFAÍha
[
j
][
i
] <<= 1;

1391 
p_IÅ
->
DFB‘a
 [
j
][
i
] <<= 1;

1392 #ià(
MVC_EXTENSION_ENABLE
)

1393 ià(
p_Vid
->
num_of_Ïy”s
 == 2)

1395 
p_IÅ
->
EnhLay”DFAÍha
[
j
][
i
] <<= 1;

1396 
p_IÅ
->
EnhLay”DFB‘a
 [
j
][
i
] <<= 1;

1404 
j
 = 0; j < 2; j++)

1406 
i
 = 0; i < 
NUM_SLICE_TYPES
; i++)

1408 
p_IÅ
->
DFDi§bËIdc
[
j
][
i
] = 0;

1409 
p_IÅ
->
DFAÍha
 [
j
][
i
] = 0;

1410 
p_IÅ
->
DFB‘a
 [
j
][
i
] = 0;

1411 #ià(
MVC_EXTENSION_ENABLE
)

1412 ià(
p_Vid
->
num_of_Ïy”s
 == 2)

1414 
p_IÅ
->
EnhLay”DFDi§bËIdc
[
j
][
i
] = 0;

1415 
p_IÅ
->
EnhLay”DFAÍha
[
j
][
i
] = 0;

1416 
p_IÅ
->
EnhLay”DFB‘a
 [
j
][
i
] = 0;

1423 
p_Vid
->
ChromaA¼ayTy³
 = 
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 ? 0 :…_IÅ->
ouut
.
yuv_fÜm©
;

1424 
p_Vid
->
cÞour_¶ªe_id
 = 0;

1426 ià(
p_IÅ
->
RDPiùu»DecisiÚ
)

1427 
p_Vid
->
äm_™”
 = 3;

1429 
p_Vid
->
äm_™”
 = 1;

1431 
p_Vid
->
max_äame_num
 = 1 << (p_Vid->
log2_max_äame_num_mšus4
 + 4);

1432 
p_Vid
->
max_pic_Üd”_út_lsb
 = 1 << (p_Vid->
log2_max_pic_Üd”_út_lsb_mšus4
 + 4);

1434 
p_Vid
->
´ev_äame_no
 = 0;

1435 
p_Vid
->
cÚ£cutive_nÚ_»ã»nû_piùu»s
 = 0;

1437 
p_Vid
->
æd_ty³
 = 0;

1439 
p_Vid
->
p_IÅ
 =…_Inp;

1441 
	`ü—‹_cÚ‹xt_memÜy
 (
p_Vid
, 
p_IÅ
);

1443 
	}
}

1454 
	$ä“_img
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1457 
	`D–‘eF¿meMemÜy
(
p_Vid
);

1459 
	`Clo£SEIMes§ges
(
p_Vid
, 
p_IÅ
);

1461 
	`ä“_cÚ‹xt_memÜy
 (
p_Vid
);

1463 ià(
p_IÅ
->
Ad­tiveRoundšg
)

1465 
	`ä“_mem4Dšt
(
p_Vid
->
ARCofAdj4x4
);

1466 
	`ä“_mem4Dšt
(
p_Vid
->
ARCofAdj8x8
);

1469 ià(
p_Vid
->
wp_weights
)

1470 
	`ä“_mem4DshÜt
(
p_Vid
->
wp_weights
);

1471 ià(
p_Vid
->
wp_off£ts
)

1472 
	`ä“_mem4DshÜt
(
p_Vid
->
wp_off£ts
);

1473 ià(
p_Vid
->
wbp_weight
)

1474 
	`ä“_mem5DshÜt
(
p_Vid
->
wbp_weight
);

1476 
	`F»eHMEInfo
 (
p_Vid
);

1477 
	`ä“_poš‹r
 (
p_Vid
->
p_SEI
);

1478 
	`ä“_poš‹r
 (
p_Vid
->
p_QSÿË
);

1479 
	`ä“_poš‹r
 (
p_Vid
->
p_Quªt
);

1480 
	`ä“_poš‹r
 (
p_Vid
->
p_Dpb_Ïy”
[0]);

1481 
p_Vid
->
p_Dpb_Ïy”
[0] =…_Vid->p_Dpb_Ïy”[1] = 
NULL
;

1482 
	`ä“_poš‹r
 (
p_Vid
->
p_Sts
);

1483 
	`ä“_poš‹r
 (
p_Vid
->
p_Di¡
);

1485 
	`ä“_’code_·¿m‘”s
(
p_Vid
);

1486 
	`ä“_poš‹r
 (
p_Vid
);

1487 
	}
}

1498 
	$ä“_·¿ms
 (
IÅutP¬am‘”s
 *
p_IÅ
)

1500 iàÐ
p_IÅ
 !ð
NULL
 )

1502 
	`ä“_poš‹r
Ð
p_IÅ
->
tÝ_Ëá
 );

1503 
	`ä“_poš‹r
Ð
p_IÅ
->
bÙtom_right
 );

1504 
	`ä“_poš‹r
Ð
p_IÅ
->
¦iû_group_id
 );

1505 
	`ä“_poš‹r
Ð
p_IÅ
->
run_Ëngth_mšus1
 );

1506 
	`ä“_poš‹r
Ð
p_IÅ
 );

1508 
	}
}

1520 
Piùu»
 *
	$m®loc_piùu»
()

1522 
Piùu»
 *
pic
;

1523 ià((
pic
 = 
	`ÿÎoc
 (1,  (
Piùu»
))è=ð
NULL
è
	`no_mem_ex™
 ("malloc_picture: Picture structure");

1525  
pic
;

1526 
	}
}

1536 
	$ä“_piùu»
(
Piùu»
 *
pic
)

1538 ià(
pic
 !ð
NULL
)

1540 
	`ä“_¦iû_li¡
(
pic
);

1541 
	`ä“_poš‹r
 (
pic
);

1543 
	}
}

1552 
	$š™_Üig_bufãrs
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
)

1554 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1555 
memÜy_size
 = 0;

1556 
ÅÏÃ
;

1559 
imgD©a
->
fÜm©
 = 
p_IÅ
->
ouut
;

1560 
imgD©a
->
fÜm©
.
width
[0] = 
p_Vid
->width;

1561 
imgD©a
->
fÜm©
.
width
[1] = 
p_Vid
->
width_ü
;

1562 
imgD©a
->
fÜm©
.
width
[2] = 
p_Vid
->
width_ü
;

1563 
imgD©a
->
fÜm©
.
height
[0] = 
p_Vid
->height;

1564 
imgD©a
->
fÜm©
.
height
[1] = 
p_Vid
->
height_ü
;

1565 
imgD©a
->
fÜm©
.
height
[2] = 
p_Vid
->
height_ü
;

1566 
imgD©a
->
fÜm©
.
yuv_fÜm©
 = 
p_Vid
->yuv_format;

1567 
imgD©a
->
fÜm©
.
auto_üÝ_bÙtom
 = 
p_Vid
->auto_crop_bottom;

1568 
imgD©a
->
fÜm©
.
auto_üÝ_right
 = 
p_Vid
->auto_crop_right;

1569 
imgD©a
->
fÜm©
.
auto_üÝ_bÙtom_ü
 = (
p_Vid
->
auto_üÝ_bÙtom
 * 
mb_height_ü
 [p_Vid->
yuv_fÜm©
]è/ 
MB_BLOCK_SIZE
;

1570 
imgD©a
->
fÜm©
.
auto_üÝ_right_ü
 = (
p_Vid
->
auto_üÝ_right
 * 
mb_width_ü
 [p_Vid->
yuv_fÜm©
]è/ 
MB_BLOCK_SIZE
;

1571 
imgD©a
->
äm_¡ride
[0] = 
p_Vid
->
width
;

1572 
imgD©a
->
äm_¡ride
[1] = imgD©a->äm_¡ride[2] = 
p_Vid
->
width_ü
;

1573 
imgD©a
->
tÝ_¡ride
[0] = imgD©a->
bÙ_¡ride
[0] = imgD©a->
äm_¡ride
[0] << 1;

1574 
imgD©a
->
tÝ_¡ride
[1] = imgD©a->tÝ_¡ride[2] = imgD©a->
bÙ_¡ride
[1] = imgD©a->bÙ_¡ride[2] = imgD©a->
äm_¡ride
[1] << 1;

1576 
imgD©a
->
äm_d©a_buf
[0][0] = imgD©a->äm_d©a_buf[0][1] = imgD©a->äm_d©a_buf[0][2] = 
NULL
;

1577 
imgD©a
->
äm_d©a_buf
[1][0] = imgD©a->äm_d©a_buf[1][1] = imgD©a->äm_d©a_buf[1][2] = 
NULL
;

1578 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1580  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

1582 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
imgD©a
->
äm_d©a
[
ÅÏÃ
]), 
p_Vid
->
height
,…_Vid->
width
);

1588 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
imgD©a
->
äm_d©a
[0]), 
p_Vid
->
height
,…_Vid->
width
);

1590 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

1592 
i
, 
j
, 
k
;

1593 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
imgD©a
->
äm_d©a
[1]), 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

1594 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
imgD©a
->
äm_d©a
[2]), 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

1596 ià((
img³l
) == ())

1598 
k
 = 1; k < 3; k++)

1599 
	`mem£t
(&(
imgD©a
->
äm_d©a
[
k
][0][0]), 128, 
p_Vid
->
height_ü
 *…_Vid->
width_ü
 * (
img³l
));

1603 
k
 = 1; k < 3; k++)

1604 
j
 = 0; j < 
p_Vid
->
height_ü
; j++)

1605 
i
 = 0; i < 
p_Vid
->
width_ü
; i++)

1606 
imgD©a
->
äm_d©a
[
k
][
j
][
i
] = 128;

1611 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

1614 
memÜy_size
 +ð
	`š™_tÝ_bÙ_¶ªes
(
imgD©a
->
äm_d©a
[0], 
p_Vid
->
height
, &(imgD©a->
tÝ_d©a
[0]), &(imgD©a->
bÙ_d©a
[0]));

1616 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

1618 
memÜy_size
 +ð4*((
img³l
**));

1620 
memÜy_size
 +ð
	`š™_tÝ_bÙ_¶ªes
(
imgD©a
->
äm_d©a
[1], 
p_Vid
->
height_ü
, &(imgD©a->
tÝ_d©a
[1]), &(imgD©a->
bÙ_d©a
[1]));

1621 
memÜy_size
 +ð
	`š™_tÝ_bÙ_¶ªes
(
imgD©a
->
äm_d©a
[2], 
p_Vid
->
height_ü
, &(imgD©a->
tÝ_d©a
[2]), &(imgD©a->
bÙ_d©a
[2]));

1624  
memÜy_size
;

1625 
	}
}

1639 
	$š™_glob®_bufãrs
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1641 
j
, 
memÜy_size
=0;

1643 ià((
p_Vid
->
’c_äame_piùu»
 = (
StÜabËPiùu»
**)
	`m®loc
(6 * (StÜabËPiùu»*))è=ð
NULL
)

1644 
	`no_mem_ex™
("init_global_buffers: *p_Vid->enc_frame_picture");

1646 
j
 = 0; j < 6; j++)

1647 
p_Vid
->
’c_äame_piùu»
[
j
] = 
NULL
;

1649 ià((
p_Vid
->
’c_f›ld_piùu»
 = (
StÜabËPiùu»
**)
	`m®loc
(2 * (StÜabËPiùu»*))è=ð
NULL
)

1650 
	`no_mem_ex™
("init_global_buffers: *p_Vid->enc_field_picture");

1652 
j
 = 0; j < 2; j++)

1653 
p_Vid
->
’c_f›ld_piùu»
[
j
] = 
NULL
;

1655 ià((
p_Vid
->
äame_pic
 = (
Piùu»
**)
	`m®loc
Õ_Vid->
äm_™”
 * (Piùu»*))è=ð
NULL
)

1656 
	`no_mem_ex™
("init_global_buffers: *p_Vid->frame_pic");

1658 
j
 = 0; j < 
p_Vid
->
äm_™”
; j++)

1659 
p_Vid
->
äame_pic
[
j
] = 
	`m®loc_piùu»
();

1661 ià(
p_IÅ
->
si_äame_šdiÿtÜ
 ||…_IÅ->
¥_³riodic™y
)

1663 
p_Vid
->
numb”_¥2_äames
=0;

1664 
p_Vid
->
äame_pic_si
 = 
	`m®loc_piùu»
();

1666 
	`g‘_mem2Dšt
 (&
p_Vid
->
Ìec
,…_Vid->
height
,…_Vid->
width
);

1667 
	`g‘_mem3Dšt
 (&
p_Vid
->
Ìec_uv
, 2,…_Vid->
height
,…_Vid->
width
);

1670 #ià(
MVC_EXTENSION_ENABLE
)

1671 
p_Vid
->
f›ld_pic_±r
 = 
NULL
;

1672 
p_Vid
->
f›ld_pic1
 = 
NULL
;

1673 
p_Vid
->
f›ld_pic2
 = 
NULL
;

1676 ià(
p_IÅ
->
PicIÁ”Ïû
 !ð
FRAME_CODING
)

1678 ià((
p_Vid
->
f›ld_pic1
 = (
Piùu»
**)
	`m®loc
(2 * (Piùu»*))è=ð
NULL
)

1679 
	`no_mem_ex™
("init_global_buffers: *p_Vid->field_pic1");

1681 
j
 = 0; j < 2; j++)

1682 
p_Vid
->
f›ld_pic1
[
j
] = 
	`m®loc_piùu»
();

1684 if(
p_Vid
->
num_of_Ïy”s
==2)

1686 ià((
p_Vid
->
f›ld_pic2
 = (
Piùu»
**)
	`m®loc
(2 * (Piùu»*))è=ð
NULL
)

1687 
	`no_mem_ex™
("init_global_buffers: *p_Vid->field_pic2");

1689 
j
 = 0; j < 2; j++)

1690 
p_Vid
->
f›ld_pic2
[
j
] = 
	`m®loc_piùu»
();

1695 ià(
p_IÅ
->
PicIÁ”Ïû
 !ð
FRAME_CODING
)

1697 ià((
p_Vid
->
f›ld_pic
 = (
Piùu»
**)
	`m®loc
(2 * (Piùu»*))è=ð
NULL
)

1698 
	`no_mem_ex™
("init_global_buffers: *p_Vid->field_pic");

1700 
j
 = 0; j < 2; j++)

1701 
p_Vid
->
f›ld_pic
[
j
] = 
	`m®loc_piùu»
();

1706 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a
);

1708 iàÐ
p_IÅ
->
MDReã»nû
[0] ||…_Inp->MDReference[1] )

1710 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgRefD©a
);

1713 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a0
);

1715 ià(
p_IÅ
->
’abË_32_puÎdown
)

1717 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a32
);

1718 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a4
);

1719 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a5
);

1720 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
imgD©a6
);

1725 
p_Vid
->
PicPos
 = 
	`ÿÎoc
Õ_Vid->
F¿meSizeInMbs
 + 1, (
BlockPos
));

1727 
j
 = 0; j < (è
p_Vid
->
F¿meSizeInMbs
 + 1; j++)

1729 
p_Vid
->
PicPos
[
j
].
x
 = (è(j %…_Vid->
PicWidthInMbs
);

1730 
p_Vid
->
PicPos
[
j
].
y
 = (è(j /…_Vid->
PicWidthInMbs
);

1734 ià(
p_IÅ
->
rdÝt
 == 3)

1736 
memÜy_size
 +ð
	`®loÿ‹_”rdo_mem
(
p_Vid
, 
p_IÅ
);

1739 ià(
p_IÅ
->
Re¡riùRef
)

1741 
memÜy_size
 +ð
	`g‘_mem2D
(&
p_Vid
->
pix–_m­
,…_Vid->
height
,…_Vid->
width
);

1742 
memÜy_size
 +ð
	`g‘_mem2D
(&
p_Vid
->
»äesh_m­
,…_Vid->
height
 >> 3,…_Vid->
width
 >> 3);

1745 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

1747 
j
=0; j<
p_Vid
->
num_of_Ïy”s
; j++)

1749 
CodšgP¬am‘”s
 *
ýs
 = 
p_Vid
->
p_EncodeP¬
[
j
];

1750 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
p_Vid
->
imgY_com_buf
[
j
]), 
ýs
->
height
, cps->
width
);

1751 ià(
ýs
->
yuv_fÜm©
 !ð
YUV400
)

1753 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
p_Vid
->
imgUV_com_buf
[
j
][0]), 
ýs
->
height_ü
, cps->
width_ü
);

1754 
memÜy_size
 +ð
	`g‘_mem2D³l
(&(
p_Vid
->
imgUV_com_buf
[
j
][1]), 
ýs
->
height_ü
, cps->
width_ü
);

1758 
p_Vid
->
imgY_com
 =…_Vid->
imgY_com_buf
[0];

1759 
p_Vid
->
imgUV_com
[0] =…_Vid->
imgUV_com_buf
[0][0];

1760 
p_Vid
->
imgUV_com
[1] =…_Vid->
imgUV_com_buf
[0][1];

1764 ià(!
p_IÅ
->
IÁ¿Profže
)

1766 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX
 ||…_Inp->SearchMode[1] == UM_HEX)

1768 ià((
p_Vid
->
p_UMHex
 = (
UMHexSŒuù
*)
	`ÿÎoc
(1, (UMHexSŒuù))è=ð
NULL
)

1769 
	`no_mem_ex™
("init_mv_block:…_Vid->p_UMHex");

1770 
memÜy_size
 +ð
	`UMHEX_g‘_mem
(
p_Vid
, 
p_IÅ
);

1772 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX_SIMPLE
 ||…_Inp->SearchMode[1] == UM_HEX_SIMPLE)

1774 ià((
p_Vid
->
p_UMHexSMP
 = (
UMHexSMPSŒuù
*)
	`ÿÎoc
(1, (UMHexSMPSŒuù))è=ð
NULL
)

1775 
	`no_mem_ex™
("init_mv_block:…_Vid->p_UMHexSMP");

1777 
	`smpUMHEX_š™
(
p_Vid
);

1778 
memÜy_size
 +ð
	`smpUMHEX_g‘_mem
(
p_Vid
);

1780 ià(
p_IÅ
->
S—rchMode
[0] =ð
EPZS
 ||…_Inp->SearchMode[1] == EPZS)

1782 
memÜy_size
 +ð
	`EPZSIn™
(
p_Vid
);

1786 ià(
p_IÅ
->
RCEÇbË
)

1787 
	`rc_®loÿ‹_memÜy
(
p_Vid
, 
p_IÅ
);

1789 ià(
p_IÅ
->
»dundªt_pic_æag
)

1791 
j
=0; j<
p_Vid
->
num_of_Ïy”s
; j++)

1793 
CodšgP¬am‘”s
 *
ýs
 = 
p_Vid
->
p_EncodeP¬
[
j
];

1794 
memÜy_size
 +ð
	`g‘_mem2D³l
(&
p_Vid
->
imgY_tmp_buf
[
j
], 
ýs
->
height
, cps->
width
);

1795 
memÜy_size
 +ð
	`g‘_mem2D³l
(&
p_Vid
->
imgUV_tmp_buf
[
j
][0], 
ýs
->
height_ü
, cps->
width_ü
);

1796 
memÜy_size
 +ð
	`g‘_mem2D³l
(&
p_Vid
->
imgUV_tmp_buf
[
j
][1], 
ýs
->
height_ü
, cps->
width_ü
);

1798 
p_Vid
->
imgY_tmp
 =…_Vid->
imgY_tmp_buf
[0];

1799 
p_Vid
->
imgUV_tmp
[0] =…_Vid->
imgUV_tmp_buf
[0][0];

1800 
p_Vid
->
imgUV_tmp
[1] =…_Vid->
imgUV_tmp_buf
[0][1];

1803 ifÐ!(
p_IÅ
->
OnTheFlyF¿ùMCP
è|| (p_IÅ->OnTheFlyF¿ùMCP==
OTF_L1
) )

1805 
memÜy_size
 +ð
	`g‘_mem2Dšt_·d
 (&
p_Vid
->
imgY_sub_tmp
,…_Vid->
height
,…_Vid->
width
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

1809 
	`chroma_mc_£tup
(
p_Vid
);

1811 
p_Vid
->
·dded_size_x
 = (p_Vid->
width
 + 2 * 
IMG_PAD_SIZE_X
);

1812 
p_Vid
->
·dded_size_x_m8x8
 = (p_Vid->
·dded_size_x
 - 
BLOCK_SIZE_8x8
);

1813 
p_Vid
->
·dded_size_x_m4x4
 = (p_Vid->
·dded_size_x
 - 
BLOCK_SIZE
);

1814 
p_Vid
->
ü_·dded_size_x
 = (p_Vid->
width_ü
 + 2 *…_Vid->
·d_size_uv_x
);

1815 
p_Vid
->
ü_·dded_size_x2
 = (p_Vid->
ü_·dded_size_x
 << 1);

1816 
p_Vid
->
ü_·dded_size_x4
 = (p_Vid->
ü_·dded_size_x
 << 2);

1817 
p_Vid
->
ü_·dded_size_x_m8
 = (p_Vid->
ü_·dded_size_x
 - 8);

1822 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
)

1824 
memÜy_size
 +ð
	`ü—‹_RGB_memÜy
(
p_Vid
);

1827 
p_Vid
->
pWPX
 = 
NULL
;

1828 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

1830 
	`wpxIn™WPXObjeù
(
p_Vid
);

1833 
memÜy_size
 +ð
	`š™_´oûss_image
Ð
p_Vid
, 
p_IÅ
 );

1835 
p_Vid
->
p_´ed
 = 
	`š™_£q_¡ruùu»
Ðp_Vid, 
p_IÅ
, &
memÜy_size
 );

1837  
memÜy_size
;

1838 
	}
}

1846 
	$ä“_Üig_¶ªes
(
VideoP¬am‘”s
 *
p_Vid
, 
ImageD©a
 *
imgD©a
)

1848 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

1850 
ÅÏÃ
;

1851  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

1853 
	`ä“_mem2D³l
(
imgD©a
->
äm_d©a
[
ÅÏÃ
]);

1854 
imgD©a
->
äm_d©a
[
ÅÏÃ
] = 
NULL
;

1859 
	`ä“_mem2D³l
(
imgD©a
->
äm_d©a
[0]);

1860 
imgD©a
->
äm_d©a
[0] = 
NULL
;

1861 ià(
imgD©a
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

1863 
	`ä“_mem2D³l
(
imgD©a
->
äm_d©a
[1]);

1864 
imgD©a
->
äm_d©a
[1] = 
NULL
;

1865 
	`ä“_mem2D³l
(
imgD©a
->
äm_d©a
[2]);

1866 
imgD©a
->
äm_d©a
[2] = 
NULL
;

1870 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

1872 
	`ä“_tÝ_bÙ_¶ªes
(
imgD©a
->
tÝ_d©a
[0], imgD©a->
bÙ_d©a
[0]);

1873 ià(
imgD©a
->
fÜm©
.
yuv_fÜm©
 !ð
YUV400
)

1875 
	`ä“_tÝ_bÙ_¶ªes
(
imgD©a
->
tÝ_d©a
[1], imgD©a->
bÙ_d©a
[1]);

1876 
	`ä“_tÝ_bÙ_¶ªes
(
imgD©a
->
tÝ_d©a
[2], imgD©a->
bÙ_d©a
[2]);

1878 
imgD©a
->
tÝ_d©a
[0] = imgD©a->
bÙ_d©a
[0] = 
NULL
;

1879 
imgD©a
->
tÝ_d©a
[1] = imgD©a->
bÙ_d©a
[1] = 
NULL
;

1880 
imgD©a
->
tÝ_d©a
[2] = imgD©a->
bÙ_d©a
[2] = 
NULL
;

1882 
	}
}

1898 
	$ä“_glob®_bufãrs
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1900 
i
,
j
;

1902 
	`ä“_poš‹r
 (
p_Vid
->
’c_äame_piùu»
);

1904 ià(
p_Vid
->
äame_pic
)

1906 
j
 = 0; j < 
p_Vid
->
äm_™”
; j++)

1908 ià(
p_Vid
->
äame_pic
[
j
])

1909 
	`ä“_piùu»
 (
p_Vid
->
äame_pic
[
j
]);

1911 
	`ä“_poš‹r
 (
p_Vid
->
äame_pic
);

1914 
	`ä“_poš‹r
 (
p_Vid
->
’c_f›ld_piùu»
);

1916 #ià(
MVC_EXTENSION_ENABLE
)

1917 ià(
p_Vid
->
f›ld_pic1
)

1919 
j
 = 0; j < 2; j++)

1921 ià(
p_Vid
->
f›ld_pic1
[
j
])

1922 
	`ä“_piùu»
 (
p_Vid
->
f›ld_pic1
[
j
]);

1924 
	`ä“_poš‹r
 (
p_Vid
->
f›ld_pic1
);

1926 if(
p_Vid
->
num_of_Ïy”s
==2)

1928 
j
 = 0; j < 2; j++)

1930 ià(
p_Vid
->
f›ld_pic2
[
j
])

1931 
	`ä“_piùu»
 (
p_Vid
->
f›ld_pic2
[
j
]);

1933 
	`ä“_poš‹r
 (
p_Vid
->
f›ld_pic2
);

1937 ià(
p_Vid
->
f›ld_pic
)

1939 
j
 = 0; j < 2; j++)

1941 ià(
p_Vid
->
f›ld_pic
[
j
])

1942 
	`ä“_piùu»
 (
p_Vid
->
f›ld_pic
[
j
]);

1944 
	`ä“_poš‹r
 (
p_Vid
->
f›ld_pic
);

1949 ià(
p_IÅ
->
si_äame_šdiÿtÜ
 ||…_IÅ->
¥_³riodic™y
)

1951 
	`ä“_piùu»
 (
p_Vid
->
äame_pic_si
);

1953 
	`ä“_mem2Dšt
 (
p_Vid
->
Ìec
);

1954 
	`ä“_mem3Dšt
 (
p_Vid
->
Ìec_uv
);

1957 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a
);

1958 iàÐ
p_Vid
->
p_IÅ
->
MDReã»nû
[0] ||…_Vid->p_Inp->MDReference[1] )

1960 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgRefD©a
);

1963 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a0
);

1965 ià(
p_IÅ
->
’abË_32_puÎdown
)

1967 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a32
);

1968 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a4
);

1969 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a5
);

1970 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
imgD©a6
);

1975 
	`ä“_poš‹r
(
p_Vid
->
PicPos
);

1977 
	`ä“_QM©rix
(
p_Vid
->
p_Quªt
);

1978 
	`ä“_QOff£ts
(
p_Vid
->
p_Quªt
, 
p_IÅ
);

1981 iàÐ
p_IÅ
->
WPMCP»cisiÚ
 )

1983 
	`wpxF»eWPXObjeù
(
p_Vid
);

1986 ià(
p_Vid
->
imgY_sub_tmp
)

1988 
	`ä“_mem2Dšt_·d
 (
p_Vid
->
imgY_sub_tmp
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

1989 
p_Vid
->
imgY_sub_tmp
 = 
NULL
;

1994 
	`ä“_mem2D
((
by‹
**)
p_Vid
->
»dmode
);

1995 
	`ä“_mem2D
((
by‹
**)
p_Vid
->
»dmode8x8
);

1997 if(
p_Vid
->
»dmode4x4_lše
)

1999 
	`ä“_mem2D
((
by‹
**)
p_Vid
->
»dmode4x4_lše
);

2000 
p_Vid
->
»dmode4x4_lše
=
NULL
;

2002 if(
p_Vid
->
»dmode8x8_lše
)

2004 
	`ä“_mem2D
((
by‹
 **)
p_Vid
->
»dmode8x8_lše
);

2005 
p_Vid
->
»dmode8x8_lše
 = 
NULL
;

2008 
	`ä“_poš‹r
Ð
p_Vid
->
b8x8šfo
 );

2010 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2012  
i
=0; i<
MAX_PLANE
; i++ )

2014 
	`ä“_mbs
(
p_Vid
->
mb_d©a_JV
[
i
],…_Vid->
F¿meSizeInMbs
);

2020 
	`ä“_mbs
(
p_Vid
->
mb_d©a
,…_Vid->
F¿meSizeInMbs
);

2023 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

2025 
	`ä“_poš‹r
 (
p_Vid
->
šŒa_block
);

2028 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

2030 
	`ä“_poš‹r
(
p_Vid
->
mb16x16_co¡_äame
);

2033 ià(
p_IÅ
->
rdÝt
 == 3)

2035 
	`ä“_”rdo_mem
(
p_Vid
);

2038 ià(
p_IÅ
->
Re¡riùRef
)

2040 
	`ä“_poš‹r
(
p_Vid
->
pix–_m­
[0]);

2041 
	`ä“_poš‹r
(
p_Vid
->
pix–_m­
);

2042 
	`ä“_poš‹r
(
p_Vid
->
»äesh_m­
[0]);

2043 
	`ä“_poš‹r
(
p_Vid
->
»äesh_m­
);

2046 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

2048 
i
=0; i<
p_Vid
->
num_of_Ïy”s
; i++)

2050 
	`ä“_mem2D³l
(
p_Vid
->
imgY_com_buf
[
i
]);

2051 
	`ä“_mem2D³l
(
p_Vid
->
imgUV_com_buf
[
i
][0]);

2052 
	`ä“_mem2D³l
(
p_Vid
->
imgUV_com_buf
[
i
][1]);

2054 
p_Vid
->
imgY_com
 = 
NULL
;

2055 
p_Vid
->
imgUV_com
[0] =…_Vid->imgUV_com[1] = 
NULL
;

2058 if(
p_Vid
->
num_of_Ïy”s
>1)

2060 
bEqu®
 = 
p_Vid
->
nz_cÛff_buf
[0] ==…_Vid->nz_coeff_buf[1];

2061 
	`ä“_mem3Dšt
(
p_Vid
->
nz_cÛff_buf
[0]);

2062 
p_Vid
->
nz_cÛff_buf
[0] = 
NULL
;

2063 if(!
bEqu®
 && 
p_Vid
->
nz_cÛff_buf
[1])

2064 
	`ä“_mem3Dšt
(
p_Vid
->
nz_cÛff_buf
[1]);

2065 
p_Vid
->
nz_cÛff_buf
[1] = 
NULL
;

2068 
	`ä“_mem3Dšt
(
p_Vid
->
nz_cÛff_buf
[0]);

2069 
p_Vid
->
nz_cÛff
 = 
NULL
;

2071 
	`ä“_mem2DÞm
 (
p_Vid
->
Ïmbda_buf
[0],…_Vid->
b™d•th_luma_qp_sÿË
);

2072 
p_Vid
->
Ïmbda
 =…_Vid->
Ïmbda_buf
[0] =…_Vid->Ïmbda_buf[1] = 
NULL
;

2073 
	`ä“_mem2DodoubË
 (
p_Vid
->
Ïmbda_md_buf
[0],…_Vid->
b™d•th_luma_qp_sÿË
);

2074 
p_Vid
->
Ïmbda_md
 =…_Vid->
Ïmbda_md_buf
[0] =…_Vid->Ïmbda_md_buf[1] = 
NULL
;

2075 
	`ä“_mem3DodoubË
 (
p_Vid
->
Ïmbda_me_buf
[0], 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

2076 
p_Vid
->
Ïmbda_me
 =…_Vid->
Ïmbda_me_buf
[0] =…_Vid->Ïmbda_me_buf[1] = 
NULL
;

2077 
	`ä“_mem3Došt
 (
p_Vid
->
Ïmbda_mf_buf
[0], 10, 52 +…_Vid->
b™d•th_luma_qp_sÿË
,…_Vid->bitdepth_luma_qp_scale);

2078 
p_Vid
->
Ïmbda_mf
 =…_Vid->
Ïmbda_mf_buf
[0] =…_Vid->Ïmbda_mf_buf[1] = 
NULL
;

2079 iàÐ
p_IÅ
->
U£RDOQuªt
 )

2081 
	`ä“_mem2DodoubË
 (
p_Vid
->
Ïmbda_rdoq_buf
[0],…_Vid->
b™d•th_luma_qp_sÿË
);

2082 
p_Vid
->
Ïmbda_rdoq
 =…_Vid->
Ïmbda_rdoq_buf
[0] =…_Vid->Ïmbda_rdoq_buf[1] = 
NULL
;

2084 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

2086 
	`ä“_mem2DodoubË
(
p_Vid
->
Ïmbda_mf_çùÜ_buf
[0],…_Vid->
b™d•th_luma_qp_sÿË
);

2087 
p_Vid
->
Ïmbda_mf_çùÜ
 =…_Vid->
Ïmbda_mf_çùÜ_buf
[0] =…_Vid->Ïmbda_mf_çùÜ_buf[1] = 
NULL
;

2090 ià(!
p_IÅ
->
IÁ¿Profže
)

2092 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX
 ||…_Inp->SearchMode[1] == UM_HEX)

2094 
	`UMHEX_ä“_mem
(
p_Vid
, 
p_IÅ
);

2096 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX_SIMPLE
 ||…_Inp->SearchMode[1] == UM_HEX_SIMPLE)

2098 
	`smpUMHEX_ä“_mem
(
p_Vid
);

2100 ià(
p_IÅ
->
S—rchMode
[0] =ð
EPZS
 ||…_Inp->SearchMode[1] == EPZS)

2102 
	`EPZSD–‘e
(
p_Vid
);

2106 ià(
p_IÅ
->
RCEÇbË
)

2107 
	`rc_ä“_memÜy
(
p_Vid
, 
p_IÅ
);

2109 ià(
p_IÅ
->
»dundªt_pic_æag
)

2111 
i
=0; i<
p_Vid
->
num_of_Ïy”s
; i++)

2113 
	`ä“_mem2D³l
(
p_Vid
->
imgY_tmp_buf
[
i
]);

2114 
	`ä“_mem2D³l
(
p_Vid
->
imgUV_tmp_buf
[
i
][0]);

2115 
	`ä“_mem2D³l
(
p_Vid
->
imgUV_tmp_buf
[
i
][1]);

2117 
p_Vid
->
imgY_tmp
 = 
NULL
;

2118 
p_Vid
->
imgUV_tmp
[0] = 
NULL
;

2119 
p_Vid
->
imgUV_tmp
[1] = 
NULL
;

2124 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
)

2126 
	`d–‘e_RGB_memÜy
(
p_Vid
);

2129 
	`þ—r_´oûss_image
Ð
p_Vid
, 
p_IÅ
 );

2130 
	`ä“_£q_¡ruùu»
Ð
p_Vid
->
p_´ed
 );

2131 
	}
}

2140 
	$g‘_mem_ACcÛff
 (
VideoP¬am‘”s
 *
p_Vid
, ***** 
cofAC
)

2142 
num_blk8x8
 = 
BLOCK_SIZE
 + 
p_Vid
->
num_blk8x8_uv
;

2144 
	`g‘_mem4Dšt
(
cofAC
, 
num_blk8x8
, 
BLOCK_SIZE
, 2, 65);

2146  
num_blk8x8
 * 
BLOCK_SIZE
 * 2 * 65 * ();

2147 
	}
}

2155 
	$g‘_mem_ACcÛff_Ãw
 (****** 
cofAC
, 
chroma
)

2157 
	`g‘_mem5Dšt
(
cofAC
, 
BLOCK_SIZE
, 
chroma
, BLOCK_SIZE, 2, 65);

2158  
chroma
 * 
BLOCK_PIXELS
 * 2 * 65 * ();

2159 
	}
}

2167 
	$g‘_mem_DCcÛff
 (**** 
cofDC
)

2169 
	`g‘_mem3Dšt
(
cofDC
, 3, 2, 18);

2171 
	}
}

2180 
	$ä“_mem_ACcÛff
 (**** 
cofAC
)

2182 
	`ä“_mem4Dšt
(
cofAC
);

2183 
	}
}

2191 
	$ä“_mem_ACcÛff_Ãw
 (***** 
cofAC
)

2193 
	`ä“_mem5Dšt
(
cofAC
);

2194 
	}
}

2202 
	$ä“_mem_DCcÛff
 (*** 
cofDC
)

2204 
	`ä“_mem3Dšt
(
cofDC
);

2205 
	}
}

2214 
	$£t_Ëv–_šdiûs
(
VideoP¬am‘”s
 *
p_Vid
)

2216 
p_Vid
->
Lev–Index
 = 
	`g‘_Ëv–_šdex
 (p_Vid->
aùive_¥s
->
´ofže_idc
,…_Vid->aùive_¥s->
Ëv–_idc
,…_Vid->aùive_¥s->
cÚ¡¿šed_£t3_æag
);

2217 
	}
}

2225 
	$š™_»dundªt_äame
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2227 ià(
p_IÅ
->
»dundªt_pic_æag
)

2229 ià(
p_IÅ
->
Numb”BF¿mes
)

2231 
	`”rÜ
("B frame‚ot supported when„edundant…icture used!", 100);

2234 ià(
p_IÅ
->
PicIÁ”Ïû
)

2236 
	`”rÜ
("Interlace‚ot supported when„edundant…icture used!", 100);

2239 ià(
p_IÅ
->
num_»f_äames
 <…_IÅ->
Prim¬yGOPL’gth
)

2241 
	`”rÜ
("NumberReferenceFrames must be‚o†esshan PrimaryGOPLength", 100);

2244 ià((1<<
p_IÅ
->
NumRedundªtH›¿rchy
è>…_IÅ->
Prim¬yGOPL’gth
)

2246 
	`”rÜ
("PrimaryGOPLength must be greaterhan 2^NumRedundantHeirarchy", 100);

2249 ià(
p_IÅ
->
V”bo£
 != 1)

2251 
	`”rÜ
("Redundant slices‚ot supported when Verbose != 1", 100);

2255 
p_Vid
->
key_äame
 = 0;

2256 
p_Vid
->
»dundªt_codšg
 = 0;

2257 
p_Vid
->
»dundªt_pic_út
 = 0;

2258 
p_Vid
->
äameNumšGOP
 =…_Vid->
cu¼_äm_idx
 % 
p_IÅ
->
Prim¬yGOPL’gth
;

2259 ià(
p_Vid
->
cu¼_äm_idx
 == 0)

2261 
p_Vid
->
äameNumšGOP
 = -1;

2263 
	}
}

2271 
	$£t_»dundªt_äame
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2273 
GOPËngth
 = 
p_IÅ
->
Prim¬yGOPL’gth
;

2276 ià(
p_Vid
->
äameNumšGOP
 == 0)

2278 
p_Vid
->
»dundªt_codšg
 = 0;

2279 
p_Vid
->
key_äame
 = 1;

2280 
p_Vid
->
»dundªt_»f_idx
 = 
GOPËngth
;

2284 ià(
p_IÅ
->
NumRedundªtH›¿rchy
 > 0)

2286 ià(
p_Vid
->
äameNumšGOP
 =ð
GOPËngth
 >> 1)

2288 
p_Vid
->
»dundªt_codšg
 = 0;

2289 
p_Vid
->
key_äame
 = 1;

2290 
p_Vid
->
»dundªt_»f_idx
 = 
GOPËngth
 >> 1;

2295 ià(
p_IÅ
->
NumRedundªtH›¿rchy
 > 1)

2297 ià(
p_Vid
->
äameNumšGOP
 =ð(
GOPËngth
 >> 2) ||…_Vid->frameNuminGOP == ((GOPlength*3) >> 2))

2299 
p_Vid
->
»dundªt_codšg
 = 0;

2300 
p_Vid
->
key_äame
 = 1;

2301 
p_Vid
->
»dundªt_»f_idx
 = 
GOPËngth
 >> 2;

2306 ià(
p_IÅ
->
NumRedundªtH›¿rchy
 > 2)

2308 ià(
p_Vid
->
äameNumšGOP
 =ð
GOPËngth
 >> 3 ||…_Vid->frameNuminGOP == ((GOPlength*3) >> 3)

2309 || 
p_Vid
->
äameNumšGOP
 =ð((
GOPËngth
*5) >> 3) ||…_Vid->frameNuminGOP == ((GOPlength*7) & 0x03))

2311 
p_Vid
->
»dundªt_codšg
 = 0;

2312 
p_Vid
->
key_äame
 = 1;

2313 
p_Vid
->
»dundªt_»f_idx
 = 
GOPËngth
 >> 3;

2318 ià(
p_IÅ
->
NumRedundªtH›¿rchy
 > 3)

2320 ià(
p_Vid
->
äameNumšGOP
 =ð(
GOPËngth
 >> 4) ||…_Vid->frameNuminGOP == ((GOPlength*3) >> 4)

2321 || 
p_Vid
->
äameNumšGOP
 =ð((
GOPËngth
*5) >> 4) ||…_Vid->frameNuminGOP == ((GOPlength*7) >> 4)

2322 || 
p_Vid
->
äameNumšGOP
 =ð((
GOPËngth
*9) >> 4) ||…_Vid->frameNuminGOP == ((GOPlength*11) >> 4)

2323 || 
p_Vid
->
äameNumšGOP
 =ð((
GOPËngth
*13) >> 4))

2325 
p_Vid
->
»dundªt_codšg
 = 0;

2326 
p_Vid
->
key_äame
 = 1;

2327 
p_Vid
->
»dundªt_»f_idx
 = 
GOPËngth
 >> 4;

2330 
	}
}

2338 
	$’code_Úe_»dundªt_äame
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2340 
p_Vid
->
key_äame
 = 0;

2341 
p_Vid
->
»dundªt_codšg
 = 1;

2342 
p_Vid
->
»dundªt_pic_út
 = 1;

2344 ià(!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
)

2346 ià(
p_Vid
->
ty³
 =ð
I_SLICE
)

2348 
	`£t_¦iû_ty³
Ð
p_Vid
, 
p_IÅ
, 
P_SLICE
 );

2352 
	`’code_Úe_äame
(
p_Vid
, 
p_IÅ
);

2353 
	}
}

2361 
	$chroma_mc_£tup
(
VideoP¬am‘”s
 *
p_Vid
)

2364 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 )

2366 
p_Vid
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
 >> 1;

2367 
p_Vid
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
 >> 1;

2368 
p_Vid
->
chroma_mask_mv_y
 = 7;

2369 
p_Vid
->
chroma_mask_mv_x
 = 7;

2370 
p_Vid
->
chroma_shiá_x
 = 3;

2371 
p_Vid
->
chroma_shiá_y
 = 3;

2373 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV422
 )

2375 
p_Vid
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
 >> 1;

2376 
p_Vid
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
;

2377 
p_Vid
->
chroma_mask_mv_y
 = 3;

2378 
p_Vid
->
chroma_mask_mv_x
 = 7;

2379 
p_Vid
->
chroma_shiá_y
 = 2;

2380 
p_Vid
->
chroma_shiá_x
 = 3;

2384 
p_Vid
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
;

2385 
p_Vid
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
;

2386 
p_Vid
->
chroma_mask_mv_y
 = 3;

2387 
p_Vid
->
chroma_mask_mv_x
 = 3;

2388 
p_Vid
->
chroma_shiá_y
 = 2;

2389 
p_Vid
->
chroma_shiá_x
 = 2;

2391 
p_Vid
->
shiá_ü_y
 =…_Vid->
chroma_shiá_y
 - 2;

2392 
p_Vid
->
shiá_ü_x
 =…_Vid->
chroma_shiá_x
 - 2;

2393 
	}
}

2396 
	$g’_’c_·r
(
VideoP¬am‘”s
 *
p_Vid
, 
Ïy”_idx
)

2398 
CodšgP¬am‘”s
 *
ýs
;

2399 
DecodedPiùu»Bufãr
 *
p_Dpb
;

2400 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2402 
ýs
 = 
p_Vid
->
p_EncodeP¬
[
Ïy”_idx
];

2403 
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[
Ïy”_idx
];

2405 
ýs
->
Ïy”_id
 = 
Ïy”_idx
;

2406 
ýs
->
yuv_fÜm©
 = 
p_Dpb
->
¡Üage_fÜm©
.yuv_format;

2407 
ýs
->
P444_jošed
 = (ýs->
yuv_fÜm©
 =ð
YUV444
 && (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0));

2408 
ýs
->
b™d•th_luma
 = ()
p_Dpb
->
¡Üage_fÜm©
.
b™_d•th
[0];

2409 
ýs
->
b™d•th_sÿË
[0] = 1 << (ýs->
b™d•th_luma
 - 8);

2410 
ýs
->
b™d•th_Ïmbda_sÿË
 = 2 * (ýs->
b™d•th_luma
 - 8);

2411 
ýs
->
b™d•th_luma_qp_sÿË
 = 3 * cps->
b™d•th_Ïmbda_sÿË
;

2412 
ýs
->
dc_´ed_v®ue_comp
[0] = (
ušt32
è(1<<(ýs->
b™d•th_luma
 - 1));

2413 
ýs
->
max_³l_v®ue_comp
[0] = (1<<ýs->
b™d•th_luma
) - 1;

2414 
ýs
->
max_img³l_v®ue_comp_sq
[0] = cps->
max_³l_v®ue_comp
[0] * cps->max_pel_value_comp[0];

2415 
ýs
->
mb_size
[0][0] = cps->mb_size[0][1] = 
MB_BLOCK_SIZE
;

2416 ià(
ýs
->
yuv_fÜm©
 !ð
YUV400
)

2418 
ýs
->
b™d•th_chroma
 = ()
p_Dpb
->
¡Üage_fÜm©
.
b™_d•th
[1];

2419 
ýs
->
b™d•th_sÿË
[1] = 1 << (ýs->
b™d•th_chroma
 - 8);

2420 
ýs
->
dc_´ed_v®ue_comp
[1] = (
ušt32
è(1<<(ýs->
b™d•th_chroma
 - 1));

2421 
ýs
->
dc_´ed_v®ue_comp
[2] = cps->dc_pred_value_comp[1];

2422 
ýs
->
max_³l_v®ue_comp
[1] = (1<<ýs->
b™d•th_chroma
) - 1;

2423 
ýs
->
max_³l_v®ue_comp
[2] = cps->max_pel_value_comp[1];

2424 
ýs
->
max_img³l_v®ue_comp_sq
[1] = cps->
max_³l_v®ue_comp
[1] * cps->max_pel_value_comp[1];

2425 
ýs
->
max_img³l_v®ue_comp_sq
[2] = cps->
max_³l_v®ue_comp
[2] * cps->max_pel_value_comp[2];

2426 
ýs
->
num_blk8x8_uv
 = (1<<ýs->
yuv_fÜm©
)&(~(0x1));

2427 
ýs
->
num_cdc_cÛff
 = cps->
num_blk8x8_uv
 << 1;

2428 
ýs
->
mb_size
[1][0] = cps->mb_size[2][0] = cps->
mb_ü_size_x
 = (ýs->
yuv_fÜm©
 =ð
YUV420
 || cps->yuv_fÜm© =ð
YUV422
) ? 8 : 16;

2429 
ýs
->
mb_size
[1][1] = cps->mb_size[2][1] = cps->
mb_ü_size_y
 = (ýs->
yuv_fÜm©
 =ð
YUV444
 || cps->yuv_fÜm© =ð
YUV422
) ? 16 : 8;

2430 
ýs
->
b™d•th_chroma_qp_sÿË
 = 6*(ýs->
b™d•th_chroma
 - 8);

2434 
ýs
->
b™d•th_chroma
 = 0;

2435 
ýs
->
b™d•th_sÿË
[1] = 0;

2436 
ýs
->
max_³l_v®ue_comp
[1] = 0;

2437 
ýs
->
max_³l_v®ue_comp
[2] = cps->max_pel_value_comp[1];

2438 
ýs
->
max_img³l_v®ue_comp_sq
[1] = cps->
max_³l_v®ue_comp
[1] * cps->max_pel_value_comp[1];

2439 
ýs
->
max_img³l_v®ue_comp_sq
[2] = cps->
max_³l_v®ue_comp
[2] * cps->max_pel_value_comp[2];

2440 
ýs
->
num_blk8x8_uv
 = 0;

2441 
ýs
->
num_cdc_cÛff
 = 0;

2442 
ýs
->
mb_size
[1][0] = cps->mb_size[2][0] = cps->
mb_ü_size_x
 = 0;

2443 
ýs
->
mb_size
[1][1] = cps->mb_size[2][1] = cps->
mb_ü_size_y
 = 0;

2445 
ýs
->
b™d•th_chroma_qp_sÿË
 = 0;

2447 
ýs
->
max_b™CouÁ
 = 128 + 256 * cps->
b™d•th_luma
 + 2 * cps->
mb_ü_size_y
 * cps->
mb_ü_size_x
 * cps->
b™d•th_chroma
;

2448 
ýs
->
width
 = (
p_IÅ
->
ouut
.width[0] + 
p_Vid
->
auto_üÝ_right
);

2449 
ýs
->
height
 = (
p_IÅ
->
ouut
.height[0] + 
p_Vid
->
auto_üÝ_bÙtom
);

2450 
ýs
->
width_blk
 = cps->
width
 / 
BLOCK_SIZE
;

2451 
ýs
->
height_blk
 = cps->
height
 / 
BLOCK_SIZE
;

2452 
ýs
->
width_·dded
 = cps->
width
 + 2 * 
IMG_PAD_SIZE_X
;

2453 
ýs
->
height_·dded
 = cps->
height
 + 2 * 
IMG_PAD_SIZE_Y
;

2455 ià(
ýs
->
yuv_fÜm©
 !ð
YUV400
)

2457 
ýs
->
width_ü
 = cps->
width
 * 
mb_width_ü
 [ýs->
yuv_fÜm©
] / 16;

2458 
ýs
->
height_ü
ðýs->
height
 * 
mb_height_ü
[ýs->
yuv_fÜm©
] / 16;

2462 
ýs
->
width_ü
 = 0;

2463 
ýs
->
height_ü
= 0;

2466 
ýs
->
height_ü_äame
 = cps->
height_ü
;

2467 
ýs
->
size
 = cps->
width
 * cps->
height
;

2468 
ýs
->
size_ü
 = cps->
width_ü
 * cps->
height_ü
;

2470 
ýs
->
PicWidthInMbs
 = cps->
width
 / 
MB_BLOCK_SIZE
;

2471 
ýs
->
F¿meHeightInMbs
 = cps->
height
 / 
MB_BLOCK_SIZE
;

2472 
ýs
->
F¿meSizeInMbs
 = cps->
PicWidthInMbs
 * cps->
F¿meHeightInMbs
;

2473 
ýs
->
PicHeightInM­Un™s
 = ( 
p_Vid
->
¥s
[
Ïy”_idx
]->
äame_mbs_Úly_æag
 ? cps->
F¿meHeightInMbs
 : cps->FrameHeightInMbs >> 1 );

2475 iàÐ
ýs
->
yuv_fÜm©
 =ð
YUV420
 )

2477 
ýs
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
 >> 1;

2478 
ýs
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
 >> 1;

2479 
ýs
->
chroma_mask_mv_y
 = 7;

2480 
ýs
->
chroma_mask_mv_x
 = 7;

2481 
ýs
->
chroma_shiá_x
 = 3;

2482 
ýs
->
chroma_shiá_y
 = 3;

2484 iàÐ
ýs
->
yuv_fÜm©
 =ð
YUV422
 )

2486 
ýs
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
 >> 1;

2487 
ýs
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
;

2488 
ýs
->
chroma_mask_mv_y
 = 3;

2489 
ýs
->
chroma_mask_mv_x
 = 7;

2490 
ýs
->
chroma_shiá_y
 = 2;

2491 
ýs
->
chroma_shiá_x
 = 3;

2495 
ýs
->
·d_size_uv_x
 = 
IMG_PAD_SIZE_X
;

2496 
ýs
->
·d_size_uv_y
 = 
IMG_PAD_SIZE_Y
;

2497 
ýs
->
chroma_mask_mv_y
 = 3;

2498 
ýs
->
chroma_mask_mv_x
 = 3;

2499 
ýs
->
chroma_shiá_y
 = 2;

2500 
ýs
->
chroma_shiá_x
 = 2;

2502 
ýs
->
shiá_ü_y
 = cps->
chroma_shiá_y
 - 2;

2503 
ýs
->
shiá_ü_x
 = cps->
chroma_shiá_x
 - 2;

2505 
ýs
->
·dded_size_x
 = (ýs->
width
 + 2 * 
IMG_PAD_SIZE_X
);

2506 
ýs
->
·dded_size_x_m8x8
 = (ýs->
·dded_size_x
 - 
BLOCK_SIZE_8x8
);

2507 
ýs
->
·dded_size_x_m4x4
 = (ýs->
·dded_size_x
 - 
BLOCK_SIZE
);

2508 
ýs
->
ü_·dded_size_x
 = (ýs->
width_ü
 + 2 * cps->
·d_size_uv_x
);

2509 
ýs
->
ü_·dded_size_x2
 = (ýs->
ü_·dded_size_x
 << 1);

2510 
ýs
->
ü_·dded_size_x4
 = (ýs->
ü_·dded_size_x
 << 2);

2511 
ýs
->
ü_·dded_size_x_m8
 = (ýs->
ü_·dded_size_x
 - 8);

2513 
	}
}

2515 
	$g’”©e_’code_·¿m‘”s
(
VideoP¬am‘”s
 *
p_Vid
)

2517 
i
;

2518 
p_Vid
->
p_EncodeP¬
[0] = (
CodšgP¬am‘”s
 *)
	`ÿÎoc
Õ_Vid->
num_of_Ïy”s
, (CodingParameters));

2520 
i
=0; i<
p_Vid
->
num_of_Ïy”s
; i++)

2522 
p_Vid
->
p_EncodeP¬
[
i
] =…_Vid->p_EncodePar[0]+i;

2523 
	`g’_’c_·r
(
p_Vid
, 
i
);

2525 
p_Vid
->
p_Cu¼EncodeP¬
 =…_Vid->
p_EncodeP¬
[0];

2526 
	}
}

2528 
	$ä“_’code_·¿m‘”s
(
VideoP¬am‘”s
 *
p_Vid
)

2530 
i
;

2531 if(
p_Vid
->
p_EncodeP¬
[0])

2533 
	`ä“_poš‹r
(
p_Vid
->
p_EncodeP¬
[0]);

2535 
i
=0; i<
p_Vid
->
num_of_Ïy”s
; i++)

2537 
p_Vid
->
p_EncodeP¬
[
i
] = 
NULL
;

2539 
p_Vid
->
p_Cu¼EncodeP¬
 = 
NULL
;

2540 
	}
}

2542 
	$š™_´oûss_image
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2544 
memÜy_size
 = 0;

2545  
p_IÅ
->
ProûssIÅut
 )

2550 ifÐ(
p_Vid
->
num_of_Ïy”s
 =ð2è&& 
	`is_MVC_´ofže
(
p_IÅ
->
ProfžeIDC
) )

2551 
memÜy_size
 +ð
	`š™_Üig_bufãrs
(
p_Vid
, &p_Vid->
‹mpD©a3
);

2554  
memÜy_size
;

2555 
	}
}

2557 
	$þ—r_´oûss_image
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2559  
p_IÅ
->
ProûssIÅut
 )

2564 ifÐ(
p_Vid
->
num_of_Ïy”s
 =ð2è&& 
	`is_MVC_´ofže
(
p_IÅ
->
ProfžeIDC
) )

2565 
	`ä“_Üig_¶ªes
(
p_Vid
, &p_Vid->
‹mpD©a3
);

2568 
	}
}

	@lencod/src/list_reorder.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<m©h.h
>

20 
	~<æßt.h
>

22 
	~"glob®.h
"

23 
	~"image.h
"

24 
	~"wp.h
"

25 
	~"li¡_»Üd”.h
"

26 
	~"me_hme.h
"

28 
poc_»f_pic_»Üd”_dummy
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
);

29 
»Üd”_li¡s_dummy
Ð
Sliû
 *
cu¼Sliû
 );

37 
	$š™_»f_pic_li¡_»Üd”šg
(
Sliû
* 
cu¼Sliû
, 
»fReÜd”M‘hod
, 
u£Di¡ÜtiÚReÜd”šg
)

39 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 0;

40 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 0;

42 ià(
»fReÜd”M‘hod
 =ð1 && 
u£Di¡ÜtiÚReÜd”šg
 == 1)

44 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
m£_»f_pic_»Üd”_äame
;

45 
cu¼Sliû
->
»Üd”_li¡s
 =„eorder_lists;

47 ià(
»fReÜd”M‘hod
 == 2)

49 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
Žyr_»f_pic_»Üd”_äame_deçuÉ
;

50 
cu¼Sliû
->
»Üd”_li¡s
 =„eorder_lists;

52 #ià(
MVC_EXTENSION_ENABLE
)

53 ià((
»fReÜd”M‘hod
 =ð1è&& (
cu¼Sliû
->
Ïy”_id
 > 0è&& (cu¼Sliû->
p_IÅ
->
MVCIÁ”V›wReÜd”
 > 0 ))

55 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
poc_»f_pic_»Üd”_äame_’h
;

56 
cu¼Sliû
->
»Üd”_li¡s
 =„eorder_lists;

58 ià((
»fReÜd”M‘hod
 =ð0è&& (
cu¼Sliû
->
Ïy”_id
 > 0è&& (cu¼Sliû->
p_IÅ
->
MVCIÁ”V›wReÜd”
 > 0 ))

60 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
poc_»f_pic_»Üd”_äame_’h
;

61 
cu¼Sliû
->
»Üd”_li¡s
 =„eorder_lists;

64 ià((
»fReÜd”M‘hod
 =ð0è|| (
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
))

66 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
poc_»f_pic_»Üd”_dummy
;

67 
cu¼Sliû
->
»Üd”_li¡s
 = 
»Üd”_li¡s_dummy
;

71 
cu¼Sliû
->
poc_»f_pic_»Üd”_äame
 = 
poc_»f_pic_»Üd”_äame_’h
;

72 
cu¼Sliû
->
»Üd”_li¡s
 =„eorder_lists;

74 
	}
}

82 
	$poc_»f_pic_»Üd”_äame_deçuÉ
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

84 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

85 *
modifiÿtiÚ_of_pic_nums_idc
 = 
cu¼Sliû
->modifiÿtiÚ_of_pic_nums_idc[
li¡_no
];

86 *
abs_diff_pic_num_mšus1
 = 
cu¼Sliû
->abs_diff_pic_num_mšus1[
li¡_no
];

87 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

88 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

89 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

90 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

92 
i
,
j
,
k
;

94 
cu¼PicNum
, 
picNumLXP»d
;

96 
deçuÉ_Üd”
[32];

97 
»_Üd”
[32];

98 
tmp_»Üd”
[32];

99 
li¡_sign
[32];

100 
»Üd”_¡Ý
, 
no_»Üd”
;

101 
poc_diff
[32];

102 
diff
;

104 
abs_poc_di¡
;

105 
maxPicNum
;

106 
num_»fs
;

108 
maxPicNum
 = 
p_Vid
->
max_äame_num
;

109 
cu¼PicNum
 = 
p_Vid
->
äame_num
;

111 
picNumLXP»d
 = 
cu¼PicNum
;

114 
i
=0; i<()
num_»f_idx_lX_aùive
; i++)

116 
deçuÉ_Üd”
[
i
] = 
li¡
[i]->
pic_num
;

123 
num_»fs
 = 
cu¼Sliû
->
p_Dpb
->
»f_äames_š_bufãr
;

124 
i
 = 0; i < ()
p_Dpb
->
»f_äames_š_bufãr
; i++)

126 
poc_diff
[
i
] = 0xFFFF;

127 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
->
pic_num
;

129 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 && (p_Dpb->fs_»f[i]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

131 
abs_poc_di¡
 = 
	`Ÿbs
(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 - 
p_Enc_Pic
->poc) ;

132 
poc_diff
[
i
] = 
abs_poc_di¡
;

133 ià(
li¡_no
 =ð
LIST_0
)

135 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 < 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

139 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 > 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

145 
i
 = 0; i < (()
num_»fs
 - 1); i++)

147 
j
 = 
i
 + 1; j < ()
num_»fs
; j++)

149 ià(
poc_diff
[
i
]>poc_diff[
j
] || (poc_diff[i] =ðpoc_diff[j] && 
li¡_sign
[j] >†ist_sign[i]))

151 
	`i32_sw­
(&
poc_diff
[
i
], &poc_diff[
j
]);

152 
	`i32_sw­
(&
»_Üd”
[
i
], &»_Üd”[
j
]);

153 
	`i32_sw­
(&
li¡_sign
[
i
], &li¡_sign[
j
]);

159 iàÐ
p_IÅ
->
WPMCP»cisiÚ


160 && 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 !ð
WP_REGULAR


161 && 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
li¡_no
] )

163 
i
=0; i<()
num_»f_idx_lX_aùive
; i++)

165 
»_Üd”
[
i
] = 
p_Vid
->
pWPX
->
wp_»f_li¡
[
li¡_no
][i].
PicNum
;

169 ià(
p_IÅ
->
EÇbËO³nGOP
)

171 
couÁ”
 = 0;

172 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
li¡_no
]; i++)

174 ià(
cu¼Sliû
->
li¡X
[
li¡_no
][
i
]->
poc
 < 
p_Vid
->
Ï¡_v®id_»ã»nû
 &&…_Vid->
ThisPOC
 >…_Vid->last_valid_reference)

176 
couÁ”
++;

180 
cu¼Sliû
->
li¡Xsize
[
li¡_no
] -ð
couÁ”
;

181 
num_»f_idx_lX_aùive
 = 
cu¼Sliû
->
li¡Xsize
[
li¡_no
];

186 
no_»Üd”
 = 1;

187 
i
=0; i<()
num_»f_idx_lX_aùive
; i++)

189 ià(
deçuÉ_Üd”
[
i
] !ð
»_Üd”
[i])

191 
no_»Üd”
 = 0;

196 ià(
no_»Üd”
==0)

198 
i
=0; i<()
num_»f_idx_lX_aùive
; i++)

200 
diff
 = 
»_Üd”
[
i
]-
picNumLXP»d
;

201 ià(
diff
 <= 0)

203 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 0;

204 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

205 ià(
abs_diff_pic_num_mšus1
[
i
] < 0)

206 
abs_diff_pic_num_mšus1
[
i
] = 
maxPicNum
 -1;

210 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 1;

211 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

213 
picNumLXP»d
 = 
»_Üd”
[
i
];

215 
tmp_»Üd”
[
i
] = 
»_Üd”
[i];

217 
k
 = 
i
;

218 
j
=
i
; j<()
num_»f_idx_lX_aùive
; j++)

220 ià(
deçuÉ_Üd”
[
j
] !ð
»_Üd”
[
i
])

222 ++
k
;

223 
tmp_»Üd”
[
k
] = 
deçuÉ_Üd”
[
j
];

226 
»Üd”_¡Ý
 = 1;

227 
j
=
i
+1; j<()
num_»f_idx_lX_aùive
; j++)

229 ià(
tmp_»Üd”
[
j
] !ð
»_Üd”
[j])

231 
»Üd”_¡Ý
 = 0;

236 ià(
»Üd”_¡Ý
==1)

238 ++
i
;

241 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

244 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 3;

246 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

248 ià(
li¡_no
==0)

250 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 1;

254 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 1;

257 
	}
}

265 
	$poc_»f_pic_»Üd”_dummy
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

267 
	}
}

275 
	$poc_»f_pic_»Üd”_äame_’h
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

277 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

278 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

279 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

280 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

281 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

283 
i
, 
j
, 
k
;

284 
found
 = 0;

286 
StÜabËPiùu»
 *
»_Üd”
[32];

287 
StÜabËPiùu»
 *
š‹r_Ïy”_»f
[32];

288 
StÜabËPiùu»
 *
tmp_pic_v®ue
;

290 
li¡_sign
[32];

291 
poc_diff
[32];

292 
š‹r_Ïy”_»f_idx
[32];

294 
abs_poc_di¡
;

295 
num_»fs
;

296 
pic_num
;

301 #ià(
MVC_EXTENSION_ENABLE
)

302 ià(
cu¼Sliû
->
Ïy”_id
 > 0)

304 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

306 ià(
li¡
[
i
]->
v›w_id
 < 
cu¼Sliû
->
Ïy”_id
)

308 
š‹r_Ïy”_»f
[
found
] = 
li¡
[
i
];

309 
š‹r_Ïy”_»f_idx
[
found
] = 
i
;

310 
found
++;

320 
num_»fs
 = 
p_Dpb
->
»f_äames_š_bufãr
;

321 
i
 = 0; i < 
num_»fs
; i++)

323 
poc_diff
[
i
] = 0xFFFF;

324 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
;

327 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 && (p_Dpb->fs_»f[i]->
äame
->
u£d_fÜ_»ã»nû
è&& (!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

329 
abs_poc_di¡
 = 
	`Ÿbs
(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 - 
p_Enc_Pic
->poc) ;

330 
poc_diff
[
i
] = 
abs_poc_di¡
;

331 ià(
li¡_no
 =ð
LIST_0
)

333 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 < 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

337 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 > 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

344 
i
 = 0; i < (
num_»fs
 - 1 ); i++)

346 
j
 = 
i
 + 1; j < 
num_»fs
; j++)

348 ià(
poc_diff
[
i
] >…oc_diff[
j
] || (poc_diff[i] =ðpoc_diff[j] && 
li¡_sign
[j] >†ist_sign[i]))

350 
	`i32_sw­
(&
poc_diff
[
i
], &poc_diff[
j
]);

351 
tmp_pic_v®ue
 = 
»_Üd”
[
i
];

352 
»_Üd”
[
i
] =„e_Üd”[
j
];

353 
»_Üd”
[
j
] = 
tmp_pic_v®ue
 ;

354 
	`i32_sw­
(&
li¡_sign
[
i
], &li¡_sign[
j
]);

360 iàÐ
p_IÅ
->
WPMCP»cisiÚ


361 && 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 !ð
WP_REGULAR


362 && 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
li¡_no
] )

364 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

366 
pic_num
 = 
p_Vid
->
pWPX
->
wp_»f_li¡
[
li¡_no
][
i
].
PicNum
;

367 
j
 = 0; j < (è
p_Dpb
->
»f_äames_š_bufãr
; j++)

369 ià(
pic_num
 =ð
p_Dpb
->
fs_»f
[
i
]->
äame
->pic_num)

371 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
;

378 ià(
cu¼Sliû
->
Ïy”_id
 > 0)

383 
j
 = 0;

384 
k
 = 0;

385 
i
 = 0; i < (è
num_»f_idx_lX_aùive
+
found
; i++)

387 ià((
found
 > 0è&& (
i
 =ð
š‹r_Ïy”_»f_idx
[
k
]))

389 
li¡
[
i
] = 
š‹r_Ïy”_»f
[
k
++];

391 
found
--;

395 
li¡
[
i
] = 
»_Üd”
[
j
++];

401 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

403 
li¡
[
i
] = 
»_Üd”
[i];

406 
	}
}

414 
	$poc_»f_pic_»Üd”_f›ld_’h
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

416 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

417 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

419 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

420 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

422 
i
,
j
,
k
;

423 
found
 = 0;

425 
StÜabËPiùu»
 *
»_Üd”
[32];

426 
StÜabËPiùu»
 *
tmp_»Üd”
[32];

427 
StÜabËPiùu»
 *
š‹r_Ïy”_»f
[32];

428 
StÜabËPiùu»
 *
tmp_pic_v®ue
;

429 
StÜabËPiùu»
 *
pF›ld
[2];

430 
F¿meStÜe
 *
pF¿meStÜe
;

432 
li¡_sign
[32];

433 
poc_diff
[32];

434 
š‹r_Ïy”_»f_idx
[32];

436 
abs_poc_di¡
;

437 
num_»fs
;

439 
f›ld_u£d
[2] = {1, 2};

440 
æd_ty³
[32];

441 
num_æds
, 
æd
, 
idx
;

442 
li¡_size
 = 0;

443 
tÝ_idx
 = 0;

444 
bÙ_idx
 = 0;

448 #ià(
MVC_EXTENSION_ENABLE
)

449 ià(
cu¼Sliû
->
Ïy”_id
 > 0)

451 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

453 ià(
li¡
[
i
]->
v›w_id
 < 
cu¼Sliû
->
Ïy”_id
)

455 
š‹r_Ïy”_»f
[
found
] = 
li¡
[
i
];

456 
š‹r_Ïy”_»f_idx
[
found
] = 
i
;

457 
found
++;

467 
idx
 = 0;

468 
num_»fs
 = 
p_Dpb
->
»f_äames_š_bufãr
;

469 
i
 = 0; i < 
num_»fs
; i++)

471 
pF¿meStÜe
 = 
p_Dpb
->
fs_»f
[
i
];

472 
pF›ld
[0] = 
pF¿meStÜe
->
tÝ_f›ld
;

473 
pF›ld
[1] = 
pF¿meStÜe
->
bÙtom_f›ld
;

474 
num_æds
 = (
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
 && (
p_Enc_Pic
->
poc
 =ð(
pF›ld
[0]->poc + 1) ) ) ? 1 : 2;

476 
poc_diff
[2*
i
 ] = 0xFFFF;

477 
poc_diff
[2*
i
 + 1] = 0xFFFF;

479  
æd
 = 0; fld < 
num_æds
; fld++ )

481 iàÐ(
pF¿meStÜe
->
is_u£d
 & 
f›ld_u£d
[
æd
]è&& 
pF›ld
[æd]->
u£d_fÜ_»ã»nû
 && !ÕF›ld[æd]->
is_lÚg_‹rm
))

483 
abs_poc_di¡
 = 
	`Ÿbs
(
pF›ld
[
æd
]->
poc
 - 
p_Enc_Pic
->poc) ;

484 
poc_diff
[
idx
] = 
abs_poc_di¡
;

485 
»_Üd”
[
idx
] = 
pF›ld
[
æd
];

486 
æd_ty³
[
idx
] = 
æd
 + 1;

488 ià(
li¡_no
 =ð
LIST_0
)

490 
li¡_sign
[
idx
] = (
p_Enc_Pic
->
poc
 < 
pF›ld
[
æd
]->poc) ? +1 : -1;

494 
li¡_sign
[
idx
] = (
p_Enc_Pic
->
poc
 > 
pF›ld
[
æd
]->poc) ? +1 : -1;

496 
idx
++;

500 
num_»fs
 = 
idx
;

503 
i
=0; i < 
num_»fs
-1; i++)

505 
j
 = (
i
 + 1); j < 
num_»fs
; j++)

507 ià(
poc_diff
[
i
] >…oc_diff[
j
] || (poc_diff[i] =ðpoc_diff[j] && 
li¡_sign
[j] >†ist_sign[i]))

510 
	`i32_sw­
 (&
poc_diff
[
i
], &poc_diff[
j
]);

512 
tmp_pic_v®ue
 = 
»_Üd”
[
i
];

513 
»_Üd”
[
i
] =„e_Üd”[
j
];

514 
»_Üd”
[
j
] = 
tmp_pic_v®ue
;

516 
	`i32_sw­
 (&
li¡_sign
[
i
], &li¡_sign[
j
]);

518 
	`i32_sw­
 (&
æd_ty³
[
i
], &æd_ty³[
j
]);

523 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

525 (
tÝ_idx
 < 
num_»fs
)||(
bÙ_idx
 <‚um_refs))

527  ; 
tÝ_idx
 < 
num_»fs
;op_idx++)

529 iàÐ
æd_ty³
[
tÝ_idx
] =ð
TOP_FIELD
 )

531 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
tÝ_idx
];

532 
li¡_size
++;

533 
tÝ_idx
++;

537  ; 
bÙ_idx
 < 
num_»fs
; bot_idx++)

539 iàÐ
æd_ty³
[
bÙ_idx
] =ð
BOTTOM_FIELD
 )

541 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
bÙ_idx
];

542 
li¡_size
++;

543 
bÙ_idx
++;

550 ià(
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
)

552 (
tÝ_idx
 < 
num_»fs
)||(
bÙ_idx
 <‚um_refs))

554  ; 
bÙ_idx
 < 
num_»fs
; bot_idx++)

556 iàÐ
æd_ty³
[
bÙ_idx
] =ð
BOTTOM_FIELD
 )

558 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
bÙ_idx
];

559 
li¡_size
++;

560 
bÙ_idx
++;

564  ; 
tÝ_idx
 < 
num_»fs
;op_idx++)

566 iàÐ
æd_ty³
[
tÝ_idx
] =ð
TOP_FIELD
 )

568 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
tÝ_idx
];

569 
li¡_size
++;

570 
tÝ_idx
++;

577 
j
 = 0;

578 
k
 = 0;

579 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

581 ià((
found
 > 0è&& (
i
 =ð
š‹r_Ïy”_»f_idx
[
k
]))

583 
li¡
[
i
] = 
š‹r_Ïy”_»f
[
k
++];

584 
found
--;

588 
li¡
[
i
] = 
tmp_»Üd”
[
j
++];

591 
	}
}

599 
	$poc_»f_pic_»Üd”_f›ld
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

601 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

602 *
modifiÿtiÚ_of_pic_nums_idc
 = 
cu¼Sliû
->modifiÿtiÚ_of_pic_nums_idc[
li¡_no
];

603 *
abs_diff_pic_num_mšus1
 = 
cu¼Sliû
->abs_diff_pic_num_mšus1[
li¡_no
];

605 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

607 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

608 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

610 
i
,
j
,
k
;

612 
cu¼PicNum
, 
picNumLXP»d
;

614 
deçuÉ_Üd”
[32];

615 
»_Üd”
[32];

616 
tmp_»Üd”
[32];

617 
li¡_sign
[32];

618 
poc_diff
[32];

619 
æd_ty³
[32];

621 
»Üd”_¡Ý
, 
no_»Üd”
;

622 
tmp_v®ue
, 
diff
;

624 
abs_poc_di¡
;

625 
maxPicNum
;

626 
num_»fs
;

628 
f›ld_u£d
[2] = {1, 2};

629 
æd
, 
idx
, 
num_æds
;

631 
tÝ_idx
 = 0;

632 
bÙ_idx
 = 0;

633 
li¡_size
 = 0;

635 
StÜabËPiùu»
 *
pF›ld
[2];

636 
F¿meStÜe
 *
pF¿meStÜe
;

638 
maxPicNum
 = 2 * 
p_Vid
->
max_äame_num
;

639 
cu¼PicNum
 = 2 * 
p_Vid
->
äame_num
 + 1;

641 
picNumLXP»d
 = 
cu¼PicNum
;

644 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

646 
deçuÉ_Üd”
[
i
] = 
li¡
[i]->
pic_num
;

654 
idx
 = 0;

656 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

658 
pF¿meStÜe
 = 
p_Dpb
->
fs_»f
[
i
];

659 
pF›ld
[0] = 
pF¿meStÜe
->
tÝ_f›ld
;

660 
pF›ld
[1] = 
pF¿meStÜe
->
bÙtom_f›ld
;

661 
num_æds
 = (
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
 && (
p_Enc_Pic
->
poc
 =ð(
pF›ld
[0]->poc + 1) ) ) ? 1 : 2;

663 
poc_diff
[2*
i
 ] = 0xFFFF;

664 
poc_diff
[2*
i
 + 1] = 0xFFFF;

666  
æd
 = 0; fld < 
num_æds
; fld++ )

668 #ià(
MVC_EXTENSION_ENABLE
)

669 iàÐ(
pF¿meStÜe
->
is_u£d
 & 
f›ld_u£d
[
æd
]è&& 
pF›ld
[æd]->
u£d_fÜ_»ã»nû
 && !ÕF›ld[æd]->
is_lÚg_‹rm
)

670 && (
p_Vid
->
p_IÅ
->
num_of_v›ws
==1 || 
pF›ld
[
æd
]->
v›w_id
==p_Vid->view_id))

672 iàÐ(
pF¿meStÜe
->
is_u£d
 & 
f›ld_u£d
[
æd
]è&& 
pF›ld
[æd]->
u£d_fÜ_»ã»nû
 && !ÕF›ld[æd]->
is_lÚg_‹rm
))

675 
abs_poc_di¡
 = 
	`Ÿbs
(
pF›ld
[
æd
]->
poc
 - 
p_Enc_Pic
->poc) ;

676 
poc_diff
[
idx
] = 
abs_poc_di¡
;

677 
»_Üd”
[
idx
] = 
pF›ld
[
æd
]->
pic_num
;

678 
æd_ty³
[
idx
] = 
æd
 + 1;

680 ià(
li¡_no
 =ð
LIST_0
)

682 
li¡_sign
[
idx
] = (
p_Enc_Pic
->
poc
 < 
pF›ld
[
æd
]->poc) ? +1 : -1;

686 
li¡_sign
[
idx
] = (
p_Enc_Pic
->
poc
 > 
pF›ld
[
æd
]->poc) ? +1 : -1;

688 
idx
++;

692 
num_»fs
 = 
idx
;

695 
i
=0; i < 
num_»fs
-1; i++)

697 
j
 = (
i
 + 1); j < 
num_»fs
; j++)

699 ià(
poc_diff
[
i
] >…oc_diff[
j
] || (poc_diff[i] =ðpoc_diff[j] && 
li¡_sign
[j] >†ist_sign[i]))

702 
tmp_v®ue
 = 
poc_diff
[
i
];

703 
poc_diff
[
i
] =…oc_diff[
j
];

704 
poc_diff
[
j
] = 
tmp_v®ue
;

706 
tmp_v®ue
 = 
»_Üd”
[
i
];

707 
»_Üd”
[
i
] =„e_Üd”[
j
];

708 
»_Üd”
[
j
] = 
tmp_v®ue
;

710 
tmp_v®ue
 = 
li¡_sign
[
i
];

711 
li¡_sign
[
i
] =†i¡_sign[
j
];

712 
li¡_sign
[
j
] = 
tmp_v®ue
;

714 
tmp_v®ue
 = 
æd_ty³
[
i
];

715 
æd_ty³
[
i
] = fld_ty³[
j
];

716 
æd_ty³
[
j
] = 
tmp_v®ue
 ;

721 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

723 (
tÝ_idx
 < 
num_»fs
)||(
bÙ_idx
 <‚um_refs))

725  ; 
tÝ_idx
 < 
num_»fs
;op_idx++)

727 iàÐ
æd_ty³
[
tÝ_idx
] =ð
TOP_FIELD
 )

729 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
tÝ_idx
];

730 
li¡_size
++;

731 
tÝ_idx
++;

735  ; 
bÙ_idx
 < 
num_»fs
; bot_idx++)

737 iàÐ
æd_ty³
[
bÙ_idx
] =ð
BOTTOM_FIELD
 )

739 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
bÙ_idx
];

740 
li¡_size
++;

741 
bÙ_idx
++;

747 ià(
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
)

749 (
tÝ_idx
 < 
num_»fs
)||(
bÙ_idx
 <‚um_refs))

751  ; 
bÙ_idx
 < 
num_»fs
; bot_idx++)

753 iàÐ
æd_ty³
[
bÙ_idx
] =ð
BOTTOM_FIELD
 )

755 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
bÙ_idx
];

756 
li¡_size
++;

757 
bÙ_idx
++;

761  ; 
tÝ_idx
 < 
num_»fs
;op_idx++)

763 iàÐ
æd_ty³
[
tÝ_idx
] =ð
TOP_FIELD
 )

765 
tmp_»Üd”
[
li¡_size
] = 
»_Üd”
[
tÝ_idx
];

766 
li¡_size
++;

767 
tÝ_idx
++;

775 
li¡_size
 = 
	`imš
(†ist_size, 32 );

776  
i
 = 0; i < 
li¡_size
; i++ )

778 
»_Üd”
[
i
] = 
tmp_»Üd”
[i];

783 
no_»Üd”
 = 1;

784 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

786 ià(
deçuÉ_Üd”
[
i
] !ð
»_Üd”
[i])

788 
no_»Üd”
 = 0;

793 ià(
no_»Üd”
 == 0)

795 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

797 
diff
 = 
»_Üd”
[
i
] - 
picNumLXP»d
;

798 ià(
diff
 <= 0)

800 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 0;

801 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

802 ià(
abs_diff_pic_num_mšus1
[
i
] < 0)

803 
abs_diff_pic_num_mšus1
[
i
] = 
maxPicNum
 -1;

807 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 1;

808 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

810 
picNumLXP»d
 = 
»_Üd”
[
i
];

812 
tmp_»Üd”
[
i
] = 
»_Üd”
[i];

814 
k
 = 
i
;

815 
j
 = 
i
; j < 
num_»f_idx_lX_aùive
; j++)

817 ià(
deçuÉ_Üd”
[
j
] !ð
»_Üd”
[
i
])

819 ++
k
;

820 
tmp_»Üd”
[
k
] = 
deçuÉ_Üd”
[
j
];

823 
»Üd”_¡Ý
 = 1;

824 
j
=
i
+1; j<
num_»f_idx_lX_aùive
; j++)

826 ià(
tmp_»Üd”
[
j
] !ð
»_Üd”
[j])

828 
»Üd”_¡Ý
 = 0;

833 ià(
»Üd”_¡Ý
==1)

835 ++
i
;

839 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

841 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 3;

843 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

845 ià(
li¡_no
==0)

847 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 1;

851 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 1;

854 
	}
}

863 
	$m£_»f_pic_»Üd”_äame
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

865 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

866 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

867 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

868 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

870 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

872 
i
, 
j
, 
k
, 
l
, 
m
;

873 
found
 = 0, 
diff
;

874 
št64
 
iDi¡ÜtiÚ
 = 0;

876 
StÜabËPiùu»
 *
»_Üd”
[32];

877 
StÜabËPiùu»
 *
š‹r_Ïy”_»f
[32];

878 
StÜabËPiùu»
 *
tmp_pic_v®ue
;

880 
li¡_sign
[32];

881 
št64
 
m£_diff
[32];

882 
š‹r_Ïy”_»f_idx
[32];

884 
num_»fs
 = 
p_Dpb
->
»f_äames_š_bufãr
;

887 ià(
num_»fs
 > 1)

890 
i
 = 0; i < 
num_»fs
; i++)

893 
m£_diff
[
i
] = 0x7FFFFFFFFFFFFFFF;

894 ià(
p_Dpb
->
fs_»f
[
i
])

895 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
;

898 
»_Üd”
[
i
] = 
NULL
;

904 ià(
p_IÅ
->
EÇbËO³nGOP
)

907 ià(
p_Dpb
->
fs_»f
[
i
]->
poc
 < 
p_Vid
->
Ï¡_v®id_»ã»nû
 &&…_Vid->
ThisPOC
 >=…_Vid->last_valid_reference)

916 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 && (p_Dpb->fs_»f[i]->
äame
->
u£d_fÜ_»ã»nû
))

918 
iDi¡ÜtiÚ
 = 0;

919 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
 == 1)

921 
ii
;

922 
ii
 = 0; i˜< 
num_»fs
; ii++)

924 ià(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 =ð
pHMEInfo
->poc[0][0][
ii
])

926 
m£_diff
[
i
] = 
pHMEInfo
->
hme_di¡ÜtiÚ
[0][0][
ii
];

934 
l
 = 0;† < 
p_Vid
->
height
;†++)

936 
m
 = 0; m < 
p_Vid
->
width
; m++) {

937 
diff
 = 
p_Vid
->
pCurImg
[
l
][l] - 
p_Dpb
->
fs_»f
[
i
]->
äame
->
imgY
[l][
m
];

938 
iDi¡ÜtiÚ
 +ð
diff
 * diff;

942 
m£_diff
[
i
] = 
iDi¡ÜtiÚ
;

943 
li¡_sign
[
i
] = 0;

949 
i
 = 0; i < (
num_»fs
 - 1); i++)

951 
j
 = 
i
 + 1; j < 
num_»fs
; j++)

953 ià(
m£_diff
[
i
] > m£_diff[
j
])

955 
	`i64_sw­
(&
m£_diff
[
i
], &m£_diff[
j
]);

956 
tmp_pic_v®ue
 = 
»_Üd”
[
i
];

957 
»_Üd”
[
i
] =„e_Üd”[
j
];

958 
»_Üd”
[
j
] = 
tmp_pic_v®ue
 ;

962 ià(
cu¼Sliû
->
Ïy”_id
 > 0)

967 
j
 = 0;

968 
k
 = 0;

969 
i
 = 0; i < (è
num_»f_idx_lX_aùive
+
found
; i++)

971 ià((
found
 > 0è&& (
i
 =ð
š‹r_Ïy”_»f_idx
[
k
]))

973 
li¡
[
i
] = 
š‹r_Ïy”_»f
[
k
++];

975 
found
--;

979 
li¡
[
i
] = 
»_Üd”
[
j
++];

986 
i
 = 0; i < (è
num_»f_idx_lX_aùive
; i++)

989 
li¡
[
i
] = 
»_Üd”
[i];

995 
	}
}

1003 
	$Žyr_»f_pic_»Üd”_äame_deçuÉ
(
Sliû
 *
cu¼Sliû
, 
num_»f_idx_lX_aùive
, 
li¡_no
)

1005 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
li¡_no
];

1006 *
modifiÿtiÚ_of_pic_nums_idc
 = 
cu¼Sliû
->modifiÿtiÚ_of_pic_nums_idc[
li¡_no
];

1007 *
abs_diff_pic_num_mšus1
 = 
cu¼Sliû
->abs_diff_pic_num_mšus1[
li¡_no
];

1009 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1010 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

1011 
StÜabËPiùu»
 *
p_Enc_Pic
 = 
p_Vid
->
’c_piùu»
;

1012 
decoded_piùu»_bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

1014 
i
,
j
,
k
;

1017 
deçuÉ_Üd”
[32];

1018 
»_Üd”
[32];

1019 
tmp_»Üd”
[32];

1020 
li¡_sign
[32];

1021 
»Üd”_¡Ý
, 
no_»Üd”
;

1022 
poc_diff
[32];

1024 
‹mpÜ®_Ïy”
[32];

1026 
diff
;

1028 
abs_poc_di¡
;

1029 
num_»fs
;

1031 
tmp_poc_diff
, 
tmp_»_Üd”
, 
tmp_li¡_sign
, 
tmp_‹mpÜ®_Ïy”
;

1032 
begšIdx
 = 0;

1033 
ÃwSize
 = 0;

1036 
maxPicNum
 = 
p_Vid
->
max_äame_num
;

1037 
cu¼PicNum
 = 
p_Vid
->
äame_num
;

1039 
picNumLXP»d
 = 
cu¼PicNum
;

1042 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

1044 
deçuÉ_Üd”
[
i
] = 
li¡
[i]->
pic_num
;

1051 
num_»fs
 = 
p_Dpb
->
»f_äames_š_bufãr
;

1052 
i
 = 0; i < 
num_»fs
; i++)

1054 
poc_diff
[
i
] = 0xFFFF;

1055 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
->
pic_num
;

1057 
‹mpÜ®_Ïy”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
->temporal_layer;

1059 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 && (p_Dpb->fs_»f[i]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

1061 
abs_poc_di¡
 = 
	`Ÿbs
(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 - 
p_Enc_Pic
->poc) ;

1062 
poc_diff
[
i
] = 
abs_poc_di¡
;

1063 ià(
li¡_no
 =ð
LIST_0
)

1065 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 < 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

1069 
li¡_sign
[
i
] = (
p_Enc_Pic
->
poc
 > 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

1075 
i
 = 0; i < (
num_»fs
 - 1); i++)

1077 
j
 = 
i
 + 1; j < 
num_»fs
; j++)

1079 ià(
li¡_sign
[
i
] =ðli¡_sign[
j
] && 
poc_diff
[i] >…oc_diff[j])

1081 
tmp_poc_diff
 = 
poc_diff
[
i
];

1082 
tmp_»_Üd”
 = 
»_Üd”
[
i
];

1083 
tmp_li¡_sign
 = 
li¡_sign
[
i
];

1084 
tmp_‹mpÜ®_Ïy”
 = 
‹mpÜ®_Ïy”
[
i
];

1085 
poc_diff
[
i
] =…oc_diff[
j
];

1086 
»_Üd”
[
i
] =„e_Üd”[
j
];

1087 
li¡_sign
[
i
] =†i¡_sign[
j
];

1088 
‹mpÜ®_Ïy”
[
i
] =empÜ®_Ïy”[
j
];

1089 
poc_diff
[
j
] = 
tmp_poc_diff
;

1090 
»_Üd”
[
j
] = 
tmp_»_Üd”
 ;

1091 
li¡_sign
[
j
] = 
tmp_li¡_sign
;

1092 
‹mpÜ®_Ïy”
[
j
] = 
tmp_‹mpÜ®_Ïy”
;

1098 
i
 = 0; i < 
num_»fs
; i++)

1104 ià(
‹mpÜ®_Ïy”
[
i
] <ð
p_Enc_Pic
->temporal_layer)

1106 
tmp_poc_diff
 = 
poc_diff
[
i
];

1107 
tmp_»_Üd”
 = 
»_Üd”
[
i
];

1108 
tmp_li¡_sign
 = 
li¡_sign
[
i
];

1109 
tmp_‹mpÜ®_Ïy”
 = 
‹mpÜ®_Ïy”
[
i
];

1110 
j
 = 
i
; j > 
begšIdx
; j--)

1112 
poc_diff
[
j
] =…oc_diff[j-1];

1113 
»_Üd”
[
j
] =„e_order[j-1];

1114 
li¡_sign
[
j
] =†ist_sign[j-1];

1115 
‹mpÜ®_Ïy”
[
j
] =emporal_layer[j-1];

1117 
poc_diff
[
begšIdx
] = 
tmp_poc_diff
;

1118 
»_Üd”
[
begšIdx
] = 
tmp_»_Üd”
;

1119 
li¡_sign
[
begšIdx
] = 
tmp_li¡_sign
;

1120 
‹mpÜ®_Ïy”
[
begšIdx
] = 
tmp_‹mpÜ®_Ïy”
;

1121 
begšIdx
 += 1;

1123 
ÃwSize
++;

1129 iàÐ
p_IÅ
->
WPMCP»cisiÚ


1130 && 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 !ð
WP_REGULAR


1131 && 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
li¡_no
] )

1133 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

1135 
»_Üd”
[
i
] = 
p_Vid
->
pWPX
->
wp_»f_li¡
[
li¡_no
][i].
PicNum
;

1141 
no_»Üd”
 = 1;

1142 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

1144 ià(
deçuÉ_Üd”
[
i
] !ð
»_Üd”
[i])

1146 
no_»Üd”
 = 0;

1151 ià(
no_»Üd”
==0)

1153 
i
=0; i<
num_»f_idx_lX_aùive
; i++)

1155 
diff
 = 
»_Üd”
[
i
]-
picNumLXP»d
;

1156 ià(
diff
 <= 0)

1158 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 0;

1159 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

1160 ià(
abs_diff_pic_num_mšus1
[
i
] < 0)

1161 
abs_diff_pic_num_mšus1
[
i
] = 
maxPicNum
 -1;

1165 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 1;

1166 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

1168 
picNumLXP»d
 = 
»_Üd”
[
i
];

1170 
tmp_»Üd”
[
i
] = 
»_Üd”
[i];

1172 
k
 = 
i
;

1173 
j
=
i
; j<
num_»f_idx_lX_aùive
; j++)

1175 ià(
deçuÉ_Üd”
[
j
] !ð
»_Üd”
[
i
])

1177 ++
k
;

1178 
tmp_»Üd”
[
k
] = 
deçuÉ_Üd”
[
j
];

1181 
»Üd”_¡Ý
 = 1;

1182 
j
=
i
+1; j<
num_»f_idx_lX_aùive
; j++)

1184 ià(
tmp_»Üd”
[
j
] !ð
»_Üd”
[j])

1186 
»Üd”_¡Ý
 = 0;

1191 ià(
»Üd”_¡Ý
==1)

1193 ++
i
;

1196 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

1199 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 3;

1201 
	`memýy
 ( 
deçuÉ_Üd”
, 
tmp_»Üd”
, 
num_»f_idx_lX_aùive
 * ());

1203 ià(
li¡_no
==0)

1205 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 1;

1209 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 1;

1212 
	}
}

1222 
	$»Üd”_li¡s_dummy
Ð
Sliû
 *
cu¼Sliû
 )

1224 
	}
}

1233 
	$»Üd”_li¡s
Ð
Sliû
 *
cu¼Sliû
 )

1235 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

1238 iàÐ
p_IÅ
->
Reã»nûReÜd”
 &&

1239 ((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
) ||

1240 (
p_IÅ
->
U£Di¡ÜtiÚReÜd”
 =ð1 &&…_IÅ->
EÇbËReÜd”B¦iû
 =ð1 && 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)) )

1242 
i
, 
num_»f
;

1244 
i
 = 0; i < 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] + 1; i++)

1246 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][
i
] = 3;

1247 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
][
i
] = 0;

1248 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
][
i
] = 0;

1251 
num_»f
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
];

1252 iàÐ
p_IÅ
->
Reã»nûReÜd”
 == 2 )

1254 iàÐ
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
 )

1255 
cu¼Sliû
->
	`poc_»f_pic_»Üd”_äame
(cu¼Sliû, 
num_»f
, 
LIST_0
);

1259 iàÐ
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
 )

1260 
cu¼Sliû
->
	`poc_»f_pic_»Üd”_äame
(cu¼Sliû, 
num_»f
, 
LIST_0
);

1263 
	`poc_»f_pic_»Üd”_f›ld_’h
(
cu¼Sliû
, 
num_»f
, 
LIST_0
);

1267 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] = cu¼Sliû->
li¡Xsize
[0];

1269 ià(
p_IÅ
->
Reã»nûReÜd”
 > 1)

1271 
	`ä“_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

1272 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

1273 
	`»Üd”_»f_pic_li¡
 ( 
cu¼Sliû
, 
LIST_0
);

1276 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] = cu¼Sliû->
li¡Xsize
[0];

1278 #ià
KEEP_B_SAME_LIST


1279 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && cu¼Sliû->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

1281 
iS’dAddtiÚ®RPLR
 = 0;

1282 
iS’dAddtiÚ®RPLR
 = ( 
p_IÅ
->
BId’tiÿlLi¡
 =ð1 && ( (
cu¼Sliû
->
ThisPOC
/2è% (p_IÅ->
Numb”BF¿mes
+1) ) == 0 ) ||

1283 Ð
p_IÅ
->
BId’tiÿlLi¡
 == 2 );

1285 iàÐ
iS’dAddtiÚ®RPLR
 )

1287 
i
, 
diff_num
, 
Ï¡_äame_num
;

1289 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

1291 
i
 = 0; i < 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] + 1; i++)

1293 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][
i
] = 3;

1294 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = 0;

1295 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
][
i
] = 0;

1298 
Ï¡_äame_num
 = 
cu¼Sliû
->
äame_num
;

1299  
i
=0; i<
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
]; i++ )

1301 
diff_num
 = 
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->
äame_num
 - 
Ï¡_äame_num
;

1302 
Ï¡_äame_num
 = 
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->
äame_num
;

1303 iàÐ
diff_num
 <= 0 )

1305 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][
i
] = 0;

1306 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = 
	`Ÿbs
(
diff_num
) - 1;

1307 iàÐ
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] < 0 )

1309 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = cu¼Sliû->
max_äame_num
 - 1;

1314 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][
i
] = 1;

1315 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = 
	`Ÿbs
(
diff_num
) - 1;

1319 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 1;

1320 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = cu¼Sliû->
li¡Xsize
[1];

1321 
	`»Üd”_»f_pic_li¡
 ( 
cu¼Sliû
, 
LIST_1
);

1322 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = cu¼Sliû->
li¡Xsize
[1];

1329 #ià
CRA


1330 iàÐ
p_IÅ
->
u£CRA
 )

1332 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && cu¼Sliû->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

1334 iàÐÐ(
cu¼Sliû
->
ThisPOC
/2è- (
p_IÅ
->
Numb”BF¿mes
+1èè%…_IÅ->
šŒa_³riod
 == 0 )

1336 
i
, 
diff_num
;

1337 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

1338 
i
 = 0; i < 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] + 1; i++)

1340 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][
i
] = 3;

1341 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = 0;

1342 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
][
i
] = 0;

1345 
diff_num
 = 
cu¼Sliû
->
li¡X
[
LIST_0
][0]->
äame_num
 - currSlice->frame_num;

1346 iàÐ
diff_num
 <= 0 )

1348 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][0] = 0;

1349 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][0] = 
	`Ÿbs
(
diff_num
) - 1;

1350 iàÐ
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][0] < 0 )

1352 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][0] = cu¼Sliû->
max_äame_num
 - 1;

1357 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][0] = 1;

1358 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][0] = 
	`Ÿbs
(
diff_num
) - 1;

1361 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
LIST_1
] = 1;

1362 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = cu¼Sliû->
li¡Xsize
[1];

1363 
	`»Üd”_»f_pic_li¡
 ( 
cu¼Sliû
, 
LIST_1
);

1364 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = cu¼Sliû->
li¡Xsize
[1];

1369 
	}
}

1378 
	$wp_mý»c_»Üd”_li¡s
Ð
Sliû
 *
cu¼Sliû
 )

1381 
i
, 
num_»f
;

1383 
	`wpxModifyRefPicLi¡
Ð
cu¼Sliû
 );

1385 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

1387 
i
 = 0; i < 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] + 1; i++)

1389 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][
i
] = 3;

1390 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
][
i
] = 0;

1391 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
][
i
] = 0;

1394 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

1396 
i
 = 0; i < 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] + 1; i++)

1398 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
][
i
] = 3;

1399 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
][
i
] = 0;

1400 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
][
i
] = 0;

1405 
num_»f
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
];

1407 
cu¼Sliû
->
	`poc_»f_pic_»Üd”_äame
(cu¼Sliû, 
num_»f
, 
LIST_0
);

1409 
	`»Üd”_»f_pic_li¡
 ( 
cu¼Sliû
, 
LIST_0
);

1411 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 )

1414 
num_»f
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
];

1416 
cu¼Sliû
->
	`poc_»f_pic_»Üd”_äame
(cu¼Sliû, 
num_»f
, 
LIST_1
);

1418 
	`»Üd”_»f_pic_li¡
 ( 
cu¼Sliû
, 
LIST_1
);

1420 
	}
}

1422 
	$£t_deçuÉ_»f_pic_li¡s
(
Sliû
 *
cu¼Sliû
)

1424 
li¡
, 
»f
;

1426 
li¡
 = 
LIST_0
;†i¡ <ð(
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 ? LIST_0:
LIST_1
);†ist++)

1428 
»f
 = 0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
];„ef++)

1430 
cu¼Sliû
->
deçuÉ_pic_num
[
li¡
][
»f
] = cu¼Sliû->
li¡X
[li¡][»f]->
pic_num
;

1431 #ià
MVC_EXTENSION_ENABLE


1432 
cu¼Sliû
->
deçuÉ_v›w_id
[
li¡
][
»f
] = cu¼Sliû->
li¡X
[li¡][»f]->
v›w_id
;

1436 
	}
}

1438 
	$»Üd”_agaš¡_deçuÉ_»f_pic_li¡s
(
Sliû
 *
cu¼Sliû
, 
cur_li¡
)

1440 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1441 *
modifiÿtiÚ_of_pic_nums_idc
 = 
cu¼Sliû
->modifiÿtiÚ_of_pic_nums_idc[
cur_li¡
];

1442 *
abs_diff_pic_num_mšus1
 = 
cu¼Sliû
->abs_diff_pic_num_mšus1[
cur_li¡
];

1443 #ià
MVC_EXTENSION_ENABLE


1444 *
abs_diff_v›w_idx_mšus1
 = 
cu¼Sliû
->abs_diff_v›w_idx_mšus1[
cur_li¡
];

1445 
picV›wIdxLX
;

1447 
i
;

1449 
maxPicNum
, 
cu¼PicNum
, 
picNumLXNoW¿p
, 
picNumLXP»d
;

1450 
maxV›wIdx
 =0;

1451 
cu¼V›wIdx
 = -1;

1452 
picV›wIdxLXP»d
=-1;

1454 
diff
;

1456 ià(
p_Vid
->
¡ruùu»
==
FRAME
)

1458 
maxPicNum
 = 
p_Vid
->
max_äame_num
;

1459 
cu¼PicNum
 = 
p_Vid
->
äame_num
;

1463 
maxPicNum
 = 2*
p_Vid
->
max_äame_num
;

1464 
cu¼PicNum
 = 2*
p_Vid
->
äame_num
+1;

1467 
cu¼V›wIdx
 = 
p_Vid
->
v›w_id
;

1468 
maxV›wIdx
 = 1;

1469 
picV›wIdxLXP»d
=-1;

1471 
picNumLXP»d
 = 
cu¼PicNum
;

1473 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
cur_li¡
] = 0;

1474 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
]; i++)

1479 #ià
MVC_EXTENSION_ENABLE


1480 
cu¼Sliû
->
deçuÉ_v›w_id
[
cur_li¡
][
i
] !ðcu¼Sliû->
li¡X
[cur_li¡][i]->
v›w_id
 ||

1482 
cu¼Sliû
->
deçuÉ_pic_num
[
cur_li¡
][
i
] !ðcu¼Sliû->
li¡X
[cur_li¡][i]->
pic_num
)

1484 
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
cur_li¡
] = 1;

1489 if(!
cu¼Sliû
->
»f_pic_li¡_»Üd”šg_æag
[
cur_li¡
])

1493 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
]+1; i++)

1494 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 3;

1496 
i
=0; i < 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
]; i++)

1498 
StÜabËPiùu»
 *
»f_pic
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
i
];

1500 #ià
MVC_EXTENSION_ENABLE


1501 if(
»f_pic
->
v›w_id
 !ð
cu¼V›wIdx
)

1503 
diff
 = 1;

1505 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 5;

1506 
abs_diff_v›w_idx_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

1512 
diff
 = 
»f_pic
->
pic_num
-
picNumLXP»d
;

1513 ià(
diff
 <= 0)

1515 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 0;

1516 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

1517 ià(
abs_diff_pic_num_mšus1
[
i
] < 0)

1518 
abs_diff_pic_num_mšus1
[
i
] = 
maxPicNum
-1;

1522 
modifiÿtiÚ_of_pic_nums_idc
[
i
] = 1;

1523 
abs_diff_pic_num_mšus1
[
i
] = 
	`Ÿbs
(
diff
)-1;

1527 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] == 0 || modification_of_pic_nums_idc[i] == 1)

1529 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] == 0)

1531 ifÐ
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) < 0 )

1532 
picNumLXNoW¿p
 = 
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) + 
maxPicNum
;

1534 
picNumLXNoW¿p
 = 
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 );

1538 ifÐ
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) >ð
maxPicNum
 )

1539 
picNumLXNoW¿p
 = 
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) - 
maxPicNum
;

1541 
picNumLXNoW¿p
 = 
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 );

1543 
picNumLXP»d
 = 
picNumLXNoW¿p
;

1545 #ià
MVC_EXTENSION_ENABLE


1546 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] == 4 || modification_of_pic_nums_idc[i] == 5)

1548 if(
modifiÿtiÚ_of_pic_nums_idc
[
i
] == 4)

1550 
picV›wIdxLX
 = 
picV›wIdxLXP»d
 - (
abs_diff_v›w_idx_mšus1
[
i
] + 1);

1551 ifÐ
picV›wIdxLX
 <0)

1552 
picV›wIdxLX
 +ð
maxV›wIdx
;

1556 
picV›wIdxLX
 = 
picV›wIdxLXP»d
 + (
abs_diff_v›w_idx_mšus1
[
i
] + 1);

1557 ifÐ
picV›wIdxLX
 >ð
maxV›wIdx
)

1558 
picV›wIdxLX
 -ð
maxV›wIdx
;

1560 
picV›wIdxLXP»d
 = 
picV›wIdxLX
;

1564 
	}
}

	@lencod/src/lln_mc_prediction.c

16 
	~"glob®.h
"

17 
	~"mbufãr.h
"

18 
	~"mb_acûss.h
"

19 
	~"maüoblock.h
"

20 
	~"”rdo.h
"

21 
	~"block.h
"

22 
	~"În_mc_´ediùiÚ.h
"

24 cÚ¡ 
	gCOEF
[6] = { 1, -5, 20, 20, -5, 1 };

31 
šlše
 
	$mc_´ediùiÚ
(
img³l
** 
mb_´ed
,

32 
block_size_y
,

33 
block_size_x
,

34 
ioff
,

35 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE])

37 
jj
;

39 ià(
block_size_x
 =ð
MB_BLOCK_SIZE
)

41 
	`memýy
(&(
mb_´ed
[0][
ioff
]), &(
block
[0][0]), 
block_size_x
 * 
block_size_y
 * (
img³l
));

45 
jj
 = 0; jj < 
block_size_y
; jj++)

47 
	`memýy
(&(
mb_´ed
[
jj
][
ioff
]), &(
block
[jj][0]), 
block_size_x
 * (
img³l
));

50 
	}
}

60 
šlše
 
	$weigh‹d_mc_´ediùiÚ
(
img³l
** 
mb_´ed
,

61 
block_size_y
,

62 
block_size_x
,

63 
ioff
,

64 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE],

65 
wp_sÿË
,

66 
wp_off£t
,

67 
weight_d’om
,

68 
cÞÜ_þ
)

70 
ii
, 
jj
;

71 
img³l
 *
m´
, *
b0
;

73 
jj
=0;jj<
block_size_y
;jj++)

75 
m´
 = &
mb_´ed
[
jj
][
ioff
];

76 
b0
 = 
block
[
jj
];

77 
ii
=0;ii<
block_size_x
;ii++)

78 *(
m´
++èð(
img³l
è
	`iCl1
(
cÞÜ_þ
, (
	`rshiá_ºd
((
wp_sÿË
 * *(
b0
++)), 
weight_d’om
è+ 
wp_off£t
 ));

80 
	}
}

89 
šlše
 
	$bi_´ediùiÚ
(
img³l
** 
mb_´ed
,

90 
img³l
 
block_l0
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE],

91 
img³l
 
block_l1
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE],

92 
block_size_y
,

93 
block_size_x
,

94 
ioff
)

96 
ii
, 
jj
;

97 
img³l
 *
m´
, *
b0
, *
b1
;

99 
jj
 = 0;jj < 
block_size_y
;jj++)

101 
m´
 = &
mb_´ed
[
jj
][
ioff
];

102 
b0
 = 
block_l0
[
jj
];

103 
b1
 = 
block_l1
[
jj
];

104 
ii
 = 0; i˜< 
block_size_x
;ii++)

105 *(
m´
++èð(
img³l
è
	`rshiá_ºd_sf
((*(
b0
++è+ *(
b1
++)), 1);

107 
	}
}

115 
šlše
 
	$weigh‹d_bi_´ediùiÚ
(
img³l
** 
mb_´ed
,

116 
img³l
 
block_l0
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE],

117 
img³l
 
block_l1
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE],

118 
block_size_y
,

119 
block_size_x
,

120 
ioff
,

121 
wp_sÿË_l0
,

122 
wp_sÿË_l1
,

123 
wp_off£t
,

124 
weight_d’om
,

125 
cÞÜ_þ
)

127 
ii
, 
jj
;

128 
img³l
 *
m´
, *
b0
, *
b1
;

130 
jj
 = 0; jj < 
block_size_y
; jj++)

132 
m´
 = &
mb_´ed
[
jj
][
ioff
];

133 
b0
 = 
block_l0
[
jj
];

134 
b1
 = 
block_l1
[
jj
];

136 
ii
=0;ii<
block_size_x
;ii++)

137 *(
m´
++èð(
img³l
è
	`iCl1
(
cÞÜ_þ
, (
	`rshiá_ºd
((
wp_sÿË_l0
 * *(
b0
++è+ 
wp_sÿË_l1
 * *(
b1
++)), 
weight_d’om
è+ 
wp_off£t
));

139 
	}
}

141 
	$g‘_block_luma
(
Maüoblock
 *
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
* 
dec_piùu»
, StÜabËPiùu» *
cu¼_»f
, 
x_pos
, 
y_pos
, 
block_size_x
, 
block_size_y
, 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE])

143 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

144 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

146 
tmp_»s
[21][21];

147 *
tmp_lše
;

148 
img³l
 *
p0
, *
p1
, *
p2
, *
p3
, *
p4
, *
p5
;

149 *
x0
, *
x1
, *
x2
, *
x3
, *
x4
, *
x5
;

151 
img³l
 **
cur_imgY
, *
cur_lšeY
;

152 
os_m2
, 
os_m1
, 
os
, 
os_p1
, 
os_p2
, 
os_p3
;

153 
img³l
 *
Üig_lše
;

154 
tmp_pos
;

156 
dx
 = (
x_pos
 & 3), 
dy
 = (
y_pos
 & 3);

157 
i
, 
j
, 
jj
;

158 
shiá_x
 = 
dec_piùu»
->
size_x
;

159 
maxÞd_x
 = 
dec_piùu»
->
size_x
 - 1;

160 
maxÞd_y
 = (
cu¼MB
->
mb_f›ld
è? (
dec_piùu»
->
size_y
 >> 1) - 1 : dec_picture->size_y - 1;

161 
»suÉ
;

162 
´es_x
;

163 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

165 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

167 
cur_imgY
 = 
cu¼_»f
->
de_mem
->
p_dec_img
[(è
p_Vid
->
cÞour_¶ªe_id
][
decod”
];

171 
cur_imgY
 = 
cu¼_»f
->
de_mem
->
p_dec_img
[
¶
][
decod”
];

174 
x_pos
 = x_pos >> 2;

175 
y_pos
 = y_pos >> 2;

177 iàÐ(
y_pos
 > 1è&& (y_po < 
maxÞd_y
 - 2 - 
block_size_y
è&& (
x_pos
 > 1è&& (x_po < 
maxÞd_x
 - 2 - 
block_size_x
))

179 
cur_imgY
 = &cur_imgY[ 
y_pos
];

180 ià(
dx
 =ð0 && 
dy
 == 0)

182 
j
 = 0; j < 
block_size_y
; j++)

184 
	`memýy
(&(
block
[
j
][0]), &(
cur_imgY
[j][
x_pos
]), 
block_size_x
 * (
img³l
));

190 ià(
dy
 == 0)

192 
j
 = 0; j < 
block_size_y
; j++)

194 
p0
 = &
cur_imgY
[
j
][
x_pos
 - 2];

195 
p1
 = 
p0
 + 1;

196 
p2
 = 
p1
 + 1;

197 
p3
 = 
p2
 + 1;

198 
p4
 = 
p3
 + 1;

199 
p5
 = 
p4
 + 1;

200 
Üig_lše
 = 
block
[
j
];

202 
i
 = 0; i < 
block_size_x
; i++)

204 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

205 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

206 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

208 *
Üig_lše
++ = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

212 ià((
dx
&1) == 1)

214 
j
 = 0; j < 
block_size_y
; j++)

216 
cur_lšeY
 = &(
cur_imgY
[
j
][
x_pos
 + (
dx
 >> 1)]);

217 
Üig_lše
 = 
block
[
j
];

218 
i
 = 0; i < 
block_size_x
; i++)

220 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lšeY
++) + 1 ) >> 1);

221 
Üig_lše
++;

226 ià(
dx
 == 0)

228 
p0
 = &(
cur_imgY
[ - 2][
x_pos
]);

229 
j
 = 0; j < 
block_size_y
; j++)

231 
p1
 = 
p0
 + 
shiá_x
;

232 
p2
 = 
p1
 + 
shiá_x
;

233 
p3
 = 
p2
 + 
shiá_x
;

234 
p4
 = 
p3
 + 
shiá_x
;

235 
p5
 = 
p4
 + 
shiá_x
;

236 
Üig_lše
 = 
block
[
j
];

238 
i
 = 0; i < 
block_size_x
; i++)

240 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

241 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

242 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

244 *
Üig_lše
++ = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

246 
p0
 = 
p1
 - 
block_size_x
;

249 ià((
dy
&1) == 1)

251 
jj
 = (
dy
 >> 1);

252 
j
 = 0; j < 
block_size_y
; j++)

254 
cur_lšeY
 = &(
cur_imgY
[
jj
++][
x_pos
]);

255 
Üig_lše
 = 
block
[
j
];

256 
i
 = 0; i < 
block_size_x
; i++)

258 *
Üig_lše
 = (
img³l
è((*Üig_lš+ *(
cur_lšeY
++) + 1 ) >> 1);

259 
Üig_lše
++;

264 ià(
dx
 == 2)

266 
jj
 = - 2;

267 
j
 = 0; j < 
block_size_y
 + 5; j++)

269 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

270 
p1
 = 
p0
 + 1;

271 
p2
 = 
p1
 + 1;

272 
p3
 = 
p2
 + 1;

273 
p4
 = 
p3
 + 1;

274 
p5
 = 
p4
 + 1;

275 
Üig_lše
 = 
block
[
j
];

276 
tmp_lše
 = 
tmp_»s
[
j
];

278 
i
 = 0; i < 
block_size_x
; i++)

280 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

281 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

282 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

286 
j
 = 0; j < 
block_size_y
; j++)

288 
x0
 = 
tmp_»s
[
j
 ];

289 
x1
 = 
tmp_»s
[
j
 + 1];

290 
x2
 = 
tmp_»s
[
j
 + 2];

291 
x3
 = 
tmp_»s
[
j
 + 3];

292 
x4
 = 
tmp_»s
[
j
 + 4];

293 
x5
 = 
tmp_»s
[
j
 + 5];

294 
Üig_lše
 = 
block
[
j
];

296 
i
 = 0; i < 
block_size_x
; i++)

298 
»suÉ
 = (*
x0
++ + *
x5
++è* 
COEF
[0]

299 + (*
x1
++ + *
x4
++è* 
COEF
[1]

300 + (*
x2
++ + *
x3
++è* 
COEF
[2];

302 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
+512)>>10));

306 ià((
dy
&1) == 1)

308 
jj
 = 2 + (
dy
>>1);

309 
j
 = 0; j < 
block_size_y
; j++)

311 
tmp_lše
 = 
tmp_»s
[
jj
++];

312 
Üig_lše
 = 
block
[
j
];

313 
i
 = 0; i < 
block_size_x
; i++)

315 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16) >> 5)) + 1 )>> 1);

316 
Üig_lše
++;

321 ià(
dy
 == 2)

323 
p0
 = &(
cur_imgY
[ -2][
x_pos
 - 2]);

324 
j
 = 0; j < 
block_size_y
; j++)

326 
p1
 = 
p0
 + 
shiá_x
;

327 
p2
 = 
p1
 + 
shiá_x
;

328 
p3
 = 
p2
 + 
shiá_x
;

329 
p4
 = 
p3
 + 
shiá_x
;

330 
p5
 = 
p4
 + 
shiá_x
;

331 
tmp_lše
 = 
tmp_»s
[
j
];

333 
i
 = 0; i < 
block_size_x
 + 5; i++)

335 *(
tmp_lše
++èð(*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

336 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

337 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

339 
p0
 = 
p1
 - (
block_size_x
 + 5);

342 
j
 = 0; j < 
block_size_y
; j++)

344 
Üig_lše
 = 
block
[
j
];

345 
x0
 = 
tmp_»s
[
j
];

346 
x1
 = 
x0
 + 1;

347 
x2
 = 
x1
 + 1;

348 
x3
 = 
x2
 + 1;

349 
x4
 = 
x3
 + 1;

350 
x5
 = 
x4
 + 1;

352 
i
 = 0; i < 
block_size_x
; i++)

354 
»suÉ
 = (*(
x0
++è+ *(
x5
++)è* 
COEF
[0]

355 + (*(
x1
++è+ *(
x4
++)è* 
COEF
[1]

356 + (*(
x2
++è+ *(
x3
++)è* 
COEF
[2];

358 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

362 ià((
dx
&1) == 1)

364 
j
 = 0; j < 
block_size_y
; j++)

366 
tmp_lše
 = &
tmp_»s
[
j
][2 + (
dx
>>1)];

367 
Üig_lše
 = 
block
[
j
];

368 
i
 = 0; i < 
block_size_x
; i++)

370 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16)>>5))+1)>>1);

371 
Üig_lše
 ++;

378 
jj
 = (
dy
 == 1 ? 0 : 1);

380 
j
 = 0; j < 
block_size_y
; j++)

382 
p0
 = &
cur_imgY
[
jj
++][
x_pos
 - 2];

383 
p1
 = 
p0
 + 1;

384 
p2
 = 
p1
 + 1;

385 
p3
 = 
p2
 + 1;

386 
p4
 = 
p3
 + 1;

387 
p5
 = 
p4
 + 1;

389 
Üig_lše
 = 
block
[
j
];

391 
i
 = 0; i < 
block_size_x
; i++)

393 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

394 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

395 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

397 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

401 
p0
 = &(
cur_imgY
[-2][(
dx
 =ð1 ? 
x_pos
 : x_pos + 1)]);

402 
j
 = 0; j < 
block_size_y
; j++)

404 
p1
 = 
p0
 + 
shiá_x
;

405 
p2
 = 
p1
 + 
shiá_x
;

406 
p3
 = 
p2
 + 
shiá_x
;

407 
p4
 = 
p3
 + 
shiá_x
;

408 
p5
 = 
p4
 + 
shiá_x
;

409 
Üig_lše
 = 
block
[
j
];

411 
i
 = 0; i < 
block_size_x
; i++)

413 
»suÉ
 = (*(
p0
++è+ *(
p5
++)è* 
COEF
[0]

414 + (*(
p1
++è+ *(
p4
++)è* 
COEF
[1]

415 + (*(
p2
++è+ *(
p3
++)è* 
COEF
[2];

417 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16) >> 5)) + 1) >> 1);

418 
Üig_lše
++;

420 
p0
 = 
p1
 - 
block_size_x
 ;

427 ià(
dx
 =ð0 && 
dy
 == 0)

429 
j
 = 0; j < 
block_size_y
; j++)

431 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
)];

432 
Üig_lše
 = 
block
[
j
];

433 
i
 = 0; i < 
block_size_x
; i++)

435 *(
Üig_lše
++èð
cur_lšeY
[
	`iCl3
(0, 
maxÞd_x
, 
x_pos
 + 
i
 )];

442 ià(
dy
 == 0)

444 
tmp_pos
 = 
x_pos
 - 2;

445 
i
 = 0; i < 
block_size_x
; i++)

447 
os_m2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

448 
os_m1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

449 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

450 
os_p1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

451 
os_p2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

452 
os_p3
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
 );

453 
tmp_pos
 -= 4;

455 
j
 = 0; j < 
block_size_y
; j++)

457 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0,
maxÞd_y
,
y_pos
+
j
)];

459 
»suÉ
 = (
cur_lšeY
[
os_m2
] + cur_lšeY[
os_p3
]è* 
COEF
[0];

460 
»suÉ
 +ð(
cur_lšeY
[
os_m1
] + cur_lšeY[
os_p2
]è* 
COEF
[1];

461 
»suÉ
 +ð(
cur_lšeY
[
os
 ] + cur_lšeY[
os_p1
]è* 
COEF
[2];

463 
block
[
j
][
i
] = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 16)>>5));

467 ià((
dx
&1) == 1)

469 
j
 = 0; j < 
block_size_y
; j++)

471 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0,
maxÞd_y
,
y_pos
+
j
)];

472 
Üig_lše
 = 
block
[
j
];

473 
i
 = 0; i < 
block_size_x
; i++)

475 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
cur_lšeY
[
	`iCl3
(0, 
maxÞd_x
, 
x_pos
 + 
i
 + (
dx
 >> 1))] + 1 ) >> 1);

476 
Üig_lše
++;

481 ià(
dx
 == 0)

483 
tmp_pos
 = 
y_pos
 - 2;

484 
j
 = 0; j < 
block_size_y
; j++)

486 
p0
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

487 
p1
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

488 
p2
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

489 
p3
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

490 
p4
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

491 
p5
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
 )];

493 
tmp_pos
 -= 4;

494 
Üig_lše
 = 
block
[
j
];

496 
i
 = 0; i < 
block_size_x
; i++)

498 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
,
x_pos
+
i
);

500 
»suÉ
 = (
p0
[
´es_x
] + 
p5
[´es_x]è* 
COEF
[0];

501 
»suÉ
 +ð(
p1
[
´es_x
] + 
p4
[´es_x]è* 
COEF
[1];

502 
»suÉ
 +ð(
p2
[
´es_x
] + 
p3
[´es_x]è* 
COEF
[2];

503 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
+16)>>5));

507 ià((
dy
&1) == 1)

509 
j
 = 0; j < 
block_size_y
; j++)

511 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0,
maxÞd_y
,
y_pos
+
j
+(
dy
>>1))];

512 
Üig_lše
 = 
block
[
j
];

513 
i
 = 0; i < 
block_size_x
; i++)

515 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
cur_lšeY
[
	`iCl3
(0, 
maxÞd_x
, 
x_pos
 + 
i
)] + 1 ) >> 1);

516 
Üig_lše
++;

521 ià(
dx
 == 2)

523 
tmp_pos
 = 
x_pos
 - 2;

524 
i
 = 0; i < 
block_size_x
; i++)

526 
os_m2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

527 
os_m1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

528 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

529 
os_p1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

530 
os_p2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

531 
os_p3
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
 );

532 
tmp_pos
 -= 4;

534 
j
 = 0; j < 
block_size_y
 + 5; j++)

536 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0,
maxÞd_y
,
y_pos
 + 
j
 - 2)];

538 
tmp_»s
[
j
][
i
] = (
cur_lšeY
[
os_m2
] + cur_lšeY[
os_p3
]è* 
COEF
[0];

539 
tmp_»s
[
j
][
i
] +ð(
cur_lšeY
[
os_m1
] + cur_lšeY[
os_p2
]è* 
COEF
[1];

540 
tmp_»s
[
j
][
i
] +ð(
cur_lšeY
[
os
 ] + cur_lšeY[
os_p1
]è* 
COEF
[2];

544 
j
 = 0; j < 
block_size_y
; j++)

546 
x0
 = 
tmp_»s
[
j
 ];

547 
x1
 = 
tmp_»s
[
j
 + 1];

548 
x2
 = 
tmp_»s
[
j
 + 2];

549 
x3
 = 
tmp_»s
[
j
 + 3];

550 
x4
 = 
tmp_»s
[
j
 + 4];

551 
x5
 = 
tmp_»s
[
j
 + 5];

552 
Üig_lše
 = 
block
[
j
];

554 
i
 = 0; i < 
block_size_x
; i++)

556 
»suÉ
 = (*
x0
++ + *
x5
++è* 
COEF
[0]

557 + (*
x1
++ + *
x4
++è* 
COEF
[1]

558 + (*
x2
++ + *
x3
++è* 
COEF
[2];

560 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
+512)>>10));

564 ià((
dy
&1) == 1)

566 
j
 = 0; j < 
block_size_y
; j++)

568 
tmp_lše
 = 
tmp_»s
[
j
 + 2 + (
dy
>>1)];

569 
Üig_lše
 = 
block
[
j
];

570 
i
 = 0; i < 
block_size_x
; i++)

572 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16) >> 5)) + 1 )>>1);

573 
Üig_lše
++;

578 ià(
dy
 == 2)

581 
tmp_pos
 = 
y_pos
 - 2;

582 
j
 = 0; j < 
block_size_y
; j++)

584 
p0
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

585 
p1
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

586 
p2
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

587 
p3
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

588 
p4
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

589 
p5
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
 )];

591 
tmp_pos
 -= 4;

593 
i
 = 0; i < 
block_size_x
 + 5; i++)

595 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
, 
x_pos
 + 
i
 - 2);

596 
»suÉ
 = (
p0
[
´es_x
] + 
p5
[´es_x])*
COEF
[0]

597 + (
p1
[
´es_x
] + 
p4
[´es_x])*
COEF
[1]

598 + (
p2
[
´es_x
] + 
p3
[´es_x])*
COEF
[2];

599 
tmp_»s
[
j
][
i
] = 
»suÉ
;

603 
j
 = 0; j < 
block_size_y
; j++)

605 
Üig_lše
 = 
block
[
j
];

606 
tmp_lše
 = 
tmp_»s
[
j
];

607 
x0
 = 
tmp_»s
[
j
];

608 
x1
 = 
x0
 + 1;

609 
x2
 = 
x1
 + 1;

610 
x3
 = 
x2
 + 1;

611 
x4
 = 
x3
 + 1;

612 
x5
 = 
x4
 + 1;

614 
i
 = 0; i < 
block_size_x
; i++)

616 
»suÉ
 = (*(
x0
++è+ *(
x5
++)è* 
COEF
[0]

617 + (*(
x1
++è+ *(
x4
++)è* 
COEF
[1]

618 + (*(
x2
++è+ *(
x3
++)è* 
COEF
[2];

620 *(
Üig_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
 + 512)>>10));

624 ià((
dx
&1) == 1)

626 
j
 = 0; j < 
block_size_y
; j++)

628 
tmp_lše
 = &
tmp_»s
[
j
][2 + (
dx
>>1)];

629 
Üig_lše
 = 
block
[
j
];

630 
i
 = 0; i < 
block_size_x
; i++)

632 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((*(
tmp_lše
++) + 16)>>5)) + 1)>> 1);

633 
Üig_lše
++;

640 
tmp_pos
 = 
x_pos
 - 2;

641 
i
 = 0; i < 
block_size_x
; i++)

643 
os_m2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

644 
os_m1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

645 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

646 
os_p1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

647 
os_p2
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

648 
os_p3
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
 );

649 
tmp_pos
 -= 4;

651 
j
 = 0; j < 
block_size_y
; j++)

653 
cur_lšeY
 = 
cur_imgY
[
	`iCl3
(0,
maxÞd_y
,(
dy
 =ð1 ? 
y_pos
+
j
 : y_pos+j+1))];

655 
»suÉ
 = (
cur_lšeY
[
os_m2
] + cur_lšeY[
os_p3
]è* 
COEF
[0];

656 
»suÉ
 +ð(
cur_lšeY
[
os_m1
] + cur_lšeY[
os_p2
]è* 
COEF
[1];

657 
»suÉ
 +ð(
cur_lšeY
[
os
 ] + cur_lšeY[
os_p1
]è* 
COEF
[2];

659 
block
[
j
][
i
] = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
+16)>>5));

663 
tmp_pos
 = 
y_pos
 - 2;

664 
j
 = 0; j < 
block_size_y
; j++)

666 
p0
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

667 
p1
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

668 
p2
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

669 
p3
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

670 
p4
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
++)];

671 
p5
 = 
cur_imgY
[
	`iCl3
(0, 
maxÞd_y
, 
tmp_pos
 )];

673 
tmp_pos
 -= 4;

674 
Üig_lše
 = 
block
[
j
];

676 
i
 = 0; i < 
block_size_x
; i++)

678 
´es_x
 = 
dx
 =ð1 ? 
x_pos
+
i
 : x_pos+i+1;

679 
´es_x
 = 
	`iCl3
(0, 
maxÞd_x
,…res_x);

681 
»suÉ
 = (
p0
[
´es_x
] + 
p5
[´es_x]è* 
COEF
[0];

682 
»suÉ
 +ð(
p1
[
´es_x
] + 
p4
[´es_x]è* 
COEF
[1];

683 
»suÉ
 +ð(
p2
[
´es_x
] + 
p3
[´es_x]è* 
COEF
[2];

685 *
Üig_lše
 = (
img³l
è((*Üig_lš+ 
	`iCl1
(
max_img³l_v®ue
, ((
»suÉ
+16)>>5)) + 1 ) >> 1);

686 
Üig_lše
++;

692 
	}
}

694 
	$g‘_block_chroma
(
Maüoblock
 *
cu¼MB
, 
decod”
, 
uv
, 
StÜabËPiùu»
* 
dec_piùu»
, StÜabËPiùu» *
cu¼_»f
, 
x_pos
, 
y_pos
, 
block_size_x
, 
block_size_y
, 
img³l
 
block
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE])

696 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

697 
sub³l_x
 = 
p_Vid
->
mb_ü_size_x
 == 8 ? 7 : 3;

698 
sub³l_y
 = 
p_Vid
->
mb_ü_size_y
 == 8 ? 7 : 3;

699 
shiá³l_x
 = 
p_Vid
->
mb_ü_size_x
 == 8 ? 3 : 2;

700 
shiá³l_y
 = 
p_Vid
->
mb_ü_size_y
 == 8 ? 3 : 2;

701 
tÙ®_sÿË
 = 
shiá³l_x
 + 
shiá³l_y
;

703 
dx
 = (
x_pos
 & 
sub³l_x
);

704 
dy
 = (
y_pos
 & 
sub³l_y
);

705 
dxcur
 = (
sub³l_x
 + 1 - 
dx
);

706 
dycur
 = (
sub³l_y
 + 1 - 
dy
);

708 
w00
 = 
dxcur
 * 
dycur
;

709 
w01
 = 
dxcur
 * 
dy
;

710 
w10
 = 
dx
 * 
dycur
;

711 
w11
 = 
dx
 * 
dy
;

713 
i
, 
j
;

714 
maxÞd_x
 = 
dec_piùu»
->
size_x_ü
 - 1;

715 
maxÞd_y
 = (
cu¼MB
->
mb_f›ld
è? (
dec_piùu»
->
size_y_ü
 >> 1) - 1 : dec_picture->size_y_cr - 1;

716 
»suÉ
;

718 
img³l
 **
cur_img
, *
blk_lše
;

719 
img³l
 *
cur_lše
, *
cur_lše_p1
;

720 
tmp_pos
;

721 
os
, 
os_p1
;

722 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

724 
cur_img
 = 
cu¼_»f
->
de_mem
->
p_dec_img
[
uv
+1][
decod”
];

726 
x_pos
 = x_po >> 
shiá³l_x
;

727 
y_pos
 = y_po >> 
shiá³l_y
;

729 ià((
y_pos
 >ð0è&& (y_po < 
maxÞd_y
 - 
block_size_y
è&& (
x_pos
 >ð0è&& (x_po < 
maxÞd_x
 - 
block_size_x
))

731 ià(
dx
 =ð0 && 
dy
 == 0)

733 
j
 = 0; j < 
block_size_y
; j++)

735 
	`memýy
(&(
block
[
j
][0]), &(
cur_img
[ 
y_pos
 + j ][
x_pos
]), 
block_size_x
 * (
img³l
));

738 ià(
dx
 == 0)

740 
j
 = 0; j < 
block_size_y
; j++)

742 
cur_lše
 = &
cur_img
[
y_pos
 + 
j
 ][
x_pos
];

743 
cur_lše_p1
 = &
cur_img
[
y_pos
 + 
j
 + 1][
x_pos
];

744 
blk_lše
 = 
block
[
j
];

746 
i
 = 0; i < 
block_size_x
; i++)

748 
»suÉ
 = (
w00
 * *
cur_lše
++ + 
w01
 * *
cur_lše_p1
++);

749 *(
blk_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

753 ià(
dy
 == 0)

755 
j
 = 0; j < 
block_size_y
; j++)

757 
cur_lše
 = &
cur_img
[
y_pos
 + 
j
][
x_pos
];

758 
cur_lše_p1
 = 
cur_lše
 + 1;

759 
blk_lše
 = 
block
[
j
];

761 
i
 = 0; i < 
block_size_x
; i++)

763 
»suÉ
 = (
w00
 * *
cur_lše
++ + 
w10
 * *
cur_lše_p1
++);

764 *(
blk_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

770 
j
 = 0; j < 
block_size_y
; j++)

772 
cur_lše
 = &
cur_img
[
y_pos
 + 
j
 ][
x_pos
];

773 
cur_lše_p1
 = &
cur_img
[
y_pos
 + 
j
 + 1][
x_pos
];

774 
blk_lše
 = 
block
[
j
];

776 
i
 = 0; i < 
block_size_x
; i++)

778 
»suÉ
 = (
w00
 * *(
cur_lše
++è+ 
w01
 * *(
cur_lše_p1
++));

779 
»suÉ
 +ð(
w10
 * *(
cur_lše
 ) + 
w11
 * *(
cur_lše_p1
 ));

780 *(
blk_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

787 ià(
dx
 =ð0 && 
dy
 == 0)

789 
j
 = 0; j < 
block_size_y
; j++)

791 
cur_lše
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
)];

792 
blk_lše
 = 
block
[
j
];

793 
i
 = 0; i < 
block_size_x
; i++)

795 *(
blk_lše
++èð
cur_lše
[
	`iCl3
(0, 
maxÞd_x
, 
x_pos
 + 
i
 )];

799 ià(
dx
 == 0)

801 
j
 = 0; j < 
block_size_y
; j++)

803 
cur_lše
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
)];

804 
cur_lše_p1
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
 + 1)];

805 
tmp_pos
 = 
x_pos
;

806 
blk_lše
 = 
block
[
j
];

808 
i
 = 0; i < 
block_size_x
; i++)

810 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

812 
»suÉ
 = (
w00
 * 
cur_lše
[
os
] + 
w01
 * 
cur_lše_p1
[ipos]);

813 *(
blk_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

817 ià(
dy
 == 0)

819 
j
 = 0; j < 
block_size_y
; j++)

821 
cur_lše
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
)];

822 
tmp_pos
 = 
x_pos
;

823 
blk_lše
 = 
block
[
j
];

825 
i
 = 0; i < 
block_size_x
; i++)

827 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

828 
os_p1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
 );

830 
»suÉ
 = (
w00
 * 
cur_lše
[
os
 ] + 
w10
 * cur_lše[
os_p1
]);

831 *(
blk_lše
++èð(
img³l
)
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

837 
j
 = 0; j < 
block_size_y
; j++)

839 
cur_lše
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
)];

840 
cur_lše_p1
 = 
cur_img
[
	`iCl3
(0, 
maxÞd_y
, 
y_pos
 + 
j
 + 1)];

841 
tmp_pos
 = 
x_pos
;

842 
blk_lše
 = 
block
[
j
];

844 
i
 = 0; i < 
block_size_x
; i++)

846 
os
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
++);

847 
os_p1
 = 
	`iCl3
(0, 
maxÞd_x
, 
tmp_pos
 );

849 
»suÉ
 = (

850 
w00
 * 
cur_lše
 [
os
 ] +

851 
w10
 * 
cur_lše
 [
os_p1
] +

852 
w01
 * 
cur_lše_p1
[
os
 ] +

853 
w11
 * 
cur_lše_p1
[
os_p1
]);

854 *(
blk_lše
++èð(
img³l
è
	`iCl1
(
max_img³l_v®ue
, 
	`rshiá_ºd_sf
(
»suÉ
, 
tÙ®_sÿË
));

859 
	}
}

862 
	$šŒa_ü_decodšg
(
Maüoblock
 *
cu¼MB
, 
yuv
, 
smb
)

864 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

865 
img³l
 **
curUV
, *
cur_img
;

866 (*
m7UV
)[16], *
m7
;

867 
uv
;

868 
b8
,
b4
;

869 
ioff
, 
joff
, 
ii
, 
jj
;

871 
uv
 = 0; uv < 2; uv++)

873 
BoÞ—n
 
los¦ess_qµrime
 = (BoÞ—nè((
p_Vid
->
los¦ess_qµrime_æag
 =ð1è&&(Õ_Vid->
qp
 + 
dec_piùu»
->
chroma_qp_off£t
[
uv
] +…_Vid->
b™d•th_chroma_qp_sÿË
) == 0));

874 
™¿ns_4x4
 = (!
los¦ess_qµrime
è? 
™¿ns4x4
 : 
™¿ns4x4_ls
;

876 
curUV
 = 
dec_piùu»
->
imgUV
[
uv
];

877 
m7UV
 = 
p_Vid
->
cu¼’tSliû
->
mb_¼es
[
uv
+1];

878 
	`šŒ­»d_chroma
(
cu¼MB
, 
uv
);

880 ià(!
smb
 && (
cu¼MB
->
cbp
 >> 4))

882 
b8
 = 0; b8 < (
p_Vid
->
num_uv_blocks
); b8++)

884 
b4
 = 0; b4 < 4; b4++)

886 
joff
 = 
subblk_off£t_y
[
yuv
][
b8
][
b4
];

887 
ioff
 = 
subblk_off£t_x
[
yuv
][
b8
][
b4
];

889 
	`™¿ns_4x4
(
p_Vid
, (
CÞÜPÏÃ
è(
uv
 + 1), 
ioff
, 
joff
);

891 
jj
=
joff
; jj<joff + 4;jj++)

893 
cur_img
 = &
curUV
[
cu¼MB
->
pix_c_y
 + 
jj
][cu¼MB->
pix_c_x
 + 
ioff
];

894 
m7
 = &
m7UV
[
jj
][
ioff
];

896 
ii
=0; ii<4;ii++)

898 *
cur_img
++ = (
img³l
è*
m7
++;

904 ià((
cu¼MB
->
cbp
 >> 4) == 0)

906 
b8
 = 0; b8 < (
p_Vid
->
num_uv_blocks
); b8++)

908 
b4
 = 0; b4 < 4; b4++)

910 
joff
 = 
subblk_off£t_y
[
yuv
][
b8
][
b4
];

911 
ioff
 = 
subblk_off£t_x
[
yuv
][
b8
][
b4
];

913 
jj
 = 
joff
; jj < 4 + joff;jj++)

914 
	`memýy
(&(
curUV
[
cu¼MB
->
pix_c_y
 + 
jj
][cu¼MB->
pix_c_x
 + 
ioff
]), &(
p_Vid
->
cu¼’tSliû
->
mb_´ed
[
uv
 + 1][jj][ioff]), 
BLOCK_SIZE
 * (
img³l
));

920 
	`™¿ns_¥_ü
(
p_Vid
, 
uv
);

922 
joff
 = 0; joff < 8; joff += 4)

924 
ioff
 = 0; ioff < 8;ioff+=4)

926 
	`™¿ns_4x4
(
p_Vid
, (
CÞÜPÏÃ
è(
uv
 + 1), 
ioff
, 
joff
);

928 
jj
 = 
joff
; jj < joff + 4; jj++)

929 
ii
 = 
ioff
; ii < ioff + 4; ii++)

931 
curUV
[
cu¼MB
->
pix_c_y
+
jj
][
ii
 + cu¼MB->
pix_c_x
] = (
img³l
è
p_Vid
->
cu¼’tSliû
->
mb_¼es
[
uv
+1][jj][ii];

937 
	}
}

939 
	$´•¬e_dœeù_·¿ms
(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
dec_piùu»
, 
MÙiÚVeùÜ
 *
pmvl0
, MÙiÚVeùÜ *
pmvl1
, *
l0_rF¿me
, *
l1_rF¿me
)

941 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

942 
l0_rF¿meL
, 
l0_rF¿meU
, 
l0_rF¿meUR
;

943 
l1_rF¿meL
, 
l1_rF¿meU
, 
l1_rF¿meUR
;

944 
PicMÙiÚP¬amsOld
 *
mÙiÚ
 = &
dec_piùu»
->motion;

946 
Pix–Pos
 
mb
[4];

948 
	`g‘_ÃighbÜs
(
cu¼MB
, 
mb
, 0, 0, 16);

950 ià(!
p_Vid
->
mb_aff_äame_æag
)

952 
l0_rF¿meL
 = (è(
mb
[0].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
] : -1);

953 
l0_rF¿meU
 = (è(
mb
[1].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] : -1);

954 
l0_rF¿meUR
 = (è(
mb
[2].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] : -1);

956 
l1_rF¿meL
 = (è(
mb
[0].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] : -1);

957 
l1_rF¿meU
 = (è(
mb
[1].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] : -1);

958 
l1_rF¿meUR
 = (è(
mb
[2].
avažabË
 ? 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] : -1);

962 ià(
cu¼MB
->
mb_f›ld
)

964 
l0_rF¿meL
 = (è(
mb
[0].
avažabË


965 ? 
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
] < 0

966 ? 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
]

967 : 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
] * 2: -1);

969 
l0_rF¿meU
 = (è(
mb
[1].
avažabË


970 ? 
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] < 0

971 ? 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
]

972 : 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] * 2: -1);

974 
l0_rF¿meUR
 = (è(
mb
[2].
avažabË


975 ? 
p_Vid
->
mb_d©a
[
mb
[2].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] < 0

976 ? 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
]

977 : 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] * 2: -1);

979 
l1_rF¿meL
 = (è(
mb
[0].
avažabË


980 ? 
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] < 0

981 ? 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
]

982 : 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] * 2: -1);

984 
l1_rF¿meU
 = (è(
mb
[1].
avažabË


985 ? 
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] < 0

986 ? 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
]

987 : 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] * 2: -1);

989 
l1_rF¿meUR
 = (è(
mb
[2].
avažabË


990 ? 
p_Vid
->
mb_d©a
[
mb
[2].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] < 0

991 ? 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
]

992 : 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] * 2: -1);

996 
l0_rF¿meL
 = (è(
mb
[0].
avažabË


997 ? 
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
] < 0

998 ? 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
] >> 1

999 : 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
]: -1);

1001 
l0_rF¿meU
 = (è(
mb
[1].
avažabË


1002 ? 
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] < 0

1003 ? 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] >> 1

1004 : 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
] : -1);

1006 
l0_rF¿meUR
 = (è(
mb
[2].
avažabË


1007 ? 
p_Vid
->
mb_d©a
[
mb
[2].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] < 0

1008 ? 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] >> 1

1009 : 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_0
] : -1);

1011 
l1_rF¿meL
 = (è(
mb
[0].
avažabË


1012 ? 
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] < 0

1013 ? 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] >> 1

1014 : 
dec_piùu»
->
mv_šfo
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_1
] : -1);

1016 
l1_rF¿meU
 = (è(
mb
[1].
avažabË


1017 ? 
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] < 0

1018 ? 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] >> 1

1019 : 
dec_piùu»
->
mv_šfo
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_1
] : -1);

1021 
l1_rF¿meUR
 = (è(
mb
[2].
avažabË


1022 ? 
p_Vid
->
mb_d©a
[
mb
[2].
mb_addr
].
mb_f›ld
 || 
dec_piùu»
->
mv_šfo
[mb[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] < 0

1023 ? 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] >> 1

1024 : 
dec_piùu»
->
mv_šfo
[
mb
[2].
pos_y
][mb[2].
pos_x
].
»f_idx
[
LIST_1
] : -1);

1028 *
l0_rF¿me
 = (è((
l0_rF¿meL
 >ð0 && 
l0_rF¿meU
 >ð0è? 
	`imš
Ö0_rF¿meL,l0_rF¿meUè: 
	`imax
(l0_rFrameL,l0_rFrameU));

1029 *
l0_rF¿me
 = (è((*l0_rF¿m>ð0 && 
l0_rF¿meUR
 >ð0è? 
	`imš
(*l0_rF¿me,l0_rF¿meUR): 
	`imax
(*l0_rFrame,l0_rFrameUR));

1031 *
l1_rF¿me
 = (è((
l1_rF¿meL
 >ð0 && 
l1_rF¿meU
 >ð0è? 
	`imš
Ö1_rF¿meL,l1_rF¿meUè: 
	`imax
(l1_rFrameL,l1_rFrameU));

1032 *
l1_rF¿me
 = (è((*l1_rF¿m>ð0 && 
l1_rF¿meUR
 >ð0è? 
	`imš
(*l1_rF¿me,l1_rF¿meUR): 
	`imax
(*l1_rFrame,l1_rFrameUR));

1034 ià(*
l0_rF¿me
 >=0)

1035 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, 
pmvl0
, *
l0_rF¿me
, 
dec_piùu»
->
mv_šfo
, 
LIST_0
, 0, 0, 16, 16);

1037 ià(*
l1_rF¿me
 >=0)

1038 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, 
pmvl1
, *
l1_rF¿me
, 
dec_piùu»
->
mv_šfo
, 
LIST_1
, 0, 0, 16, 16);

1039 
	}
}

1042 
	$check_mÙiÚ_veùÜ_¿nge
(
VideoP¬am‘”s
 *
p_Vid
, cÚ¡ 
MÙiÚVeùÜ
 *
mv
)

1044 ià(
mv
->
mv_x
 > 8191 || mv->mv_x < -8192)

1046 
	`årštf
(
¡d”r
,"WARNING! HÜizÚÈmÙiÚ veùÜ %d i ouˆoà®lowed„ªg{-8192, 8191} iÀpiùu» %d, maüoblock %d\n", 
mv
->
mv_x
, 
p_Vid
->
numb”
,…_Vid->
cu¼’t_mb_Ä
);

1050 ià(
mv
->
mv_y
 > (
p_Vid
->
max_mb_vmv_r
 - 1) || mv->mv_y < (-p_Vid->max_mb_vmv_r))

1052 
	`årštf
(
¡d”r
,"WARNING! V”tiÿÈmÙiÚ veùÜ %d i ouˆoà®lowed„ªg{%d, %d} iÀpiùu» %d, maüoblock %d\n", 
mv
->
mv_y
, (-
p_Vid
->
max_mb_vmv_r
), (p_Vid->max_mb_vmv_¸- 1),…_Vid->
numb”
,…_Vid->
cu¼’t_mb_Ä
);

1055 
	}
}

1059 
	$³rfÜm_mc
(
Maüoblock
* 
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
 *
dec_piùu»
, 
´ed_dœ
, 
l0_mode
, 
l1_mode
,

1060 
PicMÙiÚP¬ams
 **
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
, 
b»d_me
)

1062 
img³l
 
tmp_block_l0
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE];

1063 
img³l
 
tmp_block_l1
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE];

1065 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1066 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1068 
vec1_x
=0, 
vec1_y
=0;

1069 
vec2_x
=0, 
vec2_y
=0;

1071 
®pha_l0
, 
®pha_l1
, 
wp_off
;

1072 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

1073 
­¶y_weights
 = ( (
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
 && (
cu¼Sliû
->
¦iû_ty³
=ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
)) ||

1074 (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 && (
cu¼Sliû
->
¦iû_ty³
=ð
B_SLICE
)));

1075 cÚ¡ 
mv_mul
 = 16;

1077 
i4
 = 
cu¼MB
->
block_x
 + 
i
;

1078 
j4
 = 
cu¼MB
->
block_y
 + 
j
;

1079 
ioff
 = (
i
 << 2);

1080 
joff
 = (
j
 << 2);

1082 
	`as£¹
 (
´ed_dœ
<=2);

1084 ià(
´ed_dœ
 != 2)

1087 
»f_idx
 = 
mv_šfo
[
j4
][
i4
].»f_idx[
´ed_dœ
];

1088 
»f_idx_wp
 = 
»f_idx
;

1089 
MÙiÚVeùÜ
 **
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
[
´ed_dœ
][
»f_idx
][
l0_mode
];

1090 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
 + 
´ed_dœ
];

1092 
vec1_x
 = 
i4
 * 
mv_mul
 + 
mv_¬¿y
[
j
][
i
].
mv_x
;

1093 
vec1_y
 = 
j4
 * 
mv_mul
 + 
mv_¬¿y
[
j
][
i
].
mv_y
;

1095 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
li¡
[
»f_idx
], 
vec1_x
, 
vec1_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l0
);

1097 ià(
­¶y_weights
)

1099 ià(
cu¼MB
->
mb_f›ld
)

1101 
»f_idx_wp
 >>=1;

1103 
®pha_l0
 = 
cu¼Sliû
->
wp_weight
[
´ed_dœ
][
»f_idx_wp
][0];

1104 
wp_off
 = 
cu¼Sliû
->
wp_off£t
[
´ed_dœ
][
»f_idx_wp
][0];

1106 
	`weigh‹d_mc_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
block_size_y
, 
block_size_x
, 
ioff
, 
tmp_block_l0
, 
®pha_l0
, 
wp_off
, 
cu¼Sliû
->
luma_log_weight_d’om
, 
max_img³l_v®ue
);

1110 
	`mc_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
block_size_y
, 
block_size_x
, 
ioff
, 
tmp_block_l0
);

1114 ià((
dec_piùu»
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (dec_piùu»->chroma_fÜm©_idø!ð
YUV444
) )

1116 
uv
;

1118 
ioff_ü
 = (
p_Vid
->
mb_ü_size_x
 =ð
MB_BLOCK_SIZE
è? 
ioff
 : ioff >> 1;

1119 
joff_ü
 = (
p_Vid
->
mb_ü_size_y
 =ð
MB_BLOCK_SIZE
è? 
joff
 : joff >> 1;

1120 
block_size_x_ü
 = 
p_Vid
->
mb_ü_size_x
 =ð
MB_BLOCK_SIZE
 ? 
block_size_x
 : block_size_x >> 1;

1121 
block_size_y_ü
 = 
p_Vid
->
mb_ü_size_y
 =ð
MB_BLOCK_SIZE
 ? 
block_size_y
 : block_size_y >> 1;

1123 
vec1_y_ü
 = 
vec1_y
 + ((
aùive_¥s
->
chroma_fÜm©_idc
 =ð1)? 
li¡
[
»f_idx
]->
chroma_veùÜ_adju¡m’t
 : 0);

1125 
uv
=0;uv<2;uv++)

1127 
	`g‘_block_chroma
 (
cu¼MB
, 
uv
, 
li¡
[
»f_idx
], 
vec1_x
, 
vec1_y_ü
, 
block_size_x_ü
, 
block_size_y_ü
, 
tmp_block_l0
);

1129 ià(
p_Vid
->
­¶y_weights
)

1131 
®pha_l0
 = 
p_Vid
->
wp_weight
[
´ed_dœ
][
»f_idx_wp
][
uv
 + 1];

1132 
wp_off£t
 = 
p_Vid
->wp_off£t[
´ed_dœ
][
»f_idx_wp
][
uv
 + 1];

1134 
	`weigh‹d_mc_´ediùiÚ
(&
cu¼Sliû
->
mb_´ed
[
uv
 + 1][
joff_ü
], 
block_size_y_ü
, 
block_size_x_ü
, 
ioff_ü
, 
tmp_block_l0
, 
®pha_l0
, 
wp_off£t
, 
p_Vid
->
chroma_log2_weight_d’om
,…_Vid->
max_³l_v®ue_comp
[uv + 1]);

1138 
	`mc_´ediùiÚ
(&
cu¼Sliû
->
mb_´ed
[
uv
 + 1][
joff_ü
], 
block_size_y_ü
, 
block_size_x_ü
, 
ioff_ü
, 
tmp_block_l0
);

1147 
l0_»f
 = 
mv_šfo
[
j4
][
i4
].
»f_idx
[
LIST_0
];

1148 
l1_»f
 = 
mv_šfo
[
j4
][
i4
].
»f_idx
[
LIST_1
];

1150 
MÙiÚVeùÜ
 **
l0_mv_¬¿y
 = (
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[b»d_me-1][
LIST_0
][
l0_»f
][
l0_mode
]:cu¼Sliû->
®l_mv
[LIST_0][l0_ref][l0_mode]);

1151 
MÙiÚVeùÜ
 **
l1_mv_¬¿y
 = (
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[b»d_me-1][
LIST_1
][
l1_»f
][
l1_mode
]:cu¼Sliû->
®l_mv
[LIST_1][l1_ref][l1_mode]);

1153 
vec1_x
 = 
i4
 * 
mv_mul
 + 
l0_mv_¬¿y
[
j
][
i
].
mv_x
;

1154 
vec2_x
 = 
i4
 * 
mv_mul
 + 
l1_mv_¬¿y
[
j
][
i
].
mv_x
;

1156 
vec1_y
 = 
j4
 * 
mv_mul
 + 
l0_mv_¬¿y
[
j
][
i
].
mv_y
;

1157 
vec2_y
 = 
j4
 * 
mv_mul
 + 
l1_mv_¬¿y
[
j
][
i
].
mv_y
;

1159 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + cu¼MB->
li¡_off£t
][
l0_»f
], 
vec1_x
, 
vec1_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l0
);

1160 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + cu¼MB->
li¡_off£t
][
l1_»f
], 
vec2_x
, 
vec2_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l1
);

1162 if(
­¶y_weights
)

1164 
wt_li¡_off£t
 = (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
==2)? 
cu¼MB
->
li¡_off£t
 : 0;

1168 ià(
cu¼MB
->
mb_f›ld
)

1170 
l0_»f
 >>=1;

1171 
l1_»f
 >>=1;

1174 
®pha_l0
 = 
cu¼Sliû
->
wbp_weight
[
LIST_0
 + 
wt_li¡_off£t
][
l0_»f
][
l1_»f
][0];

1175 
®pha_l1
 = 
cu¼Sliû
->
wbp_weight
[
LIST_1
 + 
wt_li¡_off£t
][
l0_»f
][
l1_»f
][0];

1176 
wp_off
 = ((
cu¼Sliû
->
wp_off£t
 [
LIST_0
 + 
wt_li¡_off£t
][
l0_»f
][0] + cu¼Sliû->wp_off£t[
LIST_1
 + wt_li¡_off£t][
l1_»f
][0] + 1) >>1);

1178 
	`weigh‹d_bi_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y
, 
block_size_x
, 
ioff
, 
®pha_l0
, 
®pha_l1
, 
wp_off
, (
cu¼Sliû
->
luma_log_weight_d’om
 + 1), 
max_img³l_v®ue
);

1182 
	`bi_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y
, 
block_size_x
, 
ioff
);

1185 ià((
dec_piùu»
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (dec_piùu»->chroma_fÜm©_idø!ð
YUV444
) )

1187 
uv
;

1189 
ioff_ü
 = 
p_Vid
->
mb_ü_size_x
 =ð
MB_BLOCK_SIZE
 ? 
ioff
 : ioff >> 1;

1190 
joff_ü
 = 
p_Vid
->
mb_ü_size_y
 =ð
MB_BLOCK_SIZE
 ? 
joff
 : joff >> 1;

1191 
block_size_x_ü
 = 
p_Vid
->
mb_ü_size_x
 =ð
MB_BLOCK_SIZE
 ? 
block_size_x
 : block_size_x >> 1;

1192 
block_size_y_ü
 = 
p_Vid
->
mb_ü_size_y
 =ð
MB_BLOCK_SIZE
 ? 
block_size_y
 : block_size_y >> 1;

1194 
vec1_y_ü
 = 
vec1_y
 + ((
aùive_¥s
->
chroma_fÜm©_idc
 =ð1)? 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
l0_»fäame
]->
chroma_veùÜ_adju¡m’t
 : 0);

1195 
vec2_y_ü
 = 
vec2_y
 + ((
aùive_¥s
->
chroma_fÜm©_idc
 =ð1)? 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
li¡_off£t
][
l1_»fäame
]->
chroma_veùÜ_adju¡m’t
 : 0);

1197 
uv
=0;uv<2;uv++)

1199 
	`g‘_block_chroma
 (
cu¼MB
, 
uv
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
l0_»fäame
], 
vec1_x
, 
vec1_y_ü
, 
block_size_x_ü
, 
block_size_y_ü
, 
tmp_block_l0
);

1200 
	`g‘_block_chroma
 (
cu¼MB
, 
uv
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
li¡_off£t
][
l1_»fäame
], 
vec2_x
, 
vec2_y_ü
, 
block_size_x_ü
, 
block_size_y_ü
, 
tmp_block_l1
);

1202 if(
p_Vid
->
­¶y_weights
)

1204 
wt_li¡_off£t
 = (
aùive_µs
->
weigh‹d_b»d_idc
==2)? 
li¡_off£t
 : 0;

1206 
®pha_l0
 = 
p_Vid
->
wbp_weight
[
LIST_0
 + 
wt_li¡_off£t
][
l0_»f_idx
][
l1_»f_idx
][
uv
 + 1];

1207 
®pha_l1
 = 
p_Vid
->
wbp_weight
[
LIST_1
 + 
wt_li¡_off£t
][
l0_»f_idx
][
l1_»f_idx
][
uv
 + 1];

1208 
wp_off£t
 = ((
p_Vid
->wp_off£ˆ[
LIST_0
 + 
wt_li¡_off£t
][
l0_»f_idx
][
uv
 + 1] +…_Vid->wp_off£t[
LIST_1
 + wt_li¡_off£t][
l1_»f_idx
][uv + 1] + 1) >>1);

1210 
	`weigh‹d_bi_´ediùiÚ
(&
cu¼Sliû
->
mb_´ed
[
uv
+1][
joff_ü
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y_ü
, 
block_size_x_ü
, 
ioff_ü
, 
®pha_l0
, 
®pha_l1
, 
wp_off£t
, (
p_Vid
->
chroma_log2_weight_d’om
 + 1),…_Vid->
max_³l_v®ue_comp
[uv + 1]);

1214 
	`bi_´ediùiÚ
(&
p_Vid
->
cu¼’tSliû
->
mb_´ed
[
uv
 + 1][
joff_ü
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y_ü
, 
block_size_x_ü
, 
ioff_ü
);

1220 
	}
}

1222 
	$³rfÜm_mc_cÚû®m’t
(
Maüoblock
* 
cu¼MB
, 
decod”
, 
CÞÜPÏÃ
 
¶
, 
StÜabËPiùu»
 *
dec_piùu»
, 
´ed_dœ
, 
l0_mode
, 
l1_mode
,

1223 
PicMÙiÚP¬ams
 **
mv_šfo
, 
i
, 
j
, 
block_size_x
, 
block_size_y
)

1225 
img³l
 
tmp_block_l0
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE];

1226 
img³l
 
tmp_block_l1
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE];

1228 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1229 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1231 
vec1_x
=0, 
vec1_y
=0;

1232 
vec2_x
=0, 
vec2_y
=0;

1234 
®pha_l0
, 
®pha_l1
, 
wp_off
;

1235 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

1236 
­¶y_weights
 = ( (
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
)) ||

1237 (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 && (
cu¼Sliû
->
¦iû_ty³
=ð
B_SLICE
)));

1238 cÚ¡ 
mv_mul
 = 16;

1240 
i4
 = 
cu¼MB
->
block_x
 + 
i
;

1241 
j4
 = 
cu¼MB
->
block_y
 + 
j
;

1242 
ioff
 = (
i
 << 2);

1243 
joff
 = (
j
 << 2);

1245 
	`as£¹
 (
´ed_dœ
<=2);

1247 ià(
´ed_dœ
 != 2)

1250 
»f_idx
 = 
mv_šfo
[
j4
][
i4
].»f_idx[
´ed_dœ
];

1251 
»f_idx_wp
 = 
»f_idx
;

1252 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
dec_piùu»
->
mv_šfo
;

1254 
StÜabËPiùu»
 **
li¡
 = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
 + 
´ed_dœ
];

1256 
vec1_x
 = 
i4
 * 
mv_mul
 + 
mÙiÚ
[
j4
][i4].
mv
[
´ed_dœ
].
mv_x
;

1258 
vec1_y
 = 
j4
 * 
mv_mul
 + 
mÙiÚ
[j4][
i4
].
mv
[
´ed_dœ
].
mv_y
;

1260 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
li¡
[
»f_idx
], 
vec1_x
, 
vec1_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l0
);

1262 ià(
­¶y_weights
)

1264 ià(
cu¼MB
->
mb_f›ld
)

1266 
»f_idx_wp
 >>=1;

1268 
®pha_l0
 = 
p_Vid
->
cu¼’tSliû
->
wp_weight
[
´ed_dœ
][
»f_idx_wp
][0];

1269 
wp_off
 = 
p_Vid
->
cu¼’tSliû
->
wp_off£t
[
´ed_dœ
][
»f_idx_wp
][0];

1271 
	`weigh‹d_mc_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
block_size_y
, 
block_size_x
, 
ioff
, 
tmp_block_l0
, 
®pha_l0
, 
wp_off
,…_Vid->
cu¼’tSliû
->
luma_log_weight_d’om
, 
max_img³l_v®ue
);

1275 
	`mc_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
block_size_y
, 
block_size_x
, 
ioff
, 
tmp_block_l0
);

1281 
l0_»f
 = 
mv_šfo
[
j4
][
i4
].
»f_idx
[
LIST_0
];

1282 
l1_»f
 = 
mv_šfo
[
j4
][
i4
].
»f_idx
[
LIST_1
];

1284 
vec1_x
 = 
i4
 * 
mv_mul
 + 
dec_piùu»
->
mv_šfo
[
j4
][i4].
mv
[
LIST_0
].
mv_x
;

1285 
vec2_x
 = 
i4
 * 
mv_mul
 + 
dec_piùu»
->
mv_šfo
[
j4
][i4].
mv
[
LIST_1
].
mv_x
;

1287 
vec1_y
 = 
j4
 * 
mv_mul
 + 
dec_piùu»
->
mv_šfo
[j4][
i4
].
mv
[
LIST_0
].
mv_y
;

1288 
vec2_y
 = 
j4
 * 
mv_mul
 + 
dec_piùu»
->
mv_šfo
[j4][
i4
].
mv
[
LIST_1
].
mv_y
;

1290 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + cu¼MB->
li¡_off£t
][
l0_»f
], 
vec1_x
, 
vec1_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l0
);

1291 
	`g‘_block_luma
 (
cu¼MB
, 
decod”
, 
¶
, 
dec_piùu»
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + cu¼MB->
li¡_off£t
][
l1_»f
], 
vec2_x
, 
vec2_y
, 
block_size_x
, 
block_size_y
, 
tmp_block_l1
);

1293 if(
­¶y_weights
)

1295 
wt_li¡_off£t
 = (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
==2)? 
cu¼MB
->
li¡_off£t
 : 0;

1299 ià(
cu¼MB
->
mb_f›ld
)

1301 
l0_»f
 >>=1;

1302 
l1_»f
 >>=1;

1305 
®pha_l0
 = 
p_Vid
->
cu¼’tSliû
->
wbp_weight
[
LIST_0
 + 
wt_li¡_off£t
][
l0_»f
][
l1_»f
][0];

1306 
®pha_l1
 = 
p_Vid
->
cu¼’tSliû
->
wbp_weight
[
LIST_1
 + 
wt_li¡_off£t
][
l0_»f
][
l1_»f
][0];

1307 
wp_off
 = ((
p_Vid
->
cu¼’tSliû
->
wp_off£t
 [
LIST_0
 + 
wt_li¡_off£t
][
l0_»f
][0] +…_Vid->cu¼’tSliû->wp_off£t[
LIST_1
 + wt_li¡_off£t][
l1_»f
][0] + 1) >>1);

1309 
	`weigh‹d_bi_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y
, 
block_size_x
, 
ioff
, 
®pha_l0
, 
®pha_l1
, 
wp_off
, (p_Vid->
cu¼’tSliû
->
luma_log_weight_d’om
 + 1), 
max_img³l_v®ue
);

1313 
	`bi_´ediùiÚ
(&
p_Vid
->
p_decs
->
dec_mb_´ed
[
decod”
][
joff
], 
tmp_block_l0
, 
tmp_block_l1
, 
block_size_y
, 
block_size_x
, 
ioff
);

1316 
	}
}

	@lencod/src/loopFilter.c

23 
	~"glob®.h
"

24 
	~"image.h
"

25 
	~"mb_acûss.h
"

26 
	~"loÝ_fž‹r.h
"

28 
£t_loÝ_fž‹r_funùiÚs_mbaff
 (
VideoP¬am‘”s
 *
p_Vid
);

29 
£t_loÝ_fž‹r_funùiÚs_nÜm®
(
VideoP¬am‘”s
 *
p_Vid
);

31 
DeblockMb
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
imgY
, img³È***
imgUV
, 
MbQAddr
);

33 
	$š™_Deblock
(
VideoP¬am‘”s
 *
p_Vid
)

35 
i
;

36 ià(
p_Vid
->
mb_aff_äame_æag
 == 1)

38 
	`£t_loÝ_fž‹r_funùiÚs_mbaff
(
p_Vid
);

42 
	`£t_loÝ_fž‹r_funùiÚs_nÜm®
(
p_Vid
);

45 
i
=0; i < 
p_Vid
->
PicSizeInMbs
; i++)

47 ià(
p_Vid
->
mb_d©a
[
i
].
mb_ty³
==
IPCM
)

49 
p_Vid
->
mb_d©a
[
i
].
qp
 = 0;

50 
p_Vid
->
mb_d©a
[
i
].
qpc
[0] = 0;

51 
p_Vid
->
mb_d©a
[
i
].
qpc
[1] = 0;

54 
	}
}

56 #ià(
JM_PARALLEL_DEBLOCK
 == 0)

63 
	$DeblockF¿me
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
imgY
, img³È***
imgUV
)

65 
i
;

66 
	`š™_Deblock
(
p_Vid
);

67 
i
=0; i < 
p_Vid
->
PicSizeInMbs
; i++)

69 
	`DeblockMb
Ð
p_Vid
, 
imgY
, 
imgUV
, 
i
 ) ;

71 
	}
}

73 
	$DeblockP¬®Ël
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
imgY
, img³È***
imgUV
, 
cÞumn
, 
block
, 
n_Ï¡
)

75 
i
, 
j
;

77 
j
 = 0; j < 
GROUP_SIZE
; j++)

79 
i
 = 
block
++ * (
p_Vid
->
PicWidthInMbs
 - 2è+ 
cÞumn
;

81 
	`DeblockMb
Ð
p_Vid
, 
imgY
, 
imgUV
, 
i
 ) ;

82 ià(
block
 =ð
n_Ï¡
) ;

84 
	}
}

92 
	$DeblockF¿me
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
imgY
, img³È***
imgUV
)

94 
iheightMBs
 =(
p_Vid
->
PicSizeInMbs
/p_Vid->
PicWidthInMbs
);

95 
i
, 
k
 = 
p_Vid
->
PicWidthInMbs
 + 2 * (
iheightMBs
 - 1);

96 
	`š™_Deblock
(
p_Vid
);

98 
i
 = 0; i < 
k
; i++)

100 
Â
;

101 
n_Ï¡
 = 
	`imš
(
iheightMBs
, (
i
 >> 1) + 1);

102 
n_¡¬t
 = (
i
 < 
p_Vid
->
PicWidthInMbs
) ? 0 : ((i -…_Vid->PicWidthInMbs) >> 1) + 1;

104 #ià
	`defšed
(
OPENMP
)

105 #´agm¨
omp
 
·¿Î–
 

107 
Â
 = 
n_¡¬t
;‚À< 
n_Ï¡
;‚À+ð
GROUP_SIZE
)

108 
	`DeblockP¬®Ël
(
p_Vid
, 
imgY
, 
imgUV
, 
i
, 
Â
, 
n_Ï¡
);

110 
	}
}

120 
	$DeblockMb
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
imgY
, img³È***
imgUV
, 
MbQAddr
)

122 
edge
;

123 
by‹
 
SŒ’gth
[16];

125 
mb_x
, 
mb_y
;

127 
fž‹rNÚ8x8LumaEdgesFÏg
[4] = {1,1,1,1};

128 
fž‹rLeáMbEdgeFÏg
;

129 
fž‹rTÝMbEdgeFÏg
;

130 
edge_ü
;

131 
Maüoblock
 *
MbQ
 = &(
p_Vid
->
mb_d©a
[
MbQAddr
]) ;

132 
Sliû
 *
cu¼Sliû
 = 
MbQ
->
p_Sliû
;

133 
mvlim™
 = (
p_Vid
->
¡ruùu»
!=
FRAME
è|| (p_Vid->
mb_aff_äame_æag
 && 
MbQ
->
mb_f›ld
) ? 2 : 4;

134 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

135 
p_Vid
->
mixedModeEdgeFÏg
 = 0;

138 ià(
MbQ
->
DFDi§bËIdc
 == 1)

140 
MbQ
->
DeblockC®l
 = 0;

144 
MbQ
->
DeblockC®l
 = 1;

145 
	`g‘_mb_pos
 (
p_Vid
, 
MbQAddr
,…_Vid->
mb_size
[
IS_LUMA
], &
mb_x
, &
mb_y
);

147 ià(
MbQ
->
mb_ty³
 =ð
I8MB
)

148 
	`as£¹
(
MbQ
->
luma_ŒªsfÜm_size_8x8_æag
);

150 
fž‹rNÚ8x8LumaEdgesFÏg
[1] =

151 
fž‹rNÚ8x8LumaEdgesFÏg
[3] = !(
MbQ
->
luma_ŒªsfÜm_size_8x8_æag
);

153 
fž‹rLeáMbEdgeFÏg
 = (
mb_x
 != 0);

154 
fž‹rTÝMbEdgeFÏg
 = (
mb_y
 != 0);

156 ià(
p_Vid
->
mb_aff_äame_æag
 && 
mb_y
 =ð
MB_BLOCK_SIZE
 && 
MbQ
->
mb_f›ld
)

157 
fž‹rTÝMbEdgeFÏg
 = 0;

159 ià(
MbQ
->
DFDi§bËIdc
==2)

162 
fž‹rLeáMbEdgeFÏg
 = 
MbQ
->
mbAvažA
;

164 
fž‹rTÝMbEdgeFÏg
 = (
p_Vid
->
mb_aff_äame_æag
 && !
MbQ
->
mb_f›ld
 && (
MbQAddr
 & 0x01)è? 1 : MbQ->
mbAvažB
;

167 
	`CheckAvažabž™yOfNeighbÜs
(
MbQ
);

170 
edge
 = 0;ƒdge < 4 ; ++edge )

173 ià(
MbQ
->
cbp
 == 0)

175 ià(
fž‹rNÚ8x8LumaEdgesFÏg
[
edge
] =ð0 && 
aùive_¥s
->
chroma_fÜm©_idc
!=
YUV444
)

177 ià(
edge
 > 0 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
B_SLICE
))

179 ià((
MbQ
->
mb_ty³
 =ð0 && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
) || (MbQ->mb_type == 1) || (MbQ->mb_type == 2))

181 ià((
edge
 & 0x01è&& ((
MbQ
->
mb_ty³
 =ð3è|| (Ódg& 0x01è&& MbQ->mb_ty³ =ð0 && 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && 
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)))

186 ifÐ
edge
 || 
fž‹rLeáMbEdgeFÏg
 )

189 
p_Vid
->
	`G‘SŒ’gthV”
(
SŒ’gth
, 
MbQ
, 
edge
 << 2, 
mvlim™
);

191 iàÐ
SŒ’gth
[0] != 0 || Strength[1] != 0 || Strength[2] != 0 || Strength[3] !=0 ||

192 
SŒ’gth
[4] != 0 || Strength[5] != 0 || Strength[6] != 0 || Strength[7] !=0 ||

193 
SŒ’gth
[8] != 0 || Strength[9] != 0 || Strength[10] != 0 || Strength[11] !=0 ||

194 
SŒ’gth
[12] != 0 || Strength[13] != 0 || Strength[14] != 0 || Strength[15] !=0 )

196 ià(
fž‹rNÚ8x8LumaEdgesFÏg
[
edge
])

198 
p_Vid
->
	`EdgeLoÝLumaV”
Ð
PLANE_Y
, 
imgY
, 
SŒ’gth
, 
MbQ
, 
edge
 << 2) ;

199 ià(
p_Vid
->
P444_jošed
)

201 
p_Vid
->
	`EdgeLoÝLumaV”
(
PLANE_U
, 
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
edge
 << 2);

202 
p_Vid
->
	`EdgeLoÝLumaV”
(
PLANE_V
, 
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
edge
 << 2);

205 if(
p_Vid
->
yuv_fÜm©
==
YUV420
 ||…_Vid->yuv_fÜm©==
YUV422
 )

207 
edge_ü
 = 
chroma_edge
[0][
edge
][
p_Vid
->
yuv_fÜm©
];

208 ifÐ(
imgUV
 !ð
NULL
è&& (
edge_ü
 >= 0))

210 
p_Vid
->
	`EdgeLoÝChromaV”
Ð
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
edge_ü
, 0);

211 
p_Vid
->
	`EdgeLoÝChromaV”
Ð
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
edge_ü
, 1);

219  
edge
 = 0;ƒdge < 4 ; ++edge )

222 ià(
MbQ
->
cbp
 == 0)

224 ià(
fž‹rNÚ8x8LumaEdgesFÏg
[
edge
] =ð0 && 
aùive_¥s
->
chroma_fÜm©_idc
==
YUV420
)

226 ià(
edge
 > 0 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
B_SLICE
))

228 ià(((
MbQ
->
mb_ty³
 =ð
PSKIP
 && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (MbQ->mb_ty³ =ð
P16x16
è|| (MbQ->mb_ty³ =ð
P8x16
)))

230 ià((
edge
 & 0x01è&& (Ð
MbQ
->
mb_ty³
 =ð
P16x8
è|| (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && MbQ->mb_ty³ =ð
BSKIP_DIRECT
 && 
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)))

235 ifÐ
edge
 || 
fž‹rTÝMbEdgeFÏg
 )

238 
p_Vid
->
	`G‘SŒ’gthHÜ
(
SŒ’gth
, 
MbQ
, 
edge
 << 2, 
mvlim™
);

240 iàÐ
SŒ’gth
[0] != 0 || Strength[1] != 0 || Strength[2] != 0 || Strength[3] !=0 ||

241 
SŒ’gth
[4] != 0 || Strength[5] != 0 || Strength[6] != 0 || Strength[7] !=0 ||

242 
SŒ’gth
[8] != 0 || Strength[9] != 0 || Strength[10] != 0 || Strength[11] !=0 ||

243 
SŒ’gth
[12] != 0 || Strength[13] != 0 || Strength[14] != 0 || Strength[15] !=0 )

245 ià(
fž‹rNÚ8x8LumaEdgesFÏg
[
edge
])

247 
p_Vid
->
	`EdgeLoÝLumaHÜ
Ð
PLANE_Y
, 
imgY
, 
SŒ’gth
, 
MbQ
, 
edge
 << 2,…_Vid->
width_·dded
) ;

248 ià(
p_Vid
->
P444_jošed
)

250 
p_Vid
->
	`EdgeLoÝLumaHÜ
(
PLANE_U
, 
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
edge
 << 2,…_Vid->
width_·dded
);

251 
p_Vid
->
	`EdgeLoÝLumaHÜ
(
PLANE_V
, 
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
edge
 << 2,…_Vid->
width_·dded
);

254 if(
p_Vid
->
yuv_fÜm©
==
YUV420
 ||…_Vid->yuv_fÜm©==
YUV422
 )

256 
edge_ü
 = 
chroma_edge
[1][
edge
][
p_Vid
->
yuv_fÜm©
];

257 ifÐ(
imgUV
 !ð
NULL
è&& (
edge_ü
 >= 0))

259 
p_Vid
->
	`EdgeLoÝChromaHÜ
Ð
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
edge_ü
,…_Vid->
width_ü
 +…_Vid->
·d_size_uv_x
 * 2, 0);

260 
p_Vid
->
	`EdgeLoÝChromaHÜ
Ð
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
edge_ü
,…_Vid->
width_ü
 +…_Vid->
·d_size_uv_x
 * 2, 1);

265 ià(!
edge
 && !
MbQ
->
mb_f›ld
 && 
p_Vid
->
mixedModeEdgeFÏg
)

268 
MbQ
->
DeblockC®l
 = 2;

269 
p_Vid
->
	`G‘SŒ’gthHÜ
(
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
, 
mvlim™
);

272 ià(
fž‹rNÚ8x8LumaEdgesFÏg
[
edge
])

274 
p_Vid
->
	`EdgeLoÝLumaHÜ
Ð
PLANE_Y
, 
imgY
, 
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
,…_Vid->
width_·dded
) ;

275 ià(
p_Vid
->
P444_jošed
)

277 
p_Vid
->
	`EdgeLoÝLumaHÜ
(
PLANE_U
, 
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
,…_Vid->
width_·dded
) ;

278 
p_Vid
->
	`EdgeLoÝLumaHÜ
(
PLANE_V
, 
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
,…_Vid->
width_·dded
) ;

281 ifÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 ||…_Vid->yuv_fÜm©==
YUV422
 )

283 
edge_ü
 = 
chroma_edge
[1][
edge
][
p_Vid
->
yuv_fÜm©
];

284 ifÐ(
imgUV
 !ð
NULL
è&& (
edge_ü
 >= 0))

286 
p_Vid
->
	`EdgeLoÝChromaHÜ
Ð
imgUV
[0], 
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
,…_Vid->
width_ü
+p_Vid->
·d_size_uv_x
*2, 0) ;

287 
p_Vid
->
	`EdgeLoÝChromaHÜ
Ð
imgUV
[1], 
SŒ’gth
, 
MbQ
, 
MB_BLOCK_SIZE
,…_Vid->
width_ü
+p_Vid->
·d_size_uv_x
*2, 1) ;

291 
MbQ
->
DeblockC®l
 = 1;

296 
MbQ
->
DeblockC®l
 = 0;

297 
	}
}

	@lencod/src/loop_filter_mbaff.c

23 
	~"glob®.h
"

24 
	~"image.h
"

25 
	~"mb_acûss.h
"

26 
	~"loÝ_fž‹r.h
"

30 
g‘_¡»ngth_v”_MBAff
 (
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
);

31 
g‘_¡»ngth_hÜ_MBAff
 (
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
);

32 
edge_loÝ_luma_v”_MBAff
 (
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
);

33 
edge_loÝ_luma_hÜ_MBAff
 (
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
width
);

34 
edge_loÝ_chroma_v”_MBAff
 (
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
uv
);

35 
edge_loÝ_chroma_hÜ_MBAff
 (
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
width
, 
uv
);

38 
	$£t_loÝ_fž‹r_funùiÚs_mbaff
(
VideoP¬am‘”s
 *
p_Vid
)

40 
p_Vid
->
G‘SŒ’gthV”
 = 
g‘_¡»ngth_v”_MBAff
;

41 
p_Vid
->
G‘SŒ’gthHÜ
 = 
g‘_¡»ngth_hÜ_MBAff
;

42 
p_Vid
->
EdgeLoÝLumaV”
 = 
edge_loÝ_luma_v”_MBAff
;

43 
p_Vid
->
EdgeLoÝLumaHÜ
 = 
edge_loÝ_luma_hÜ_MBAff
;

44 
p_Vid
->
EdgeLoÝChromaV”
 = 
edge_loÝ_chroma_v”_MBAff
;

45 
p_Vid
->
EdgeLoÝChromaHÜ
 = 
edge_loÝ_chroma_hÜ_MBAff
;

46 
	}
}

54 
	$g‘_¡»ngth_v”_MBAff
(
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
)

56 
blkP
, 
blkQ
, 
idx
;

57 
blk_x
, 
blk_x2
, 
blk_y
, 
blk_y2
 ;

59 
xQ
, 
yQ
;

60 
mb_x
, 
mb_y
;

62 
Maüoblock
 *
MbP
;

64 
Pix–Pos
 
pixP
;

65 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

66 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

68  
idx
 = 0; idx < 16; ++idx )

70 
xQ
 = 
edge
;

71 
yQ
 = 
idx
;

72 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
 - 1, 
yQ
,…_Vid->
mb_size
[
IS_LUMA
], &
pixP
);

73 
blkQ
 = (è((
yQ
 & 0xFFFCè+ (
xQ
 >> 2));

74 
blkP
 = (è((
pixP
.
y
 & 0xFFFCè+ (pixP.
x
 >> 2));

76 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

77 
p_Vid
->
mixedModeEdgeFÏg
 = (
by‹
è(
MbQ
->
mb_f›ld
 !ð
MbP
->mb_field);

79 ià(
p_Vid
->
ty³
==
SP_SLICE
 ||…_Vid->ty³==
SI_SLICE
)

81 
SŒ’gth
[
idx
] = (
edge
 == 0) ? 4 : 3;

86 
SŒ’gth
[
idx
] = (
edge
 == 0) ? 4 : 3;

88 ifÐ!(
MbP
->
mb_ty³
==
I4MB
 || MbP->mb_ty³==
I16MB
 || MbP->mb_ty³==
I8MB
 || MbP->mb_ty³==
IPCM
)

89 && !(
MbQ
->
mb_ty³
==
I4MB
 || MbQ->mb_ty³==
I16MB
 || MbQ->mb_ty³==
I8MB
 || MbQ->mb_ty³==
IPCM
) )

91 ifÐ((
MbQ
->
cbp_blk
 & ((
št64
)1 << 
blkQ
 )è!ð0è|| ((
MbP
->cbp_blk & ((št64)1 << 
blkP
)) != 0) )

92 
SŒ’gth
[
idx
] = 2 ;

98 ià(
p_Vid
->
mixedModeEdgeFÏg
)

100 (
SŒ’gth
[
idx
] = 1);

104 
p_Vid
->
	`g‘_mb_block_pos
 (p_Vid->
PicPos
, 
MbQ
->
mbAddrX
, &
mb_x
, &
mb_y
);

105 
blk_y
 = (è((
mb_y
<<2è+ (
blkQ
 >> 2));

106 
blk_x
 = (è((
mb_x
<<2è+ (
blkQ
 & 3));

107 
blk_y2
 = (è(
pixP
.
pos_y
 >> 2);

108 
blk_x2
 = (è(
pixP
.
pos_x
 >> 2);

110 
PicMÙiÚP¬ams
 *
mv_šfo_p
 = &
mv_šfo
[
blk_y
 ][
blk_x
 ];

111 
PicMÙiÚP¬ams
 *
mv_šfo_q
 = &
mv_šfo
[
blk_y2
][
blk_x2
];

113 
StÜabËPiùu»PŒ
 
»f_p0
 = 
mv_šfo_p
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_0];

114 
StÜabËPiùu»PŒ
 
»f_q0
 = 
mv_šfo_q
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_0];

115 
StÜabËPiùu»PŒ
 
»f_p1
 = 
mv_šfo_p
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_1];

116 
StÜabËPiùu»PŒ
 
»f_q1
 = 
mv_šfo_q
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_1];

118 iàÐ((
»f_p0
==
»f_q0
è&& (
»f_p1
==
»f_q1
)) ||

119 ((
»f_p0
==
»f_q1
è&& (
»f_p1
==
»f_q0
)))

121 
SŒ’gth
[
idx
]=0;

123 ià(
»f_p0
 !ð
»f_p1
)

126 ià(
»f_p0
==
»f_q0
)

128 
SŒ’gth
[
idx
] = (
by‹
) (

129 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) ||

130 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
));

134 
SŒ’gth
[
idx
] = (
by‹
) (

135 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) ||

136 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
));

142 
SŒ’gth
[
idx
] = (
by‹
) ((

143 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) ||

144 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
))

146 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) ||

147 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
)));

152 
SŒ’gth
[
idx
] = 1;

160 
	}
}

168 
	$g‘_¡»ngth_hÜ_MBAff
(
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
)

170 
blkP
, 
blkQ
, 
idx
;

171 
blk_x
, 
blk_x2
, 
blk_y
, 
blk_y2
 ;

173 
xQ
, 
yQ
;

174 
mb_x
, 
mb_y
;

176 
Maüoblock
 *
MbP
;

178 
Pix–Pos
 
pixP
;

179 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

180 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

183  
idx
 = 0; idx < 16; ++idx )

185 
xQ
 = 
idx
;

186 
yQ
 = (
edge
 < 
MB_BLOCK_SIZE
 ?ƒdge : 1);

187 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
 - 1,…_Vid->
mb_size
[
IS_LUMA
], &
pixP
);

188 
blkQ
 = (è((
yQ
 & 0xFFFCè+ (
xQ
 >> 2));

189 
blkP
 = (è((
pixP
.
y
 & 0xFFFCè+ (pixP.
x
 >> 2));

191 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

192 
p_Vid
->
mixedModeEdgeFÏg
 = (
by‹
è(
MbQ
->
mb_f›ld
 !ð
MbP
->mb_field);

194 ià(
p_Vid
->
ty³
==
SP_SLICE
 ||…_Vid->ty³==
SI_SLICE
)

196 
SŒ’gth
[
idx
] = (
edge
 =ð0 && (((!
p_Vid
->
mb_aff_äame_æag
 && (p_Vid->
¡ruùu»
==
FRAME
)) ||

197 (
p_Vid
->
mb_aff_äame_æag
 && !
MbP
->
mb_f›ld
 && !
MbQ
->mb_field)))) ? 4 : 3;

202 
SŒ’gth
[
idx
] = (
edge
 =ð0 && (((!
p_Vid
->
mb_aff_äame_æag
 && (p_Vid->
¡ruùu»
==
FRAME
)) ||

203 (
p_Vid
->
mb_aff_äame_æag
 && !
MbP
->
mb_f›ld
 && !
MbQ
->mb_field)))) ? 4 : 3;

205 ifÐ!(
MbP
->
mb_ty³
==
I4MB
 || MbP->mb_ty³==
I16MB
 || MbP->mb_ty³==
I8MB
 || MbP->mb_ty³==
IPCM
)

206 && !(
MbQ
->
mb_ty³
==
I4MB
 || MbQ->mb_ty³==
I16MB
 || MbQ->mb_ty³==
I8MB
 || MbQ->mb_ty³==
IPCM
) )

208 ifÐ((
MbQ
->
cbp_blk
 & ((
št64
)1 << 
blkQ
 )è!ð0è|| ((
MbP
->cbp_blk & ((št64)1 << 
blkP
)) != 0) )

209 
SŒ’gth
[
idx
] = 2 ;

215 ià(
p_Vid
->
mixedModeEdgeFÏg
)

217 (
SŒ’gth
[
idx
] = 1);

221 
p_Vid
->
	`g‘_mb_block_pos
 (p_Vid->
PicPos
, 
MbQ
->
mbAddrX
, &
mb_x
, &
mb_y
);

222 
blk_y
 = (è((
mb_y
<<2è+ (
blkQ
 >> 2));

223 
blk_x
 = (è((
mb_x
<<2è+ (
blkQ
 & 3));

224 
blk_y2
 = (è(
pixP
.
pos_y
 >> 2);

225 
blk_x2
 = (è(
pixP
.
pos_x
 >> 2);

227 
PicMÙiÚP¬ams
 *
mv_šfo_p
 = &
mv_šfo
[
blk_y
 ][
blk_x
 ];

228 
PicMÙiÚP¬ams
 *
mv_šfo_q
 = &
mv_šfo
[
blk_y2
][
blk_x2
];

230 
StÜabËPiùu»PŒ
 
»f_p0
 = 
mv_šfo_p
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_0];

231 
StÜabËPiùu»PŒ
 
»f_q0
 = 
mv_šfo_q
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_0];

232 
StÜabËPiùu»PŒ
 
»f_p1
 = 
mv_šfo_p
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_1];

233 
StÜabËPiùu»PŒ
 
»f_q1
 = 
mv_šfo_q
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_1];

235 iàÐ((
»f_p0
==
»f_q0
è&& (
»f_p1
==
»f_q1
)) ||

236 ((
»f_p0
==
»f_q1
è&& (
»f_p1
==
»f_q0
)))

238 
SŒ’gth
[
idx
]=0;

240 ià(
»f_p0
 !ð
»f_p1
)

243 ià(
»f_p0
==
»f_q0
)

245 
SŒ’gth
[
idx
] = (
by‹
) (

246 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) ||

247 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
));

251 
SŒ’gth
[
idx
] = (
by‹
) (

252 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) ||

253 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
));

259 
SŒ’gth
[
idx
] = (
by‹
) ((

260 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) ||

261 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
))

263 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) ||

264 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
)));

269 
SŒ’gth
[
idx
] = 1;

277 
	}
}

288 
	$edge_loÝ_luma_v”_MBAff
(
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
)

290 
³l
, 
­
 = 0, 
aq
 = 0, 
SŒng
 ;

291 
C0
, 
tc0
, 
dif
;

292 
img³l
 
L2
 = 0, 
L1
, 
L0
, 
R0
, 
R1
, 
R2
 = 0, 
L3
, 
R3
;

293 
RL0
;

294 
AÍha
 = 0, 
B‘a
 = 0 ;

295 cÚ¡ 
by‹
* 
ClTab
 = 
NULL
;

296 
sm®l_g­
;

297 
šdexA
, 
šdexB
;

299 
QP
;

300 
xQ
, 
yQ
;

302 
Pix–Pos
 
pixP
, 
pixQ
;

304 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

305 
b™d•th_sÿË
 = 
¶
? 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
] :…_Vid->b™d•th_sÿË[
IS_LUMA
];

306 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

308 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

309 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

311 
Maüoblock
 *
MbP
;

312 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

314  
³l
 = 0 ;…– < 
MB_BLOCK_SIZE
 ; ++pel )

316 
xQ
 = 
edge
;

317 
yQ
 = 
³l
;

318 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
 - 1, 
yQ
,…_Vid->
mb_size
[
IS_LUMA
], &
pixP
);

320 ià(
pixP
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
== 0))

322 ifÐ(
SŒng
 = 
SŒ’gth
[
³l
]) != 0)

324 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
,…_Vid->
mb_size
[
IS_LUMA
], &
pixQ
);

326 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

328 
SrcPŒQ
 = &(
Img
[
pixQ
.
pos_y
][pixQ.
pos_x
]);

329 
SrcPŒP
 = &(
Img
[
pixP
.
pos_y
][pixP.
pos_x
]);

332 
QP
 = 
¶
? ((
MbP
->
qpc
[¶-1] + 
MbQ
->qpc[¶-1] + 1è>> 1è: (MbP->
qp
 + MbQ->qp + 1) >> 1;

334 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

335 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

337 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

338 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

339 
ClTab
 = 
CLIP_TAB
[
šdexA
];

341 
L3
 = 
SrcPŒP
[-3];

342 
L2
 = 
SrcPŒP
[-2];

343 
L1
 = 
SrcPŒP
[-1];

344 
L0
 = 
SrcPŒP
[0] ;

345 
R0
 = 
SrcPŒQ
[0] ;

346 
R1
 = 
SrcPŒQ
[ 1];

347 
R2
 = 
SrcPŒQ
[ 2];

348 
R3
 = 
SrcPŒQ
[ 3];

350 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

352 ià((
	`Ÿbs
Ð
R0
 - 
R1
è< 
B‘a
 ) && (Ÿbs(
L0
 - 
L1
) < Beta ))

354 if(
SŒng
 == 4 )

356 
RL0
 = 
L0
 + 
R0
;

357 
sm®l_g­
 = (
	`Ÿbs
Ð
R0
 - 
L0
 ) < ((
AÍha
 >> 2) + 2));

358 
aq
 = ( 
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
 ) & 
sm®l_g­
;

359 
­
 = ( 
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
 ) & 
sm®l_g­
;

361 ià(
­
)

363 
SrcPŒP
[-2 ] = (
img³l
è((((
L3
 + 
L2
è<< 1è+ L2 + 
L1
 + 
RL0
 + 4) >> 3);

364 
SrcPŒP
[-1 ] = (
img³l
è(Ð
L2
 + 
L1
 + 
L0
 + 
R0
 + 2) >> 2);

365 
SrcPŒP
[ 0 ] = (
img³l
è(Ð
R1
 + ((
L1
 + 
RL0
è<< 1è+ 
L2
 + 4) >> 3);

369 
SrcPŒP
[ 0 ] = (
img³l
è(((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2) ;

372 ià(
aq
)

374 
SrcPŒQ
[ 0 ] = (
img³l
è(Ð
L1
 + ((
R1
 + 
RL0
è<< 1è+ 
R2
 + 4) >> 3);

375 
SrcPŒQ
[ 1 ] = (
img³l
è(Ð
R2
 + 
R0
 + 
R1
 + 
L0
 + 2) >> 2);

376 
SrcPŒQ
[ 2 ] = (
img³l
è((((
R3
 + 
R2
è<< 1è+ R2 + 
R1
 + 
RL0
 + 4) >> 3);

380 
SrcPŒQ
[ 0 ] = (
img³l
è(((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2);

385 
RL0
 = (
L0
 + 
R0
 + 1) >> 1;

386 
aq
 = (
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
);

387 
­
 = (
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
);

389 
C0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
;

390 
tc0
 = (
C0
 + 
­
 + 
aq
) ;

391 
dif
 = 
	`iCl3
Ð-
tc0
,c0, (((
R0
 - 
L0
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3) ;

393 ifÐ
­
 )

394 *(
SrcPŒP
 - 1è+ð
	`iCl3
Ð-
C0
, C0, ( 
L2
 + 
RL0
 - (
L1
 << 1)) >> 1 ) ;

396 *
SrcPŒP
 = (
img³l
è
	`iCl1
 (
max_img³l_v®ue
, 
L0
 + 
dif
) ;

397 *
SrcPŒQ
 = (
img³l
è
	`iCl1
 (
max_img³l_v®ue
, 
R0
 - 
dif
) ;

399 ifÐ
aq
 )

400 *(
SrcPŒQ
 + 1è+ð
	`iCl3
Ð-
C0
, C0, ( 
R2
 + 
RL0
 - (
R1
 << 1)) >> 1 ) ;

407 
	}
}

415 
	$edge_loÝ_luma_hÜ_MBAff
(
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
width
)

417 
³l
, 
­
 = 0, 
aq
 = 0, 
SŒng
 ;

418 
šcP
, 
šcQ
;

419 
C0
, 
tc0
, 
dif
;

420 
img³l
 
L2
 = 0, 
L1
, 
L0
, 
R0
, 
R1
, 
R2
 = 0, 
L3
, 
R3
;

421 
RL0
;

422 
AÍha
 = 0, 
B‘a
 = 0 ;

423 cÚ¡ 
by‹
* 
ClTab
 = 
NULL
;

424 
sm®l_g­
;

425 
šdexA
, 
šdexB
;

427 
QP
;

428 
xQ
, 
yQ
;

430 
Pix–Pos
 
pixP
, 
pixQ
;

431 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

432 
b™d•th_sÿË
 = 
¶
? 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
] :…_Vid->b™d•th_sÿË[
IS_LUMA
];

433 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

435 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

436 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

438 
Maüoblock
 *
MbP
;

439 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

441  
³l
 = 0 ;…– < 
MB_BLOCK_SIZE
 ; ++pel )

443 
xQ
 = 
³l
;

444 
yQ
 = (
edge
 < 16 ?ƒdge : 1);

445 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
 - 1,…_Vid->
mb_size
[
IS_LUMA
], &
pixP
);

447 ià(
pixP
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
== 0))

449 ifÐ(
SŒng
 = 
SŒ’gth
[
³l
]) != 0)

451 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
,…_Vid->
mb_size
[
IS_LUMA
], &
pixQ
);

453 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

455 
šcQ
 = ((
MbP
->
mb_f›ld
 && !
MbQ
->mb_f›ldè? 2 * 
width
 : width);

456 
šcP
 = ((
MbQ
->
mb_f›ld
 && !
MbP
->mb_f›ldè? 2 * 
width
 : width);

457 
SrcPŒQ
 = &(
Img
[
pixQ
.
pos_y
][pixQ.
pos_x
]);

458 
SrcPŒP
 = &(
Img
[
pixP
.
pos_y
][pixP.
pos_x
]);

461 
QP
 = 
¶
? ((
MbP
->
qpc
[¶-1] + 
MbQ
->qpc[¶-1] + 1è>> 1è: (MbP->
qp
 + MbQ->qp + 1) >> 1;

463 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

464 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

466 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

467 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

468 
ClTab
 = 
CLIP_TAB
[
šdexA
];

470 
L3
 = 
SrcPŒP
[-
šcP
*3];

471 
L2
 = 
SrcPŒP
[-
šcP
*2];

472 
L1
 = 
SrcPŒP
[-
šcP
];

473 
L0
 = 
SrcPŒP
[0] ;

474 
R0
 = 
SrcPŒQ
[0] ;

475 
R1
 = 
SrcPŒQ
[ 
šcQ
];

476 
R2
 = 
SrcPŒQ
[ 
šcQ
*2];

477 
R3
 = 
SrcPŒQ
[ 
šcQ
*3];

479 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

481 ià((
	`Ÿbs
Ð
R0
 - 
R1
è< 
B‘a
 ) && (Ÿbs(
L0
 - 
L1
) < Beta ))

483 if(
SŒng
 == 4 )

485 
RL0
 = 
L0
 + 
R0
;

486 
sm®l_g­
 = (
	`Ÿbs
Ð
R0
 - 
L0
 ) < ((
AÍha
 >> 2) + 2));

487 
aq
 = ( 
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
 ) & 
sm®l_g­
;

488 
­
 = ( 
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
 ) & 
sm®l_g­
;

490 ià(
­
)

492 
SrcPŒP
[-
šcP
 * 2] = (
img³l
è((((
L3
 + 
L2
è<< 1è+ L2 + 
L1
 + 
RL0
 + 4) >> 3);

493 
SrcPŒP
[-
šcP
 ] = (
img³l
è(Ð
L2
 + 
L1
 + 
L0
 + 
R0
 + 2) >> 2);

494 
SrcPŒP
[ 0 ] = (
img³l
è(Ð
R1
 + ((
L1
 + 
RL0
è<< 1è+ 
L2
 + 4) >> 3);

498 
SrcPŒP
[ 0 ] = (
img³l
è(((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2) ;

501 ià(
aq
)

503 
SrcPŒQ
[ 0 ] = (
img³l
è(Ð
L1
 + ((
R1
 + 
RL0
è<< 1è+ 
R2
 + 4) >> 3);

504 
SrcPŒQ
[ 
šcQ
 ] = (
img³l
è(Ð
R2
 + 
R0
 + 
R1
 + 
L0
 + 2) >> 2);

505 
SrcPŒQ
[ 
šcQ
 * 2 ] = (
img³l
è((((
R3
 + 
R2
è<< 1è+ R2 + 
R1
 + 
RL0
 + 4) >> 3);

509 
SrcPŒQ
[ 0 ] = (
img³l
è(((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2);

514 
RL0
 = (
L0
 + 
R0
 + 1) >> 1;

515 
aq
 = (
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
);

516 
­
 = (
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
);

518 
C0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
;

519 
tc0
 = (
C0
 + 
­
 + 
aq
) ;

520 
dif
 = 
	`iCl3
Ð-
tc0
,c0, (((
R0
 - 
L0
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3) ;

522 ifÐ
­
 )

523 *(
SrcPŒP
 - 
šcP
è+ð
	`iCl3
Ð-
C0
, C0, ( 
L2
 + 
RL0
 - (
L1
 << 1)) >> 1 ) ;

525 *
SrcPŒP
 = (
img³l
è
	`iCl1
 (
max_img³l_v®ue
, 
L0
 + 
dif
) ;

526 *
SrcPŒQ
 = (
img³l
è
	`iCl1
 (
max_img³l_v®ue
, 
R0
 - 
dif
) ;

528 ifÐ
aq
 )

529 *(
SrcPŒQ
 + 
šcQ
è+ð
	`iCl3
Ð-
C0
, C0, ( 
R2
 + 
RL0
 - (
R1
 << 1)) >> 1 ) ;

536 
	}
}

544 
	$edge_loÝ_chroma_v”_MBAff
(
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
uv
)

546 
³l
, 
SŒng
 ;

547 
C0
, 
tc0
, 
dif
;

548 
img³l
 
L1
, 
L0
, 
R0
, 
R1
;

549 
AÍha
 = 0, 
B‘a
 = 0;

550 cÚ¡ 
by‹
* 
ClTab
 = 
NULL
;

551 
šdexA
, 
šdexB
;

552 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

553 
P–Num
 = 
³Êum_ü
[0][
p_Vid
->
yuv_fÜm©
];

554 
SŒ’gthIdx
;

555 
QP
;

556 
xQ
, 
yQ
;

557 
Pix–Pos
 
pixP
, 
pixQ
;

558 
b™d•th_sÿË
 = 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
];

559 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

561 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

562 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

563 
Maüoblock
 *
MbP
;

564 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

566  
³l
 = 0 ;…– < 
P–Num
 ; ++pel )

568 
xQ
 = 
edge
;

569 
yQ
 = 
³l
;

570 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
,…_Vid->
mb_size
[
IS_CHROMA
], &
pixQ
);

571 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
 - 1, 
yQ
,…_Vid->
mb_size
[
IS_CHROMA
], &
pixP
);

572 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

573 
SŒ’gthIdx
 = (
P–Num
 =ð8è? ((
MbQ
->
mb_f›ld
 && !
MbP
->mb_f›ldè? 
³l
 << 1 :((pel >> 1) << 2) + (pel & 0x01)) :…el;

575 ià(
pixP
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
 == 0))

577 ifÐ(
SŒng
 = 
SŒ’gth
[
SŒ’gthIdx
]) != 0)

579 
SrcPŒQ
 = &(
Img
[
pixQ
.
pos_y
][pixQ.
pos_x
]);

580 
SrcPŒP
 = &(
Img
[
pixP
.
pos_y
][pixP.
pos_x
]);

583 
QP
 = (
MbP
->
qpc
[
uv
] + 
MbQ
->qpc[uv] + 1) >> 1;

585 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

586 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

588 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

589 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

590 
ClTab
 = 
CLIP_TAB
[
šdexA
];

592 
L1
 = 
SrcPŒP
[-1];

593 
L0
 = 
SrcPŒP
[0] ;

594 
R0
 = 
SrcPŒQ
[0] ;

595 
R1
 = 
SrcPŒQ
[ 1];

597 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

599 ifÐ((
	`Ÿbs
Ð
R0
 - 
R1
è- 
B‘a
 < 0è&& (Ÿbs(
L0
 - 
L1
) - Beta < 0 )) )

601 ifÐ
SŒng
 == 4 )

603 
SrcPŒQ
[0] = (
img³l
èÐ((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2 );

604 
SrcPŒP
[0] = (
img³l
èÐ((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2 );

608 
C0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
;

609 
tc0
 = (
C0
 + 1);

610 
dif
 = 
	`iCl3
Ð-
tc0
,c0, ( ((
R0
 - 
L0
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3 );

612 
SrcPŒP
[0] = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, 
L0
 + 
dif
 );

613 
SrcPŒQ
[0] = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, 
R0
 - 
dif
 );

620 
	}
}

628 
	$edge_loÝ_chroma_hÜ_MBAff
(
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
width
, 
uv
)

630 
³l
, 
SŒng
 ;

631 
šcP
, 
šcQ
;

632 
C0
, 
tc0
, 
dif
;

633 
img³l
 
L1
, 
L0
, 
R0
, 
R1
;

634 
AÍha
 = 0, 
B‘a
 = 0;

635 cÚ¡ 
by‹
* 
ClTab
 = 
NULL
;

636 
šdexA
, 
šdexB
;

637 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

638 
P–Num
 = 
³Êum_ü
[1][
p_Vid
->
yuv_fÜm©
];

639 
SŒ’gthIdx
;

640 
QP
;

641 
xQ
, 
yQ
;

642 
Pix–Pos
 
pixP
, 
pixQ
;

643 
b™d•th_sÿË
 = 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
];

644 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

646 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

647 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

648 
Maüoblock
 *
MbP
;

649 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

651  
³l
 = 0 ;…– < 
P–Num
 ; ++pel )

653 
xQ
 = 
³l
;

654 
yQ
 = (
edge
 < 16?ƒdge : 1);

655 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
,…_Vid->
mb_size
[
IS_CHROMA
], &
pixQ
);

656 
p_Vid
->
	`g‘Neighbour
(
MbQ
, 
xQ
, 
yQ
 - 1,…_Vid->
mb_size
[
IS_CHROMA
], &
pixP
);

657 
MbP
 = &(
p_Vid
->
mb_d©a
[
pixP
.
mb_addr
]);

658 
SŒ’gthIdx
 = (
P–Num
 =ð8è? ((
MbQ
->
mb_f›ld
 && !
MbP
->mb_f›ldè? 
³l
 << 1 :((pel >> 1) << 2) + (pel & 0x01)) :…el;

660 ià(
pixP
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
 == 0))

662 ifÐ(
SŒng
 = 
SŒ’gth
[
SŒ’gthIdx
]) != 0)

664 
šcQ
 = ((
MbP
->
mb_f›ld
 && !
MbQ
->mb_f›ldè? 2 * 
width
 : width);

665 
šcP
 = ((
MbQ
->
mb_f›ld
 && !
MbP
->mb_f›ldè? 2 * 
width
 : width);

666 
SrcPŒQ
 = &(
Img
[
pixQ
.
pos_y
][pixQ.
pos_x
]);

667 
SrcPŒP
 = &(
Img
[
pixP
.
pos_y
][pixP.
pos_x
]);

670 
QP
 = (
MbP
->
qpc
[
uv
] + 
MbQ
->qpc[uv] + 1) >> 1;

672 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

673 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

675 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

676 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

677 
ClTab
 = 
CLIP_TAB
[
šdexA
];

679 
L1
 = 
SrcPŒP
[-
šcP
];

680 
L0
 = 
SrcPŒP
[0] ;

681 
R0
 = 
SrcPŒQ
[0] ;

682 
R1
 = 
SrcPŒQ
[ 
šcQ
];

684 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

686 ifÐ((
	`Ÿbs
Ð
R0
 - 
R1
è- 
B‘a
 < 0è&& (Ÿbs(
L0
 - 
L1
) - Beta < 0 )) )

688 ifÐ
SŒng
 == 4 )

690 
SrcPŒQ
[0] = (
img³l
èÐ((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2 );

691 
SrcPŒP
[0] = (
img³l
èÐ((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2 );

695 
C0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
;

696 
tc0
 = (
C0
 + 1);

697 
dif
 = 
	`iCl3
Ð-
tc0
,c0, ( ((
R0
 - 
L0
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3 );

699 
SrcPŒP
[0] = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, 
L0
 + 
dif
 );

700 
SrcPŒQ
[0] = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, 
R0
 - 
dif
 );

707 
	}
}

	@lencod/src/loop_filter_normal.c

23 
	~"glob®.h
"

24 
	~"image.h
"

25 
	~"mb_acûss.h
"

26 
	~"loÝ_fž‹r.h
"

28 
G‘SŒ’gthV”
 (
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
);

29 
G‘SŒ’gthHÜ
 (
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
);

30 
EdgeLoÝLumaV”
 (
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
);

31 
EdgeLoÝLumaHÜ
 (
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
width
);

32 
EdgeLoÝChromaV”
 (
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
uv
);

33 
EdgeLoÝChromaHÜ
 (
img³l
** 
Img
, 
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
width
, 
uv
);

36 
	$£t_loÝ_fž‹r_funùiÚs_nÜm®
(
VideoP¬am‘”s
 *
p_Vid
)

38 
p_Vid
->
G‘SŒ’gthV”
 = GetStrengthVer;

39 
p_Vid
->
G‘SŒ’gthHÜ
 = GetStrengthHor;

40 
p_Vid
->
EdgeLoÝLumaV”
 = EdgeLoopLumaVer;

41 
p_Vid
->
EdgeLoÝLumaHÜ
 = EdgeLoopLumaHor;

42 
p_Vid
->
EdgeLoÝChromaV”
 = EdgeLoopChromaVer;

43 
p_Vid
->
EdgeLoÝChromaHÜ
 = EdgeLoopChromaHor;

44 
	}
}

52 
	$G‘SŒ’gthV”
(
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
)

54 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

55 
Sliû
 *
cu¼Sliû
 = 
MbQ
->
p_Sliû
;

56 
SŒV®ue
;

58 ià((
cu¼Sliû
->
¦iû_ty³
==
SP_SLICE
)||(cu¼Sliû->¦iû_ty³==
SI_SLICE
) )

61 
SŒV®ue
 = (
edge
 == 0) ? 4 : 3;

62 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

66 ià(!(
MbQ
->
mb_ty³
==
I4MB
||MbQ->mb_ty³==
I8MB
||MbQ->mb_ty³==
I16MB
||MbQ->mb_ty³==
IPCM
))

68 
Pix–Pos
 
pixMB
;

69 
Maüoblock
 *
MbP
;

70 
xQ
 = 
edge
 - 1;

72 
	`g‘NÚAffNeighbour
(
MbQ
, 
xQ
, 0, 
p_Vid
->
mb_size
[
IS_LUMA
], &
pixMB
);

73 
MbP
 = (
edge
è? 
MbQ
 : &(
p_Vid
->
mb_d©a
[
pixMB
.
mb_addr
]);

75 ià(!(
MbP
->
mb_ty³
==
I4MB
||MbP->mb_ty³==
I8MB
||MbP->mb_ty³==
I16MB
||MbP->mb_ty³==
IPCM
))

77 
Pix–Pos
 
pixP
 = 
pixMB
;

78 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

80 
blkP
, 
blkQ
, 
idx
;

82 
mb_x
, 
mb_y
;

84 
	`g‘_mb_block_pos_nÜm®
 (
p_Vid
->
PicPos
, 
MbQ
->
mbAddrX
, &
mb_x
, &
mb_y
);

85 
mb_x
 <<= 2;

86 
mb_y
 <<= 2;

88 
xQ
 ++;

90  
idx
 = 0 ; idx < 
MB_BLOCK_SIZE
 ; idx +ð
BLOCK_SIZE
 )

92 
pixP
.
y
 = (è(
pixMB
.y + 
idx
);

93 
pixP
.
pos_y
 = (è(
pixMB
.pos_y + 
idx
);

95 
blkQ
 = (
idx
 & 0xFFFCè+ (
xQ
 >> 2);

96 
blkP
 = (
pixP
.
y
 & 0xFFFCè+ (pixP.
x
 >> 2);

98 ià(((
MbQ
->
cbp_blk
 & 
	`i64_pow”2
(
blkQ
)è!ð0è|| ((
MbP
->cbp_blk & i64_pow”2(
blkP
)) != 0))

99 
SŒV®ue
 = 2;

100 ià(
edge
 && ((
MbQ
->
mb_ty³
 == 1) || (MbQ->mb_type == 2)))

101 
SŒV®ue
 = 0;

104 
blk_y
 = 
mb_y
 + (
blkQ
 >> 2);

105 
blk_x
 = 
mb_x
 + (
blkQ
 & 3);

106 
blk_y2
 = 
pixP
.
pos_y
 >> 2;

107 
blk_x2
 = 
pixP
.
pos_x
 >> 2;

109 
PicMÙiÚP¬ams
 *
mv_šfo_p
 = &
mv_šfo
[
blk_y
 ][
blk_x
 ];

110 
PicMÙiÚP¬ams
 *
mv_šfo_q
 = &
mv_šfo
[
blk_y2
][
blk_x2
];

112 
StÜabËPiùu»PŒ
 
»f_p0
 = 
mv_šfo_p
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_0];

113 
StÜabËPiùu»PŒ
 
»f_q0
 = 
mv_šfo_q
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_0];

114 
StÜabËPiùu»PŒ
 
»f_p1
 = 
mv_šfo_p
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_1];

115 
StÜabËPiùu»PŒ
 
»f_q1
 = 
mv_šfo_q
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_1];

117 iàÐ((
»f_p0
==
»f_q0
è&& (
»f_p1
==
»f_q1
)) || ((ref_p0==ref_q1) && (ref_p1==ref_q0)))

120 ià(
»f_p0
 !ð
»f_p1
)

123 ià(
»f_p0
 =ð
»f_q0
)

125 
SŒV®ue
 =

126 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) |

127 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
);

131 
SŒV®ue
 =

132 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) |

133 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
);

138 
SŒV®ue
 = ((

139 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) |

140 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
))

142 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) |

143 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
)

148 
SŒV®ue
 = 1;

152 *(*)(
SŒ’gth
+
idx
èð
SŒV®ue
 * 0x01010101;

158 
SŒV®ue
 = (
edge
 == 0) ? 4 : 3;

159 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

165 
SŒV®ue
 = (
edge
 == 0) ? 4 : 3;

166 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

169 
	}
}

177 
	$G‘SŒ’gthHÜ
(
by‹
 
SŒ’gth
[
MB_BLOCK_SIZE
], 
Maüoblock
 *
MbQ
, 
edge
, 
mvlim™
)

179 
SŒV®ue
;

180 
Sliû
 *
cu¼Sliû
 = 
MbQ
->
p_Sliû
;

181 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

183 ià((
cu¼Sliû
->
¦iû_ty³
==
SP_SLICE
)||(cu¼Sliû->¦iû_ty³==
SI_SLICE
) )

186 
SŒV®ue
 = (
edge
 =ð0 && (
p_Vid
->
¡ruùu»
 =ð
FRAME
)) ? 4 : 3;

187 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

191 ià(!(
MbQ
->
mb_ty³
==
I4MB
||MbQ->mb_ty³==
I8MB
||MbQ->mb_ty³==
I16MB
||MbQ->mb_ty³==
IPCM
))

193 
Pix–Pos
 
pixMB
;

194 
Maüoblock
 *
MbP
;

195 
yQ
 = (
edge
 < 16 ?ƒdge - 1: 0);

197 
	`g‘NÚAffNeighbour
(
MbQ
, 0, 
yQ
, 
p_Vid
->
mb_size
[
IS_LUMA
], &
pixMB
);

198 
MbP
 = (
edge
è? 
MbQ
 : &(
p_Vid
->
mb_d©a
[
pixMB
.
mb_addr
]);

200 ià(!(
MbP
->
mb_ty³
==
I4MB
||MbP->mb_ty³==
I8MB
||MbP->mb_ty³==
I16MB
||MbP->mb_ty³==
IPCM
))

202 
Pix–Pos
 
pixP
 = 
pixMB
;

203 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

205 
blkP
, 
blkQ
, 
idx
;

207 
mb_x
, 
mb_y
;

209 
	`g‘_mb_block_pos_nÜm®
 (
p_Vid
->
PicPos
, 
MbQ
->
mbAddrX
, &
mb_x
, &
mb_y
);

210 
mb_x
 <<= 2;

211 
mb_y
 <<= 2;

212 
yQ
 ++;

214  
idx
 = 0 ; idx < 
MB_BLOCK_SIZE
 ; idx +ð
BLOCK_SIZE
 )

216 
pixP
.
x
 = (è(
pixMB
.x + 
idx
);

217 
pixP
.
pos_x
 = (è(
pixMB
.pos_x + 
idx
);

219 
blkQ
 = (
yQ
 & 0xFFFCè+ (
idx
 >> 2);

220 
blkP
 = (
pixP
.
y
 & 0xFFFCè+ (pixP.
x
 >> 2);

222 ifÐ((
MbQ
->
cbp_blk
 & 
	`i64_pow”2
(
blkQ
)è!ð0è|| ((
MbP
->cbp_blk & i64_pow”2(
blkP
)) != 0) )

223 
SŒV®ue
 = 2;

224 ià(
edge
 && ((
MbQ
->
mb_ty³
 == 1) || (MbQ->mb_type == 3)))

225 
SŒV®ue
 = 0;

228 
blk_y
 = 
mb_y
 + (
blkQ
 >> 2);

229 
blk_x
 = 
mb_x
 + (
blkQ
 & 3);

230 
blk_y2
 = 
pixP
.
pos_y
 >> 2;

231 
blk_x2
 = 
pixP
.
pos_x
 >> 2;

233 
PicMÙiÚP¬ams
 *
mv_šfo_p
 = &
mv_šfo
[
blk_y
 ][
blk_x
 ];

234 
PicMÙiÚP¬ams
 *
mv_šfo_q
 = &
mv_šfo
[
blk_y2
][
blk_x2
];

236 
StÜabËPiùu»PŒ
 
»f_p0
 = 
mv_šfo_p
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_0];

237 
StÜabËPiùu»PŒ
 
»f_q0
 = 
mv_šfo_q
->
»f_idx
[
LIST_0
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_0];

238 
StÜabËPiùu»PŒ
 
»f_p1
 = 
mv_šfo_p
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_p->
»f_pic
[LIST_1];

239 
StÜabËPiùu»PŒ
 
»f_q1
 = 
mv_šfo_q
->
»f_idx
[
LIST_1
] =ð-1 ? 
NULL
 : mv_šfo_q->
»f_pic
[LIST_1];

241 iàÐ((
»f_p0
==
»f_q0
è&& (
»f_p1
==
»f_q1
)) || ((ref_p0==ref_q1) && (ref_p1==ref_q0)))

244 ià(
»f_p0
 !ð
»f_p1
)

247 ià(
»f_p0
 =ð
»f_q0
)

249 
SŒV®ue
 =

250 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) |

251 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
);

255 
SŒV®ue
 =

256 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) |

257 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
);

262 
SŒV®ue
 = ((

263 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[LIST_0], 
mvlim™
) |

264 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[LIST_1], 
mvlim™
))

266 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_0
], &
mv_šfo_q
->mv[
LIST_1
], 
mvlim™
) |

267 
	`com·»_mvs
(&
mv_šfo_p
->
mv
[
LIST_1
], &
mv_šfo_q
->mv[
LIST_0
], 
mvlim™
)

272 
SŒV®ue
 = 1;

275 *(*)(
SŒ’gth
+
idx
èð
SŒV®ue
 * 0x01010101;

281 
SŒV®ue
 = (
edge
 =ð0 && (
p_Vid
->
¡ruùu»
 =ð
FRAME
)) ? 4 : 3;

282 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

288 
SŒV®ue
 = (
edge
 =ð0 && (
p_Vid
->
¡ruùu»
 =ð
FRAME
)) ? 4 : 3;

289 
	`mem£t
(
SŒ’gth
, (
by‹
è
SŒV®ue
, 
MB_BLOCK_SIZE
 * (byte));

292 
	}
}

301 
	$EdgeLoÝLumaV”
(
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
)

303 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

305 
Pix–Pos
 
pixMB1
;

306 
	`g‘NÚAffNeighbour
(
MbQ
, 
edge
 - 1, 0, 
p_Vid
->
mb_size
[
IS_LUMA
], &
pixMB1
);

308 ià(
pixMB1
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
== 0))

310 
b™d•th_sÿË
 = 
¶
 ? 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
] :…_Vid->b™d•th_sÿË[
IS_LUMA
];

312 
Maüoblock
 *
MbP
 = &(
p_Vid
->
mb_d©a
[
pixMB1
.
mb_addr
]);

315 
QP
 = 
¶
? ((
MbP
->
qpc
[¶-1] + 
MbQ
->qpc[¶-1] + 1è>> 1è: (MbP->
qp
 + MbQ->qp + 1) >> 1;

317 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
MbQ
->
DFAÍhaC0Off£t
);

318 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
MbQ
->
DFB‘aOff£t
);

320 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

321 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

323 ià((
AÍha
 | 
B‘a
 )!= 0)

325 cÚ¡ 
by‹
 *
ClTab
 = 
CLIP_TAB
[
šdexA
];

326 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

328 
pos_x1
 = 
pixMB1
.
pos_x
;

329 
img³l
 **
cur_img
 = &
Img
[
pixMB1
.
pos_y
];

330 
³l
;

332  
³l
 = 0 ;…– < 
MB_BLOCK_SIZE
 ;…el += 4 )

334 if(*
SŒ’gth
 == 4 )

336 
i
;

337  
i
 = 0 ; i < 
BLOCK_SIZE
 ; ++i )

339 
img³l
 *
SrcPŒP
 = *(
cur_img
++è+ 
pos_x1
;

340 
img³l
 *
SrcPŒQ
 = 
SrcPŒP
 + 1;

341 
img³l
 
L0
 = *
SrcPŒP
;

342 
img³l
 
R0
 = *
SrcPŒQ
;

344 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

346 
img³l
 
R1
 = *(
SrcPŒQ
 + 1);

347 
img³l
 
L1
 = *(
SrcPŒP
 - 1);

348 ià((
	`Ÿbs
Ð
R0
 - 
R1
è< 
B‘a
è&& (Ÿbs(
L0
 - 
L1
) < Beta))

350 
img³l
 
R2
 = *(
SrcPŒQ
 + 2);

351 
img³l
 
L2
 = *(
SrcPŒP
 - 2);

352 
RL0
 = 
L0
 + 
R0
;

353 
sm®l_g­
 = (
	`Ÿbs
Ð
R0
 - 
L0
 ) < ((
AÍha
 >> 2) + 2));

354 
aq
 = ( 
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
 ) & 
sm®l_g­
;

355 
­
 = ( 
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
 ) & 
sm®l_g­
;

357 ià(
­
)

359 
img³l
 
L3
 = *(
SrcPŒP
 - 3);

360 *(
SrcPŒP
--èð(
img³l
è(Ð
R1
 + ((
L1
 + 
RL0
è<< 1è+ 
L2
 + 4) >> 3);

361 *(
SrcPŒP
--èð(
img³l
è(Ð
L2
 + 
L1
 + 
RL0
 + 2) >> 2);

362 *(
SrcPŒP
 ) = (
img³l
è((((
L3
 + 
L2
è<<1è+ L2 + 
L1
 + 
RL0
 + 4) >> 3);

366 *
SrcPŒP
 = (
img³l
è(((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2);

369 ià(
aq
)

371 
img³l
 
R3
 = *(
SrcPŒQ
 + 3);

372 *(
SrcPŒQ
++èð(
img³l
è(Ð
L1
 + ((
R1
 + 
RL0
è<< 1è+ 
R2
 + 4) >> 3);

373 *(
SrcPŒQ
++èð(
img³l
è(Ð
R2
 + 
R0
 + 
L0
 + 
R1
 + 2) >> 2);

374 *(
SrcPŒQ
 ) = (
img³l
è((((
R3
 + 
R2
è<<1è+ R2 + 
R1
 + 
RL0
 + 4) >> 3);

378 *
SrcPŒQ
 = (
img³l
è(((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2);

384 ifÐ*
SŒ’gth
 != 0)

386 
C0
 = 
ClTab
[ *
SŒ’gth
 ] * 
b™d•th_sÿË
;

387 
i
;

388 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

389 
edge_diff
;

390  
i
 = 0 ; i < 
BLOCK_SIZE
 ; ++i )

392 
SrcPŒP
 = *(
cur_img
++è+ 
pos_x1
;

393 
SrcPŒQ
 = 
SrcPŒP
 + 1;

394 
edge_diff
 = *
SrcPŒQ
 - *
SrcPŒP
;

396 ifÐ
	`Ÿbs
Ð
edge_diff
 ) < 
AÍha
 )

398 
img³l
 *
SrcPŒQ1
 = 
SrcPŒQ
 + 1;

399 
img³l
 *
SrcPŒP1
 = 
SrcPŒP
 - 1;

401 ià((
	`Ÿbs
Ð*
SrcPŒQ
 - *
SrcPŒQ1
è< 
B‘a
è&& (Ÿbs(*
SrcPŒP
 - *
SrcPŒP1
) < Beta))

403 
RL0
 = (*
SrcPŒP
 + *
SrcPŒQ
 + 1) >> 1;

404 
img³l
 
R2
 = *(
SrcPŒQ1
 + 1);

405 
img³l
 
L2
 = *(
SrcPŒP1
 - 1);

407 
aq
 = (
	`Ÿbs
(*
SrcPŒQ
 - 
R2
è< 
B‘a
);

408 
­
 = (
	`Ÿbs
(*
SrcPŒP
 - 
L2
è< 
B‘a
);

410 
tc0
 = (
C0
 + 
­
 + 
aq
) ;

411 
dif
 = 
	`iCl3
Ð-
tc0
,c0, (((
edge_diff
è<< 2è+ (*
SrcPŒP1
 - *
SrcPŒQ1
) + 4) >> 3 );

413 ifÐ
­
 )

414 *
SrcPŒP1
 +ð
	`iCl3
Ð-
C0
, C0, (
L2
 + 
RL0
 - (*SrcPtrP1<<1)) >> 1 );

416 ià(
dif
 != 0)

418 *
SrcPŒP
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, *SrcPŒP + 
dif
);

419 *
SrcPŒQ
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, *SrcPŒQ - 
dif
);

421 ifÐ
aq
 )

422 *
SrcPŒQ1
 +ð
	`iCl3
Ð-
C0
, C0, (
R2
 + 
RL0
 - (*SrcPtrQ1<<1)) >> 1 );

429 
cur_img
 += 4;

431 
SŒ’gth
 += 4;

435 
	}
}

444 
	$EdgeLoÝLumaHÜ
(
CÞÜPÏÃ
 
¶
, 
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
width
)

446 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

448 
Pix–Pos
 
pixMB1
;

449 
	`g‘NÚAffNeighbour
(
MbQ
, 0, (
edge
 < 
MB_BLOCK_SIZE
 ?ƒdg- 1: 0), 
p_Vid
->
mb_size
[
IS_LUMA
], &
pixMB1
);

451 ià(
pixMB1
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
== 0))

453 
b™d•th_sÿË
 = 
¶
 ? 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
] :…_Vid->b™d•th_sÿË[
IS_LUMA
];

455 
Maüoblock
 *
MbP
 = &(
p_Vid
->
mb_d©a
[
pixMB1
.
mb_addr
]);

458 
QP
 = 
¶
? ((
MbP
->
qpc
[¶-1] + 
MbQ
->qpc[¶-1] + 1è>> 1è: (MbP->
qp
 + MbQ->qp + 1) >> 1;

460 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
MbQ
->
DFAÍhaC0Off£t
);

461 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
MbQ
->
DFB‘aOff£t
);

463 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

464 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

465 ià((
AÍha
 | 
B‘a
 )!= 0)

467 cÚ¡ 
by‹
 *
ClTab
 = 
CLIP_TAB
[
šdexA
];

468 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
¶
];

469 
img³l
 *
imgP
 = &
Img
[
pixMB1
.
pos_y
 ][pixMB1.
pos_x
];

470 
img³l
 *
imgQ
 = 
imgP
 + 
width
;

471 
³l
;

473  
³l
 = 0 ;…– < 
MB_BLOCK_SIZE
 ;…el += 4 )

475 if(*
SŒ’gth
 == 4 )

477 
pix–
;

478 
šc_dim2
 = 
width
 * 2;

479 
šc_dim3
 = 
width
 * 3;

480  
pix–
 = 0 ;…ix– < 
BLOCK_SIZE
 ; ++pixel )

482 
img³l
 *
SrcPŒP
 = 
imgP
++;

483 
img³l
 *
SrcPŒQ
 = 
imgQ
++;

484 
img³l
 
L0
 = *
SrcPŒP
;

485 
img³l
 
R0
 = *
SrcPŒQ
;

487 ifÐ
	`Ÿbs
Ð
R0
 - 
L0
 ) < 
AÍha
 )

489 
img³l
 
L1
 = *(
SrcPŒP
 - 
width
);

490 
img³l
 
R1
 = *(
SrcPŒQ
 + 
width
);

492 ià((
	`Ÿbs
Ð
R0
 - 
R1
è< 
B‘a
è&& (Ÿbs(
L0
 - 
L1
) < Beta))

494 
img³l
 
L2
 = *(
SrcPŒP
 - 
šc_dim2
);

495 
img³l
 
R2
 = *(
SrcPŒQ
 + 
šc_dim2
);

496 
RL0
 = 
L0
 + 
R0
;

497 
sm®l_g­
 = (
	`Ÿbs
Ð
R0
 - 
L0
 ) < ((
AÍha
 >> 2) + 2));

498 
aq
 = ( 
	`Ÿbs
Ð
R0
 - 
R2
è< 
B‘a
 ) & 
sm®l_g­
;

499 
­
 = ( 
	`Ÿbs
Ð
L0
 - 
L2
è< 
B‘a
 ) & 
sm®l_g­
;

501 ià(
­
)

503 
img³l
 
L3
 = *(
SrcPŒP
 - 
šc_dim3
);

504 *
SrcPŒP
 = (
img³l
è(Ð
R1
 + ((
L1
 + 
RL0
è<< 1è+ 
L2
 + 4) >> 3);

505 *(
SrcPŒP
 -ð
width
èð(
img³l
è(Ð
L2
 + 
L1
 + 
RL0
 + 2) >> 2);

506 *(
SrcPŒP
 - 
width
èð(
img³l
è((((
L3
 + 
L2
è<<1è+ L2 + 
L1
 + 
RL0
 + 4) >> 3);

510 *
SrcPŒP
 = (
img³l
è(((
L1
 << 1è+ 
L0
 + 
R1
 + 2) >> 2);

513 ià(
aq
)

515 
img³l
 
R3
 = *(
SrcPŒQ
 + 
šc_dim3
);

516 *(
SrcPŒQ
 ) = (
img³l
è(Ð
L1
 + ((
R1
 + 
RL0
è<< 1è+ 
R2
 + 4) >> 3);

517 *(
SrcPŒQ
 +ð
width
 ) = (
img³l
è(Ð
R2
 + 
R0
 + 
L0
 + 
R1
 + 2) >> 2);

518 *(
SrcPŒQ
 + 
width
 ) = (
img³l
è((((
R3
 + 
R2
è<<1è+ R2 + 
R1
 + 
RL0
 + 4) >> 3);

522 *
SrcPŒQ
 = (
img³l
è(((
R1
 << 1è+ 
R0
 + 
L1
 + 2) >> 2);

528 ifÐ*
SŒ’gth
 != 0)

530 
C0
 = 
ClTab
[ *
SŒ’gth
 ] * 
b™d•th_sÿË
;

531 
i
;

532 
img³l
 *
SrcPŒP
, *
SrcPŒQ
;

533 
edge_diff
;

534  
i
ð0 ; i < 
BLOCK_SIZE
 ; ++i )

536 
SrcPŒP
 = 
imgP
++;

537 
SrcPŒQ
 = 
imgQ
++;

538 
edge_diff
 = *
SrcPŒQ
 - *
SrcPŒP
;

540 ifÐ
	`Ÿbs
Ð
edge_diff
 ) < 
AÍha
 )

542 
img³l
 *
SrcPŒQ1
 = 
SrcPŒQ
 + 
width
;

543 
img³l
 *
SrcPŒP1
 = 
SrcPŒP
 - 
width
;

545 ià((
	`Ÿbs
Ð*
SrcPŒQ
 - *
SrcPŒQ1
è< 
B‘a
è&& (Ÿbs(*
SrcPŒP
 - *
SrcPŒP1
) < Beta))

547 
RL0
 = (*
SrcPŒP
 + *
SrcPŒQ
 + 1) >> 1;

548 
img³l
 
R2
 = *(
SrcPŒQ1
 + 
width
);

549 
img³l
 
L2
 = *(
SrcPŒP1
 - 
width
);

551 
aq
 = (
	`Ÿbs
(*
SrcPŒQ
 - 
R2
è< 
B‘a
);

552 
­
 = (
	`Ÿbs
(*
SrcPŒP
 - 
L2
è< 
B‘a
);

554 
tc0
 = (
C0
 + 
­
 + 
aq
) ;

555 
dif
 = 
	`iCl3
Ð-
tc0
,c0, (((
edge_diff
è<< 2è+ (*
SrcPŒP1
 - *
SrcPŒQ1
) + 4) >> 3 );

557 ifÐ
­
 )

558 *
SrcPŒP1
 +ð
	`iCl3
Ð-
C0
, C0, (
L2
 + 
RL0
 - (*SrcPtrP1<<1)) >> 1 );

560 ià(
dif
 != 0)

562 *
SrcPŒP
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, *SrcPŒP + 
dif
);

563 *
SrcPŒQ
 = (
img³l
è
	`iCl1
(
max_img³l_v®ue
, *SrcPŒQ - 
dif
);

566 ifÐ
aq
 )

567 *
SrcPŒQ1
 +ð
	`iCl3
Ð-
C0
, C0, (
R2
 + 
RL0
 - (*SrcPtrQ1<<1)) >> 1 );

574 
imgP
 += 4;

575 
imgQ
 += 4;

577 
SŒ’gth
 += 4;

581 
	}
}

590 
	$EdgeLoÝChromaV”
(
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
uv
)

592 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

594 
xQ
 = 
edge
 - 1;

595 
yQ
 = 0;

596 
Pix–Pos
 
pixMB1
;

598 
	`g‘NÚAffNeighbour
(
MbQ
, 
xQ
, 
yQ
, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
pixMB1
);

600 ià(
pixMB1
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
 == 0))

602 
b™d•th_sÿË
 = 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
];

603 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

605 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

606 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

607 
Maüoblock
 *
MbP
 = &(
p_Vid
->
mb_d©a
[
pixMB1
.
mb_addr
]);

610 
QP
 = (
MbP
->
qpc
[
uv
] + 
MbQ
->qpc[uv] + 1) >> 1;

612 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

613 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

615 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

616 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

617 ià((
AÍha
 | 
B‘a
) != 0)

619 cÚ¡ 
P–Num
 = 
³Êum_ü
[0][
p_Vid
->
yuv_fÜm©
];

620 cÚ¡ 
by‹
 *
ClTab
 = 
CLIP_TAB
[
šdexA
];

622 
³l
;

623 
pos_x1
 = 
pixMB1
.
pos_x
;

624 
img³l
 **
cur_img
 = &
Img
[
pixMB1
.
pos_y
];

626  
³l
 = 0 ;…– < 
P–Num
 ; ++pel )

628 
SŒng
 = 
SŒ’gth
[(
P–Num
 =ð8è? (((
³l
 >> 1) << 2) + (pel & 0x01)) :…el];

630 ifÐ
SŒng
 != 0)

632 
img³l
 *
SrcPŒP
 = *
cur_img
 + 
pos_x1
;

633 
img³l
 *
SrcPŒQ
 = 
SrcPŒP
 + 1;

634 
edge_diff
 = *
SrcPŒQ
 - *
SrcPŒP
;

636 iàÐ
	`Ÿbs
Ð
edge_diff
 ) < 
AÍha
 )

638 
img³l
 
R1
 = *(
SrcPŒQ
 + 1);

639 iàÐ
	`Ÿbs
(*
SrcPŒQ
 - 
R1
è< 
B‘a
 )

641 
img³l
 
L1
 = *(
SrcPŒP
 - 1);

642 iàÐ
	`Ÿbs
(*
SrcPŒP
 - 
L1
è< 
B‘a
 )

644 ifÐ
SŒng
 == 4 )

646 *
SrcPŒP
 = (
img³l
èÐ((
L1
 << 1è+ *SrcPŒP + 
R1
 + 2) >> 2 );

647 *
SrcPŒQ
 = (
img³l
èÐ((
R1
 << 1è+ *SrcPŒQ + 
L1
 + 2) >> 2 );

651 
tc0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
 + 1;

652 
dif
 = 
	`iCl3
Ð-
tc0
,c0, ( ((
edge_diff
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3 );

654 ià(
dif
 != 0)

656 *
SrcPŒP
 = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, *SrcPŒP + 
dif
 );

657 *
SrcPŒQ
 = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, *SrcPŒQ - 
dif
 );

664 
cur_img
++;

668 
	}
}

677 
	$EdgeLoÝChromaHÜ
(
img³l
** 
Img
, 
by‹
 
SŒ’gth
[16], 
Maüoblock
 *
MbQ
, 
edge
, 
width
, 
uv
)

679 
VideoP¬am‘”s
 *
p_Vid
 = 
MbQ
->p_Vid;

681 
xQ
 = 0;

682 
yQ
 = (
edge
 < 16 ?ƒdge - 1: 0);

683 
Pix–Pos
 
pixMB1
;

685 
	`g‘NÚAffNeighbour
(
MbQ
, 
xQ
, 
yQ
, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
pixMB1
);

687 ià(
pixMB1
.
avažabË
 || (
MbQ
->
DFDi§bËIdc
 == 0))

689 
b™d•th_sÿË
 = 
p_Vid
->b™d•th_sÿË[
IS_CHROMA
];

690 
max_img³l_v®ue
 = 
p_Vid
->
max_³l_v®ue_comp
[
uv
 + 1];

692 
AÍhaC0Off£t
 = 
MbQ
->
DFAÍhaC0Off£t
;

693 
B‘aOff£t
 = 
MbQ
->
DFB‘aOff£t
;

694 
Maüoblock
 *
MbP
 = &(
p_Vid
->
mb_d©a
[
pixMB1
.
mb_addr
]);

697 
QP
 = (
MbP
->
qpc
[
uv
] + 
MbQ
->qpc[uv] + 1) >> 1;

699 
šdexA
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
AÍhaC0Off£t
);

700 
šdexB
 = 
	`iCl3
(0, 
MAX_QP
, 
QP
 + 
B‘aOff£t
);

702 
AÍha
 = 
ALPHA_TABLE
[
šdexA
] * 
b™d•th_sÿË
;

703 
B‘a
 = 
BETA_TABLE
 [
šdexB
] * 
b™d•th_sÿË
;

704 ià((
AÍha
 | 
B‘a
) != 0)

706 cÚ¡ 
P–Num
 = 
³Êum_ü
[1][
p_Vid
->
yuv_fÜm©
];

707 cÚ¡ 
by‹
 *
ClTab
 = 
CLIP_TAB
[
šdexA
];

709 
³l
;

711 
img³l
 *
imgP
 = &
Img
[
pixMB1
.
pos_y
 ][pixMB1.
pos_x
];

712 
img³l
 *
imgQ
 = 
imgP
 + 
width
 ;

714  
³l
 = 0 ;…– < 
P–Num
 ; ++pel )

716 
SŒng
 = 
SŒ’gth
[(
P–Num
 =ð8è? (((
³l
 >> 1) << 2) + (pel & 0x01)) :…el];

718 ifÐ
SŒng
 != 0)

720 
img³l
 *
SrcPŒP
 = 
imgP
;

721 
img³l
 *
SrcPŒQ
 = 
imgQ
;

722 
edge_diff
 = *
imgQ
 - *
imgP
;

724 iàÐ
	`Ÿbs
Ð
edge_diff
 ) < 
AÍha
 )

726 
img³l
 
R1
 = *(
SrcPŒQ
 + 
width
);

727 iàÐ
	`Ÿbs
(*
SrcPŒQ
 - 
R1
è< 
B‘a
 )

729 
img³l
 
L1
 = *(
SrcPŒP
 - 
width
);

730 iàÐ
	`Ÿbs
(*
SrcPŒP
 - 
L1
è< 
B‘a
 )

732 ifÐ
SŒng
 == 4 )

734 *
SrcPŒP
 = (
img³l
èÐ((
L1
 << 1è+ *SrcPŒP + 
R1
 + 2) >> 2 );

735 *
SrcPŒQ
 = (
img³l
èÐ((
R1
 << 1è+ *SrcPŒQ + 
L1
 + 2) >> 2 );

739 
tc0
 = 
ClTab
[ 
SŒng
 ] * 
b™d•th_sÿË
 + 1;

740 
dif
 = 
	`iCl3
Ð-
tc0
,c0, ( ((
edge_diff
è<< 2è+ (
L1
 - 
R1
) + 4) >> 3 );

742 ià(
dif
 != 0)

744 *
SrcPŒP
 = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, *SrcPŒP + 
dif
 );

745 *
SrcPŒQ
 = (
img³l
è
	`iCl1
 ( 
max_img³l_v®ue
, *SrcPŒQ - 
dif
 );

752 
imgP
++;

753 
imgQ
++;

757 
	}
}

	@lencod/src/macroblock.c

21 
	~"cÚŒibutÜs.h
"

23 
	~<lim™s.h
>

24 
	~<m©h.h
>

26 
	~"glob®.h
"

27 
	~"’c_¡©i¡ics.h
"

29 
	~"block.h
"

30 
	~"–em’ts.h
"

31 
	~"maüoblock.h
"

32 
	~"mem®loc.h
"

33 
	~"blk_´ediùiÚ.h
"

34 
	~"mc_´ediùiÚ.h
"

35 
	~"fmo.h
"

36 
	~"vlc.h
"

37 
	~"image.h
"

38 
	~"mb_acûss.h
"

39 
	~"¿‹ùl.h
"

40 
	~"ÿbac.h
"

41 
	~"bŸr›ncode.h
"

42 
	~"me_fuÎ£¬ch.h
"

43 
	~"me_fuÎç¡.h
"

44 
	~"symbÞ.h
"

45 
	~"cÚfÜmªû.h
"

46 
	~"md_commÚ.h
"

47 
	~"mv_´ediùiÚ.h
"

48 
	~"rdÝt.h
"

49 
	~"ŒªsfÜm.h
"

52 #ià
TRACE


53 
	#TRACE_SE
(
Œaû
,
¡r
è
	`¢´štf
Ñ¿û,
TRACESTRING_SIZE
,¡r)

	)

55 
	#TRACE_SE
(
Œaû
,
¡r
)

	)

59 
¦iû_too_big
 (
Sliû
 *
cu¼Sliû
, 
¾c_b™s
);

60 
wr™e_chroma_šŒa_´ed_mode
 (
Maüoblock
* 
cu¼MB
);

61 
wr™e_chroma_cÛff
 (
Maüoblock
* 
cu¼MB
);

62 
wr™e_CBP_ªd_Dquªt
 (
Maüoblock
* 
cu¼MB
);

75 
	$£t_MB_·¿m‘”s
 (
Sliû
 *
cu¼Sliû
, 
Maüoblock
 *
cu¼MB
)

77 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

78 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

80 
mb_addr
 = 
cu¼MB
->
mbAddrX
;

81 
p_Vid
->
cu¼’t_mb_Ä
 = 
mb_addr
;

83 
p_Vid
->
	`g‘_mb_block_pos
Õ_Vid->
PicPos
, 
cu¼MB
->
mbAddrX
, &cu¼MB->
mb_x
, &cu¼MB->
mb_y
);

85 
cu¼MB
->
block_x
 = cu¼MB->
mb_x
 << 2;

86 
cu¼MB
->
block_y
 = cu¼MB->
mb_y
 << 2;

88 
cu¼MB
->
pix_x
 = cu¼MB->
block_x
 << 2;

89 
cu¼MB
->
pix_y
 = cu¼MB->
block_y
 << 2;

91 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

93 ià(
cu¼MB
->
mb_f›ld
)

95 
p_Vid
->
pCurImg
 = (
mb_addr
 & 0x01è?…_Vid->
imgD©a
.
bÙ_d©a
[0] :…_Vid->imgD©a.
tÝ_d©a
[0];

96 
p_Vid
->
pImgOrg
[0] =…_Vid->
pCurImg
;

98 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

100 ià(
mb_addr
 & 0x01)

102 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
bÙ_d©a
[1];

103 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
bÙ_d©a
[2];

107 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
tÝ_d©a
[1];

108 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
tÝ_d©a
[2];

112 
cu¼MB
->
Ýix_y
 = (cu¼MB->
mb_y
 >> 1 ) << 4;

113 
cu¼MB
->
li¡_off£t
 = (
mb_addr
 & 0x01) ? 4 : 2;

117 
p_Vid
->
pCurImg
 =…_Vid->
imgD©a
.
äm_d©a
[0];

118 
p_Vid
->
pImgOrg
[0] =…_Vid->
imgD©a
.
äm_d©a
[0];

120 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

122 
p_Vid
->
pImgOrg
[1] =…_Vid->
imgD©a
.
äm_d©a
[1];

123 
p_Vid
->
pImgOrg
[2] =…_Vid->
imgD©a
.
äm_d©a
[2];

126 
cu¼MB
->
Ýix_y
 = cu¼MB->
block_y
 << 2;

127 
cu¼MB
->
li¡_off£t
 = 0;

132 
cu¼MB
->
Ýix_y
 = cu¼MB->
block_y
 << 2;

133 
cu¼MB
->
li¡_off£t
 = 0;

136 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

138 
cu¼MB
->
pix_c_x
 = (
p_Vid
->
mb_ü_size_x
 * cu¼MB->
pix_x
) >> 4;

139 
cu¼MB
->
pix_c_y
 = (
p_Vid
->
mb_ü_size_y
 * cu¼MB->
pix_y
) >> 4;

141 
cu¼MB
->
Ýix_c_y
 = (
p_Vid
->
mb_ü_size_y
 * cu¼MB->
Ýix_y
) >> 4;

145 
	}
}

155 
	$Ãxt_maüoblock
(
Maüoblock
 *
cu¼MB
)

157 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

158 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

159 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

160 
¦iû_ty³
 = 
cu¼Sliû
->slice_type;

161 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

162 
i
;

163 
StP¬am‘”s
 *
cur_¡©s
 = &
p_Vid
->
’c_piùu»
->
¡©s
;

165 ià(
mbB™s
->
mb_tÙ®
 > 
p_Vid
->
max_b™CouÁ
)

166 
	`´štf
("W¬nšg!!! Numb” oàb™ (%dèoàmaüoblock_Ïy”(èd©¨£em tØexûed defšed†im™ (%d).\n", 
mbB™s
->
mb_tÙ®
,
p_Vid
->
max_b™CouÁ
);

169 
cur_¡©s
->
b™_u£_mb_ty³
[
¦iû_ty³
] +ð
mbB™s
->
mb_mode
;

170 
cur_¡©s
->
tmp_b™_u£_cbp
[
¦iû_ty³
] +ð
mbB™s
->
mb_cbp
;

171 
cur_¡©s
->
b™_u£_cÛffC
[
¦iû_ty³
] +ð
mbB™s
->
mb_uv_cÛff
;

172 
cur_¡©s
->
b™_u£_cÛff
[0][
¦iû_ty³
] +ð
mbB™s
->
mb_y_cÛff
;

173 
cur_¡©s
->
b™_u£_cÛff
[1][
¦iû_ty³
] +ð
mbB™s
->
mb_cb_cÛff
;

174 
cur_¡©s
->
b™_u£_cÛff
[2][
¦iû_ty³
] +ð
mbB™s
->
mb_ü_cÛff
;

175 
cur_¡©s
->
b™_u£_d–_quªt
[
¦iû_ty³
] +ð
mbB™s
->
mb_d–_quªt
;

176 
cur_¡©s
->
b™_u£_¡uffšg_b™s
[
¦iû_ty³
] +ð
mbB™s
->
mb_¡uffšg
;

178 ià(
	`is_šŒa
(
cu¼MB
))

180 ++
cur_¡©s
->
šŒa_chroma_mode
[ (è
cu¼MB
->
c_»d_mode
];

183 ià((
cu¼MB
->
cbp
&15) != 0)

185 ++
cur_¡©s
->
mode_u£_ŒªsfÜm
[
¦iû_ty³
][
cu¼MB
->
mb_ty³
][cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
];

189 ++
cur_¡©s
->
mode_u£
[
¦iû_ty³
][
cu¼MB
->
mb_ty³
];

190 
cur_¡©s
->
b™_u£_mode
[
¦iû_ty³
][
cu¼MB
->
mb_ty³
] +ð
mbB™s
->
mb_š‹r
;

192 ià(
¦iû_ty³
 !ð
I_SLICE
)

194 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
)

196 
i
=0;i<4;++i)

198 ià(
cu¼MB
->
b8x8
[
i
].
mode
 > 0)

199 ++
cur_¡©s
->
mode_u£
[
¦iû_ty³
][(è
cu¼MB
->
b8x8
[
i
].
mode
];

201 ++
cur_¡©s
->
b8_mode_0_u£
[
¦iû_ty³
][
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
];

203 ià(
cu¼MB
->
b8x8
[
i
].
mode
 ==4)

205 ià((
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && (cu¼MB->
cbp
&15è!ð0è|| 
p_IÅ
->
T¿nsfÜm8x8Mode
 == 2)

206 ++
cur_¡©s
->
mode_u£_ŒªsfÜm
[
¦iû_ty³
][4][1];

208 ++
cur_¡©s
->
mode_u£_ŒªsfÜm
[
¦iû_ty³
][4][0];

212 ià(
cu¼MB
->
mb_ty³
 >ð0 && cu¼MB->mb_ty³ <=3 && ((cu¼MB->
cbp
&15) != 0))

214 ++
cur_¡©s
->
mode_u£_ŒªsfÜm
[
¦iû_ty³
][
cu¼MB
->
mb_ty³
][cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
];

219 
cur_¡©s
->
quªt
[
¦iû_ty³
] +ð
cu¼MB
->
qp
;

220 ++
cur_¡©s
->
num_maüoblocks
[
¦iû_ty³
];

221 
	}
}

223 
	$£t_chroma_qp
(
Maüoblock
* 
cu¼MB
)

225 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

226 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

227 
i
;

228 
i
 = 0; i <= 1; ++i)

230 
cu¼MB
->
qpc
[
i
] = (è
	`iCl3
 ( -
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
, 51, cu¼MB->
qp
 + 
p_Vid
->
chroma_qp_off£t
[i] );

231 
cu¼MB
->
qpc
[
i
] = (è(cu¼MB->qpc[i] < 0 ? cu¼MB->qpc[i] : 
QP_SCALE_CR
[currMB->qpc[i]]);

232 
cu¼MB
->
qp_sÿËd
[
i
 + 1] = (è(cu¼MB->
qpc
[i] + 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
);

234 
	}
}

242 
	$upd©e_qp
(
Maüoblock
 *
cu¼MB
)

244 
cu¼MB
->
qp_sÿËd
[
PLANE_Y
] = (è(cu¼MB->
qp
 + cu¼MB->
p_Sliû
->
b™d•th_luma_qp_sÿË
);

245 
	`£t_chroma_qp
(
cu¼MB
);

247 
	`£Ëù_ŒªsfÜm
(
cu¼MB
);

248 
	}
}

259 
	$»£t_maüoblock
(
Maüoblock
 *
cu¼MB
)

261 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

262 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

263 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

264 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

265 
PicMÙiÚP¬ams
 *
p_mÙiÚ
;

266 
j
, 
i
;

269 
j
=
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; ++j)

271 
i
 = 
cu¼MB
->
block_x
; i < cu¼MB->block_x + 
BLOCK_MULTIPLE
; ++i)

273 
p_mÙiÚ
 = &
mÙiÚ
[
j
][
i
];

274 
p_mÙiÚ
->
»f_pic
[
LIST_0
] = 
NULL
;

275 
p_mÙiÚ
->
»f_pic
[
LIST_1
] = 
NULL
;

276 
p_mÙiÚ
->
mv
 [
LIST_0
] = 
z”o_mv
;

277 
p_mÙiÚ
->
mv
 [
LIST_1
] = 
z”o_mv
;

278 
p_mÙiÚ
->
»f_idx
[
LIST_0
] = -1;

279 
p_mÙiÚ
->
»f_idx
[
LIST_1
] = -1;

285 
cu¼MB
->
mb_ty³
 = 0;

286 
cu¼MB
->
cbp_blk
 = 0;

287 
cu¼MB
->
cbp
 = 0;

288 
cu¼MB
->
c_»d_mode
 = 
DC_PRED_8
;

290 
cu¼Sliû
->
cmp_cbp
[1] = cu¼Sliû->cmp_cbp[2] = cu¼Sliû->
cu¼_cbp
[0] = currSlice->curr_cbp[1] = 0;

292 
	`mem£t
(
cu¼MB
->
cbp_b™s
 , 0, 3 * (
št64
));

293 
	`mem£t
(
cu¼MB
->
cbp_b™s_8x8
, 0, 3 * (
št64
));

295 
	`mem£t
 (
cu¼MB
->
mvd
, 0, 
BLOCK_CONTEXT
 * ());

296 
	`mem£t
 (
cu¼MB
->
šŒa_´ed_modes
, 
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

297 
	`mem£t
 (
cu¼MB
->
šŒa_´ed_modes8x8
, 
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

299 
cu¼MB
->
b8x8
[0].
b»d
 = 0;

300 
cu¼MB
->
b8x8
[1].
b»d
 = 0;

301 
cu¼MB
->
b8x8
[2].
b»d
 = 0;

302 
cu¼MB
->
b8x8
[3].
b»d
 = 0;

304 
cu¼MB
->
wr™e_mb
 = 
FALSE
;

308 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

310 
p_Vid
->
šŒa_block
[
cu¼MB
->
mbAddrX
] = 1;

314 
	`mem£t
(&
cu¼MB
->
b™s
, 0, (
B™CouÁ”
));

316 
cu¼MB
->
mš_rdco¡
 = 
DISTBLK_MAX
;

317 
cu¼MB
->
mš_dco¡
 = 
DISTBLK_MAX
;

318 
cu¼MB
->
mš_¿‹
 = 
DISTBLK_MAX
;

320 
cu¼MB
->
be¡_mode
 = 0;

321 
cu¼MB
->
be¡_c_imode
 = 0;

322 
cu¼MB
->
be¡_i16off£t
 = 0;

323 
cu¼MB
->
be¡_cbp
 = 0;

324 
	}
}

342 
	$¡¬t_maüoblock
(
Sliû
 *
cu¼Sliû
, 
Maüoblock
 **
cu¼MB
, 
mb_addr
, 
BoÞ—n
 
mb_f›ld
)

344 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

345 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

346 
i
, 
mb_qp
;

347 
u£_b™¡»am_backšg
 = (
p_IÅ
->
¦iû_mode
 =ð
FIXED_RATE
 ||…_IÅ->¦iû_mod=ð
CALL_BACK
);

349 
Maüoblock
 *
Ï¡_coded_mb
 = 
NULL
;

351 
D©aP¬t™iÚ
 *
d©aP¬t
;

352 
B™¡»am
 *
cu¼SŒ—m
;

353 
´ev_mb
;

355 *
cu¼MB
 = &
p_Vid
->
mb_d©a
[
mb_addr
];

356 (*
cu¼MB
)->
p_Sliû
 = 
cu¼Sliû
;

357 (*
cu¼MB
)->
p_Vid
 =…_Vid;

358 (*
cu¼MB
)->
p_IÅ
 =…_Inp;

360 (*
cu¼MB
)->
mbAddrX
 = 
mb_addr
;

362 (*
cu¼MB
)->
is_šŒa_block
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
è? 
TRUE
 : 
FALSE
;

364 (*
cu¼MB
)->
mb_f›ld
 = (
by‹
) mb_field;

365 
p_Vid
->
’c_piùu»
->
mÙiÚ
.
mb_f›ld
[
mb_addr
] = (
by‹
) mb_field;

367 (*
cu¼MB
)->
is_f›ld_mode
 = (
by‹
è(
p_Vid
->
f›ld_piùu»
 || ( 
cu¼Sliû
->
mb_aff_äame_æag
 && (*cu¼MB)->
mb_f›ld
));

368 (*
cu¼MB
)->
´ev_»code_mb
 = 
FALSE
;

369 (*
cu¼MB
)->
DeblockC®l
 = 0;

371 (*
cu¼MB
)->
šŒa4x4_´ed
 = (*cu¼MB)->
šŒa4x4_´ed_buf
[
p_Vid
->
dpb_Ïy”_id
];

372 (*
cu¼MB
)->
šŒa8x8_´ed
 = (*cu¼MB)->
šŒa8x8_´ed_buf
[
p_Vid
->
dpb_Ïy”_id
];

373 (*
cu¼MB
)->
šŒa16x16_´ed
 = (*cu¼MB)->
šŒa16x16_´ed_buf
[
p_Vid
->
dpb_Ïy”_id
];

375 
	`£t_MB_·¿m‘”s
 (
cu¼Sliû
, *
cu¼MB
);

377 
´ev_mb
 = 
	`FmoG‘P»viousMBNr
(
p_Vid
, 
mb_addr
);

379 if(
u£_b™¡»am_backšg
)

381 ià((!
p_IÅ
->
MbIÁ”Ïû
)||((
mb_addr
 & 0x01)==0))

384 if(!
p_Vid
->
cod_couÁ”
)

386 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

388 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

389 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

390 
cu¼SŒ—m
->
¡Üed_b™s_to_go
 = cu¼SŒ—m->
b™s_to_go
;

391 
cu¼SŒ—m
->
¡Üed_by‹_pos
 = cu¼SŒ—m->
by‹_pos
;

392 
cu¼SŒ—m
->
¡Üed_by‹_buf
 = cu¼SŒ—m->
by‹_buf
;

393 
p_Vid
->
p_Sts
->
¡Üed_b™_¦iû
 =…_Vid->p_Sts->
b™_¦iû
;

395 ià(
cu¼Sliû
->
symbÞ_mode
 ==
CABAC
)

397 
d©aP¬t
->
“_»code
 = d©aP¬t->
“_ÿbac
;

406 (*
cu¼MB
)->
¦iû_Ä
 = 
cu¼Sliû
->slice_nr;

410 (*
cu¼MB
)->
qp¥
 = (è
p_Vid
->qpsp;

412 ià(
´ev_mb
 > -1 && (
p_Vid
->
mb_d©a
[´ev_mb].
¦iû_Ä
 =ð
cu¼Sliû
->slice_nr))

414 (*
cu¼MB
)->
P»vMB
 = &
p_Vid
->
mb_d©a
[
´ev_mb
];

415 (*
cu¼MB
)->
´ev_qp
 = (*cu¼MB)->
P»vMB
->
qp
;

416 (*
cu¼MB
)->
´ev_dqp
 = (*cu¼MB)->
´ev_qp
 - (*cu¼MB)->
P»vMB
->prev_qp;

420 
´ev_mb
 = - 1;

421 (*
cu¼MB
)->
P»vMB
 = 
NULL
;

422 (*
cu¼MB
)->
´ev_qp
 = (è
cu¼Sliû
->
qp
;

423 (*
cu¼MB
)->
´ev_dqp
 = 0;

426 if(
p_IÅ
->
RCEÇbË
 && (
Ï¡_coded_mb
 !ð*
cu¼MB
))

428 
mb_qp
 = 
	`rc_hªdË_mb
Ð*
cu¼MB
, 
´ev_mb
);

432 
mb_qp
 = 
p_Vid
->
qp
;

435 
Ï¡_coded_mb
 = *
cu¼MB
;

437 ià((*
cu¼MB
)->
mbAddrX
 == 0)

438 
p_Vid
->
BasicUn™QP
 = 
mb_qp
;

440 
mb_qp
 = 
	`iCl3
(-
cu¼Sliû
->
b™d•th_luma_qp_sÿË
, 51, mb_qp);

441 (*
cu¼MB
)->
qp
 = (è
mb_qp
;

442 
p_Vid
->
qp
 = 
mb_qp
;

444 
	`upd©e_qp
 (*
cu¼MB
);

448 ià(
p_Vid
->
aùive_µs
->
deblockšg_fž‹r_cÚŒÞ_´e£Á_æag
)

450 (*
cu¼MB
)->
DFDi§bËIdc
 = 
cu¼Sliû
->DFDisableIdc;

451 (*
cu¼MB
)->
DFAÍhaC0Off£t
 = 
cu¼Sliû
->DFAlphaC0Offset;

452 (*
cu¼MB
)->
DFB‘aOff£t
 = 
cu¼Sliû
->DFBetaOffset;

456 (*
cu¼MB
)->
DFDi§bËIdc
 = 0;

457 (*
cu¼MB
)->
DFAÍhaC0Off£t
 = 0;

458 (*
cu¼MB
)->
DFB‘aOff£t
 = 0;

460 (*
cu¼MB
)->
mš_rdco¡
 = 
DISTBLK_MAX
;

461 (*
cu¼MB
)->
mš_dco¡
 = 
DISTBLK_MAX
;

462 (*
cu¼MB
)->
mš_¿‹
 = 
DISTBLK_MAX
;

464 (*
cu¼MB
)->
i16mode
 = 0;

465 (*
cu¼MB
)->
be¡_mode
 = 10;

467 ià((
p_Vid
->
yuv_fÜm©
!=0) && (p_Vid->yuv_format!=3))

469 (*
cu¼MB
)->
cbp_lšfo_šŒa
 = 
cbp_lšfo_šŒa_nÜm®
;

470 (*
cu¼MB
)->
cbp_lšfo_š‹r
 = 
cbp_lšfo_š‹r_nÜm®
;

474 (*
cu¼MB
)->
cbp_lšfo_šŒa
 = 
cbp_lšfo_šŒa_Ùh”
;

475 (*
cu¼MB
)->
cbp_lšfo_š‹r
 = 
cbp_lšfo_š‹r_Ùh”
;

479 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

481 
	`š™_mÙiÚ_veùÜ_´ediùiÚ
(*
cu¼MB
, 
cu¼Sliû
->
mb_aff_äame_æag
);

482 
	`š™_ME_’gše
(*
cu¼MB
);

486 
	`CheckAvažabž™yOfNeighbÜs
(*
cu¼MB
);

488 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

489 
	`CheckAvažabž™yOfNeighbÜsCABAC
(*
cu¼MB
);

491 
	`»£t_maüoblock
(*
cu¼MB
);

493 ià((
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
FAST_FULL_SEARCH
è&& (!p_IÅ->
IÁ¿Profže
))

494 
	`»£t_ç¡_fuÎ_£¬ch
 (
p_Vid
);

497 #ià
TRACE


498 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i )

500 
cu¼Sliû
->
·¹A¼
[
i
].
b™¡»am
->
Œaû_’abËd
 = 
FALSE
;

503 
	}
}

512 
	$’d_maüoblock
(
Maüoblock
 *
cu¼MB
,

513 
BoÞ—n
 *
’d_of_¦iû
,

514 
BoÞ—n
 *
»code_maüoblock


517 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

518 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

519 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

520 
i
;

521 
SyÁaxEËm’t
 
£
;

522 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

523 
D©aP¬t™iÚ
 *
d©aP¬t
;

524 
B™¡»am
 *
cu¼SŒ—m
;

525 
¾c_b™s
=0;

526 
u£_b™¡»am_backšg
 = (
p_IÅ
->
¦iû_mode
 =ð
FIXED_RATE
 ||…_IÅ->¦iû_mod=ð
CALL_BACK
);

527 
sk
 = 
FALSE
;

528 
Ãw_¦iû
 = 0;

532 ià((
cu¼MB
->
mbAddrX
 =ð0è|| cu¼MB->
P»vMB
 =ð
NULL
 || ( cu¼MB->P»vMB->
¦iû_Ä
 !ð
cu¼Sliû
->slice_nr ))

533 
Ãw_¦iû
=1;

535 *
»code_maüoblock
=
FALSE
;

537 
p_IÅ
->
¦iû_mode
)

539 
NO_SLICES
:

540 ++
cu¼Sliû
->
num_mb
;

541 *
»code_maüoblock
 = 
FALSE
;

542 ià((
cu¼Sliû
->
num_mb
è=ð()
p_Vid
->
PicSizeInMbs
)

543 *
’d_of_¦iû
 = 
TRUE
;

546 *
’d_of_¦iû
 = (
BoÞ—n
è(*’d_of_¦iû | (
cu¼MB
->
mbAddrX
 =ð
	`FmoG‘La¡CodedMBOfSliûGroup
 (
p_Vid
, 
	`FmoMB2SliûGroup
 (p_Vid, currMB->mbAddrX))));

549 
FIXED_MB
:

551 ++
cu¼Sliû
->
num_mb
;

552 *
»code_maüoblock
 = 
FALSE
;

554 *
’d_of_¦iû
 = (
BoÞ—n
è(
cu¼MB
->
mbAddrX
 =ð
	`FmoG‘La¡CodedMBOfSliûGroup
 (
p_Vid
, 
	`FmoMB2SliûGroup
 (p_Vid, currMB->mbAddrX)));

556 *
’d_of_¦iû
 = (
BoÞ—n
è(*’d_of_¦iû | (
cu¼Sliû
->
num_mb
 >ð
p_IÅ
->
¦iû_¬gum’t
));

563 
FIXED_RATE
:

566 if(
p_Vid
->
cod_couÁ”
)

569 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

570 
£
.
v®ue2
 = 0;

571 
£
.
ty³
 = 
SE_MBTYPE
;

572 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

574 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_run");

575 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

576 
¾c_b™s
=
£
.
Ën
;

578 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

580 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

581 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

583 
cu¼SŒ—m
->
b™s_to_go_sk
 = cu¼SŒ—m->
b™s_to_go
;

584 
cu¼SŒ—m
->
by‹_pos_sk
 = cu¼SŒ—m->
by‹_pos
;

585 
cu¼SŒ—m
->
by‹_buf_sk
 = cu¼SŒ—m->
by‹_buf
;

587 
cu¼SŒ—m
->
b™s_to_go
 = cu¼SŒ—m->
¡Üed_b™s_to_go
;

588 
cu¼SŒ—m
->
by‹_pos
 = cu¼SŒ—m->
¡Üed_by‹_pos
;

589 
cu¼SŒ—m
->
by‹_buf
 = cu¼SŒ—m->
¡Üed_by‹_buf
;

591 
sk
 = 
TRUE
;

595 ià(!
Ãw_¦iû
)

597 if(
	`¦iû_too_big
(
cu¼Sliû
, 
¾c_b™s
))

599 *
»code_maüoblock
 = 
TRUE
;

600 *
’d_of_¦iû
 = 
TRUE
;

602 if(!
p_Vid
->
cod_couÁ”
)

603 
sk
 = 
FALSE
;

608 ià((*
»code_maüoblock
 =ð
FALSE
è&& (
cu¼MB
->
mbAddrX
 =ð
	`FmoG‘La¡CodedMBOfSliûGroup
 (
p_Vid
, 
	`FmoMB2SliûGroup
 (p_Vid, currMB->mbAddrX))))

610 *
’d_of_¦iû
 = 
TRUE
;

611 if(!
p_Vid
->
cod_couÁ”
)

612 
sk
 = 
FALSE
;

616 ià(
Ãw_¦iû
 && 
	`¦iû_too_big
(
cu¼Sliû
, 
¾c_b™s
))

618 *
’d_of_¦iû
 = 
TRUE
;

619 if(!
p_Vid
->
cod_couÁ”
)

620 
sk
 = 
FALSE
;

622 ià(!*
»code_maüoblock
)

623 ++
cu¼Sliû
->
num_mb
;

626 
CALL_BACK
:

627 ià(
cu¼MB
->
mbAddrX
 > 0 && !
Ãw_¦iû
)

629 ià(
cu¼Sliû
->
	`¦iû_too_big
(
¾c_b™s
))

631 *
»code_maüoblock
 = 
TRUE
;

632 *
’d_of_¦iû
 = 
TRUE
;

636 iàÐ(*
»code_maüoblock
 =ð
FALSE
è&& (
cu¼MB
->
mbAddrX
 =ð
	`FmoG‘La¡CodedMBOfSliûGroup
 (
p_Vid
, 
	`FmoMB2SliûGroup
 (p_Vid, currMB->mbAddrX))))

637 *
’d_of_¦iû
 = 
TRUE
;

641 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Sliû Mod%d‚Ù suµÜ‹d", 
p_IÅ
->
¦iû_mode
);

642 
	`”rÜ
(
”rÜ‹xt
, 600);

645 ià(*
»code_maüoblock
 =ð
TRUE
)

648 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

650 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

651 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

652 
cu¼SŒ—m
->
b™s_to_go
 = cu¼SŒ—m->
¡Üed_b™s_to_go
;

653 
cu¼SŒ—m
->
by‹_pos
 = cu¼SŒ—m->
¡Üed_by‹_pos
;

654 
cu¼SŒ—m
->
by‹_buf
 = cu¼SŒ—m->
¡Üed_by‹_buf
;

655 
p_Vid
->
p_Sts
->
b™_¦iû
 =…_Vid->p_Sts->
¡Üed_b™_¦iû
;

657 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

659 
d©aP¬t
->
“_ÿbac
 = d©aP¬t->
“_»code
;

664 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

667 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

668 if(*
’d_of_¦iû
 =ð
TRUE
 && 
sk
 == TRUE)

672 if(
p_Vid
->
cod_couÁ”
 && *
»code_maüoblock
 =ð
TRUE
)

676 
p_Vid
->
cod_couÁ”
--;

677 if(
p_Vid
->
cod_couÁ”
)

679 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

680 
£
.
v®ue2
 = 0;

681 
£
.
ty³
 = 
SE_MBTYPE
;

682 #ià
TRACE


683 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "Fš® MB„uÆ’gth = %3d",
p_Vid
->
cod_couÁ”
);

685 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

686 
¾c_b™s
=
£
.
Ën
;

687 
cu¼MB
->
b™s
.
mb_mode
 = cu¼MB->b™s.mb_mod+ (è
¾c_b™s
;

688 
p_Vid
->
cod_couÁ”
 = 0;

693 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

695 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

696 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

698 
cu¼SŒ—m
->
b™s_to_go
 = cu¼SŒ—m->
b™s_to_go_sk
;

699 
cu¼SŒ—m
->
by‹_pos
 = cu¼SŒ—m->
by‹_pos_sk
;

700 
cu¼SŒ—m
->
by‹_buf
 = cu¼SŒ—m->
by‹_buf_sk
;

703 
p_Vid
->
cod_couÁ”
 = 0;

704 
sk
 = 
FALSE
;

709 if(*
’d_of_¦iû
 =ð
TRUE
 && 
p_Vid
->
cod_couÁ”
 && !
u£_b™¡»am_backšg
)

711 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

712 
£
.
v®ue2
 = 0;

713 
£
.
ty³
 = 
SE_MBTYPE
;

715 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_run");

716 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

718 
¾c_b™s
=
£
.
Ën
;

719 
cu¼MB
->
b™s
.
mb_mode
 = cu¼MB->b™s.mb_mod+ (è
¾c_b™s
;

720 
p_Vid
->
cod_couÁ”
 = 0;

723 
	}
}

746 
	$¦iû_too_big
(
Sliû
 *
cu¼Sliû
, 
¾c_b™s
)

748 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

749 
D©aP¬t™iÚ
 *
d©aP¬t
;

750 
B™¡»am
 *
cu¼SŒ—m
;

751 
EncodšgEnvœÚm’tPŒ
 
“p
;

752 
i
;

753 
size_š_by‹s
;

756 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

758 
i
 = 0; i < 
cu¼Sliû
->
max_·¹_Ä
; ++i)

760 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

761 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

762 
size_š_by‹s
 = 
cu¼SŒ—m
->
by‹_pos
 ;

764 ià(
cu¼SŒ—m
->
b™s_to_go
 < 8)

765 ++
size_š_by‹s
;

766 ià(
cu¼SŒ—m
->
b™s_to_go
 < 
¾c_b™s
)

767 ++
size_š_by‹s
;

768 if(
size_š_by‹s
 > 
p_IÅ
->
¦iû_¬gum’t
)

769  
TRUE
;

774 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

776 
d©aP¬t
ð&(
cu¼Sliû
->
·¹A¼
[
i
]);

777 
“p
 = &(
d©aP¬t
->
“_ÿbac
);

779 ifÐ
	`¬›nco_b™s_wr™‹n
(
“p
è> (
p_IÅ
->
¦iû_¬gum’t
*8))

780  
TRUE
;

784  
FALSE
;

785 
	}
}

806 
	$»£t_block
(
Maüoblock
* 
cu¼MB
, *
cbp
, 
št64
 *
cbp_blk
, 
block8x8
)

808 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

809 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

810 
i
, 
j
;

811 
mb_y
 = (
block8x8
 >> 1) << 3;

812 
mb_x
 = (
block8x8
 & 0x01) << 3;

813 
cbp_mask
 = 1 << 
block8x8
;

815 (*
cbp
è&ð(63 - 
cbp_mask
);

816 (*
cbp_blk
è&ð~(51 << (4 * 
block8x8
 - 2 * (block8x8 & 0x01)));

818 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[
block8x8
][0][0], 0, 4 * 2 * 65 * ());

820 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[0][mb_y], cu¼MB->
pix_x
 + 
mb_x
, mb_x);

822 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

824 
i
 = 
mb_x
; i < mb_x + 
BLOCK_SIZE_8x8
; i +ð
BLOCK_SIZE
)

825 
j
 = 
mb_y
; j < mb_y + 
BLOCK_SIZE_8x8
; j +ð
BLOCK_SIZE
)

826 
	`cÝyblock_¥
(
cu¼MB
, 
PLANE_Y
, 
i
, 
j
);

830 
	}
}

841 
	$luma_»sidu®_codšg_16x16
 (
Maüoblock
* 
cu¼MB
,

842 
block8x8
,

843 
li¡_mode
[2]

847 *
cbp
 = &(
cu¼MB
->cbp);

848 
št64
 *
cbp_blk
 = &(
cu¼MB
->cbp_blk);

849 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

850 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

851 
nÚz”o
 = 0, 
cbp_blk_mask
;

852 
cÛff_co¡
 = 0;

853 
mb_y
 = (
block8x8
 >> 1) << 3;

854 
mb_x
 = (
block8x8
 & 0x01) << 3;

855 
cbp_mask
 = 1 << 
block8x8
;

857 
sk³d
 = (
li¡_mode
[0] =ð0 &&†i¡_mode[1] =ð0 && (
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
));

862 if(!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

865 ià(!
sk³d
 && ( (
cu¼Sliû
->
NoResidueDœeù
 !ð1è|| (
cu¼MB
->
qp_sÿËd
[
PLANE_Y
] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 1) ))

867 
block_y
, 
block_x
;

869 
block_y
=
mb_y
; block_y<mb_y + 8; block_y += 4)

871 
block_x
=
mb_x
; block_x<mb_x + 8; block_x += 4)

874 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
cÛff_co¡
, 0);

876 ià(
nÚz”o
)

878 
cbp_blk_mask
 = (
block_x
 >> 2è+ 
block_y
;

879 (*
cbp_blk
è|ð(
št64
è1 << 
cbp_blk_mask
;

880 (*
cbp
è|ð
cbp_mask
;

888 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
)

890 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

891 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
block8x8
, &
cÛff_co¡
, 0);

893 ià(
nÚz”o
)

895 (*
cbp_blk
è|ð51 << (4*
block8x8
 - 2*(block8x8 & 0x01));

896 (*
cbp
è|ð
cbp_mask
;

901 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && 
cÛff_co¡
 <ð
_LUMA_COEFF_COST_
 &&

902 ((
cu¼MB
->
qp_sÿËd
[
PLANE_Y
])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

904 
cÛff_co¡
 = 
	`»£t_block
(
cu¼MB
, 
cbp
, 
cbp_blk
, 
block8x8
);

907  
cÛff_co¡
;

908 
	}
}

919 
	$luma_»sidu®_codšg_8x8
 (
Maüoblock
* 
cu¼MB
,

920 *
cbp
,

921 
št64
 *
cbp_blk
,

922 
block8x8
,

923 
p_dœ
,

924 
li¡_mode
[2],

925 *
»f_idx
)

927 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

928 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

929 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

930 
block_y
, 
block_x
, 
pic_pix_x
, 
nÚz”o
 = 0, 
cbp_blk_mask
;

931 
cÛff_co¡
 = 0;

932 
mb_y
 = (
block8x8
 >> 1) << 3;

933 
mb_x
 = (
block8x8
 & 0x01) << 3;

934 
cbp_mask
 = 1 << 
block8x8
;

935 
sk³d
 = (
li¡_mode
[0] =ð0 &&†i¡_mode[1] =ð0 && (
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
));

936 
BoÞ—n
 
dœeù_šã»nû
 = (
li¡_mode
[0] =ð0 &&†i¡_mode[1] =ð0 && 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 == 0);

938 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8x8
].
b»d
;

939 
cu¼Sliû
->
cÛff_co¡_ü
[1] = currSlice->coeff_cost_cr[2] = 0;

944 if(!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

946 
bxx
, 
byy
;

947 ià(!
dœeù_šã»nû
 && (((
p_dœ
 =ð0 ||…_dœ =ð2 )&& 
li¡_mode
[0] < 5) || ((p_dir == 1 ||…_dir == 2 ) &&†ist_mode[1] < 5)))

949 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
mb_x
, 
mb_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

952 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[0][mb_y], &cu¼Sliû->
mb_Ües
[0][mb_y], 
mb_x
, cu¼MB->
pix_x
 + mb_x, 8, 8);

955 
byy
=0, 
block_y
=
mb_y
; block_y<mb_y+8; byy+=4, block_y+=4)

957 
bxx
=0, 
block_x
=
mb_x
; block_x<mb_x+8; bxx+=4, block_x+=4)

959 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

960 
cbp_blk_mask
 = (
block_x
 >> 2è+ 
block_y
;

963 ià(
dœeù_šã»nû
 || !(((
p_dœ
 =ð0 ||…_dœ =ð2 )&& 
li¡_mode
[0] < 5) || ((p_dir == 1 ||…_dir == 2 ) &&†ist_mode[1] < 5)))

965 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
block_x
, 
block_y
, 4, 4, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

968 
	`compu‹_»sidue
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[0][block_y], &cu¼Sliû->
mb_Ües
[0][block_y], 
block_x
, 
pic_pix_x
, 4, 4);

972 ià(!
sk³d
 && ( (
cu¼Sliû
->
NoResidueDœeù
 !ð1è|| (
cu¼MB
->
qp_sÿËd
[
PLANE_Y
] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 1) ))

975 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
cÛff_co¡
, 0);

977 ià(
nÚz”o
)

979 (*
cbp_blk
è|ð(
št64
)1 << 
cbp_blk_mask
;

980 (*
cbp
è|ð
cbp_mask
;

988 
block_y
 = 
mb_y
;

989 
block_x
 = 
mb_x
;

990 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

992 
cbp_blk_mask
 = (
block_x
>>2è+ 
block_y
;

995 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
block_x
, 
block_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

998 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[0][block_y], &cu¼Sliû->
mb_Ües
[0][block_y], 
block_x
, 
pic_pix_x
, 8, 8);

1000 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
)

1002 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

1003 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
block8x8
, &
cÛff_co¡
, 0);

1005 ià(
nÚz”o
)

1007 (*
cbp_blk
è|ð51 << (4*
block8x8
 - 2*(block8x8 & 0x01));

1008 (*
cbp
è|ð
cbp_mask
;

1013 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && 
cÛff_co¡
 <ð
_LUMA_COEFF_COST_
 &&

1014 ((
cu¼MB
->
qp_sÿËd
[
PLANE_Y
])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

1016 
cÛff_co¡
 = 
	`»£t_block
(
cu¼MB
, 
cbp
, 
cbp_blk
, 
block8x8
);

1019  
cÛff_co¡
;

1020 
	}
}

1028 
	$£t_modes_ªd_»äame
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
)

1030 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1031 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1032 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1033 
j
 = 2*(
b8
>>1);

1034 
i
 = 2*(
b8
 & 0x01);

1036 
li¡_mode
[0] =†i¡_mode[1] = 
li¡_»f_idx
[0] =†ist_ref_idx[1] = -1;

1038 *
p_dœ
 = 
cu¼MB
->
b8x8
[
b8
].
pdœ
;

1040 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

1042 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1043 
li¡_»f_idx
[1] = 0;

1044 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1045 
li¡_mode
[1] = 0;

1049 ià(*
p_dœ
 == -1)

1051 
li¡_»f_idx
[0] = -1;

1052 
li¡_»f_idx
[1] = -1;

1053 
li¡_mode
[0] = 0;

1054 
li¡_mode
[1] = 0;

1056 ià(*
p_dœ
 == 0)

1058 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1059 
li¡_»f_idx
[1] = 0;

1060 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1061 
li¡_mode
[1] = 0;

1063 ià(*
p_dœ
 == 1)

1065 
li¡_»f_idx
[0] = 0;

1066 
li¡_»f_idx
[1] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_1
];

1067 
li¡_mode
[0] = 0;

1068 
li¡_mode
[1] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1072 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1073 
li¡_»f_idx
[1] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_1
];

1074 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1075 
li¡_mode
[1] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1078 
	}
}

1087 
	$£t_modes_ªd_»äame_i_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
)

1089 *
p_dœ
 = 
cu¼MB
->
b8x8
[
b8
].
pdœ
;

1091 
li¡_»f_idx
[0] = -1;

1092 
li¡_»f_idx
[1] = 0;

1093 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1094 
li¡_mode
[1] = 0;

1095 
	}
}

1103 
	$£t_modes_ªd_»äame_p_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
)

1105 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1106 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1107 
j
 = 2*(
b8
>>1);

1108 
i
 = 2*(
b8
 & 0x01);

1110 *
p_dœ
 = 
cu¼MB
->
b8x8
[
b8
].
pdœ
;

1112 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1113 
li¡_»f_idx
[1] = 0;

1114 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1115 
li¡_mode
[1] = 0;

1116 
	}
}

1126 
	$£t_modes_ªd_»äame_b_¦iû
 (
Maüoblock
* 
cu¼MB
, 
b8
, * 
p_dœ
, 
li¡_mode
[2], *
li¡_»f_idx
)

1128 *
p_dœ
 = 
cu¼MB
->
b8x8
[
b8
].
pdœ
;

1130 ià(*
p_dœ
 == -1)

1132 
li¡_»f_idx
[0] = -1;

1133 
li¡_»f_idx
[1] = -1;

1134 
li¡_mode
[0] = 0;

1135 
li¡_mode
[1] = 0;

1137 ià(*
p_dœ
 == 0)

1139 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1140 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1141 
j
 = 2*(
b8
>>1);

1142 
i
 = 2*(
b8
 & 0x01);

1144 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1145 
li¡_»f_idx
[1] = 0;

1146 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1147 
li¡_mode
[1] = 0;

1149 ià(*
p_dœ
 == 1)

1151 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1152 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1153 
j
 = 2*(
b8
>>1);

1154 
i
 = 2*(
b8
 & 0x01);

1156 
li¡_»f_idx
[0] = 0;

1157 
li¡_»f_idx
[1] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_1
];

1158 
li¡_mode
[0] = 0;

1159 
li¡_mode
[1] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1163 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1164 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1165 
j
 = 2*(
b8
>>1);

1166 
i
 = 2*(
b8
 & 0x01);

1168 
li¡_»f_idx
[0] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
];

1169 
li¡_»f_idx
[1] = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_1
];

1170 
li¡_mode
[0] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1171 
li¡_mode
[1] = 
cu¼MB
->
b8x8
[
b8
].
mode
;

1173 
	}
}

1182 
	$luma_»sidu®_codšg
 (
Maüoblock
 *
cu¼MB
)

1184 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1185 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1186 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1188 
block8x8
;

1189 
li¡_mode
[2];

1190 
li¡_»f_idx
[2];

1191 
p_dœ
 = 0;

1193 
is_sk
 = 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 && 
cu¼MB
->
mb_ty³
 =ð
PSKIP
;

1195 
cu¼MB
->
cbp
 = 0;

1196 
cu¼MB
->
cbp_blk
 = 0;

1198 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1199 
cu¼Sliû
->
cur_cbp_blk
[1] = currSlice->cur_cbp_blk[2] = 0;

1201 ià(
is_sk
)

1203 
block8x8
=0; block8x8<4; ++block8x8)

1205 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1209 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 0, 0, 16, 16, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
, cu¼MB->
b8x8
[0].
b»d
);

1213 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], *
cu¼Sliû
->
mb_´ed
, *cu¼Sliû->
mb_Ües
, 0, cu¼MB->
pix_x
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1215 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], *
cu¼Sliû
->
mb_´ed
, cu¼MB->
pix_x
, 0);

1219 
sum_út_nÚz
 = 0;

1220 ià(
cu¼MB
->
mb_ty³
 =ð
P16x16
)

1222 
block8x8
 = 0; block8x8 < 4; ++block8x8)

1224 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1227 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 0, 0, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
, cu¼MB->
b8x8
[0].
b»d
);

1230 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], *
cu¼Sliû
->
mb_´ed
, *cu¼Sliû->
mb_Ües
, 0, cu¼MB->
pix_x
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1233 
block8x8
 = 0; block8x8 < 4; ++block8x8)

1235 
sum_út_nÚz
 +ð
	`luma_»sidu®_codšg_16x16
 (
cu¼MB
, 
block8x8
, 
li¡_mode
);

1240 
block8x8
 = 0; block8x8 < 4; ++block8x8)

1242 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1243 
sum_út_nÚz
 +ð
cu¼Sliû
->
	`luma_»sidu®_codšg_8x8
 (
cu¼MB
, &(cu¼MB->
cbp
), &(cu¼MB->
cbp_blk
), 
block8x8
, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1248 ià(
sum_út_nÚz
 <ð
_LUMA_MB_COEFF_COST_
 && ((
cu¼MB
->
qp_sÿËd
[
PLANE_Y
])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 0))

1250 
cu¼MB
->
cbp
 &= 0xfffff0 ;

1251 
cu¼MB
->
cbp_blk
 &= 0xff0000 ;

1253 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
cu¼Sliû
->
mb_´ed
[0], cu¼MB->
pix_x
, 0);

1257 
	}
}

1266 
	$luma_»sidu®_codšg_¥
 (
Maüoblock
 *
cu¼MB
)

1268 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1269 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1270 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1272 
i
, 
j
, 
block8x8
, 
b8_x
, 
b8_y
;

1273 
li¡_mode
[2];

1274 
li¡_»f_idx
[2];

1275 
p_dœ
 = 0;

1276 
sum_út_nÚz
 = 0;

1278 
is_sk
 = 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 && 
cu¼MB
->
mb_ty³
 =ð
PSKIP
;

1280 
cu¼MB
->
cbp
 = 0;

1281 
cu¼MB
->
cbp_blk
 = 0;

1283 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1284 
cu¼Sliû
->
cur_cbp_blk
[1] = currSlice->cur_cbp_blk[2] = 0;

1286 ià(
is_sk
 || 
cu¼MB
->
mb_ty³
 == 1)

1288 
block8x8
=0; block8x8<4; ++block8x8)

1290 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1294 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 0, 0, 16, 16, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
, cu¼MB->
b8x8
[0].
b»d
);

1298 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], &
cu¼Sliû
->
mb_´ed
[0][0], &cu¼Sliû->
mb_Ües
[0][0], 0, cu¼MB->
pix_x
, 16, 16);

1301 ià(!
is_sk
)

1303 
block8x8
=0; block8x8<4; ++block8x8)

1305 
sum_út_nÚz
 +ð
	`luma_»sidu®_codšg_16x16
 (
cu¼MB
, 
block8x8
, 
li¡_mode
);

1311 
block8x8
=0; block8x8<4; ++block8x8)

1313 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1314 
sum_út_nÚz
 +ð
cu¼Sliû
->
	`luma_»sidu®_codšg_8x8
 (
cu¼MB
, &(cu¼MB->
cbp
), &(cu¼MB->
cbp_blk
), 
block8x8
, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1320 ià((
is_sk
 ||

1321 (
sum_út_nÚz
 <ð
_LUMA_MB_COEFF_COST_
 && ((
cu¼MB
->
qp_sÿËd
[
PLANE_Y
])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 0))))

1323 
cu¼MB
->
cbp
 &= 0xfffff0 ;

1324 
cu¼MB
->
cbp_blk
 &= 0xff0000 ;

1326 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
cu¼Sliû
->
mb_´ed
[0], cu¼MB->
pix_x
, 0);

1330 
block8x8
 = 0;block8x8 < 4; ++block8x8)

1332 
b8_x
=(
block8x8
&1)<<3;

1333 
b8_y
=(
block8x8
&2)<<2;

1334 
i
 = 
b8_x
; i < b8_x + 
BLOCK_SIZE_8x8
; i += 4)

1335 
j
 = 
b8_y
; j < b8_y + 
BLOCK_SIZE_8x8
;j += 4)

1336 
	`cÝyblock_¥
(
cu¼MB
, 
PLANE_Y
, 
i
, 
j
);

1339 
	}
}

1347 
by‹
 
	$ŒªsfÜm_decisiÚ
 (
Maüoblock
 *
cu¼MB
, 
block_check
, 
di¡blk
 *
co¡
)

1349 if(
cu¼MB
->
p_IÅ
->
T¿nsfÜm8x8Mode
 == 2)

1355 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1356 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1357 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1358 
pic_pix_y
, 
pic_pix_x
, 
i
, 
j
;

1359 
mb_y
, 
mb_x
, 
block8x8
;

1360 
li¡_mode
[2];

1361 
li¡_»f_idx
[2];

1362 
p_dœ
;

1363 
num_blks
;

1364 
di¡blk
 
co¡8x8
=0, 
co¡4x4
=0;

1365 
b»d_me
;

1366 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

1367 
diff16
[4][16];

1368 
diff64
[64];

1369 
šdex
;

1371 if(
block_check
 == -1)

1373 
block8x8
 = 0;

1374 
num_blks
 = 4;

1378 
block8x8
 = 
block_check
;

1379 
num_blks
 = 
block_check
 + 1;

1382 ; 
block8x8
<
num_blks
; ++block8x8)

1384 *
tmp64
 = 
diff64
;

1385 *
tmp16
[4];

1387 
tmp16
[0] = 
diff16
[0];

1388 
tmp16
[1] = 
diff16
[1];

1389 
tmp16
[2] = 
diff16
[2];

1390 
tmp16
[3] = 
diff16
[3];

1392 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1393 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8x8
].
b»d
;

1394 
mb_y
 = (
block8x8
 >> 1) << 3;

1395 
mb_x
 = (
block8x8
 & 0x01) << 3;

1398 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
mb_x
, 
mb_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
, 
b»d_me
);

1401 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

1402 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

1404 
j
 = 
mb_y
; j < 8 + mb_y; j++)

1406 
i
 = 
mb_x
; i < 8 + mb_x; i++)

1408 
šdex
 = 2 * ((
j
 - 
mb_y
)> 3è+ ((
i
 - 
mb_x
)> 3);

1409 *
tmp64
++ = *(
tmp16
[
šdex
])++ = (è(
p_Vid
->
pCurImg
[
pic_pix_y
 + 
j
][
pic_pix_x
 + 
i
] - 
mb_´ed
[j][i]);

1413 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[0], 
DISTBLK_MAX
);

1414 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[1], 
DISTBLK_MAX
);

1415 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[2], 
DISTBLK_MAX
);

1416 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[3], 
DISTBLK_MAX
);

1417 
co¡8x8
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
 (
diff64
 , 
DISTBLK_MAX
);

1421 if(
co¡8x8
 < 
co¡4x4
)

1427 *
co¡
 +ð(
co¡4x4
 - 
co¡8x8
);

1431 
	}
}

1439 
	$chroma_»sidu®_codšg
 (
Maüoblock
 *
cu¼MB
)

1441 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1442 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1443 
chroma_cbp
 = 0;

1444 
uv
, 
block_y
, 
block_x
;

1445 
li¡_mode
[2];

1446 
li¡_»f_idx
[2];

1447 
p_dœ
;

1448 
sk³d
 = (
cu¼MB
->
mb_ty³
 =ð0 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
));

1449 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

1451 
uv
 = 0; uv < 2; ++uv)

1455 ià(
cu¼MB
->
mb_ty³
 > 
P8x8
)

1457 
block_y
=0; block_y < 
p_Vid
->
mb_ü_size_y
; block_y +ð
BLOCK_SIZE
)

1459 
block_x
=0; block_x < 
p_Vid
->
mb_ü_size_x
; block_x +ð
BLOCK_SIZE
)

1461 
block8
 = 
block8x8_idx
[
yuv
][
block_y
>>2][
block_x
>>2];

1462 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1463 
	`IÁ¿ChromaP»diùiÚ4x4
 (
cu¼MB
, 
uv
 + 1, 
block_x
, 
block_y
);

1469 
block_y
 = 0; block_y < 
p_Vid
->
mb_ü_size_y
; block_y +ð
BLOCK_SIZE
)

1471 
block_x
 = 0; block_x < 
p_Vid
->
mb_ü_size_x
; block_x +ð
BLOCK_SIZE
)

1473 
block8
 = 
block8x8_idx
[
yuv
][
block_y
>>2][
block_x
>>2];

1474 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8
].
b»d
;

1475 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1477 
	`chroma_´ediùiÚ_4x4
 (
cu¼MB
, 
uv
, 
block_x
, 
block_y
, 
p_dœ
, 
li¡_mode
[0],†i¡_mode[1], 
li¡_»f_idx
[0],†i¡_»f_idx[1], 
b»d_me
);

1483 ià(
cu¼Sliû
->
NoResidueDœeù
)

1485 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
], 
cu¼Sliû
->
mb_´ed
[ uv + 1], cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1487 ià(
sk³d
)

1489 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
], 
cu¼Sliû
->
mb_´ed
[ uv + 1], cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1493 
	`compu‹_»sidue
(&
p_Vid
->
pImgOrg
[
uv
 + 1][
cu¼MB
->
Ýix_c_y
 ], 
cu¼Sliû
->
mb_´ed
[ uv + 1], cu¼Sliû->
mb_Ües
[uv + 1], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1496 
chroma_cbp
 = 
cu¼MB
->
»sidu®_ŒªsfÜm_quªt_chroma_4x4
[
uv
] (currMB, uv, chroma_cbp);

1501 
cu¼MB
->
cbp
 +ð((
chroma_cbp
) << 4);

1502 
	}
}

1510 
	$chroma_»sidu®_codšg_si
 (
Maüoblock
 *
cu¼MB
)

1512 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1513 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1514 
chroma_cbp
 = 0;

1515 
uv
, 
block_y
, 
block_x
;

1516 
li¡_mode
[2];

1517 
li¡_»f_idx
[2];

1518 
p_dœ
;

1519 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

1521 
uv
 = 0; uv < 2; ++uv)

1524 
block_y
=0; block_y < 
p_Vid
->
mb_ü_size_y
; block_y+=4)

1526 
block_x
=0; block_x < 
p_Vid
->
mb_ü_size_x
; block_x+=4)

1528 
block8
 = 
block8x8_idx
[
yuv
][
block_y
>>2][
block_x
>>2];

1529 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1530 
	`IÁ¿ChromaP»diùiÚ4x4
 (
cu¼MB
, 
uv
 + 1, 
block_x
, 
block_y
);

1534 
	`compu‹_»sidue
(&
p_Vid
->
pImgOrg
[
uv
 + 1][
cu¼MB
->
Ýix_c_y
 ], 
cu¼Sliû
->
mb_´ed
[ uv + 1], cu¼Sliû->
mb_Ües
[uv + 1], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1537 ià(
cu¼MB
->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³ =ð
I4MB
)

1539 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4
(
cu¼MB
, 
uv
, chroma_cbp);

1543 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
(
cu¼MB
, 
uv
, chroma_cbp);

1548 
cu¼MB
->
cbp
 +ð((
chroma_cbp
) << 4);

1549 
	}
}

1558 
	$chroma_»sidu®_codšg_¥
 (
Maüoblock
 *
cu¼MB
)

1560 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1561 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1562 
chroma_cbp
;

1563 
uv
, 
block_y
, 
block_x
, 
j
;

1564 
li¡_mode
[2];

1565 
li¡_»f_idx
[2];

1566 
p_dœ
;

1567 
sk³d
 = (
cu¼MB
->
mb_ty³
 == 0);

1568 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

1571 
chroma_cbp
 = 0, 
uv
=0; uv<2; ++uv)

1575 ià(
cu¼MB
->
mb_ty³
 > 
P8x8
)

1577 
block_y
=0; block_y < 
p_Vid
->
mb_ü_size_y
; block_y +ð
BLOCK_SIZE
)

1579 
block_x
=0; block_x < 
p_Vid
->
mb_ü_size_x
; block_x +ð
BLOCK_SIZE
)

1581 
block8
 = 
block8x8_idx
[
yuv
][
block_y
>>2][
block_x
>>2];

1582 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1583 
	`IÁ¿ChromaP»diùiÚ4x4
 (
cu¼MB
, 
uv
 + 1, 
block_x
, 
block_y
);

1589 
block_y
=0; block_y < 
p_Vid
->
mb_ü_size_y
; block_y +ð
BLOCK_SIZE
)

1591 
block_x
=0; block_x < 
p_Vid
->
mb_ü_size_x
; block_x +ð
BLOCK_SIZE
)

1593 
block8
 = 
block8x8_idx
[
yuv
][
block_y
>>2][
block_x
>>2];

1594 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8
].
b»d
;

1595 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

1597 
	`chroma_´ediùiÚ_4x4
 (
cu¼MB
, 
uv
, 
block_x
, 
block_y
, 
p_dœ
, 
li¡_mode
[0],†i¡_mode[1], 
li¡_»f_idx
[0],†i¡_»f_idx[1], 
b»d_me
);

1603 ià(
cu¼Sliû
->
NoResidueDœeù
)

1605 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
cu¼MB
->
pix_c_y
], 
cu¼Sliû
->
mb_´ed
[ uv + 1], cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1607 ià(
sk³d
)

1609 
j
=0; j<
p_Vid
->
mb_ü_size_y
; ++j)

1610 
	`mem£t
(
cu¼Sliû
->
mb_Ües
[
uv
 + 1][
j
], 0 , 
p_Vid
->
mb_ü_size_x
 * ());

1611 
j
=0; j<
p_Vid
->
mb_ü_size_y
; ++j)

1612 
	`mem£t
(
cu¼Sliû
->
mb_¼es
[
uv
 + 1][
j
], 0 , 
p_Vid
->
mb_ü_size_x
 * ());

1616 
	`compu‹_»sidue
(&
p_Vid
->
pImgOrg
[
uv
 + 1][
cu¼MB
->
Ýix_c_y
 ], &
cu¼Sliû
->
mb_´ed
[ uv + 1][0], &cu¼Sliû->
mb_Ües
[uv + 1][0], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1622 ià(
sk³d
)

1624 if(
p_Vid
->
¥2_äame_šdiÿtÜ
)

1625 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
(
cu¼MB
, 
uv
, chroma_cbp);

1627 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
(
cu¼MB
, 
uv
, chroma_cbp);

1631 ià(!
cu¼Sliû
->
NoResidueDœeù
 && !
sk³d
)

1633 ià(
cu¼MB
->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³ =ð
I4MB
)

1635 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4
(
cu¼MB
, 
uv
,chroma_cbp);

1639 if(
p_Vid
->
¥2_äame_šdiÿtÜ
)

1640 
chroma_cbp
 = 
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥2
(
cu¼MB
, 
uv
, chroma_cbp);

1642 
chroma_cbp
=
	`»sidu®_ŒªsfÜm_quªt_chroma_4x4_¥
(
cu¼MB
, 
uv
, chroma_cbp);

1649 
cu¼MB
->
cbp
 +ð((
chroma_cbp
)<<4);

1650 
	}
}

1658 
	$Z”oRef
 (
Maüoblock
* 
cu¼MB
)

1660 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
cu¼MB
->
p_Vid
->
’c_piùu»
->
mv_šfo
;

1661 
i
,
j
;

1663 
j
=
cu¼MB
->
block_y
; j<cu¼MB->block_y + 
BLOCK_MULTIPLE
; ++j)

1665 
i
=
cu¼MB
->
block_x
; i<cu¼MB->block_x + 
BLOCK_MULTIPLE
; ++i)

1667 ià(
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_0
] != 0)

1672 
	}
}

1681 
	$MBTy³2V®ue
 (
Maüoblock
* 
cu¼MB
)

1683 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1684 cÚ¡ 
dœ1off£t
[3] = { 1, 2, 3};

1685 cÚ¡ 
dœ2off£t
[3][3] = {{ 0, 4, 8},

1689 
si_¦iû
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
) ? 1 : 0;

1691 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

1693  
cu¼MB
->
mb_ty³
 )

1695 
I8MB
:

1696 
I4MB
:

1697  ((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || 
si_¦iû
) ? (0 + si_slice) : 6);

1699 
SI4MB
:

1702 
I16MB
:

1703  ((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || 
si_¦iû
è? (0 + si_¦iûè: 6è+ 
cu¼MB
->
i16off£t
;

1705 
IPCM
:

1706  ((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || 
si_¦iû
 ) ? (25 + si_slice) : 31);

1708 
P8x8
:

1710 ià(
cu¼Sliû
->
symbÞ_mode
==
CAVLC
 && 
	`Z”oRef
 (
cu¼MB
))

1717  
cu¼MB
->
mb_ty³
;

1723  
cu¼MB
->
mb_ty³
 )

1728 
I4MB
:

1729 
I8MB
:

1732 
I16MB
:

1733  23 + 
cu¼MB
->
i16off£t
;

1735 
IPCM
:

1738 
P8x8
:

1743 
pdœ0
 = 
cu¼MB
->
b8x8
[0].
pdœ
;

1744  
dœ1off£t
[
pdœ0
];

1749 
pdœ0
 = 
cu¼MB
->
b8x8
[0].
pdœ
;

1750 
pdœ1
 = 
cu¼MB
->
b8x8
[3].
pdœ
;

1752  4 + 
dœ2off£t
[
pdœ0
][
pdœ1
];

1757 
pdœ0
 = 
cu¼MB
->
b8x8
[0].
pdœ
;

1758 
pdœ1
 = 
cu¼MB
->
b8x8
[3].
pdœ
;

1759  5 + 
dœ2off£t
[
pdœ0
][
pdœ1
];

1764 
	}
}

1772 
	$wr™eIÁ¿4x4Modes
(
Maüoblock
 *
cu¼MB
)

1774 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1775 
i
;

1776 
SyÁaxEËm’t
 
£
;

1777 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

1778 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

1779 
D©aP¬t™iÚ
 *
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

1781 
¿‹
 = 0;

1783 
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 = 1;

1785 
i
 = 0; i < 16; ++i)

1787 
£
.
cÚ‹xt
 = 
i
;

1788 
£
.
v®ue1
 = 
cu¼MB
->
šŒa_´ed_modes
[
i
];

1789 
£
.
v®ue2
 = 0;

1791 #ià
TRACE


1792 ià(
£
.
v®ue1
 < 0 )

1793 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "IÁ¿ 4x4 mod =…»diùed (cÚ‹xt: %d)",£.
cÚ‹xt
);

1795 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "IÁ¿ 4x4 mod = %3d (cÚ‹xt: %d)",£.
v®ue1
,£.
cÚ‹xt
);

1799 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

1802 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

1804 
¿‹
 +ð
£
.
Ën
;

1807 
mbB™s
->
mb_mode
 +ð
¿‹
;

1809  
¿‹
;

1810 
	}
}

1818 
	$wr™eIÁ¿8x8Modes
(
Maüoblock
 *
cu¼MB
)

1820 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1821 
block8x8
;

1822 
SyÁaxEËm’t
 
£
;

1823 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

1824 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

1825 
D©aP¬t™iÚ
 *
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

1827 
¿‹
 = 0;

1829 
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 = 1;

1831 
block8x8
 = 0; block8x8 < 16; block8x8 += 4)

1834 
£
.
cÚ‹xt
 = 
block8x8
;

1835 
£
.
v®ue1
 = 
cu¼MB
->
šŒa_´ed_modes8x8
[
block8x8
];

1836 
£
.
v®ue2
 = 0;

1838 #ià
TRACE


1839 ià(
£
.
v®ue1
 < 0 )

1840 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "IÁ¿ 8x8 mod =…»diùed (cÚ‹xt: %d)",£.
cÚ‹xt
);

1842 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "IÁ¿ 8x8 mod = %3d (cÚ‹xt: %d)",£.
v®ue1
,£.
cÚ‹xt
);

1846 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

1849 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

1851 
¿‹
 +ð
£
.
Ën
;

1853 
mbB™s
->
mb_mode
 +ð
¿‹
;

1855  
¿‹
;

1856 
	}
}

1858 
	$wr™eIÁ¿Modes
(
Maüoblock
 *
cu¼MB
)

1860 
cu¼MB
->
mb_ty³
)

1862 
I4MB
:

1863  
	`wr™eIÁ¿4x4Modes
(
cu¼MB
);

1865 
I8MB
:

1866  
	`wr™eIÁ¿8x8Modes
(
cu¼MB
);

1872 
	}
}

1880 
	$B8Mode2V®ue
 (
Sliû
 *
cu¼Sliû
, 
b8mode
, 
b8pdœ
)

1882 cÚ¡ 
b8¡¬t
[8] = {0,0,0,0, 1, 4, 5, 10};

1883 cÚ¡ 
b8šc
 [8] = {0,0,0,0, 1, 2, 2, 1};

1885  (
cu¼Sliû
->
¦iû_ty³
!=
B_SLICE
è? (
b8mode
 - 4è: 
b8¡¬t
[b8mode] + 
b8šc
[b8mode] * 
b8pdœ
;

1886 
	}
}

1888 
	$wr™eIPCMLuma
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
imgY
, 
B™¡»am
 *
cu¼SŒ—m
, 
SyÁaxEËm’t
 *
£
, *
b™CouÁ
)

1890 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1891 
i
, 
j
;

1892 
b™_size
 = 
MB_BLOCK_SIZE
 * MB_BLOCK_SIZE * 
p_Vid
->
b™d•th_luma
;

1894 *
b™CouÁ
 +ð
b™_size
;

1895 
£
->
Ën
 = 
p_Vid
->
b™d•th_luma
;

1896 
£
->
ty³
 = 
SE_MBTYPE
;

1898 
j
 = 
cu¼MB
->
pix_y
; j < cu¼MB->pix_y + 
MB_BLOCK_SIZE
; ++j)

1900 
i
 = 
cu¼MB
->
pix_x
; i < cu¼MB->pix_x + 
MB_BLOCK_SIZE
; ++i)

1902 
£
->
b™·‰”n
 = 
	`imax
(
p_Vid
->
mš_IPCM_v®ue
, 
imgY
[
j
][
i
]);

1903 
£
->
v®ue1
 = se->
b™·‰”n
;

1904 #ià
TRACE


1905 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "pcm_§m¶e_lum¨(%d %dèð%d", 
j
, 
i
, se->
b™·‰”n
);

1907 
	`wr™eSE_Fix
(
£
, 
cu¼SŒ—m
);

1910  
b™_size
;

1911 
	}
}

1913 
	$wr™eIPCMChroma
 (
Maüoblock
 *
cu¼MB
, 
img³l
 **
imgUV
, 
B™¡»am
 *
cu¼SŒ—m
, 
SyÁaxEËm’t
 *
£
, *
b™CouÁ
)

1915 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1916 
i
, 
j
;

1917 
b™_size
 = 
p_Vid
->
mb_ü_size_y
 *…_Vid->
mb_ü_size_x
 *…_Vid->
b™d•th_luma
;

1918 *
b™CouÁ
 +ð
b™_size
;

1920 
£
->
Ën
 = 
p_Vid
->
b™d•th_chroma
;

1921 
£
->
ty³
 = 
SE_MBTYPE
;

1923 
j
 = 
cu¼MB
->
pix_c_y
; j < cu¼MB->pix_c_y + 
p_Vid
->
mb_ü_size_y
; ++j)

1925 
i
 = 
cu¼MB
->
pix_c_x
; i < cu¼MB->pix_c_x + 
p_Vid
->
mb_ü_size_x
; ++i)

1927 
£
->
b™·‰”n
 = 
	`imax
(
p_Vid
->
mš_IPCM_v®ue
, 
imgUV
[
j
][
i
]);

1928 
£
->
v®ue1
 = se->
b™·‰”n
;

1929 #ià
TRACE


1931 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "pcm_§m¶e_chrom¨(%d %dèð%d", 
j
, 
i
, se->
b™·‰”n
);

1933 
	`wr™eSE_Fix
(
£
, 
cu¼SŒ—m
);

1936  
b™_size
;

1937 
	}
}

1939 
	$wr™eIPCMBy‹Align
(
B™¡»am
 *
cu¼SŒ—m
, 
SyÁaxEËm’t
 *
£
, *
b™CouÁ
)

1941 ià(
cu¼SŒ—m
->
b™s_to_go
 < 8)

1944 
£
->
ty³
 = 
SE_MBTYPE
;

1945 
£
->
Ën
 = 
cu¼SŒ—m
->
b™s_to_go
;

1946 *
b™CouÁ
 +ð
£
->
Ën
;

1947 
£
->
b™·‰”n
 = 0;

1948 #ià
TRACE


1949 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "pcm_®ignm’t_z”o_b™ ð%d", se->
Ën
);

1951 
	`wr™eSE_Fix
(
£
, 
cu¼SŒ—m
);

1953  
£
->
Ën
;

1957 
	}
}

1965 
	$wr™eIPCMD©a
(
Maüoblock
 *
cu¼MB
, 
D©aP¬t™iÚ
* 
d©aP¬t
)

1967 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1968 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1969 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1970 
no_b™s
 = 0;

1971 
SyÁaxEËm’t
 
£
;

1972 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

1974 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

1976 
Ën
;

1977 
EncodšgEnvœÚm’tPŒ
 
“p
 = &
d©aP¬t
->
“_ÿbac
;

1978 
Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p
);

1979 
	`¬›nco_dÚe_’codšg
(
cu¼MB
, 
“p
);

1980 
Ën
 = 
	`¬›nco_b™s_wr™‹n
(
“p
) -†en;

1981 
no_b™s
 +ð
Ën
;

1983 
	`¬›nco_¡¬t_’codšg
(
“p
, 
d©aP¬t
->
b™¡»am
->
¡»amBufãr
, &(d©aP¬t->b™¡»am->
by‹_pos
));

1986 
	`wr™eIPCMBy‹Align
(
d©aP¬t
->
b™¡»am
, &
£
, &(
cu¼MB
->
b™s
.
mb_y_cÛff
));

1988 
no_b™s
 +ð
	`wr™eIPCMLuma
 (
cu¼MB
, 
p_Vid
->
’c_piùu»
->
imgY
, 
d©aP¬t
->
b™¡»am
, &
£
, &
mbB™s
->
mb_y_cÛff
);

1990 ià((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

1992 
uv
;

1993 
uv
 = 0; uv < 2; ++uv )

1995 
no_b™s
 +ð
	`wr™eIPCMChroma
 (
cu¼MB
, 
p_Vid
->
’c_piùu»
->
imgUV
[
uv
], 
d©aP¬t
->
b™¡»am
, &
£
, &
mbB™s
->
mb_uv_cÛff
);

1998  
no_b™s
;

1999 
	}
}

2013 
	$wr™e_b_¦iû_MB_Ïy”
 (
Maüoblock
 *
cu¼MB
, 
rdÝt
, *
cÛff_¿‹
)

2015 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2016 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2017 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2019 
i
;

2020 
mb_Ä
 = 
cu¼MB
->
mbAddrX
;

2021 
Maüoblock
 *
´evMB
 = 
cu¼MB
->
P»vMB
;

2022 
´ev_mb_Ä
 = (
NULL
 =ð
´evMB
è? -1 :…»vMB->
mbAddrX
;

2024 
SyÁaxEËm’t
 
£
;

2025 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2026 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2028 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2029 
B™¡»am
 *
cu¼SŒ—m
;

2031 
no_b™s
 = 0;

2032 
sk
 = 
cu¼MB
->
mb_ty³
 ? 0 : !cu¼MB->
cbp
;

2033 
´evMbSk³d
 = 0;

2034 
Wr™eF¿meF›ldMBInH—d”
 = 0;

2036 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

2038 ià((
mb_Ä
 & 0x01) == 0)

2040 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2042 
´evMbSk³d
 = 0;

2046 ià(
´evMB
->
mb_ty³
 ? 0: !´evMB->
cbp
)

2048 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2051 
´evMbSk³d
 = 
p_Vid
->
mb_d©a
[
´ev_mb_Ä
].
sk_æag
;

2054 
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 = (è
	`is_šŒa
(currMB);

2056 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

2058 
mb_ty³
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

2059 ià(
cu¼Sliû
->
mb_aff_äame_æag
 && ((
cu¼MB
->
mbAddrX
 & 0x01è=ð0 || 
´evMbSk³d
))

2061 
by‹
 
mb_f›ld_tmp
 = 
cu¼MB
->
mb_f›ld
;

2062 
cu¼MB
->
mb_f›ld
 = 
	`f›ld_æag_šã»nû
(currMB);

2063 
	`CheckAvažabž™yOfNeighbÜsCABAC
(
cu¼MB
);

2064 
cu¼MB
->
mb_f›ld
 = 
mb_f›ld_tmp
;

2068 
£
.
v®ue1
 = 
mb_ty³
;

2069 
£
.
v®ue2
 = 
cu¼MB
->
cbp
;

2070 
£
.
ty³
 = 
SE_MBTYPE
;

2072 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_flag");

2073 
cu¼Sliû
->
	`wr™eMB_Sk
(
cu¼MB
, &
£
, 
d©aP¬t
);

2075 
no_b™s
 +ð
£
.
Ën
;

2077 
	`CheckAvažabž™yOfNeighbÜsCABAC
(
cu¼MB
);

2080 if(
cu¼Sliû
->
mb_aff_äame_æag
 && !
sk
)

2082 if(
Wr™eF¿meF›ldMBInH—d”
)

2084 
£
.
v®ue1
 = 
cu¼MB
->
mb_f›ld
;

2085 
£
.
v®ue2
 = 0;

2086 
£
.
ty³
 = 
SE_MBTYPE
;

2088 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_field_decoding_flag");

2089 
cu¼Sliû
->
	`wr™eF›ldModeInfo
(
cu¼MB
, &
£
, 
d©aP¬t
);

2091 
no_b™s
 +ð
£
.
Ën
;

2096 ià(
cu¼MB
->
mb_ty³
 !ð0 || ((cu¼MB->
cbp
 !ð0 || 
cu¼Sliû
->
cmp_cbp
[1] !=0 || currSlice->cmp_cbp[2]!=0 )))

2098 
£
.
v®ue1
 = 
mb_ty³
;

2099 
£
.
v®ue2
 = 0;

2100 
£
.
ty³
 = 
SE_MBTYPE
;

2102 #ià
TRACE


2103 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mb_ty³ (B_SLICEè(%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, cu¼MB->
mb_ty³
);

2105 
cu¼Sliû
->
	`wr™eMB_ty³Info
(
cu¼MB
, &
£
, 
d©aP¬t
);

2107 
no_b™s
 +ð
£
.
Ën
;

2111 ià(
cu¼MB
->
mb_ty³
 !ð0 || ((cu¼MB->
cbp
 !ð0 || 
cu¼Sliû
->
cmp_cbp
[1] != 0 || currSlice->cmp_cbp[2]!=0 )))

2114 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

2115 
£
.
v®ue2
 = 0;

2116 
£
.
ty³
 = 
SE_MBTYPE
;

2118 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_run");

2119 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

2121 
no_b™s
 +ð
£
.
Ën
;

2124 iàÐ(
p_Vid
->
cod_couÁ”
è&& (
p_IÅ
->
¦iû_mode
 =ð
FIXED_RATE
è&& (!
rdÝt
))

2126 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

2128 
cu¼SŒ—m
 = 
cu¼Sliû
->
·¹A¼
[
i
].
b™¡»am
;

2129 
cu¼SŒ—m
->
¡Üed_b™s_to_go
 = cu¼SŒ—m->
b™s_to_go
;

2130 
cu¼SŒ—m
->
¡Üed_by‹_pos
 = cu¼SŒ—m->
by‹_pos
;

2131 
cu¼SŒ—m
->
¡Üed_by‹_buf
 = cu¼SŒ—m->
by‹_buf
;

2133 
p_Vid
->
p_Sts
->
¡Üed_b™_¦iû
 =…_Vid->p_Sts->
b™_¦iû
;

2137 
p_Vid
->
cod_couÁ”
 = 0;

2140 if(
cu¼Sliû
->
mb_aff_äame_æag
 && !
sk
)

2142 if(
Wr™eF¿meF›ldMBInH—d”
)

2144 
£
.
v®ue1
 = 
cu¼MB
->
mb_f›ld
;

2145 
£
.
ty³
 = 
SE_MBTYPE
;

2147 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_field_decoding_flag");

2148 
	`wr™eSE_FÏg
 (&
£
, 
d©aP¬t
);

2150 
no_b™s
 +ð
£
.
Ën
;

2154 
£
.
v®ue1
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

2156 
£
.
ty³
 = 
SE_MBTYPE
;

2157 
£
.
v®ue2
 = 0;

2159 #ià
TRACE


2160 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mb_ty³ (B_SLICEè(%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, cu¼MB->
mb_ty³
);

2163 
cu¼Sliû
->
	`wr™eMB_ty³Info
(
cu¼MB
, &
£
, 
d©aP¬t
);

2165 
no_b™s
 +ð
£
.
Ën
;

2170 ++(
p_Vid
->
cod_couÁ”
);

2172 
cu¼MB
->
sk_æag
 = 1;

2174 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

2176 if(
	`FmoG‘NextMBNr
(
p_Vid
, 
cu¼MB
->
mbAddrX
è=ð-1 &&…_Vid->
cod_couÁ”
 > 0)

2179 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

2180 
£
.
v®ue2
 = 0;

2181 
£
.
ty³
 = 
SE_MBTYPE
;

2183 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_skip_run");

2184 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

2186 
no_b™s
 +ð
£
.
Ën
;

2189 
p_Vid
->
cod_couÁ”
 = 0;

2192 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
no_b™s
;;

2195 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 = (cu¼MB->
mb_ty³
 =ð0 && !(
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
))? 
FALSE
 : 
TRUE
;

2197 ià(
cu¼MB
->
mb_ty³
 =ð
IPCM
)

2199 
no_b™s
 +ð
	`wr™eIPCMD©a
(
cu¼MB
, &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_LUM_DC_INTRA
]]));

2200  
no_b™s
;

2203 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2206 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
)

2208 
i
=0; i<4; ++i)

2210 
£
.
v®ue1
 = 
	`B8Mode2V®ue
 (
cu¼Sliû
, 
cu¼MB
->
b8x8
[
i
].
mode
, cu¼MB->b8x8[i].
pdœ
);

2211 
£
.
v®ue2
 = 0;

2212 
£
.
ty³
 = 
SE_MBTYPE
;

2213 #ià
TRACE


2214 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "8x8 mode/pdœ(%2dèð%3d/%d", 
i
, 
cu¼MB
->
b8x8
[i].
mode
, cu¼MB->b8x8[i].
pdœ
);

2216 
cu¼Sliû
->
	`wr™eB8_ty³Info
 (&
£
, 
d©aP¬t
);

2217 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;;

2218 
no_b™s
 +ð
£
.
Ën
;

2221 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 &ð(
BoÞ—n
è((cu¼MB->
b8x8
[
i
].
mode
 =ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)

2222 || (
cu¼MB
->
b8x8
[
i
].
mode
 == 4));

2225 
no_b™s
 +ð
cu¼Sliû
->
	`wr™eMÙiÚInfo2NAL
 (
cu¼MB
);

2231 ià((
cu¼MB
->
mb_ty³
 =ð
I8MB
 || cu¼MB->mb_ty³ =ð
I4MB
è&& 
p_IÅ
->
T¿nsfÜm8x8Mode
)

2233 
£
.
v®ue1
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

2234 
£
.
ty³
 = 
SE_MBTYPE
;

2236 #ià
TRACE


2237 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "ŒªsfÜm_size_8x8_æag = %3d", 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
);

2239 
cu¼Sliû
->
	`wr™eMB_ŒªsfÜm_size
(
cu¼MB
, &
£
, 
d©aP¬t
);

2241 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;;

2242 
no_b™s
 +ð
£
.
Ën
;

2246 
no_b™s
 +ð
	`wr™eIÁ¿Modes
(
cu¼MB
);

2248 ià(
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 && ((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (p_Vid->aùive_¥s->chroma_fÜm©_idø!ð
YUV444
)))

2249 
no_b™s
 +ð
	`wr™e_chroma_šŒa_´ed_mode
(
cu¼MB
);

2250 if(!
rdÝt
)

2252 
cu¼MB
->
c_»d_mode
 = 
DC_PRED_8
;

2260 ià(
cu¼MB
->
mb_ty³
 !=0 && cu¼MB->mb_ty³ !ð
P8x8
 && (!
	`is_šŒa
(currMB)))

2262 
no_b™s
 +ð
cu¼Sliû
->
	`wr™eMÙiÚInfo2NAL
 (
cu¼MB
);

2265 ià((
cu¼MB
->
mb_ty³
!=0è|| ((cu¼MB->
cbp
!=0 || 
cu¼Sliû
->
cmp_cbp
[1]!=0 || currSlice->cmp_cbp[2]!=0)))

2267 *
cÛff_¿‹
 = 
	`wr™e_CBP_ªd_Dquªt
 (
cu¼MB
);

2268 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
 (
cu¼MB
, 
PLANE_Y
);

2270 ià((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& ((
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0)))

2272 if(
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

2274 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_U
);

2275 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_V
);

2278 *
cÛff_¿‹
 +ð
	`wr™e_chroma_cÛff
 (
cu¼MB
);

2280 
no_b™s
 +ð*
cÛff_¿‹
;

2283  
no_b™s
;

2284 
	}
}

2298 
	$wr™e_p_¦iû_MB_Ïy”
 (
Maüoblock
 *
cu¼MB
, 
rdÝt
, *
cÛff_¿‹
)

2300 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2301 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2302 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2304 
i
;

2305 
mb_Ä
 = 
cu¼MB
->
mbAddrX
;

2306 
Maüoblock
 *
´evMB
 = 
cu¼MB
->
P»vMB
;

2307 
´ev_mb_Ä
 = (
NULL
 =ð
´evMB
è? -1 :…»vMB->
mbAddrX
;

2309 
SyÁaxEËm’t
 
£
;

2310 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2311 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2313 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2314 
B™¡»am
 *
cu¼SŒ—m
;

2316 
no_b™s
 = 0;

2317 
sk
 = 
cu¼MB
->
mb_ty³
 ? 0 : 1;

2318 
´evMbSk³d
 = 0;

2319 
Wr™eF¿meF›ldMBInH—d”
 = 0;

2321 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

2323 ià((
mb_Ä
 & 0x01) == 0)

2325 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2327 
´evMbSk³d
 = 0;

2331 ià(
´evMB
->
mb_ty³
 ? 0 : 1)

2333 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2336 
´evMbSk³d
 = 
p_Vid
->
mb_d©a
[
´ev_mb_Ä
].
sk_æag
;

2339 
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 = (è
	`is_šŒa
(currMB);

2341 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

2343 
mb_ty³
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

2344 ià(
cu¼Sliû
->
mb_aff_äame_æag
 && ((
cu¼MB
->
mbAddrX
 & 0x01è=ð0 || 
´evMbSk³d
))

2346 
by‹
 
mb_f›ld_tmp
 = 
cu¼MB
->
mb_f›ld
;

2347 
cu¼MB
->
mb_f›ld
 = 
	`f›ld_æag_šã»nû
(currMB);

2348 
	`CheckAvažabž™yOfNeighbÜsCABAC
(
cu¼MB
);

2349 
cu¼MB
->
mb_f›ld
 = 
mb_f›ld_tmp
;

2353 
£
.
v®ue1
 = 
mb_ty³
;

2354 
£
.
v®ue2
 = 
cu¼MB
->
cbp
;

2355 
£
.
ty³
 = 
SE_MBTYPE
;

2357 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_flag");

2358 
cu¼Sliû
->
	`wr™eMB_Sk
(
cu¼MB
, &
£
, 
d©aP¬t
);

2360 
no_b™s
 +ð
£
.
Ën
;

2362 
	`CheckAvažabž™yOfNeighbÜsCABAC
(
cu¼MB
);

2365 if(
cu¼Sliû
->
mb_aff_äame_æag
 && !
sk
)

2367 if(
Wr™eF¿meF›ldMBInH—d”
)

2369 
£
.
v®ue1
 = 
cu¼MB
->
mb_f›ld
;

2370 
£
.
v®ue2
 = 0;

2371 
£
.
ty³
 = 
SE_MBTYPE
;

2373 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_field_decoding_flag");

2374 
cu¼Sliû
->
	`wr™eF›ldModeInfo
(
cu¼MB
, &
£
, 
d©aP¬t
);

2376 
no_b™s
 +ð
£
.
Ën
;

2381 ià(
cu¼MB
->
mb_ty³
 != 0)

2383 
£
.
v®ue1
 = 
mb_ty³
;

2384 
£
.
v®ue2
 = 0;

2385 
£
.
ty³
 = 
SE_MBTYPE
;

2387 #ià
TRACE


2388 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mb_ty³ (P_SLICEè(%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, cu¼MB->
mb_ty³
);

2390 
cu¼Sliû
->
	`wr™eMB_ty³Info
(
cu¼MB
, &
£
, 
d©aP¬t
);

2392 
no_b™s
 +ð
£
.
Ën
;

2396 ià(
cu¼MB
->
mb_ty³
 != 0)

2399 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

2400 
£
.
v®ue2
 = 0;

2401 
£
.
ty³
 = 
SE_MBTYPE
;

2403 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_skip_run");

2404 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

2406 
no_b™s
 +ð
£
.
Ën
;

2409 iàÐ(
p_Vid
->
cod_couÁ”
è&& (
p_IÅ
->
¦iû_mode
 =ð
FIXED_RATE
è&& (!
rdÝt
))

2411 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

2413 
cu¼SŒ—m
 = 
cu¼Sliû
->
·¹A¼
[
i
].
b™¡»am
;

2414 
cu¼SŒ—m
->
¡Üed_b™s_to_go
 = cu¼SŒ—m->
b™s_to_go
;

2415 
cu¼SŒ—m
->
¡Üed_by‹_pos
 = cu¼SŒ—m->
by‹_pos
;

2416 
cu¼SŒ—m
->
¡Üed_by‹_buf
 = cu¼SŒ—m->
by‹_buf
;

2417 
p_Vid
->
p_Sts
->
¡Üed_b™_¦iû
 =…_Vid->p_Sts->
b™_¦iû
;

2421 
p_Vid
->
cod_couÁ”
 = 0;

2424 if(
cu¼Sliû
->
mb_aff_äame_æag
 && !
sk
)

2426 if(
Wr™eF¿meF›ldMBInH—d”
)

2428 
£
.
v®ue1
 = 
cu¼MB
->
mb_f›ld
;

2429 
£
.
ty³
 = 
SE_MBTYPE
;

2431 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_field_decoding_flag");

2432 
	`wr™eSE_FÏg
 (&
£
, 
d©aP¬t
);

2434 
no_b™s
 +ð
£
.
Ën
;

2438 
£
.
v®ue1
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

2439 
£
.
v®ue1
--;

2441 
£
.
ty³
 = 
SE_MBTYPE
;

2442 
£
.
v®ue2
 = 0;

2444 #ià
TRACE


2445 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mb_ty³ (P_SLICEè(%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, cu¼MB->
mb_ty³
);

2448 
cu¼Sliû
->
	`wr™eMB_ty³Info
(
cu¼MB
, &
£
, 
d©aP¬t
);

2450 
no_b™s
 +ð
£
.
Ën
;

2455 ++(
p_Vid
->
cod_couÁ”
);

2457 
cu¼MB
->
sk_æag
 = 1;

2459 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

2461 if(
	`FmoG‘NextMBNr
(
p_Vid
, 
cu¼MB
->
mbAddrX
è=ð-1 &&…_Vid->
cod_couÁ”
 > 0)

2464 
£
.
v®ue1
 = 
p_Vid
->
cod_couÁ”
;

2465 
£
.
v®ue2
 = 0;

2466 
£
.
ty³
 = 
SE_MBTYPE
;

2468 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "mb_skip_run");

2469 
	`wr™eSE_UVLC
(&
£
, 
d©aP¬t
);

2471 
no_b™s
 +ð
£
.
Ën
;

2474 
p_Vid
->
cod_couÁ”
 = 0;

2477 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
no_b™s
;;

2480 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 = 
TRUE
;

2482 ià(
cu¼MB
->
mb_ty³
 =ð
IPCM
)

2484 
no_b™s
 +ð
	`wr™eIPCMD©a
(
cu¼MB
, &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_LUM_DC_INTRA
]]));

2485  
no_b™s
;

2488 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2491 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
)

2493 
i
=0; i<4; ++i)

2495 
£
.
v®ue1
 = 
	`B8Mode2V®ue
 (
cu¼Sliû
, 
cu¼MB
->
b8x8
[
i
].
mode
, cu¼MB->b8x8[i].
pdœ
);

2496 
£
.
v®ue2
 = 0;

2497 
£
.
ty³
 = 
SE_MBTYPE
;

2498 #ià
TRACE


2499 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "8x8 mode/pdœ(%2dèð%3d/%d", 
i
, 
cu¼MB
->
b8x8
[i].
mode
, cu¼MB->b8x8[i].
pdœ
);

2501 
cu¼Sliû
->
	`wr™eB8_ty³Info
 (&
£
, 
d©aP¬t
);

2502 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;;

2503 
no_b™s
 +ð
£
.
Ën
;

2506 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 &ð(
BoÞ—n
è((cu¼MB->
b8x8
[
i
].
mode
 =ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)

2507 || (
cu¼MB
->
b8x8
[
i
].
mode
 ==4));

2510 
no_b™s
 +ð
cu¼Sliû
->
	`wr™eMÙiÚInfo2NAL
 (
cu¼MB
);

2516 ià((
cu¼MB
->
mb_ty³
 =ð
I8MB
 || cu¼MB->mb_ty³ =ð
I4MB
è&& 
p_IÅ
->
T¿nsfÜm8x8Mode
)

2518 
£
.
v®ue1
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

2519 
£
.
ty³
 = 
SE_MBTYPE
;

2521 #ià
TRACE


2522 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "ŒªsfÜm_size_8x8_æag = %3d", 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
);

2524 
cu¼Sliû
->
	`wr™eMB_ŒªsfÜm_size
(
cu¼MB
, &
£
, 
d©aP¬t
);

2526 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;;

2527 
no_b™s
 +ð
£
.
Ën
;

2531 
no_b™s
 +ð
	`wr™eIÁ¿Modes
(
cu¼MB
);

2533 ià(
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 && ((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (p_Vid->aùive_¥s->chroma_fÜm©_idø!ð
YUV444
)))

2534 
no_b™s
 +ð
	`wr™e_chroma_šŒa_´ed_mode
(
cu¼MB
);

2535 if(!
rdÝt
)

2537 
cu¼MB
->
c_»d_mode
 = 
DC_PRED_8
;

2545 ià(
cu¼MB
->
mb_ty³
 !=0 && cu¼MB->mb_ty³ !ð
P8x8
 && (!
	`is_šŒa
(currMB)))

2547 
no_b™s
 +ð
cu¼Sliû
->
	`wr™eMÙiÚInfo2NAL
 (
cu¼MB
);

2550 ià(
cu¼MB
->
mb_ty³
!=0)

2552 *
cÛff_¿‹
 = 
	`wr™e_CBP_ªd_Dquªt
 (
cu¼MB
);

2553 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
 (
cu¼MB
, 
PLANE_Y
);

2555 ià((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& ((
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0)))

2557 if(
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

2559 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_U
);

2560 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_V
);

2563 *
cÛff_¿‹
 +ð
	`wr™e_chroma_cÛff
 (
cu¼MB
);

2565 
no_b™s
 +ð*
cÛff_¿‹
;

2568  
no_b™s
;

2569 
	}
}

2572 
	$wr™e_i_¦iû_MB_Ïy”
 (
Maüoblock
 *
cu¼MB
, 
rdÝt
, *
cÛff_¿‹
)

2574 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2575 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2576 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2578 
mb_Ä
 = 
cu¼MB
->
mbAddrX
;

2579 
Maüoblock
 *
´evMB
 = 
cu¼MB
->
P»vMB
;

2581 
SyÁaxEËm’t
 
£
;

2582 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2583 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2585 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2587 
no_b™s
 = 0;

2588 
Wr™eF¿meF›ldMBInH—d”
 = 0;

2590 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

2592 ià((
mb_Ä
 & 0x01) == 0)

2594 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2598 ià(
´evMB
->
mb_ty³
 ? 0: 1)

2600 
Wr™eF¿meF›ldMBInH—d”
 = 1;

2605 if(
Wr™eF¿meF›ldMBInH—d”
)

2607 
£
.
v®ue1
 = 
cu¼MB
->
mb_f›ld
;

2608 
£
.
v®ue2
 = 0;

2609 
£
.
ty³
 = 
SE_MBTYPE
;

2611 
	`TRACE_SE
 (
£
.
Œaû¡ršg
, "mb_field_decoding_flag");

2612 
cu¼Sliû
->
	`wr™eF›ldModeInfo
(
cu¼MB
, &
£
, 
d©aP¬t
);

2614 
no_b™s
 +ð
£
.
Ën
;

2617 
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 = (è
	`is_šŒa
(currMB);

2621 
£
.
v®ue1
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

2622 
£
.
v®ue2
 = 0;

2623 
£
.
ty³
 = 
SE_MBTYPE
;

2625 #ià
TRACE


2626 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mb_ty³ (I_SLICEè(%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, cu¼MB->
mb_ty³
);

2629 
cu¼Sliû
->
	`wr™eMB_ty³Info
 (
cu¼MB
, &
£
, 
d©aP¬t
);

2631 
no_b™s
 +ð
£
.
Ën
;

2633 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
no_b™s
;

2636 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 = 
TRUE
;

2638 ià(
cu¼MB
->
mb_ty³
 =ð
IPCM
)

2640 
no_b™s
 +ð
	`wr™eIPCMD©a
(
cu¼MB
, &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_LUM_DC_INTRA
]]));

2641  
no_b™s
;

2644 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2649 ià((
cu¼MB
->
mb_ty³
 =ð
I8MB
 || cu¼MB->mb_ty³ =ð
I4MB
è&& 
p_IÅ
->
T¿nsfÜm8x8Mode
)

2651 
£
.
v®ue1
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

2652 
£
.
ty³
 = 
SE_MBTYPE
;

2654 #ià
TRACE


2655 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "ŒªsfÜm_size_8x8_æag = %3d", 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
);

2657 
cu¼Sliû
->
	`wr™eMB_ŒªsfÜm_size
(
cu¼MB
, &
£
, 
d©aP¬t
);

2659 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;;

2660 
no_b™s
 +ð
£
.
Ën
;

2664 
no_b™s
 +ð
	`wr™eIÁ¿Modes
(
cu¼MB
);

2666 ià(
cu¼MB
->
IÁ¿ChromaP»dModeFÏg
 && ((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& (p_Vid->aùive_¥s->chroma_fÜm©_idø!ð
YUV444
)))

2667 
no_b™s
 +ð
	`wr™e_chroma_šŒa_´ed_mode
(
cu¼MB
);

2668 if(!
rdÝt
)

2670 
cu¼MB
->
c_»d_mode
 = 
DC_PRED_8
;

2677 *
cÛff_¿‹
 = 
	`wr™e_CBP_ªd_Dquªt
 (
cu¼MB
);

2678 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
 (
cu¼MB
, 
PLANE_Y
);

2680 ià((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV400
è&& ((
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0)))

2682 if(
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

2684 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_U
);

2685 *
cÛff_¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
(
cu¼MB
, 
PLANE_V
);

2688 *
cÛff_¿‹
 +ð
	`wr™e_chroma_cÛff
 (
cu¼MB
);

2691 
no_b™s
 +ð*
cÛff_¿‹
;

2693  
no_b™s
;

2694 
	}
}

2696 
	$wr™e_‹rmš©šg_b™
 (
Sliû
 *
cu¼Sliû
, 
b™
)

2698 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2700 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

2701 
d©aP¬t
->
b™¡»am
->
wr™e_æag
 = 1;

2703 
	`bŸri_’code_symbÞ_fš®
(&(
d©aP¬t
->
“_ÿbac
), 
b™
);

2704 #ià
TRACE


2705 
	`årštf
 (
p_Enc
->
p_Œaû
, " CABAC”mš©šg b™ = %d\n",
b™
);

2707 
	}
}

2716 
	$wr™e_chroma_šŒa_´ed_mode
(
Maüoblock
* 
cu¼MB
)

2718 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2719 
SyÁaxEËm’t
 
£
;

2720 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2721 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

2722 
¿‹
 = 0;

2727 
£
.
v®ue1
 = 
cu¼MB
->
c_»d_mode
;

2728 
£
.
v®ue2
 = 0;

2729 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

2731 
	`TRACE_SE
(
£
.
Œaû¡ršg
, "intra_chroma_pred_mode");

2732 
cu¼Sliû
->
	`wr™eCIP»dMode
(
cu¼MB
, &
£
, 
d©aP¬t
);

2734 
cu¼MB
->
b™s
.
mb_uv_cÛff
 +ð
£
.
Ën
;

2735 
¿‹
 +ð
£
.
Ën
;

2737  
¿‹
;

2738 
	}
}

2741 #ià(
MVC_EXTENSION_ENABLE
)

2742 
	$is_š‹rv›w_mb
(
Maüoblock
 *
cu¼MB
)

2744 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2745 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2746 
¡ÜabË_piùu»
 **
pLi¡
 = 
cu¼Sliû
->
li¡X
[0];

2747 
i
,
j
, 
iRefIdx
=-1, 
k
;

2748 
š‹rv›w_š_l0
 = 1;

2749 
¡•_h0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][0] >> 2);

2750 
¡•_v0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][1] >> 2);

2751 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2753 
i
=0; i<
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

2755 if(
pLi¡
[
i
]->
v›w_id
==0)

2757 
iRefIdx
 = 
i
;

2761 if(
iRefIdx
 =ð-1 && 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2763 
š‹rv›w_š_l0
 = 0;

2764 
pLi¡
 = 
cu¼Sliû
->
li¡X
[
LIST_1
];

2765 
i
=0; i<
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; i++)

2767 if(
pLi¡
[
i
]->
v›w_id
==0)

2769 
iRefIdx
 = 
i
;

2775 if(
iRefIdx
<0)

2779 if(
cu¼MB
->
mb_ty³
 =ð
PSKIP
 && 
cu¼Sliû
->
¦iû_ty³
==
P_SLICE
)

2781  (
iRefIdx
==0);

2783 
j
=0; j<4; j+=
¡•_v0
)

2785 
i
=0; i<4; i +=
¡•_h0
)

2787 
k
 = 
j
 + (
i
 >> 1);

2788 ià(
š‹rv›w_š_l0
 && (
cu¼MB
->
b8x8
[
k
].
pdœ
 == 0 || currMB->b8x8[k].pdir == 2))

2790 if(
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_0
] =ð
iRefIdx
)

2793 ià(!
š‹rv›w_š_l0
 && (
cu¼MB
->
b8x8
[
k
].
pdœ
 == 1 || currMB->b8x8[k].pdir == 2))

2795 if(
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
»f_idx
[
LIST_1
] =ð
iRefIdx
)

2802 
	}
}

2810 
	$wr™e_maüoblock
 (
Maüoblock
* 
cu¼MB
, 
eos_b™
)

2812 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2813 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2814 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2815 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2816 
i
;

2819 #ià
TRACE


2820 iàÐ
cu¼MB
->
´ev_»code_mb
 =ð
FALSE
 )

2822 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; ++i)

2824 
cu¼Sliû
->
·¹A¼
[
i
].
b™¡»am
->
Œaû_’abËd
 = 
TRUE
;

2830 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 && (
cu¼Sliû
->
¦iû_ty³
==
P_SLICE
 || cu¼Sliû->¦iû_ty³==
B_SLICE
))

2832 
p_Vid
->
šŒa_block
[
cu¼MB
->
mbAddrX
] = 
	`is_šŒa
(currMB);

2836 ià(
cu¼MB
->
mbAddrX
 == 0)

2838 
p_Vid
->
šŒas
 = 0;

2839 
p_Vid
->
iIÁ”V›wMBs
 =0;

2842 ià(
	`is_šŒa
(
cu¼MB
))

2843 ++
p_Vid
->
šŒas
;

2844 #ià(
MVC_EXTENSION_ENABLE
)

2845 if(
p_Vid
->
num_of_Ïy”s
==2 &&…_Vid->
dpb_Ïy”_id
==1)

2847 
is_š‹rv›w
 = 
	`is_š‹rv›w_mb
(
cu¼MB
);

2849 if(
is_š‹rv›w
)

2850 
p_Vid
->
iIÁ”V›wMBs
++;

2855 ià(
cu¼Sliû
->
symbÞ_mode
==
CABAC
 && 
cu¼MB
->
mbAddrX
 !ðcu¼Sliû->
¡¬t_mb_Ä
 && 
eos_b™
)

2857 
	`wr™e_‹rmš©šg_b™
 (
cu¼Sliû
, 0);

2860 #ià
TRACE


2862 ià(
p_Enc
->
p_Œaû
)

2864 
	`årštf
(
p_Enc
->
p_Œaû
, "\n*********** Pic: %˜(I/PèMB: %˜Sliû: %˜**********\n\n", 
p_Vid
->
äame_no
, 
cu¼MB
->
mbAddrX
, 
cu¼Sliû
->
¦iû_Ä
);

2868 
p_Vid
->
ÿbac_’codšg
 = 1;

2870 
cu¼MB
->
wr™e_mb
 = 
TRUE
;

2872 
cu¼Sliû
->
	`wr™e_MB_Ïy”
 (
cu¼MB
, 0, &
i
);

2874 ià(!((
cu¼MB
->
mb_ty³
 !=0 ) || ((
cu¼Sliû
->
¦iû_ty³
==
B_SLICE
è&& cu¼MB->
cbp
 != 0) ))

2876 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

2880 
mbB™s
->
mb_tÙ®
 = mbB™s->
mb_mode


2881 + 
mbB™s
->
mb_y_cÛff


2882 + 
mbB™s
->
mb_š‹r


2883 + 
mbB™s
->
mb_cbp


2884 + 
mbB™s
->
mb_d–_quªt


2885 + 
mbB™s
->
mb_uv_cÛff


2886 + 
mbB™s
->
mb_cb_cÛff


2887 + 
mbB™s
->
mb_ü_cÛff
;

2889 iàÐ
p_IÅ
->
RCEÇbË
 )

2890 
	`rc_upd©e_mb_¡©s
(
cu¼MB
);

2893 ++(
p_Vid
->
Numb”ofCodedMaüoBlocks
);

2895 
p_Vid
->
p_Sts
->
b™_¦iû
 +ð
mbB™s
->
mb_tÙ®
;

2897 
p_Vid
->
ÿbac_’codšg
 = 0;

2898 
	}
}

2907 
	$wr™eReã»nûF¿me
 (
Maüoblock
* 
cu¼MB
, 
i
, 
j
, 
li¡_idx
, 
»f
)

2909 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2910 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2911 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2912 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_REFFRAME
]]);

2913 
li¡
 = 
li¡_idx
 + 
cu¼MB
->
li¡_off£t
;

2914 
SyÁaxEËm’t
 
£
;

2916 
£
.
v®ue1
 = 
»f
;

2917 
£
.
ty³
 = 
SE_REFFRAME
;

2918 
£
.
v®ue2
 = 
li¡_idx
;

2920 
cu¼MB
->
subblock_x
 = (è(
i
 << 2);

2921 
cu¼MB
->
subblock_y
 = (è(
j
 << 2);

2923 #ià
TRACE


2924 ià(!
li¡_idx
)

2925 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "»f_idx_l0 = %d", se.
v®ue1
);

2927 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "»f_idx_l1 = %d", se.
v®ue1
);

2930 
cu¼Sliû
->
wr™eRefF¿me
[
li¡
](
cu¼MB
, &
£
, 
d©aP¬t
);

2932 
mbB™s
->
mb_š‹r
 = mbB™s->mb_š‹¸+ (è
£
.
Ën
;

2934  (
£
.
Ën
);

2935 
	}
}

2944 
	$wr™eMÙiÚVeùÜ8x8
 (
Maüoblock
 *
cu¼MB
,

2945 
i0
,

2946 
j0
,

2947 
i1
,

2948 
j1
,

2949 
»fäame
,

2950 
li¡_idx
,

2951 
mv_mode
,

2952 
b»d_me


2955 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2956 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2958 
Pix–Pos
 
block
[4];

2959 
i
, 
j
, 
k
, 
l
, 
m
;

2960 
cu¼_mvd
;

2962 
¿‹
 = 0;

2963 
¡•_h
 = 
·¹_size
[
mv_mode
][0];

2964 
¡•_v
 = 
·¹_size
[
mv_mode
][1];

2965 
SyÁaxEËm’t
 
£
;

2966 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2968 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

2969 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MVD
]]);

2970 
»fšdex
 = 
»fäame
;

2972 
MÙiÚVeùÜ
 **
®l_mv
 = 
cu¼Sliû
->®l_mv[
li¡_idx
][
»fšdex
][
mv_mode
];

2973 
MÙiÚVeùÜ
 *
cur_mv
;

2974 
MÙiÚVeùÜ
 
´edMV
;

2975 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2977 
mvd
[2];

2978 (*
cu¼MB_mvd
)[4][2] = 
cu¼MB
->
mvd
[
li¡_idx
];

2979 
£
.
ty³
 = 
SE_MVD
;

2981 ià(
b»d_me
 && 
	`is_b»d_’abËd
(
p_Vid
, 
mv_mode
è&& 
»fšdex
 == 0)

2982 
®l_mv
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1][
li¡_idx
][
»fšdex
][
mv_mode
];

2984 
j
 = 
j0
; j < 
j1
; j +ð
¡•_v
)

2986 
cu¼MB
->
subblock_y
 = (è(
j
 << 2);

2987 
i
 = 
i0
; i < 
i1
; i +ð
¡•_h
)

2989 
cu¼MB
->
subblock_x
 = (è(
i
 << 2);

2991 ià(
cu¼MB
->
wr™e_mb
)

2992 
cur_mv
 = &
mÙiÚ
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
 + 
i
].
mv
[
li¡_idx
];

2994 
cur_mv
 = &
®l_mv
[
j
][
i
];

2997 
	`g‘_ÃighbÜs
(
cu¼MB
, 
block
, 
i
<<2, 
j
<<2, 
¡•_h
<<2);

2998 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
block
, &
´edMV
, (è
»fšdex
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡_idx
, (
i
<<2), (
j
<<2), 
¡•_h
<<2, 
¡•_v
<<2);

3000 
mvd
[0] = 
cur_mv
->
mv_x
 - 
´edMV
.mv_x;

3001 
mvd
[1] = 
cur_mv
->
mv_y
 - 
´edMV
.mv_y;

3003 
k
=0; k<2; ++k)

3005 
cu¼_mvd
 = 
mvd
[
k
];

3008 
l
 = 
j
;† < j + 
¡•_v
; ++l)

3010 
m
 = 
i
; m < i + 
¡•_h
; ++m)

3012 
cu¼MB_mvd
[
l
][
m
][
k
] = (è
cu¼_mvd
;

3016 
£
.
v®ue1
 = 
cu¼_mvd
;

3017 
£
.
v®ue2
 = (
k
 << 1è+ 
li¡_idx
;

3018 #ià
TRACE


3019 ià(
k
 == 0)

3020 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mvd_l%d (%dèð%3d (Üg_mv %3d…»d_mv %3d)",
li¡_idx
, 
k
, 
cu¼_mvd
, 
cur_mv
->
mv_x
, 
´edMV
.mv_x);

3022 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "mvd_l%d (%dèð%3d (Üg_mv %3d…»d_mv %3d)",
li¡_idx
, 
k
, 
cu¼_mvd
, 
cur_mv
->
mv_y
, 
´edMV
.mv_y);

3024 
cu¼Sliû
->
	`wr™eMVD
 (
cu¼MB
, &
£
, 
d©aP¬t
);

3026 
¿‹
 +ð
£
.
Ën
;

3031 
mbB™s
->
mb_š‹r
 = mbB™s->mb_š‹¸+ (è
¿‹
;

3032  
¿‹
;

3033 
	}
}

3042 
	$wr™e_b_¦iû_mÙiÚ_šfo_to_NAL
 (
Maüoblock
* 
cu¼MB
)

3044 
no_b™s
 = 0;

3046 ià(
cu¼MB
->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I16MB
 && cu¼MB->mb_ty³ !ð
I8MB
 && currMB->mb_type != 0)

3048 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3049 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

3050 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

3051 
k
, 
j0
, 
i0
;

3053 
¡•_h0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][0] >> 2);

3054 
¡•_v0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][1] >> 2);

3059 
j0
 = 0; j0 < 4; j0 +ð
¡•_v0
)

3061 
i0
 = 0; i0 < 4; i0 +ð
¡•_h0
)

3063 
k
 = 
j0
 + (
i0
 >> 1);

3064 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 0 || currMB->b8x8[k].pdir == 2))

3066 
no_b™s
 +ð
	`wr™eReã»nûF¿me
 (
cu¼MB
, 
i0
, 
j0
, 
LIST_0
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[LIST_0]);

3074 
j0
 = 0; j0 < 4; j0 +ð
¡•_v0
)

3076 
i0
 = 0; i0 < 4; i0 +ð
¡•_h0
)

3078 
k
 = 
j0
 + (
i0
 >> 1);

3079 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 1 || currMB->b8x8[k].pdir == 2))

3081 
no_b™s
 +ð
	`wr™eReã»nûF¿me
 (
cu¼MB
, 
i0
, 
j0
, 
LIST_1
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[LIST_1]);

3088 
j0
=0; j0<4; j0+=
¡•_v0
)

3090 
i0
=0; i0<4; i0+=
¡•_h0
)

3092 
k
 = 
j0
 + (
i0
 >> 1);

3093 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 0 || currMB->b8x8[k].pdir == 2))

3096 
no_b™s
 +ð
	`wr™eMÙiÚVeùÜ8x8
 (
cu¼MB
, 
i0
, 
j0
, i0 + 
¡•_h0
, j0 + 
¡•_v0
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[
LIST_0
],

3097 
LIST_0
, 
cu¼MB
->
b8x8
[
k
].
mode
, cu¼MB->b8x8[k].
b»d
);

3104 
j0
=0; j0<4; j0+=
¡•_v0
)

3106 
i0
 = 0; i0 < 4; i0 +ð
¡•_h0
)

3108 
k
=
j0
+(
i0
 >> 1);

3109 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 1 || currMB->b8x8[k].pdir == 2))

3111 
no_b™s
 +ð
	`wr™eMÙiÚVeùÜ8x8
 (
cu¼MB
, 
i0
, 
j0
, i0+
¡•_h0
, j0+
¡•_v0
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[
LIST_1
],

3112 
LIST_1
, 
cu¼MB
->
b8x8
[
k
].
mode
, cu¼MB->b8x8[k].
b»d
);

3118  
no_b™s
;

3119 
	}
}

3128 
	$wr™e_p_¦iû_mÙiÚ_šfo_to_NAL
 (
Maüoblock
* 
cu¼MB
)

3130 
no_b™s
 = 0;

3132 ià(
cu¼MB
->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I16MB
 && cu¼MB->mb_ty³ !ð
I8MB
 && currMB->mb_type != 0)

3134 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3135 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

3136 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

3137 
k
, 
j0
, 
i0
;

3138 
¡•_h0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][0] >> 2);

3139 
¡•_v0
 = (
block_size
[(
cu¼MB
->
mb_ty³
 =ð
P8x8
) ? 4 : currMB->mb_type][1] >> 2);

3142 ià((
cu¼MB
->
mb_ty³
 !ð
P8x8
è|| !
	`Z”oRef
 (cu¼MBè|| 
cu¼Sliû
->
symbÞ_mode
==
CABAC
)

3144 
j0
 = 0; j0 < 4; j0 +ð
¡•_v0
)

3146 
i0
 = 0; i0 < 4; i0 +ð
¡•_h0
)

3148 
k
 = 
j0
 + (
i0
 >> 1);

3149 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 0 || currMB->b8x8[k].pdir == 2))

3151 
no_b™s
 +ð
	`wr™eReã»nûF¿me
 (
cu¼MB
, 
i0
, 
j0
, 
LIST_0
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[LIST_0]);

3158 
j0
=0; j0<4; j0+=
¡•_v0
)

3160 
i0
=0; i0<4; i0+=
¡•_h0
)

3162 
k
 = 
j0
 + (
i0
 >> 1);

3163 ià(
cu¼MB
->
b8x8
[
k
].
mode
 !=0 && (cu¼MB->b8x8[k].
pdœ
 == 0 || currMB->b8x8[k].pdir == 2))

3165 
no_b™s
 +ð
	`wr™eMÙiÚVeùÜ8x8
 (
cu¼MB
, 
i0
, 
j0
, i0 + 
¡•_h0
, j0 + 
¡•_v0
, 
mÙiÚ
[cu¼MB->
block_y
 + j0][cu¼MB->
block_x
 + i0].
»f_idx
[
LIST_0
],

3166 
LIST_0
, 
cu¼MB
->
b8x8
[
k
].
mode
, cu¼MB->b8x8[k].
b»d
);

3172  
no_b™s
;

3173 
	}
}

3182 
	$wr™e_chroma_cÛff
 (
Maüoblock
* 
cu¼MB
)

3184 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3185 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

3187 
¿‹
 = 0;

3188 
block_¿‹
 = 0;

3189 
SyÁaxEËm’t
 
£
;

3190 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

3191 
cbp
 = 
cu¼MB
->cbp;

3192 
D©aP¬t™iÚ
* 
d©aP¬t
;

3194 
Ëv–
;

3195 
k
, 
uv
;

3196 
b8
, 
b4
;

3197 * 
ACLev–
;

3198 * 
ACRun
;

3199 * 
DCLev–
;

3200 * 
DCRun
;

3202 cÚ¡ 
chroma_dc_cÚ‹xt
[3]=

3204 
CHROMA_DC
, 
CHROMA_DC_2x4
, 
CHROMA_DC_4x4


3207 cÚ¡ 
chroma_ac_·¿m
[3][8][4] =

3235 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

3239 ià(
cbp
 > 15)

3241 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

3243 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_DC
, 0, 0, 0);

3244 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_DC
, 0, 0, 1);

3248 
cu¼MB
->
is_šŒa_block
 = (
by‹
è
	`is_šŒa
(currMB);

3249 
£
.
ty³
 = (
cu¼MB
->
is_šŒa_block
 ? 
SE_CHR_DC_INTRA
 : 
SE_CHR_DC_INTER
);

3251 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3252 
£
.
cÚ‹xt
 = 
chroma_dc_cÚ‹xt
[
yuv
];

3254 
uv
=0; uv < 2; ++uv)

3256 
p_Vid
->
is_v_block
 = 
uv
;

3258 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
uv
+1][0];

3259 
DCRun
 = 
cu¼Sliû
->
cofDC
[
uv
+1][1];

3261 
Ëv–
 = 1;

3262 
k
=0; k <ð
p_Vid
->
num_cdc_cÛff
 && 
Ëv–
 != 0; ++k)

3264 
Ëv–
 = 
£
.
v®ue1
 = 
DCLev–
[
k
];

3265 
£
.
v®ue2
 = 
DCRun
 [
k
];

3267 #ià
TRACE


3268 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "DC Chrom¨%2d:†ev– =%3d„uÀ=%2d",
k
, 
Ëv–
, se.
v®ue2
);

3270 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3272 
block_¿‹
 +ð
£
.
Ën
;

3275 
cu¼MB
->
b™s
.
mb_uv_cÛff
 +ð
block_¿‹
;

3276 
¿‹
 +ð
block_¿‹
;

3283 
uv
=-1;

3284 ià(
cbp
 >> 4 == 2)

3286 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

3288 
b8
=4; b8 < (4 + 
p_Vid
->
num_blk8x8_uv
); b8++)

3290 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_AC
, 
b8
, 0, 
chroma_ac_·¿m
[
yuv
][b8 - 4][0]);

3291 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_AC
, 
b8
, 1, 
chroma_ac_·¿m
[
yuv
][b8 - 4][1]);

3292 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_AC
, 
b8
, 2, 
chroma_ac_·¿m
[
yuv
][b8 - 4][2]);

3293 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CHROMA_AC
, 
b8
, 3, 
chroma_ac_·¿m
[
yuv
][b8 - 4][3]);

3298 
block_¿‹
 = 0;

3299 
cu¼MB
->
is_šŒa_block
 = (
by‹
è
	`is_šŒa
(currMB);

3300 
£
.
cÚ‹xt
 = 
CHROMA_AC
;

3301 
£
.
ty³
 = (
cu¼MB
->
is_šŒa_block
 ? 
SE_CHR_AC_INTRA
 : 
SE_CHR_AC_INTER
);

3303 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3305 
b8
=4; b8 < (4+
p_Vid
->
num_blk8x8_uv
); b8++)

3307 
b4
=0; b4 < 4; b4++)

3309 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

3310 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

3312 
Ëv–
=1;

3313 
uv
++;

3314 
p_Vid
->
is_v_block
 = (
uv
 >ðÕ_Vid->
num_blk8x8_uv
 << 1));

3316 
cu¼MB
->
subblock_y
 = 
subblk_off£t_y
[
yuv
][
b8
 - 4][
b4
];

3317 
cu¼MB
->
subblock_x
 = 
subblk_off£t_x
[
yuv
][
b8
 - 4][
b4
];

3319 
k
=0; k < 16 && 
Ëv–
 != 0; k++)

3321 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[
k
];

3322 
£
.
v®ue2
 = 
ACRun
 [
k
];

3324 #ià
TRACE


3325 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "AC Chrom¨%2d:†ev– =%3d„uÀ=%2d",
k
, 
Ëv–
, se.
v®ue2
);

3327 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3328 
block_¿‹
 +ð
£
.
Ën
;

3332 
cu¼MB
->
b™s
.
mb_uv_cÛff
 +ð
block_¿‹
;

3333 
¿‹
 +ð
block_¿‹
;

3337  
¿‹
;

3338 
	}
}

3340 #ià
TRACE


3341 
šlše
 
	$Œaû_cÛff
(
SyÁaxEËm’t
 *
£
, 
¶ªe
, *
ty³
, 
k
, 
Ëv–
, 
run
)

3343 ià(
¶ªe
 == 0)

3344 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "Luma% ¢g(%2dèËv– =%3d„uÀ=%2d", 
ty³
, 
k
, 
Ëv–
,
run
);

3345 ià(
¶ªe
 == 1)

3346 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "Cb%  sng(%2dèËv– =%3d„uÀ=%2d", 
ty³
, 
k
, 
Ëv–
,
run
);

3348 
	`¢´štf
(
£
->
Œaû¡ršg
, 
TRACESTRING_SIZE
, "Cr%  sng(%2dèËv– =%3d„uÀ=%2d", 
ty³
, 
k
, 
Ëv–
,
run
);

3349 
	}
}

3358 
	$wr™eCÛff4x4_CABAC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
 
¶ªe
, 
b8
, 
b4
, 
šŒa4x4mode
)

3360 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3362 
¿‹
 = 0;

3363 
SyÁaxEËm’t
 
£
;

3364 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

3365 
D©aP¬t™iÚ
* 
d©aP¬t
;

3367 
Ëv–
;

3368 
k
;

3369 
¶_off
=
¶ªe
<<2;

3371 *
mb_b™s_cÛff
 = ((
¶ªe
==0è? &
cu¼MB
->
b™s
.
mb_y_cÛff
 : (ÕÏÃ==1è? &cu¼MB->b™s.
mb_cb_cÛff
 : &cu¼MB->b™s.
mb_ü_cÛff
));

3372 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
+
¶_off
][
b4
][0];

3373 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
+
¶_off
][
b4
][1];

3375 
cu¼MB
->
subblock_x
 = ((
b8
&0x1)==0è? (((
b4
&0x1)==0)? 0: 4) : (((b4&0x1)==0)? 8: 12);

3376 
cu¼MB
->
subblock_y
 = (
b8
<2è? ((
b4
<2) ? 0: 4) : ((b4<2) ? 8: 12);

3377 
cu¼MB
->
is_šŒa_block
 = (
by‹
è
šŒa4x4mode
;

3378 
£
.
cÚ‹xt
 = ((
¶ªe
 =ð0è? (
LUMA_4x4
è: (ÕÏÃ==1è? 
CB_4x4
 : 
CR_4x4
));

3381 
£
.
ty³
 = (
šŒa4x4mode
 ? 
SE_LUM_DC_INTRA
 : 
SE_LUM_DC_INTER
);

3384 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3386 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[0];

3387 
£
.
v®ue2
 = 
ACRun
 [0];

3389 #ià
TRACE


3390 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "4x4", 0, 
Ëv–
, se.
v®ue2
);

3393 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3394 
¿‹
 +ð
£
.
Ën
;

3397 
£
.
ty³
 = (
šŒa4x4mode
 ? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
);

3399 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3401 
k
 = 1; k <ð16 && 
Ëv–
 != 0; k++)

3403 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[
k
];

3404 
£
.
v®ue2
 = 
ACRun
 [
k
];

3405 #ià
TRACE


3406 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "4x4", 
k
, 
Ëv–
, se.
v®ue2
);

3408 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3410 
¿‹
 +ð
£
.
Ën
;

3413 *
mb_b™s_cÛff
 +ð
¿‹
;

3415  
¿‹
;

3416 
	}
}

3424 
	$wr™eCÛff8x8_CABAC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
 
¶ªe
, 
b8
, 
šŒa_mode
)

3426 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3428 
¿‹
 = 0;

3429 
SyÁaxEËm’t
 
£
;

3430 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

3431 
D©aP¬t™iÚ
* 
d©aP¬t
;

3433 
Ëv–
;

3434 
k
;

3436 
¶_off
 = 
¶ªe
<<2;

3437 *
mb_b™s_cÛff
 = ((
¶ªe
==0è? &
cu¼MB
->
b™s
.
mb_y_cÛff
 : (ÕÏÃ==1è? &cu¼MB->b™s.
mb_cb_cÛff
 : &cu¼MB->b™s.
mb_ü_cÛff
));

3438 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
+
¶_off
][0][0];

3439 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
+
¶_off
][0][1];

3441 
cu¼MB
->
subblock_x
 = ((
b8
&0x1) == 0) ? 0 : 8;

3442 
cu¼MB
->
subblock_y
 = (
b8
 < 2) ? 0 : 8;

3443 
cu¼MB
->
is_šŒa_block
 = (
by‹
è
šŒa_mode
;

3445 
£
.
cÚ‹xt
 = ((
¶ªe
==0è? (
LUMA_8x8
è: (ÕÏÃ =ð1)? 
CB_8x8
 : 
CR_8x8
));

3448 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[0];

3449 
£
.
v®ue2
 = 
ACRun
 [0];

3451 
£
.
ty³
 = (
šŒa_mode
 ? 
SE_LUM_DC_INTRA
 : 
SE_LUM_DC_INTER
);

3454 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[cu¼Sliû->
¦iû_ty³
 !ð
B_SLICE
 ? 
£
.
ty³
 : 
SE_BFRAME
]]);

3456 #ià
TRACE


3457 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "8x8", 0, 
Ëv–
, se.
v®ue2
);

3460 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3461 
¿‹
 +ð
£
.
Ën
;

3464 
£
.
ty³
 = (
šŒa_mode
 ? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
);

3466 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[cu¼Sliû->
¦iû_ty³
 !ð
B_SLICE
 ? 
£
.
ty³
 : 
SE_BFRAME
]]);

3468 
k
=1; k<=64 && 
Ëv–
 !=0; k++)

3470 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[
k
];

3471 
£
.
v®ue2
 = 
ACRun
 [
k
];

3473 #ià
TRACE


3474 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "8x8", 
k
, 
Ëv–
, se.
v®ue2
);

3477 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3478 
¿‹
 +ð
£
.
Ën
;

3481 *
mb_b™s_cÛff
 +ð
¿‹
;

3482  
¿‹
;

3483 
	}
}

3491 
	$wr™eCÛff8x8
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
block8x8
, 
block_mode
, 
ŒªsfÜm_size_æag
)

3493 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3494 
¿‹
 = 0;

3495 
is_šŒa
 = (
block_mode
 =ð
IBLOCK
è|| (block_mod=ð
I8MB
);

3500 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
 )

3502 
block_cÞÜ_ty³
 = ((
¶
 =ð0è? 
LUMA
 : (ÕÈ=ð1è? 
CB
 : 
CR
));

3504 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
block_cÞÜ_ty³
, 
block8x8
, 0, 
is_šŒa
);

3505 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
block_cÞÜ_ty³
, 
block8x8
, 1, 
is_šŒa
);

3506 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
block_cÞÜ_ty³
, 
block8x8
, 2, 
is_šŒa
);

3507 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
block_cÞÜ_ty³
, 
block8x8
, 3, 
is_šŒa
);

3511 if(
ŒªsfÜm_size_æag
)

3512 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
¶
, 
block8x8
, 
is_šŒa
);

3515 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
¶
, 
block8x8
, 0, 
is_šŒa
);

3516 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
¶
, 
block8x8
, 1, 
is_šŒa
);

3517 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
¶
, 
block8x8
, 2, 
is_šŒa
);

3518 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
¶
, 
block8x8
, 3, 
is_šŒa
);

3522  
¿‹
;

3523 
	}
}

3531 
	$wr™e_CBP_ªd_Dquªt
 (
Maüoblock
* 
cu¼MB
)

3533 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3535 
¿‹
 = 0;

3536 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

3537 
SyÁaxEËm’t
 
£
;

3538 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

3539 
cbp
 = 
cu¼MB
->cbp;

3540 
D©aP¬t™iÚ
* 
d©aP¬t
;

3542 
£
.
v®ue2
 = 0;

3544 ià(
cu¼MB
->
mb_ty³
 !ð
I16MB
)

3546 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3547 
Ãed_ŒªsfÜm_size_æag
;

3550 
£
.
v®ue1
 = 
cbp
;

3551 
£
.
ty³
 = 
SE_CBP
;

3554 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3556 #ià
TRACE


3557 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "CBP (%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, 
cbp
);

3559 
cu¼Sliû
->
	`wr™eCBP
 (
cu¼MB
, &
£
, 
d©aP¬t
);

3561 
cu¼MB
->
b™s
.
mb_cbp
 = cu¼MB->b™s.mb_cb°+ (è
£
.
Ën
;

3562 
¿‹
 +ð
£
.
Ën
;

3566 
Ãed_ŒªsfÜm_size_æag
 = (((
cu¼MB
->
mb_ty³
 >= 1 && currMB->mb_type <= 3)||

3567 (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && 
cu¼MB
->
mb_ty³
 =ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
) ||

3568 (
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
))

3569 && 
cu¼MB
->
mb_ty³
 !ð
I8MB
 && cu¼MB->mb_ty³ !ð
I4MB


3570 && (
cu¼MB
->
cbp
&15 || 
cu¼Sliû
->
cmp_cbp
[1]&15 || currSlice->cmp_cbp[2] & 15)

3571 && 
cu¼Sliû
->
p_IÅ
->
T¿nsfÜm8x8Mode
);

3573 ià(
Ãed_ŒªsfÜm_size_æag
)

3575 
£
.
v®ue1
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

3576 
£
.
ty³
 = 
SE_MBTYPE
;

3578 #ià
TRACE


3579 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "ŒªsfÜm_size_8x8_æag = %3d", 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
);

3581 
cu¼Sliû
->
	`wr™eMB_ŒªsfÜm_size
(
cu¼MB
, &
£
, 
d©aP¬t
);

3583 
mbB™s
->
mb_mode
 = mbB™s->mb_mod+ (è
£
.
Ën
;

3584 
¿‹
 +ð
£
.
Ën
;

3590 ià(
cbp
!=0 || (
cu¼MB
->
mb_ty³
 =ð
I16MB
))

3592 
£
.
v®ue1
 = 
cu¼MB
->
qp
 - cu¼MB->
´ev_qp
;

3593 
£
.
ty³
 = 
SE_DELTA_QUANT
;

3596 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3597 #ià
TRACE


3598 
	`¢´štf
(
£
.
Œaû¡ršg
, 
TRACESTRING_SIZE
, "D– QP (%2d,%2dèð%3d",
cu¼MB
->
mb_x
, cu¼MB->
mb_y
, se.
v®ue1
);

3600 
cu¼Sliû
->
	`wr™eDquªt
 (
cu¼MB
, &
£
, 
d©aP¬t
);

3601 
cu¼MB
->
b™s
.
mb_d–_quªt
 = cu¼MB->b™s.mb_d–_quªˆ+ (è
£
.
Ën
;

3602 
¿‹
 +ð
£
.
Ën
;

3605  
¿‹
;

3606 
	}
}

3615 
	$wr™eCÛff16x16_CAVLC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
 
¶ªe
)

3617 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3618 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3620 
cbp
 = 
cu¼MB
->cbp;

3622 
i
, 
k
;

3623 
¿‹
 = 0;

3625 
b8
, 
d©a_ty³
;

3626 *
mb_b™s_cÛff
 = ((
¶ªe
==0è? &
cu¼MB
->
b™s
.
mb_y_cÛff
 : (ÕÏÃ==1è? &cu¼MB->b™s.
mb_cb_cÛff
 : &cu¼MB->b™s.
mb_ü_cÛff
));

3628 ià(
cu¼Sliû
->
P444_jošed
)

3630 
i
=0; i < 4; i++)

3631 
k
=4*
¶ªe
; k<4*(plane+1); k++)

3632 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
i
][
k
] = 0;

3636 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

3640 ià(
cu¼MB
->
mb_ty³
 !ð
I16MB
)

3644 
i
=0; i<4; i++)

3646 ià(
cbp
 & (1<<
i
))

3648 
¿‹
 +ð
	`wr™eCÛff8x8
 (
cu¼MB
, 
¶ªe
, 
i
, cu¼MB->
b8x8
[i].
mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
);

3657 
¶ªe
)

3661 
d©a_ty³
 = 
LUMA_INTRA16x16DC
;

3664 
d©a_ty³
 = 
CB_INTRA16x16DC
;

3667 
d©a_ty³
 = 
CR_INTRA16x16DC
;

3670 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
d©a_ty³
, 0, 0, 0);

3674 ià(
cbp
 & 15)

3676 
¶ªe
)

3680 
d©a_ty³
 = 
LUMA_INTRA16x16AC
;

3683 
d©a_ty³
 = 
CB_INTRA16x16AC
;

3686 
d©a_ty³
 = 
CR_INTRA16x16AC
;

3690 
b8
 = 0; b8 < 4; b8 ++)

3692 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
d©a_ty³
, 
b8
, 0, 0);

3693 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
d©a_ty³
, 
b8
, 1, 0);

3694 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
d©a_ty³
, 
b8
, 2, 0);

3695 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
d©a_ty³
, 
b8
, 3, 0);

3699 
mb_b™s_cÛff
 +ð
¿‹
;

3700  
¿‹
;

3701 
	}
}

3711 
	$wr™eCÛff16x16_CABAC
 (
Maüoblock
* 
cu¼MB
, 
CÞÜPÏÃ
 
¶ªe
)

3713 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3714 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

3716 
cbp
 = 
cu¼MB
->cbp;

3718 
mb_x
, 
mb_y
, 
i
, 
j
, 
k
;

3719 
Ëv–
;

3720 
¿‹
 = 0;

3721 
block_¿‹
 = 0;

3722 
SyÁaxEËm’t
 
£
;

3723 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

3724 
¶_off
 = 
¶ªe
<<2;

3725 
D©aP¬t™iÚ
* 
d©aP¬t
;

3727 
b8
, 
b4
;

3728 * 
DCLev–
 = 
cu¼Sliû
->
cofDC
[
¶ªe
][0];

3729 * 
DCRun
 = 
cu¼Sliû
->
cofDC
[
¶ªe
][1];

3730 * 
ACLev–
;

3731 * 
ACRun
;

3732 
d©a_ty³
;

3733 * 
mb_b™s_cÛff
 = ((
¶ªe
==0è? &
cu¼MB
->
b™s
.
mb_y_cÛff
 : (ÕÏÃ==1è? &cu¼MB->b™s.
mb_cb_cÛff
 : &cu¼MB->b™s.
mb_ü_cÛff
));

3735 ià(
cu¼Sliû
->
P444_jošed
)

3737 
i
=0; i < 4; i++)

3738 
k
=4*
¶ªe
; k<4*(plane+1); k++)

3739 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
i
][
k
] = 0;

3743 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

3747 ià(
cu¼MB
->
mb_ty³
 !ð
I16MB
)

3751 ià(
cbp
 != 0)

3753 
i
=0; i<4; i++)

3755 ià(
cbp
 & (1<<
i
))

3757 
¿‹
 +ð
	`wr™eCÛff8x8
 (
cu¼MB
, 
¶ªe
, 
i
, cu¼MB->
b8x8
[i].
mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
);

3767 
cu¼MB
->
is_šŒa_block
 = 
TRUE
;

3768 
¶ªe
)

3772 
d©a_ty³
 = 
LUMA_16DC
;

3775 
d©a_ty³
 = 
CB_16DC
;

3778 
d©a_ty³
 = 
CR_16DC
;

3782 
£
.
cÚ‹xt
 = 
d©a_ty³
;

3783 
£
.
ty³
 = 
SE_LUM_DC_INTRA
;

3786 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3788 
Ëv–
 = 1;

3789 
k
=0; k<=16 && 
Ëv–
!=0; k++)

3791 
Ëv–
 = 
£
.
v®ue1
 = 
DCLev–
[
k
];

3792 
£
.
v®ue2
 = 
DCRun
 [
k
];

3793 #ià
TRACE


3794 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "16x16 DC", 
k
, 
Ëv–
, se.
v®ue2
);

3796 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3797 
block_¿‹
 +ð
£
.
Ën
;

3799 *
mb_b™s_cÛff
 +ð
block_¿‹
;

3800 
¿‹
 +ð
block_¿‹
;

3803 ià(
cbp
 & 15)

3805 
¶ªe
)

3809 
d©a_ty³
 = 
LUMA_16AC
;

3812 
d©a_ty³
 = 
CB_16AC
;

3815 
d©a_ty³
 = 
CR_16AC
;

3819 
£
.
cÚ‹xt
 = 
d©a_ty³
;

3820 
£
.
ty³
 = 
SE_LUM_AC_INTRA
;

3823 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

3824 
block_¿‹
 = 0;

3826 
mb_y
 = 0; mb_y < 4; mb_y += 2)

3828 
mb_x
 = 0; mb_x < 4; mb_x += 2)

3830 
j
 = 
mb_y
; j < mb_y + 2; j++)

3832 
j1
 = 2*(
j
 >> 1);

3833 
j2
 = 2*(
j
 & 0x01);

3834 
cu¼MB
->
subblock_y
 = (è(
j
 << 2);

3836 
i
=
mb_x
; i < mb_x+2; i++)

3838 
cu¼MB
->
subblock_x
 = (è(
i
 << 2);

3839 
b8
 = 
j1
 + (
i
 >> 1è+ 
¶_off
;

3840 
b4
 = 
j2
 + (
i
 & 0x01);

3842 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

3843 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

3845 
Ëv–
=1;

3847 
k
=0; k < 16 && 
Ëv–
 !=0; k++)

3849 
Ëv–
 = 
£
.
v®ue1
 = 
ACLev–
[
k
];

3850 
£
.
v®ue2
 = 
ACRun
 [
k
];

3851 #ià
TRACE


3852 
	`Œaû_cÛff
(&
£
, 
¶ªe
, "16x16 AC", 
k
, 
Ëv–
, se.
v®ue2
);

3854 
	`wr™eRunLev–_CABAC
(
cu¼MB
, &
£
, 
d©aP¬t
);

3855 
block_¿‹
 +ð
£
.
Ën
;

3862 
¿‹
 +ð
block_¿‹
;

3863 *
mb_b™s_cÛff
 +ð
block_¿‹
;

3867  
¿‹
;

3868 
	}
}

3878 
	$´ediù_Âz
(
Maüoblock
 *
cu¼MB
, 
block_ty³
, 
i
,
j
)

3880 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3881 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3882 
Pix–Pos
 
pix
;

3884 
´ed_Âz
 = 0;

3885 
út
 = 0;

3888 
	`g‘4x4Neighbour
(
cu¼MB
, (
i
 << 2è- 1, (
j
 << 2), 
p_Vid
->
mb_size
[
IS_LUMA
], &
pix
);

3890 ià(
	`is_šŒa
(
cu¼MB
è&& 
pix
.
avažabË
 && 
p_Vid
->
aùive_µs
->
cÚ¡¿šed_šŒa_´ed_æag
 && ((
cu¼Sliû
->
·¹™iÚ_mode
 !ð0è&& !cu¼Sliû->
idr_æag
))

3892 
pix
.
avažabË
 &ð
p_Vid
->
šŒa_block
[pix.
mb_addr
];

3893 ià(!
pix
.
avažabË
)

3894 
út
++;

3897 ià(
pix
.
avažabË
)

3899 
block_ty³
)

3901 
LUMA
:

3902 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][pix.
y
];

3903 
út
++;

3905 
CB
:

3906 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][4+pix.
y
];

3907 
út
++;

3909 
CR
:

3910 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][8+pix.
y
];

3911 
út
++;

3914 
	`”rÜ
("writeCoeff4x4_CAVLC: Invalid blockype", 600);

3920 
	`g‘4x4Neighbour
(
cu¼MB
, (
i
<<2), (
j
<<2è- 1, 
p_Vid
->
mb_size
[
IS_LUMA
], &
pix
);

3922 ià(
	`is_šŒa
(
cu¼MB
è&& 
pix
.
avažabË
 && 
p_Vid
->
aùive_µs
->
cÚ¡¿šed_šŒa_´ed_æag
 && ((
cu¼Sliû
->
·¹™iÚ_mode
 !ð0è&& !cu¼Sliû->
idr_æag
))

3924 
pix
.
avažabË
 &ð
p_Vid
->
šŒa_block
[pix.
mb_addr
];

3925 ià(!
pix
.
avažabË
)

3926 
út
++;

3929 ià(
pix
.
avažabË
)

3931 
block_ty³
)

3933 
LUMA
:

3934 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][pix.
y
];

3935 
út
++;

3937 
CB
:

3938 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][4+pix.
y
];

3939 
út
++;

3941 
CR
:

3942 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][pix.
x
][8+pix.
y
];

3943 
út
++;

3946 
	`”rÜ
("writeCoeff4x4_CAVLC: Invalid blockype", 600);

3951 ià(
út
==2)

3953 
´ed_Âz
++;

3954 
´ed_Âz
>>=1;

3957  
´ed_Âz
;

3958 
	}
}

3969 
	$´ediù_Âz_chroma
(
Maüoblock
 *
cu¼MB
, 
i
,
j
)

3971 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3972 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3973 
Pix–Pos
 
pix
;

3975 
´ed_Âz
 = 0;

3976 
út
 = 0;

3978 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV444
)

3982 
	`g‘4x4Neighbour
(
cu¼MB
, ((
i
 & 0x01)<<2è- 1, ((
j
-4)<<2), 
p_Vid
->
mb_size
[
IS_CHROMA
], &
pix
);

3984 ià(
	`is_šŒa
(
cu¼MB
è&& 
pix
.
avažabË
 && 
p_Vid
->
aùive_µs
->
cÚ¡¿šed_šŒa_´ed_æag
 && ((
cu¼Sliû
->
·¹™iÚ_mode
 !ð0è&& !cu¼Sliû->
idr_æag
))

3986 
pix
.
avažabË
 &ð
p_Vid
->
šŒa_block
[pix.
mb_addr
];

3987 ià(!
pix
.
avažabË
)

3988 
út
++;

3991 ià(
pix
.
avažabË
)

3993 
´ed_Âz
 = 
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][2 * (
i
 >> 1è+…ix.
x
][4 +…ix.
y
];

3994 
út
++;

3998 
	`g‘4x4Neighbour
(
cu¼MB
, ((
i
 & 0x01)<<2), ((
j
-4)<<2è-1, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
pix
);

4000 ià(
	`is_šŒa
(
cu¼MB
è&& 
pix
.
avažabË
 && 
p_Vid
->
aùive_µs
->
cÚ¡¿šed_šŒa_´ed_æag
 && ((
cu¼Sliû
->
·¹™iÚ_mode
 !ð0è&& !cu¼Sliû->
idr_æag
))

4002 
pix
.
avažabË
 &ð
p_Vid
->
šŒa_block
[pix.
mb_addr
];

4003 ià(!
pix
.
avažabË
)

4004 
út
++;

4007 ià(
pix
.
avažabË
)

4009 
´ed_Âz
 +ð
p_Vid
->
nz_cÛff
 [
pix
.
mb_addr
 ][2 * (
i
 >> 1è+…ix.
x
][4 +…ix.
y
];

4010 
út
++;

4015 ià(
út
==2)

4017 
´ed_Âz
++;

4018 
´ed_Âz
>>=1;

4021  
´ed_Âz
;

4022 
	}
}

4034 
	$wr™eCÛff4x4_CAVLC_nÜm®
 (
Maüoblock
* 
cu¼MB
, 
block_ty³
, 
b8
, 
b4
, 
·¿m
)

4036 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

4037 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

4038 
no_b™s
 = 0;

4039 
SyÁaxEËm’t
 
£
;

4040 
D©aP¬t™iÚ
 *
d©aP¬t
;

4041 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

4043 
k
,
Ëv–
 = 1,
run
 = 0, 
vlúum
;

4044 
numcÛff
 = 0, 
Ï¡cÛff
 = 0, 
numŒažšgÚes
 = 0;

4045 
numÚes
 = 0, 
tÙz”os
 = 0, 
z”o¦eá
, 
numcÛf
;

4046 
numcÛff_vlc
;

4047 
code
, 
Ëv–_two_Ü_high”
;

4048 
d±y³
 = 0;

4049 
Âz
, 
max_cÛff_num
 = 0, 
cdc
 = 0, 
ÿc
 = 0;

4050 
subblock_x
, 
subblock_y
;

4051 *
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_y_cÛff
;

4052 #ià
TRACE


4053 
ty³
[15];

4056 cÚ¡ 
šcVlc
[] = {0, 3, 6, 12, 24, 48, 32768};

4059 * 
pLev–
 = 
NULL
;

4060 * 
pRun
 = 
NULL
;

4062 
block_ty³
)

4064 
LUMA
:

4065 
max_cÛff_num
 = 16;

4067 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4068 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4069 #ià
TRACE


4070 
	`¥rštf
(
ty³
, "%s", "Luma");

4072 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
;

4075 
CHROMA_AC
:

4076 
max_cÛff_num
 = 15;

4077 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_uv_cÛff
;

4078 
ÿc
 = 1;

4080 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4081 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4082 #ià
TRACE


4083 
	`¥rštf
(
ty³
, "%s", "ChrAC");

4085 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_CHR_AC_INTRA
 : 
SE_CHR_AC_INTER
;

4088 
CHROMA_DC
:

4089 
max_cÛff_num
 = 
p_Vid
->
num_cdc_cÛff
;

4090 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_uv_cÛff
;

4091 
cdc
 = 1;

4093 
pLev–
 = 
cu¼Sliû
->
cofDC
[
·¿m
 + 1][0];

4094 
pRun
 = 
cu¼Sliû
->
cofDC
[
·¿m
 + 1][1];

4095 #ià
TRACE


4096 
	`¥rštf
(
ty³
, "%s", "ChrDC");

4098 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_CHR_DC_INTRA
 : 
SE_CHR_DC_INTER
;

4101 
LUMA_INTRA16x16AC
:

4102 
max_cÛff_num
 = 15;

4104 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4105 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4106 #ià
TRACE


4107 
	`¥rštf
(
ty³
, "%s", "Lum16AC");

4109 
d±y³
 = 
SE_LUM_AC_INTRA
;

4112 
LUMA_INTRA16x16DC
:

4113 
max_cÛff_num
 = 16;

4115 
pLev–
 = 
cu¼Sliû
->
cofDC
[0][0];

4116 
pRun
 = 
cu¼Sliû
->
cofDC
[0][1];

4117 #ià
TRACE


4118 
	`¥rštf
(
ty³
, "%s", "Lum16DC");

4120 
d±y³
 = 
SE_LUM_DC_INTRA
;

4125 
	`”rÜ
("writeCoeff4x4_CAVLC: Invalid blockype", 600);

4129 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
d±y³
]]);

4131 
k
 = 0; (k <ð((
cdc
è? 
p_Vid
->
num_cdc_cÛff
 : 16)è&& 
Ëv–
 != 0; k++)

4133 
Ëv–
 = 
pLev–
[
k
];

4134 
run
 = 
pRun
[
k
];

4136 ià(
Ëv–
)

4139 
tÙz”os
 +ð
run
;

4140 ià(
	`Ÿbs
(
Ëv–
) == 1)

4142 
numÚes
 ++;

4143 
numŒažšgÚes
 ++;

4144 
numŒažšgÚes
 = 
	`imš
(numtrailingones, 3);

4148 
numŒažšgÚes
 = 0;

4150 
numcÛff
 ++;

4151 
Ï¡cÛff
 = 
k
;

4155 ià(!
cdc
)

4157 ià(!
ÿc
)

4160 
subblock_x
 = ((
b8
 & 0x1è=ð0è? (((
b4
 & 0x1) == 0) ? 0 : 1) : (((b4 & 0x1) == 0) ? 2 : 3);

4162 
subblock_y
 = (
b8
 < 2è? ((
b4
 < 2) ? 0 : 1) : ((b4 < 2) ? 2 : 3);

4164 
Âz
 = 
	`´ediù_Âz
(
cu¼MB
, 
LUMA
, 
subblock_x
,
subblock_y
);

4169 
subblock_x
 = 
·¿m
 >> 4;

4170 
subblock_y
 = 
·¿m
 & 15;

4171 
Âz
 = 
	`´ediù_Âz_chroma
(
cu¼MB
, 
subblock_x
, 
subblock_y
);

4173 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
 ][
subblock_x
][
subblock_y
] = 
numcÛff
;

4175 
numcÛff_vlc
 = (
Âz
 < 2) ? 0 : ((nnz < 4) ? 1 : ((nnz < 8) ? 2 : 3));

4181 
numcÛff_vlc
 = 0;

4183 
subblock_x
 = 
·¿m
;

4184 
subblock_y
 = 
·¿m
;

4187 
£
.
ty³
 = 
d±y³
;

4189 
£
.
v®ue1
 = 
numcÛff
;

4190 
£
.
v®ue2
 = 
numŒažšgÚes
;

4191 
£
.
Ën
 = 
numcÛff_vlc
;

4193 #ià
TRACE


4194 
	`¢´štf
(
£
.
Œaû¡ršg
,

4195 
TRACESTRING_SIZE
, "%s # c &r.1s(%d,%d) vlc=%d #c=%d #t1=%d",

4196 
ty³
, 
subblock_x
, 
subblock_y
, 
numcÛff_vlc
, 
numcÛff
, 
numŒažšgÚes
);

4199 ià(!
cdc
)

4200 
	`wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃs
(&
£
, 
d©aP¬t
);

4202 
	`wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃsChromaDC
(
p_Vid
, &
£
, 
d©aP¬t
);

4204 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4205 
no_b™s
 +ð
£
.
Ën
;

4207 ià(!
numcÛff
)

4208  
no_b™s
;

4210 ià(
numcÛff
)

4212 
code
 = 0;

4213 
k
 = 
Ï¡cÛff
; k >†a¡cÛfà- 
numŒažšgÚes
; k--)

4215 
Ëv–
 = 
pLev–
[
k
];

4216 #ifdeà 
_DEBUG


4217 ià(
	`Ÿbs
(
Ëv–
) > 1)

4219 
	`´štf
("ERROR:†evel > 1\n");

4220 
	`ex™
(-1);

4223 
code
 <<= 1;

4225 
code
 |ð(
Ëv–
 < 0);

4228 ià(
numŒažšgÚes
)

4230 
£
.
ty³
 = 
d±y³
;

4232 
£
.
v®ue2
 = 
numŒažšgÚes
;

4233 
£
.
v®ue1
 = 
code
;

4235 #ià
TRACE


4236 
	`¢´štf
(
£
.
Œaû¡ršg
,

4237 
TRACESTRING_SIZE
, "%srailing ones sign (%d,%d)",

4238 
ty³
, 
subblock_x
, 
subblock_y
);

4241 
	`wr™eSyÁaxEËm’t_VLC
 (&
£
, 
d©aP¬t
);

4242 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4243 
no_b™s
 +ð
£
.
Ën
;

4248 
Ëv–_two_Ü_high”
 = (
numcÛff
 > 3 && 
numŒažšgÚes
 == 3) ? 0 : 1;

4250 
vlúum
 = (
numcÛff
 > 10 && 
numŒažšgÚes
 < 3) ? 1 : 0;

4252 
k
 = 
Ï¡cÛff
 - 
numŒažšgÚes
; k >= 0; k--)

4254 
Ëv–
 = 
pLev–
[
k
];

4256 
£
.
v®ue1
 = 
Ëv–
;

4257 
£
.
ty³
 = 
d±y³
;

4259 #ià
TRACE


4260 
	`¢´štf
(
£
.
Œaû¡ršg
,

4261 
TRACESTRING_SIZE
, "%s†ev (%d,%d) k=%d vlc=%d†ev=%3d",

4262 
ty³
, 
subblock_x
, 
subblock_y
, 
k
, 
vlúum
, 
Ëv–
);

4265 ià(
Ëv–_two_Ü_high”
)

4267 
Ëv–_two_Ü_high”
 = 0;

4269 ià(
£
.
v®ue1
 > 0)

4270 
£
.
v®ue1
 --;

4272 
£
.
v®ue1
 ++;

4277 ià(
vlúum
 == 0)

4278 
	`wr™eSyÁaxEËm’t_Lev–_VLC1
(&
£
, 
d©aP¬t
, 
p_Vid
->
aùive_¥s
->
´ofže_idc
);

4280 
	`wr™eSyÁaxEËm’t_Lev–_VLCN
(&
£
, 
vlúum
, 
d©aP¬t
, 
p_Vid
->
aùive_¥s
->
´ofže_idc
);

4283 ià(
	`Ÿbs
(
Ëv–
è> 
šcVlc
[
vlúum
])

4284 
vlúum
++;

4286 ià((
k
 =ð
Ï¡cÛff
 - 
numŒažšgÚes
è&& 
	`Ÿbs
(
Ëv–
) > 3)

4287 
vlúum
 = 2;

4289 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4290 
no_b™s
 +ð
£
.
Ën
;

4294 ià(
numcÛff
 < 
max_cÛff_num
)

4297 
£
.
ty³
 = 
d±y³
;

4298 
£
.
v®ue1
 = 
tÙz”os
;

4300 
vlúum
 = 
numcÛff
 - 1;

4302 
£
.
Ën
 = 
vlúum
;

4304 #ià
TRACE


4305 
	`¢´štf
(
£
.
Œaû¡ršg
,

4306 
TRACESTRING_SIZE
, "%sotalrun (%d,%d) vlc=%dotzeros=%3d",

4307 
ty³
, 
subblock_x
, 
subblock_y
, 
vlúum
, 
tÙz”os
);

4309 ià(!
cdc
)

4310 
	`wr™eSyÁaxEËm’t_TÙ®Z”os
(&
£
, 
d©aP¬t
);

4312 
	`wr™eSyÁaxEËm’t_TÙ®Z”osChromaDC
(
p_Vid
, &
£
, 
d©aP¬t
);

4314 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4315 
no_b™s
 +ð
£
.
Ën
;

4319 
z”o¦eá
 = 
tÙz”os
;

4320 
numcÛf
 = 
numcÛff
;

4321 
k
 = 
Ï¡cÛff
; k >= 0; k--)

4323 
run
 = 
pRun
[
k
];

4325 
£
.
v®ue1
 = 
run
;

4326 
£
.
ty³
 = 
d±y³
;

4330 ià((!
z”o¦eá
è|| (
numcÛff
 <= 1 ))

4333 ià(
numcÛf
 > 1 && 
z”o¦eá
)

4335 
vlúum
 = 
	`imš
(
z”o¦eá
 - 1, 
RUNBEFORE_NUM_M1
);

4336 
£
.
Ën
 = 
vlúum
;

4338 #ià
TRACE


4339 
	`¢´štf
(
£
.
Œaû¡ršg
,

4340 
TRACESTRING_SIZE
, "%s„un (%d,%d) k=%d vlc=%d„un=%2d",

4341 
ty³
, 
subblock_x
, 
subblock_y
, 
k
, 
vlúum
, 
run
);

4344 
	`wr™eSyÁaxEËm’t_Run
(&
£
, 
d©aP¬t
);

4346 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4347 
no_b™s
 +ð
£
.
Ën
;

4349 
z”o¦eá
 -ð
run
;

4350 
numcÛf
 --;

4355  
no_b™s
;

4356 
	}
}

4368 
	$wr™eCÛff4x4_CAVLC_444
 (
Maüoblock
* 
cu¼MB
, 
block_ty³
, 
b8
, 
b4
, 
·¿m
)

4370 
Sliû
* 
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

4371 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

4372 
no_b™s
 = 0;

4373 
SyÁaxEËm’t
 
£
;

4374 
D©aP¬t™iÚ
 *
d©aP¬t
;

4375 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

4377 
k
,
Ëv–
 = 1,
run
 = 0, 
vlúum
;

4378 
numcÛff
 = 0, 
Ï¡cÛff
 = 0, 
numŒažšgÚes
 = 0;

4379 
numÚes
 = 0, 
tÙz”os
 = 0, 
z”o¦eá
, 
numcÛf
;

4380 
numcÛff_vlc
;

4381 
code
, 
Ëv–_two_Ü_high”
;

4382 
d±y³
 = 0;

4383 
Âz
, 
max_cÛff_num
 = 0, 
cdc
 = 0, 
ÿc
 = 0;

4384 
subblock_x
, 
subblock_y
;

4385 *
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_y_cÛff
;

4386 #ià
TRACE


4387 
ty³
[15];

4390 cÚ¡ 
šcVlc
[] = {0, 3, 6, 12, 24, 48, 32768};

4392 * 
pLev–
 = 
NULL
;

4393 * 
pRun
 = 
NULL
;

4395 
block_ty³
)

4397 
LUMA
:

4398 
max_cÛff_num
 = 16;

4400 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4401 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4402 #ià
TRACE


4403 
	`¥rštf
(
ty³
, "%s", "Luma");

4405 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
;

4407 
LUMA_INTRA16x16DC
:

4408 
max_cÛff_num
 = 16;

4410 
pLev–
 = 
cu¼Sliû
->
cofDC
[0][0];

4411 
pRun
 = 
cu¼Sliû
->
cofDC
[0][1];

4412 #ià
TRACE


4413 
	`¥rštf
(
ty³
, "%s", "Lum16DC");

4415 
d±y³
 = 
SE_LUM_DC_INTRA
;

4417 
LUMA_INTRA16x16AC
:

4418 
max_cÛff_num
 = 15;

4420 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4421 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4422 #ià
TRACE


4423 
	`¥rštf
(
ty³
, "%s", "Lum16AC");

4425 
d±y³
 = 
SE_LUM_AC_INTRA
;

4427 
CB
:

4428 
max_cÛff_num
 = 16;

4429 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_cb_cÛff
;

4431 
pLev–
 = 
cu¼Sliû
->
cofAC
[4+
b8
][
b4
][0];

4432 
pRun
 = 
cu¼Sliû
->
cofAC
[4+
b8
][
b4
][1];

4433 #ià
TRACE


4434 
	`¥rštf
(
ty³
, "%s", "CB");

4436 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
;

4438 
CB_INTRA16x16DC
:

4439 
max_cÛff_num
 = 16;

4440 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_cb_cÛff
;

4442 
pLev–
 = 
cu¼Sliû
->
cofDC
[1][0];

4443 
pRun
 = 
cu¼Sliû
->
cofDC
[1][1];

4444 #ià
TRACE


4445 
	`¥rštf
(
ty³
, "%s", "CB_16DC");

4447 
d±y³
 = 
SE_LUM_DC_INTRA
;

4449 
CB_INTRA16x16AC
:

4450 
max_cÛff_num
 = 15;

4451 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_cb_cÛff
;

4453 
pLev–
 = 
cu¼Sliû
->
cofAC
[4+
b8
][
b4
][0];

4454 
pRun
 = 
cu¼Sliû
->
cofAC
[4+
b8
][
b4
][1];

4455 #ià
TRACE


4456 
	`¥rštf
(
ty³
, "%s", "CB_16AC");

4458 
d±y³
 = 
SE_LUM_AC_INTRA
;

4461 
CR
:

4462 
max_cÛff_num
 = 16;

4463 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_ü_cÛff
;

4465 
pLev–
 = 
cu¼Sliû
->
cofAC
[8+
b8
][
b4
][0];

4466 
pRun
 = 
cu¼Sliû
->
cofAC
[8+
b8
][
b4
][1];

4467 #ià
TRACE


4468 
	`¥rštf
(
ty³
, "%s", "CR");

4470 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_LUM_AC_INTRA
 : 
SE_LUM_AC_INTER
;

4472 
CR_INTRA16x16DC
:

4473 
max_cÛff_num
 = 16;

4474 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_ü_cÛff
;

4476 
pLev–
 = 
cu¼Sliû
->
cofDC
[2][0];

4477 
pRun
 = 
cu¼Sliû
->
cofDC
[2][1];

4478 #ià
TRACE


4479 
	`¥rštf
(
ty³
, "%s", "CR_16DC");

4481 
d±y³
 = 
SE_LUM_DC_INTRA
;

4483 
CR_INTRA16x16AC
:

4484 
max_cÛff_num
 = 15;

4485 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_ü_cÛff
;

4487 
pLev–
 = 
cu¼Sliû
->
cofAC
[8+
b8
][
b4
][0];

4488 
pRun
 = 
cu¼Sliû
->
cofAC
[8+
b8
][
b4
][1];

4489 #ià
TRACE


4490 
	`¥rštf
(
ty³
, "%s", "CR_16AC");

4492 
d±y³
 = 
SE_LUM_AC_INTRA
;

4495 
CHROMA_DC
:

4496 
max_cÛff_num
 = 
p_Vid
->
num_cdc_cÛff
;

4497 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_uv_cÛff
;

4498 
cdc
 = 1;

4500 
pLev–
 = 
cu¼Sliû
->
cofDC
[
·¿m
+1][0];

4501 
pRun
 = 
cu¼Sliû
->
cofDC
[
·¿m
+1][1];

4502 #ià
TRACE


4503 
	`¥rštf
(
ty³
, "%s", "ChrDC");

4505 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_CHR_DC_INTRA
 : 
SE_CHR_DC_INTER
;

4507 
CHROMA_AC
:

4508 
max_cÛff_num
 = 15;

4509 
mb_b™s_cÛff
 = &
cu¼MB
->
b™s
.
mb_uv_cÛff
;

4510 
ÿc
 = 1;

4512 
pLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

4513 
pRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

4514 #ià
TRACE


4515 
	`¥rštf
(
ty³
, "%s", "ChrAC");

4517 
d±y³
 = (
	`is_šŒa
 (
cu¼MB
)è? 
SE_CHR_AC_INTRA
 : 
SE_CHR_AC_INTER
;

4520 
	`”rÜ
("writeCoeff4x4_CAVLC: Invalid blockype", 600);

4524 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
d±y³
]]);

4526 
k
 = 0; (k <ð((
cdc
è? 
p_Vid
->
num_cdc_cÛff
 : 16)è&& 
Ëv–
 != 0; k++)

4528 
Ëv–
 = 
pLev–
[
k
];

4529 
run
 = 
pRun
[
k
];

4531 ià(
Ëv–
)

4534 
tÙz”os
 +ð
run
;

4535 ià(
	`Ÿbs
(
Ëv–
) == 1)

4537 
numÚes
 ++;

4538 
numŒažšgÚes
 ++;

4539 
numŒažšgÚes
 = 
	`imš
(numtrailingones, 3);

4543 
numŒažšgÚes
 = 0;

4545 
numcÛff
 ++;

4546 
Ï¡cÛff
 = 
k
;

4550 ià(!
cdc
)

4552 if(
block_ty³
==
LUMA
 || block_ty³==
LUMA_INTRA16x16DC
 || block_ty³==
LUMA_INTRA16x16AC


4553 ||
block_ty³
==
CHROMA_AC
)

4555 ià(!
ÿc
)

4558 
subblock_x
 = ((
b8
 & 0x1è=ð0è? (((
b4
 & 0x1) == 0) ? 0 : 1) : (((b4 & 0x1) == 0) ? 2 : 3);

4560 
subblock_y
 = (
b8
 < 2è? ((
b4
 < 2) ? 0 : 1) : ((b4 < 2) ? 2 : 3);

4562 
Âz
 = 
	`´ediù_Âz
(
cu¼MB
, 
LUMA
, 
subblock_x
,
subblock_y
);

4567 
subblock_x
 = 
·¿m
 >> 4;

4568 
subblock_y
 = 
·¿m
 & 15;

4569 
Âz
 = 
	`´ediù_Âz_chroma
(
cu¼MB
, 
subblock_x
, 
subblock_y
);

4571 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
 ][
subblock_x
][
subblock_y
] = 
numcÛff
;

4573 ià(
block_ty³
==
CB
 || block_ty³==
CB_INTRA16x16DC


4574 || 
block_ty³
==
CB_INTRA16x16AC
)

4576 
subblock_x
 = ((
b8
 & 0x1è=ð0)?(((
b4
 & 0x1) == 0) ? 0 : 1):(((b4 & 0x1) == 0) ? 2 : 3);

4578 
subblock_y
 = (
b8
 < 2è? ((
b4
 < 2) ? 0 : 1) : ((b4 < 2) ? 2 : 3);

4580 
Âz
 = 
	`´ediù_Âz
(
cu¼MB
, 
CB
, 
subblock_x
,
subblock_y
);

4581 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
 ][
subblock_x
][4+
subblock_y
] = 
numcÛff
;

4585 
subblock_x
 = ((
b8
 & 0x1è=ð0)?(((
b4
 & 0x1) == 0) ? 0 : 1) : (((b4 & 0x1) == 0) ? 2 : 3);

4587 
subblock_y
 = (
b8
 < 2è? ((
b4
 < 2) ? 0 : 1) : ((b4 < 2) ? 2 : 3);

4589 
Âz
 = 
	`´ediù_Âz
(
cu¼MB
, 
CR
, 
subblock_x
,
subblock_y
);

4590 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
 ][
subblock_x
][8+
subblock_y
] = 
numcÛff
;

4593 
numcÛff_vlc
 = (
Âz
 < 2) ? 0 : ((nnz < 4) ? 1 : ((nnz < 8) ? 2 : 3));

4599 
numcÛff_vlc
 = 0;

4601 
subblock_x
 = 
·¿m
;

4602 
subblock_y
 = 
·¿m
;

4605 
£
.
ty³
 = 
d±y³
;

4607 
£
.
v®ue1
 = 
numcÛff
;

4608 
£
.
v®ue2
 = 
numŒažšgÚes
;

4609 
£
.
Ën
 = 
numcÛff_vlc
;

4611 #ià
TRACE


4612 
	`¢´štf
(
£
.
Œaû¡ršg
,

4613 
TRACESTRING_SIZE
, "%s # c &r.1s(%d,%d) vlc=%d #c=%d #t1=%d",

4614 
ty³
, 
subblock_x
, 
subblock_y
, 
numcÛff_vlc
, 
numcÛff
, 
numŒažšgÚes
);

4617 ià(!
cdc
)

4618 
	`wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃs
(&
£
, 
d©aP¬t
);

4620 
	`wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃsChromaDC
(
p_Vid
, &
£
, 
d©aP¬t
);

4622 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4623 
no_b™s
 +ð
£
.
Ën
;

4625 ià(!
numcÛff
)

4626  
no_b™s
;

4628 ià(
numcÛff
)

4630 
code
 = 0;

4631 
k
 = 
Ï¡cÛff
; k >†a¡cÛfà- 
numŒažšgÚes
; k--)

4633 
Ëv–
 = 
pLev–
[
k
];

4635 ià(
	`Ÿbs
(
Ëv–
) > 1)

4637 
	`´štf
("ERROR:†evel > 1\n");

4638 
	`ex™
(-1);

4641 
code
 <<= 1;

4643 ià(
Ëv–
 < 0)

4645 
code
 |= 0x1;

4649 ià(
numŒažšgÚes
)

4651 
£
.
ty³
 = 
d±y³
;

4653 
£
.
v®ue2
 = 
numŒažšgÚes
;

4654 
£
.
v®ue1
 = 
code
;

4656 #ià
TRACE


4657 
	`¢´štf
(
£
.
Œaû¡ršg
,

4658 
TRACESTRING_SIZE
, "%srailing ones sign (%d,%d)",

4659 
ty³
, 
subblock_x
, 
subblock_y
);

4662 
	`wr™eSyÁaxEËm’t_VLC
 (&
£
, 
d©aP¬t
);

4663 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4664 
no_b™s
 +ð
£
.
Ën
;

4669 
Ëv–_two_Ü_high”
 = (
numcÛff
 > 3 && 
numŒažšgÚes
 == 3) ? 0 : 1;

4671 
vlúum
 = (
numcÛff
 > 10 && 
numŒažšgÚes
 < 3) ? 1 : 0;

4673 
k
 = 
Ï¡cÛff
 - 
numŒažšgÚes
; k >= 0; k--)

4675 
Ëv–
 = 
pLev–
[
k
];

4677 
£
.
v®ue1
 = 
Ëv–
;

4678 
£
.
ty³
 = 
d±y³
;

4680 #ià
TRACE


4681 
	`¢´štf
(
£
.
Œaû¡ršg
,

4682 
TRACESTRING_SIZE
, "%s†ev (%d,%d) k=%d vlc=%d†ev=%3d",

4683 
ty³
, 
subblock_x
, 
subblock_y
, 
k
, 
vlúum
, 
Ëv–
);

4686 ià(
Ëv–_two_Ü_high”
)

4688 
Ëv–_two_Ü_high”
 = 0;

4690 ià(
£
.
v®ue1
 > 0)

4691 
£
.
v®ue1
 --;

4693 
£
.
v®ue1
 ++;

4698 ià(
vlúum
 == 0)

4699 
	`wr™eSyÁaxEËm’t_Lev–_VLC1
(&
£
, 
d©aP¬t
, 
p_Vid
->
aùive_¥s
->
´ofže_idc
);

4701 
	`wr™eSyÁaxEËm’t_Lev–_VLCN
(&
£
, 
vlúum
, 
d©aP¬t
, 
p_Vid
->
aùive_¥s
->
´ofže_idc
);

4704 ià(
	`Ÿbs
(
Ëv–
è> 
šcVlc
[
vlúum
])

4705 
vlúum
++;

4707 ià((
k
 =ð
Ï¡cÛff
 - 
numŒažšgÚes
è&& 
	`Ÿbs
(
Ëv–
) > 3)

4708 
vlúum
 = 2;

4710 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4711 
no_b™s
 +ð
£
.
Ën
;

4715 ià(
numcÛff
 < 
max_cÛff_num
)

4718 
£
.
ty³
 = 
d±y³
;

4719 
£
.
v®ue1
 = 
tÙz”os
;

4721 
vlúum
 = 
numcÛff
 - 1;

4723 
£
.
Ën
 = 
vlúum
;

4725 #ià
TRACE


4726 
	`¢´štf
(
£
.
Œaû¡ršg
,

4727 
TRACESTRING_SIZE
, "%sotalrun (%d,%d) vlc=%dotzeros=%3d",

4728 
ty³
, 
subblock_x
, 
subblock_y
, 
vlúum
, 
tÙz”os
);

4730 ià(!
cdc
)

4731 
	`wr™eSyÁaxEËm’t_TÙ®Z”os
(&
£
, 
d©aP¬t
);

4733 
	`wr™eSyÁaxEËm’t_TÙ®Z”osChromaDC
(
p_Vid
, &
£
, 
d©aP¬t
);

4735 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4736 
no_b™s
 +ð
£
.
Ën
;

4740 
z”o¦eá
 = 
tÙz”os
;

4741 
numcÛf
 = 
numcÛff
;

4742 
k
 = 
Ï¡cÛff
; k >= 0; k--)

4744 
run
 = 
pRun
[
k
];

4746 
£
.
v®ue1
 = 
run
;

4747 
£
.
ty³
 = 
d±y³
;

4751 ià((!
z”o¦eá
è|| (
numcÛff
 <= 1 ))

4754 ià(
numcÛf
 > 1 && 
z”o¦eá
)

4756 
vlúum
 = 
	`imš
(
z”o¦eá
 - 1, 
RUNBEFORE_NUM_M1
);

4757 
£
.
Ën
 = 
vlúum
;

4759 #ià
TRACE


4760 
	`¢´štf
(
£
.
Œaû¡ršg
,

4761 
TRACESTRING_SIZE
, "%s„un (%d,%d) k=%d vlc=%d„un=%2d",

4762 
ty³
, 
subblock_x
, 
subblock_y
, 
k
, 
vlúum
, 
run
);

4765 
	`wr™eSyÁaxEËm’t_Run
(&
£
, 
d©aP¬t
);

4767 *
mb_b™s_cÛff
 +ð
£
.
Ën
;

4768 
no_b™s
 +ð
£
.
Ën
;

4770 
z”o¦eá
 -ð
run
;

4771 
numcÛf
 --;

4776  
no_b™s
;

4777 
	}
}

4786 
	$chªge_¶ªe_JV
Ð
VideoP¬am‘”s
 *
p_Vid
, 
ÅÏÃ
 )

4788 
p_Vid
->
cÞour_¶ªe_id
 = (è
ÅÏÃ
;

4789 
p_Vid
->
mb_d©a
 =…_Vid->
mb_d©a_JV
[
ÅÏÃ
];

4790 
p_Vid
->
’c_piùu»
 =…_Vid->
’c_äame_piùu»_JV
[
ÅÏÃ
];

4791 
p_Vid
->
pCurImg
 =…_Vid->
imgD©a
.
äm_d©a
[
ÅÏÃ
];

4792 
	}
}

4799 
	$make_äame_piùu»_JV
(
VideoP¬am‘”s
 *
p_Vid
)

4801 
uv
, 
lše
;

4802 
nsize
;

4804 
p_Vid
->
’c_äame_piùu»
[0] =…_Vid->
’c_äame_piùu»_JV
[0];

4807 if(
p_Vid
->
cu¼’tSliû
->
Çl_»ã»nû_idc
)

4809 
nsize
 = (
p_Vid
->
’c_äame_piùu»_JV
[0]->
size_y
/
BLOCK_SIZE
)*Õ_Vid->’c_äame_piùu»_JV[0]->
size_x
/BLOCK_SIZE)*(
PicMÙiÚP¬ams
);

4810 
	`memýy
Ð&(
p_Vid
->
’c_äame_piùu»
[0]->
JVmv_šfo
[
PLANE_Y
][0][0]), &Õ_Vid->
’c_äame_piùu»_JV
[PLANE_Y]->
mv_šfo
[0][0]), 
nsize
);

4811 
	`memýy
Ð&(
p_Vid
->
’c_äame_piùu»
[0]->
JVmv_šfo
[
PLANE_U
][0][0]), &Õ_Vid->
’c_äame_piùu»_JV
[PLANE_U]->
mv_šfo
[0][0]), 
nsize
);

4812 
	`memýy
Ð&(
p_Vid
->
’c_äame_piùu»
[0]->
JVmv_šfo
[
PLANE_V
][0][0]), &Õ_Vid->
’c_äame_piùu»_JV
[PLANE_V]->
mv_šfo
[0][0]), 
nsize
);

4815  
uv
=0; uv<2; uv++ )

4817  
lše
=0;†še<
p_Vid
->
height
;†ine++ )

4819 
nsize
 = (
img³l
è* 
p_Vid
->
width
;

4820 
	`memýy
Ð
p_Vid
->
’c_äame_piùu»
[0]->
imgUV
[
uv
][
lše
],…_Vid->
’c_äame_piùu»_JV
[uv+1]->
imgY
[lše], 
nsize
 );

4822 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
’c_äame_piùu»_JV
[
uv
+1]);

4825 
	}
}

4827 
Maüoblock
 *
	$®loc_mbs
(
VideoP¬am‘”s
 *
p_Vid
, 
mb_num
, 
Ïy”s
)

4829 
i
, 
j
;

4830 
Maüoblock
 *
pMBs
 = (Maüoblock *)
	`ÿÎoc
(
mb_num
, (Maüoblock)), *
pMB
;

4831 if(!
pMBs
)

4832  
NULL
;

4833 
i
=0; i<
mb_num
; i++)

4835 
pMB
 = 
pMBs
+
i
;

4836 
j
=0; j<2; j++)

4838 
	`g‘_mem2D³l
(&
pMB
->
šŒa4x4_´ed_buf
[
j
], 3, 17);

4839 
	`g‘_mem2D³l
(&
pMB
->
šŒa8x8_´ed_buf
[
j
], 3, 25);

4840 
	`g‘_mem2D³l
(&
pMB
->
šŒa16x16_´ed_buf
[
j
], 3, 33);

4842 
pMB
->
šŒa4x4_´ed
 =…MB->
šŒa4x4_´ed_buf
[0];

4843 
pMB
->
šŒa8x8_´ed
 =…MB->
šŒa8x8_´ed_buf
[0];

4844 
pMB
->
šŒa16x16_´ed
 =…MB->
šŒa16x16_´ed_buf
[0];

4846  
pMBs
;

4847 
	}
}

4849 
	$£tup_mbs
(
Maüoblock
 *
pMBs
, 
mb_num
, 
Ïy”_id
)

4851 
i
;

4852 
Maüoblock
 *
pMB
;

4853 
i
=0; i<
mb_num
; i++)

4855 
pMB
 = 
pMBs
+
i
;

4856 
pMB
->
šŒa4x4_´ed
 =…MB->
šŒa4x4_´ed_buf
[
Ïy”_id
];

4857 
pMB
->
šŒa8x8_´ed
 =…MB->
šŒa8x8_´ed_buf
[
Ïy”_id
];

4858 
pMB
->
šŒa16x16_´ed
 =…MB->
šŒa16x16_´ed_buf
[
Ïy”_id
];

4860 
	}
}

4862 
	$ä“_mbs
(
Maüoblock
 *
pMBs
, 
mb_num
)

4864 
i
, 
j
;

4865 
Maüoblock
 *
pMB
;

4866 if(!
pMBs
)

4868 
i
=0; i<
mb_num
; i++)

4870 
pMB
 = 
pMBs
+
i
;

4871 
j
=0; j<2; j++)

4873 
	`ä“_mem2D³l
(
pMB
->
šŒa4x4_´ed_buf
[
j
]);

4874 
	`ä“_mem2D³l
(
pMB
->
šŒa8x8_´ed_buf
[
j
]);

4875 
	`ä“_mem2D³l
(
pMB
->
šŒa16x16_´ed_buf
[
j
]);

4877 
pMB
->
šŒa4x4_´ed
 = 
NULL
;

4878 
pMB
->
šŒa8x8_´ed
 = 
NULL
;

4879 
pMB
->
šŒa16x16_´ed
 = 
NULL
;

4881 
	`ä“
(
pMBs
);

4882 
	}
}

	@lencod/src/macroblock_P444.c

14 
	~"cÚŒibutÜs.h
"

15 
	~"glob®.h
"

16 
	~"blk_´ediùiÚ.h
"

17 
	~"mc_´ediùiÚ.h
"

18 
	~"md_commÚ.h
"

19 
	~"rdÝt.h
"

20 
	~"maüoblock.h
"

32 
	$luma_»sidu®_codšg_p444_16x16
 (
Maüoblock
* 
cu¼MB
,

33 
block8x8
,

34 
p_dœ
,

35 
li¡_mode
[2],

36 *
»f_idx
)

39 *
cbp
 = &(
cu¼MB
->cbp);

40 
št64
 *
cbp_blk
 = &(
cu¼MB
->cbp_blk);

41 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

42 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

43 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

44 
i
, 
j
, 
nÚz”o
 = 0, 
cbp_blk_mask
;

45 
cÛff_co¡
 = 0;

46 
mb_y
 = (
block8x8
 >> 1) << 3;

47 
mb_x
 = (
block8x8
 & 0x01) << 3;

48 
cbp_mask
 = 1 << 
block8x8
;

50 
sk³d
 = (
li¡_mode
[0] =ð0 &&†i¡_mode[1] =ð0 && (
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
));

51 
CÞÜPÏÃ
 
uv
;

53 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8x8
].
b»d
;

54 
cu¼Sliû
->
cÛff_co¡_ü
[1] = currSlice->coeff_cost_cr[2] = 0;

59 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
mb_x
, 
mb_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

62 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[0][mb_y], &cu¼Sliû->
mb_Ües
[0][mb_y], 
mb_x
, cu¼MB->
pix_x
 + mb_x, 8, 8);

64 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

66 
	`£Ëù_¶ªe
(
p_Vid
, 
uv
);

67 
p_Dpb
->
	`pf_chroma_´ediùiÚ
 (
cu¼MB
, 
uv
 - 1, 
mb_x
, 
mb_y
, 8, 8, 
p_dœ
, 
li¡_mode
[0],†i¡_mode[1], 
»f_idx
[0],„ef_idx[1], 
b»d_me
);

70 
	`compu‹_»sidue
(&
p_Vid
->
pImgOrg
[
uv
][
cu¼MB
->
Ýix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[uv][mb_y], &cu¼Sliû->
mb_Ües
[uv][mb_y], 
mb_x
, cu¼MB->
pix_x
 + mb_x, 8, 8);

72 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

75 if(!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

78 ià(!
sk³d
 && ( (
cu¼Sliû
->
NoResidueDœeù
 !ð1è|| (
cu¼MB
->
qp_sÿËd
[0] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 1) ))

80 
block_y
, 
block_x
;

82 
block_y
=
mb_y
; block_y<mb_y + 8; block_y += 4)

84 
block_x
=
mb_x
; block_x<mb_x + 8; block_x += 4)

87 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
cÛff_co¡
, 0);

89 ià(
nÚz”o
)

91 
cbp_blk_mask
 = (
block_x
 >> 2è+ 
block_y
;

92 (*
cbp_blk
è|ð(
št64
è1 << 
cbp_blk_mask
;

93 (*
cbp
è|ð
cbp_mask
;

96 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

98 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

100 
	`£Ëù_¶ªe
(
p_Vid
, (
CÞÜPÏÃ
è
uv
);

101 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
Ðcu¼MB, (
CÞÜPÏÃ
è
uv
, 
block_x
, 
block_y
, &
cu¼Sliû
->
cÛff_co¡_ü
[uv], 0);

102 ià(
nÚz”o
)

104 
cbp_blk_mask
 = (
block_x
 >> 2è+ 
block_y
;

105 (
cu¼Sliû
->
cur_cbp_blk
[
uv
]è|ð(
št64
è1 << 
cbp_blk_mask
;

106 (
cu¼Sliû
->
cmp_cbp
[
uv
]è|ð
cbp_mask
;

109 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

113 
	`as£¹
(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
);

121 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
)

123 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

124 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
block8x8
, &
cÛff_co¡
, 0);

126 ià(
nÚz”o
)

128 (*
cbp_blk
è|ð51 << (4*
block8x8
 - 2*(block8x8 & 0x01));

129 (*
cbp
è|ð
cbp_mask
;

132 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

134 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

136 
	`£Ëù_¶ªe
(
p_Vid
, (
CÞÜPÏÃ
è
uv
);

137 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
Ðcu¼MB, (
CÞÜPÏÃ
è
uv
, 
block8x8
, &
cu¼Sliû
->
cÛff_co¡_ü
[uv], 0);

138 ià(
nÚz”o
)

140 (
cu¼Sliû
->
cur_cbp_blk
[
uv
]è|ð51 << (4*
block8x8
-2*(block8x8 & 0x01));

141 (
cu¼Sliû
->
cmp_cbp
[
uv
]è|ð
cbp_mask
;

144 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

149 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && 
cÛff_co¡
 <ð
_LUMA_COEFF_COST_
 &&

150 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0)&&

151 !(
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
 && 
p_Vid
->
¥2_äame_šdiÿtÜ
 =ð
TRUE
 )))

154 
cÛff_co¡
 = 0;

155 (*
cbp
è&ð(63 - 
cbp_mask
);

156 (*
cbp_blk
è&ð~(51 << (4 * 
block8x8
 - 2 * (block8x8 & 0x01)));

158 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[
block8x8
][0][0], 0, 4 * 2 * 65 * ());

160 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[0][mb_y], cu¼MB->
pix_x
 + 
mb_x
, mb_x);

162 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

164 
i
 = 
mb_x
; i < mb_x + 
BLOCK_SIZE_8x8
; i +ð
BLOCK_SIZE
)

165 
j
 = 
mb_y
; j < mb_y + 
BLOCK_SIZE_8x8
; j +ð
BLOCK_SIZE
)

166 
	`cÝyblock_¥
(
cu¼MB
, 
PLANE_Y
, 
i
, 
j
);

170 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

172 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && cu¼Sliû->
cÛff_co¡_ü
[
uv
] <ð
_LUMA_COEFF_COST_
 &&

173 (
cu¼MB
->
qp_sÿËd
[
uv
]!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

175 
cu¼Sliû
->
cÛff_co¡_ü
[
uv
] = 0;

176 
cu¼Sliû
->
cmp_cbp
[
uv
] &ð(63 - 
cbp_mask
);

177 
cu¼Sliû
->
cur_cbp_blk
[
uv
] &ð~(51 << (4*
block8x8
-2*(block8x8 & 0x01)));

179 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[
block8x8
 + 4 * 
uv
][0][0], 0, 4 * 2 * 65 * ());

181 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
 - 1][
cu¼MB
->
pix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[uv][mb_y], cu¼MB->
pix_x
 + 
mb_x
, mb_x);

185  
cÛff_co¡
;

186 
	}
}

198 
	$luma_»sidu®_codšg_p444_8x8
 (
Maüoblock
* 
cu¼MB
,

199 *
cbp
,

200 
št64
 *
cbp_blk
,

201 
block8x8
,

202 
p_dœ
,

203 
li¡_mode
[2],

204 *
»f_idx
)

206 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

207 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

208 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

209 
block_y
, 
block_x
, 
pic_pix_x
, 
nÚz”o
 = 0, 
cbp_blk_mask
;

210 
cÛff_co¡
 = 0;

211 
mb_y
 = (
block8x8
 >> 1) << 3;

212 
mb_x
 = (
block8x8
 & 0x01) << 3;

213 
cbp_mask
 = 1 << 
block8x8
;

214 
bxx
, 
byy
;

215 
sk³d
 = (
li¡_mode
[0] =ð0 &&†i¡_mode[1] =ð0 && (
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
));

216 
CÞÜPÏÃ
 
uv
;

218 
b»d_me
 = 
cu¼MB
->
b8x8
[
block8x8
].
b»d
;

219 
cu¼Sliû
->
cÛff_co¡_ü
[1] = currSlice->coeff_cost_cr[2] = 0;

224 if(!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

226 ià(((
p_dœ
 =ð0 ||…_dœ =ð2 )&& 
li¡_mode
[0] < 5) || ((p_dir == 1 ||…_dir == 2 ) &&†ist_mode[1] < 5))

228 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
mb_x
, 
mb_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

231 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[0][mb_y], &cu¼Sliû->
mb_Ües
[0][mb_y], 
mb_x
, cu¼MB->
pix_x
 + mb_x, 8, 8);

234 
byy
=0, 
block_y
=
mb_y
; block_y<mb_y+8; byy+=4, block_y+=4)

236 
bxx
=0, 
block_x
=
mb_x
; block_x<mb_x+8; bxx+=4, block_x+=4)

238 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

239 
cbp_blk_mask
 = (
block_x
 >> 2è+ 
block_y
;

242 ià(!(((
p_dœ
 =ð0 ||…_dœ =ð2 )&& 
li¡_mode
[0] < 5) || ((p_dir == 1 ||…_dir == 2 ) &&†ist_mode[1] < 5)))

244 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
block_x
, 
block_y
, 4, 4, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

247 
	`compu‹_»sidue
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[0][block_y], &cu¼Sliû->
mb_Ües
[0][block_y], 
block_x
, 
pic_pix_x
, 4, 4);

250 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

252 
	`£Ëù_¶ªe
(
p_Vid
, 
uv
);

253 
p_Dpb
->
	`pf_chroma_´ediùiÚ
 (
cu¼MB
, 
uv
 - 1, 
block_x
, 
block_y
, 4, 4, 
p_dœ
, 
li¡_mode
[0],†i¡_mode[1], 
»f_idx
[0],„ef_idx[1], 
b»d_me
);

256 
	`compu‹_»sidue
(&
p_Vid
->
pImgOrg
[
uv
][
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[uv][block_y], &cu¼Sliû->
mb_Ües
[uv][block_y], 
block_x
, 
pic_pix_x
, 4, 4);

258 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

261 ià(!
sk³d
 && ( (
cu¼Sliû
->
NoResidueDœeù
 !ð1è|| (
cu¼MB
->
qp_sÿËd
[0] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 == 1) ))

264 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
cÛff_co¡
, 0);

266 ià(
nÚz”o
)

268 (*
cbp_blk
è|ð(
št64
)1 << 
cbp_blk_mask
;

269 (*
cbp
è|ð
cbp_mask
;

272 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

274 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

276 
	`£Ëù_¶ªe
(
p_Vid
, (
CÞÜPÏÃ
è
uv
);

277 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
Ðcu¼MB, (
CÞÜPÏÃ
è
uv
, 
block_x
, 
block_y
, &
cu¼Sliû
->
cÛff_co¡_ü
[uv], 0);

278 ià(
nÚz”o
)

280 (
cu¼Sliû
->
cur_cbp_blk
[
uv
]è|ð(
št64
è1 << 
cbp_blk_mask
;

281 (
cu¼Sliû
->
cmp_cbp
[
uv
]è|ð
cbp_mask
;

284 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

288 
	`as£¹
(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
);

296 
block_y
 = 
mb_y
;

297 
block_x
 = 
mb_x
;

299 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

301 
cbp_blk_mask
 = (
block_x
>>2è+ 
block_y
;

304 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
block_x
, 
block_y
, 8, 8, 
p_dœ
, 
li¡_mode
, 
»f_idx
, 
b»d_me
);

307 
	`compu‹_»sidue
 (&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[0][block_y], &cu¼Sliû->
mb_Ües
[0][block_y], 
block_x
, 
pic_pix_x
, 8, 8);

309 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

311 
	`£Ëù_¶ªe
(
p_Vid
, (
CÞÜPÏÃ
è
uv
);

312 
p_Dpb
->
	`pf_chroma_´ediùiÚ
 (
cu¼MB
, 
uv
 - 1, 
block_x
, 
block_y
, 8, 8, 
p_dœ
, 
li¡_mode
[0],†i¡_mode[1], 
»f_idx
[0],„ef_idx[1], 
b»d_me
);

315 
	`compu‹_»sidue
 (&
p_Vid
->
pImgOrg
[
uv
][
cu¼MB
->
Ýix_y
 + 
block_y
], &
cu¼Sliû
->
mb_´ed
[uv][block_y], &cu¼Sliû->
mb_Ües
[uv][block_y], 
block_x
, 
pic_pix_x
, 8, 8);

317 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

319 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
)

321 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

322 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
block8x8
, &
cÛff_co¡
, 0);

324 ià(
nÚz”o
)

326 (*
cbp_blk
è|ð51 << (4*
block8x8
 - 2*(block8x8 & 0x01));

327 (*
cbp
è|ð
cbp_mask
;

330 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

332 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

334 
	`£Ëù_¶ªe
(
p_Vid
, (
CÞÜPÏÃ
è
uv
);

335 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
Ðcu¼MB, (
CÞÜPÏÃ
è
uv
, 
block8x8
, &
cu¼Sliû
->
cÛff_co¡_ü
[uv], 0);

336 ià(
nÚz”o
)

338 (
cu¼Sliû
->
cur_cbp_blk
[
uv
]è|ð51 << (4*
block8x8
-2*(block8x8 & 0x01));

339 (
cu¼Sliû
->
cmp_cbp
[
uv
]è|ð
cbp_mask
;

342 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

347 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && 
cÛff_co¡
 <ð
_LUMA_COEFF_COST_
 &&

348 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0)&&

349 !(
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
 && 
p_Vid
->
¥2_äame_šdiÿtÜ
 =ð
TRUE
 )))

352 
cÛff_co¡
 = 
	`»£t_block
(
cu¼MB
, 
cbp
, 
cbp_blk
, 
block8x8
);

355 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

357 ià(
cu¼Sliû
->
NoResidueDœeù
 !ð1 && !
sk³d
 && cu¼Sliû->
cÛff_co¡_ü
[
uv
] <ð
_LUMA_COEFF_COST_
 &&

358 (
cu¼MB
->
qp_sÿËd
[
uv
]!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

360 
cu¼Sliû
->
cÛff_co¡_ü
[
uv
] = 0;

361 
cu¼Sliû
->
cmp_cbp
[
uv
] &ð(63 - 
cbp_mask
);

362 
cu¼Sliû
->
cur_cbp_blk
[
uv
] &ð~(51 << (4*
block8x8
-2*(block8x8 & 0x01)));

364 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[
block8x8
 + 4 * 
uv
][0][0], 0, 4 * 2 * 65 * ());

366 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
 - 1][
cu¼MB
->
pix_y
 + 
mb_y
], &
cu¼Sliû
->
mb_´ed
[uv][mb_y], cu¼MB->
pix_x
 + 
mb_x
, mb_x);

370  
cÛff_co¡
;

371 
	}
}

380 
	$luma_»sidu®_codšg_p444
 (
Maüoblock
 *
cu¼MB
)

382 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

383 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

385 
uv
, 
i
,
j
,
block8x8
,
b8_x
,
b8_y
;

386 
li¡_mode
[2];

387 
li¡_»f_idx
[2];

388 
p_dœ
;

389 
sum_út_nÚz
[3] = {0 ,0, 0};

390 
is_sk
 = 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 && 
cu¼MB
->
mb_ty³
 =ð
PSKIP
;

392 
cu¼MB
->
cbp
 = 0;

393 
cu¼MB
->
cbp_blk
 = 0;

394 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

395 
cu¼Sliû
->
cur_cbp_blk
[1] = currSlice->cur_cbp_blk[2] = 0;

397 ià(
is_sk
 || 
cu¼MB
->
mb_ty³
 == 1)

400 
block8x8
=0; block8x8<4; ++block8x8)

402 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

404 
sum_út_nÚz
[0] +ð
	`luma_»sidu®_codšg_p444_16x16
 (
cu¼MB
, 
block8x8
, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

405 
sum_út_nÚz
[1] +ð
cu¼Sliû
->
cÛff_co¡_ü
[1];

406 
sum_út_nÚz
[2] +ð
cu¼Sliû
->
cÛff_co¡_ü
[2];

411 
block8x8
=0; block8x8<4; ++block8x8)

413 
cu¼Sliû
->
	`£t_modes_ªd_»äame
 (
cu¼MB
, 
block8x8
, &
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

415 
sum_út_nÚz
[0] +ð
	`luma_»sidu®_codšg_p444_8x8
 (
cu¼MB
, &(cu¼MB->
cbp
), &(cu¼MB->
cbp_blk
), 
block8x8
, 
p_dœ
, 
li¡_mode
, 
li¡_»f_idx
);

417 if(
p_Vid
->
P444_jošed
)

419 
sum_út_nÚz
[1] +ð
cu¼Sliû
->
cÛff_co¡_ü
[1];

420 
sum_út_nÚz
[2] +ð
cu¼Sliû
->
cÛff_co¡_ü
[2];

425 ià((
is_sk
 ||

426 (
sum_út_nÚz
[0] <ð
_LUMA_MB_COEFF_COST_
 && ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))) &&

427 !(
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
 && 
p_Vid
->
¥2_äame_šdiÿtÜ
 =ð
TRUE
 )))

430 
cu¼MB
->
cbp
 &= 0xfffff0 ;

431 
cu¼MB
->
cbp_blk
 &= 0xff0000 ;

433 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
cu¼Sliû
->
mb_´ed
[0], cu¼MB->
pix_x
, 0);

435 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[0][0][0], 0, 2080 * ());

437 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

439 
block8x8
=0;block8x8<4; ++block8x8)

441 
b8_x
=(
block8x8
&1)<<3;

442 
b8_y
=(
block8x8
&2)<<2;

443 
i
 = 
b8_x
; i < b8_x + 
BLOCK_SIZE_8x8
; i += 4)

444 
j
 = 
b8_y
; j < b8_y + 
BLOCK_SIZE_8x8
;j += 4)

445 
	`cÝyblock_¥
(
cu¼MB
, 
PLANE_Y
, 
i
, 
j
);

450 
uv
 = 
PLANE_U
; uv <ð
PLANE_V
; ++uv)

452 if(
is_sk
 || (
sum_út_nÚz
[
uv
] <ð
_LUMA_MB_COEFF_COST_
 &&

453 ((
cu¼MB
->
qp_sÿËd
[
uv
])!=0 ||
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0)))

455 
cu¼Sliû
->
cmp_cbp
[
uv
] &= 0xfffff0 ;

456 
cu¼Sliû
->
cur_cbp_blk
[
uv
] &= 0xff0000 ;

458 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
p_img
[
uv
][
cu¼MB
->
pix_y
], 
cu¼Sliû
->
mb_´ed
[uv], cu¼MB->
pix_x
, 0);

460 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[4 * 
uv
][0][0], 0, 2080 * ());

462 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[
uv
];

464 
	}
}

	@lencod/src/mb_access.c

15 
	~"glob®.h
"

16 
	~"mb_acûss.h
"

24 
BoÞ—n
 
	$mb_is_avažabË
(
mbAddr
, 
Maüoblock
 *
cu¼MB
)

26 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

27 ià((
mbAddr
 < 0è|| (mbAdd¸> (()
p_Vid
->
PicSizeInMbs
 - 1)))

28  
FALSE
;

31 ià(!
cu¼MB
->
DeblockC®l
)

33 ià(
p_Vid
->
mb_d©a
[
mbAddr
].
¦iû_Ä
 !ð
cu¼MB
->slice_nr)

34  
FALSE
;

37  
TRUE
;

38 
	}
}

48 
	$CheckAvažabž™yOfNeighbÜs
(
Maüoblock
 *
cu¼MB
)

50 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

51 cÚ¡ 
mb_Ä
 = 
cu¼MB
->
mbAddrX
;

52 
BlockPos
 *
PicPos
 = 
p_Vid
->PicPos;

55 
cu¼MB
->
mb_up
 = 
NULL
;

56 
cu¼MB
->
mb_Ëá
 = 
NULL
;

58 ià(
p_Vid
->
mb_aff_äame_æag
)

60 
cur_mb_·œ
 = 
mb_Ä
 >> 1;

61 
cu¼MB
->
mbAddrA
 = 2 * (
cur_mb_·œ
 - 1);

62 
cu¼MB
->
mbAddrB
 = 2 * (
cur_mb_·œ
 - 
p_Vid
->
PicWidthInMbs
);

63 
cu¼MB
->
mbAddrC
 = 2 * (
cur_mb_·œ
 - 
p_Vid
->
PicWidthInMbs
 + 1);

64 
cu¼MB
->
mbAddrD
 = 2 * (
cur_mb_·œ
 - 
p_Vid
->
PicWidthInMbs
 - 1);

66 
cu¼MB
->
mbAvažA
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrA
, cu¼MBè&& ((
PicPos
[
cur_mb_·œ
 ].
x
)!=0));

67 
cu¼MB
->
mbAvažB
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrB
, currMB));

68 
cu¼MB
->
mbAvažC
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrC
, cu¼MBè&& ((
PicPos
[
cur_mb_·œ
 + 1].
x
)!=0));

69 
cu¼MB
->
mbAvažD
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrD
, cu¼MBè&& ((
PicPos
[
cur_mb_·œ
 ].
x
)!=0));

73 
cu¼MB
->
mbAddrA
 = 
mb_Ä
 - 1;

74 
cu¼MB
->
mbAddrB
 = 
mb_Ä
 - 
p_Vid
->
PicWidthInMbs
;

75 
cu¼MB
->
mbAddrC
 = 
mb_Ä
 - 
p_Vid
->
PicWidthInMbs
 + 1;

76 
cu¼MB
->
mbAddrD
 = 
mb_Ä
 - 
p_Vid
->
PicWidthInMbs
 - 1;

78 
cu¼MB
->
mbAvažA
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrA
, cu¼MBè&& ((
PicPos
[
mb_Ä
 ].
x
)!=0));

79 
cu¼MB
->
mbAvažB
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrB
, currMB));

80 
cu¼MB
->
mbAvažC
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrC
, cu¼MBè&& ((
PicPos
[
mb_Ä
 + 1].
x
)!=0));

81 
cu¼MB
->
mbAvažD
 = (
by‹
è(
	`mb_is_avažabË
(cu¼MB->
mbAddrD
, cu¼MBè&& ((
PicPos
[
mb_Ä
 ].
x
)!=0));

84 ià(
cu¼MB
->
mbAvažA
ècu¼MB->
mb_Ëá
 = &(
p_Vid
->
mb_d©a
[cu¼MB->
mbAddrA
]);

85 ià(
cu¼MB
->
mbAvažB
ècu¼MB->
mb_up
 = &(
p_Vid
->
mb_d©a
[cu¼MB->
mbAddrB
]);

86 
	}
}

95 
	$g‘_mb_block_pos_nÜm®
 (
BlockPos
 *
PicPos
, 
mb_addr
, *
x
, *
y
)

97 *
x
 = (è
PicPos
[ 
mb_addr
 ].x;

98 *
y
 = (è
PicPos
[ 
mb_addr
 ].y;

99 
	}
}

108 
	$g‘_mb_block_pos_mbaff
 (
BlockPos
 *
PicPos
, 
mb_addr
, *
x
, *
y
)

110 *
x
 = (è
PicPos
[
mb_addr
>>1].x;

111 *
y
 = (è((
PicPos
[
mb_addr
>>1].y << 1) + (mb_addr & 0x01));

112 
	}
}

120 
	$g‘_mb_pos
 (
VideoP¬am‘”s
 *
p_Vid
, 
mb_addr
, 
mb_size
[2], *
x
, *
y
)

122 
p_Vid
->
	`g‘_mb_block_pos
Õ_Vid->
PicPos
, 
mb_addr
, 
x
, 
y
);

124 (*
x
èð(è((*xè* 
mb_size
[0]);

125 (*
y
èð(è((*yè* 
mb_size
[1]);

126 
	}
}

145 
	$g‘NÚAffNeighbour
(
Maüoblock
 *
cu¼MB
, 
xN
, 
yN
, 
mb_size
[2], 
Pix–Pos
 *
pix
)

147 
BlockPos
 *
PicPos
 = 
cu¼MB
->
p_Vid
->PicPos;

148 ià(
xN
 < 0)

150 ià(
yN
 < 0)

152 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrD
;

153 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažD
;

155 ià((
yN
 >ð0)&&(yN < 
mb_size
[1]))

157 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

158 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

162 
pix
->
avažabË
 = 
FALSE
;

165 ià((
xN
 >ð0)&&(xN < 
mb_size
[0]))

167 ià(
yN
<0)

169 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrB
;

170 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažB
;

172 ià(((
yN
 >ð0)&&(yN < 
mb_size
[1])))

174 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrX
;

175 
pix
->
avažabË
 = 
TRUE
;

179 
pix
->
avažabË
 = 
FALSE
;

182 ià((
xN
 >ð
mb_size
[0])&&(
yN
 < 0))

184 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrC
;

185 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažC
;

189 
pix
->
avažabË
 = 
FALSE
;

192 ià(
pix
->
avažabË
 || 
cu¼MB
->
DeblockC®l
)

194 
pix
->
x
 = (è(
xN
 & (
mb_size
[0] - 1));

195 
pix
->
y
 = (è(
yN
 & (
mb_size
[1] - 1));

196 
pix
->
pos_x
 = (èÕix->
x
 + 
PicPos
[…ix->
mb_addr
 ].x * 
mb_size
[0]);

197 
pix
->
pos_y
 = (èÕix->
y
 + 
PicPos
[…ix->
mb_addr
 ].y * 
mb_size
[1]);

199 
	}
}

217 
	$g‘AffNeighbour
(
Maüoblock
 *
cu¼MB
, 
xN
, 
yN
, 
mb_size
[2], 
Pix–Pos
 *
pix
)

219 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

220 
maxW
, 
maxH
;

221 
yM
 = -1;

223 
maxW
 = 
mb_size
[0];

224 
maxH
 = 
mb_size
[1];

227 
pix
->
avažabË
 = 
FALSE
;

229 if(
yN
 > (
maxH
 - 1))

233 ià(
xN
 > (
maxW
 - 1è&& 
yN
 >ð0 && yN < 
maxH
)

238 ià(
xN
 < 0)

240 ià(
yN
 < 0)

242 if(!
cu¼MB
->
mb_f›ld
)

245 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

248 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrD
 + 1;

249 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažD
;

250 
yM
 = 
yN
;

255 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

256 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

257 ià(
cu¼MB
->
mbAvažA
)

259 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].
mb_f›ld
)

261 
yM
 = 
yN
;

265 (
pix
->
mb_addr
)++;

266 
yM
 = (
yN
 + 
maxH
) >> 1;

274 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

277 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrD
;

278 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažD
;

279 ià(
cu¼MB
->
mbAvažD
)

281 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrD
].
mb_f›ld
)

283 (
pix
->
mb_addr
)++;

284 
yM
 = 2 * 
yN
;

288 
yM
 = 
yN
;

295 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrD
+1;

296 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažD
;

297 
yM
 = 
yN
;

303 ià(
yN
 >ð0 && yN <
maxH
)

305 ià(!
cu¼MB
->
mb_f›ld
)

308 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

311 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

312 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

313 ià(
cu¼MB
->
mbAvažA
)

315 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].
mb_f›ld
)

317 
yM
 = 
yN
;

321 (
pix
->
mb_addr
)+ð((
yN
 & 0x01) != 0);

322 
yM
 = 
yN
 >> 1;

329 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

330 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

331 ià(
cu¼MB
->
mbAvažA
)

333 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].
mb_f›ld
)

335 (
pix
->
mb_addr
)++;

336 
yM
 = 
yN
;

340 (
pix
->
mb_addr
)+ð((
yN
 & 0x01) != 0);

341 
yM
 = (
yN
 + 
maxH
) >> 1;

349 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

352 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

353 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

354 ià(
cu¼MB
->
mbAvažA
)

356 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].
mb_f›ld
)

358 ià(
yN
 < (
maxH
 >> 1))

360 
yM
 = 
yN
 << 1;

364 (
pix
->
mb_addr
)++;

365 
yM
 = (
yN
 << 1 ) - 
maxH
;

370 
yM
 = 
yN
;

377 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrA
;

378 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažA
;

379 ià(
cu¼MB
->
mbAvažA
)

381 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].
mb_f›ld
)

383 ià(
yN
 < (
maxH
 >> 1))

385 
yM
 = (
yN
 << 1) + 1;

389 (
pix
->
mb_addr
)++;

390 
yM
 = (
yN
 << 1 ) + 1 - 
maxH
;

395 (
pix
->
mb_addr
)++;

396 
yM
 = 
yN
;

406 ià(
xN
 >ð0 && xN < 
maxW
)

408 ià(
yN
<0)

410 ià(!
cu¼MB
->
mb_f›ld
)

413 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

416 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrB
;

419 ià(
cu¼MB
->
mbAvažB
)

421 ià(!(
cu¼MB
->
DeblockC®l
 =ð1 && (
p_Vid
->
mb_d©a
[cu¼MB->
mbAddrB
]).
mb_f›ld
))

422 
pix
->
mb_addr
 += 1;

425 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažB
;

426 
yM
 = 
yN
;

431 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrX
 - 1;

432 
pix
->
avažabË
 = 
TRUE
;

433 
yM
 = 
yN
;

439 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

442 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrB
;

443 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažB
;

444 ià(
cu¼MB
->
mbAvažB
)

446 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrB
].
mb_f›ld
)

448 (
pix
->
mb_addr
)++;

449 
yM
 = 2 * 
yN
;

453 
yM
 = 
yN
;

460 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrB
 + 1;

461 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažB
;

462 
yM
 = 
yN
;

470 ià(
yN
 =ð0 && 
cu¼MB
->
DeblockC®l
 == 2)

472 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrB
 + 1;

473 
pix
->
avažabË
 = 
TRUE
;

474 
yM
 = 
yN
 - 1;

477 ià((
yN
 >ð0è&& (yN <
maxH
))

479 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrX
;

480 
pix
->
avažabË
 = 
TRUE
;

481 
yM
 = 
yN
;

487 if(
yN
 < 0)

489 ià(!
cu¼MB
->
mb_f›ld
)

492 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

495 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrC
 + 1;

496 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažC
;

497 
yM
 = 
yN
;

502 
pix
->
avažabË
 = 
FALSE
;

508 ià((
cu¼MB
->
mbAddrX
 & 0x01) == 0)

511 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrC
;

512 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažC
;

513 ià(
cu¼MB
->
mbAvažC
)

515 if(!
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrC
].
mb_f›ld
)

517 (
pix
->
mb_addr
)++;

518 
yM
 = 2* 
yN
;

522 
yM
 = 
yN
;

529 
pix
->
mb_addr
 = 
cu¼MB
->
mbAddrC
 + 1;

530 
pix
->
avažabË
 = 
cu¼MB
->
mbAvažC
;

531 
yM
 = 
yN
;

537 ià(
pix
->
avažabË
 || 
cu¼MB
->
DeblockC®l
)

539 
pix
->
x
 = (è(
xN
 & (
maxW
 - 1));

540 
pix
->
y
 = (è(
yM
 & (
maxH
 - 1));

541 
	`g‘_mb_pos
(
p_Vid
, 
pix
->
mb_addr
, 
mb_size
, &Õix->
pos_x
), &Õix->
pos_y
));

542 
pix
->
pos_x
 =…ix->pos_x +…ix->
x
;

543 
pix
->
pos_y
 =…ix->pos_y +…ix->
y
;

545 
	}
}

564 
	$g‘4x4Neighbour
 (
Maüoblock
 *
cu¼MB
, 
block_x
, 
block_y
, 
mb_size
[2], 
Pix–Pos
 *
pix
)

566 
cu¼MB
->
p_Vid
->
	`g‘Neighbour
(cu¼MB, 
block_x
, 
block_y
, 
mb_size
, 
pix
);

568 ià(
pix
->
avažabË
)

570 
pix
->
x
 >>= 2;

571 
pix
->
y
 >>= 2;

572 
pix
->
pos_x
 >>= 2;

573 
pix
->
pos_y
 >>= 2;

575 
	}
}

	@lencod/src/mbuffer.c

17 
	~<lim™s.h
>

19 
	~"glob®.h
"

20 
	~"mbufãr.h
"

21 
	~"mbufãr_commÚ.h
"

22 
	~"mem®loc.h
"

23 
	~"ouut.h
"

24 
	~"image.h
"

25 
	~"ÇlucommÚ.h
"

26 
	~"img_luma.h
"

27 
	~"img_chroma.h
"

28 
	~"”rdo.h
"

29 
	~"me_hme.h
"

31 
SbSMuxBasic
(
ImageD©a
 *
imgOut
, ImageD©¨*
imgIn0
, ImageD©¨*
imgIn1
, 
off£t
);

32 
š™_¡©s
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
¡©s
);

33 
š£¹_piùu»_š_dpb
 (
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
* 
fs
, 
StÜabËPiùu»
* 
p
);

34 
ouut_Úe_äame_äom_dpb
 (
DecodedPiùu»Bufãr
 *
p_Dpb
, 
F¿meFÜm©
 *
ouut
);

35 
g’_f›ld_»f_ids
 (
StÜabËPiùu»
 *
p
);

36 
æush_unu£d_äame_äom_dpb
 (
DecodedPiùu»Bufãr
 *
p_Dpb
);

37 
´oûss_piùu»_š_dpb_s
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p_pic
);

38 
StÜabËPiùu»
 * 
þÚe_¡ÜabË_piùu»
Ð
VideoP¬am‘”s
 *
p_Vid
, StÜabËPiùu» *
p_pic
 );

40 
	#MAX_LIST_SIZE
 33

	)

42 
ä“_mem2Dušt16
(
ušt16
 **
¬¿y2D
);

43 
ä“_mem3Dušt16
(
ušt16
 ***
¬¿y3D
);

51 
	$dump_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

53 #ià
DUMP_DPB


54 
i
;

56 
i
=0; i<
p_Dpb
->
u£d_size
;i++)

58 
	`´štf
("(");

59 
	`´štf
("â=%d ", 
p_Dpb
->
fs
[
i
]->
äame_num
);

60 ià(
p_Dpb
->
fs
[
i
]->
is_u£d
 & 1)

62 ià(
p_Dpb
->
fs
[
i
]->
tÝ_f›ld
)

63 
	`´štf
("T:…oc=%d ", 
p_Dpb
->
fs
[
i
]->
tÝ_f›ld
->
poc
);

65 
	`´štf
("T:…oc=%d ", 
p_Dpb
->
fs
[
i
]->
äame
->
tÝ_poc
);

67 ià(
p_Dpb
->
fs
[
i
]->
is_u£d
 & 2)

69 ià(
p_Dpb
->
fs
[
i
]->
bÙtom_f›ld
)

70 
	`´štf
("B:…oc=%d ", 
p_Dpb
->
fs
[
i
]->
bÙtom_f›ld
->
poc
);

72 
	`´štf
("B:…oc=%d ", 
p_Dpb
->
fs
[
i
]->
äame
->
bÙtom_poc
);

74 ià(
p_Dpb
->
fs
[
i
]->
is_u£d
 == 3)

75 
	`´štf
("F:…oc=%d ", 
p_Dpb
->
fs
[
i
]->
äame
->
poc
);

76 
	`´štf
("G:…oc=%dè ", 
p_Dpb
->
fs
[
i
]->
poc
);

77 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
è
	`´štf
 ("ref (%d) ",…_Dpb->fs[i]->is_reference);

78 ià(
p_Dpb
->
fs
[
i
]->
is_lÚg_‹rm
è
	`´štf
 ("É_»à(%dè",…_Dpb->fs[i]->
is_»ã»nû
);

79 ià(
p_Dpb
->
fs
[
i
]->
is_ouut
è
	`´štf
 ("out ");

80 ià(
p_Dpb
->
fs
[
i
]->
is_u£d
 == 3)

82 ià(
p_Dpb
->
fs
[
i
]->
äame
->
nÚ_exi¡šg
è
	`´štf
 ("ne ");

84 #ià(
MVC_EXTENSION_ENABLE
)

85 if(
p_Dpb
->
p_IÅ
->
num_of_v›ws
==2)

86 
	`´štf
 ("v›w_id=%d ", 
p_Dpb
->
fs
[
i
]->
v›w_id
);

88 
	`´štf
 ("\n");

91 
	}
}

101 
	$g‘DpbSize
(
VideoP¬am‘”s
 *
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
)

103 
pic_size_mb
 = (
aùive_¥s
->
pic_width_š_mbs_mšus1
 + 1è* (aùive_¥s->
pic_height_š_m­_un™s_mšus1
 + 1è* (aùive_¥s->
äame_mbs_Úly_æag
?1:2);

105 
size
 = 0;

107 
aùive_¥s
->
Ëv–_idc
)

113 
size
 = 396;

116 
size
 = 396;

119 ià(!
	`is_FREXT_´ofže
(
aùive_¥s
->
´ofže_idc
è&& (aùive_¥s->
cÚ¡¿šed_£t3_æag
 == 1))

120 
size
 = 396;

122 
size
 = 900;

125 
size
 = 2376;

128 
size
 = 2376;

131 
size
 = 2376;

134 
size
 = 4752;

137 
size
 = 8100;

140 
size
 = 8100;

143 
size
 = 18000;

146 
size
 = 20480;

149 
size
 = 32768;

152 
size
 = 32768;

155 
size
 = 34816;

158 
size
 = 110400;

161 
size
 = 184320;

164 
size
 = 184320;

169 
size
 = 696320;

172 
	`”rÜ
 ("undefined†evel", 500);

176 
size
 /ð
pic_size_mb
;

177 if(
	`is_MVC_´ofže
(
p_Vid
->
p_IÅ
->
ProfžeIDC
))

179 
num_v›ws
 = 
p_Vid
->
p_IÅ
->
num_of_v›ws
;

180 
size
 = 
	`imš
(2*size, 
	`imax
(1, 
	`RoundLog2
(
num_v›ws
))*16)/num_views;

183 
size
 = 
	`imš
( size, 16);

185 ià(
aùive_¥s
->
vui_·¿m‘”s_´e£Á_æag
 &&‡ùive_¥s->
vui_£q_·¿m‘”s
.
b™¡»am_»¡riùiÚ_æag
)

187 ià(()
aùive_¥s
->
vui_£q_·¿m‘”s
.
max_dec_äame_bufãršg
 > 
size
)

189 
	`”rÜ
 ("max_dec_frame_buffering†argerhan MaxDpbSize", 500);

191 
size
 = 
	`imax
 (1, 
aùive_¥s
->
vui_£q_·¿m‘”s
.
max_dec_äame_bufãršg
);

194  
size
;

195 
	}
}

205 
	$check_num_»f
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

207 ià(()(
p_Dpb
->
É»f_äames_š_bufãr
 +…_Dpb->
»f_äames_š_bufãr
 ) > 
	`imax
(1,…_Dpb->
num_»f_äames
))

209 
	`”rÜ
 ("Max.‚umber of„eference framesƒxceeded. Invalid stream.", 500);

211 
	}
}

221 
	$š™_dpb
(
VideoP¬am‘”s
 *
p_Vid
, 
DecodedPiùu»Bufãr
 *
p_Dpb
)

223 
i
;

225 
p_Dpb
->
p_Vid
 =…_Vid;

226 
p_Dpb
->
p_IÅ
 = 
p_Vid
->p_Inp;

227 
p_Dpb
->
num_»f_äames
 = 
p_Vid
->num_ref_frames;

229 ià(
p_Dpb
->
š™_dÚe
)

231 
	`ä“_dpb
(
p_Dpb
);

234 
p_Dpb
->
size
 = 
	`g‘DpbSize
(
p_Vid
,…_Vid->
¥s
[p_Dpb->
Ïy”_id
]);

237 ià(
p_Dpb
->
size
 < (è(
p_Vid
->
p_IÅ
)->
num_»f_äames
)

239 
	`”rÜ
 ("DPB size‡t specified†evel is smallerhanhe specified‚umber of„eference frames. This is‚ot‡llowed.\n", 1000);

242 
p_Dpb
->
u£d_size
 = 0;

243 
p_Dpb
->
Ï¡_piùu»
 = 
NULL
;

245 
p_Dpb
->
»f_äames_š_bufãr
 = 0;

246 
p_Dpb
->
É»f_äames_š_bufãr
 = 0;

248 
p_Dpb
->
fs
 = 
	`ÿÎoc
Õ_Dpb->
size
,  (
F¿meStÜe
*));

249 ià(
NULL
==
p_Dpb
->
fs
)

250 
	`no_mem_ex™
("init_dpb:…_Dpb->fs");

252 
p_Dpb
->
fs_»f
 = 
	`ÿÎoc
Õ_Dpb->
size
,  (
F¿meStÜe
*));

253 ià(
NULL
==
p_Dpb
->
fs_»f
)

254 
	`no_mem_ex™
("init_dpb:…_Dpb->fs_ref");

256 
p_Dpb
->
fs_É»f
 = 
	`ÿÎoc
Õ_Dpb->
size
,  (
F¿meStÜe
*));

257 ià(
NULL
==
p_Dpb
->
fs_É»f
)

258 
	`no_mem_ex™
("init_dpb:…_Dpb->fs_ltref");

260 
i
 = 0; i < 
p_Dpb
->
size
; i++)

262 
p_Dpb
->
fs
[
i
] = 
	`®loc_äame_¡Üe
();

263 
p_Dpb
->
fs_»f
[
i
] = 
NULL
;

264 
p_Dpb
->
fs_É»f
[
i
] = 
NULL
;

266 
p_Dpb
->
fs_ž»f
 = 
	`ÿÎoc
(1,  (
F¿meStÜe
*));

267 ià(
NULL
==
p_Dpb
->
fs_ž»f
)

268 
	`no_mem_ex™
("init_dpb:…_Dpb->fs_ilref");

270 if(
p_Dpb
->
Ïy”_id
 == 0)

272 
p_Dpb
->
fs_ž»f
[0] = 
NULL
;

274 if(
p_Dpb
->
Ïy”_id
 == 1)

276 
p_Dpb
->
fs_ž»f
[0] = 
	`®loc_äame_¡Üe
();

279 
p_Dpb
->
Ï¡_ouut_poc
 = 
INT_MIN
;

281 #ià(
MVC_EXTENSION_ENABLE
)

282 
p_Dpb
->
Ï¡_ouut_v›w_id
 = 0;

285 
p_Vid
->
Ï¡_has_mmco_5
 = 0;

287 
p_Dpb
->
š™_dÚe
 = 1;

289 
	}
}

298 
	$ä“_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

300 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

301 
i
;

302 ià(
p_Dpb
->
fs
)

304 
i
=0; i<
p_Dpb
->
size
; i++)

306 
	`ä“_äame_¡Üe
(
p_Vid
, 
p_Dpb
->
fs
[
i
]);

308 
	`ä“
 (
p_Dpb
->
fs
);

309 
p_Dpb
->
fs
=
NULL
;

312 ià(
p_Dpb
->
fs_»f
)

314 
	`ä“
 (
p_Dpb
->
fs_»f
);

316 ià(
p_Dpb
->
fs_É»f
)

318 
	`ä“
 (
p_Dpb
->
fs_É»f
);

320 if(
p_Dpb
->
fs_ž»f
)

322 if(
p_Dpb
->
fs_ž»f
[0])

324 
	`ä“_äame_¡Üe
(
p_Vid
, 
p_Dpb
->
fs_ž»f
[0]);

325 
p_Dpb
->
fs_ž»f
[0] = 
NULL
;

327 
	`ä“
(
p_Dpb
->
fs_ž»f
);

329 
p_Dpb
->
Ï¡_ouut_poc
 = 
INT_MIN
;

331 #ià(
MVC_EXTENSION_ENABLE
)

332 
p_Dpb
->
Ï¡_ouut_v›w_id
 = 0;

335 
p_Dpb
->
š™_dÚe
 = 0;

336 
	}
}

348 
F¿meStÜe
* 
	$®loc_äame_¡Üe
()

350 
F¿meStÜe
 *
f
;

352 
f
 = 
	`ÿÎoc
 (1, (
F¿meStÜe
));

353 ià(
NULL
==
f
)

354 
	`no_mem_ex™
("alloc_frame_store: f");

356 
f
->
is_u£d
 = 0;

357 
f
->
is_»ã»nû
 = 0;

358 
f
->
is_lÚg_‹rm
 = 0;

359 
f
->
is_Üig_»ã»nû
 = 0;

361 
f
->
is_ouut
 = 0;

363 
f
->
äame
 = 
NULL
;;

364 
f
->
tÝ_f›ld
 = 
NULL
;

365 
f
->
bÙtom_f›ld
 = 
NULL
;

367 #ià(
MVC_EXTENSION_ENABLE
)

368 
f
->
v›w_id
 = -1;

369 
f
->
š‹r_v›w_æag
[0] = 0;

370 
f
->
š‹r_v›w_æag
[1] = 0;

371 
f
->
ªchÜ_pic_æag
[0] = 0;

372 
f
->
ªchÜ_pic_æag
[1] = 0;

375  
f
;

376 
	}
}

378 
	$®loc_pic_mÙiÚ
(
PicMÙiÚP¬amsOld
 *
mÙiÚ
, 
size_y
, 
size_x
)

380 
mÙiÚ
->
mb_f›ld
 = 
	`ÿÎoc
 (
size_y
 * 
size_x
, (
by‹
));

381 ià(
mÙiÚ
->
mb_f›ld
 =ð
NULL
)

382 
	`no_mem_ex™
("alloc_storable_picture: motion->mb_field");

383 
	}
}

407 
StÜabËPiùu»
* 
	$®loc_¡ÜabË_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»SŒuùu»
 
¡ruùu»
, 
size_x
, 
size_y
, 
size_x_ü
, 
size_y_ü
)

409 
StÜabËPiùu»
 *
s
;

410 
ÅÏÃ
;

411 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

415 
s
 = 
	`ÿÎoc
 (1, (
StÜabËPiùu»
));

416 ià(
NULL
==
s
)

417 
	`no_mem_ex™
("alloc_storable_picture: s");

419 
s
->
imgY
 = 
NULL
;

420 
s
->
imgUV
 = 
NULL
;

421 
s
->
imgY_sub
 = 
NULL
;

422 
s
->
imgUV_sub
 = 
NULL
;

424 
s
->
p_img_sub
[0] = 
NULL
;

425 
s
->
p_img_sub
[1] = 
NULL
;

426 
s
->
p_img_sub
[2] = 
NULL
;

428 
s
->
de_mem
 = 
NULL
;

430 #ià(
MVC_EXTENSION_ENABLE
)

431 ià((
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
è|| ((
p_IÅ
->
num_of_v›ws
 =ð2è&&…_Vid->
v›w_id
 == 0))

433 ià(
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
)

436 ià(!
p_IÅ
->
OnTheFlyF¿ùMCP
)

438 
	`g‘_mem4D³l_·d
(&(
s
->
imgY_sub
), 4, 4, 
size_y
, 
size_x
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

439 
s
->
imgY
 = s->
imgY_sub
[0][0];

441 iàÐ
p_IÅ
->
ChromaMCBufãr
 || 
p_Vid
->
P444_jošed
 || (p_IÅ->
yuv_fÜm©
==
YUV444
 && !p_Vid->P444_joined))

444 iàÐ
p_Vid
->
yuv_fÜm©
 !ð
YUV400
 )

446 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 )

448 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 8, 8, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

450 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV422
 )

452 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 4, 8, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

456 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 4, 4, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

458 
s
->
p_img_sub
[1] = s->
imgUV_sub
[0];

459 
s
->
p_img_sub
[2] = s->
imgUV_sub
[1];

460 
s
->
imgUV
 = (
img³l
 ***)
	`m®loc
(2*(imgpel**));

461 
s
->
imgUV
[0] = s->
imgUV_sub
[0][0][0];

462 
s
->
imgUV
[1] = s->
imgUV_sub
[1][0][0];

467 
	`g‘_mem3D³l_·d
(&(
s
->
imgUV
), 2, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

470 iàÐ
p_IÅ
->
OnTheFlyF¿ùMCP
 =ð
OTF_L1
 )

472 
	`g‘_mem4D³l_·d
(&(
s
->
imgY_sub
), 2, 2, 
size_y
, 
size_x
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

473 
s
->
imgY
 = s->
imgY_sub
[0][0];

475 iàÐ
p_IÅ
->
ChromaMCBufãr
 || 
p_Vid
->
P444_jošed
 || (p_IÅ->
yuv_fÜm©
==
YUV444
 && !p_Vid->P444_joined))

478 iàÐ
p_Vid
->
yuv_fÜm©
 !ð
YUV400
 )

480 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 )

482 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 4, 4, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

484 iàÐ
p_Vid
->
yuv_fÜm©
 =ð
YUV422
 )

486 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 2, 4, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

490 
	`g‘_mem5D³l_·d
(&(
s
->
imgUV_sub
), 2, 2, 2, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

492 
s
->
p_img_sub
[1] = s->
imgUV_sub
[0];

493 
s
->
p_img_sub
[2] = s->
imgUV_sub
[1];

494 
s
->
imgUV
 = (
img³l
 ***)
	`m®loc
(2*(imgpel**));

495 
s
->
imgUV
[0] = s->
imgUV_sub
[0][0][0];

496 
s
->
imgUV
[1] = s->
imgUV_sub
[1][0][0];

501 
	`g‘_mem3D³l_·d
(&(
s
->
imgUV
), 2, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

506 
	`g‘_mem2D³l_·d
(&(
s
->
imgY
), 
size_y
, 
size_x
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

507 
	`g‘_mem3D³l_·d
(&(
s
->
imgUV
), 2, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

512 
	`g‘_mem2D³l_·d
(&(
s
->
imgY
), 
size_y
, 
size_x
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

513 
	`g‘_mem3D³l_·d
(&(
s
->
imgUV
), 2, 
size_y_ü
, 
size_x_ü
, 
p_Vid
->
·d_size_uv_y
,…_Vid->
·d_size_uv_x
);

516 
s
->
p_img
[0] = s->
imgY
;

517 
s
->
p_cu¼_img
 = s->
p_img
[0];

518 
s
->
p_cu¼_img_sub
 = s->
p_img_sub
[0];

520 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

523 
s
->
p_img
[1] = s->
imgUV
[0];

524 
s
->
p_img
[2] = s->
imgUV
[1];

527 
	`g‘_mem2Dmp
 (&
s
->
mv_šfo
, (
size_y
 >> 
BLOCK_SHIFT
), (
size_x
 >> BLOCK_SHIFT));

528 
	`®loc_pic_mÙiÚ
(&
s
->
mÙiÚ
, (
size_y
 >> 
BLOCK_SHIFT
), (
size_x
 >> BLOCK_SHIFT));

530 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

532  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

534 
	`g‘_mem2Dmp
 (&
s
->
JVmv_šfo
[
ÅÏÃ
], (
size_y
 >> 
BLOCK_SHIFT
), (
size_x
 >> BLOCK_SHIFT));

535 
	`®loc_pic_mÙiÚ
(&
s
->
JVmÙiÚ
[
ÅÏÃ
], (
size_y
 >> 
BLOCK_SHIFT
), (
size_x
 >> BLOCK_SHIFT));

539 ià(
p_IÅ
->
rdÝt
 == 3)

541 
	`”rdo_®loc_¡ÜabË_piùu»
(
s
, 
p_Vid
, 
p_IÅ
, 
size_x
, 
size_y
, 
size_x_ü
, 
size_y_ü
);

545 if(
p_IÅ
->
HMEEÇbË
 && 
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
)

547 
	`AÎocHMEMemÜy
(&
s
->
pHmeImage
, 
p_Vid
, 
size_y
, 
size_x
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
, 1);

550 
s
->
pic_num
=0;

551 
s
->
äame_num
=0;

552 
s
->
lÚg_‹rm_äame_idx
=0;

553 
s
->
lÚg_‹rm_pic_num
=0;

554 
s
->
u£d_fÜ_»ã»nû
=0;

555 
s
->
is_lÚg_‹rm
=0;

556 
s
->
nÚ_exi¡šg
=0;

557 
s
->
is_ouut
 = 0;

559 
s
->
¡ruùu»
=structure;

560 
s
->
size_x
 = size_x;

561 
s
->
size_y
 = size_y;

562 
s
->
size_x_·dded
 = 
size_x
 + 2 * 
IMG_PAD_SIZE_X
;

563 
s
->
size_y_·dded
 = 
size_y
 + 2 * 
IMG_PAD_SIZE_Y
;

564 
s
->
size_x_·d
 = 
size_x
 + 2 * 
IMG_PAD_SIZE_X
 - 1 - 
MB_BLOCK_SIZE
 -IMG_PAD_SIZE_X;

565 
s
->
size_y_·d
 = 
size_y
 + 2 * 
IMG_PAD_SIZE_Y
 - 1 - 
MB_BLOCK_SIZE
 -IMG_PAD_SIZE_Y;

566 
s
->
size_x_ü
 = size_x_cr;

567 
s
->
size_y_ü
 = size_y_cr;

568 
s
->
size_x_ü_·d
 = (è(
size_x_ü
 - 1è+ (
p_Vid
->
·d_size_uv_x
 << 1è- (p_Vid->
mb_ü_size_x
) -…_Vid->pad_size_uv_x;

569 
s
->
size_y_ü_·d
 = (è(
size_y_ü
 - 1è+ (
p_Vid
->
·d_size_uv_y
 << 1è- (p_Vid->
mb_ü_size_y
) -…_Vid->pad_size_uv_y;

570 
s
->
·d_size_uv_x
 = 
p_Vid
->pad_size_uv_x;

571 
s
->
·d_size_uv_y
 = 
p_Vid
->pad_size_uv_y;

573 
s
->
tÝ_f›ld
 = 
NULL
;

574 
s
->
bÙtom_f›ld
 = 
NULL
;

575 
s
->
äame
 = 
NULL
;

577 
s
->
coded_äame
 = 0;

578 
s
->
mb_aff_äame_æag
 = 0;

580 
	`mem£t
(
s
->
»f_pic_Ç
, 0xff, ()*6);

582 
	`š™_¡©s
(
p_IÅ
, &
s
->
¡©s
);

583  
s
;

584 
	}
}

599 
	$ä“_äame_¡Üe
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
* 
f
)

601 ià(
f
)

603 ià(
f
->
äame
)

605 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
f
->
äame
);

606 
f
->
äame
=
NULL
;

608 ià(
f
->
tÝ_f›ld
)

610 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
f
->
tÝ_f›ld
);

611 
f
->
tÝ_f›ld
=
NULL
;

613 ià(
f
->
bÙtom_f›ld
)

615 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
f
->
bÙtom_f›ld
);

616 
f
->
bÙtom_f›ld
=
NULL
;

618 
	`ä“
(
f
);

620 
	}
}

622 
	$ä“_pic_mÙiÚ
(
PicMÙiÚP¬amsOld
 *
mÙiÚ
)

624 ià(
mÙiÚ
->
mb_f›ld
)

626 
	`ä“
(
mÙiÚ
->
mb_f›ld
);

627 
mÙiÚ
->
mb_f›ld
 = 
NULL
;

629 
	}
}

631 
	$ä“_äame_d©a_memÜy
(
StÜabËPiùu»
 *
piùu»
, 
bF»eImage
)

633 if(
piùu»
)

635 ià(
piùu»
->
imgY_sub
)

637 if(
bF»eImage
)

639 
piùu»
->
imgY
 = 
NULL
;

640 ifÐ
piùu»
->
Ùf_æag
 =ð
OTF_L1
 )

642 
	`ä“_mem4D³l_·d
(
piùu»
->
imgY_sub
, 4, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

646 
	`ä“_mem4D³l_·d
(
piùu»
->
imgY_sub
, 16, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

648 
piùu»
->
imgY_sub
=
NULL
;

652 
k
;

653 
K
 = (
piùu»
->
Ùf_æag
==
OTF_L1
) ? (4):(16) ;

654 
k
 = 1; k < 
K
; k++)

656 if(
piùu»
->
imgY_sub
[
k
>>2][k&3])

658 
	`ä“_mem2D³l_·d
(
piùu»
->
imgY_sub
[
k
>>2][k&3], 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

659 
piùu»
->
imgY_sub
[
k
>>2][k&3] = 
NULL
;

665 ià(
piùu»
->
imgUV_sub
)

667 
iUVResX
 = 4*(
piùu»
->
size_x
/piùu»->
size_x_ü
);

668 
iUVResY
 = 4*(
piùu»
->
size_y
/piùu»->
size_y_ü
);

670 iàÐ
piùu»
->
Ùf_æag
 =ð
OTF_L1
 )

672 
iUVResX
 >>= 1 ;

673 
iUVResY
 >>= 1 ;

676 if(
bF»eImage
)

678 if(
piùu»
->
imgUV
)

680 
	`ä“
(
piùu»
->
imgUV
);

681 
piùu»
->
imgUV
 = 
NULL
;

683 
	`ä“_mem5D³l_·d
(
piùu»
->
imgUV_sub
, 2*
iUVResY
*
iUVResX
,…iùu»->
·d_size_uv_y
,…iùu»->
·d_size_uv_x
);

684 
piùu»
->
imgUV_sub
 = 
NULL
;

688 
i
, 
j
, 
k
;

689 
k
=1; k<
iUVResY
*
iUVResX
; k++)

691 
j
 = 
k
/
iUVResX
;

692 
i
 = 
k
%
iUVResX
;

693 if(
piùu»
->
imgUV_sub
[0][
j
][
i
])

695 
	`ä“_mem2D³l_·d
(
piùu»
->
imgUV_sub
[0][
j
][
i
],…iùu»->
·d_size_uv_y
,…iùu»->
·d_size_uv_x
);

696 
piùu»
->
imgUV_sub
[0][
j
][
i
] = 
NULL
;

698 if(
piùu»
->
imgUV_sub
[1][
j
][
i
])

700 
	`ä“_mem2D³l_·d
(
piùu»
->
imgUV_sub
[1][
j
][
i
],…iùu»->
·d_size_uv_y
,…iùu»->
·d_size_uv_x
);

701 
piùu»
->
imgUV_sub
[1][
j
][
i
] = 
NULL
;

707 ià(
piùu»
->
mv_šfo
)

709 
	`ä“_mem2Dmp
(
piùu»
->
mv_šfo
);

710 
piùu»
->
mv_šfo
 = 
NULL
;

713 
	`ä“_pic_mÙiÚ
(&
piùu»
->
mÙiÚ
);

715 
	}
}

729 
	$ä“_¡ÜabË_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
* 
p
)

731 ià(
p
)

733 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

735 if(
p
->
imgY
 && !p->
imgY_sub
)

737 
	`ä“_mem2D³l_·d
(
p
->
imgY
, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

738 
p
->
imgY
=
NULL
;

741 ià(
p
->
imgUV
 && !p->
imgUV_sub
)

743 
	`ä“_mem3D³l_·d
(
p
->
imgUV
, 2,…->
·d_size_uv_y
,…->
·d_size_uv_x
);

744 
p
->
imgUV
=
NULL
;

747 
	`ä“_äame_d©a_memÜy
(
p
, 1);

749 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

751 
ÅÏÃ
;

752  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

754 ià(
p
->
JVmv_šfo
[
ÅÏÃ
])

756 
	`ä“_mem2Dmp
(
p
->
JVmv_šfo
[
ÅÏÃ
]);

757 
p
->
JVmv_šfo
[
ÅÏÃ
] = 
NULL
;

759 
	`ä“_pic_mÙiÚ
(&
p
->
JVmÙiÚ
[
ÅÏÃ
]);

761 
p
->
p_cu¼_img
 = 
NULL
;

762 
p
->
p_cu¼_img_sub
 = 
NULL
;

763 
p
->
p_img
[0] = 
NULL
;

764 
p
->
p_img
[1] = 
NULL
;

765 
p
->
p_img
[2] = 
NULL
;

766 
p
->
p_img_sub
[0] = 
NULL
;

767 
p
->
p_img_sub
[1] = 
NULL
;

768 
p
->
p_img_sub
[2] = 
NULL
;

771 ià(
p_IÅ
->
rdÝt
 == 3)

773 
	`”rdo_ä“_¡ÜabË_piùu»
(
p
);

777 if(
p_IÅ
->
HMEEÇbË
)

779 
	`F»eHMEMemÜy
(&(
p
->
pHmeImage
), 
p_Vid
, 1, 
IMG_PAD_SIZE_Y
, 
IMG_PAD_SIZE_X
);

782 
	`ä“
(
p
);

783 
p
 = 
NULL
;

785 
	}
}

794 
	$unm¬k_fÜ_»ã»nû
(
F¿meStÜe
* 
fs
)

796 ià(
fs
->
is_u£d
 & 1)

798 ià(
fs
->
tÝ_f›ld
)

800 
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

803 ià(
fs
->
is_u£d
 & 2)

805 ià(
fs
->
bÙtom_f›ld
)

807 
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

810 ià(
fs
->
is_u£d
 == 3)

812 ià(
fs
->
tÝ_f›ld
 && fs->
bÙtom_f›ld
)

814 
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

815 
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

817 
fs
->
äame
->
u£d_fÜ_»ã»nû
 = 0;

820 
fs
->
is_»ã»nû
 = 0;

822 
	`ä“_äame_d©a_memÜy
(
fs
->
äame
, 0);

823 
	`ä“_äame_d©a_memÜy
(
fs
->
tÝ_f›ld
, 0);

824 
	`ä“_äame_d©a_memÜy
(
fs
->
bÙtom_f›ld
, 0);

825 
	}
}

835 
	$unm¬k_fÜ_lÚg_‹rm_»ã»nû
(
F¿meStÜe
* 
fs
)

837 ià(
fs
->
is_u£d
 & 1)

839 ià(
fs
->
tÝ_f›ld
)

841 
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

842 
fs
->
tÝ_f›ld
->
is_lÚg_‹rm
 = 0;

845 ià(
fs
->
is_u£d
 & 2)

847 ià(
fs
->
bÙtom_f›ld
)

849 
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

850 
fs
->
bÙtom_f›ld
->
is_lÚg_‹rm
 = 0;

853 ià(
fs
->
is_u£d
 == 3)

855 ià(
fs
->
tÝ_f›ld
 && fs->
bÙtom_f›ld
)

857 
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

858 
fs
->
tÝ_f›ld
->
is_lÚg_‹rm
 = 0;

859 
fs
->
bÙtom_f›ld
->
u£d_fÜ_»ã»nû
 = 0;

860 
fs
->
bÙtom_f›ld
->
is_lÚg_‹rm
 = 0;

862 
fs
->
äame
->
u£d_fÜ_»ã»nû
 = 0;

863 
fs
->
äame
->
is_lÚg_‹rm
 = 0;

866 
	`ä“_äame_d©a_memÜy
(
fs
->
äame
, 0);

867 
	`ä“_äame_d©a_memÜy
(
fs
->
tÝ_f›ld
, 0);

868 
	`ä“_äame_d©a_memÜy
(
fs
->
bÙtom_f›ld
, 0);

870 
fs
->
is_»ã»nû
 = 0;

871 
fs
->
is_lÚg_‹rm
 = 0;

872 
	}
}

876 
	$upd©e_pic_num
(
Sliû
 *
cu¼Sliû
)

878 
i
;

880 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

882 
add_tÝ
 = 0, 
add_bÙtom
 = 0;

884 
max_äame_num
 = 
cu¼Sliû
->max_frame_num;

887 ià(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

889 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

891 iàÐ
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 )

893 ià((
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

895 ifÐ
p_Dpb
->
fs_»f
[
i
]->
äame_num
 > 
cu¼Sliû
->frame_num )

897 
p_Dpb
->
fs_»f
[
i
]->
äame_num_w¿p
 =…_Dpb->fs_»f[i]->
äame_num
 - 
max_äame_num
;

901 
p_Dpb
->
fs_»f
[
i
]->
äame_num_w¿p
 =…_Dpb->fs_»f[i]->
äame_num
;

903 
p_Dpb
->
fs_»f
[
i
]->
äame
->
pic_num
 =…_Dpb->fs_»f[i]->
äame_num_w¿p
;

908 
i
 = 0; i < 
p_Dpb
->
É»f_äames_š_bufãr
; i++)

910 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_u£d
==3)

912 ià(
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
)

914 
p_Dpb
->
fs_É»f
[
i
]->
äame
->
lÚg_‹rm_pic_num
 =…_Dpb->fs_É»f[i]->äame->
lÚg_‹rm_äame_idx
;

921 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

923 
add_tÝ
 = 1;

924 
add_bÙtom
 = 0;

928 
add_tÝ
 = 0;

929 
add_bÙtom
 = 1;

932 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

934 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
)

936 ifÐ
p_Dpb
->
fs_»f
[
i
]->
äame_num
 > 
cu¼Sliû
->frame_num )

938 
p_Dpb
->
fs_»f
[
i
]->
äame_num_w¿p
 =…_Dpb->fs_»f[i]->
äame_num
 - 
max_äame_num
;

942 
p_Dpb
->
fs_»f
[
i
]->
äame_num_w¿p
 =…_Dpb->fs_»f[i]->
äame_num
;

944 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 1)

946 
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
pic_num
 = (2 *…_Dpb->fs_»f[i]->
äame_num_w¿p
è+ 
add_tÝ
;

948 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 2)

950 
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
pic_num
 = (2 *…_Dpb->fs_»f[i]->
äame_num_w¿p
è+ 
add_bÙtom
;

955 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

957 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 & 1)

959 
p_Dpb
->
fs_É»f
[
i
]->
tÝ_f›ld
->
lÚg_‹rm_pic_num
 = 2 *…_Dpb->fs_É»f[i]->tÝ_f›ld->
lÚg_‹rm_äame_idx
 + 
add_tÝ
;

961 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_lÚg_‹rm
 & 2)

963 
p_Dpb
->
fs_É»f
[
i
]->
bÙtom_f›ld
->
lÚg_‹rm_pic_num
 = 2 *…_Dpb->fs_É»f[i]->bÙtom_f›ld->
lÚg_‹rm_äame_idx
 + 
add_bÙtom
;

967 
	}
}

975 
	$š™_li¡s_i_¦iû
(
Sliû
 *
cu¼Sliû
)

977 
cu¼Sliû
->
li¡Xsize
[0] = 0;

978 
cu¼Sliû
->
li¡Xsize
[1] = 0;

979 
	}
}

990 
	$š™_li¡s_p_¦iû
(
Sliû
 *
cu¼Sliû
)

992 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

993 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

995 
i
, 
j
;

997 
li¡0idx
 = 0;

998 
li¡Éidx
 = 0;

1000 #ià(
MVC_EXTENSION_ENABLE
)

1001 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

1002 
š‹rv›w_pos
 = 0;

1005 
F¿meStÜe
 **
fs_li¡0
;

1006 
F¿meStÜe
 **
fs_li¡É
;

1008 
i
 = 0; i < 6; i++)

1010 
cu¼Sliû
->
li¡X
[
i
] = 
	`ÿÎoc
(
MAX_LIST_SIZE
,  (
StÜabËPiùu»
*));

1011 ià(
NULL
 =ð
cu¼Sliû
->
li¡X
[
i
])

1012 
	`no_mem_ex™
("init_dpb: currSlice->listX[i]");

1015 
j
 = 0; j < 6; j++)

1017 
i
 = 0; i < 
MAX_LIST_SIZE
; i++)

1019 
cu¼Sliû
->
li¡X
[
j
][
i
] = 
NULL
;

1021 
cu¼Sliû
->
li¡Xsize
[
j
]=0;

1025 ià(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

1027 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1029 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3)

1031 ià((
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

1033 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
]->
äame
;

1038 
	`qsÜt
((*)
cu¼Sliû
->
li¡X
[0], 
li¡0idx
, (
StÜabËPiùu»
*), 
com·»_pic_by_pic_num_desc
);

1039 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1042 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

1044 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_u£d
==3)

1046 ià(
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
)

1048 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
p_Dpb
->
fs_É»f
[
i
]->
äame
;

1052 
	`qsÜt
((*)&
cu¼Sliû
->
li¡X
[0][(ècu¼Sliû->
li¡Xsize
[0]], 
li¡0idx
 - cu¼Sliû->li¡Xsize[0], (
StÜabËPiùu»
*), 
com·»_pic_by_É_pic_num_asc
);

1053 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1057 
fs_li¡0
 = 
	`ÿÎoc
(
p_Dpb
->
size
,  (
F¿meStÜe
*));

1058 ià(
NULL
==
fs_li¡0
)

1059 
	`no_mem_ex™
("init_lists: fs_list0");

1060 
fs_li¡É
 = 
	`ÿÎoc
(
p_Dpb
->
size
,  (
F¿meStÜe
*));

1061 ià(
NULL
==
fs_li¡É
)

1062 
	`no_mem_ex™
("init_lists: fs_listlt");

1064 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1066 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
)

1068 
fs_li¡0
[
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
];

1072 
	`qsÜt
((*)
fs_li¡0
, 
li¡0idx
, (
F¿meStÜe
*), 
com·»_fs_by_äame_num_desc
);

1076 
cu¼Sliû
->
li¡Xsize
[0] = 0;

1077 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡0
, 
li¡0idx
, cu¼Sliû->
li¡X
[0], &cu¼Sliû->
li¡Xsize
[0], 0);

1082 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

1084 
fs_li¡É
[
li¡Éidx
++]=
p_Dpb
->
fs_É»f
[
i
];

1087 
	`qsÜt
((*)
fs_li¡É
, 
li¡Éidx
, (
F¿meStÜe
*), 
com·»_fs_by_É_pic_idx_asc
);

1089 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡É
, 
li¡Éidx
, cu¼Sliû->
li¡X
[0], &cu¼Sliû->
li¡Xsize
[0], 1);

1091 
	`ä“
(
fs_li¡0
);

1092 
	`ä“
(
fs_li¡É
);

1094 
cu¼Sliû
->
li¡Xsize
[1] = 0;

1096 #ià(
MVC_EXTENSION_ENABLE
 && !
SIMULCAST_ENABLE
)

1098 if(
p_IÅ
->
num_of_v›ws
 =ð2 && 
p_Vid
->
v›w_id
 == 1)

1100 
StÜabËPiùu»
 *
ba£_»f
;

1101 if(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

1103 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1104 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1105 
li¡0idx
 = 
cu¼Sliû
->
li¡Xsize
[0];

1110 
š‹rv›w_pos
 = 0;

1111 
ba£_»f
 = 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame
;

1113 ià(
ba£_»f
->
u£d_fÜ_»ã»nû
 || ba£_»f->
š‹r_v›w_æag
[0])

1116 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame_num_w¿p
 = -99;

1117 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
ba£_»f
;

1118 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1123 
cur_š‹r_v›w_æag
 = 
cu¼Sliû
->
¡ruùu»
 !ð
BOTTOM_FIELD
 ? 0 : 1;

1124 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1125 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1126 
li¡0idx
 = 
cu¼Sliû
->
li¡Xsize
[0];

1131 
š‹rv›w_pos
 = 0;

1132 
ba£_»f
 = 
cu¼Sliû
->
¡ruùu»
!=
BOTTOM_FIELD
? 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
tÝ_f›ld
:p_Dpb->fs_ž»f[š‹rv›w_pos]->
bÙtom_f›ld
;

1133 ià(
ba£_»f
->
u£d_fÜ_»ã»nû
 || ba£_»f->
š‹r_v›w_æag
[
cur_š‹r_v›w_æag
])

1136 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame_num_w¿p
 = -99;

1137 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
ba£_»f
;

1138 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1145 ià(
p_Vid
->
is_hme
 == 0)

1147 #ià(
MVC_EXTENSION_ENABLE
)

1148 if(
p_Vid
->
num_of_Ïy”s
 =ð2 && 
p_IÅ
->
MVCIÁ”V›wReÜd”
 &&…_Vid->
v›w_id
 == 1)

1150 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
] + 1);

1151 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1156 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1157 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1162 
i
=
cu¼Sliû
->
li¡Xsize
[0]; i< (
MAX_LIST_SIZE
) ; i++)

1164 
cu¼Sliû
->
li¡X
[0][
i
] = 
NULL
;

1166 
i
=
cu¼Sliû
->
li¡Xsize
[1]; i< (
MAX_LIST_SIZE
) ; i++)

1168 
cu¼Sliû
->
li¡X
[1][
i
] = 
NULL
;

1171 #ià
PRINTREFLIST


1172 #ià(
MVC_EXTENSION_ENABLE
)

1174 if(
p_IÅ
->
num_of_v›ws
==2 && 
p_Vid
->
cu¼’t_¦iû_Ä
==0)

1176 if(
cu¼Sliû
->
li¡Xsize
[0]>0)

1178 
	`´štf
("\n");

1179 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 0 ****\n", 
p_Vid
->
v›w_id
, 
cu¼Sliû
->
¡ruùu»
==
FRAME
 ? "FRM":(cu¼Sliû->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1180 
i
=0; i<()(
cu¼Sliû
->
li¡Xsize
[0]); i++)

1182 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, 
cu¼Sliû
->
li¡X
[0][i]->
poc
, cu¼Sliû->li¡X[0][i]->
pic_num
, cu¼Sliû->li¡X[0][i]->
v›w_id
);

1188 
	}
}

1198 
	$š™_li¡s_b_¦iû
(
Sliû
 *
cu¼Sliû
)

1200 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

1201 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

1203 
i
;

1204 
j
;

1206 
li¡0idx
 = 0;

1207 
li¡0idx_1
 = 0;

1208 
li¡Éidx
 = 0;

1210 #ià(
MVC_EXTENSION_ENABLE
)

1211 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

1212 
li¡1idx
 = 0;

1213 
š‹rv›w_pos
 = 0;

1216 
F¿meStÜe
 **
fs_li¡0
;

1217 
F¿meStÜe
 **
fs_li¡1
;

1218 
F¿meStÜe
 **
fs_li¡É
;

1221 
i
 = 0; i < 6; i++)

1223 
cu¼Sliû
->
li¡X
[
i
] = 
	`ÿÎoc
(
MAX_LIST_SIZE
,  (
StÜabËPiùu»
*));

1224 ià(
NULL
 =ð
cu¼Sliû
->
li¡X
[
i
])

1225 
	`no_mem_ex™
("init_dpb: currSlice->listX[i]");

1228 
j
 = 0; j < 6; j++)

1230 
i
 = 0; i < 
MAX_LIST_SIZE
; i++)

1232 
cu¼Sliû
->
li¡X
[
j
][
i
] = 
NULL
;

1234 
cu¼Sliû
->
li¡Xsize
[
j
]=0;

1239 ià(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

1241 
i
 = 0; i < 
p_Dpb
->
»f_äames_š_bufãr
; i++)

1243 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3)

1245 ià((
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

1247 ià(
cu¼Sliû
->
äam•oc
 > 
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
)

1249 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
]->
äame
;

1254 
	`qsÜt
((*)
cu¼Sliû
->
li¡X
[0], 
li¡0idx
, (
StÜabËPiùu»
*), 
com·»_pic_by_poc_desc
);

1257 
li¡0idx_1
 = 
li¡0idx
;

1258 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1260 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3)

1262 ià((
p_Dpb
->
fs_»f
[
i
]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

1264 ià(
cu¼Sliû
->
äam•oc
 < 
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
)

1266 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
]->
äame
;

1271 
	`qsÜt
((*)&
cu¼Sliû
->
li¡X
[0][
li¡0idx_1
], 
li¡0idx
-li¡0idx_1, (
StÜabËPiùu»
*), 
com·»_pic_by_poc_asc
);

1273 
j
=0; j<
li¡0idx_1
; j++)

1275 
cu¼Sliû
->
li¡X
[1][
li¡0idx
-
li¡0idx_1
+
j
]=currSlice->listX[0][j];

1277 
j
=
li¡0idx_1
; j<
li¡0idx
; j++)

1279 
cu¼Sliû
->
li¡X
[1][
j
-
li¡0idx_1
]=currSlice->listX[0][j];

1282 
cu¼Sliû
->
li¡Xsize
[0] = cu¼Sliû->li¡Xsize[1] = (è
li¡0idx
;

1288 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

1290 ià(
p_Dpb
->
fs_É»f
[
i
]->
is_u£d
==3)

1292 ià(
p_Dpb
->
fs_É»f
[
i
]->
äame
->
is_lÚg_‹rm
)

1294 
cu¼Sliû
->
li¡X
[0][
li¡0idx
] = 
p_Dpb
->
fs_É»f
[
i
]->
äame
;

1295 
cu¼Sliû
->
li¡X
[1][
li¡0idx
++] = 
p_Dpb
->
fs_É»f
[
i
]->
äame
;

1299 
	`qsÜt
((*)&
cu¼Sliû
->
li¡X
[0][(ècu¼Sliû->
li¡Xsize
[0]], 
li¡0idx
 - cu¼Sliû->li¡Xsize[0], (
StÜabËPiùu»
*), 
com·»_pic_by_É_pic_num_asc
);

1300 
	`qsÜt
((*)&
cu¼Sliû
->
li¡X
[1][(ècu¼Sliû->
li¡Xsize
[0]], 
li¡0idx
 - cu¼Sliû->li¡Xsize[0], (
StÜabËPiùu»
*), 
com·»_pic_by_É_pic_num_asc
);

1301 
cu¼Sliû
->
li¡Xsize
[0] = cu¼Sliû->li¡Xsize[1] = (è
li¡0idx
;

1305 
fs_li¡0
 = 
	`ÿÎoc
(
p_Dpb
->
size
,  (
F¿meStÜe
*));

1306 ià(
NULL
==
fs_li¡0
)

1307 
	`no_mem_ex™
("init_lists: fs_list0");

1308 
fs_li¡1
 = 
	`ÿÎoc
(
p_Dpb
->
size
,  (
F¿meStÜe
*));

1309 ià(
NULL
==
fs_li¡1
)

1310 
	`no_mem_ex™
("init_lists: fs_list1");

1311 
fs_li¡É
 = 
	`ÿÎoc
(
p_Dpb
->
size
,  (
F¿meStÜe
*));

1312 ià(
NULL
==
fs_li¡É
)

1313 
	`no_mem_ex™
("init_lists: fs_listlt");

1315 
cu¼Sliû
->
li¡Xsize
[0] = 0;

1316 
cu¼Sliû
->
li¡Xsize
[1] = 1;

1318 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1320 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
)

1322 ià(
cu¼Sliû
->
ThisPOC
 >ð
p_Dpb
->
fs_»f
[
i
]->
poc
)

1324 
fs_li¡0
[
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
];

1328 
	`qsÜt
((*)
fs_li¡0
, 
li¡0idx
, (
F¿meStÜe
*), 
com·»_fs_by_poc_desc
);

1329 
li¡0idx_1
 = 
li¡0idx
;

1330 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1332 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
)

1334 ià(
cu¼Sliû
->
ThisPOC
 < 
p_Dpb
->
fs_»f
[
i
]->
poc
)

1336 
fs_li¡0
[
li¡0idx
++] = 
p_Dpb
->
fs_»f
[
i
];

1340 
	`qsÜt
((*)&
fs_li¡0
[
li¡0idx_1
], 
li¡0idx
-li¡0idx_1, (
F¿meStÜe
*), 
com·»_fs_by_poc_asc
);

1342 
j
=0; j<
li¡0idx_1
; j++)

1344 
fs_li¡1
[
li¡0idx
-
li¡0idx_1
+
j
]=
fs_li¡0
[j];

1346 
j
=
li¡0idx_1
; j<
li¡0idx
; j++)

1348 
fs_li¡1
[
j
-
li¡0idx_1
]=
fs_li¡0
[j];

1354 
cu¼Sliû
->
li¡Xsize
[0] = 0;

1355 
cu¼Sliû
->
li¡Xsize
[1] = 0;

1356 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡0
, 
li¡0idx
, cu¼Sliû->
li¡X
[0], &cu¼Sliû->
li¡Xsize
[0], 0);

1357 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡1
, 
li¡0idx
, cu¼Sliû->
li¡X
[1], &cu¼Sliû->
li¡Xsize
[1], 0);

1363 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

1365 
fs_li¡É
[
li¡Éidx
++]=
p_Dpb
->
fs_É»f
[
i
];

1368 
	`qsÜt
((*)
fs_li¡É
, 
li¡Éidx
, (
F¿meStÜe
*), 
com·»_fs_by_É_pic_idx_asc
);

1370 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡É
, 
li¡Éidx
, cu¼Sliû->
li¡X
[0], &cu¼Sliû->
li¡Xsize
[0], 1);

1371 
	`g’_pic_li¡_äom_äame_li¡
(
cu¼Sliû
->
¡ruùu»
, 
fs_li¡É
, 
li¡Éidx
, cu¼Sliû->
li¡X
[1], &cu¼Sliû->
li¡Xsize
[1], 1);

1373 
	`ä“
(
fs_li¡0
);

1374 
	`ä“
(
fs_li¡1
);

1375 
	`ä“
(
fs_li¡É
);

1379 ià((
cu¼Sliû
->
li¡Xsize
[0] == currSlice->listXsize[1]) && (currSlice->listXsize[0] > 1))

1382 
diff
=0;

1383 
j
 = 0; j< 
cu¼Sliû
->
li¡Xsize
[0]; j++)

1385 ià(
cu¼Sliû
->
li¡X
[0][
j
] != currSlice->listX[1][j])

1387 
diff
 = 1;

1391 ià(!
diff
)

1393 
StÜabËPiùu»
 *
tmp_s
 = 
cu¼Sliû
->
li¡X
[1][0];

1394 
cu¼Sliû
->
li¡X
[1][0]=currSlice->listX[1][1];

1395 
cu¼Sliû
->
li¡X
[1][1]=
tmp_s
;

1399 #ià(
MVC_EXTENSION_ENABLE
 && !
SIMULCAST_ENABLE
)

1401 if(
p_IÅ
->
num_of_v›ws
 =ð2 && 
p_Vid
->
v›w_id
 == 1)

1403 
StÜabËPiùu»
 *
ba£_»f
;

1404 if(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

1406 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1407 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1408 
li¡0idx
 = 
cu¼Sliû
->
li¡Xsize
[0];

1409 
li¡1idx
 = 
cu¼Sliû
->
li¡Xsize
[1];

1414 
š‹rv›w_pos
 = 0;

1415 
ba£_»f
 = 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame
;

1417 ià(
ba£_»f
->
u£d_fÜ_»ã»nû
 || ba£_»f->
š‹r_v›w_æag
[0])

1420 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame_num_w¿p
 = -99;

1421 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
ba£_»f
;

1422 
cu¼Sliû
->
li¡X
[1][
li¡1idx
++] = 
ba£_»f
;

1423 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1424 
cu¼Sliû
->
li¡Xsize
[1] = (è
li¡1idx
;

1429 
cur_š‹r_v›w_æag
 = 
cu¼Sliû
->
¡ruùu»
 !ð
BOTTOM_FIELD
 ? 0 : 1;

1430 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1431 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1432 
li¡0idx
 = 
cu¼Sliû
->
li¡Xsize
[0];

1433 
li¡1idx
 = 
cu¼Sliû
->
li¡Xsize
[1];

1438 
š‹rv›w_pos
 = 0;

1439 
ba£_»f
 = 
cu¼Sliû
->
¡ruùu»
 !ð
BOTTOM_FIELD
 ? 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
tÝ_f›ld
:p_Dpb->fs_ž»f[š‹rv›w_pos]->
bÙtom_f›ld
;

1440 ià(
ba£_»f
->
u£d_fÜ_»ã»nû
 || ba£_»f->
š‹r_v›w_æag
[
cur_š‹r_v›w_æag
])

1443 
p_Dpb
->
fs_ž»f
[
š‹rv›w_pos
]->
äame_num_w¿p
 = -99;

1444 
cu¼Sliû
->
li¡X
[0][
li¡0idx
++] = 
ba£_»f
;

1445 
cu¼Sliû
->
li¡X
[1][
li¡1idx
++] = 
ba£_»f
;

1446 
cu¼Sliû
->
li¡Xsize
[0] = (è
li¡0idx
;

1447 
cu¼Sliû
->
li¡Xsize
[1] = (è
li¡1idx
;

1454 #ià(
MVC_EXTENSION_ENABLE
)

1455 if(
p_Vid
->
num_of_Ïy”s
 =ð2 && 
p_IÅ
->
MVCIÁ”V›wReÜd”
 &&…_Vid->
v›w_id
 == 1)

1457 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
] + 1);

1458 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1463 
cu¼Sliû
->
li¡Xsize
[0] = (è
	`imš
 (cu¼Sliû->li¡Xsize[0], cu¼Sliû->
num_»f_idx_aùive
[
LIST_0
]);

1464 
cu¼Sliû
->
li¡Xsize
[1] = (è
	`imš
 (cu¼Sliû->li¡Xsize[1], cu¼Sliû->
num_»f_idx_aùive
[
LIST_1
]);

1468 
i
=
cu¼Sliû
->
li¡Xsize
[0]; i< (
MAX_LIST_SIZE
) ; i++)

1470 
cu¼Sliû
->
li¡X
[0][
i
] = 
NULL
;

1472 
i
=
cu¼Sliû
->
li¡Xsize
[1]; i< (
MAX_LIST_SIZE
) ; i++)

1474 
cu¼Sliû
->
li¡X
[1][
i
] = 
NULL
;

1477 #ià
PRINTREFLIST


1478 #ià(
MVC_EXTENSION_ENABLE
)

1480 if(
p_IÅ
->
num_of_v›ws
==2 && 
p_Vid
->
cu¼’t_¦iû_Ä
==0)

1482 if((
cu¼Sliû
->
li¡Xsize
[0]>0) || (currSlice->listXsize[1]>0))

1483 
	`´štf
("\n");

1484 if(
cu¼Sliû
->
li¡Xsize
[0]>0)

1486 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 0 ****\n", 
p_Vid
->
v›w_id
, 
cu¼Sliû
->
¡ruùu»
==
FRAME
 ? "FRM":(cu¼Sliû->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1487 
i
=0; i<()(
cu¼Sliû
->
li¡Xsize
[0]); i++)

1489 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, 
cu¼Sliû
->
li¡X
[0][i]->
poc
, cu¼Sliû->li¡X[0][i]->
pic_num
, cu¼Sliû->li¡X[0][i]->
v›w_id
);

1492 if(
cu¼Sliû
->
li¡Xsize
[1]>0)

1494 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 1 ****\n", 
p_Vid
->
v›w_id
, 
cu¼Sliû
->
¡ruùu»
==
FRAME
 ? "FRM":(cu¼Sliû->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1495 
i
=0; i<()(
cu¼Sliû
->
li¡Xsize
[1]); i++)

1497 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, 
cu¼Sliû
->
li¡X
[1][i]->
poc
, cu¼Sliû->li¡X[1][i]->
pic_num
, cu¼Sliû->li¡X[1][i]->
v›w_id
);

1503 
	}
}

1516 
	$š™_mbaff_li¡s
(
Sliû
 *
cu¼Sliû
)

1518 
j
;

1519 
i
;

1521 
i
=2;i<6;i++)

1523 if(
cu¼Sliû
->
li¡X
[
i
])

1525 
j
=0; j<
MAX_LIST_SIZE
; j++)

1527 
cu¼Sliû
->
li¡X
[
i
][
j
] = 
NULL
;

1530 
cu¼Sliû
->
li¡Xsize
[
i
]=0;

1533 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[0]; i++)

1535 
cu¼Sliû
->
li¡X
[2][2*
i
 ] = cu¼Sliû->li¡X[0][i]->
tÝ_f›ld
;

1536 
cu¼Sliû
->
li¡X
[2][2*
i
+1] = cu¼Sliû->li¡X[0][i]->
bÙtom_f›ld
;

1537 
cu¼Sliû
->
li¡X
[4][2*
i
 ] = cu¼Sliû->li¡X[0][i]->
bÙtom_f›ld
;

1538 
cu¼Sliû
->
li¡X
[4][2*
i
+1] = cu¼Sliû->li¡X[0][i]->
tÝ_f›ld
;

1540 
cu¼Sliû
->
li¡Xsize
[2] = currSlice->listXsize[4] = currSlice->listXsize[0] * 2;

1542 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[1]; i++)

1544 
cu¼Sliû
->
li¡X
[3][2*
i
 ] = cu¼Sliû->li¡X[1][i]->
tÝ_f›ld
;

1545 
cu¼Sliû
->
li¡X
[3][2*
i
+1] = cu¼Sliû->li¡X[1][i]->
bÙtom_f›ld
;

1546 
cu¼Sliû
->
li¡X
[5][2*
i
 ] = cu¼Sliû->li¡X[1][i]->
bÙtom_f›ld
;

1547 
cu¼Sliû
->
li¡X
[5][2*
i
+1] = cu¼Sliû->li¡X[1][i]->
tÝ_f›ld
;

1549 
cu¼Sliû
->
li¡Xsize
[3] = currSlice->listXsize[5] = currSlice->listXsize[1] * 2;

1550 
	}
}

1559 
StÜabËPiùu»
 *
	$g‘_shÜt_‹rm_pic
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
picNum
)

1561 
i
;

1563 
i
 = 0; i < 
p_Dpb
->
»f_äames_š_bufãr
; i++)

1565 ià(
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

1567 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 == 3)

1568 ià((!
p_Dpb
->
fs_»f
[
i
]->
äame
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->äame->
pic_num
 =ð
picNum
))

1569  
p_Dpb
->
fs_»f
[
i
]->
äame
;

1573 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 1)

1574 ià((!
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->tÝ_f›ld->
pic_num
 =ð
picNum
))

1575  
p_Dpb
->
fs_»f
[
i
]->
tÝ_f›ld
;

1576 ià(
p_Dpb
->
fs_»f
[
i
]->
is_»ã»nû
 & 2)

1577 ià((!
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
->
is_lÚg_‹rm
)&&Õ_Dpb->fs_»f[i]->bÙtom_f›ld->
pic_num
 =ð
picNum
))

1578  
p_Dpb
->
fs_»f
[
i
]->
bÙtom_f›ld
;

1581  
NULL
;

1582 
	}
}

1592 
	$»Üd”_shÜt_‹rm
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cur_li¡
, 
picNumLX
, *
»fIdxLX
)

1594 
StÜabËPiùu»
 **
RefPicLi¡X
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
];

1595 
cIdx
, 
nIdx
;

1597 
StÜabËPiùu»
 *
picLX
;

1599 
picLX
 = 
	`g‘_shÜt_‹rm_pic
(
cu¼Sliû
, 
p_Dpb
, 
picNumLX
);

1601  
cIdx
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
cur_li¡
]; cIdx > *
»fIdxLX
; cIdx-- )

1602 
RefPicLi¡X
[ 
cIdx
 ] = RefPicListX[ cIdx - 1];

1604 
RefPicLi¡X
[ (*
»fIdxLX
)++ ] = 
picLX
;

1606 
nIdx
 = *
»fIdxLX
;

1608  
cIdx
 = *
»fIdxLX
; cIdx <ð
cu¼Sliû
->
num_»f_idx_aùive
[
cur_li¡
]; cIdx++ )

1610 ià(
RefPicLi¡X
[ 
cIdx
 ])

1611 ifÐ(
RefPicLi¡X
[ 
cIdx
 ]->
is_lÚg_‹rm
 ) || (RefPicLi¡X[ cIdx ]->
pic_num
 !ð
picNumLX
 ))

1612 
RefPicLi¡X
[ 
nIdx
++ ] = RefPicLi¡X[ 
cIdx
 ];

1614 
	}
}

1624 
	$»Üd”_lÚg_‹rm
(
Sliû
 *
cu¼Sliû
, 
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
 **
RefPicLi¡X
, 
cur_li¡
, 
äame_no
, *
»fIdxLX
)

1626 
cIdx
, 
nIdx
;

1627 
LÚgT”mPicNum
 = 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
cur_li¡
][
äame_no
];

1629 
StÜabËPiùu»
 *
picLX
;

1631 
picLX
 = 
	`g‘_lÚg_‹rm_pic
(
cu¼Sliû
, 
p_Dpb
, 
LÚgT”mPicNum
);

1633  
cIdx
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
cur_li¡
]; cIdx > *
»fIdxLX
; cIdx-- )

1634 
RefPicLi¡X
[ 
cIdx
 ] = RefPicListX[ cIdx - 1];

1636 
RefPicLi¡X
[ (*
»fIdxLX
)++ ] = 
picLX
;

1638 
nIdx
 = *
»fIdxLX
;

1640  
cIdx
 = *
»fIdxLX
; cIdx <ð
cu¼Sliû
->
num_»f_idx_aùive
[
cur_li¡
]; cIdx++ )

1641 ifÐ(!
RefPicLi¡X
[ 
cIdx
 ]->
is_lÚg_‹rm
 ) || (RefPicLi¡X[ cIdx ]->
lÚg_‹rm_pic_num
 !ð
LÚgT”mPicNum
 ))

1642 
RefPicLi¡X
[ 
nIdx
++ ] = RefPicLi¡X[ 
cIdx
 ];

1643 
	}
}

1654 
	$»Üd”_»f_pic_li¡
(
Sliû
 *
cu¼Sliû
, 
cur_li¡
)

1656 *
modifiÿtiÚ_of_pic_nums_idc
 = 
cu¼Sliû
->modifiÿtiÚ_of_pic_nums_idc[
cur_li¡
];

1657 *
abs_diff_pic_num_mšus1
 = 
cu¼Sliû
->abs_diff_pic_num_mšus1[
cur_li¡
];

1658 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

1659 
i
;

1661 
maxPicNum
, 
cu¼PicNum
, 
picNumLXNoW¿p
, 
picNumLXP»d
, 
picNumLX
;

1662 
»fIdxLX
 = 0;

1664 ià(
cu¼Sliû
->
¡ruùu»
==
FRAME
)

1666 
maxPicNum
 = 
cu¼Sliû
->
max_äame_num
;

1667 
cu¼PicNum
 = 
cu¼Sliû
->
äame_num
;

1671 
maxPicNum
 = 2 * 
cu¼Sliû
->
max_äame_num
;

1672 
cu¼PicNum
 = 2 * 
cu¼Sliû
->
äame_num
 + 1;

1675 
picNumLXP»d
 = 
cu¼PicNum
;

1677 
i
=0; 
modifiÿtiÚ_of_pic_nums_idc
[i]!=3; i++)

1679 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] > 3)

1680 
	`”rÜ
 ("Invalid modification_of_pic_nums_idc command", 500);

1682 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] < 2)

1684 ià(
modifiÿtiÚ_of_pic_nums_idc
[
i
] == 0)

1686 ifÐ
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) < 0 )

1687 
picNumLXNoW¿p
 = 
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) + 
maxPicNum
;

1689 
picNumLXNoW¿p
 = 
picNumLXP»d
 - ( 
abs_diff_pic_num_mšus1
[
i
] + 1 );

1693 ifÐ
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) >ð
maxPicNum
 )

1694 
picNumLXNoW¿p
 = 
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 ) - 
maxPicNum
;

1696 
picNumLXNoW¿p
 = 
picNumLXP»d
 + ( 
abs_diff_pic_num_mšus1
[
i
] + 1 );

1698 
picNumLXP»d
 = 
picNumLXNoW¿p
;

1700 ifÐ
picNumLXNoW¿p
 > 
cu¼PicNum
 )

1701 
picNumLX
 = 
picNumLXNoW¿p
 - 
maxPicNum
;

1703 
picNumLX
 = 
picNumLXNoW¿p
;

1705 
	`»Üd”_shÜt_‹rm
(
cu¼Sliû
, 
p_Dpb
, 
cur_li¡
, 
picNumLX
, &
»fIdxLX
);

1709 
	`»Üd”_lÚg_‹rm
 (
cu¼Sliû
, 
p_Dpb
, cu¼Sliû->
li¡X
[
cur_li¡
], cur_li¡, 
i
, &
»fIdxLX
);

1714 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
] = cu¼Sliû->
num_»f_idx_aùive
[cur_list];

1715 
	}
}

1727 
	$idr_memÜy_mªagem’t
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
)

1729 
i
;

1730 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

1732 
	`as£¹
 (
p_Vid
->
cu¼’tPiùu»
->
idr_æag
);

1734 ià(
p_Vid
->
no_ouut_of_´iÜ_pics_æag
)

1737 
i
=0; i<
p_Dpb
->
u£d_size
; i++)

1740 
	`ä“_äame_¡Üe
(
p_Vid
, 
p_Dpb
->
fs
[
i
]);

1741 
p_Dpb
->
fs
[
i
] = 
	`®loc_äame_¡Üe
();

1743 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

1745 
p_Dpb
->
fs_»f
[
i
]=
NULL
;

1747 
i
=0; i<
p_Dpb
->
É»f_äames_š_bufãr
; i++)

1749 
p_Dpb
->
fs_É»f
[
i
]=
NULL
;

1751 
p_Dpb
->
u£d_size
=0;

1755 
	`æush_dpb
(
p_Dpb
, 
ouut
);

1757 
p_Dpb
->
Ï¡_piùu»
 = 
NULL
;

1759 
	`upd©e_»f_li¡
(
p_Dpb
);

1760 
	`upd©e_É»f_li¡
(
p_Dpb
);

1761 
p_Dpb
->
Ï¡_ouut_poc
 = 
INT_MIN
;

1762 #ià(
MVC_EXTENSION_ENABLE
)

1763 
p_Dpb
->
Ï¡_ouut_v›w_id
 = 0;

1766 ià(
p_Vid
->
lÚg_‹rm_»ã»nû_æag
)

1768 
p_Dpb
->
max_lÚg_‹rm_pic_idx
 = 0;

1769 
p
->
is_lÚg_‹rm
 = 1;

1770 
p
->
lÚg_‹rm_äame_idx
 = 0;

1774 
p_Dpb
->
max_lÚg_‹rm_pic_idx
 = -1;

1775 
p
->
is_lÚg_‹rm
 = 0;

1777 
	}
}

1786 
	$¦idšg_wšdow_memÜy_mªagem’t
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
)

1788 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

1789 
i
;

1792 ià(
p_Dpb
->
»f_äames_š_bufãr
 =ð
	`imax
(1, 
p_Vid
->
aùive_¥s
->
num_»f_äames
è-…_Dpb->
É»f_äames_š_bufãr
)

1794 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

1796 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)))

1798 
	`unm¬k_fÜ_»ã»nû
(
p_Dpb
->
fs
[
i
]);

1799 
	`upd©e_»f_li¡
(
p_Dpb
);

1805 
p
->
is_lÚg_‹rm
 = 0;

1806 
	}
}

1819 
	$ad­tive_memÜy_mªagem’t
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
)

1821 
DecRefPicM¬kšg_t
 *
tmp_d½m
;

1822 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

1824 
p_Vid
->
Ï¡_has_mmco_5
 = 0;

1826 
	`as£¹
 (!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
);

1827 
	`as£¹
 (
p_Vid
->
ad­tive_»f_pic_bufãršg_æag
);

1829 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
)

1831 
tmp_d½m
 = 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
;

1832 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
)

1835 ià(
tmp_d½m
->
Next
 !ð
NULL
)

1837 
	`”rÜ
 ("memory_management_control_operation = 0‚ot†ast operation in buffer", 500);

1841 
	`mm_unm¬k_shÜt_‹rm_fÜ_»ã»nû
(
p_Dpb
, 
p
, 
tmp_d½m
->
difã»nû_of_pic_nums_mšus1
);

1842 
	`upd©e_»f_li¡
(
p_Dpb
);

1845 
	`mm_unm¬k_lÚg_‹rm_fÜ_»ã»nû
(
p_Dpb
, 
p
, 
tmp_d½m
->
lÚg_‹rm_pic_num
);

1846 
	`upd©e_É»f_li¡
(
p_Dpb
);

1849 
	`mm_assign_lÚg_‹rm_äame_idx
(
p_Dpb
, 
p
, 
tmp_d½m
->
difã»nû_of_pic_nums_mšus1
,mp_d½m->
lÚg_‹rm_äame_idx
);

1850 
	`upd©e_»f_li¡
(
p_Dpb
);

1851 
	`upd©e_É»f_li¡
(
p_Dpb
);

1854 
	`mm_upd©e_max_lÚg_‹rm_äame_idx
 (
p_Dpb
, 
tmp_d½m
->
max_lÚg_‹rm_äame_idx_¶us1
);

1855 
	`upd©e_É»f_li¡
(
p_Dpb
);

1858 
	`mm_unm¬k_®l_shÜt_‹rm_fÜ_»ã»nû
(
p_Dpb
);

1859 
	`mm_unm¬k_®l_lÚg_‹rm_fÜ_»ã»nû
(
p_Dpb
);

1860 
p_Vid
->
Ï¡_has_mmco_5
 = 1;

1863 
	`mm_m¬k_cu¼’t_piùu»_lÚg_‹rm
(
p_Dpb
, 
p
, 
tmp_d½m
->
lÚg_‹rm_äame_idx
);

1864 
	`check_num_»f
(
p_Dpb
);

1867 
	`”rÜ
 ("invalid memory_management_control_operation in buffer", 500);

1869 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m
->
Next
;

1870 
	`ä“
 (
tmp_d½m
);

1872 iàÐ
p_Vid
->
Ï¡_has_mmco_5
 )

1874 
p
->
pic_num
 =…->
äame_num
 = 0;

1876 
p
->
¡ruùu»
)

1878 
TOP_FIELD
:

1880 
p
->
poc
 =…->
tÝ_poc
 = 
p_Vid
->
tÝpoc
 =0;

1883 
BOTTOM_FIELD
:

1885 
p
->
poc
 =…->
bÙtom_poc
 = 
p_Vid
->
bÙtompoc
 = 0;

1888 
FRAME
:

1890 
p
->
tÝ_poc
 -ðp->
poc
;

1891 
p
->
bÙtom_poc
 -ðp->
poc
;

1893 
p_Vid
->
tÝpoc
 = 
p
->
tÝ_poc
;

1894 
p_Vid
->
bÙtompoc
 = 
p
->
bÙtom_poc
;

1896 
p
->
poc
 = 
	`imš
 (p->
tÝ_poc
,…->
bÙtom_poc
);

1897 
p_Vid
->
äam•oc
 = 
p
->
poc
;

1901 
p_Vid
->
ThisPOC
 = 
p
->
poc
;

1902 
	`æush_dpb
(
p_Vid
->
p_Dpb_Ïy”
[0], 
ouut
);

1903 if(
p_Vid
->
num_of_Ïy”s
 >1)

1904 
	`æush_dpb
(
p_Vid
->
p_Dpb_Ïy”
[1], 
ouut
);

1906 
	}
}

1927 
	$¡Üe_piùu»_š_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
)

1929 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

1930 
i
;

1931 
poc
, 
pos
;

1936 
	`as£¹
 (
p
!=
NULL
);

1938 
p
->
Ùf_æag
 = 
p_Vid
->
p_IÅ
->
OnTheFlyF¿ùMCP
 ;

1940 
p
->
u£d_fÜ_»ã»nû
 = (
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
);

1942 
p
->
ty³
 = 
p_Vid
->type;

1944 #ià(
MVC_EXTENSION_ENABLE
)

1945 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

1947 
p
->
v›w_id
 = 
p_Vid
->view_id;

1949 if(
p
->
¡ruùu»
==
FRAME
)

1951 
p
->
š‹r_v›w_æag
[0] =…->š‹r_v›w_æag[1] = 
p_Vid
->inter_view_flag[0];

1952 
p
->
ªchÜ_pic_æag
[0] =…->ªchÜ_pic_æag[1] = 
p_Vid
->anchor_pic_flag[0];

1956 if(
p
->
¡ruùu»
==
TOP_FIELD
)

1958 
p
->
š‹r_v›w_æag
[0] = 
p_Vid
->inter_view_flag[0];

1959 
p
->
ªchÜ_pic_æag
[0] = 
p_Vid
->anchor_pic_flag[0];

1963 
p
->
š‹r_v›w_æag
[1] = 
p_Vid
->inter_view_flag[1];

1964 
p
->
ªchÜ_pic_æag
[1] = 
p_Vid
->anchor_pic_flag[1];

1968 if(
p_Vid
->
v›w_id
 == 0)

1970 
	`´oûss_piùu»_š_dpb_s
(
p_Vid
, 
p
);

1971 
p_Vid
->
´oc_piùu»
 = 
	`þÚe_¡ÜabË_piùu»
Õ_Vid, 
p
);

1976 
p_Vid
->
Ï¡_has_mmco_5
 = 0;

1977 
p_Vid
->
Ï¡_pic_bÙtom_f›ld
 = (p_Vid->
¡ruùu»
 =ð
BOTTOM_FIELD
);

1979 ià(
p_Vid
->
cu¼’tPiùu»
->
idr_æag
)

1981 
	`idr_memÜy_mªagem’t
(
p_Dpb
, 
p
, 
ouut
);

1982 if(
p_Vid
->
num_of_Ïy”s
 > 1)

1983 
	`idr_memÜy_mªagem’t
(
p_Vid
->
p_Dpb_Ïy”
[1], 
p
, 
ouut
);

1988 ià(
p
->
u£d_fÜ_»ã»nû
 && (
p_Vid
->
ad­tive_»f_pic_bufãršg_æag
))

1989 
	`ad­tive_memÜy_mªagem’t
(
p_Dpb
, 
p
, 
ouut
);

1992 ià((
p
->
¡ruùu»
==
TOP_FIELD
)||Õ->¡ruùu»==
BOTTOM_FIELD
))

1995 ià(
p_Dpb
->
Ï¡_piùu»
)

1997 ià(()
p_Dpb
->
Ï¡_piùu»
->
äame_num
 =ð
p
->
pic_num
)

1999 ià(((
p
->
¡ruùu»
==
TOP_FIELD
)&&(
p_Dpb
->
Ï¡_piùu»
->
is_u£d
==2))||(Õ->¡ruùu»==
BOTTOM_FIELD
)&&(p_Dpb->last_picture->is_used==1)))

2001 ià((
p
->
u£d_fÜ_»ã»nû
 && (
p_Dpb
->
Ï¡_piùu»
->
is_Üig_»ã»nû
!=0))||

2002 (!
p
->
u£d_fÜ_»ã»nû
 && (
p_Dpb
->
Ï¡_piùu»
->
is_Üig_»ã»nû
==0)))

2004 
	`š£¹_piùu»_š_dpb
(
p_Vid
, 
p_Dpb
->
Ï¡_piùu»
, 
p
);

2005 
	`upd©e_»f_li¡
(
p_Dpb
);

2006 
	`upd©e_É»f_li¡
(
p_Dpb
);

2007 #ià(
DUMP_DPB
)

2008 
	`´štf
("\nstore_picture_in_dpb inserting complementary field\n");

2010 
	`dump_dpb
(
p_Dpb
);

2011 
p_Dpb
->
Ï¡_piùu»
 = 
NULL
;

2022 ià((!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
è&& (
p
->
u£d_fÜ_»ã»nû
 && (!p_Vid->
ad­tive_»f_pic_bufãršg_æag
)))

2024 
	`¦idšg_wšdow_memÜy_mªagem’t
(
p_Dpb
, 
p
);

2028 ià(
p_Dpb
->
u£d_size
 =ðp_Dpb->
size
)

2030 
	`»move_unu£d_äame_äom_dpb
(
p_Dpb
);

2034 
p_Dpb
->
u£d_size
 =ðp_Dpb->
size
)

2037 ià(!
p
->
u£d_fÜ_»ã»nû
)

2039 
	`g‘_sm®Ë¡_poc
(
p_Dpb
, &
poc
, &
pos
);

2041 #ià(
MVC_EXTENSION_ENABLE
)

2042 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

2044 ià(((-1==
pos
è|| (
p
->
poc
 <…oc)))

2046 
	`dœeù_ouut
(
p_Vid
, 
p
, 
ouut
, (
p_Dpb
->
Ïy”_id
 ?…_Vid->
p_dec2
:…_Vid->
p_dec
));

2053 ià((-1==
pos
è|| (
p
->
poc
 <…oc))

2055 
	`dœeù_ouut
(
p_Vid
, 
p
, 
ouut
,…_Vid->
p_dec
);

2061 
	`ouut_Úe_äame_äom_dpb
(
p_Dpb
, 
ouut
);

2065 ià((
p
->
u£d_fÜ_»ã»nû
)&&(!p->
is_lÚg_‹rm
))

2067 
i
=0; i<
p_Dpb
->
»f_äames_š_bufãr
; i++)

2069 ià(
p_Dpb
->
fs_»f
[
i
]->
äame_num
 =ð
p
->frame_num)

2071 
	`”rÜ
("duplicate frame_num in short-term„eference…icture buffer", 500);

2076 
	`š£¹_piùu»_š_dpb
(
p_Vid
, 
p_Dpb
->
fs
[p_Dpb->
u£d_size
],
p
);

2078 ià(
p
->
¡ruùu»
 !ð
FRAME
)

2080 
p_Dpb
->
Ï¡_piùu»
 =…_Dpb->
fs
[p_Dpb->
u£d_size
];

2084 
p_Dpb
->
Ï¡_piùu»
 = 
NULL
;

2087 
p_Dpb
->
u£d_size
++;

2089 
	`upd©e_»f_li¡
(
p_Dpb
);

2090 
	`upd©e_É»f_li¡
(
p_Dpb
);

2092 
	`check_num_»f
(
p_Dpb
);

2093 #ià(
DUMP_DPB
)

2094 
	`´štf
("\nEnd of store_picture_in_dpb\n");

2096 
	`dump_dpb
(
p_Dpb
);

2097 
	}
}

2099 #ià(
MVC_EXTENSION_ENABLE
)

2116 
	$»¶aû_tÝ_´oc_pic_w™h_äame
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
)

2118 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

2119 
StÜabËPiùu»
 *
´oc_piùu»
 = 
p_Vid
->proc_picture;

2120 
F¿meStÜe
* 
fs
 = 
NULL
;

2121 
found
;

2123 
	`as£¹
 (
p
!=
NULL
);

2124 
	`as£¹
 (
p
->
¡ruùu»
==
FRAME
);

2125 
	`as£¹
 (
´oc_piùu»
==
NULL
);

2126 
	`as£¹
 (
p_Vid
->
p_IÅ
->
ProfžeIDC
 <=
STEREO_HIGH
);

2127 
	`´oûss_piùu»_š_dpb_s
(
p_Vid
, 
p
);

2128 
´oc_piùu»
 = 
	`þÚe_¡ÜabË_piùu»
(
p_Vid
, 
p
);

2130 
´oc_piùu»
->
u£d_fÜ_»ã»nû
 = (
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
);

2131 
´oc_piùu»
->
ty³
 = 
p_Vid
->type;

2132 
p_Vid
->
Ï¡_has_mmco_5
=0;

2133 
p_Vid
->
Ï¡_pic_bÙtom_f›ld
 = (p_Vid->
¡ruùu»
 =ð
BOTTOM_FIELD
);

2136 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2138 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
´oc_piùu»
);

2139 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
´oc_piùu»
);

2140 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
´oc_piùu»
);

2144 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
´oc_piùu»
);

2145 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2146 
	`G’”©eHMELay”s
(
p_Vid
, 
´oc_piùu»
);

2149 
found
=0;

2151 if(
p_Dpb
->
fs_ž»f
[0] && (p_Dpb->fs_ž»f[0]->
äame_num
 =ð
p_Vid
->äame_numè&& (p_Dpb->fs_ž»f[0]->
is_u£d
 == 1))

2153 
found
 = 1;

2154 
fs
 = 
p_Dpb
->
fs_ž»f
[0];

2157 ià(!
found
)

2159 
	`´štf
("replace_top_proc_pic_with_frame: Warning! Reference…rocessed field‚ot found. Processed frame‚ot inserted in DPB\n");

2160 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
´oc_piùu»
);

2164 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2165 
fs
->
tÝ_f›ld
=
NULL
;

2166 
fs
->
äame
=
´oc_piùu»
;

2167 
fs
->
is_u£d
 = 3;

2168 ià(
p
->
u£d_fÜ_»ã»nû
)

2170 
fs
->
is_»ã»nû
 = 3;

2171 ià(
p
->
is_lÚg_‹rm
)

2173 
fs
->
is_lÚg_‹rm
 = 3;

2177 
	`dpb_¥l™_f›ld
(
p_Vid
, 
fs
);

2178 
fs
->
tÝ_f›ld
->
v›w_id
 = fs->
bÙtom_f›ld
->v›w_id = fs->
äame
->view_id;

2179 
	`upd©e_»f_li¡
(
p_Dpb
);

2180 
	`upd©e_É»f_li¡
(
p_Dpb
);

2183 
p_Vid
->
´oc_piùu»
 = 
NULL
;

2184 
	}
}

2202 
	$»¶aû_tÝ_pic_w™h_äame
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
)

2204 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

2205 
F¿meStÜe
* 
fs
 = 
NULL
;

2206 
i
, 
found
;

2208 
	`as£¹
 (
p
!=
NULL
);

2209 
	`as£¹
 (
p
->
¡ruùu»
==
FRAME
);

2211 
p
->
u£d_fÜ_»ã»nû
 = (
p_Vid
->
Çl_»ã»nû_idc
 !ð
NALU_PRIORITY_DISPOSABLE
);

2212 
p
->
ty³
 = 
p_Vid
->type;

2215 #ià(
MVC_EXTENSION_ENABLE
)

2216 ià(
p
->
u£d_fÜ_»ã»nû
 || (
p_Vid
->
p_IÅ
->
num_of_v›ws
==2 &&…_Vid->
v›w_id
 == 0))

2218 ià(
p
->
u£d_fÜ_»ã»nû
)

2221 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2223 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
p
);

2224 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
p
);

2225 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
p
);

2229 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
p
);

2230 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2231 
	`G’”©eHMELay”s
(
p_Vid
, 
p
);

2235 
found
=0;

2237 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

2239 if((
p_Dpb
->
fs
[
i
]->
äame_num
 =ð
p_Vid
->äame_numè&& (p_Dpb->fs[i]->
is_u£d
 == 1))

2241 
found
=1;

2242 
fs
 = 
p_Dpb
->fs[
i
];

2247 #ià(
MVC_EXTENSION_ENABLE
)

2248 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2)

2250 ià(
p_Dpb
->
Ïy”_id
 == 0)

2252 
	`»¶aû_tÝ_´oc_pic_w™h_äame
(
p_Vid
->
p_Dpb_Ïy”
[1], 
p
);

2257 ià(!
found
)

2260 #ià(
MVC_EXTENSION_ENABLE
)

2261 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
 == 2)

2263 ià(
p_Dpb
->
Ïy”_id
 == 0)

2264 
	`dœeù_ouut_·ff
(
p_Vid
, 
p
, 
ouut
,…_Vid->
p_dec
);

2266 
	`dœeù_ouut_·ff
(
p_Vid
, 
p
, 
ouut
,…_Vid->
p_dec2
);

2270 
	`dœeù_ouut_·ff
(
p_Vid
, 
p
, 
ouut
,…_Vid->
p_dec
);

2274 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2275 
fs
->
tÝ_f›ld
 = 
NULL
;

2276 
fs
->
äame
 = 
p
;

2277 
fs
->
is_u£d
 = 3;

2278 ià(
p
->
u£d_fÜ_»ã»nû
)

2280 
fs
->
is_»ã»nû
 = 3;

2281 ià(
p
->
is_lÚg_‹rm
)

2283 
fs
->
is_lÚg_‹rm
 = 3;

2287 
	`dpb_¥l™_f›ld
(
p_Vid
, 
fs
);

2288 
	`upd©e_»f_li¡
(
p_Dpb
);

2289 
	`upd©e_É»f_li¡
(
p_Dpb
);

2291 #ià(
DUMP_DPB
)

2292 
	`´štf
("\nReplace Top…ic with Frame\n");

2293 
	`dump_dpb
(
p_Dpb
);

2295 
	}
}

2313 
	$š£¹_piùu»_š_dpb
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
* 
fs
, 
StÜabËPiùu»
* 
p
)

2316 
	`as£¹
 (
p
!=
NULL
);

2317 
	`as£¹
 (
fs
!=
NULL
);

2320 ià(
p
->
u£d_fÜ_»ã»nû
)

2322 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2324 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
p
);

2325 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
p
);

2326 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
p
);

2330 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
p
);

2331 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2333 
	`G’”©eHMELay”s
(
p_Vid
, 
p
);

2337 #ià(
MVC_EXTENSION_ENABLE
)

2338 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2 && 
p
->
š‹r_v›w_æag
[p->
¡ruùu»
>>1])

2340 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
p
);

2341 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2342 
	`G’”©eHMELay”s
(
p_Vid
, 
p
);

2346 
p
->
¡ruùu»
)

2348 
FRAME
:

2349 
fs
->
äame
 = 
p
;

2350 
fs
->
is_u£d
 = 3;

2351 ià(
p
->
u£d_fÜ_»ã»nû
)

2353 
fs
->
is_»ã»nû
 = 3;

2354 
fs
->
is_Üig_»ã»nû
 = 3;

2355 ià(
p
->
is_lÚg_‹rm
)

2357 
fs
->
is_lÚg_‹rm
 = 3;

2358 
fs
->
lÚg_‹rm_äame_idx
 = 
p
->long_term_frame_idx;

2362 
	`dpb_¥l™_f›ld
(
p_Vid
, 
fs
);

2363 #ià(
MVC_EXTENSION_ENABLE
)

2364 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

2366 
fs
->
ªchÜ_pic_æag
[0] = fs->ªchÜ_pic_æag[1] = 
p
->anchor_pic_flag[0];

2367 
fs
->
š‹r_v›w_æag
[0] = fs->š‹r_v›w_æag[1] = 
p
->inter_view_flag[0];

2369 ià(
fs
->
tÝ_f›ld
)

2371 
fs
->
tÝ_f›ld
->
v›w_id
 = 
p
->view_id;

2373 ià(
fs
->
bÙtom_f›ld
)

2375 
fs
->
bÙtom_f›ld
->
v›w_id
 = 
p
->view_id;

2379 
TOP_FIELD
:

2380 
fs
->
tÝ_f›ld
 = 
p
;

2381 
fs
->
is_u£d
 |= 1;

2382 ià(
p
->
u£d_fÜ_»ã»nû
)

2384 
fs
->
is_»ã»nû
 |= 1;

2385 
fs
->
is_Üig_»ã»nû
 |= 1;

2386 ià(
p
->
is_lÚg_‹rm
)

2388 
fs
->
is_lÚg_‹rm
 |= 1;

2389 
fs
->
lÚg_‹rm_äame_idx
 = 
p
->long_term_frame_idx;

2392 ià(
fs
->
is_u£d
 == 3)

2395 
	`dpb_combše_f›ld
(
p_Vid
, 
fs
);

2399 
fs
->
poc
 = 
p
->poc;

2400 
	`g’_f›ld_»f_ids
(
p
);

2402 #ià(
MVC_EXTENSION_ENABLE
)

2403 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

2405 
fs
->
ªchÜ_pic_æag
[0] = 
p
->anchor_pic_flag[0];

2406 
fs
->
š‹r_v›w_æag
[0] = 
p
->inter_view_flag[0];

2408 
fs
->
tÝ_f›ld
->
v›w_id
 = 
p
->view_id;

2411 
BOTTOM_FIELD
:

2412 
fs
->
bÙtom_f›ld
 = 
p
;

2413 
fs
->
is_u£d
 |= 2;

2414 ià(
p
->
u£d_fÜ_»ã»nû
)

2416 
fs
->
is_»ã»nû
 |= 2;

2417 
fs
->
is_Üig_»ã»nû
 |= 2;

2418 ià(
p
->
is_lÚg_‹rm
)

2420 
fs
->
is_lÚg_‹rm
 |= 2;

2421 
fs
->
lÚg_‹rm_äame_idx
 = 
p
->long_term_frame_idx;

2424 ià(
fs
->
is_u£d
 == 3)

2427 
	`dpb_combše_f›ld
(
p_Vid
, 
fs
);

2428 #ià(
MVC_EXTENSION_ENABLE
)

2429 
fs
->
äame
->
v›w_id
 = 
p
->view_id;

2434 
fs
->
poc
 = 
p
->poc;

2435 
	`g’_f›ld_»f_ids
(
p
);

2437 #ià(
MVC_EXTENSION_ENABLE
)

2438 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

2440 
fs
->
ªchÜ_pic_æag
[1] = 
p
->anchor_pic_flag[1];

2441 
fs
->
š‹r_v›w_æag
[1] = 
p
->inter_view_flag[1];

2443 
fs
->
bÙtom_f›ld
->
v›w_id
 = 
p
->view_id;

2447 
fs
->
äame_num
 = 
p
->
pic_num
;

2448 
fs
->
is_ouut
 = 
p
->is_output;

2449 
fs
->
is_š‹r_Ïy”
 = 
FALSE
;

2451 #ià(
MVC_EXTENSION_ENABLE
)

2452 
fs
->
v›w_id
 = 
p
->view_id;

2454 
	}
}

2464 
	$»move_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
pos
)

2466 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

2467 
F¿meStÜe
* 
fs
 = 
p_Dpb
->fs[
pos
];

2468 
F¿meStÜe
* 
tmp
;

2469 
i
;

2472 
fs
->
is_u£d
)

2475 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
äame
);

2476 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2477 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

2478 
fs
->
äame
=
NULL
;

2479 
fs
->
tÝ_f›ld
=
NULL
;

2480 
fs
->
bÙtom_f›ld
=
NULL
;

2483 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

2484 
fs
->
bÙtom_f›ld
=
NULL
;

2487 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2488 
fs
->
tÝ_f›ld
=
NULL
;

2493 
	`”rÜ
("invalid frame storeype",500);

2495 
fs
->
is_u£d
 = 0;

2496 
fs
->
is_lÚg_‹rm
 = 0;

2497 
fs
->
is_»ã»nû
 = 0;

2498 
fs
->
is_Üig_»ã»nû
 = 0;

2501 
tmp
 = 
p_Dpb
->
fs
[
pos
];

2503 
i
=
pos
; i<
p_Dpb
->
u£d_size
-1;i++)

2505 
p_Dpb
->
fs
[
i
] =…_Dpb->fs[i+1];

2507 
p_Dpb
->
fs
[p_Dpb->
u£d_size
-1] = 
tmp
;

2508 
p_Dpb
->
u£d_size
--;

2509 
	}
}

2518 
	$æush_unu£d_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
)

2520 
i
;

2523 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

2525 ià(
p_Dpb
->
fs
[
i
]->
is_ouut
 && (!
	`is_u£d_fÜ_»ã»nû
(p_Dpb->fs[i])))

2527 
	`»move_äame_äom_dpb
(
p_Dpb
, 
i
);

2532 
	}
}

2542 
	$ouut_Úe_äame_äom_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
F¿meFÜm©
 *
ouut
)

2544 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

2545 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Dpb
->p_Inp;

2546 
poc
, 
pos
;

2548 ià(
p_Dpb
->
u£d_size
 < 1)

2550 
	`”rÜ
("Cannot output frame, DPBƒmpty.",150);

2554 
	`g‘_sm®Ë¡_poc
(
p_Dpb
, &
poc
, &
pos
);

2556 if(
pos
==-1)

2558 
	`”rÜ
("no frames for output‡vailable", 150);

2563 #ià(
MVC_EXTENSION_ENABLE
)

2564 if(
p_IÅ
->
num_of_v›ws
==2)

2566 if(
p_Dpb
->
fs
[
pos
]->
v›w_id
==1)

2567 
	`wr™e_¡Üed_äame
(
p_Vid
, 
p_Dpb
->
fs
[
pos
], 
ouut
,…_Vid->
p_dec2
);

2569 
	`wr™e_¡Üed_äame
(
p_Vid
, 
p_Dpb
->
fs
[
pos
], 
ouut
,…_Vid->
p_dec
);

2573 
	`wr™e_¡Üed_äame
(
p_Vid
, 
p_Dpb
->
fs
[
pos
], 
ouut
,…_Vid->
p_dec
);

2576 if(
p_IÅ
->
»dundªt_pic_æag
 == 0)

2578 ià(
p_Dpb
->
Ï¡_ouut_poc
 >ð
poc
)

2580 
	`”rÜ
 ("output POC must be in‡scending order", 150);

2583 
p_Dpb
->
Ï¡_ouut_poc
 = 
poc
;

2586 ià(!
	`is_u£d_fÜ_»ã»nû
(
p_Dpb
->
fs
[
pos
]))

2588 
	`»move_äame_äom_dpb
(
p_Dpb
, 
pos
);

2590 
	}
}

2600 
	$æush_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
F¿meFÜm©
 *
ouut
)

2602 
i
;

2609 
i
=0; i<
p_Dpb
->
u£d_size
; i++)

2611 
	`unm¬k_fÜ_»ã»nû
 (
p_Dpb
->
fs
[
i
]);

2614 
	`æush_unu£d_äame_äom_dpb
(
p_Dpb
)) ;

2617 
p_Dpb
->
u£d_size
)

2619 
	`ouut_Úe_äame_äom_dpb
(
p_Dpb
, 
ouut
);

2622 
p_Dpb
->
Ï¡_ouut_poc
 = 
INT_MIN
;

2623 #ià(
MVC_EXTENSION_ENABLE
)

2624 
p_Dpb
->
Ï¡_ouut_v›w_id
 = 0;

2626 
	}
}

2629 
	$g’_f›ld_»f_ids
(
StÜabËPiùu»
 *
p
)

2631 
i
,
j
;

2633 
i
 = 0; i < (
p
->
size_x
 >> 2); i++)

2635 
j
 = 0; j < (
p
->
size_y
 >> 2); j++)

2637 
p
->
mv_šfo
[
j
][
i
].
f›ld_äame
=1;

2640 
	}
}

2648 
	$dpb_¥l™_f›ld
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
)

2650 
i
, 
j
, 
k
, 
ii
, 
jj
, 
jj4
;

2651 
idiv
,
jdiv
;

2652 
cu¼’tmb
;

2654 
twosz16
 = 2 * (
fs
->
äame
->
size_x
 >> 4);

2655 
StÜabËPiùu»
 *
fs_tÝ
, *
fs_btm
;

2656 
StÜabËPiùu»
 *
äame
 = 
fs
->frame;

2658 
fs
->
poc
 = 
äame
->poc;

2660 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

2662 
fs_tÝ
 = 
fs
->
tÝ_f›ld
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, 
TOP_FIELD
, 
äame
->
size_x
, f¿me->
size_y
 >> 1, f¿me->
size_x_ü
, f¿me->
size_y_ü
 >> 1);

2663 
fs_btm
 = 
fs
->
bÙtom_f›ld
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, 
BOTTOM_FIELD
, 
äame
->
size_x
, f¿me->
size_y
 >> 1, f¿me->
size_x_ü
, f¿me->
size_y_ü
 >> 1);

2665 
i
 = 0; i < (
äame
->
size_y
 >> 1); i++)

2667 
	`memýy
(
fs_tÝ
->
imgY
[
i
], 
äame
->imgY[i*2], f¿me->
size_x
*(
img³l
));

2668 
	`memýy
(
fs_btm
->
imgY
[
i
], 
äame
->imgY[i*2 + 1], f¿me->
size_x
*(
img³l
));

2671 
k
 = 0; k < 2; k++)

2673 
i
=0; i< (
äame
->
size_y_ü
 >> 1); i++)

2675 
	`memýy
(
fs_tÝ
->
imgUV
[
k
][
i
], 
äame
->imgUV[k][i*2], f¿me->
size_x_ü
*(
img³l
));

2676 
	`memýy
(
fs_btm
->
imgUV
[
k
][
i
], 
äame
->imgUV[k][i*2 + 1], f¿me->
size_x_ü
*(
img³l
));

2679 if(
äame
->
u£d_fÜ_»ã»nû
)

2681 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2683 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
fs
->
tÝ_f›ld
);

2684 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
fs
->
tÝ_f›ld
);

2685 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
fs
->
tÝ_f›ld
);

2686 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
fs
->
bÙtom_f›ld
);

2687 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
fs
->
bÙtom_f›ld
);

2688 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
fs
->
bÙtom_f›ld
);

2692 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2693 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

2694 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2696 
	`G’”©eHMELay”s
(
p_Vid
, 
fs
->
tÝ_f›ld
);

2697 
	`G’”©eHMELay”s
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

2701 
fs
->
tÝ_f›ld
->
poc
 = 
äame
->
tÝ_poc
;

2702 
fs
->
bÙtom_f›ld
->
poc
 = 
äame
->
bÙtom_poc
;

2704 
fs
->
tÝ_f›ld
->
äame_poc
 = 
äame
->frame_poc;

2706 
fs
->
tÝ_f›ld
->
bÙtom_poc
 =fs->
bÙtom_f›ld
->bÙtom_poøð
äame
->bottom_poc;

2707 
fs
->
tÝ_f›ld
->
tÝ_poc
 =fs->
bÙtom_f›ld
->tÝ_poøð
äame
->top_poc;

2708 
fs
->
bÙtom_f›ld
->
äame_poc
 = 
äame
->frame_poc;

2710 
fs
->
tÝ_f›ld
->
u£d_fÜ_»ã»nû
 = fs->
bÙtom_f›ld
->used_for_reference

2711 ð
äame
->
u£d_fÜ_»ã»nû
;

2712 
fs
->
tÝ_f›ld
->
is_lÚg_‹rm
 = fs->
bÙtom_f›ld
->is_long_term

2713 ð
äame
->
is_lÚg_‹rm
;

2714 
fs
->
lÚg_‹rm_äame_idx
 = fs->
tÝ_f›ld
->long_term_frame_idx

2715 ð
fs
->
bÙtom_f›ld
->
lÚg_‹rm_äame_idx


2716 ð
äame
->
lÚg_‹rm_äame_idx
;

2718 
fs
->
tÝ_f›ld
->
coded_äame
 = fs->
bÙtom_f›ld
->coded_frame = 1;

2719 
fs
->
tÝ_f›ld
->
mb_aff_äame_æag
 = fs->
bÙtom_f›ld
->mb_aff_frame_flag

2720 ð
äame
->
mb_aff_äame_æag
;

2722 
äame
->
tÝ_f›ld
 = 
fs
->top_field;

2723 
äame
->
bÙtom_f›ld
 = 
fs
->bottom_field;

2724 
äame
->frame = frame;

2725 
fs
->
tÝ_f›ld
->
bÙtom_f›ld
 = fs->bottom_field;

2726 
fs
->
tÝ_f›ld
->
äame
 = fs->frame;

2727 
fs
->
tÝ_f›ld
->top_field = fs->top_field;

2728 
fs
->
bÙtom_f›ld
->
tÝ_f›ld
 = fs->top_field;

2729 
fs
->
bÙtom_f›ld
->
äame
 = frame;

2730 
fs
->
bÙtom_f›ld
->bottom_field = fs->bottom_field;

2732 
fs
->
tÝ_f›ld
->
chroma_fÜm©_idc
 = fs->
bÙtom_f›ld
->chroma_fÜm©_idøð
äame
->chroma_format_idc;

2733 
fs
->
tÝ_f›ld
->
chroma_mask_mv_x
 = fs->
bÙtom_f›ld
->chroma_mask_mv_x = 
äame
->chroma_mask_mv_x;

2734 
fs
->
tÝ_f›ld
->
chroma_mask_mv_y
 = fs->
bÙtom_f›ld
->chroma_mask_mv_y = 
äame
->chroma_mask_mv_y;

2735 
fs
->
tÝ_f›ld
->
chroma_shiá_x
 = fs->
bÙtom_f›ld
->chroma_shiá_x = 
äame
->chroma_shift_x;

2736 
fs
->
tÝ_f›ld
->
chroma_shiá_y
 = fs->
bÙtom_f›ld
->chroma_shiá_y = 
äame
->chroma_shift_y;

2739 
fs
->
tÝ_f›ld
->
Ùf_æag
 = fs->
bÙtom_f›ld
->Ùf_æag = 
äame
->otf_flag ;

2743 
fs
->
tÝ_f›ld
=
NULL
;

2744 
fs
->
bÙtom_f›ld
=
NULL
;

2745 
äame
->
tÝ_f›ld
=
NULL
;

2746 
äame
->
bÙtom_f›ld
=
NULL
;

2747 
äame
->frame = frame;

2751 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
 && 
fs
->
äame
->
mb_aff_äame_æag
)

2753 
j
=0 ; j< 
äame
->
size_y
 >> 3; j++)

2755 
jj
 = (
j
 >> 2)*8 + (j & 0x03);

2756 
jj4
 = 
jj
 + 4;

2757 
jdiv
 = (
j
 >> 1);

2758 
i
=0 ; i < (
äame
->
size_x
 >> 2); i++)

2760 
idiv
=
i
 >> 2;

2762 
cu¼’tmb
 = 
twosz16
*(
jdiv
 >> 1)+ (
idiv
)*2 + (jdiv & 0x01);

2764 ià(
fs
->
äame
->
mÙiÚ
.
mb_f›ld
[
cu¼’tmb
])

2766 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
f›ld_äame
 = fs->
tÝ_f›ld
->mv_info[j][i].field_frame=1;

2767 
fs
->
äame
->
mv_šfo
[2*
j
][
i
].
f›ld_äame
 = fs->frame->mv_info[2*j+1][i].field_frame = 1;

2769 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_0
] = fs->
äame
->mv_šfo[
jj4
][i].mv[LIST_0];

2770 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_1
] = fs->
äame
->mv_šfo[
jj4
][i].mv[LIST_1];

2771 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_0
] = fs->
äame
->mv_šfo[
jj4
][i].ref_idx[LIST_0];

2772 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_1
] = fs->
äame
->mv_šfo[
jj4
][i].ref_idx[LIST_1];

2774 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_0
] = fs->
äame
->mv_šfo[
jj
][i].mv[LIST_0];

2775 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_1
] = fs->
äame
->mv_šfo[
jj
][i].mv[LIST_1];

2776 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_0
] = fs->
äame
->mv_šfo[
jj
][i].ref_idx[LIST_0];

2777 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_1
] = fs->
äame
->mv_šfo[
jj
][i].ref_idx[LIST_1];

2784 ià(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

2786 
j
=0 ; j<
fs
->
äame
->
size_y
 >> 3 ; j++)

2788 
jj
 = 2* 
	`RSD
(
j
);

2789 
jdiv
 = 
j
 >> 1;

2790 
i
=0 ; i<
fs
->
äame
->
size_x
 >> 2 ; i++)

2792 
ii
 = 
	`RSD
(
i
);

2793 
idiv
 = 
i
 >> 2;

2795 
cu¼’tmb
 = 
twosz16
*(
jdiv
 >> 1)+ (
idiv
)*2 + (jdiv & 0x01);

2797 ià(!
fs
->
äame
->
mb_aff_äame_æag
 || !fs->äame->
mÙiÚ
.
mb_f›ld
[
cu¼’tmb
])

2799 
fs
->
äame
->
mv_šfo
[2*
j
+1][
i
].
f›ld_äame
 = fs->frame->mv_info[2*j][i].field_frame = 0;

2801 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
f›ld_äame
 = fs->
bÙtom_f›ld
->mv_info[j][i].field_frame = 0;

2803 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_0
] = fs->
bÙtom_f›ld
->mv_šfo[j][i].mv[LIST_0] = fs->
äame
->mv_šfo[
jj
][
ii
].mv[LIST_0];

2804 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
mv
[
LIST_1
] = fs->
bÙtom_f›ld
->mv_šfo[j][i].mv[LIST_1] = fs->
äame
->mv_šfo[
jj
][
ii
].mv[LIST_1];

2807 ià(
fs
->
äame
->
mv_šfo
[
jj
][
ii
].
»f_idx
[
LIST_0
] == -1)

2808 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_0
] = fs->
bÙtom_f›ld
->mv_info[j][i].ref_idx[LIST_0] = - 1;

2811 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_0
] = fs->
bÙtom_f›ld
->mv_šfo[j][i].»f_idx[LIST_0] = fs->
äame
->mv_šfo[
jj
][
ii
].ref_idx[LIST_0];

2814 ià(
fs
->
äame
->
mv_šfo
[
jj
][
ii
].
»f_idx
[
LIST_1
] == -1)

2815 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_1
] = fs->
bÙtom_f›ld
->mv_info[j][i].ref_idx[LIST_1] = - 1;

2818 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_1
] = fs->
bÙtom_f›ld
->mv_šfo[j][i].»f_idx[LIST_1] = fs->
äame
->mv_šfo[
jj
][
ii
].ref_idx[LIST_1];

2823 
fs
->
äame
->
mv_šfo
[2*
j
+1][
i
].
f›ld_äame
 = fs->äame->mv_šfo[2*j][i].f›ld_äameðfs->äame->
mÙiÚ
.
mb_f›ld
[
cu¼’tmb
];

2830 
j
=0 ; j<
fs
->
äame
->
size_y
 >> 2 ; j++)

2832 
i
=0 ; i<
fs
->
äame
->
size_x
 >> 2 ; i++)

2834 
äame
->
mv_šfo
[
j
][
i
].
f›ld_äame
 = 0;

2838 
	}
}

2848 
	$dpb_combše_f›ld_yuv
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
)

2850 
i
, 
j
;

2852 ià(!
fs
->
äame
)

2854 
fs
->
äame
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, 
FRAME
, fs->
tÝ_f›ld
->
size_x
, fs->tÝ_f›ld->
size_y
*2, fs->tÝ_f›ld->
size_x_ü
, fs->tÝ_f›ld->
size_y_ü
*2);

2857 
i
=0; i<
fs
->
tÝ_f›ld
->
size_y
; i++)

2859 
	`memýy
(
fs
->
äame
->
imgY
[
i
*2], fs->
tÝ_f›ld
->imgY[i] , fs->tÝ_f›ld->
size_x
 * (
img³l
));

2860 
	`memýy
(
fs
->
äame
->
imgY
[
i
*2 + 1], fs->
bÙtom_f›ld
->imgY[i], fs->bÙtom_f›ld->
size_x
 * (
img³l
));

2863 
j
 = 0; j < 2; j++)

2865 
i
=0; i<
fs
->
tÝ_f›ld
->
size_y_ü
; i++)

2867 
	`memýy
(
fs
->
äame
->
imgUV
[
j
][
i
*2], fs->
tÝ_f›ld
->imgUV[j][i], fs->tÝ_f›ld->
size_x_ü
*(
img³l
));

2868 
	`memýy
(
fs
->
äame
->
imgUV
[
j
][
i
*2 + 1], fs->
bÙtom_f›ld
->imgUV[j][i], fs->bÙtom_f›ld->
size_x_ü
*(
img³l
));

2872 
fs
->
poc
=fs->
äame
->poø=fs->äame->
äame_poc
 = 
	`imš
 (fs->
tÝ_f›ld
->poc, fs->
bÙtom_f›ld
->poc);

2874 
fs
->
bÙtom_f›ld
->
äame_poc
=fs->
tÝ_f›ld
->äame_poc=fs->
äame
->
poc
;

2876 
fs
->
bÙtom_f›ld
->
tÝ_poc
=fs->
äame
->tÝ_poc=fs->
tÝ_f›ld
->
poc
;

2877 
fs
->
tÝ_f›ld
->
bÙtom_poc
=fs->
äame
->bÙtom_poc=fs->
bÙtom_f›ld
->
poc
;

2879 
fs
->
äame
->
u£d_fÜ_»ã»nû
 = (fs->
tÝ_f›ld
->u£d_fÜ_»ã»nû && fs->
bÙtom_f›ld
->used_for_reference );

2880 
fs
->
äame
->
is_lÚg_‹rm
 = (fs->
tÝ_f›ld
->is_lÚg_‹rm && fs->
bÙtom_f›ld
->is_long_term );

2882 ià(
fs
->
äame
->
is_lÚg_‹rm
)

2883 
fs
->
äame
->
lÚg_‹rm_äame_idx
 = fs->long_term_frame_idx;

2885 
fs
->
äame
->
tÝ_f›ld
 = fs->top_field;

2886 
fs
->
äame
->
bÙtom_f›ld
 = fs->bottom_field;

2887 
fs
->
äame
->frame = fs->frame;

2889 
fs
->
äame
->
coded_äame
 = 0;

2891 
fs
->
äame
->
chroma_fÜm©_idc
 = fs->
tÝ_f›ld
->chroma_format_idc;

2892 
fs
->
äame
->
chroma_mask_mv_x
 = fs->
tÝ_f›ld
->chroma_mask_mv_x;

2893 
fs
->
äame
->
chroma_mask_mv_y
 = fs->
tÝ_f›ld
->chroma_mask_mv_y;

2894 
fs
->
äame
->
chroma_shiá_x
 = fs->
tÝ_f›ld
->chroma_shift_x;

2895 
fs
->
äame
->
chroma_shiá_y
 = fs->
tÝ_f›ld
->chroma_shift_y;

2897 
fs
->
äame
->
äame_üÝpšg_æag
 = fs->
tÝ_f›ld
->frame_cropping_flag;

2898 ià(
fs
->
äame
->
äame_üÝpšg_æag
)

2900 
fs
->
äame
->
äame_üÝ_tÝ_off£t
 = fs->
tÝ_f›ld
->frame_crop_top_offset;

2901 
fs
->
äame
->
äame_üÝ_bÙtom_off£t
 = fs->
tÝ_f›ld
->frame_crop_bottom_offset;

2902 
fs
->
äame
->
äame_üÝ_Ëá_off£t
 = fs->
tÝ_f›ld
->frame_crop_left_offset;

2903 
fs
->
äame
->
äame_üÝ_right_off£t
 = fs->
tÝ_f›ld
->frame_crop_right_offset;

2906 
fs
->
tÝ_f›ld
->
äame
 = fs->
bÙtom_f›ld
->frame = fs->frame;

2907 
fs
->
tÝ_f›ld
->top_field = fs->top_field;

2908 
fs
->
tÝ_f›ld
->
bÙtom_f›ld
 = fs->bottom_field;

2909 
fs
->
bÙtom_f›ld
->
tÝ_f›ld
 = fs->top_field;

2910 
fs
->
bÙtom_f›ld
->bottom_field = fs->bottom_field;

2913 
fs
->
äame
->
Ùf_æag
 = fs->
tÝ_f›ld
->otf_flag;

2914 
	}
}

2923 
	$dpb_combše_f›ld
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
)

2925 
i
,
j
, 
jj
, 
jj4
;

2927 
	`dpb_combše_f›ld_yuv
(
p_Vid
, 
fs
);

2928 ià(
fs
->
äame
->
u£d_fÜ_»ã»nû
)

2930 ifÐ(
p_Vid
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

2932 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 0, 
fs
->
äame
);

2933 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 1, 
fs
->
äame
);

2934 
	`Unif›dOÃFÜthPix_JV
(
p_Vid
, 2, 
fs
->
äame
);

2938 
	`Unif›dOÃFÜthPix
(
p_Vid
, 
fs
->
äame
);

2939 ià(
p_Vid
->
p_IÅ
->
HMEEÇbË
)

2940 
	`G’”©eHMELay”s
(
p_Vid
, 
fs
->
äame
);

2945 
j
=0 ; j<
fs
->
tÝ_f›ld
->
size_y
 >> 2 ; j++)

2947 
jj
 = 8*(
j
 >> 2) + (j & 0x03);

2948 
jj4
 = 
jj
 + 4;

2949 
i
=0 ; i<
fs
->
tÝ_f›ld
->
size_x
 >> 2 ; i++)

2951 
fs
->
äame
->
mv_šfo
[
jj
][
i
].
f›ld_äame
ðfs->äame->mv_šfo[
jj4
][i].field_frame = 1;

2953 
fs
->
äame
->
mv_šfo
[
jj
][
i
].
mv
[
LIST_0
] = fs->
tÝ_f›ld
->mv_šfo[
j
][i].mv[LIST_0];

2954 
fs
->
äame
->
mv_šfo
[
jj
][
i
].
mv
[
LIST_1
] = fs->
tÝ_f›ld
->mv_šfo[
j
][i].mv[LIST_1];

2956 
fs
->
äame
->
mv_šfo
[
jj4
][
i
].
mv
[
LIST_0
] = fs->
bÙtom_f›ld
->mv_šfo[
j
][i].mv[LIST_0];

2957 
fs
->
äame
->
mv_šfo
[
jj4
][
i
].
mv
[
LIST_1
] = fs->
bÙtom_f›ld
->mv_šfo[
j
][i].mv[LIST_1];

2959 
fs
->
tÝ_f›ld
->
mv_šfo
[
j
][
i
].
f›ld_äame
 = 1;

2960 
fs
->
bÙtom_f›ld
->
mv_šfo
[
j
][
i
].
f›ld_äame
 = 1;

2963 
	}
}

2972 
	$®loc_»f_pic_li¡_»Üd”šg_bufãr
(
Sliû
 *
cu¼Sliû
)

2974 
	`ä“_»f_pic_li¡_»Üd”šg_bufãr
(
cu¼Sliû
);

2976 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

2978 
size
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] + 1;

2979 ià((
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

2980 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer: modification_of_pic_nums_idc_l0");

2981 ià((
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

2982 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:‡bs_diff_pic_num_minus1_l0");

2983 ià((
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

2984 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:†ong_term_pic_idx_l0");

2985 #ià(
MVC_EXTENSION_ENABLE
)

2986 ià((
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_0
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

2987 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:‡bs_diff_view_idx_minus1_l0");

2992 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
] = 
NULL
;

2993 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
] = 
NULL
;

2994 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
] = 
NULL
;

2995 #ià(
MVC_EXTENSION_ENABLE
)

2996 
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_0
] = 
NULL
;

3000 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

3002 
size
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] + 1;

3003 ià((
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

3004 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer: modification_of_pic_nums_idc_l1");

3005 ià((
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

3006 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:‡bs_diff_pic_num_minus1_l1");

3007 ià((
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

3008 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:†ong_term_pic_idx_l1");

3009 #ià(
MVC_EXTENSION_ENABLE
)

3010 ià((
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_1
] = 
	`ÿÎoc
(
size
, ()))==
NULL
)

3011 
	`no_mem_ex™
("alloc_ref_pic_list_reordering_buffer:‡bs_diff_view_idx_minus1_l1");

3016 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
] = 
NULL
;

3017 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
] = 
NULL
;

3018 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
] = 
NULL
;

3019 #ià(
MVC_EXTENSION_ENABLE
)

3020 
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_1
] = 
NULL
;

3023 
	}
}

3032 
	$ä“_»f_pic_li¡_»Üd”šg_bufãr
(
Sliû
 *
cu¼Sliû
)

3034 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
])

3035 
	`ä“
(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
]);

3036 ià(
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
])

3037 
	`ä“
(
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
]);

3038 ià(
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
])

3039 
	`ä“
(
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
]);

3041 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
] = 
NULL
;

3042 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_0
] = 
NULL
;

3043 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_0
] = 
NULL
;

3045 ià(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
])

3046 
	`ä“
(
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
]);

3047 ià(
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
])

3048 
	`ä“
(
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
]);

3049 ià(
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
])

3050 
	`ä“
(
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
]);

3052 
cu¼Sliû
->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_1
] = 
NULL
;

3053 
cu¼Sliû
->
abs_diff_pic_num_mšus1
[
LIST_1
] = 
NULL
;

3054 
cu¼Sliû
->
lÚg_‹rm_pic_idx
[
LIST_1
] = 
NULL
;

3056 #ià(
MVC_EXTENSION_ENABLE
)

3057 ià(
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_0
])

3059 
	`ä“
(
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_0
]);

3060 
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_0
] = 
NULL
;

3062 ià(
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_1
])

3064 
	`ä“
(
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_1
]);

3065 
cu¼Sliû
->
abs_diff_v›w_idx_mšus1
[
LIST_1
] = 
NULL
;

3068 
	}
}

3084 
	$fžl_äame_num_g­
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
ouut
)

3086 
Cu¼F¿meNum
;

3087 
Unu£dShÜtT”mF¿meNum
;

3088 
StÜabËPiùu»
 *
piùu»
 = 
NULL
;

3089 
Çl_»f_idc_bak
 = 
p_Vid
->
Çl_»ã»nû_idc
;

3094 
p_Vid
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_LOW
;

3096 
Unu£dShÜtT”mF¿meNum
 = (
p_Vid
->
´e_äame_num
 + 1è%…_Vid->
max_äame_num
;

3097 
Cu¼F¿meNum
 = 
p_Vid
->
äame_num
;

3099 
Cu¼F¿meNum
 !ð
Unu£dShÜtT”mF¿meNum
)

3101 
piùu»
 = 
	`®loc_¡ÜabË_piùu»
 (
p_Vid
, 
FRAME
,…_Vid->
width
,…_Vid->
height
,…_Vid->
width_ü
,…_Vid->
height_ü
);

3102 
piùu»
->
coded_äame
 = 1;

3103 
piùu»
->
pic_num
 = 
Unu£dShÜtT”mF¿meNum
;

3104 
piùu»
->
nÚ_exi¡šg
 = 1;

3105 
piùu»
->
is_ouut
 = 1;

3107 
p_Vid
->
ad­tive_»f_pic_bufãršg_æag
 = 0;

3108 
	`¡Üe_piùu»_š_dpb
(
p_Vid
->
p_Dpb_Ïy”
[0], 
piùu»
, 
ouut
);

3109 
piùu»
=
NULL
;

3110 
Unu£dShÜtT”mF¿meNum
 = (Unu£dShÜtT”mF¿meNum + 1è% 
p_Vid
->
max_äame_num
;

3113 
p_Vid
->
Çl_»ã»nû_idc
 = 
Çl_»f_idc_bak
;

3114 
	}
}

3123 
	$compu‹_cÞoÿ‹d
(
Sliû
 *
cu¼Sliû
, 
StÜabËPiùu»
 **
li¡X
[6])

3125 
i
, 
j
;

3127 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

3129 ià(
cu¼Sliû
->
dœeù_¥©Ÿl_mv_´ed_æag
 == 0)

3131 
j
 = 0; j < 2 + (
cu¼Sliû
->
mb_aff_äame_æag
 * 4); j += 2)

3133 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
j
];i++)

3135 
´esÿË
, 
iTRb
, 
iTRp
;

3137 ià(
j
==0)

3139 
iTRb
 = 
	`iCl3
Ð-128, 127, 
p_Vid
->
’c_piùu»
->
poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->poc );

3141 ià(
j
 == 2)

3143 
iTRb
 = 
	`iCl3
Ð-128, 127, 
p_Vid
->
’c_piùu»
->
tÝ_poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->
poc
 );

3147 
iTRb
 = 
	`iCl3
Ð-128, 127, 
p_Vid
->
’c_piùu»
->
bÙtom_poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->
poc
 );

3150 
iTRp
 = 
	`iCl3
Ð-128, 127, 
li¡X
[
LIST_1
 + 
j
][0]->
poc
 -†i¡X[
LIST_0
 + j][
i
]->poc);

3152 ià(
iTRp
!=0)

3154 
´esÿË
 = ( 16384 + 
	`Ÿbs
Ð
iTRp
 / 2 ) ) / iTRp;

3155 
cu¼Sliû
->
mvsÿË
[
j
][
i
] = 
	`iCl3
Ð-1024, 1023, ( 
iTRb
 * 
´esÿË
 + 32 ) >> 6 ) ;

3159 
cu¼Sliû
->
mvsÿË
[
j
][
i
] = 9999;

3164 
	}
}

3167 
	$´oûss_piùu»_š_dpb_s
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p_pic
)

3171 
ImageD©a
 *
p_img_out
 = &
p_Vid
->
‹mpD©a3
;

3172 
ImageD©a
 
img_š
;

3173 
img³l
*** 
d_img
;

3174 
i
;

3176 
img_š
.
äm_¡ride
[0] = 
p_pic
->
size_x_·dded
;

3177 
img_š
.
äm_¡ride
[1] = img_š.äm_¡ride[2] = 
p_pic
->
size_x_ü
 + (p_pic->
·d_size_uv_x
 << 1);

3179 ià(
p_pic
->
¡ruùu»
 =ð
FRAME
)

3181 
img_š
.
äm_d©a
[0] = 
p_pic
->
imgY
;

3182 
img_š
.
äm_d©a
[1] = 
p_pic
->
imgUV
[0];

3183 
img_š
.
äm_d©a
[2] = 
p_pic
->
imgUV
[1];

3184 
img_š
.
tÝ_¡ride
[0] = img_š.
bÙ_¡ride
[0] = img_š.
äm_¡ride
[0] << 1;

3185 
img_š
.
tÝ_¡ride
[1] = img_š.
bÙ_¡ride
[1] = img_š.tÝ_¡ride[2] = img_š.bÙ_¡ride[2] = img_š.
äm_¡ride
[1] << 1;

3186 
d_img
 = 
p_img_out
->
äm_d©a
;

3190 
img_š
.
tÝ_¡ride
[0] = img_š.
bÙ_¡ride
[0] = img_š.
äm_¡ride
[0];

3191 
img_š
.
tÝ_¡ride
[1] = img_š.
bÙ_¡ride
[1] = img_š.tÝ_¡ride[2] = img_š.bÙ_¡ride[2] =img_š.
äm_¡ride
[1];

3192 ià(
p_pic
->
¡ruùu»
 =ð
TOP_FIELD
)

3194 
img_š
.
tÝ_d©a
[0] = 
p_pic
->
imgY
;

3195 
img_š
.
tÝ_d©a
[1] = 
p_pic
->
imgUV
[0];

3196 
img_š
.
tÝ_d©a
[2] = 
p_pic
->
imgUV
[1];

3197 
d_img
 = 
p_img_out
->
tÝ_d©a
;

3201 
img_š
.
bÙ_d©a
[0] = 
p_pic
->
imgY
;

3202 
img_š
.
bÙ_d©a
[1] = 
p_pic
->
imgUV
[0];

3203 
img_š
.
bÙ_d©a
[2] = 
p_pic
->
imgUV
[1];

3204 
d_img
 = 
p_img_out
->
bÙ_d©a
;

3208 
i
=0; i<
p_pic
->
size_y
; i++)

3209 
	`memýy
(
d_img
[0][
i
], 
p_pic
->
imgY
[i],…_pic->
size_x
*(
img³l
));

3210 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

3212 
i
=0; i<
p_pic
->
size_y_ü
; i++)

3213 
	`memýy
(
d_img
[1][
i
], 
p_pic
->
imgUV
[0][i],…_pic->
size_x_ü
 * (
img³l
));

3214 
i
=0; i<
p_pic
->
size_y_ü
; i++)

3215 
	`memýy
(
d_img
[2][
i
], 
p_pic
->
imgUV
[1][i],…_pic->
size_x_ü
 * (
img³l
));

3217 
	}
}

3225 
	$cÝy_¡ÜabË_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
s
, StÜabËPiùu» *
d
)

3227 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

3228 
ÅÏÃ
;

3229 
i
, 
j
;

3230 
size_x
 = 
s
->size_x;

3231 
size_y
 = 
s
->size_y;

3232 
size_x_ü
 = 
s
->size_x_cr;

3233 
size_y_ü
 = 
s
->size_y_cr;

3234 
img³l
*** 
s_img
;

3235 
	`check_v®ue
(
img³l
 **
pBufIn
, 
width
, 
height
, 
max
);

3238 ià(
s
->
¡ruùu»
 =ð
FRAME
)

3240 
s_img
 = 
p_Vid
->
‹mpD©a3
.
äm_d©a
;

3242 ià(
s
->
¡ruùu»
 =ð
TOP_FIELD
)

3244 
s_img
 = 
p_Vid
->
‹mpD©a3
.
tÝ_d©a
;

3248 
s_img
 = 
p_Vid
->
‹mpD©a3
.
bÙ_d©a
;

3251 
i
=0; i<
size_y
; i++)

3252 
	`memýy
((*)
d
->
imgY
[
i
], (*)
s_img
[0][i], 
size_x
 *  (
img³l
));

3254 
d
->
p_img
[0] = d->
imgY
;

3255 
d
->
p_cu¼_img
 = d->
p_img
[0];

3257 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

3260 
i
=0; i<
size_y_ü
; i++)

3261 
	`memýy
((*)
d
->
imgUV
[0][
i
], (*)
s_img
[1][i], 
size_x_ü
 *  (
img³l
));

3262 
i
=0; i<
size_y_ü
; i++)

3263 
	`memýy
((*)
d
->
imgUV
[1][
i
], (*)
s_img
[2][i], 
size_x_ü
 *  (
img³l
));

3265 
d
->
p_img
[1] = d->
imgUV
[0];

3266 
d
->
p_img
[2] = d->
imgUV
[1];

3269 
d
->
p_cu¼_img_sub
 = d->
p_img_sub
[0];

3270 
j
 = 0; j < (
size_y
 >> 
BLOCK_SHIFT
); j++)

3272 
i
 = 0; i < (
size_x
 >> 
BLOCK_SHIFT
); i++)

3274 
d
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_0
] = -1;

3275 
d
->
mv_šfo
[
j
][
i
].
»f_idx
[
LIST_1
] = -1;

3276 
d
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] = 
NULL
;

3277 
d
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_1
] = 
NULL
;

3281 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

3283  
ÅÏÃ
=0;‚¶ªe<
MAX_PLANE
;‚plane++ )

3285 
j
 = 0; j < (
size_y
 >> 
BLOCK_SHIFT
); j++)

3287 
i
 = 0; i < (
size_x
 >> 
BLOCK_SHIFT
); i++)

3289 
d
->
JVmv_šfo
[
ÅÏÃ
][
j
][
i
].
»f_idx
[
LIST_0
] = -1;

3290 
d
->
JVmv_šfo
[
ÅÏÃ
][
j
][
i
].
»f_idx
[
LIST_1
] = -1;

3296 
d
->
pic_num
 = 
s
->pic_num;

3297 
d
->
äame_num
 = 
s
->frame_num;

3298 
d
->
lÚg_‹rm_äame_idx
 = 
s
->long_term_frame_idx;

3299 
d
->
lÚg_‹rm_pic_num
 = 
s
->long_term_pic_num;

3300 
d
->
u£d_fÜ_»ã»nû
 = 
s
->used_for_reference;

3301 
d
->
is_lÚg_‹rm
 = 
s
->is_long_term;

3302 
d
->
nÚ_exi¡šg
 = 
s
->non_existing;

3303 
d
->
is_ouut
 = 1;

3304 
d
->
¡ruùu»
 = 
s
->structure;

3307 
d
->
tÝ_f›ld
 = 
NULL
;

3308 
d
->
bÙtom_f›ld
 = 
NULL
;

3309 
d
->
äame
 = 
NULL
;

3311 
d
->
coded_äame
 = 
s
->coded_frame;

3312 
d
->
mb_aff_äame_æag
 = 
s
->mb_aff_frame_flag;

3314 
	`memýy
Ð(*)&
d
->
¡©s
, (*)&
s
->¡©s, Ð
StP¬am‘”s
 ) );

3315 
d
->
¡©s
.
Numb”BF¿mes
 = 
s
->stats.NumberBFrames;

3316 
	}
}

3324 
StÜabËPiùu»
 * 
	$þÚe_¡ÜabË_piùu»
Ð
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p_pic
 )

3326 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

3327 
StÜabËPiùu»
 *
p_¡Üed_pic
;

3328 
Çl_»ã»nû_idc
ð
p_Vid
->nal_reference_idc;

3329 
p_Vid
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_HIGH
;

3330 
p_¡Üed_pic
 = 
	`®loc_¡ÜabË_piùu»
 (
p_Vid
, (
Piùu»SŒuùu»
èp_Vid->
¡ruùu»
, 
p_pic
->
size_x
,…_pic->
size_y
,…_pic->
size_x_ü
,…_pic->
size_y_ü
);

3331 
p_Vid
->
Çl_»ã»nû_idc
 =‚al_reference_idc;

3332 
p_¡Üed_pic
->
poc
 = 
p_Vid
->
äam•oc
;

3333 
p_¡Üed_pic
->
tÝ_poc
 = 
p_Vid
->
tÝpoc
;

3334 
p_¡Üed_pic
->
bÙtom_poc
 = 
p_Vid
->
bÙtompoc
;

3335 
p_¡Üed_pic
->
äame_poc
 = 
p_Vid
->
äam•oc
;

3336 
p_¡Üed_pic
->
pic_num
 = 
p_pic
->pic_num;

3337 
p_¡Üed_pic
->
äame_num
 = 
p_pic
->frame_num;

3338 
p_¡Üed_pic
->
coded_äame
 = 1;

3339 
p_¡Üed_pic
->
mb_aff_äame_æag
 = 
p_Vid
->mb_aff_äame_æag = (
BoÞ—n
è(
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_CODING
);

3341 
	`cÝy_·¿ms
(
p_Vid
, 
p_¡Üed_pic
,…_Vid->
aùive_¥s
);

3344 
	`cÝy_¡ÜabË_piùu»
(
p_Vid
, 
p_pic
, 
p_¡Üed_pic
);

3345 #ià(
MVC_EXTENSION_ENABLE
)

3347 
p_¡Üed_pic
->
š‹r_v›w_æag
[0] = 
p_pic
->inter_view_flag[0];

3348 
p_¡Üed_pic
->
š‹r_v›w_æag
[1] = 
p_pic
->inter_view_flag[1];

3349 
p_¡Üed_pic
->
ªchÜ_pic_æag
[0] =…_stored_pic->anchor_pic_flag[1] = 0;

3350 
p_¡Üed_pic
->
v›w_id
 = 0;

3353  
p_¡Üed_pic
;

3354 
	}
}

3368 #ià(
MVC_EXTENSION_ENABLE
)

3369 
	$¡Üe_´oc_piùu»_š_dpb
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
StÜabËPiùu»
* 
p
, 
F¿meFÜm©
 *
ouut
)

3371 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

3372 
F¿meStÜe
 *
fs
 = 
p_Dpb
->
fs_ž»f
[0];

3373 if(
p_Dpb
->
u£d_size_ž
>0 && 
fs
->
is_u£d
==3)

3376 #ifdeà
_DEBUG


3377 if(
p
->
¡ruùu»
==
FRAME
)

3378 
	`as£¹
(
fs
->
äame
->
äame_poc
 !ð
p
->
poc
);

3379 if(
p
->
¡ruùu»
==
TOP_FIELD
)

3380 
	`as£¹
(
fs
->
tÝ_f›ld
->
tÝ_poc
 !ð
p
->
poc
);

3381 if(
p
->
¡ruùu»
==
BOTTOM_FIELD
)

3382 
	`as£¹
(
fs
->
bÙtom_f›ld
->
bÙtom_poc
 !ð
p
->
poc
);

3384 if(
fs
->
äame
)

3386 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
äame
);

3387 
fs
->
äame
 = 
NULL
;

3389 if(
fs
->
tÝ_f›ld
)

3391 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

3392 
fs
->
tÝ_f›ld
 = 
NULL
;

3394 if(
fs
->
bÙtom_f›ld
)

3396 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

3397 
fs
->
bÙtom_f›ld
 = 
NULL
;

3399 
fs
->
is_u£d
 = 0;

3400 
fs
->
is_»ã»nû
 = 0;

3401 
fs
->
is_š‹r_Ïy”
 = 
TRUE
;

3402 
p_Dpb
->
u£d_size_ž
--;

3404 #ifdeà
_DEBUG


3405 if(
fs
->
is_u£d
>0)

3408 if(
p
->
¡ruùu»
==
FRAME
)

3409 
	`as£¹
(
fs
->
äame
 =ð
NULL
);

3410 if(
p
->
¡ruùu»
==
TOP_FIELD
)

3411 
	`as£¹
(
fs
->
tÝ_f›ld
 =ð
NULL
);

3412 if(
p
->
¡ruùu»
==
BOTTOM_FIELD
)

3413 
	`as£¹
(
fs
->
bÙtom_f›ld
 =ð
NULL
);

3417 
	`š£¹_piùu»_š_dpb
(
p_Vid
, 
fs
, 
p
);

3418 if((
p
->
¡ruùu»
==
FRAME
 && 
fs
->
is_u£d
 == 3) || (p->structure!=FRAME && fs->is_used && fs->is_used <3))

3419 
p_Dpb
->
u£d_size_ž
++;

3420 
	}
}

	@lencod/src/mc_prediction.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<¡dlib.h
>

18 
	~<as£¹.h
>

19 
	~<lim™s.h
>

20 
	~<m©h.h
>

22 
	~"glob®.h
"

23 
	~"block.h
"

25 
	~"maüoblock.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"»fbuf.h
"

28 
	~"image.h
"

29 
	~"mb_acûss.h
"

30 
	~"me_di¡ÜtiÚ.h
"

38 
šlše
 
	$weigh‹d_bi_´ediùiÚ
(
img³l
** 
mb_´ed
, img³l* 
l0´ed
, img³È*
l1´ed
,

39 
block_size_y
, 
block_x
, 
block_size_x
,

40 
max_img³l_v®ue
,

41 
wbp0
, 
wbp1
, 
off£t
, 
wp_round
, 
weight_d’om
)

43 
i
, 
j
;

44 
block_x4
 = 
block_x
 + 
block_size_x
;

46 
j
 = 0; j< 
block_size_y
; j++)

48 
i
=
block_x
; i<
block_x4
; i++)

49 
mb_´ed
[
j
][
i
] = (
img³l
è
	`iCl1
Ð
max_img³l_v®ue
,

50 ((
wbp0
 * *
l0´ed
++ + 
wbp1
 * *
l1´ed
++ + 
wp_round
è>> (
weight_d’om
)è+ 
off£t
);

52 
	}
}

60 
šlše
 
	$weigh‹d_mc_´ediùiÚ
(
img³l
** 
mb_´ed
, img³l* 
Í»d
,

61 
block_size_y
, 
block_x
, 
block_size_x
,

62 
max_img³l_v®ue
,

63 
wp
, 
off£t
, 
wp_round
, 
weight_d’om
)

65 
i
, 
j
;

66 
block_x4
 = 
block_x
 + 
block_size_x
;

68 
j
 = 0; j < 
block_size_y
; j++)

70 
i
=
block_x
; i<
block_x4
; i++)

71 
mb_´ed
[
j
][
i
] = (
img³l
è
	`iCl1
Ð
max_img³l_v®ue
,

72 ((
wp
 * *
Í»d
++ + 
wp_round
è>> 
weight_d’om
è+ 
off£t
);

74 
	}
}

82 
šlše
 
	$bi_´ediùiÚ
(
img³l
** 
mb_´ed
, img³l* 
l0´ed
, img³È*
l1´ed
,

83 
block_size_y
, 
block_x
, 
block_size_x
)

85 
i
, 
j
;

86 
block_x4
 = 
block_x
 + 
block_size_x
;

88 
j
 = 0; j < 
block_size_y
; j++)

90 
i
=
block_x
; i<
block_x4
; i++)

91 
mb_´ed
[
j
][
i
] = (*
l0´ed
++ + *
l1´ed
++ + 1) >> 1;

93 
	}
}

101 
šlše
 
	$mc_´ediùiÚ
(
img³l
** 
mb_´ed
, img³l* 
Í»d
, 
block_size_y
, 
block_x
, 
block_size_x
)

103 
j
;

104 
j
 = 0; j < 
block_size_y
; j++)

106 
	`memýy
(&(
mb_´ed
[
j
][
block_x
]), 
Í»d
, 
block_size_x
 * (
img³l
));

107 
Í»d
 +ð
block_size_x
;

109 
	}
}

117 
šlše
 
	$OÃCompÚ’tLumaP»diùiÚ
 ( 
VideoP¬am‘”s
 *
p_Vid
,

118 
img³l
* 
m´ed
,

119 
pic_pix_x
,

120 
pic_pix_y
,

121 
block_size_x
,

122 
block_size_y
,

123 
StÜabËPiùu»
 *
li¡


126 
j
;

127 
img³l
 *
»f_lše
 = 
	`UMVLše4X
 (
li¡
, 
pic_pix_y
, 
pic_pix_x
);

129 
j
 = 0; j < 
block_size_y
; j++)

131 
	`memýy
(
m´ed
, 
»f_lše
, 
block_size_x
 * (
img³l
));

132 
»f_lše
 +ð
p_Vid
->
·dded_size_x
;

133 
m´ed
 +ð
block_size_x
;

135 
	}
}

144 
	$luma_´ediùiÚ
 (
Maüoblock
* 
cu¼MB
,

145 
block_x
,

146 
block_y
,

147 
block_size_x
,

148 
block_size_y
,

149 
p_dœ
,

150 
li¡_mode
[2],

151 *
»f_idx
,

152 
b»d_me


155 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

156 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

157 
img³l
 
l0_´ed
[
MB_PIXELS
];

158 
img³l
 
l1_´ed
[
MB_PIXELS
];

160 
pic_Ýix_x
 = ((
cu¼MB
->
pix_x
 + 
block_x
) << 2);

161 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_y
 + 
block_y
) << 2);

162 
bx
 = 
block_x
 >> 2;

163 
by
 = 
block_y
 >> 2;

164 
MÙiÚVeùÜ
 ***** 
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
;

165 
MÙiÚVeùÜ
 *
cu¼_mv
 = 
NULL
;

166 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

168 
­¶y_weights
 = ( (
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1è|| (cu¼Sliû->weigh‹d_´ediùiÚ =ð2 && 
p_dœ
 == 2) );

170 ià(
b»d_me
 && 
»f_idx
[0] =ð0 &&„ef_idx[1] =ð0 && 
p_dœ
 =ð2 && 
	`is_b»d_’abËd
(
p_Vid
, 
li¡_mode
[0]) && is_bipred_enabled(p_Vid,†ist_mode[1]))

171 
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

173 
p_dœ
)

176 
cu¼_mv
 = &
mv_¬¿y
[
LIST_0
][(è
»f_idx
[LIST_0]][
li¡_mode
[LIST_0]][
by
][
bx
];

177 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l0_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
cu¼MB
->
li¡_off£t
][(è
»f_idx
[LIST_0]]);

180 
cu¼_mv
 = &
mv_¬¿y
[
LIST_1
][(è
»f_idx
[LIST_1]][
li¡_mode
[LIST_1]][
by
][
bx
];

181 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l1_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[LIST_1]]);

184 
cu¼_mv
 = &
mv_¬¿y
[
LIST_0
][(è
»f_idx
[LIST_0]][
li¡_mode
[LIST_0]][
by
][
bx
];

185 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l0_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[LIST_0]]);

186 
cu¼_mv
 = &
mv_¬¿y
[
LIST_1
][(è
»f_idx
[LIST_1]][
li¡_mode
[LIST_1]][
by
][
bx
];

187 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l1_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[LIST_1]]);

193 ià(
­¶y_weights
)

195 ià(
p_dœ
==2)

197 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

198 
p_Vid
->
max_img³l_v®ue
,

199 
cu¼Sliû
->
wbp_weight
[0][()
»f_idx
[0]][()ref_idx[1]][0], currSlice->wbp_weight[1][()ref_idx[0]][()ref_idx[1]][0],

200 (
cu¼Sliû
->
wp_off£t
[0][()
»f_idx
[0]][0] + currSlice->wp_offset[1][()ref_idx[1]][0] + 1)>>1,

201 (
cu¼Sliû
->
wp_luma_round
 << 1), cu¼Sliû->
luma_log_weight_d’om
 + 1);

203 ià(
p_dœ
==0)

205 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

206 
p_Vid
->
max_img³l_v®ue
,

207 
cu¼Sliû
->
wp_weight
[0][()
»f_idx
[0]][0], cu¼Sliû->
wp_off£t
[0][(ìef_idx[0]][0], cu¼Sliû->
wp_luma_round
, cu¼Sliû->
luma_log_weight_d’om
);

211 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

212 
p_Vid
->
max_img³l_v®ue
,

213 
cu¼Sliû
->
wp_weight
[1][()
»f_idx
[1]][0], cu¼Sliû->
wp_off£t
[1][(ìef_idx[1]][0], cu¼Sliû->
wp_luma_round
, cu¼Sliû->
luma_log_weight_d’om
);

218 ià(
p_dœ
==2)

220 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

222 ià(
p_dœ
==0)

224 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

228 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

231 
	}
}

239 
	$luma_´ediùiÚ_bi
 (
Maüoblock
* 
cu¼MB
,

240 
block_x
,

241 
block_y
,

242 
block_size_x
,

243 
block_size_y
,

244 
l0_mode
,

245 
l1_mode
,

246 
l0_»f_idx
,

247 
l1_»f_idx
,

248 
li¡


251 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

252 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

254 
img³l
 
l0_´ed
[
MB_PIXELS
];

255 
img³l
 
l1_´ed
[
MB_PIXELS
];

256 
pic_Ýix_x
 = ((
cu¼MB
->
pix_x
 + 
block_x
) << 2);

257 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_y
 + 
block_y
) << 2);

258 
bx
 = 
block_x
 >> 2;

259 
by
 = 
block_y
 >> 2;

261 
­¶y_weights
 = ( 
cu¼Sliû
->
weigh‹d_´ediùiÚ
 != 0 );

263 
MÙiÚVeùÜ
 *****
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
li¡
];

264 
MÙiÚVeùÜ
 *
mv_¬¿yl0
 = &
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
];

265 
MÙiÚVeùÜ
 *
mv_¬¿yl1
 = &
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
];

266 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

268 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l0_´ed
, 
pic_Ýix_x
 + 
mv_¬¿yl0
->
mv_x
, 
pic_Ýix_y
 + mv_¬¿yl0->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][
l0_»f_idx
]);

269 
	`OÃCompÚ’tLumaP»diùiÚ
 (
p_Vid
, 
l1_´ed
, 
pic_Ýix_x
 + 
mv_¬¿yl1
->
mv_x
, 
pic_Ýix_y
 + mv_¬¿yl1->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][
l1_»f_idx
]);

271 ià(
­¶y_weights
)

273 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

274 
p_Vid
->
max_img³l_v®ue
,

275 
cu¼Sliû
->
wbp_weight
[0][
l0_»f_idx
][
l1_»f_idx
][0], currSlice->wbp_weight[1][l0_ref_idx][l1_ref_idx][0],

276 (
cu¼Sliû
->
wp_off£t
[0][
l0_»f_idx
][0] + cu¼Sliû->wp_off£t[1][
l1_»f_idx
][0] + 1)>>1,

277 (
cu¼Sliû
->
wp_luma_round
 << 1), cu¼Sliû->
luma_log_weight_d’om
 + 1);

281 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

283 
	}
}

292 
	$OÃCompÚ’tChromaP»diùiÚ4x4_»g’”©e
 (

293 
Maüoblock
 *
cu¼MB
,

294 
img³l
* 
m´ed
,

295 
block_c_x
,

296 
block_c_y
,

297 
MÙiÚVeùÜ
 **
mv
,

298 
StÜabËPiùu»
 *
li¡
,

299 
uv
)

301 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

302 
i
, 
j
, 
ii
, 
jj
, 
ii0
, 
jj0
, 
ii1
, 
jj1
, 
if0
, 
if1
, 
jf0
, 
jf1
;

303 
MÙiÚVeùÜ
 *
mvb
;

305 
f1_x
 = 64/
p_Vid
->
mb_ü_size_x
;

306 
f2_x
=
f1_x
-1;

308 
f1_y
 = 64/
p_Vid
->
mb_ü_size_y
;

309 
f2_y
=
f1_y
-1;

311 
f3
=
f1_x
*
f1_y
, 
f4
=f3>>1;

312 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

313 
max_y_ü
 = (è(
li¡_off£t
 ? (
p_Vid
->
height_ü
 >> 1) - 1 :…_Vid->height_cr - 1);

314 
max_x_ü
 = (è(
p_Vid
->
width_ü
 - 1);

315 
jjx
, 
iix
;

316 
mb_ü_y_div4
 = 
p_Vid
->
mb_ü_size_y
>>2;

317 
mb_ü_x_div4
 = 
p_Vid
->
mb_ü_size_x
>>2;

318 
jpos
;

320 
img³l
** 
»fimage
 = 
li¡
->
imgUV
[
uv
];

322 
j
=
block_c_y
; j < block_c_y + 
BLOCK_SIZE
; j++)

324 
jjx
 = 
j
/
mb_ü_y_div4
;

325 
jpos
 = (
j
 + 
cu¼MB
->
Ýix_c_y
)*
f1_y
;

327 
i
=
block_c_x
; i < block_c_x + 
BLOCK_SIZE
; i++)

329 
iix
 = 
i
/
mb_ü_x_div4
;

330 
mvb
 = &
mv
 [
jjx
][
iix
];

332 
ii
 = (
i
 + 
cu¼MB
->
pix_c_x
)*
f1_x
 + 
mvb
->
mv_x
;

333 
jj
 = 
jpos
 + 
mvb
->
mv_y
;

335 ià(
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 == 1)

336 
jj
 +ð
li¡
->
chroma_veùÜ_adju¡m’t
;

338 
ii0
 = 
	`iCl3
 (0, 
max_x_ü
, 
ii
/
f1_x
);

339 
jj0
 = 
	`iCl3
 (0, 
max_y_ü
, 
jj
/
f1_y
);

340 
ii1
 = 
	`iCl3
 (0, 
max_x_ü
, (
ii
+
f2_x
)/
f1_x
);

341 
jj1
 = 
	`iCl3
 (0, 
max_y_ü
, (
jj
+
f2_y
)/
f1_y
);

343 
if1
 = (
ii
&
f2_x
); 
if0
 = 
f1_x
-if1;

344 
jf1
 = (
jj
&
f2_y
); 
jf0
 = 
f1_y
-jf1;

346 *
m´ed
++ = (
img³l
) (

347 (
if0
 * 
jf0
 * 
»fimage
[
jj0
][
ii0
] +

348 
if1
 * 
jf0
 * 
»fimage
[
jj0
][
ii1
] +

349 
if0
 * 
jf1
 * 
»fimage
[
jj1
][
ii0
] +

350 
if1
 * 
jf1
 * 
»fimage
[
jj1
][
ii1
] + 
f4
è/ 
f3
);

353 
	}
}

361 
	$OÃCompÚ’tChromaP»diùiÚ4x4_»Œ›ve
 (

362 
Maüoblock
 *
cu¼MB
,

363 
img³l
* 
m´ed
,

364 
block_c_x
,

365 
block_c_y
,

366 
MÙiÚVeùÜ
 **
mv
,

367 
StÜabËPiùu»
 *
li¡
,

368 
uv
)

370 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

371 
j
, 
ii
, 
jj
;

372 
MÙiÚVeùÜ
* 
mvb
;

374 
jjx
;

375 
right_shiá_x
 = 4 - 
p_Vid
->
chroma_shiá_x
;

376 
right_shiá_y
 = 4 - 
p_Vid
->
chroma_shiá_y
;

377 
jpos
;

379 
pos_x1
 = 
block_c_x
 >> 
right_shiá_x
;

380 
pos_x2
 = (
block_c_x
 + 2è>> 
right_shiá_x
;

382 
os1
 = ((
block_c_x
 + 
cu¼MB
->
pix_c_x
 ) << 
p_Vid
->
chroma_shiá_x
);

383 
os2
 = ((
block_c_x
 + 
cu¼MB
->
pix_c_x
 + 2è<< 
p_Vid
->
chroma_shiá_x
);

384 
jj_chroma
 = ((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð1è? 
li¡
->
chroma_veùÜ_adju¡m’t
 : 0);

386 
img³l
 *
lše_±r
 = 
NULL
;

388 
j
=
block_c_y
; j < block_c_y + 
BLOCK_SIZE
; j++)

390 
jjx
 = 
j
 >> 
right_shiá_y
;

392 
jpos
 = ( (
j
 + 
cu¼MB
->
Ýix_c_y
è<< 
p_Vid
->
chroma_shiá_y
 ) + 
jj_chroma
;

394 
mvb
 = &
mv
 [
jjx
][
pos_x1
];

396 
ii
 = 
os1
 + 
mvb
->
mv_x
;

397 
jj
 = 
jpos
 + 
mvb
->
mv_y
;

399 
lše_±r
 = 
	`UMVLše8X_chroma
 ( 
li¡
, 
uv
 + 1, 
jj
, 
ii
);

400 *
m´ed
++ = *
lše_±r
++;

401 *
m´ed
++ = *
lše_±r
;

403 
mvb
 = &
mv
 [
jjx
][
pos_x2
];

405 
ii
 = 
os2
 + 
mvb
->
mv_x
;

406 
jj
 = 
jpos
 + 
mvb
->
mv_y
;

408 
lše_±r
 = 
	`UMVLše8X_chroma
 ( 
li¡
, 
uv
 + 1, 
jj
, 
ii
);

409 *
m´ed
++ = *
lše_±r
++;

410 *
m´ed
++ = *
lše_±r
;

412 
	}
}

421 
šlše


422 
	$OÃCompÚ’tChromaP»diùiÚ
 (
VideoP¬am‘”s
 *
p_Vid
,

423 
img³l
* 
m´ed
,

424 
pic_pix_x
,

425 
pic_pix_y
,

426 
block_size_x
,

427 
block_size_y
,

428 
StÜabËPiùu»
 *
li¡
,

429 
uv
)

431 
j
;

432 
img³l
 *
»f_lše
 = 
	`UMVLše4Xü
 (
li¡
, 
uv
 + 1, 
pic_pix_y
, 
pic_pix_x
);

434 
j
 = 0; j < 
block_size_y
; j++)

436 
	`memýy
(
m´ed
, 
»f_lše
, 
block_size_x
 * (
img³l
));

437 
»f_lše
 +ð
p_Vid
->
ü_·dded_size_x
;

438 
m´ed
 +ð
block_size_x
;

440 
	}
}

448 
	$IÁ¿ChromaP»diùiÚ4x4
 (
Maüoblock
* 
cu¼MB
,

449 
uv
,

450 
block_x
,

451 
block_y
)

453 
j
;

454 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

455 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[ 
uv
 ];

456 
img³l
 **
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[
uv
][ (è
cu¼MB
->
c_»d_mode
];

459 
j
=
block_y
; j<block_y + 
BLOCK_SIZE
; j++)

460 
	`memýy
(&
mb_´ed
[
j
][
block_x
],&
cu¼_m´_16x16
[j][block_x], 
BLOCK_SIZE
 * (
img³l
));

461 
	}
}

469 
	$chroma_´ediùiÚ
 (
Maüoblock
* 
cu¼MB
,

470 
uv
,

471 
block_x
,

472 
block_y
,

473 
block_size_x
,

474 
block_size_y
,

475 
p_dœ
,

476 
l0_mode
,

477 
l1_mode
,

478 
l0_»f_idx
,

479 
l1_»f_idx
,

480 
b»d_me


483 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

484 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

486 
img³l
 
l0_´ed
[
MB_PIXELS
];

487 
img³l
 
l1_´ed
[
MB_PIXELS
];

489 
pic_Ýix_x
 = ((
cu¼MB
->
pix_c_x
 + 
block_x
) << 2);

490 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_c_y
 + 
block_y
) << 2);

492 
bx
 = 
block_x
 >> 2;

493 
by
 = 
block_y
 >> 2;

494 
MÙiÚVeùÜ
 ***** 
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
;

495 
uv_comp
 = 
uv
 + 1;

496 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[ 
uv_comp
];

498 
­¶y_weights
 = ( (
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1è|| (cu¼Sliû->weigh‹d_´ediùiÚ =ð2 && 
p_dœ
 == 2) );

500 ià(
b»d_me
 && 
l0_»f_idx
 =ð0 && 
l1_»f_idx
 =ð0 && 
p_dœ
 =ð2 && 
	`is_b»d_’abËd
(
p_Vid
, 
l0_mode
è&& is_b»d_’abËdÕ_Vid, 
l1_mode
))

501 
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

504 
p_dœ
)

507 
	`OÃCompÚ’tChromaP»diùiÚ
 (
p_Vid
, 
l0_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_0][l0_»f_idx][l0_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][l0_»f_idx], 
uv
);

510 
	`OÃCompÚ’tChromaP»diùiÚ
 (
p_Vid
, 
l1_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_1][l1_»f_idx][l1_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][l1_»f_idx], 
uv
);

513 
	`OÃCompÚ’tChromaP»diùiÚ
 (
p_Vid
, 
l0_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_0][l0_»f_idx][l0_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][l0_»f_idx], 
uv
);

514 
	`OÃCompÚ’tChromaP»diùiÚ
 (
p_Vid
, 
l1_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_1][l1_»f_idx][l1_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][l1_»f_idx], 
uv
);

520 ià(
­¶y_weights
)

522 ià(
p_dœ
==2)

524 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

525 
p_Vid
->
max_³l_v®ue_comp
[1],

526 
cu¼Sliû
->
wbp_weight
[0][
l0_»f_idx
][
l1_»f_idx
][
uv_comp
], currSlice->wbp_weight[1][l0_ref_idx][l1_ref_idx][uv_comp],

527 (
cu¼Sliû
->
wp_off£t
[0][
l0_»f_idx
][
uv_comp
] + cu¼Sliû->wp_off£t[1][
l1_»f_idx
][uv_comp] + 1)>>1,

528 (
cu¼Sliû
->
wp_chroma_round
 << 1), cu¼Sliû->
chroma_log_weight_d’om
 + 1);

530 ià(
p_dœ
==0)

532 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

533 
p_Vid
->
max_³l_v®ue_comp
[1],

534 
cu¼Sliû
->
wp_weight
[0][
l0_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[0][l0_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

538 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

539 
p_Vid
->
max_³l_v®ue_comp
[1],

540 
cu¼Sliû
->
wp_weight
[1][
l1_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[1][l1_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

545 ià(
p_dœ
==2)

547 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

549 ià(
p_dœ
==0)

551 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

555 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
);

558 
	}
}

568 
	$chroma_´ediùiÚ_4x4
 (
Maüoblock
* 
cu¼MB
,

569 
uv
,

570 
block_x
,

571 
block_y
,

572 
p_dœ
,

573 
l0_mode
,

574 
l1_mode
,

575 
l0_»f_idx
,

576 
l1_»f_idx
,

577 
b»d_me


580 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

581 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

583 
img³l
 
l0_´ed
[
MB_PIXELS
];

584 
img³l
 
l1_´ed
[
MB_PIXELS
];

586 
MÙiÚVeùÜ
 ***** 
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
;

587 
uv_comp
 = 
uv
 + 1;

588 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
uv_comp
];

589 
li¡_off£t
 = 
cu¼MB
->list_offset;

591 
­¶y_weights
 = ( (
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1è|| (cu¼Sliû->weigh‹d_´ediùiÚ =ð2 && 
p_dœ
 == 2) );

593 ià(
b»d_me
 && 
l0_»f_idx
 =ð0 && 
l1_»f_idx
 =ð0 && 
p_dœ
 =ð2 && 
	`is_b»d_’abËd
(
p_Vid
, 
l0_mode
è&& is_b»d_’abËdÕ_Vid, 
l1_mode
) )

594 
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

597 
p_dœ
)

600 
p_Vid
->
	`OÃCompÚ’tChromaP»diùiÚ4x4
 (
cu¼MB
, 
l0_´ed
, 
block_x
, 
block_y
, 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
], 
cu¼Sliû
->
li¡X
[LIST_0 + 
li¡_off£t
][l0_»f_idx], 
uv
);

603 
p_Vid
->
	`OÃCompÚ’tChromaP»diùiÚ4x4
 (
cu¼MB
, 
l1_´ed
, 
block_x
, 
block_y
, 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
], 
cu¼Sliû
->
li¡X
[LIST_1 + 
li¡_off£t
][l1_»f_idx], 
uv
);

606 
p_Vid
->
	`OÃCompÚ’tChromaP»diùiÚ4x4
 (
cu¼MB
, 
l0_´ed
, 
block_x
, 
block_y
, 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
], 
cu¼Sliû
->
li¡X
[LIST_0 + 
li¡_off£t
][l0_»f_idx], 
uv
);

607 
p_Vid
->
	`OÃCompÚ’tChromaP»diùiÚ4x4
 (
cu¼MB
, 
l1_´ed
, 
block_x
, 
block_y
, 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
], 
cu¼Sliû
->
li¡X
[LIST_1 + 
li¡_off£t
][l1_»f_idx], 
uv
);

613 ià(
­¶y_weights
)

615 ià(
p_dœ
==2)

617 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE,

618 
p_Vid
->
max_³l_v®ue_comp
[1],

619 
cu¼Sliû
->
wbp_weight
[0][
l0_»f_idx
][
l1_»f_idx
][
uv_comp
], currSlice->wbp_weight[1][l0_ref_idx][l1_ref_idx][uv_comp],

620 (
cu¼Sliû
->
wp_off£t
[0][
l0_»f_idx
][
uv_comp
] + cu¼Sliû->wp_off£t[1][
l1_»f_idx
][uv_comp] + 1)>>1,

621 (
cu¼Sliû
->
wp_chroma_round
 << 1), cu¼Sliû->
chroma_log_weight_d’om
 + 1);

624 ià(
p_dœ
==0)

626 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE,

627 
p_Vid
->
max_³l_v®ue_comp
[1],

628 
cu¼Sliû
->
wp_weight
[0][
l0_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[0][l0_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

632 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE,

633 
p_Vid
->
max_³l_v®ue_comp
[1],

634 
cu¼Sliû
->
wp_weight
[1][
l1_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[1][l1_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

639 ià(
p_dœ
==2)

641 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE);

643 ià(
p_dœ
==0)

645 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE);

649 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
BLOCK_SIZE
, 
block_x
, BLOCK_SIZE);

652 
	}
}

	@lencod/src/mc_prediction_otf.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<¡dlib.h
>

18 
	~<as£¹.h
>

19 
	~<lim™s.h
>

20 
	~<m©h.h
>

22 
	~"glob®.h
"

23 
	~"block.h
"

25 
	~"maüoblock.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"mc_´ediùiÚ_Ùf.h
"

29 
	~"»fbuf.h
"

30 
	~"image.h
"

31 
	~"mb_acûss.h
"

32 
	~"me_di¡ÜtiÚ.h
"

33 
	~"g‘_block_Ùf.h
"

41 
	$mc_´ediùiÚ
(
img³l
** 
mb_´ed
, img³l* 
Í»d
, 
block_size_y
, 
block_size_x
, 
ioff
)

43 
j
;

44 
j
 = 0; j < 
block_size_y
; j++)

46 
	`memýy
(&(
mb_´ed
[
j
][
ioff
]), 
Í»d
, 
block_size_x
 * (
img³l
));

47 
Í»d
 +ð
block_size_x
;

49 
	}
}

57 
	$weigh‹d_mc_´ediùiÚ
(
img³l
** 
mb_´ed
,

58 
img³l
* 
Í»d
,

59 
block_size_y
,

60 
block_size_x
,

61 
ioff
,

62 
max_img³l_v®ue
,

63 
wp_sÿË
,

64 
wp_off£t
,

65 
wp_round
,

66 
weight_d’om
)

68 
i
, 
j
;

69 
»suÉ
;

70 
block_x4
 = 
ioff
 + 
block_size_x
;

72 
j
 = 0; j < 
block_size_y
; j++)

74 
i
 = 
ioff
; i < 
block_x4
; i++)

76 
»suÉ
 = 
	`rshiá_ºd
((
wp_sÿË
 * *
Í»d
++), 
weight_d’om
è+ 
wp_off£t
;

77 
mb_´ed
[
j
][
i
] = (
img³l
è
	`iCl1
Ð
max_img³l_v®ue
, 
»suÉ
);

80 
	}
}

88 
	$bi_´ediùiÚ
(
img³l
 **
mb_´ed
,

89 
img³l
 *
l0´ed
,

90 
img³l
 *
l1´ed
,

91 
block_size_y
,

92 
block_size_x
,

93 
ioff
)

95 
i
, 
j
;

96 
block_x4
 = 
ioff
 + 
block_size_x
;

98 
j
 = 0; j < 
block_size_y
; j++)

100 
i
=
ioff
; i<
block_x4
; i++)

101 
mb_´ed
[
j
][
i
] = (*
l0´ed
++ + *
l1´ed
++ + 1) >> 1;

103 
	}
}

113 
	$weigh‹d_bi_´ediùiÚ
(
img³l
** 
mb_´ed
,

114 
img³l
 *
block_l0
,

115 
img³l
 *
block_l1
,

116 
block_size_y
,

117 
block_x
,

118 
block_size_x
,

119 
max_img³l_v®ue
,

120 
wp_sÿË_l0
,

121 
wp_sÿË_l1
,

122 
wp_off£t
,

123 
weight_d’om
)

125 
i
, 
j
, 
»suÉ
;

126 
block_x4
 = 
block_x
 + 
block_size_x
;

128 
j
 = 0; j< 
block_size_y
; j++)

130 
i
=
block_x
; i<
block_x4
; i++)

132 
»suÉ
 = 
	`rshiá_ºd_sf
((
wp_sÿË_l0
 * *(
block_l0
++è+ 
wp_sÿË_l1
 * *(
block_l1
++)), 
weight_d’om
);

133 
mb_´ed
[
j
][
i
] = (
img³l
è
	`iCl1
Ð
max_img³l_v®ue
, 
»suÉ
 + 
wp_off£t
);

136 
	}
}

145 
	$luma_´ediùiÚ_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

146 
block_x
,

147 
block_y
,

148 
block_size_x
,

149 
block_size_y
,

150 
p_dœ
,

151 
li¡_mode
[2],

152 *
»f_idx
,

153 
b»d_me


156 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

157 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

158 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

159 
img³l
 
l0_´ed
[
MB_PIXELS
];

160 
img³l
 
l1_´ed
[
MB_PIXELS
];

161 
tmp_´ed
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ];

163 
pic_Ýix_x
 = ((
cu¼MB
->
pix_x
 + 
block_x
) << 2);

164 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_y
 + 
block_y
) << 2);

165 
bx
 = 
block_x
 >> 2;

166 
by
 = 
block_y
 >> 2;

167 
MÙiÚVeùÜ
 ***** 
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
;

168 
MÙiÚVeùÜ
 *
cu¼_mv
 = 
NULL
;

169 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

170 
­¶y_weights
 = ( (
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1è|| (cu¼Sliû->weigh‹d_´ediùiÚ =ð2 && 
p_dœ
 == 2) );

172 ià(
b»d_me
 && 
»f_idx
[0] =ð0 &&„ef_idx[1] =ð0 && 
p_dœ
 =ð2 && 
	`is_b»d_’abËd
(
p_Vid
, 
li¡_mode
[0]) && is_bipred_enabled(p_Vid,†ist_mode[1]))

173 
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

175 
p_dœ
)

178 
cu¼_mv
 = &
mv_¬¿y
[
LIST_0
][(è
»f_idx
[0]][
li¡_mode
[0]][
by
][
bx
];

179 
p_Dpb
->
	`pf_g‘_block_luma
 (
p_Vid
, 
l0_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
cu¼MB
->
li¡_off£t
][(è
»f_idx
[0]], 0 );

182 
cu¼_mv
 = &
mv_¬¿y
[
LIST_1
][(è
»f_idx
[1]][
li¡_mode
[1]][
by
][
bx
];

183 
p_Dpb
->
	`pf_g‘_block_luma
 (
p_Vid
, 
l1_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[1]], 0 );

186 
cu¼_mv
 = &
mv_¬¿y
[
LIST_0
][(è
»f_idx
[0]][
li¡_mode
[0]][
by
][
bx
];

187 
p_Dpb
->
	`pf_g‘_block_luma
 (
p_Vid
, 
l0_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[0]], 0);

188 
cu¼_mv
 = &
mv_¬¿y
[
LIST_1
][(è
»f_idx
[1]][
li¡_mode
[1]][
by
][
bx
];

189 
p_Dpb
->
	`pf_g‘_block_luma
 (
p_Vid
, 
l1_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
cu¼_mv
->
mv_x
, 
pic_Ýix_y
 + cu¼_mv->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
cu¼MB
->
li¡_off£t
][()
»f_idx
[1]], 0);

195 ià(
­¶y_weights
)

197 ià(
p_dœ
==2)

199 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

200 
p_Vid
->
max_img³l_v®ue
,

201 
cu¼Sliû
->
wbp_weight
[0][()
»f_idx
[0]][()ref_idx[1]][0], currSlice->wbp_weight[1][()ref_idx[0]][()ref_idx[1]][0],

202 (
cu¼Sliû
->
wp_off£t
[0][()
»f_idx
[0]][0] + currSlice->wp_offset[1][()ref_idx[1]][0] + 1)>>1,

203 
cu¼Sliû
->
luma_log_weight_d’om
 + 1);

205 ià(
p_dœ
==0)

207 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
,

208 
p_Vid
->
max_img³l_v®ue
,

209 
cu¼Sliû
->
wp_weight
[0][()
»f_idx
[0]][0], cu¼Sliû->
wp_off£t
[0][(ìef_idx[0]][0], cu¼Sliû->
wp_luma_round
, cu¼Sliû->
luma_log_weight_d’om
);

213 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
,

214 
p_Vid
->
max_img³l_v®ue
,

215 
cu¼Sliû
->
wp_weight
[1][()
»f_idx
[1]][0], cu¼Sliû->
wp_off£t
[1][(ìef_idx[1]][0], cu¼Sliû->
wp_luma_round
, cu¼Sliû->
luma_log_weight_d’om
);

220 ià(
p_dœ
==2)

222 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

224 ià(
p_dœ
==0)

226 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

230 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

233 
	}
}

241 
	$luma_´ediùiÚ_bi_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

242 
block_x
,

243 
block_y
,

244 
block_size_x
,

245 
block_size_y
,

246 
l0_mode
,

247 
l1_mode
,

248 
l0_»f_idx
,

249 
l1_»f_idx
,

250 
li¡


253 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

254 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

255 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

257 
img³l
 
l0_´ed
[
MB_PIXELS
];

258 
img³l
 
l1_´ed
[
MB_PIXELS
];

260 
tmp_´ed
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ];

261 
pic_Ýix_x
 = ((
cu¼MB
->
pix_x
 + 
block_x
) << 2);

262 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_y
 + 
block_y
) << 2);

263 
bx
 = 
block_x
 >> 2;

264 
by
 = 
block_y
 >> 2;

266 
­¶y_weights
 = ( 
cu¼Sliû
->
weigh‹d_´ediùiÚ
 != 0 );

268 
MÙiÚVeùÜ
 *****
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
li¡
];

269 
MÙiÚVeùÜ
 *
mv_¬¿yl0
 = &
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
];

270 
MÙiÚVeùÜ
 *
mv_¬¿yl1
 = &
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
];

271 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

273 
p_Dpb
->
	`pf_g‘_block_luma
(
p_Vid
, 
l0_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿yl0
->
mv_x
, 
pic_Ýix_y
 + mv_¬¿yl0->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][
l0_»f_idx
], 0);

274 
p_Dpb
->
	`pf_g‘_block_luma
(
p_Vid
, 
l1_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿yl1
->
mv_x
, 
pic_Ýix_y
 + mv_¬¿yl1->
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][
l1_»f_idx
], 0);

276 ià(
­¶y_weights
)

278 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

279 
p_Vid
->
max_img³l_v®ue
,

280 
cu¼Sliû
->
wbp_weight
[0][
l0_»f_idx
][
l1_»f_idx
][0], currSlice->wbp_weight[1][l0_ref_idx][l1_ref_idx][0],

281 (
cu¼Sliû
->
wp_off£t
[0][
l0_»f_idx
][0] + cu¼Sliû->wp_off£t[1][
l1_»f_idx
][0] + 1)>>1,

282 
cu¼Sliû
->
luma_log_weight_d’om
 + 1);

286 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

288 
	}
}

296 
	$chroma_´ediùiÚ_Ùf
 ( 
Maüoblock
* 
cu¼MB
,

297 
uv
,

298 
block_x
,

299 
block_y
,

300 
block_size_x
,

301 
block_size_y
,

302 
p_dœ
,

303 
l0_mode
,

304 
l1_mode
,

305 
l0_»f_idx
,

306 
l1_»f_idx
,

307 
b»d_me


310 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

311 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

312 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

314 
img³l
 
l0_´ed
[
MB_PIXELS
];

315 
img³l
 
l1_´ed
[
MB_PIXELS
];

316 
tmp_´ed
[(
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5)];

318 
pic_Ýix_x
 = ((
cu¼MB
->
pix_c_x
 + 
block_x
) << 2);

319 
pic_Ýix_y
 = ((
cu¼MB
->
Ýix_c_y
 + 
block_y
) << 2);

321 
bx
 = 
block_x
 >> 2;

322 
by
 = 
block_y
 >> 2;

323 
MÙiÚVeùÜ
 ***** 
mv_¬¿y
 = 
cu¼Sliû
->
®l_mv
;

324 
uv_comp
 = 
uv
 + 1;

325 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[ 
uv_comp
];

327 
­¶y_weights
 = ( (
cu¼Sliû
->
weigh‹d_´ediùiÚ
 =ð1è|| (cu¼Sliû->weigh‹d_´ediùiÚ =ð2 && 
p_dœ
 == 2) );

329 ià(
b»d_me
 && 
l0_»f_idx
 =ð0 && 
l1_»f_idx
 =ð0 && 
p_dœ
 =ð2 && 
	`is_b»d_’abËd
(
p_Vid
, 
l0_mode
è&& is_b»d_’abËdÕ_Vid, 
l1_mode
))

330 
mv_¬¿y
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

333 
p_dœ
)

336 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_MC
] (
p_Vid
, 
l0_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_0][l0_»f_idx][l0_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][l0_»f_idx], 
uv
+1 );

339 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_MC
] (
p_Vid
, 
l1_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_1][l1_»f_idx][l1_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][l1_»f_idx], 
uv
+1 );

342 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_MC
] (
p_Vid
, 
l0_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_0
][
l0_»f_idx
][
l0_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_0][l0_»f_idx][l0_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[0+
cu¼MB
->
li¡_off£t
][l0_»f_idx], 
uv
+1 );

343 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_MC
] (
p_Vid
, 
l1_´ed
, 
tmp_´ed
, 
pic_Ýix_x
 + 
mv_¬¿y
[
LIST_1
][
l1_»f_idx
][
l1_mode
][
by
][
bx
].
mv_x
, 
pic_Ýix_y
 + mv_¬¿y[LIST_1][l1_»f_idx][l1_mode][by][bx].
mv_y
, 
block_size_x
, 
block_size_y
, 
cu¼Sliû
->
li¡X
[1+
cu¼MB
->
li¡_off£t
][l1_»f_idx], 
uv
+1 );

349 ià(
­¶y_weights
)

351 ià(
p_dœ
==2)

353 
	`weigh‹d_bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_x
, 
block_size_x
,

354 
p_Vid
->
max_³l_v®ue_comp
[1],

355 
cu¼Sliû
->
wbp_weight
[0][
l0_»f_idx
][
l1_»f_idx
][
uv_comp
], currSlice->wbp_weight[1][l0_ref_idx][l1_ref_idx][uv_comp],

356 (
cu¼Sliû
->
wp_off£t
[0][
l0_»f_idx
][
uv_comp
] + cu¼Sliû->wp_off£t[1][
l1_»f_idx
][uv_comp] + 1)>>1,

357 
cu¼Sliû
->
chroma_log_weight_d’om
 + 1);

359 ià(
p_dœ
==0)

361 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
,

362 
p_Vid
->
max_³l_v®ue_comp
[1],

363 
cu¼Sliû
->
wp_weight
[0][
l0_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[0][l0_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

367 
	`weigh‹d_mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
,

368 
p_Vid
->
max_³l_v®ue_comp
[1],

369 
cu¼Sliû
->
wp_weight
[1][
l1_»f_idx
][
uv_comp
], cu¼Sliû->
wp_off£t
[1][l1_»f_idx][uv_comp], cu¼Sliû->
wp_chroma_round
, cu¼Sliû->
chroma_log_weight_d’om
 );

374 ià(
p_dœ
==2)

376 
	`bi_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

378 ià(
p_dœ
==0)

380 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l0_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

384 
	`mc_´ediùiÚ
(&
mb_´ed
[
block_y
], 
l1_´ed
, 
block_size_y
, 
block_size_x
, 
block_x
);

387 
	}
}

	@lencod/src/md_common.c

15 
	~<lim™s.h
>

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"maüoblock.h
"

19 
	~"mc_´ediùiÚ.h
"

27 
šlše
 
	$CÝyMVBlock16
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
MÙiÚVeùÜ
 **
rdo_mv
, 
li¡
, 
block_x
, 
block_y
, 
¡¬t
, 
’d
)

29 
j
, 
i
;

30 
j
 = 
¡¬t
; j < 
’d
; j++)

32 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

34 
mv_šfo
[
block_y
 + 
j
][
block_x
 + 
i
].
mv
[
li¡
] = 
rdo_mv
[j][i];

37 
	}
}

45 
šlše
 
	$Re£tMÙiÚBlock16
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
block_y
, 
¡¬t
, 
’d
)

47 
j
, 
i
;

48 
j
 = 
block_y
 + 
¡¬t
; j < block_y + 
’d
; j++)

50 
i
 = 
block_x
; i < block_x + 
BLOCK_MULTIPLE
; i++)

52 
mv_šfo
[
j
][
i
].
mv
[
li¡
] = 
z”o_mv
;

53 
mv_šfo
[
j
][
i
].
»f_idx
[
li¡
] = -1;

54 
mv_šfo
[
j
][
i
].
»f_pic
[
li¡
] = 
NULL
;

57 
	}
}

65 
šlše
 
	$Re£tMVBlock16
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
block_y
, 
¡¬t
, 
’d
)

67 
j
, 
i
;

68 
j
 = 
block_y
 + 
¡¬t
; j < block_y + 
’d
; j++)

70 
i
 = 
block_x
; i < block_x + 
BLOCK_MULTIPLE
; i++)

71 
mv_šfo
[
j
][
i
].
mv
[
li¡
] = 
z”o_mv
;

73 
	}
}

81 
šlše
 
	$Re£tRefBlock16
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
block_y
, 
¡¬t
, 
’d
)

83 
j
, 
i
;

84 
j
 = 
block_y
 + 
¡¬t
; j < block_y + 
’d
; j++)

86 
i
 = 
block_x
; i < block_x + 
BLOCK_MULTIPLE
; ++i)

88 
mv_šfo
[
j
][
i
].
»f_idx
[
li¡
] = -1;

89 
mv_šfo
[
j
][
i
].
»f_pic
[
li¡
] = 
NULL
;

92 
	}
}

100 
šlše
 
	$CÝyMVBlock8
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
MÙiÚVeùÜ
 **
rdo_mv
, 
li¡
, 
block_x
, 
¡¬t
, 
’d
, 
off£t
)

102 
j
;

103 
j
 = 
¡¬t
; j < 
’d
; j++)

105 
mv_šfo
[
j
][
block_x
 ].
mv
[
li¡
] = 
rdo_mv
[j][
off£t
];

106 
mv_šfo
[
j
][
block_x
 + 1].
mv
[
li¡
] = 
rdo_mv
[j][
off£t
 + 1];

108 
	}
}

116 
šlše
 
	$Re£tMÙiÚBlock8
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
¡¬t
, 
’d
)

118 
j
;

120 
j
 = 
¡¬t
; j < 
’d
; j++)

122 
mv_šfo
[
j
][
block_x
 ].
mv
[
li¡
] = 
z”o_mv
;

123 
mv_šfo
[
j
][
block_x
 ].
»f_idx
[
li¡
] = -1;

124 
mv_šfo
[
j
][
block_x
 ].
»f_pic
[
li¡
] = 
NULL
;

125 
mv_šfo
[
j
][
block_x
 + 1].
mv
[
li¡
] = 
z”o_mv
;

126 
mv_šfo
[
j
][
block_x
 + 1].
»f_idx
[
li¡
] = -1;

127 
mv_šfo
[
j
][
block_x
 + 1].
»f_pic
[
li¡
] = 
NULL
;

129 
	}
}

137 
šlše
 
	$Re£tMVBlock8
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
¡¬t
, 
’d
)

139 
j
;

141 
j
 = 
¡¬t
; j < 
’d
; j++)

143 
mv_šfo
[
j
][
block_x
 ].
mv
[
li¡
] = 
z”o_mv
;

144 
mv_šfo
[
j
][
block_x
 + 1].
mv
[
li¡
] = 
z”o_mv
;

146 
	}
}

154 
šlše
 
	$Re£tRefBlock8
(
PicMÙiÚP¬ams
 **
mv_šfo
, 
li¡
, 
block_x
, 
¡¬t
, 
’d
)

156 
j
;

157 
j
 = 
¡¬t
; j < 
’d
; j++)

159 
mv_šfo
[
j
][
block_x
 ].
»f_idx
[
li¡
] = -1;

160 
mv_šfo
[
j
][
block_x
 ].
»f_pic
[
li¡
] = 
NULL
;

161 
mv_šfo
[
j
][
block_x
 + 1].
»f_idx
[
li¡
] = -1;

162 
mv_šfo
[
j
][
block_x
 + 1].
»f_pic
[
li¡
] = 
NULL
;

164 
	}
}

172 
	$S‘MÙiÚVeùÜsMBPSliû
 (
Maüoblock
* 
cu¼MB
)

174 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

175 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

176 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

178 
RD_DATA
 *
rdÝt
 = 
cu¼Sliû
->
rdd©a
;

179 
MÙiÚVeùÜ
 ****
®l_mv
 = 
cu¼Sliû
->®l_mv[
LIST_0
];

180 
l0_»f
, 
mode8
;

182 ià(
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1))

184 
	`memýy
(&
rdÝt
->
®l_mv
[
LIST_0
][0][0][0][0], &®l_mv[0][0][0][0], 
p_Vid
->
max_num_»ã»nûs
 * 9 * 
MB_BLOCK_PARTITIONS
 * (
MÙiÚVeùÜ
));

187 ià(
cu¼MB
->
mb_ty³
 =ð
PSKIP
)

189 
	`CÝyMVBlock16
(
mv_šfo
, 
®l_mv
[0][
PSKIP
], 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

191 ià(
cu¼MB
->
mb_ty³
 =ð
P16x16
)

193 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

194 
	`CÝyMVBlock16
(
mv_šfo
, 
®l_mv
[
l0_»f
][
P16x16
], 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

196 ià(
cu¼MB
->
mb_ty³
 =ð
P16x8
)

198 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

199 
	`CÝyMVBlock16
(
mv_šfo
, 
®l_mv
[
l0_»f
][
P16x8
], 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 2);

201 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
 + 2][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

202 
	`CÝyMVBlock16
(
mv_šfo
, 
®l_mv
[
l0_»f
][
P16x8
], 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 2, 4);

204 ià(
cu¼MB
->
mb_ty³
 =ð
P8x16
)

206 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

207 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
P8x16
], 
LIST_0
, cu¼MB->
block_x
 , 0, 4, 0);

209 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
][cu¼MB->
block_x
 + 2].
»f_idx
[
LIST_0
];

210 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
P8x16
], 
LIST_0
, cu¼MB->
block_x
 + 2, 0, 4, 2);

212 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
)

214 
mode8
 = 
cu¼MB
->
b8x8
[0].
mode
;

215 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
 ][cu¼MB->
block_x
 ].
»f_idx
[
LIST_0
];

216 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
mode8
], 
LIST_0
, cu¼MB->
block_x
 , 0, 2, 0);

218 
mode8
 = 
cu¼MB
->
b8x8
[1].
mode
;

219 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
 ][cu¼MB->
block_x
 + 2].
»f_idx
[
LIST_0
];

220 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
mode8
], 
LIST_0
, cu¼MB->
block_x
 + 2, 0, 2, 2);

222 
mode8
 = 
cu¼MB
->
b8x8
[2].
mode
;

223 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
 + 2][cu¼MB->
block_x
 ].
»f_idx
[
LIST_0
];

224 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
mode8
], 
LIST_0
, cu¼MB->
block_x
, 2, 4, 0);

226 
mode8
 = 
cu¼MB
->
b8x8
[3].
mode
;

227 
l0_»f
 = 
mv_šfo
[
cu¼MB
->
block_y
 + 2][cu¼MB->
block_x
 + 2].
»f_idx
[
LIST_0
];

228 
	`CÝyMVBlock8
(&
mv_šfo
[
cu¼MB
->
block_y
], 
®l_mv
[
l0_»f
][
mode8
], 
LIST_0
, cu¼MB->
block_x
 + 2, 2, 4, 2);

232 
	`Re£tMÙiÚBlock16
 (
mv_šfo
, 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

234 
	}
}

242 
	$S‘MVBSliû16x8
(
Sliû
 *
cu¼Sliû
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Maüoblock
* 
cu¼MB
, 
pos
)

244 
l0_»f
, 
l1_»f
;

245 
pdœ
 = 
cu¼MB
->
b8x8
[
pos
].pdir;

246 ià(
pdœ
 =ð
LIST_0
)

248 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
pos
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

249 
	`CÝyMVBlock16
(
mÙiÚ
, 
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0_»f
][
P16x8
], LIST_0, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

250 
	`Re£tMÙiÚBlock16
 (
mÙiÚ
, 
LIST_1
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

252 ià(
pdœ
 =ð
LIST_1
)

254 
	`Re£tMÙiÚBlock16
 (
mÙiÚ
, 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

255 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
pos
][cu¼MB->
block_x
].
»f_idx
[
LIST_1
];

256 
	`CÝyMVBlock16
 (
mÙiÚ
, 
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1_»f
][
P16x8
], LIST_1, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

260 
b»d_me
 = 
cu¼MB
->
b8x8
[
pos
].
b»d
;

261 
MÙiÚVeùÜ
 *****
®l_mv
 = 
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[bipred_me - 1]: currSlice->all_mv;

262 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
pos
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

263 
	`CÝyMVBlock16
 (
mÙiÚ
, 
®l_mv
 [
LIST_0
][
l0_»f
][
P16x8
], LIST_0, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

265 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
 + 
pos
][cu¼MB->
block_x
].
»f_idx
[
LIST_1
];

266 
	`CÝyMVBlock16
 (
mÙiÚ
, 
®l_mv
 [
LIST_1
][
l1_»f
][
P16x8
], LIST_1, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 
pos
,…os + 2);

268 ià(
b»d_me
 && (
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1)))

270 
	`memýy
(
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_0
][
l0_»f
][
P16x8
][
pos
],‡Î_mv [LIST_0][l0_»f][P16x8][pos], 2 * 
BLOCK_MULTIPLE
 * (
MÙiÚVeùÜ
));

271 
	`memýy
(
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_1
][
l1_»f
][
P16x8
][
pos
],‡Î_mv [LIST_1][l1_»f][P16x8][pos], 2 * 
BLOCK_MULTIPLE
 * (
MÙiÚVeùÜ
));

274 
	}
}

282 
	$S‘MVBSliû8x16
(
Sliû
 *
cu¼Sliû
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Maüoblock
* 
cu¼MB
, 
pos
)

284 
l0_»f
, 
l1_»f
;

285 
pdœ
 = 
cu¼MB
->
b8x8
[
pos
 >> 1].pdir;

286 ià(
pdœ
 =ð
LIST_0
)

288 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
 + 
pos
].
»f_idx
[
LIST_0
];

289 
	`CÝyMVBlock8
 (&
mÙiÚ
[
cu¼MB
->
block_y
], 
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0_»f
][
P8x16
], LIST_0, cu¼MB->
block_x
 + 
pos
, 0, 4,…os);

290 
	`Re£tMÙiÚBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_1
, cu¼MB->
block_x
 + 
pos
, 0, 4);

292 ià(
pdœ
 =ð
LIST_1
)

294 
	`Re£tMÙiÚBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_0
, cu¼MB->
block_x
 + 
pos
, 0, 4);

295 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
 + 
pos
].
»f_idx
[
LIST_1
];

296 
	`CÝyMVBlock8
 (&
mÙiÚ
[
cu¼MB
->
block_y
], 
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1_»f
][
P8x16
], LIST_1, cu¼MB->
block_x
 + 
pos
, 0, 4,…os);

300 
b»d_me
 = 
cu¼MB
->
b8x8
[
pos
 >> 1].
b»d
;

301 
MÙiÚVeùÜ
 *****
®l_mv
 = 
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[bipred_me - 1]: currSlice->all_mv;

303 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
 + 
pos
].
»f_idx
[
LIST_0
];

304 
	`CÝyMVBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
®l_mv
 [
LIST_0
][
l0_»f
][
P8x16
], LIST_0, cu¼MB->
block_x
 + 
pos
, 0, 4,…os);

305 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
 + 
pos
].
»f_idx
[
LIST_1
];

306 
	`CÝyMVBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
®l_mv
 [
LIST_1
][
l1_»f
][
P8x16
], LIST_1, cu¼MB->
block_x
 + 
pos
, 0, 4,…os);

308 ià(
b»d_me
 && (
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1)))

310 
j
;

311 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

313 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_0
][
l0_»f
][
P8x16
][
j
][
pos
], &®l_mv [LIST_0][l0_»f][P8x16][j][pos], 2 * (
MÙiÚVeùÜ
));

315 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

317 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_1
][
l1_»f
][
P8x16
][
j
][
pos
], &®l_mv [LIST_1][l1_»f][P8x16][j][pos], 2 * (
MÙiÚVeùÜ
));

321 
	}
}

329 
	$S‘MVBSliû8x8
(
Sliû
 *
cu¼Sliû
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Maüoblock
* 
cu¼MB
, 
pos_y
, 
pos_x
)

331 
l0_»f
, 
l1_»f
;

332 
pos
 = 
pos_y
 + (
pos_x
 >> 1);

333 
pdœ
 = 
cu¼MB
->
b8x8
[
pos
].pdir;

334 
mode
 = 
cu¼MB
->
b8x8
[
pos
].mode;

335 
block_y
 = 
cu¼MB
->block_y + 
pos_y
;

336 
block_x
 = 
cu¼MB
->block_x + 
pos_x
;

338 ià(
pdœ
 =ð
LIST_0
)

340 
l0_»f
 = 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
];

341 
	`CÝyMVBlock8
 (&
mÙiÚ
[
cu¼MB
->
block_y
], 
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0_»f
][
mode
], LIST_0, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2,…os_x);

342 
	`Re£tMÙiÚBlock8
 (&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_1
, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2);

344 ià(
pdœ
 =ð
LIST_1
)

346 
	`Re£tMÙiÚBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_0
, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2);

347 
l1_»f
 = 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_1
];

348 
	`CÝyMVBlock8
 (&
mÙiÚ
[
cu¼MB
->
block_y
], 
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1_»f
][
mode
], LIST_1, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2,…os_x);

350 ià(
pdœ
 =ð
BI_PRED
)

352 
b»d_me
 = 
cu¼MB
->
b8x8
[
pos
].
b»d
;

353 
MÙiÚVeùÜ
 *****
®l_mv
 = 
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[bipred_me - 1]: currSlice->all_mv;

354 
l0_»f
 = 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
];

355 
	`CÝyMVBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
®l_mv
 [
LIST_0
][
l0_»f
][
mode
], LIST_0, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2,…os_x);

357 
l1_»f
 = 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_1
];

358 
	`CÝyMVBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
®l_mv
 [
LIST_1
][
l1_»f
][
mode
], LIST_1, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2,…os_x);

360 ià(
b»d_me
 && (
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1)))

362 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_0
][
l0_»f
][
mode
][
pos_y
 ][
pos_x
], &®l_mv [LIST_0][l0_»f][mode][pos_y ][pos_x], 2 * (
MÙiÚVeùÜ
));

363 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_0
][
l0_»f
][
mode
][
pos_y
 + 1][
pos_x
], &®l_mv [LIST_0][l0_»f][mode][pos_y + 1][pos_x], 2 * (
MÙiÚVeùÜ
));

364 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_1
][
l1_»f
][
mode
][
pos_y
 ][
pos_x
], &®l_mv [LIST_1][l1_»f][mode][pos_y ][pos_x], 2 * (
MÙiÚVeùÜ
));

365 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_1
][
l1_»f
][
mode
][
pos_y
 + 1][
pos_x
], &®l_mv [LIST_1][l1_»f][mode][pos_y + 1][pos_x], 2 * (
MÙiÚVeùÜ
));

370 
	`Re£tMÙiÚBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_0
, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2);

371 
	`Re£tMÙiÚBlock8
(&
mÙiÚ
[
cu¼MB
->
block_y
], 
LIST_1
, cu¼MB->
block_x
 + 
pos_x
, 
pos_y
,…os_y + 2);

373 
	}
}

375 
	$S‘MÙiÚVeùÜsMBISliû
 (
Maüoblock
* 
cu¼MB
)

377 
	}
}

385 
	$S‘MÙiÚVeùÜsMBBSliû
 (
Maüoblock
* 
cu¼MB
)

387 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

388 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

389 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

391 
l0_»f
, 
l1_»f
;

397 ià(
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1))

399 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
[
LIST_0
][0][0][0][0], &cu¼Sliû->®l_mv[LIST_0][0][0][0][0], 2 * 
p_Vid
->
max_num_»ã»nûs
 * 9 * 
MB_BLOCK_PARTITIONS
 * (
MÙiÚVeùÜ
));

402 ià(
cu¼MB
->
mb_ty³
 =ð
P16x16
)

404 
pdœ
 = 
cu¼MB
->
b8x8
[0].pdir;

405 ià(
pdœ
 =ð
LIST_0
)

407 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

408 
	`CÝyMVBlock16
 (
mÙiÚ
, 
cu¼Sliû
->
®l_mv
 [
LIST_0
][
l0_»f
][
P16x16
], LIST_0, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

409 
	`Re£tMÙiÚBlock16
(
mÙiÚ
, 
LIST_1
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

411 ià(
pdœ
 =ð
LIST_1
)

413 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_1
];

414 
	`Re£tMÙiÚBlock16
 (
mÙiÚ
, 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

415 
	`CÝyMVBlock16
 (
mÙiÚ
, 
cu¼Sliû
->
®l_mv
 [
LIST_1
][
l1_»f
][
P16x16
], LIST_1, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

419 
b»d_me
 = 
cu¼MB
->
b8x8
[0].
b»d
;

420 
MÙiÚVeùÜ
 *****
®l_mv
 = 
b»d_me
 ? 
cu¼Sliû
->
b»d_mv
[bipred_me - 1]: currSlice->all_mv;

421 
l0_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
];

422 
	`CÝyMVBlock16
 (
mÙiÚ
, 
®l_mv
 [
LIST_0
][
l0_»f
][
P16x16
], LIST_0, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

423 
l1_»f
 = 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_1
];

424 
	`CÝyMVBlock16
 (
mÙiÚ
, 
®l_mv
 [
LIST_1
][
l1_»f
][
P16x16
], LIST_1, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

427 ià(
b»d_me
 && (
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1)))

429 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_0
][
l0_»f
][
P16x16
][0][0], &®l_mv [LIST_0][l0_»f][P16x16][0][0], 
MB_BLOCK_PARTITIONS
 * (
MÙiÚVeùÜ
));

430 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
®l_mv
 [
LIST_1
][
l1_»f
][
P16x16
][0][0], &®l_mv [LIST_1][l1_»f][P16x16][0][0], 
MB_BLOCK_PARTITIONS
 * (
MÙiÚVeùÜ
));

434 ià(
cu¼MB
->
mb_ty³
 =ð
P16x8
)

436 
	`S‘MVBSliû16x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 0);

437 
	`S‘MVBSliû16x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 2);

439 ià(
cu¼MB
->
mb_ty³
 =ð
P8x16
)

441 
	`S‘MVBSliû8x16
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 0);

442 
	`S‘MVBSliû8x16
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 2);

444 ià(
cu¼MB
->
mb_ty³
 =ð
P8x8
 || cu¼MB->mb_ty³ =ð
BSKIP_DIRECT
)

446 
	`S‘MVBSliû8x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 0, 0);

447 
	`S‘MVBSliû8x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 0, 2);

448 
	`S‘MVBSliû8x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 2, 0);

449 
	`S‘MVBSliû8x8
(
cu¼Sliû
, 
mÙiÚ
, 
cu¼MB
, 2, 2);

453 
	`Re£tMÙiÚBlock16
 (
mÙiÚ
, 
LIST_0
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

454 
	`Re£tMÙiÚBlock16
 (
mÙiÚ
, 
LIST_1
, 
cu¼MB
->
block_x
, cu¼MB->
block_y
, 0, 4);

456 
	}
}

464 
	$cÝy_image_d©a_16x16
(
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
)

466 
j
;

467 
j
=0; j<
MB_BLOCK_SIZE
; j++)

469 
	`memýy
(&
imgBuf1
[
j
][
off1
], &
imgBuf2
[j][
off2
], 
MB_BLOCK_SIZE
 *  (
img³l
));

471 
	}
}

479 
	$cÝy_image_d©a_8x8
(
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
)

481 
j
;

482 
j
 = 0; j < 
BLOCK_SIZE_8x8
; j++)

484 
	`memýy
(&
imgBuf1
[
j
][
off1
], &
imgBuf2
[j][
off2
], 
BLOCK_SIZE_8x8
 *  (
img³l
));

486 
	}
}

494 
	$cÝy_image_d©a_4x4
(
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
)

496 
j
;

497 
j
 = 0; j < 
BLOCK_SIZE
; j++)

499 
	`memýy
(&
imgBuf1
[
j
][
off1
], &
imgBuf2
[j][
off2
], 
BLOCK_SIZE
 *  (
img³l
));

501 
	}
}

509 
	$cÝy_image_d©a
(
img³l
 **
imgBuf1
, img³È**
imgBuf2
, 
off1
, 
off2
, 
width
, 
height
)

511 
j
;

512 
j
 = 0; j < 
height
; j++)

514 
	`memýy
(&
imgBuf1
[
j
][
off1
], &
imgBuf2
[j][
off2
], 
width
 *  (
img³l
));

516 
	}
}

524 
	$Re£tRD8x8D©a
(
VideoP¬am‘”s
 *
p_Vid
, 
RD_8x8DATA
 *
rd_d©a
)

526 
block
;

527 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
TRUE
;

529 
rd_d©a
->
mb_p8x8_co¡
 = 0;

530 
rd_d©a
->
cbp8x8
 = 0;

531 
rd_d©a
->
cbp_blk8x8
 = 0;

532 
rd_d©a
->
út_nÚz_8x8
 = 0;

534 
block
 = 0; block < 4; block++)

536 
rd_d©a
->
smb_p8x8_co¡
[
block
] = 
DISTBLK_MAX
;

537 
rd_d©a
->
smb_p8x8_rdco¡
[
block
] = 
DISTBLK_MAX
;

538 
rd_d©a
->
·¹
[
block
].
mode
 = -1;

540 
	}
}

548 
	$£t_chroma_´ed_mode
(
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 
’c_mb
, *
mb_avažabË
, 
chroma_´ed_mode_¿nge
[2])

550 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

551 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

553 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

555 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

557 
cu¼Sliû
->
	`šŒa_chroma_´ediùiÚ
(
cu¼MB
, &
mb_avažabË
[0], &mb_available[1], &mb_available[2]);

559 ià(
p_IÅ
->
Fa¡CrIÁ¿DecisiÚ
)

561 
cu¼Sliû
->
	`šŒa_chroma_RD_decisiÚ
(
cu¼MB
, &
’c_mb
);

563 
chroma_´ed_mode_¿nge
[0] = 
cu¼MB
->
c_»d_mode
;

564 
chroma_´ed_mode_¿nge
[1] = 
cu¼MB
->
c_»d_mode
;

568 
chroma_´ed_mode_¿nge
[0] = 
DC_PRED_8
;

569 
chroma_´ed_mode_¿nge
[1] = 
PLANE_8
;

574 
chroma_´ed_mode_¿nge
[0] = 
DC_PRED_8
;

575 
chroma_´ed_mode_¿nge
[1] = 
DC_PRED_8
;

577 
	}
}

	@lencod/src/md_distortion.c

12 
	~<m©h.h
>

13 
	~<lim™s.h
>

14 
	~<æßt.h
>

16 
	~"glob®.h
"

17 
	~"rdÝt_codšg_¡©e.h
"

18 
	~"mb_acûss.h
"

19 
	~"šŒ¬eäesh.h
"

20 
	~"image.h
"

21 
	~"ŒªsfÜm8x8.h
"

22 
	~"¿‹ùl.h
"

23 
	~"mode_decisiÚ.h
"

24 
	~"fmo.h
"

25 
	~"me_umhex.h
"

26 
	~"me_umhexsmp.h
"

27 
	~"maüoblock.h
"

28 
	~"mv_£¬ch.h
"

29 
	~"md_di¡ÜtiÚ.h
"

31 
	$£tupDi¡ÜtiÚ
(
Sliû
 *
cu¼Sliû
)

33 
cu¼Sliû
->
g‘Di¡ÜtiÚ
 = 
di¡ÜtiÚSSE
;

34 
	}
}

42 
št64
 
	$compu‹_SSE
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, 
ySize
, 
xSize
)

44 
i
, 
j
;

45 
img³l
 *
lšeRef
, *
lšeSrc
;

46 
št64
 
di¡ÜtiÚ
 = 0;

48 
j
 = 0; j < 
ySize
; j++)

50 
lšeRef
 = &
imgRef
[
j
][
xRef
];

51 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

53 
i
 = 0; i < 
xSize
; i++)

54 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

56  
di¡ÜtiÚ
;

57 
	}
}

59 
di¡blk
 
	$compu‹_SSE_ü
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, 
ySize
, 
xSize
)

61 
i
, 
j
;

62 
img³l
 *
lšeRef
, *
lšeSrc
;

63 
di¡blk
 
di¡ÜtiÚ
 = 0;

65 
j
 = 0; j < 
ySize
; j++)

67 
lšeRef
 = &
imgRef
[
j
][
xRef
];

68 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

70 
i
 = 0; i < 
xSize
; i++)

71 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

74  
	`di¡_sÿË
(
di¡ÜtiÚ
);

75 
	}
}

83 
di¡blk
 
	$compu‹_SSE16x16
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
)

85 
i
, 
j
;

86 
img³l
 *
lšeRef
, *
lšeSrc
;

87 
di¡blk
 
di¡ÜtiÚ
 = 0;

89 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

91 
lšeRef
 = &
imgRef
[
j
][
xRef
];

92 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

94 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

95 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

98  
	`di¡_sÿË
(
di¡ÜtiÚ
);

99 
	}
}

101 
di¡blk
 
	$compu‹_SSE16x16_th»s
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
, 
di¡blk
 
mš_co¡
)

103 
i
, 
j
;

104 
img³l
 *
lšeRef
, *
lšeSrc
;

105 
di¡blk
 
di¡ÜtiÚ
 = 0;

106 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

108 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

110 
lšeRef
 = &
imgRef
[
j
][
xRef
];

111 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

113 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

114 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

115 ià(
di¡ÜtiÚ
 > 
imš_co¡
)

116  (
mš_co¡
);

119  
	`di¡_sÿË
(
di¡ÜtiÚ
);

120 
	}
}

127 
di¡blk
 
	$compu‹_SSE8x8
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
)

129 
i
, 
j
;

130 
img³l
 *
lšeRef
, *
lšeSrc
;

131 
di¡blk
 
di¡ÜtiÚ
 = 0;

133 
j
 = 0; j < 
BLOCK_SIZE_8x8
; j++)

135 
lšeRef
 = &
imgRef
[
j
][
xRef
];

136 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

138 
i
 = 0; i < 
BLOCK_SIZE_8x8
; i++)

139 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

142  
	`di¡_sÿË
(
di¡ÜtiÚ
);

143 
	}
}

152 
di¡blk
 
	$compu‹_SSE4x4
(
img³l
 **
imgRef
, img³È**
imgSrc
, 
xRef
, 
xSrc
)

154 
i
, 
j
;

155 
img³l
 *
lšeRef
, *
lšeSrc
;

156 
di¡blk
 
di¡ÜtiÚ
 = 0;

158 
j
 = 0; j < 
BLOCK_SIZE
; j++)

160 
lšeRef
 = &
imgRef
[
j
][
xRef
];

161 
lšeSrc
 = &
imgSrc
[
j
][
xSrc
];

163 
i
 = 0; i < 
BLOCK_SIZE
; i++)

164 
di¡ÜtiÚ
 +ð
	`Ÿbs2
Ð*
lšeRef
++ - *
lšeSrc
++ );

167  
	`di¡_sÿË
(
di¡ÜtiÚ
);

168 
	}
}

176 
di¡blk
 
	$di¡ÜtiÚSSE
(
Maüoblock
 *
cu¼MB
)

178 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

179 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

180 
di¡blk
 
di¡ÜtiÚY
 = 0;

181 
di¡blk
 
di¡ÜtiÚCr
[2] = {0, 0};

184 
di¡ÜtiÚY
 = 
	`compu‹_SSE16x16
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], &p_Vid->
’c_piùu»
->
p_cu¼_img
[cu¼MB->
pix_y
], cu¼MB->
pix_x
, currMB->pix_x);

187 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

189 
di¡ÜtiÚCr
[0] = 
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

190 
di¡ÜtiÚCr
[1] = 
	`compu‹_SSE_ü
(&
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_c_y
], &p_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
);

192 #ià
JCOST_OVERFLOWCHECK


193 if(
di¡ÜtiÚY
 * 
p_IÅ
->
WeightY
 + 
di¡ÜtiÚCr
[0] *…_IÅ->
WeightCb
 + di¡ÜtiÚCr[1] *…_IÅ->
WeightCr
 > 
DISTBLK_MAX
)

195 
	`´štf
("Ov”æow: % : %d \ÀMB: %d, V®ue: %lf\n", 
__FILE__
, 
__LINE__
, 
cu¼MB
->
mbAddrX
, (
di¡ÜtiÚY
 * 
p_IÅ
->
WeightY
 + 
di¡ÜtiÚCr
[0] *…_IÅ->
WeightCb
 + di¡ÜtiÚCr[1] *…_IÅ->
WeightCr
));

196 
	`ex™
(-1);

199  (
di¡blk
)Ð
di¡ÜtiÚY
 * 
p_IÅ
->
WeightY
 + 
di¡ÜtiÚCr
[0] *…_IÅ->
WeightCb
 + di¡ÜtiÚCr[1] *…_IÅ->
WeightCr
 );

200 
	}
}

	@lencod/src/md_high.c

11 
	~<m©h.h
>

12 
	~<lim™s.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"rdÝt_codšg_¡©e.h
"

17 
	~"šŒ¬eäesh.h
"

18 
	~"image.h
"

19 
	~"¿‹ùl.h
"

20 
	~"mode_decisiÚ.h
"

21 
	~"mode_decisiÚ_p8x8.h
"

22 
	~"fmo.h
"

23 
	~"me_umhex.h
"

24 
	~"me_umhexsmp.h
"

25 
	~"maüoblock.h
"

26 
	~"md_commÚ.h
"

27 
	~"cÚfÜmªû.h
"

28 
	~"vlc.h
"

29 
	~"rdÝt.h
"

30 
	~"mv_£¬ch.h
"

38 
	$’code_Úe_maüoblock_high
 (
Maüoblock
 *
cu¼MB
)

40 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

41 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

42 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

43 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

44 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

46 
max_šdex
 = 9;

47 
block
, 
šdex
, 
mode
, 
i
, 
j
;

48 
RD_PARAMS
 
’c_mb
;

49 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

50 
di¡blk
 
co¡
=0;

51 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

52 
šŒa1
 = 0;

53 
mb_avažabË
[3];

55 
b¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

56 
p¦iû
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

57 
šŒa
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
è|| (
p¦iû
 && 
cu¼MB
->
mb_y
 =ð
p_Vid
->
mb_y_upd
 &&…_Vid->mb_y_upd !ðp_Vid->
mb_y_šŒa
));

58 
Ïmbda_mf
[3];

60 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

61 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

63 
chroma_´ed_mode_¿nge
[2];

64 
š‹r_sk
 = 0;

65 
Be¡Mode
 
md_be¡
;

66 
Info8x8
 
be¡
;

69 
	`š™_md_be¡
(&
md_be¡
);

72 
be¡
.
pdœ
 = 0;

73 
be¡
.
b»d
 = 0;

74 
be¡
.
»f
[
LIST_0
] = 0;

75 
be¡
.
»f
[
LIST_1
] = -1;

77 
šŒa
 |ð
	`RªdomIÁ¿
 (
p_Vid
, 
cu¼MB
->
mbAddrX
);

80 
	`š™_’c_mb_·¿ms
(
cu¼MB
, &
’c_mb
, 
šŒa
);

81 ià(
p_IÅ
->
Ad­tiveRoundšg
)

83 
	`»£t_ad­tive_roundšg
(
p_Vid
);

86 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

88 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

93 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

95 ià(!
šŒa
)

98 ià(
’c_mb
.
v®id
[0])

100 ià(
b¦iû
)

101 
cu¼Sliû
->
	`G‘_Dœeù_MÙiÚ_VeùÜs
 (
cu¼MB
);

103 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

105 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

107 
	`g‘_š™Ÿl_mb16x16_co¡
(
cu¼MB
);

111 
mode
 = 1; mode < 4; mode++)

113 
be¡
.
mode
 = () mode;

114 
be¡
.
b»d
 = 0;

115 
b8x8šfo
->
be¡
[
mode
][0].
b»d
 = 0;

117 ià(
’c_mb
.
v®id
[
mode
])

119 
co¡
=0, 
block
=0; block<(
mode
==1?1:2); block++)

121 
	`upd©e_Ïmbda_co¡s
(
cu¼MB
, &
’c_mb
, 
Ïmbda_mf
);

122 
	`P¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

125 
j
 = (
block
==1 && 
mode
==2 ? 2 : 0);

126 
i
 = (
block
==1 && 
mode
==3 ? 2 : 0);

129 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

130 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

132 ià(
b¦iû
)

135 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

136 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

139 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

142 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

144 
	`g‘_b»d_co¡
(
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, &
be¡
, &
’c_mb
, 
bmco¡
);

148 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

149 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

153 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, &
co¡
);

157 
be¡
.
pdœ
 = 0;

158 
co¡
 +ð
bmco¡
[
LIST_0
];

161 
	`assign_’c_piùu»_·¿ms
(
cu¼MB
, 
mode
, &
be¡
, 2 * 
block
);

164 
	`£t_block8x8_šfo
(
b8x8šfo
, 
mode
, 
block
, &
be¡
);

167 ià(
mode
>1 && 
block
 == 0)

168 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
be¡
, 
block
);

170 ià(
co¡
 < 
mš_co¡
)

172 
md_be¡
.
mode
 = (
by‹
) mode;

173 
md_be¡
.
co¡
 = cost;

174 
cu¼MB
->
be¡_mode
 = (è
mode
;

175 
mš_co¡
 = 
co¡
;

176 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

178 
	`adju¡_mb16x16_co¡
(
cu¼MB
, 
co¡
);

184 ià(
’c_mb
.
v®id
[
P8x8
])

186 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

188 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

190 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ8x8
);

191 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

196 
block
 = 0; block < 4; block++)

198 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ8x8
,…_RDO->
cofAC8x8ts
[
block
], block, &
co¡
);

199 if(!
cu¼MB
->
v®id_8x8
)

201 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ8x8
);

206 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

207 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

209 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

210 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ4x4
);

215 
block
 = 0; block < 4; block++)

217 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ4x4
,…_RDO->
cÛfAC8x8
[
block
], block, &
co¡
);

218 if(!
cu¼MB
->
v®id_4x4
)

220 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ4x4
);

224 ià(
p_IÅ
->
RCEÇbË
)

225 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

227 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

232 
mš_co¡
 = 
DISTBLK_MAX
;

236 
	`£t_chroma_´ed_mode
(
cu¼MB
, 
’c_mb
, 
mb_avažabË
, 
chroma_´ed_mode_¿nge
);

241 
cu¼MB
->
c_»d_mode
 = 
chroma_´ed_mode_¿nge
[0]; currMB->c_ipred_mode<=chroma_pred_mode_range[1]; currMB->c_ipred_mode++)

244 iàÐ(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
) &&

245 Ð((!
šŒa
 || !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
cu¼MB
->
c_»d_mode
!=
DC_PRED_8
)

246 || (
cu¼MB
->
c_»d_mode
 =ð
VERT_PRED_8
 && !
mb_avažabË
[0])

247 || (
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 && !
mb_avažabË
[1])

248 || (
cu¼MB
->
c_»d_mode
 =ð
PLANE_8
 && (!
mb_avažabË
[1] || !mb_available[0] || !mb_available[2]))))

252 
šdex
=0; index < 
max_šdex
; index++)

254 
mode
 = 
mb_mode_bË
[
šdex
];

256 ià(
’c_mb
.
v®id
[
mode
])

259 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

261 
cu¼MB
->
i16mode
 = 0;

265 ià(
cu¼Sliû
->
P444_jošed
)

267 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I16MB


268 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,5)))

273 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
)

275 ià(!
šŒa
 && 
mode
 >ð
I4MB
)

277 ià(
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
, 5)))

281 ià(
cu¼MB
->
be¡_mode
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,6)))

289 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

296 
	`»¡Üe_nz_cÛff
(
cu¼MB
);

298 
šŒa1
 = 
	`is_šŒa
(
cu¼MB
);

302 
	`upd©e_qp_cbp_tmp
(
cu¼MB
, 
p_RDO
->
cbp
);

303 
cu¼Sliû
->
	`£t_¡Üed_mb_·¿m‘”s
 (
cu¼MB
);

306 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

307 
	`rc_¡Üe_mad
(
cu¼MB
);

311 ià(
p_IÅ
->
Re¡riùRef
)

312 
	`upd©e_»äesh_m­
(
cu¼MB
, 
šŒa
, 
šŒa1
);

313 
	}
}

	@lencod/src/md_high_updated.c

13 
	~<m©h.h
>

14 
	~<lim™s.h
>

15 
	~<æßt.h
>

17 
	~"glob®.h
"

18 
	~"rdÝt_codšg_¡©e.h
"

19 
	~"šŒ¬eäesh.h
"

20 
	~"image.h
"

21 
	~"¿‹ùl.h
"

22 
	~"mode_decisiÚ.h
"

23 
	~"mode_decisiÚ_p8x8.h
"

24 
	~"fmo.h
"

25 
	~"me_umhex.h
"

26 
	~"me_umhexsmp.h
"

27 
	~"maüoblock.h
"

28 
	~"md_commÚ.h
"

29 
	~"cÚfÜmªû.h
"

30 
	~"vlc.h
"

31 
	~"rdÝt.h
"

32 
	~"mv_£¬ch.h
"

40 
	$’code_Úe_maüoblock_high_upd©ed
 (
Maüoblock
 *
cu¼MB
)

42 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

43 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

44 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

45 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

46 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

48 
max_šdex
 = 9;

49 
block
, 
šdex
, 
mode
, 
i
, 
j
;

50 
RD_PARAMS
 
’c_mb
;

51 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

52 
di¡blk
 
co¡
=0;

53 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

54 
šŒa1
 = 0;

55 
mb_avažabË
[3];

57 
b¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

58 
p¦iû
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

59 
šŒa
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
è|| (
p¦iû
 && 
cu¼MB
->
mb_y
 =ð
p_Vid
->
mb_y_upd
 &&…_Vid->mb_y_upd !ðp_Vid->
mb_y_šŒa
));

60 
Ïmbda_mf
[3];

62 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

63 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

65 
chroma_´ed_mode_¿nge
[2];

66 
š‹r_sk
 = 0;

67 
Be¡Mode
 
md_be¡
;

68 
Info8x8
 
be¡
;

71 
	`š™_md_be¡
(&
md_be¡
);

74 
be¡
.
pdœ
 = 0;

75 
be¡
.
b»d
 = 0;

76 
be¡
.
»f
[
LIST_0
] = 0;

77 
be¡
.
»f
[
LIST_1
] = -1;

79 
šŒa
 |ð
	`RªdomIÁ¿
 (
p_Vid
, 
cu¼MB
->
mbAddrX
);

82 
	`š™_’c_mb_·¿ms
(
cu¼MB
, &
’c_mb
, 
šŒa
);

83 ià(
p_IÅ
->
Ad­tiveRoundšg
)

85 
	`»£t_ad­tive_roundšg
(
p_Vid
);

88 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

90 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

95 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

97 ià(!
šŒa
)

100 ià(
’c_mb
.
v®id
[0])

102 ià(
b¦iû
)

103 
cu¼Sliû
->
	`G‘_Dœeù_MÙiÚ_VeùÜs
 (
cu¼MB
);

105 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

107 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

109 
	`g‘_š™Ÿl_mb16x16_co¡
(
cu¼MB
);

113 
mode
 = 1; mode < 4; mode++)

115 
be¡
.
mode
 = () mode;

116 
be¡
.
b»d
 = 0;

117 
b8x8šfo
->
be¡
[
mode
][0].
b»d
 = 0;

119 ià(
’c_mb
.
v®id
[
mode
])

121 
co¡
=0, 
block
=0; block<(
mode
==1?1:2); block++)

123 
	`upd©e_Ïmbda_co¡s
(
cu¼MB
, &
’c_mb
, 
Ïmbda_mf
);

124 
	`P¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

127 
j
 = (
block
==1 && 
mode
==2 ? 2 : 0);

128 
i
 = (
block
==1 && 
mode
==3 ? 2 : 0);

131 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

132 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

134 ià(
b¦iû
)

137 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

138 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

141 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

144 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

146 
	`g‘_b»d_co¡
(
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, &
be¡
, &
’c_mb
, 
bmco¡
);

150 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

151 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

155 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, &
co¡
);

159 
be¡
.
pdœ
 = 0;

160 
co¡
 +ð
bmco¡
[
LIST_0
];

163 
	`assign_’c_piùu»_·¿ms
(
cu¼MB
, 
mode
, &
be¡
, 2 * 
block
);

166 
	`£t_block8x8_šfo
(
b8x8šfo
, 
mode
, 
block
, &
be¡
);

169 ià(
mode
>1 && 
block
 == 0)

170 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
be¡
, 
block
);

172 ià(
co¡
 < 
mš_co¡
)

174 
md_be¡
.
mode
 = (
by‹
) mode;

175 
md_be¡
.
co¡
 = cost;

176 
cu¼MB
->
be¡_mode
 = (è
mode
;

177 
mš_co¡
 = 
co¡
;

178 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

180 
	`adju¡_mb16x16_co¡
(
cu¼MB
, 
co¡
);

186 ià(
’c_mb
.
v®id
[
P8x8
])

188 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

190 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

192 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ8x8
);

193 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

198 
block
 = 0; block < 4; block++)

200 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ8x8
,…_RDO->
cofAC8x8ts
[
block
], block, &
co¡
);

201 if(!
cu¼MB
->
v®id_8x8
)

203 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ8x8
);

208 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

209 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

211 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

212 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ4x4
);

217 
block
 = 0; block < 4; block++)

219 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ4x4
,…_RDO->
cÛfAC8x8
[
block
], block, &
co¡
);

220 if(!
cu¼MB
->
v®id_4x4
)

222 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ4x4
);

226 ià(
p_IÅ
->
RCEÇbË
)

227 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

229 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

234 
mš_co¡
 = 
DISTBLK_MAX
;

238 
	`£t_chroma_´ed_mode
(
cu¼MB
, 
’c_mb
, 
mb_avažabË
, 
chroma_´ed_mode_¿nge
);

243 
cu¼MB
->
c_»d_mode
 = 
chroma_´ed_mode_¿nge
[0]; currMB->c_ipred_mode<=chroma_pred_mode_range[1]; currMB->c_ipred_mode++)

246 iàÐ(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
) &&

247 Ð((!
šŒa
 || !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
cu¼MB
->
c_»d_mode
!=
DC_PRED_8
)

248 || (
cu¼MB
->
c_»d_mode
 =ð
VERT_PRED_8
 && !
mb_avažabË
[0])

249 || (
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 && !
mb_avažabË
[1])

250 || (
cu¼MB
->
c_»d_mode
 =ð
PLANE_8
 && (!
mb_avažabË
[1] || !mb_available[0] || !mb_available[2]))))

254 
šdex
=0; index < 
max_šdex
; index++)

256 ià(
p¦iû
)

257 
mode
 = 
mb_mode_bË_upd©ed
[
šdex
];

259 
mode
 = 
mb_mode_bË
[
šdex
];

261 ià(
’c_mb
.
v®id
[
mode
])

264 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

266 
cu¼MB
->
i16mode
 = 0;

282 ià((
p¦iû
è&& 
mode
 == 0)

284 
MÙiÚVeùÜ
 *
®lmvs
 = &
cu¼Sliû
->
®l_mv
[0][0][0][0][0];

285 
p_IÅ
->
PSliûSkDecisiÚM‘hod
)

288 ifÐ!(
cu¼MB
->
be¡_mode
 =ð1 && cu¼MB->
cbp
==0 &&

289 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

290 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 =ð
®lmvs
->mv_x &&

291 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 =ð
®lmvs
->mv_y))

297 iàÐ!(
cu¼MB
->
be¡_mode
 == 1 &&

298 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

299 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 =ð
®lmvs
->mv_x &&

300 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 =ð
®lmvs
->mv_y))

306 iàÐ!(
cu¼MB
->
be¡_mode
 == 1 &&

307 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

308 
	`Ÿbs
(
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 - 
®lmvs
->mv_x) < 8 &&

309 
	`Ÿbs
(
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 - 
®lmvs
->mv_y) < 8))

315 iàÐ
cu¼MB
->
cbp
 != 0 )

321 iàÐ!(
cu¼MB
->
cbp
 =ð0 || (cu¼MB->
be¡_mode
 == 1 &&

322 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

323 
	`Ÿbs
(
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 - 
®lmvs
->mv_x) < 8 &&

324 
	`Ÿbs
(
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 - 
®lmvs
->mv_y) < 8)))

337 ià(
cu¼Sliû
->
P444_jošed
)

339 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I16MB


340 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,5)))

345 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
)

347 ià(!
šŒa
 && 
mode
 >ð
I4MB
)

349 ià(
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
, 5)))

353 ià(
cu¼MB
->
be¡_mode
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,6)))

361 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

368 
	`»¡Üe_nz_cÛff
(
cu¼MB
);

370 
šŒa1
 = 
	`is_šŒa
(
cu¼MB
);

374 
	`upd©e_qp_cbp_tmp
(
cu¼MB
, 
p_RDO
->
cbp
);

375 
cu¼Sliû
->
	`£t_¡Üed_mb_·¿m‘”s
 (
cu¼MB
);

378 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

379 
	`rc_¡Üe_mad
(
cu¼MB
);

383 ià(
p_IÅ
->
Re¡riùRef
)

384 
	`upd©e_»äesh_m­
(
cu¼MB
, 
šŒa
, 
šŒa1
);

385 
	}
}

	@lencod/src/md_highfast.c

11 
	~<m©h.h
>

12 
	~<lim™s.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"rdÝt_codšg_¡©e.h
"

17 
	~"mb_acûss.h
"

18 
	~"šŒ¬eäesh.h
"

19 
	~"image.h
"

20 
	~"¿‹ùl.h
"

21 
	~"mode_decisiÚ.h
"

22 
	~"mode_decisiÚ_p8x8.h
"

23 
	~"fmo.h
"

24 
	~"me_umhex.h
"

25 
	~"me_umhexsmp.h
"

26 
	~"maüoblock.h
"

27 
	~"md_commÚ.h
"

28 
	~"cÚfÜmªû.h
"

29 
	~"vlc.h
"

30 
	~"rdÝt.h
"

31 
	~"mv_£¬ch.h
"

40 
	$ç¡_mode_šŒa_decisiÚ
(
Maüoblock
 *
cu¼MB
, *
šŒa_sk
)

42 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

43 
i
;

44 
mb_avažabË_up
, 
mb_avažabË_Ëá
;

45 
SBE
;

46 
AR
 = 0, 
ABE
 = 0;

47 
Pix–Pos
 
up
;

48 
Pix–Pos
 
Ëá
[2];

50 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, 0 , -1 ,…_Vid->
mb_size
[
IS_LUMA
], &
up
);

51 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , -1 ,…_Vid->
mb_size
[
IS_LUMA
], &
Ëá
[0]);

52 
p_Vid
->
	`g‘Neighbour
(
cu¼MB
, -1 , 0 ,…_Vid->
mb_size
[
IS_LUMA
], &
Ëá
[1]);

54 
mb_avažabË_up
 = 
up
.
avažabË
;

55 
mb_avažabË_Ëá
 = 
Ëá
[1].
avažabË
;

57 
AR
=(1.0/384)*
cu¼MB
->
mš_¿‹
;

59 
SBE
 = 0;

61 ifÐ(
cu¼MB
->
mb_y
 !ð()
p_Vid
->
F¿meHeightInMbs
-1è&& (cu¼MB->
mb_x
 !ð(í_Vid->
PicWidthInMbs
-1è&& 
mb_avažabË_Ëá
 && 
mb_avažabË_up
)

63 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

65 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
][cu¼MB->
pix_x
 + 
i
] -…_Vid->
’c_piùu»
->
imgY
[cu¼MB->
pix_y
 - 1][currMB->pix_x + i]);

66 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
i
][cu¼MB->
pix_x
] -…_Vid->
’c_piùu»
->
imgY
[cu¼MB->
pix_y
 + i][currMB->pix_x - 1]);

69 
i
 = 0; i < 8; i++)

71 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_c_y
][cu¼MB->
pix_c_x
 + 
i
] -…_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_c_y
 - 1][currMB->pix_c_x + i]);

72 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_c_y
+
i
][cu¼MB->
pix_c_x
] -…_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_c_y
 + i][currMB->pix_c_x - 1]);

73 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_c_y
][cu¼MB->
pix_c_x
 + 
i
] -…_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_c_y
 - 1][currMB->pix_c_x + i]);

74 
SBE
 +ð
	`Ÿbs
(
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_c_y
+
i
][cu¼MB->
pix_c_x
] -…_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_c_y
 + i][currMB->pix_c_x - 1]);

76 
ABE
 = 1.0/64 * 
SBE
;

80 
ABE
 = 0;

83 if(
AR
 <ð
ABE
)

85 *
šŒa_sk
 = 1;

87 
	}
}

95 
	$’code_Úe_maüoblock_highç¡
 (
Maüoblock
 *
cu¼MB
)

97 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

98 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

99 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

100 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

101 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

103 
max_šdex
;

104 
block
, 
šdex
, 
mode
, 
i
, 
j
;

105 
RD_PARAMS
 
’c_mb
;

106 
di¡blk
 
max_rdco¡
 = 
DISTBLK_MAX
;

107 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

108 
di¡blk
 
co¡
=0;

109 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

110 
šŒa1
 = 0;

111 
mb_avažabË
[3];

113 
i¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
);

114 
b¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

115 
p¦iû
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

116 
šŒa
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
è|| (
p¦iû
 && 
cu¼MB
->
mb_y
 =ð
p_Vid
->
mb_y_upd
 &&…_Vid->mb_y_upd !ðp_Vid->
mb_y_šŒa
));

117 
Ïmbda_mf
[3];

119 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

120 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

122 
chroma_´ed_mode_¿nge
[2];

125 
MÙiÚVeùÜ
 *
®lmvs
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è? 
NULL
: &cu¼Sliû->
®l_mv
[0][0][0][0][0];

128 
š‹r_sk
 = 0, 
šŒa_sk
 = 0;

129 
mode16
 = 0;

130 
di¡blk
 
RDCo¡16
 = 
DISTBLK_MAX
;

131 
Be¡Mode
 
md_be¡
;

132 
Info8x8
 
be¡
;

134 
	`š™_md_be¡
(&
md_be¡
);

137 
be¡
.
pdœ
 = 0;

138 
be¡
.
b»d
 = 0;

139 
be¡
.
»f
[
LIST_0
] = 0;

140 
be¡
.
»f
[
LIST_1
] = -1;

142 
šŒa
 |ð
	`RªdomIÁ¿
 (
p_Vid
, 
cu¼MB
->
mbAddrX
);

145 
	`š™_’c_mb_·¿ms
(
cu¼MB
, &
’c_mb
, 
šŒa
);

146 ià(
p_IÅ
->
Ad­tiveRoundšg
)

148 
	`»£t_ad­tive_roundšg
(
p_Vid
);

151 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

153 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

158 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

160 ià(!
šŒa
)

163 ià(
b¦iû
 && 
’c_mb
.
v®id
[0])

165 
cu¼Sliû
->
	`G‘_Dœeù_MÙiÚ_VeùÜs
 (
cu¼MB
);

166 
cu¼MB
->
be¡_mode
 = 0;

167 
cu¼MB
->
c_»d_mode
=
DC_PRED_8
;

168 
cu¼MB
->
mš_rdco¡
 = 
max_rdco¡
;

169 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, 0, &
š‹r_sk
);

171 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

173 
	`g‘_š™Ÿl_mb16x16_co¡
(
cu¼MB
);

177 
mode
 = 1; mode < 4; mode++)

179 
be¡
.
mode
 = () mode;

180 
be¡
.
b»d
 = 0;

181 
b8x8šfo
->
be¡
[
mode
][0].
b»d
 = 0;

183 ià(
’c_mb
.
v®id
[
mode
] && !
š‹r_sk
)

185 
co¡
=0, 
block
=0; block<(
mode
==1?1:2); block++)

187 
	`upd©e_Ïmbda_co¡s
(
cu¼MB
, &
’c_mb
, 
Ïmbda_mf
);

188 
	`P¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

191 
j
 = (
block
==1 && 
mode
==2 ? 2 : 0);

192 
i
 = (
block
==1 && 
mode
==3 ? 2 : 0);

195 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

196 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

198 ià(
b¦iû
)

201 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

202 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

205 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

208 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

210 
	`g‘_b»d_co¡
(
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, &
be¡
, &
’c_mb
, 
bmco¡
);

214 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

215 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

219 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, &
co¡
);

223 
be¡
.
pdœ
 = 0;

224 
co¡
 +ð
bmco¡
[
LIST_0
];

227 
	`assign_’c_piùu»_·¿ms
(
cu¼MB
, 
mode
, &
be¡
, 2 * 
block
);

230 
	`£t_block8x8_šfo
(
b8x8šfo
, 
mode
, 
block
, &
be¡
);

233 ià(
mode
>1 && 
block
 == 0)

234 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
be¡
, 
block
);

238 if(
mode
 == 1)

240 if(
p¦iû
)

241 
cu¼MB
->
mš_rdco¡
 = 
max_rdco¡
;

243 
cu¼MB
->
c_»d_mode
=
DC_PRED_8
;

244 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

246 if(
p¦iû
)

249 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

251 if(
p_IÅ
->
E¬lySkEÇbË
)

254 iàÐ
cu¼MB
->
cbp
==0 && 
mÙiÚ
[cu¼MB->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
]==0 &&

255 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
[
LIST_0
].
mv_x
 =ð
®lmvs
->mv_x &&

256 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
[
LIST_0
].
mv_y
 =ð
®lmvs
->mv_y)

258 
š‹r_sk
 = 1;

259 
cu¼MB
->
be¡_mode
 = 0;

265 
RDCo¡16
 = 
cu¼MB
->
mš_rdco¡
;

266 
mode16
 = 
cu¼MB
->
be¡_mode
;

269 ià((!
š‹r_sk
è&& (
co¡
 < 
mš_co¡
))

271 
md_be¡
.
mode
 = (
by‹
) mode;

272 
md_be¡
.
co¡
 = cost;

273 
cu¼MB
->
be¡_mode
 = (è
mode
;

274 
mš_co¡
 = 
co¡
;

275 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

277 
	`adju¡_mb16x16_co¡
(
cu¼MB
, 
co¡
);

283 ià((!
š‹r_sk
è&& 
’c_mb
.
v®id
[
P8x8
])

285 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

287 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

289 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ8x8
);

290 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

295 
block
 = 0; block < 4; block++)

297 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ8x8
,…_RDO->
cofAC8x8ts
[
block
], block, &
co¡
);

298 if(!
cu¼MB
->
v®id_8x8
)

300 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ8x8
);

304 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

305 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

307 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

308 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ4x4
);

313 
block
 = 0; block < 4; block++)

315 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ4x4
,…_RDO->
cÛfAC8x8
[
block
], block, &
co¡
);

316 if(!
cu¼MB
->
v®id_4x4
)

318 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ4x4
);

322 ià(
p_IÅ
->
RCEÇbË
)

323 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

325 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

330 
mš_co¡
 = 
DISTBLK_MAX
;

336 ià(!
š‹r_sk
)

338 if(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

340 
cu¼MB
->
mš_rdco¡
 = 
RDCo¡16
;

341 
cu¼MB
->
be¡_mode
 = (è
mode16
;

344 
cu¼MB
->
mš_rdco¡
 = 
max_rdco¡
;

347 
max_šdex
 = ((!
šŒa
 && 
p_IÅ
->
S–eùiveIÁ¿EÇbË
 ) ? 5 : 9);

350 
	`£t_chroma_´ed_mode
(
cu¼MB
, 
’c_mb
, 
mb_avažabË
, 
chroma_´ed_mode_¿nge
);

355 
cu¼MB
->
c_»d_mode
 = 
chroma_´ed_mode_¿nge
[0]; currMB->c_ipred_mode<=chroma_pred_mode_range[1]; currMB->c_ipred_mode++)

358 iàÐ(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
) &&

359 Ð((!
šŒa
 || !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
cu¼MB
->
c_»d_mode
!=
DC_PRED_8
)

360 || (
cu¼MB
->
c_»d_mode
 =ð
VERT_PRED_8
 && !
mb_avažabË
[0])

361 || (
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 && !
mb_avažabË
[1])

362 || (
cu¼MB
->
c_»d_mode
 =ð
PLANE_8
 && (!
mb_avažabË
[1] || !mb_available[0] || !mb_available[2]))))

366 
šdex
=0; index < 
max_šdex
; index++)

368 
mode
 = 
mb_mode_bË
[
šdex
];

369 ià(
mode
 == 1)

371 ià(
’c_mb
.
v®id
[
mode
])

373 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

375 
cu¼MB
->
i16mode
 = 0;

379 ià(
cu¼Sliû
->
P444_jošed
)

381 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I16MB


382 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
, 5)))

387 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I4MB
 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,5)))

391 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

398 if((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
è&& 
p_IÅ
->
S–eùiveIÁ¿EÇbË
 && !
	`is_FREXT_´ofže
Õ_IÅ->
ProfžeIDC
))

400 
	`ç¡_mode_šŒa_decisiÚ
(
cu¼MB
, &
šŒa_sk
);

402 if(!
šŒa_sk
)

405 
	`£t_chroma_´ed_mode
(
cu¼MB
, 
’c_mb
, 
mb_avažabË
, 
chroma_´ed_mode_¿nge
);

407 
max_šdex
 = 9;

409 
cu¼MB
->
c_»d_mode
=
chroma_´ed_mode_¿nge
[0]; currMB->c_ipred_mode<=chroma_pred_mode_range[1]; currMB->c_ipred_mode++)

413 iàÐ(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
) &&

414 Ð((!
šŒa
 || !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
cu¼MB
->
c_»d_mode
!=
DC_PRED_8
)

415 || (
cu¼MB
->
c_»d_mode
 =ð
VERT_PRED_8
 && !
mb_avažabË
[0])

416 || (
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 && !
mb_avažabË
[1])

417 || (
cu¼MB
->
c_»d_mode
 =ð
PLANE_8
 && (!
mb_avažabË
[0] || !mb_available[1]|| !mb_available[2]))))

421 
šdex
 = 5; index < 
max_šdex
; index++)

423 
mode
 = 
mb_mode_bË
[
šdex
];

426 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I4MB
 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 == 0)

429 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

431 
cu¼MB
->
i16mode
 = 0;

433 if(((
b¦iû
 && 
mode
 =ð0è|| (!
i¦iû
 && mode == 1)))

437 ià(
’c_mb
.
v®id
[
mode
])

438 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

444 
	`»¡Üe_nz_cÛff
(
cu¼MB
);

448 
šŒa1
 = 
	`is_šŒa
(
cu¼MB
);

452 
	`upd©e_qp_cbp_tmp
(
cu¼MB
, 
p_RDO
->
cbp
);

453 
cu¼Sliû
->
	`£t_¡Üed_mb_·¿m‘”s
 (
cu¼MB
);

456 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

457 
	`rc_¡Üe_mad
(
cu¼MB
);

460 ià(
p_IÅ
->
Re¡riùRef
)

461 
	`upd©e_»äesh_m­
(
cu¼MB
, 
šŒa
, 
šŒa1
);

463 
	}
}

	@lencod/src/md_highloss.c

11 
	~<m©h.h
>

12 
	~<lim™s.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"rdÝt_codšg_¡©e.h
"

17 
	~"šŒ¬eäesh.h
"

18 
	~"image.h
"

19 
	~"¿‹ùl.h
"

20 
	~"mode_decisiÚ.h
"

21 
	~"mode_decisiÚ_p8x8.h
"

22 
	~"fmo.h
"

23 
	~"me_umhex.h
"

24 
	~"me_umhexsmp.h
"

25 
	~"maüoblock.h
"

26 
	~"md_commÚ.h
"

27 
	~"cÚfÜmªû.h
"

28 
	~"vlc.h
"

29 
	~"rdÝt.h
"

30 
	~"mv_£¬ch.h
"

38 
	$’code_Úe_maüoblock_highloss
 (
Maüoblock
 *
cu¼MB
)

40 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

41 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

42 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

43 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

44 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

46 
max_šdex
 = 9;

47 
»run
, 
block
, 
šdex
, 
mode
, 
i
, 
j
;

48 
RD_PARAMS
 
’c_mb
;

49 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

50 
di¡blk
 
co¡
=0;

51 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

52 
šŒa1
 = 0;

53 
mb_avažabË
[3];

55 
b¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

56 
p¦iû
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

57 
šŒa
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
è|| (
p¦iû
 && 
cu¼MB
->
mb_y
 =ð
p_Vid
->
mb_y_upd
 &&…_Vid->mb_y_upd !ðp_Vid->
mb_y_šŒa
));

58 
Ïmbda_mf
[3];

59 
runs
 = (è((
p_IÅ
->
Re¡riùRef
==1 && (
p¦iû
 || (
b¦iû
 && 
p_Vid
->
Çl_»ã»nû_idc
>0))) ? 2 : 1);

61 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

62 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

64 
chroma_´ed_mode_¿nge
[2];

65 
š‹r_sk
 = 0;

66 
Be¡Mode
 
md_be¡
;

67 
Info8x8
 
be¡
;

69 
	`š™_md_be¡
(&
md_be¡
);

72 
be¡
.
pdœ
 = 0;

73 
be¡
.
b»d
 = 0;

74 
be¡
.
»f
[
LIST_0
] = 0;

75 
be¡
.
»f
[
LIST_1
] = -1;

77 
šŒa
 |ð
	`RªdomIÁ¿
 (
p_Vid
, 
cu¼MB
->
mbAddrX
);

80 
	`š™_’c_mb_·¿ms
(
cu¼MB
, &
’c_mb
, 
šŒa
);

83 
»run
=0;„”un<
runs
;„erun++)

85 ià(
runs
==2)

86 
p_IÅ
->
rdÝt
ð(
»run
==0) ? 1 : 3;

88 ià(
p_IÅ
->
Ad­tiveRoundšg
)

90 
	`»£t_ad­tive_roundšg
(
p_Vid
);

93 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

95 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

100 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

102 ià(!
šŒa
)

105 ià(
’c_mb
.
v®id
[0])

107 ià(
b¦iû
)

108 
cu¼Sliû
->
	`G‘_Dœeù_MÙiÚ_VeùÜs
 (
cu¼MB
);

110 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

112 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

114 
	`g‘_š™Ÿl_mb16x16_co¡
(
cu¼MB
);

118 
mode
 = 1; mode < 4; mode++)

120 
be¡
.
mode
 = () mode;

121 
be¡
.
b»d
 = 0;

122 
b8x8šfo
->
be¡
[
mode
][0].
b»d
 = 0;

124 ià(
’c_mb
.
v®id
[
mode
])

126 
co¡
=0, 
block
=0; block<(
mode
==1?1:2); block++)

128 
	`upd©e_Ïmbda_co¡s
(
cu¼MB
, &
’c_mb
, 
Ïmbda_mf
);

129 
	`P¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

132 
j
 = (
block
==1 && 
mode
==2 ? 2 : 0);

133 
i
 = (
block
==1 && 
mode
==3 ? 2 : 0);

136 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

137 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

139 ià(
b¦iû
)

142 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

143 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

146 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

149 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

151 
	`g‘_b»d_co¡
(
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, &
be¡
, &
’c_mb
, 
bmco¡
);

155 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

156 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

160 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, &
co¡
);

164 
be¡
.
pdœ
 = 0;

165 
co¡
 +ð
bmco¡
[
LIST_0
];

168 
	`assign_’c_piùu»_·¿ms
(
cu¼MB
, 
mode
, &
be¡
, 2 * 
block
);

171 
	`£t_block8x8_šfo
(
b8x8šfo
, 
mode
, 
block
, &
be¡
);

174 ià(
mode
>1 && 
block
==0)

175 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
be¡
, 
block
);

177 ià(
co¡
 < 
mš_co¡
)

179 
md_be¡
.
mode
 = (
by‹
) mode;

180 
md_be¡
.
co¡
 = cost;

181 
cu¼MB
->
be¡_mode
 = (è
mode
;

182 
mš_co¡
 = 
co¡
;

183 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

185 
	`adju¡_mb16x16_co¡
(
cu¼MB
, 
co¡
);

191 ià(
’c_mb
.
v®id
[
P8x8
])

193 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

195 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

197 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ8x8
);

198 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

203 
block
 = 0; block < 4; block++)

205 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ8x8
,…_RDO->
cofAC8x8ts
[
block
], block, &
co¡
);

206 if(!
cu¼MB
->
v®id_8x8
)

208 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ8x8
);

212 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

213 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

215 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

216 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ4x4
);

221 
block
 = 0; block < 4; block++)

223 
cu¼Sliû
->
	`submaüoblock_mode_decisiÚ
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ4x4
,…_RDO->
cÛfAC8x8
[
block
], block, &
co¡
);

224 if(!
cu¼MB
->
v®id_4x4
)

226 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ4x4
);

231 ià(
p_IÅ
->
RCEÇbË
)

232 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

234 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

239 
mš_co¡
 = 
DISTBLK_MAX
;

243 
	`£t_chroma_´ed_mode
(
cu¼MB
, 
’c_mb
, 
mb_avažabË
, 
chroma_´ed_mode_¿nge
);

247 
cu¼MB
->
c_»d_mode
 = 
chroma_´ed_mode_¿nge
[0]; currMB->c_ipred_mode<=chroma_pred_mode_range[1]; currMB->c_ipred_mode++)

250 iàÐ(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
) &&

251 Ð((!
šŒa
 || !
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
è&&…_IÅ->
ChromaIÁ¿Di§bË
 =ð1 && 
cu¼MB
->
c_»d_mode
!=
DC_PRED_8
)

252 || (
cu¼MB
->
c_»d_mode
 =ð
VERT_PRED_8
 && !
mb_avažabË
[0])

253 || (
cu¼MB
->
c_»d_mode
 =ð
HOR_PRED_8
 && !
mb_avažabË
[1])

254 || (
cu¼MB
->
c_»d_mode
 =ð
PLANE_8
 && (!
mb_avažabË
[1] || !mb_available[0] || !mb_available[2]))))

258 
šdex
=0; index < 
max_šdex
; index++)

260 
mode
 = 
mb_mode_bË
[
šdex
];

261 ià(
’c_mb
.
v®id
[
mode
])

263 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

265 
cu¼MB
->
i16mode
 = 0;

269 ià(
cu¼Sliû
->
P444_jošed
)

271 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
 && !
šŒa
 && 
mode
 >ð
I16MB


272 && 
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,5)))

277 ià(
p_IÅ
->
SkIÁ¿InIÁ”Sliûs
)

279 ià(!
šŒa
 && 
mode
 >ð
I4MB
)

281 ià(
cu¼MB
->
be¡_mode
 <=3 && cu¼MB->
be¡_cbp
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
, 5)))

285 ià(
cu¼MB
->
be¡_mode
 =ð0 && (cu¼MB->
mš_rdco¡
 < 
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
,6)))

292 
	`compu‹_mode_RD_co¡
(
cu¼MB
, &
’c_mb
, (è
mode
, &
š‹r_sk
);

298 
	`»¡Üe_nz_cÛff
(
cu¼MB
);

300 ià(
»run
==0)

301 
šŒa1
 = 
	`is_šŒa
(
cu¼MB
);

306 
	`upd©e_qp_cbp_tmp
(
cu¼MB
, 
p_RDO
->
cbp
);

307 
cu¼Sliû
->
	`£t_¡Üed_mb_·¿m‘”s
 (
cu¼MB
);

310 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

311 
	`rc_¡Üe_mad
(
cu¼MB
);

314 ià(
p_IÅ
->
Re¡riùRef
)

315 
	`upd©e_»äesh_m­
(
cu¼MB
, 
šŒa
, 
šŒa1
);

316 
	}
}

	@lencod/src/md_low.c

12 
	~<m©h.h
>

13 
	~<lim™s.h
>

14 
	~<æßt.h
>

16 
	~"glob®.h
"

17 
	~"rdÝt_codšg_¡©e.h
"

18 
	~"mb_acûss.h
"

19 
	~"šŒ¬eäesh.h
"

20 
	~"image.h
"

21 
	~"ŒªsfÜm8x8.h
"

22 
	~"¿‹ùl.h
"

23 
	~"mode_decisiÚ.h
"

24 
	~"mode_decisiÚ_p8x8.h
"

25 
	~"fmo.h
"

26 
	~"me_umhex.h
"

27 
	~"me_umhexsmp.h
"

28 
	~"maüoblock.h
"

29 
	~"q_¬ound.h
"

30 
	~"vlc.h
"

31 
	~"md_commÚ.h
"

32 
	~"rdÝt.h
"

33 
	~"mem®loc.h
"

34 
	~"mc_´ediùiÚ.h
"

35 
	~"rd_šŒa_jm.h
"

43 
	$g‘_be¡_ŒªsfÜm_8x8
(
Maüoblock
 *
cu¼MB
)

45 if(
cu¼MB
->
p_IÅ
->
T¿nsfÜm8x8Mode
 == 2)

49 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

50 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼MB
->
p_Sliû
->p_RDO;

52 
diff16
[4][16];

53 
diff64
[64];

54 
pic_pix_y
, 
pic_pix_x
, 
i
, 
j
;

55 
mb_y
, 
mb_x
, 
block8x8
;

56 
di¡blk
 
co¡8x8
=0, 
co¡4x4
=0;

58 
block8x8
 = 0; block8x8 < 4; block8x8++)

60 *
tmp64
 = 
diff64
;

61 *
tmp16
[4];

62 
sourû_³l
, 
šdex
;

64 
tmp16
[0] = 
diff16
[0];

65 
tmp16
[1] = 
diff16
[1];

66 
tmp16
[2] = 
diff16
[2];

67 
tmp16
[3] = 
diff16
[3];

69 
mb_y
 = (
block8x8
 >> 1) << 3;

70 
mb_x
 = (
block8x8
 & 0x01) << 3;

73 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

74 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

76 
j
 = 
mb_y
; j < 8 + mb_y; j++)

78 
i
 = 
mb_x
; i < 8 + mb_x; i++)

80 
šdex
 = (è(2 * ((
j
 - 
mb_y
)> 3è+ ((
i
 - 
mb_x
)> 3));

81 
sourû_³l
 = 
p_Vid
->
pCurImg
[
pic_pix_y
 + 
j
][
pic_pix_x
 + 
i
];

82 *(
tmp16
[
šdex
])++ = (è(
sourû_³l
 - 
p_RDO
->
Œ4x4
->
m´8x8
[
j
][
i
]);

83 *
tmp64
++ = (è(
sourû_³l
 - 
p_RDO
->
Œ8x8
->
m´8x8
[
j
][
i
]);

87 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[0], 
DISTBLK_MAX
);

88 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[1], 
DISTBLK_MAX
);

89 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[2], 
DISTBLK_MAX
);

90 
co¡4x4
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[3], 
DISTBLK_MAX
);

91 
co¡8x8
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
 (
diff64
 , 
DISTBLK_MAX
);

94  (
co¡8x8
 < 
co¡4x4
);

96 
	}
}

104 
	$’code_Úe_maüoblock_low
 (
Maüoblock
 *
cu¼MB
)

106 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

107 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

108 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

109 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

110 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

112 
img³l
 ***
‹mp_img
;

114 
block
, 
mode
, 
j
;

115 
RD_PARAMS
 
’c_mb
;

116 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

117 
di¡blk
 
rd_co¡
 = 0;

118 
di¡blk
 
co¡
 = 0;

119 
di¡blk
 
mš_co¡
 = 
DISTBLK_MAX
;

120 
di¡blk
 
co¡_dœeù
=0;

121 
di¡blk
 
co¡8x8_dœeù
 = 0;

122 
have_dœeù
=0;

123 
šŒa1
 = 0;

124 
‹mp_ýb
 = 0;

125 
by‹
 
be¡_ŒªsfÜm_æag
 = (byte) 0;

126 
i¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
);

127 
b¦iû
 = (è(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

128 
p¦iû
 = (è((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

129 
šŒa
 = (è(
i¦iû
 || (
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
è|| (
p¦iû
 && 
cu¼MB
->
mb_y
 =ð
p_Vid
->
mb_y_upd
 &&…_Vid->mb_y_upd!õ_Vid->
mb_y_šŒa
));

130 
Ïmbda_mf
[3];

131 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

134 **
»dmodes
 = 
p_Vid
->
»dmode
;

135 
MÙiÚVeùÜ
 *
®lmvs
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)è? 
NULL
: &cu¼Sliû->
®l_mv
[0][0][0][0][0];

136 ****
i4p
;

137 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

139 
by‹
 
tmp_8x8_æag
, 
tmp_no_mb·¹
;

141 
Be¡Mode
 
md_be¡
;

142 
Info8x8
 
be¡
 = 
	`š™_šfo_8x8_¡ruù
();

144 
	`š™_md_be¡
(&
md_be¡
);

146 
	`g‘_mem3D³l
(&
‹mp_img
, 3, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

148 
šŒa
 |ð
	`RªdomIÁ¿
 (
p_Vid
, 
cu¼MB
->
mbAddrX
);

149 #ià(
MVC_EXTENSION_ENABLE
)

150 if(
p_IÅ
->
num_of_v›ws
==2)

151 
šŒa
 |ð(
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
]==0 && cu¼Sliû->num_»f_idx_aùive[
LIST_1
]==0);

155 
	`š™_’c_mb_·¿ms
(
cu¼MB
, &
’c_mb
, 
šŒa
);

156 ià(
p_IÅ
->
Ad­tiveRoundšg
)

158 
	`»£t_ad­tive_roundšg
(
p_Vid
);

161 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

163 
	`»£t_mb_nz_cÛff
(
p_Vid
, 
cu¼MB
->
mbAddrX
);

168 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

170 ià(!
šŒa
)

173 
cu¼MB
->
be¡_mode
 = 10;

174 ià(
b¦iû
 && 
’c_mb
.
v®id
[0])

176 
cu¼Sliû
->
	`G‘_Dœeù_MÙiÚ_VeùÜs
 (
cu¼MB
);

179 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

181 
	`g‘_š™Ÿl_mb16x16_co¡
(
cu¼MB
);

185 
mode
 = 1; mode < 4; mode++)

187 
be¡
.
b»d
 = 0;

188 
be¡
.
mode
 = () mode;

189 
b8x8šfo
->
be¡
[
mode
][0].
b»d
 = 0;

190 ià(
’c_mb
.
v®id
[
mode
])

192 
co¡
=0, 
block
=0; block<(
mode
==1?1:2); block++)

194 
	`upd©e_Ïmbda_co¡s
(
cu¼MB
, &
’c_mb
, 
Ïmbda_mf
);

195 
	`P¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

198 
j
 = (
block
==1 && 
mode
==2 ? 2 : 0);

201 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

202 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

204 ià(
b¦iû
)

207 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

208 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

211 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

214 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

216 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L0
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 0);

217 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L1
, 
block
, 
mode
, &
’c_mb
, 
bmco¡
, 0);

221 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

222 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

226 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, &
co¡
);

230 
be¡
.
pdœ
 = 0;

231 
co¡
 +ð
bmco¡
[
LIST_0
];

234 
	`assign_’c_piùu»_·¿ms
(
cu¼MB
, 
mode
, &
be¡
, 2 * 
block
);

237 
	`£t_block8x8_šfo
(
b8x8šfo
, 
mode
, 
block
, &
be¡
);

240 ià(
mode
>1 && 
block
==0)

241 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
be¡
, 
block
);

244 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

245 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

247 
cu¼Sliû
->
	`£t_modes_ªd_»fs_fÜ_blocks
(
cu¼MB
, (è
mode
);

248 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = (
by‹
è
	`ŒªsfÜm_decisiÚ
(cu¼MB, -1, &
co¡
);

251 ià(
co¡
 < 
mš_co¡
)

253 
cu¼MB
->
be¡_mode
 = (è
mode
;

254 
mš_co¡
 = 
co¡
;

255 
be¡_ŒªsfÜm_æag
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

257 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

259 
	`adju¡_mb16x16_co¡
(
cu¼MB
, 
co¡
);

265 ià(
’c_mb
.
v®id
[
P8x8
])

268 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_mb
);

269 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[0][0][0], 0, 2080 * ());

271 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

273 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

275 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ8x8
);

280 
co¡_dœeù
 = 0, 
block
 = 0; block < 4; block++)

282 
	`submaüoblock_mode_decisiÚ_low
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ8x8
,…_RDO->
cofAC8x8ts
[
block
],

283 &
have_dœeù
, 
block
, &
co¡_dœeù
, &
co¡
, &
co¡8x8_dœeù
, 1);

285 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ8x8
);

288 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

292 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

294 
	`Re£tRD8x8D©a
(
p_Vid
, 
p_RDO
->
Œ4x4
);

299 
co¡_dœeù
 = 0, 
block
=0; block<4; block++)

301 
	`submaüoblock_mode_decisiÚ_low
(
cu¼MB
, &
’c_mb
, 
p_RDO
->
Œ4x4
,…_RDO->
cÛfAC8x8
[
block
],

302 &
have_dœeù
, 
block
, &
co¡_dœeù
, &
co¡
, &
co¡8x8_dœeù
, 0);

304 
	`£t_subblock8x8_šfo
(
b8x8šfo
, 
P8x8
, 
block
, 
p_RDO
->
Œ4x4
);

308 ià(
p_IÅ
->
RCEÇbË
)

309 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

312 ià(((
p_IÅ
->
T¿nsfÜm8x8Mode
 < 2è&& (
p_RDO
->
Œ4x4
->
mb_p8x8_co¡
 < 
mš_co¡
)) ||

313 ((
p_IÅ
->
T¿nsfÜm8x8Mode
 > 0è&& (
p_RDO
->
Œ8x8
->
mb_p8x8_co¡
 < 
mš_co¡
)))

315 
cu¼MB
->
be¡_mode
 = 
P8x8
;

316 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 == 2)

318 
mš_co¡
 = 
p_RDO
->
Œ8x8
->
mb_p8x8_co¡
;

319 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

321 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

323 ià(
p_RDO
->
Œ8x8
->
mb_p8x8_co¡
 <…_RDO->
Œ4x4
->mb_p8x8_cost)

325 
mš_co¡
 = 
p_RDO
->
Œ8x8
->
mb_p8x8_co¡
;

326 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

328 if(
p_RDO
->
Œ4x4
->
mb_p8x8_co¡
 <…_RDO->
Œ8x8
->mb_p8x8_cost)

330 
mš_co¡
 = 
p_RDO
->
Œ4x4
->
mb_p8x8_co¡
;

331 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

335 ià(
	`g‘_be¡_ŒªsfÜm_8x8
(
cu¼MB
) == 0)

337 
mš_co¡
 = 
p_RDO
->
Œ4x4
->
mb_p8x8_co¡
;

338 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

342 
mš_co¡
 = 
p_RDO
->
Œ8x8
->
mb_p8x8_co¡
;

343 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

349 
mš_co¡
 = 
p_RDO
->
Œ4x4
->
mb_p8x8_co¡
;

350 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

353 
p_Vid
->
giRDO±_B8OÆyFÏg
 = 
FALSE
;

357 if(
p¦iû
)

358 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

362 
mš_co¡
 = 
DISTBLK_MAX
;

368 
tmp_8x8_æag
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

369 
tmp_no_mb·¹
 = 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
;

370 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (p_Vid->yuv_fÜm© !ð
YUV444
))

372 
cu¼Sliû
->
	`šŒa_chroma_´ediùiÚ
(
cu¼MB
, 
NULL
, NULL, NULL);

374 ià(
’c_mb
.
v®id
[0] && 
b¦iû
)

376 if(
have_dœeù
)

378 
p_IÅ
->
T¿nsfÜm8x8Mode
)

381 
co¡
 = ((
co¡8x8_dœeù
 < 
co¡_dœeù
è|| !(
’c_mb
.
v®id
[5] &&ƒnc_mb.valid[6] &&ƒnc_mb.valid[7]))

382 ? 
co¡8x8_dœeù
 : 
co¡_dœeù
;

385 
co¡
 = 
co¡8x8_dœeù
;

388 
co¡
 = 
co¡_dœeù
;

394 
co¡
 = 
	`G‘DœeùCo¡MB
 (
cu¼MB
);

396 ià(
co¡
!=
DISTBLK_MAX
)

398 
co¡
 -ð
	`weigh‹d_co¡
(
’c_mb
.
Ïmbda_mdå
, 16);

401 ià(
co¡
 <ð
mš_co¡
)

403 if(
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 && 
p_IÅ
->
T¿nsfÜm8x8Mode
)

405 if(
p_IÅ
->
T¿nsfÜm8x8Mode
==2)

406 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

409 if(
co¡8x8_dœeù
 < 
co¡_dœeù
)

410 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

412 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

416 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

419 ià(
p_IÅ
->
RCEÇbË
)

420 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

422 
mš_co¡
 = 
co¡
;

423 
cu¼MB
->
be¡_mode
 = 0;

424 
tmp_8x8_æag
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

428 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
tmp_8x8_æag
;

429 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 = 
tmp_no_mb·¹
;

432 
cu¼MB
->
mš_rdco¡
 = 
mš_co¡
;

433 ià(
’c_mb
.
v®id
[
I8MB
])

435 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

437 
cu¼MB
->
mb_ty³
 = cu¼MB->
¬_mode
 = 
I8MB
;

438 
‹mp_ýb
 = 
	`mode_decisiÚ_fÜ_I8x8_MB
 (
cu¼MB
, 
’c_mb
.
Ïmbda_mdå
, &
rd_co¡
);

440 ià(
rd_co¡
 <ð
cu¼MB
->
mš_rdco¡
)

442 
cu¼MB
->
cbp
 = 
‹mp_ýb
;

443 ià(
p_Vid
->
P444_jošed
)

445 
cu¼Sliû
->
cu¼_cbp
[0] = cu¼Sliû->
cmp_cbp
[1];

446 
cu¼Sliû
->
cu¼_cbp
[1] = cu¼Sliû->
cmp_cbp
[2];

449 if(
’c_mb
.
v®id
[
I4MB
])

452 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

454 
i4p
 = 
p_RDO
->
cofAC
;

455 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

456 
cu¼Sliû
->
cofAC
 = 
i4p
;

460 
	`cÝy_image_d©a_16x16
(
‹mp_img
[0], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 0, cu¼MB->
pix_x
);

462 ià(
p_Vid
->
P444_jošed
)

464 
	`cÝy_image_d©a_16x16
(
‹mp_img
[1], &
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 0, cu¼MB->
pix_x
);

465 
	`cÝy_image_d©a_16x16
(
‹mp_img
[2], &
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 0, cu¼MB->
pix_x
);

469 ià(
p_IÅ
->
RCEÇbË
)

470 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

472 
cu¼MB
->
mš_rdco¡
 = 
rd_co¡
;

473 
cu¼MB
->
be¡_mode
 = 
I8MB
;

474 
tmp_8x8_æag
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

478 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
tmp_8x8_æag
;

479 ià(
p_Vid
->
P444_jošed
)

481 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[0];

482 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[1];

483 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

484 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

489 ià(
’c_mb
.
v®id
[
I4MB
])

491 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

492 
cu¼MB
->
mb_ty³
 = cu¼MB->
¬_mode
 = 
I4MB
;

493 
‹mp_ýb
 = 
	`mode_decisiÚ_fÜ_I4x4_MB
 (
cu¼MB
, 
’c_mb
.
Ïmbda_mdå
, &
rd_co¡
);

494 ià(
rd_co¡
 <ð
cu¼MB
->
mš_rdco¡
)

496 
cu¼MB
->
cbp
 = 
‹mp_ýb
;

499 ià(
p_IÅ
->
RCEÇbË
)

500 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

502 
cu¼MB
->
mš_rdco¡
 = 
rd_co¡
;

503 
cu¼MB
->
be¡_mode
 = 
I4MB
;

504 
tmp_8x8_æag
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

508 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
tmp_8x8_æag
;

509 ià(
p_Vid
->
P444_jošed
)

511 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[0];

512 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[1];

513 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

514 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

517 
i4p
 = 
p_RDO
->
cofAC
;

518 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

519 
cu¼Sliû
->
cofAC
=
i4p
;

522 ià(
’c_mb
.
v®id
[
I16MB
])

524 
rd_co¡
 = 
	`fšd_be¡_mode_I16x16_MB
 (
cu¼MB
, 
’c_mb
.
Ïmbda_mdå
, cu¼MB->
mš_rdco¡
);

526 ià(
rd_co¡
 < 
cu¼MB
->
mš_rdco¡
)

529 ià(
p_IÅ
->
RCEÇbË
)

530 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, cu¼Sliû->
m´_16x16
[0][(ècu¼MB->
i16mode
]);

532 
cu¼MB
->
be¡_mode
 = 
I16MB
;

533 
cu¼MB
->
mš_rdco¡
 = 
rd_co¡
;

534 
cu¼MB
->
cbp
 = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_Y
);

536 ià(
p_Vid
->
P444_jošed
)

538 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

539 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
(cu¼MB, 
PLANE_U
);

540 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

541 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
(cu¼MB, 
PLANE_V
);

543 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

544 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[1];

545 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[2];

546 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

547 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

553 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
tmp_8x8_æag
;

554 
cu¼MB
->
NoMbP¬tLessThª8x8FÏg
 = 
tmp_no_mb·¹
;

558 
šŒa1
 = 
	`is_šŒa
(
cu¼MB
);

564 
cu¼Sliû
->
	`£t_modes_ªd_»fs_fÜ_blocks
 (
cu¼MB
, cu¼MB->
be¡_mode
);

566 ià(
cu¼MB
->
be¡_mode
 =ð
P8x8
)

568 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && (
p_RDO
->
Œ8x8
->
cbp8x8
 =ð0è&& 
p_IÅ
->
T¿nsfÜm8x8Mode
 != 2)

569 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

571 
cu¼Sliû
->
	`£t_cÛff_ªd_»cÚ_8x8
 (
cu¼MB
);

573 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
, 
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

574 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

575 
	`mem£t
(&
»dmodes
[
j
][
cu¼MB
->
block_x
], 
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

580 ià(
cu¼MB
->
be¡_mode
 =ð
I8MB
)

582 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,cu¼MB->
šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

583 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

584 
	`memýy
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
],&p_Vid->
»dmode8x8
[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

587 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
‹mp_img
[0], cu¼MB->
pix_x
, 0);

589 ià(
p_Vid
->
P444_jošed
)

591 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
‹mp_img
[1], cu¼MB->
pix_x
, 0);

592 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
‹mp_img
[2], cu¼MB->
pix_x
, 0);

596 ià((
cu¼MB
->
be¡_mode
!=
I4MB
)&&(cu¼MB->be¡_mod!ð
I8MB
))

598 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
,
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

599 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

600 
	`mem£t
(&
»dmodes
[
j
][
cu¼MB
->
block_x
],
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

601 
cu¼MB
->
¬_mode
 = cu¼MB->
be¡_mode
;

603 ià(
cu¼MB
->
be¡_mode
!=
I16MB
)

605 if((
cu¼MB
->
be¡_mode
 >= 1) && (currMB->best_mode <= 3))

606 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
be¡_ŒªsfÜm_æag
;

608 
cu¼Sliû
->
	`luma_»sidu®_codšg
(
cu¼MB
);

609 ià(
cu¼Sliû
->
P444_jošed
)

611 if((
cu¼MB
->
cbp
==0 && 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0è&&(cu¼MB->
be¡_mode
 == 0))

612 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

616 if((
cu¼MB
->
cbp
==0)&&(cu¼MB->
be¡_mode
 == 0))

617 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

621 ià(
p_IÅ
->
RCEÇbË
)

622 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
mb_´ed
);

627 ià(((
cu¼MB
->
cbp
&15è=ð0è&& cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
)

628 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

631 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (p_Vid->yuv_fÜm© !ð
YUV444
))

632 
cu¼Sliû
->
	`šŒa_chroma_´ediùiÚ
(
cu¼MB
, 
NULL
, NULL, NULL);

634 
cu¼MB
->
i16off£t
 = 0;

636 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (p_Vid->yuv_fÜm© !ð
YUV444
))

637 
cu¼Sliû
->
	`chroma_»sidu®_codšg
 (
cu¼MB
);

639 ià(
cu¼MB
->
be¡_mode
 =ð
I16MB
)

641 
cu¼MB
->
i16off£t
 = 
	`I16Off£t
 (cu¼MB->
cbp
, cu¼MB->
i16mode
);

644 
cu¼Sliû
->
	`£t_mÙiÚ_veùÜs_mb
 (
cu¼MB
);

647 if(
p_Vid
->
P444_jošed
)

649 ià((
p¦iû
è&& 
cu¼MB
->
be¡_mode
 =ð1 && cu¼MB->
cbp
==0 && 
cu¼Sliû
->
cmp_cbp
[1] == 0 && currSlice->cmp_cbp[2] == 0 &&

650 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

651 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 =ð
®lmvs
->mv_x &&

652 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 =ð
®lmvs
->mv_y)

654 
cu¼MB
->
mb_ty³
 = cu¼MB->
b8x8
[0].
mode
 = currMB->b8x8[1].mode = currMB->b8x8[2].mode = currMB->b8x8[3].mode = 0;

655 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

658 ià((
p¦iû
è&& 
cu¼MB
->
be¡_mode
 =ð1 && cu¼MB->
cbp
==0 &&

659 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
»f_idx
[
LIST_0
] == 0 &&

660 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_x
 =ð
®lmvs
->mv_x &&

661 
mÙiÚ
[
cu¼MB
->
block_y
][cu¼MB->
block_x
].
mv
 [
LIST_0
].
mv_y
 =ð
®lmvs
->mv_y)

663 
cu¼MB
->
mb_ty³
 = cu¼MB->
b8x8
[0].
mode
 = currMB->b8x8[1].mode = currMB->b8x8[2].mode = currMB->b8x8[3].mode = 0;

664 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

667 ià(
cu¼Sliû
->
mb_aff_äame_æag
 || (
p_IÅ
->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1))

668 
	`£t_mbaff_·¿m‘”s
(
cu¼MB
);

672 if(
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
)

673 
	`rc_¡Üe_mad
(
cu¼MB
);

676 ià(
p_IÅ
->
Re¡riùRef
)

677 
	`upd©e_»äesh_m­
(
cu¼MB
, 
šŒa
, 
šŒa1
);

681 ià(
p_Vid
->
Ad­tiveRoundšg
)

683 
	`upd©e_off£t_·¿ms
(
cu¼MB
, cu¼MB->
be¡_mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
);

686 
	`ä“_mem3D³l
(
‹mp_img
);

687 
	}
}

	@lencod/src/me_distortion.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

21 
	~"image.h
"

22 
	~"mem®loc.h
"

23 
	~"mb_acûss.h
"

24 
	~"»fbuf.h
"

25 
	~"mv_£¬ch.h
"

26 
	~"me_di¡ÜtiÚ.h
"

30 
	#CHECKOVERFLOW
(
mco¡
)

	)

38 
di¡blk
 
	$di¡ÜtiÚ4x4SAD
(* 
diff
, 
di¡blk
 
mš_di¡
)

40 
di¡ÜtiÚ
 = 0, 
k
;

41 
k
 = 0; k < 16; k++)

43 
di¡ÜtiÚ
 +ð
	`Ÿbs
(*
diff
++);

45  (
	`di¡_sÿË
((
di¡blk
è
di¡ÜtiÚ
));

46 
	}
}

54 
di¡blk
 
	$di¡ÜtiÚ4x4SSE
(* 
diff
, 
di¡blk
 
mš_di¡
)

56 
di¡ÜtiÚ
 = 0, 
k
;

57 
k
 = 0; k < 16; k++)

59 
di¡ÜtiÚ
 +ð
	`Ÿbs2
(*
diff
++);

61  (
	`di¡_sÿË
((
di¡blk
è
di¡ÜtiÚ
));

62 
	}
}

70 
di¡blk
 
	$di¡ÜtiÚ4x4SATD
(* 
diff
, 
di¡blk
 
mš_di¡
)

72 
di¡blk
 
i64R‘
 = 
	`Hadam¬dSAD4x4
Ð
diff
 );

73  (
	`di¡_sÿË
(
i64R‘
));

74 
	}
}

82 
di¡blk
 
	$di¡ÜtiÚ8x8SADth»s
(* 
diff
, 
di¡blk
 
mš_co¡
)

84 
di¡ÜtiÚ
 = 0;

85 
i
, 
j
;

86 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

88 
j
 = 0; j < 8; j++)

90 
i
 = 0; i < 8; i++)

92 
di¡ÜtiÚ
 +ð
	`Ÿbs
(*
diff
++);

94 ià(
di¡ÜtiÚ
 > 
imš_co¡
)

98  (
	`di¡_sÿË
((
di¡blk
è
di¡ÜtiÚ
));

99 
	}
}

107 
di¡blk
 
	$di¡ÜtiÚ8x8SAD
(* 
diff
, 
di¡blk
 
mš_di¡
)

109 
di¡ÜtiÚ
 = 0;

110 
k
;

112 
k
 = 0; k < 64; k++)

114 
di¡ÜtiÚ
 +ð
	`Ÿbs
(*
diff
++);

116  (
	`di¡_sÿË
((
di¡blk
è
di¡ÜtiÚ
));

117 
	}
}

125 
di¡blk
 
	$di¡ÜtiÚ8x8SSE
(* 
diff
, 
di¡blk
 
mš_di¡
)

127 
di¡blk
 
di¡ÜtiÚ
 = 0;

128 
k
;

129 
k
 = 0; k < 64; k++)

131 
di¡ÜtiÚ
 +ð
	`Ÿbs2
(*
diff
++);

133  (
	`di¡_sÿË
(
di¡ÜtiÚ
));

134 
	}
}

142 
di¡blk
 
	$di¡ÜtiÚ8x8SATD
(* 
diff
, 
di¡blk
 
mš_di¡
)

144 
di¡blk
 
i64R‘
 = 
	`Hadam¬dSAD8x8
Ð
diff
 );

145  (
	`di¡_sÿË
(
i64R‘
));

146 
	}
}

148 
	$£Ëù_di¡ÜtiÚ
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

150 
p_IÅ
->
ModeDecisiÚM‘ric
)

152 
ERROR_SAD
:

153 
p_Vid
->
di¡ÜtiÚ4x4
 = 
di¡ÜtiÚ4x4SAD
;

154 
p_Vid
->
di¡ÜtiÚ8x8
 = 
di¡ÜtiÚ8x8SAD
;

156 
ERROR_SSE
:

157 
p_Vid
->
di¡ÜtiÚ4x4
 = 
di¡ÜtiÚ4x4SSE
;

158 
p_Vid
->
di¡ÜtiÚ8x8
 = 
di¡ÜtiÚ8x8SSE
;

160 
ERROR_SATD
 :

162 
p_Vid
->
di¡ÜtiÚ4x4
 = 
di¡ÜtiÚ4x4SATD
;

163 
p_Vid
->
di¡ÜtiÚ8x8
 = 
di¡ÜtiÚ8x8SATD
;

166 
	}
}

175 
	$Hadam¬dSAD4x4
 (* 
diff
)

177 
k
, 
§td
 = 0;

178 
m
[16], 
d
[16];

181 
m
[ 0] = 
diff
[ 0] + diff[12];

182 
m
[ 1] = 
diff
[ 1] + diff[13];

183 
m
[ 2] = 
diff
[ 2] + diff[14];

184 
m
[ 3] = 
diff
[ 3] + diff[15];

185 
m
[ 4] = 
diff
[ 4] + diff[ 8];

186 
m
[ 5] = 
diff
[ 5] + diff[ 9];

187 
m
[ 6] = 
diff
[ 6] + diff[10];

188 
m
[ 7] = 
diff
[ 7] + diff[11];

189 
m
[ 8] = 
diff
[ 4] - diff[ 8];

190 
m
[ 9] = 
diff
[ 5] - diff[ 9];

191 
m
[10] = 
diff
[ 6] - diff[10];

192 
m
[11] = 
diff
[ 7] - diff[11];

193 
m
[12] = 
diff
[ 0] - diff[12];

194 
m
[13] = 
diff
[ 1] - diff[13];

195 
m
[14] = 
diff
[ 2] - diff[14];

196 
m
[15] = 
diff
[ 3] - diff[15];

198 
d
[ 0] = 
m
[ 0] + m[ 4];

199 
d
[ 1] = 
m
[ 1] + m[ 5];

200 
d
[ 2] = 
m
[ 2] + m[ 6];

201 
d
[ 3] = 
m
[ 3] + m[ 7];

202 
d
[ 4] = 
m
[ 8] + m[12];

203 
d
[ 5] = 
m
[ 9] + m[13];

204 
d
[ 6] = 
m
[10] + m[14];

205 
d
[ 7] = 
m
[11] + m[15];

206 
d
[ 8] = 
m
[ 0] - m[ 4];

207 
d
[ 9] = 
m
[ 1] - m[ 5];

208 
d
[10] = 
m
[ 2] - m[ 6];

209 
d
[11] = 
m
[ 3] - m[ 7];

210 
d
[12] = 
m
[12] - m[ 8];

211 
d
[13] = 
m
[13] - m[ 9];

212 
d
[14] = 
m
[14] - m[10];

213 
d
[15] = 
m
[15] - m[11];

215 
m
[ 0] = 
d
[ 0] + d[ 3];

216 
m
[ 1] = 
d
[ 1] + d[ 2];

217 
m
[ 2] = 
d
[ 1] - d[ 2];

218 
m
[ 3] = 
d
[ 0] - d[ 3];

219 
m
[ 4] = 
d
[ 4] + d[ 7];

220 
m
[ 5] = 
d
[ 5] + d[ 6];

221 
m
[ 6] = 
d
[ 5] - d[ 6];

222 
m
[ 7] = 
d
[ 4] - d[ 7];

223 
m
[ 8] = 
d
[ 8] + d[11];

224 
m
[ 9] = 
d
[ 9] + d[10];

225 
m
[10] = 
d
[ 9] - d[10];

226 
m
[11] = 
d
[ 8] - d[11];

227 
m
[12] = 
d
[12] + d[15];

228 
m
[13] = 
d
[13] + d[14];

229 
m
[14] = 
d
[13] - d[14];

230 
m
[15] = 
d
[12] - d[15];

232 
d
[ 0] = 
m
[ 0] + m[ 1];

233 
d
[ 1] = 
m
[ 0] - m[ 1];

234 
d
[ 2] = 
m
[ 2] + m[ 3];

235 
d
[ 3] = 
m
[ 3] - m[ 2];

236 
d
[ 4] = 
m
[ 4] + m[ 5];

237 
d
[ 5] = 
m
[ 4] - m[ 5];

238 
d
[ 6] = 
m
[ 6] + m[ 7];

239 
d
[ 7] = 
m
[ 7] - m[ 6];

240 
d
[ 8] = 
m
[ 8] + m[ 9];

241 
d
[ 9] = 
m
[ 8] - m[ 9];

242 
d
[10] = 
m
[10] + m[11];

243 
d
[11] = 
m
[11] - m[10];

244 
d
[12] = 
m
[12] + m[13];

245 
d
[13] = 
m
[12] - m[13];

246 
d
[14] = 
m
[14] + m[15];

247 
d
[15] = 
m
[15] - m[14];

251 
k
=0; k<16; ++k)

253 
§td
 +ð
	`Ÿbs
(
d
 [
k
]);

257  ((
§td
+1)>>1);

258 
	}
}

266 
	$Hadam¬dSAD8x8
 (* 
diff
)

268 
i
, 
j
, 
jj
, 
§d
=0;

271 
m1
[8][8], 
m2
[8][8], 
m3
[8][8];

275 
j
=0; j < 8; j++)

277 
jj
 = 
j
 << 3;

278 
m2
[
j
][0] = 
diff
[
jj
 ] + diff[jj+4];

279 
m2
[
j
][1] = 
diff
[
jj
+1] + diff[jj+5];

280 
m2
[
j
][2] = 
diff
[
jj
+2] + diff[jj+6];

281 
m2
[
j
][3] = 
diff
[
jj
+3] + diff[jj+7];

282 
m2
[
j
][4] = 
diff
[
jj
 ] - diff[jj+4];

283 
m2
[
j
][5] = 
diff
[
jj
+1] - diff[jj+5];

284 
m2
[
j
][6] = 
diff
[
jj
+2] - diff[jj+6];

285 
m2
[
j
][7] = 
diff
[
jj
+3] - diff[jj+7];

287 
m1
[
j
][0] = 
m2
[j][0] + m2[j][2];

288 
m1
[
j
][1] = 
m2
[j][1] + m2[j][3];

289 
m1
[
j
][2] = 
m2
[j][0] - m2[j][2];

290 
m1
[
j
][3] = 
m2
[j][1] - m2[j][3];

291 
m1
[
j
][4] = 
m2
[j][4] + m2[j][6];

292 
m1
[
j
][5] = 
m2
[j][5] + m2[j][7];

293 
m1
[
j
][6] = 
m2
[j][4] - m2[j][6];

294 
m1
[
j
][7] = 
m2
[j][5] - m2[j][7];

296 
m2
[
j
][0] = 
m1
[j][0] + m1[j][1];

297 
m2
[
j
][1] = 
m1
[j][0] - m1[j][1];

298 
m2
[
j
][2] = 
m1
[j][2] + m1[j][3];

299 
m2
[
j
][3] = 
m1
[j][2] - m1[j][3];

300 
m2
[
j
][4] = 
m1
[j][4] + m1[j][5];

301 
m2
[
j
][5] = 
m1
[j][4] - m1[j][5];

302 
m2
[
j
][6] = 
m1
[j][6] + m1[j][7];

303 
m2
[
j
][7] = 
m1
[j][6] - m1[j][7];

307 
i
=0; i < 8; i++)

309 
m3
[0][
i
] = 
m2
[0][i] + m2[4][i];

310 
m3
[1][
i
] = 
m2
[1][i] + m2[5][i];

311 
m3
[2][
i
] = 
m2
[2][i] + m2[6][i];

312 
m3
[3][
i
] = 
m2
[3][i] + m2[7][i];

313 
m3
[4][
i
] = 
m2
[0][i] - m2[4][i];

314 
m3
[5][
i
] = 
m2
[1][i] - m2[5][i];

315 
m3
[6][
i
] = 
m2
[2][i] - m2[6][i];

316 
m3
[7][
i
] = 
m2
[3][i] - m2[7][i];

318 
m1
[0][
i
] = 
m3
[0][i] + m3[2][i];

319 
m1
[1][
i
] = 
m3
[1][i] + m3[3][i];

320 
m1
[2][
i
] = 
m3
[0][i] - m3[2][i];

321 
m1
[3][
i
] = 
m3
[1][i] - m3[3][i];

322 
m1
[4][
i
] = 
m3
[4][i] + m3[6][i];

323 
m1
[5][
i
] = 
m3
[5][i] + m3[7][i];

324 
m1
[6][
i
] = 
m3
[4][i] - m3[6][i];

325 
m1
[7][
i
] = 
m3
[5][i] - m3[7][i];

327 
m2
[0][
i
] = 
m1
[0][i] + m1[1][i];

328 
m2
[1][
i
] = 
m1
[0][i] - m1[1][i];

329 
m2
[2][
i
] = 
m1
[2][i] + m1[3][i];

330 
m2
[3][
i
] = 
m1
[2][i] - m1[3][i];

331 
m2
[4][
i
] = 
m1
[4][i] + m1[5][i];

332 
m2
[5][
i
] = 
m1
[4][i] - m1[5][i];

333 
m2
[6][
i
] = 
m1
[6][i] + m1[7][i];

334 
m2
[7][
i
] = 
m1
[6][i] - m1[7][i];

336 
j
=0; j < 8; j++)

337 
i
=0; i < 8; i++)

338 
§d
 +ð
	`Ÿbs
 (
m2
[
j
][
i
]);

340  ((
§d
+2)>>2);

341 
	}
}

349 
di¡blk
 
	$compu‹SAD
(
StÜabËPiùu»
 *
»f1
,

350 
MEBlock
 *
mv_block
,

351 
di¡blk
 
mš_mco¡
,

352 
MÙiÚVeùÜ
 *
ÿnd
)

354 
mco¡
 = 0;

355 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

356 
y
,
x
;

357 
blocksize_x
 = 
mv_block
->blocksize_x;

358 
blocksize_y
 = 
mv_block
->blocksize_y;

359 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

360 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

361 #ià(
JM_MEM_DISTORTION
)

362 *
img³l_abs
 = 
p_Vid
->imgpel_abs;

365 
img³l
 *
¤c_lše
, *
»f_lše
;

366 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

367 
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

368 
y
=0; y<
blocksize_y
; y++)

370 
x
 = 0; x < 
blocksize_x
; x+=4)

372 #ià(
JM_MEM_DISTORTION
)

373 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

374 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

375 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

376 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

378 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

379 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

380 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

381 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

384 if(
mco¡
 > 
imš_co¡
)

385  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

386 
»f_lše
 +ð
·d_size_x
;

388 iàÐ
mv_block
->
ChromaMEEÇbË
 )

391 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

392 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

393 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

394 
k
;

395 
mü_co¡
 = 0;

397 
k
=0; k < 2; k++)

399 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

400 
»f_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd
->
mv_y
, cªd->
mv_x
);

401 
mü_co¡
 = 0;

403 
y
 = 0; y < 
blocksize_y_ü
; y++)

405 
x
 = 0; x < 
blocksize_x_ü
; x += 2)

407 #ià(
JM_MEM_DISTORTION
)

408 
mü_co¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

409 
mü_co¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

411 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

412 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

415 
»f_lše
 +ð
ü_·d_size_x
;

417 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

419 if(
mco¡
 >
imš_co¡
)

420  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

424 
	`CHECKOVERFLOW
(
mco¡
);

425  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

426 
	}
}

434 
di¡blk
 
	$compu‹SADWP
(
StÜabËPiùu»
 *
»f1
,

435 
MEBlock
 *
mv_block
,

436 
di¡blk
 
mš_mco¡
,

437 
MÙiÚVeùÜ
 *
ÿnd


440 
mco¡
 = 0;

441 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

442 
y
, 
x
;

443 
weigh‹d_³l
;

444 
blocksize_x
 = 
mv_block
->blocksize_x;

445 
blocksize_y
 = 
mv_block
->blocksize_y;

447 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

448 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

449 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

450 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

451 
weight
 = 
mv_block
->
weight_luma
;

452 
off£t
 = 
mv_block
->
off£t_luma
;

454 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

455 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

457 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

458 
img³l
 *
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

460 
y
=0; y<
blocksize_y
; y++)

462 
x
 = 0; x < 
blocksize_x
; x+=4)

464 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

465 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

466 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

467 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

468 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

469 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

470 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

471 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

473 if(
mco¡
 > 
imš_co¡
)

474  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

475 
»f_lše
 +ð
·d_size_x
;

477 iàÐ
mv_block
->
ChromaMEEÇbË
 )

480 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

481 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

482 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

483 
k
;

484 
mü_co¡
 = 0;

485 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

486 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

487 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

489 
k
=0; k < 2; k++)

491 
weight
 = 
mv_block
->
weight_ü
[
k
];

492 
off£t
 = 
mv_block
->
off£t_ü
[
k
];

494 
mü_co¡
 = 0;

495 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

496 
»f_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd
->
mv_y
, cªd->
mv_x
);

497 
y
=0; y<
blocksize_y_ü
; y++)

499 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

501 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

502 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

503 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

504 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

506 
»f_lše
 +ð
ü_·d_size_x
;

508 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

510 if(
mco¡
 >
imš_co¡
)

511  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

515 
	`CHECKOVERFLOW
(
mco¡
);

516  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

517 
	}
}

525 
di¡blk
 
	$compu‹BiP»dSAD1
(
StÜabËPiùu»
 *
»f1
,

526 
StÜabËPiùu»
 *
»f2
,

527 
MEBlock
 *
mv_block
,

528 
di¡blk
 
mš_mco¡
,

529 
MÙiÚVeùÜ
 *
ÿnd1
,

530 
MÙiÚVeùÜ
 *
ÿnd2
)

532 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

533 
mco¡
 = 0;

534 
bi_diff
;

535 
y
,
x
;

536 
blocksize_x
 = 
mv_block
->blocksize_x;

537 
blocksize_y
 = 
mv_block
->blocksize_y;

538 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

539 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

540 #ià(
JM_MEM_DISTORTION
)

541 *
img³l_abs
 = 
p_Vid
->imgpel_abs;

544 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

545 
img³l
 *
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

546 
img³l
 *
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

548 
y
 = 0; y < 
blocksize_y
; y++)

550 
x
 = 0; x < 
blocksize_x
; x+=4)

552 #ià(
JM_MEM_DISTORTION
)

553 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

554 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

555 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

556 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

557 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

558 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

559 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

560 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

562 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

563 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

564 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

565 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

566 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

567 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

568 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

569 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

572 if(
mco¡
 > 
imš_co¡
)

573  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

575 
»f2_lše
 +ð
·d_size_x
;

576 
»f1_lše
 +ð
·d_size_x
;

579 iàÐ
mv_block
->
ChromaMEEÇbË
 )

582 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

583 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

584 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

585 
k
;

586 
mü_co¡
 = 0;

588 
k
=1; k<3; k++)

590 
mü_co¡
 = 0;

591 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
];

592 
»f2_lše
 = 
	`UMVLše8X_chroma
 ( 
»f2
, 
k
, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

593 
»f1_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

595 
y
=0; y<
blocksize_y_ü
; y++)

597 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

599 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

600 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

601 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

602 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

604 
»f2_lše
 +ð
ü_·d_size_x
;

605 
»f1_lše
 +ð
ü_·d_size_x
;

607 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

609 if(
mco¡
 > 
imš_co¡
)

610  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

614 
	`CHECKOVERFLOW
(
mco¡
);

615  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

616 
	}
}

624 
di¡blk
 
	$compu‹BiP»dSAD2
(
StÜabËPiùu»
 *
»f1
,

625 
StÜabËPiùu»
 *
»f2
,

626 
MEBlock
 *
mv_block
,

627 
di¡blk
 
mš_mco¡
,

628 
MÙiÚVeùÜ
 *
ÿnd1
,

629 
MÙiÚVeùÜ
 *
ÿnd2
)

631 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

632 
mco¡
 = 0;

633 
bi_diff
;

634 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

635 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

636 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

637 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

638 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

639 
y
,
x
;

640 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

641 
blocksize_x
 = 
mv_block
->blocksize_x;

642 
blocksize_y
 = 
mv_block
->blocksize_y;

643 
weight1
 = 
mv_block
->weight1;

644 
weight2
 = 
mv_block
->weight2;

645 
off£tBi
 = 
mv_block
->offsetBi;

647 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

649 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

650 
img³l
 *
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

651 
img³l
 *
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

653 
y
=0; y<
blocksize_y
; y++)

655 
x
 = 0; x < 
blocksize_x
; x+=4)

657 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

658 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

659 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

660 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

661 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

663 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

664 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

665 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

666 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

667 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

669 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

670 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

671 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

672 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

673 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

675 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

676 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

677 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

678 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

679 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

682 if(
mco¡
 > 
imš_co¡
)

683  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

684 
»f2_lše
 +ð
·d_size_x
;

685 
»f1_lše
 +ð
·d_size_x
;

688 iàÐ
mv_block
->
ChromaMEEÇbË
 )

691 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

692 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

693 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

694 
k
;

695 
mü_co¡
 = 0;

696 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

698 
k
=0; k<2; k++)

700 
weight1
 = 
mv_block
->
weight1_ü
[
k
];

701 
weight2
 = 
mv_block
->
weight2_ü
[
k
];

702 
off£tBi
 = 
mv_block
->
off£tBi_ü
[
k
];

704 
mü_co¡
 = 0;

705 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

706 
»f2_lše
 = 
	`UMVLše8X_chroma
 ( 
»f2
, 
k
+1, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

707 
»f1_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

709 
y
=0; y<
blocksize_y_ü
; y++)

711 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

713 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

714 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

715 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

716 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

717 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

719 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

720 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

721 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

722 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

723 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

725 
»f2_lše
 +ð
ü_·d_size_x
;

726 
»f1_lše
 +ð
ü_·d_size_x
;

728 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

730 if(
mco¡
 > 
imš_co¡
)

731  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

735 
	`CHECKOVERFLOW
(
mco¡
);

736  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

737 
	}
}

745 
di¡blk
 
	$compu‹SATD
(
StÜabËPiùu»
 *
»f1
,

746 
MEBlock
 *
mv_block
,

747 
di¡blk
 
mš_mco¡
,

748 
MÙiÚVeùÜ
 *
ÿnd


751 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

752 
mco¡
 = 0;

753 
y
, 
x
, 
y4
;

754 
¤c_size_x
, 
¤c_size_mul
;

755 
blocksize_x
 = 
mv_block
->blocksize_x;

756 
blocksize_y
 = 
mv_block
->blocksize_y;

757 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

758 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

759 *
d
, 
diff
[
MB_PIXELS
];

760 
img³l
 *
¤c_lše
, *
»f_lše
;

762 iàÐ!
mv_block
->
‹¡8x8
 )

764 
¤c_size_x
 = 
blocksize_x
 - 
BLOCK_SIZE
;

765 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

766 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

768 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

770 
d
 = 
diff
;

771 
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
y
, 
ÿnd
->
mv_x
 + (
x
<<2));

772 
¤c_lše
 = 
¤c_tmp
 + 
x
;

773 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

775 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

776 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

777 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

778 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

780 
»f_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

781 
¤c_lše
 +ð
¤c_size_x
;

783 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

784 if(
mco¡
 > 
imš_co¡
)

785  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

787 
¤c_tmp
 +ð
¤c_size_mul
;

792 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

793 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

794 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_8x8_SP
) )

796 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

798 
d
 = 
diff
;

799 
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
y
, 
ÿnd
->
mv_x
 + (
x
<<2));

800 
¤c_lše
 = 
¤c_tmp
 + 
x
;

801 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

803 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

804 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

805 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

806 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

807 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

808 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

809 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

810 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

812 
»f_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

813 
¤c_lše
 +ð
¤c_size_x
;

815 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

816 if(
mco¡
 > 
imš_co¡
)

817  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

819 
¤c_tmp
 +ð
¤c_size_mul
;

823 
	`CHECKOVERFLOW
(
mco¡
);

824  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

825 
	}
}

833 
di¡blk
 
	$compu‹SATDWP
(
StÜabËPiùu»
 *
»f1
,

834 
MEBlock
 *
mv_block
,

835 
di¡blk
 
mš_mco¡
,

836 
MÙiÚVeùÜ
 *
ÿnd


839 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

840 
mco¡
 = 0;

841 
y
, 
x
, 
y4
;

842 
weigh‹d_³l
;

843 
¤c_size_x
, 
¤c_size_mul
;

844 
blocksize_x
 = 
mv_block
->blocksize_x;

845 
blocksize_y
 = 
mv_block
->blocksize_y;

847 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

848 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

849 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

850 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

851 
weight
 = 
mv_block
->
weight_luma
;

852 
off£t
 = 
mv_block
->
off£t_luma
;

854 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

855 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

856 *
d
, 
diff
[
MB_PIXELS
];

857 
img³l
 *
¤c_lše
, *
»f_lše
;

859 iàÐ!
mv_block
->
‹¡8x8
 )

861 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

862 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

863 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

865 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

867 
d
 = 
diff
;

868 
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
y
, 
ÿnd
->
mv_x
 + (
x
<<2));

869 
¤c_lše
 = 
¤c_tmp
 + 
x
;

870 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

872 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

873 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

874 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

875 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

876 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

877 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

878 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

879 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

881 
»f_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

882 
¤c_lše
 +ð
¤c_size_x
;

884 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

886 if(
mco¡
 > 
imš_co¡
)

887  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

889 
¤c_tmp
 +ð
¤c_size_mul
;

894 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

895 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

896 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_8x8_SP
) )

898 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

900 
d
 = 
diff
;

901 
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
y
, 
ÿnd
->
mv_x
 + (
x
<<2));

902 
¤c_lše
 = 
¤c_tmp
 + 
x
;

903 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

905 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

906 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

907 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

908 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

909 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

910 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

911 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

912 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

913 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

914 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

915 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

916 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

917 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

918 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

919 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

920 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

922 
»f_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

923 
¤c_lše
 +ð
¤c_size_x
;

925 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

926 if(
mco¡
 > 
imš_co¡
)

927  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

929 
¤c_tmp
 +ð
¤c_size_mul
;

933 
	`CHECKOVERFLOW
(
mco¡
);

934  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

935 
	}
}

943 
di¡blk
 
	$compu‹BiP»dSATD1
(
StÜabËPiùu»
 *
»f1
,

944 
StÜabËPiùu»
 *
»f2
,

945 
MEBlock
 *
mv_block
,

946 
di¡blk
 
mš_mco¡
,

947 
MÙiÚVeùÜ
 *
ÿnd1
,

948 
MÙiÚVeùÜ
 *
ÿnd2
)

950 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

951 
mco¡
 = 0;

952 
y
, 
x
, 
y4
;

953 
¤c_size_x
, 
¤c_size_mul
;

954 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

955 *
d
, 
diff
[
MB_PIXELS
];

956 
img³l
 *
¤c_lše
, *
»f1_lše
, *
»f2_lše
;

957 
blocksize_x
 = 
mv_block
->blocksize_x;

958 
blocksize_y
 = 
mv_block
->blocksize_y;

959 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

961 iàÐ!
mv_block
->
‹¡8x8
 )

963 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

964 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

965 
y
=0; y<(
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

967 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

969 
d
 = 
diff
;

970 
¤c_lše
 = 
¤c_tmp
 + 
x
;

971 
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
 + 
y
, cªd2->
mv_x
 + (
x
<<2));

972 
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
 + 
y
, cªd1->
mv_x
 + (
x
<<2));

973 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

975 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

976 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

977 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

978 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

980 
»f1_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

981 
»f2_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

982 
¤c_lše
 +ð
¤c_size_x
;

984 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

985 if(
mco¡
 > 
imš_co¡
)

986  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

988 
¤c_tmp
 +ð
¤c_size_mul
;

993 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

994 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

995 
y
=0; y<(
blocksize_y
 << 2); y +ð
BLOCK_SIZE_8x8_SP
 )

997 
y_pos2
 = 
ÿnd2
->
mv_y
 + 
y
;

998 
y_pos1
 = 
ÿnd1
->
mv_y
 + 
y
;

999 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

1001 
d
 = 
diff
;

1002 
¤c_lše
 = 
¤c_tmp
 + 
x
;

1003 
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
y_pos2
, 
ÿnd2
->
mv_x
 + (
x
<<2));

1004 
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
y_pos1
, 
ÿnd1
->
mv_x
 + (
x
<<2));

1005 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

1007 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1008 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1009 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1010 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1011 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1012 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1013 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1014 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1016 
»f1_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

1017 
»f2_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

1018 
¤c_lše
 +ð
¤c_size_x
;

1020 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

1021 if(
mco¡
 > 
imš_co¡
)

1022  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1024 
¤c_tmp
 +ð
¤c_size_mul
;

1028 
	`CHECKOVERFLOW
(
mco¡
);

1029  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1030 
	}
}

1038 
di¡blk
 
	$compu‹BiP»dSATD2
(
StÜabËPiùu»
 *
»f1
,

1039 
StÜabËPiùu»
 *
»f2
,

1040 
MEBlock
 *
mv_block
,

1041 
di¡blk
 
mš_mco¡
,

1042 
MÙiÚVeùÜ
 *
ÿnd1
,

1043 
MÙiÚVeùÜ
 *
ÿnd2
)

1045 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1046 
mco¡
 = 0;

1047 
y
, 
x
, 
y4
;

1048 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

1049 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1050 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

1051 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

1052 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

1053 
weight1
 = 
mv_block
->weight1;

1054 
weight2
 = 
mv_block
->weight2;

1055 
off£tBi
 = 
mv_block
->offsetBi;

1058 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

1059 
¤c_size_x
, 
¤c_size_mul
;

1060 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

1061 *
d
, 
diff
[
MB_PIXELS
];

1062 
img³l
 *
¤c_lše
, *
»f1_lše
, *
»f2_lše
;

1063 
blocksize_x
 = 
mv_block
->blocksize_x;

1064 
blocksize_y
 = 
mv_block
->blocksize_y;

1066 iàÐ!
mv_block
->
‹¡8x8
 )

1068 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

1069 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

1070 
y
=0; y<(
blocksize_y
<<2); y +ð
BLOCK_SIZE_SP
)

1072 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

1074 
d
 = 
diff
;

1075 
¤c_lše
 = 
¤c_tmp
 + 
x
;

1076 
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
 + 
y
, cªd2->
mv_x
 + (
x
<<2));

1077 
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
 + 
y
, cªd1->
mv_x
 + (
x
<<2));

1078 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

1081 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1082 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1083 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1084 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1086 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1087 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1088 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1089 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1091 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1092 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1093 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1094 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1096 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1097 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1098 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1099 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1101 
»f1_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

1102 
»f2_lše
 +ð
p_Vid
->
·dded_size_x_m4x4
;

1103 
¤c_lše
 +ð
¤c_size_x
;

1105 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

1106 if(
mco¡
 > 
imš_co¡
)

1107  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1109 
¤c_tmp
 +ð
¤c_size_mul
;

1114 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

1115 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

1116 
y
=0; y < (
blocksize_y
 << 2); y +ð
BLOCK_SIZE_8x8_SP
 )

1118 
y_pos2
 = 
ÿnd2
->
mv_y
 + 
y
;

1119 
y_pos1
 = 
ÿnd1
->
mv_y
 + 
y
;

1120 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

1122 
d
 = 
diff
;

1123 
¤c_lše
 = 
¤c_tmp
 + 
x
;

1124 
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
y_pos2
, 
ÿnd2
->
mv_x
 + (
x
<<2));

1125 
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
y_pos1
, 
ÿnd1
->
mv_x
 + (
x
<<2));

1126 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

1129 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1130 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1131 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1132 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1134 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1135 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1136 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1137 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1139 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1140 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1141 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1142 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1144 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1145 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1146 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1147 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1149 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1150 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1151 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1152 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1154 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1155 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1156 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1157 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1159 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1160 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1161 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1162 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

1164 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1165 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1166 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1167 *
d
++ = (è((*
¤c_lše
è- 
weigh‹d_³l
);

1169 
»f1_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

1170 
»f2_lše
 +ð
p_Vid
->
·dded_size_x_m8x8
;

1171 
¤c_lše
 +ð
¤c_size_x
;

1173 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

1174 if(
mco¡
 > 
imš_co¡
)

1175  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1177 
¤c_tmp
 +ð
¤c_size_mul
;

1180 
	`CHECKOVERFLOW
(
mco¡
);

1181  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1182 
	}
}

1190 
di¡blk
 
	$compu‹SSE
(
StÜabËPiùu»
 *
»f1
,

1191 
MEBlock
 *
mv_block
,

1192 
di¡blk
 
mš_mco¡
,

1193 
MÙiÚVeùÜ
 *
ÿnd


1196 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1197 
mco¡
 = 0;

1198 
y
,
x
;

1199 
blocksize_x
 = 
mv_block
->blocksize_x;

1200 
blocksize_y
 = 
mv_block
->blocksize_y;

1201 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1202 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

1204 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1205 
img³l
 *
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

1207 
y
=0; y<
blocksize_y
; y++)

1209 
x
 = 0; x < 
blocksize_x
; x+=4)

1211 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1212 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1213 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1214 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1216 if(
mco¡
 > 
imš_co¡
)

1217  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1218 
»f_lše
 +ð
·d_size_x
;

1221 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1224 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1225 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1226 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

1227 
k
;

1228 
mü_co¡
 = 0;

1230 
k
=0; k<2; k++)

1232 
mü_co¡
 = 0;

1233 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1234 
»f_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd
->
mv_y
, cªd->
mv_x
);

1235 
y
=0; y<
blocksize_y_ü
; y++)

1237 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1239 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1240 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

1242 
»f_lše
 +ð
ü_·d_size_x
;

1244 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1245 if(
mco¡
 > 
imš_co¡
)

1246  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1250 
	`CHECKOVERFLOW
(
mco¡
);

1251  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1252 
	}
}

1261 
di¡blk
 
	$compu‹SSEWP
(
StÜabËPiùu»
 *
»f1
,

1262 
MEBlock
 *
mv_block
,

1263 
di¡blk
 
mš_mco¡
,

1264 
MÙiÚVeùÜ
 *
ÿnd


1267 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1268 
mco¡
 = 0;

1269 
y
,
x
;

1270 
weigh‹d_³l
;

1271 
blocksize_x
 = 
mv_block
->blocksize_x;

1272 
blocksize_y
 = 
mv_block
->blocksize_y;

1273 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1274 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

1275 
weight
 = 
mv_block
->
weight_luma
;

1276 
off£t
 = 
mv_block
->
off£t_luma
;

1278 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

1279 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

1280 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

1281 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

1283 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1284 
img³l
 *
»f_lše
 = 
	`UMVLše4X
 (
»f1
, 
ÿnd
->
mv_y
, cªd->
mv_x
);

1286 
y
=0; y<
blocksize_y
; y++)

1288 
x
 = 0; x < 
blocksize_x
; x+=4)

1290 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1291 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1292 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1293 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1294 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1295 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1296 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1297 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1299 if(
mco¡
 > 
imš_co¡
)

1300  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1301 
»f_lše
 +ð
·d_size_x
;

1304 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1308 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1309 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1310 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

1311 
k
;

1312 
mü_co¡
 = 0;

1313 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

1314 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

1315 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

1317 
k
=0; k<2; k++)

1319 
weight
 = 
mv_block
->
weight_ü
[
k
];

1320 
off£t
 = 
mv_block
->
off£t_ü
[
k
];

1322 
mü_co¡
 = 0;

1323 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1324 
»f_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd
->
mv_y
, cªd->
mv_x
);

1325 
y
=0; y<
blocksize_y_ü
; y++)

1328 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1330 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

1331 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1332 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

1333 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1335 
»f_lše
 +ð
ü_·d_size_x
;

1337 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1338 if(
mco¡
 > 
imš_co¡
)

1339  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1343 
	`CHECKOVERFLOW
(
mco¡
);

1344  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1345 
	}
}

1353 
di¡blk
 
	$compu‹BiP»dSSE1
(
StÜabËPiùu»
 *
»f1
,

1354 
StÜabËPiùu»
 *
»f2
,

1355 
MEBlock
 *
mv_block
,

1356 
di¡blk
 
mš_mco¡
,

1357 
MÙiÚVeùÜ
 *
ÿnd1
,

1358 
MÙiÚVeùÜ
 *
ÿnd2
)

1360 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1361 
mco¡
 = 0;

1362 
bi_diff
;

1363 
y
,
x
;

1364 
blocksize_x
 = 
mv_block
->blocksize_x;

1365 
blocksize_y
 = 
mv_block
->blocksize_y;

1366 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1367 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

1369 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1370 
img³l
 *
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

1371 
img³l
 *
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

1373 
y
 = 0; y < 
blocksize_y
; y++)

1375 
x
 = 0; x < 
blocksize_x
; x+=4)

1377 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1378 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1379 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1380 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1381 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1382 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1383 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1384 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1386 if(
mco¡
 > 
imš_co¡
)

1387  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1389 
»f2_lše
 +ð
·d_size_x
;

1390 
»f1_lše
 +ð
·d_size_x
;

1393 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1396 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1397 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1398 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

1399 
k
;

1400 
mü_co¡
 = 0;

1402 
k
=0; k<2; k++)

1404 
mü_co¡
 = 0;

1405 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1406 
»f2_lše
 = 
	`UMVLše8X_chroma
 ( 
»f2
, 
k
+1, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

1407 
»f1_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

1409 
y
=0; y<
blocksize_y_ü
; y++)

1411 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1413 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1414 
mü_co¡
 +ð
	`Ÿbs2
(
bi_diff
);

1415 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1416 
mü_co¡
 +ð
	`Ÿbs2
(
bi_diff
);

1418 
»f2_lše
 +ð
ü_·d_size_x
;

1419 
»f1_lše
 +ð
ü_·d_size_x
;

1421 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1422 if(
mco¡
 > 
imš_co¡
)

1423  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1427 
	`CHECKOVERFLOW
(
mco¡
);

1428  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1429 
	}
}

1438 
di¡blk
 
	$compu‹BiP»dSSE2
(
StÜabËPiùu»
 *
»f1
,

1439 
StÜabËPiùu»
 *
»f2
,

1440 
MEBlock
 *
mv_block
,

1441 
di¡blk
 
mš_mco¡
,

1442 
MÙiÚVeùÜ
 *
ÿnd1
,

1443 
MÙiÚVeùÜ
 *
ÿnd2
)

1445 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1446 
mco¡
 = 0;

1447 
bi_diff
;

1448 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1449 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

1450 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

1451 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

1452 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

1453 
y
,
x
;

1454 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

1455 
weight1
 = 
mv_block
->weight1;

1456 
weight2
 = 
mv_block
->weight2;

1457 
off£tBi
 = 
mv_block
->offsetBi;

1459 
blocksize_x
 = 
mv_block
->blocksize_x;

1460 
blocksize_y
 = 
mv_block
->blocksize_y;

1461 
·d_size_x
 = 
p_Vid
->
·dded_size_x
 - 
blocksize_x
;

1463 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1464 
img³l
 *
»f2_lše
 = 
	`UMVLše4X
(
»f2
, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

1465 
img³l
 *
»f1_lše
 = 
	`UMVLše4X
(
»f1
, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

1466 
y
=0; y<
blocksize_y
; y++)

1468 
x
 = 0; x < 
blocksize_x
; x+=4)

1470 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1471 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1472 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1473 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1474 
mco¡
 +ð
bi_diff
 * bi_diff;

1476 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1477 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1478 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1479 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1480 
mco¡
 +ð
bi_diff
 * bi_diff;

1482 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1483 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1484 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1485 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1486 
mco¡
 +ð
bi_diff
 * bi_diff;

1488 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1489 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1490 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1491 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1492 
mco¡
 +ð
bi_diff
 * bi_diff;

1494 if(
mco¡
 > 
imš_co¡
)

1495  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1497 
»f2_lše
 +ð
·d_size_x
;

1498 
»f1_lše
 +ð
·d_size_x
;

1501 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1504 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1505 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1506 
ü_·d_size_x
 = 
p_Vid
->
ü_·dded_size_x
 - 
blocksize_x_ü
;

1507 
k
;

1508 
mü_co¡
 = 0;

1509 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

1511 
k
=0; k<2; k++)

1513 
weight1
 = 
mv_block
->
weight1_ü
[
k
];

1514 
weight2
 = 
mv_block
->
weight2_ü
[
k
];

1515 
off£tBi
 = 
mv_block
->
off£tBi_ü
[
k
];

1517 
mü_co¡
 = 0;

1518 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1519 
»f2_lše
 = 
	`UMVLše8X_chroma
 ( 
»f2
, 
k
+1, 
ÿnd2
->
mv_y
, cªd2->
mv_x
);

1520 
»f1_lše
 = 
	`UMVLše8X_chroma
 ( 
»f1
, 
k
+1, 
ÿnd1
->
mv_y
, cªd1->
mv_x
);

1522 
y
=0; y<
blocksize_y_ü
; y++)

1524 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1526 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1527 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1528 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1529 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1530 
mü_co¡
 +ð
bi_diff
 * bi_diff;

1532 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1533 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1534 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1535 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1536 
mü_co¡
 +ð
bi_diff
 * bi_diff;

1538 
»f2_lše
 +ð
ü_·d_size_x
;

1539 
»f1_lše
 +ð
ü_·d_size_x
;

1541 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1542 if(
mco¡
 > 
imš_co¡
)

1543  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1547 
	`CHECKOVERFLOW
(
mco¡
);

1548  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1549 
	}
}

1552 
	$ÿlcDifã»nû
(
img³l
 **
ÜigImg
, 
ox
, 
oy
, img³È**
´edImg
, 
px
, 
py
, 
width
, 
height
, *
diff
)

1554 
i
, 
j
;

1555 
img³l
 *
Üig
, *
´ed
;

1556 
j
 = 0; j < 
height
; j++)

1558 
Üig
 = 
ÜigImg
[
oy
+
j
]+
ox
;

1559 
´ed
 = 
´edImg
[
py
+
j
]+
px
;

1560 
i
 = 0; i < 
width
; i++)

1562 *
diff
++ = *
Üig
++ - *
´ed
++;

1565 
	}
}

	@lencod/src/me_distortion_otf.c

12 
	~"cÚŒibutÜs.h
"

14 
	~<lim™s.h
>

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"mem®loc.h
"

19 
	~"mb_acûss.h
"

20 
	~"mv_£¬ch.h
"

21 
	~"me_di¡ÜtiÚ.h
"

22 
	~"me_di¡ÜtiÚ_Ùf.h
"

23 
	~"g‘_block_Ùf.h
"

25 
	~"»fbuf_Ùf.h
"

29 
	#CHECKOVERFLOW
(
mco¡
)

	)

38 
di¡blk
 
	$compu‹SAD_Ùf
(
StÜabËPiùu»
 *
»f1
,

39 
MEBlock
 *
mv_block
,

40 
di¡blk
 
mš_mco¡
,

41 
MÙiÚVeùÜ
 *
ÿnd
)

43 
mco¡
 = 0;

44 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

45 
y
,
x
;

46 
blocksize_x
 = 
mv_block
->blocksize_x;

47 
blocksize_y
 = 
mv_block
->blocksize_y;

48 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

49 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

50 #ià(
JM_MEM_DISTORTION
)

51 *
img³l_abs
 = 
p_Vid
->imgpel_abs;

53 
img³l
 *
¤c_lše
, *
»f_lše
 ;

54 
img³l
 
d©a
[
MB_PIXELS
];

55 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

57 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

58 
»f_lše
 = 
d©a
 ;

60 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 ) ;

62 
y
=0; y<
blocksize_y
; y++)

64 
x
 = 0; x < 
blocksize_x
; x+=4)

66 #ià(
JM_MEM_DISTORTION
)

67 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

68 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

69 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

70 
mco¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

72 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

73 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

74 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

75 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

78 if(
mco¡
 > 
imš_co¡
)

79  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

81 iàÐ
mv_block
->
ChromaMEEÇbË
 )

84 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

85 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

86 
k
;

87 
mü_co¡
 = 0;

89 
k
=0; k < 2; k++)

91 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

92 
»f_lše
 = 
d©a
 ;

93 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

94 
mü_co¡
 = 0;

96 
y
 = 0; y < 
blocksize_y_ü
; y++)

98 
x
 = 0; x < 
blocksize_x_ü
; x += 2)

100 #ià(
JM_MEM_DISTORTION
)

101 
mü_co¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

102 
mü_co¡
 +ð
img³l_abs
[ *
¤c_lše
++ - *
»f_lše
++ ];

104 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

105 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - *
»f_lše
++ );

109 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

111 if(
mco¡
 >
imš_co¡
)

112  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

116 
	`CHECKOVERFLOW
(
mco¡
);

117  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

118 
	}
}

126 
di¡blk
 
	$compu‹SADWP_Ùf
(
StÜabËPiùu»
 *
»f1
,

127 
MEBlock
 *
mv_block
,

128 
di¡blk
 
mš_mco¡
,

129 
MÙiÚVeùÜ
 *
ÿnd


132 
mco¡
 = 0;

133 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

134 
y
, 
x
;

135 
weigh‹d_³l
;

136 
blocksize_x
 = 
mv_block
->blocksize_x;

137 
blocksize_y
 = 
mv_block
->blocksize_y;

139 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

140 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

141 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

142 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

143 
weight
 = 
mv_block
->
weight_luma
;

144 
off£t
 = 
mv_block
->
off£t_luma
;

146 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

147 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

149 
img³l
 *
¤c_lše
, *
»f_lše
 ;

150 
img³l
 
d©a
[
MB_PIXELS
];

151 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

153 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

154 
»f_lše
 = 
d©a
 ;

156 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

158 
y
=0; y<
blocksize_y
; y++)

160 
x
 = 0; x < 
blocksize_x
; x+=4)

162 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

163 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

164 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

165 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

166 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

167 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

168 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

169 
mco¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

171 if(
mco¡
 > 
imš_co¡
)

172  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

174 iàÐ
mv_block
->
ChromaMEEÇbË
 )

177 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

178 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

179 
k
;

180 
mü_co¡
 = 0;

181 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

182 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

183 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

185 
k
=0; k < 2; k++)

187 
weight
 = 
mv_block
->
weight_ü
[
k
];

188 
off£t
 = 
mv_block
->
off£t_ü
[
k
];

190 
mü_co¡
 = 0;

191 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

192 
»f_lše
 = 
d©a
 ;

193 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

195 
y
=0; y<
blocksize_y_ü
; y++)

197 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

199 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

200 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

201 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

202 
mü_co¡
 +ð
	`Ÿbs
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

205 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

207 if(
mco¡
 >
imš_co¡
)

208  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

212 
	`CHECKOVERFLOW
(
mco¡
);

213  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

214 
	}
}

222 
di¡blk
 
	$compu‹BiP»dSAD1_Ùf
(
StÜabËPiùu»
 *
»f1
,

223 
StÜabËPiùu»
 *
»f2
,

224 
MEBlock
 *
mv_block
,

225 
di¡blk
 
mš_mco¡
,

226 
MÙiÚVeùÜ
 *
ÿnd1
,

227 
MÙiÚVeùÜ
 *
ÿnd2
)

229 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

230 
mco¡
 = 0;

231 
bi_diff
;

232 
y
,
x
;

233 
blocksize_x
 = 
mv_block
->blocksize_x;

234 
blocksize_y
 = 
mv_block
->blocksize_y;

235 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

236 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

237 #ià(
JM_MEM_DISTORTION
)

238 *
img³l_abs
 = 
p_Vid
->imgpel_abs;

241 
img³l
 *
¤c_lše
, *
»f2_lše
, *
»f1_lše
 ;

242 
img³l
 
d©a2
[
MB_PIXELS
], 
d©a1
[MB_PIXELS];

243 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

245 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

246 
»f2_lše
 = 
d©a2
 ;

247 
»f1_lše
 = 
d©a1
 ;

249 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f2
, 0 );

250 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

252 
y
 = 0; y < 
blocksize_y
; y++)

254 
x
 = 0; x < 
blocksize_x
; x+=4)

256 #ià(
JM_MEM_DISTORTION
)

257 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

258 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

259 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

260 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

261 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

262 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

263 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

264 
mco¡
 +ð
img³l_abs
[ 
bi_diff
 ];

266 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

267 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

268 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

269 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

270 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

271 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

272 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

273 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

276 if(
mco¡
 > 
imš_co¡
)

277  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

280 iàÐ
mv_block
->
ChromaMEEÇbË
 )

283 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

284 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

285 
k
;

286 
mü_co¡
 = 0;

288 
k
=1; k<3; k++)

290 
mü_co¡
 = 0;

292 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
];

293 
»f2_lše
 = 
d©a2
 ;

294 
»f1_lše
 = 
d©a1
 ;

295 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f2
, 
k
 ) ;

296 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
 ) ;

298 
y
=0; y<
blocksize_y_ü
; y++)

300 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

302 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

303 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

304 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

305 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

308 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

310 if(
mco¡
 > 
imš_co¡
)

311  (
	`di¡_sÿË_f
((
di¡blk
)
mco¡
));

315 
	`CHECKOVERFLOW
(
mco¡
);

316  (
	`di¡_sÿË
((
di¡blk
)
mco¡
));

317 
	}
}

325 
di¡blk
 
	$compu‹BiP»dSAD2_Ùf
(
StÜabËPiùu»
 *
»f1
,

326 
StÜabËPiùu»
 *
»f2
,

327 
MEBlock
 *
mv_block
,

328 
di¡blk
 
mš_mco¡
,

329 
MÙiÚVeùÜ
 *
ÿnd1
,

330 
MÙiÚVeùÜ
 *
ÿnd2
)

332 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

333 
mco¡
 = 0;

334 
bi_diff
;

335 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

336 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

337 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

338 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

339 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

340 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

341 
y
,
x
;

342 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

343 
blocksize_x
 = 
mv_block
->blocksize_x;

344 
blocksize_y
 = 
mv_block
->blocksize_y;

345 
weight1
 = 
mv_block
->weight1;

346 
weight2
 = 
mv_block
->weight2;

347 
off£tBi
 = 
mv_block
->offsetBi;

349 
img³l
 *
¤c_lše
, *
»f2_lše
, *
»f1_lše
 ;

350 
img³l
 
d©a2
[
MB_PIXELS
], 
d©a1
[MB_PIXELS];

351 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

352 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

353 
»f2_lše
 = 
d©a2
 ;

354 
»f1_lše
 = 
d©a1
 ;

356 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f2
, 0 );

357 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

359 
y
=0; y<
blocksize_y
; y++)

361 
x
 = 0; x < 
blocksize_x
; x+=4)

363 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

364 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

365 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

366 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

367 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

369 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

370 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

371 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

372 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

373 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

375 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

376 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

377 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

378 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

379 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

381 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

382 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

383 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

384 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

385 
mco¡
 +ð
	`Ÿbs
(
bi_diff
);

388 if(
mco¡
 > 
imš_co¡
)

389  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

392 iàÐ
mv_block
->
ChromaMEEÇbË
 )

395 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

396 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

397 
k
;

398 
mü_co¡
 = 0;

399 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

401 
k
=0; k<2; k++)

403 
weight1
 = 
mv_block
->
weight1_ü
[
k
];

404 
weight2
 = 
mv_block
->
weight2_ü
[
k
];

405 
off£tBi
 = 
mv_block
->
off£tBi_ü
[
k
];

407 
mü_co¡
 = 0;

408 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

409 
»f2_lše
 = 
d©a2
 ;

410 
»f1_lše
 = 
d©a1
 ;

411 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f2
, 
k
+1 ) ;

412 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

414 
y
=0; y<
blocksize_y_ü
; y++)

416 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

418 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

419 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

420 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

421 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

422 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

424 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

425 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

426 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

427 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

428 
mü_co¡
 +ð
	`Ÿbs
(
bi_diff
);

431 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

433 if(
mco¡
 > 
imš_co¡
)

434  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

438 
	`CHECKOVERFLOW
(
mco¡
);

439  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

440 
	}
}

448 
di¡blk
 
	$compu‹SATD_Ùf
(
StÜabËPiùu»
 *
»f1
,

449 
MEBlock
 *
mv_block
,

450 
di¡blk
 
mš_mco¡
,

451 
MÙiÚVeùÜ
 *
ÿnd


454 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

455 
mco¡
 = 0;

456 
y
, 
x
, 
y4
;

457 
¤c_size_x
, 
¤c_size_mul
;

458 
blocksize_x
 = 
mv_block
->blocksize_x;

459 
blocksize_y
 = 
mv_block
->blocksize_y;

460 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

461 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

463 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

464 *
d
, 
diff
[
MB_PIXELS
];

465 
img³l
 *
¤c_lše
, *
»f_lše
, 
d©a
[
MB_PIXELS
] ;

466 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

469 iàÐ!
mv_block
->
‹¡8x8
 )

471 
¤c_size_x
 = 
blocksize_x
 - 
BLOCK_SIZE
;

472 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

473 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

475 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

477 
d
 = 
diff
;

478 
»f_lše
 = 
d©a
 ;

479 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
 + (
x
<<2è, 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f1
, 0 );

480 
¤c_lše
 = 
¤c_tmp
 + 
x
;

481 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

483 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

484 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

485 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

486 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

488 
¤c_lše
 +ð
¤c_size_x
;

490 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

491 if(
mco¡
 > 
imš_co¡
)

492  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

494 
¤c_tmp
 +ð
¤c_size_mul
;

499 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

500 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

501 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_8x8_SP
) )

503 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

505 
d
 = 
diff
;

506 
»f_lše
 = 
d©a
 ;

507 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
 + (
x
<<2è, 
y
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f1
, 0 );

508 
¤c_lše
 = 
¤c_tmp
 + 
x
;

509 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

511 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

512 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

513 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

514 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

515 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

516 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

517 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

518 *
d
++ = *
¤c_lše
++ - *
»f_lše
++ ;

520 
¤c_lše
 +ð
¤c_size_x
;

522 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

523 if(
mco¡
 > 
imš_co¡
)

524  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

526 
¤c_tmp
 +ð
¤c_size_mul
;

530 
	`CHECKOVERFLOW
(
mco¡
);

531  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

532 
	}
}

540 
di¡blk
 
	$compu‹SATDWP_Ùf
(
StÜabËPiùu»
 *
»f1
,

541 
MEBlock
 *
mv_block
,

542 
di¡blk
 
mš_mco¡
,

543 
MÙiÚVeùÜ
 *
ÿnd


546 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

547 
mco¡
 = 0;

548 
y
, 
x
, 
y4
;

549 
weigh‹d_³l
;

550 
¤c_size_x
, 
¤c_size_mul
;

551 
blocksize_x
 = 
mv_block
->blocksize_x;

552 
blocksize_y
 = 
mv_block
->blocksize_y;

554 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

555 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

556 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

557 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

558 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

559 
weight
 = 
mv_block
->
weight_luma
;

560 
off£t
 = 
mv_block
->
off£t_luma
;

562 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

563 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

564 *
d
, 
diff
[
MB_PIXELS
];

565 
img³l
 *
¤c_lše
, *
»f_lše
, 
d©a
[
MB_PIXELS
];

566 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

568 iàÐ!
mv_block
->
‹¡8x8
 )

570 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

571 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

572 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

574 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

576 
d
 = 
diff
;

577 
»f_lše
 = 
d©a
;

578 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
 + (
x
<<2è, 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f1
, 0 );

579 
¤c_lše
 = 
¤c_tmp
 + 
x
;

580 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

582 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

583 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

584 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

585 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

586 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

587 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

588 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

589 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

591 
¤c_lše
 +ð
¤c_size_x
;

593 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

595 if(
mco¡
 > 
imš_co¡
)

596  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

598 
¤c_tmp
 +ð
¤c_size_mul
;

603 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

604 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

605 
y
 = 
ÿnd
->
mv_y
; y < cªd->mv_y + (
blocksize_y
<<2); y +ð(
BLOCK_SIZE_8x8_SP
) )

607 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

609 
d
 = 
diff
;

610 
»f_lše
 = 
d©a
;

611 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
 + (
x
<<2è, 
y
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f1
, 0 );

612 
¤c_lše
 = 
¤c_tmp
 + 
x
;

613 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

615 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

616 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

617 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

618 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

619 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

620 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

621 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

622 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

623 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

624 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

625 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

626 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

627 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

628 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

629 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

630 *
d
++ = (è(*
¤c_lše
++ - 
weigh‹d_³l
);

632 
¤c_lše
 +ð
¤c_size_x
;

634 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

635 if(
mco¡
 > 
imš_co¡
)

636  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

638 
¤c_tmp
 +ð
¤c_size_mul
;

642 
	`CHECKOVERFLOW
(
mco¡
);

643  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

644 
	}
}

652 
di¡blk
 
	$compu‹BiP»dSATD1_Ùf
(
StÜabËPiùu»
 *
»f1
,

653 
StÜabËPiùu»
 *
»f2
,

654 
MEBlock
 *
mv_block
,

655 
di¡blk
 
mš_mco¡
,

656 
MÙiÚVeùÜ
 *
ÿnd1
,

657 
MÙiÚVeùÜ
 *
ÿnd2
)

659 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

660 
mco¡
 = 0;

661 
y
, 
x
, 
y4
;

662 
¤c_size_x
, 
¤c_size_mul
;

663 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

664 *
d
, 
diff
[
MB_PIXELS
];

665 
img³l
 *
¤c_lše
, *
»f1_lše
, *
»f2_lše
, 
d©a1
[
MB_PIXELS
], 
d©a2
[MB_PIXELS] ;

666 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

667 
blocksize_x
 = 
mv_block
->blocksize_x;

668 
blocksize_y
 = 
mv_block
->blocksize_y;

669 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

670 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

672 iàÐ!
mv_block
->
‹¡8x8
 )

674 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

675 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

676 
y
=0; y<(
blocksize_y
<<2); y +ð(
BLOCK_SIZE_SP
))

678 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

680 
d
 = 
diff
;

681 
»f2_lše
 = 
d©a2
;

682 
»f1_lše
 = 
d©a1
;

683 
¤c_lše
 = 
¤c_tmp
 + 
x
;

684 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
 + (
x
<<2è, cªd2->
mv_y
 + 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f2
, 0 );

685 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
 + (
x
<<2è, cªd1->
mv_y
 + 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f1
, 0 );

687 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

689 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

690 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

691 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

692 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

694 
¤c_lše
 +ð
¤c_size_x
;

696 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

697 if(
mco¡
 > 
imš_co¡
)

698  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

700 
¤c_tmp
 +ð
¤c_size_mul
;

705 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

706 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

707 
y
=0; y<(
blocksize_y
 << 2); y +ð
BLOCK_SIZE_8x8_SP
 )

709 
y_pos2
 = 
ÿnd2
->
mv_y
 + 
y
;

710 
y_pos1
 = 
ÿnd1
->
mv_y
 + 
y
;

711 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

713 
d
 = 
diff
;

714 
»f2_lše
 = 
d©a2
;

715 
»f1_lše
 = 
d©a1
;

716 
¤c_lše
 = 
¤c_tmp
 + 
x
;

717 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
 + (
x
<<2è, 
y_pos2
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f2
, 0 );

718 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
 + (
x
<<2è, 
y_pos1
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f1
, 0 );

720 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

722 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

723 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

724 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

725 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

726 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

727 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

728 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

729 *
d
++ = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

731 
¤c_lše
 +ð
¤c_size_x
;

733 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

734 if(
mco¡
 > 
imš_co¡
)

735  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

737 
¤c_tmp
 +ð
¤c_size_mul
;

741 
	`CHECKOVERFLOW
(
mco¡
);

742  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

743 
	}
}

751 
di¡blk
 
	$compu‹BiP»dSATD2_Ùf
(
StÜabËPiùu»
 *
»f1
,

752 
StÜabËPiùu»
 *
»f2
,

753 
MEBlock
 *
mv_block
,

754 
di¡blk
 
mš_mco¡
,

755 
MÙiÚVeùÜ
 *
ÿnd1
,

756 
MÙiÚVeùÜ
 *
ÿnd2
)

758 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

759 
mco¡
 = 0;

760 
y
, 
x
, 
y4
;

761 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

762 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

763 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

764 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

765 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

766 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

767 
weight1
 = 
mv_block
->weight1;

768 
weight2
 = 
mv_block
->weight2;

769 
off£tBi
 = 
mv_block
->offsetBi;

772 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

773 
¤c_size_x
, 
¤c_size_mul
;

774 
img³l
 *
¤c_tmp
 = 
mv_block
->
Üig_pic
[0];

775 *
d
, 
diff
[
MB_PIXELS
];

776 
img³l
 *
¤c_lše
, *
»f1_lše
, *
»f2_lše
, 
d©a1
[
MB_PIXELS
], 
d©a2
[MB_PIXELS] ;

777 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

778 
blocksize_x
 = 
mv_block
->blocksize_x;

779 
blocksize_y
 = 
mv_block
->blocksize_y;

781 iàÐ!
mv_block
->
‹¡8x8
 )

783 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE
);

784 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE
;

785 
y
=0; y<(
blocksize_y
<<2); y +ð
BLOCK_SIZE_SP
)

787 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE
)

789 
d
 = 
diff
;

790 
»f2_lše
 = 
d©a2
;

791 
»f1_lše
 = 
d©a1
;

792 
¤c_lše
 = 
¤c_tmp
 + 
x
;

793 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
 + (
x
<<2è, cªd2->
mv_y
 + 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f2
, 0 );

794 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
 + (
x
<<2è, cªd1->
mv_y
 + 
y
, 
BLOCK_SIZE
, BLOCK_SIZE, 
»f1
, 0 );

796 
y4
 = 0; y4 < 
BLOCK_SIZE
; y4++ )

799 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

800 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

801 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

802 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

804 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

805 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

806 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

807 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

809 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

810 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

811 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

812 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

814 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

815 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

816 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

817 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

819 
¤c_lše
 +ð
¤c_size_x
;

821 
mco¡
 +ð
	`Hadam¬dSAD4x4
 (
diff
);

822 if(
mco¡
 > 
imš_co¡
)

823  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

825 
¤c_tmp
 +ð
¤c_size_mul
;

830 
¤c_size_x
 = (
blocksize_x
 - 
BLOCK_SIZE_8x8
);

831 
¤c_size_mul
 = 
blocksize_x
 * 
BLOCK_SIZE_8x8
;

832 
y
=0; y < (
blocksize_y
 << 2); y +ð
BLOCK_SIZE_8x8_SP
 )

834 
y_pos2
 = 
ÿnd2
->
mv_y
 + 
y
;

835 
y_pos1
 = 
ÿnd1
->
mv_y
 + 
y
;

836 
x
=0; x<
blocksize_x
; x +ð
BLOCK_SIZE_8x8
 )

838 
d
 = 
diff
;

839 
»f2_lše
 = 
d©a2
;

840 
»f1_lše
 = 
d©a1
;

841 
¤c_lše
 = 
¤c_tmp
 + 
x
;

842 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
 + (
x
<<2è, 
y_pos2
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f2
, 0 );

843 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
 + (
x
<<2è, 
y_pos1
, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
»f1
, 0 );

845 
y4
 = 0; y4 < 
BLOCK_SIZE_8x8
; y4++ )

848 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

849 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

850 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

851 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

853 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

854 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

855 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

856 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

858 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

859 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

860 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

861 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

863 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

864 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

865 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

866 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

868 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

869 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

870 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

871 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

873 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

874 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

875 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

876 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

878 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

879 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

880 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

881 *
d
++ = (è((*
¤c_lše
++è- 
weigh‹d_³l
);

883 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

884 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

885 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

886 *
d
++ = (è((*
¤c_lše
è- 
weigh‹d_³l
);

888 
¤c_lše
 +ð
¤c_size_x
;

890 
mco¡
 +ð
	`Hadam¬dSAD8x8
 (
diff
);

891 if(
mco¡
 > 
imš_co¡
)

892  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

894 
¤c_tmp
 +ð
¤c_size_mul
;

897 
	`CHECKOVERFLOW
(
mco¡
);

898  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

899 
	}
}

907 
di¡blk
 
	$compu‹SSE_Ùf
(
StÜabËPiùu»
 *
»f1
,

908 
MEBlock
 *
mv_block
,

909 
di¡blk
 
mš_mco¡
,

910 
MÙiÚVeùÜ
 *
ÿnd


913 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

914 
mco¡
 = 0;

915 
y
,
x
;

916 
blocksize_x
 = 
mv_block
->blocksize_x;

917 
blocksize_y
 = 
mv_block
->blocksize_y;

918 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

919 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

921 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

922 
img³l
 *
»f_lše
 , 
d©a
[
MB_PIXELS
] ;

923 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

924 
»f_lše
 = 
d©a
;

926 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

928 
y
=0; y<
blocksize_y
; y++)

930 
x
 = 0; x < 
blocksize_x
; x+=4)

932 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

933 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

934 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

935 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

937 if(
mco¡
 > 
imš_co¡
)

938  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

941 iàÐ
mv_block
->
ChromaMEEÇbË
 )

944 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

945 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

946 
k
;

947 
mü_co¡
 = 0;

949 
k
=0; k<2; k++)

951 
mü_co¡
 = 0;

952 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

953 
»f_lše
 = 
d©a
 ;

954 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

955 
y
=0; y<
blocksize_y_ü
; y++)

957 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

959 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

960 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - *
»f_lše
++ );

963 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

964 if(
mco¡
 > 
imš_co¡
)

965  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

969 
	`CHECKOVERFLOW
(
mco¡
);

970  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

971 
	}
}

979 
di¡blk
 
	$compu‹SSEWP_Ùf
(
StÜabËPiùu»
 *
»f1
,

980 
MEBlock
 *
mv_block
,

981 
di¡blk
 
mš_mco¡
,

982 
MÙiÚVeùÜ
 *
ÿnd


985 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

986 
mco¡
 = 0;

987 
y
,
x
;

988 
weigh‹d_³l
;

989 
blocksize_x
 = 
mv_block
->blocksize_x;

990 
blocksize_y
 = 
mv_block
->blocksize_y;

991 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

992 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

993 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

994 
weight
 = 
mv_block
->
weight_luma
;

995 
off£t
 = 
mv_block
->
off£t_luma
;

997 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

998 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

999 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

1001 
img³l
 *
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1002 
img³l
 *
»f_lše
 , 
d©a
[
MB_PIXELS
] ;

1003 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

1005 
»f_lše
 = 
d©a
;

1006 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

1008 
y
=0; y<
blocksize_y
; y++)

1010 
x
 = 0; x < 
blocksize_x
; x+=4)

1012 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1013 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1014 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1015 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1016 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1017 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1018 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
weight
 * *
»f_lše
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t
);

1019 
mco¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1021 if(
mco¡
 > 
imš_co¡
)

1022  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1025 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1029 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1030 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1031 
k
;

1032 
mü_co¡
 = 0;

1033 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

1034 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

1035 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

1037 
k
=0; k<2; k++)

1039 
weight
 = 
mv_block
->
weight_ü
[
k
];

1040 
off£t
 = 
mv_block
->
off£t_ü
[
k
];

1042 
mü_co¡
 = 0;

1043 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1044 
»f_lše
 = 
d©a
 ;

1045 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f_lše
, 
tmp_lše
, 
ÿnd
->
mv_x
, cªd->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

1046 
y
=0; y<
blocksize_y_ü
; y++)

1049 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1051 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

1052 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1053 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight
 * *
»f_lše
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t
);

1054 
mü_co¡
 +ð
	`Ÿbs2
Ð*
¤c_lše
++ - 
weigh‹d_³l
 );

1057 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1058 if(
mco¡
 > 
imš_co¡
)

1059  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1063 
	`CHECKOVERFLOW
(
mco¡
);

1064  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1065 
	}
}

1073 
di¡blk
 
	$compu‹BiP»dSSE1_Ùf
(
StÜabËPiùu»
 *
»f1
,

1074 
StÜabËPiùu»
 *
»f2
,

1075 
MEBlock
 *
mv_block
,

1076 
di¡blk
 
mš_mco¡
,

1077 
MÙiÚVeùÜ
 *
ÿnd1
,

1078 
MÙiÚVeùÜ
 *
ÿnd2
)

1080 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1081 
mco¡
 = 0;

1082 
bi_diff
;

1083 
y
,
x
;

1084 
blocksize_x
 = 
mv_block
->blocksize_x;

1085 
blocksize_y
 = 
mv_block
->blocksize_y;

1086 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1087 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1089 
img³l
 *
¤c_lše
, *
»f2_lše
, *
»f1_lše
 ;

1090 
img³l
 
d©a2
[
MB_PIXELS
], 
d©a1
[MB_PIXELS];

1091 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

1092 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1093 
»f2_lše
 = 
d©a2
 ;

1094 
»f1_lše
 = 
d©a1
 ;

1096 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f2
, 0 );

1097 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

1099 
y
 = 0; y < 
blocksize_y
; y++)

1101 
x
 = 0; x < 
blocksize_x
; x+=4)

1103 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1104 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1105 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1106 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1107 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1108 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1109 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1110 
mco¡
 +ð
	`Ÿbs2
(
bi_diff
);

1112 if(
mco¡
 > 
imš_co¡
)

1113  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1116 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1119 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1120 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1121 
k
;

1122 
mü_co¡
 = 0;

1124 
k
=0; k<2; k++)

1126 
mü_co¡
 = 0;

1127 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1128 
»f2_lše
 = 
d©a2
 ;

1129 
»f1_lše
 = 
d©a1
 ;

1130 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f2
, 
k
+1 ) ;

1131 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

1133 
y
=0; y<
blocksize_y_ü
; y++)

1135 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1137 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1138 
mü_co¡
 +ð
	`Ÿbs2
(
bi_diff
);

1139 
bi_diff
 = (*
¤c_lše
++è- ((*
»f1_lše
++ + *
»f2_lše
++ + 1)>>1);

1140 
mü_co¡
 +ð
	`Ÿbs2
(
bi_diff
);

1143 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1144 if(
mco¡
 > 
imš_co¡
)

1145  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1149 
	`CHECKOVERFLOW
(
mco¡
);

1150  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1151 
	}
}

1159 
di¡blk
 
	$compu‹BiP»dSSE2_Ùf
(
StÜabËPiùu»
 *
»f1
,

1160 
StÜabËPiùu»
 *
»f2
,

1161 
MEBlock
 *
mv_block
,

1162 
di¡blk
 
mš_mco¡
,

1163 
MÙiÚVeùÜ
 *
ÿnd1
,

1164 
MÙiÚVeùÜ
 *
ÿnd2
)

1166 
imš_co¡
 = 
	`di¡_down
(
mš_mco¡
);

1167 
mco¡
 = 0;

1168 
bi_diff
;

1169 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1170 
Sliû
 *
cu¼Sliû
 = 
mv_block
->
p_Sliû
;

1171 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1172 
d’om
 = 
cu¼Sliû
->
luma_log_weight_d’om
 + 1;

1173 
Ìound
 = 2 * 
cu¼Sliû
->
wp_luma_round
;

1174 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

1175 
y
,
x
;

1176 
weigh‹d_³l
, 
pix–1
, 
pix–2
;

1177 
weight1
 = 
mv_block
->weight1;

1178 
weight2
 = 
mv_block
->weight2;

1179 
off£tBi
 = 
mv_block
->offsetBi;

1181 
blocksize_x
 = 
mv_block
->blocksize_x;

1182 
blocksize_y
 = 
mv_block
->blocksize_y;

1184 
img³l
 *
¤c_lše
, *
»f2_lše
, *
»f1_lše
 ;

1185 
img³l
 
d©a2
[
MB_PIXELS
], 
d©a1
[MB_PIXELS];

1186 
tmp_lše
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

1187 
¤c_lše
 = 
mv_block
->
Üig_pic
[0];

1188 
»f2_lše
 = 
d©a2
 ;

1189 
»f1_lše
 = 
d©a1
 ;

1191 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f2
, 0 );

1192 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x
, 
blocksize_y
, 
»f1
, 0 );

1194 
y
=0; y<
blocksize_y
; y++)

1196 
x
 = 0; x < 
blocksize_x
; x+=4)

1198 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1199 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1200 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1201 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1202 
mco¡
 +ð
bi_diff
 * bi_diff;

1204 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1205 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1206 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1207 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1208 
mco¡
 +ð
bi_diff
 * bi_diff;

1210 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1211 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1212 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1213 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1214 
mco¡
 +ð
bi_diff
 * bi_diff;

1216 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1217 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1218 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1219 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1220 
mco¡
 +ð
bi_diff
 * bi_diff;

1222 if(
mco¡
 > 
imš_co¡
)

1223  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1226 iàÐ
mv_block
->
ChromaMEEÇbË
 )

1229 
blocksize_x_ü
 = 
mv_block
->
blocksize_ü_x
;

1230 
blocksize_y_ü
 = 
mv_block
->
blocksize_ü_y
;

1231 
k
;

1232 
mü_co¡
 = 0;

1233 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

1235 
k
=0; k<2; k++)

1237 
weight1
 = 
mv_block
->
weight1_ü
[
k
];

1238 
weight2
 = 
mv_block
->
weight2_ü
[
k
];

1239 
off£tBi
 = 
mv_block
->
off£tBi_ü
[
k
];

1241 
mü_co¡
 = 0;

1242 
¤c_lše
 = 
mv_block
->
Üig_pic
[
k
+1];

1243 
»f2_lše
 = 
d©a2
 ;

1244 
»f1_lše
 = 
d©a1
 ;

1245 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f2_lše
, 
tmp_lše
, 
ÿnd2
->
mv_x
, cªd2->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f2
, 
k
+1 ) ;

1246 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»f1_lše
, 
tmp_lše
, 
ÿnd1
->
mv_x
, cªd1->
mv_y
, 
blocksize_x_ü
, 
blocksize_y_ü
, 
»f1
, 
k
+1 ) ;

1248 
y
=0; y<
blocksize_y_ü
; y++)

1250 
x
 = 0; x < 
blocksize_x_ü
; x+=2)

1252 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1253 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1254 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1255 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1256 
mü_co¡
 +ð
bi_diff
 * bi_diff;

1258 
pix–1
 = 
weight1
 * (*
»f1_lše
++);

1259 
pix–2
 = 
weight2
 * (*
»f2_lše
++);

1260 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
pix–1
 + 
pix–2
 + 
Ìound
è>> 
d’om
è+ 
off£tBi
);

1261 
bi_diff
 = (*
¤c_lše
++è- 
weigh‹d_³l
;

1262 
mü_co¡
 +ð
bi_diff
 * bi_diff;

1265 
mco¡
 +ð
mv_block
->
ChromaMEWeight
 * 
mü_co¡
;

1266 if(
mco¡
 > 
imš_co¡
)

1267  
	`di¡_sÿË_f
((
di¡blk
)
mco¡
);

1271 
	`CHECKOVERFLOW
(
mco¡
);

1272  
	`di¡_sÿË
((
di¡blk
)
mco¡
);

1273 
	}
}

	@lencod/src/me_epzs.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mem®loc.h
"

24 
	~"mb_acûss.h
"

25 
	~"»fbuf.h
"

26 
	~"maüoblock.h
"

27 
	~"me_di¡ÜtiÚ.h
"

28 
	~"me_•zs.h
"

29 
	~"me_•zs_commÚ.h
"

30 
	~"mv_£¬ch.h
"

40 
šlše
 
	$£t_š‹g”_mv
(
MÙiÚVeùÜ
 *
mv
)

42 
mv
->
mv_x
 &= 0xFFFC;

43 
mv
->
mv_y
 &= 0xFFFC;

44 
	}
}

53 
di¡blk


54 
	$EPZS_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

55 
MÙiÚVeùÜ
 * 
´ed_mv
,

56 
MEBlock
 * 
mv_block
,

57 
di¡blk
 
mš_mco¡
,

58 
Ïmbda_çùÜ


61 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

62 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

63 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

64 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

65 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

67 
blockty³
 = 
mv_block
->blocktype;

69 
li¡
 = 
mv_block
->list;

70 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

71 
»f
 = 
mv_block
->
»f_idx
;

72 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

73 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

74 
m­C’‹r_x
 = 
£¬chRªge
->
max_x
 - 
mv
->
mv_x
;

75 
m­C’‹r_y
 = 
£¬chRªge
->
max_y
 - 
mv
->
mv_y
;

76 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

78 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 2);

79 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

80 
di¡blk
 *
´evSad
 = &
p_EPZS
->
di¡ÜtiÚ
[
cur_li¡
][
blockty³
 - 1][
mv_block
->
pos_x2
];

82 
MÙiÚVeùÜ
 *
p_mÙiÚ
 = 
NULL
;

84 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

85 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

86 
ušt16
 *
EPZSPošt
 = &
p_EPZS
->
EPZSM­
[
£¬chRªge
->
max_y
][£¬chRªge->
max_x
];

88 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

89 
MÙiÚVeùÜ
 
´ed
 = 
	`·d_MVs
 (*
´ed_mv
, 
mv_block
);

90 
MÙiÚVeùÜ
 
tmp
 = *
mv
, 
ÿnd
 = 
ûÁ”
;

92 ++
p_EPZS
->
BlkCouÁ
;

93 ià(
p_EPZS
->
BlkCouÁ
 == 0)

94 ++
p_EPZS
->
BlkCouÁ
;

96 ià(
p_IÅ
->
EPZSS·tŸlMem
)

98 #ià
EPZSREF


99 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
»f
][
blockty³
 - 1][
mv_block
->
block_y
][mv_block->
pos_x2
];

101 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
blockty³
 - 1][
mv_block
->
block_y
][mv_block->
pos_x2
];

109 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

112 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

115 
mš_mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
DISTBLK_MAX
 - mš_mco¡, &
ÿnd
);

118 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
è&& (*
´evSad
 < 
	`di¡blkmš
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, 
mš_mco¡
)))

120 #ià
EPZSREF


121 ià(
p_IÅ
->
EPZSS·tŸlMem
)

123 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

126 *
p_mÙiÚ
 = 
tmp
;

128  
mš_mco¡
;

133 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

135 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

136 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

137 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

138 
di¡blk
 
mco¡
;

139 
´ednum
 = 5;

140 
cÚd™iÚEPZS
;

141 
MÙiÚVeùÜ
 
tmp2
 = {0, 0}, 
tmv
;

142 
pos
;

143 
šv®id_»fs
 = 0;

145 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

147 ià(
mš_mco¡
 < (
¡ÝCr™”iÚ
 >> 1))

149 #ià
EPZSREF


150 ià(
p_IÅ
->
EPZSS·tŸlMem
)

152 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

155 *
p_mÙiÚ
 = 
tmp
;

158  
mš_mco¡
;

164 
šv®id_»fs
 = 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
,

165 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

167 ià(
p_IÅ
->
EPZSS·tŸlMem
)

168 
	`EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
cur_li¡
, &
´ednum
, 
»f_piùu»
->
size_x
 >> 2);

172 ià(
p_IÅ
->
HMEEÇbË
 =ð1 &&…_IÅ->
EPZSU£HMEP»diùÜs
 == 1)

173 
	`EPZS_h›¿rchiÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
, &
´ednum
, 
»f_piùu»
, 
cu¼Sliû
);

175 #ià(
MVC_EXTENSION_ENABLE
)

176 iàÐ
p_IÅ
->
EPZSTempÜ®
[
cu¼Sliû
->
v›w_id
] && 
blockty³
 < 5 )

179 ià(
p_IÅ
->
EPZSTempÜ®
 && 
blockty³
 < 5)

182 
	`EPZS_‹mpÜ®_´ediùÜs
 (
cu¼MB
, 
»f_piùu»
, 
p_EPZS
, 
mv_block
, &
´ednum
, 
¡ÝCr™”iÚ
, 
mš_mco¡
);

198 
cÚd™iÚEPZS
 = (
p_IÅ
->
EPZSFixed
 =ð3 && (
cu¼MB
->
mb_x
 =ð0 || cu¼MB->
mb_y
 == 0))

199 || ((
mš_mco¡
 > 3 * 
¡ÝCr™”iÚ
è&& ((
»f
 < 2 && 
blockty³
 < 4) || (ref < 1 && blocktype == 4)

200 || ((
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 || 
cu¼MB
->
li¡_off£t
)

201 && 
»f
 < 3))

202 && (
p_IÅ
->
EPZSFixed
 > 1 || (p_IÅ->EPZSFixed && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
)));

204 ià(
cÚd™iÚEPZS
)

205 
	`EPZSWšdowP»diùÜs
 (
mv
, 
p_EPZS
->
´ediùÜ
, &
´ednum
,

206 (
p_IÅ
->
EPZSAgg»ssiveWšdow
 !ð0è|| ((
blockty³
 < 5è&& (
šv®id_»fs
 > 2è&& (
»f
 < 1 + (
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 || 
cu¼MB
->
li¡_off£t
)))

207 ? 
p_EPZS
->
wšdow_´ediùÜ_ext
 :…_EPZS->
wšdow_´ediùÜ
);

214 
cÚd™iÚEPZS
 = (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 > 2 * 
¡ÝCr™”iÚ
));

216 ià(
cÚd™iÚEPZS
 && 
cu¼MB
->
mbAddrX
 !ð0 && 
p_IÅ
->
EPZSBlockTy³
)

217 
	`EPZSBlockTy³P»diùÜsMB
 (
cu¼Sliû
, 
mv_block
, 
p_EPZS_pošt
, &
´ednum
);

220 
pos
 = 0;…o < 
´ednum
; ++pos)

222 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

223 
	`£t_š‹g”_mv
(&
tmv
);

226 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

228 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

229 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

231 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

232 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

235 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

237 ià(
mco¡
 < 
£cÚd_mco¡
)

239 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

242 ià(
mco¡
 < 
mš_mco¡
)

244 
tmp2
 = 
tmp
;

245 
tmp
 = 
tmv
;

246 
£cÚd_mco¡
 = 
mš_mco¡
;

247 
mš_mco¡
 = 
mco¡
;

248 
checkMedŸn
 = 
TRUE
;

251 ià(
mco¡
 < 
£cÚd_mco¡
)

253 
tmp2
 = 
tmv
;

254 
£cÚd_mco¡
 = 
mco¡
;

255 
checkMedŸn
 = 
TRUE
;

266 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

268 cÚ¡ 
mv_¿nge
 = 10;

269 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

270 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

273 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

275 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((3 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

277 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 == 0)

278 || (
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range)))

279 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

281 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

283 ià(
blockty³
 > 4 || (
»f
 > 0 && blocktype != 1))

284 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

286 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

290 
ûÁ”
 = 
tmp
;

294 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

297 
checkPts
 = 
tÙ®CheckPts
;

300 
tmv
 = 
	`add_MVs
 (
ûÁ”
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

302 ià(((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
è<ð0è&& ((Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
) <= 0))

304 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

305 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

307 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

308 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

310 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

312 ià(
mco¡
 < 
mš_mco¡
)

314 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

316 ià(
mco¡
 < 
mš_mco¡
)

318 
tmp
 = 
tmv
;

319 
mš_mco¡
 = 
mco¡
;

320 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

325 ++
poštNumb”
;

326 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

327 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

328 
checkPts
--;

330 
checkPts
 > 0);

332 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”
.mv_xè&& (tmp.
mv_y
 == center.mv_y)))

334 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

335 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

336 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

337 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

338 
mÙiÚDœeùiÚ
 = 0;

339 
poštNumb”
 = 0;

343 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

344 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

345 
ûÁ”
 = 
tmp
;

348 
·‰”nStÝ
 != 1);

350 ià((
»f
 > 0è&& (
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

351 && ((4 * *
´evSad
 < 
mš_mco¡
è|| ((3 * *´evSad < mš_mco¡è&& (*´evSad <ð
¡ÝCr™”iÚ
))))

353 *
mv
 = 
tmp
;

354 #ià
EPZSREF


355 ià(
p_IÅ
->
EPZSS·tŸlMem
)

357 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

360 *
p_mÙiÚ
 = 
tmp
;

363  
mš_mco¡
;

367 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
)

368 && ((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (
blockty³
 < 5))

369 && (
mš_mco¡
 > 
¡ÝCr™”iÚ
è&& (
p_IÅ
->
EPZSDu®
 > 0);

371 ià(!
cÚd™iÚEPZS
)

374 
poštNumb”
 = 0;

375 
·‰”nStÝ
 = 0;

376 
mÙiÚDœeùiÚ
 = 0;

377 
ÃxtLa¡
 = 0;

379 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv
->mv_x &&mp.mv_y == mv->mv_y))

381 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range))

382 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

384 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

387 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

390 
ûÁ”
 = 
tmp2
;

391 
checkMedŸn
 = 
FALSE
;

396 ià((
»f
 =ð0è|| (*
´evSad
 > 
mš_mco¡
))

397 *
´evSad
 = 
mš_mco¡
;

398 #ià
EPZSREF


399 ià(
p_IÅ
->
EPZSS·tŸlMem
)

401 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

404 *
p_mÙiÚ
 = 
tmp
;

409 *
mv
 = 
tmp
;

411  
mš_mco¡
;

412 
	}
}

421 
di¡blk


422 
	$EPZS_subMB_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

423 
MÙiÚVeùÜ
 * 
´ed_mv
,

424 
MEBlock
 * 
mv_block
,

425 
di¡blk
 
mš_mco¡
,

426 
Ïmbda_çùÜ


429 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

430 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

431 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

432 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

433 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

435 
blockty³
 = 
mv_block
->blocktype;

436 
li¡
 = 
mv_block
->list;

437 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

438 
»f
 = 
mv_block
->
»f_idx
;

439 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

441 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

442 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

443 
MÙiÚVeùÜ
 
ÿnd
 = 
ûÁ”
;

444 
MÙiÚVeùÜ
 
´ed
 = 
	`·d_MVs
 (*
´ed_mv
, 
mv_block
);

445 
MÙiÚVeùÜ
 
tmp
 = *
mv
;

446 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

447 
m­C’‹r_x
 = 
£¬chRªge
->
max_x
 - 
mv
->
mv_x
;

448 
m­C’‹r_y
 = 
£¬chRªge
->
max_y
 - 
mv
->
mv_y
;

450 
pic_pix_x2
 = 
mv_block
->
pos_x2
;

451 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
,3);

452 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

453 
di¡blk
 *
´evSad
 = &
p_EPZS
->
di¡ÜtiÚ
[
cur_li¡
][
blockty³
 - 1][
pic_pix_x2
];

454 
MÙiÚVeùÜ
 *
p_mÙiÚ
 = 
NULL
;

456 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

457 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

459 ++
p_EPZS
->
BlkCouÁ
;

460 ià(
p_EPZS
->
BlkCouÁ
 == 0)

461 ++
p_EPZS
->
BlkCouÁ
;

463 ià(
p_IÅ
->
EPZSS·tŸlMem
)

465 #ià
EPZSREF


466 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
»f
][
blockty³
 - 1][
mv_block
->
block_y
][
pic_pix_x2
];

468 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
blockty³
 - 1][
mv_block
->
block_y
][
pic_pix_x2
];

476 
p_EPZS
->
EPZSM­
[
£¬chRªge
->
max_y
][£¬chRªge->
max_x
] =…_EPZS->
BlkCouÁ
;

479 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

482 
mš_mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
DISTBLK_MAX
-mš_mco¡, &
ÿnd
);

485 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
) &&

486 (*
´evSad
 < 
	`di¡blkmš
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, 
mš_mco¡
)))

488 #ià
EPZSREF


489 ià(
p_IÅ
->
EPZSS·tŸlMem
)

491 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

494 *
p_mÙiÚ
 = 
tmp
;

496  
mš_mco¡
;

501 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

503 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

504 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

505 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

506 
di¡blk
 
mco¡
;

507 
´ednum
 = 5;

508 
cÚd™iÚEPZS
;

510 
MÙiÚVeùÜ
 
tmv
, 
tmp2
 = {0,0};

511 
pos
;

513 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

515 ià(
mš_mco¡
 < (
¡ÝCr™”iÚ
 >> 1))

517 #ià
EPZSREF


518 ià(
p_IÅ
->
EPZSS·tŸlMem
)

520 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

523 *
p_mÙiÚ
 = 
tmp
;

525  
mš_mco¡
;

531 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
 , 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

533 ià(
p_IÅ
->
EPZSS·tŸlMem
)

534 
	`EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
cur_li¡
, &
´ednum
, 
»f_piùu»
->
size_x
 >> 2);

540 
cÚd™iÚEPZS
 = (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 > 2 * 
¡ÝCr™”iÚ
));

542 ià(
cÚd™iÚEPZS
 && 
cu¼MB
->
mbAddrX
 !ð0 && 
p_IÅ
->
EPZSBlockTy³
)

543 
	`EPZSBlockTy³P»diùÜs
 (
cu¼Sliû
, 
mv_block
, 
p_EPZS_pošt
, &
´ednum
);

546 
pos
 = 0;…o < 
´ednum
; ++pos)

548 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

549 
	`£t_š‹g”_mv
(&
tmv
);

552 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

555 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

557 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

559 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

562 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

564 ià(
mco¡
 < 
£cÚd_mco¡
)

566 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

569 ià(
mco¡
 < 
mš_mco¡
)

571 
tmp2
 = 
tmp
;

572 
tmp
 = 
tmv
;

573 
£cÚd_mco¡
 = 
mš_mco¡
;

574 
mš_mco¡
 = 
mco¡
;

575 
checkMedŸn
 = 
TRUE
;

578 ià(
mco¡
 < 
£cÚd_mco¡
)

580 
tmp2
 = 
tmv
;

581 
£cÚd_mco¡
 = 
mco¡
;

582 
checkMedŸn
 = 
TRUE
;

591 ià(
mš_mco¡
 < ((3 * 
¡ÝCr™”iÚ
) >> 2))

593 #ià
EPZSREF


594 ià(
p_IÅ
->
EPZSS·tŸlMem
)

596 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

599 *
p_mÙiÚ
 = 
tmp
;

601 *
mv
 = 
tmp
;

602  
mš_mco¡
;

610 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

612 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

613 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

614 cÚ¡ 
mv_¿nge
 = 12;

617 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

619 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((3 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

621 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (
	`Ÿbs
 (tmp.mv_x - 
mv
->mv_xè< (
mv_¿nge
) && iabs (tmp.mv_y - mv->mv_y) < (mv_range)))

622 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

624 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

627 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

631 
ûÁ”
 = 
tmp
;

634 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

637 
checkPts
 = 
tÙ®CheckPts
;

640 
tmv
 = 
	`add_MVs
 (
ûÁ”
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

642 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè<ð
£¬chRªge
->
max_x
è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè<ð£¬chRªge->
max_y
))

644 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

646 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

647 
ÿnd
 = 
	`·d_MVs
(
tmv
, 
mv_block
);

649 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

650 ià(
mco¡
 < 
mš_mco¡
)

653 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

655 ià(
mco¡
 < 
mš_mco¡
)

657 
tmp
 = 
tmv
;

658 
mš_mco¡
 = 
mco¡
;

659 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

664 ++
poštNumb”
;

665 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

666 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

667 
checkPts
--;

669 
checkPts
 > 0);

671 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”
.mv_xè&& (tmp.
mv_y
 == center.mv_y)))

673 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

674 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

675 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

676 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

677 
mÙiÚDœeùiÚ
 = 0;

678 
poštNumb”
 = 0;

682 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

683 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

684 
ûÁ”
 = 
tmp
;

687 
·‰”nStÝ
 != 1);

689 ià((
»f
 > 0è&& (
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

690 && ((4 * *
´evSad
 < 
mš_mco¡
è|| ((3 * *´evSad < mš_mco¡è&& (*´evSad <ð
¡ÝCr™”iÚ
))))

692 *
mv
 = 
tmp
;

693 #ià
EPZSREF


694 ià(
p_IÅ
->
EPZSS·tŸlMem
)

696 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

699 *
p_mÙiÚ
 = 
tmp
;

702  
mš_mco¡
;

706 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
)

707 && ((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
))

708 && (
mš_mco¡
 > 
¡ÝCr™”iÚ
è&& (
p_IÅ
->
EPZSDu®
 > 0);

710 ià(!
cÚd™iÚEPZS
)

713 
poštNumb”
 = 0;

714 
·‰”nStÝ
 = 0;

715 
mÙiÚDœeùiÚ
 = 0;

716 
ÃxtLa¡
 = 0;

718 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv
->mv_x &&mp.mv_y == mv->mv_y))

720 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range))

721 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

723 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

726 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

729 
ûÁ”
 = 
tmp2
;

730 
checkMedŸn
 = 
FALSE
;

735 ià((
»f
 =ð0è|| (*
´evSad
 > 
mš_mco¡
))

736 *
´evSad
 = 
mš_mco¡
;

738 #ià
EPZSREF


739 ià(
p_IÅ
->
EPZSS·tŸlMem
)

741 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

744 *
p_mÙiÚ
 = 
tmp
;

747 *
mv
 = 
tmp
;

749  
mš_mco¡
;

750 
	}
}

761 
di¡blk


762 
	$EPZS_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

763 
li¡
,

764 
MÙiÚVeùÜ
 * 
´ed_mv1
,

765 
MÙiÚVeùÜ
 * 
´ed_mv2
,

766 
MÙiÚVeùÜ
 * 
mv1
,

767 
MÙiÚVeùÜ
 * 
mv2
,

768 
MEBlock
 * 
mv_block
,

769 
£¬ch_¿nge
,

770 
di¡blk
 
mš_mco¡
,

771 
Ïmbda_çùÜ


774 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

775 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

776 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

777 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

778 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

780 
blockty³
 = 
mv_block
->blocktype;

781 
»f
 = 
mv_block
->
»f_idx
;

783 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
»f
];

784 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
cu¼MB
->
li¡_off£t
][0];

786 
m­C’‹r_x
 = 
£¬ch_¿nge
 - 
mv1
->
mv_x
;

787 
m­C’‹r_y
 = 
£¬ch_¿nge
 - 
mv1
->
mv_y
;

788 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 4);

789 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

790 
di¡blk
 *
´evSad
 = &
p_EPZS
->
bi_di¡ÜtiÚ
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
blockty³
 - 1][
mv_block
->
pos_x2
];

791 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

792 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

794 
MÙiÚVeùÜ
 
tmp
 = *
mv1
;

795 
MÙiÚVeùÜ
 
ûÁ”1
 = 
	`·d_MVs
 (*
mv1
, 
mv_block
);

796 
MÙiÚVeùÜ
 
ûÁ”2
 = 
	`·d_MVs
 (*
mv2
, 
mv_block
);

797 
MÙiÚVeùÜ
 
´ed1
 = 
	`·d_MVs
 (*
´ed_mv1
, 
mv_block
);

798 
MÙiÚVeùÜ
 
´ed2
 = 
	`·d_MVs
 (*
´ed_mv2
, 
mv_block
);

799 
MÙiÚVeùÜ
 
ÿnd1
 = 
ûÁ”1
;

800 
MÙiÚVeùÜ
 
ÿnd2
 = 
ûÁ”2
;

802 ++
p_EPZS
->
BlkCouÁ
;

803 ià(
p_EPZS
->
BlkCouÁ
 == 0)

804 ++
p_EPZS
->
BlkCouÁ
;

811 
p_EPZS
->
EPZSM­
[
£¬ch_¿nge
][£¬ch_¿nge] =…_EPZS->
BlkCouÁ
;

814 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

815 
mš_mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

818 
mš_mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
DISTBLK_MAX
-mš_mco¡, &
ÿnd1
, &
ÿnd2
);

821 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

823 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

824 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

825 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

826 
di¡blk
 
mco¡
;

827 
´ednum
 = 5;

828 
MÙiÚVeùÜ
 
tmv
, 
tmp2
 = { 0, 0 };

829 
pos
;

831 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

836 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
 , 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

839 
pos
 = 0;…o < 
´ednum
; ++pos)

841 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

842 
	`£t_š‹g”_mv
(&
tmv
);

844 ià(
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv1
->mv_xè<ð
£¬ch_¿nge
 && iab Ñmv.
mv_y
 - mv1->mv_y) <= search_range)

846 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

848 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

850 
ÿnd1
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

853 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

854 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

856 ià(
mco¡
 >ð
£cÚd_mco¡
)

859 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd1
, &
ÿnd2
);

862 ià(
mco¡
 < 
mš_mco¡
)

864 
tmp2
 = 
tmp
;

865 
tmp
 = 
tmv
;

866 
£cÚd_mco¡
 = 
mš_mco¡
;

867 
mš_mco¡
 = 
mco¡
;

868 
checkMedŸn
 = 
TRUE
;

871 ià(
mco¡
 < 
£cÚd_mco¡
)

873 
tmp2
 = 
tmv
;

874 
£cÚd_mco¡
 = 
mco¡
;

875 
checkMedŸn
 = 
TRUE
;

885 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

887 
cÚd™iÚEPZS
;

888 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

889 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

891 cÚ¡ 
mv_¿nge
 = 12;

894 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

896 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((4 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

898 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (
	`Ÿbs
 (tmp.mv_x - 
mv1
->mv_xè< (
mv_¿nge
) && iabs (tmp.mv_y - mv1->mv_y) < (mv_range)))

899 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

901 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

903 ià(
blockty³
 > 5 || (
»f
 > 0 && blocktype != 1))

904 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

906 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

910 
ûÁ”1
 = 
tmp
;

913 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

916 
checkPts
 = 
tÙ®CheckPts
;

919 
tmv
 = 
	`add_MVs
 (
ûÁ”1
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

921 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv1
->mv_xè<ð
£¬ch_¿nge
è&& (Ÿb Ñmv.
mv_y
 - mv1->mv_y) <= search_range))

923 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

925 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

926 
ÿnd1
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

928 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

929 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

931 ià(
mco¡
 < 
mš_mco¡
)

933 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd1
, &
ÿnd2
);

935 ià(
mco¡
 < 
mš_mco¡
)

937 
tmp
 = 
tmv
;

938 
mš_mco¡
 = 
mco¡
;

939 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

944 ++
poštNumb”
;

945 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

946 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

947 
checkPts
--;

949 
checkPts
 > 0);

951 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”1
.mv_xè&& (tmp.
mv_y
 == center1.mv_y)))

953 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

954 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

955 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

956 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

957 
mÙiÚDœeùiÚ
 = 0;

958 
poštNumb”
 = 0;

962 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

963 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

964 
ûÁ”1
 = 
tmp
;

967 
·‰”nStÝ
 != 1);

970 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
è&& (
blockty³
 < 5è&& (
mš_mco¡
 > 
¡ÝCr™”iÚ
è&& (
p_IÅ
->
EPZSDu®
 > 0);

972 ià(!
cÚd™iÚEPZS
)

975 
poštNumb”
 = 0;

976 
·‰”nStÝ
 = 0;

977 
mÙiÚDœeùiÚ
 = 0;

978 
ÃxtLa¡
 = 0;

980 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv1
->mv_x &&mp.mv_y == mv1->mv_y))

982 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv1
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv1->mv_y) < (mv_range))

983 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

985 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

988 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

989 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

992 
ûÁ”1
 = 
tmp2
;

993 
checkMedŸn
 = 
FALSE
;

998 ià(
mv_block
->
™”©iÚ_no
 == 0)

1000 *
´evSad
 = 
mš_mco¡
;

1003 *
mv1
 = 
tmp
;

1005  
mš_mco¡
;

1006 
	}
}

	@lencod/src/me_epzs_common.c

16 
	~<lim™s.h
>

18 
	~"cÚŒibutÜs.h
"

19 
	~"glob®.h
"

20 
	~"image.h
"

21 
	~"mem®loc.h
"

22 
	~"mb_acûss.h
"

23 
	~"»fbuf.h
"

24 
	~"maüoblock.h
"

25 
	~"me_di¡ÜtiÚ.h
"

26 
	~"me_•zs.h
"

27 
	~"me_hme.h
"

28 
	~"me_•zs_commÚ.h
"

29 
	~"me_•zs_št.h
"

30 
	~"me_fuÎ£¬ch.h
"

31 
	~"mv_£¬ch.h
"

33 cÚ¡ 
	gBLOCK_PARENT
[8] = { 1, 1, 1, 1, 2, 4, 4, 5 };

34 cÚ¡ 
	gMIN_THRES_BASE
[8] = { 0, 64, 32, 32, 16, 8, 8, 4 };

36 cÚ¡ 
	gMED_THRES_BASE
[8] = { 0, 192, 96, 96, 48, 24, 24, 12 };

37 cÚ¡ 
	gMAX_THRES_BASE
[8] = { 0, 768, 384, 384, 192, 96, 96, 48 };

40 cÚ¡ 
	gEPZS_PATTERN
[6][20] = { "Diamond", "Square", "Extended Diamond", "Large Diamond", "SBP Large Diamond", "PMVFAST" };

41 cÚ¡ 
	gEPZS_DUAL_PATTERN
[7][20] =

43 cÚ¡ 
	gEPZS_FIXED_PREDICTORS
[4][20] = { "Disabled", "All P", "All P + B", "Aggressive" };

44 cÚ¡ 
	gEPZS_OTHER_PREDICTORS
[2][20] = { "Disabled", "Enabled" };

45 cÚ¡ 
	gEPZS_SUBPEL_METHOD
[3][20] = { "Full", "Basic", "Enhanced" };

48 cÚ¡ 
	g·‰”n_d©a
[7][12][4] =

86 
EPZSSŒuùu»
 *

87 
	$®locEPZS·‰”n
 (
£¬chpošts
)

89 
EPZSSŒuùu»
 *
s
;

90 
s
 = 
	`ÿÎoc
 (1,  (
EPZSSŒuùu»
));

92 ià(
NULL
 =ð
s
)

93 
	`no_mem_ex™
 ("alloc_EPZSpattern: s");

95 
s
->
£¬chPošts
 = 
£¬chpošts
;

96 
s
->
pošt
 = (
SPošt
 *è
	`ÿÎoc
 (
£¬chpošts
,  (SPoint));

98  
s
;

99 
	}
}

112 
	$ä“EPZS·‰”n
 (
EPZSSŒuùu»
 * 
p
)

114 ià(
p
)

116 
	`ä“
 ((
SPošt
 *è
p
->
pošt
);

117 
	`ä“
 (
p
);

118 
p
 = 
NULL
;

120 
	}
}

131 
	$assignEPZS·‰”n
 (
EPZSSŒuùu»
 * 
·‰”n
, 
ty³
, 
¡ÝS—rch
, 
ÃxtLa¡
, EPZSSŒuùu» * 
Ãx©‹º
)

133 
i
;

135 
i
 = 0; i < 
·‰”n
->
£¬chPošts
; ++i)

137 
·‰”n
->
pošt
[
i
].
mÙiÚ
.
mv_x
 = 
·‰”n_d©a
[
ty³
][i][0];

138 
·‰”n
->
pošt
[
i
].
mÙiÚ
.
mv_y
 = 
·‰”n_d©a
[
ty³
][i][1];

139 
·‰”n
->
pošt
[
i
].
¡¬t_nmbr
 = 
·‰”n_d©a
[
ty³
][i][2];

140 
·‰”n
->
pošt
[
i
].
Ãxt_pošts
 = 
·‰”n_d©a
[
ty³
][i][3];

142 
·‰”n
->
¡ÝS—rch
 = stopSearch;

143 
·‰”n
->
ÃxtLa¡
 =‚extLast;

144 
·‰”n
->
Ãx©‹º
 =‚extpattern;

145 
	}
}

153 
	$EPZS_£tup_’gše
(
Maüoblock
 *
cu¼MB
, 
IÅutP¬am‘”s
 *
p_IÅ
)

155 
cu¼MB
->
IÁP–ME
 = (
p_IÅ
->
EPZSSubP–Grid
è? 
EPZS_š‹g”_mÙiÚ_e¡im©iÚ
 : 
EPZS_mÙiÚ_e¡im©iÚ
;

156 
cu¼MB
->
BiP»dME
 = (
p_IÅ
->
EPZSSubP–Grid
è? 
EPZS_š‹g”_b»d_mÙiÚ_e¡im©iÚ
 : 
EPZS_b»d_mÙiÚ_e¡im©iÚ
;

157 ià(
p_IÅ
->
EPZSSubP–ME
 == 1)

158 
cu¼MB
->
SubP–ME
 = 
EPZS_sub_³l_mÙiÚ_e¡im©iÚ
;

159 ià(
p_IÅ
->
EPZSSubP–ME
 == 2)

160 
cu¼MB
->
SubP–ME
 = 
fuÎ_sub_³l_mÙiÚ_e¡im©iÚ
;

162 
cu¼MB
->
SubP–ME
 = 
sub_³l_mÙiÚ_e¡im©iÚ
;

163 ià(
p_IÅ
->
EPZSSubP–MEBiP»d
 == 1)

164 
cu¼MB
->
SubP–BiP»dME
 = 
EPZS_sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

165 ià(
p_IÅ
->
EPZSSubP–MEBiP»d
 == 2)

166 
cu¼MB
->
SubP–BiP»dME
 = 
fuÎ_sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

168 
cu¼MB
->
SubP–BiP»dME
 = 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

169 
	}
}

178 
	$EPZSIn™
 (
VideoP¬am‘”s
 * 
p_Vid
)

181 
memÜy_size
 = 0;

193 if(!
p_Vid
->
sdŸmÚd
)

195 
p_Vid
->
sdŸmÚd
 = 
	`®locEPZS·‰”n
 (4);

196 
	`assignEPZS·‰”n
 (
p_Vid
->
sdŸmÚd
, 
SDIAMOND
, 
TRUE
, TRUE,…_Vid->sdiamond);

198 if(!
p_Vid
->
squ¬e
)

200 
p_Vid
->
squ¬e
 = 
	`®locEPZS·‰”n
 (8);

201 
	`assignEPZS·‰”n
 (
p_Vid
->
squ¬e
, 
SQUARE
, 
TRUE
, TRUE,…_Vid->square);

203 if(!
p_Vid
->
edŸmÚd
)

205 
p_Vid
->
edŸmÚd
 = 
	`®locEPZS·‰”n
 (12);

206 
	`assignEPZS·‰”n
 (
p_Vid
->
edŸmÚd
, 
EDIAMOND
, 
TRUE
, TRUE,…_Vid->ediamond);

208 if(!
p_Vid
->
ldŸmÚd
)

210 
p_Vid
->
ldŸmÚd
 = 
	`®locEPZS·‰”n
 (8);

211 
	`assignEPZS·‰”n
 (
p_Vid
->
ldŸmÚd
, 
LDIAMOND
, 
TRUE
, TRUE,…_Vid->ldiamond);

213 if(!
p_Vid
->
sbdŸmÚd
)

215 
p_Vid
->
sbdŸmÚd
 = 
	`®locEPZS·‰”n
 (12);

216 
	`assignEPZS·‰”n
 (
p_Vid
->
sbdŸmÚd
, 
SBDIAMOND
, 
FALSE
, 
TRUE
,…_Vid->
sdŸmÚd
);

218 if(!
p_Vid
->
pmvç¡
)

220 
p_Vid
->
pmvç¡
 = 
	`®locEPZS·‰”n
 (8);

221 
	`assignEPZS·‰”n
 (
p_Vid
->
pmvç¡
, 
LDIAMOND
, 
FALSE
, 
TRUE
,…_Vid->
sdŸmÚd
);

224  
memÜy_size
;

225 
	}
}

234 
	$EPZSD–‘e
 (
VideoP¬am‘”s
 * 
p_Vid
)

237 if(
p_Vid
->
pmvç¡
)

239 
	`ä“EPZS·‰”n
 (
p_Vid
->
pmvç¡
);

240 
p_Vid
->
pmvç¡
 = 
NULL
;

242 if(
p_Vid
->
sbdŸmÚd
)

244 
	`ä“EPZS·‰”n
 (
p_Vid
->
sbdŸmÚd
);

245 
p_Vid
->
sbdŸmÚd
 = 
NULL
;

247 if(
p_Vid
->
ldŸmÚd
)

249 
	`ä“EPZS·‰”n
 (
p_Vid
->
ldŸmÚd
);

250 
p_Vid
->
ldŸmÚd
 = 
NULL
;

252 if(
p_Vid
->
edŸmÚd
)

254 
	`ä“EPZS·‰”n
 (
p_Vid
->
edŸmÚd
);

255 
p_Vid
->
edŸmÚd
 = 
NULL
;

257 if(
p_Vid
->
sdŸmÚd
)

259 
	`ä“EPZS·‰”n
 (
p_Vid
->
sdŸmÚd
);

260 
p_Vid
->
sdŸmÚd
 = 
NULL
;

262 if(
p_Vid
->
squ¬e
)

264 
	`ä“EPZS·‰”n
 (
p_Vid
->
squ¬e
);

265 
p_Vid
->
squ¬e
 = 
NULL
;

267 
	}
}

285 
EPZSCÞocP¬ams
 *

286 
	$®locEPZScÞoÿ‹d
 (
size_x
, 
size_y
, 
mb_ad­tive_äame_f›ld_æag
)

288 
EPZSCÞocP¬ams
 *
s
;

289 
s
 = 
	`ÿÎoc
 (1,  (
EPZSCÞocP¬ams
));

290 ià(
NULL
 =ð
s
)

291 
	`no_mem_ex™
 ("alloc_EPZScolocated: s");

293 
s
->
size_x
 = size_x;

294 
s
->
size_y
 = size_y;

295 
	`g‘_mem3Dmv
 (&(
s
->
äame
), 2, (
size_y
 >> 
BLOCK_SHIFT
), (
size_x
 >> BLOCK_SHIFT));

297 ià(
mb_ad­tive_äame_f›ld_æag
)

299 
	`g‘_mem3Dmv
 (&(
s
->
tÝ
), 2, (
size_y
 >> (
BLOCK_SHIFT
 + 1)), (
size_x
 >> BLOCK_SHIFT));

300 
	`g‘_mem3Dmv
 (&(
s
->
bÙ
), 2, (
size_y
 >> (
BLOCK_SHIFT
 + 1)), (
size_x
 >> BLOCK_SHIFT));

303 
s
->
mb_ad­tive_äame_f›ld_æag
 = mb_adaptive_frame_field_flag;

305  
s
;

306 
	}
}

319 
	$ä“EPZScÞoÿ‹d
 (
EPZSCÞocP¬ams
 * 
p
)

322 ià(
p
)

324 
	`ä“_mem3Dmv
 (
p
->
äame
);

325 ià(
p
->
mb_ad­tive_äame_f›ld_æag
)

327 
	`ä“_mem3Dmv
 (
p
->
tÝ
);

328 
	`ä“_mem3Dmv
 (
p
->
bÙ
);

331 
	`ä“
 (
p
);

332 
p
 = 
NULL
;

334 
	}
}

343 
	$EPZSWšdowP»diùÜIn™
 (
£¬ch_¿nge
, 
EPZSSŒuùu»
 * 
´ediùÜ
, 
mode
)

345 
pos
;

346 
£¬chpos
, 
f›ld£¬chpos
;

347 
´ednum
 = -1;

348 
i
;

349 
£¬ch_¿nge_q³l
 = 2;

350 
SPošt
 *
pošt
 = 
´ediùÜ
->point;

352 ià(
mode
 == 0)

354 
pos
 = (è(
	`RoundLog2
 (
£¬ch_¿nge
) - 2);…os > -1;…os--)

356 
£¬chpos
 = ((
£¬ch_¿nge
 << 
£¬ch_¿nge_q³l
è>> 
pos
);

358 
i
 = 1; i >= -1; i -= 2)

360 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
£¬chpos
;

361 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 0;

362 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
£¬chpos
;

363 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

364 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 0;

365 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

366 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = -
i
 * 
£¬chpos
;

367 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

373 
pos
 = (è(
	`RoundLog2
 (
£¬ch_¿nge
) - 2);…os > -1;…os--)

375 
£¬chpos
 = ((
£¬ch_¿nge
 << 
£¬ch_¿nge_q³l
è>> 
pos
);

378 
f›ld£¬chpos
 = (3 * 
£¬chpos
 + 2) >> 2;

379 
i
 = 1; i >= -1; i -= 2)

381 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
f›ld£¬chpos
;

382 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 0;

383 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
f›ld£¬chpos
;

384 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
f›ld£¬chpos
;

385 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 0;

386 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
f›ld£¬chpos
;

387 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = -
i
 * 
f›ld£¬chpos
;

388 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
f›ld£¬chpos
;

391 
i
 = 1; i >= -1; i -= 2)

393 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
£¬chpos
;

394 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 0;

395 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
£¬chpos
;

396 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
f›ld£¬chpos
;

397 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
£¬chpos
;

398 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

399 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 
i
 * 
f›ld£¬chpos
;

400 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

401 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = 0;

402 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

403 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = -
i
 * 
f›ld£¬chpos
;

404 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

405 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = -
i
 * 
£¬chpos
;

406 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
£¬chpos
;

407 
pošt
[++
´ednum
].
mÙiÚ
.
mv_x
 = -
i
 * 
£¬chpos
;

408 
pošt
[ 
´ednum
].
mÙiÚ
.
mv_y
 = 
i
 * 
f›ld£¬chpos
;

413 
´ediùÜ
->
£¬chPošts
 = 
´ednum
;

414 
	}
}

423 
	$EPZSSŒuùIn™
 (
Sliû
 * 
cu¼Sliû
)

425 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

426 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

427 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

428 
max_li¡_numb”
 = 
p_Vid
->
mb_aff_äame_æag
 ? 6 : 2;

429 
³l_”rÜ_me
 = 1 << (
p_Vid
->
b™d•th_luma
 - 8);

430 
³l_”rÜ_me_ü
 = 1 << (
p_Vid
->
b™d•th_chroma
 - 8);

431 
i
, 
memÜy_size
 = 0;

432 
chroma_weight
 =

433 
p_IÅ
->
ChromaMEEÇbË
 ? 
³l_”rÜ_me_ü
 *…_IÅ->
ChromaMEWeight
 * (è(
p_Vid
->
width_ü
 *…_Vid->
height_ü
) /

434 (è(
p_Vid
->
width
 *…_Vid->
height
) : 0;

435 
£¬chËv–s
 = 
	`RoundLog2
 (
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
]) - 1;

436 
£¬ch¬¿y
 =

437 
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 ? (2 * 
	`imax
 (p_IÅ->
£¬ch_¿nge
[
p_Vid
->
v›w_id
],…_IÅ->
BiP»dMES—rchRªge
[p_Vid->view_id]) +

438 1è<< 2 : (2 * 
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
] + 1) << 2;

439 
p_EPZS
->
p_Vid
 =…_Vid;

440 
p_EPZS
->
BlkCouÁ
 = 1;

447 
i
 = 0; i < 8; ++i)

449 #ià(
MVC_EXTENSION_ENABLE
)

450 iàÐ(
cu¼Sliû
->
v›w_id
è&& (
p_IÅ
->
EÇbËEnhLay”EPZSSÿËrs
) )

452 
p_EPZS
->
medth»s
[
i
] = 
p_IÅ
->
EPZSMedTh»sSÿË
[
cu¼Sliû
->
v›w_id
] * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

453 
p_EPZS
->
maxth»s
[
i
] = 
p_IÅ
->
EPZSMaxTh»sSÿË
[
cu¼Sliû
->
v›w_id
] * (
MAX_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MAX_THRES_BASE[i] * 
chroma_weight
 + 0.5));

454 
p_EPZS
->
mšth»s
[
i
] = 
p_IÅ
->
EPZSMšTh»sSÿË
[
cu¼Sliû
->
v›w_id
] * (
MIN_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MIN_THRES_BASE[i] * 
chroma_weight
 + 0.5));

455 
p_EPZS
->
subth»s
[
i
] = 
p_IÅ
->
EPZSSubP–Th»sSÿË
[
cu¼Sliû
->
v›w_id
] * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

459 
p_EPZS
->
medth»s
[
i
] = 
p_IÅ
->
EPZSMedTh»sSÿË
[0] * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

460 
p_EPZS
->
maxth»s
[
i
] = 
p_IÅ
->
EPZSMaxTh»sSÿË
[0] * (
MAX_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MAX_THRES_BASE[i] * 
chroma_weight
 + 0.5));

461 
p_EPZS
->
mšth»s
[
i
] = 
p_IÅ
->
EPZSMšTh»sSÿË
[0] * (
MIN_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MIN_THRES_BASE[i] * 
chroma_weight
 + 0.5));

462 
p_EPZS
->
subth»s
[
i
] = 
p_IÅ
->
EPZSSubP–Th»sSÿË
[0] * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

465 
p_EPZS
->
medth»s
[
i
] = 
p_IÅ
->
EPZSMedTh»sSÿË
 * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

466 
p_EPZS
->
maxth»s
[
i
] = 
p_IÅ
->
EPZSMaxTh»sSÿË
 * (
MAX_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MAX_THRES_BASE[i] * 
chroma_weight
 + 0.5));

467 
p_EPZS
->
mšth»s
[
i
] = 
p_IÅ
->
EPZSMšTh»sSÿË
 * (
MIN_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MIN_THRES_BASE[i] * 
chroma_weight
 + 0.5));

468 
p_EPZS
->
subth»s
[
i
] = 
p_IÅ
->
EPZSSubP–Th»sSÿË
 * (
MED_THRES_BASE
[i] * 
³l_”rÜ_me
 + (è(MED_THRES_BASE[i] * 
chroma_weight
 + 0.5));

470 
	`up_sÿË
(&
p_EPZS
->
medth»s
[
i
]);

471 
	`up_sÿË
(&
p_EPZS
->
maxth»s
[
i
]);

472 
	`up_sÿË
(&
p_EPZS
->
mšth»s
[
i
]);

473 
	`up_sÿË
(&
p_EPZS
->
subth»s
[
i
]);

479 
p_EPZS
->
wšdow_´ediùÜ
 = 
	`®locEPZS·‰”n
 (
£¬chËv–s
 * 8);

480 
p_EPZS
->
wšdow_´ediùÜ_ext
 = 
	`®locEPZS·‰”n
 (
£¬chËv–s
 * 24);

481 
	`EPZSWšdowP»diùÜIn™
 ((è
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
], 
p_EPZS
->
wšdow_´ediùÜ
, 0);

482 
	`EPZSWšdowP»diùÜIn™
 ((è
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
], 
p_EPZS
->
wšdow_´ediùÜ_ext
, 1);

486 #ià(
MVC_EXTENSION_ENABLE
)

487 
p_EPZS
->
´ediùÜ
 = 
	`®locEPZS·‰”n
 (10 + 
£¬chËv–s
 * 24 + 5 + 5 + 9 * (
p_IÅ
->
EPZSTempÜ®
[0] |…_IÅ->EPZSTempÜ®[1]è+ 3 * (p_IÅ->
EPZSS·tŸlMem
));

489 
p_EPZS
->
´ediùÜ
 = 
	`®locEPZS·‰”n
 (10 + 
£¬chËv–s
 * 24 + 5 + 5 + 9 * (
p_IÅ
->
EPZSTempÜ®
è+ 3 * (p_IÅ->
EPZSS·tŸlMem
));

496 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
 (&(
p_EPZS
->
di¡ÜtiÚ
), 
max_li¡_numb”
, 7, (
p_Vid
->
width
 + 
MB_BLOCK_SIZE
)/ 
BLOCK_SIZE
);

497 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
)

498 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
 (&(
p_EPZS
->
bi_di¡ÜtiÚ
), 
max_li¡_numb”
, 7, (
p_Vid
->
width
 + 
MB_BLOCK_SIZE
è/ 
BLOCK_SIZE
);

499 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
 (&(
p_EPZS
->
di¡ÜtiÚ_h³l
), 
max_li¡_numb”
, 7, (
p_Vid
->
width
 + 
MB_BLOCK_SIZE
)/ 
BLOCK_SIZE
);

500 
memÜy_size
 +ð
	`g‘_mem2DshÜt
 ((***è&(
p_EPZS
->
EPZSM­
), 
£¬ch¬¿y
, searcharray);

502 ià(
p_IÅ
->
EPZSS·tŸlMem
)

504 #ià
EPZSREF


505 
memÜy_size
 +ð
	`g‘_mem5Dmv
 (&(
p_EPZS
->
p_mÙiÚ
), 6, 
p_Vid
->
max_num_»ã»nûs
, 7, 4,…_Vid->
width
 / 
BLOCK_SIZE
);

507 
memÜy_size
 +ð
	`g‘_mem4Dmv
 (&(
p_EPZS
->
p_mÙiÚ
), 6, 7, 4, 
p_Vid
->
width
 / 
BLOCK_SIZE
);

511 #ià(
MVC_EXTENSION_ENABLE
)

512 iàÐ
p_IÅ
->
EPZSTempÜ®
[
cu¼Sliû
->
v›w_id
] )

514 ià(
p_IÅ
->
EPZSTempÜ®
)

517 
p_EPZS
->
p_cÞoÿ‹d
 = 
	`®locEPZScÞoÿ‹d
 (
p_Vid
->
width
,…_Vid->
height
,…_Vid->
aùive_¥s
->
mb_ad­tive_äame_f›ld_æag
);

520 
p_IÅ
->
EPZSP©‹º
)

523 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
pmvç¡
;

526 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
sbdŸmÚd
;

529 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
ldŸmÚd
;

532 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
edŸmÚd
;

535 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
squ¬e
;

539 
p_EPZS
->
£¬chP©‹º
 = 
p_Vid
->
sdŸmÚd
;

543 
p_IÅ
->
EPZSDu®
)

546 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
pmvç¡
;

549 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
sbdŸmÚd
;

552 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
ldŸmÚd
;

555 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
edŸmÚd
;

558 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
squ¬e
;

562 
p_EPZS
->
£¬chP©‹ºD
 = 
p_Vid
->
sdŸmÚd
;

566  
memÜy_size
;

567 
	}
}

576 
	$EPZSSŒuùD–‘e
 (
Sliû
 * 
cu¼Sliû
)

578 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

579 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

580 #ià(
MVC_EXTENSION_ENABLE
)

581 ià(
p_IÅ
->
EPZSTempÜ®
[
cu¼Sliû
->
v›w_id
])

583 ià(
p_IÅ
->
EPZSTempÜ®
)

585 
	`ä“EPZScÞoÿ‹d
 (
p_EPZS
->
p_cÞoÿ‹d
);

588 
	`ä“_mem2DshÜt
 ((**è
p_EPZS
->
EPZSM­
);

589 
	`ä“_mem3Ddi¡blk
 (
p_EPZS
->
di¡ÜtiÚ
);

590 
	`ä“_mem3Ddi¡blk
 (
p_EPZS
->
di¡ÜtiÚ_h³l
);

592 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
)

593 
	`ä“_mem3Ddi¡blk
 (
p_EPZS
->
bi_di¡ÜtiÚ
);

595 
	`ä“EPZS·‰”n
 (
p_EPZS
->
wšdow_´ediùÜ_ext
);

596 
	`ä“EPZS·‰”n
 (
p_EPZS
->
wšdow_´ediùÜ
);

597 
	`ä“EPZS·‰”n
 (
p_EPZS
->
´ediùÜ
);

599 ià(
p_IÅ
->
EPZSS·tŸlMem
)

601 #ià
EPZSREF


602 
	`ä“_mem5Dmv
 (
p_EPZS
->
p_mÙiÚ
);

604 
	`ä“_mem4Dmv
 (
p_EPZS
->
p_mÙiÚ
);

608 
	`ä“
 (
cu¼Sliû
->
p_EPZS
);

609 
cu¼Sliû
->
p_EPZS
 = 
NULL
;

610 
	}
}

620 
	$EPZSSliûIn™
 (
Sliû
 * 
cu¼Sliû
)

622 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

623 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

624 
StÜabËPiùu»
 *
p_Pic
 = 
p_Vid
->
’c_piùu»
;

625 
EPZSCÞocP¬ams
 *
p
 = 
cu¼Sliû
->
p_EPZS
->
p_cÞoÿ‹d
;

626 
StÜabËPiùu»
 ***
li¡X
 = 
cu¼Sliû
->listX;

627 
StÜabËPiùu»
 *
fs
, *
fs_tÝ
, *
fs_bÙtom
;

628 
StÜabËPiùu»
 *
fs1
, *
fs_tÝ1
, *
fs_bÙtom1
, *
fsx
;

629 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

630 
i
, 
j
, 
k
, 
jj
, 
jdiv
, 
loff£t
;

631 
´esÿË
, 
iTRb
, 
iTRp
;

632 
li¡
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è? 
LIST_1
 : 
LIST_0
;

633 
‹mpmv_sÿË
[2];

634 
•zs_sÿË
[2][6][
MAX_LIST_SIZE
];

635 
œef
;

636 
švmv_´ecisiÚ
 = 8;

640 
j
 = 
LIST_0
; j < 2 + (
cu¼Sliû
->
mb_aff_äame_æag
 << 2); ++j)

642 
k
 = 0; k < 
cu¼Sliû
->
li¡Xsize
[
j
]; ++k)

644 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
j
]; ++i)

646 ià((
j
 >> 1) == 0)

648 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
poc
 - 
li¡X
[
j
][
i
]->poc);

649 
iTRp
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
poc
 - 
li¡X
[
j
][
k
]->poc);

651 ià((
j
 >> 1) == 1)

653 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
tÝ_poc
 - 
li¡X
[
j
][
i
]->
poc
);

654 
iTRp
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
tÝ_poc
 - 
li¡X
[
j
][
k
]->
poc
);

658 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
bÙtom_poc
 - 
li¡X
[
j
][
i
]->
poc
);

659 
iTRp
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
bÙtom_poc
 - 
li¡X
[
j
][
k
]->
poc
);

662 ià(
iTRp
 != 0)

664 
´esÿË
 = (16384 + 
	`Ÿbs
 (
iTRp
 / 2)) / iTRp;

665 
p_EPZS
->
mv_sÿË
[
j
][
i
][
k
] = 
	`iCl3
 (-2048, 2047, 
	`rshiá_ºd_sf
 ((
iTRb
 * 
´esÿË
), 6));

668 
p_EPZS
->
mv_sÿË
[
j
][
i
][
k
] = 256;

673 #ià(
MVC_EXTENSION_ENABLE
)

674 ià(
p_IÅ
->
EPZSTempÜ®
[
cu¼Sliû
->
v›w_id
])

676 ià(
p_IÅ
->
EPZSTempÜ®
)

679 
MÙiÚVeùÜ
 **
MÙiÚVeùÜ0
 = 
p
->
äame
[
LIST_0
];

680 
MÙiÚVeùÜ
 **
MÙiÚVeùÜ1
 = 
p
->
äame
[
LIST_1
];

682 
fs_tÝ
 = 
fs_bÙtom
 = 
fs
 = 
li¡X
[
li¡
][0];

683 ià(
cu¼Sliû
->
li¡Xsize
[
li¡
] > 1)

684 
fs_tÝ1
 = 
fs_bÙtom1
 = 
fs1
 = 
li¡X
[
li¡
][1];

686 
fs_tÝ1
 = 
fs_bÙtom1
 = 
fs1
 = 
li¡X
[
li¡
][0];

687 
j
 = 0; j < 6; ++j)

689 
i
 = 0; i < 6; ++i)

691 
•zs_sÿË
[0][
j
][
i
] = 256;

692 
•zs_sÿË
[1][
j
][
i
] = 256;

696 
j
 = 0; j < 2 + (
cu¼Sliû
->
mb_aff_äame_æag
 << 2); j += 2)

698 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
j
]; ++i)

700 ià(
j
 == 0)

701 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->poc);

702 ià(
j
 == 2)

703 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
tÝ_poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->
poc
);

705 
iTRb
 = 
	`iCl3
 (-128, 127, 
p_Pic
->
bÙtom_poc
 - 
li¡X
[
LIST_0
 + 
j
][
i
]->
poc
);

706 
iTRp
 = 
	`iCl3
 (-128, 127, 
li¡X
[
li¡
 + 
j
][0]->
poc
 -†i¡X[
LIST_0
 + j][
i
]->poc);

708 ià(
iTRp
 != 0)

710 
´esÿË
 = (16384 + 
	`Ÿbs
 (
iTRp
 / 2)) / iTRp;

711 
´esÿË
 = 
	`iCl3
 (-2048, 2047, 
	`rshiá_ºd_sf
 ((
iTRb
 *…rescale), 6));

716 
´esÿË
 = 256;

718 
•zs_sÿË
[0][
j
][
i
] = 
	`rshiá_ºd_sf
 ((
p_EPZS
->
mv_sÿË
[j][0][i] * 
´esÿË
), 8);

719 
•zs_sÿË
[0][
j
 + 1][
i
] = 
´esÿË
 - 256;

721 ià(
cu¼Sliû
->
li¡Xsize
[
li¡
 + 
j
] > 1)

723 
iTRp
 = 
	`iCl3
 (-128, 127, 
li¡X
[
li¡
 + 
j
][1]->
poc
 -†i¡X[
LIST_0
 + j][
i
]->poc);

724 ià(
iTRp
 != 0)

726 
´esÿË
 = (16384 + 
	`Ÿbs
 (
iTRp
 / 2)) / iTRp;

727 
´esÿË
 = 
	`iCl3
 (-2048, 2047, 
	`rshiá_ºd_sf
 ((
iTRb
 *…rescale), 6));

731 
´esÿË
 = 256;

733 
•zs_sÿË
[1][
j
][
i
] = 
	`rshiá_ºd_sf
 ((
p_EPZS
->
mv_sÿË
[j][1][i] * 
´esÿË
), 8);

734 
•zs_sÿË
[1][
j
 + 1][
i
] = 
´esÿË
 - 256;

738 
•zs_sÿË
[1][
j
][
i
] =ƒpzs_scale[0][j][i];

739 
•zs_sÿË
[1][
j
 + 1][
i
] =ƒpzs_scale[0][j + 1][i];

744 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

746 
fs_tÝ
 = 
li¡X
[
li¡
 + 2][0];

747 
fs_bÙtom
 = 
li¡X
[
li¡
 + 4][0];

749 ià(
cu¼Sliû
->
li¡Xsize
[0] > 1)

751 
fs_tÝ1
 = 
li¡X
[
li¡
 + 2][1];

752 
fs_bÙtom1
 = 
li¡X
[
li¡
 + 4][1];

757 ià(
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
)

759 ià((
cu¼Sliû
->
¡ruùu»
 !ð
fs
->¡ruùu»è&& (fs->
coded_äame
))

761 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

763 
fs_tÝ
 = 
fs_bÙtom
 = 
fs
 = 
li¡X
[
li¡
][0]->
tÝ_f›ld
;

764 
fs_tÝ1
 = 
fs_bÙtom1
 = 
fs1
 = 
li¡X
[
li¡
][0]->
bÙtom_f›ld
;

768 
fs_tÝ
 = 
fs_bÙtom
 = 
fs
 = 
li¡X
[
li¡
][0]->
bÙtom_f›ld
;

769 
fs_tÝ1
 = 
fs_bÙtom1
 = 
fs1
 = 
li¡X
[
li¡
][0]->
tÝ_f›ld
;

775 ià(!
cu¼Sliû
->
aùive_¥s
->
äame_mbs_Úly_æag
)

777 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

779 
j
 = 0; j < 
fs
->
size_y
 >> 2; ++j)

781 
jj
 = 
j
 >> 1;

782 
jdiv
 = 
jj
 + 4 * (
j
 >> 3);

783 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

785 ià(
fs
->
mv_šfo
[
j
][
i
].
f›ld_äame
)

790 ià(
	`Ÿbs
 (
p_Pic
->
poc
 - 
fs_bÙtom
->pocè> iab Õ_Pic->poø- 
fs_tÝ
->poc))

792 
‹mpmv_sÿË
[
LIST_0
] = 256;

793 
‹mpmv_sÿË
[
LIST_1
] = 0;

795 ià(
fs
->
mv_šfo
[
jdiv
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

797 
fsx
 = 
fs_tÝ1
;

798 
loff£t
 = 1;

802 
fsx
 = 
fs_tÝ
;

803 
loff£t
 = 0;

806 ià(
fs
->
mv_šfo
[
jdiv
][
i
] .
»f_pic
[
LIST_0
] !ð
NULL
)

808 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

810 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fs
->
mv_šfo
[
jdiv
][
i
].
»f_pic
[LIST_0])

812 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

813 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

818 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[
jj
][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

822 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

823 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

828 
‹mpmv_sÿË
[
LIST_0
] = 256;

829 
‹mpmv_sÿË
[
LIST_1
] = 0;

830 ià(
fs
->
mv_šfo
[
jdiv
 + 4][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

832 
fsx
 = 
fs_bÙtom1
;

833 
loff£t
 = 1;

837 
fsx
 = 
fs_bÙtom
;

838 
loff£t
 = 0;

841 ià(
fs
->
mv_šfo
[
jdiv
 + 4][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

843 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

845 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fs
->
mv_šfo
[
jdiv
 + 4][
i
].
»f_pic
[LIST_0])

847 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

848 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

853 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[
jj
][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

857 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

858 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

864 
‹mpmv_sÿË
[
LIST_0
] = 256;

865 
‹mpmv_sÿË
[
LIST_1
] = 0;

867 ià(
fs
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

869 
fsx
 = 
fs1
;

870 
loff£t
 = 1;

874 
fsx
 = 
fs
;

875 
loff£t
 = 0;

878 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

880 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

882 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

884 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

885 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

889 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

893 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

894 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

902 
j
 = 0; j < 
fs
->
size_y
 >> 2; ++j)

904 
jj
 = 
j
 >> 1;

905 
jdiv
 = 
jj
 + 4 * (
j
 >> 3);

906 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

908 
‹mpmv_sÿË
[
LIST_0
] = 256;

909 
‹mpmv_sÿË
[
LIST_1
] = 0;

910 ià(
fs
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

912 
fsx
 = 
fs1
;

913 
loff£t
 = 1;

917 
fsx
 = 
fs
;

918 
loff£t
 = 0;

921 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

923 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

925 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

927 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

928 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

934 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

938 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

939 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

946 ià(
cu¼Sliû
->
¡ruùu»
 || cu¼Sliû->
mb_aff_äame_æag
)

948 
j
 = 0; j < 
fs
->
size_y
 >> 3; ++j)

950 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

952 ià(!
cu¼Sliû
->
mb_aff_äame_æag
)

954 
‹mpmv_sÿË
[
LIST_0
] = 256;

955 
‹mpmv_sÿË
[
LIST_1
] = 0;

956 ià(
fs
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

958 
fsx
 = 
fs1
;

959 
loff£t
 = 1;

963 
fsx
 = 
fs
;

964 
loff£t
 = 0;

967 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

969 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

971 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

973 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

974 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

978 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

982 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

983 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

988 
‹mpmv_sÿË
[
LIST_0
] = 256;

989 
‹mpmv_sÿË
[
LIST_1
] = 0;

990 ià(
fs_bÙtom
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

992 
fsx
 = 
fs_bÙtom1
;

993 
loff£t
 = 1;

997 
fsx
 = 
fs_bÙtom
;

998 
loff£t
 = 0;

1001 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

1003 
œef
 = 0; i»à< 
	`imš
 (2 * 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0 + 4]); ++iref)

1005 ià(
cu¼Sliû
->
li¡X
[
LIST_0
 + 4][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

1007 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0 + 4][
œef
];

1008 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1 + 4][
œef
];

1013 
	`compu‹_sÿËd
 (&
p
->
bÙ
[
LIST_0
][
j
][
i
], &p->bÙ[
LIST_1
][j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[LIST_0], 
švmv_´ecisiÚ
);

1017 
p
->
bÙ
[
LIST_0
][
j
][
i
] = 
z”o_mv
;

1018 
p
->
bÙ
[
LIST_1
][
j
][
i
] = 
z”o_mv
;

1021 ià(!
fs
->
mv_šfo
[2 * 
j
][
i
].
f›ld_äame
)

1023 
p
->
bÙ
[
LIST_0
][
j
][
i
].
mv_y
 = (p->bot[LIST_0][j][i].mv_y + 1) >> 1;

1024 
p
->
bÙ
[
LIST_1
][
j
][
i
].
mv_y
 = (p->bot[LIST_1][j][i].mv_y + 1) >> 1;

1027 
‹mpmv_sÿË
[
LIST_0
] = 256;

1028 
‹mpmv_sÿË
[
LIST_1
] = 0;

1029 ià(
fs_tÝ
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

1031 
fsx
 = 
fs_tÝ1
;

1032 
loff£t
 = 1;

1036 
fsx
 = 
fs_tÝ
;

1037 
loff£t
 = 0;

1039 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

1041 
œef
 = 0; i»à< 
	`imš
 (2 * 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0 + 2]); ++iref)

1043 ià(
cu¼Sliû
->
li¡X
[
LIST_0
 + 2][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

1045 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0 + 2][
œef
];

1046 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1 + 2][
œef
];

1051 
	`compu‹_sÿËd
 (&
p
->
tÝ
[
LIST_0
][
j
][
i
], &p->tÝ[
LIST_1
][j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[LIST_0], 
švmv_´ecisiÚ
);

1055 
p
->
tÝ
[
LIST_0
][
j
][
i
] = 
z”o_mv
;

1056 
p
->
tÝ
[
LIST_1
][
j
][
i
] = 
z”o_mv
;

1059 ià(!
fs
->
mv_šfo
[2 * 
j
][
i
].
f›ld_äame
)

1061 
p
->
tÝ
[
LIST_0
][
j
][
i
].
mv_y
 = (p->top[LIST_0][j][i].mv_y + 1) >> 1;

1062 
p
->
tÝ
[
LIST_1
][
j
][
i
].
mv_y
 = (p->top[LIST_1][j][i].mv_y + 1) >> 1;

1071 ià(!
cu¼Sliû
->
¡ruùu»
)

1073 
j
 = 0; j < 
fs
->
size_y
 >> 2; ++j)

1075 
jj
 = 
j
 >> 1;

1076 
jdiv
 = (
j
 >> 1) + ((j >> 3) << 2);

1077 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

1079 ià(
fs
->
mv_šfo
[
j
][
i
].
f›ld_äame
)

1081 
‹mpmv_sÿË
[
LIST_0
] = 256;

1082 
‹mpmv_sÿË
[
LIST_1
] = 0;

1083 ià(
fs
->
mv_šfo
[
jdiv
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

1085 
fsx
 = 
fs1
;

1086 
loff£t
 = 1;

1090 
fsx
 = 
fs
;

1091 
loff£t
 = 0;

1094 ià(
fsx
->
mv_šfo
[
jdiv
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
)

1096 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

1098 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fsx
->
mv_šfo
[
jdiv
][
i
].
»f_pic
[LIST_0])

1100 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

1101 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

1105 ià(
	`Ÿbs
 (
p_Pic
->
poc
 - 
fsx
->
bÙtom_f›ld
->pocè> iab Õ_Pic->poø- fsx->
tÝ_f›ld
->poc))

1107 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
,

1108 &
fsx
->
tÝ_f›ld
->
mv_šfo
[
jj
][
i
].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

1112 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
,

1113 &
fsx
->
bÙtom_f›ld
->
mv_šfo
[
jj
][
i
].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

1118 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

1119 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

1128 
j
 = 0; j < 
fs
->
size_y
 >> 2; ++j)

1130 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

1132 
‹mpmv_sÿË
[
LIST_0
] = 256;

1133 
‹mpmv_sÿË
[
LIST_1
] = 0;

1134 ià(
fs
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] =ð
NULL
 && 
cu¼Sliû
->
li¡Xsize
[LIST_0] > 1)

1136 
fsx
 = 
fs1
;

1137 
loff£t
 = 1;

1141 
fsx
 = 
fs
;

1142 
loff£t
 = 0;

1145 ià(
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[
LIST_0
] !ð
NULL
 && (!
p_Vid
->
v›w_id
 || ((fsx->
»f_pic_Ç
[0]<0 || fsx->mv_šfo[j][i].
»f_idx
[LIST_0] != fsx->ref_pic_na[0]))))

1147 
œef
 = 0; i»à< 
	`imš
 (
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0]); ++iref)

1149 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
œef
] =ð
fsx
->
mv_šfo
[
j
][
i
].
»f_pic
[LIST_0])

1151 
‹mpmv_sÿË
[
LIST_0
] = 
•zs_sÿË
[
loff£t
][LIST_0][
œef
];

1152 
‹mpmv_sÿË
[
LIST_1
] = 
•zs_sÿË
[
loff£t
][LIST_1][
œef
];

1156 
	`compu‹_sÿËd
 (&
MÙiÚVeùÜ0
[
j
][
i
], &
MÙiÚVeùÜ1
[j][i], 
‹mpmv_sÿË
, &
fsx
->
mv_šfo
[j][i].
mv
[
LIST_0
], 
švmv_´ecisiÚ
);

1160 
MÙiÚVeùÜ0
[
j
][
i
] = 
z”o_mv
;

1161 
MÙiÚVeùÜ1
[
j
][
i
] = 
z”o_mv
;

1167 ià(!
cu¼Sliû
->
aùive_¥s
->
äame_mbs_Úly_æag
)

1169 
j
 = 0; j < 
fs
->
size_y
 >> 2; ++j)

1171 
i
 = 0; i < 
fs
->
size_x
 >> 2; ++i)

1173 ià((!
cu¼Sliû
->
mb_aff_äame_æag
 && !cu¼Sliû->
¡ruùu»
 && 
fs
->
mv_šfo
[
j
][
i
].
f›ld_äame
)

1174 || (
cu¼Sliû
->
mb_aff_äame_æag
 && 
fs
->
mv_šfo
[
j
][
i
].
f›ld_äame
))

1176 
MÙiÚVeùÜ0
[
j
][
i
].
mv_y
 *= 2;

1177 
MÙiÚVeùÜ1
[
j
][
i
].
mv_y
 *= 2;

1179 ià(
cu¼Sliû
->
¡ruùu»
 && !
fs
->
mv_šfo
[
j
][
i
].
f›ld_äame
)

1181 
MÙiÚVeùÜ0
[
j
][
i
].
mv_y
 = (è
	`rshiá_ºd_sf
 (MotionVector0[j][i].mv_y, 1);

1182 
MÙiÚVeùÜ1
[
j
][
i
].
mv_y
 = (è
	`rshiá_ºd_sf
 (MotionVector1[j][i].mv_y, 1);

1189 
	}
}

1193 
	$is_block_avažabË
 (
Maüoblock
 * 
cu¼MB
, 
StÜabËPiùu»
 * 
»f_piùu»
, 
MEBlock
 * 
mv_block
, 
block_avažabË
[4])

1195 ià((
mv_block
->
block_y
 << 2) > 0)

1197 ià((
mv_block
->
block_x
 << 2) < 8)

1199 ià((
mv_block
->
block_y
 << 2) == 8)

1201 
block_avažabË
[0] = (
mv_block
->
blocksize_x
 !ð
MB_BLOCK_SIZE
è|| (
cu¼MB
->
mb_x
 < (
»f_piùu»
->
size_x
 >> 4) - 1);

1205 
block_avažabË
[0] = ((
mv_block
->
block_x
 << 2è+ mv_block->
blocksize_x
 != 8)

1206 || (
cu¼MB
->
mb_x
 < (
»f_piùu»
->
size_x
 >> 4) - 1);

1211 
block_avažabË
[0] = ((
mv_block
->
block_x
 << 2è+ mv_block->
blocksize_x
 !ð
MB_BLOCK_SIZE
è|| (
cu¼MB
->
mb_x
 < (
»f_piùu»
->
size_x
 >> 4) - 1);

1216 
block_avažabË
[0] = ((
mv_block
->
block_x
 << 2è+ mv_block->
blocksize_x
 !ð
MB_BLOCK_SIZE
è|| (
cu¼MB
->
mb_x
 < (
»f_piùu»
->
size_x
 >> 4) - 1);

1219 
block_avažabË
[1] = ((
mv_block
->
block_y
 << 2è+ mv_block->
blocksize_y
 !ð
MB_BLOCK_SIZE
è|| ((
cu¼MB
->
mb_y
 < (
»f_piùu»
->
size_y
 >> 4) - 1));

1220 
block_avažabË
[2] = 
mv_block
->
block
[0].
avažabË
;

1221 
block_avažabË
[3] = 
mv_block
->
block
[1].
avažabË
;

1222 
	}
}

1231 
	$EPZSBlockTy³P»diùÜsMB
 (
Sliû
 * 
cu¼Sliû
, 
MEBlock
 * 
mv_block
, 
SPošt
 * 
pošt
, *
´ednum
)

1233 
blockty³
 = 
mv_block
->blocktype;

1234 
block_x
 = 
mv_block
->block_x;

1235 
block_y
 = 
mv_block
->block_y;

1236 
li¡
 = 
mv_block
->list;

1237 
»f
 = 
mv_block
->
»f_idx
;

1238 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

1239 
MÙiÚVeùÜ
 ****
®l_mv
 = 
cu¼Sliû
->®l_mv[
li¡
];

1240 
MÙiÚVeùÜ
 *
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1242 ià(
blockty³
 != 1)

1244 *
cur_mv
 = 
®l_mv
[
»f
][
BLOCK_PARENT
[
blockty³
]][
block_y
][
block_x
];

1247 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1249 if(
BLOCK_PARENT
[
blockty³
] !=1)

1251 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1252 *
cur_mv
 = 
®l_mv
[
»f
][1][
block_y
][
block_x
];

1254 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1258 ià(
»f
 > 0)

1260 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1261 
	`sÿË_mv
 (
cur_mv
, 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][»à- 1], &
®l_mv
[»à- 1][
blockty³
][
block_y
][
block_x
], 8);

1263 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1265 ià(
»f
 > 1)

1267 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1268 
	`sÿË_mv
 (
cur_mv
, 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][0], &
®l_mv
[0][
blockty³
][
block_y
][
block_x
], 8);

1270 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1273 
	}
}

1283 
	$EPZS_¥©Ÿl_´ediùÜs
 (
EPZSP¬am‘”s
 * 
p_EPZS
, 
MEBlock
 *
mv_block
, 
li¡
, 
li¡_off£t
, 
»f
, 
pic_mÙiÚ_·¿ms
 **
mv_šfo
)

1285 
Pix–Pos
 * 
block
 = 
mv_block
->block;

1286 
»fA
 = 0, 
»fB
 = 0, 
»fC
 = 0, 
»fD
 = 0;

1287 
VideoP¬am‘”s
 *
p_Vid
 = 
p_EPZS
->p_Vid;

1288 *
mÙ_sÿË
 = 
p_EPZS
->
mv_sÿË
[
li¡
 + 
li¡_off£t
][
»f
];

1289 
SPošt
 *
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1292 (
pošt
++)->
mÙiÚ
 = 
z”o_mv
;

1295 ià(!
p_Vid
->
mb_aff_äame_æag
)

1297 
»fA
 = 
block
[0].
avažabË
 ? (è
mv_šfo
[block[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] : -1;

1298 
»fB
 = 
block
[1].
avažabË
 ? (è
mv_šfo
[block[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] : -1;

1299 
»fC
 = 
block
[2].
avažabË
 ? (è
mv_šfo
[block[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] : -1;

1300 
»fD
 = 
block
[3].
avažabË
 ? (è
mv_šfo
[block[3].
pos_y
][block[3].
pos_x
].
»f_idx
[
li¡
] : -1;

1303 ià(
block
[0].
avažabË
)

1305 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fA
], &
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
], 8);

1313 ++
pošt
;

1317 (
pošt
)->
mÙiÚ
.
mv_x
 = 12;

1318 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1321 ià(
block
[1].
avažabË
)

1323 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fB
], &
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
], 8);

1331 ++
pošt
;

1335 (
pošt
)->
mÙiÚ
.
mv_x
 = 0;

1336 (
pošt
++)->
mÙiÚ
.
mv_y
 = 12;

1340 ià(
block
[2].
avažabË
)

1342 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fC
], &
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
], 8);

1350 ++
pošt
;

1354 (
pošt
)->
mÙiÚ
.
mv_x
 = -12;

1355 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1359 ià(
block
[3].
avažabË
)

1361 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fD
], &
mv_šfo
[
block
[3].
pos_y
][block[3].
pos_x
].
mv
[
li¡
], 8);

1369 ++
pošt
;

1373 (
pošt
)->
mÙiÚ
.
mv_x
 = 0;

1374 (
pošt
++)->
mÙiÚ
.
mv_y
 = -12;

1380 ià(
li¡_off£t
)

1382 
»fA
 = 
block
[0].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[0].
mb_addr
].
mb_f›ld
 ? (è
mv_šfo
[block[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
]

1383 : (è
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] * 2 : -1;

1384 
»fB
 = 
block
[1].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[1].
mb_addr
].
mb_f›ld
 ? (è
mv_šfo
[block[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
]

1385 : (è
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] * 2 : -1;

1386 
»fC
 = 
block
[2].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[2].
mb_addr
].
mb_f›ld
 ? (è
mv_šfo
[block[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
]

1387 : (è
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] * 2 : -1;

1388 
»fD
 = 
block
[3].
avažabË
 ? 
p_Vid
->
mb_d©a
[block[3].
mb_addr
].
mb_f›ld
 ? (è
mv_šfo
[block[3].
pos_y
][block[3].
pos_x
].
»f_idx
[
li¡
]

1389 : (è
mv_šfo
[
block
[3].
pos_y
][block[3].
pos_x
].
»f_idx
[
li¡
] * 2 : -1;

1392 ià(
block
[0].
avažabË
)

1394 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fA
], &
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
], 8);

1395 ià(!
p_Vid
->
mb_d©a
[
block
[0].
mb_addr
].
mb_f›ld
)

1397 
pošt
->
mÙiÚ
.
mv_y
 <<= 1;

1398 ++
pošt
;

1402 (
pošt
)->
mÙiÚ
.
mv_x
 = 12;

1403 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1407 ià(
block
[1].
avažabË
)

1409 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fB
], &
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
], 8);

1410 ià(!
p_Vid
->
mb_d©a
[
block
[1].
mb_addr
].
mb_f›ld
)

1412 
pošt
->
mÙiÚ
.
mv_y
 <<= 1;

1413 ++
pošt
;

1417 (
pošt
)->
mÙiÚ
.
mv_x
 = 0;

1418 (
pošt
++)->
mÙiÚ
.
mv_y
 = 12;

1422 ià(
block
[2].
avažabË
)

1424 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fC
], &
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
], 8);

1425 ià(!
p_Vid
->
mb_d©a
[
block
[2].
mb_addr
].
mb_f›ld
)

1427 
pošt
->
mÙiÚ
.
mv_y
 <<= 1;

1428 ++
pošt
;

1432 (
pošt
)->
mÙiÚ
.
mv_x
 = -12;

1433 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1437 ià(
block
[3].
avažabË
)

1439 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fD
], &
mv_šfo
[
block
[3].
pos_y
][block[3].
pos_x
].
mv
[
li¡
], 8);

1440 ià(!
p_Vid
->
mb_d©a
[
block
[3].
mb_addr
].
mb_f›ld
)

1442 
pošt
->
mÙiÚ
.
mv_y
 <<= 1;

1443 ++
pošt
;

1447 (
pošt
)->
mÙiÚ
.
mv_x
 = 0;

1448 (
pošt
++)->
mÙiÚ
.
mv_y
 = -12;

1453 
»fA
 = 
block
[0].
avažabË


1454 ? 
p_Vid
->
mb_d©a
[
block
[0].
mb_addr
].
mb_f›ld


1455 ? (è
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
»f_idx
[
li¡
] >> 1 : () mv_info[block[0].pos_y][block[0].pos_x].ref_idx[list] : -1;

1456 
»fB
 = 
block
[1].
avažabË


1457 ? 
p_Vid
->
mb_d©a
[
block
[1].
mb_addr
].
mb_f›ld


1458 ? (è
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
»f_idx
[
li¡
] >> 1 : () mv_info[block[1].pos_y][block[1].pos_x].ref_idx[list] : -1;

1459 
»fC
 = 
block
[2].
avažabË


1460 ? 
p_Vid
->
mb_d©a
[
block
[2].
mb_addr
].
mb_f›ld


1461 ? (è
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
»f_idx
[
li¡
] >> 1 : () mv_info[block[2].pos_y][block[2].pos_x].ref_idx[list] : -1;

1462 
»fD
 = 
block
[3].
avažabË


1463 ? 
p_Vid
->
mb_d©a
[
block
[3].
mb_addr
].
mb_f›ld


1464 ? (è
mv_šfo
[
block
[3].
pos_y
][block[3].
pos_x
].
»f_idx
[
li¡
] >> 1 : () mv_info[block[3].pos_y][block[3].pos_x].ref_idx[list] : -1;

1467 ià(
block
[0].
avažabË
)

1469 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fA
], &
mv_šfo
[
block
[0].
pos_y
][block[0].
pos_x
].
mv
[
li¡
], 8);

1470 ià(
p_Vid
->
mb_d©a
[
block
[0].
mb_addr
].
mb_f›ld
)

1471 
pošt
->
mÙiÚ
.
mv_y
 = (è
	`rshiá_ºd_sf
 (point->motion.mv_y, 1);

1472 ++
pošt
;

1476 (
pošt
)->
mÙiÚ
.
mv_x
 = 12;

1477 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1481 ià(
block
[1].
avažabË
)

1483 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fB
], &
mv_šfo
[
block
[1].
pos_y
][block[1].
pos_x
].
mv
[
li¡
], 8);

1484 ià(
p_Vid
->
mb_d©a
[
block
[1].
mb_addr
].
mb_f›ld
)

1485 
pošt
->
mÙiÚ
.
mv_y
 = (è
	`rshiá_ºd_sf
 (point->motion.mv_y, 1);

1486 ++
pošt
;

1490 (
pošt
)->
mÙiÚ
.
mv_x
 = 0;

1491 (
pošt
++)->
mÙiÚ
.
mv_y
 = 12;

1495 ià(
block
[2].
avažabË
)

1497 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fC
], &
mv_šfo
[
block
[2].
pos_y
][block[2].
pos_x
].
mv
[
li¡
], 8);

1498 ià(
p_Vid
->
mb_d©a
[
block
[2].
mb_addr
].
mb_f›ld
)

1499 
pošt
->
mÙiÚ
.
mv_y
 = (è
	`rshiá_ºd_sf
 (point->motion.mv_y, 1);

1500 ++
pošt
;

1504 (
pošt
)->
mÙiÚ
.
mv_x
 = -12;

1505 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1509 ià(
block
[3].
avažabË
)

1511 
	`sÿË_mv
 (&
pošt
->
mÙiÚ
, 
mÙ_sÿË
[
»fD
], &
mv_šfo
[
block
[3].
pos_y
][block[3].
pos_x
].
mv
[
li¡
], 8);

1512 ià(
p_Vid
->
mb_d©a
[
block
[3].
mb_addr
].
mb_f›ld
)

1513 
pošt
->
mÙiÚ
.
mv_y
 = (è
	`rshiá_ºd_sf
 (point->motion.mv_y, 1);

1514 ++
pošt
;

1518 (
pošt
)->
mÙiÚ
.
mv_x
 = 12;

1519 (
pošt
++)->
mÙiÚ
.
mv_y
 = 0;

1524  ((
»fA
 =ð-1è+ (
»fB
 =ð-1è+ ((
»fC
 =ð-1è&& (
»fD
 == -1)));

1525 
	}
}

1535 
	$EPZS_‹mpÜ®_´ediùÜs
 (
Maüoblock
 *
cu¼MB
,

1536 
StÜabËPiùu»
 *
»f_piùu»
,

1537 
EPZSP¬am‘”s
 * 
p_EPZS
,

1538 
MEBlock
 *
mv_block
,

1539 *
´ednum
,

1540 
di¡blk
 
¡ÝCr™”iÚ
,

1541 
di¡blk
 
mš_mco¡
)

1543 
li¡_off£t
 = 
cu¼MB
->list_offset;

1544 
blocksh­e_x
 = (
mv_block
->
blocksize_x
 >> 2);

1545 
blocksh­e_y
 = (
mv_block
->
blocksize_y
 >> 2);

1546 
o_block_x
 = 
mv_block
->
pos_x2
;

1547 
o_block_y
 = 
mv_block
->
pos_y2
;

1548 
li¡
 = 
mv_block
->list;

1549 
»f
 = 
mv_block
->
»f_idx
;

1551 
EPZSCÞocP¬ams
 *
p_CÞoc
 = 
p_EPZS
->
p_cÞoÿ‹d
;

1552 
SPošt
 * 
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1553 
mvSÿË
 = 
p_EPZS
->
mv_sÿË
[
li¡
 + 
li¡_off£t
][
»f
][0];

1554 
MÙiÚVeùÜ
 **
cÞ_mv
 = (
li¡_off£t
 =ð0è? 
p_CÞoc
->
äame
[
li¡
] : (li¡_off£ˆ=ð2è?…_CÞoc->
tÝ
[li¡] :…_CÞoc->
bÙ
[list];

1555 
MÙiÚVeùÜ
 *
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1557 *
´ednum
 +ð
	`add_´ediùÜ
 (
cur_mv
, 
cÞ_mv
[
o_block_y
][
o_block_x
], 
mvSÿË
, 8);

1558 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
 && 
»f
 < 2)

1560 
block_avažabË
[4];

1561 
	`is_block_avažabË
 (
cu¼MB
, 
»f_piùu»
, 
mv_block
, 
block_avažabË
);

1563 ià(
block_avažabË
[2])

1565 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
][
o_block_x
 - 1], 
mvSÿË
, 8);

1567 ià(
block_avažabË
[3])

1569 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 - 1][
o_block_x
 - 1], 
mvSÿË
, 8);

1573 ià(
block_avažabË
[1])

1575 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 + 
blocksh­e_y
][
o_block_x
 - 1], 
mvSÿË
, 8);

1580 ià(
block_avažabË
[3])

1582 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 - 1][
o_block_x
], 
mvSÿË
, 8);

1586 ià(
block_avažabË
[0])

1588 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
][
o_block_x
 + 
blocksh­e_x
], 
mvSÿË
, 8);

1589 ià(
block_avažabË
[3])

1591 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 - 1][
o_block_x
 + 
blocksh­e_x
], 
mvSÿË
, 8);

1594 ià(
block_avažabË
[1])

1596 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 + 
blocksh­e_y
][
o_block_x
 + 
blocksh­e_x
], 
mvSÿË
, 8);

1600 ià(
block_avažabË
[1])

1602 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, 
cÞ_mv
[
o_block_y
 + 
blocksh­e_y
][
o_block_x
], 
mvSÿË
, 8);

1605 
	}
}

1615 
	$EPZSBlockTy³P»diùÜs
 (
Sliû
 * 
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
SPošt
 * 
pošt
, *
´ednum
)

1617 
blockty³
 = 
mv_block
->blocktype;

1618 
block_x
 = 
mv_block
->block_x;

1619 
block_y
 = 
mv_block
->block_y;

1620 
li¡
 = 
mv_block
->list;

1621 
»f
 = 
mv_block
->
»f_idx
;

1622 
MÙiÚVeùÜ
 ****
®l_mv
 = 
cu¼Sliû
->®l_mv[
li¡
];

1623 
MÙiÚVeùÜ
 *
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1625 *
cur_mv
 = 
®l_mv
[
»f
][
BLOCK_PARENT
[
blockty³
]][
block_y
][
block_x
];

1628 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1630 ià((
»f
 > 0è&& (
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
))

1632 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

1633 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1634 
	`sÿË_mv
 (
cur_mv
, 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][»à- 1], &
®l_mv
[»à- 1][
blockty³
][
block_y
][
block_x
], 8);

1637 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1638 ià(
»f
 > 1)

1640 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1641 
	`sÿË_mv
 (
cur_mv
, 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][0], &
®l_mv
[0][
blockty³
][
block_y
][
block_x
], 8);

1643 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1647 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1648 *
cur_mv
 = 
®l_mv
[
»f
][1][
block_y
][
block_x
];

1651 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1652 
	}
}

1661 
	$EPZSWšdowP»diùÜs
 (
MÙiÚVeùÜ
 * 
mv
, 
EPZSSŒuùu»
 * 
´ediùÜ
, *
´ednum
, EPZSSŒuùu» * 
wšdowP»d
)

1663 
pos
;

1664 
SPošt
 *
wPošt
 = &
wšdowP»d
->
pošt
[0];

1665 
SPošt
 *
pPošt
 = &
´ediùÜ
->
pošt
[(*
´ednum
)];

1667 
pos
 = 0;…o < 
wšdowP»d
->
£¬chPošts
; ++pos)

1669 (
pPošt
++)->
mÙiÚ
 = 
	`add_MVs
 ((
wPošt
++)->mÙiÚ, 
mv
);

1671 *
´ednum
 +ð
wšdowP»d
->
£¬chPošts
;

1672 
	}
}

1682 
	$EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
EPZSP¬am‘”s
 * 
p_EPZS
,

1683 
MEBlock
 * 
mv_block
,

1684 
li¡
,

1685 *
´ednum
,

1686 
img_width
)

1689 
SPošt
 *
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1691 
blockty³
 = 
mv_block
->blocktype - 1;

1693 
by
 = 
mv_block
->
block_y
;

1695 
bs_x
 = (
mv_block
->
blocksize_x
 >> 2);

1696 
bs_y
 = (
mv_block
->
blocksize_y
 >> 2);

1697 
pic_x
 = 
mv_block
->
pos_x2
;

1699 
»f
 = 
mv_block
->
»f_idx
;

1701 #ià
EPZSREF


1702 
MÙiÚVeùÜ
 **
´d_mv
 = 
p_EPZS
->
p_mÙiÚ
[
li¡
][
»f
][
blockty³
];

1703 
MÙiÚVeùÜ
 *
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1706 ià(
pic_x
 > 0)

1708 *
cur_mv
 = 
´d_mv
[
by
][
pic_x
 - 
bs_x
];

1709 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1710 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1713 
by
 = (by > 0è? by - 
bs_y
 : 4 - bs_y;

1716 *
cur_mv
 = 
´d_mv
[
by
][
pic_x
];

1717 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1720 ià(
pic_x
 + 
bs_x
 < 
img_width
)

1722 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1723 *
cur_mv
 = 
´d_mv
[
by
][
pic_x
 + 
bs_x
];

1724 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1727 
mÙ_sÿË
 = 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][0];

1729 
MÙiÚVeùÜ
 **
´d_mv
 = 
p_EPZS
->
p_mÙiÚ
[
li¡
][
blockty³
];

1732 
pošt
[*
´ednum
].
mÙiÚ
.
mv_x
 = (
pic_x
 > 0)

1733 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
][
pic_x
 - 
bs_x
].
mv_x
), 8)

1735 
pošt
[*
´ednum
].
mÙiÚ
.
mv_y
 = (
pic_x
 > 0)

1736 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
][
pic_x
 - 
bs_x
].
mv_y
), 8)

1738 *
´ednum
 +ð((
pošt
[*´ednum].
mÙiÚ
.
mv_x
 !ð0è|| (pošt[*´ednum].mÙiÚ.
mv_y
 != 0));

1741 
pošt
[*
´ednum
].
mÙiÚ
.
mv_x
 = (
by
 > 0)

1742 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
 - 
bs_y
][
pic_x
].
mv_x
), 8)

1743 : (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[4 - 
bs_y
][
pic_x
].
mv_x
), 8);

1744 
pošt
[*
´ednum
].
mÙiÚ
.
mv_y
 = (
by
 > 0)

1745 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
 - 
bs_y
][
pic_x
].
mv_y
), 8)

1746 : (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[4 - 
bs_y
][
pic_x
].
mv_y
), 8);

1747 *
´ednum
 +ð((
pošt
[*´ednum].
mÙiÚ
.
mv_x
 !ð0è|| (pošt[*´ednum].mÙiÚ.
mv_y
 != 0));

1750 
pošt
[*
´ednum
].
mÙiÚ
.
mv_x
 = (
pic_x
 + 
bs_x
 < 
img_width
)

1751 ? (
by
 > 0)

1752 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
 - 
bs_y
][
pic_x
 + 
bs_x
].
mv_x
), 8)

1753 : (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[4 - 
bs_y
][
pic_x
 + 
bs_x
].
mv_x
), 8)

1755 
pošt
[*
´ednum
].
mÙiÚ
.
mv_y
 = (
pic_x
 + 
bs_x
 < 
img_width
)

1756 ? (
by
 > 0)

1757 ? (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[
by
 - 
bs_y
][
pic_x
 + 
bs_x
].
mv_y
), 8)

1758 : (è
	`rshiá_ºd_sf
 ((
mÙ_sÿË
 * 
´d_mv
[4 - 
bs_y
][
pic_x
 + 
bs_x
].
mv_y
), 8)

1760 *
´ednum
 +ð((
pošt
[*´ednum].
mÙiÚ
.
mv_x
 !ð0è|| (pošt[*´ednum].mÙiÚ.
mv_y
 != 0));

1762 
	}
}

1772 
	$EPZS_h›¿rchiÿl_´ediùÜs
 (
EPZSP¬am‘”s
 * 
p_EPZS
,

1773 
MEBlock
 * 
mv_block
,

1774 *
´ednum
,

1775 
StÜabËPiùu»
 *
»f_piùu»
,

1776 
Sliû
 *
cu¼Sliû
)

1778 
HMEInfo_t
 *
pHMEInfo
 = 
cu¼Sliû
->
p_Vid
->pHMEInfo;

1779 
SPošt
 *
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1781 
li¡
 = 
mv_block
->list;

1782 
»f
 = 
mv_block
->
»f_idx
;

1783 
bx
 = (
mv_block
->
pos_x
 >> 
pHMEInfo
->
HMEBlockSizeIdx
);

1784 
by
 = (
mv_block
->
pos_y
 >> 
pHMEInfo
->
HMEBlockSizeIdx
);

1786 
MÙiÚVeùÜ
 *
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1787 
MÙiÚVeùÜ
 **
hme_mv
;

1788 
i
;

1790 
i
 = 0; i < (è
cu¼Sliû
->
p_Dpb
->
»f_äames_š_bufãr
; i++)

1792 ià(
»f_piùu»
->
poc
 =ð
pHMEInfo
->poc[0][
li¡
][
i
])

1794 
»f
 = 
i
;

1799 
hme_mv
 = 
pHMEInfo
->
p_hme_mv
[0][
li¡
][
»f
];

1803 *
cur_mv
 = 
hme_mv
[
by
][
bx
];

1804 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1805 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1808 ià(
bx
 > 0)

1811 *
cur_mv
 = 
hme_mv
[
by
][
bx
 - 1];

1812 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1813 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1815 ià(
by
 > 0)

1817 *
cur_mv
 = 
hme_mv
[
by
 - 1][
bx
 - 1];

1818 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1819 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1822 ià(
by
 + 1 < (
»f_piùu»
->
size_y
 >> 
pHMEInfo
->
HMEBlockSizeIdx
))

1824 *
cur_mv
 = 
hme_mv
[
by
 + 1][
bx
 - 1];

1825 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1826 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1830 ià(
bx
 + 1 < (
»f_piùu»
->
size_x
 >> 
pHMEInfo
->
HMEBlockSizeIdx
))

1833 *
cur_mv
 = 
hme_mv
[
by
][
bx
 + 1];

1834 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1835 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1837 ià(
by
 > 0)

1839 *
cur_mv
 = 
hme_mv
[
by
 - 1][
bx
 + 1];

1840 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1841 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1844 ià(
by
 + 1 < (
»f_piùu»
->
size_y
 >> 
pHMEInfo
->
HMEBlockSizeIdx
))

1846 *
cur_mv
 = 
hme_mv
[
by
 + 1][
bx
 + 1];

1847 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1848 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1852 ià(
by
 > 0)

1854 *
cur_mv
 = 
hme_mv
[
by
 - 1][
bx
];

1855 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1856 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1859 ià(
by
 + 1 < (
»f_piùu»
->
size_y
 >> 
pHMEInfo
->
HMEBlockSizeIdx
))

1861 *
cur_mv
 = 
hme_mv
[
by
 + 1][
bx
];

1862 *
´ednum
 +ð(*((*è
cur_mv
) != 0);

1863 
cur_mv
 = &
pošt
[*
´ednum
].
mÙiÚ
;

1865 
	}
}

1873 
di¡blk


1874 
	$EPZSD‘”mšeStÝCr™”iÚ
 (
EPZSP¬am‘”s
 * 
p_EPZS
, 
di¡blk
 *
´evSad
, 
MEBlock
 * 
mv_block
, di¡blk 
Ïmbda_di¡
)

1876 
blockty³
 = 
mv_block
->blocktype;

1877 
blocksh­e_x
 = (
mv_block
->
blocksize_x
 >> 2);

1878 
Pix–Pos
 *
block
 = 
mv_block
->block;

1879 
di¡blk
 
§dA
, 
§dB
, 
§dC
, 
¡ÝCr™”iÚ
;

1880 
§dA
 = 
block
[0].
avažabË
 ? 
´evSad
[-
blocksh­e_x
] : 
DISTBLK_MAX
;

1881 
§dB
 = 
block
[1].
avažabË
 ? 
´evSad
[0] : 
DISTBLK_MAX
;

1882 
§dC
 = 
block
[2].
avažabË
 ? 
´evSad
[
blocksh­e_x
] : 
DISTBLK_MAX
;

1884 
¡ÝCr™”iÚ
 = 
	`di¡blkmš
 (
§dA
, di¡blkmš (
§dB
, 
§dC
));

1885 
¡ÝCr™”iÚ
 = 
	`di¡blkmax
 (¡ÝCr™”iÚ, 
p_EPZS
->
mšth»s
[
blockty³
]);

1886 
¡ÝCr™”iÚ
 = 
	`di¡blkmš
 (¡ÝCr™”iÚ, 
p_EPZS
->
maxth»s
[
blockty³
] + 
Ïmbda_di¡
);

1887 
¡ÝCr™”iÚ
 = (8 * 
	`di¡blkmax
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, stopCriterion) + 1 *…_EPZS->medthres[blocktype]) >> 3;

1889  
¡ÝCr™”iÚ
 + 
Ïmbda_di¡
;

1890 
	}
}

1900 
	$EPZSOuutSts
 (
IÅutP¬am‘”s
 * 
p_IÅ
, 
FILE
 * 
¡©
, 
¡©s_fže
)

1902 ià(
¡©s_fže
 == 1)

1904 
	`årštf
 (
¡©
, " EPZS P©‹º : %s\n", 
EPZS_PATTERN
[
p_IÅ
->
EPZSP©‹º
]);

1905 
	`årštf
 (
¡©
, " EPZS Du® P©‹º : %s\n", 
EPZS_DUAL_PATTERN
[
p_IÅ
->
EPZSDu®
]);

1906 
	`årštf
 (
¡©
, " EPZS Fixed P»diùÜ  : %s\n", 
EPZS_FIXED_PREDICTORS
[
p_IÅ
->
EPZSFixed
]);

1907 
	`årštf
 (
¡©
, " EPZS Agg»ssivP»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSAgg»ssiveWšdow
]);

1908 #ià(
MVC_EXTENSION_ENABLE
)

1909 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1911 
	`årštf
 (
¡©
, " BL EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[0]]);

1912 
	`årštf
 (
¡©
, " EL EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[1]]);

1916 
	`årštf
 (
¡©
, " EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[0]]);

1919 
	`årštf
 (
¡©
, " EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
]);

1921 
	`årštf
 (
¡©
, " EPZS S·tŸÈP»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSS·tŸlMem
]);

1922 #ià(
MVC_EXTENSION_ENABLE
)

1923 iàÐ(
p_IÅ
->
num_of_v›ws
 =ð2è&& (p_IÅ->
EÇbËEnhLay”EPZSSÿËrs
) )

1925 
	`årštf
 (
¡©
, " BL EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[0],…_IÅ->
EPZSMšTh»sSÿË
[0],…_IÅ->
EPZSMaxTh»sSÿË
[0]);

1926 
	`årštf
 (
¡©
, " EL EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[1],…_IÅ->
EPZSMšTh»sSÿË
[1],…_IÅ->
EPZSMaxTh»sSÿË
[1]);

1930 
	`årštf
 (
¡©
, " EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[0],…_IÅ->
EPZSMšTh»sSÿË
[0],…_IÅ->
EPZSMaxTh»sSÿË
[0]);

1933 
	`årštf
 (
¡©
, " EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
,…_IÅ->
EPZSMšTh»sSÿË
,…_IÅ->
EPZSMaxTh»sSÿË
);

1935 
	`årštf
 (
¡©
, " EPZS Sub³ÈME : %s\n", 
EPZS_SUBPEL_METHOD
[
p_IÅ
->
EPZSSubP–ME
]);

1936 
	`årštf
 (
¡©
, " EPZS Sub³ÈME BiP»d : %s\n", 
EPZS_SUBPEL_METHOD
[
p_IÅ
->
EPZSSubP–MEBiP»d
]);

1940 
	`årštf
 (
¡©
, " EPZS P©‹º : %s\n", 
EPZS_PATTERN
[
p_IÅ
->
EPZSP©‹º
]);

1941 
	`årštf
 (
¡©
, " EPZS Du® P©‹º : %s\n", 
EPZS_DUAL_PATTERN
[
p_IÅ
->
EPZSDu®
]);

1942 
	`årštf
 (
¡©
, " EPZS Fixed P»diùÜ  : %s\n", 
EPZS_FIXED_PREDICTORS
[
p_IÅ
->
EPZSFixed
]);

1943 
	`årštf
 (
¡©
, " EPZS Agg»ssivP»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSAgg»ssiveWšdow
]);

1945 #ià(
MVC_EXTENSION_ENABLE
)

1946 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1948 
	`årštf
 (
¡©
, " BL EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[0]]);

1949 
	`årštf
 (
¡©
, " EL EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[1]]);

1953 
	`årštf
 (
¡©
, " EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
[0]]);

1956 
	`årštf
 (
¡©
, " EPZS TempÜ® P»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSTempÜ®
]);

1958 
	`årštf
 (
¡©
, " EPZS S·tŸÈP»diùÜ  : %s\n", 
EPZS_OTHER_PREDICTORS
[
p_IÅ
->
EPZSS·tŸlMem
]);

1959 #ià(
MVC_EXTENSION_ENABLE
)

1960 iàÐ(
p_IÅ
->
num_of_v›ws
 =ð2è&& (p_IÅ->
EÇbËEnhLay”EPZSSÿËrs
) )

1962 
	`årštf
 (
¡©
, " BL EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[0],…_IÅ->
EPZSMšTh»sSÿË
[0],…_IÅ->
EPZSMaxTh»sSÿË
[0]);

1963 
	`årštf
 (
¡©
, " EL EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[1],…_IÅ->
EPZSMšTh»sSÿË
[1],…_IÅ->
EPZSMaxTh»sSÿË
[1]);

1967 
	`årštf
 (
¡©
, " EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
[0],…_IÅ->
EPZSMšTh»sSÿË
[0],…_IÅ->
EPZSMaxTh»sSÿË
[0]);

1970 
	`årštf
 (
¡©
, " EPZS Th»shÞd MuÉl›r  : (%d %d %d)\n", 
p_IÅ
->
EPZSMedTh»sSÿË
,…_IÅ->
EPZSMšTh»sSÿË
,…_IÅ->
EPZSMaxTh»sSÿË
);

1972 
	`årštf
 (
¡©
, " EPZS Sub³ÈME : %s\n", 
EPZS_SUBPEL_METHOD
[
p_IÅ
->
EPZSSubP–ME
]);

1973 
	`årštf
 (
¡©
, " EPZS Sub³ÈME BiP»d : %s\n", 
EPZS_SUBPEL_METHOD
[
p_IÅ
->
EPZSSubP–MEBiP»d
]);

1975 
	}
}

	@lencod/src/me_epzs_int.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mem®loc.h
"

24 
	~"mb_acûss.h
"

25 
	~"»fbuf.h
"

26 
	~"maüoblock.h
"

27 
	~"me_di¡ÜtiÚ.h
"

28 
	~"me_•zs.h
"

29 
	~"me_•zs_commÚ.h
"

30 
	~"mv_£¬ch.h
"

41 
di¡blk


42 
	$EPZS_š‹g”_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

43 
MÙiÚVeùÜ
 * 
´ed_mv
,

44 
MEBlock
 * 
mv_block
,

45 
di¡blk
 
mš_mco¡
,

46 
Ïmbda_çùÜ


49 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

50 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

51 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

52 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

53 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

55 
blockty³
 = 
mv_block
->blocktype;

57 
li¡
 = 
mv_block
->list;

58 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

59 
»f
 = 
mv_block
->
»f_idx
;

60 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

61 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

62 
m­C’‹r_x
 = 
£¬chRªge
->
max_x
 - 
mv
->
mv_x
;

63 
m­C’‹r_y
 = 
£¬chRªge
->
max_y
 - 
mv
->
mv_y
;

64 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

66 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 2);

67 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

68 
di¡blk
 *
´evSad
 = &
p_EPZS
->
di¡ÜtiÚ
[
cur_li¡
][
blockty³
 - 1][
mv_block
->
pos_x2
];

70 
MÙiÚVeùÜ
 *
p_mÙiÚ
 = 
NULL
;

72 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

73 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

74 
ušt16
 *
EPZSPošt
 = &
p_EPZS
->
EPZSM­
[
£¬chRªge
->
max_y
][£¬chRªge->
max_x
];

76 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

77 
MÙiÚVeùÜ
 
´ed
 = 
	`·d_MVs
 (*
´ed_mv
, 
mv_block
);

78 
MÙiÚVeùÜ
 
tmp
 = *
mv
, 
ÿnd
 = 
ûÁ”
;

80 ++
p_EPZS
->
BlkCouÁ
;

81 ià(
p_EPZS
->
BlkCouÁ
 == 0)

82 ++
p_EPZS
->
BlkCouÁ
;

84 ià(
p_IÅ
->
EPZSS·tŸlMem
)

86 #ià
EPZSREF


87 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
»f
][
blockty³
 - 1][
mv_block
->
block_y
][mv_block->
pos_x2
];

89 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
blockty³
 - 1][
mv_block
->
block_y
][mv_block->
pos_x2
];

97 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

100 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

103 
mš_mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
DISTBLK_MAX
 - mš_mco¡, &
ÿnd
);

108 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
) &&

109 ((*
´evSad
 < 
	`di¡blkmš
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, 
mš_mco¡
)) || (*prevSad * 8 < min_mcost)))

111 #ià
EPZSREF


112 ià(
p_IÅ
->
EPZSS·tŸlMem
)

114 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

117 *
p_mÙiÚ
 = 
tmp
;

119  
mš_mco¡
;

124 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

126 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

127 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

128 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

129 
di¡blk
 
mco¡
;

130 
´ednum
 = 5;

131 
cÚd™iÚEPZS
;

132 
MÙiÚVeùÜ
 
tmp2
 = {0, 0}, 
tmv
;

133 
pos
;

134 
šv®id_»fs
 = 0;

136 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

138 ià(
mš_mco¡
 < (
¡ÝCr™”iÚ
 >> 1))

140 #ià
EPZSREF


141 ià(
p_IÅ
->
EPZSS·tŸlMem
)

143 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

146 *
p_mÙiÚ
 = 
tmp
;

150 ià((
»f
 =ð0è|| (*
´evSad
 > 
mš_mco¡
))

151 *
´evSad
 = 
mš_mco¡
;

153  
mš_mco¡
;

159 
šv®id_»fs
 = 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
,

160 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

162 ià(
p_IÅ
->
EPZSS·tŸlMem
)

163 
	`EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
cur_li¡
, &
´ednum
, 
»f_piùu»
->
size_x
 >> 2);

167 ià(
p_IÅ
->
HMEEÇbË
 =ð1 &&…_IÅ->
EPZSU£HMEP»diùÜs
 == 1)

168 
	`EPZS_h›¿rchiÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
, &
´ednum
, 
»f_piùu»
, 
cu¼Sliû
);

171 #ià(
MVC_EXTENSION_ENABLE
)

172 iàÐ
p_IÅ
->
EPZSTempÜ®
[
cu¼Sliû
->
v›w_id
] )

175 ià(
p_IÅ
->
EPZSTempÜ®
)

178 
	`EPZS_‹mpÜ®_´ediùÜs
 (
cu¼MB
, 
»f_piùu»
, 
p_EPZS
, 
mv_block
, &
´ednum
, 
¡ÝCr™”iÚ
, 
mš_mco¡
);

194 
cÚd™iÚEPZS
 = (
p_IÅ
->
EPZSFixed
 =ð3 && (
cu¼MB
->
mb_x
 =ð0 || cu¼MB->
mb_y
 == 0))

195 || ((
mš_mco¡
 > 3 * 
¡ÝCr™”iÚ
è&& ((
»f
 < 2 && 
blockty³
 < 4) || (ref < 1 && blocktype == 4)

196 || ((
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 || 
cu¼MB
->
li¡_off£t
)

197 && 
»f
 < 3))

198 && (
p_IÅ
->
EPZSFixed
 > 1 || (p_IÅ->EPZSFixed && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
)));

200 ià(
cÚd™iÚEPZS
)

201 
	`EPZSWšdowP»diùÜs
 (
mv
, 
p_EPZS
->
´ediùÜ
, &
´ednum
,

202 (
p_IÅ
->
EPZSAgg»ssiveWšdow
 !ð0è|| ((
šv®id_»fs
 > 2è&& (
»f
 < 1 + (
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 || 
cu¼MB
->
li¡_off£t
)))

203 ? 
p_EPZS
->
wšdow_´ediùÜ_ext
 :…_EPZS->
wšdow_´ediùÜ
);

210 
cÚd™iÚEPZS
 = (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 > 2 * 
¡ÝCr™”iÚ
));

212 ià(
cÚd™iÚEPZS
 && 
cu¼MB
->
mbAddrX
 !ð0 && 
p_IÅ
->
EPZSBlockTy³
)

213 
	`EPZSBlockTy³P»diùÜsMB
 (
cu¼Sliû
, 
mv_block
, 
p_EPZS_pošt
, &
´ednum
);

216 
pos
 = 0;…o < 
´ednum
; ++pos)

218 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

220 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

222 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

223 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

225 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

226 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

229 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

231 ià(
mco¡
 < 
£cÚd_mco¡
)

233 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

236 ià(
mco¡
 < 
mš_mco¡
)

238 
tmp2
 = 
tmp
;

239 
tmp
 = 
tmv
;

240 
£cÚd_mco¡
 = 
mš_mco¡
;

241 
mš_mco¡
 = 
mco¡
;

242 
checkMedŸn
 = 
TRUE
;

245 ià(
mco¡
 < 
£cÚd_mco¡
)

247 
tmp2
 = 
tmv
;

248 
£cÚd_mco¡
 = 
mco¡
;

249 
checkMedŸn
 = 
TRUE
;

256 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
è&& (*
´evSad
 * 3 < 
mš_mco¡
))

258 #ià
EPZSREF


259 ià(
p_IÅ
->
EPZSS·tŸlMem
)

261 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

264 *
p_mÙiÚ
 = 
tmp
;

267 *
mv
 = 
tmp
;

273  
mš_mco¡
;

280 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

282 cÚ¡ 
mv_¿nge
 = 10;

283 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

284 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

287 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

289 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((3 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

291 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 == 0)

292 || (
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range)))

293 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

295 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

297 ià(
»f
 > 0 && 
blockty³
 != 1)

298 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

300 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

304 
ûÁ”
 = 
tmp
;

308 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

311 
checkPts
 = 
tÙ®CheckPts
;

314 
tmv
 = 
	`add_MVs
 (
ûÁ”
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

316 ià(((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
è<ð0è&& ((Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
) <= 0))

318 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

319 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

321 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

322 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

324 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

326 ià(
mco¡
 < 
mš_mco¡
)

328 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

330 ià(
mco¡
 < 
mš_mco¡
)

332 
tmp
 = 
tmv
;

333 
mš_mco¡
 = 
mco¡
;

334 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

339 ++
poštNumb”
;

340 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

341 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

342 
checkPts
--;

344 
checkPts
 > 0);

346 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”
.mv_xè&& (tmp.
mv_y
 == center.mv_y)))

348 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

349 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

350 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

351 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

352 
mÙiÚDœeùiÚ
 = 0;

353 
poštNumb”
 = 0;

357 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

358 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

359 
ûÁ”
 = 
tmp
;

362 
·‰”nStÝ
 != 1);

364 ià((
»f
 > 0è&& (
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

365 && ((4 * *
´evSad
 < 
mš_mco¡
è|| ((3 * *´evSad < mš_mco¡è&& (*´evSad <ð
¡ÝCr™”iÚ
))))

367 *
mv
 = 
tmp
;

368 #ià
EPZSREF


369 ià(
p_IÅ
->
EPZSS·tŸlMem
)

371 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

374 *
p_mÙiÚ
 = 
tmp
;

377  
mš_mco¡
;

381 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
)

382 && (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 < 2 * *
´evSad
))

383 && (
mš_mco¡
 > (Ð3 * 
¡ÝCr™”iÚ
è>> 1)è&& (
p_IÅ
->
EPZSDu®
 > 0);

385 ià(!
cÚd™iÚEPZS
)

388 
poštNumb”
 = 0;

389 
·‰”nStÝ
 = 0;

390 
mÙiÚDœeùiÚ
 = 0;

391 
ÃxtLa¡
 = 0;

393 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv
->mv_x &&mp.mv_y == mv->mv_y))

395 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range))

396 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

398 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

401 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

404 
ûÁ”
 = 
tmp2
;

405 
checkMedŸn
 = 
FALSE
;

410 ià((
»f
 =ð0è|| (*
´evSad
 > 
mš_mco¡
))

411 *
´evSad
 = 
mš_mco¡
;

412 #ià
EPZSREF


413 ià(
p_IÅ
->
EPZSS·tŸlMem
)

415 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

418 *
p_mÙiÚ
 = 
tmp
;

423 *
mv
 = 
tmp
;

425  
mš_mco¡
;

426 
	}
}

436 
di¡blk


437 
	$EPZS_š‹g”_subMB_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

438 
MÙiÚVeùÜ
 * 
´ed_mv
,

439 
MEBlock
 * 
mv_block
,

440 
di¡blk
 
mš_mco¡
,

441 
Ïmbda_çùÜ


444 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

445 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

446 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

447 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

448 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

450 
blockty³
 = 
mv_block
->blocktype;

451 
li¡
 = 
mv_block
->list;

452 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

453 
»f
 = 
mv_block
->
»f_idx
;

454 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

456 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

457 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

458 
MÙiÚVeùÜ
 
ÿnd
 = 
ûÁ”
;

459 
MÙiÚVeùÜ
 
´ed
 = 
	`·d_MVs
 (*
´ed_mv
, 
mv_block
);

460 
MÙiÚVeùÜ
 
tmp
 = *
mv
;

461 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

462 
m­C’‹r_x
 = 
£¬chRªge
->
max_x
 - 
mv
->
mv_x
;

463 
m­C’‹r_y
 = 
£¬chRªge
->
max_y
 - 
mv
->
mv_y
;

465 
pic_pix_x2
 = 
mv_block
->
pos_x2
;

466 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
,3);

467 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

468 
di¡blk
 *
´evSad
 = &
p_EPZS
->
di¡ÜtiÚ
[
cur_li¡
][
blockty³
 - 1][
pic_pix_x2
];

469 
MÙiÚVeùÜ
 *
p_mÙiÚ
 = 
NULL
;

471 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

472 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

474 ++
p_EPZS
->
BlkCouÁ
;

475 ià(
p_EPZS
->
BlkCouÁ
 == 0)

476 ++
p_EPZS
->
BlkCouÁ
;

478 ià(
p_IÅ
->
EPZSS·tŸlMem
)

480 #ià
EPZSREF


481 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
»f
][
blockty³
 - 1][
mv_block
->
block_y
][
pic_pix_x2
];

483 
p_mÙiÚ
 = &
p_EPZS
->p_mÙiÚ[
cur_li¡
][
blockty³
 - 1][
mv_block
->
block_y
][
pic_pix_x2
];

491 
p_EPZS
->
EPZSM­
[
£¬chRªge
->
max_y
][£¬chRªge->
max_x
] =…_EPZS->
BlkCouÁ
;

494 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

497 
mš_mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
DISTBLK_MAX
-mš_mco¡, &
ÿnd
);

501 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
) &&

502 ((*
´evSad
 < 
	`di¡blkmš
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, 
mš_mco¡
)) || (*prevSad * 6 < min_mcost)))

504 #ià
EPZSREF


505 ià(
p_IÅ
->
EPZSS·tŸlMem
)

507 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

510 *
p_mÙiÚ
 = 
tmp
;

512  
mš_mco¡
;

517 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

519 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

520 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

521 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

522 
di¡blk
 
mco¡
;

523 
´ednum
 = 5;

524 
cÚd™iÚEPZS
;

526 
MÙiÚVeùÜ
 
tmv
, 
tmp2
 = {0,0};

527 
pos
;

529 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

531 ià(
mš_mco¡
 < (
¡ÝCr™”iÚ
 >> 1))

533 #ià
EPZSREF


534 ià(
p_IÅ
->
EPZSS·tŸlMem
)

536 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

539 *
p_mÙiÚ
 = 
tmp
;

541  
mš_mco¡
;

547 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

549 ià(
p_IÅ
->
EPZSS·tŸlMem
)

550 
	`EPZS_¥©Ÿl_memÜy_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
cur_li¡
, &
´ednum
, 
»f_piùu»
->
size_x
 >> 2);

556 
cÚd™iÚEPZS
 = (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 > 2 * 
¡ÝCr™”iÚ
));

558 ià(
cÚd™iÚEPZS
 && 
cu¼MB
->
mbAddrX
 !ð0 && 
p_IÅ
->
EPZSBlockTy³
)

559 
	`EPZSBlockTy³P»diùÜs
 (
cu¼Sliû
, 
mv_block
, 
p_EPZS_pošt
, &
´ednum
);

562 
pos
 = 0;…o < 
´ednum
; ++pos)

564 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

566 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

569 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

571 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

573 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

576 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

578 ià(
mco¡
 < 
£cÚd_mco¡
)

580 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

583 ià(
mco¡
 < 
mš_mco¡
)

585 
tmp2
 = 
tmp
;

586 
tmp
 = 
tmv
;

587 
£cÚd_mco¡
 = 
mš_mco¡
;

588 
mš_mco¡
 = 
mco¡
;

589 
checkMedŸn
 = 
TRUE
;

592 ià(
mco¡
 < 
£cÚd_mco¡
)

594 
tmp2
 = 
tmv
;

595 
£cÚd_mco¡
 = 
mco¡
;

596 
checkMedŸn
 = 
TRUE
;

602 ià((
»f
 > 0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
è&& (*
´evSad
 * 3 < 
mš_mco¡
))

604 #ià
EPZSREF


605 ià(
p_IÅ
->
EPZSS·tŸlMem
)

607 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

610 *
p_mÙiÚ
 = 
tmp
;

612  
mš_mco¡
;

617 ià(
mš_mco¡
 < ((3 * 
¡ÝCr™”iÚ
) >> 2))

619 #ià
EPZSREF


620 ià(
p_IÅ
->
EPZSS·tŸlMem
)

622 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

625 *
p_mÙiÚ
 = 
tmp
;

627 *
mv
 = 
tmp
;

628  
mš_mco¡
;

636 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

638 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

639 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

640 cÚ¡ 
mv_¿nge
 = 12;

643 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

645 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((3 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

647 ià((
blockty³
 == 7)

648 || (
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (
	`Ÿbs
 (tmp.mv_x - 
mv
->mv_xè< (
mv_¿nge
) && iabs (tmp.mv_y - mv->mv_y) < (mv_range)))

649 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

651 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

654 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

658 
ûÁ”
 = 
tmp
;

661 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

664 
checkPts
 = 
tÙ®CheckPts
;

667 
tmv
 = 
	`add_MVs
 (
ûÁ”
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

669 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè<ð
£¬chRªge
->
max_x
è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè<ð£¬chRªge->
max_y
))

671 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

673 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

674 
ÿnd
 = 
	`·d_MVs
(
tmv
, 
mv_block
);

676 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

677 ià(
mco¡
 < 
mš_mco¡
)

680 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

682 ià(
mco¡
 < 
mš_mco¡
)

684 
tmp
 = 
tmv
;

685 
mš_mco¡
 = 
mco¡
;

686 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

691 ++
poštNumb”
;

692 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

693 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

694 
checkPts
--;

696 
checkPts
 > 0);

698 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”
.mv_xè&& (tmp.
mv_y
 == center.mv_y)))

700 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

701 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

702 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

703 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

704 
mÙiÚDœeùiÚ
 = 0;

705 
poštNumb”
 = 0;

709 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

710 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

711 
ûÁ”
 = 
tmp
;

714 
·‰”nStÝ
 != 1);

716 ià((
»f
 > 0è&& (
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
)

717 && ((4 * *
´evSad
 < 
mš_mco¡
è|| ((3 * *´evSad < mš_mco¡è&& (*´evSad <ð
¡ÝCr™”iÚ
))))

719 *
mv
 = 
tmp
;

720 #ià
EPZSREF


721 ià(
p_IÅ
->
EPZSS·tŸlMem
)

723 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

726 *
p_mÙiÚ
 = 
tmp
;

729  
mš_mco¡
;

733 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
è&& (
blockty³
 != 7)

735 && (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 < 2 * *
´evSad
))

736 && ((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
)è&& (
mš_mco¡
 > ((3 * 
¡ÝCr™”iÚ
è>> 1)è&& (
p_IÅ
->
EPZSDu®
 > 0);

738 ià(!
cÚd™iÚEPZS
)

741 
poštNumb”
 = 0;

742 
·‰”nStÝ
 = 0;

743 
mÙiÚDœeùiÚ
 = 0;

744 
ÃxtLa¡
 = 0;

746 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv
->mv_x &&mp.mv_y == mv->mv_y))

748 ià((
blockty³
 =ð7è|| (
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range)))

749 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

751 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

754 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

757 
ûÁ”
 = 
tmp2
;

758 
checkMedŸn
 = 
FALSE
;

763 ià((
»f
 =ð0è|| (*
´evSad
 > 
mš_mco¡
))

764 *
´evSad
 = 
mš_mco¡
;

766 #ià
EPZSREF


767 ià(
p_IÅ
->
EPZSS·tŸlMem
)

769 ià(
p_IÅ
->
EPZSS·tŸlMem
 && 
»f
 == 0)

772 *
p_mÙiÚ
 = 
tmp
;

775 *
mv
 = 
tmp
;

777  
mš_mco¡
;

778 
	}
}

789 
di¡blk


790 
	$EPZS_š‹g”_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 * 
cu¼MB
,

791 
li¡
,

792 
MÙiÚVeùÜ
 * 
´ed_mv1
,

793 
MÙiÚVeùÜ
 * 
´ed_mv2
,

794 
MÙiÚVeùÜ
 * 
mv1
,

795 
MÙiÚVeùÜ
 * 
mv2
,

796 
MEBlock
 * 
mv_block
,

797 
£¬ch_¿nge
,

798 
di¡blk
 
mš_mco¡
,

799 
Ïmbda_çùÜ


802 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

803 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

804 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

805 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

806 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

808 
blockty³
 = 
mv_block
->blocktype;

809 
»f
 = 
mv_block
->
»f_idx
;

811 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
»f
];

812 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
cu¼MB
->
li¡_off£t
][0];

814 
m­C’‹r_x
 = 
£¬ch_¿nge
 - 
mv1
->
mv_x
;

815 
m­C’‹r_y
 = 
£¬ch_¿nge
 - 
mv1
->
mv_y
;

816 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 4);

817 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

818 
di¡blk
 *
´evSad
 = &
p_EPZS
->
bi_di¡ÜtiÚ
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
blockty³
 - 1][
mv_block
->
pos_x2
];

819 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

820 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

822 
MÙiÚVeùÜ
 
tmp
 = *
mv1
;

823 
MÙiÚVeùÜ
 
ûÁ”1
 = 
	`·d_MVs
 (*
mv1
, 
mv_block
);

824 
MÙiÚVeùÜ
 
ûÁ”2
 = 
	`·d_MVs
 (*
mv2
, 
mv_block
);

825 
MÙiÚVeùÜ
 
´ed1
 = 
	`·d_MVs
 (*
´ed_mv1
, 
mv_block
);

826 
MÙiÚVeùÜ
 
´ed2
 = 
	`·d_MVs
 (*
´ed_mv2
, 
mv_block
);

827 
MÙiÚVeùÜ
 
ÿnd1
 = 
ûÁ”1
;

828 
MÙiÚVeùÜ
 
ÿnd2
 = 
ûÁ”2
;

830 ++
p_EPZS
->
BlkCouÁ
;

831 ià(
p_EPZS
->
BlkCouÁ
 == 0)

832 ++
p_EPZS
->
BlkCouÁ
;

839 
p_EPZS
->
EPZSM­
[
£¬ch_¿nge
][£¬ch_¿nge] =…_EPZS->
BlkCouÁ
;

842 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

843 
mš_mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

846 
mš_mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
DISTBLK_MAX
-mš_mco¡, &
ÿnd1
, &
ÿnd2
);

849 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

851 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

852 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

853 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

854 
di¡blk
 
mco¡
;

855 
´ednum
 = 5;

856 
MÙiÚVeùÜ
 
tmv
, 
tmp2
 = { 0, 0 };

857 
pos
;

859 
¡ÝCr™”iÚ
 = 
	`EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
´evSad
, 
mv_block
, 
Ïmbda_di¡
);

865 
	`EPZS_¥©Ÿl_´ediùÜs
 (
p_EPZS
, 
mv_block
, 
li¡
, 
cu¼MB
->
li¡_off£t
, 
»f
, 
mÙiÚ
);

868 
pos
 = 0;…o < 
´ednum
; ++pos)

870 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

872 ià(
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv1
->mv_xè<ð
£¬ch_¿nge
 && iab Ñmv.
mv_y
 - mv1->mv_y) <= search_range)

874 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

876 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

878 
ÿnd1
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

881 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

882 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

884 ià(
mco¡
 >ð
£cÚd_mco¡
)

887 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd1
, &
ÿnd2
);

890 ià(
mco¡
 < 
mš_mco¡
)

892 
tmp2
 = 
tmp
;

893 
tmp
 = 
tmv
;

894 
£cÚd_mco¡
 = 
mš_mco¡
;

895 
mš_mco¡
 = 
mco¡
;

896 
checkMedŸn
 = 
TRUE
;

899 ià(
mco¡
 < 
£cÚd_mco¡
)

901 
tmp2
 = 
tmv
;

902 
£cÚd_mco¡
 = 
mco¡
;

903 
checkMedŸn
 = 
TRUE
;

913 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

915 
cÚd™iÚEPZS
;

916 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

917 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

919 cÚ¡ 
mv_¿nge
 = 12;

922 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

924 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((4 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

926 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (
	`Ÿbs
 (tmp.mv_x - 
mv1
->mv_xè< (
mv_¿nge
) && iabs (tmp.mv_y - mv1->mv_y) < (mv_range)))

927 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

929 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

931 ià(
blockty³
 > 5 || (
»f
 > 0 && blocktype != 1))

932 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

934 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

938 
ûÁ”1
 = 
tmp
;

941 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

944 
checkPts
 = 
tÙ®CheckPts
;

947 
tmv
 = 
	`add_MVs
 (
ûÁ”1
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

949 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv1
->mv_xè<ð
£¬ch_¿nge
è&& (Ÿb Ñmv.
mv_y
 - mv1->mv_y) <= search_range))

951 ià(
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] !ð
p_EPZS
->
BlkCouÁ
)

953 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

954 
ÿnd1
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

956 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd1
, &
´ed1
);

957 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd2
, &
´ed2
);

959 ià(
mco¡
 < 
mš_mco¡
)

961 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
 (
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd1
, &
ÿnd2
);

963 ià(
mco¡
 < 
mš_mco¡
)

965 
tmp
 = 
tmv
;

966 
mš_mco¡
 = 
mco¡
;

967 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

972 ++
poštNumb”
;

973 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

974 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

975 
checkPts
--;

977 
checkPts
 > 0);

979 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”1
.mv_xè&& (tmp.
mv_y
 == center1.mv_y)))

981 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

982 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

983 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

984 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

985 
mÙiÚDœeùiÚ
 = 0;

986 
poštNumb”
 = 0;

990 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

991 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

992 
ûÁ”1
 = 
tmp
;

995 
·‰”nStÝ
 != 1);

998 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
è&& (
blockty³
 < 5è&& (
mš_mco¡
 > 
¡ÝCr™”iÚ
è&& (
p_IÅ
->
EPZSDu®
 > 0);

1000 ià(!
cÚd™iÚEPZS
)

1003 
poštNumb”
 = 0;

1004 
·‰”nStÝ
 = 0;

1005 
mÙiÚDœeùiÚ
 = 0;

1006 
ÃxtLa¡
 = 0;

1008 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv1
->mv_x &&mp.mv_y == mv1->mv_y))

1010 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv1
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv1->mv_y) < (mv_range))

1011 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

1013 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

1016 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

1017 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

1020 
ûÁ”1
 = 
tmp2
;

1021 
checkMedŸn
 = 
FALSE
;

1026 ià(
mv_block
->
™”©iÚ_no
 == 0)

1028 *
´evSad
 = 
mš_mco¡
;

1031 *
mv1
 = 
tmp
;

1033  
mš_mco¡
;

1034 
	}
}

	@lencod/src/me_epzs_sub.c

16 
	~"cÚŒibutÜs.h
"

18 
	~"glob®.h
"

19 
	~"»fbuf.h
"

20 
	~"me_•zs.h
"

21 
	~"mv_£¬ch.h
"

29 
di¡blk


30 
	$EPZS_sub_³l_mÙiÚ_e¡im©iÚ
 ( 
Maüoblock
 *
cu¼MB
,

31 
MÙiÚVeùÜ
 *
´ed
,

32 
MEBlock
 *
mv_block
,

33 
di¡blk
 
mš_mco¡
,

34 * 
Ïmbda


37 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

38 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

39 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

40 
pos
, 
be¡_pos
 = 0, 
£cÚd_pos
 = 0;

41 
di¡blk
 
mco¡
;

42 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

43 
max_pos2
 = ( (!
p_Vid
->
¡¬t_me_»fšem’t_hp
 || !p_Vid->
¡¬t_me_»fšem’t_qp
è? 
	`imax
(1, 
mv_block
->
£¬ch_pos2
) : mv_block->search_pos2);

45 
li¡
 = 
mv_block
->list;

46 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

47 
»f
 = 
mv_block
->
»f_idx
;

48 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

49 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

50 
MÙiÚVeùÜ
 
ÿnd
;

51 
MÙiÚVeùÜ
 
·dded_mv
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

52 
MÙiÚVeùÜ
 
´ed_mv
 = 
	`·d_MVs
 (*
´ed
, 
mv_block
);

54 
¡¬t_pos
 = 5, 
’d_pos
 = 
max_pos2
;

55 
Ïmbda_çùÜ
 = 
Ïmbda
[
H_PEL
];

56 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 2);

57 
di¡blk
 
sub_th»shÞd
 = 
p_EPZS
->
subth»s
[
mv_block
->
blockty³
] + 
Ïmbda_di¡
;

66 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_hp
;…o < 
	`imš
(5, 
max_pos2
); ++pos)

68 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_hp
[
pos
], &
·dded_mv
);

71 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv
);

72 ià(
mco¡
 < 
£cÚd_mco¡
)

74 
mco¡
 +ð
mv_block
->
	`compu‹P»dHP–
(
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

76 ià(
mco¡
 < 
mš_mco¡
)

78 
£cÚd_mco¡
 = 
mš_mco¡
;

79 
£cÚd_pos
 = 
be¡_pos
;

80 
mš_mco¡
 = 
mco¡
;

81 
be¡_pos
 = 
pos
;

83 ià(
mco¡
 < 
£cÚd_mco¡
)

85 
£cÚd_mco¡
 = 
mco¡
;

86 
£cÚd_pos
 = 
pos
;

91 ià(
be¡_pos
 ==0 && (
´ed
->
mv_x
 =ð
mv
->mv_xè&& (´ed->
mv_y
 =ðmv->mv_yè&& 
mš_mco¡
 < 
sub_th»shÞd
)

93  
mš_mco¡
;

96 if(
mv_block
->
£¬ch_pos2
 >= 9)

98 ià(
be¡_pos
 !=0 || (
	`Ÿbs
(
´ed
->
mv_x
 - 
mv
->mv_xè+ iabsÕ»d->
mv_y
 - mv->mv_y)))

100 
¡¬t_pos
 = 
Ãxt_¡¬t_pos
[
be¡_pos
][
£cÚd_pos
];

101 
’d_pos
 = 
Ãxt_’d_pos
[
be¡_pos
][
£cÚd_pos
];

103 
pos
 = 
¡¬t_pos
;…o < 
’d_pos
; ++pos)

105 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_hp
[
pos
], &
·dded_mv
);

108 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv
);

110 ià(
mco¡
 < 
mš_mco¡
)

112 
mco¡
 +ð
mv_block
->
	`compu‹P»dHP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

114 ià(
mco¡
 < 
mš_mco¡
)

116 
mš_mco¡
 = 
mco¡
;

117 
be¡_pos
 = 
pos
;

124 ià(
be¡_pos
)

126 
	`add_mvs
(
mv
, &
£¬ch_pošt_hp
[
be¡_pos
]);

127 
·dded_mv
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

135 
’d_pos
 = (
mš_mco¡
 < 
sub_th»shÞd
) ? 1 : 5;

136 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

138 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

140 
be¡_pos
 = -1;

141 
mš_mco¡
 = 
DISTBLK_MAX
;

145 
be¡_pos
 = 0;

147 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

150 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_qp
;…o < 
’d_pos
; ++pos)

152 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_qp
[
pos
], &
·dded_mv
);

155 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv
);

157 ià(
mco¡
 < 
£cÚd_mco¡
)

159 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
(
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

161 ià(
mco¡
 < 
mš_mco¡
)

163 
£cÚd_mco¡
 = 
mš_mco¡
;

164 
£cÚd_pos
 = 
be¡_pos
;

165 
mš_mco¡
 = 
mco¡
;

166 
be¡_pos
 = 
pos
;

168 ià(
mco¡
 < 
£cÚd_mco¡
)

170 
£cÚd_mco¡
 = 
mco¡
;

171 
£cÚd_pos
 = 
pos
;

177 iàÐ(
mš_mco¡
 > 
sub_th»shÞd
))

180 ià(
be¡_pos
 !=0 || (
	`Ÿbs
(
´ed
->
mv_x
 - 
mv
->mv_xè+ iabsÕ»d->
mv_y
 - mv->mv_y)))

182 
¡¬t_pos
 = 
Ãxt_¡¬t_pos
[
be¡_pos
][
£cÚd_pos
];

183 
’d_pos
 = 
Ãxt_’d_pos
[
be¡_pos
][
£cÚd_pos
];

185 
pos
 = 
¡¬t_pos
;…o < 
’d_pos
; ++pos)

187 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_qp
[
pos
], &
·dded_mv
);

190 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv
);

192 ià(
mco¡
 < 
mš_mco¡
)

194 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
(
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

196 ià(
mco¡
 < 
mš_mco¡
)

198 
mš_mco¡
 = 
mco¡
;

199 
be¡_pos
 = 
pos
;

206 ià(
be¡_pos
)

208 
	`add_mvs
(
mv
, &
£¬ch_pošt_qp
[
be¡_pos
]);

212  
mš_mco¡
;

213 
	}
}

222 
di¡blk


223 
	$EPZS_sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

224 
MEBlock
 *
mv_block
,

225 
li¡
,

226 
MÙiÚVeùÜ
 *
´ed1
,

227 
MÙiÚVeùÜ
 *
´ed2
,

228 
MÙiÚVeùÜ
 *
mv1
,

229 
MÙiÚVeùÜ
 *
mv2
,

230 
di¡blk
 
mš_mco¡
,

231 * 
Ïmbda


234 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

235 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

236 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

238 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

240 
pos
, 
be¡_pos
 = 0, 
£cÚd_pos
 = 0;

241 
di¡blk
 
mco¡
;

242 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

245 
¡¬t_hp
 = (
mš_mco¡
 =ð
DISTBLK_MAX
è? 0 : 
p_Vid
->
¡¬t_me_»fšem’t_hp
;

246 
max_pos2
 = ( (!
p_Vid
->
¡¬t_me_»fšem’t_hp
 || !p_Vid->
¡¬t_me_»fšem’t_qp
è? 
	`imax
(1, 
mv_block
->
£¬ch_pos2
) : mv_block->search_pos2);

248 
»f
 = 
mv_block
->
»f_idx
;

249 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
li¡_off£t
][
»f
];

250 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
li¡_off£t
][0];

251 
MÙiÚVeùÜ
 
ÿnd
;

252 
MÙiÚVeùÜ
 
·dded_mv1
 = 
	`·d_MVs
 (*
mv1
, 
mv_block
);

253 
MÙiÚVeùÜ
 
·dded_mv2
 = 
	`·d_MVs
 (*
mv2
, 
mv_block
);

254 
MÙiÚVeùÜ
 
´ed_mv1
 = 
	`·d_MVs
 (*
´ed1
, 
mv_block
);

255 
MÙiÚVeùÜ
 
´ed_mv2
 = 
	`·d_MVs
 (*
´ed2
, 
mv_block
);

257 
¡¬t_pos
 = 5, 
’d_pos
 = 
max_pos2
;

258 
Ïmbda_çùÜ
 = 
Ïmbda
[
H_PEL
];

259 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 2);

260 
di¡blk
 
sub_th»shÞd
 = 
p_EPZS
->
subth»s
[
mv_block
->
blockty³
] + 
Ïmbda_di¡
;

262 
di¡blk
 
mco¡2
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
·dded_mv2
, &
´ed_mv2
);

263 
mš_mco¡
 -ð
mco¡2
;

272 
be¡_pos
 = 0, 
pos
 = 
¡¬t_hp
;…os < 5; ++pos)

274 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_hp
[
pos
], &
·dded_mv1
);

277 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv1
);

279 ià(
mco¡
 < 
£cÚd_mco¡
)

281 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dHP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
, &
·dded_mv2
);

283 ià(
mco¡
 < 
mš_mco¡
)

285 
£cÚd_mco¡
 = 
mš_mco¡
;

286 
£cÚd_pos
 = 
be¡_pos
;

287 
mš_mco¡
 = 
mco¡
;

288 
be¡_pos
 = 
pos
;

290 ià(
mco¡
 < 
£cÚd_mco¡
)

292 
£cÚd_mco¡
 = 
mco¡
;

293 
£cÚd_pos
 = 
pos
;

298 ià(
be¡_pos
 ==0 && (
´ed1
->
mv_x
 =ð
mv1
->mv_xè&& (´ed1->
mv_y
 =ðmv1->mv_yè&& 
mš_mco¡
 < 
sub_th»shÞd
)

300  
mš_mco¡
;

303 if(
mv_block
->
£¬ch_pos2
 >= 9)

305 ià(
be¡_pos
 !=0 || (
	`Ÿbs
(
´ed1
->
mv_x
 - 
mv1
->mv_xè+ iabsÕ»d1->
mv_y
 - mv1->mv_y)))

307 
¡¬t_pos
 = 
Ãxt_¡¬t_pos
[
be¡_pos
][
£cÚd_pos
];

308 
’d_pos
 = 
Ãxt_’d_pos
[
be¡_pos
][
£cÚd_pos
];

310 
pos
 = 
¡¬t_pos
;…o < 
’d_pos
; ++pos)

312 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_hp
[
pos
], &
·dded_mv1
);

315 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv1
);

317 ià(
mco¡
 < 
mš_mco¡
)

319 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dHP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
, &
·dded_mv2
);

321 ià(
mco¡
 < 
mš_mco¡
)

323 
mš_mco¡
 = 
mco¡
;

324 
be¡_pos
 = 
pos
;

331 ià(
be¡_pos
)

333 
	`add_mvs
 (
mv1
, &
£¬ch_pošt_hp
[
be¡_pos
]);

334 
·dded_mv1
 = 
	`·d_MVs
 (*
mv1
, 
mv_block
);

342 
’d_pos
 = (
mš_mco¡
 < 
sub_th»shÞd
) ? 1 : 5;

343 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

345 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

347 
be¡_pos
 = -1;

348 
mš_mco¡
 = 
DISTBLK_MAX
;

352 
be¡_pos
 = 0;

353 
mš_mco¡
 +ð
mco¡2
;

355 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

356 
mco¡2
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
·dded_mv2
, &
´ed_mv2
);

357 
mš_mco¡
 -ð
mco¡2
;

360 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_qp
;…os < 5; ++pos)

362 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_qp
[
pos
], &
·dded_mv1
);

365 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv1
);

367 ià(
mco¡
 < 
£cÚd_mco¡
)

369 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dQP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
, &
·dded_mv2
);

371 ià(
mco¡
 < 
mš_mco¡
)

373 
£cÚd_mco¡
 = 
mš_mco¡
;

374 
£cÚd_pos
 = 
be¡_pos
;

375 
mš_mco¡
 = 
mco¡
;

376 
be¡_pos
 = 
pos
;

378 ià(
mco¡
 < 
£cÚd_mco¡
)

380 
£cÚd_mco¡
 = 
mco¡
;

381 
£cÚd_pos
 = 
pos
;

386 iàÐ(
mš_mco¡
 > 
sub_th»shÞd
))

389 ià(
be¡_pos
 !=0 || (
	`Ÿbs
(
´ed1
->
mv_x
 - 
mv1
->mv_xè+ iabsÕ»d1->
mv_y
 - mv1->mv_y)))

391 
¡¬t_pos
 = 
Ãxt_¡¬t_pos
[
be¡_pos
][
£cÚd_pos
];

392 
’d_pos
 = 
Ãxt_’d_pos
[
be¡_pos
][
£cÚd_pos
];

394 
pos
 = 
¡¬t_pos
;…o < 
’d_pos
; ++pos)

396 
ÿnd
 = 
	`add_MVs
(
£¬ch_pošt_qp
[
pos
], &
·dded_mv1
);

399 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed_mv1
);

401 ià(
mco¡
 < 
mš_mco¡
)

403 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dQP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
, &
·dded_mv2
);

405 ià(
mco¡
 < 
mš_mco¡
)

407 
mš_mco¡
 = 
mco¡
;

408 
be¡_pos
 = 
pos
;

415 ià(
be¡_pos
)

417 
	`add_mvs
(
mv1
, &
£¬ch_pošt_qp
[
be¡_pos
]);

421  
mš_mco¡
 + 
mco¡2
;

422 
	}
}

	@lencod/src/me_fullfast.c

17 
	~"cÚŒibutÜs.h
"

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

21 
	~"image.h
"

22 
	~"mem®loc.h
"

23 
	~"mb_acûss.h
"

24 
	~"»fbuf.h
"

26 
	~"me_di¡ÜtiÚ.h
"

27 
	~"me_fuÎ£¬ch.h
"

28 
	~"me_fuÎç¡.h
"

29 
	~"cÚfÜmªû.h
"

30 
	~"mv_£¬ch.h
"

48 
	$š™Ÿlize_ç¡_fuÎ_£¬ch
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

50 
i
, 
j
, 
k
, 
li¡
;

51 
£¬ch_¿nge
 = 
p_IÅ
->
S—rchMode
[0] =ð
FAST_FULL_SEARCH
 ?…_Inp->search_range[0] :…_Inp->search_range[1];

52 
max_pos
 = (2*
£¬ch_¿nge
+1) * (2*search_range+1);

53 
MEFuÎFa¡
 *
p_me_fç¡
 = 
NULL
;

55 ià((
p_Vid
->
p_fç¡_me
 = 
	`ÿÎoc
 (1,  (
MEFuÎFa¡
))è=ð
NULL
)

56 
	`no_mem_ex™
 ("initialize_fast_full_search:…_Vid->p_ffast_me");

57 
p_me_fç¡
 = 
p_Vid
->
p_fç¡_me
;

59 ià((
p_me_fç¡
->
BlockSAD
 = (
di¡³l
*****)
	`m®loc
 (2 * (di¡³l****))è=ð
NULL
)

60 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->BlockSAD");

62 
li¡
=0;†ist<2;list++)

64 ià((
p_me_fç¡
->
BlockSAD
[
li¡
] = (
di¡³l
****)
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
è* (di¡³l***))è=ð
NULL
)

65 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->BlockSAD");

66 
i
 = 0; i < 
p_Vid
->
max_num_»ã»nûs
; i++)

68 ià((
p_me_fç¡
->
BlockSAD
[
li¡
][
i
] = (
di¡³l
***)
	`m®loc
 (8 * (di¡³l**))è=ð
NULL
)

69 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->BlockSAD");

70 
j
 = 1; j < 8; j++)

72 ià((
p_me_fç¡
->
BlockSAD
[
li¡
][
i
][
j
] = (
di¡³l
**)
	`m®loc
 (16 * (di¡³l*))è=ð
NULL
)

73 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->BlockSAD");

74 
k
 = 0; k < 16; k++)

76 ià((
p_me_fç¡
->
BlockSAD
[
li¡
][
i
][
j
][
k
] = (
di¡³l
*)
	`m®loc
 (
max_pos
 * (di¡³l))è=ð
NULL
)

77 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->BlockSAD");

83 ià((
p_me_fç¡
->
£¬ch_£tup_dÚe
 = (**)
	`m®loc
 (2*(*)))==
NULL
)

84 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_setup_done");

85 ià((
p_me_fç¡
->
£¬ch_ûÁ”
 = (
MÙiÚVeùÜ
**è
	`m®loc
 (2 * (MÙiÚVeùÜ*)))==
NULL
)

86 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_center");

87 ià((
p_me_fç¡
->
£¬ch_ûÁ”_·dded
 = (
MÙiÚVeùÜ
**è
	`m®loc
 (2 * (MÙiÚVeùÜ*)))==
NULL
)

88 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_center_padded");

90 ià((
p_me_fç¡
->
pos_00
 = (**)
	`m®loc
 (2*(*)))==
NULL
)

91 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->pos_00");

92 ià((
p_me_fç¡
->
max_£¬ch_¿nge
 = (**)
	`m®loc
 (2*(*)))==
NULL
)

93 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->max_search_range");

95 
li¡
=0;†ist<2;†ist++)

97 ià((
p_me_fç¡
->
£¬ch_£tup_dÚe
[
li¡
] = (*)
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
)*()))==
NULL
)

98 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_setup_done");

99 ià((
p_me_fç¡
->
£¬ch_ûÁ”
[
li¡
] = (
MÙiÚVeùÜ
*è
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
è* (MÙiÚVeùÜ)))==
NULL
)

100 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_center");

101 ià((
p_me_fç¡
->
£¬ch_ûÁ”_·dded
[
li¡
] = (
MÙiÚVeùÜ
*è
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
è* (MÙiÚVeùÜ)))==
NULL
)

102 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->search_center_padded");

105 ià((
p_me_fç¡
->
pos_00
[
li¡
] = (*)
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
)*()))==
NULL
)

106 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->pos_00");

107 ià((
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
] = (*)
	`m®loc
 ((
p_Vid
->
max_num_»ã»nûs
)*()))==
NULL
)

108 
	`no_mem_ex™
 ("initialize_fast_full_search:…_me_ffast->max_search_range");

112 ià(
p_IÅ
->
fuÎ_£¬ch
 == 2)

114 
li¡
=0;list<2;list++)

115 
i
=0; i<
p_Vid
->
max_num_»ã»nûs
; i++)

116 
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
][
i
] = 
£¬ch_¿nge
;

120 
li¡
=0;list<2;list++)

122 
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
][0] = 
£¬ch_¿nge
;

123 
i
=1; i< 
p_Vid
->
max_num_»ã»nûs
; i++è
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
][i] = 
£¬ch_¿nge
 / 2;

126 
	}
}

135 
	$þ—r_ç¡_fuÎ_£¬ch
 (
VideoP¬am‘”s
 *
p_Vid
)

137 
i
, 
j
, 
k
, 
li¡
;

138 
MEFuÎFa¡
 *
p_me_fç¡
 = 
p_Vid
->
p_fç¡_me
;

140 
li¡
=0;†ist<2;†ist++)

142 
i
 = 0; i < 
p_Vid
->
max_num_»ã»nûs
; i++)

144 
j
 = 1; j < 8; j++)

146 
k
 = 0; k < 16; k++)

148 
	`ä“
 (
p_me_fç¡
->
BlockSAD
[
li¡
][
i
][
j
][
k
]);

150 
	`ä“
 (
p_me_fç¡
->
BlockSAD
[
li¡
][
i
][
j
]);

152 
	`ä“
 (
p_me_fç¡
->
BlockSAD
[
li¡
][
i
]);

154 
	`ä“
 (
p_me_fç¡
->
BlockSAD
[
li¡
]);

156 
	`ä“
 (
p_me_fç¡
->
BlockSAD
);

158 
li¡
=0;†ist<2;†ist++)

160 
	`ä“
 (
p_me_fç¡
->
£¬ch_£tup_dÚe
[
li¡
]);

161 
	`ä“
 (
p_me_fç¡
->
£¬ch_ûÁ”_·dded
[
li¡
]);

162 
	`ä“
 (
p_me_fç¡
->
£¬ch_ûÁ”
[
li¡
]);

163 
	`ä“
 (
p_me_fç¡
->
pos_00
[
li¡
]);

164 
	`ä“
 (
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
]);

166 
	`ä“
 (
p_me_fç¡
->
£¬ch_£tup_dÚe
);

167 
	`ä“
 (
p_me_fç¡
->
£¬ch_ûÁ”_·dded
);

168 
	`ä“
 (
p_me_fç¡
->
£¬ch_ûÁ”
);

169 
	`ä“
 (
p_me_fç¡
->
pos_00
);

170 
	`ä“
 (
p_me_fç¡
->
max_£¬ch_¿nge
);

171 
	`ä“
 (
p_me_fç¡
);

173 
	}
}

183 
	$»£t_ç¡_fuÎ_£¬ch
 (
VideoP¬am‘”s
 *
p_Vid
)

185 
li¡
;

186 
li¡
=0;†ist<2;†ist++)

187 
	`mem£t
(&
p_Vid
->
p_fç¡_me
->
£¬ch_£tup_dÚe
 [
li¡
][0], 0,…_Vid->
max_num_»ã»nûs
 * ());

188 
	}
}

196 
	$upd©e_fuÎ_£¬ch_Ïrge_blocks
 (
MEFuÎFa¡
 *
p_fç¡_me
, 
li¡
, 
»fšdex
, 
max_pos
)

198 
	#ADD_UP_BLOCKS
(è
_o
=*
_bo
; 
_i
=*
_bi
; 
_j
=*
_bj
; 
pos
=0;pos<
max_pos
;pos++è_o[pos] = _i[pos] + _j[pos];

	)

199 
	#INCREMENT
(
šc
è
_bo
+=šc; 
_bi
+=šc; 
_bj
+=šc;

	)

200 
di¡³l
 *****
BlockSAD
 = 
p_fç¡_me
->BlockSAD;

202 
pos
;

203 
di¡³l
 **
_bo
, **
_bi
, **
_bj
;

204 
di¡³l
 *
_o
, *
_i
, *
_j
;

207 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][6];

208 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][7];

209 
_bj
 = 
_bi
 + 4;

210 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

211 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

212 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

213 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(5);

214 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

215 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

216 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(1);

217 
	`ADD_UP_BLOCKS
();

220 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][5];

221 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][7];

222 
_bj
 = 
_bi
 + 1;

223 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

224 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

225 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

226 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

227 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

228 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

229 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

230 
	`ADD_UP_BLOCKS
();

233 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][4];

234 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][6];

235 
_bj
 = 
_bi
 + 1;

236 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

237 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(6);

238 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

239 
	`ADD_UP_BLOCKS
();

242 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][3];

243 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][4];

244 
_bj
 = 
_bi
 + 8;

245 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(2);

246 
	`ADD_UP_BLOCKS
();

249 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][2];

250 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][4];

251 
_bj
 = 
_bi
 + 2;

252 
	`ADD_UP_BLOCKS
(); 
	`INCREMENT
(8);

253 
	`ADD_UP_BLOCKS
();

256 
_bo
 = 
BlockSAD
[
li¡
][
»fšdex
][1];

257 
_bi
 = 
BlockSAD
[
li¡
][
»fšdex
][3];

258 
_bj
 = 
_bi
 + 2;

259 
	`ADD_UP_BLOCKS
();

260 
	}
}

269 
	$£tup_ç¡_fuÎ_£¬ch
 (
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
li¡
)

271 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

272 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

273 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

274 (*
di¡_m‘hod
è(
x
èð
p_IÅ
->
MEE¼ÜM‘ric
[0] ? 
Ÿbs2
 : 
Ÿbs
;

275 #ià(
JM_MEM_DISTORTION
)

276 * 
img³l_di¡
 = 
p_IÅ
->
MEE¼ÜM‘ric
[0] ? 
p_Vid
->
img³l_quad
 :…_Vid->
img³l_abs
;

278 
MÙiÚVeùÜ
 
pmv
;

279 
img³l
 
Üig_³ls
[768];

280 
img³l
 *
¤ýŒ
 = 
Üig_³ls
, *
»åŒ
;

281 
k
, 
x
, 
y
;

282 
MÙiÚVeùÜ
 
ÿnd
, 
off£t
;

283 
»f_x
, 
»f_y
, 
pos
, 
bšdex
, 
blky
;

284 
di¡blk
 
LšeSadBlk0
, 
LšeSadBlk1
, 
LšeSadBlk2
, 
LšeSadBlk3
;

285 
Pix–Pos
 
block
[4];

286 
MEFuÎFa¡
 *
p_me_fç¡
 = 
p_Vid
->
p_fç¡_me
;

289 
»f
 = 
mv_block
->
»f_idx
;

290 
di¡³l
** 
block_§d
 = 
p_me_fç¡
->
BlockSAD
[
li¡
][
»f
][7];

291 
£¬ch_¿nge
 = 
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
][
»f
];

292 
max_pos
 = (2*
£¬ch_¿nge
+1) * (2*search_range+1);

294 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

295 
­¶y_weights
 = ( (
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
))) ||

296 (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
))è&& 
p_IÅ
->
U£Weigh‹dReã»nûME
;

297 
weigh‹d_³l
;

298 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
li¡
+
li¡_off£t
][
»f
];

300 
wp_luma_round
 = 0;

301 
luma_log_weight_d’om
 = 5;

302 
chroma_log_weight_d’om
 = 5;

303 
wp_chroma_round
 = 0;

304 
weight_luma
 = 
mv_block
->weight_luma, 
weight_ü
[2];

305 
off£t_luma
 = 
mv_block
->off£t_luma, 
off£t_ü
[2];

306 
£¬ch_¿nge
 <<= 2;

309 
	`g‘_ÃighbÜs
(
cu¼MB
, 
block
, 0, 0, 16);

310 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
block
, &
pmv
, 
»f
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡
, 0, 0, 16, 16);

312 #ià(
JM_INT_DIVIDE
)

313 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = ((
pmv
.mv_x + 2) >> 2) * 4;

314 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = ((
pmv
.mv_y + 2) >> 2) * 4;

316 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (
pmv
.mv_x / 4) * 4;

317 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (
pmv
.mv_y / 4) * 4;

319 ià(!
p_IÅ
->
rdÝt
)

322 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (è
	`iCl3
(-
£¬ch_¿nge
, search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_x);

323 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (è
	`iCl3
(-
£¬ch_¿nge
, search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_y);

326 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (è
	`iCl3
Õ_Vid->
MaxHmvR
[4] + 
£¬ch_¿nge
,…_Vid->MaxHmvR[5] - search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_x);

327 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (è
	`iCl3
Õ_Vid->
MaxVmvR
[4] + 
£¬ch_¿nge
,…_Vid->MaxVmvR[5] - search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_y);

329 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”_·dded
[
li¡
][
»f
] = 
	`·d_MVs
Õ_Vid->p_fç¡_me->
£¬ch_ûÁ”
[li¡][»f], 
mv_block
);

331 
off£t
 = 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”_·dded
[
li¡
][
»f
];

333 
y
 = 
cu¼MB
->
Ýix_y
; y < cu¼MB->Ýix_y + 
MB_BLOCK_SIZE
; y++)

335 
	`memýy
(
¤ýŒ
, &
p_Vid
->
pCurImg
[
y
][
cu¼MB
->
pix_x
], 
MB_BLOCK_SIZE
 * (
img³l
));

336 
¤ýŒ
 +ð
MB_BLOCK_SIZE
;

339 iàÐ
mv_block
->
ChromaMEEÇbË
)

341 
k
 = 1; k < 3; k++)

343 
y
 = 
cu¼MB
->
Ýix_c_y
; y < cu¼MB->Ýix_c_y + 
p_Vid
->
mb_ü_size_y
; y++)

345 
	`memýy
(
¤ýŒ
, &
p_Vid
->
pImgOrg
[
k
][
y
][
cu¼MB
->
pix_c_x
],…_Vid->
mb_ü_size_x
 * (
img³l
));

346 
¤ýŒ
 +ð
p_Vid
->
mb_ü_size_x
;

353 ià(!
p_IÅ
->
rdÝt
)

355 
»f_x
 = 
mv_block
->
pos_x_·dded
 - 
off£t
.
mv_x
;

356 
»f_y
 = 
mv_block
->
pos_y_·dded
 - 
off£t
.
mv_y
;

358 
pos
 = 0;…o < 
max_pos
;…os++)

360 ià(
»f_x
 =ð
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].
mv_x
 && 
»f_y
 =ðp_Vid->¥œ®_q³l_£¬ch[pos].
mv_y
)

362 
p_me_fç¡
->
pos_00
[
li¡
][
»f
] = 
pos
;

369 ià(
­¶y_weights
)

371 
weight_luma
 = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][0];

372 
off£t_luma
 = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][0];

373 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

374 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

375 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

376 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

378 ià(
mv_block
->
ChromaMEEÇbË
)

380 
weight_ü
[0] = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][1];

381 
weight_ü
[1] = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][2];

382 
off£t_ü
[0] = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][1];

383 
off£t_ü
[1] = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][2];

386 
pos
 = 0;…o < 
max_pos
;…os++)

388 
ÿnd
 = 
	`add_MVs
(
off£t
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
]);

390 
¤ýŒ
 = 
Üig_³ls
;

391 
bšdex
 = 0;

393 
»åŒ
 = 
	`UMVLše4X
 (
»f_piùu»
, 
ÿnd
.
mv_y
, cªd.
mv_x
);

395 
blky
 = 0; blky < 4; blky++)

397 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

399 
y
 = 0; y < 4; y++)

401 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

402 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

403 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

404 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

405 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

406 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

407 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

408 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

409 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

410 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

411 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

412 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

413 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

414 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

415 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

416 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

417 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

418 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

419 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

420 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

421 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

422 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

423 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

424 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

425 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

426 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

427 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

428 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

429 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

430 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

431 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

432 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

433 
»åŒ
 +ð
p_Vid
->
·dded_size_x
 - 
MB_BLOCK_SIZE
;

435 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk0
;

436 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk1
;

437 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk2
;

438 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk3
;

441 ià(
mv_block
->
ChromaMEEÇbË
)

443 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

444 
k
 = 0; k < 2; k ++)

446 
bšdex
 = 0;

448 
»åŒ
 = 
	`UMVLše8X_chroma
 (
»f_piùu»
, 
k
+1, 
ÿnd
.
mv_y
, cªd.
mv_x
);

449 
blky
 = 0; blky < 4; blky++)

451 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

453 
y
 = 0; y < 
p_Vid
->
mb_ü_size_y
; y+=
BLOCK_SIZE
)

455 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

457 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

458 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

460 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

462 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

463 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

465 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

467 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

468 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

470 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

472 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

473 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

475 
»åŒ
 +ð
p_Vid
->
ü_·dded_size_x
 -…_Vid->
mb_ü_size_x
;

477 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk0
);

478 ++
bšdex
;

479 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk1
);

480 ++
bšdex
;

481 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk2
);

482 ++
bšdex
;

483 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk3
);

484 ++
bšdex
;

492 
pos
 = 0;…o < 
max_pos
;…os++)

494 
ÿnd
 = 
	`add_MVs
(
off£t
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
]);

495 
¤ýŒ
 = 
Üig_³ls
;

496 
bšdex
 = 0;

498 
»åŒ
 = 
	`UMVLše4X
 (
»f_piùu»
, 
ÿnd
.
mv_y
, cªd.
mv_x
);

500 
blky
 = 0; blky < 4; blky++)

502 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

504 
y
 = 0; y < 4; y++)

506 #ià(
JM_MEM_DISTORTION
)

508 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

509 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

510 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

511 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

513 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

514 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

515 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

516 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

518 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

519 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

520 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

521 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

523 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

524 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

525 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

526 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

529 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

530 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

531 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

532 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

534 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

535 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

536 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

537 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

539 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

540 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

541 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

542 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

544 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

545 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

546 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

547 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

550 
»åŒ
 +ð
p_Vid
->
·dded_size_x
 - 
MB_BLOCK_SIZE
;

552 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk0
;

553 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk1
;

554 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk2
;

555 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk3
;

558 ià(
mv_block
->
ChromaMEEÇbË
)

560 
k
 = 0; k < 2; k ++)

562 
bšdex
 = 0;

564 
»åŒ
 = 
	`UMVLše8X_chroma
 (
»f_piùu»
, 
k
+1, 
ÿnd
.
mv_y
, cªd.
mv_x
);

565 
blky
 = 0; blky < 4; blky++)

567 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

569 
y
 = 0; y < 
p_Vid
->
mb_ü_size_y
; y+=
BLOCK_SIZE
)

571 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

573 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

575 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

577 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

579 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

581 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

583 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

585 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

587 
»åŒ
 +ð
p_Vid
->
ü_·dded_size_x
 -…_Vid->
mb_ü_size_x
;

589 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk0
);

590 ++
bšdex
;

591 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk1
);

592 ++
bšdex
;

593 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk2
);

594 ++
bšdex
;

595 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk3
);

596 ++
bšdex
;

604 
	`upd©e_fuÎ_£¬ch_Ïrge_blocks
 (
p_Vid
->
p_fç¡_me
, 
li¡
, 
»f
, 
max_pos
);

607 
p_Vid
->
p_fç¡_me
->
£¬ch_£tup_dÚe
[
li¡
][
»f
] = 1;

608 
	}
}

617 
di¡blk


618 
	$ç¡_fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

619 
MÙiÚVeùÜ
 *
´ed_mv
,

620 
MEBlock
 *
mv_block
,

621 
di¡blk
 
mš_mco¡
,

622 
Ïmbda_çùÜ


625 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

626 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

627 
MEFuÎFa¡
 *
p_me_fç¡
 = 
p_Vid
->
p_fç¡_me
;

628 
di¡blk
 
mco¡
;

629 
pos
;

630 
£¬ch_¿nge
 = 
	`imax
(
mv_block
->
£¬chRªge
.
max_x
, mv_block->£¬chRªge.
max_y
) >> 2;

631 
max_pos
 = (2*
£¬ch_¿nge
+1)*(2*search_range+1);

632 
be¡_pos
 = 0;

633 
block_šdex
;

634 
di¡³l
* 
block_§d
;

635 
li¡
 = 
mv_block
->list;

636 
»f
 = 
mv_block
->
»f_idx
;

637 
MÙiÚVeùÜ
 
ÿnd
 = {0, 0}, *
off£t
 = &
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
];

638 
max_mvd
 = 
p_Vid
->max_mvd-1;

640 
block_šdex
 = (
mv_block
->
block_y
 << 2è+ (mv_block->
block_x
);

641 
block_§d
 = 
p_me_fç¡
->
BlockSAD
[
li¡
][
»f
][
mv_block
->
blockty³
][
block_šdex
];

644 ià(!
p_Vid
->
p_fç¡_me
->
£¬ch_£tup_dÚe
[
li¡
][
»f
])

646 
cu¼MB
->
	`p_S‘upFa¡FuÎP–S—rch
 (cu¼MB, 
mv_block
, 
li¡
);

650 ià(!
p_IÅ
->
rdÝt
 && 
	`G‘MaxMVD
(&
ÿnd
, 
´ed_mv
)<
max_mvd
)

652 
mš_mco¡
 = 
block_§d
[
p_me_fç¡
->
pos_00
[
li¡
][
»f
]];

653 
	`up_sÿË
(&
mš_mco¡
);

654 
mš_mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

656 
be¡_pos
 = 
p_me_fç¡
->
pos_00
[
li¡
][
»f
];

660 
pos
=0;…os<
max_pos
;…os++, 
block_§d
++)

662 
mco¡
 = 
	`di¡_sÿË
(*
block_§d
);

663 
ÿnd
 = 
	`add_MVs
 (
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
], 
off£t
);

671 ià(
mco¡
 < 
mš_mco¡
 && 
	`G‘MaxMVD
(&
ÿnd
, 
´ed_mv
)<
max_mvd
)

674 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

677 ià(
mco¡
 < 
mš_mco¡
)

679 
mš_mco¡
 = 
mco¡
;

680 
be¡_pos
 = 
pos
;

686 
mv_block
->
mv
[
li¡
] = 
	`add_MVs
 (
p_Vid
->
¥œ®_q³l_£¬ch
[
be¡_pos
], 
off£t
);

688  
mš_mco¡
;

689 
	}
}

	@lencod/src/me_fullfast_otf.c

13 
	~"cÚŒibutÜs.h
"

14 
	~<lim™s.h
>

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"mem®loc.h
"

19 
	~"mb_acûss.h
"

21 
	~"me_di¡ÜtiÚ.h
"

22 
	~"g‘_block_Ùf.h
"

24 
	~"me_fuÎ£¬ch.h
"

25 
	~"me_fuÎç¡.h
"

26 
	~"me_fuÎç¡_Ùf.h
"

27 
	~"cÚfÜmªû.h
"

28 
	~"mv_£¬ch.h
"

36 
	$S‘upFa¡FuÎP–S—rch_Ùf
 (
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
li¡
)

38 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

39 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

40 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

41 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

42 (*
di¡_m‘hod
è(
x
èð
p_IÅ
->
MEE¼ÜM‘ric
[0 + (Ð
p_Vid
->
dpb_Ïy”_id
 >ð1 ) ? 3 : 0)] ? 
Ÿbs2
 : 
Ÿbs
;

43 #ià(
JM_MEM_DISTORTION
)

44 * 
img³l_di¡
 = 
p_IÅ
->
MEE¼ÜM‘ric
[0 + 
p_Vid
->
Ïy”_off£t
] ?…_Vid->
img³l_quad
 :…_Vid->
img³l_abs
;

46 
MÙiÚVeùÜ
 
pmv
;

47 
img³l
 
Üig_³ls
[768];

48 
img³l
 
d©a
[
MB_PIXELS
] ;

49 
tmp_d©a
[ (
MB_BLOCK_SIZE
+5)*(MB_BLOCK_SIZE+5) ] ;

50 
img³l
 *
¤ýŒ
 = 
Üig_³ls
, *
»åŒ
 = 
d©a
 ;

51 
k
, 
x
, 
y
;

52 
MÙiÚVeùÜ
 
ÿnd
, 
off£t
;

53 
»f_x
, 
»f_y
, 
pos
, 
bšdex
, 
blky
;

54 
di¡blk
 
LšeSadBlk0
, 
LšeSadBlk1
, 
LšeSadBlk2
, 
LšeSadBlk3
;

55 
Pix–Pos
 
block
[4];

56 
MEFuÎFa¡
 *
p_me_fç¡
 = 
p_Vid
->
p_fç¡_me
;

59 
»f
 = 
mv_block
->
»f_idx
;

60 
di¡³l
** 
block_§d
 = 
p_me_fç¡
->
BlockSAD
[
li¡
][
»f
][7];

61 
£¬ch_¿nge
 = 
p_me_fç¡
->
max_£¬ch_¿nge
[
li¡
][
»f
];

62 
max_pos
 = (2*
£¬ch_¿nge
+1) * (2*search_range+1);

64 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

65 
­¶y_weights
 = ( (
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
))) ||

66 (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
))è&& 
p_IÅ
->
U£Weigh‹dReã»nûME
;

67 
weigh‹d_³l
;

68 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
li¡
+
li¡_off£t
][
»f
];

70 
wp_luma_round
 = 0;

71 
luma_log_weight_d’om
 = 5;

72 
chroma_log_weight_d’om
 = 5;

73 
wp_chroma_round
 = 0;

74 
weight_luma
 = 
mv_block
->weight_luma, 
weight_ü
[2];

75 
off£t_luma
 = 
mv_block
->off£t_luma, 
off£t_ü
[2];

76 
£¬ch_¿nge
 <<= 2;

79 
	`g‘_ÃighbÜs
(
cu¼MB
, 
block
, 0, 0, 16);

80 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
block
, &
pmv
, 
»f
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡
, 0, 0, 16, 16);

82 #ià(
JM_INT_DIVIDE
)

83 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = ((
pmv
.mv_x + 2) >> 2) * 4;

84 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = ((
pmv
.mv_y + 2) >> 2) * 4;

86 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (
pmv
.mv_x / 4) * 4;

87 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (
pmv
.mv_y / 4) * 4;

89 ià(!
p_IÅ
->
rdÝt
)

92 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (è
	`iCl3
(-
£¬ch_¿nge
, search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_x);

93 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (è
	`iCl3
(-
£¬ch_¿nge
, search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_y);

96 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_x
 = (è
	`iCl3
Õ_Vid->
MaxHmvR
[4] + 
£¬ch_¿nge
,…_Vid->MaxHmvR[5] - search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_x);

97 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”
[
li¡
][
»f
].
mv_y
 = (è
	`iCl3
Õ_Vid->
MaxVmvR
[4] + 
£¬ch_¿nge
,…_Vid->MaxVmvR[5] - search_range,…_Vid->p_ffast_me->search_center[list][ref].mv_y);

99 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”_·dded
[
li¡
][
»f
] = 
	`·d_MVs
Õ_Vid->p_fç¡_me->
£¬ch_ûÁ”
[li¡][»f], 
mv_block
);

101 
off£t
 = 
p_Vid
->
p_fç¡_me
->
£¬ch_ûÁ”_·dded
[
li¡
][
»f
];

103 
y
 = 
cu¼MB
->
Ýix_y
; y < cu¼MB->Ýix_y + 
MB_BLOCK_SIZE
; y++)

105 
	`memýy
(
¤ýŒ
, &
p_Vid
->
pCurImg
[
y
][
cu¼MB
->
pix_x
], 
MB_BLOCK_SIZE
 * (
img³l
));

106 
¤ýŒ
 +ð
MB_BLOCK_SIZE
;

109 iàÐ
mv_block
->
ChromaMEEÇbË
)

111 
k
 = 1; k < 3; k++)

113 
y
 = 
cu¼MB
->
Ýix_c_y
; y < cu¼MB->Ýix_c_y + 
p_Vid
->
mb_ü_size_y
; y++)

115 
	`memýy
(
¤ýŒ
, &
p_Vid
->
pImgOrg
[
k
][
y
][
cu¼MB
->
pix_c_x
],…_Vid->
mb_ü_size_x
 * (
img³l
));

116 
¤ýŒ
 +ð
p_Vid
->
mb_ü_size_x
;

123 ià(!
p_IÅ
->
rdÝt
)

125 
»f_x
 = 
mv_block
->
pos_x_·dded
 - 
off£t
.
mv_x
;

126 
»f_y
 = 
mv_block
->
pos_y_·dded
 - 
off£t
.
mv_y
;

128 
pos
 = 0;…o < 
max_pos
;…os++)

130 ià(
»f_x
 =ð
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].
mv_x
 && 
»f_y
 =ðp_Vid->¥œ®_q³l_£¬ch[pos].
mv_y
)

132 
p_me_fç¡
->
pos_00
[
li¡
][
»f
] = 
pos
;

139 ià(
­¶y_weights
)

141 
weight_luma
 = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][0];

142 
off£t_luma
 = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][0];

143 
wp_luma_round
 = 
cu¼Sliû
->wp_luma_round;

144 
luma_log_weight_d’om
 = 
cu¼Sliû
->luma_log_weight_denom;

145 
chroma_log_weight_d’om
 = 
cu¼Sliû
->chroma_log_weight_denom;

146 
wp_chroma_round
 = 
cu¼Sliû
->wp_chroma_round;

148 ià(
mv_block
->
ChromaMEEÇbË
)

150 
weight_ü
[0] = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][1];

151 
weight_ü
[1] = 
cu¼Sliû
->
wp_weight
[
li¡
 + 
li¡_off£t
][
»f
][2];

152 
off£t_ü
[0] = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][1];

153 
off£t_ü
[1] = 
cu¼Sliû
->
wp_off£t
[
li¡
 + 
li¡_off£t
][
»f
][2];

156 
pos
 = 0;…o < 
max_pos
;…os++)

158 
ÿnd
 = 
	`add_MVs
(
off£t
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
]);

160 
¤ýŒ
 = 
Üig_³ls
;

161 
bšdex
 = 0;

162 
»åŒ
 = 
d©a
 ;

163 
p_Dpb
->
	`pf_g‘_block_luma
 ( 
p_Vid
, 
»åŒ
, 
tmp_d©a
, 
ÿnd
.
mv_x
, cªd.
mv_y
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE, 
»f_piùu»
, 0 ) ;

165 
blky
 = 0; blky < 4; blky++)

167 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

169 
y
 = 0; y < 4; y++)

171 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

172 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

173 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

174 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

175 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

176 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

177 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

178 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

179 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

180 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

181 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

182 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

183 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

184 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

185 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

186 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

187 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

188 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

189 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

190 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

191 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

192 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

193 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

194 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

195 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

196 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

197 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

198 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

199 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

200 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

201 
weigh‹d_³l
 = 
	`iCl1
Ð
p_Vid
->
max_img³l_v®ue
, ((
weight_luma
 * *
»åŒ
++ + 
wp_luma_round
è>> 
luma_log_weight_d’om
è+ 
off£t_luma
);

202 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

204 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk0
;

205 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk1
;

206 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk2
;

207 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk3
;

210 ià(
mv_block
->
ChromaMEEÇbË
)

212 
max_img³l_v®ue_uv
 = 
p_Vid
->
max_³l_v®ue_comp
[1];

214 
k
 = 0; k < 2; k ++)

216 
bšdex
 = 0;

217 
»åŒ
 = 
d©a
 ;

218 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»åŒ
, 
tmp_d©a
, 
ÿnd
.
mv_x
, cªd.
mv_y
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
, 
»f_piùu»
, 
k
+1 );

220 
blky
 = 0; blky < 4; blky++)

222 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

224 
y
 = 0; y < 
p_Vid
->
mb_ü_size_y
; y+=
BLOCK_SIZE
)

226 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

228 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

229 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

231 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

233 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

234 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

236 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

238 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

239 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

241 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

243 
weigh‹d_³l
 = 
	`iCl1
Ð
max_img³l_v®ue_uv
, ((
weight_ü
[
k
] * *
»åŒ
++ + 
wp_chroma_round
è>> 
chroma_log_weight_d’om
è+ 
off£t_ü
[k]);

244 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (
weigh‹d_³l
 - *
¤ýŒ
++);

247 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk0
);

248 ++
bšdex
;

249 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk1
);

250 ++
bšdex
;

251 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk2
);

252 ++
bšdex
;

253 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk3
);

254 ++
bšdex
;

262 
pos
 = 0;…o < 
max_pos
;…os++)

264 
ÿnd
 = 
	`add_MVs
(
off£t
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
]);

265 
¤ýŒ
 = 
Üig_³ls
;

266 
bšdex
 = 0;

268 
»åŒ
 = 
d©a
;

269 
p_Dpb
->
	`pf_g‘_block_luma
Ð
p_Vid
, 
»åŒ
, 
tmp_d©a
, 
ÿnd
.
mv_x
, cªd.
mv_y
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE, 
»f_piùu»
, 0 ) ;

271 
blky
 = 0; blky < 4; blky++)

273 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

275 
y
 = 0; y < 4; y++)

277 #ià(
JM_MEM_DISTORTION
)

279 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

280 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

281 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

282 
LšeSadBlk0
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

284 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

285 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

286 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

287 
LšeSadBlk1
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

289 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

290 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

291 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

292 
LšeSadBlk2
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

294 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

295 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

296 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

297 
LšeSadBlk3
 +ð
img³l_di¡
[ *
»åŒ
++ - *
¤ýŒ
++ ];

300 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

301 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

302 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

303 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

305 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

306 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

307 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

308 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

310 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

311 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

312 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

313 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

315 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

316 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

317 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

318 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

321 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk0
;

322 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk1
;

323 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk2
;

324 
block_§d
[
bšdex
++][
pos
] = (
di¡³l
è
LšeSadBlk3
;

327 ià(
mv_block
->
ChromaMEEÇbË
)

329 
k
 = 0; k < 2; k ++)

331 
bšdex
 = 0;

333 
»åŒ
 = 
d©a
 ;

334 
p_Dpb
->
pf_g‘_block_chroma
[
OTF_ME
]Ð
p_Vid
, 
»åŒ
, 
tmp_d©a
, 
ÿnd
.
mv_x
, cªd.
mv_y
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
, 
»f_piùu»
, 
k
+1 );

336 
blky
 = 0; blky < 4; blky++)

338 
LšeSadBlk0
 = 
LšeSadBlk1
 = 
LšeSadBlk2
 = 
LšeSadBlk3
 = 0;

340 
y
 = 0; y < 
p_Vid
->
mb_ü_size_y
; y+=
BLOCK_SIZE
)

342 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

344 
LšeSadBlk0
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

346 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

348 
LšeSadBlk1
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

350 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

352 
LšeSadBlk2
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

354 
x
 = 0; x < 
p_Vid
->
mb_ü_size_x
; x +ð
BLOCK_SIZE
)

356 
LšeSadBlk3
 +ð
	`di¡_m‘hod
 (*
»åŒ
++ - *
¤ýŒ
++);

359 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk0
);

360 ++
bšdex
;

361 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk1
);

362 ++
bšdex
;

363 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk2
);

364 ++
bšdex
;

365 
block_§d
[
bšdex
][
pos
] = block_§d[bšdex][pos] + ((
di¡³l
è
LšeSadBlk3
);

366 ++
bšdex
;

374 
	`upd©e_fuÎ_£¬ch_Ïrge_blocks
 (
p_Vid
->
p_fç¡_me
, 
li¡
, 
»f
, 
max_pos
);

377 
p_Vid
->
p_fç¡_me
->
£¬ch_£tup_dÚe
[
li¡
][
»f
] = 1;

378 
	}
}

	@lencod/src/me_fullsearch.c

18 
	~"cÚŒibutÜs.h
"

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mem®loc.h
"

24 
	~"mb_acûss.h
"

25 
	~"»fbuf.h
"

26 
	~"maüoblock.h
"

27 
	~"me_di¡ÜtiÚ.h
"

28 
	~"me_fuÎ£¬ch.h
"

29 
	~"mv_£¬ch.h
"

38 
di¡blk


39 
	$fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
 ,

40 
MÙiÚVeùÜ
 *
´ed_mv
,

41 
MEBlock
 *
mv_block
,

42 
di¡blk
 
mš_mco¡
,

43 
Ïmbda_çùÜ


46 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

47 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

48 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

49 
£¬ch_¿nge
 = 
	`imš
(
mv_block
->
£¬chRªge
.
max_x
, mv_block->£¬chRªge.
max_y
)>> 2;

50 
di¡blk
 
mco¡
;

51 
pos
;

52 
MÙiÚVeùÜ
 
ÿnd
, 
ûÁ”
, 
´ed
;

53 
»f
 = 
mv_block
->
»f_idx
;

55 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
mv_block
->
li¡
+
cu¼MB
->
li¡_off£t
][
»f
];

57 
be¡_pos
 = 0;

58 
max_pos
 = (2*
£¬ch_¿nge
+1)*(2*search_range+1);

60 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[(èmv_block->
li¡
];

61 
check_fÜ_00
 = (
mv_block
->
blockty³
==1 && !
p_IÅ
->
rdÝt
 && 
cu¼Sliû
->
¦iû_ty³
!=
B_SLICE
 && 
»f
==0);

62 
ûÁ”
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
mv
->mv_x;

63 
ûÁ”
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
mv
->mv_y;

64 
´ed
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
´ed_mv
->mv_x;

65 
´ed
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
´ed_mv
->mv_y;

69 
pos
=0;…os<
max_pos
;…os++)

72 
ÿnd
.
mv_x
 = 
ûÁ”
.mv_x + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_x;

73 
ÿnd
.
mv_y
 = 
ûÁ”
.mv_y + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_y;

76 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

78 ià(
check_fÜ_00
 && 
ÿnd
.
mv_x
 =ð
mv_block
->
pos_x_·dded
 && cªd.
mv_y
 =ðmv_block->
pos_y_·dded
)

80 
di¡blk
 
tmp
 = 
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 16);

81 
mco¡
 = mco¡ > 
tmp
? (mcost-tmp): 0;

83 ià(
mco¡
 >ð
mš_mco¡
) ;

86 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
(
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

89 ià(
mco¡
 < 
mš_mco¡
)

91 
be¡_pos
 = 
pos
;

92 
mš_mco¡
 = 
mco¡
;

98 ià(
be¡_pos
)

100 
	`add_mvs
(
mv
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
be¡_pos
]);

102  
mš_mco¡
;

103 
	}
}

111 
di¡blk


112 
	$fuÎ_£¬ch_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

113 
li¡
,

114 
MÙiÚVeùÜ
 *
´ed_mv1
,

115 
MÙiÚVeùÜ
 *
´ed_mv2
,

116 
MÙiÚVeùÜ
 *
mv1
,

117 
MÙiÚVeùÜ
 *
mv2
,

118 
MEBlock
 *
mv_block
,

119 
£¬ch_¿nge
,

120 
di¡blk
 
mš_mco¡
,

121 
Ïmbda_çùÜ


124 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

125 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

126 
»f
 = 
mv_block
->
»f_idx
;

127 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
»f
];

128 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
cu¼MB
->
li¡_off£t
][0];

129 
di¡blk
 
mco¡
;

130 
pos
;

132 
be¡_pos
 = 0;

133 
max_pos
 = (2 * (
£¬ch_¿nge
 >> 2) +1)*(2 * (search_range >> 2) + 1);

135 
MÙiÚVeùÜ
 
ûÁ”1
, 
ûÁ”2
, 
ÿnd
, 
´ed1
, 
´ed2
;

136 
´ed1
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
´ed_mv1
->mv_x;

137 
´ed1
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
´ed_mv1
->mv_y;

138 
´ed2
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
´ed_mv2
->mv_x;

139 
´ed2
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
´ed_mv2
->mv_y;

140 
ûÁ”1
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
mv1
->mv_x;

141 
ûÁ”1
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
mv1
->mv_y;

142 
ûÁ”2
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
mv2
->mv_x;

143 
ûÁ”2
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
mv2
->mv_y;

147 
pos
=0;…os<
max_pos
;…os++)

150 
ÿnd
.
mv_x
 = 
ûÁ”1
.mv_x + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_x;

151 
ÿnd
.
mv_y
 = 
ûÁ”1
.mv_y + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_y;

154 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed1
);

155 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ûÁ”2
, &
´ed2
);

157 ià(
mco¡
 >ð
mš_mco¡
) ;

160 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mcost,

161 &
ÿnd
, &
ûÁ”2
);

164 ià(
mco¡
 < 
mš_mco¡
)

166 
be¡_pos
 = 
pos
;

167 
mš_mco¡
 = 
mco¡
;

172 ià(
be¡_pos
)

174 
	`add_mvs
(
mv1
, &
p_Vid
->
¥œ®_q³l_£¬ch
[
be¡_pos
]);

176  
mš_mco¡
;

177 
	}
}

185 
di¡blk


186 
	$sub_³l_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

187 
MÙiÚVeùÜ
 *
´ed
,

188 
MEBlock
 *
mv_block
,

189 
di¡blk
 
mš_mco¡
,

190 * 
Ïmbda


193 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

194 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

195 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

196 
di¡blk
 
mco¡
;

197 
pos
, 
be¡_pos
;

199 
MÙiÚVeùÜ
 
ÿnd
;

200 
li¡
 = 
mv_block
->list;

201 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

202 
»f
 = 
mv_block
->
»f_idx
;

203 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

205 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

207 
check_pos™iÚ0
 = (!
p_IÅ
->
rdÝt
 && 
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
 && 
»f
==0 && 
mv_block
->
blockty³
==1 && 
mv
->
mv_x
 =ð0 && mv->
mv_y
 ==0);

209 
max_pos2
 = ( !
p_Vid
->
¡¬t_me_»fšem’t_hp
 ? 
	`imax
(1, 
mv_block
->
£¬ch_pos2
) : mv_block->search_pos2);

210 
MÙiÚVeùÜ
 
cmv
;

212 
Ïmbda_çùÜ
 = 
Ïmbda
[
H_PEL
];

221 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_hp
;…o < 
max_pos2
;…os++)

223 
ÿnd
.
mv_x
 = 
mv
->mv_x + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_x;

224 
ÿnd
.
mv_y
 = 
mv
->mv_y + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_y;

227 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed
);

230 ià(
mco¡
 >ð
mš_mco¡
) ;

232 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

234 
mco¡
 +ð
mv_block
->
	`compu‹P»dHP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
);

236 ià(
pos
==0 && 
check_pos™iÚ0
)

238 
mco¡
 -ð
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 16);

241 ià(
mco¡
 < 
mš_mco¡
)

243 
mš_mco¡
 = 
mco¡
;

244 
be¡_pos
 = 
pos
;

247 ià(
be¡_pos
)

249 
mv
->
mv_x
 = mv->mv_x + 
p_Vid
->
¥œ®_h³l_£¬ch
[
be¡_pos
].mv_x;

250 
mv
->
mv_y
 = mv->mv_y + 
p_Vid
->
¥œ®_h³l_£¬ch
[
be¡_pos
].mv_y;

252 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

253 
mš_mco¡
 = 
DISTBLK_MAX
;

260 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

263 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_qp
;…o < 
mv_block
->
£¬ch_pos4
;…os++)

265 
ÿnd
.
mv_x
 = 
mv
->mv_x + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_x;

266 
ÿnd
.
mv_y
 = 
mv
->mv_y + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_y;

269 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed
);

271 ià(
mco¡
 >ð
mš_mco¡
) ;

273 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

275 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
);

276 ià(
mco¡
 < 
mš_mco¡
)

278 
mš_mco¡
 = 
mco¡
;

279 
be¡_pos
 = 
pos
;

282 ià(
be¡_pos
)

284 
	`add_mvs
(
mv
, &
p_Vid
->
¥œ®_£¬ch
[
be¡_pos
]);

288  
mš_mco¡
;

289 
	}
}

298 
di¡blk


299 
	$sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

300 
MEBlock
 *
mv_block
,

301 
li¡
,

302 
MÙiÚVeùÜ
 *
´ed_mv1
,

303 
MÙiÚVeùÜ
 *
´ed_mv2
,

304 
MÙiÚVeùÜ
 *
mv1
,

305 
MÙiÚVeùÜ
 *
mv2
,

306 
di¡blk
 
mš_mco¡
,

307 * 
Ïmbda


310 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

311 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

312 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

313 
di¡blk
 
mco¡
;

314 
pos
, 
be¡_pos
;

315 
MÙiÚVeùÜ
 
ÿnd
;

316 
¡¬t_hp
 = (
mš_mco¡
 =ð
DISTBLK_MAX
è? 0 : 
p_Vid
->
¡¬t_me_»fšem’t_hp
;

317 
max_pos2
 = ( !
p_Vid
->
¡¬t_me_»fšem’t_hp
 ? 
	`imax
(1, 
mv_block
->
£¬ch_pos2
) : mv_block->search_pos2);

319 
MÙiÚVeùÜ
 
cmv
, 
smv
 = 
	`·d_MVs
(*
mv2
, 
mv_block
);

320 
»f
 = 
mv_block
->
»f_idx
;

322 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
li¡_off£t
][
»f
];

323 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
li¡_off£t
][0];

325 
Ïmbda_çùÜ
 = 
Ïmbda
[
H_PEL
];

334 
be¡_pos
 = 0, 
pos
 = 
¡¬t_hp
;…o < 
max_pos2
;…os++)

336 
ÿnd
.
mv_x
 = 
mv1
->mv_x + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_x;

337 
ÿnd
.
mv_y
 = 
mv1
->mv_y + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_y;

340 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv1
);

341 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, 
mv2
, 
´ed_mv2
);

343 ià(
mco¡
 >ð
mš_mco¡
) ;

345 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

346 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dHP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
, &
smv
);

348 ià(
mco¡
 < 
mš_mco¡
)

350 
mš_mco¡
 = 
mco¡
;

351 
be¡_pos
 = 
pos
;

355 ià(
be¡_pos
)

357 
	`add_mvs
(
mv1
, &
p_Vid
->
¥œ®_h³l_£¬ch
[
be¡_pos
]);

365 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

366 
mš_mco¡
 = 
DISTBLK_MAX
;

368 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

371 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_qp
;…o < 
mv_block
->
£¬ch_pos4
;…os++)

373 
ÿnd
.
mv_x
 = 
mv1
->mv_x + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_x;

374 
ÿnd
.
mv_y
 = 
mv1
->mv_y + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_y;

377 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv1
);

378 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, 
mv2
, 
´ed_mv2
);

380 ià(
mco¡
 >ð
mš_mco¡
) ;

382 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

383 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dQP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
, &
smv
);

385 ià(
mco¡
 < 
mš_mco¡
)

387 
mš_mco¡
 = 
mco¡
;

388 
be¡_pos
 = 
pos
;

393 ià(
be¡_pos
)

395 
	`add_mvs
(
mv1
, &
p_Vid
->
¥œ®_£¬ch
[
be¡_pos
]);

399  
mš_mco¡
;

400 
	}
}

408 
di¡blk


409 
	$fuÎ_sub_³l_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

410 
MÙiÚVeùÜ
 *
´ed
,

411 
MEBlock
 *
mv_block
,

412 
di¡blk
 
mš_mco¡
,

413 * 
Ïmbda


416 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

417 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

418 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

419 
di¡blk
 
mco¡
;

420 
pos
, 
be¡_pos
;

422 
MÙiÚVeùÜ
 
ÿnd
;

423 
li¡
 = 
mv_block
->list;

424 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

425 
»f
 = 
mv_block
->
»f_idx
;

426 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

428 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

430 
check_pos™iÚ0
 = (!
p_IÅ
->
rdÝt
 && 
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
 && 
»f
==0 && 
mv_block
->
blockty³
==1 && 
mv
->
mv_x
 =ð0 && mv->
mv_y
 ==0);

432 
MÙiÚVeùÜ
 
cmv
;

434 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

437 
mš_mco¡
 = 
DISTBLK_MAX
;

440 
be¡_pos
 = 0, 
pos
 = 0;…os < 49;…os++)

442 
ÿnd
.
mv_x
 = 
mv
->mv_x + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_x;

443 
ÿnd
.
mv_y
 = 
mv
->mv_y + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_y;

446 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed
);

448 ià(
mco¡
 >ð
mš_mco¡
) ;

450 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

451 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
);

453 ià(
pos
 =ð0 && 
check_pos™iÚ0
)

455 
mco¡
 -ð
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 16);

458 ià(
mco¡
 < 
mš_mco¡
)

460 
mš_mco¡
 = 
mco¡
;

461 
be¡_pos
 = 
pos
;

465 ià(
be¡_pos
)

467 
	`add_mvs
(
mv
, &
p_Vid
->
¥œ®_£¬ch
[
be¡_pos
]);

471  
mš_mco¡
;

472 
	}
}

480 
di¡blk


481 
	$fuÎ_sub_³l_b»d_mÙiÚ_e¡im©iÚ
 (
Maüoblock
 *
cu¼MB
,

482 
MEBlock
 *
mv_block
,

483 
li¡
,

484 
MÙiÚVeùÜ
 *
´ed_mv1
,

485 
MÙiÚVeùÜ
 *
´ed_mv2
,

486 
MÙiÚVeùÜ
 *
mv1
,

487 
MÙiÚVeùÜ
 *
mv2
,

488 
di¡blk
 
mš_mco¡
,

489 * 
Ïmbda


492 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

493 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

494 
li¡_off£t
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].list_offset;

495 
di¡blk
 
mco¡
;

496 
pos
, 
be¡_pos
;

497 
MÙiÚVeùÜ
 
ÿnd
;

499 
MÙiÚVeùÜ
 
cmv
, 
smv
 = 
	`·d_MVs
(*
mv2
, 
mv_block
);

500 
»f
 = 
mv_block
->
»f_idx
;

502 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
li¡_off£t
][
»f
];

503 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[(
li¡
 ^ 1è+ 
li¡_off£t
][0];

505 
Ïmbda_çùÜ
 = 
Ïmbda
[
Q_PEL
];

511 
be¡_pos
 = 0, 
pos
 = 0;…os < 49;…os++)

513 
ÿnd
.
mv_x
 = 
mv1
->mv_x + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_x;

514 
ÿnd
.
mv_y
 = 
mv1
->mv_y + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_y;

517 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv1
);

518 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, 
mv2
, 
´ed_mv2
);

520 ià(
mco¡
 >ð
mš_mco¡
) ;

522 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

523 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dQP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
, &
smv
);

525 ià(
mco¡
 < 
mš_mco¡
)

527 
mš_mco¡
 = 
mco¡
;

528 
be¡_pos
 = 
pos
;

532 ià(
be¡_pos
)

534 
	`add_mvs
(
mv1
, &
p_Vid
->
¥œ®_£¬ch
[
be¡_pos
]);

538  
mš_mco¡
;

539 
	}
}

	@lencod/src/me_hme.c

17 
	~"cÚŒibutÜs.h
"

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

21 
	~"image.h
"

22 
	~"mem®loc.h
"

23 
	~"mb_acûss.h
"

24 
	~"»fbuf.h
"

25 
	~"maüoblock.h
"

26 
	~"me_di¡ÜtiÚ.h
"

27 
	~"me_•zs.h
"

28 
	~"me_•zs_commÚ.h
"

29 
	~"mv_£¬ch.h
"

31 
	~"me_hme.h
"

32 
	~"hme_di¡ÜtiÚ.h
"

33 
	~"»size.h
"

35 
	~"wp.h
"

36 
	~"¦iû.h
"

37 
	~"li¡_»Üd”.h
"

41 
S‘MVFromUµ”Lev–
 (
Sliû
 *
cu¼Sliû
, 
pyr_Ëv–
);

42 
HMEPicMÙiÚS—rch
 (
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
);

43 
di¡blk
 
HMEBlockMÙiÚS—rch
(
MÙiÚVeùÜ
 **
p_pic_mv
, di¡blk **
p_pic_mco¡
, di¡blk **
p_pic_mdi¡
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
);

44 
di¡blk
 
HME_EPZSIÁP–BlockMÙiÚS—rch_Enh
 (
MÙiÚVeùÜ
 *
´ed_mv
, 
MEBlock
 *
mv_block
, MÙiÚVeùÜ **
pic_mv
, di¡blk **
pic_mco¡
, 
Ïmbda_çùÜ
);

46 
	$´•¬e_’c_äame_piùu»_hme
 (
VideoP¬am‘”s
 *
p_Vid
)

48 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

49 
StÜabËPiùu»
 *
¡Üed_pic
 = 
p_Vid
->
pHMEInfo
->
pTmpEncPic
;

51 
p_Vid
->
ThisPOC
 =…_Vid->
äam•oc
;

52 
¡Üed_pic
->
poc
 = 
p_Vid
->
äam•oc
;

53 
¡Üed_pic
->
tÝ_poc
 = 
p_Vid
->
tÝpoc
;

54 
¡Üed_pic
->
bÙtom_poc
 = 
p_Vid
->
bÙtompoc
;

55 
¡Üed_pic
->
äame_poc
 = 
p_Vid
->
äam•oc
;

56 
¡Üed_pic
->
pic_num
 = 
p_Vid
->
äame_num
;

57 
¡Üed_pic
->
äame_num
 = 
p_Vid
->frame_num;

58 
¡Üed_pic
->
coded_äame
 = 1;

59 
¡Üed_pic
->
mb_aff_äame_æag
 = 
p_Vid
->mb_aff_äame_æag = (
BoÞ—n
è(
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_CODING
);

61 
p_Vid
->
g‘_mb_block_pos
 =…_Vid->
mb_aff_äame_æag
 ? 
g‘_mb_block_pos_mbaff
 : 
g‘_mb_block_pos_nÜm®
;

62 
p_Vid
->
g‘Neighbour
 =…_Vid->
mb_aff_äame_æag
 ? 
g‘AffNeighbour
 : 
g‘NÚAffNeighbour
;

63 
p_Vid
->
’c_piùu»
 = 
¡Üed_pic
;

65 
	`cÝy_·¿ms
(
p_Vid
,…_Vid->
’c_piùu»
,…_Vid->
aùive_¥s
);

66 
	}
}

68 
	$švoke_HME
(
VideoP¬am‘”s
 *
p_Vid
, 
pic_idx
)

70 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

71 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

72 
£t_li¡s
;

74 
	`HMEIn™F¿me
(
p_Vid
, 
pHMEInfo
);

75 
	`HMEStÜeInfo
(
p_Vid
, 
pHMEInfo
);

76 
	`´•¬e_’c_äame_piùu»_hme
Ð
p_Vid
);

78 
p_Vid
->
cu¼’tPiùu»
 =…_Vid->
äame_pic
[
pic_idx
];

80 
pHMEInfo
->
p_Üig_img_poš‹r
[0] = 
p_Vid
->
imgD©a
.
äm_d©a
[0];

81 
	`G’”©eImagePy¿mid
(
p_Vid
, 
pHMEInfo
->
iImageWidth
,…HMEInfo->
iImageHeight
,…HMEInfo->
p_Üig_img_poš‹r
, 0, 0);

88 
	`In™WP
(
p_Vid
, 
p_IÅ
, (p_IÅ->
WPM‘hod
 =ð3 && 
pic_idx
 == 0) ? 1:0);

89 
p_Vid
->
is_hme
 = 1;

90 
	`š™_¦iû
(
p_Vid
, &(
pHMEInfo
->
pTmpSliû
), 0);

91 
p_Vid
->
is_hme
 = 0;

93 if(
pHMEInfo
->
pTmpSliû
->
p_EPZS
->
EPZSM­
)

95 
	`HMEResizeS—rchRªge
(
p_Vid
, 
pHMEInfo
);

98 
p_Vid
->
ThisPOC
 = 
pHMEInfo
->
pTmpSliû
->
äam•oc
;

99 
£t_li¡s
 = 
TRUE
;

101 
	`HMES—rch
(
pHMEInfo
->
pTmpSliû
);

103 
	`ä“_¦iû
(
pHMEInfo
->
pTmpSliû
);

105 
p_Vid
->
äame_pic
[
pic_idx
]->
no_¦iûs
 = 0;

106 
	`HMERe¡ÜeInfo
(
p_Vid
, 
pHMEInfo
);

108 
p_Vid
->
’c_piùu»
 = 
NULL
;

109 
	}
}

111 
	$AÎocHMEMemÜy
(
img³l
 ****
pHmeImage
, 
VideoP¬am‘”s
 *
p_Vid
, 
size_y
, 
size_x
, 
off£t_y
, 
off£t_x
, 
iS¹Lev–
)

113 
i
, 
iSx
, 
iSy
;

114 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

116 *
pHmeImage
 = (
img³l
 ***)
	`m®loc
((img³l**)* 
iPy¿midLev–s
);

117 
i
=0; i<
iS¹Lev–
; i++)

118 (*
pHmeImage
)[
i
] = 
NULL
;

119 
i
=
iS¹Lev–
; i< 
iPy¿midLev–s
; i++)

121 
iSx
 = (
size_x
 >> 
i
);

122 
iSy
 = (
size_y
 >> 
i
);

123 
	`g‘_mem2D³l_·d
(&((*
pHmeImage
)[
i
]), 
iSy
, 
iSx
, 
off£t_y
, 
off£t_x
);

125 
	}
}

127 
	$F»eHMEMemÜy
(
img³l
 ****
pHmeImage
, 
VideoP¬am‘”s
 *
p_Vid
, 
iS¹Lev–
, 
iPadY
, 
iPadX
)

129 if(
pHmeImage
 && (*pHmeImage))

131 
i
;

132 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

133 
i
=0; i<
iS¹Lev–
; i++)

134 (*
pHmeImage
)[
i
] = 
NULL
;

135 
i
=
iS¹Lev–
; i<
iPy¿midLev–s
; i++)

137 
	`ä“_mem2D³l_·d
((*
pHmeImage
)[
i
], 
iPadY
, 
iPadX
);

138 (*
pHmeImage
)[
i
]=
NULL
;

140 
	`ä“
((*
pHmeImage
));

141 (*
pHmeImage
èð
NULL
;

143 
	}
}

145 
	$AÎoÿ‹HMEMVInfo
(
MÙiÚVeùÜ
 ******
p_hme_mv
, 
VideoP¬am‘”s
 *
p_Vid
)

147 
iLi¡Num
=2;

148 
i
, 
iMaxRefNum
, 
iSx
, 
iSy
;

149 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

151 
iMaxRefNum
 = 
p_Vid
->
pHMEInfo
->iMaxRefNum;

152 *
p_hme_mv
 = (
MÙiÚVeùÜ
*****è
	`m®loc
(
iPy¿midLev–s
*(MotionVector****));

153 
i
=0; i<
iPy¿midLev–s
; i++)

155 
iSx
 = (
p_Vid
->
width
 >>(
i
 + 3));

156 
iSy
 = (
p_Vid
->
height
 >>(
i
 + 3));

157 
	`g‘_mem4Dmv
(&(*
p_hme_mv
)[
i
], 
iLi¡Num
, 
iMaxRefNum
, 
iSy
, 
iSx
);

159 
	}
}

161 
	$AÎoÿ‹HMEMECo¡
(
di¡blk
 ******
p_hme_mco¡
, 
VideoP¬am‘”s
 *
p_Vid
)

163 
iLi¡Num
=2;

164 
i
, 
iMaxRefNum
, 
iSx
, 
iSy
;

165 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

167 
iMaxRefNum
 = 
p_Vid
->
pHMEInfo
->iMaxRefNum;

168 *
p_hme_mco¡
 = (
di¡blk
*****è
	`m®loc
(
iPy¿midLev–s
*(distblk****));

169 
i
=0; i<
iPy¿midLev–s
; i++)

171 
iSx
 = (
p_Vid
->
width
 >> (
i
 + 3));

172 
iSy
 = (
p_Vid
->
height
 >> (
i
 + 3));

173 
	`g‘_mem4Ddi¡blk
(&(*
p_hme_mco¡
)[
i
], 
iLi¡Num
, 
iMaxRefNum
, 
iSy
, 
iSx
);

175 
	}
}

177 
	$AÎoÿ‹HMEDi¡Info
(
di¡blk
 ******
p_hme_mdi¡
, 
VideoP¬am‘”s
 *
p_Vid
)

179 
iLi¡Num
=2;

180 
i
, 
iMaxRefNum
, 
iSx
, 
iSy
;

181 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

183 
iMaxRefNum
 = 
p_Vid
->
pHMEInfo
->iMaxRefNum;

184 *
p_hme_mdi¡
 = (
di¡blk
*****è
	`m®loc
(
iPy¿midLev–s
*(distblk****));

185 
i
=0; i<
iPy¿midLev–s
; i++)

187 
iSx
 = (
p_Vid
->
width
 >> (
i
 + 3));

188 
iSy
 = (
p_Vid
->
height
 >> (
i
 + 3));

189 
	`g‘_mem4Ddi¡blk
(&(*
p_hme_mdi¡
)[
i
], 
iLi¡Num
, 
iMaxRefNum
, 
iSy
, 
iSx
);

191 
	}
}

193 
	$F»eHMEMVInfo
(
MÙiÚVeùÜ
 ******
p_hme_mv
, 
VideoP¬am‘”s
 *
p_Vid
)

195 
i
;

197 if(
p_hme_mv
 && *p_hme_mv)

199 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

200 
i
=0; i<
iPy¿midLev–s
; i++)

202 
	`ä“_mem4Dmv
((*
p_hme_mv
)[
i
]);

203 (*
p_hme_mv
)[
i
] = 
NULL
;

205 
	`ä“
(*
p_hme_mv
);

206 *
p_hme_mv
 = 
NULL
;

208 
	}
}

210 
	$F»eHMEMECo¡
(
di¡blk
 ******
p_hme_mco¡
, 
VideoP¬am‘”s
 *
p_Vid
)

212 
i
;

214 if(
p_hme_mco¡
 && *p_hme_mcost)

216 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

217 
i
=0; i<
iPy¿midLev–s
; i++)

219 
	`ä“_mem4Ddi¡blk
((*
p_hme_mco¡
)[
i
]);

220 (*
p_hme_mco¡
)[
i
] = 
NULL
;

222 
	`ä“
(*
p_hme_mco¡
);

223 *
p_hme_mco¡
 = 
NULL
;

225 
	}
}

227 
	$F»eHMEMEDi¡
(
di¡blk
 ******
p_hme_mdi¡
, 
VideoP¬am‘”s
 *
p_Vid
)

229 
i
;

231 if(
p_hme_mdi¡
 && *p_hme_mdist)

233 
iPy¿midLev–s
 = 
p_Vid
->
pHMEInfo
->iPyramidLevels;

234 
i
=0; i<
iPy¿midLev–s
; i++)

236 
	`ä“_mem4Ddi¡blk
((*
p_hme_mdi¡
)[
i
]);

237 (*
p_hme_mdi¡
)[
i
] = 
NULL
;

239 
	`ä“
(*
p_hme_mdi¡
);

240 *
p_hme_mdi¡
 = 
NULL
;

242 
	}
}

245 
	$C®cS—rchRªge
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
iMaxRefNum
)

247 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

248 
S—rchWšdow
 *
pD¡SW
 = 
pHMEInfo
->
p_HMESW
, *
pSW
;

250 
»f
;

251 
iSRx
 = 
p_IÅ
->
£¬ch_¿nge
[0]<<2;

252 
iSRy
 = 
p_IÅ
->
£¬ch_¿nge
[0]<<2;

253 
iSRxMš
 = 16;

254 
iSRyMš
 = 16;

258 
»f
=0;„ef<
iMaxRefNum
;„ef++)

261 
pSW
 = 
pD¡SW
 + 
»f
;

262 
pSW
->
mš_x
 = -
iSRx
;

263 
pSW
->
max_x
 = 
iSRx
;

264 
pSW
->
mš_y
 = -
iSRy
;

265 
pSW
->
max_y
 = 
iSRy
;

267 
pSW
 = 
pHMEInfo
->
p_HMESWMš
+
»f
;

268 
pSW
->
mš_x
 = -
iSRxMš
;

269 
pSW
->
max_x
 = 
iSRxMš
;

270 
pSW
->
mš_y
 = -
iSRyMš
;

271 
pSW
->
max_y
 = 
iSRyMš
;

273 
	}
}

275 
	$In™HMEInfo
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

277 
HMEInfo_t
 *
pHMEInfo
 = (HMEInfo_ˆ*)
	`ÿÎoc
(1, (HMEInfo_t));

278 
pic_size_x_š_blk
, 
pic_size_y_š_blk
;

280 
pic_size_x_š_blk
 = 
p_Vid
->
width
 >>3;

281 
pic_size_y_š_blk
 = 
p_Vid
->
height
>>3;

283 if(!
pHMEInfo
)

285 
p_Vid
->
pHMEInfo
 = 
NULL
;

288 
p_Vid
->
pHMEInfo
 =…HMEInfo;

290 if(
p_IÅ
->
Py¿midLev–s
 >0)

291 
pHMEInfo
->
iPy¿midLev–s
 = 
p_IÅ
->
Py¿midLev–s
;

294 
i
 = 
	`imax
(1, ()(
	`log
(
	`imš
(
p_Vid
->
width
/88,…_Vid->
height
/72))/log(2.0)+1));

295 
pHMEInfo
->
iPy¿midLev–s
 = 
i
;

297 
pHMEInfo
->
HMEBlockSizeIdx
 = 3;

298 
pHMEInfo
->
T¿nsfÜm8x8Mode
 = -1;

300 
pHMEInfo
->
iMaxRefNum
 = 
p_IÅ
->
num_»f_äames
;

302 if(
p_IÅ
->
PicIÁ”Ïû
 !ð
FRAME_CODING
)

304 
pHMEInfo
->
iMaxRefNum
 <<= 1;

308 
	`AÎocHMEMemÜy
(&(
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[0]), 
p_Vid
,…_Vid->
height
,…_Vid->
width
, 0, 0, 1);

309 
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[1] = 
NULL
;

311 
pHMEInfo
->
p_Üig_img_poš‹r
 =…HMEInfo->
p_Üig_img_poš‹r_Ïy”s
[0];

312 
pHMEInfo
->
p_Üig_img_poš‹r
[0] = 
NULL
;

313 
	`AÎoÿ‹HMEMVInfo
(&
pHMEInfo
->
p_hme_mv
, 
p_Vid
);

314 
	`AÎoÿ‹HMEMECo¡
(&
pHMEInfo
->
p_hme_mco¡
, 
p_Vid
);

315 
	`AÎoÿ‹HMEDi¡Info
(&
pHMEInfo
->
p_hme_mdi¡
, 
p_Vid
);

316 
	`g‘_mem3Dšt64
(&
pHMEInfo
->
hme_di¡ÜtiÚ
,…HMEInfo->
iPy¿midLev–s
, 3,…HMEInfo->
iMaxRefNum
);

317 
	`g‘_mem3Dšt64
(&
pHMEInfo
->
poc
,…HMEInfo->
iPy¿midLev–s
, 3,…HMEInfo->
iMaxRefNum
);

319 
pHMEInfo
->
p_HMESW
 = (
S—rchWšdow
 *)
	`m®loc
ÐpHMEInfo->
iMaxRefNum
 * (SearchWindow));

320 if(!
pHMEInfo
->
p_HMESW
)

322 
pHMEInfo
->
p_HMESWMš
 = (
S—rchWšdow
 *)
	`m®loc
ÐpHMEInfo->
iMaxRefNum
 * (SearchWindow));

323 if(!
pHMEInfo
->
p_HMESWMš
)

325 
	`C®cS—rchRªge
(
p_Vid
, 
p_IÅ
, 
pHMEInfo
->
iMaxRefNum
);

328 
Çl_»ã»nû_idc
 = 
p_Vid
->nal_reference_idc;

329 
p_Vid
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

330 
pHMEInfo
->
pTmpEncPic
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, (
Piùu»SŒuùu»
è
FRAME
, 16, 16, 8, 8);

331 
p_Vid
->
Çl_»ã»nû_idc
 =‚al_reference_idc;

334 
	`g‘_mem3Dšt
(&
pHMEInfo
->
hme_blk_good_¡Üe
, 2, 
pic_size_y_š_blk
, 
pic_size_x_š_blk
);

337 
pHMEInfo
->
hme_blk_weight_¡Üe
 = 
NULL
;

338 
pHMEInfo
->
hme_blk_off£t_¡Üe
 = 
NULL
;

339 
pHMEInfo
->
hme_blk_»s_DC_¡Üe
 = 
NULL
;

340 
pHMEInfo
->
hme_blk_£g_¡Üe
 = 
NULL
;

341 
pHMEInfo
->
pWPReÜd”Ty³
 = 
NULL
;

342 
pHMEInfo
->
»f_idx_m­
 = 
NULL
;

343 
pHMEInfo
->
dup_»f_æag
 = 
NULL
;

344 
pHMEInfo
->
wp_»f_li¡
 = 
NULL
;

345 
pHMEInfo
->
mo¡_u£d_»f
 = 
NULL
;

346 
pHMEInfo
->
³rfÜm_»Üd”_·ss
 = 
NULL
;

350 
	}
}

352 
	$F»eHMEInfo
(
VideoP¬am‘”s
 *
p_Vid
)

354 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

355 if(
pHMEInfo
)

357 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

359 if(
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[0] !=…HMEInfo->p_orig_img_pointer_layers[1])

361 
	`F»eHMEMemÜy
(&(
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[1]), 
p_Vid
, 1, 0, 0);

364 
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[1] = 
NULL
;

367 
	`F»eHMEMemÜy
(&(
pHMEInfo
->
p_Üig_img_poš‹r_Ïy”s
[0]), 
p_Vid
, 1, 0, 0);

368 
pHMEInfo
->
p_Üig_img_poš‹r
 = 
NULL
;

369 
	`F»eHMEMVInfo
(&
pHMEInfo
->
p_hme_mv
, 
p_Vid
);

370 
	`F»eHMEMECo¡
(&
pHMEInfo
->
p_hme_mco¡
, 
p_Vid
);

371 
	`F»eHMEMEDi¡
(&
pHMEInfo
->
p_hme_mdi¡
, 
p_Vid
);

372 if(
pHMEInfo
->
p_HMESW
)

374 
	`ä“
(
pHMEInfo
->
p_HMESW
);

375 
pHMEInfo
->
p_HMESW
 = 
NULL
;

377 if(
pHMEInfo
->
p_HMESWMš
)

379 
	`ä“
(
pHMEInfo
->
p_HMESWMš
);

380 
pHMEInfo
->
p_HMESWMš
 = 
NULL
;

382 if(
pHMEInfo
->
pTmpEncPic
)

384 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
pHMEInfo
->
pTmpEncPic
);

385 
pHMEInfo
->
pTmpEncPic
 = 
NULL
;

388 ià(
pHMEInfo
->
hme_di¡ÜtiÚ
)

389 
	`ä“_mem3Dšt64
(
pHMEInfo
->
hme_di¡ÜtiÚ
);

390 ià(
pHMEInfo
->
hme_di¡ÜtiÚ
)

391 
	`ä“_mem3Dšt64
(
pHMEInfo
->
poc
);

392 if(
pHMEInfo
->
hme_blk_weight_¡Üe
)

393 
	`ä“_mem3Dšt
(
pHMEInfo
->
hme_blk_weight_¡Üe
);

394 if(
pHMEInfo
->
hme_blk_off£t_¡Üe
)

395 
	`ä“_mem3Dšt
(
pHMEInfo
->
hme_blk_off£t_¡Üe
);

396 if(
pHMEInfo
->
hme_blk_»s_DC_¡Üe
)

397 
	`ä“_mem3Dšt
(
pHMEInfo
->
hme_blk_»s_DC_¡Üe
);

398 if(
pHMEInfo
->
hme_blk_good_¡Üe
)

399 
	`ä“_mem3Dšt
(
pHMEInfo
->
hme_blk_good_¡Üe
);

400 if(
pHMEInfo
->
hme_blk_£g_¡Üe
)

401 
	`ä“_mem3Dšt
(
pHMEInfo
->
hme_blk_£g_¡Üe
);

402 if(
pHMEInfo
->
pWPReÜd”Ty³
)

404 if(*
pHMEInfo
->
pWPReÜd”Ty³
)

405 
	`ä“
((*)(*
pHMEInfo
->
pWPReÜd”Ty³
));

407 
	`”rÜ
 ("FreeHMEInfo:ryingo free unused memory *pHMEInfo->pWPReorderType",100);

409 
	`ä“
(
pHMEInfo
->
pWPReÜd”Ty³
);

411 if(
pHMEInfo
->
»f_idx_m­
)

412 
	`ä“_mem3Dšt
(
pHMEInfo
->
»f_idx_m­
);

413 if(
pHMEInfo
->
dup_»f_æag
)

414 
	`ä“_mem3Dšt
(
pHMEInfo
->
dup_»f_æag
);

415 if(
pHMEInfo
->
wp_»f_li¡
)

416 
	`ä“_mem3Dšt
(
pHMEInfo
->
wp_»f_li¡
);

417 if(
pHMEInfo
->
mo¡_u£d_»f
)

418 
	`ä“_mem2Dšt
(
pHMEInfo
->
mo¡_u£d_»f
);

419 if(
pHMEInfo
->
³rfÜm_»Üd”_·ss
)

420 
	`ä“
(
pHMEInfo
->
³rfÜm_»Üd”_·ss
);

422 
	`ä“
(
pHMEInfo
);

424 
p_Vid
->
pHMEInfo
 = 
NULL
;

426 
	}
}

428 
	$HMEIn™F¿me
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
)

430 
pHMEInfo
->
hme_time
 = 0;

431 
pHMEInfo
->
iImageHeight
 = 
p_Vid
->
f›ld_piùu»
? (p_Vid->
height
>>1):p_Vid->height;

432 
pHMEInfo
->
iImageWidth
 = 
p_Vid
->
width
;

433 
pHMEInfo
->
p_Üig_img_poš‹r
 =…HMEInfo->
p_Üig_img_poš‹r_Ïy”s
[
p_Vid
->
dpb_Ïy”_id
];

436 
pHMEInfo
->
pf_compu‹SAD_hme
 = 
compu‹SAD_hme
;

437 
	}
}

439 
	$HMEResizeS—rchRªge
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
)

441 
ušt16
 **
EPZSM­
 = 
pHMEInfo
->
pTmpSliû
->
p_EPZS
->EPZSMap;

442 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

443 
iS—rchRªgeY
 = (2 * 
p_IÅ
->
£¬ch_¿nge
[0] + 1) << 2;

444 
iS—rchRªgeX
 = (2 * 
p_IÅ
->
£¬ch_¿nge
[0] + 1) << 2;

446 if(
EPZSM­
)

448 
	`ä“_mem2DshÜt
 ((**è
EPZSM­
);

450 
	`g‘_mem2DshÜt
 ((***è&
EPZSM­
, 
iS—rchRªgeY
, 
iS—rchRªgeX
);

451 
pHMEInfo
->
pTmpSliû
->
p_EPZS
->
EPZSM­
 = EPZSMap;

453 
	}
}

455 
	$HMEStÜeInfo
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
)

457 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

458 
pHMEInfo
->
S—rchMode
 = 
p_IÅ
->S—rchMode[
p_Vid
->
v›w_id
];

459 
	}
}

461 
	$HMERe¡ÜeInfo
(
VideoP¬am‘”s
 *
p_Vid
, 
HMEInfo_t
 *
pHMEInfo
)

463 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

464 
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] = (
S—rchTy³
è
pHMEInfo
->SearchMode;

465 
	}
}

467 
	$S‘MELambda
(
VideoP¬am‘”s
 *
p_Vid
, *
Ïmbda_mf
)

472 
¦iû_ty³
 = 
p_Vid
->
ty³
;

473 
iHMEQP
 = 
p_Vid
->
ma¡”QP
;

474 if((
p_Vid
->
ty³
 =ð
B_SLICE
è&&…_Vid->
Çl_»ã»nû_idc
)

476 
¦iû_ty³
 = 5;

479 
Ïmbda_mf
[
F_PEL
] = 
p_Vid
->Ïmbda_mf[
¦iû_ty³
][
iHMEQP
][F_PEL];

480 
Ïmbda_mf
[
H_PEL
] = 
p_Vid
->Ïmbda_mf[
¦iû_ty³
][
iHMEQP
][H_PEL];

481 
Ïmbda_mf
[
Q_PEL
] = 
p_Vid
->Ïmbda_mf[
¦iû_ty³
][
iHMEQP
][Q_PEL];

482 
	}
}

484 
	$hme_š™_mv_block
(
VideoP¬am‘”s
 *
p_Vid
, 
MEBlock
 *
mv_block
, 
blockty³
)

486 
Sliû
 *
cu¼Sliû
 = 
p_Vid
->
cu¼’tSliû
;

487 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

489 
mv_block
->
blockty³
 = blocktype;

490 
mv_block
->
blocksize_x
 = 
block_size
[
blockty³
][0];

491 
mv_block
->
blocksize_y
 = 
block_size
[
blockty³
][1];

492 
mv_block
->
block_x
 = 0;

493 
mv_block
->
block_y
 = 0;

495 
mv_block
->
mv
[
LIST_0
].
mv_x
 = 0;

496 
mv_block
->
mv
[
LIST_0
].
mv_y
 = 0;

497 
mv_block
->
mv
[
LIST_1
].
mv_x
 = 0;

498 
mv_block
->
mv
[
LIST_1
].
mv_y
 = 0;

500 
mv_block
->
p_Vid
 =…_Vid;

501 
mv_block
->
p_Sliû
 = 
cu¼Sliû
;

502 
mv_block
->
co¡
 = 
INT_MAX
;

503 
mv_block
->
£¬ch_pos2
 = 9;

504 
mv_block
->
£¬ch_pos4
 = 9;

506 
	`g‘_mem2D³l
(&
mv_block
->
Üig_pic
, 1, mv_block->
blocksize_x
 * mv_block->
blocksize_y
);

508 
mv_block
->
ChromaMEEÇbË
 = 0;

510 
mv_block
->
­¶y_bi_weights
 = 0;

511 
mv_block
->
­¶y_weights
 = 0;

513 
mv_block
->
compu‹P»dFP–
 = 
pHMEInfo
->
pf_compu‹SAD_hme
;

514 
mv_block
->
compu‹BiP»dFP–
 = 
NULL
;

515 
	}
}

518 
	$HMES—rch
(
Sliû
 *
cu¼Sliû
)

520 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

523 
MEBlock
 
mv_block
;

525 
Ïmbda_çùÜ
[3];

526 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

527 
blockty³
 = 
SMB8x8
;

529 #ià
GET_METIME


530 
TIME_T
 
me_time_¡¬t
;

531 
TIME_T
 
me_time_’d
;

532 
št64
 
me_tmp_time
;

533 
	`g‘time
Ð&
me_time_¡¬t
 );

536 
cu¼Sliû
->
	`£t_Ïg¿ngŸn_muÉl›rs
(currSlice);

537 
	`S‘MELambda
(
p_Vid
, 
Ïmbda_çùÜ
);

539 
	`hme_š™_mv_block
(
p_Vid
, &
mv_block
, (è
blockty³
);

542 
	`HMEPicMÙiÚS—rch
 (
cu¼Sliû
, &
mv_block
, 
Ïmbda_çùÜ
);

544 
	`ä“_mv_block
(&
mv_block
);

546 #ià
GET_METIME


547 
	`g‘time
(&
me_time_’d
);

548 
me_tmp_time
 = 
	`timediff
 (&
me_time_¡¬t
, &
me_time_’d
);

549 
pHMEInfo
->
hme_tÙ_time
 +ð
me_tmp_time
;

550 
pHMEInfo
->
hme_time
 +ð
me_tmp_time
;

553 
	}
}

555 
	$S‘MVFromUµ”Lev–
(
Sliû
 *
cu¼Sliû
, 
pyr_Ëv–
)

557 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

558 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

559 
MÙiÚVeùÜ
 *****
p_hme_mv
 = 
pHMEInfo
->p_hme_mv;

560 
i
, 
j
;

561 
li¡
;

562 
»f
;

563 
blkwidth
 = (
pHMEInfo
->
iImageWidth
 >> (
pyr_Ëv–
 + 3));

564 
blkheight
 = (
pHMEInfo
->
iImageHeight
 >> (
pyr_Ëv–
 + 3));

565 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)? 2: 1;

567 if(
pyr_Ëv–
 < 
pHMEInfo
->
iPy¿midLev–s
-1)

569 
li¡
=0;†i¡<
numli¡s
;†ist++)

570 
»f
=0;„ef<
cu¼Sliû
->
li¡Xsize
[
li¡
];„ef++)

572 
MÙiÚVeùÜ
 **
p_mv0
 = 
p_hme_mv
[
pyr_Ëv–
][
li¡
][
»f
];

573 
MÙiÚVeùÜ
 **
p_mv1
 = 
p_hme_mv
[
pyr_Ëv–
+1][
li¡
][
»f
];

574 
MÙiÚVeùÜ
 
mv_sÿËd
;

575 
ii
, 
jj
;

576 
j
=0; j<(
blkheight
>>1); j++)

578 
jj
 = 
j
<<1;

579 
i
=0; i<(
blkwidth
>>1); i++)

581 
ii
 = 
i
<<1;

582 
mv_sÿËd
.
mv_x
 = 
p_mv1
[
j
][
i
].mv_x <<1;

583 
mv_sÿËd
.
mv_y
 = 
p_mv1
[
j
][
i
].mv_y <<1;

584 
p_mv0
[
jj
][
ii
] =

585 
p_mv0
[
jj
][
ii
+1] =

586 
p_mv0
[
jj
+1][
ii
] =

587 
p_mv0
[
jj
+1][
ii
+1] = 
mv_sÿËd
;

589 if(
blkwidth
&1)

591 
p_mv0
[
jj
][
blkwidth
-1] =…_mv0[jj][blkwidth-2];

592 
p_mv0
[
jj
+1][
blkwidth
-1] =…_mv0[jj+1][blkwidth-2];

595 if(
blkheight
&1)

597 
	`memýy
(
p_mv0
[
blkheight
-1],…_mv0[blkheight-2], 
blkwidth
*(
MÙiÚVeùÜ
));

603 
li¡
=0;†i¡<
numli¡s
;†ist++)

604 
	`mem£t
(*
p_hme_mv
[
pyr_Ëv–
][
li¡
][0], 0, 
cu¼Sliû
->
li¡Xsize
[li¡]*
blkwidth
*
blkheight
*(
MÙiÚVeùÜ
));

606 
	}
}

608 
	$hme_g‘_Üigš®_block
(
HMEInfo_t
 *
pHMEInfo
, 
Ëv–
, 
MEBlock
 *
mv_block
)

613 
img³l
 *
Üig_pic_tmp
 = 
mv_block
->
Üig_pic
[0];

614 
bsx
 = 
mv_block
->
blocksize_x
;

615 
pic_pix_x
 = 
mv_block
->
pos_x
;

616 
j
;

617 
img³l
 **
cur_img
 = &
pHMEInfo
->
p_Üig_img_poš‹r
[
Ëv–
][
mv_block
->
pos_y
];

618 
by‹s
 = (
img³l
);

619 
img³ls
 = 
by‹s
/(
img³l
);

621 
j
 = 0; j < 
mv_block
->
blocksize_y
; j++)

623 
	`memýy
(
Üig_pic_tmp
,&
cur_img
[
j
][
pic_pix_x
*
img³ls
], 
bsx
 * 
by‹s
);

624 
Üig_pic_tmp
 +ð
bsx
*
img³ls
;

626 
	}
}

628 
	$HMEG‘PMV
(
VideoP¬am‘”s
 *
p_Vid
, 
MÙiÚVeùÜ
 **
p_pic_mv
, 
Ëv–
, 
bx
, 
by
, MÙiÚVeùÜ *
´ed
)

630 
img_bx
 = (
p_Vid
->
width
>>
Ëv–
)>>3;

632 
MÙiÚVeùÜ
 
mv
[3];

633 if(!
by
)

635 if(!
bx
)

636 *
´ed
 = 
p_pic_mv
[
by
][
bx
];

638 *
´ed
 = 
p_pic_mv
[
by
][
bx
-1];

642 if(
bx
)

643 
mv
[0] = 
p_pic_mv
[
by
][
bx
-1];

646 
mv
[0] = 
p_pic_mv
[
by
][
bx
];

649 
mv
[1] = 
p_pic_mv
[
by
-1][
bx
];

650 if(
bx
 < 
img_bx
-1)

651 
mv
[2] = 
p_pic_mv
[
by
-1][
bx
+1];

653 
mv
[2] = 
p_pic_mv
[
by
-1][
bx
-1];

656 
´ed
->
mv_x
 = 
mv
[0].mv_x + mv[1].mv_x + mv[2].mv_x - 
	`smš
(mv[0].mv_x, smš(mv[1].mv_x, mv[2].mv_x)è- 
	`smax
(mv[0].mv_x, smax(mv[1].mv_x, mv[2].mv_x));

657 
´ed
->
mv_y
 = 
mv
[0].mv_y + mv[1].mv_y + mv[2].mv_y - 
	`smš
(mv[0].mv_y, smš(mv[1].mv_y, mv[2].mv_y)è- 
	`smax
(mv[0].mv_y, smax(mv[1].mv_y, mv[2].mv_y));

659 
	}
}

661 
	$HMES‘S—rchRªge
(
S—rchWšdow
 *
pSrcSW
,

662 
Ëv–
,

663 
S—rchWšdow
 *
pCu¼SW
,

664 
S—rchWšdow
 *
pSWMš


667 
tmp
;

668 
tmp
 = 
pSrcSW
->
max_x
 >> 
Ëv–
;

669 
pCu¼SW
->
max_x
 = 
tmp
 < 
pSWMš
->max_x?…SWMin->max_x:mp;

670 
tmp
 = 
pSrcSW
->
mš_x
 >> 
Ëv–
;

671 
pCu¼SW
->
mš_x
 = 
tmp
 > 
pSWMš
->min_x?…SWMin->min_x:mp;

672 
tmp
 = 
pSrcSW
->
max_y
 >> 
Ëv–
;

673 
pCu¼SW
->
max_y
 = 
tmp
 < 
pSWMš
->max_y?…SWMin->max_y:mp;

674 
tmp
 = 
pSrcSW
->
mš_y
 >> 
Ëv–
;

675 
pCu¼SW
->
mš_y
 = 
tmp
 > 
pSWMš
->min_y?…SWMin->min_y:mp;

676 
	}
}

679 
	$hme_g‘_ÃighbÜs
(
Pix–Pos
 *
pBlkPos
, 
bx
, 
by
, 
iMaxBlkX
)

681 if(!
by
)

683 
pBlkPos
[1].
avažabË
 =…BlkPos[2].available =…BlkPos[3].available = 0;

684 if(!
bx
)

685 
pBlkPos
[0].
avažabË
 = 0;

688 
pBlkPos
[0].
avažabË
 = 1;

689 
pBlkPos
[0].
pos_x
 =…BlkPos[0].
x
 = (è(
bx
 - 1);

690 
pBlkPos
[0].
pos_y
 =…BlkPos[0].
y
 = (è
by
;

695 
pBlkPos
[1].
avažabË
 = 1;

696 
pBlkPos
[1].
pos_x
 =…BlkPos[1].
x
 = (è
bx
;

697 
pBlkPos
[1].
pos_y
 =…BlkPos[1].
y
 = (è(
by
 - 1);

698 
pBlkPos
[0].
avažabË
 =…BlkPos[2].available =…BlkPos[3].available = 1;

699 if(!
bx
)

701 
pBlkPos
[0].
avažabË
 =…BlkPos[3].available = 0;

703 if(
bx
 >=
iMaxBlkX
-1)

705 
pBlkPos
[2].
avažabË
 = 0;

708 if(
pBlkPos
[0].
avažabË
)

710 
pBlkPos
[0].
pos_x
 =…BlkPos[0].
x
 = (è(
bx
 - 1);

711 
pBlkPos
[0].
pos_y
 =…BlkPos[0].
y
 = (è
by
;

713 if(
pBlkPos
[2].
avažabË
)

715 
pBlkPos
[2].
pos_x
 =…BlkPos[2].
x
 = (è(
bx
 + 1);

716 
pBlkPos
[2].
pos_y
 =…BlkPos[2].
y
 = (è(
by
 - 1);

718 if(
pBlkPos
[3].
avažabË
)

720 
pBlkPos
[3].
pos_x
 =…BlkPos[3].
x
 = (è(
bx
 - 1);

721 
pBlkPos
[3].
pos_y
 =…BlkPos[3].
y
 = (è(
by
 - 1);

724 
	}
}

727 
	$hme_g‘_ÃighbÜs2
(
Pix–Pos
 *
pBlkPos
, 
bx
, 
by
, 
iMaxBlkX
, 
iMaxBlkY
)

729 if(!
bx
)

731 
pBlkPos
[0].
avažabË
 = 0;

732 
pBlkPos
[2].
avažabË
 = 1;

733 
pBlkPos
[2].
pos_x
 =…BlkPos[2].
x
 = (è(
bx
 + 1);

734 
pBlkPos
[2].
pos_y
 =…BlkPos[2].
y
 = (è
by
;

736 if(
bx
 =ð
iMaxBlkX
-1)

738 
pBlkPos
[2].
avažabË
 = 0;

739 
pBlkPos
[0].
avažabË
 = 1;

740 
pBlkPos
[0].
pos_x
 =…BlkPos[0].
x
 = (è(
bx
 - 1);

741 
pBlkPos
[0].
pos_y
 =…BlkPos[0].
y
 = (è
by
;

745 
pBlkPos
[0].
avažabË
 = 1;

746 
pBlkPos
[0].
pos_x
 =…BlkPos[0].
x
 = (è(
bx
 - 1);

747 
pBlkPos
[0].
pos_y
 =…BlkPos[0].
y
 = (è
by
;

748 
pBlkPos
[2].
avažabË
 = 1;

749 
pBlkPos
[2].
pos_x
 =…BlkPos[2].
x
 = (è(
bx
 + 1);

750 
pBlkPos
[2].
pos_y
 =…BlkPos[2].
y
 = (è
by
;

753 if(!
by
)

755 
pBlkPos
[1].
avažabË
 = 0;

756 
pBlkPos
[3].
avažabË
 = 1;

757 
pBlkPos
[3].
pos_x
 =…BlkPos[3].
x
 = (è
bx
;

758 
pBlkPos
[3].
pos_y
 =…BlkPos[3].
y
 = (è(
by
+1);

760 if(
by
 =ð
iMaxBlkY
-1)

762 
pBlkPos
[3].
avažabË
 = 0;

763 
pBlkPos
[1].
avažabË
 = 1;

764 
pBlkPos
[1].
pos_x
 =…BlkPos[1].
x
 = (è
bx
;

765 
pBlkPos
[1].
pos_y
 =…BlkPos[1].
y
 = (è(
by
-1);

769 
pBlkPos
[1].
avažabË
 = 1;

770 
pBlkPos
[1].
pos_x
 =…BlkPos[1].
x
 = (è
bx
;

771 
pBlkPos
[1].
pos_y
 =…BlkPos[1].
y
 = (è(
by
-1);

772 
pBlkPos
[3].
avažabË
 = 1;

773 
pBlkPos
[3].
pos_x
 =…BlkPos[3].
x
 = (è
bx
;

774 
pBlkPos
[3].
pos_y
 =…BlkPos[3].
y
 = (è(
by
+1);

776 
	}
}

778 
	$hme_S‘S—rchRªge
(
MEBlock
 *
mv_block
, 
MÙiÚVeùÜ
 *
mv
)

780 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

781 
S—rchWšdow
 *
pSW
 = &
mv_block
->
£¬chRªge
;

782 
SW_x
 = (
pSW
->
max_x
 -…SW->
mš_x
);

783 
SW_y
 = (
pSW
->
max_y
 -…SW->
mš_y
);

784 
bChªged
=0;

785 
b0
 = 
ûÁ”
.
mv_x
+
pSW
->
mš_x
, 
b1
;

787 
ËáBound¬y
 = -((
IMG_PAD_SIZE_X
-4)*4);

788 
rightBound¬y
 = (
mv_block
->
hme_»f_size_x_max
-4)*4;

789 
tÝBound¬y
 = -((
IMG_PAD_SIZE_Y
-4)*4);

790 
bÙtomBound¬y
 = (
mv_block
->
hme_»f_size_y_max
-4)*4;

794 if(
b0
 < 
ËáBound¬y
)

796 
b0
 = 
ËáBound¬y
;

797 
bChªged
=1;

799 if(
b0
+
SW_x
 > 
rightBound¬y
)

801 
b0
 = 
rightBound¬y
 - (
SW_x
);

802 
bChªged
=1;

804 if(
bChªged
)

806 
b1
 = 
b0
+(
SW_x
);

807 if(
b1
 > 
rightBound¬y
)

809 
b1
 = 
rightBound¬y
;

810 
SW_x
 = (
b1
 - 
b0
)>>1;

811 
pSW
->
mš_x
 = -
SW_x
;

812 
pSW
->
max_x
 = 
SW_x
;

814 
mv
->
mv_x
 = (è(((
b0
 + 
b1
)>>1è- 
mv_block
->
pos_x_·dded
);

817 
bChªged
 = 0;

818 
b0
 = 
ûÁ”
.
mv_y
+
pSW
->
mš_y
;

819 if(
b0
 < 
tÝBound¬y
)

821 
b0
 = 
tÝBound¬y
;

822 
bChªged
 = 1;

824 if(
b0
 + 
SW_y
 > 
bÙtomBound¬y
)

826 
b0
 = 
bÙtomBound¬y
-
SW_y
;

827 
bChªged
 = 1;

829 if(
bChªged
)

831 
b1
 = 
b0
+
SW_y
;

832 if(
b1
 > 
bÙtomBound¬y
)

834 
b1
 = 
bÙtomBound¬y
;

835 
SW_y
 = (
b1
 - 
b0
)>>1;

836 
pSW
->
mš_y
 = -
SW_y
;

837 
pSW
->
max_y
 = 
SW_y
;

839 
mv
->
mv_y
 = (è(((
b0
 + 
b1
)>>1è- 
mv_block
->
pos_y_·dded
);

841 
	}
}

843 
	$HMELev–MÙiÚS—rch
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
)

845 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

846 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

847 
di¡blk
 **
p_pic_mco¡
;

848 
MÙiÚVeùÜ
 **
p_pic_mv
;

849 
di¡blk
 **
p_pic_mdi¡
;

850 
S—rchWšdow
 *
cu¼PicSW
 = 
pHMEInfo
->
p_HMESW
;

851 
S—rchWšdow
 *
cu¼PicSWMš
 = 
pHMEInfo
->
p_HMESWMš
;

853 
pyr_Ëv–
 = 
mv_block
->
hme_Ëv–
;

855 
by
, 
bx
;

856 
pic_size_x
, 
pic_size_y
;

857 
li¡
, 
»f
;

858 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 2 : 1;

860 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

862 
»f
 = 0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
];„ef++)

864 
pHMEInfo
->
hme_di¡ÜtiÚ
[
pyr_Ëv–
][
li¡
][
»f
] = 0;

865 
pHMEInfo
->
poc
[
pyr_Ëv–
][
li¡
][
»f
] = 
cu¼Sliû
->
li¡X
[list][ref]->poc;

869 
pic_size_x
 = 
pHMEInfo
->
iImageWidth
 >> 
pyr_Ëv–
;

870 
pic_size_y
 = 
pHMEInfo
->
iImageHeight
 >> 
pyr_Ëv–
;

872 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

875 
mv_block
->
li¡
 = ()†ist;

879 
»f
=0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
+0];„ef++)

881 
mv_block
->
»f_idx
 = (è
»f
;

882 
by
=0; by<(
pic_size_y
>>3); by++)

884 
bx
=0; bx<(
pic_size_x
>>3); bx++)

887 
mv_block
->
pos_x2
 = (è
bx
;

888 
mv_block
->
pos_y2
 = (è
by
;

889 
mv_block
->
pos_x
 = (è(
bx
 << 3);

890 
mv_block
->
pos_y
 = (è(
by
 << 3);

891 
mv_block
->
pos_x_·dded
 = (è(mv_block->
pos_x
 << 2);

892 
mv_block
->
pos_y_·dded
 = (è(mv_block->
pos_y
 << 2);

893 
	`hme_g‘_ÃighbÜs
(
mv_block
->
block
, 
bx
, 
by
, (
pic_size_x
>>3));

895 
	`hme_g‘_Üigš®_block
(
pHMEInfo
, 
pyr_Ëv–
, 
mv_block
);

898 
	`P»·»MEP¬ams
(
p_Vid
->
cu¼’tSliû
, 
mv_block
, 
FALSE
, 
li¡
, 
»f
);

900 
p_pic_mv
 = 
pHMEInfo
->
p_hme_mv
[
pyr_Ëv–
][
li¡
][
»f
];

901 
p_pic_mco¡
 = 
pHMEInfo
->
p_hme_mco¡
[
pyr_Ëv–
][
li¡
][
»f
];

902 
p_pic_mdi¡
 = 
pHMEInfo
->
p_hme_mdi¡
[
pyr_Ëv–
][
li¡
][
»f
];

905 
	`HMES‘S—rchRªge
(
cu¼PicSW
+
»f
, 
pyr_Ëv–
, &(
mv_block
->
£¬chRªge
), 
cu¼PicSWMš
+ref);

907 
pHMEInfo
->
hme_di¡ÜtiÚ
[
pyr_Ëv–
][
li¡
][
»f
] +ð
	`HMEBlockMÙiÚS—rch
(
p_pic_mv
, 
p_pic_mco¡
, 
p_pic_mdi¡
, 
mv_block
, 
Ïmbda_çùÜ
);

917 
	}
}

921 
šlše
 
di¡blk
 
	$»f_co¡_adj
(cÚ¡ 
Sliû
 *
cu¼Sliû
, 
Ïmbda
, 
»f
, 
li¡_off£t
, 
li¡_size
)

923 
di¡blk
 
Þd_co¡
, 
Ãw_co¡
;

925 
	`as£¹
(
li¡_size
 == 2 ||†ist_size == 1);

927 ià(
cu¼Sliû
->
li¡Xsize
[
li¡_off£t
] <= 1)

928 
Þd_co¡
 = 0;

931 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

932 #ià
JCOST_CALC_SCALEUP


933 
Þd_co¡
 = ( ((
di¡blk
)
Ïmbda
è*((di¡blk)(
p_Vid
->
»fb™s
[(
»f
)])) );

935 #ià(
USE_RND_COST
)

936 
Þd_co¡
 = (
	`rshiá_ºd_sf
((
Ïmbda
è* (
p_Vid
->
»fb™s
[(
»f
)]), 
LAMBDA_ACCURACY_BITS
));

938 
Þd_co¡
 = ((
Ïmbda
 *(
p_Vid
->
»fb™s
[(
»f
)]))>> 
LAMBDA_ACCURACY_BITS
);

943 ià(
li¡_size
 == 1)

944 
Ãw_co¡
 = 0;

947 #ià
JCOST_CALC_SCALEUP


948 
Ãw_co¡
 = ( ((
di¡blk
)
Ïmbda
) *((distblk)(1)) );

950 #ià(
USE_RND_COST
)

951 
Ãw_co¡
 = (
	`rshiá_ºd_sf
((
Ïmbda
è* (1), 
LAMBDA_ACCURACY_BITS
));

953 
Ãw_co¡
 = ((
Ïmbda
 *(1))>> 
LAMBDA_ACCURACY_BITS
);

958  
Ãw_co¡
-
Þd_co¡
;

959 
	}
}

968 
	$HMEPicMÙiÚS—rch
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
)

970 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

971 
pyr_Ëv–
;

972 
pic_size_x
, 
pic_size_y
;

973 
HMEInfo_t
 *
pHMEInfo
 = 
p_Vid
->pHMEInfo;

975 
iLowe¡Lev–
 = 0;

977 if(
pHMEInfo
->
³rfÜm_»Üd”_·ss
)

978 
	`mem£t
(
pHMEInfo
->
³rfÜm_»Üd”_·ss
, 0, ()*pHMEInfo->
iPy¿midLev–s
);

980 
	`as£¹
(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
 && cu¼Sliû->
li¡Xsize
[0] <ð
p_Vid
->
pHMEInfo
->
iMaxRefNum
);

981 
	`as£¹
((
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ðB_SLICE && cu¼Sliû->
li¡Xsize
[1] <ð
p_Vid
->
pHMEInfo
->
iMaxRefNum
));

982 
pyr_Ëv–
 = 
pHMEInfo
->
iPy¿midLev–s
 - 1;…yr_Ëv– >ð
iLowe¡Lev–
;…yr_level--)

984 
pic_size_x
 = 
pHMEInfo
->
iImageWidth
 >> 
pyr_Ëv–
;

985 
pic_size_y
 = 
pHMEInfo
->
iImageHeight
 >> 
pyr_Ëv–
;

986 
	`S‘MVFromUµ”Lev–
(
cu¼Sliû
, 
pyr_Ëv–
);

988 
mv_block
->
hme_Ëv–
 = (è
pyr_Ëv–
;

989 
mv_block
->
hme_»f_size_x_·d
 = 
pic_size_x
+
IMG_PAD_SIZE_X
*2;

990 
mv_block
->
hme_»f_size_y_·d
 = 
pic_size_y
+
IMG_PAD_SIZE_Y
*2;

991 
mv_block
->
hme_»f_size_x_max
 = 
pic_size_x
+
IMG_PAD_SIZE_X
-mv_block->
blocksize_x
;

992 
mv_block
->
hme_»f_size_y_max
 = 
pic_size_y
+
IMG_PAD_SIZE_Y
-mv_block->
blocksize_y
;

994 
	`HMELev–MÙiÚS—rch
(
cu¼Sliû
, 
mv_block
, 
Ïmbda_çùÜ
);

997 
	}
}

999 
di¡blk
 
	$HMEBlockMÙiÚS—rch
(
MÙiÚVeùÜ
 **
p_pic_mv
, 
di¡blk
 **
p_pic_mco¡
, di¡blk **
p_pic_mdi¡
, 
MEBlock
 *
mv_block
, *
Ïmbda_çùÜ
)

1001 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1002 
li¡
 = 
mv_block
->list;

1004 
Ëv–
 = 
mv_block
->
hme_Ëv–
;

1006 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
], 
´ed
;

1007 
bx
 = 
mv_block
->
pos_x2
;

1008 
by
 = 
mv_block
->
pos_y2
;

1009 
di¡blk
 
mš_mco¡
 = 
DISTBLK_MAX
;

1012 
	`HMEG‘PMV
(
p_Vid
, 
p_pic_mv
, 
Ëv–
, 
bx
, 
by
, &
´ed
);

1013 
mv
->
mv_x
 = ((
´ed
.mv_x+1)>>2)<<2;

1014 
mv
->
mv_y
 = ((
´ed
.mv_y+1)>>2)<<2;

1017 
mš_mco¡
 = 
	`HME_EPZSIÁP–BlockMÙiÚS—rch_Enh
(&
´ed
, 
mv_block
, 
p_pic_mv
, 
p_pic_mco¡
, 
Ïmbda_çùÜ
[
F_PEL
] / 2);

1020 
p_pic_mv
[
by
][
bx
] = *
mv
;

1021 
p_pic_mco¡
[
by
][
bx
] = 
mš_mco¡
;

1022 
p_pic_mdi¡
[
by
][
bx
] = 
mš_mco¡
 - 
	`mv_co¡
(
p_Vid
, 
Ïmbda_çùÜ
[
F_PEL
], 
mv
, &
´ed
);

1025  
p_pic_mco¡
[
by
][
bx
];

1026 
	}
}

1028 
di¡blk
 
	$hme_G‘NeighbÜMECo¡
(
di¡blk
 **
pic_mco¡
, 
MEBlock
 *
mv_block
)

1030 
bx
 = 
mv_block
->
pos_x2
;

1031 
by
 = 
mv_block
->
pos_y2
;

1032 
Pix–Pos
 *
block
 = 
mv_block
->block;

1033 
di¡blk
 
¡ÝTh
;

1035 if(
block
[0].
avažabË
 && block[1].available)

1037 
¡ÝTh
 = 
	`di¡blkmš
(
pic_mco¡
[
by
][
bx
-1],…ic_mcost[by-1][bx]);

1039 if(
block
[0].
avažabË
)

1040 
¡ÝTh
 = 
pic_mco¡
[
by
][
bx
-1];

1041 if(
block
[1].
avažabË
)

1043 
¡ÝTh
 = 
pic_mco¡
[
by
-1][
bx
];

1046 
¡ÝTh
 = 0;

1047  
¡ÝTh
;

1048 
	}
}

1052 
di¡blk


1053 
	$hme_EPZSD‘”mšeStÝCr™”iÚ
 (
EPZSP¬am‘”s
 * 
p_EPZS
, 
di¡blk
 **
pic_mco¡
, 
MEBlock
 * 
mv_block
, di¡blk 
Ïmbda_di¡
)

1055 
blockty³
 = 
mv_block
->blocktype;

1057 
bx
 = 
mv_block
->
pos_x2
;

1058 
by
 = 
mv_block
->
pos_y2
;

1059 
Pix–Pos
 *
block
 = 
mv_block
->block;

1060 
di¡blk
 
§dA
, 
§dB
, 
§dC
, 
¡ÝCr™”iÚ
;

1061 
§dA
 = 
block
[0].
avažabË
 ? 
pic_mco¡
[
by
][
bx
-1] : 
DISTBLK_MAX
;

1062 
§dB
 = 
block
[1].
avažabË
 ? 
pic_mco¡
[
by
-1][
bx
] : 
DISTBLK_MAX
;

1063 
§dC
 = 
block
[2].
avažabË
 ? 
pic_mco¡
[
by
-1][
bx
+1] : (block[3].avažabË ?…ic_mco¡[by-1][bx-1] : 
DISTBLK_MAX
);

1065 
¡ÝCr™”iÚ
 = 
	`di¡blkmš
 (
§dA
, di¡blkmš (
§dB
, 
§dC
));

1066 
¡ÝCr™”iÚ
 = 
	`di¡blkmax
 (¡ÝCr™”iÚ, 
p_EPZS
->
mšth»s
[
blockty³
]);

1067 
¡ÝCr™”iÚ
 = 
	`di¡blkmš
 (¡ÝCr™”iÚ, 
p_EPZS
->
maxth»s
[
blockty³
] + 
Ïmbda_di¡
);

1068 
¡ÝCr™”iÚ
 = (9 * 
	`di¡blkmax
 (
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
, stopCriterion) + 2 *…_EPZS->medthres[blocktype]) >> 3;

1070  
¡ÝCr™”iÚ
 + 
Ïmbda_di¡
;

1071 
	}
}

1075 
	$hme_EPZSS·tŸlP»diùÜs
 (
EPZSP¬am‘”s
 * 
p_EPZS
,

1076 
MEBlock
 *
mv_block
,

1077 
MÙiÚVeùÜ
 **
pic_mv


1080 
Pix–Pos
 * 
block
 = 
mv_block
->block;

1081 
SPošt
 *
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1082 
blk_x
 = 
mv_block
->
pos_x2
;

1083 
blk_y
 = 
mv_block
->
pos_y2
;

1092 
	`as£¹
(
mv_block
->
blockty³
>=1);

1094 (
pošt
++)->
mÙiÚ
 = 
z”o_mv
;

1097 ià(
block
[0].
avažabË
)

1099 
pošt
->
mÙiÚ
 = 
pic_mv
[
blk_y
][(
blk_x
-1)];

1100 
pošt
 +ð(*(*)(&pošt->
mÙiÚ
)!=0);

1109 ià(
block
[1].
avažabË
)

1111 
pošt
->
mÙiÚ
 = 
pic_mv
[
blk_y
-1][
blk_x
];

1112 
pošt
 +ð(*(*)(&pošt->
mÙiÚ
)!=0);

1121 if(
block
[2].
avažabË
)

1123 
pošt
->
mÙiÚ
 = 
pic_mv
[
blk_y
-1][
blk_x
+1];

1125 
pošt
 +ð(*(*)(&pošt->
mÙiÚ
)!=0);

1134 ià(
block
[3].
avažabË
)

1136 
pošt
->
mÙiÚ
 = 
pic_mv
[
blk_y
-1][
blk_x
-1];

1138 
pošt
 +ð(*(*)(&pošt->
mÙiÚ
)!=0);

1146  (è(
pošt
 - 
p_EPZS
->
´ediùÜ
->point);

1147 
	}
}

1150 
	$hme_EPZSWšdowP»diùÜs
 (
MÙiÚVeùÜ
 * 
mv
, 
EPZSSŒuùu»
 * 
´ediùÜ
, *
´ednum
, EPZSSŒuùu» * 
wšdowP»d
, 
Ëv–
)

1152 
pos
;

1153 
SPošt
 *
wPošt
 = &
wšdowP»d
->
pošt
[0];

1154 
SPošt
 *
pPošt
 = &
´ediùÜ
->
pošt
[(*
´ednum
)];

1155 
MÙiÚVeùÜ
 
tmpMV
;

1156 
pos
 = 0;…o < 
wšdowP»d
->
£¬chPošts
; ++pos)

1158 
tmpMV
.
mv_x
 = (è((
wPošt
)->
mÙiÚ
.mv_x >> 
Ëv–
);

1159 
tmpMV
.
mv_y
 = (è((
wPošt
++)->
mÙiÚ
.mv_y>>
Ëv–
);

1160 (
pPošt
++)->
mÙiÚ
 = 
	`add_MVs
 (
tmpMV
, 
mv
);

1162 *
´ednum
 +ð
wšdowP»d
->
£¬chPošts
;

1163 
	}
}

1166 
di¡blk


1167 
	$HME_EPZSIÁP–BlockMÙiÚS—rch_Enh
 (

1168 
MÙiÚVeùÜ
 * 
´ed_mv
,

1169 
MEBlock
 * 
mv_block
,

1170 
MÙiÚVeùÜ
 **
pic_mv
,

1171 
di¡blk
 **
pic_mco¡
,

1172 
Ïmbda_çùÜ


1175 
VideoP¬am‘”s
 *
p_Vid
 = 
mv_block
->p_Vid;

1176 
Sliû
 *
cu¼Sliû
 = 
p_Vid
->
cu¼’tSliû
;

1177 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1178 
EPZSP¬am‘”s
 *
p_EPZS
 = 
cu¼Sliû
->p_EPZS;

1180 
blockty³
 = 
mv_block
->blocktype;

1182 
li¡
 = 
mv_block
->list;

1183 
cur_li¡
 = 
li¡
;

1184 
»f
 = 
mv_block
->
»f_idx
;

1185 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

1186 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

1187 
m­C’‹r_x
 = 
£¬chRªge
->
max_x
 - 
mv
->
mv_x
;

1188 
m­C’‹r_y
 = 
£¬chRªge
->
max_y
 - 
mv
->
mv_y
;

1189 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

1191 
di¡blk
 
Ïmbda_di¡
 = 
	`weigh‹d_co¡
(
Ïmbda_çùÜ
, 2);

1192 
di¡blk
 
¡ÝCr™”iÚ
 = 
p_EPZS
->
medth»s
[
blockty³
] + 
Ïmbda_di¡
;

1194 
di¡blk
 
mš_mco¡
 = 
DISTBLK_MAX
;

1195 
di¡blk
 
mco¡
 = 
DISTBLK_MAX
;

1198 
EPZSSŒuùu»
 *
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

1199 
ušt16
 **
EPZSM­
 = &
p_EPZS
->EPZSM­[
m­C’‹r_y
];

1200 
ušt16
 *
EPZSPošt
 = &
p_EPZS
->
EPZSM­
[
£¬chRªge
->
max_y
][£¬chRªge->
max_x
];

1202 
MÙiÚVeùÜ
 
ûÁ”
 = 
	`·d_MVs
 (*
mv
, 
mv_block
);

1203 
MÙiÚVeùÜ
 
´ed
 = 
	`·d_MVs
 (*
´ed_mv
, 
mv_block
);

1204 
MÙiÚVeùÜ
 
tmp
 = *
mv
, 
ÿnd
 = 
ûÁ”
, 
tmv
;

1206 
di¡blk
 
ÃighbÜ_di¡
 = 
	`hme_G‘NeighbÜMECo¡
(
pic_mco¡
, 
mv_block
);

1208 if(
ÃighbÜ_di¡
 == 0)

1209 
ÃighbÜ_di¡
 = (
di¡blk
)(
¡ÝCr™”iÚ
*0.5);

1211 ++
p_EPZS
->
BlkCouÁ
;

1212 ià(
p_EPZS
->
BlkCouÁ
 == 0)

1214 ++
p_EPZS
->
BlkCouÁ
;

1219 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

1222 
mš_mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

1225 
mš_mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
DISTBLK_MAX
-mš_mco¡, &
ÿnd
);

1229 
tmv
.
mv_x
 = ((
pic_mv
[
mv_block
->
pos_y2
][mv_block->
pos_x2
].mv_x+1)>>2)<<2;

1230 
tmv
.
mv_y
 = ((
pic_mv
[
mv_block
->
pos_y2
][mv_block->
pos_x2
].mv_y+1)>>2)<<2;

1231 if(*(*)&
tmv
 !ð*(*)&
tmp
)

1233 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

1235 
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
] = 
p_EPZS
->
BlkCouÁ
;

1236 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

1238 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

1239 if(
mco¡
 < 
mš_mco¡
)

1241 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
-mco¡, &
ÿnd
);

1243 if((
mco¡
 < 
mš_mco¡
))

1245 
tmp
 = 
tmv
;

1246 
mš_mco¡
 = 
mco¡
;

1253 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

1255 
SPošt
 *
p_EPZS_pošt
 = 
p_EPZS
->
´ediùÜ
->
pošt
;

1256 
BoÞ—n
 
checkMedŸn
 = 
FALSE
;

1257 
di¡blk
 
£cÚd_mco¡
 = 
DISTBLK_MAX
;

1258 
´ednum
 = 5;

1259 
cÚd™iÚEPZS
;

1260 
MÙiÚVeùÜ
 
tmp2
 = {0, 0};

1261 
pos
;

1265 if(
mv_block
->
block
[0].
avažabË
 || mv_block->block[1].available || mv_block->block[2].available || mv_block->block[3].available)

1266 
¡ÝCr™”iÚ
 = 
	`hme_EPZSD‘”mšeStÝCr™”iÚ
 (
p_EPZS
, 
pic_mco¡
, 
mv_block
, 
Ïmbda_di¡
);

1271 
´ednum
 = 
	`hme_EPZSS·tŸlP»diùÜs
(
p_EPZS
, 
mv_block
 , 
pic_mv
);

1297 
cÚd™iÚEPZS
 = ((
mš_mco¡
 > 3 * 
¡ÝCr™”iÚ
è&& ((
»f
 < 2 && 
blockty³
 < 4) || (ref < 1 && blocktype == 4))

1298 && (
p_IÅ
->
EPZSFixed
 > 1 || (p_IÅ->EPZSFixed && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
)è&& (
mv_block
->
hme_Ëv–
==
p_Vid
->
pHMEInfo
->
iPy¿midLev–s
-1));

1300 ià(
cÚd™iÚEPZS
)

1301 
	`hme_EPZSWšdowP»diùÜs
 (&
tmp
 , 
p_EPZS
->
´ediùÜ
, &
´ednum
,

1302 Ð(
»f
 < 1 + (
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 ))&& (
mš_mco¡
 > 2*
ÃighbÜ_di¡
))

1303 ? 
p_EPZS
->
wšdow_´ediùÜ_ext
 :…_EPZS->
wšdow_´ediùÜ
, 
mv_block
->
hme_Ëv–
);

1317 
pos
 = 0;…o < 
´ednum
; ++pos)

1319 
tmv
 = 
p_EPZS_pošt
[
pos
].
mÙiÚ
;

1321 ià((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
 <ð0è&& (Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
 <= 0))

1323 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

1324 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

1326 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

1327 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

1330 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

1332 ià(
mco¡
 < 
£cÚd_mco¡
)

1334 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
£cÚd_mco¡
 - mco¡, &
ÿnd
);

1337 ià(
mco¡
 < 
mš_mco¡
)

1339 
tmp2
 = 
tmp
;

1340 
tmp
 = 
tmv
;

1341 
£cÚd_mco¡
 = 
mš_mco¡
;

1342 
mš_mco¡
 = 
mco¡
;

1343 
checkMedŸn
 = 
TRUE
;

1346 ià(
mco¡
 < 
£cÚd_mco¡
)

1348 
tmp2
 = 
tmv
;

1349 
£cÚd_mco¡
 = 
mco¡
;

1350 
checkMedŸn
 = 
TRUE
;

1362 ià(
mš_mco¡
 > 
¡ÝCr™”iÚ
)

1364 cÚ¡ 
mv_¿nge
 = 10;

1365 
·‰”nStÝ
 = 0, 
poštNumb”
 = 0, 
checkPts
, 
ÃxtLa¡
 = 0;

1366 
tÙ®CheckPts
 = 0, 
mÙiÚDœeùiÚ
 = 0;

1369 ià(
p_IÅ
->
EPZSP©‹º
 != 0)

1371 ià((
mš_mco¡
 < 
¡ÝCr™”iÚ
 + ((3 * 
p_EPZS
->
medth»s
[
blockty³
]) >> 1)))

1373 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 == 0)

1374 || (
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range)))

1375 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

1377 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

1379 ià(
»f
 > 0 && 
blockty³
 != 1)

1380 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

1382 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹º
;

1386 
ûÁ”
 = 
tmp
;

1390 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

1393 
checkPts
 = 
tÙ®CheckPts
;

1396 
tmv
 = 
	`add_MVs
 (
ûÁ”
, &(
£¬chP©‹ºF
->
pošt
[
poštNumb”
].
mÙiÚ
));

1398 ià(((
	`Ÿbs
 (
tmv
.
mv_x
 - 
mv
->mv_xè- 
£¬chRªge
->
max_x
è<ð0è&& ((Ÿb Ñmv.
mv_y
 - mv->mv_yè- s—rchRªge->
max_y
) <= 0))

1400 
EPZSPošt
 = &
EPZSM­
[
tmv
.
mv_y
][
m­C’‹r_x
 +mv.
mv_x
];

1401 ià(*
EPZSPošt
 !ð
p_EPZS
->
BlkCouÁ
)

1403 *
EPZSPošt
 = 
p_EPZS
->
BlkCouÁ
;

1404 
ÿnd
 = 
	`·d_MVs
 (
tmv
, 
mv_block
);

1406 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

1407 ià(
mco¡
 < 
mš_mco¡
)

1409 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
 (
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

1411 ià(
mco¡
 < 
mš_mco¡
)

1413 
tmp
 = 
tmv
;

1414 
mš_mco¡
 = 
mco¡
;

1415 
mÙiÚDœeùiÚ
 = 
poštNumb”
;

1420 ++
poštNumb”
;

1421 ià(
poštNumb”
 >ð
£¬chP©‹ºF
->
£¬chPošts
)

1422 
poštNumb”
 -ð
£¬chP©‹ºF
->
£¬chPošts
;

1423 
checkPts
--;

1425 
checkPts
 > 0);

1427 ià(
ÃxtLa¡
 || ((
tmp
.
mv_x
 =ð
ûÁ”
.mv_xè&& (tmp.
mv_y
 == center.mv_y)))

1429 
·‰”nStÝ
 = 
£¬chP©‹ºF
->
¡ÝS—rch
;

1430 
£¬chP©‹ºF
 = s—rchP©‹ºF->
Ãx©‹º
;

1431 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
£¬chPošts
;

1432 
ÃxtLa¡
 = 
£¬chP©‹ºF
->nextLast;

1433 
mÙiÚDœeùiÚ
 = 0;

1434 
poštNumb”
 = 0;

1438 
tÙ®CheckPts
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
Ãxt_pošts
;

1439 
poštNumb”
 = 
£¬chP©‹ºF
->
pošt
[
mÙiÚDœeùiÚ
].
¡¬t_nmbr
;

1440 
ûÁ”
 = 
tmp
;

1443 
·‰”nStÝ
 != 1);

1446 
cÚd™iÚEPZS
 = (
checkMedŸn
 =ð
TRUE
)

1447 && (
»f
 =ð0 || (»à> 0 && 
mš_mco¡
 < 2 * 
ÃighbÜ_di¡
))

1448 && (
mš_mco¡
 > (Ð3 * 
¡ÝCr™”iÚ
è>> 1)è&& (
p_IÅ
->
EPZSDu®
 > 0);

1450 ià(!
cÚd™iÚEPZS
)

1453 
poštNumb”
 = 0;

1454 
·‰”nStÝ
 = 0;

1455 
mÙiÚDœeùiÚ
 = 0;

1456 
ÃxtLa¡
 = 0;

1458 ià((
tmp
.
mv_x
 =ð0 &&mp.
mv_y
 =ð0è|| (tmp.mv_x =ð
mv
->mv_x &&mp.mv_y == mv->mv_y))

1460 ià(
	`Ÿbs
 (
tmp
.
mv_x
 - 
mv
->mv_xè< (
mv_¿nge
è&& iab Ñmp.
mv_y
 - mv->mv_y) < (mv_range))

1461 
£¬chP©‹ºF
 = 
p_Vid
->
sdŸmÚd
;

1463 
£¬chP©‹ºF
 = 
p_Vid
->
squ¬e
;

1466 
£¬chP©‹ºF
 = 
p_EPZS
->
£¬chP©‹ºD
;

1469 
ûÁ”
 = 
tmp2
;

1470 
checkMedŸn
 = 
FALSE
;

1476 *
mv
 = 
tmp
;

1478  (
mš_mco¡
);

1479 
	}
}

1482 
	$hme_EPZSTempÜ®P»diùÜs
 (

1483 
HMEInfo_t
 *
pHMEInfo
,

1484 
EPZSP¬am‘”s
 * 
p_EPZS
,

1485 
MEBlock
 *
mv_block
,

1486 *
´ednum
,

1487 
di¡blk
 
¡ÝCr™”iÚ
,

1488 
di¡blk
 
mš_mco¡
)

1490 
o_block_x
 = 
mv_block
->
pos_x2
;

1491 
o_block_y
 = 
mv_block
->
pos_y2
;

1492 
li¡
 = 
mv_block
->list;

1493 
»f
 = 
mv_block
->
»f_idx
;

1494 
Pix–Pos
 * 
block
 = 
mv_block
->block;

1495 
SPošt
 * 
pošt
 = 
p_EPZS
->
´ediùÜ
->point;

1496 
mvSÿË
 = 
p_EPZS
->
mv_sÿË
[
li¡
][
»f
][0];

1497 
MÙiÚVeùÜ
 **
cÞ_mv
 = 
pHMEInfo
->
p_hme_mv
[
mv_block
->
hme_Ëv–
][
li¡
][0];

1498 
MÙiÚVeùÜ
 *
tmp_mv
, *
sÿËdMV
;

1500 
tmp_mv
 = 
cÞ_mv
[
o_block_y
]+
o_block_x
;

1501 if(*(*)(
tmp_mv
))

1503 
sÿËdMV
 = &
pošt
[(*
´ednum
)].
mÙiÚ
;

1504 
	`sÿË_mv
(
sÿËdMV
, 
mvSÿË
, 
tmp_mv
, 8);

1505 (*
´ednum
)++;

1509 ifÐ(
mš_mco¡
 > 
¡ÝCr™”iÚ
 && 
»f
 < 2) )

1512 ià(
block
[0].
avažabË
)

1514 
tmp_mv
 = 
cÞ_mv
[
o_block_y
]+(
o_block_x
 - 1);

1515 if(*(*)(
tmp_mv
))

1517 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, *
tmp_mv
, 
mvSÿË
, 8);

1521 ià(
block
[1].
avažabË
)

1523 
tmp_mv
 = 
cÞ_mv
[
o_block_y
 - 1] + 
o_block_x
;

1524 if(*(*)
tmp_mv
)

1526 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, *
tmp_mv
, 
mvSÿË
, 8);

1530 ià(
block
[2].
avažabË
)

1532 
tmp_mv
 = 
cÞ_mv
[
o_block_y
 - 1] + 
o_block_x
+1;

1533 if(*(*)
tmp_mv
)

1535 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, *
tmp_mv
, 
mvSÿË
, 8);

1539 ià(
block
[3].
avažabË
)

1541 
tmp_mv
 = 
cÞ_mv
[
o_block_y
 - 1] + 
o_block_x
-1;

1542 if(*(*)
tmp_mv
)

1544 *
´ednum
 +ð
	`add_´ediùÜ
 (&
pošt
[*´ednum].
mÙiÚ
, *
tmp_mv
, 
mvSÿË
, 8);

1548 
	}
}

	@lencod/src/me_umhex.c

26 
	~<lim™s.h
>

28 
	~"glob®.h
"

29 
	~"mem®loc.h
"

30 
	~"me_umhex.h
"

31 
	~"»fbuf.h
"

32 
	~"mb_acûss.h
"

33 
	~"image.h
"

34 
	~"’c_¡©i¡ics.h
"

35 
	~"maüoblock.h
"

36 
	~"me_di¡ÜtiÚ.h
"

37 
	~"mv_£¬ch.h
"

38 
	~"me_fuÎ£¬ch.h
"

40 
	#Q_BITS
 15

	)

41 
	#MIN_IMG_WIDTH
 176

	)

43 cÚ¡ 
MÙiÚVeùÜ
 
	gDŸmÚd
[4] = {{-4, 0}, {4, 0}, {0, -4}, {0, 4}};

44 cÚ¡ 
MÙiÚVeùÜ
 
	gHexagÚ
[6] = {{-8, 0}, {8, 0},{-4, -8}, {4, 8}, {-4, 8}, {4 , -8}};

45 cÚ¡ 
	gBig_HexagÚ_X
[16] = {0,-8, -16,-16,-16, -16, -16, -8, 0, 8, 16, 16, 16, 16, 16, 8};

46 cÚ¡ 
	gBig_HexagÚ_Y
[16] = {8, 12, 8, 4, 0, -4, -8, -12, -16, -12, -8, -4, 0, 4, 8, 12};

48 cÚ¡ 
	gMuÉi_Ref_Thd
[8] = {0, 300, 120, 120, 60, 30, 30, 15};

49 cÚ¡ 
	gBig_HexagÚ_Thd
[8] = {0, 3000, 1500, 1500, 800, 400, 400, 200};

50 cÚ¡ 
	gMedŸn_P»d_Thd
[8] = {0, 750, 350, 350, 170, 80, 80, 40};

51 cÚ¡ 
	gTh»shÞd_DSR
[8] = {0, 2200, 1000, 1000, 500, 250, 250, 120};

54 
	$UMHEX_DefšeTh»shÞd
(
VideoP¬am‘”s
 *
p_Vid
)

56 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

58 
p_UMHex
->
AÍhaFou¹h_1
[1] = 0.01f;

59 
p_UMHex
->
AÍhaFou¹h_1
[2] = 0.01f;

60 
p_UMHex
->
AÍhaFou¹h_1
[3] = 0.01f;

61 
p_UMHex
->
AÍhaFou¹h_1
[4] = 0.02f;

62 
p_UMHex
->
AÍhaFou¹h_1
[5] = 0.03f;

63 
p_UMHex
->
AÍhaFou¹h_1
[6] = 0.03f;

64 
p_UMHex
->
AÍhaFou¹h_1
[7] = 0.04f;

66 
p_UMHex
->
AÍhaFou¹h_2
[1] = 0.06f;

67 
p_UMHex
->
AÍhaFou¹h_2
[2] = 0.07f;

68 
p_UMHex
->
AÍhaFou¹h_2
[3] = 0.07f;

69 
p_UMHex
->
AÍhaFou¹h_2
[4] = 0.08f;

70 
p_UMHex
->
AÍhaFou¹h_2
[5] = 0.12f;

71 
p_UMHex
->
AÍhaFou¹h_2
[6] = 0.11f;

72 
p_UMHex
->
AÍhaFou¹h_2
[7] = 0.15f;

74 
p_UMHex
->
BlockTy³_LUT
[0][0] = 7;

75 
p_UMHex
->
BlockTy³_LUT
[0][1] = 6;

76 
p_UMHex
->
BlockTy³_LUT
[1][0] = 5;

77 
p_UMHex
->
BlockTy³_LUT
[1][1] = 4;

78 
p_UMHex
->
BlockTy³_LUT
[1][3] = 3;

79 
p_UMHex
->
BlockTy³_LUT
[3][1] = 2;

80 
p_UMHex
->
BlockTy³_LUT
[3][3] = 1;

83 
	}
}

93 
	$UMHEX_DefšeTh»shÞdMB
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

95 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

96 
gb_qp_³r
 = (
p_IÅ
->
qp
[
P_SLICE
])/6;

97 
gb_qp_»m
 = (
p_IÅ
->
qp
[
P_SLICE
])%6;

99 
gb_q_b™s
 = 
Q_BITS
+
gb_qp_³r
;

100 
gb_qp_cÚ¡
,
Th»sh4x4
;

102 
Quªtize_¡•
;

103 
i
;

105 
sÿË_çùÜ
 = ()((1-
p_IÅ
->
UMHexSÿË
*0.1)+p_IÅ->UMHexSÿË*0.1*(
p_Vid
->
width
/
MIN_IMG_WIDTH
));

107 
QP_çùÜ
 = ()((1.0-0.90*(
p_IÅ
->
qp
[
P_SLICE
]/51.0f)));

108 
di¡blk
 
dbSÿÏr
 = 
	`di¡_sÿË
(1);

110 
gb_qp_cÚ¡
=(1<<
gb_q_b™s
)/6;

111 
Th»sh4x4
 = ((1<<
gb_q_b™s
è- 
gb_qp_cÚ¡
)/
	`imax
(1, 
p_Vid
->
p_Quªt
->
q_·¿ms_4x4
[0][1][
gb_qp_»m
][0][0].
SÿËComp
);

112 
Quªtize_¡•
 = 
Th»sh4x4
/(4*5.61f)*2.0f*
sÿË_çùÜ
;

113 
p_UMHex
->
Bsize
[7]=(16*16)*
Quªtize_¡•
*
dbSÿÏr
;

115 
p_UMHex
->
Bsize
[6] =…_UMHex->Bsize[7]*4*
dbSÿÏr
;

116 
p_UMHex
->
Bsize
[5] =…_UMHex->Bsize[7]*4*
dbSÿÏr
;

117 
p_UMHex
->
Bsize
[4] =…_UMHex->Bsize[5]*4*
dbSÿÏr
;

118 
p_UMHex
->
Bsize
[3] =…_UMHex->Bsize[4]*4*
dbSÿÏr
;

119 
p_UMHex
->
Bsize
[2] =…_UMHex->Bsize[4]*4*
dbSÿÏr
;

120 
p_UMHex
->
Bsize
[1] =…_UMHex->Bsize[2]*4*
dbSÿÏr
;

122 
i
=1;i<8;i++)

125 
p_UMHex
->
MedŸn_P»d_Thd_MB
[
i
] = (
di¡blk
è(
MedŸn_P»d_Thd
[i]* 
sÿË_çùÜ
*
QP_çùÜ
*
dbSÿÏr
);

127 
p_UMHex
->
Big_HexagÚ_Thd_MB
[
i
] = (
di¡blk
è(
Big_HexagÚ_Thd
[i]* 
sÿË_çùÜ
*
QP_çùÜ
*
dbSÿÏr
);

129 
p_UMHex
->
MuÉi_Ref_Thd_MB
[
i
] = (
di¡blk
è(
MuÉi_Ref_Thd
[i] * 
sÿË_çùÜ
*
QP_çùÜ
*
dbSÿÏr
);

131 
p_UMHex
->
Th»shÞd_DSR_MB
[
i
] = (
di¡blk
è(
Th»shÞd_DSR
[i] * 
sÿË_çùÜ
*
QP_çùÜ
*
dbSÿÏr
);

133 
	}
}

141 
	$UMHEX_g‘_mem
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

143 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

145 
memÜy_size
 = 0;

146 
£¬ch_¿nge
 = 
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX
 ?…_Inp->search_range[0] :…_Inp->search_range[1];

148 ià(
NULL
==(
p_UMHex
->
æag_šŒa
 = 
	`ÿÎoc
 ((
p_Vid
->
width
>>4)+1,(
by‹
)))è
	`no_mem_ex™
("UMHEX_get_mem:…_UMHex->flag_intra");

150 
memÜy_size
 +ð
	`g‘_mem2D
(&
p_UMHex
->
Mco¡S‹
, 2*
£¬ch_¿nge
+1, 2*search_range+1);

152 
memÜy_size
 +ð
	`g‘_mem4Ddi¡blk
(&(
p_UMHex
->
ç¡me_»f_co¡
), 
p_Vid
->
max_num_»ã»nûs
, 9, 4, 4);

153 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&(
p_UMHex
->
ç¡me_l0_co¡
), 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

154 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&(
p_UMHex
->
ç¡me_l1_co¡
), 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

155 
memÜy_size
 +ð
	`g‘_mem2Ddi¡blk
(&(
p_UMHex
->
ç¡me_be¡_co¡
), 7, 
p_Vid
->
width
 >> 2);

157 
memÜy_size
 +ð
	`g‘_mem2D
(&
p_UMHex
->
S—rchS‹
, 7, 7);

158 if(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 == 1)

160 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&(
p_UMHex
->
ç¡me_l0_co¡_b»d
), 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

161 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&(
p_UMHex
->
ç¡me_l1_co¡_b»d
), 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

164  
memÜy_size
;

165 
	}
}

173 
	$UMHEX_ä“_mem
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

175 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

176 
	`ä“_mem2D
(
p_UMHex
->
Mco¡S‹
);

178 
	`ä“_mem4Ddi¡blk
(
p_UMHex
->
ç¡me_»f_co¡
);

179 
	`ä“_mem3Ddi¡blk
(
p_UMHex
->
ç¡me_l0_co¡
 );

180 
	`ä“_mem3Ddi¡blk
(
p_UMHex
->
ç¡me_l1_co¡
);

181 
	`ä“_mem2Ddi¡blk
(
p_UMHex
->
ç¡me_be¡_co¡
);

183 
	`ä“_mem2D
(
p_UMHex
->
S—rchS‹
);

184 
	`ä“
 (
p_UMHex
->
æag_šŒa
);

185 if(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 == 1)

187 
	`ä“_mem3Ddi¡blk
(
p_UMHex
->
ç¡me_l0_co¡_b»d
);

188 
	`ä“_mem3Ddi¡blk
(
p_UMHex
->
ç¡me_l1_co¡_b»d
);

190 
	`ä“
(
p_UMHex
);

191 
	}
}

223 
di¡blk


224 
	$UMHEXIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

225 
MÙiÚVeùÜ
 *
´ed_mv
,

226 
MEBlock
 *
mv_block
,

227 
di¡blk
 
mš_mco¡
,

228 
Ïmbda_çùÜ


231 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

232 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

233 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

234 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

236 
blockty³
 = 
mv_block
->blocktype;

237 
blocksize_x
 = 
mv_block
->blocksize_x;

238 
blocksize_y
 = 
mv_block
->blocksize_y;

239 
pic_pix_x2
 = 
mv_block
->
pos_x2
;

240 
block_x
 = 
mv_block
->block_x;

241 
block_y
 = 
mv_block
->block_y;

243 
li¡
 = 
mv_block
->list;

244 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

245 
»f
 = 
mv_block
->
»f_idx
;

246 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

248 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

249 
MÙiÚVeùÜ
 
iMšNow
, 
ÿnd
, 
ûÁ”
, 
´ed
, 
be¡
 = {0, 0};

251 
£¬ch_¡•
;

252 
pos
;

253 
di¡blk
 
mco¡
;

254 
di¡blk
 *
SAD_´ediùiÚ
 = 
p_UMHex
->
ç¡me_be¡_co¡
[
blockty³
-1];

255 
i
, 
j
, 
m
;

256 
b‘aFou¹h_1
,
b‘aFou¹h_2
;

257 
‹mp_Big_HexagÚ_X
[16];

258 
‹mp_Big_HexagÚ_Y
[16];

259 
di¡blk
 
ET_Th»d
 = 
p_UMHex
->
MedŸn_P»d_Thd_MB
[
blockty³
];

260 
£¬ch_¿nge
 = 
mv_block
->
£¬chRªge
.
max_x
 >> 2;

262 
pic_pix_x
 = 
mv_block
->
pos_x_·dded
;

263 
pic_pix_y
 = 
mv_block
->
pos_y_·dded
;

264 
´ed
.
mv_x
 = 
pic_pix_x
 + 
´ed_mv
->mv_x;

265 
´ed
.
mv_y
 = 
pic_pix_y
 + 
´ed_mv
->mv_y;

266 
ûÁ”
.
mv_x
 = 
pic_pix_x
 + 
mv
->mv_x;

267 
ûÁ”
.
mv_y
 = 
pic_pix_y
 + 
mv
->mv_y;

272 
	`mem£t
(
p_UMHex
->
Mco¡S‹
[0],0,(2*
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
]+1)*(2*p_Inp->search_range[p_Vid->view_id]+1));

277 
ÿnd
 = 
ûÁ”
;

278 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

280 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
(
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

282 
p_UMHex
->
Mco¡S‹
[
£¬ch_¿nge
][search_range] = 1;

283 ià(
mco¡
 < 
mš_mco¡
)

285 
mš_mco¡
 = 
mco¡
;

286 
be¡
 = 
ÿnd
;

289 
iMšNow
 = 
be¡
;

291 
m
 = 0; m < 4; m++)

293 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

294 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

295 
SEARCH_ONE_PIXEL


298 if(
ûÁ”
.
mv_x
 !ð
pic_pix_x
 || c’‹r.
mv_y
 !ð
pic_pix_y
)

300 
ÿnd
.
mv_x
 = 
pic_pix_x
 ;

301 
ÿnd
.
mv_y
 = 
pic_pix_y
 ;

302 
SEARCH_ONE_PIXEL


303 
iMšNow
 = 
be¡
;

304 
m
 = 0; m < 4; m++)

306 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

307 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

308 
SEARCH_ONE_PIXEL


313 if(
»f
>0 && 
cu¼Sliû
->
¡ruùu»
 =ð
FRAME
 && 
mš_mco¡
 > 
ET_Th»d
 && 
SAD_´ediùiÚ
[
pic_pix_x2
] < 
p_UMHex
->
MuÉi_Ref_Thd_MB
[
blockty³
])

314 
‹rmš©e_¡•
;

317 ifÐ
mš_mco¡
 < 
ET_Th»d
)

319 
‹rmš©e_¡•
;

324 
	`UMHEX_£tup
(
cu¼MB
, 
»f
, 
mv_block
->
li¡
, 
block_y
, 
block_x
, 
blockty³
, 
cu¼Sliû
->
®l_mv
 );

325 
ET_Th»d
 = 
p_UMHex
->
Big_HexagÚ_Thd_MB
[
blockty³
];

328 ià(
p_UMHex
->
´ed_SAD
 == 0)

330 
b‘aFou¹h_1
=0;

331 
b‘aFou¹h_2
=0;

335 
b‘aFou¹h_1
 = 
p_UMHex
->
Bsize
[
blockty³
]/((í_UMHex->
´ed_SAD
 *…_UMHex->´ed_SAD)-p_UMHex->
AÍhaFou¹h_1
[blocktype];

336 
b‘aFou¹h_2
 = 
p_UMHex
->
Bsize
[
blockty³
]/((í_UMHex->
´ed_SAD
 *…_UMHex->´ed_SAD)-p_UMHex->
AÍhaFou¹h_2
[blocktype];

343 if(
blockty³
>1)

345 
ÿnd
.
mv_x
 = (è(
pic_pix_x
 + (
p_UMHex
->
´ed_MV_u¶ay”
[0] / 4) * 4);

346 
ÿnd
.
mv_y
 = (è(
pic_pix_y
 + (
p_UMHex
->
´ed_MV_u¶ay”
[1] / 4) * 4);

347 
SEARCH_ONE_PIXEL


352 if(
p_UMHex
->
´ed_MV_»f_æag
 == 1)

354 
ÿnd
.
mv_x
 = (è(
pic_pix_x
 + (
p_UMHex
->
´ed_MV_»f
[0] / 4) * 4);

355 
ÿnd
.
mv_y
 = (è(
pic_pix_y
 + (
p_UMHex
->
´ed_MV_»f
[1] / 4) * 4);

356 
SEARCH_ONE_PIXEL


359 
iMšNow
 = 
be¡
;

360 
m
 = 0; m < 4; m++)

362 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

363 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

364 
SEARCH_ONE_PIXEL


368 
EARLY_TERMINATION


370 if(
blockty³
>6)

371 
fou¹h_1_¡•
;

373 
£c_¡•
;

375 
£c_¡•
:

376 
iMšNow
 = 
be¡
;

378 
i
 = 4; i < 
£¬ch_¿nge
 << 2; i+=8)

380 
£¬ch_¡•
 = 
i
;

381 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
£¬ch_¡•
);

382 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y ;

383 
SEARCH_ONE_PIXEL


384 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x - 
£¬ch_¡•
);

385 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y ;

386 
SEARCH_ONE_PIXEL


388 
i
 = 4; i < (
£¬ch_¿nge
 << 1);i+=8)

390 
£¬ch_¡•
 = 
i
;

391 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x ;

392 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
£¬ch_¡•
);

393 
SEARCH_ONE_PIXEL


394 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x ;

395 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y - 
£¬ch_¡•
);

396 
SEARCH_ONE_PIXEL


401 
EARLY_TERMINATION


403 
iMšNow
 = 
be¡
;

407 
pos
=1;pos<25;pos++)

409 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_x;

410 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_y;

411 
SEARCH_ONE_PIXEL


415 
EARLY_TERMINATION


418 
	`memýy
(
‹mp_Big_HexagÚ_X
,
Big_HexagÚ_X
,64);

419 
	`memýy
(
‹mp_Big_HexagÚ_Y
,
Big_HexagÚ_Y
,64);

420 
i
=1;i<=(
£¬ch_¿nge
 >> 2); i++)

423 
m
 = 0; m < 16; m++)

425 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
‹mp_Big_HexagÚ_X
[
m
]);

426 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
‹mp_Big_HexagÚ_Y
[
m
]);

427 
‹mp_Big_HexagÚ_X
[
m
] +ð
Big_HexagÚ_X
[m];

428 
‹mp_Big_HexagÚ_Y
[
m
] +ð
Big_HexagÚ_Y
[m];

430 
SEARCH_ONE_PIXEL


433 if(
mš_mco¡
 < 
ET_Th»d
)

435 
‹rmš©e_¡•
;

442 
fou¹h_1_¡•
:

443 
i
 = 0; i < 
£¬ch_¿nge
; i++)

445 
iMšNow
 = 
be¡
;

446 
m
 = 0; m < 6; m++)

448 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

449 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

450 
SEARCH_ONE_PIXEL


453 ià(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

458 
fou¹h_2_¡•
:

460 
i
 = 0; i < 
£¬ch_¿nge
; i++)

462 
iMšNow
 = 
be¡
;

463 
m
 = 0; m < 4; m++)

465 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

466 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

467 
SEARCH_ONE_PIXEL


469 if(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

473 
‹rmš©e_¡•
:

477 
i
=0; i < (
blocksize_x
>>2); i++)

479 
j
=0; j < (
blocksize_y
>>2); j++)

481 if(
mv_block
->
li¡
 == 0)

483 
p_UMHex
->
ç¡me_»f_co¡
[
»f
][
blockty³
][
block_y
+
j
][
block_x
+
i
] = 
mš_mco¡
;

484 ià(
»f
==0)

485 
p_UMHex
->
ç¡me_l0_co¡
[
blockty³
][(
cu¼MB
->
block_y
)+block_y+
j
][(cu¼MB->
block_x
)+block_x+
i
] = 
mš_mco¡
;

489 
p_UMHex
->
ç¡me_l1_co¡
[
blockty³
][(
cu¼MB
->
block_y
)+block_y+
j
][(cu¼MB->
block_x
)+block_x+
i
] = 
mš_mco¡
;

494 ià((
»f
==0è|| (
SAD_´ediùiÚ
[
pic_pix_x2
] > 
mš_mco¡
))

495 
SAD_´ediùiÚ
[
pic_pix_x2
] = 
mš_mco¡
;

497 
mv
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

498 
mv
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

499  
mš_mco¡
;

500 
	}
}

502 
di¡blk


503 
	$UMHEXSubP–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

504 
MÙiÚVeùÜ
 *
´ed_mv
,

505 
MEBlock
 *
mv_block
,

506 
di¡blk
 
mš_mco¡
,

507 
Ïmbda_çùÜ


510 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

511 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

512 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

513 cÚ¡ 
MÙiÚVeùÜ
 
DŸmÚdQ
[4] = {{-1, 0}, { 0, 1}, { 1, 0}, { 0, -1}};

514 
di¡blk
 
mco¡
;

515 
MÙiÚVeùÜ
 
ÿnd
, 
iMšNow
, 
cu¼mv
 = {0, 0}, 
ÿnd_·d
;

517 
li¡
 = 
mv_block
->list;

518 
li¡_off£t
 = 
cu¼MB
->list_offset;

519 
»f
 = 
mv_block
->
»f_idx
;

520 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

522 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
li¡
+
li¡_off£t
][
»f
];

524 
dyÇmic_£¬ch_¿nge
 = 3, 
i
;

525 
m
;

526 
´ed_äac_mv_x
,
´ed_äac_mv_y
,
abÜt_£¬ch
;

530 
´ed_äac_mv_x
 = (
´ed_mv
->
mv_x
 - 
mv
->mv_x) & 0x03;

531 
´ed_äac_mv_y
 = (
´ed_mv
->
mv_y
 - 
mv
->mv_y) & 0x03;

537 
	`mem£t
(
p_UMHex
->
S—rchS‹
[0], 0,(2 * 
dyÇmic_£¬ch_¿nge
 + 1)*(2 * dynamic_search_range + 1));

539 ifÐ!
p_Vid
->
¡¬t_me_»fšem’t_hp
 )

541 
p_UMHex
->
S—rchS‹
[
dyÇmic_£¬ch_¿nge
][dynamic_search_range] = 1;

542 
ÿnd
 = *
mv
;

543 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

544 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

545 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

547 ià(
mco¡
 < 
mš_mco¡
)

549 
mš_mco¡
 = 
mco¡
;

550 
cu¼mv
 = 
ÿnd
;

555 
p_UMHex
->
S—rchS‹
[
dyÇmic_£¬ch_¿nge
][dynamic_search_range] = 1;

556 
cu¼mv
 = *
mv
;

559 if(
´ed_äac_mv_x
!=0 || 
´ed_äac_mv_y
!=0)

561 
ÿnd
.
mv_x
 = (è(
mv
->mv_x + 
´ed_äac_mv_x
);

562 
ÿnd
.
mv_y
 = (è(
mv
->mv_y + 
´ed_äac_mv_y
);

563 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

564 
p_UMHex
->
S—rchS‹
[
ÿnd
.
mv_y
 -
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 - mv->mv_x + dynamic_search_range] = 1;

565 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

567 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

569 ià(
mco¡
 < 
mš_mco¡
)

571 
mš_mco¡
 = 
mco¡
;

572 
cu¼mv
 = 
ÿnd
;

576 
iMšNow
 = 
cu¼mv
;

578 
i
 = 0; i < 
dyÇmic_£¬ch_¿nge
; i++)

580 
abÜt_£¬ch
=1;

581 
m
 = 0; m < 4; m++)

583 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚdQ
[
m
].mv_x;

584 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚdQ
[
m
].mv_y;

586 if(
	`Ÿbs
(
ÿnd
.
mv_x
 - 
mv
->mv_xè<ð
dyÇmic_£¬ch_¿nge
 && iabs(ÿnd.
mv_y
 - mv->mv_y) <= dynamic_search_range)

588 if(!
p_UMHex
->
S—rchS‹
[
ÿnd
.
mv_y
 -
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 -mv->mv_x + dynamic_search_range])

590 
p_UMHex
->
S—rchS‹
[
ÿnd
.
mv_y
 -
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 -mv->mv_x + dynamic_search_range] = 1;

591 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

592 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

594 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

595 ià(
mco¡
 < 
mš_mco¡
)

597 
mš_mco¡
 = 
mco¡
;

598 
cu¼mv
 = 
ÿnd
;

599 
abÜt_£¬ch
 = 0;

604 
iMšNow
 = 
cu¼mv
;

605 if(
abÜt_£¬ch
)

611 *
mv
 = 
cu¼mv
;

614  
mš_mco¡
;

615 
	}
}

617 
di¡blk


618 
	$UMHEXSubP–BlockME
 (
Maüoblock
 *
cu¼MB
,

619 
MÙiÚVeùÜ
 *
´ed_mv
,

620 
MEBlock
 *
mv_block
,

621 
di¡blk
 
mš_mco¡
,

622 * 
Ïmbda


625 if(
mv_block
->
blockty³
 >3)

627 
mš_mco¡
 = 
	`UMHEXSubP–BlockMÙiÚS—rch
 (
cu¼MB
, 
´ed_mv
, 
mv_block
, mš_mco¡, 
Ïmbda
[
Q_PEL
]);

631 
mš_mco¡
 = 
	`sub_³l_mÙiÚ_e¡im©iÚ
 (
cu¼MB
, 
´ed_mv
, 
mv_block
, mš_mco¡, 
Ïmbda
);

634  
mš_mco¡
;

635 
	}
}

649 
	$UMHEX_decide_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
)

651 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

652 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

653 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

654 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

656 ià(
cu¼MB
->
pix_x
 =ð0 && cu¼MB->
pix_y
 == 0)

658 
p_UMHex
->
æag_šŒa_SAD
 = 0;

660 ià(
cu¼MB
->
pix_x
 == 0)

662 
p_UMHex
->
æag_šŒa_SAD
 =…_UMHex->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4];

664 ià(
cu¼MB
->
pix_y
 == 0)

666 
p_UMHex
->
æag_šŒa_SAD
 =…_UMHex->
æag_šŒa
[((
cu¼MB
->
pix_x
)>>4)-1];

670 
p_UMHex
->
æag_šŒa_SAD
 = (Õ_UMHex->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4])||(p_UMHex->flag_intra[((currMB->pix_x)>>4)-1])||(p_UMHex->flag_intra[((currMB->pix_x)>>4)+1])) ;

674 
	}
}

676 
	$UMHEX_sk_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
, 
»f_max
)

678 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

679 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

680 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

681 
i
,
j
,
k
, 
»f
;

682 ià(
p_Vid
->
numb”
 > 0)

683 
p_UMHex
->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4] = (cu¼MB->
be¡_mode
 == 9 || currMB->best_mode == 10) ? 1:0;

685 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
 && (
cu¼MB
->
be¡_mode
 == 9 || currMB->best_mode == 10))

687 
k
=0; k < 9;k++)

689 
j
=0; j < 4; j++)

691 
i
=0; i < 4; i++)

693 
p_UMHex
->
ç¡me_l0_co¡
[
k
][
j
][
i
] = 0;

694 
p_UMHex
->
ç¡me_l1_co¡
[
k
][
j
][
i
] = 0;

696 
»f
=0;„eà< 
»f_max
;ref++)

698 
p_UMHex
->
ç¡me_»f_co¡
[
»f
][
k
][
j
][
i
] = 0;

706 
	}
}

709 
	$UMHEX_£tup
(
Maüoblock
 *
cu¼MB
, 
»f
, 
li¡
, 
block_y
, 
block_x
, 
blockty³
, 
MÙiÚVeùÜ
 *****
®l_mv
)

711 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

712 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

713 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

715 
N_Bäame
=0;

716 
n_Bäame
=0;

717 
‹mp_blockty³
 = 0;

718 
šdiÿtiÚ_blockty³
[8]={0,0,1,1,2,4,4,5};

719 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

720 
N_Bäame
 = 
p_IÅ
->
Numb”BF¿mes
;

721 
n_Bäame
 =(
N_Bäame
è? (
p_Vid
->
p_Sts
->
äame_ùr
[
B_SLICE
]%(N_Bframe+1)): 0;

726 ià(
blockty³
>1)

728 
‹mp_blockty³
 = 
šdiÿtiÚ_blockty³
[
blockty³
];

729 
p_UMHex
->
´ed_MV_u¶ay”
[0] = 
®l_mv
[
li¡
][
»f
][
‹mp_blockty³
][
block_y
][
block_x
].
mv_x
;

730 
p_UMHex
->
´ed_MV_u¶ay”
[1] = 
®l_mv
[
li¡
][
»f
][
‹mp_blockty³
][
block_y
][
block_x
].
mv_y
;

735 
p_UMHex
->
´ed_MV_»f_æag
 = 0;

736 if(
li¡
==0)

738 ià(
p_Vid
->
f›ld_piùu»
)

740 iàÐ
»f
 > 1)

742 
p_UMHex
->
´ed_MV_»f
[0] = 
®l_mv
[0][
»f
-2][
blockty³
][
block_y
][
block_x
].
mv_x
;

743 
p_UMHex
->
´ed_MV_»f
[0] = ()Õ_UMHex->´ed_MV_»f[0]*((
»f
>>1)+1)/()((ref>>1)));

744 
p_UMHex
->
´ed_MV_»f
[1] = 
®l_mv
[0][
»f
-2][
blockty³
][
block_y
][
block_x
].
mv_y
;

745 
p_UMHex
->
´ed_MV_»f
[1] = ()Õ_UMHex->´ed_MV_»f[1]*((
»f
>>1)+1)/()((ref>>1)));

746 
p_UMHex
->
´ed_MV_»f_æag
 = 1;

748 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && (
»f
==0 ||„ef==1) )

750 
p_UMHex
->
´ed_MV_»f
[0] =(è(
®l_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_x
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

751 
p_UMHex
->
´ed_MV_»f
[1] =(è(
®l_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_y
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

752 
p_UMHex
->
´ed_MV_»f_æag
 = 1;

757 iàÐ
»f
 > 0)

759 
p_UMHex
->
´ed_MV_»f
[0] = 
®l_mv
[0][
»f
-1][
blockty³
][
block_y
][
block_x
].
mv_x
;

760 
p_UMHex
->
´ed_MV_»f
[0] = ()Õ_UMHex->´ed_MV_»f[0]*(
»f
+1)/()(ref));

761 
p_UMHex
->
´ed_MV_»f
[1] = 
®l_mv
[0][
»f
-1][
blockty³
][
block_y
][
block_x
].
mv_y
;

762 
p_UMHex
->
´ed_MV_»f
[1] = ()Õ_UMHex->´ed_MV_»f[1]*(
»f
+1)/()(ref));

763 
p_UMHex
->
´ed_MV_»f_æag
 = 1;

765 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && (
»f
==0))

767 
p_UMHex
->
´ed_MV_»f
[0] =(è(
®l_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_x
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

768 
p_UMHex
->
´ed_MV_»f
[1] =(è(
®l_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_y
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

769 
p_UMHex
->
´ed_MV_»f_æag
 = 1;

774 ià(
li¡
==0 && 
»f
>0)

777 ià(
p_UMHex
->
æag_šŒa_SAD
)

779 
p_UMHex
->
´ed_SAD
 = 0;

783 ià(
p_Vid
->
f›ld_piùu»
)

785 ià(
»f
 > 1)

787 
p_UMHex
->
´ed_SAD
 =…_UMHex->
ç¡me_»f_co¡
[
»f
-2][
blockty³
][
block_y
][
block_x
];

791 
p_UMHex
->
´ed_SAD
 =…_UMHex->
ç¡me_»f_co¡
[0][
blockty³
][
block_y
][
block_x
];

796 
p_UMHex
->
´ed_SAD
 =…_UMHex->
ç¡me_»f_co¡
[
»f
-1][
blockty³
][
block_y
][
block_x
];

801 ià(
blockty³
>1)

803 ià(
p_UMHex
->
æag_šŒa_SAD
)

805 
p_UMHex
->
´ed_SAD
 = 0;

809 
p_UMHex
->
´ed_SAD
 = (
li¡
==1è? (p_UMHex->
ç¡me_l1_co¡
[
‹mp_blockty³
][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x]è: (p_UMHex->
ç¡me_l0_co¡
[temp_blocktype][(currMB->block_y)+block_y][(currMB->block_x)+block_x]);

810 
p_UMHex
->
´ed_SAD
 /= 2;

813 
p_UMHex
->
´ed_SAD
 = 0 ;

815 
	}
}

832 
di¡blk


833 
	$UMHEXB»dIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

834 
li¡
,

835 
MÙiÚVeùÜ
 *
´ed_mv1
,

836 
MÙiÚVeùÜ
 *
´ed_mv2
,

837 
MÙiÚVeùÜ
 *
mv1
,

838 
MÙiÚVeùÜ
 *
mv2
,

839 
MEBlock
 *
mv_block
,

840 
£¬ch_¿nge
,

841 
di¡blk
 
mš_mco¡
,

842 
Ïmbda_çùÜ


845 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

846 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

847 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

848 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

849 
‹mp_Big_HexagÚ_X
[16];

850 
‹mp_Big_HexagÚ_Y
[16];

852 
£¬ch_¡•
;

853 
i
,
m
,
j
;

854 
b‘aFou¹h_1
,
b‘aFou¹h_2
;

855 
pos
;

856 
di¡blk
 
mco¡
;

857 
blockty³
 = 
mv_block
->blocktype;

858 
blocksize_x
 = 
mv_block
->blocksize_x;

859 
blocksize_y
 = 
mv_block
->blocksize_y;

861 
pic_pix_x
 = 
mv_block
->
pos_x_·dded
;

862 
pic_pix_y
 = 
mv_block
->
pos_y_·dded
;

864 
block_x
 = 
mv_block
->block_x;

865 
block_y
 = 
mv_block
->block_y;

866 
di¡blk
 
ET_Th»d
 = 
p_UMHex
->
MedŸn_P»d_Thd_MB
[
blockty³
];

867 
»f
 = 
mv_block
->
»f_idx
;

869 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
»f
];

870 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[
li¡
 =ð0 ? 1 + 
cu¼MB
->
li¡_off£t
: currMB->list_offset][ 0 ];

872 
MÙiÚVeùÜ
 
iMšNow
, 
be¡
, 
ÿnd
;

874 
MÙiÚVeùÜ
 
´ed1
 = 
	`·d_MVs
(*
´ed_mv1
, 
mv_block
);

875 
MÙiÚVeùÜ
 
´ed2
 = 
	`·d_MVs
(*
´ed_mv2
, 
mv_block
);

876 
MÙiÚVeùÜ
 
ûÁ”1
 = 
	`·d_MVs
(*
mv1
, 
mv_block
);

877 
MÙiÚVeùÜ
 
ûÁ”2
 = 
	`·d_MVs
(*
mv2
, 
mv_block
);

880 
£¬ch_¿nge
 >>= 2;

884 
	`mem£t
(
p_UMHex
->
Mco¡S‹
[0],0,(2*
£¬ch_¿nge
+1)*(2*search_range+1));

887 
be¡
 = 
ÿnd
 = 
ûÁ”2
;

888 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ûÁ”1
, &
´ed1
);

889 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed2
);

890 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block, 
DISTBLK_MAX
-mco¡, &
ûÁ”1
, &
ÿnd
);

892 
p_UMHex
->
Mco¡S‹
[
£¬ch_¿nge
][search_range] = 1;

894 ià(
mco¡
 < 
mš_mco¡
)

896 
mš_mco¡
 = 
mco¡
;

897 
be¡
 = 
ÿnd
;

900 
iMšNow
 = 
be¡
;

901 
m
 = 0; m < 4; m++)

903 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

904 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

905 
SEARCH_ONE_PIXEL_BIPRED
;

908 if(
ûÁ”2
.
mv_x
 !ð
pic_pix_x
 || c’‹r2.
mv_y
 !ð
pic_pix_y
)

910 
ÿnd
.
mv_x
 = 
pic_pix_x
 ;

911 
ÿnd
.
mv_y
 = 
pic_pix_y
 ;

912 
SEARCH_ONE_PIXEL_BIPRED
;

914 
iMšNow
 = 
be¡
;

916 
m
 = 0; m < 4; m++)

918 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

919 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

920 
SEARCH_ONE_PIXEL_BIPRED
;

925 ifÐ
mš_mco¡
 < 
ET_Th»d
)

927 
‹rmš©e_¡•
;

931 
N_Bäame
=0;

932 
n_Bäame
=0;

933 
MÙiÚVeùÜ
 *****
b»d_mv
 = 
cu¼Sliû
->b»d_mv[
li¡
];

934 
N_Bäame
 = 
p_IÅ
->
Numb”BF¿mes
;

935 
n_Bäame
 = 
p_Vid
->
p_Sts
->
äame_ùr
[
B_SLICE
]%(
N_Bäame
+1);

944 if(
li¡
==0)

946 ià(
p_Vid
->
f›ld_piùu»
)

948 
p_UMHex
->
´ed_MV_»f
[0] =(è(
b»d_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_x
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

949 
p_UMHex
->
´ed_MV_»f
[1] =(è(
b»d_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_y
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

953 
p_UMHex
->
´ed_MV_»f
[0] =(è(
b»d_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_x
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

954 
p_UMHex
->
´ed_MV_»f
[1] =(è(
b»d_mv
[1][0][
blockty³
][
block_y
][
block_x
].
mv_y
 * (-
n_Bäame
)/(
N_Bäame
-n_Bframe+1.0f));

958 
p_UMHex
->
´ed_SAD
 =
	`di¡blkmš
(di¡blkmšÕ_UMHex->
SAD_a
,p_UMHex->
SAD_b
),p_UMHex->
SAD_c
);

959 
ET_Th»d
 = 
p_UMHex
->
Big_HexagÚ_Thd_MB
[
blockty³
];

962 ià(
p_UMHex
->
´ed_SAD
 == 0)

964 
b‘aFou¹h_1
=0;

965 
b‘aFou¹h_2
=0;

969 
b‘aFou¹h_1
 = 
p_UMHex
->
Bsize
[
blockty³
]/Õ_UMHex->
´ed_SAD
 *…_UMHex->´ed_SAD)-p_UMHex->
AÍhaFou¹h_1
[blocktype];

970 
b‘aFou¹h_2
 = 
p_UMHex
->
Bsize
[
blockty³
]/Õ_UMHex->
´ed_SAD
 *…_UMHex->´ed_SAD)-p_UMHex->
AÍhaFou¹h_2
[blocktype];

980 if(
li¡
 == 0)

982 
ÿnd
.
mv_x
 = (è(
pic_pix_x
 + (
p_UMHex
->
´ed_MV_»f
[0] / 4) * 4);

983 
ÿnd
.
mv_y
 = (è(
pic_pix_y
 + (
p_UMHex
->
´ed_MV_»f
[1] / 4) * 4);

984 
SEARCH_ONE_PIXEL_BIPRED
;

989 
iMšNow
 = 
be¡
;

990 
m
 = 0; m < 4; m++)

992 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

993 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

994 
SEARCH_ONE_PIXEL_BIPRED
;

998 
EARLY_TERMINATION
;

1002 
iMšNow
 = 
be¡
;

1004 
i
 = 1; i < 
£¬ch_¿nge
; i+=2)

1006 
£¬ch_¡•
 = 
i
;

1007 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
£¬ch_¡•
);

1008 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y ;

1009 
SEARCH_ONE_PIXEL_BIPRED
;

1010 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x - 
£¬ch_¡•
);

1011 
SEARCH_ONE_PIXEL_BIPRED
;

1014 
i
 = 1; i < (
£¬ch_¿nge
 >> 1);i+=2)

1016 
£¬ch_¡•
 = 
i
;

1017 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x ;

1018 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
£¬ch_¡•
);

1019 
SEARCH_ONE_PIXEL_BIPRED
;

1020 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y - 
£¬ch_¡•
);

1021 
SEARCH_ONE_PIXEL_BIPRED
;

1024 
EARLY_TERMINATION
;

1027 
iMšNow
 = 
be¡
;

1029 
pos
=1;pos<25;pos++)

1031 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_x;

1032 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
p_Vid
->
¥œ®_q³l_£¬ch
[
pos
].mv_y;

1033 
SEARCH_ONE_PIXEL_BIPRED
;

1037 
EARLY_TERMINATION
;

1040 
	`memýy
(
‹mp_Big_HexagÚ_X
,
Big_HexagÚ_X
,64);

1041 
	`memýy
(
‹mp_Big_HexagÚ_Y
,
Big_HexagÚ_Y
,64);

1042 
i
=1;i<=(
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
] >> 2); i++)

1045 
m
 = 0; m < 16; m++)

1047 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
‹mp_Big_HexagÚ_X
[
m
]);

1048 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
‹mp_Big_HexagÚ_Y
[
m
]);

1049 
‹mp_Big_HexagÚ_X
[
m
] +ð
Big_HexagÚ_X
[m];

1050 
‹mp_Big_HexagÚ_Y
[
m
] +ð
Big_HexagÚ_Y
[m];

1052 
SEARCH_ONE_PIXEL_BIPRED
;

1054 if(
mš_mco¡
 < 
ET_Th»d
)

1056 
‹rmš©e_¡•
;

1061 
fou¹h_1_¡•
:

1063 
i
=0; i < 
£¬ch_¿nge
; i++)

1065 
iMšNow
 = 
be¡
;

1066 
m
 = 0; m < 6; m++)

1068 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

1069 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

1070 
SEARCH_ONE_PIXEL_BIPRED
;

1072 if(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

1075 
fou¹h_2_¡•
:

1077 
i
 = 0; i < 
£¬ch_¿nge
; i++)

1079 
iMšNow
 = 
be¡
;

1080 
m
 = 0; m < 4; m++)

1082 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

1083 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

1084 
SEARCH_ONE_PIXEL_BIPRED
;

1086 if(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

1090 
‹rmš©e_¡•
:

1091 
i
=0; i < (
blocksize_x
>>2); i++)

1093 
j
=0; j < (
blocksize_y
>>2); j++)

1095 if(
li¡
 == 0)

1097 
p_UMHex
->
ç¡me_l0_co¡_b»d
[
blockty³
][(
cu¼MB
->
block_y
)+block_y+
j
][(cu¼MB->
block_x
)+block_x+
i
] = 
mš_mco¡
;

1101 
p_UMHex
->
ç¡me_l1_co¡_b»d
[
blockty³
][(
cu¼MB
->
block_y
)+block_y+
j
][(cu¼MB->
block_x
)+block_x+
i
] = 
mš_mco¡
;

1106 
mv1
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

1107 
mv1
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

1109  
mš_mco¡
;

1110 
	}
}

1118 
	$UMHEXS‘MÙiÚVeùÜP»diùÜ
 (
Maüoblock
 *
cu¼MB
,

1119 
MÙiÚVeùÜ
 *
pmv
,

1120 
pic_mÙiÚ_·¿ms
 **
mv_šfo
,

1121 
»f_äame
,

1122 
li¡
,

1123 
mb_x
,

1124 
mb_y
,

1125 
blocksh­e_x
,

1126 
blocksh­e_y
,

1127 
MEBlock
 *
mv_block
)

1129 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1130 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1131 
UMHexSŒuù
 *
p_UMHex
 = 
p_Vid
->p_UMHex;

1132 
mv_a
, 
mv_b
, 
mv_c
;

1133 
´ed_vec
=0;

1134 
mvP»dTy³
, 
rF¿meL
, 
rF¿meU
, 
rF¿meUR
;

1135 
hv
;

1137 
Pix–Pos
 
block_a
, 
block_b
, 
block_c
, 
block_d
;

1140 
di¡blk
 *** 
ç¡me_l0_co¡_æag
 = (
p_UMHex
->
b»d_æag
 ?…_UMHex->
ç¡me_l0_co¡_b»d
 :…_UMHex->
ç¡me_l0_co¡
);

1141 
di¡blk
 *** 
ç¡me_l1_co¡_æag
 = (
p_UMHex
->
b»d_æag
 ?…_UMHex->
ç¡me_l1_co¡_b»d
 :…_UMHex->
ç¡me_l1_co¡
);

1144 
d¤_‹mp_£¬ch_¿nge
[2];

1145 
d¤_mv_avaž
, 
d¤_mv_max
, 
d¤_mv_sum
, 
d¤_sm®l_£¬ch_¿nge
;

1146 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

1149 
p_UMHex
->
SAD_a
 = 0;

1150 
p_UMHex
->
SAD_b
 = 0;

1151 
p_UMHex
->
SAD_c
 = 0;

1152 
p_UMHex
->
SAD_d
 = 0;

1154 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 - 1 , 
mb_y
 , 
mb_size
, &
block_a
);

1155 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 , 
mb_y
 - 1, 
mb_size
, &
block_b
);

1156 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 + 
blocksh­e_x
, 
mb_y
 - 1, 
mb_size
, &
block_c
);

1157 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 - 1 , 
mb_y
 - 1, 
mb_size
, &
block_d
);

1159 ià(
mb_y
 > 0)

1161 ià(
mb_x
 < 8)

1163 ià(
mb_y
==8)

1165 ià(
blocksh­e_x
 =ð16è
block_c
.
avažabË
 = 0;

1169 ià(
mb_x
+
blocksh­e_x
 =ð8è
block_c
.
avažabË
 = 0;

1174 ià(
mb_x
+
blocksh­e_x
 =ð16è
block_c
.
avažabË
 = 0;

1178 ià(!
block_c
.
avažabË
)

1180 
block_c
=
block_d
;

1183 
mvP»dTy³
 = 
MVPRED_MEDIAN
;

1185 ià(!
p_Vid
->
mb_aff_äame_æag
)

1187 
rF¿meL
 = 
block_a
.
avažabË
 ? 
mv_šfo
[block_a.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] : -1;

1188 
rF¿meU
 = 
block_b
.
avažabË
 ? 
mv_šfo
[block_b.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] : -1;

1189 
rF¿meUR
 = 
block_c
.
avažabË
 ? 
mv_šfo
[block_c.
pos_y
][block_c.
pos_x
].
»f_idx
[
li¡
] : -1;

1193 ià(
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].
mb_f›ld
)

1195 
rF¿meL
 = 
block_a
.
avažabË


1196 ? (
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mb_f›ld


1197 ? 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
]

1198 : 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

1199 
rF¿meU
 = 
block_b
.
avažabË


1200 ? (
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mb_f›ld


1201 ? 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
]

1202 : 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

1203 
rF¿meUR
 = 
block_c
.
avažabË


1204 ? (
p_Vid
->
mb_d©a
[
block_c
.
mb_addr
].
mb_f›ld


1205 ? 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
»f_idx
[
li¡
]

1206 : 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
»f_idx
[
li¡
] * 2) : -1;

1210 
rF¿meL
 = 
block_a
.
avažabË


1211 ? (
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mb_f›ld


1212 ? 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
] >>1

1213 : 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
»f_idx
[
li¡
]) : -1;

1214 
rF¿meU
 = 
block_b
.
avažabË
 ?

1215 
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mb_f›ld
 ?

1216 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] >>1:

1217 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
»f_idx
[
li¡
] :

1219 
rF¿meUR
 = 
block_c
.
avažabË
 ?

1220 
p_Vid
->
mb_d©a
[
block_c
.
mb_addr
].
mb_f›ld
 ?

1221 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
»f_idx
[
li¡
] >>1:

1222 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
»f_idx
[
li¡
] :

1230 if(
rF¿meL
 =ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 !ð»f_äameè
mvP»dTy³
 = 
MVPRED_L
;

1231 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 =ð»f_äam&& 
rF¿meUR
 !ð»f_äameè
mvP»dTy³
 = 
MVPRED_U
;

1232 if(
rF¿meL
 !ð
»f_äame
 && 
rF¿meU
 !ð»f_äam&& 
rF¿meUR
 =ð»f_äameè
mvP»dTy³
 = 
MVPRED_UR
;

1234 if(
blocksh­e_x
 =ð8 && 
blocksh­e_y
 == 16)

1236 if(
mb_x
 == 0)

1238 if(
rF¿meL
 =ð
»f_äame
)

1239 
mvP»dTy³
 = 
MVPRED_L
;

1243 ifÐ
rF¿meUR
 =ð
»f_äame
)

1244 
mvP»dTy³
 = 
MVPRED_UR
;

1247 if(
blocksh­e_x
 =ð16 && 
blocksh­e_y
 == 8)

1249 if(
mb_y
 == 0)

1251 if(
rF¿meU
 =ð
»f_äame
)

1252 
mvP»dTy³
 = 
MVPRED_U
;

1256 if(
rF¿meL
 =ð
»f_äame
)

1257 
mvP»dTy³
 = 
MVPRED_L
;

1262 if((
p_IÅ
->
UMHexDSR
 =ð1 ||…_IÅ->
BiP»dMÙiÚE¡im©iÚ
 == 1))

1264 
p_UMHex
->
SAD_a
 = 
block_a
.
avažabË
 ? ((
li¡
==1è? (
ç¡me_l1_co¡_æag
[p_UMHex->
UMHEX_blockty³
][block_a.
pos_y
][block_a.
pos_x
]è: (
ç¡me_l0_co¡_æag
[p_UMHex->UMHEX_blocktype][block_a.pos_y][block_a.pos_x])) : 0;

1265 
p_UMHex
->
SAD_b
 = 
block_b
.
avažabË
 ? ((
li¡
==1è? (
ç¡me_l1_co¡_æag
[p_UMHex->
UMHEX_blockty³
][block_b.
pos_y
][block_b.
pos_x
]è: (
ç¡me_l0_co¡_æag
[p_UMHex->UMHEX_blocktype][block_b.pos_y][block_b.pos_x])) : 0;

1266 
p_UMHex
->
SAD_d
 = 
block_d
.
avažabË
 ? ((
li¡
==1è? (
ç¡me_l1_co¡_æag
[p_UMHex->
UMHEX_blockty³
][block_d.
pos_y
][block_d.
pos_x
]è: (
ç¡me_l0_co¡_æag
[p_UMHex->UMHEX_blocktype][block_d.pos_y][block_d.pos_x])) : 0;

1267 
p_UMHex
->
SAD_c
 = 
block_c
.
avažabË
 ? ((
li¡
==1è? (
ç¡me_l1_co¡_æag
[p_UMHex->
UMHEX_blockty³
][block_c.
pos_y
][block_c.
pos_x
]è: (
ç¡me_l0_co¡_æag
[p_UMHex->UMHEX_blockty³][block_c.pos_y][block_c.pos_x])è:…_UMHex->
SAD_d
;

1269 
hv
=0; hv < 2; hv++)

1271 ià(!
p_Vid
->
mb_aff_äame_æag
 || 
hv
==0)

1273 
mv_a
 = 
block_a
.
avažabË
 ? 
mv_šfo
[block_a.
pos_y
][block_a.
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

1274 
mv_b
 = 
block_b
.
avažabË
 ? 
mv_šfo
[block_b.
pos_y
][block_b.
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

1275 
mv_c
 = 
block_c
.
avažabË
 ? 
mv_šfo
[block_c.
pos_y
][block_c.
pos_x
].
mv
[
li¡
].
mv_x
 : 0;

1279 ià(
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrX
].
mb_f›ld
)

1281 
mv_a
 = 
block_a
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_a.
mb_addr
].
mb_f›ld


1282 ? 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
mv
[
li¡
].
mv_y


1283 : 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
mv
[
li¡
].
mv_y
 / 2

1285 
mv_b
 = 
block_b
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_b.
mb_addr
].
mb_f›ld


1286 ? 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
mv
[
li¡
].
mv_y


1287 : 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
mv
[
li¡
].
mv_y
 / 2

1289 
mv_c
 = 
block_c
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_c.
mb_addr
].
mb_f›ld


1290 ? 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
mv
[
li¡
].
mv_y


1291 : 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
mv
[
li¡
].
mv_y
 / 2

1296 
mv_a
 = 
block_a
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_a.
mb_addr
].
mb_f›ld


1297 ? 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
mv
[
li¡
].
mv_y
 * 2

1298 : 
mv_šfo
[
block_a
.
pos_y
][block_a.
pos_x
].
mv
[
li¡
].
mv_y


1300 
mv_b
 = 
block_b
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_b.
mb_addr
].
mb_f›ld


1301 ? 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
mv
[
li¡
].
mv_y
 * 2

1302 : 
mv_šfo
[
block_b
.
pos_y
][block_b.
pos_x
].
mv
[
li¡
].
mv_y


1304 
mv_c
 = 
block_c
.
avažabË
 ? 
p_Vid
->
mb_d©a
[block_c.
mb_addr
].
mb_f›ld


1305 ? 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
mv
[
li¡
].
mv_y
 * 2

1306 : 
mv_šfo
[
block_c
.
pos_y
][block_c.
pos_x
].
mv
[
li¡
].
mv_y


1311 
mvP»dTy³
)

1313 
MVPRED_MEDIAN
:

1314 if(!(
block_b
.
avažabË
 || 
block_c
.available))

1316 
´ed_vec
 = (è
mv_a
;

1320 
´ed_vec
 = (è(
mv_a
+
mv_b
+
mv_c
-
	`imš
(mv_a,imš(mv_b,mv_c))-
	`imax
(mv_a,imax(mv_b,mv_c)));

1323 
MVPRED_L
:

1324 
´ed_vec
 = (è
mv_a
;

1326 
MVPRED_U
:

1327 
´ed_vec
 = (è
mv_b
;

1329 
MVPRED_UR
:

1330 
´ed_vec
 = (è
mv_c
;

1336 ià(
hv
 == 0)

1337 
pmv
->
mv_x
 = 
´ed_vec
;

1339 
pmv
->
mv_y
 = 
´ed_vec
;

1342 ià(
p_IÅ
->
UMHexDSR
)

1344 
d¤_mv_avaž
=
block_a
.
avažabË
+
block_b
.avažabË+
block_c
.available;

1345 if(
d¤_mv_avaž
 < 2)

1347 
d¤_‹mp_£¬ch_¿nge
[
hv
] = 
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
];

1351 
d¤_mv_max
 = 
	`imax
(
	`Ÿbs
(
mv_a
),imax(Ÿbs(
mv_b
),Ÿbs(
mv_c
)));

1352 
d¤_mv_sum
 = (
	`Ÿbs
(
mv_a
)+Ÿbs(
mv_b
)+Ÿbs(
mv_c
));

1353 if(
d¤_mv_sum
 =ð0è
d¤_sm®l_£¬ch_¿nge
 = (
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
] + 4) >> 3;

1354 if(
d¤_mv_sum
 > 3 ) 
d¤_sm®l_£¬ch_¿nge
 = (
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
] + 2) >>2;

1355 
d¤_sm®l_£¬ch_¿nge
 = (3*
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
] + 8) >> 4;

1356 
d¤_‹mp_£¬ch_¿nge
[
hv
]=
	`imš
(
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
],
	`imax
(
d¤_sm®l_£¬ch_¿nge
,
d¤_mv_max
<<1));

1357 if(
	`di¡blkmax
(
p_UMHex
->
SAD_a
, di¡blkmaxÕ_UMHex->
SAD_b
,p_UMHex->
SAD_c
)è>…_UMHex->
Th»shÞd_DSR_MB
[p_UMHex->
UMHEX_blockty³
])

1358 
d¤_‹mp_£¬ch_¿nge
[
hv
] = 
p_IÅ
->
£¬ch_¿nge
[
p_Vid
->
v›w_id
];

1364 ià(
p_IÅ
->
UMHexDSR
)

1366 
£¬ch_¿nge
 = 
	`imax
(
d¤_‹mp_£¬ch_¿nge
[0],dsr_temp_search_range[1]);

1367 
£¬ch_¿nge
 <<= 2;

1369 ià(
p_IÅ
->
fuÎ_£¬ch
 == 2)

1371 
mv_block
->
£¬chRªge
.
mš_x
 = -
£¬ch_¿nge
;

1372 
mv_block
->
£¬chRªge
.
max_x
 = 
£¬ch_¿nge
;

1373 
mv_block
->
£¬chRªge
.
mš_y
 = -
£¬ch_¿nge
;

1374 
mv_block
->
£¬chRªge
.
max_y
 = 
£¬ch_¿nge
;

1376 ià(
p_IÅ
->
fuÎ_£¬ch
 == 1)

1378 
sÿË
 = (
	`imš
(
»f_äame
,1)+1);

1379 
mv_block
->
£¬chRªge
.
mš_x
 = -
£¬ch_¿nge
 / 
sÿË
;

1380 
mv_block
->
£¬chRªge
.
max_x
 = 
£¬ch_¿nge
 / 
sÿË
;

1381 
mv_block
->
£¬chRªge
.
mš_y
 = -
£¬ch_¿nge
 / 
sÿË
;

1382 
mv_block
->
£¬chRªge
.
max_y
 = 
£¬ch_¿nge
 / 
sÿË
;

1386 
sÿË
 = ((
	`imš
(
»f_äame
,1)+1è* imš(2,
p_UMHex
->
BlockTy³_LUT
[(
blocksh­e_y
 >> 2è- 1][(
blocksh­e_x
 >> 2) - 1]));

1387 
mv_block
->
£¬chRªge
.
mš_x
 = -
£¬ch_¿nge
 / 
sÿË
;

1388 
mv_block
->
£¬chRªge
.
max_x
 = 
£¬ch_¿nge
 / 
sÿË
;

1389 
mv_block
->
£¬chRªge
.
mš_y
 = -
£¬ch_¿nge
 / 
sÿË
;

1390 
mv_block
->
£¬chRªge
.
max_y
 = 
£¬ch_¿nge
 / 
sÿË
;

1393 
	}
}

1395 #undeà
SEARCH_ONE_PIXEL


	@lencod/src/me_umhexsmp.c

26 
	~<lim™s.h
>

28 
	~"glob®.h
"

29 
	~"mem®loc.h
"

30 
	~"me_umhexsmp.h
"

31 
	~"»fbuf.h
"

32 
	~"maüoblock.h
"

33 
	~"me_di¡ÜtiÚ.h
"

34 
	~"mv_£¬ch.h
"

37 cÚ¡ 
MÙiÚVeùÜ
 
	gDŸmÚd
[4] = {{-4, 0}, {4, 0}, {0, -4}, {0, 4}};

38 cÚ¡ 
MÙiÚVeùÜ
 
	gDŸmÚd_SubP–S—rch
[4] = {{-1, 0}, {1, 0}, {0, -1}, {0, 1}};

39 cÚ¡ 
MÙiÚVeùÜ
 
	gHexagÚ
[6] = {{-8, 0}, {8, 0},{-4, -8}, {4, 8}, {-4, 8}, {4 , -8}};

40 cÚ¡ 
	gBig_HexagÚ_X
[16] = {-16, 16, 0, 0,-16, 16,-16, 16,-16, 16,-16, 16,-8, 8,-8, 8};

41 cÚ¡ 
	gBig_HexagÚ_Y
[16] = { 0, 0,-16, 16,-4, 4, 4,-4,-8, 8, 8,-8,-12, 12, 12,-12};

43 cÚ¡ 
	gblock_ty³_shiá_çùÜ
[8] = {0, 0, 1, 1, 2, 3, 3, 1};

46 #undeà
SEARCH_ONE_PIXEL_BIPRED


47 #undeà
SEARCH_ONE_PIXEL


48 
	#SEARCH_ONE_PIXEL
 \

	)

49 if((
Ÿbs
(
ÿnd
.
mv_x
 - 
ûÁ”
.mv_x)>>2è<ð
£¬ch_¿nge
 && \

50 (
Ÿbs
(
ÿnd
.
mv_y
 - 
ûÁ”
.mv_y)>>2è<ð
£¬ch_¿nge
) \

52 
mco¡
 = 
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
); \

53 
	gmco¡
 +ð
mv_block
->
compu‹P»dFP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - 
mco¡
, &
ÿnd
); \

54 ià(
	gmco¡
 < 
	gmš_mco¡
) \

56 
	gbe¡
 = 
ÿnd
; \

57 
	gmš_mco¡
 = 
mco¡
; \

61 
	#SEARCH_ONE_PIXEL_BIPRED
 \

	)

62 ià((
Ÿbs
(
ÿnd
.
mv_x
 - 
ûÁ”2
.mv_x)>>2è<ð
£¬ch_¿nge
 \

63 && (
Ÿbs
(
ÿnd
.
mv_y
 - 
ûÁ”2
.mv_y)>>2è<ð
£¬ch_¿nge
) \

65 
mco¡
 = 
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ûÁ”1
, &
´ed1
); \

66 
	gmco¡
 +ð
mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed2
); \

67 ià(
	gmco¡
 < 
	gmš_mco¡
) \

69 
	gmco¡
 +ð
mv_block
->
compu‹BiP»dFP–
(
»f_piùu»1
, 
»f_piùu»2
, \

70 
mv_block
, 
mš_mco¡
 - 
mco¡
, &
ûÁ”1
, &
ÿnd
); \

71 ià(
	gmco¡
 < 
	gmš_mco¡
) \

73 
	gbe¡
 = 
ÿnd
; \

74 
	gmš_mco¡
 = 
mco¡
; \

87 
	$smpUMHEX_š™
(
VideoP¬am‘”s
 *
p_Vid
)

89 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

91 
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd1
 = 
	`di¡_sÿË
(800);

92 
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd2
 = 
	`di¡_sÿË
(7000);

93 
p_UMHexSMP
->
CÚv”geTh»shÞd
 = 
	`di¡_sÿË
(1000);

94 
p_UMHexSMP
->
SubP–Th»shÞd1
 = 
	`di¡_sÿË
(1000);

95 
p_UMHexSMP
->
SubP–Th»shÞd3
 = 
	`di¡_sÿË
(400);

96 
	}
}

104 
	$smpUMHEX_g‘_mem
(
VideoP¬am‘”s
 *
p_Vid
)

106 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

107 
memÜy_size
 = 0;

108 ià(
NULL
==(
p_UMHexSMP
->
æag_šŒa
 = 
	`ÿÎoc
((
p_Vid
->
width
>>4)+1, (
by‹
))))

109 
	`no_mem_ex™
("smpUMHEX_get_mem: flag_intra");

111 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&
p_UMHexSMP
->
l0_co¡
, 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

112 
memÜy_size
 +ð
	`g‘_mem3Ddi¡blk
(&
p_UMHexSMP
->
l1_co¡
, 9, 
p_Vid
->
height
 >> 2,…_Vid->
width
 >> 2);

113 
memÜy_size
 +ð
	`g‘_mem2D
(&
p_UMHexSMP
->
S—rchS‹
, 7, 7);

115  
memÜy_size
;

116 
	}
}

124 
	$smpUMHEX_ä“_mem
(
VideoP¬am‘”s
 *
p_Vid
)

126 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

127 
	`ä“_mem3Ddi¡blk
(
p_UMHexSMP
->
l0_co¡
 );

128 
	`ä“_mem3Ddi¡blk
(
p_UMHexSMP
->
l1_co¡
 );

129 
	`ä“_mem2D
(
p_UMHexSMP
->
S—rchS‹
);

131 
	`ä“
 (
p_UMHexSMP
->
æag_šŒa
);

132 
	`ä“
 (
p_UMHexSMP
);

133 
	}
}

142 
di¡blk


143 
	$smpUMHEXIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

144 
MÙiÚVeùÜ
 *
´ed_mv
,

145 
MEBlock
 *
mv_block
,

146 
di¡blk
 
mš_mco¡
,

147 
Ïmbda_çùÜ


150 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

151 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

152 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

153 
blockty³
 = 
mv_block
->blocktype;

154 
blocksize_x
 = 
mv_block
->blocksize_x;

155 
blocksize_y
 = 
mv_block
->blocksize_y;

156 
pic_pix_x
 = 
mv_block
->
pos_x_·dded
;

157 
pic_pix_y
 = 
mv_block
->
pos_y_·dded
;

159 
li¡
 = 
mv_block
->list;

160 
cur_li¡
 = 
li¡
 + 
cu¼MB
->
li¡_off£t
;

161 
»f
 = 
mv_block
->
»f_idx
;

162 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
cur_li¡
][
»f
];

163 
£¬ch_¿nge
 = 
mv_block
->
£¬chRªge
.
max_x
 >> 2;

165 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

166 
MÙiÚVeùÜ
 
iMšNow
, 
ÿnd
, 
ûÁ”
, 
´ed
, 
be¡
 = {0, 0};

168 
£¬ch_¡•
;

169 
di¡blk
 
mco¡
;

170 
ušt16
 
i
, 
j
, 
m
;

172 
pic_pix_x
 = 
mv_block
->
pos_x_·dded
;

173 
pic_pix_y
 = 
mv_block
->
pos_y_·dded
;

174 
´ed
.
mv_x
 = 
pic_pix_x
 + 
´ed_mv
->mv_x;

175 
´ed
.
mv_y
 = 
pic_pix_y
 + 
´ed_mv
->mv_y;

176 
ûÁ”
.
mv_x
 = 
pic_pix_x
 + 
mv
->mv_x;

177 
ûÁ”
.
mv_y
 = 
pic_pix_y
 + 
mv
->mv_y;

182 
ÿnd
 = 
ûÁ”
;

183 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed
);

185 
mco¡
 +ð
mv_block
->
	`compu‹P»dFP–
(
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd
);

187 ià(
mco¡
 < 
mš_mco¡
)

189 
mš_mco¡
 = 
mco¡
;

190 
be¡
 = 
ÿnd
;

193 
iMšNow
 = 
be¡
;

196 ià((0 !ð
´ed_mv
->
mv_x
è|| (0 !ð´ed_mv->
mv_y
))

198 
ÿnd
.
mv_x
 = 
pic_pix_x
;

199 
ÿnd
.
mv_y
 = 
pic_pix_y
;

200 
SEARCH_ONE_PIXEL
;

201 
iMšNow
 = 
be¡
;

206 ià(
mš_mco¡
 < (
p_UMHexSMP
->
CÚv”geTh»shÞd
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

208 
m
 = 0; m < 4; m++)

210 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

211 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

212 
SEARCH_ONE_PIXEL
;

214 
mv
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

215 
mv
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

216  
mš_mco¡
;

220 
iMšNow
 = 
be¡
;

221 
m
 = 0; m < 4; m++)

223 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

224 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

225 
SEARCH_ONE_PIXEL
;

230 iàÐ(
blockty³
 == 1 &&

231 
mš_mco¡
 > (
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd1
 >> 
block_ty³_shiá_çùÜ
[
blockty³
])) ||

232 (
mš_mco¡
 > (
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd2
>>
block_ty³_shiá_çùÜ
[
blockty³
])) )

234 
iMšNow
 = 
be¡
;

236 
i
 = 4; i <ð4 * 
£¬ch_¿nge
 - 4; i+= 8)

238 
£¬ch_¡•
 = 
i
;

239 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
£¬ch_¡•
);

240 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y;

241 
SEARCH_ONE_PIXEL
;

243 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x - 
£¬ch_¡•
);

244 
SEARCH_ONE_PIXEL
;

246 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x;

247 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
£¬ch_¡•
);

248 
SEARCH_ONE_PIXEL
;

250 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y - 
£¬ch_¡•
);

251 
SEARCH_ONE_PIXEL
;

255 
iMšNow
 = 
be¡
;

257 
m
 = 0; m < 6; m++)

259 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

260 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

261 
SEARCH_ONE_PIXEL
;

264 
iMšNow
 = 
be¡
;

266 
i
 = 1; i <ð
£¬ch_¿nge
 >> 2; i++)

268 
m
 = 0; m < 16; m++)

270 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
Big_HexagÚ_X
[
m
]*
i
;

271 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
Big_HexagÚ_Y
[
m
]*
i
;

272 
SEARCH_ONE_PIXEL
;

278 ià(
blockty³
 > 1)

280 
ÿnd
.
mv_x
 = 
pic_pix_x
 + (
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 / 4) * 4;

281 
ÿnd
.
mv_y
 = 
pic_pix_y
 + (
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 / 4) * 4;

282 
SEARCH_ONE_PIXEL
;

285 if(
ûÁ”
.
mv_x
 !ð
pic_pix_x
 || c’‹r.
mv_y
 !ð
pic_pix_y
)

287 
ÿnd
.
mv_x
 = 
pic_pix_x
;

288 
ÿnd
.
mv_y
 = 
pic_pix_y
;

289 
SEARCH_ONE_PIXEL
;

291 
iMšNow
 = 
be¡
;

293 
m
 = 0; m < 4; m++)

295 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

296 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

297 
SEARCH_ONE_PIXEL
;

303 ià(
mš_mco¡
 < (
p_UMHexSMP
->
CÚv”geTh»shÞd
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

305 
iMšNow
 = 
be¡
;

307 
m
 = 0; m < 4; m++)

309 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

310 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

311 
SEARCH_ONE_PIXEL
;

313 
mv
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

314 
mv
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

315  
mš_mco¡
;

319 
i
 = 0; i < 
£¬ch_¿nge
; i++)

321 
iMšNow
 = 
be¡
;

322 
m
 = 0; m < 6; m++)

324 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

325 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

326 
SEARCH_ONE_PIXEL
;

329 ià(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

336 
i
 = 0; i < 
£¬ch_¿nge
; i++)

338 
iMšNow
 = 
be¡
;

339 
m
 = 0; m < 4; m++)

341 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

342 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

343 
SEARCH_ONE_PIXEL
;

347 ià(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

353 
mv
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

354 
mv
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

356 
j
=(
mv_block
->
pos_y2
); j < (mv_block->pos_y2è+ (
blocksize_y
>>2); j++)

358 
i
=(
mv_block
->
pos_x2
); i < (mv_block->pos_x2è+ (
blocksize_x
>>2); i++)

360 if(
mv_block
->
li¡
 == 0)

362 
p_UMHexSMP
->
l0_co¡
[
blockty³
][
j
][
i
] = 
mš_mco¡
;

366 
p_UMHexSMP
->
l1_co¡
[
blockty³
][
j
][
i
] = 
mš_mco¡
;

371  
mš_mco¡
;

372 
	}
}

380 
di¡blk


381 
	$smpUMHEXFuÎSubP–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

382 
MÙiÚVeùÜ
 *
´ed_mv
,

383 
MEBlock
 *
mv_block
,

384 
di¡blk
 
mš_mco¡
,

385 
Ïmbda_çùÜ


388 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

389 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

390 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

391 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

392 
pos
, 
be¡_pos
;

393 
di¡blk
 
mco¡
;

395 
MÙiÚVeùÜ
 
ÿnd
;

397 
blockty³
 = 
mv_block
->blocktype;

398 
li¡
 = 
mv_block
->list;

399 
li¡_off£t
 = 
cu¼MB
->list_offset;

400 
»f
 = 
mv_block
->
»f_idx
;

401 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

403 
check_pos™iÚ0
 = (!
p_IÅ
->
rdÝt
 && 
cu¼Sliû
->
¦iû_ty³
!=
B_SLICE
 && 
»f
==0 && 
blockty³
==1 && 
mv
->
mv_x
==0 && mv->
mv_y
==0);

405 
max_pos2
 = ( !
p_Vid
->
¡¬t_me_»fšem’t_hp
 ? 
	`imax
(1, 
mv_block
->
£¬ch_pos2
) : mv_block->search_pos2);

406 
MÙiÚVeùÜ
 
cmv
;

408 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
li¡_off£t
][
»f
];

418 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_hp
;…o < 
max_pos2
;…os++)

420 
ÿnd
.
mv_x
 = 
mv
->mv_x + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_x;

421 
ÿnd
.
mv_y
 = 
mv
->mv_y + 
p_Vid
->
¥œ®_h³l_£¬ch
[
pos
].mv_y;

424 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

426 ià(
mco¡
 >ð
mš_mco¡
) ;

428 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

430 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
);

432 ià(
pos
==0 && 
check_pos™iÚ0
)

434 
di¡blk
 
dbTmp
 = 
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 16);

435 
mco¡
 = (mco¡ > 
dbTmp
)? (mcost - dbTmp):0;

438 ià(
mco¡
 < 
mš_mco¡
)

440 
mš_mco¡
 = 
mco¡
;

441 
be¡_pos
 = 
pos
;

443 ià(
mš_mco¡
 < (
p_UMHexSMP
->
SubP–Th»shÞd3
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

449 ià(
be¡_pos
)

451 
	`add_mvs
(
mv
, &
p_Vid
->
¥œ®_h³l_£¬ch
[
be¡_pos
]);

454 ià((
mv
->
mv_x
 =ð0è&& (mv->
mv_y
 =ð0è&& (
´ed_mv
->mv_x == 0 &&…red_mv->mv_y == 0) &&

455 (
mš_mco¡
 < (
p_UMHexSMP
->
SubP–Th»shÞd1
 >> 
block_ty³_shiá_çùÜ
[
blockty³
])) )

457 
be¡_pos
 = 0;

458  
mš_mco¡
;

460 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

461 
mš_mco¡
 = 
DISTBLK_MAX
;

469 
be¡_pos
 = 0, 
pos
 = 
p_Vid
->
¡¬t_me_»fšem’t_qp
;…o < 
mv_block
->
£¬ch_pos4
;…os++)

471 
ÿnd
.
mv_x
 = 
mv
->mv_x + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_x;

472 
ÿnd
.
mv_y
 = 
mv
->mv_y + 
p_Vid
->
¥œ®_£¬ch
[
pos
].mv_y;

475 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

477 ià(
mco¡
 >ð
mš_mco¡
) ;

479 
cmv
 = 
	`·d_MVs
(
ÿnd
, 
mv_block
);

481 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
cmv
);

483 ià(
mco¡
 < 
mš_mco¡
)

485 
mš_mco¡
 = 
mco¡
;

486 
be¡_pos
 = 
pos
;

488 ià(
mš_mco¡
 < (
p_UMHexSMP
->
SubP–Th»shÞd3
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

494 ià(
be¡_pos
)

496 
	`add_mvs
(
mv
, &
p_Vid
->
¥œ®_£¬ch
[
be¡_pos
]);

500  
mš_mco¡
;

501 
	}
}

510 
di¡blk


511 
	$smpUMHEXSubP–BlockMÙiÚS—rch
 (

512 
Maüoblock
 *
cu¼MB
,

513 
MÙiÚVeùÜ
 *
´ed_mv
,

514 
MEBlock
 *
mv_block
,

515 
di¡blk
 
mš_mco¡
,

516 
Ïmbda_çùÜ


519 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

520 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

521 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

522 
di¡blk
 
mco¡
;

523 
MÙiÚVeùÜ
 
ÿnd
, 
iMšNow
, 
cu¼mv
 = {0, 0}, 
ÿnd_·d
;

525 
blockty³
 = 
mv_block
->blocktype;

526 
li¡
 = 
mv_block
->list;

527 
li¡_off£t
 = 
cu¼MB
->list_offset;

528 
»f
 = 
mv_block
->
»f_idx
;

529 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

531 
StÜabËPiùu»
 *
»f_piùu»
 = 
cu¼Sliû
->
li¡X
[
li¡
+
li¡_off£t
][
»f
];

533 
dyÇmic_£¬ch_¿nge
 = 3, 
i
, 
m
;

534 
´ed_äac_mv_x
,
´ed_äac_mv_y
,
abÜt_£¬ch
;

535 
´ed_äac_up_mv_x
, 
´ed_äac_up_mv_y
;

537 
´ed_äac_mv_x
 = (
´ed_mv
->
mv_x
 - 
mv
->mv_x) %4;

538 
´ed_äac_mv_y
 = (
´ed_mv
->
mv_y
 - 
mv
->mv_y) %4;

540 
´ed_äac_up_mv_x
 = (
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 - 
mv
->
mv_x
) & 0x03;

541 
´ed_äac_up_mv_y
 = (
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 - 
mv
->
mv_y
) & 0x03;

543 
	`mem£t
(
p_UMHexSMP
->
S—rchS‹
[0], 0, (2 * 
dyÇmic_£¬ch_¿nge
 + 1)*(2 * dynamic_search_range + 1));

545 
p_UMHexSMP
->
S—rchS‹
[
dyÇmic_£¬ch_¿nge
][dynamic_search_range] = 1;

546 ifÐ!
p_Vid
->
¡¬t_me_»fšem’t_hp
 )

548 
ÿnd
.
mv_x
 = 
mv
->mv_x;

549 
ÿnd
.
mv_y
 = 
mv
->mv_y;

550 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

551 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

553 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

554 ià(
mco¡
 < 
mš_mco¡
)

556 
mš_mco¡
 = 
mco¡
;

557 
cu¼mv
 = 
ÿnd
;

562 
cu¼mv
 = *
mv
;

567 iàÐ((
mv
->
mv_x
è=ð0è&& ((mv->
mv_y
) == 0) &&

568 (
´ed_äac_mv_x
 =ð0 && 
´ed_äac_up_mv_x
 == 0) &&

569 (
´ed_äac_mv_y
 =ð0 && 
´ed_äac_up_mv_y
 == 0) &&

570 (
mš_mco¡
 < (
p_UMHexSMP
->
SubP–Th»shÞd1
 >> 
block_ty³_shiá_çùÜ
[
blockty³
])) )

572 *
mv
 = 
cu¼mv
;

573  
mš_mco¡
;

576 if(
´ed_äac_mv_x
 || 
´ed_äac_mv_y
)

578 
ÿnd
.
mv_x
 = (è(
mv
->mv_x + 
´ed_äac_mv_x
);

579 
ÿnd
.
mv_y
 = (è(
mv
->mv_y + 
´ed_äac_mv_y
);

580 
p_UMHexSMP
->
S—rchS‹
[
ÿnd
.
mv_y
 -
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 - mv->mv_x + dynamic_search_range] = 1;

581 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

583 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

584 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

586 ià(
mco¡
 < 
mš_mco¡
)

588 
mš_mco¡
 = 
mco¡
;

589 
cu¼mv
 = 
ÿnd
;

594 
i
 = 0; i < 
dyÇmic_£¬ch_¿nge
; i++)

596 
abÜt_£¬ch
 = 1;

598 
iMšNow
 = 
cu¼mv
;

600 
m
 = 0; m < 4; m++)

602 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd_SubP–S—rch
[
m
].mv_x;

603 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd_SubP–S—rch
[
m
].mv_y;

605 if(
	`Ÿbs
(
ÿnd
.
mv_x
 - 
mv
->mv_xè<ð
dyÇmic_£¬ch_¿nge
 && iabs(ÿnd.
mv_y
 - mv->mv_y) <= dynamic_search_range)

607 if(!
p_UMHexSMP
->
S—rchS‹
[
ÿnd
.
mv_y
 - 
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 - mv->mv_x + dynamic_search_range])

609 
p_UMHexSMP
->
S—rchS‹
[
ÿnd
.
mv_y
 - 
mv
->mv_y + 
dyÇmic_£¬ch_¿nge
][ÿnd.
mv_x
 - mv->mv_x + dynamic_search_range] = 1;

610 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, 
´ed_mv
);

611 
ÿnd_·d
 = 
	`·d_MVs
 (
ÿnd
, 
mv_block
);

612 
mco¡
 +ð
mv_block
->
	`compu‹P»dQP–
Ð
»f_piùu»
, mv_block, 
mš_mco¡
 - mco¡, &
ÿnd_·d
);

613 ià(
mco¡
 < 
mš_mco¡
)

615 
mš_mco¡
 = 
mco¡
;

616 
cu¼mv
 = 
ÿnd
;

617 
abÜt_£¬ch
 = 0;

619 ià(
mš_mco¡
 < (
p_UMHexSMP
->
SubP–Th»shÞd3
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

621 *
mv
 = 
cu¼mv
;

622  
mš_mco¡
;

628 ià(
abÜt_£¬ch
)

634 *
mv
 = 
cu¼mv
;

637  
mš_mco¡
;

638 
	}
}

640 
di¡blk


641 
	$smpUMHEXSubP–BlockME
 (
Maüoblock
 *
cu¼MB
,

642 
MÙiÚVeùÜ
 *
´ed_mv
,

643 
MEBlock
 *
mv_block
,

644 
di¡blk
 
mš_mco¡
,

645 * 
Ïmbda_çùÜ
 )

647 if(
mv_block
->
blockty³
 > 1)

649 
mš_mco¡
 = 
	`smpUMHEXSubP–BlockMÙiÚS—rch
 (
cu¼MB
, 
´ed_mv
, 
mv_block
, mš_mco¡, 
Ïmbda_çùÜ
[
Q_PEL
]);

653 
mš_mco¡
 = 
	`smpUMHEXFuÎSubP–BlockMÙiÚS—rch
 (
cu¼MB
, 
´ed_mv
, 
mv_block
, mš_mco¡, 
Ïmbda_çùÜ
[
Q_PEL
]);

656  
mš_mco¡
;

657 
	}
}

666 
di¡blk


667 
	$smpUMHEXB»dIÁeg”P–BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

668 
li¡
,

669 
MÙiÚVeùÜ
 *
´ed_mv1
,

670 
MÙiÚVeùÜ
 *
´ed_mv2
,

671 
MÙiÚVeùÜ
 *
mv1
,

672 
MÙiÚVeùÜ
 *
mv2
,

673 
MEBlock
 *
mv_block
,

674 
£¬ch_¿nge
,

675 
di¡blk
 
mš_mco¡
,

676 
Ïmbda_çùÜ


679 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

680 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

681 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

683 
£¬ch_¡•
;

684 
i
, 
m
;

685 
di¡blk
 
mco¡
;

686 
blockty³
 = 
mv_block
->blocktype;

688 
pic_pix_x
 = 
mv_block
->
pos_x_·dded
;

689 
pic_pix_y
 = 
mv_block
->
pos_y_·dded
;

690 
»f
 = 
mv_block
->
»f_idx
;

692 
StÜabËPiùu»
 *
»f_piùu»1
 = 
cu¼Sliû
->
li¡X
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
»f
];

693 
StÜabËPiùu»
 *
»f_piùu»2
 = 
cu¼Sliû
->
li¡X
[
li¡
 =ð0 ? 1 + 
cu¼MB
->
li¡_off£t
: currMB->list_offset][ 0 ];

695 
MÙiÚVeùÜ
 
iMšNow
, 
be¡
, 
ÿnd
, 
´ed1
, 
´ed2
, 
ûÁ”1
, 
ûÁ”2
;

696 
£¬ch_¿nge
 >>= 2;

698 
´ed1
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
´ed_mv1
->mv_x;

699 
´ed1
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
´ed_mv1
->mv_y;

700 
´ed2
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
´ed_mv2
->mv_x;

701 
´ed2
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
´ed_mv2
->mv_y;

703 
ûÁ”2
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
mv1
->mv_x;

704 
ûÁ”2
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
mv1
->mv_y;

705 
ûÁ”1
.
mv_x
 = 
mv_block
->
pos_x_·dded
 + 
mv2
->mv_x;

706 
ûÁ”1
.
mv_y
 = 
mv_block
->
pos_y_·dded
 + 
mv2
->mv_y;

709 
be¡
 = 
ÿnd
 = 
ûÁ”2
;

710 
mco¡
 = 
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ûÁ”1
, &
´ed1
);

711 
mco¡
 +ð
	`mv_co¡
 (
p_Vid
, 
Ïmbda_çùÜ
, &
ÿnd
, &
´ed2
);

712 
mco¡
 +ð
mv_block
->
	`compu‹BiP»dFP–
(
»f_piùu»1
, 
»f_piùu»2
, mv_block,

713 
DISTBLK_MAX
, &
ûÁ”1
, &
ÿnd
);

714 ià(
mco¡
 < 
mš_mco¡
)

716 
mš_mco¡
 = 
mco¡
;

717 
be¡
 = 
ÿnd
;

720 
iMšNow
 = 
be¡
;

721 ià(0 !ð
´ed_mv1
->
mv_x
 || 0 !ð´ed_mv1->
mv_y
 || 0 !ð
´ed_mv2
->mv_x || 0 !=…red_mv2->mv_y)

723 
ÿnd
.
mv_x
 = 
pic_pix_x
;

724 
ÿnd
.
mv_y
 = 
pic_pix_y
;

725 
SEARCH_ONE_PIXEL_BIPRED
;

730 ià((
mš_mco¡
<<3è< (
p_UMHexSMP
->
CÚv”geTh»shÞd
 >> (
block_ty³_shiá_çùÜ
[
blockty³
])))

732 
m
 = 0; m < 4; m++)

734 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

735 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

736 
SEARCH_ONE_PIXEL_BIPRED
;

739 
mv1
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

740 
mv1
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

741  
mš_mco¡
;

745 
m
 = 0; m < 4; m++)

747 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

748 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

749 
SEARCH_ONE_PIXEL_BIPRED
;

754 ià((
blockty³
 == 1 &&

755 (
mš_mco¡
<<2è> (
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd1
 >> 
block_ty³_shiá_çùÜ
[
blockty³
])) ||

756 ((
mš_mco¡
<<2è> (
p_UMHexSMP
->
Symm‘riÿlCrossS—rchTh»shÞd2
>>
block_ty³_shiá_çùÜ
[
blockty³
])))

758 
iMšNow
.
mv_x
 = 
be¡
.mv_x;

759 
iMšNow
.
mv_y
 = 
be¡
.mv_y;

761 
i
 = 8; i <ð4 * 
£¬ch_¿nge
; i+= 8)

763 
£¬ch_¡•
 = 
i
 - 4;

764 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
£¬ch_¡•
);

765 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y;

766 
SEARCH_ONE_PIXEL_BIPRED
;

767 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x - 
£¬ch_¡•
);

768 
SEARCH_ONE_PIXEL_BIPRED
;

770 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x;

771 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
£¬ch_¡•
);

772 
SEARCH_ONE_PIXEL_BIPRED
;

773 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y - 
£¬ch_¡•
);

774 
SEARCH_ONE_PIXEL_BIPRED
;

778 
iMšNow
.
mv_x
 = 
be¡
.mv_x;

779 
iMšNow
.
mv_y
 = 
be¡
.mv_y;

780 
m
 = 0; m < 6; m++)

782 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

783 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

784 
SEARCH_ONE_PIXEL_BIPRED
;

787 
iMšNow
 = 
be¡
;

788 
i
 = 1; i <ð
£¬ch_¿nge
 / 4; i++)

790 
m
 = 0; m < 16; m++)

792 
ÿnd
.
mv_x
 = (è(
iMšNow
.mv_x + 
Big_HexagÚ_X
[
m
] * 
i
);

793 
ÿnd
.
mv_y
 = (è(
iMšNow
.mv_y + 
Big_HexagÚ_Y
[
m
] * 
i
);

794 
SEARCH_ONE_PIXEL_BIPRED
;

800 ià(
blockty³
 > 1)

802 
ÿnd
.
mv_x
 = 
pic_pix_x
 + (
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 / 4) * 4;

803 
ÿnd
.
mv_y
 = 
pic_pix_y
 + (
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 / 4) * 4;

804 
SEARCH_ONE_PIXEL_BIPRED
;

807 if(
ûÁ”2
.
mv_x
 !ð
pic_pix_x
 || c’‹r2.mv_x !ð
pic_pix_y
)

809 
ÿnd
.
mv_x
 = 
pic_pix_x
;

810 
ÿnd
.
mv_y
 = 
pic_pix_y
;

811 
SEARCH_ONE_PIXEL_BIPRED
;

813 
iMšNow
 = 
be¡
;

815 
m
 = 0; m < 4; m++)

817 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

818 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

819 
SEARCH_ONE_PIXEL_BIPRED
;

825 ià((
mš_mco¡
<<2è< (
p_UMHexSMP
->
CÚv”geTh»shÞd
 >> 
block_ty³_shiá_çùÜ
[
blockty³
]))

827 
iMšNow
 = 
be¡
;

828 
m
 = 0; m < 4; m++)

830 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

831 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

832 
SEARCH_ONE_PIXEL_BIPRED
;

834 
mv1
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

835 
mv1
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

836  
mš_mco¡
;

840 
i
 = 0; i < 
£¬ch_¿nge
; i++)

842 
iMšNow
 = 
be¡
;

843 
m
 = 0; m < 6; m++)

845 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
HexagÚ
[
m
].mv_x;

846 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
HexagÚ
[
m
].mv_y;

847 
SEARCH_ONE_PIXEL_BIPRED
;

850 ià(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

857 
i
 = 0; i < 
£¬ch_¿nge
; i++)

859 
iMšNow
 = 
be¡
;

860 
m
 = 0; m < 4; m++)

862 
ÿnd
.
mv_x
 = 
iMšNow
.mv_x + 
DŸmÚd
[
m
].mv_x;

863 
ÿnd
.
mv_y
 = 
iMšNow
.mv_y + 
DŸmÚd
[
m
].mv_y;

864 
SEARCH_ONE_PIXEL_BIPRED
;

868 ià(
be¡
.
mv_x
 =ð
iMšNow
.mv_x && be¡.
mv_y
 == iMinNow.mv_y)

874 
mv1
->
mv_x
 = (è(
be¡
.mv_x - 
pic_pix_x
);

875 
mv1
->
mv_y
 = (è(
be¡
.mv_y - 
pic_pix_y
);

876  
mš_mco¡
;

877 
	}
}

886 
	$smpUMHEX_decide_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
)

888 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

889 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

890 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

892 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

894 ià(
cu¼MB
->
pix_x
 =ð0 && cu¼MB->
pix_y
 == 0)

896 
p_UMHexSMP
->
æag_šŒa_SAD
 = 0;

898 ià(
cu¼MB
->
pix_x
 == 0)

900 
p_UMHexSMP
->
æag_šŒa_SAD
 =…_UMHexSMP->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4];

902 ià(
cu¼MB
->
pix_y
 == 0)

904 
p_UMHexSMP
->
æag_šŒa_SAD
 =…_UMHexSMP->
æag_šŒa
[((
cu¼MB
->
pix_x
)>>4)-1];

908 
p_UMHexSMP
->
æag_šŒa_SAD
 = (Õ_UMHexSMP->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4])||

909 (
p_UMHexSMP
->
æag_šŒa
[((
cu¼MB
->
pix_x
)>>4)-1])||

910 (
p_UMHexSMP
->
æag_šŒa
[((
cu¼MB
->
pix_x
)>>4)+1])) ;

914 
	}
}

923 
	$smpUMHEX_sk_šŒabk_SAD
(
Maüoblock
 *
cu¼MB
)

925 
i
, 
j
, 
k
;

926 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

927 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

928 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

930 ià(
p_Vid
->
numb”
 > 0)

932 
p_UMHexSMP
->
æag_šŒa
[(
cu¼MB
->
pix_x
)>>4] = (cu¼MB->
be¡_mode
 == 9 || currMB->best_mode == 10) ? 1 : 0;

935 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
 && (
cu¼MB
->
be¡_mode
 == 9 || currMB->best_mode == 10))

937 
k
=0; k < 9;k++)

939 
j
=0; j < 4; j++)

941 
i
=0; i < 4; i++)

943 
p_UMHexSMP
->
l0_co¡
[
k
][
j
][
i
] = 0;

944 
p_UMHexSMP
->
l1_co¡
[
k
][
j
][
i
] = 0;

950 
	}
}

959 
	$smpUMHEX_£tup
(
Maüoblock
 *
cu¼MB
,

960 
»f
,

961 
li¡
,

962 
block_y
,

963 
block_x
,

964 
blockty³
,

965 
MÙiÚVeùÜ
 *****
®l_mv
)

967 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

968 
UMHexSMPSŒuù
 *
p_UMHexSMP
 = 
p_Vid
->p_UMHexSMP;

970 ià(
blockty³
 > 6)

972 
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 = 
®l_mv
[
li¡
][
»f
][5][
block_y
][
block_x
].
mv_x
;

973 
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 = 
®l_mv
[
li¡
][
»f
][5][
block_y
][
block_x
].
mv_y
;

975 ià(
blockty³
 > 4)

977 
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 = 
®l_mv
[
li¡
][
»f
][4][
block_y
][
block_x
].
mv_x
;

978 
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 = 
®l_mv
[
li¡
][
»f
][4][
block_y
][
block_x
].
mv_y
;

980 ià(
blockty³
 == 4)

982 
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 = 
®l_mv
[
li¡
][
»f
][2][
block_y
][
block_x
].
mv_x
;

983 
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 = 
®l_mv
[
li¡
][
»f
][2][
block_y
][
block_x
].
mv_y
;

985 ià(
blockty³
 > 1)

987 
p_UMHexSMP
->
´ed_MV_u¶ay”_X
 = 
®l_mv
[
li¡
][
»f
][1][
block_y
][
block_x
].
mv_x
;

988 
p_UMHexSMP
->
´ed_MV_u¶ay”_Y
 = 
®l_mv
[
li¡
][
»f
][1][
block_y
][
block_x
].
mv_y
;

991 ià(
blockty³
 > 1)

993 ià(
blockty³
 > 6)

995 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 = (
li¡
==1) ?

996 (
p_UMHexSMP
->
l1_co¡
[5][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x])

997 : (
p_UMHexSMP
->
l0_co¡
[5][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x]);

998 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 /= 2;

1000 ià(
blockty³
 > 4)

1002 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 = (
li¡
==1) ?

1003 (
p_UMHexSMP
->
l1_co¡
[4][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x])

1004 : (
p_UMHexSMP
->
l0_co¡
[4][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x]);

1005 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 /= 2;

1007 ià(
blockty³
 == 4)

1009 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 = (
li¡
==1) ?

1010 (
p_UMHexSMP
->
l1_co¡
[2][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x])

1011 : (
p_UMHexSMP
->
l0_co¡
[2][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x]);

1012 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 /= 2;

1016 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 = (
li¡
==1) ?

1017 (
p_UMHexSMP
->
l1_co¡
[1][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x])

1018 : (
p_UMHexSMP
->
l0_co¡
[1][(
cu¼MB
->
block_y
)+block_y][(cu¼MB->
block_x
)+block_x]);

1019 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 /= 2;

1022 
p_UMHexSMP
->
´ed_SAD_u¶ay”
 =…_UMHexSMP->
æag_šŒa_SAD
 ? 0 :…_UMHexSMP->pred_SAD_uplayer;

1024 
	}
}

	@lencod/src/mmco.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<ùy³.h
>

18 
	~<lim™s.h
>

19 
	~"glob®.h
"

21 
	~"image.h
"

22 
	~"ÇlucommÚ.h
"

23 
	~"»pÜt.h
"

26 
	$mmco_lÚg_‹rm
(
VideoP¬am‘”s
 *
p_Vid
, 
cu¼’t_pic_num
)

28 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
;

30 iàÐ!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

32 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

35 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

36 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

38 
tmp_d½m
->
Next
=
NULL
;

40 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

42 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

43 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

44 
tmp_d½m2
->
Next
=
tmp_d½m
;

46 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 3;

47 
tmp_d½m2
->
lÚg_‹rm_äame_idx
 = 
cu¼’t_pic_num
;

48 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m2
;

52 
p_Vid
->
lÚg_‹rm_»ã»nû_æag
 = 
TRUE
;

54 
	}
}

56 #ià
HM50_LIKE_MMCO


57 
	$hm50_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
)

59 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

60 
i
;

61 
pic_num
 = 0;

63 
rg‘_poc
=-1;

64 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
;

67 iàÐ
p_Vid
->
p_IÅ
->
Numb”BF¿mes
 != 7 ||

68 
p_Vid
->
p_IÅ
->
num_»f_äames
 != 4 ||

69 
p_Vid
->
p_IÅ
->
B_Li¡0_»fs
[0] != 2 ||

70 
p_Vid
->
p_IÅ
->
B_Li¡1_»fs
[0] != 2 )

75 #ià
CRA


77 iàÐ
p_Vid
->
p_IÅ
->
u£CRA
 )

79 iàÐÐ
p_Vid
->
cu¼’tSliû
->
¦iû_ty³
 =ð
B_SLICE
 ||…_Vid->cu¼’tSliû->¦iû_ty³ =ð
P_SLICE
 ) &&…_Vid->cu¼’tSliû->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

81 iàÐÐ(
p_Vid
->
cu¼’tSliû
->
ThisPOC
/2è- (p_Vid->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

89 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

92 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

95 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

98  
p_Vid
->
cu¼’tSliû
->
ThisPOC
 / 2 % 8 )

101 
rg‘_poc
 = 
p_Vid
->
cu¼’tSliû
->
ThisPOC
 - 32;

104 
rg‘_poc
 = 
p_Vid
->
cu¼’tSliû
->
ThisPOC
 - 16;

107 
rg‘_poc
 = 
p_Vid
->
cu¼’tSliû
->
ThisPOC
 - 8;

110 
rg‘_poc
 = 
p_Vid
->
cu¼’tSliû
->
ThisPOC
 - 8;

113 
rg‘_poc
 = -1;

117 iàÐ
rg‘_poc
 < 0 )

121 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

123 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 =ð
rg‘_poc
)

125 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

129 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

130 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

131 
tmp_d½m
->
Next
=
NULL
;

133 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

135 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

136 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

137 
tmp_d½m2
->
Next
=
tmp_d½m
;

139 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

141 iàÐ
p_Vid
->
num_of_Ïy”s
 == 1 )

142 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num
 - 1;

144 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = (
cu¼’t_pic_num
 - 
pic_num
)/2 - 1;

146 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m2
;

147 
	}
}

150 #ià
CRA


151 
	$üa_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
)

153 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

154 
i
;

155 
pic_num
 = 0;

158 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
;

160 
Ï¡_šŒa_poc
 = 
p_Vid
->
cu¼’tSliû
->
ThisPOC
 / 2 /…_Vid->
p_IÅ
->
šŒa_³riod
 *…_Vid->p_Inp->intra_period * 2;

162 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

165 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

168 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

171 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

172 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

173 
tmp_d½m
->
Next
=
NULL
;

175 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

177 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

179 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
Ï¡_šŒa_poc
)

181 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

182 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

183 
tmp_d½m2
->
Next
=
tmp_d½m
;

184 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

186 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

188 iàÐ
p_Vid
->
num_of_Ïy”s
 == 1 )

189 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num
 - 1;

191 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = (
cu¼’t_pic_num
 - 
pic_num
)/2 - 1;

193 iàÐ
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 < 0 )

195 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 +ð
p_Vid
->
cu¼’tSliû
->
max_äame_num
;

197 iàÐ
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 >ð(è
p_Vid
->
cu¼’tSliû
->
max_äame_num
 )

199 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 -ð
p_Vid
->
cu¼’tSliû
->
max_äame_num
;

202 
tmp_d½m
 = 
tmp_d½m2
;

206 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m
;

207 
	}
}

210 #ià
LD_REF_SETTING


211 
	$low_d–ay_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
)

213 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

214 
i
;

215 
pic_num
 = 0;

217 
mš_poc
=
INT_MAX
;

218 
mš_poc_nÙ_4x
 = 
INT_MAX
;

219 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
;

221 #ià
CRA


223 iàÐ
p_Vid
->
p_IÅ
->
u£CRA
 )

225 iàÐÐ
p_Vid
->
cu¼’tSliû
->
¦iû_ty³
 =ð
B_SLICE
 ||…_Vid->cu¼’tSliû->¦iû_ty³ =ð
P_SLICE
 ) &&…_Vid->cu¼’tSliû->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

227 iàÐÐ(
p_Vid
->
cu¼’tSliû
->
ThisPOC
/2è- (p_Vid->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

235 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

238 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

241 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

244 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

246 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
mš_poc
)

248 
mš_poc
 = 
p_Dpb
->
fs
[
i
]->
äame
->
poc
 ;

249 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

252 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

254 if((
p_Vid
->
cu¼’tSliû
->
ThisPOC
/2-
p_Dpb
->
fs
[
i
]->
poc
/2)>4)

256 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
mš_poc_nÙ_4x
 && (p_Dpb->fs[i]->poc/2)%(
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1)!=0 )

258 
mš_poc_nÙ_4x
 = 
p_Dpb
->
fs
[
i
]->
äame
->
poc
 ;

259 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

264 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
mš_poc_nÙ_4x
 && (p_Dpb->fs[i]->poc/2)%((
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1)/2)!=0 )

266 
mš_poc_nÙ_4x
 = 
p_Dpb
->
fs
[
i
]->
äame
->
poc
 ;

267 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

272 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

273 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

274 
tmp_d½m
->
Next
=
NULL
;

276 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

278 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

279 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

280 
tmp_d½m2
->
Next
=
tmp_d½m
;

282 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

284 iàÐ
p_Vid
->
num_of_Ïy”s
 == 1 )

285 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num
 - 1;

287 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = (
cu¼’t_pic_num
 - 
pic_num
)/2 - 1;

289 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m2
;

290 
	}
}

300 
	$poc_ba£d_»f_mªagem’t_äame_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
)

302 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

303 
i
;

304 
pic_num
 = 0;

306 
mš_poc
=
INT_MAX
;

307 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
;

309 #ià
CRA


311 iàÐ
p_Vid
->
p_IÅ
->
u£CRA
 )

313 iàÐÐ
p_Vid
->
cu¼’tSliû
->
¦iû_ty³
 =ð
B_SLICE
 ||…_Vid->cu¼’tSliû->¦iû_ty³ =ð
P_SLICE
 ) &&…_Vid->cu¼’tSliû->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

315 iàÐÐ(
p_Vid
->
cu¼’tSliû
->
ThisPOC
/2è- (p_Vid->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

323 #ià
HM50_LIKE_MMCO


324 iàÐ
p_Vid
->
p_IÅ
->
HM50RefSŒuùu»
 )

327 iàÐ
p_Vid
->
p_IÅ
->
Numb”BF¿mes
 != 7 ||

328 
p_Vid
->
p_IÅ
->
num_»f_äames
 != 4 ||

329 
p_Vid
->
p_IÅ
->
B_Li¡0_»fs
[0] != 2 ||

330 
p_Vid
->
p_IÅ
->
B_Li¡1_»fs
[0] != 2 )

337 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

340 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

343 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

346 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

348 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
mš_poc
)

350 
mš_poc
 = 
p_Dpb
->
fs
[
i
]->
äame
->
poc
 ;

351 
pic_num
 = 
p_Dpb
->
fs
[
i
]->
äame
->pic_num;

355 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

356 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

357 
tmp_d½m
->
Next
=
NULL
;

359 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

361 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

362 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

363 
tmp_d½m2
->
Next
=
tmp_d½m
;

365 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

366 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num
 - 1;

368 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m2
;

369 
	}
}

378 
	$poc_ba£d_»f_mªagem’t_f›ld_pic
(
DecodedPiùu»Bufãr
 *
p_Dpb
, 
cu¼’t_pic_num
)

380 
VideoP¬am‘”s
 *
p_Vid
 = 
p_Dpb
->p_Vid;

381 
i
;

382 
pic_num1
 = 0, 
pic_num2
 = 0;

384 
mš_poc
=
INT_MAX
;

385 
DecRefPicM¬kšg_t
 *
tmp_d½m
,*
tmp_d½m2
, *
tmp_d½m3
;

387 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

390 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

393 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

396 iàÐ
p_Vid
->
¡ruùu»
 =ð
TOP_FIELD
 )

398 
i
=0; i<
p_Dpb
->
u£d_size
;i++)

400 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
poc
 < 
mš_poc
)

402 
mš_poc
 = 
p_Dpb
->
fs
[
i
]->
poc
;

403 
pic_num1
 = 
p_Dpb
->
fs
[
i
]->
tÝ_f›ld
->
pic_num
;

404 
pic_num2
 = 
p_Dpb
->
fs
[
i
]->
bÙtom_f›ld
->
pic_num
;

409 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicM¬kšg_t)))è
	`no_mem_ex™
("poc_based_ref_management_field_pic:mp_drpm");

410 
tmp_d½m
->
Next
=
NULL
;

411 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

413 iàÐ
p_Vid
->
¡ruùu»
 =ð
BOTTOM_FIELD
 )

415 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m
;

419 ià(
NULL
==(
tmp_d½m2
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicM¬kšg_t)))è
	`no_mem_ex™
("poc_based_ref_management_field_pic:mp_drpm2");

420 
tmp_d½m2
->
Next
=
tmp_d½m
;

421 
tmp_d½m2
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

422 
tmp_d½m2
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num1
 - 1;

424 ià(
NULL
==(
tmp_d½m3
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicM¬kšg_t)))è
	`no_mem_ex™
("poc_based_ref_management_field_pic:mp_drpm3");

425 
tmp_d½m3
->
Next
=
tmp_d½m2
;

426 
tmp_d½m3
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

427 
tmp_d½m3
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
pic_num2
 - 1;

429 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
tmp_d½m3
;

430 
	}
}

440 
	$Žyr_ba£d_»f_mªagem’t_äame_pic
(
VideoP¬am‘”s
 *
p_Vid
, 
cu¼’t_pic_num
)

442 
i
, 
fœ¡
 = 1;

443 
DecRefPicM¬kšg_t
 *
d½m
 = 
NULL
, *
cu¼’t_d½m
 = NULL, *
tmp_d½m
 = NULL;

444 
decoded_piùu»_bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[0];

446 ià(
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
!=
NULL
)

449 iàÐ
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 )

452 ià((
p_Dpb
->
»f_äames_š_bufãr
 +…_Dpb->
É»f_äames_š_bufãr
)==0)

455 
i
 = 0; i < 
p_Dpb
->
u£d_size
; i++)

457 ià(
p_Dpb
->
fs
[
i
]->
is_»ã»nû
 && (!Õ_Dpb->fs[i]->
is_lÚg_‹rm
)è&&…_Dpb->fs[i]->
äame
->
‹mpÜ®_Ïy”
 > 
p_Vid
->
’c_piùu»
->temporal_layer)

459 ià(
NULL
 =ð(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

460 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm2");

461 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 1;

462 
tmp_d½m
->
difã»nû_of_pic_nums_mšus1
 = 
cu¼’t_pic_num
 - 
p_Dpb
->
fs
[
i
]->
äame
->
pic_num
 - 1;

464 ià(
fœ¡
)

466 
d½m
 = 
cu¼’t_d½m
 = 
tmp_d½m
;

467 
fœ¡
 = 0;

471 
cu¼’t_d½m
->
Next
 = 
tmp_d½m
;

472 
cu¼’t_d½m
 = cu¼’t_d½m->
Next
;

477 ià(
fœ¡
)

480 ià(
NULL
==(
tmp_d½m
=(
DecRefPicM¬kšg_t
*)
	`ÿÎoc
 (1, (DecRefPicMarking_t))))

481 
	`no_mem_ex™
("poc_based_ref_management:mp_drpm");

482 
tmp_d½m
->
Next
=
NULL
;

484 
tmp_d½m
->
memÜy_mªagem’t_cÚŒÞ_Ý”©iÚ
 = 0;

486 
cu¼’t_d½m
->
Next
=
tmp_d½m
;

488 
p_Vid
->
dec_»f_pic_m¬kšg_bufãr
 = 
d½m
;

489 
	}
}

	@lencod/src/mode_decision.c

12 
	~<m©h.h
>

13 
	~<lim™s.h
>

14 
	~<æßt.h
>

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"¿‹ùl.h
"

19 
	~"mode_decisiÚ.h
"

20 
	~"md_commÚ.h
"

21 
	~"me_umhex.h
"

22 
	~"me_umhexsmp.h
"

23 
	~"maüoblock.h
"

24 
	~"rdoq.h
"

25 
	~"q_¬ound.h
"

26 
	~"¦iû.h
"

27 
	~"cÚfÜmªû.h
"

28 
	~"rdÝt.h
"

37 
	$»£t_v®id_modes
(
RD_PARAMS
 *
’c_mb
)

39 
	`mem£t
(
’c_mb
->
v®id
, 0, 
MAXMODE
 * ());

40 
	}
}

49 
šlše
 
	$check_fÜ_SI16
(**
Ìec
, 
pix_x
, 
pix_y
)

51 
i
,
j
;

52 
i
 = 
pix_y
; i <…ix_y + 
MB_BLOCK_SIZE
; i++)

54 
j
 = 
pix_x
;j <…ix_x + 
MB_BLOCK_SIZE
; j++)

55 ià(
Ìec
[
i
][
j
] != -16)

59 
	}
}

67 
	$’d_’code_Úe_maüoblock
(
Maüoblock
 *
cu¼MB
)

69 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

70 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

71 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

73 
	`upd©e_qp_cbp
(
cu¼MB
);

75 iàÐ(
cu¼Sliû
->
mb_aff_äame_æag
)

76 && (
cu¼MB
->
mbAddrX
 & 0x01)

77 && (
cu¼MB
->
mb_ty³
 ? 0:(((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)è? !cu¼MB->
cbp
:1))

78 && ((
cu¼MB
->
P»vMB
)->
mb_ty³
 ? 0:(((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)è? !(cu¼MB->P»vMB)->
cbp
:1))

79 && !(
	`f›ld_æag_šã»nû
(
cu¼MB
è=ðcu¼MB->
mb_f›ld
))

81 
cu¼Sliû
->
rdd©a
->
mš_rdco¡
 = 1e30;

84 
cu¼Sliû
->
rdd©a
->
mš_rdco¡
 = ()
cu¼MB
->min_rdcost;

86 
cu¼Sliû
->
rdd©a
->
mš_dco¡
 = ()
cu¼MB
->min_dcost;

87 
cu¼Sliû
->
rdd©a
->
mš_¿‹
 = ()
cu¼MB
->min_rate;

89 if(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX
)

91 
	`UMHEX_sk_šŒabk_SAD
(
cu¼MB
, 
cu¼Sliû
->
li¡Xsize
[cu¼MB->
li¡_off£t
]);

93 if(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX_SIMPLE
)

95 
	`smpUMHEX_sk_šŒabk_SAD
(
cu¼MB
);

99 if(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
B_SLICE
))

101 
p_Vid
->
šŒa_block
[
cu¼MB
->
mbAddrX
] = 
	`is_šŒa
(currMB);

103 
	}
}

111 
	$š™_’c_mb_·¿ms
(
Maüoblock
* 
cu¼MB
, 
RD_PARAMS
 *
’c_mb
, 
šŒa
)

113 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

114 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

115 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

116 #ià(
MVC_EXTENSION_ENABLE
)

117 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[(
p_Vid
->
num_of_Ïy”s
 > 1è? 
cu¼Sliû
->
v›w_id
 : 0][(cu¼Sliû->
¦iû_ty³
 =ð
B_SLICE
)];

119 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[0][(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)];

122 
l
,
k
;

124 
’c_mb
->
cu¼_mb_f›ld
 = (è((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
cu¼MB
->
mb_f›ld
));

127 
’c_mb
->
v®id
[
I8MB
] = (è((!
p_IÅ
->
Di§bËIÁ¿InIÁ”
[
p_Vid
->
v›w_id
] || 
šŒa
 )?…_IÅ->
T¿nsfÜm8x8Mode
 : 0);

128 
’c_mb
->
v®id
[
I4MB
] = (è((!
p_IÅ
->
Di§bËIÁ¿InIÁ”
[
p_Vid
->
v›w_id
] || 
šŒa
 )? (Õ_IÅ->
T¿nsfÜm8x8Mode
 == 2) ? 0 : 1) : 0);

129 
’c_mb
->
v®id
[
I4MB
] = (è((!
p_IÅ
->
Di§bËIÁ¿4x4
 ) ?ƒnc_mb->valid[I4MB] : 0);

130 
’c_mb
->
v®id
[
I16MB
] = (è((!
p_IÅ
->
Di§bËIÁ¿InIÁ”
[
p_Vid
->
v›w_id
] || 
šŒa
 )? 1 : 0);

131 
’c_mb
->
v®id
[
I16MB
] = (è((!
p_IÅ
->
Di§bËIÁ¿16x16
) ?ƒnc_mb->valid[I16MB] : 0);

132 
’c_mb
->
v®id
[
IPCM
] = (è((!
p_IÅ
->
Di§bËIÁ¿InIÁ”
[
p_Vid
->
v›w_id
] || 
šŒa
 )? (p_IÅ->
EÇbËIPCM
 > 0 ? 1:0) : 0);

133 
’c_mb
->
v®id
[
SI4MB
] = 0;

137 
’c_mb
->
v®id
[0] = (è(!
šŒa
 && 
IÁ”S—rch
[0]);

138 
’c_mb
->
v®id
[1] = (è(!
šŒa
 && 
IÁ”S—rch
[1]);

139 
’c_mb
->
v®id
[2] = (è(!
šŒa
 && 
IÁ”S—rch
[2]);

140 
’c_mb
->
v®id
[3] = (è(!
šŒa
 && 
IÁ”S—rch
[3]);

141 
’c_mb
->
v®id
[4] = (è(!
šŒa
 && 
IÁ”S—rch
[4]);

142 
’c_mb
->
v®id
[5] = (è(!
šŒa
 && 
IÁ”S—rch
[5] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

143 
’c_mb
->
v®id
[6] = (è(!
šŒa
 && 
IÁ”S—rch
[6] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

144 
’c_mb
->
v®id
[7] = (è(!
šŒa
 && 
IÁ”S—rch
[7] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

145 
’c_mb
->
v®id
[
P8x8
] = () (enc_mb->valid[4] ||ƒnc_mb->valid[5] ||ƒnc_mb->valid[6] ||ƒnc_mb->valid[7]);

148 ià(
cu¼Sliû
->
U£RDOQuªt
 && 
p_IÅ
->
RDOQ_CP_Mode
 && (
p_Vid
->
qp
 !ðp_Vid->
ma¡”QP
) )

149 
	`RDOQ_upd©e_mode
(
cu¼Sliû
, 
’c_mb
);

151 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

153 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
)

155 
	`»£t_v®id_modes
(
’c_mb
);

156 if(
	`check_fÜ_SI16
(
p_Vid
->
Ìec
, 
cu¼MB
->
pix_x
, cu¼MB->
pix_y
))

158 
’c_mb
->
v®id
[
I16MB
] = 1;

162 
’c_mb
->
v®id
[
I4MB
] = 1;

166 if(
p_Vid
->
¥2_äame_šdiÿtÜ
)

168 if(
	`check_fÜ_SI16
(
p_Vid
->
Ìec
, 
cu¼MB
->
pix_x
, cu¼MB->
pix_y
))

170 
	`»£t_v®id_modes
(
’c_mb
);

171 
’c_mb
->
v®id
[
I16MB
] = 1;

175 
’c_mb
->
v®id
[
I8MB
] = 0;

176 
’c_mb
->
v®id
[
IPCM
] = 0;

177 
’c_mb
->
v®id
[0] = 0;

186 
’c_mb
->
Ïmbda_md
 = 
p_Vid
->Ïmbda_md[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
ma¡”QP
];

188 
’c_mb
->
Ïmbda_mdå
 = 
	`LAMBDA_FACTOR
Ónc_mb->
Ïmbda_md
);

191 
	`memýy
(
’c_mb
->
Ïmbda_me
, 
p_Vid
->Ïmbda_me[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
ma¡”QP
], 3 * ());

192 
	`memýy
(
’c_mb
->
Ïmbda_mf
, 
p_Vid
->Ïmbda_mf[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
ma¡”QP
], 3 * ());

194 ià(!
cu¼Sliû
->
mb_aff_äame_æag
)

196 
l
 = 
LIST_0
;† < 
BI_PRED
;†++)

198 
k
 = 0; k < 
cu¼Sliû
->
li¡Xsize
[
l
]; k++)

200 if(
cu¼Sliû
->
¡ruùu»
 !ðcu¼Sliû->
li¡X
[
l
][
k
]->structure)

202 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

203 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
 = -2;

204 ià(
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
)

205 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
 = 2;

207 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
= 0;

210 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
= 0;

216 ià(
’c_mb
->
cu¼_mb_f›ld
)

218 
l
 = 
cu¼MB
->
li¡_off£t
;† <ðcu¼MB->li¡_off£ˆ+ 
LIST_1
;†++)

220 
k
 = 0; k < 
cu¼Sliû
->
li¡Xsize
[
l
]; k++)

222 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
= 0;

223 if((
cu¼MB
->
mbAddrX
 & 0x01è=ð0 && 
cu¼Sliû
->
li¡X
[
l
][
k
]->
¡ruùu»
 =ð
BOTTOM_FIELD
)

224 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
 = -2;

225 if((
cu¼MB
->
mbAddrX
 & 0x01è=ð1 && 
cu¼Sliû
->
li¡X
[
l
][
k
]->
¡ruùu»
 =ð
TOP_FIELD
)

226 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
 = 2;

232 
l
 = 
cu¼MB
->
li¡_off£t
;† <ðcu¼MB->li¡_off£ˆ+ 
LIST_1
;†++)

234 
k
 = 0; k < 
cu¼Sliû
->
li¡Xsize
[
l
]; k++)

235 
cu¼Sliû
->
li¡X
[
l
][
k
]->
chroma_veùÜ_adju¡m’t
 = 0;

241 
cu¼MB
->
c_»d_mode
 = 
DC_PRED_8
;

244 if(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX
)

246 
	`UMHEX_decide_šŒabk_SAD
(
cu¼MB
);

247 
	`UMHEX_DefšeTh»shÞdMB
(
p_Vid
, 
p_IÅ
);

249 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX_SIMPLE
)

251 
	`smpUMHEX_decide_šŒabk_SAD
(
cu¼MB
);

254 
	}
}

256 
	$upd©e_mco¡
(
Sliû
 *
cu¼Sliû
, 
»f_Ïmbda
, 
»f
, 
cur_li¡
, 
di¡blk
 
mco¡
, di¡blk *
bmco¡
, *
be¡_»f
)

258 ià(
mco¡
 < *
bmco¡
)

260 
mco¡
 +ð
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, 
»f
, 
cur_li¡
);

262 ià(
mco¡
 < *
bmco¡
)

264 *
bmco¡
 = 
mco¡
;

265 *
be¡_»f
 = ()
»f
;

268 
	}
}

275 
	$li¡_´ediùiÚ_co¡
(
Maüoblock
 *
cu¼MB
, 
li¡
, 
block
, 
mode
, 
RD_PARAMS
 *
’c_mb
, 
di¡blk
 
bmco¡
[5], 
be¡_»f
[2])

277 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

278 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

279 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

281 
»f
;

282 
cur_li¡
 = 
li¡
 < 
BI_PRED
 ? 
cu¼MB
->
li¡_off£t
 +†ist : currMB->list_offset;

283 
»f_Ïmbda
 = (
p_IÅ
->
rdÝt
è? 
’c_mb
->
Ïmbda_mf
[
Q_PEL
] :ƒnc_mb->lambda_mf[Q_PEL] >> 2;

286 ià(
li¡
 < 
BI_PRED
)

288 
di¡blk
 **
mÙiÚ_co¡
 = 
p_Vid
->mÙiÚ_co¡[
mode
][
li¡
];

290 
¥_šdiÿtÜ
 = (
p_IÅ
->
¥2_äame_šdiÿtÜ
 ||…_IÅ->
¥_ouut_šdiÿtÜ
);

292 ià(!
p_Vid
->
check»f
 || 
li¡
)

294 ià(
p_IÅ
->
¥2_äame_šdiÿtÜ
 =ð0 &&…_IÅ->
¥_ouut_šdiÿtÜ
 == 0)

296 
»f
 = 0;„eà< 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
];„ef++)

298 
	`upd©e_mco¡
(
cu¼Sliû
, 
»f_Ïmbda
, 
»f
, 
cur_li¡
, 
mÙiÚ_co¡
[»f][
block
], &
bmco¡
[
li¡
], &
be¡_»f
[list]);

303 
»f
 = 0;„eà< 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
];„ef++)

306 if((((
cu¼Sliû
->
¦iû_ty³
 !ð
P_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SP_SLICE
)è|| (
»f
 == 0)))

308 
	`upd©e_mco¡
(
cu¼Sliû
, 
»f_Ïmbda
, 
»f
, 
cur_li¡
, 
mÙiÚ_co¡
[»f][
block
], &
bmco¡
[
li¡
], &
be¡_»f
[list]);

315 
»f
 = 0;„eà< 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
];„ef++)

317 ià(
»f
 =ð0 || (
p_IÅ
->
Re¡riùRef
 && 
	`CheckR–Ÿbž™yOfRef
 (
cu¼MB
, 
block
, 
li¡
,„ef, 
mode
)))

320 ifÐ!(
¥_šdiÿtÜ
è|| (((
cu¼Sliû
->
¦iû_ty³
 !ð
P_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SP_SLICE
))|| (
»f
 == 0)))

322 
	`upd©e_mco¡
(
cu¼Sliû
, 
»f_Ïmbda
, 
»f
, 
cur_li¡
, 
mÙiÚ_co¡
[»f][
block
], &
bmco¡
[
li¡
], &
be¡_»f
[list]);

328 ià(
li¡
 =ð
BI_PRED
)

330 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

332 
weight_sum
 = 
cu¼Sliû
->
wbp_weight
[0][(è
be¡_»f
[
LIST_0
]][(èbe¡_»f[
LIST_1
]][0] +

333 
cu¼Sliû
->
wbp_weight
[1][(è
be¡_»f
[
LIST_0
]][(èbe¡_»f[
LIST_1
]][0];

335 ià(
weight_sum
 < -128 || weight_sum > 127)

337 
bmco¡
[
li¡
] = 
DISTBLK_MAX
;

341 
bmco¡
[
li¡
] = 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, (è
be¡_»f
[
LIST_0
], 
cur_li¡
) +

342 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, (è
be¡_»f
[
LIST_1
], 
cur_li¡
 + LIST_1);

343 
bmco¡
[
li¡
] +ð
	`BIDP¬t™iÚCo¡
 (
cu¼MB
, 
mode
, 
block
, 
be¡_»f
, 
’c_mb
->
Ïmbda_mf
[
Q_PEL
]);

348 
bmco¡
[
li¡
] = 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, (è
be¡_»f
[
LIST_0
], 
cur_li¡
) +

349 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, (è
be¡_»f
[
LIST_1
], 
cur_li¡
 + LIST_1);

350 
bmco¡
[
li¡
] +ð
	`BIDP¬t™iÚCo¡
 (
cu¼MB
, 
mode
, 
block
, 
be¡_»f
, 
’c_mb
->
Ïmbda_mf
[
Q_PEL
]);

355 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

357 
weight_sum
 = 
cu¼Sliû
->
wbp_weight
[0][0][0][0] + currSlice->wbp_weight[1][0][0][0];

359 ià(
weight_sum
 < -128 || weight_sum > 127)

361 
bmco¡
[
li¡
] = 
DISTBLK_MAX
;

365 
bmco¡
[
li¡
] = 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, 0, 
cur_li¡
è+„ef_co¡(cu¼Sliû,„ef_Ïmbda, 0, cur_li¡ + 
LIST_1
);

366 
bmco¡
[
li¡
] +ð
	`BP»dP¬t™iÚCo¡
(
cu¼MB
, 
mode
, 
block
, 0, 0, 
’c_mb
->
Ïmbda_mf
[
Q_PEL
], !(list&1));

371 
bmco¡
[
li¡
] = 
	`»f_co¡
(
cu¼Sliû
, 
»f_Ïmbda
, 0, 
cur_li¡
è+„ef_co¡(cu¼Sliû,„ef_Ïmbda, 0, cur_li¡ + 
LIST_1
);

372 
bmco¡
[
li¡
] +ð
	`BP»dP¬t™iÚCo¡
(
cu¼MB
, 
mode
, 
block
, 0, 0, 
’c_mb
->
Ïmbda_mf
[
Q_PEL
], !(list&1));

375 
	}
}

377 
šlše
 
di¡blk
 
	$compu‹_»f_co¡
(
Sliû
 *
cu¼Sliû
, 
RD_PARAMS
 *
’c_mb
, 
»f
, 
li¡
)

379  
	`weigh‹d_co¡
(
’c_mb
->
Ïmbda_mf
[
Q_PEL
],((
cu¼Sliû
->
li¡Xsize
[
li¡
] <ð1)? 0 : cu¼Sliû->
p_Vid
->
»fb™s
[
»f
]));

380 
	}
}

388 
	$d‘”mše_´ediùiÚ_li¡
Ð
di¡blk
 
bmco¡
[5], 
Info8x8
 *
be¡
, di¡blk *
co¡
)

390 
be¡li¡
;

391 *
co¡
 +ð
	`di¡blkmš¬¿y
 ( 
bmco¡
, 5, &
be¡li¡
);

393 ià(
be¡li¡
 <ð
BI_PRED
)

395 
be¡
->
pdœ
 = (è
be¡li¡
;

396 
be¡
->
b»d
= 0;

400 
be¡
->
pdœ
 = 2;

401 
be¡
->
b»d
 = (è(
be¡li¡
 - 2);

402 
be¡
->
»f
[
LIST_0
] = 0;

403 
be¡
->
»f
[
LIST_1
] = 0;

405 
	}
}

414 
	$compu‹_mode_RD_co¡
(
Maüoblock
 *
cu¼MB
,

415 
RD_PARAMS
 *
’c_mb
,

416 
mode
,

417 *
š‹r_sk
)

419 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

420 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

421 
‹rmš©e_16x16
 = 0, 
‹rmš©e_Œªs
 = 0, 
ùr16x16
 = 0;

422 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

423 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

424 
b¦iû
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
);

427 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = (
by‹
è(
p_IÅ
->
T¿nsfÜm8x8Mode
==2

428 ? (
mode
 >= 1 && mode <= 3)

429 || (
mode
 =ð0 && 
b¦iû
 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)

430 || ((
mode
 =ð
P8x8
è&& (
’c_mb
->
v®id
[4]))

433 
cu¼Sliû
->
	`£t_modes_ªd_»fs_fÜ_blocks
 (
cu¼MB
, (è
mode
);

437 
cu¼Sliû
->
NoResidueDœeù
 = 0;

439 ià((
p_IÅ
->
Fa¡CrIÁ¿DecisiÚ
 ) || (
cu¼MB
->
c_»d_mode
 =ð
DC_PRED_8
 || (
	`is_šŒa
(currMB) )))

444 
‹rmš©e_16x16
 = 
	`b¦iû_16x16_‹rmš©iÚ_cÚŒÞ
(
p_IÅ
, 
p_Vid
->
b8x8šfo
, &
ùr16x16
, 
mode
, 
b¦iû
);

447 
RD_8x8DATA
 *
t8x8_d©a
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 ? 
p_RDO
->
Œ8x8
 :…_RDO->
Œ4x4
;

449 ià(
mode
 =ð
P8x8
 )

451 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][0] = 
t8x8_d©a
->
·¹
[0];

452 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][1] = 
t8x8_d©a
->
·¹
[1];

453 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][2] = 
t8x8_d©a
->
·¹
[2];

454 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][3] = 
t8x8_d©a
->
·¹
[3];

457 ià(
	`CheckP»diùiÚP¬ams
(
cu¼MB
, 
p_Vid
->
b8x8šfo
, 
mode
è=ð
TRUE
)

459 ià(
	`RDCo¡_fÜ_maüoblocks
 (
cu¼MB
, 
’c_mb
->
Ïmbda_mdå
, 
mode
))

462 ià(
p_IÅ
->
RCEÇbË
)

464 if(
mode
 =ð
P8x8
)

466 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
t8x8_d©a
->
m´8x8
);

469 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
p_RDO
->
´ed
);

472 
	`¡Üe_maüoblock_·¿m‘”s
 (
cu¼MB
, 
mode
);

474 if(
p_IÅ
->
rdÝt
 =ð2 && 
mode
 =ð0 &&…_IÅ->
E¬lySkEÇbË
)

477 if(
cu¼MB
->
cbp
 == 0)

478 *
š‹r_sk
 = 1;

484 
‹rmš©e_Œªs
 = 
	`ŒªsfÜm_‹rmš©iÚ_cÚŒÞ
(
cu¼MB
, 
mode
);

486 }!
‹rmš©e_Œªs
);

487 }!
‹rmš©e_16x16
);

491 iàÐ(
b¦iû
 && 
mode
 =ð0 && (*
š‹r_sk
 =ð0è&& 
’c_mb
->
v®id
[mode] && 
cu¼MB
->
cbp
 && (cu¼MB->cbp&15è!ð15 && !
p_IÅ
->
nobsk


492 && !(
cu¼MB
->
qp_sÿËd
[0] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==1) )

495 
cu¼Sliû
->
NoResidueDœeù
 = 1;

496 if(
mode
 =ð
P8x8
)

498 
RD_8x8DATA
 *
t8x8_d©a
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 ? 
p_RDO
->
Œ8x8
 :…_RDO->
Œ4x4
;

499 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][0] = 
t8x8_d©a
->
·¹
[0];

500 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][1] = 
t8x8_d©a
->
·¹
[1];

501 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][2] = 
t8x8_d©a
->
·¹
[2];

502 
p_Vid
->
b8x8šfo
->
be¡
[
P8x8
][3] = 
t8x8_d©a
->
·¹
[3];

503 if(
p_IÅ
->
T¿nsfÜm8x8Mode
 =ð1 && 
cu¼MB
->
v®id_8x8
 && cu¼MB->
v®id_4x4
)

505 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, (!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
));

508 ià(
	`CheckP»diùiÚP¬ams
(
cu¼MB
, 
p_Vid
->
b8x8šfo
, 
mode
è=ð
TRUE
)

510 ià(
	`RDCo¡_fÜ_maüoblocks
 (
cu¼MB
, 
’c_mb
->
Ïmbda_mdå
, 
mode
))

513 ià(
p_IÅ
->
RCEÇbË
)

514 
	`rc_¡Üe_diff
(
cu¼Sliû
->
diffy
, &
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], cu¼MB->
pix_x
, 
p_RDO
->
´ed
);

516 ià(
p_Vid
->
Ad­tiveRoundšg
)

517 
	`»£t_ad­tive_roundšg_dœeù
(
p_Vid
);

519 
	`¡Üe_maüoblock_·¿m‘”s
 (
cu¼MB
, 
mode
);

522 if(
mode
 =ð
P8x8
)

524 if(
p_IÅ
->
T¿nsfÜm8x8Mode
 =ð1 && 
cu¼MB
->
v®id_8x8
 && cu¼MB->
v®id_4x4
)

526 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 0);

532 ià(
p_Vid
->
Ad­tiveRoundšg
 && 
b¦iû
 && 
mode
 <= 1)

534 ià(
cu¼MB
->
‹mp_ŒªsfÜm_size_8x8_æag
)

535 
	`upd©e_ad­tive_roundšg_16x16
Ð
p_Vid
,…_Vid->
ARCofAdj8x8
, 
mode
);

537 
	`upd©e_ad­tive_roundšg_16x16
Ð
p_Vid
,…_Vid->
ARCofAdj4x4
, 
mode
);

540 
	}
}

542 
	$g‘_š™Ÿl_mb16x16_co¡
(
Maüoblock
* 
cu¼MB
)

544 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

545 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

546 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

547 ià(
cu¼MB
->
mb_Ëá
 && cu¼MB->
mb_up
)

549 
p_Vid
->
mb16x16_co¡
 = (p_Vid->
mb16x16_co¡_äame
[
cu¼MB
->
mbAddrX
 - 1] +

550 
p_Vid
->
mb16x16_co¡_äame
[
cu¼MB
->
mbAddrX
 - (p_Vid->
width
>>4)] + 1)/2.0;

552 ià(
cu¼MB
->
mb_Ëá
)

554 
p_Vid
->
mb16x16_co¡
 =…_Vid->
mb16x16_co¡_äame
[
cu¼MB
->
mbAddrX
 - 1];

556 ià(
cu¼MB
->
mb_up
)

558 
p_Vid
->
mb16x16_co¡
 =…_Vid->
mb16x16_co¡_äame
[
cu¼MB
->
mbAddrX
 - (p_Vid->
width
>>4)];

562 
p_Vid
->
mb16x16_co¡
 = 
CALM_MF_FACTOR_THRESHOLD
;

565 
p_RDO
->
Ïmbda_mf_çùÜ
 = 
p_Vid
->
mb16x16_co¡
 < 
CALM_MF_FACTOR_THRESHOLD
 ? 1.0 : 
	`sq¹
Õ_Vid->mb16x16_co¡ / (CALM_MF_FACTOR_THRESHOLD *…_Vid->Ïmbda_mf_çùÜ[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
qp
]));

566 
	}
}

568 
	$adju¡_mb16x16_co¡
(
Maüoblock
 *
cu¼MB
, 
di¡blk
 
co¡
)

570 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

571 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

572 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

574 
p_Vid
->
mb16x16_co¡
 = (è
co¡
;

575 
p_Vid
->
mb16x16_co¡_äame
[
cu¼MB
->
mbAddrX
] =…_Vid->
mb16x16_co¡
;

576 #ià
JCOST_CALC_SCALEUP


577 
p_RDO
->
Ïmbda_mf_çùÜ
 = (
p_Vid
->
mb16x16_co¡
 < 
CALM_MF_FACTOR_THRESHOLD
 * (1 << 
LAMBDA_ACCURACY_BITS
))

579 : 
	`sq¹
(
p_Vid
->
mb16x16_co¡
 / (
CALM_MF_FACTOR_THRESHOLD
*(1<<
LAMBDA_ACCURACY_BITS
è*…_Vid->
Ïmbda_mf_çùÜ
[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
qp
]));

581 
p_RDO
->
Ïmbda_mf_çùÜ
 = (
p_Vid
->
mb16x16_co¡
 < 
CALM_MF_FACTOR_THRESHOLD
)

583 : 
	`sq¹
(
p_Vid
->
mb16x16_co¡
 / (
CALM_MF_FACTOR_THRESHOLD
 *…_Vid->
Ïmbda_mf_çùÜ
[
cu¼Sliû
->
¦iû_ty³
][p_Vid->
qp
]));

585 
	}
}

587 
	$upd©e_Ïmbda_co¡s
(
Maüoblock
 *
cu¼MB
, 
RD_PARAMS
 *
’c_mb
, 
Ïmbda_mf
[3])

589 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

590 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼MB
->
p_Sliû
->p_RDO;

592 
MEPos
;

593 
MEPos
 = 0; MEPos < 3; MEPos ++)

595 
Ïmbda_mf
[
MEPos
] = 
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 =ð0 ? 
’c_mb
->Ïmbda_mf[MEPos] : ()Ónc_mb->Ïmbda_mf[MEPos] * 
	`sq¹
(
p_RDO
->
Ïmbda_mf_çùÜ
));

597 
	}
}

605 
	$imš¬¿y
 ( 
¬r
[], 
size
, *
mššd
 )

607 
i
;

608 
mšÿnd
 = 
¬r
[0];

609 *
mššd
 = 0;

610  
i
 = 1; i < 
size
; i++ )

612 ià(
¬r
[
i
] < 
mšÿnd
)

614 
mšÿnd
 = 
¬r
[
i
];

615 *
mššd
 = 
i
;

618  
mšÿnd
;

619 
	}
}

621 
di¡blk
 
	$di¡blkmš¬¿y
 ( 
di¡blk
 
¬r
[], 
size
, *
mššd
 )

623 
i
;

624 
di¡blk
 
mšÿnd
 = 
¬r
[0];

625 *
mššd
 = 0;

626  
i
 = 1; i < 
size
; i++ )

628 ià(
¬r
[
i
] < 
mšÿnd
)

630 
mšÿnd
 = 
¬r
[
i
];

631 *
mššd
 = 
i
;

634  
mšÿnd
;

635 
	}
}

643 
	$is_b»d_’abËd
(
VideoP¬am‘”s
 *
p_Vid
, 
mode
)

645  
p_Vid
->
b»d_’abËd
[(
mode
 =ð
P8x8
) ? 4: mode];

646 
	}
}

654 
	$ŒªsfÜm_‹rmš©iÚ_cÚŒÞ
(
Maüoblock
* 
cu¼MB
, 
mode
)

656 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

657 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

658 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

664 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 == 1)

667 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 =ð
FALSE
 &&

668 ((
mode
 >ð1 && mod<ð3è|| ((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& mod=ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
è|| (mod=ð
P8x8
)))

673 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

678 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

686 
	}
}

694 
	$b¦iû_16x16_‹rmš©iÚ_cÚŒÞ
(
IÅutP¬am‘”s
 *
p_IÅ
, 
Block8x8Info
 *
b8x8šfo
, *
ùr16x16
, 
mode
, 
b¦iû
)

696 
Ï¡check
 = 1;

698 ià(
mode
 =ð1 && 
b¦iû
)

700 
pdœ
 = 0;

701 
i
;

702 
b»d_me
 = 0;

704 *
ùr16x16
)

707 
pdœ
 = 0;

708 
Ï¡check
 = 0;

711 
pdœ
 = 1;

712 
Ï¡check
 = 0;

715 
pdœ
 = 2;

716 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
)

718 
Ï¡check
 = 0;

722 
pdœ
 = 2;

723 
b»d_me
 = 1;

724 
Ï¡check
 = 0;

727 
pdœ
 = 2;

728 
b»d_me
 = 2;

731 
	`”rÜ
("invalid 'ctr16x16' value", -1);

734 
i
 = 0; i< 4; i++)

736 
b8x8šfo
->
be¡
[1][
i
].
b»d
 = 
b»d_me
;

737 
b8x8šfo
->
be¡
[1][
i
].
pdœ
 =…dir;

739 (*
ùr16x16
)++;

741  
Ï¡check
;

742 
	}
}

750 
	$g‘_b»d_co¡
(
Maüoblock
 *
cu¼MB
, 
mode
, 
block
, 
i
, 
j
, 
Info8x8
 *
be¡
, 
RD_PARAMS
 *
’c_mb
, 
di¡blk
 
bmco¡
[5])

752 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

753 
MÙiÚVeùÜ
 *
bi0_mv_l0
 = &
cu¼Sliû
->
b»d_mv
[0][
LIST_0
][0][
mode
][
j
][
i
];

754 
MÙiÚVeùÜ
 *
bi0_mv_l1
 = &
cu¼Sliû
->
b»d_mv
[0][
LIST_1
][0][
mode
][
j
][
i
];

755 
MÙiÚVeùÜ
 *
bi1_mv_l0
 = &
cu¼Sliû
->
b»d_mv
[1][
LIST_0
][0][
mode
][
j
][
i
];

756 
MÙiÚVeùÜ
 *
bi1_mv_l1
 = &
cu¼Sliû
->
b»d_mv
[1][
LIST_1
][0][
mode
][
j
][
i
];

757 
di¡blk
 
MaxV®
 = 
DISTBLK_MAX
;

758 ià(
be¡
->
»f
[0] == 0 && best->ref[1] == 0)

760 
MÙiÚVeùÜ
 *
sšgË_mv_l0
 = &
cu¼Sliû
->
®l_mv
 [
LIST_0
][0][
mode
][
j
][
i
];

761 
MÙiÚVeùÜ
 *
sšgË_mv_l1
 = &
cu¼Sliû
->
®l_mv
 [
LIST_1
][0][
mode
][
j
][
i
];

763 ià((
sšgË_mv_l0
->
mv_x
 !ð
bi0_mv_l0
->mv_xè|| (sšgË_mv_l0->
mv_y
 != bi0_mv_l0->mv_y) ||

764 (
sšgË_mv_l1
->
mv_x
 !ð
bi0_mv_l1
->mv_xè|| (sšgË_mv_l1->
mv_y
 != bi0_mv_l1->mv_y))

765 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

767 
bmco¡
[
BI_PRED_L0
] = 
MaxV®
;

769 ià((
sšgË_mv_l0
->
mv_x
 !ð
bi1_mv_l0
->mv_xè|| (sšgË_mv_l0->
mv_y
 != bi1_mv_l0->mv_y) ||

770 (
sšgË_mv_l1
->
mv_x
 !ð
bi1_mv_l1
->mv_xè|| (sšgË_mv_l1->
mv_y
 != bi1_mv_l1->mv_y))

772 ià((
bi0_mv_l0
->
mv_x
 !ð
bi1_mv_l0
->mv_xè|| (bi0_mv_l0->
mv_y
 != bi1_mv_l0->mv_y) ||

773 (
bi0_mv_l1
->
mv_x
 !ð
bi1_mv_l1
->mv_xè|| (bi0_mv_l1->
mv_y
 != bi1_mv_l1->mv_y))

774 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L1
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

776 
bmco¡
[
BI_PRED_L1
] = 
MaxV®
;

779 
bmco¡
[
BI_PRED_L1
] = 
MaxV®
;

783 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

784 ià((
bi0_mv_l0
->
mv_x
 !ð
bi1_mv_l0
->mv_xè|| (bi0_mv_l0->
mv_y
 != bi1_mv_l0->mv_y) ||

785 (
bi0_mv_l1
->
mv_x
 !ð
bi1_mv_l1
->mv_xè|| (bi0_mv_l1->
mv_y
 != bi1_mv_l1->mv_y))

786 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L1
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

788 
bmco¡
[
BI_PRED_L1
] = 
MaxV®
;

790 
	}
}

	@lencod/src/mode_decision_P8x8.c

12 
	~<m©h.h
>

13 
	~<lim™s.h
>

14 
	~<æßt.h
>

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"mode_decisiÚ.h
"

19 
	~"maüoblock.h
"

20 
	~"”rdo.h
"

21 
	~"q_¬ound.h
"

22 
	~"md_commÚ.h
"

23 
	~"rdÝt.h
"

26 
	$cÝy_·¹_šfo
(
Info8x8
 *
b8x8
, Info8x8 *
·¹
)

28 
b8x8
[0] = 
·¹
[0];

29 
b8x8
[1] = 
·¹
[1];

30 
b8x8
[2] = 
·¹
[2];

31 
b8x8
[3] = 
·¹
[3];

32 
	}
}

40 
	$submaüoblock_mode_decisiÚ_p_¦iû
(
Maüoblock
 *
cu¼MB
,

41 
RD_PARAMS
 *
’c_mb
,

42 
RD_8x8DATA
 *
d©aTr
,

43 ****
cofACŒ
,

44 
block
,

45 
di¡blk
 *
co¡
)

47 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

48 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

49 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

50 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

51 
ŒªsfÜm8x8
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

52 
št64
 
cu¼_cbp_blk
;

53 
j
, 
k
;

54 
šdex
;

55 
mode
;

56 
di¡blk
 
mš_rdco¡
, 
rdco¡
 = 0;

57 
di¡blk
 
mš_co¡8x8
;

58 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

59 
út_nÚz
 = 0;

60 
be¡_út_nÚz
 = 0;

61 
maxšdex
 = (
ŒªsfÜm8x8
) ? 2 : 5;

62 
block_x
, 
block_y
;

63 
Ïmbda_mf
[3];

65 ****
çdju¡
 = 
ŒªsfÜm8x8
? 
p_Vid
->
ARCofAdj8x8
 :…_Vid->
ARCofAdj4x4
;

68 
j0
 = ((
block
>>1)<<3);

69 
j1
 = (
j0
>>2);

70 
i0
 = ((
block
&0x01)<<3);

71 
i1
 = (
i0
>>2);

73 
BoÞ—n
 
v®id_8x8
 = 
FALSE
;

74 
BoÞ—n
 
¡Üed_¡©e_8x8
 = 
FALSE
;

76 #ifdeà
BEST_NZ_COEFF


77 
be¡_nz_cÛff
[2][2];

80 
Info8x8
 *
·¹™iÚ
 = &(
d©aTr
->
·¹
[
block
]);

81 
Info8x8
 
be¡
 = 
	`š™_šfo_8x8_¡ruù
();

83 *
·¹™iÚ
 = 
be¡
;

84 ià(
ŒªsfÜm8x8
)

85 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

87 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

89 #ifdeà
BEST_NZ_COEFF


90 
j
 = 0; j <= 1; j++)

92 
i
 = 0; i <= 1; i++)

93 
be¡_nz_cÛff
[
i
][
j
] = 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 + j] = 0;

97 if(
p_IÅ
->
subMBCodšgS‹
 == 2)

98 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
(
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

101 
mš_co¡8x8
 = 
DISTBLK_MAX
, 
mš_rdco¡
 = DISTBLK_MAX, 
šdex
 = 1; index < 
maxšdex
; index++)

104 
mode
 = 
b8_mode_bË
[
šdex
];

106 
be¡
.
mode
 = () mode;

107 *
co¡
 = 0;

109 ià(
’c_mb
->
v®id
[
mode
] && (!(
ŒªsfÜm8x8
 == 1 && mode > 4)) && (transform8x8 == 0 || mode != 0 ))

111 ià(
ŒªsfÜm8x8
)

113 
cu¼MB
->
v®id_8x8
 = 
TRUE
;

116 
cu¼MB
->
v®id_4x4
 = 
TRUE
;

117 
v®id_8x8
 = 
TRUE
;

118 
cu¼_cbp_blk
 = 0;

121 
b_»f
;

125 
	`memýy
(
Ïmbda_mf
, 
’c_mb
->lambda_mf, 3 * ());

127 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

129 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

130 
Ïmbda_mf
[
F_PEL
] = ()Öambda_mf[F_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

131 
Ïmbda_mf
[
H_PEL
] = ()Öambda_mf[H_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

132 
Ïmbda_mf
[
Q_PEL
] = ()Öambda_mf[Q_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

135 
	`SubP¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

138 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

139 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

142 
block_x
 = 
cu¼MB
->block_x + (
block
 & 0x01)*2;

143 
block_y
 = 
cu¼MB
->block_y + (
block
 & 0x02);

144 
b_»f
 = 
be¡
.
»f
[
LIST_0
];

146 
mÙiÚ
[
block_y
 ][
block_x
 ].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

147 
mÙiÚ
[
block_y
 ][
block_x
 ].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 ][
i1
 ];

148 
mÙiÚ
[
block_y
 ][
block_x
 ].
»f_idx
 [
LIST_0
] = (è
b_»f
;

149 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

150 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 ][
i1
 + 1];

151 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
»f_idx
 [
LIST_0
] = (è
b_»f
;

152 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

153 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 + 1][
i1
 ];

154 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
»f_idx
 [
LIST_0
] = (è
b_»f
;

155 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

156 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 + 1][
i1
 + 1];

157 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
»f_idx
 [
LIST_0
] = (è
b_»f
;

159 
be¡
.
pdœ
 = 0;

160 *
co¡
 = 
bmco¡
[
LIST_0
];

164 
rdco¡
 = 
	`rdco¡_fÜ_8x8blocks
 (
cu¼MB
, 
d©aTr
, &
út_nÚz
, &
cu¼_cbp_blk
, 
’c_mb
->
Ïmbda_mdå
, 
block
, (è
mode
, &
be¡
, 
mš_rdco¡
);

167 ià(
rdco¡
 < 
mš_rdco¡
)

169 
mš_co¡8x8
 = *
co¡
;

170 
mš_rdco¡
 = 
rdco¡
;

171 *
·¹™iÚ
 = 
be¡
;

172 
·¹™iÚ
->
mode
 = () mode;

173 
cu¼MB
->
b8x8
[
block
].
mode
 = () mode;

175 #ifdeà
BEST_NZ_COEFF


176 ià(
út_nÚz
)

178 
i
 = 0; i <= 1; i++)

180 
be¡_nz_cÛff
[
i
][0]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 ];

181 
be¡_nz_cÛff
[
i
][1]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 + 1];

186 
i
 = 0; i <= 1; i++)

188 
be¡_nz_cÛff
[
i
][0]= 0;

189 
be¡_nz_cÛff
[
i
][1]= 0;

195 
be¡_út_nÚz
 = 
út_nÚz
;

198 
d©aTr
->
cbp_blk8x8
 &ð(~(0x33 << (((
block
>>1)<<3)+((block & 0x01)<<1))));

199 
d©aTr
->
cbp_blk8x8
 |ð
cu¼_cbp_blk
;

202 
	`memýy
(&
cofACŒ
[0][0][0][0],&
cu¼Sliû
->
cofAC
[
block
][0][0][0], 4 * 2 * 65 * ());

204 ifÐ
cu¼Sliû
->
P444_jošed
 )

207 
	`memýy
(&
cofACŒ
[1][0][0][0],&
cu¼Sliû
->
cofAC
[
block
 + 4][0][0][0], 4 * 2 * 65 * ());

208 
	`memýy
(&
cofACŒ
[2][0][0][0],&
cu¼Sliû
->
cofAC
[
block
 + 8][0][0][0], 4 * 2 * 65 * ());

212 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mbY8x8
[
j0
], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

213 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8
[
j0
], &
cu¼Sliû
->
mb_´ed
[0][j0], 
i0
, i0);

215 ià(
p_IÅ
->
rdÝt
 == 3)

217 
	`”rdo_¡Üe_be¡_b8x8
(
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

220 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

222 
j
 = 
j0
; j < j0 + 
BLOCK_SIZE_8x8
; j++)

224 
	`memýy
(&
d©aTr
->
Ìec
[
j
][
i0
],&
p_Vid
->Ìec[
cu¼MB
->
pix_y
 + j][cu¼MB->
pix_x
 + i0], 
BLOCK_SIZE_8x8
 * ());

228 if(
cu¼Sliû
->
P444_jošed
)

230 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[0][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

231 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[0][
j0
], &
cu¼Sliû
->
mb_´ed
[1][j0], 
i0
, i0);

233 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[1][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

234 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[1][
j0
], &
cu¼Sliû
->
mb_´ed
[2][j0], 
i0
, i0);

238 ià(
block
 < 3)

240 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

241 
¡Üed_¡©e_8x8
 = 
TRUE
;

246 ià(
šdex
 !ð
maxšdex
 - 1)

248 if(
p_IÅ
->
subMBCodšgS‹
 == 1)

249 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

250 if(
p_IÅ
->
subMBCodšgS‹
 == 2)

251 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

256 ià(
v®id_8x8
 =ð
TRUE
)

258 #ifdeà
BEST_NZ_COEFF


259 
i
 = 0; i <= 1; i++)

261 
j
 = 0; j <= 1; j++)

262 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + 
i
][
j1
 + 
j
] = 
be¡_nz_cÛff
[i][j];

266 ià(!
ŒªsfÜm8x8
)

268 ià(
mš_co¡8x8
 !ð
DISTBLK_MAX
)

269 
d©aTr
->
mb_p8x8_co¡
 +ð
mš_co¡8x8
;

271 
d©aTr
->
mb_p8x8_co¡
 = 
DISTBLK_MAX
;

275 ià(
be¡_út_nÚz
)

277 
d©aTr
->
cbp8x8
 |ð(1 << 
block
);

278 
d©aTr
->
út_nÚz_8x8
 +ð
be¡_út_nÚz
;

281 ià(!
ŒªsfÜm8x8
)

283 ià(
block
 < 3)

286 
j0
 = 8*(
block
 >> 1);

287 
i0
 = 8*(
block
 & 0x01);

290 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mbY8x8
[j0], cu¼MB->
pix_x
 + 
i0
, i0);

292 ià(
p_IÅ
->
rdÝt
 == 3)

294 
	`”rdo_g‘_be¡_b8x8
(
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

297 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

299 
j
 = 
j0
; j < j0 + 
BLOCK_SIZE_8x8
; j++)

301 
	`memýy
(&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
 + 
j
][cu¼MB->
pix_x
], 
d©aTr
->Ìec[j], 2 * 
BLOCK_SIZE
 * ());

305 if(
cu¼Sliû
->
P444_jošed
)

308 
k
=0; k<2; k++)

310 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[
k
][
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mb8x8_ü
[k][j0], cu¼MB->
pix_x
 + 
i0
, i0);

318 
cu¼Sliû
->
	`¡Üe_8x8_mÙiÚ_veùÜs
(cu¼Sliû, 0, 
block
, 
·¹™iÚ
);

322 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, 
·¹™iÚ
, 
block
);

326 ià(
¡Üed_¡©e_8x8
 =ð
TRUE
)

327 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

330 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

331 
	`upd©e_ad­tive_roundšg_8x8
(
p_Vid
, 
p_IÅ
, 
d©aTr
, 
çdju¡
);

334 
	}
}

342 
	$submaüoblock_mode_decisiÚ_b_¦iû
(
Maüoblock
 *
cu¼MB
,

343 
RD_PARAMS
 *
’c_mb
,

344 
RD_8x8DATA
 *
d©aTr
,

345 ****
cofACŒ
,

346 
block
,

347 
di¡blk
 *
co¡
)

349 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

350 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

351 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

352 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

353 
ŒªsfÜm8x8
 = 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
;

354 
maxšdex
 = (
ŒªsfÜm8x8
) ? 2 : 5;

355 
št64
 
cu¼_cbp_blk
;

356 
k
;

357 
šdex
;

358 
mode
;

359 
di¡blk
 
mš_rdco¡
, 
rdco¡
 = 0;

360 
di¡blk
 
mš_co¡8x8
;

361 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

362 
út_nÚz
 = 0;

363 
be¡_út_nÚz
 = 0;

364 
block_x
, 
block_y
;

365 
Ïmbda_mf
[3];

367 ****
çdju¡
 = 
ŒªsfÜm8x8
? 
p_Vid
->
ARCofAdj8x8
 :…_Vid->
ARCofAdj4x4
;

370 
j0
 = ((
block
>>1)<<3);

371 
j1
 = (
j0
>>2);

372 
i0
 = ((
block
&0x01)<<3);

373 
i1
 = (
i0
>>2);

375 
BoÞ—n
 
v®id_8x8
 = 
FALSE
;

376 
BoÞ—n
 
¡Üed_¡©e_8x8
 = 
FALSE
;

378 #ifdeà
BEST_NZ_COEFF


379 
be¡_nz_cÛff
[2][2];

383 
Info8x8
 *
·¹™iÚ
 = &(
d©aTr
->
·¹
[
block
]);

384 
Info8x8
 
be¡
 = 
	`š™_šfo_8x8_¡ruù
();

385 *
·¹™iÚ
 = 
be¡
;

386 ià(
ŒªsfÜm8x8
)

387 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

389 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

391 #ifdeà
BEST_NZ_COEFF


392 
j
 = 0; j <= 1; j++)

394 
i
 = 0; i <= 1; i++)

395 
be¡_nz_cÛff
[
i
][
j
] = 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 + j] = 0;

399 if(
p_IÅ
->
subMBCodšgS‹
 == 2)

400 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
(
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

403 
mš_co¡8x8
 = 
DISTBLK_MAX
, 
mš_rdco¡
 = DISTBLK_MAX, 
šdex
 = 0; index < 
maxšdex
; index++)

406 
mode
 = 
b8_mode_bË
[
šdex
];

408 
be¡
.
mode
 = () mode;

409 *
co¡
 = 0;

411 ià(
’c_mb
->
v®id
[
mode
] && (!(
ŒªsfÜm8x8
 =ð1 && mod> 4)è&& (ŒªsfÜm8x8 =ð0 || mod!ð0 || (mod=ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)))

413 ià(
ŒªsfÜm8x8
)

415 
cu¼MB
->
v®id_8x8
 = 
TRUE
;

418 
cu¼MB
->
v®id_4x4
 = 
TRUE
;

420 
v®id_8x8
 = 
TRUE
;

421 
cu¼_cbp_blk
 = 0;

423 ià(
mode
==0)

425 
block_x
 = 
cu¼MB
->block_x + (
block
 & 0x01)*2;

426 
block_y
 = 
cu¼MB
->block_y + (
block
 & 0x02);

427 
be¡
.
»f
[
LIST_0
] = 
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][LIST_0];

428 
be¡
.
»f
[
LIST_1
] = 
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][LIST_1];

429 
be¡
.
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[
block_y
][
block_x
];

433 
b_»f
;

437 
	`memýy
(
Ïmbda_mf
, 
’c_mb
->lambda_mf, 3 * ());

439 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

441 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

442 
Ïmbda_mf
[
F_PEL
] = ()Öambda_mf[F_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

443 
Ïmbda_mf
[
H_PEL
] = ()Öambda_mf[H_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

444 
Ïmbda_mf
[
Q_PEL
] = ()Öambda_mf[Q_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

447 
	`SubP¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

450 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

451 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

454 
block_x
 = 
cu¼MB
->block_x + (
block
 & 0x01)*2;

455 
block_y
 = 
cu¼MB
->block_y + (
block
 & 0x02);

456 
b_»f
 = 
be¡
.
»f
[
LIST_0
];

458 
mÙiÚ
[
block_y
 ][
block_x
 ].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

459 
mÙiÚ
[
block_y
 ][
block_x
 ].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 ][
i1
 ];

460 
mÙiÚ
[
block_y
 ][
block_x
 ].
»f_idx
 [
LIST_0
] = (è
b_»f
;

461 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

462 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 ][
i1
 + 1];

463 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
»f_idx
 [
LIST_0
] = (è
b_»f
;

464 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

465 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 + 1][
i1
 ];

466 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
»f_idx
 [
LIST_0
] = (è
b_»f
;

467 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

468 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
b_»f
][
mode
][
j1
 + 1][
i1
 + 1];

469 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
»f_idx
 [
LIST_0
] = (è
b_»f
;

472 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

473 
bmco¡
[
BI_PRED
] = 
DISTBLK_MAX
;

474 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

477 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

480 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

482 
	`g‘_b»d_co¡
(
cu¼MB
, 
mode
, 
block
, 
i1
, 
j1
, &
be¡
, 
’c_mb
, 
bmco¡
);

486 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

487 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

491 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, 
co¡
);

494 
k
 = 
LIST_0
; k <ð
LIST_1
; k++)

496 
mÙiÚ
[
block_y
 ][
block_x
 ].
»f_idx
[
k
] = 
be¡
.
»f
[k];

497 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
»f_idx
[
k
] = 
be¡
.
»f
[k];

498 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
»f_idx
[
k
] = 
be¡
.
»f
[k];

499 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
»f_idx
[
k
] = 
be¡
.
»f
[k];

501 ià(
be¡
.
b»d
)

503 
mÙiÚ
[
block_y
 ][
block_x
 ].
mv
[
k
] = 
cu¼Sliû
->
b»d_mv
[
be¡
.
b»d
 - 1][k][(èbe¡.
»f
[k]][
mode
][
j1
 ][
i1
 ];

504 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
mv
[
k
] = 
cu¼Sliû
->
b»d_mv
[
be¡
.
b»d
 - 1][k][(èbe¡.
»f
[k]][
mode
][
j1
 ][
i1
 + 1];

505 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
mv
[
k
] = 
cu¼Sliû
->
b»d_mv
[
be¡
.
b»d
 - 1][k][(èbe¡.
»f
[k]][
mode
][
j1
 + 1][
i1
 ];

506 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
mv
[
k
] = 
cu¼Sliû
->
b»d_mv
[
be¡
.
b»d
 - 1][k][(èbe¡.
»f
[k]][
mode
][
j1
 + 1][
i1
 + 1];

510 
mÙiÚ
[
block_y
 ][
block_x
 ].
mv
[
k
] = 
cu¼Sliû
->
®l_mv
[k][(è
be¡
.
»f
[k]][
mode
][
j1
 ][
i1
 ];

511 
mÙiÚ
[
block_y
 ][
block_x
 + 1].
mv
[
k
] = 
cu¼Sliû
->
®l_mv
[k][(è
be¡
.
»f
[k]][
mode
][
j1
 ][
i1
 + 1];

512 
mÙiÚ
[
block_y
 + 1][
block_x
 ].
mv
[
k
] = 
cu¼Sliû
->
®l_mv
[k][(è
be¡
.
»f
[k]][
mode
][
j1
 + 1][
i1
 ];

513 
mÙiÚ
[
block_y
 + 1][
block_x
 + 1].
mv
[
k
] = 
cu¼Sliû
->
®l_mv
[k][(è
be¡
.
»f
[k]][
mode
][
j1
 + 1][
i1
 + 1];

519 
rdco¡
 = 
	`rdco¡_fÜ_8x8blocks
 (
cu¼MB
, 
d©aTr
, &
út_nÚz
, &
cu¼_cbp_blk
, 
’c_mb
->
Ïmbda_mdå
, 
block
, (è
mode
, &
be¡
, 
mš_rdco¡
);

522 ià(
rdco¡
 < 
mš_rdco¡
)

524 
mš_co¡8x8
 = *
co¡
;

525 
mš_rdco¡
 = 
rdco¡
;

526 *
·¹™iÚ
 = 
be¡
;

527 
·¹™iÚ
->
mode
 = () mode;

528 
cu¼MB
->
b8x8
[
block
].
mode
 = () mode;

530 #ifdeà
BEST_NZ_COEFF


531 ià(
út_nÚz
)

533 
i
 = 0; i <= 1; i++)

535 
be¡_nz_cÛff
[
i
][0]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 ];

536 
be¡_nz_cÛff
[
i
][1]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 + 1];

541 
i
 = 0; i <= 1; i++)

543 
be¡_nz_cÛff
[
i
][0]= 0;

544 
be¡_nz_cÛff
[
i
][1]= 0;

550 
be¡_út_nÚz
 = 
út_nÚz
;

553 
d©aTr
->
cbp_blk8x8
 &ð(~(0x33 << (((
block
>>1)<<3)+((block & 0x01)<<1))));

554 
d©aTr
->
cbp_blk8x8
 |ð
cu¼_cbp_blk
;

557 
	`memýy
(&
cofACŒ
[0][0][0][0],&
cu¼Sliû
->
cofAC
[
block
][0][0][0], 4 * 2 * 65 * ());

559 ifÐ
cu¼Sliû
->
P444_jošed
 )

562 
	`memýy
(&
cofACŒ
[1][0][0][0],&
cu¼Sliû
->
cofAC
[
block
 + 4][0][0][0], 4 * 2 * 65 * ());

563 
	`memýy
(&
cofACŒ
[2][0][0][0],&
cu¼Sliû
->
cofAC
[
block
 + 8][0][0][0], 4 * 2 * 65 * ());

567 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mbY8x8
[
j0
], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

568 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8
[
j0
], &
cu¼Sliû
->
mb_´ed
[0][j0], 
i0
, i0);

570 ià(
p_IÅ
->
rdÝt
 == 3)

572 
	`”rdo_¡Üe_be¡_b8x8
(
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

575 if(
cu¼Sliû
->
P444_jošed
)

577 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[0][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

578 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[0][
j0
], &
cu¼Sliû
->
mb_´ed
[1][j0], 
i0
, i0);

580 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[1][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

581 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[1][
j0
], &
cu¼Sliû
->
mb_´ed
[2][j0], 
i0
, i0);

585 ià(
block
 < 3)

587 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

588 
¡Üed_¡©e_8x8
 = 
TRUE
;

593 ià(
šdex
 !ð
maxšdex
 - 1)

595 if(
p_IÅ
->
subMBCodšgS‹
 == 1)

596 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

597 if(
p_IÅ
->
subMBCodšgS‹
 == 2)

598 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

603 ià(
v®id_8x8
 =ð
TRUE
)

605 #ifdeà
BEST_NZ_COEFF


606 
i
 = 0; i <= 1; i++)

608 
j
 = 0; j <= 1; j++)

609 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + 
i
][
j1
 + 
j
] = 
be¡_nz_cÛff
[i][j];

613 ià(!
ŒªsfÜm8x8
)

615 ià(
mš_co¡8x8
 !ð
DISTBLK_MAX
)

616 
d©aTr
->
mb_p8x8_co¡
 +ð
mš_co¡8x8
;

618 
d©aTr
->
mb_p8x8_co¡
 = 
DISTBLK_MAX
;

622 ià(
be¡_út_nÚz
)

624 
d©aTr
->
cbp8x8
 |ð(1 << 
block
);

625 
d©aTr
->
út_nÚz_8x8
 +ð
be¡_út_nÚz
;

628 ià(!
ŒªsfÜm8x8
)

630 ià(
block
 < 3)

633 
j0
 = 8*(
block
 >> 1);

634 
i0
 = 8*(
block
 & 0x01);

637 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mbY8x8
[j0], cu¼MB->
pix_x
 + 
i0
, i0);

639 ià(
p_IÅ
->
rdÝt
 == 3)

641 
	`”rdo_g‘_be¡_b8x8
(
cu¼MB
, 
ŒªsfÜm8x8
, 
block
);

644 if(
cu¼Sliû
->
P444_jošed
)

647 
k
=0; k<2; k++)

649 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[
k
][
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mb8x8_ü
[k][j0], cu¼MB->
pix_x
 + 
i0
, i0);

657 
cu¼Sliû
->
	`¡Üe_8x8_mÙiÚ_veùÜs
(cu¼Sliû, 0, 
block
, 
·¹™iÚ
);

661 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, 
·¹™iÚ
, 
block
);

665 ià(
¡Üed_¡©e_8x8
 =ð
TRUE
)

666 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

669 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

670 
	`upd©e_ad­tive_roundšg_8x8
(
p_Vid
, 
p_IÅ
, 
d©aTr
, 
çdju¡
);

673 
	}
}

681 
	$submaüoblock_mode_decisiÚ_low
(
Maüoblock
 *
cu¼MB
,

682 
RD_PARAMS
 *
’c_mb
,

683 
RD_8x8DATA
 *
d©aTr
,

684 ****
cofACŒ
,

685 *
have_dœeù
,

686 
block
,

687 
di¡blk
 *
co¡_dœeù
,

688 
di¡blk
 *
co¡
,

689 
di¡blk
 *
co¡8x8_dœeù
,

690 
ŒªsfÜm8x8
)

692 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

693 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

694 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

695 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

697 
št64
 
cu¼_cbp_blk
;

699 
j0
, 
i0
;

700 
i
, 
j
;

701 
šdex
;

702 
mode
;

703 
di¡blk
 
mš_co¡8x8
;

704 
di¡blk
 
dœeù4x4_tmp
, 
dœeù8x8_tmp
;

705 
di¡blk
 
bmco¡
[5] = {
DISTBLK_MAX
};

706 
út_nÚz
 = 0;

707 
dummy
;

708 
be¡_út_nÚz
 = 0;

709 
maxšdex
 = (
ŒªsfÜm8x8
) ? 2 : 5;

710 
block_x
, 
block_y
;

711 
Ïmbda_mf
[3];

713 ****
çdju¡
 = 
ŒªsfÜm8x8
? 
p_Vid
->
ARCofAdj8x8
 :…_Vid->
ARCofAdj4x4
;

714 
pdœ
;

716 
BoÞ—n
 
v®id_8x8
 = 
FALSE
;

717 
BoÞ—n
 
¡Üed_¡©e_8x8
 = 
FALSE
;

719 #ifdeà
BEST_NZ_COEFF


720 
j1
, 
i1
;

721 
be¡_nz_cÛff
[2][2];

724 
Info8x8
 
be¡
 = 
	`š™_šfo_8x8_¡ruù
();

725 
d©aTr
->
·¹
[
block
].
mode
 = 0;

726 ià(
ŒªsfÜm8x8
)

727 
cu¼MB
->
v®id_8x8
 = 
FALSE
;

729 
cu¼MB
->
v®id_4x4
 = 
FALSE
;

732 
j0
 = ((
block
>>1)<<3);

733 
i0
 = ((
block
&0x01)<<3);

735 #ifdeà
BEST_NZ_COEFF


736 
j1
 = (
j0
>>2);

737 
i1
 = (
i0
>>2);

738 
j
 = 0; j <= 1; j++)

740 
i
 = 0; i <= 1; i++)

741 
be¡_nz_cÛff
[
i
][
j
] = 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + i][
j1
 + j] = 0;

745 ià(
ŒªsfÜm8x8
)

746 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

749 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

752 
mš_co¡8x8
 = 
DISTBLK_MAX
, 
šdex
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 ? 0 : 1); index < 
maxšdex
; index++)

754 
mode
 = 
b8_mode_bË
[
šdex
];

755 
be¡
.
mode
 = () mode;

756 *
co¡
 = 0;

758 ià(
’c_mb
->
v®id
[
mode
] && (!(
ŒªsfÜm8x8
 =ð1 && mod> 4)è&& (ŒªsfÜm8x8 =ð0 || mod!ð0 || (mod=ð0 && 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)))

760 ià(
ŒªsfÜm8x8
)

762 
cu¼MB
->
v®id_8x8
 = 
TRUE
;

765 
cu¼MB
->
v®id_4x4
 = 
TRUE
;

767 
v®id_8x8
 = 
TRUE
;

768 
cu¼_cbp_blk
 = 0;

770 ià(
mode
==0)

773 
dœeù4x4_tmp
 = 0;

774 
dœeù8x8_tmp
 = 0;

775 
dœeù4x4_tmp
 = 
	`G‘DœeùCo¡8x8
 ( 
cu¼MB
, 
block
, &
dœeù8x8_tmp
);

776 ià((
dœeù4x4_tmp
==
DISTBLK_MAX
)||(*
co¡_dœeù
==DISTBLK_MAX))

778 *
co¡_dœeù
 = 
DISTBLK_MAX
;

779 ià(
ŒªsfÜm8x8
)

780 *
co¡8x8_dœeù
 = 
DISTBLK_MAX
;

784 *
co¡_dœeù
 +ð
dœeù4x4_tmp
;

785 ià(
ŒªsfÜm8x8
)

786 *
co¡8x8_dœeù
 +ð
dœeù8x8_tmp
;

788 (*
have_dœeù
) ++;

790 ià(
ŒªsfÜm8x8
)

792 
p_IÅ
->
T¿nsfÜm8x8Mode
)

795 if((
dœeù8x8_tmp
 < 
dœeù4x4_tmp
è|| !(
’c_mb
->
v®id
[5] &&ƒnc_mb->valid[6] &&ƒnc_mb->valid[7]))

796 *
co¡
 = 
dœeù8x8_tmp
;

798 *
co¡
 = 
dœeù4x4_tmp
;

801 *
co¡
 = 
dœeù8x8_tmp
;

804 *
co¡
 = 
dœeù4x4_tmp
;

807 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
==2)

808 *
co¡
 = 
DISTBLK_MAX
;

812 *
co¡
 = 
dœeù4x4_tmp
;

815 
block_x
 = 
cu¼MB
->block_x + (
block
 & 0x01)*2;

816 
block_y
 = 
cu¼MB
->block_y + (
block
 & 0x02);

817 
be¡
.
»f
[
LIST_0
] = 
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][LIST_0];

818 
be¡
.
»f
[
LIST_1
] = 
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][LIST_1];

819 
be¡
.
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[
block_y
][
block_x
];

823 
b_»f
;

827 
	`memýy
(
Ïmbda_mf
, 
’c_mb
->lambda_mf, 3 * ());

828 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

830 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

831 
Ïmbda_mf
[
F_PEL
] = ()Öambda_mf[F_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

832 
Ïmbda_mf
[
H_PEL
] = ()Öambda_mf[H_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

833 
Ïmbda_mf
[
Q_PEL
] = ()Öambda_mf[Q_PEL] * 
p_RDO
->
Ïmbda_mf_çùÜ
);

836 
	`SubP¬t™iÚMÙiÚS—rch
 (
cu¼MB
, 
mode
, 
block
, 
Ïmbda_mf
);

839 
bmco¡
[
LIST_0
] = 
DISTBLK_MAX
;

840 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

843 
block_x
 = 
cu¼MB
->block_x + (
block
 & 0x01)*2;

844 
block_y
 = 
cu¼MB
->block_y + (
block
 & 0x02);

845 
b_»f
 = 
be¡
.
»f
[
LIST_0
];

847 
j
 = 
block_y
; j< block_y + 2; j++)

849 
i
 = 
block_x
; i< block_x + 2; i++)

851 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[
cu¼MB
->
li¡_off£t
][
b_»f
];

852 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
b_»f
;

856 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

859 
bmco¡
[
LIST_1
] = 
DISTBLK_MAX
;

860 
bmco¡
[
BI_PRED
] = 
DISTBLK_MAX
;

861 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
LIST_1
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

864 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 
be¡
.
»f
);

867 ià(
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

869 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L0
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

870 
	`li¡_´ediùiÚ_co¡
(
cu¼MB
, 
BI_PRED_L1
, 
block
, 
mode
, 
’c_mb
, 
bmco¡
, 0);

874 
bmco¡
[
BI_PRED_L0
] = 
DISTBLK_MAX
;

875 
bmco¡
[
BI_PRED_L1
] = 
DISTBLK_MAX
;

879 
	`d‘”mše_´ediùiÚ_li¡
(
bmco¡
, &
be¡
, 
co¡
);

882 
j
 = 
block_y
; j< block_y + 2; j++)

884 
i
 = 
block_x
; i < block_x + 2; i++)

887 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
be¡
.
»f
[LIST_0];

888 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
be¡
.
»f
[
LIST_1
];

894 
be¡
.
pdœ
 = 0;

895 *
co¡
 = 
bmco¡
[
LIST_0
];

898 ià(*
co¡
 !ð
DISTBLK_MAX
)

899 *
co¡
 +ð(
	`»f_co¡
(
cu¼Sliû
, 
’c_mb
->
Ïmbda_mf
[
Q_PEL
], (è
	`B8Mode2V®ue
 (cu¼Sliû, (è
mode
, 
be¡
.
pdœ
),

900 (
be¡
.
pdœ
 < 1 ? 
cu¼MB
->
li¡_off£t
 : cu¼MB->li¡_off£ˆ+ 
LIST_1
)) - 1);

903 ià(*
co¡
 < 
mš_co¡8x8
)

905 
mš_co¡8x8
 = *
co¡
;

907 
d©aTr
->
·¹
[
block
] = 
be¡
;

908 
cu¼MB
->
b8x8
[
block
].
mode
 = () mode;

910 #ifdeà
BEST_NZ_COEFF


911 ià(
út_nÚz
)

913 
be¡_nz_cÛff
[0][0]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 ][
j1
 ];

914 
be¡_nz_cÛff
[0][1]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 ][
j1
 + 1];

915 
be¡_nz_cÛff
[1][0]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + 1][
j1
 ];

916 
be¡_nz_cÛff
[1][1]ð
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + 1][
j1
 + 1];

920 
be¡_nz_cÛff
[0][0]= 0;

921 
be¡_nz_cÛff
[0][1]= 0;

922 
be¡_nz_cÛff
[1][0]= 0;

923 
be¡_nz_cÛff
[1][1]= 0;

928 
be¡_út_nÚz
 = 
út_nÚz
;

931 ià(
block
 < 3)

933 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

934 
¡Üed_¡©e_8x8
 = 
TRUE
;

939 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

943 ià(
v®id_8x8
 =ð
TRUE
)

945 
li¡_mode
[2];

946 #ifdeà
BEST_NZ_COEFF


947 
i
 = 0; i <= 1; i++)

949 
j
 = 0; j <= 1; j++)

950 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
i1
 + 
i
][
j1
 + 
j
] = 
be¡_nz_cÛff
[i][j];

954 ià(!
ŒªsfÜm8x8
)

956 ià(
mš_co¡8x8
 !ð
DISTBLK_MAX
)

957 
d©aTr
->
mb_p8x8_co¡
 +ð
mš_co¡8x8
;

959 
d©aTr
->
mb_p8x8_co¡
 = 
DISTBLK_MAX
;

963 ià(
ŒªsfÜm8x8
)

965 ià(
mš_co¡8x8
 !ð
DISTBLK_MAX
)

966 
d©aTr
->
mb_p8x8_co¡
 +ð
mš_co¡8x8
;

968 
d©aTr
->
mb_p8x8_co¡
 = 
DISTBLK_MAX
;

970 
mode
 = 
d©aTr
->
·¹
[
block
].mode;

971 
pdœ
 = 
d©aTr
->
·¹
[
block
].pdir;

975 
mode
 = 
d©aTr
->
·¹
[
block
].mode;

976 
pdœ
 = 
d©aTr
->
·¹
[
block
].pdir;

979 
cu¼_cbp_blk
 = 0;

980 
cu¼MB
->
b8x8
[
block
].
b»d
 = 
d©aTr
->
·¹
[block].bipred;

981 
cu¼MB
->
¬_mode
 = (è((
mode
 !ð0)? mode: 
P8x8
);

983 
li¡_mode
[0] = (
pdœ
 =ð0 ||…dœ =ð2 ? 
mode
 : 0);

984 
li¡_mode
[1] = (
pdœ
 =ð1 ||…dœ =ð2 ? 
mode
 : 0);

986 
be¡_út_nÚz
 = 
cu¼Sliû
->
	`luma_»sidu®_codšg_8x8
 (
cu¼MB
, &
dummy
, &
cu¼_cbp_blk
, 
block
, 
pdœ
, 
li¡_mode
, 
d©aTr
->
·¹
[block].
»f
);

988 ià(
cu¼Sliû
->
P444_jošed
)

990 
be¡_út_nÚz
 +ð
cu¼Sliû
->
cÛff_co¡_ü
[1] + currSlice->coeff_cost_cr[2];

993 
d©aTr
->
cbp_blk8x8
 &ð(~(0x33 << (((
block
>>1)<<3)+((block & 0x01)<<1))));

994 
d©aTr
->
cbp_blk8x8
 |ð
cu¼_cbp_blk
;

997 
	`memýy
(
cofACŒ
[0][0][0],
cu¼Sliû
->
cofAC
[
block
][0][0], 4 * 2 * 65 * ());

999 if(
cu¼Sliû
->
P444_jošed
)

1002 
	`memýy
(
cofACŒ
[1][0][0],
cu¼Sliû
->
cofAC
[
block
 + 4][0][0], 4 * 2 * 65 * ());

1003 
	`memýy
(
cofACŒ
[2][0][0],
cu¼Sliû
->
cofAC
[
block
 + 8][0][0], 4 * 2 * 65 * ());

1008 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mbY8x8
[
j0
], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

1009 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8
[
j0
], &
cu¼Sliû
->
mb_´ed
[0][j0], 
i0
, i0);

1013 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

1015 
j
=
j0
; j < j0 + 
BLOCK_SIZE_8x8
; j++)

1017 
	`memýy
(&
d©aTr
->
Ìec
[
j
][
i0
],&
p_Vid
->Ìec[
cu¼MB
->
pix_y
+j][cu¼MB->
pix_x
+i0],
BLOCK_SIZE_8x8
 * ());

1020 if(
cu¼Sliû
->
P444_jošed
)

1022 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[0][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

1023 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[0][
j0
], &
cu¼Sliû
->
mb_´ed
[1][j0], 
i0
, i0);

1024 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
»c_mb8x8_ü
[1][
j0
], &
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
 + j0], 
i0
, cu¼MB->
pix_x
 + i0);

1025 
	`cÝy_image_d©a_8x8
(&
d©aTr
->
m´8x8CbCr
[1][
j0
], &
cu¼Sliû
->
mb_´ed
[2][j0], 
i0
, i0);

1030 ià(
be¡_út_nÚz
)

1032 
d©aTr
->
cbp8x8
 |ð(1 << 
block
);

1033 
d©aTr
->
út_nÚz_8x8
 +ð
be¡_út_nÚz
;

1036 ià(!
ŒªsfÜm8x8
)

1038 ià(
block
 < 3)

1041 
j0
 = 8*(
block
 >> 1);

1042 
i0
 = 8*(
block
 & 0x01);

1044 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mbY8x8
[j0], cu¼MB->
pix_x
 + 
i0
, i0);

1046 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

1048 
j
 = 
j0
; j < j0 + 
BLOCK_SIZE_8x8
; j++)

1050 
	`memýy
(&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
 + 
j
][cu¼MB->
pix_x
], 
d©aTr
->Ìec[j], 2 * 
BLOCK_SIZE
 * ());

1054 if(
cu¼Sliû
->
P444_jošed
)

1056 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mb8x8_ü
[0][j0], cu¼MB->
pix_x
 + 
i0
, i0);

1057 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
 + 
j0
], &
d©aTr
->
»c_mb8x8_ü
[1][j0], cu¼MB->
pix_x
 + 
i0
, i0);

1064 
cu¼Sliû
->
	`¡Üe_8x8_mÙiÚ_veùÜs
(cu¼Sliû, 0, 
block
, &
d©aTr
->
·¹
[block]);

1068 
cu¼Sliû
->
	`£t_»f_ªd_mÙiÚ_veùÜs
 (
cu¼MB
, 
mÙiÚ
, &
d©aTr
->
·¹
[
block
], block);

1072 ià(
¡Üed_¡©e_8x8
 =ð
TRUE
)

1073 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_b8
);

1076 
	`upd©e_ad­tive_roundšg_8x8
(
p_Vid
, 
p_IÅ
, 
d©aTr
, 
çdju¡
);

1079 
	}
}

	@lencod/src/mv_direct.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

19 
	~<lim™s.h
>

20 
	~<time.h
>

22 
	~"glob®.h
"

24 
	~"image.h
"

25 
	~"mv_£¬ch.h
"

26 
	~"»fbuf.h
"

27 
	~"mem®loc.h
"

28 
	~"mb_acûss.h
"

29 
	~"maüoblock.h
"

30 
	~"mc_´ediùiÚ.h
"

31 
	~"cÚfÜmªû.h
"

32 
	~"mode_decisiÚ.h
"

40 
	$G‘_Dœeù_MV_TempÜ®
 (
Maüoblock
 *
cu¼MB
)

42 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

43 
block_x
, 
block_y
, 
pic_block_x
, 
pic_block_y
, 
Ýic_block_x
, 
Ýic_block_y
;

44 
MÙiÚVeùÜ
 *****
®l_mvs
;

45 
mv_sÿË
;

46 
»fLi¡
;

47 
»f_idx
;

48 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

49 
li¡_off£t
 = 
cu¼MB
->list_offset;

51 
StÜabËPiùu»
 **
li¡1
 = 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
li¡_off£t
];

53 
PicMÙiÚP¬ams
 
cÞoÿ‹d
;

56 
block_y
 = 0; block_y < 4; block_y++)

58 
pic_block_y
 = 
cu¼MB
->
block_y
 + block_y;

59 
Ýic_block_y
 = (
cu¼MB
->
Ýix_y
 >> 2è+ 
block_y
;

61 
block_x
 = 0; block_x < 4; block_x++)

63 
pic_block_x
 = 
cu¼MB
->
block_x
 + block_x;

64 
Ýic_block_x
 = (
cu¼MB
->
pix_x
>>2è+ 
block_x
;

66 
®l_mvs
 = 
cu¼Sliû
->
®l_mv
;

67 ià(
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)

69 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

70 
cÞoÿ‹d
 = 
li¡1
[0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][
	`RSD
(
Ýic_block_y
)][RSD(
Ýic_block_x
)];

72 
cÞoÿ‹d
 = 
li¡1
[0]->
mv_šfo
[
	`RSD
(
Ýic_block_y
)][RSD(
Ýic_block_x
)];

73 if(
cu¼Sliû
->
mb_aff_äame_æag
 && 
cu¼MB
->
mb_f›ld
 && cu¼Sliû->
li¡X
[
LIST_1
][0]->
coded_äame
)

75 
iPosBlkY
;

76 if(
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
mÙiÚ
.
mb_f›ld
[
cu¼MB
->
mbAddrX
] )

77 
iPosBlkY
 = (
Ýic_block_y
>>2)*8+4*(
cu¼MB
->
mbAddrX
&1)+(opic_block_y&0x03);

79 
iPosBlkY
 = 
	`RSD
(
Ýic_block_y
)*2;

81 if(
cÞoÿ‹d
.
»f_idx
[
LIST_0
]>=0)

82 
cÞoÿ‹d
.
»f_pic
[
LIST_0
] = 
li¡1
[0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_0];

83 if(
cÞoÿ‹d
.
»f_idx
[
LIST_1
]>=0)

84 
cÞoÿ‹d
.
»f_pic
[
LIST_1
] = 
li¡1
[0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_1];

89 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

90 
cÞoÿ‹d
 = 
li¡1
[0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][
Ýic_block_y
][
Ýic_block_x
];

92 
cÞoÿ‹d
 = 
li¡1
[0]->
mv_šfo
[
Ýic_block_y
][
Ýic_block_x
];

94 if(
cu¼Sliû
->
mb_aff_äame_æag
)

96 if(!
cu¼MB
->
mb_f›ld
 && ((
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
coded_äame
 && cu¼Sliû->li¡X[LIST_1][0]->
mÙiÚ
.mb_f›ld[cu¼MB->
mbAddrX
]) ||

97 (!
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
coded_äame
)))

99 ià(
	`Ÿbs
(
p_Vid
->
’c_piùu»
->
poc
 - 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->poc)> iabs(p_Vid->enc_picture->poc -currSlice->listX[LIST_1+2][0]->poc) )

101 iàÐ
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
)

103 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

104 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+2][0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)];

106 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+2][0]->
mv_šfo
[
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)];

110 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

111 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+2][0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][(
Ýic_block_y
)>>1][(
Ýic_block_x
)];

113 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+2][0]->
mv_šfo
[(
Ýic_block_y
)>>1][
Ýic_block_x
];

115 if(
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
coded_äame
)

117 
iPosBlkY
 = (
	`RSD
(
Ýic_block_y
)>>3)*8 + ((RSD(opic_block_y)>>1) & 0x03);

118 if(
cÞoÿ‹d
.
»f_idx
[
LIST_0
] >=0)

119 
cÞoÿ‹d
.
»f_pic
[
LIST_0
] = 
cu¼Sliû
->
li¡X
[
LIST_1
+2][0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_0];

120 if(
cÞoÿ‹d
.
»f_idx
[
LIST_1
] >=0)

121 
cÞoÿ‹d
.
»f_pic
[
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1+2][0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_1];

126 ià(
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 )

128 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

129 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)];

131 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->
mv_šfo
[
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)];

136 if(
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 && cu¼MB->
p_Vid
->
yuv_fÜm©
==
YUV444
)

137 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->
JVmv_šfo
[
cu¼MB
->
p_Sliû
->
cÞour_¶ªe_id
][(
Ýic_block_y
)>>1][
Ýic_block_x
];

139 
cÞoÿ‹d
 = 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->
mv_šfo
[(
Ýic_block_y
)>>1][
Ýic_block_x
];

141 if(
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
coded_äame
)

143 
iPosBlkY
 = (
	`RSD
(
Ýic_block_y
)>>3)*8 + ((RSD(opic_block_y)>>1) & 0x03)+4;

144 if(
cÞoÿ‹d
.
»f_idx
[
LIST_0
] >=0)

145 
cÞoÿ‹d
.
»f_pic
[
LIST_0
] = 
cu¼Sliû
->
li¡X
[
LIST_1
+4][0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_0];

146 if(
cÞoÿ‹d
.
»f_idx
[
LIST_1
] >=0)

147 
cÞoÿ‹d
.
»f_pic
[
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1+4][0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_1];

152 if(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
 && !
cu¼Sliû
->
¡ruùu»
 && !cu¼Sliû->
li¡X
[
LIST_1
][0]->
coded_äame
)

154 ià(
	`Ÿbs
(
p_Vid
->
’c_piùu»
->
poc
 - 
li¡1
[0]->
bÙtom_f›ld
->poc)> iabsÕ_Vid->’c_piùu»->poø-li¡1[0]->
tÝ_f›ld
->poc) )

156 
cÞoÿ‹d
 = 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ?

157 
li¡1
[0]->
tÝ_f›ld
->
mv_šfo
[
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)] :†ist1[0]->top_field->mv_info[(opic_block_y)>>1][opic_block_x];

161 
cÞoÿ‹d
 = 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ?

162 
li¡1
[0]->
bÙtom_f›ld
->
mv_šfo
[
	`RSD
(
Ýic_block_y
)>>1][RSD(
Ýic_block_x
)] :†ist1[0]->bottom_field->mv_info[(opic_block_y)>>1][opic_block_x];

165 if(!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
 && 
cu¼Sliû
->
¡ruùu»
 && 
li¡1
[0]->
coded_äame
)

167 
iPosBlkY
;

168 
cu¼’tmb
 = 2*(
li¡1
[0]->
size_x
>>4è* (
Ýic_block_y
 >> 2)+ (
Ýic_block_x
>>2)*2 + ((opic_block_y>>1) & 0x01);

169 if(
cu¼Sliû
->
¡ruùu»
!=
li¡1
[0]->structure)

171 ià(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

173 
cÞoÿ‹d
 = 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ?

174 
li¡1
[0]->
äame
->
tÝ_f›ld
->
mv_šfo
[
	`RSD
(
Ýic_block_y
)][RSD(
Ýic_block_x
)] :†ist1[0]->frame->top_field->mv_info[opic_block_y][opic_block_x];

178 
cÞoÿ‹d
 = 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ?

179 
li¡1
[0]->
äame
->
bÙtom_f›ld
->
mv_šfo
[
	`RSD
(
Ýic_block_y
)][RSD(
Ýic_block_x
)] :†ist1[0]->frame->bottom_field->mv_info[opic_block_y][opic_block_x];

183 if(!
cu¼Sliû
->
li¡X
[
LIST_1
][0]->
äame
->
mb_aff_äame_æag
 || !
li¡1
[0]->äame->
mÙiÚ
.
mb_f›ld
[
cu¼’tmb
])

184 
iPosBlkY
 = 2*(
	`RSD
(
Ýic_block_y
));

186 
iPosBlkY
 = (
	`RSD
(
Ýic_block_y
)>>2)*8 + (RSD(Ýic_block_yè& 0x03)+4*(
cu¼Sliû
->
¡ruùu»
 =ð
BOTTOM_FIELD
);

187 if(
cÞoÿ‹d
.
»f_idx
[
LIST_0
] >=0)

188 
cÞoÿ‹d
.
»f_pic
[
LIST_0
] = 
li¡1
[0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_0];

189 if(
cÞoÿ‹d
.
»f_idx
[
LIST_1
] >=0)

190 
cÞoÿ‹d
.
»f_pic
[
LIST_1
] = 
li¡1
[0]->
äame
->
mv_šfo
[
iPosBlkY
][
	`RSD
(
Ýic_block_x
)].ref_pic[LIST_1];

193 
»fLi¡
 = ((
cÞoÿ‹d
.
»f_idx
[
LIST_0
] =ð-1 || (
p_Vid
->
v›w_id
 && cÞoÿ‹d.»f_idx[LIST_0]==
li¡1
[0]->
»f_pic_Ç
[0]))? 
LIST_1
 : LIST_0);

194 
»f_idx
 = 
cÞoÿ‹d
.»f_idx[
»fLi¡
];

197 ià(
»f_idx
 =ð-1 || (
p_Vid
->
v›w_id
 &&„ef_idx==
li¡1
[0]->
»f_pic_Ç
[
»fLi¡
]))

199 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

200 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

201 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
] = 0;

202 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
] = 0;

203 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

208 
m­³d_idx
=
INVALIDINDEX
;

209 
œef
;

210 ià(
cÞoÿ‹d
.
»f_pic
[
»fLi¡
] =ð
NULL
)

212 
	`´štf
("invalid index found\n");

216 ifÐ(
cu¼Sliû
->
mb_aff_äame_æag
 && ( (
cu¼MB
->
mb_f›ld
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->
¡ruùu»
==
FRAME
) ||

217 (!
cu¼MB
->
mb_f›ld
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->
¡ruùu»
!=
FRAME
))) ||

218 (!
cu¼Sliû
->
mb_aff_äame_æag
 && ((cu¼Sliû->
¡ruùu»
==
FRAME
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->structure!=FRAME)||

219 (
cu¼Sliû
->
¡ruùu»
!=
FRAME
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->structure==FRAME))) )

222 
œef
 = 0; i»à< 
	`imš
(
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0 + 
li¡_off£t
]); iref++)

224 ià(
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
œef
]->
tÝ_f›ld
 =ð
cÞoÿ‹d
.
»f_pic
[
»fLi¡
] ||

225 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
œef
]->
bÙtom_f›ld
 =ð
cÞoÿ‹d
.
»f_pic
[
»fLi¡
] ||

226 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
œef
]->
äame
 =ð
cÞoÿ‹d
.
»f_pic
[
»fLi¡
] )

228 ià((
p_Vid
->
f›ld_piùu»
==1è&& (
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
œef
]->
¡ruùu»
 != currSlice->structure))

230 
m­³d_idx
=
INVALIDINDEX
;

234 
m­³d_idx
 = 
œef
;

239 
m­³d_idx
=
INVALIDINDEX
;

244 
œef
 = 0; i»à< 
	`imš
(
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
], cu¼Sliû->
li¡Xsize
[LIST_0 + 
li¡_off£t
]);iref++)

246 if(
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][
œef
] =ð
cÞoÿ‹d
.
»f_pic
[
»fLi¡
])

248 
m­³d_idx
 = 
œef
;

253 
m­³d_idx
=
INVALIDINDEX
;

258 ià(
m­³d_idx
 !ð
INVALIDINDEX
)

260 
MÙiÚVeùÜ
 
mv
 = 
cÞoÿ‹d
.mv[
»fLi¡
];

261 
mv_sÿË
 = 
cu¼Sliû
->
mvsÿË
[
LIST_0
 + 
li¡_off£t
][
m­³d_idx
];

263 if((
cu¼Sliû
->
mb_aff_äame_æag
 && !
cu¼MB
->
mb_f›ld
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->
¡ruùu»
!=
FRAME
) ||

264 (!
cu¼Sliû
->
mb_aff_äame_æag
 && cu¼Sliû->
¡ruùu»
==
FRAME
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->structure!=FRAME))

265 
mv
.
mv_y
 *= 2;

266 if((
cu¼Sliû
->
mb_aff_äame_æag
 && 
cu¼MB
->
mb_f›ld
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->
¡ruùu»
==
FRAME
) ||

267 (!
cu¼Sliû
->
mb_aff_äame_æag
 && cu¼Sliû->
¡ruùu»
!=
FRAME
 && 
cÞoÿ‹d
.
»f_pic
[
»fLi¡
]->structure==FRAME))

268 
mv
.
mv_y
 /= 2;

270 ià(
mv_sÿË
==9999)

273 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
mv
;

275 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

280 
®l_mvs
[
LIST_0
][
m­³d_idx
][0][
block_y
][
block_x
].
mv_x
 = (è((
mv_sÿË
 * 
mv
.mv_x + 128) >> 8);

281 
®l_mvs
[
LIST_0
][
m­³d_idx
][0][
block_y
][
block_x
].
mv_y
 = (è((
mv_sÿË
 * 
mv
.mv_y + 128) >> 8);

283 
®l_mvs
[
LIST_1
][ 0][0][
block_y
][
block_x
].
mv_x
 = (è(((
mv_sÿË
 - 256è* 
mv
.mv_x + 128) >> 8);

284 
®l_mvs
[
LIST_1
][ 0][0][
block_y
][
block_x
].
mv_y
 = (è(((
mv_sÿË
 - 256è* 
mv
.mv_y + 128) >> 8);

289 iàÐ
	`out_of_bounds_mvs
(
p_Vid
, &
®l_mvs
[
LIST_0
][
m­³d_idx
][0][
block_y
][
block_x
])|| out_of_bounds_mvsÕ_Vid, &®l_mvs[
LIST_1
][0][0][block_y][block_x]))

291 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
] = -1;

292 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
] = -1;

293 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = -1;

297 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
] = (è
m­³d_idx
;

298 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
] = 0;

299 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

304 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
] = -1;

305 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
] = -1;

306 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = -1;

310 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 =ð1 && 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] == 2)

312 
weight_sum
, 
i
;

313 
l0_»fX
 = 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
];

314 
l1_»fX
 = 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
];

315 
i
=0;i< (
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV400
 ? 1 : 3); i++)

317 
weight_sum
 = 
cu¼Sliû
->
wbp_weight
[0][
l0_»fX
][
l1_»fX
][
i
] + currSlice->wbp_weight[1][l0_refX][l1_refX][i];

318 ià(
weight_sum
 < -128 || weight_sum > 127)

320 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_0
] = -1;

321 
cu¼Sliû
->
dœeù_»f_idx
[
pic_block_y
][
pic_block_x
][
LIST_1
] = -1;

322 
cu¼Sliû
->
dœeù_pdœ
 [
pic_block_y
][
pic_block_x
] = -1;

329 
	}
}

331 
šlše
 
	$£t_dœeù_»ã»nûs
(cÚ¡ 
Pix–Pos
 *
mb
, *
l0_rF¿me
, *
l1_rF¿me
, 
PicMÙiÚP¬ams
 **
mv_šfo
)

333 ià(
mb
->
avažabË
)

335 *
»f_idx
 = 
mv_šfo
[
mb
->
pos_y
][mb->
pos_x
].ref_idx;

336 *
l0_rF¿me
 = 
»f_idx
[
LIST_0
];

337 *
l1_rF¿me
 = 
»f_idx
[
LIST_1
];

341 *
l0_rF¿me
 = -1;

342 *
l1_rF¿me
 = -1;

344 
	}
}

346 
	$£t_dœeù_»ã»nûs_mb_f›ld
(cÚ¡ 
Pix–Pos
 *
mb
, *
l0_rF¿me
, *
l1_rF¿me
, 
PicMÙiÚP¬ams
 **
mv_šfo
, 
Maüoblock
 *
mb_d©a
)

348 ià(
mb
->
avažabË
)

350 *
»f_idx
 = 
mv_šfo
[
mb
->
pos_y
][mb->
pos_x
].ref_idx;

351 ià(
mb_d©a
[
mb
->
mb_addr
].
mb_f›ld
)

353 *
l0_rF¿me
 = 
»f_idx
[
LIST_0
];

354 *
l1_rF¿me
 = 
»f_idx
[
LIST_1
];

358 *
l0_rF¿me
 = (
»f_idx
[
LIST_0
] < 0) ?„ef_idx[LIST_0] :„ef_idx[LIST_0] * 2;

359 *
l1_rF¿me
 = (
»f_idx
[
LIST_1
] < 0) ?„ef_idx[LIST_1] :„ef_idx[LIST_1] * 2;

364 *
l0_rF¿me
 = -1;

365 *
l1_rF¿me
 = -1;

367 
	}
}

369 
	$£t_dœeù_»ã»nûs_mb_äame
(cÚ¡ 
Pix–Pos
 *
mb
, *
l0_rF¿me
, *
l1_rF¿me
, 
PicMÙiÚP¬ams
 **
mv_šfo
, 
Maüoblock
 *
mb_d©a
)

371 ià(
mb
->
avažabË
)

373 *
»f_idx
 = 
mv_šfo
[
mb
->
pos_y
][mb->
pos_x
].ref_idx;

374 ià(
mb_d©a
[
mb
->
mb_addr
].
mb_f›ld
)

376 *
l0_rF¿me
 = (
»f_idx
[
LIST_0
] >> 1);

377 *
l1_rF¿me
 = (
»f_idx
[
LIST_1
] >> 1);

381 *
l0_rF¿me
 = 
»f_idx
[
LIST_0
];

382 *
l1_rF¿me
 = 
»f_idx
[
LIST_1
];

387 *
l0_rF¿me
 = -1;

388 *
l1_rF¿me
 = -1;

390 
	}
}

392 
	$‹¡_v®id_dœeù
(
Sliû
 *
cu¼Sliû
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
, *
dœeù_»f_idx
, 
l0_»fX
, 
l1_»fX
, 
pic_block_y
, 
pic_block_x
)

394 
weight_sum
, 
i
;

395 
BoÞ—n
 
šv®id_wp
 = 
FALSE
;

396 
i
=0;i< (
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV400
 ? 1 : 3); i++)

398 
weight_sum
 = 
cu¼Sliû
->
wbp_weight
[0][
l0_»fX
][
l1_»fX
][
i
] + currSlice->wbp_weight[1][l0_refX][l1_refX][i];

399 ià(
weight_sum
 < -128 || weight_sum > 127)

401 
šv®id_wp
 = 
TRUE
;

405 ià(
šv®id_wp
 =ð
FALSE
)

406 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

409 
dœeù_»f_idx
[
LIST_0
] = -1;

410 
dœeù_»f_idx
[
LIST_1
] = -1;

411 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = -1;

413 
	}
}

422 
	$g‘_cÞoÿ‹d_šfo
(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
li¡1
, 
i
, 
j
)

424 ià(
li¡1
->
is_lÚg_‹rm
)

428 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

429 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

430 ifÐ(
cu¼Sliû
->
mb_aff_äame_æag
) ||

431 (!
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
 && ((!
cu¼Sliû
->
¡ruùu»
 && !
li¡1
->
coded_äame
) || (currSlice->structure!=list1->structure &&†ist1->coded_frame))))

433 
jj
 = 
	`RSD
(
j
);

434 
ii
 = 
	`RSD
(
i
);

435 
jdiv
 = (
jj
>>1);

436 
movšg
;

437 
PicMÙiÚP¬ams
 *
fs
 = &
li¡1
->
mv_šfo
[
jj
][
ii
];

439 if(
cu¼Sliû
->
¡ruùu»
 && cu¼Sliû->¡ruùu»!=
li¡1
->¡ruùu» &&†i¡1->
coded_äame
)

441 if(
cu¼Sliû
->
¡ruùu»
 =ð
TOP_FIELD
)

442 
fs
 = 
li¡1
->
tÝ_f›ld
->
mv_šfo
[
jj
] + 
ii
;

444 
fs
 = 
li¡1
->
bÙtom_f›ld
->
mv_šfo
[
jj
] + 
ii
;

448 ifÐ(
cu¼Sliû
->
mb_aff_äame_æag
 && ((!
cu¼MB
->
mb_f›ld
 && 
li¡1
->
mÙiÚ
.mb_f›ld[cu¼MB->
mbAddrX
]) ||

449 (!
cu¼MB
->
mb_f›ld
 && !
li¡1
->
coded_äame
)))

450 || (!
cu¼Sliû
->
mb_aff_äame_æag
))

452 ià(
	`Ÿbs
(
p_Vid
->
’c_piùu»
->
poc
 - 
li¡1
->
bÙtom_f›ld
->poc)> iabsÕ_Vid->’c_piùu»->poø-li¡1->
tÝ_f›ld
->poc) )

454 
fs
 = 
li¡1
->
tÝ_f›ld
->
mv_šfo
[
jdiv
] + 
ii
;

458 
fs
 = 
li¡1
->
bÙtom_f›ld
->
mv_šfo
[
jdiv
] + 
ii
;

462 
movšg
 = !((((
fs
->
»f_idx
[
LIST_0
] == 0)

463 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_x
)>>1 == 0)

464 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_y
)>>1 == 0)))

465 || ((
fs
->
»f_idx
[
LIST_0
] == -1)

466 && (
fs
->
»f_idx
[
LIST_1
] == 0)

467 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_x
)>>1 == 0)

468 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_y
)>>1 == 0)));

469  
movšg
;

473 
PicMÙiÚP¬ams
 *
fs
 = &
li¡1
->
mv_šfo
[
	`RSD
(
j
)][RSD(
i
)];

474 
movšg
;

475 if(
cu¼MB
->
p_Vid
->
yuv_fÜm©
 =ð
YUV444
 && !
cu¼Sliû
->
P444_jošed
)

476 
fs
 = &
li¡1
->
JVmv_šfo
[()(
p_Vid
->
cÞour_¶ªe_id
)][
	`RSD
(
j
)][RSD(
i
)];

477 
movšg
ð!((((
fs
->
»f_idx
[
LIST_0
] == 0)

478 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_x
)>>1 == 0)

479 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_y
)>>1 == 0)))

480 || ((
fs
->
»f_idx
[
LIST_0
] == -1)

481 && (
fs
->
»f_idx
[
LIST_1
] == 0)

482 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_x
)>>1 == 0)

483 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_y
)>>1 == 0)));

485  
movšg
;

488 
	}
}

496 
	$g‘_cÞoÿ‹d_šfo_4x4
(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
li¡1
, 
i
, 
j
)

498 ià(
li¡1
->
is_lÚg_‹rm
)

502 
PicMÙiÚP¬ams
 *
fs
 = &
li¡1
->
mv_šfo
[
j
][
i
];

504 
movšg
 = !((((
fs
->
»f_idx
[
LIST_0
] == 0)

505 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_x
)>>1 == 0)

506 && (
	`Ÿbs
(
fs
->
mv
[
LIST_0
].
mv_y
)>>1 == 0)))

507 || ((
fs
->
»f_idx
[
LIST_0
] == -1)

508 && (
fs
->
»f_idx
[
LIST_1
] == 0)

509 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_x
)>>1 == 0)

510 && (
	`Ÿbs
(
fs
->
mv
[
LIST_1
].
mv_y
)>>1 == 0)));

512  
movšg
;

514 
	}
}

522 
	$G‘_Dœeù_MV_S·tŸl_NÜm®
 (
Maüoblock
 *
cu¼MB
)

524 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

525 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

526 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

527 
l0_»fA
, 
l0_»fB
, 
l0_»fC
;

528 
l1_»fA
, 
l1_»fB
, 
l1_»fC
;

529 
l0_»fX
,
l1_»fX
;

530 
MÙiÚVeùÜ
 
pmvfw
 = 
z”o_mv
, 
pmvbw
 = zero_mv;

532 
block_x
, 
block_y
, 
pic_block_x
, 
pic_block_y
, 
Ýic_block_x
, 
Ýic_block_y
;

533 
MÙiÚVeùÜ
 *****
®l_mvs
;

534 *
dœeù_»f_idx
;

535 
StÜabËPiùu»
 **
li¡1
 = 
cu¼Sliû
->
li¡X
[
LIST_1
];

537 
Pix–Pos
 
mb
[4];

538 
	`g‘_ÃighbÜs
(
cu¼MB
, 
mb
, 0, 0, 16);

540 
	`£t_dœeù_»ã»nûs
(&
mb
[0], &
l0_»fA
, &
l1_»fA
, 
mv_šfo
);

541 
	`£t_dœeù_»ã»nûs
(&
mb
[1], &
l0_»fB
, &
l1_»fB
, 
mv_šfo
);

542 
	`£t_dœeù_»ã»nûs
(&
mb
[2], &
l0_»fC
, &
l1_»fC
, 
mv_šfo
);

544 
l0_»fX
 = (è
	`imš
(imš((è
l0_»fA
, (è
l0_»fB
), (è
l0_»fC
);

545 
l1_»fX
 = (è
	`imš
(imš((è
l1_»fA
, (è
l1_»fB
), (è
l1_»fC
);

547 ià(
l0_»fX
 >= 0)

548 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, &
pmvfw
, 
l0_»fX
, 
mv_šfo
, 
LIST_0
, 0, 0, 16, 16);

550 ià(
l1_»fX
 >= 0)

551 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, &
pmvbw
, 
l1_»fX
, 
mv_šfo
, 
LIST_1
, 0, 0, 16, 16);

553 ià(
l0_»fX
 =ð-1 && 
l1_»fX
 == -1)

555 
block_y
=0; block_y<4; block_y++)

557 
pic_block_y
 = 
cu¼MB
->
block_y
 + block_y;

558 
block_x
=0; block_x<4; block_x++)

560 
pic_block_x
 = 
cu¼MB
->
block_x
 + block_x;

561 
dœeù_»f_idx
 = 
cu¼Sliû
->dœeù_»f_idx[
pic_block_y
][
pic_block_x
];

563 
cu¼Sliû
->
®l_mv
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

564 
cu¼Sliû
->
®l_mv
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

566 
dœeù_»f_idx
[
LIST_0
] = dœeù_»f_idx[
LIST_1
] = 0;

568 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

569 
	`‹¡_v®id_dœeù
(
cu¼Sliû
, cu¼Sliû->
aùive_¥s
, 
dœeù_»f_idx
, 0, 0, 
pic_block_y
, 
pic_block_x
);

571 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

575 ià(
l0_»fX
 =ð0 || 
l1_»fX
 == 0)

577 (*
g‘_cÞoÿ‹d
)(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
li¡1
, 
i
, 
j
) =

578 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ? 
g‘_cÞoÿ‹d_šfo
 : 
g‘_cÞoÿ‹d_šfo_4x4
;

580 
is_movšg_block
;

581 
block_y
 = 0; block_y < 4; block_y++)

583 
pic_block_y
 = 
cu¼MB
->
block_y
 + block_y;

584 
Ýic_block_y
 = (
cu¼MB
->
Ýix_y
 >> 2è+ 
block_y
;

586 
block_x
=0; block_x<4; block_x++)

588 
pic_block_x
 = 
cu¼MB
->
block_x
 + block_x;

589 
dœeù_»f_idx
 = 
cu¼Sliû
->dœeù_»f_idx[
pic_block_y
][
pic_block_x
];

590 
Ýic_block_x
 = (
cu¼MB
->
pix_x
 >> 2è+ 
block_x
;

592 
®l_mvs
 = 
cu¼Sliû
->
®l_mv
;

593 
is_movšg_block
 = (
	`g‘_cÞoÿ‹d
(
cu¼MB
, 
li¡1
[0], 
Ýic_block_x
, 
Ýic_block_y
) == 0);

595 ià(
l0_»fX
 < 0)

597 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

598 
dœeù_»f_idx
[
LIST_0
] = -1;

600 ià((
l0_»fX
 =ð0è&& 
is_movšg_block
)

602 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

603 
dœeù_»f_idx
[
LIST_0
] = 0;

607 
®l_mvs
[
LIST_0
][(è
l0_»fX
][0][
block_y
][
block_x
] = 
pmvfw
;

608 
dœeù_»f_idx
[
LIST_0
] = ()
l0_»fX
;

611 ià(
l1_»fX
 < 0)

613 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

614 
dœeù_»f_idx
[
LIST_1
] = -1;

616 if((
l1_»fX
 =ð0è&& 
is_movšg_block
)

618 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

619 
dœeù_»f_idx
[
LIST_1
] = 0;

623 
®l_mvs
[
LIST_1
][(è
l1_»fX
][0][
block_y
][
block_x
] = 
pmvbw
;

624 
dœeù_»f_idx
[
LIST_1
] = ()
l1_»fX
;

627 ià(
dœeù_»f_idx
[
LIST_1
] == -1)

628 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 0;

629 ià(
dœeù_»f_idx
[
LIST_0
] == -1)

630 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 1;

631 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

632 
	`‹¡_v®id_dœeù
(
cu¼Sliû
, cu¼Sliû->
aùive_¥s
, 
dœeù_»f_idx
, 
l0_»fX
, 
l1_»fX
, 
pic_block_y
, 
pic_block_x
);

634 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

640 
block_y
=0; block_y<4; block_y++)

642 
pic_block_y
 = 
cu¼MB
->
block_y
 + block_y;

644 
block_x
=0; block_x<4; block_x++)

646 
pic_block_x
 = 
cu¼MB
->
block_x
 + block_x;

647 
dœeù_»f_idx
 = 
cu¼Sliû
->dœeù_»f_idx[
pic_block_y
][
pic_block_x
];

649 
®l_mvs
 = 
cu¼Sliû
->
®l_mv
;

651 ià(
l0_»fX
 > 0)

653 
®l_mvs
[
LIST_0
][(è
l0_»fX
][0][
block_y
][
block_x
] = 
pmvfw
;

654 
dœeù_»f_idx
[
LIST_0
]ð()
l0_»fX
;

658 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

659 
dœeù_»f_idx
[
LIST_0
]=-1;

662 ià(
l1_»fX
 > 0)

664 
®l_mvs
[
LIST_1
][(è
l1_»fX
][0][
block_y
][
block_x
] = 
pmvbw
;

665 
dœeù_»f_idx
[
LIST_1
] = ()
l1_»fX
;

669 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

670 
dœeù_»f_idx
[
LIST_1
] = -1;

673 ià(
dœeù_»f_idx
[
LIST_1
] == -1)

674 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 0;

675 ià(
dœeù_»f_idx
[
LIST_0
] == -1)

676 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 1;

677 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

678 
	`‹¡_v®id_dœeù
(
cu¼Sliû
, cu¼Sliû->
aùive_¥s
, 
dœeù_»f_idx
, 
l0_»fX
, 
l1_»fX
, 
pic_block_y
, 
pic_block_x
);

680 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

684 
	}
}

693 
	$G‘_Dœeù_MV_S·tŸl_MBAFF
 (
Maüoblock
 *
cu¼MB
)

695 
l0_»fA
, 
l0_»fB
, 
l0_»fC
;

696 
l1_»fA
, 
l1_»fB
, 
l1_»fC
;

697 
l0_»fX
,
l1_»fX
;

698 
MÙiÚVeùÜ
 
pmvfw
 = 
z”o_mv
, 
pmvbw
 = zero_mv;

700 
block_x
, 
block_y
, 
pic_block_x
, 
pic_block_y
, 
Ýic_block_x
, 
Ýic_block_y
;

701 
MÙiÚVeùÜ
 *****
®l_mvs
;

702 *
dœeù_»f_idx
;

703 
is_movšg_block
;

704 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

705 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

706 
PicMÙiÚP¬ams
 **
mv_šfo
 = 
p_Vid
->
’c_piùu»
->mv_info;

707 
StÜabËPiùu»
 **
li¡1
 = 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
cu¼MB
->
li¡_off£t
];

709 (*
g‘_cÞoÿ‹d
)(
Maüoblock
 *
cu¼MB
, 
StÜabËPiùu»
 *
li¡1
, 
i
, 
j
) =

710 
p_Vid
->
aùive_¥s
->
dœeù_8x8_šã»nû_æag
 ? 
g‘_cÞoÿ‹d_šfo
 : 
g‘_cÞoÿ‹d_šfo_4x4
;

712 
Pix–Pos
 
mb
[4];

713 
	`g‘_ÃighbÜs
(
cu¼MB
, 
mb
, 0, 0, 16);

716 ià(
cu¼MB
->
mb_f›ld
)

718 
	`£t_dœeù_»ã»nûs_mb_f›ld
(&
mb
[0], &
l0_»fA
, &
l1_»fA
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

719 
	`£t_dœeù_»ã»nûs_mb_f›ld
(&
mb
[1], &
l0_»fB
, &
l1_»fB
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

720 
	`£t_dœeù_»ã»nûs_mb_f›ld
(&
mb
[2], &
l0_»fC
, &
l1_»fC
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

724 
	`£t_dœeù_»ã»nûs_mb_äame
(&
mb
[0], &
l0_»fA
, &
l1_»fA
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

725 
	`£t_dœeù_»ã»nûs_mb_äame
(&
mb
[1], &
l0_»fB
, &
l1_»fB
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

726 
	`£t_dœeù_»ã»nûs_mb_äame
(&
mb
[2], &
l0_»fC
, &
l1_»fC
, 
mv_šfo
, 
p_Vid
->
mb_d©a
);

729 
l0_»fX
 = (è
	`imš
(imš((è
l0_»fA
, (è
l0_»fB
), (è
l0_»fC
);

730 
l1_»fX
 = (è
	`imš
(imš((è
l1_»fA
, (è
l1_»fB
), (è
l1_»fC
);

732 ià(
l0_»fX
 >=0)

733 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, &
pmvfw
, 
l0_»fX
, 
mv_šfo
, 
LIST_0
, 0, 0, 16, 16);

735 ià(
l1_»fX
 >=0)

736 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, &
pmvbw
, 
l1_»fX
, 
mv_šfo
, 
LIST_1
, 0, 0, 16, 16);

738 
block_y
=0; block_y<4; block_y++)

740 
pic_block_y
 = 
cu¼MB
->
block_y
 + block_y;

741 
Ýic_block_y
 = (
cu¼MB
->
Ýix_y
 >> 2è+ 
block_y
;

743 
block_x
=0; block_x<4; block_x++)

745 
pic_block_x
 = 
cu¼MB
->
block_x
 + block_x;

746 
dœeù_»f_idx
 = 
cu¼Sliû
->dœeù_»f_idx[
pic_block_y
][
pic_block_x
];

747 
Ýic_block_x
 = (
cu¼MB
->
pix_x
 >> 2è+ 
block_x
;

748 
is_movšg_block
 = (
	`g‘_cÞoÿ‹d
(
cu¼MB
, 
li¡1
[0], 
Ýic_block_x
, 
Ýic_block_y
) == 0);

750 
®l_mvs
 = 
cu¼Sliû
->
®l_mv
;

752 ià(
l0_»fX
 >=0)

754 ià(!
l0_»fX
 && 
is_movšg_block
)

756 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

757 
dœeù_»f_idx
[
LIST_0
] = 0;

761 
®l_mvs
[
LIST_0
][(è
l0_»fX
][0][
block_y
][
block_x
] = 
pmvfw
;

762 
dœeù_»f_idx
[
LIST_0
] = ()
l0_»fX
;

767 
®l_mvs
[
LIST_0
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

768 
dœeù_»f_idx
[
LIST_0
] = -1;

771 ià(
l1_»fX
 >=0)

773 if(
l1_»fX
==0 && 
is_movšg_block
)

775 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

776 
dœeù_»f_idx
[
LIST_1
] = ()
l1_»fX
;

780 
®l_mvs
[
LIST_1
][(è
l1_»fX
][0][
block_y
][
block_x
] = 
pmvbw
;

781 
dœeù_»f_idx
[
LIST_1
] = ()
l1_»fX
;

786 
®l_mvs
[
LIST_1
][0][0][
block_y
][
block_x
] = 
z”o_mv
;

787 
dœeù_»f_idx
[
LIST_1
] = -1;

793 ià((
	`out_of_bounds_mvs
(
p_Vid
, &
®l_mvs
[
LIST_0
][
l0_»fX
 < 0? 0 :†0_»fX][0][
block_y
][
block_x
])

794 || 
	`out_of_bounds_mvs
(
p_Vid
, &
®l_mvs
[
LIST_1
][
l1_»fX
 < 0? 0 :†1_»fX][0][
block_y
][
block_x
])))

796 
dœeù_»f_idx
[
LIST_0
] = -1;

797 
dœeù_»f_idx
[
LIST_1
] = -1;

798 
cu¼Sliû
->
dœeù_pdœ
 [
pic_block_y
][
pic_block_x
] = -1;

802 ià(
l0_»fX
 < 0 && 
l1_»fX
 < 0)

804 
dœeù_»f_idx
[
LIST_0
] = dœeù_»f_idx[
LIST_1
] = 0;

805 
l0_»fX
 = 0;

806 
l1_»fX
 = 0;

809 ià(
dœeù_»f_idx
[
LIST_1
] == -1)

810 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 0;

811 ià(
dœeù_»f_idx
[
LIST_0
] == -1)

812 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 1;

813 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

814 
	`‹¡_v®id_dœeù
(
cu¼Sliû
, cu¼Sliû->
aùive_¥s
, 
dœeù_»f_idx
, 
l0_»fX
, 
l1_»fX
, 
pic_block_y
, 
pic_block_x
);

816 
cu¼Sliû
->
dœeù_pdœ
[
pic_block_y
][
pic_block_x
] = 2;

820 
	}
}

	@lencod/src/mv_search.c

24 
	~"cÚŒibutÜs.h
"

26 
	~<m©h.h
>

27 
	~<lim™s.h
>

28 
	~<time.h
>

30 
	~"glob®.h
"

32 
	~"image.h
"

33 
	~"mv_£¬ch.h
"

34 
	~"»fbuf.h
"

35 
	~"mem®loc.h
"

36 
	~"mb_acûss.h
"

37 
	~"maüoblock.h
"

38 
	~"mc_´ediùiÚ.h
"

39 
	~"cÚfÜmªû.h
"

40 
	~"mode_decisiÚ.h
"

43 
	~"me_di¡ÜtiÚ.h
"

44 
	~"me_di¡ÜtiÚ_Ùf.h
"

47 
	~"me_•zs.h
"

48 
	~"me_•zs_št.h
"

49 
	~"me_fuÎç¡.h
"

50 
	~"me_fuÎç¡_Ùf.h
"

51 
	~"me_fuÎ£¬ch.h
"

52 
	~"me_umhex.h
"

53 
	~"me_umhexsmp.h
"

54 
	~"rdoq.h
"

57 cÚ¡ 
	gbx0
[5][4] = {{0,0,0,0}, {0,0,0,0}, {0,0,0,0}, {0,2,0,0}, {0,2,0,2}};

58 cÚ¡ 
	gby0
[5][4] = {{0,0,0,0}, {0,0,0,0}, {0,2,0,0}, {0,0,0,0}, {0,0,2,2}};

61 
di¡blk
 
G‘SkCo¡MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
);

62 
di¡blk
 
BiP»dBlockMÙiÚS—rch
(
Maüoblock
 *
cu¼MB
, 
MEBlock
 *, 
MÙiÚVeùÜ
*, , , *);

70 
	$g‘_£¬ch_¿nge
(
MEBlock
 *
mv_block
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
»f
, 
blockty³
)

72 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

74 *
£¬chRªge
 = 
mv_block
->
p_Vid
->searchRange;

76 ià(
p_IÅ
->
fuÎ_£¬ch
 == 1)

78 
sÿË
 = (
	`imš
(
»f
, 1) + 1);

79 
£¬chRªge
->
mš_x
 /ð
sÿË
;

80 
£¬chRªge
->
max_x
 /ð
sÿË
;

81 
£¬chRªge
->
mš_y
 /ð
sÿË
;

82 
£¬chRªge
->
max_y
 /ð
sÿË
;

84 ià(
p_IÅ
->
fuÎ_£¬ch
 != 2)

86 
sÿË
 = ((
	`imš
(
»f
, 1è+ 1è* imš(2, 
blockty³
));

87 
£¬chRªge
->
mš_x
 /ð
sÿË
;

88 
£¬chRªge
->
max_x
 /ð
sÿË
;

89 
£¬chRªge
->
mš_y
 /ð
sÿË
;

90 
£¬chRªge
->
max_y
 /ð
sÿË
;

92 
	}
}

100 
šlše
 
	$£t_me_·¿m‘”s
Ð
PicMÙiÚP¬ams
 **
mÙiÚ
, cÚ¡ 
MÙiÚVeùÜ
 *
®l_mv
, 
li¡
, 
»f
, 
¡•_h
, 
¡•_v
, 
pic_block_y
, 
pic_block_x
)

102 
i
, 
j
;

105 
j
 = 
pic_block_y
; j <…ic_block_y + 
¡•_v
; j++)

107 
i
=
pic_block_x
; i<pic_block_x + 
¡•_h
; i++)

109 
mÙiÚ
[
j
][
i
].
mv
[
li¡
] = *
®l_mv
;

110 
mÙiÚ
[
j
][
i
].
»f_idx
[
li¡
] = 
»f
;

113 
	}
}

121 
	$£t_acûss_m‘hod
(*
acûss_m‘hod
, 
MÙiÚVeùÜ
 *
blk
, 
mš_x
, 
mš_y
, 
max_x
, 
max_y
)

123 iàÐ(
blk
->
mv_x
 > 
mš_x
è&& (blk->mv_x < 
max_x
è&& (blk->
mv_y
 > 
mš_y
è&& (blk->mv_y < 
max_y
))

125 *
acûss_m‘hod
 = 
FAST_ACCESS
;

129 *
acûss_m‘hod
 = 
UMV_ACCESS
;

131 
	}
}

139 
	$š™_ME_’gše
(
Maüoblock
 *
cu¼MB
)

141 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

142 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

143 
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
])

145 
EPZS
:

146 
	`EPZS_£tup_’gše
(
cu¼MB
, 
p_IÅ
);

148 
UM_HEX
:

149 
cu¼MB
->
IÁP–ME
 = 
UMHEXIÁeg”P–BlockMÙiÚS—rch
;

150 
cu¼MB
->
BiP»dME
 = 
UMHEXB»dIÁeg”P–BlockMÙiÚS—rch
;

151 
cu¼MB
->
SubP–BiP»dME
 = 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

152 
cu¼MB
->
SubP–ME
 = 
UMHEXSubP–BlockME
;

154 
UM_HEX_SIMPLE
:

155 
cu¼MB
->
IÁP–ME
 = 
smpUMHEXIÁeg”P–BlockMÙiÚS—rch
;

156 
cu¼MB
->
BiP»dME
 = 
smpUMHEXB»dIÁeg”P–BlockMÙiÚS—rch
;

157 
cu¼MB
->
SubP–BiP»dME
 = 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

158 
cu¼MB
->
SubP–ME
 = 
smpUMHEXSubP–BlockME
;

160 
FULL_SEARCH
:

161 
cu¼MB
->
IÁP–ME
 = 
fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
;

162 
cu¼MB
->
BiP»dME
 = 
fuÎ_£¬ch_b»d_mÙiÚ_e¡im©iÚ
;

163 
cu¼MB
->
SubP–BiP»dME
 = 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

164 
cu¼MB
->
SubP–ME
 = 
sub_³l_mÙiÚ_e¡im©iÚ
;

166 
FAST_FULL_SEARCH
:

168 
cu¼MB
->
IÁP–ME
 = 
ç¡_fuÎ_£¬ch_mÙiÚ_e¡im©iÚ
;

169 
cu¼MB
->
BiP»dME
 = 
fuÎ_£¬ch_b»d_mÙiÚ_e¡im©iÚ
;

170 
cu¼MB
->
SubP–BiP»dME
 = 
sub_³l_b»d_mÙiÚ_e¡im©iÚ
;

171 
cu¼MB
->
SubP–ME
 = 
sub_³l_mÙiÚ_e¡im©iÚ
;

172 
cu¼MB
->
p_S‘upFa¡FuÎP–S—rch
 = (
p_IÅ
->
OnTheFlyF¿ùMCP
è? (
S‘upFa¡FuÎP–S—rch_Ùf
):(
£tup_ç¡_fuÎ_£¬ch
);

175 
	}
}

183 
	$P»·»MEP¬ams
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
ChromaMEEÇbË
, 
li¡
, 
»f
)

185 ià(
mv_block
->
­¶y_weights
)

187 
mv_block
->
weight_luma
 = 
cu¼Sliû
->
wp_weight
[
li¡
][
»f
][0];

188 
mv_block
->
off£t_luma
 = 
cu¼Sliû
->
wp_off£t
[
li¡
][
»f
][0];

190 iàÐ
ChromaMEEÇbË
)

192 
mv_block
->
weight_ü
[0] = 
cu¼Sliû
->
wp_weight
[
li¡
][
»f
][1];

193 
mv_block
->
weight_ü
[1] = 
cu¼Sliû
->
wp_weight
[
li¡
][
»f
][2];

194 
mv_block
->
off£t_ü
[0] = 
cu¼Sliû
->
wp_off£t
[
li¡
][
»f
][1];

195 
mv_block
->
off£t_ü
[1] = 
cu¼Sliû
->
wp_off£t
[
li¡
][
»f
][2];

198 
	}
}

206 
	$P»·»BiP»dMEP¬ams
(
Sliû
 *
cu¼Sliû
, 
MEBlock
 *
mv_block
, 
ChromaMEEÇbË
, 
li¡
, 
li¡_off£t
, 
»f
)

208 ià(
mv_block
->
­¶y_weights
)

210 ià(
li¡
 =ð
LIST_0
)

212 
mv_block
->
weight1
 = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][
»f
][0][0];

213 
mv_block
->
weight2
 = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][
»f
][0][0];

214 
mv_block
->
off£tBi
 = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 ][
»f
][0] + cu¼Sliû->wp_off£t[li¡_off£ˆ+ 
LIST_1
][ref][0] + 1)>>1;

216 iàÐ
ChromaMEEÇbË
)

218 
mv_block
->
weight1_ü
[0] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][
»f
][0][1];

219 
mv_block
->
weight1_ü
[1] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][
»f
][0][2];

220 
mv_block
->
weight2_ü
[0] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][
»f
][0][1];

221 
mv_block
->
weight2_ü
[1] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][
»f
][0][2];

223 
mv_block
->
off£tBi_ü
[0] = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 ][
»f
][1] + cu¼Sliû->wp_off£t[li¡_off£ˆ+ 
LIST_1
][ref][1] + 1) >> 1;

224 
mv_block
->
off£tBi_ü
[1] = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 ][
»f
][2] + cu¼Sliû->wp_off£t[li¡_off£ˆ+ 
LIST_1
][ref][2] + 1) >> 1;

229 
mv_block
->
weight1
 = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][0 ][
»f
][0];

230 
mv_block
->
weight2
 = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][0 ][
»f
][0];

231 
mv_block
->
off£tBi
 = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 + 
LIST_1
][0][0] + currSlice->wp_offset[list_offset][0][0] + 1)>>1;

233 iàÐ
ChromaMEEÇbË
)

235 
mv_block
->
weight1_ü
[0] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][0 ][
»f
][1];

236 
mv_block
->
weight1_ü
[1] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 + 
LIST_1
][0 ][
»f
][2];

237 
mv_block
->
weight2_ü
[0] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][0 ][
»f
][1];

238 
mv_block
->
weight2_ü
[1] = 
cu¼Sliû
->
wbp_weight
[
li¡_off£t
 ][0 ][
»f
][2];

240 
mv_block
->
off£tBi_ü
[0] = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 + 
LIST_1
][0 ][1] + currSlice->wp_offset[list_offset ][0 ][1] + 1) >> 1;

241 
mv_block
->
off£tBi_ü
[1] = (
cu¼Sliû
->
wp_off£t
[
li¡_off£t
 + 
LIST_1
][0 ][2] + currSlice->wp_offset[list_offset ][0 ][2] + 1) >> 1;

247 
mv_block
->
weight1
 = (è(1 << 
cu¼Sliû
->
luma_log_weight_d’om
);

248 
mv_block
->
weight2
 = (è(1 << 
cu¼Sliû
->
luma_log_weight_d’om
);

249 
mv_block
->
off£tBi
 = 0;

250 iàÐ
ChromaMEEÇbË
)

252 
mv_block
->
weight1_ü
[0] = 1<<
cu¼Sliû
->
chroma_log_weight_d’om
;

253 
mv_block
->
weight1_ü
[1] = 1<<
cu¼Sliû
->
chroma_log_weight_d’om
;

254 
mv_block
->
weight2_ü
[0] = 1<<
cu¼Sliû
->
chroma_log_weight_d’om
;

255 
mv_block
->
weight2_ü
[1] = 1<<
cu¼Sliû
->
chroma_log_weight_d’om
;

256 
mv_block
->
off£tBi_ü
[0] = 0;

257 
mv_block
->
off£tBi_ü
[1] = 0;

260 
	}
}

268 
	$g‘_ÃighbÜs
(
Maüoblock
 *
cu¼MB
,

269 
Pix–Pos
 *
block
,

270 
mb_x
,

271 
mb_y
,

272 
blocksh­e_x


275 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

276 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

278 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 - 1, 
mb_y
 , 
mb_size
, &
block
[0]);

279 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
, 
mb_y
 - 1, 
mb_size
, &
block
[1]);

280 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 + 
blocksh­e_x
, 
mb_y
 - 1, 
mb_size
, &
block
[2]);

281 
	`g‘4x4Neighbour
(
cu¼MB
, 
mb_x
 - 1, 
mb_y
 - 1, 
mb_size
, &
block
[3]);

283 ià(
mb_y
 > 0)

285 ià(
mb_x
 < 8)

287 ià(
mb_y
 == 8 )

289 ià(
blocksh­e_x
 =ð
MB_BLOCK_SIZE
)

290 
block
[2].
avažabË
 = 0;

292 ià(
mb_x
 + 
blocksh­e_x
 == 8)

294 
block
[2].
avažabË
 = 0;

297 ià(
mb_x
 + 
blocksh­e_x
 =ð
MB_BLOCK_SIZE
)

299 
block
[2].
avažabË
 = 0;

303 ià(!
block
[2].
avažabË
)

305 
block
[2] = block[3];

307 
	}
}

315 
	$š™_mÙiÚ_£¬ch_moduË
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

317 
b™s
;

318 
i_mš
, 
i_max
,
k
;

319 
i
, 
l
;

320 
£¬ch_¿nge_Üig
 = 
p_IÅ
->
S•V›wIÁ”S—rch
 ? 
	`imax
Ðp_IÅ->
£¬ch_¿nge
[0],…_Inp->search_range[1] ) :…_Inp->search_range[0];

321 
£¬ch_¿nge
 = 
£¬ch_¿nge_Üig
;

322 
max_£¬ch_pošts
 = 
	`imax
(9, (2 * 
£¬ch_¿nge
 + 1) * (2 * search_range + 1));

323 
max_»f_b™s
 = 1 + 2 * ()
	`æoÜ
(
	`log
(
	`imax
(16, 
p_Vid
->
max_num_»ã»nûs
 + 1)) /†og(2) + 1e-10);

324 
max_»f
 = (1<<((
max_»f_b™s
>>1)+1))-1;

325 
numb”_of_sub³l_pos™iÚs
 = 4 * (2*
£¬ch_¿nge
+3);

326 
max_mv_b™s
 = 3 + 2 * ()
	`ûž
 (
	`log
(
numb”_of_sub³l_pos™iÚs
 + 1) /†og(2) + 1e-10);

327 
max_mvd
 = 
p_IÅ
->
U£MVLim™s
? 
	`imax
(4*imaxÕ_IÅ->
S‘MVXLim™
,…_IÅ->
S‘MVYLim™
), ((1<<Ð
max_mv_b™s
 >>1) ) - 1)): ((1<<( max_mv_bits >>1)) - 1);

329 
p_Vid
->
max_mvd
 = max_mvd;

330 
p_Vid
->
img³l_abs_¿nge
 = (
	`imax
Õ_Vid->
max_³l_v®ue_comp
[0],p_Vid->max_pel_value_comp[1]) + 1) * 64;

334 ià((
p_Vid
->
¥œ®_£¬ch
 = (
MÙiÚVeùÜ
*)
	`ÿÎoc
(
max_£¬ch_pošts
, (MÙiÚVeùÜ))è=ð
NULL
)

335 
	`no_mem_ex™
("init_motion_search_module:…_Vid->spiral_search");

336 ià((
p_Vid
->
¥œ®_h³l_£¬ch
 = (
MÙiÚVeùÜ
*)
	`ÿÎoc
(
max_£¬ch_pošts
, (MÙiÚVeùÜ))è=ð
NULL
)

337 
	`no_mem_ex™
("init_motion_search_module:…_Vid->spiral_hpel_search");

338 ià((
p_Vid
->
¥œ®_q³l_£¬ch
 = (
MÙiÚVeùÜ
*)
	`ÿÎoc
(
max_£¬ch_pošts
, (MÙiÚVeùÜ))è=ð
NULL
)

339 
	`no_mem_ex™
("init_motion_search_module:…_Vid->spiral_qpel_search");

342 ià((
p_Vid
->
mvb™s
 = (*)
	`ÿÎoc
(2 * 
max_mvd
 + 1, ())è=ð
NULL
)

343 
	`no_mem_ex™
("init_motion_search_module:…_Vid->mvbits");

345 ià((
p_Vid
->
»fb™s
 = (*)
	`ÿÎoc
(
max_»f
, ())è=ð
NULL
)

346 
	`no_mem_ex™
("init_motion_search_module:…_Vid->refbits");

348 #ià(
JM_MEM_DISTORTION
)

349 ià((
p_Vid
->
img³l_abs
 = (*)
	`ÿÎoc
Õ_Vid->
img³l_abs_¿nge
, ())è=ð
NULL
)

350 
	`no_mem_ex™
("init_motion_search_module:…_Vid->imgpel_abs");

351 ià((
p_Vid
->
img³l_quad
 = (*)
	`ÿÎoc
Õ_Vid->
img³l_abs_¿nge
, ())è=ð
NULL
)

352 
	`no_mem_ex™
("init_motion_search_module:…_Vid->imgpel_quad");

353 
p_Vid
->
img³l_abs
 +ðp_Vid->
img³l_abs_¿nge
 / 2;

354 
p_Vid
->
img³l_quad
 +ðp_Vid->
img³l_abs_¿nge
 / 2;

357 ià(
p_Vid
->
max_num_»ã»nûs
)

358 
	`g‘_mem4Ddi¡blk
 (&
p_Vid
->
mÙiÚ_co¡
, 8, 2,…_Vid->
max_num_»ã»nûs
, 4);

361 
p_Vid
->
mvb™s
 +ð
max_mvd
;

366 
p_Vid
->
mvb™s
[0] = 1;

367 
b™s
 = 3; b™ <ð
max_mv_b™s
; bits += 2)

369 
i_max
 = (è(1 << (
b™s
 >> 1));

370 
i_mš
 = 
i_max
 >> 1;

372 
i
 = 
i_mš
; i < 
i_max
; i++)

373 
p_Vid
->
mvb™s
[-
i
] =…_Vid->mvb™s[i] = 
b™s
;

377 
p_Vid
->
»fb™s
[0] = 1;

378 
b™s
=3; b™s<=
max_»f_b™s
; bits+=2)

380 
i_max
 = (è(1 << ((
b™s
 >> 1) + 1)) - 1;

381 
i_mš
 = 
i_max
 >> 1;

383 
i
 = 
i_mš
; i < 
i_max
; i++)

384 
p_Vid
->
»fb™s
[
i
] = 
b™s
;

387 #ià(
JM_MEM_DISTORTION
)

389 
p_Vid
->
img³l_abs
[0] = 0;

391 
i
=1; i<
p_Vid
->
img³l_abs_¿nge
 / 2; i++)

393 
p_Vid
->
img³l_abs
[
i
] =…_Vid->imgpel_abs[-i] = i;

397 
p_Vid
->
img³l_quad
[0] = 0;

399 
i
=1; i<
p_Vid
->
img³l_abs_¿nge
 / 2; i++)

401 
p_Vid
->
img³l_quad
[
i
] =…_Vid->imgpel_quad[-i] = i * i;

406 
p_Vid
->
¥œ®_£¬ch
[0].
mv_x
 =…_Vid->¥œ®_£¬ch[0].
mv_y
 = 0;

407 
p_Vid
->
¥œ®_h³l_£¬ch
[0].
mv_x
 =…_Vid->¥œ®_h³l_£¬ch[0].
mv_y
 = 0;

408 
p_Vid
->
¥œ®_q³l_£¬ch
[0].
mv_x
 =…_Vid->¥œ®_q³l_£¬ch[0].
mv_y
 = 0;

410 
k
=1, 
l
=1;† <ð
	`imax
(1,
£¬ch_¿nge
);†++)

412 
i
=-
l
+1; i<†; i++)

414 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_x
 = (è
i
;

415 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_y
 = (è-
l
;

416 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_x
 = (è(
i
<<1);

417 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_y
 = (è-(
l
<<1);

418 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
].
mv_x
 = (è(
i
<<2);

419 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
++].
mv_y
 = (è-(
l
<<2);

420 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_x
 = (è
i
;

421 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_y
 = (è
l
;

422 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_x
 = (è(
i
<<1);

423 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_y
 = (è(
l
<<1);

424 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
].
mv_x
 = (è(
i
<<2);

425 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
++].
mv_y
 = (è(
l
<<2);

427 
i
=-
l
; i<=l; i++)

429 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_x
 = (è-
l
;

430 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_y
 = (è
i
;

431 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_x
 = (è-(
l
<<1);

432 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_y
 = (è(
i
<<1);

433 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
].
mv_x
 = (è-(
l
<<2);

434 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
++].
mv_y
 = (è(
i
<<2);

435 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_x
 = (è
l
;

436 
p_Vid
->
¥œ®_£¬ch
[
k
].
mv_y
 = (è
i
;

437 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_x
 = (è(
l
<<1);

438 
p_Vid
->
¥œ®_h³l_£¬ch
[
k
].
mv_y
 = (è(
i
<<1);

439 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
].
mv_x
 = (è(
l
<<2);

440 
p_Vid
->
¥œ®_q³l_£¬ch
[
k
++].
mv_y
 = (è(
i
<<2);

445 
p_Vid
->
¡¬t_me_»fšem’t_hp
 = (
p_IÅ
->
ChromaMEEÇbË
 =ð1 ||…_IÅ->
MEE¼ÜM‘ric
[
F_PEL
] !ðp_IÅ->MEE¼ÜM‘ric[
H_PEL
] ) ? 0 : 1;

446 
p_Vid
->
¡¬t_me_»fšem’t_qp
 = (
p_IÅ
->
ChromaMEEÇbË
 =ð1 ||…_IÅ->
MEE¼ÜM‘ric
[
H_PEL
] !ðp_IÅ->MEE¼ÜM‘ric[
Q_PEL
] ) ? 0 : 1;

448 
	`£Ëù_di¡ÜtiÚ
(
p_Vid
, 
p_IÅ
);

451 ifÐ
p_IÅ
->
OnTheFlyF¿ùMCP
 )

453 
i
=0; i<3; i++)

455  
p_IÅ
->
MEE¼ÜM‘ric
[
i
])

457 
ERROR_SAD
:

458 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SAD_Ùf
 ;

459 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SADWP_Ùf
 ;

460 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSAD1_Ùf
 ;

461 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSAD2_Ùf
 ;

463 
ERROR_SSE
:

464 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SSE_Ùf
;

465 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SSEWP_Ùf
;

466 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSSE1_Ùf
;

467 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSSE2_Ùf
;

469 
ERROR_SATD
 :

471 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SATD_Ùf
 ;

472 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SATDWP_Ùf
 ;

473 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSATD1_Ùf
 ;

474 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSATD2_Ùf
 ;

481 
i
=0; i<3; i++)

483 
p_IÅ
->
MEE¼ÜM‘ric
[
i
])

485 
ERROR_SAD
:

486 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SAD
;

487 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SADWP
;

488 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSAD1
;

489 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSAD2
;

491 
ERROR_SSE
:

492 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SSE
;

493 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SSEWP
;

494 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSSE1
;

495 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSSE2
;

497 
ERROR_SATD
 :

499 
p_Vid
->
compu‹UniP»d
[
i
] = 
compu‹SATD
;

500 
p_Vid
->
compu‹UniP»d
[
i
 + 3] = 
compu‹SATDWP
;

501 
p_Vid
->
compu‹BiP»d1
[
i
] = 
compu‹BiP»dSATD1
;

502 
p_Vid
->
compu‹BiP»d2
[
i
] = 
compu‹BiP»dSATD2
;

507 ià(!
p_IÅ
->
IÁ¿Profže
)

509 if(
p_IÅ
->
S—rchMode
[0] =ð
FAST_FULL_SEARCH
 ||…_Inp->SearchMode[1] == FAST_FULL_SEARCH)

510 
	`š™Ÿlize_ç¡_fuÎ_£¬ch
 (
p_Vid
, 
p_IÅ
);

512 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX
 ||…_Inp->SearchMode[1] == UM_HEX)

513 
	`UMHEX_DefšeTh»shÞd
(
p_Vid
);

515 
	}
}

524 
	$þ—r_mÙiÚ_£¬ch_moduË
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

529 
max_mvd
 = 
p_Vid
->max_mvd;

533 
p_Vid
->
mvb™s
 -ð
max_mvd
;

534 #ià(
JM_MEM_DISTORTION
)

535 
p_Vid
->
img³l_abs
 -ðp_Vid->
img³l_abs_¿nge
 / 2;

536 
p_Vid
->
img³l_quad
 -ðp_Vid->
img³l_abs_¿nge
 / 2;

540 
	`ä“
 (
p_Vid
->
¥œ®_£¬ch
);

541 
	`ä“
 (
p_Vid
->
¥œ®_h³l_£¬ch
);

542 
	`ä“
 (
p_Vid
->
¥œ®_q³l_£¬ch
);

543 
	`ä“
 (
p_Vid
->
mvb™s
);

544 
	`ä“
 (
p_Vid
->
»fb™s
);

546 #ià(
JM_MEM_DISTORTION
)

547 
	`ä“
 (
p_Vid
->
img³l_abs
);

548 
	`ä“
 (
p_Vid
->
img³l_quad
);

552 ià(
p_Vid
->
mÙiÚ_co¡
)

553 
	`ä“_mem4Ddi¡blk
 (
p_Vid
->
mÙiÚ_co¡
);

555 ià((
p_IÅ
->
S—rchMode
[0] =ð
FAST_FULL_SEARCH
 ||…_IÅ->S—rchMode[1] =ðFAST_FULL_SEARCHè&& (!p_IÅ->
IÁ¿Profže
) )

556 
	`þ—r_ç¡_fuÎ_£¬ch
 (
p_Vid
);

557 
	}
}

559 
šlše
 
	$mv_b™_co¡
(
Maüoblock
 *
cu¼MB
, 
MÙiÚVeùÜ
 **
®l_mv
, 
cur_li¡
, 
cur_»f
, 
by
, 
bx
, 
¡•_v0
, 
¡•_v
, 
¡•_h0
, 
¡•_h
, 
mvd_b™s
)

561 
v
, 
h
;

562 
MÙiÚVeùÜ
 
´edMV
;

563 
Pix–Pos
 
block
[4];

564 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

566 
v
=
by
; v<by + 
¡•_v0
; v+=
¡•_v
)

568 
h
=
bx
; h<bx + 
¡•_h0
; h+=
¡•_h
)

571 
	`g‘_ÃighbÜs
(
cu¼MB
, 
block
, 
h
, 
v
, 
¡•_h
);

573 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
block
, &
´edMV
, 
cur_»f
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
cur_li¡
, 
h
, 
v
, 
¡•_h
, 
¡•_v
);

575 
mvd_b™s
 +ð
p_Vid
->
mvb™s
[ 
®l_mv
[
v
>>2][
h
>>2].
mv_x
 - 
´edMV
.mv_x ];

576 
mvd_b™s
 +ð
p_Vid
->
mvb™s
[ 
®l_mv
[
v
>>2][
h
>>2].
mv_y
 - 
´edMV
.mv_y ];

580  
mvd_b™s
;

581 
	}
}

589 
di¡blk
 
	$BP»dP¬t™iÚCo¡
 (
Maüoblock
 *
cu¼MB
,

590 
blockty³
,

591 
block8x8
,

592 
»f_l0
,

593 
»f_l1
,

594 
Ïmbda_çùÜ
,

595 
li¡
)

597 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

598 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

599 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

600 
img³l
 **
cur_img
 = 
p_Vid
->
pCurImg
;

602 
pic_pix_x
, 
pic_pix_y
;

603 
v
, 
h
;

604 
di¡blk
 
mco¡
;

606 
mvd_b™s
 = 0;

608 
·¹ty³
 = (è(
blockty³
 < 4 ? blocktype : 4);

609 
¡•_h0
 = 
block_size
[ 
·¹ty³
][0];

610 
¡•_v0
 = 
block_size
[ 
·¹ty³
][1];

611 
¡•_h
 = 
block_size
[
blockty³
][0];

612 
¡•_v
 = 
block_size
[
blockty³
][1];

613 
by0_·¹
 = 
by0
[
·¹ty³
][
block8x8
] << 2;

614 
bx0_·¹
 = 
bx0
[
·¹ty³
][
block8x8
] << 2;

615 
block_size_x
 = 
block_size
[
blockty³
][0];

616 
block_size_y
 = 
block_size
[
blockty³
][1];

618 
MÙiÚVeùÜ
 **
®l_mv_l0
 = 
cu¼Sliû
->
b»d_mv
[
li¡
][
LIST_0
][
»f_l0
][
blockty³
];

619 
MÙiÚVeùÜ
 **
®l_mv_l1
 = 
cu¼Sliû
->
b»d_mv
[
li¡
][
LIST_1
][
»f_l1
][
blockty³
];

620 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

623 
mvd_b™s
 = 
	`mv_b™_co¡
(
cu¼MB
, 
®l_mv_l0
, 
LIST_0
, 
»f_l0
, 
by0_·¹
, 
bx0_·¹
, 
¡•_v0
, 
¡•_v
, 
¡•_h0
, 
¡•_h
, mvd_bits);

625 
mvd_b™s
 = 
	`mv_b™_co¡
(
cu¼MB
, 
®l_mv_l1
, 
LIST_1
, 
»f_l1
, 
by0_·¹
, 
bx0_·¹
, 
¡•_v0
, 
¡•_v
, 
¡•_h0
, 
¡•_h
, mvd_bits);

627 
mco¡
 = 
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 
mvd_b™s
);

630 
v
 = 
by0_·¹
; v < by0_·¹ + 
¡•_v0
; v = (è(v + 
block_size_y
))

632 
h
 = 
bx0_·¹
; h < bx0_·¹ + 
¡•_h0
; h = (è(h + 
block_size_x
))

634 
p_Dpb
->
	`pf_luma_´ediùiÚ_bi
 (
cu¼MB
, 
h
, 
v
, 
block_size_x
, 
block_size_y
, 
blockty³
, blockty³, 
»f_l0
, 
»f_l1
, 
li¡
);

639 ià((!
cu¼Sliû
->
p_IÅ
->
T¿nsfÜm8x8Mode
è|| (
blockty³
>4))

641 
diff16
[16];

642 *
diff
;

644 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

645 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

646 
v
 = 
by0_·¹
; v < by0_·¹ + 
¡•_v0
; v += 4)

648 
h
 = 
bx0_·¹
; h < bx0_·¹ + 
¡•_h0
; h += 4)

650 
diff
 = 
diff16
;

651 
	`ÿlcDifã»nû
(
cur_img
, 
pic_pix_x
+
h
, 
pic_pix_y
+
v
, 
mb_´ed
, h, v, 4, 4, 
diff
);

652 
mco¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
, 
DISTBLK_MAX
);

658 
diff64
[64];

659 *
diff
;

661 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

662 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

663 
v
 = 
by0_·¹
; v < by0_·¹ + 
¡•_v0
; v += 8)

665 
h
 = 
bx0_·¹
; h < bx0_·¹ + 
¡•_h0
; h += 8)

667 
diff
 = 
diff64
;

668 
	`ÿlcDifã»nû
(
cur_img
, 
pic_pix_x
+
h
, 
pic_pix_y
+
v
, 
mb_´ed
, h, v, 8, 8, 
diff
);

669 
mco¡
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
(
diff64
, 
DISTBLK_MAX
);

674  
mco¡
;

675 
	}
}

677 
	$upd©e_mv_block
(
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
h
, 
v
)

679 
mv_block
->
block_x
 = (è
h
;

680 
mv_block
->
block_y
 = (è
v
;

681 
mv_block
->
pos_x
 = (è(
cu¼MB
->
pix_x
 + (
h
 << 2));

682 
mv_block
->
pos_y
 = (è(
cu¼MB
->
Ýix_y
 + (
v
 << 2));

683 
mv_block
->
pos_x2
 = (è(mv_block->
pos_x
 >> 2);

684 
mv_block
->
pos_y2
 = (è(mv_block->
pos_y
 >> 2);

685 
mv_block
->
pos_x_·dded
 = (è(mv_block->
pos_x
 << 2);

686 
mv_block
->
pos_y_·dded
 = (è(mv_block->
pos_y
 << 2);

688 
mv_block
->
pos_ü_x
 = (è(mv_block->
pos_x
 >> 
cu¼MB
->
p_Vid
->
shiá_ü_x
);

689 
mv_block
->
pos_ü_y
 = (è(mv_block->
pos_y
 >> 
cu¼MB
->
p_Vid
->
shiá_ü_y
);

690 
	}
}

698 
	$š™_mv_block
(
Maüoblock
 *
cu¼MB
, 
MEBlock
 *
mv_block
, 
blockty³
, 
li¡
, 
»f_idx
, 
mb_x
, 
mb_y
)

700 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

701 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

702 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

703 
mv_block
->
blockty³
 = blocktype;

704 
mv_block
->
blocksize_x
 = 
block_size
[
blockty³
][0];

705 
mv_block
->
blocksize_y
 = 
block_size
[
blockty³
][1];

707 
	`upd©e_mv_block
(
cu¼MB
, 
mv_block
, 
mb_x
, 
mb_y
);

709 
mv_block
->
li¡
 = ()†ist;

710 
mv_block
->
»f_idx
 =„ef_idx;

712 
mv_block
->
mv
[
LIST_0
].
mv_x
 = 0;

713 
mv_block
->
mv
[
LIST_0
].
mv_y
 = 0;

714 
mv_block
->
mv
[
LIST_1
].
mv_x
 = 0;

715 
mv_block
->
mv
[
LIST_1
].
mv_y
 = 0;

717 
mv_block
->
p_Vid
 =…_Vid;

718 
mv_block
->
p_Sliû
 = 
cu¼Sliû
;

719 
mv_block
->
co¡
 = 
INT_MAX
;

720 
mv_block
->
£¬ch_pos2
 = 9;

721 
mv_block
->
£¬ch_pos4
 = 9;

723 ià(
p_IÅ
->
ChromaMEEÇbË
)

724 
	`g‘_mem2D³l
(&
mv_block
->
Üig_pic
, 3, mv_block->
blocksize_x
 * mv_block->
blocksize_y
);

726 
	`g‘_mem2D³l
(&
mv_block
->
Üig_pic
, 1, mv_block->
blocksize_x
 * mv_block->
blocksize_y
);

728 
mv_block
->
ChromaMEEÇbË
 = 
p_IÅ
->ChromaMEEnable;

730 
mv_block
->
­¶y_bi_weights
 = 
p_IÅ
->
U£Weigh‹dReã»nûME
 && ((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& 
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 != 0);

731 
mv_block
->
­¶y_weights
 = 
p_IÅ
->
U£Weigh‹dReã»nûME
 && ( 
cu¼Sliû
->
weigh‹d_´ediùiÚ
 != 0 );

733 ià(
p_IÅ
->
ChromaMEEÇbË
)

735 
mv_block
->
blocksize_ü_x
 = (è(mv_block->
blocksize_x
 >> 
p_Vid
->
shiá_ü_x
);

736 
mv_block
->
blocksize_ü_y
 = (è(mv_block->
blocksize_y
 >> 
p_Vid
->
shiá_ü_y
);

738 
mv_block
->
ChromaMEWeight
 = 
p_IÅ
->ChromaMEWeight;

741 ià(
mv_block
->
­¶y_weights
)

744 ià((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& (
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2))

746 
mv_block
->
compu‹P»dFP–
 = 
p_Vid
->
compu‹UniP»d
[
F_PEL
];

747 
mv_block
->
compu‹P»dHP–
 = 
p_Vid
->
compu‹UniP»d
[
H_PEL
];

748 
mv_block
->
compu‹P»dQP–
 = 
p_Vid
->
compu‹UniP»d
[
Q_PEL
];

752 
mv_block
->
compu‹P»dFP–
 = 
p_Vid
->
compu‹UniP»d
[
F_PEL
 + 3];

753 
mv_block
->
compu‹P»dHP–
 = 
p_Vid
->
compu‹UniP»d
[
H_PEL
 + 3];

754 
mv_block
->
compu‹P»dQP–
 = 
p_Vid
->
compu‹UniP»d
[
Q_PEL
 + 3];

756 
mv_block
->
compu‹BiP»dFP–
 = 
p_Vid
->
compu‹BiP»d2
[
F_PEL
];

757 
mv_block
->
compu‹BiP»dHP–
 = 
p_Vid
->
compu‹BiP»d2
[
H_PEL
];

758 
mv_block
->
compu‹BiP»dQP–
 = 
p_Vid
->
compu‹BiP»d2
[
Q_PEL
];

762 
mv_block
->
compu‹P»dFP–
 = 
p_Vid
->
compu‹UniP»d
[
F_PEL
];

763 
mv_block
->
compu‹P»dHP–
 = 
p_Vid
->
compu‹UniP»d
[
H_PEL
];

764 
mv_block
->
compu‹P»dQP–
 = 
p_Vid
->
compu‹UniP»d
[
Q_PEL
];

765 
mv_block
->
compu‹BiP»dFP–
 = 
p_Vid
->
compu‹BiP»d1
[
F_PEL
];

766 
mv_block
->
compu‹BiP»dHP–
 = 
p_Vid
->
compu‹BiP»d1
[
H_PEL
];

767 
mv_block
->
compu‹BiP»dQP–
 = 
p_Vid
->
compu‹BiP»d1
[
Q_PEL
];

769 
	}
}

777 
	$ä“_mv_block
(
MEBlock
 *
mv_block
)

779 ià(
mv_block
->
Üig_pic
)

781 
	`ä“_mem2D³l
(
mv_block
->
Üig_pic
);

783 
	}
}

786 
	$g‘_Üigš®_block
(
VideoP¬am‘”s
 *
p_Vid
, 
MEBlock
 *
mv_block
)

791 
img³l
 *
Üig_pic_tmp
 = 
mv_block
->
Üig_pic
[0];

792 
bsx
 = 
mv_block
->
blocksize_x
;

793 
pic_pix_x
 = 
mv_block
->
pos_x
;

794 
i
, 
j
;

795 
img³l
 **
cur_img
 = &
p_Vid
->
pCurImg
[
mv_block
->
pos_y
];

797 
j
 = 0; j < 
mv_block
->
blocksize_y
; j++)

799 
	`memýy
(
Üig_pic_tmp
,&
cur_img
[
j
][
pic_pix_x
], 
bsx
 * (
img³l
));

800 
Üig_pic_tmp
 +ð
bsx
;

803 iàÐ
p_Vid
->
p_IÅ
->
ChromaMEEÇbË
 )

805 
bsx
 = 
mv_block
->
blocksize_ü_x
;

806 
pic_pix_x
 = 
mv_block
->
pos_ü_x
;

809  
i
 = 1; i<=2; i++)

811 
cur_img
 = &
p_Vid
->
pImgOrg
[
i
][
mv_block
->
pos_ü_y
];

812 
Üig_pic_tmp
 = 
mv_block
->
Üig_pic
[
i
];

813 
j
 = 0; j < 
mv_block
->
blocksize_ü_y
; j++)

815 
	`memýy
(
Üig_pic_tmp
, &(
cur_img
[
j
][
pic_pix_x
]), 
bsx
 * (
img³l
));

816 
Üig_pic_tmp
 +ð
bsx
;

820 
	}
}

822 
	$CheckS—rchRªge
(
VideoP¬am‘”s
 *
p_Vid
, 
MÙiÚVeùÜ
 *
pP»dMV
, MÙiÚVeùÜ *
pSWC
, 
MEBlock
 *
mv_block
)

824 
iMaxMVD
 = 
p_Vid
->
max_mvd
 - 2;

825 
S—rchWšdow
 *
£¬chRªge
 = &
mv_block
->searchRange;

826 
Ëá
 = 
pSWC
->
mv_x
 + 
£¬chRªge
->
mš_x
;

827 
right
 = 
pSWC
->
mv_x
 + 
£¬chRªge
->
max_x
;

828 
tÝ
 = 
pSWC
->
mv_y
 + 
£¬chRªge
->
mš_y
;

829 
down
 = 
pSWC
->
mv_y
 + 
£¬chRªge
->
max_y
;

831 
Ëá
 = 
	`iCl3
(
pP»dMV
->
mv_x
 - 
iMaxMVD
,…PredMV->mv_x + iMaxMVD,†eft);

832 
right
 = 
	`iCl3
(
pP»dMV
->
mv_x
 - 
iMaxMVD
,…PredMV->mv_x + iMaxMVD,„ight);

833 
tÝ
 = 
	`iCl3
(
pP»dMV
->
mv_y
 - 
iMaxMVD
,…PredMV->mv_y + iMaxMVD,op);

834 
down
 = 
	`iCl3
(
pP»dMV
->
mv_y
 - 
iMaxMVD
,…PredMV->mv_y + iMaxMVD, down);

836 if(
Ëá
<
right
 && 
tÝ
<
down
)

838 
pSWC
->
mv_x
 = (è((
Ëá
 + 
right
)>>1);

839 
pSWC
->
mv_y
 = (è((
tÝ
 + 
down
)>>1);

840 
£¬chRªge
->
mš_x
 = 
Ëá
 - 
pSWC
->
mv_x
;

841 
£¬chRªge
->
max_x
 = 
	`imš
(
pSWC
->
mv_x
-
Ëá
, 
right
-pSWC->mv_x);

842 
£¬chRªge
->
mš_y
 = 
tÝ
 - 
pSWC
->
mv_y
;

843 
£¬chRªge
->
max_y
 = 
	`imš
(
pSWC
->
mv_y
-
tÝ
, 
down
-pSWC->mv_y);

847 *
pSWC
 = *
pP»dMV
;

849 
	}
}

857 
di¡blk


858 
	$BlockMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

859 
MEBlock
 *
mv_block
,

860 
mb_x
,

861 
mb_y
,

862 * 
Ïmbda_çùÜ
)

866 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

867 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

868 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

870 
i
, 
j
;

871 
di¡blk
 
max_v®ue
 = 
DISTBLK_MAX
;

872 
di¡blk
 
mš_mco¡
 = 
max_v®ue
;

873 
block_x
 = (
mb_x
>>2);

874 
block_y
 = (
mb_y
>>2);

876 
bsx
 = 
mv_block
->
blocksize_x
;

877 
bsy
 = 
mv_block
->
blocksize_y
;

879 
pic_pix_x
 = (è(
cu¼MB
->
pix_x
 + 
mb_x
);

881 
blockty³
 = 
mv_block
->blocktype;

882 
li¡
 = 
mv_block
->list;

883 
»f
 = 
mv_block
->
»f_idx
;

884 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
], 
´ed
;

886 
MÙiÚVeùÜ
 **
®l_mv
 = &
cu¼Sliû
->®l_mv[
li¡
][
»f
][
blockty³
][
block_y
];

888 
di¡blk
 *
´evSad
 = (
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
EPZS
)? 
cu¼Sliû
->
p_EPZS
->
di¡ÜtiÚ
[
li¡
 + 
cu¼MB
->
li¡_off£t
][
blockty³
 - 1]: 
NULL
;

890 
	`g‘_ÃighbÜs
(
cu¼MB
, 
mv_block
->
block
, 
mb_x
, 
mb_y
, 
bsx
);

892 
	`P»·»MEP¬ams
(
cu¼Sliû
, 
mv_block
, 
p_IÅ
->
ChromaMEEÇbË
, 
li¡
 + 
cu¼MB
->
li¡_off£t
, 
»f
);

897 ià(
blockty³
 > 4)

898 
	`g‘_Üigš®_block
(
p_Vid
, 
mv_block
);

903 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX
)

905 
p_Vid
->
p_UMHex
->
UMHEX_blockty³
 = 
blockty³
;

906 
p_Vid
->
p_UMHex
->
b»d_æag
 = 0;

907 
	`UMHEXS‘MÙiÚVeùÜP»diùÜ
(
cu¼MB
, &
´ed
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
»f
, 
li¡
, 
mb_x
, 
mb_y
, 
bsx
, 
bsy
, 
mv_block
);

909 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX_SIMPLE
)

911 
	`smpUMHEX_£tup
(
cu¼MB
, 
»f
, 
li¡
, 
block_y
, 
block_x
, 
blockty³
, 
cu¼Sliû
->
®l_mv
 );

912 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mv_block
->
block
, &
´ed
, 
»f
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡
, 
mb_x
, 
mb_y
, 
bsx
, 
bsy
);

916 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mv_block
->
block
, &
´ed
, 
»f
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡
, 
mb_x
, 
mb_y
, 
bsx
, 
bsy
);

924 ià(
p_IÅ
->
EPZSSubP–Grid
)

926 *
mv
 = 
´ed
;

930 #ià(
JM_INT_DIVIDE
)

931 
mv
->
mv_x
 = (è(((
´ed
.mv_x + 2) >> 2) * 4);

932 
mv
->
mv_y
 = (è(((
´ed
.mv_y + 2) >> 2) * 4);

934 
mv
->
mv_x
 = (è((
´ed
.mv_x / 4) * 4);

935 
mv
->
mv_y
 = (è((
´ed
.mv_y / 4) * 4);

939 ià(
p_IÅ
->
Di§bËMEP»diùiÚ
 =ð
TRUE
)

941 
mv
->
mv_x
 = 0;

942 
mv
->
mv_y
 = 0;

945 ià(!
p_IÅ
->
rdÝt
)

947 
MÙiÚVeùÜ
 
ûÁ”
 = *
mv
;

949 
mv
->
mv_x
 = (è
	`iCl3
 (
mv_block
->
£¬chRªge
.
mš_x
, mv_block->£¬chRªge.
max_x
, mv->mv_x);

950 
mv
->
mv_y
 = (è
	`iCl3
 (
mv_block
->
£¬chRªge
.
mš_y
, mv_block->£¬chRªge.
max_y
, mv->mv_y);

952 if((
mv
->
mv_x
 !ð
ûÁ”
.mv_xè|| (mv->
mv_y
 != center.mv_y))

953 
	`CheckS—rchRªge
(
p_Vid
, &
ûÁ”
, 
mv
, 
mv_block
);

957 
	`þ_mv_¿nge
(
p_Vid
, 0, 
mv
, 
Q_PEL
);

960 
mš_mco¡
 = 
cu¼MB
->
	`IÁP–ME
 (cu¼MB, &
´ed
, 
mv_block
, mš_mco¡, 
Ïmbda_çùÜ
[
F_PEL
]);

965 
mv_block
->
ChromaMEEÇbË
 = (
p_IÅ
->ChromaMEEÇbË =ð
ME_YUV_FP_SP
 ) ? 
TRUE
 : 
FALSE
;

967 ià(!
p_IÅ
->
Di§bËSub³lME
[
p_Vid
->
v›w_id
])

969 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] !ð
EPZS
 || (
»f
 =ð0 || 
cu¼Sliû
->
¡ruùu»
 !ð
FRAME
 || (»à> 0 && 
mš_mco¡
 < 3.5 * 
´evSad
[
pic_pix_x
 >> 2])))

971 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_hp
 )

973 
mš_mco¡
 = 
max_v®ue
;

975 
mš_mco¡
 = 
cu¼MB
->
	`SubP–ME
 (cu¼MB, &
´ed
, 
mv_block
, mš_mco¡, 
Ïmbda_çùÜ
);

981 
	`þ_mv_¿nge
(
p_Vid
, 0, 
mv
, 
Q_PEL
);

983 ià(!
p_IÅ
->
rdÝt
)

986 ià(
blockty³
 =ð1 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
) ))

988 
di¡blk
 
co¡
;

989 
	`FšdSkModeMÙiÚVeùÜ
 (
cu¼MB
);

991 
co¡
 = 
	`G‘SkCo¡MB
 (
cu¼MB
, 
Ïmbda_çùÜ
[
Q_PEL
]);

992 ià(
co¡
 < 
mš_mco¡
)

994 
mš_mco¡
 = 
co¡
;

995 *
mv
 = 
cu¼Sliû
->
®l_mv
 [0][0][0][0][0];

1005 
i
=
block_x
; i < block_x + (
bsx
>>2); i++)

1007 
®l_mv
[0][
i
] = *
mv
;

1011 
j
=1; j < (
bsy
>>2); j++)

1013 
	`memýy
(&
®l_mv
[
j
][
block_x
], &®l_mv[0][block_x], (
bsx
>>2è* (
MÙiÚVeùÜ
));

1018 ià(
	`is_b»d_’abËd
(
p_Vid
, 
blockty³
è&& (
»f
 == 0))

1020 
	`BiP»dBlockMÙiÚS—rch
(
cu¼MB
, 
mv_block
, &
´ed
, 
mb_x
, 
mb_y
, 
Ïmbda_çùÜ
);

1023  
mš_mco¡
;

1024 
	}
}

1033 
di¡blk
 
	$BiP»dBlockMÙiÚS—rch
(
Maüoblock
 *
cu¼MB
,

1034 
MEBlock
 *
mv_block
,

1035 
MÙiÚVeùÜ
 *
´ed_mv
,

1036 
mb_x
,

1037 
mb_y
,

1038 * 
Ïmbda_çùÜ
)

1040 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1041 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1042 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1043 
li¡
 = 
mv_block
->list;

1044 
i
, 
j
;

1045 
b»d_ty³
 = 
li¡
 ? 0 : 1;

1046 
MÙiÚVeùÜ
 ***** 
b»d_mv
 = 
cu¼Sliû
->b»d_mv[
b»d_ty³
];

1047 
di¡blk
 
mš_mco¡bi
 = 
DISTBLK_MAX
;

1048 
MÙiÚVeùÜ
 *
mv
 = &
mv_block
->mv[
li¡
];

1049 
MÙiÚVeùÜ
 
bimv
, 
‹mpmv
;

1050 
MÙiÚVeùÜ
 
´ed_mv1
, 
´ed_mv2
, 
´ed_bi
;

1051 
MÙiÚVeùÜ
 *
bi_mv1
 = 
NULL
, *
bi_mv2
 = NULL;

1052 
™”li¡
 = (è
li¡
;

1053 
block_x
 = (
mb_x
>>2);

1054 
block_y
 = (
mb_y
>>2);

1055 
blockty³
 = 
mv_block
->blocktype;

1056 
bsx
 = 
mv_block
->
blocksize_x
;

1057 
bsy
 = 
mv_block
->
blocksize_y
;

1062 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
UM_HEX
)

1064 
p_Vid
->
p_UMHex
->
b»d_æag
 = 1;

1065 
	`UMHEXS‘MÙiÚVeùÜP»diùÜ
(
cu¼MB
, &
´ed_bi
, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 0, 
li¡
 ^ 1, 
mb_x
, 
mb_y
, 
bsx
, 
bsy
, 
mv_block
);

1068 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mv_block
->
block
, &
´ed_bi
, 0, 
p_Vid
->
’c_piùu»
->
mv_šfo
, 
li¡
 ^ 1, 
mb_x
, 
mb_y
, 
bsx
, 
bsy
);

1070 ià((
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] !ð
EPZS
è|| (p_IÅ->
EPZSSubP–Grid
 == 0))

1072 
mv
->
mv_x
 = ((mv->mv_x + 2) >> 2) * 4;

1073 
mv
->
mv_y
 = ((mv->mv_y + 2) >> 2) * 4;

1074 
bimv
.
mv_x
 = ((
´ed_bi
.mv_x + 2) >> 2) * 4;

1075 
bimv
.
mv_y
 = ((
´ed_bi
.mv_y + 2) >> 2) * 4;

1079 
bimv
 = 
´ed_bi
;

1083 
mv_block
->
™”©iÚ_no
 = 0; mv_block->™”©iÚ_nØ<ð
p_IÅ
->
BiP»dMERefšem’ts
; mv_block->iteration_no++)

1085 ià(
mv_block
->
™”©iÚ_no
 & 0x01)

1087 
´ed_mv1
 = *
´ed_mv
;

1088 
´ed_mv2
 = 
´ed_bi
;

1089 
bi_mv1
 = 
mv
;

1090 
bi_mv2
 = &
bimv
;

1091 
™”li¡
 = (è
li¡
;

1095 
´ed_mv1
 = 
´ed_bi
;

1096 
´ed_mv2
 = *
´ed_mv
;

1097 
bi_mv1
 = &
bimv
;

1098 
bi_mv2
 = 
mv
;

1099 
™”li¡
 = (è(
li¡
 ^ 1);

1102 
‹mpmv
 = *
bi_mv1
;

1104 
	`P»·»BiP»dMEP¬ams
(
cu¼Sliû
, 
mv_block
, mv_block->
ChromaMEEÇbË
, 
™”li¡
, 
cu¼MB
->
li¡_off£t
, mv_block->
»f_idx
);

1106 
mš_mco¡bi
 = 
cu¼MB
->
	`BiP»dME
 (cu¼MB, 
™”li¡
,

1107 &
´ed_mv1
, &
´ed_mv2
, 
bi_mv1
, 
bi_mv2
, 
mv_block
,

1108 (
p_IÅ
->
BiP»dMES—rchRªge
[
p_Vid
->
v›w_id
] <<2)>>
mv_block
->
™”©iÚ_no
, 
mš_mco¡bi
, 
Ïmbda_çùÜ
[
F_PEL
]);

1110 ià(
mv_block
->
™”©iÚ_no
 > 0 && (
‹mpmv
.
mv_x
 =ð
bi_mv1
->mv_xè&& (‹mpmv.
mv_y
 == bi_mv1->mv_y))

1116 ià(!
p_IÅ
->
Di§bËSub³lME
[
p_Vid
->
v›w_id
])

1118 ià(
p_IÅ
->
BiP»dMESubP–
)

1120 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_hp
 )

1121 
mš_mco¡bi
 = 
DISTBLK_MAX
;

1122 
	`P»·»BiP»dMEP¬ams
(
cu¼Sliû
, 
mv_block
, mv_block->
ChromaMEEÇbË
, 
™”li¡
, 
cu¼MB
->
li¡_off£t
, mv_block->
»f_idx
);

1124 
mš_mco¡bi
 = 
cu¼MB
->
	`SubP–BiP»dME
 (cu¼MB, 
mv_block
, 
™”li¡
, &
´ed_mv1
, &
´ed_mv2
, 
bi_mv1
, 
bi_mv2
, mš_mco¡bi, 
Ïmbda_çùÜ
);

1127 ià(
p_IÅ
->
BiP»dMESubP–
==2)

1129 iàÐ!
p_Vid
->
¡¬t_me_»fšem’t_qp
 )

1130 
mš_mco¡bi
 = 
DISTBLK_MAX
;

1131 
	`P»·»BiP»dMEP¬ams
(
cu¼Sliû
, 
mv_block
, mv_block->
ChromaMEEÇbË
, 
™”li¡
 ^ 1, 
cu¼MB
->
li¡_off£t
, mv_block->
»f_idx
);

1133 
mš_mco¡bi
 = 
cu¼MB
->
	`SubP–BiP»dME
 (cu¼MB, 
mv_block
, 
™”li¡
 ^ 1, &
´ed_mv2
, &
´ed_mv1
, 
bi_mv2
, 
bi_mv1
, mš_mco¡bi, 
Ïmbda_çùÜ
);

1137 
	`þ_mv_¿nge
(
p_Vid
, 0, 
bi_mv1
, 
Q_PEL
);

1138 
	`þ_mv_¿nge
(
p_Vid
, 0, 
bi_mv2
, 
Q_PEL
);

1140 
j
=
block_y
; j < block_y + (
bsy
>>2); j++)

1142 
i
=
block_x
 ; i < block_x + (
bsx
>>2); i++)

1144 
b»d_mv
[
™”li¡
 ][(è
mv_block
->
»f_idx
][
blockty³
][
j
][
i
] = *
bi_mv1
;

1145 
b»d_mv
[
™”li¡
 ^ 1][(è
mv_block
->
»f_idx
][
blockty³
][
j
][
i
] = *
bi_mv2
;

1150  
mš_mco¡bi
;

1151 
	}
}

1159 
di¡blk
 
	$BIDP¬t™iÚCo¡
 (
Maüoblock
 *
cu¼MB
,

1160 
blockty³
,

1161 
block8x8
,

1162 
cur_»f
[2],

1163 
Ïmbda_çùÜ
)

1165 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1166 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1167 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1168 
img³l
 **
cur_img
 = 
p_Vid
->
pCurImg
;

1170 
pic_pix_x
, 
pic_pix_y
;

1171 
v
, 
h
;

1172 
di¡blk
 
mco¡
;

1174 
mvd_b™s
 = 0;

1176 
·¹ty³
 = (
blockty³
 < 4 ? blocktype : 4);

1177 
¡•_h0
 = 
block_size
[ 
·¹ty³
][0];

1178 
¡•_v0
 = 
block_size
[ 
·¹ty³
][1];

1179 
¡•_h
 = 
block_size
[
blockty³
][0];

1180 
¡•_v
 = 
block_size
[
blockty³
][1];

1181 
bx
 = 
bx0
[
·¹ty³
][
block8x8
] << 2;

1182 
by
 = 
by0
[
·¹ty³
][
block8x8
] << 2;

1183 
block_size_x
 = 
block_size
[
blockty³
][0];

1184 
block_size_y
 = 
block_size
[
blockty³
][1];

1186 
MÙiÚVeùÜ
 **
®l_mv_l0
 = 
cu¼Sliû
->
®l_mv
 [
LIST_0
][(è
cur_»f
[LIST_0]][
blockty³
];

1187 
MÙiÚVeùÜ
 **
®l_mv_l1
 = 
cu¼Sliû
->
®l_mv
 [
LIST_1
][(è
cur_»f
[LIST_1]][
blockty³
];

1188 
b»d_me
 = 0;

1189 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

1190 
li¡_mode
[2];

1191 
li¡_mode
[0] = 
blockty³
;

1192 
li¡_mode
[1] = 
blockty³
;

1197 
mvd_b™s
 = 
	`mv_b™_co¡
(
cu¼MB
, 
®l_mv_l0
, 
LIST_0
, 
cur_»f
[LIST_0], 
by
, 
bx
, 
¡•_v0
, 
¡•_v
, 
¡•_h0
, 
¡•_h
, mvd_bits);

1199 
mvd_b™s
 = 
	`mv_b™_co¡
(
cu¼MB
, 
®l_mv_l1
, 
LIST_1
, 
cur_»f
[LIST_1], 
by
, 
bx
, 
¡•_v0
, 
¡•_v
, 
¡•_h0
, 
¡•_h
, mvd_bits);

1201 
mco¡
 = 
	`weigh‹d_co¡
 (
Ïmbda_çùÜ
, 
mvd_b™s
);

1204 
v
 = 
by
; v < by + 
¡•_v0
; v +ð
block_size_y
)

1206 
h
 = 
bx
; h < bx + 
¡•_h0
; h +ð
block_size_x
)

1208 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
h
, 
v
, 
block_size_x
, 
block_size_y
, 2, 
li¡_mode
, 
cur_»f
, 
b»d_me
);

1213 ià((!
cu¼Sliû
->
p_IÅ
->
T¿nsfÜm8x8Mode
è|| (
blockty³
>4))

1215 
diff16
[16];

1216 *
diff
;

1218 
pic_pix_y
 = (è
cu¼MB
->
Ýix_y
;

1219 
pic_pix_x
 = (è
cu¼MB
->
pix_x
;

1220 
v
ð
by
; v < by + 
¡•_v0
; v +ð
BLOCK_SIZE
)

1222 
h
 = 
bx
; h < bx + 
¡•_h0
; h +ð
BLOCK_SIZE
)

1224 
diff
 = 
diff16
;

1225 
	`ÿlcDifã»nû
(
cur_img
, 
pic_pix_x
+
h
, 
pic_pix_y
+
v
, 
mb_´ed
, h,v, 4, 4, 
diff
);

1226 
mco¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
, 
DISTBLK_MAX
);

1232 
diff64
[64];

1233 *
diff
;

1235 
pic_pix_y
 = (è
cu¼MB
->
Ýix_y
;

1236 
pic_pix_x
 = (è
cu¼MB
->
pix_x
;

1237 
v
ð
by
; v < by + 
¡•_v0
; v +ð
BLOCK_SIZE_8x8
)

1239 
h
 = 
bx
; h < bx + 
¡•_h0
; h +ð
BLOCK_SIZE_8x8
)

1241 
diff
 = 
diff64
;

1242 
	`ÿlcDifã»nû
(
cur_img
, 
pic_pix_x
+
h
, 
pic_pix_y
+
v
, 
mb_´ed
, h, v, 8, 8, 
diff
);

1243 
mco¡
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
(
diff64
, 
DISTBLK_MAX
);

1248  
mco¡
;

1249 
	}
}

1257 
di¡blk
 
	$G‘SkCo¡MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
)

1259 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1260 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1261 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1262 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1263 
di¡blk
 
co¡
 = 0;

1265 
block
;

1266 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

1267 
cur_»f
[2] = {0, 0};

1268 
li¡_mode
[2] = {0, 0};

1271 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 0, 0, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE, 0, 
li¡_mode
, 
cur_»f
, 0);

1273 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 == 0)

1275 
diff16
[16];

1276 *
diff
;

1277 
block_y
, 
block_x
;

1278 
mb_x
, 
mb_y
;

1280 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

1281 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

1283 
block
 = 0;block < 4; block++)

1285 
mb_y
 = (
block
 >> 1)<<3;

1286 
mb_x
 = (
block
 & 0x01)<<3;

1287 
block_y
 = 
mb_y
; block_y < mb_y + 8; block_y += 4)

1289 
block_x
 = 
mb_x
; block_x < mb_x + 8; block_x += 4)

1291 
diff
 = 
diff16
;

1293 
	`ÿlcDifã»nû
(
p_Vid
->
pCurImg
, 
pic_pix_x
+
block_x
, 
pic_pix_y
+
block_y
, 
mb_´ed
, block_x, block_y, 4, 4, 
diff
);

1294 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
, 
DISTBLK_MAX
);

1301 
diff64
[64];

1302 *
diff
;

1304 
mb_x
, 
mb_y
;

1306 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

1307 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

1309 
block
 = 0;block < 4;block++)

1311 
mb_y
 = (
block
 >> 1)<<3;

1312 
mb_x
 = (
block
 & 0x01)<<3;

1315 
diff
 = 
diff64
;

1316 
	`ÿlcDifã»nû
(
p_Vid
->
pCurImg
, 
pic_pix_x
+
mb_x
, 
pic_pix_y
+
mb_y
, 
mb_´ed
, mb_x, mb_y, 8, 8, 
diff
);

1317 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
 (
diff64
, 
DISTBLK_MAX
);

1322 
co¡
 -ð
	`weight_co¡
(
Ïmbda
, 8);

1324  
co¡
;

1325 
	}
}

1333 
	$FšdSkModeMÙiÚVeùÜ
 (
Maüoblock
 *
cu¼MB
)

1335 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1336 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1337 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1338 
bx
, 
by
;

1339 
MÙiÚVeùÜ
 **
®l_mv
 = 
cu¼Sliû
->all_mv[0][0][0];

1341 
MÙiÚVeùÜ
 
pmv
;

1343 
z”oMÙiÚAbove
;

1344 
z”oMÙiÚLeá
;

1345 
Pix–Pos
 
mb
[4];

1346 
a_mv_y
 = 0;

1347 
a_»f_idx
 = 0;

1348 
b_mv_y
 = 0;

1349 
b_»f_idx
 = 0;

1351 
	`g‘_ÃighbÜs
(
cu¼MB
, 
mb
, 0, 0, 16);

1353 ià(
mb
[0].
avažabË
)

1355 
a_mv_y
 = 
mÙiÚ
[
mb
[0].
pos_y
][mb[0].
pos_x
].
mv
[
LIST_0
].
mv_y
;

1356 
a_»f_idx
 = 
mÙiÚ
[
mb
[0].
pos_y
][mb[0].
pos_x
].
»f_idx
[
LIST_0
];

1358 ià(
cu¼MB
->
mb_f›ld
 && !
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].mb_field)

1360 
a_mv_y
 /=2;

1361 
a_»f_idx
 *=2;

1363 ià(!
cu¼MB
->
mb_f›ld
 && 
p_Vid
->
mb_d©a
[
mb
[0].
mb_addr
].mb_field)

1365 
a_mv_y
 *= 2;

1366 
a_»f_idx
 >>=1;

1370 ià(
mb
[1].
avažabË
)

1372 
b_mv_y
 = 
mÙiÚ
[
mb
[1].
pos_y
][mb[1].
pos_x
].
mv
[
LIST_0
].
mv_y
;

1373 
b_»f_idx
 = 
mÙiÚ
[
mb
[1].
pos_y
][mb[1].
pos_x
].
»f_idx
[
LIST_0
];

1375 ià(
cu¼MB
->
mb_f›ld
 && !
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].mb_field)

1377 
b_mv_y
 /=2;

1378 
b_»f_idx
 *=2;

1380 ià(!
cu¼MB
->
mb_f›ld
 && 
p_Vid
->
mb_d©a
[
mb
[1].
mb_addr
].mb_field)

1382 
b_mv_y
 *=2;

1383 
b_»f_idx
 >>=1;

1387 
z”oMÙiÚLeá
 = !
mb
[0].
avažabË
 ? 1 : 
a_»f_idx
==0 && 
mÙiÚ
[mb[0].
pos_y
][mb[0].
pos_x
].
mv
[
LIST_0
].
mv_x
 ==0 && 
a_mv_y
==0 ? 1 : 0;

1388 
z”oMÙiÚAbove
 = !
mb
[1].
avažabË
 ? 1 : 
b_»f_idx
==0 && 
mÙiÚ
[mb[1].
pos_y
][mb[1].
pos_x
].
mv
[
LIST_0
].
mv_x
 ==0 && 
b_mv_y
==0 ? 1 : 0;

1390 ià(
z”oMÙiÚAbove
 || 
z”oMÙiÚLeá
)

1392 
	`mem£t
(&
®l_mv
 [0][0], 0, 16 * (
MÙiÚVeùÜ
));

1396 
cu¼MB
->
	`G‘MVP»diùÜ
 (cu¼MB, 
mb
, &
pmv
, 0, 
mÙiÚ
, 
LIST_0
, 0, 0, 16, 16);

1398 
by
 = 0;by < 4;by++)

1399 
bx
 = 0;bx < 4;bx++)

1401 
®l_mv
 [
by
][
bx
] = 
pmv
;

1404 
	}
}

1412 
di¡blk
 
	$G‘DœeùCo¡8x8
 (
Maüoblock
 *
cu¼MB
, 
block
, 
di¡blk
 *
co¡8x8
)

1414 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1415 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1416 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1417 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1418 
pic_pix_y
, 
pic_pix_x
, 
i
, 
j
;

1420 
di¡blk
 
co¡
 = 0;

1421 
mb_y
 = (
block
 >> 1)<<3;

1422 
mb_x
 = (
block
 & 0x01)<<3;

1423 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

1424 
li¡_mode
[2] = {0, 0};

1427 
j
=(
cu¼MB
->
Ýix_y
 + 
mb_y
) >> 2; j < (currMB->opix_y + mb_y + 8) >> 2; j++)

1429 
i
=(
cu¼MB
->
pix_x
 + 
mb_x
) >> 2; i < (currMB->pix_x + mb_x + 8) >> 2; i++)

1431 ià(
cu¼Sliû
->
dœeù_pdœ
[
j
][
i
] < 0)

1433 *
co¡8x8
 = 
DISTBLK_MAX
;

1434  
DISTBLK_MAX
;

1440 
j
 = 
mb_y
; j < mb_y + 8; j += 4)

1442 
pic_pix_y
 = (
cu¼MB
->
Ýix_y
 + 
j
) >> 2;

1443 
i
 = 
mb_x
; i < mb_x + 8; i += 4)

1445 
pic_pix_x
 = (
cu¼MB
->
pix_x
 + 
i
) >> 2;

1446 
p_Dpb
->
	`pf_luma_´ediùiÚ
 (
cu¼MB
, 
i
, 
j
, 4, 4, 
cu¼Sliû
->
dœeù_pdœ
[
pic_pix_y
][
pic_pix_x
],

1447 
li¡_mode
, 
cu¼Sliû
->
dœeù_»f_idx
[
pic_pix_y
][
pic_pix_x
], 0);

1451 if(
p_IÅ
->
T¿nsfÜm8x8Mode
)

1453 
diff16
[4][16];

1454 
diff64
[64];

1455 *
tmp64
 = 
diff64
;

1456 *
tmp16
[4];

1457 
šdex
;

1459 
tmp16
[0] = 
diff16
[0];

1460 
tmp16
[1] = 
diff16
[1];

1461 
tmp16
[2] = 
diff16
[2];

1462 
tmp16
[3] = 
diff16
[3];

1464 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
;

1465 
pic_pix_x
 = 
cu¼MB
->
pix_x
;

1468 
j
 = 
mb_y
; j < 8 + mb_y; j++)

1470 
i
 = 
mb_x
; i < 8 + mb_x; i++)

1472 
šdex
 = 2 * ((
j
 - 
mb_y
)> 3è+ ((
i
 - 
mb_x
)> 3);

1473 *
tmp64
++ = *(
tmp16
[
šdex
])++ = (è(
p_Vid
->
pCurImg
[
pic_pix_y
 + 
j
][
pic_pix_x
 + 
i
] - 
mb_´ed
[j][i]);

1477 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[0], 
DISTBLK_MAX
);

1478 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[1], 
DISTBLK_MAX
);

1479 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[2], 
DISTBLK_MAX
);

1480 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
[3], 
DISTBLK_MAX
);

1481 *
co¡8x8
 +ð
p_Vid
->
	`di¡ÜtiÚ8x8
 (
diff64
, 
DISTBLK_MAX
);

1485 
block_y
, 
block_x
;

1486 
diff16
[16];

1487 *
diff
;

1489 
block_y
=
mb_y
; block_y < mb_y + 8; block_y += 4)

1491 
pic_pix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

1493 
block_x
=
mb_x
; block_x<mb_x+8; block_x+=4)

1495 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

1496 
diff
 = 
diff16
;

1499 
	`ÿlcDifã»nû
(
p_Vid
->
pCurImg
, 
pic_pix_x
, 
pic_pix_y
, 
mb_´ed
, 
block_x
, 
block_y
, 4, 4, 
diff
);

1500 
co¡
 +ð
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff16
, 
DISTBLK_MAX
);

1505  
co¡
;

1506 
	}
}

1516 
di¡blk
 
	$G‘DœeùCo¡MB
 (
Maüoblock
 *
cu¼MB
)

1518 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1519 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

1520 
i
;

1521 
di¡blk
 
co¡
 = 0;

1522 
di¡blk
 
co¡8x8
 = 0;

1523 
b¦iû
 = 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
;

1524 #ià(
MVC_EXTENSION_ENABLE
)

1525 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[(
cu¼Sliû
->
p_Vid
->
num_of_Ïy”s
 > 1è? cu¼Sliû->
v›w_id
 : 0][
b¦iû
];

1527 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[0][
b¦iû
];

1530 
i
=0; i<4; i++)

1532 
co¡
 +ð
	`G‘DœeùCo¡8x8
 (
cu¼MB
, 
i
, &
co¡8x8
);

1533 ià(
co¡8x8
 =ð
DISTBLK_MAX
)  DISTBLK_MAX;

1536 
p_IÅ
->
T¿nsfÜm8x8Mode
)

1539 if((
co¡8x8
 < 
co¡
)||

1540 !(
IÁ”S—rch
[5] &&

1541 
IÁ”S—rch
[6] &&

1542 
IÁ”S—rch
[7])

1545 
co¡
 = 
co¡8x8
;

1549 
co¡
 = 
co¡8x8
;

1555  
co¡
;

1556 
	}
}

1564 
	$P¬t™iÚMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

1565 
blockty³
,

1566 
block8x8
,

1567 *
Ïmbda_çùÜ
)

1569 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1570 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1572 #ià
GET_METIME


1573 
TIME_T
 
me_time_¡¬t
;

1574 
TIME_T
 
me_time_’d
;

1575 
št64
 
me_tmp_time
;

1576 
	`g‘time
Ð&
me_time_¡¬t
 );

1579 ià(
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 == 1)

1581 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1582 
by
 = 
by0
[
blockty³
][
block8x8
];

1583 
bx
 = 
bx0
[
blockty³
][
block8x8
];

1584 
¡•_h
 = (
·¹_size
[
blockty³
][0]);

1585 
¡•_v
 = (
·¹_size
[
blockty³
][1]);

1587 
pic_block_y
 = 
cu¼MB
->
block_y
 + 
by
;

1588 
pic_block_x
 = 
cu¼MB
->
block_x
 + 
bx
;

1589 
li¡_off£t
 = 
cu¼MB
->list_offset;

1590 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 2 : 1;

1591 
di¡blk
 *
m_co¡
;

1593 
li¡
 = 
LIST_0
;

1594 
»f
 = 0;

1597 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

1599 
»f
=0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
+
li¡_off£t
];„ef++)

1601 
m_co¡
 = &
p_Vid
->
mÙiÚ_co¡
[
blockty³
][
li¡
][
»f
][
block8x8
];

1604 
	`upd©eMV_mp
(
cu¼MB
, 
m_co¡
, 
»f
, 
li¡
, 
bx
, 
by
, 
blockty³
, 
block8x8
);

1605 
	`£t_me_·¿m‘”s
(
mÙiÚ
, &
cu¼Sliû
->
®l_mv
[
li¡
][
»f
][
blockty³
][
by
][
bx
],†i¡, (è»f, 
¡•_h
, 
¡•_v
, 
pic_block_y
, 
pic_block_x
);

1611 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1612 
by
 = 
by0
[
blockty³
][
block8x8
];

1613 
bx
 = 
bx0
[
blockty³
][
block8x8
];

1614 
¡•_h
 = (
·¹_size
[
blockty³
][0]);

1615 
¡•_v
 = (
·¹_size
[
blockty³
][1]);

1617 
pic_block_y
 = 
cu¼MB
->
block_y
 + 
by
;

1618 
pic_block_x
 = 
cu¼MB
->
block_x
 + 
bx
;

1619 
li¡_off£t
 = 
cu¼MB
->list_offset;

1620 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 2 : 1;

1621 
li¡
 = 
LIST_0
;

1622 
»f
 = 0;

1623 
MEBlock
 
mv_block
;

1624 
di¡blk
 *
m_co¡
;

1627 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1630 
mv_block
.
‹¡8x8
 = 
p_IÅ
->
T¿nsfÜm8x8Mode
;

1632 
	`š™_mv_block
(
cu¼MB
, &
mv_block
, (è
blockty³
, 
li¡
, (è
»f
, 
bx
, 
by
);

1634 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
EPZS
)

1636 ià(
p_IÅ
->
EPZSSubP–Grid
)

1637 
cu¼MB
->
IÁP–ME
 = 
EPZS_š‹g”_mÙiÚ_e¡im©iÚ
;

1639 
cu¼MB
->
IÁP–ME
 = 
EPZS_mÙiÚ_e¡im©iÚ
;

1642 
	`g‘_Üigš®_block
(
p_Vid
, &
mv_block
);

1647 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

1650 
mv_block
.
li¡
 = ()†ist;

1651 
»f
=0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
+
li¡_off£t
];„ef++)

1653 
mv_block
.
»f_idx
 = (è
»f
;

1654 
m_co¡
 = &
p_Vid
->
mÙiÚ_co¡
[
blockty³
][
li¡
][
»f
][
block8x8
];

1658 
	`g‘_£¬ch_¿nge
(&
mv_block
, 
p_IÅ
, 
»f
, 
blockty³
);

1661 *
m_co¡
 = 
	`BlockMÙiÚS—rch
 (
cu¼MB
, &
mv_block
, 
bx
<<2, 
by
<<2, 
Ïmbda_çùÜ
);

1664 
	`£t_me_·¿m‘”s
(
mÙiÚ
, &
cu¼Sliû
->
®l_mv
[
li¡
][
»f
][
blockty³
][
by
][
bx
],†i¡, (è»f, 
¡•_h
, 
¡•_v
, 
pic_block_y
, 
pic_block_x
);

1669 
	`ä“_mv_block
(&
mv_block
);

1672 #ià
GET_METIME


1673 
	`g‘time
(&
me_time_’d
);

1674 
me_tmp_time
 = 
	`timediff
 (&
me_time_¡¬t
, &
me_time_’d
);

1675 
p_Vid
->
me_tÙ_time
 +ð
me_tmp_time
;

1676 
p_Vid
->
me_time
 +ð
me_tmp_time
;

1678 
	}
}

1686 
	$SubP¬t™iÚMÙiÚS—rch
 (
Maüoblock
 *
cu¼MB
,

1687 
blockty³
,

1688 
block8x8
,

1689 *
Ïmbda_çùÜ
)

1692 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1693 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1695 #ià
GET_METIME


1696 
TIME_T
 
me_time_¡¬t
;

1697 
TIME_T
 
me_time_’d
;

1698 
št64
 
me_tmp_time
;

1699 
	`g‘time
Ð&
me_time_¡¬t
 );

1702 ià(
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 == 1)

1704 
·¹ty³
 = 4;

1705 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1706 
by
 = 
by0
[
·¹ty³
][
block8x8
];

1707 
bx
 = 
bx0
[
·¹ty³
][
block8x8
];

1708 
¡•_h
 = (
·¹_size
[
blockty³
][0]);

1709 
¡•_v
 = (
·¹_size
[
blockty³
][1]);

1710 
li¡_off£t
 = 
cu¼MB
->list_offset;

1711 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 2 : 1;

1712 
di¡blk
 *
m_co¡
;

1713 
MÙiÚVeùÜ
 *
®l_mv
;

1714 
li¡
 = 
LIST_0
;

1715 
»f
 = 0;

1717 
¡•_h0
 = (
·¹_size
[ 
·¹ty³
][0]);

1718 
¡•_v0
 = (
·¹_size
[ 
·¹ty³
][1]);

1720 
v
, 
h
;

1721 
pic_block_y
;

1724 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

1726 
»f
=0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
+
li¡_off£t
];„ef++)

1728 
m_co¡
 = &
p_Vid
->
mÙiÚ_co¡
[
blockty³
][
li¡
][
»f
][
block8x8
];

1731 
v
=
by
; v<by + 
¡•_v0
; v +ð
¡•_v
)

1733 
pic_block_y
 = 
cu¼MB
->
block_y
 + 
v
;

1734 
h
=
bx
; h<bx+
¡•_h0
; h+=
¡•_h
)

1736 
®l_mv
 = &
cu¼Sliû
->®l_mv[
li¡
][
»f
][
blockty³
][
v
][
h
];

1738 
	`upd©eMV_mp
(
cu¼MB
, 
m_co¡
, 
»f
, 
li¡
, 
h
, 
v
, 
blockty³
, 
block8x8
);

1741 
	`£t_me_·¿m‘”s
(
mÙiÚ
, 
®l_mv
, 
li¡
, (è
»f
, 
¡•_h
, 
¡•_v
, 
pic_block_y
, 
cu¼MB
->
block_x
 + 
h
);

1749 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1750 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1751 
·¹ty³
 = 4;

1752 
by
 = 
by0
[
·¹ty³
][
block8x8
];

1753 
bx
 = 
bx0
[
·¹ty³
][
block8x8
];

1754 
¡•_h0
 = (
·¹_size
[ 
·¹ty³
][0]);

1755 
¡•_v0
 = (
·¹_size
[ 
·¹ty³
][1]);

1756 
¡•_h
 = (
·¹_size
[
blockty³
][0]);

1757 
¡•_v
 = (
·¹_size
[
blockty³
][1]);

1758 
li¡_off£t
 = 
cu¼MB
->list_offset;

1759 
numli¡s
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 2 : 1;

1760 
MÙiÚVeùÜ
 *
®l_mv
;

1761 
li¡
 = 
LIST_0
;

1762 
»f
 = 0;

1763 
MEBlock
 
mv_block
;

1764 
di¡blk
 *
m_co¡
;

1765 
di¡blk
 
mco¡
;

1766 
v
, 
h
;

1767 
pic_block_y
;

1770 
mv_block
.
‹¡8x8
 = 
p_IÅ
->
T¿nsfÜm8x8Mode
 && 
blockty³
 == 4;

1772 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
EPZS
)

1774 ià(
p_IÅ
->
EPZSSubP–Grid
)

1776 ià(
blockty³
 > 4)

1777 
cu¼MB
->
IÁP–ME
 = 
EPZS_š‹g”_subMB_mÙiÚ_e¡im©iÚ
;

1779 
cu¼MB
->
IÁP–ME
 = 
EPZS_š‹g”_mÙiÚ_e¡im©iÚ
;

1783 ià(
blockty³
 > 4)

1784 
cu¼MB
->
IÁP–ME
 = 
EPZS_subMB_mÙiÚ_e¡im©iÚ
;

1786 
cu¼MB
->
IÁP–ME
 = 
EPZS_mÙiÚ_e¡im©iÚ
;

1790 
	`š™_mv_block
(
cu¼MB
, &
mv_block
, (è
blockty³
, 
li¡
, (è
»f
, 
bx
, 
by
);

1792 ià(
blockty³
 == 4)

1793 
	`g‘_Üigš®_block
(
p_Vid
, &
mv_block
);

1796 
li¡
=0;†i¡<
numli¡s
;list++)

1798 
mv_block
.
li¡
 = ()†ist;

1799 
»f
=0;„eà< 
cu¼Sliû
->
li¡Xsize
[
li¡
+
li¡_off£t
];„ef++)

1801 
mv_block
.
»f_idx
 = (è
»f
;

1802 
m_co¡
 = &
p_Vid
->
mÙiÚ_co¡
[
blockty³
][
li¡
][
»f
][
block8x8
];

1804 
	`g‘_£¬ch_¿nge
(&
mv_block
, 
p_IÅ
, 
»f
, 
blockty³
);

1807 *
m_co¡
 = 0;

1810 
v
=
by
; v<by + 
¡•_v0
; v +ð
¡•_v
)

1812 
pic_block_y
 = 
cu¼MB
->
block_y
 + 
v
;

1814 
h
=
bx
; h<bx+
¡•_h0
; h+=
¡•_h
)

1816 
®l_mv
 = &
cu¼Sliû
->®l_mv[
li¡
][
»f
][
blockty³
][
v
][
h
];

1819 
	`upd©e_mv_block
(
cu¼MB
, &
mv_block
, 
h
, 
v
);

1822 
	`g‘_£¬ch_¿nge
(&
mv_block
, 
p_IÅ
, 
»f
, 
blockty³
);

1824 
mco¡
 = 
	`BlockMÙiÚS—rch
 (
cu¼MB
, &
mv_block
, 
h
<<2, 
v
<<2, 
Ïmbda_çùÜ
);

1826 *
m_co¡
 +ð
mco¡
;

1829 
	`£t_me_·¿m‘”s
(
mÙiÚ
, 
®l_mv
, 
li¡
, (è
»f
, 
¡•_h
, 
¡•_v
, 
pic_block_y
, 
cu¼MB
->
block_x
 + 
h
);

1833 ià((
p_IÅ
->
T¿nsfÜm8x8Mode
 =ð1è&&…_IÅ->
RDOQ_CP_MV
 && (
blockty³
 == 4))

1835 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

1837 
cu¼Sliû
->
tmp_mv8
[
li¡
][
»f
][
by
][
bx
] = cu¼Sliû->
®l_mv
[li¡][»f][
blockty³
][by][bx];

1838 
cu¼Sliû
->
mÙiÚ_co¡8
[
li¡
][
»f
][
block8x8
] = *
m_co¡
;

1842 
cu¼Sliû
->
tmp_mv4
[
li¡
][
»f
][
by
][
bx
] = cu¼Sliû->
®l_mv
[li¡][»f][
blockty³
][by][bx];

1843 
cu¼Sliû
->
mÙiÚ_co¡4
[
li¡
][
»f
][
block8x8
] = *
m_co¡
;

1850 
	`ä“_mv_block
(&
mv_block
);

1853 #ià
GET_METIME


1854 
	`g‘time
(&
me_time_’d
);

1855 
me_tmp_time
 = 
	`timediff
 (&
me_time_¡¬t
, &
me_time_’d
);

1856 
p_Vid
->
me_tÙ_time
 +ð
me_tmp_time
;

1857 
p_Vid
->
me_time
 +ð
me_tmp_time
;

1859 
	}
}

	@lencod/src/nal.c

18 
	~"cÚŒibutÜs.h
"

19 
	~"glob®.h
"

20 
	~"’c_¡©i¡ics.h
"

21 
	~"bŸr›ncode.h
"

22 
	~"Çl.h
"

24 cÚ¡ 
	gMbWidthC
 [4]= { 0, 8, 8, 16};

25 cÚ¡ 
	gMbHeightC
 [4]= { 0, 8, 16, 16};

40 
	$SODBtoRBSP
(
B™¡»am
 *
cu¼SŒ—m
)

42 
cu¼SŒ—m
->
by‹_buf
 <<= 1;

43 
cu¼SŒ—m
->
by‹_buf
 |= 1;

44 
cu¼SŒ—m
->
b™s_to_go
--;

45 
cu¼SŒ—m
->
by‹_buf
 <<ðcu¼SŒ—m->
b™s_to_go
;

46 
cu¼SŒ—m
->
¡»amBufãr
[cu¼SŒ—m->
by‹_pos
++] = cu¼SŒ—m->
by‹_buf
;

47 
cu¼SŒ—m
->
b™s_to_go
 = 8;

48 
cu¼SŒ—m
->
by‹_buf
 = 0;

49 
	}
}

74 
	$RBSPtoEBSP
(
by‹
 *
N®uBufãr
, *
rb¥
, 
rb¥_size
)

76 
j
 = 0;

77 
couÁ
 = 0;

78 
i
;

80 
i
 = 0; i < 
rb¥_size
; i++)

82 if(
couÁ
 =ð
ZEROBYTES_SHORTSTARTCODE
 && !(
rb¥
[
i
] & 0xFC))

84 
N®uBufãr
[
j
] = 0x03;

85 
j
++;

86 
couÁ
 = 0;

88 
N®uBufãr
[
j
] = 
rb¥
[
i
];

89 if(
rb¥
[
i
] == 0x00)

90 
couÁ
++;

92 
couÁ
 = 0;

93 
j
++;

96  
j
;

97 
	}
}

116 
	$addCabacZ”oWÜds
(
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
Çlu
, 
StP¬am‘”s
 *
cur_¡©s
)

118 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

120 
¡uffšg_by‹s
 = 0;

121 
i
 = 0;

123 
by‹
 *
buf
 = &
Çlu
->buf[Çlu->
Ën
];

125 
RawMbB™s
 = 256 * 
p_Vid
->
b™d•th_luma
 + 2 * 
MbWidthC
[
aùive_¥s
->
chroma_fÜm©_idc
] * 
MbHeightC
[aùive_¥s->chroma_fÜm©_idc] *…_Vid->
b™d•th_chroma
;

126 
mš_num_by‹s
 = ((96 * 
	`g‘_pic_bš_couÁ
(
p_Vid
)è- (
RawMbB™s
 * (í_Vid->
PicSizeInMbs
 *3) + 1023) / 1024;

128 ià(
mš_num_by‹s
 > 
p_Vid
->
by‹s_š_piùu»
)

130 
¡uffšg_by‹s
 = 
mš_num_by‹s
 - 
p_Vid
->
by‹s_š_piùu»
;

131 
	`´štf
 ("In£¹šg %d/%d cabac_z”o_wÜd syÁaxƒËm’ts/by‹ (CÏu£ 7.4.2.10)\n", ((
¡uffšg_by‹s
 + 2)/3), stuffing_bytes);

133 
i
 = 0; i < 
¡uffšg_by‹s
; i+=3 )

135 *
buf
++ = 0x00;

136 *
buf
++ = 0x00;

137 *
buf
++ = 0x03;

139 
cur_¡©s
->
b™_u£_¡uffšg_b™s
[
p_Vid
->
ty³
] +ð(
i
<<3);

140 
Çlu
->
Ën
 +ð
i
;

143  
i
;

144 
	}
}

	@lencod/src/nalu.c

15 
	~"glob®.h
"

16 
	~"Çlu.h
"

17 
	~"Çl.h
"

44 
	$RBSPtoNALU
 (*
rb¥
, 
NALU_t
 *
Çlu
, 
rb¥_size
, 
Çl_un™_ty³
, 
Çl_»ã»nû_idc
, 
U£AÂexbLÚgS¹code
)

46 
Ën
;

48 
	`as£¹
 (
Çlu
 !ð
NULL
);

49 
	`as£¹
 (
Çl_»ã»nû_idc
 <=3 &&‚al_reference_idc >=0);

50 #ià(
MVC_EXTENSION_ENABLE
)

51 
	`as£¹
 (
Çl_un™_ty³
 > 0 &&‚®_un™_ty³ <ð
NALU_TYPE_SLC_EXT
);

53 
	`as£¹
 (
Çl_un™_ty³
 > 0 &&‚®_un™_ty³ <ð
NALU_TYPE_FILL
);

55 
	`as£¹
 (
rb¥_size
 < 
MAXRBSPSIZE
);

57 
Çlu
->
¡¬tcod•»fix_Ën
 = 
U£AÂexbLÚgS¹code
 ? 4 : 3;

58 
Çlu
->
fÜbidd’_b™
 = 0;

59 
Çlu
->
Çl_»ã»nû_idc
 = (
N®RefIdc
)‚al_reference_idc;

60 
Çlu
->
Çl_un™_ty³
 = (
N®uTy³
)‚al_unit_type;

62 #ià(
MVC_EXTENSION_ENABLE
)

63 if(
Çl_un™_ty³
==
NALU_TYPE_PREFIX
 ||‚®_un™_ty³==
NALU_TYPE_SLC_EXT
)

65 
Çlu
->
svc_ex‹nsiÚ_æag
 = 0;

67 
Çlu
->
»£rved_Úe_b™
 = 1;

71 
Çlu
->
svc_ex‹nsiÚ_æag
 = 0;

75 
Ën
 = 
	`RBSPtoEBSP
 (
Çlu
->
buf
, 
rb¥
, 
rb¥_size
);

76 
Çlu
->
Ën
 =†en;

78  
Ën
;

79 
	}
}

88 
	$Wr™e_AUD_NALU
Ð
VideoP¬am‘”s
 *
p_Vid
 )

90 
RBSPËn
 = 0;

91 
Ën
;

92 
by‹
 
rb¥
[
MAXRBSPSIZE
];

93 
NALU_t
 *
Çlu
 = 
	`AÎocNALU
Ð
MAXNALUSIZE
 );

95  
p_Vid
->
ty³
 )

97 
I_SLICE
:

98 
p_Vid
->
´im¬y_pic_ty³
 = 0;

100 
P_SLICE
:

101 
p_Vid
->
´im¬y_pic_ty³
 = 1;

103 
B_SLICE
:

104 
p_Vid
->
´im¬y_pic_ty³
 = 2;

107 
RBSPËn
 = 1;

108 
rb¥
[0] = (
by‹
è(
p_Vid
->
´im¬y_pic_ty³
 << 5);

109 
rb¥
[0] |= (1 << 4);

112 
	`RBSPtoNALU
Ð
rb¥
, 
Çlu
, 
RBSPËn
, 
NALU_TYPE_AUD
, 
NALU_PRIORITY_DISPOSABLE
, 1 );

114 
Ën
 = 
p_Vid
->
	`Wr™eNALU
Ðp_Vid, 
Çlu
,…_Vid->
f_out
 );

116 
	`F»eNALU
Ð
Çlu
 );

118  
Ën
;

119 
	}
}

128 
	$Wr™e_FžËr_D©a_NALU
Ð
VideoP¬am‘”s
 *
p_Vid
, 
num_by‹s
 )

130 
RBSPËn
 = 
num_by‹s
 - 1;

131 
Ën
, 
by‹s_wr™‹n
 = 0;

132 
by‹
 
rb¥
[
MAXRBSPSIZE
];

133 
by‹
 
fžËr_by‹
 = (byte)0xFF;

134 
by‹
 
Œažšg_by‹
 = (byte)0x80;

135 
NALU_t
 *
Çlu
 = 
	`AÎocNALU
Ð
MAXNALUSIZE
 );

137 
num_by‹s
 = 
	`iCl3
Ð1, (
MAXRBSPSIZE
 - 2),‚um_bytes );

138 
	`as£¹
Ð
num_by‹s
 > 0 &&‚um_by‹ < (
MAXRBSPSIZE
 - 1) );

140 
num_by‹s
 = 
	`imax
( 2,‚um_bytes );

142 iàÐ
RBSPËn
 > 1 )

144  
by‹s_wr™‹n
 < (
RBSPËn
 - 1) )

146 
rb¥
[ 
by‹s_wr™‹n
++ ] = 
fžËr_by‹
;

149 
rb¥
[ 
by‹s_wr™‹n
++ ] = 
Œažšg_by‹
;

150 
	`as£¹
Ð
num_by‹s
 =ð(
by‹s_wr™‹n
 + 1) );

153 
	`RBSPtoNALU
Ð
rb¥
, 
Çlu
, 
RBSPËn
, 
NALU_TYPE_FILL
, 
NALU_PRIORITY_DISPOSABLE
, 1 );

155 
Ën
 = 
p_Vid
->
	`Wr™eNALU
Ðp_Vid, 
Çlu
,…_Vid->
f_out
 );

156 
p_Vid
->
by‹s_š_piùu»
 +ð(
Çlu
->
Ën
 + 1);

158 
	`F»eNALU
Ð
Çlu
 );

160  
Ën
;

161 
	}
}

	@lencod/src/output.c

15 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"šput.h
"

19 
	~"ouut.h
"

45 
	$img2buf
 (
img³l
** 
imgX
, * 
buf
, 
size_x
, 
size_y
, 
symbÞ_size_š_by‹s
, 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
)

47 
i
,
j
;

49 
twidth
 = 
size_x
 - 
üÝ_Ëá
 - 
üÝ_right
;

50 
theight
 = 
size_y
 - 
üÝ_tÝ
 - 
üÝ_bÙtom
;

51 
size
 = 0;

52 
ui8
;

53 
ušt16
 
tmp16
, 
ui16
;

54 
tmp32
, 
ui32
;

56 ià(Ð(è=ð (
img³l
)è&& ( (è=ð
symbÞ_size_š_by‹s
))

59 ià(
üÝ_Ëá
 =ð0 && 
üÝ_tÝ
 =ð0 && 
üÝ_right
 =ð0 && 
üÝ_bÙtom
 == 0)

62 
j
=0; j<
theight
; j++)

63 
	`memýy
(
buf
+
j
*
twidth
, 
imgX
[j],width);

67 
i
=0;i<
theight
;i++)

69 
	`memýy
(
buf
 + (
i
*
twidth
), &(
imgX
[˜+ 
üÝ_tÝ
][
üÝ_Ëá
]),width);

75 ià(
	`‹¡EndŸn
())

78 
symbÞ_size_š_by‹s
)

82 
i
=
üÝ_tÝ
;i<
size_y
-
üÝ_bÙtom
;i++)

83 
j
=
üÝ_Ëá
;j<
size_x
-
üÝ_right
;j++)

85 
ui8
 = (è(
imgX
[
i
][
j
]);

86 
buf
[(
j
-
üÝ_Ëá
+((
i
-
üÝ_tÝ
)*(
twidth
)))] = 
ui8
;

92 
i
=
üÝ_tÝ
;i<
size_y
-
üÝ_bÙtom
;i++)

93 
j
=
üÝ_Ëá
;j<
size_x
-
üÝ_right
;j++)

95 
tmp16
 = (
ušt16
è(
imgX
[
i
][
j
]);

96 
ui16
 = (
tmp16
 >> 8) | ((tmp16&0xFF)<<8);

97 
	`memýy
(
buf
+((
j
-
üÝ_Ëá
+((
i
-
üÝ_tÝ
)*(
twidth
)))*2),&(
ui16
), 2);

103 
i
=
üÝ_tÝ
;i<
size_y
-
üÝ_bÙtom
;i++)

104 
j
=
üÝ_Ëá
;j<
size_x
-
üÝ_right
;j++)

106 
tmp32
 = (è(
imgX
[
i
][
j
]);

107 
ui32
 = ((
tmp32
&0xFF00)<<8) | ((tmp32&0xFF)<<24) | ((tmp32&0xFF0000)>>8) | ((tmp32&0xFF000000)>>24);

108 
	`memýy
(
buf
+((
j
-
üÝ_Ëá
+((
i
-
üÝ_tÝ
)*(
twidth
)))*4),&(
ui32
), 4);

114 
	`”rÜ
 ("writing onlyo formats of 8, 16 or 32 bit‡llowed on bigƒndian‡rchitecture", 500);

123 ià( (
img³l
è< 
symbÞ_size_š_by‹s
)

126 
size
 =  (
img³l
);

128 
	`mem£t
 (
buf
, 0, (
twidth
*
theight
*
symbÞ_size_š_by‹s
));

132 
size
 = 
symbÞ_size_š_by‹s
;

135 
i
=
üÝ_tÝ
;i<
size_y
-
üÝ_bÙtom
;i++)

137 
i_pos
 = (
i
-
üÝ_tÝ
)*(
twidth
è- 
üÝ_Ëá
;

138 
j
=
üÝ_Ëá
;j<
size_x
-
üÝ_right
;j++)

140 
	`memýy
(
buf
+((
j
 + 
i_pos
)*
symbÞ_size_š_by‹s
),&(
imgX
[
i
][j]), 
size
);

145 
	}
}

159 
	$wr™e_piùu»
(
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

161 
	`wr™e_out_piùu»
(
p
, 
ouut
, 
p_out
);

162 
	}
}

176 
	$wr™e_out_piùu»
(
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

178 
SubWidthC
 [4]= { 1, 2, 2, 1};

179 
SubHeightC
 [4]= { 1, 2, 1, 1};

181 
»t
;

183 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
;

184 
symbÞ_size_š_by‹s
 = 
ouut
->
pic_un™_size_shiá3
;

185 
BoÞ—n
 
rgb_ouut
 = (BoÞ—nè(
ouut
->
cÞÜ_mod–
 !ð
CM_YUV
 && ouut->
yuv_fÜm©
 =ð
YUV444
);

186 *
buf
;

188 ià(
p
->
nÚ_exi¡šg
)

191 ià(
p_out
 == -1)

194 ià(
p
->
äame_üÝpšg_æag
)

196 
üÝ_Ëá
 = 
SubWidthC
[
p
->
chroma_fÜm©_idc
] *…->
äame_üÝ_Ëá_off£t
;

197 
üÝ_right
 = 
SubWidthC
[
p
->
chroma_fÜm©_idc
] *…->
äame_üÝ_right_off£t
;

198 
üÝ_tÝ
 = 
SubHeightC
[
p
->
chroma_fÜm©_idc
]*Ð2 -…->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_tÝ_off£t
;

199 
üÝ_bÙtom
 = 
SubHeightC
[
p
->
chroma_fÜm©_idc
]*Ð2 -…->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_bÙtom_off£t
;

203 
üÝ_Ëá
 = 
üÝ_right
 = 
üÝ_tÝ
 = 
üÝ_bÙtom
 = 0;

209 
buf
 = 
	`m®loc
 (
p
->
size_x
 *…->
size_y
 * 
symbÞ_size_š_by‹s
);

210 ià(
NULL
==
buf
)

212 
	`no_mem_ex™
("write_out_picture: buf");

215 if(
rgb_ouut
)

217 
üÝ_Ëá
 = 
p
->
äame_üÝ_Ëá_off£t
;

218 
üÝ_right
 = 
p
->
äame_üÝ_right_off£t
;

219 
üÝ_tÝ
 = ( 2 - 
p
->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_tÝ_off£t
;

220 
üÝ_bÙtom
 = ( 2 - 
p
->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_bÙtom_off£t
;

222 
	`img2buf
 (
p
->
imgUV
[1], 
buf
,…->
size_x_ü
,…->
size_y_ü
, 
symbÞ_size_š_by‹s
, 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
);

223 
»t
 = 
	`wr™e
(
p_out
, 
buf
, (
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
);

224 ià(
»t
 !ð((
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
))

226 
	`”rÜ
 ("write_out_picture:ƒrror writingo RGB output file.", 500);

229 ià(
p
->
äame_üÝpšg_æag
)

231 
üÝ_Ëá
 = 
SubWidthC
[
p
->
chroma_fÜm©_idc
] *…->
äame_üÝ_Ëá_off£t
;

232 
üÝ_right
 = 
SubWidthC
[
p
->
chroma_fÜm©_idc
] *…->
äame_üÝ_right_off£t
;

233 
üÝ_tÝ
 = 
SubHeightC
[
p
->
chroma_fÜm©_idc
]*Ð2 -…->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_tÝ_off£t
;

234 
üÝ_bÙtom
 = 
SubHeightC
[
p
->
chroma_fÜm©_idc
]*Ð2 -…->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_bÙtom_off£t
;

238 
üÝ_Ëá
 = 
üÝ_right
 = 
üÝ_tÝ
 = 
üÝ_bÙtom
 = 0;

242 
	`img2buf
 (
p
->
imgY
, 
buf
,…->
size_x
,…->
size_y
, 
symbÞ_size_š_by‹s
, 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
);

243 
»t
 = 
	`wr™e
(
p_out
, 
buf
, (
p
->
size_y
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
);

244 ià(
»t
 !ð((
p
->
size_y
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
))

246 
	`”rÜ
 ("write_out_picture:ƒrror writingo YUV output file.", 500);

249 ià(
p
->
chroma_fÜm©_idc
 !ð
YUV400
)

251 
üÝ_Ëá
 = 
p
->
äame_üÝ_Ëá_off£t
;

252 
üÝ_right
 = 
p
->
äame_üÝ_right_off£t
;

253 
üÝ_tÝ
 = ( 2 - 
p
->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_tÝ_off£t
;

254 
üÝ_bÙtom
 = ( 2 - 
p
->
äame_mbs_Úly_æag
 ) *…->
äame_üÝ_bÙtom_off£t
;

256 
	`img2buf
 (
p
->
imgUV
[0], 
buf
,…->
size_x_ü
,…->
size_y_ü
, 
symbÞ_size_š_by‹s
, 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
);

257 
»t
 = 
	`wr™e
(
p_out
, 
buf
, (
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)* 
symbÞ_size_š_by‹s
);

258 ià(
»t
 !ð((
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)* 
symbÞ_size_š_by‹s
))

260 
	`”rÜ
 ("write_out_picture:ƒrror writingo YUV output file.", 500);

263 ià(!
rgb_ouut
)

265 
	`img2buf
 (
p
->
imgUV
[1], 
buf
,…->
size_x_ü
,…->
size_y_ü
, 
symbÞ_size_š_by‹s
, 
üÝ_Ëá
, 
üÝ_right
, 
üÝ_tÝ
, 
üÝ_bÙtom
);

266 
»t
 = 
	`wr™e
(
p_out
, 
buf
, (
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
);

267 ià(
»t
 !ð((
p
->
size_y_ü
-
üÝ_bÙtom
-
üÝ_tÝ
)*Õ->
size_x_ü
-
üÝ_right
-
üÝ_Ëá
)*
symbÞ_size_š_by‹s
))

269 
	`”rÜ
 ("write_out_picture:ƒrror writingo YUV output file.", 500);

274 
	`ä“
(
buf
);

277 
	}
}

285 
	$š™_out_bufãr
(
VideoP¬am‘”s
 *
p_Vid
)

287 
p_Vid
->
out_bufãr
 = 
	`®loc_äame_¡Üe
();

288 
	}
}

296 
	$unš™_out_bufãr
(
VideoP¬am‘”s
 *
p_Vid
)

298 
	`ä“_äame_¡Üe
(
p_Vid
,…_Vid->
out_bufãr
);

299 
p_Vid
->
out_bufãr
=
NULL
;

300 
	}
}

308 
	$þ—r_piùu»
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p
)

310 
i
;

312 ià(
p_Vid
->
b™d•th_luma
 == 8)

316 
i
=0;i<
p
->
size_y
;i++)

317 
	`mem£t
(
p
->
imgY
[
i
], 
p_Vid
->
dc_´ed_v®ue_comp
[0],…->
size_x
*(
img³l
));

321 
j
;

322 
i
=0;˜< 
p
->
size_y
; i++)

323 
j
=0;j < 
p
->
size_x
; j++)

324 
p
->
imgY
[
i
][
j
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue_comp
[0];

327 ià(
p_Vid
->
b™d•th_chroma
 == 8)

329 
i
=0;i<
p
->
size_y_ü
;i++)

330 
	`mem£t
(
p
->
imgUV
[0][
i
], 
p_Vid
->
dc_´ed_v®ue_comp
[1],…->
size_x_ü
*(
img³l
));

331 
i
=0;i<
p
->
size_y_ü
;i++)

332 
	`mem£t
(
p
->
imgUV
[1][
i
], 
p_Vid
->
dc_´ed_v®ue_comp
[2],…->
size_x_ü
*(
img³l
));

336 
k
, 
j
;

337 
k
 = 0; k < 2; k++)

339 
i
=0;i<
p
->
size_y_ü
;i++)

340 
j
=0;j < 
p
->
size_x_ü
; j++)

341 
p
->
imgUV
[
k
][
i
][
j
] = (
img³l
è
p_Vid
->
dc_´ed_v®ue_comp
[1];

344 
	}
}

361 
	$wr™e_uÅaœed_f›ld
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
* 
fs
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

363 
StÜabËPiùu»
 *
p
;

364 
	`as£¹
 (
fs
->
is_u£d
<3);

365 if(
fs
->
is_u£d
 &1)

369 
p
 = 
fs
->
tÝ_f›ld
;

370 
fs
->
bÙtom_f›ld
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, 
BOTTOM_FIELD
, 
p
->
size_x
,…->
size_y
,…->
size_x_ü
,…->
size_y_ü
);

371 
fs
->
bÙtom_f›ld
->
chroma_fÜm©_idc
 = 
p
->chroma_format_idc;

372 
fs
->
bÙtom_f›ld
->
chroma_mask_mv_x
 = 
p
->chroma_mask_mv_x;

373 
fs
->
bÙtom_f›ld
->
chroma_mask_mv_y
 = 
p
->chroma_mask_mv_y;

374 
fs
->
bÙtom_f›ld
->
chroma_shiá_x
 = 
p
->chroma_shift_x;

375 
fs
->
bÙtom_f›ld
->
chroma_shiá_y
 = 
p
->chroma_shift_y;

377 
	`þ—r_piùu»
(
p_Vid
, 
fs
->
bÙtom_f›ld
);

378 
	`dpb_combše_f›ld_yuv
(
p_Vid
, 
fs
);

379 
	`wr™e_piùu»
 (
fs
->
äame
, 
ouut
, 
p_out
);

382 if(
fs
->
is_u£d
 &2)

386 
p
 = 
fs
->
bÙtom_f›ld
;

387 
fs
->
tÝ_f›ld
 = 
	`®loc_¡ÜabË_piùu»
(
p_Vid
, 
TOP_FIELD
, 
p
->
size_x
,…->
size_y
,…->
size_x_ü
,…->
size_y_ü
);

388 
	`þ—r_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

389 
fs
->
tÝ_f›ld
->
chroma_fÜm©_idc
 = 
p
->chroma_format_idc;

390 
fs
->
tÝ_f›ld
->
chroma_mask_mv_x
 = 
p
->chroma_mask_mv_x;

391 
fs
->
tÝ_f›ld
->
chroma_mask_mv_y
 = 
p
->chroma_mask_mv_y;

392 
fs
->
tÝ_f›ld
->
chroma_shiá_x
 = 
p
->chroma_shift_x;

393 
fs
->
tÝ_f›ld
->
chroma_shiá_y
 = 
p
->chroma_shift_y;

395 
	`þ—r_piùu»
(
p_Vid
, 
fs
->
tÝ_f›ld
);

396 
fs
 ->
tÝ_f›ld
->
äame_üÝpšg_æag
 = fs->
bÙtom_f›ld
->frame_cropping_flag;

397 if(
fs
 ->
tÝ_f›ld
->
äame_üÝpšg_æag
)

399 
fs
 ->
tÝ_f›ld
->
äame_üÝ_tÝ_off£t
 = fs->
bÙtom_f›ld
->frame_crop_top_offset;

400 
fs
 ->
tÝ_f›ld
->
äame_üÝ_bÙtom_off£t
 = fs->
bÙtom_f›ld
->frame_crop_bottom_offset;

401 
fs
 ->
tÝ_f›ld
->
äame_üÝ_Ëá_off£t
 = fs->
bÙtom_f›ld
->frame_crop_left_offset;

402 
fs
 ->
tÝ_f›ld
->
äame_üÝ_right_off£t
 = fs->
bÙtom_f›ld
->frame_crop_right_offset;

404 
	`dpb_combše_f›ld_yuv
(
p_Vid
, 
fs
);

405 
	`wr™e_piùu»
 (
fs
->
äame
, 
ouut
, 
p_out
);

408 
fs
->
is_u£d
=3;

409 
	}
}

423 
	$æush_dœeù_ouut
(
VideoP¬am‘”s
 *
p_Vid
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

425 
	`wr™e_uÅaœed_f›ld
(
p_Vid
,…_Vid->
out_bufãr
, 
ouut
, 
p_out
);

427 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
äame
);

428 
p_Vid
->
out_bufãr
->
äame
 = 
NULL
;

429 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
tÝ_f›ld
);

430 
p_Vid
->
out_bufãr
->
tÝ_f›ld
 = 
NULL
;

431 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
bÙtom_f›ld
);

432 
p_Vid
->
out_bufãr
->
bÙtom_f›ld
 = 
NULL
;

433 
p_Vid
->
out_bufãr
->
is_u£d
 = 0;

434 
	}
}

451 
	$wr™e_¡Üed_äame
Ð
VideoP¬am‘”s
 *
p_Vid
, 
F¿meStÜe
 *
fs
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

454 
	`æush_dœeù_ouut
(
p_Vid
, 
ouut
, 
p_out
);

456 ià(
fs
->
is_u£d
<3)

458 
	`wr™e_uÅaœed_f›ld
(
p_Vid
, 
fs
, 
ouut
, 
p_out
);

462 
	`wr™e_piùu»
(
fs
->
äame
, 
ouut
, 
p_out
);

465 
fs
->
is_ouut
 = 1;

466 
	}
}

484 
	$dœeù_ouut
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

486  
p
->
¡ruùu»
 )

488 
FRAME
:

491 
	`æush_dœeù_ouut
(
p_Vid
, 
ouut
, 
p_out
);

492 
	`wr™e_piùu»
 (
p
, 
ouut
, 
p_out
);

493 
	`ä“_¡ÜabË_piùu»
(
p_Vid
, 
p
);

496 
TOP_FIELD
:

497 ià(
p_Vid
->
out_bufãr
->
is_u£d
 &1)

498 
	`æush_dœeù_ouut
(
p_Vid
, 
ouut
, 
p_out
);

499 
p_Vid
->
out_bufãr
->
tÝ_f›ld
 = 
p
;

500 
p_Vid
->
out_bufãr
->
is_u£d
 |= 1;

502 
BOTTOM_FIELD
:

503 ià(
p_Vid
->
out_bufãr
->
is_u£d
 &2)

504 
	`æush_dœeù_ouut
(
p_Vid
, 
ouut
, 
p_out
);

505 
p_Vid
->
out_bufãr
->
bÙtom_f›ld
 = 
p
;

506 
p_Vid
->
out_bufãr
->
is_u£d
 |= 2;

509 
	`´štf
("invalid…ictureype\n");

513 ià(
p_Vid
->
out_bufãr
->
is_u£d
 == 3)

516 
	`dpb_combše_f›ld_yuv
(
p_Vid
,…_Vid->
out_bufãr
);

517 
	`wr™e_piùu»
 (
p_Vid
->
out_bufãr
->
äame
, 
ouut
, 
p_out
);

518 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
äame
);

519 
p_Vid
->
out_bufãr
->
äame
 = 
NULL
;

520 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
tÝ_f›ld
);

521 
p_Vid
->
out_bufãr
->
tÝ_f›ld
 = 
NULL
;

522 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
bÙtom_f›ld
);

523 
p_Vid
->
out_bufãr
->
bÙtom_f›ld
 = 
NULL
;

524 
p_Vid
->
out_bufãr
->
is_u£d
 = 0;

526 
	}
}

544 
	$dœeù_ouut_·ff
(
VideoP¬am‘”s
 *
p_Vid
, 
StÜabËPiùu»
 *
p
, 
F¿meFÜm©
 *
ouut
, 
p_out
)

546 
	`´štf
("Warning!!! Frame can't fit in DPB. Displayed out of sequence.\n");

547 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
äame
);

548 
p_Vid
->
out_bufãr
->
äame
 = 
NULL
;

549 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
tÝ_f›ld
);

550 
p_Vid
->
out_bufãr
->
tÝ_f›ld
 = 
NULL
;

551 
	`ä“_¡ÜabË_piùu»
(
p_Vid
,…_Vid->
out_bufãr
->
bÙtom_f›ld
);

552 
p_Vid
->
out_bufãr
->
bÙtom_f›ld
 = 
NULL
;

553 
p_Vid
->
out_bufãr
->
is_u£d
 = 0;

555 
	`dœeù_ouut
(
p_Vid
, 
p
, 
ouut
, 
p_out
);

556 
	}
}

	@lencod/src/parset.c

15 
	~<time.h
>

16 
	~<lim™s.h
>

18 
	~"glob®.h
"

20 
	~"cÚŒibutÜs.h
"

21 
	~"Çl.h
"

22 
	~"mbufãr.h
"

23 
	~"·r£t.h
"

24 
	~"vlc.h
"

25 
	~"q_m©rix.h
"

28 
id’tify_´ofže
(
IÅutP¬am‘”s
 *
p_IÅ
);

29 
id’tify_Ëv–
(
IÅutP¬am‘”s
 *
p_IÅ
);

30 
G’”©eVUI_·¿m‘”s_rb¥
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
B™¡»am
 *
b™¡»am
);

32 cÚ¡ 
by‹
 
	gZZ_SCAN
[16] =

37 cÚ¡ 
by‹
 
	gZZ_SCAN8
[64] =

56 
	$g’”©e_·¿m‘”_£ts
 (
VideoP¬am‘”s
 *
p_Vid
)

58 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

59 
i
;

60 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
 = 
NULL
;

62 
¥s
 = 
	`AÎocSPS
();

64 
i
=0; i<
MAXPPS
; i++)

66 
p_Vid
->
PicP¬S‘
[
i
] = 
NULL
;

69 
	`G’”©eSequ’ûP¬am‘”S‘
(
¥s
, 
p_Vid
, 0);

71 ià(
p_IÅ
->
G’”©eMuÉËPPS
)

73 
p_Vid
->
PicP¬S‘
[0] = 
	`AÎocPPS
();

74 
p_Vid
->
PicP¬S‘
[1] = 
	`AÎocPPS
();

75 
p_Vid
->
PicP¬S‘
[2] = 
	`AÎocPPS
();

77 ià(
	`is_FREXT_´ofže
(
¥s
->
´ofže_idc
))

79 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[0], 
¥s
,…_Vid, 
p_IÅ
, 0, 0, 0,…_IÅ->
cb_qp_šdex_off£t
,…_IÅ->
ü_qp_šdex_off£t
);

80 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[1], 
¥s
,…_Vid, 
p_IÅ
, 1, 1, 1,…_IÅ->
cb_qp_šdex_off£t
,…_IÅ->
ü_qp_šdex_off£t
);

81 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[2], 
¥s
,…_Vid, 
p_IÅ
, 2, 1, 2,…_IÅ->
cb_qp_šdex_off£t
,…_IÅ->
ü_qp_šdex_off£t
);

85 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[0], 
¥s
,…_Vid, 
p_IÅ
, 0, 0, 0,…_IÅ->
chroma_qp_šdex_off£t
, 0);

86 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[1], 
¥s
,…_Vid, 
p_IÅ
, 1, 1, 1,…_IÅ->
chroma_qp_šdex_off£t
, 0);

87 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[2], 
¥s
,…_Vid, 
p_IÅ
, 2, 1, 2,…_IÅ->
chroma_qp_šdex_off£t
, 0);

92 
p_Vid
->
PicP¬S‘
[0] = 
	`AÎocPPS
();

93 ià(
	`is_FREXT_´ofže
(
¥s
->
´ofže_idc
))

94 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[0], 
¥s
,…_Vid, 
p_IÅ
, 0,…_IÅ->
Weigh‹dP»diùiÚ
,…_IÅ->
Weigh‹dB»diùiÚ
,

95 
p_IÅ
->
cb_qp_šdex_off£t
,…_IÅ->
ü_qp_šdex_off£t
);

97 
	`G’”©ePiùu»P¬am‘”S‘
Ð
p_Vid
->
PicP¬S‘
[0], 
¥s
,…_Vid, 
p_IÅ
, 0,…_IÅ->
Weigh‹dP»diùiÚ
,…_IÅ->
Weigh‹dB»diùiÚ
,

98 
p_IÅ
->
chroma_qp_šdex_off£t
, 0);

101 
p_Vid
->
aùive_¥s
 = 
¥s
;

102 
p_Vid
->
aùive_µs
 =…_Vid->
PicP¬S‘
[0];

104 
p_Vid
->
¥s
[0] = sps;

105 if(
p_Vid
->
num_of_Ïy”s
 == 2)

107 
p_Vid
->
¥s
[1] = 
	`AÎocSPS
();

108 *(
p_Vid
->
¥s
[1]) = *sps;

111 
p_Vid
->
¥s
[1] = 
NULL
;

112 
	}
}

124 
	$F»eP¬am‘”S‘s
 (
VideoP¬am‘”s
 *
p_Vid
)

126 
i
;

127 
i
=0; i<
MAXPPS
; i++)

129 iàÐ
NULL
 !ð
p_Vid
->
PicP¬S‘
[
i
])

131 
	`F»ePPS
(
p_Vid
->
PicP¬S‘
[
i
]);

132 
p_Vid
->
PicP¬S‘
[
i
] = 
NULL
;

135 
i
=0; i<
p_Vid
->
num_of_Ïy”s
; i++)

136 if(
p_Vid
->
¥s
[
i
])

138 
	`F»eSPS
(
p_Vid
->
¥s
[
i
]);

139 
p_Vid
->
¥s
[
i
] = 
NULL
;

141 
p_Vid
->
aùive_¥s
 = 
NULL
;

142 
	}
}

160 
NALU_t
 *
	$G’”©eSeq_·¿m‘”_£t_NALU
 (
VideoP¬am‘”s
 *
p_Vid
)

162 
NALU_t
 *
n
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

163 
RBSPËn
 = 0;

164 
by‹
 
rb¥
[
MAXRBSPSIZE
];

166 #ià(
MVC_EXTENSION_ENABLE
)

167 
RBSPËn
 = 
	`G’”©eSeq_·¿m‘”_£t_rb¥
 (
p_Vid
,…_Vid->
¥s
[0] , 
rb¥
, 0);

169 
RBSPËn
 = 
	`G’”©eSeq_·¿m‘”_£t_rb¥
 (
p_Vid
,…_Vid->
aùive_¥s
, 
rb¥
);

171 
	`RBSPtoNALU
 (
rb¥
, 
n
, 
RBSPËn
, 
NALU_TYPE_SPS
, 
NALU_PRIORITY_HIGHEST
, 1);

172 
n
->
¡¬tcod•»fix_Ën
 = 4;

174  
n
;

175 
	}
}

177 #ià(
MVC_EXTENSION_ENABLE
)

194 
NALU_t
 *
	$G’”©eSub£tSeq_·¿m‘”_£t_NALU
 (
VideoP¬am‘”s
 *
p_Vid
)

196 
NALU_t
 *
n
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

197 
RBSPËn
 = 0;

198 
by‹
 
rb¥
[
MAXRBSPSIZE
];

200 
RBSPËn
 = 
	`G’”©eSeq_·¿m‘”_£t_rb¥
 (
p_Vid
,…_Vid->
¥s
[1] , 
rb¥
, 1);

201 
	`RBSPtoNALU
 (
rb¥
, 
n
, 
RBSPËn
, 
NALU_TYPE_SUB_SPS
, 
NALU_PRIORITY_HIGHEST
, 1);

202 
n
->
¡¬tcod•»fix_Ën
 = 4;

204  
n
;

205 
	}
}

223 
NALU_t
 *
	$G’”©ePic_·¿m‘”_£t_NALU
(
VideoP¬am‘”s
 *
p_Vid
, 
PPS_id
)

225 
NALU_t
 *
n
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

226 
RBSPËn
 = 0;

227 
by‹
 
rb¥
[
MAXRBSPSIZE
];

229 
RBSPËn
 = 
	`G’”©ePic_·¿m‘”_£t_rb¥
 (
p_Vid
,…_Vid->
PicP¬S‘
[
PPS_id
], 
rb¥
);

230 
	`RBSPtoNALU
 (
rb¥
, 
n
, 
RBSPËn
, 
NALU_TYPE_PPS
, 
NALU_PRIORITY_HIGHEST
, 1);

231 
n
->
¡¬tcod•»fix_Ën
 = 4;

233  
n
;

234 
	}
}

257 
	$G’”©eSequ’ûP¬am‘”S‘
Ð
£q_·¿m‘”_£t_rb¥_t
 *
¥s
,

258 
VideoP¬am‘”s
 *
p_Vid
,

259 
SPS_id


262 cÚ¡ 
SubWidthC
 [4]= { 1, 2, 2, 1};

263 cÚ¡ 
SubHeightC
 [4]= { 1, 2, 1, 1};

264 
i
;

265 
n_SÿlšgLi¡
;

266 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

268 
äext_´ofže
 = ((
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_HP
) ||

269 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi10P
) ||

270 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi422
) ||

271 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi444
) ||

272 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_CAVLC444
)

273 #ià(
MVC_EXTENSION_ENABLE
)

274 || (
	`id’tify_´ofže
(
p_IÅ
)==
MULTIVIEW_HIGH
)

275 || (
	`id’tify_´ofže
(
p_IÅ
)==
STEREO_HIGH
)

281 
	`as£¹
 (
¥s
 !ð
NULL
);

284 
¥s
->
´ofže_idc
 = 
	`id’tify_´ofže
(
p_IÅ
);

285 
¥s
->
Ëv–_idc
 = 
	`id’tify_Ëv–
(
p_IÅ
);

288 
¥s
->
cÚ¡¿šed_£t0_æag
 = 
FALSE
;

289 
¥s
->
cÚ¡¿šed_£t1_æag
 = 
FALSE
;

290 
¥s
->
cÚ¡¿šed_£t2_æag
 = 
FALSE
;

292 iàÐ(
¥s
->
Ëv–_idc
 =ð9è&& !
	`is_FREXT_´ofže
(¥s->
´ofže_idc
) )

294 
¥s
->
cÚ¡¿šed_£t3_æag
 = 
TRUE
;

295 
¥s
->
Ëv–_idc
 = 11;

297 ià(
äext_´ofže
 && 
p_IÅ
->
IÁ¿Profže
)

299 
¥s
->
cÚ¡¿šed_£t3_æag
 = 
TRUE
;

303 
¥s
->
cÚ¡¿šed_£t3_æag
 = 
FALSE
;

307 
¥s
->
£q_·¿m‘”_£t_id
 = 
SPS_id
;

310 
¥s
->
b™_d•th_luma_mšus8
 = 
p_IÅ
->
ouut
.
b™_d•th
[0] - 8;

311 
¥s
->
b™_d•th_chroma_mšus8
 = 
p_IÅ
->
ouut
.
b™_d•th
[1] - 8;

312 
¥s
->
los¦ess_qµrime_æag
 = 
p_IÅ
->
Los¦essCodšg
 &

313 (
¥s
->
´ofže_idc
==
FREXT_Hi444
 || sps->´ofže_idc==
FREXT_CAVLC444
);

320 
¥s
->
log2_max_äame_num_mšus4
 = 
p_Vid
->log2_max_frame_num_minus4;

321 
¥s
->
log2_max_pic_Üd”_út_lsb_mšus4
 = 
p_Vid
->log2_max_pic_order_cnt_lsb_minus4;

323 
¥s
->
pic_Üd”_út_ty³
 = 
p_IÅ
->pic_order_cnt_type;

324 
¥s
->
num_»f_äames_š_pic_Üd”_út_cyþe
 = 
p_Vid
->num_ref_frames_in_pic_order_cnt_cycle;

325 
¥s
->
d–_pic_Üd”_®ways_z”o_æag
 = 
p_Vid
->delta_pic_order_always_zero_flag;

326 
¥s
->
off£t_fÜ_nÚ_»f_pic
 = 
p_Vid
->offset_for_non_ref_pic;

327 
¥s
->
off£t_fÜ_tÝ_to_bÙtom_f›ld
 = 
p_Vid
->offset_for_top_to_bottom_field;

329 
i
=0; i<
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
; i++)

331 
¥s
->
off£t_fÜ_»f_äame
[
i
] = 
p_Vid
->offset_for_ref_frame[i];

336 
¥s
->
num_»f_äames
 = (è
p_IÅ
->num_ref_frames;

339 
¥s
->
g­s_š_äame_num_v®ue_®lowed_æag
 = 
FALSE
;

341 
¥s
->
äame_mbs_Úly_æag
 = (
BoÞ—n
è!(
p_IÅ
->
PicIÁ”Ïû
 ||…_IÅ->
MbIÁ”Ïû
);

344 
¥s
->
pic_width_š_mbs_mšus1
 = (Ð
p_IÅ
->
ouut
.
width
[0] + 
p_Vid
->
auto_üÝ_right
) >> 4) -1;

345 
¥s
->
pic_height_š_m­_un™s_mšus1
 = (((
p_IÅ
->
ouut
.
height
[0] + 
p_Vid
->
auto_üÝ_bÙtom
è>> 4)/ (2 - sps->
äame_mbs_Úly_æag
)) - 1;

348 
¥s
->
mb_ad­tive_äame_f›ld_æag
 = (
BoÞ—n
è(
FRAME_CODING
 !ð
p_IÅ
->
MbIÁ”Ïû
);

349 
¥s
->
dœeù_8x8_šã»nû_æag
 = (
BoÞ—n
è
p_IÅ
->
dœeùInã»nûFÏg
;

352 
¥s
->
vui_·¿m‘”s_´e£Á_æag
 = (
BoÞ—n
è((
p_IÅ
->
ouut
.
cÞÜ_mod–
 !ð
CM_YUV
 &&…_IÅ->ouut.
yuv_fÜm©
 =ð
YUV444
è||…_IÅ->
EÇbËVUISuµÜt
);

353 
¥s
->
chroma_fÜm©_idc
 = 
p_IÅ
->
ouut
.
yuv_fÜm©
;

354 
¥s
->
£·¿‹_cÞour_¶ªe_æag
 = ( sps->
chroma_fÜm©_idc
 =ð
YUV444
 ) ? 
p_IÅ
->separate_colour_plane_flag : 0;

356 iàÐ
¥s
->
vui_·¿m‘”s_´e£Á_æag
 )

357 
	`G’”©eVUIP¬am‘”s
(
¥s
, 
p_IÅ
);

360 if(
äext_´ofže
)

362 
¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
 = (
BoÞ—n
è(
p_IÅ
->
SÿlšgM©rixP»£ÁFÏg
&1);

363 
n_SÿlšgLi¡
 = (
¥s
->
chroma_fÜm©_idc
 !ð
YUV444
) ? 8 : 12;

364 
i
=0; i<
n_SÿlšgLi¡
; i++)

366 if(
i
<6)

367 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
] = (
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[i]&1);

370 if(
p_IÅ
->
T¿nsfÜm8x8Mode
)

371 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
] = (
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[i]&1);

373 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

375 ifÐ
¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
 =ð
FALSE
 )

376 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

381 
¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
 = 
FALSE
;

382 
i
=0; i<12; i++)

383 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

388 ià(
p_Vid
->
auto_üÝ_right
 ||…_Vid->
auto_üÝ_bÙtom
)

390 
¥s
->
äame_üÝpšg_æag
 = 
TRUE
;

391 
¥s
->
äame_üÝ_Ëá_off£t
=0;

392 
¥s
->
äame_üÝ_tÝ_off£t
=0;

393 
¥s
->
äame_üÝ_right_off£t
ð(
p_Vid
->
auto_üÝ_right
 / 
SubWidthC
[¥s->
chroma_fÜm©_idc
]);

394 
¥s
->
äame_üÝ_bÙtom_off£t
ð(
p_Vid
->
auto_üÝ_bÙtom
 / (
SubHeightC
[¥s->
chroma_fÜm©_idc
] * (2 - sps->
äame_mbs_Úly_æag
)));

395 ià(
p_Vid
->
auto_üÝ_right
 % 
SubWidthC
[
¥s
->
chroma_fÜm©_idc
])

397 
	`”rÜ
("automatic frame cropping (width)‚ot…ossible",500);

399 ià(
p_Vid
->
auto_üÝ_bÙtom
 % (
SubHeightC
[
¥s
->
chroma_fÜm©_idc
] * (2 - sps->
äame_mbs_Úly_æag
)))

401 
	`”rÜ
("automatic frame cropping (height)‚ot…ossible",500);

406 
¥s
->
äame_üÝpšg_æag
 = 
FALSE
;

409 
	}
}

424 
	$G’”©ePiùu»P¬am‘”S‘
Ð
pic_·¿m‘”_£t_rb¥_t
 *
µs
,

425 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
,

426 
VideoP¬am‘”s
 *
p_Vid
,

427 
IÅutP¬am‘”s
 *
p_IÅ
,

428 
PPS_id
,

429 
Weigh‹dP»diùiÚ
,

430 
Weigh‹dB»diùiÚ
,

431 
cb_qp_šdex_off£t
,

432 
ü_qp_šdex_off£t


436 
i
;

437 
n_SÿlšgLi¡
;

438 
F¿meSizeInM­Un™s
 = 0;

440 
äext_´ofže
 = ((
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_HP
) ||

441 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi10P
) ||

442 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi422
) ||

443 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_Hi444
) ||

444 (
	`id’tify_´ofže
(
p_IÅ
)==
FREXT_CAVLC444
)

445 #ià(
MVC_EXTENSION_ENABLE
)

446 || (
	`id’tify_´ofže
(
p_IÅ
)==
MULTIVIEW_HIGH
)

447 || (
	`id’tify_´ofže
(
p_IÅ
)==
STEREO_HIGH
)

455 
µs
->
£q_·¿m‘”_£t_id
 = 
¥s
->seq_parameter_set_id;

456 
µs
->
pic_·¿m‘”_£t_id
 = 
PPS_id
;

457 
µs
->
’ŒÝy_codšg_mode_æag
 = (
p_IÅ
->
symbÞ_mode
 =ð
CAVLC
 ? 
FALSE
 : 
TRUE
);

459 if(
äext_´ofže
)

461 
µs
->
ŒªsfÜm_8x8_mode_æag
 = (
p_IÅ
->
T¿nsfÜm8x8Mode
 ? 
TRUE
:
FALSE
);

462 
µs
->
pic_sÿlšg_m©rix_´e£Á_æag
 = (
BoÞ—n
è((
p_IÅ
->
SÿlšgM©rixP»£ÁFÏg
&2)>>1);

463 
n_SÿlšgLi¡
 = (
¥s
->
chroma_fÜm©_idc
 !ð
YUV444
) ? 8 : 12;

464 
i
=0; i<
n_SÿlšgLi¡
; i++)

466 if(
i
<6)

467 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] = (
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[i]&2)>>1;

470 if(
µs
->
ŒªsfÜm_8x8_mode_æag
)

471 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] = (
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[i]&2)>>1;

473 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

475 ifÐ
µs
->
pic_sÿlšg_m©rix_´e£Á_æag
 =ð
FALSE
 )

476 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

481 
µs
->
pic_sÿlšg_m©rix_´e£Á_æag
 = 
FALSE
;

482 
i
=0; i<12; i++)

483 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
] = 0;

485 
µs
->
ŒªsfÜm_8x8_mode_æag
 = 
FALSE
;

486 
p_IÅ
->
T¿nsfÜm8x8Mode
 = 0;

490 
µs
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 = 
p_Vid
->bottom_field_pic_order_in_frame_present_flag;

493 
µs
->
num_¦iû_groups_mšus1
 = 
p_IÅ
->num_slice_groups_minus1;

496 ià(
µs
->
num_¦iû_groups_mšus1
 > 0)

498 ià((
µs
->
¦iû_group_id
 = 
	`ÿÎoc
 ((
¥s
->
pic_height_š_m­_un™s_mšus1
+1)*(¥s->
pic_width_š_mbs_mšus1
+1), (
by‹
))è=ð
NULL
)

499 
	`no_mem_ex™
 ("GeneratePictureParameterSet: slice_group_id");

501 
p_IÅ
->
¦iû_group_m­_ty³
)

504 
µs
->
¦iû_group_m­_ty³
 = 0;

505 
i
=0; i<=
µs
->
num_¦iû_groups_mšus1
; i++)

507 
µs
->
run_Ëngth_mšus1
[
i
]=
p_IÅ
->run_length_minus1[i];

511 
µs
->
¦iû_group_m­_ty³
 = 1;

515 
µs
->
¦iû_group_m­_ty³
 = 2;

516 
F¿meSizeInM­Un™s
 = (
¥s
->
pic_height_š_m­_un™s_mšus1
è* (¥s->
pic_width_š_mbs_mšus1
 + 1);

517 
i
=0; i<
µs
->
num_¦iû_groups_mšus1
; i++)

520 
µs
->
tÝ_Ëá
[
i
] = 
	`imš
 (
p_IÅ
->tÝ_Ëá[i], 
F¿meSizeInM­Un™s
);

521 
µs
->
bÙtom_right
[
i
] = 
	`imš
 (
p_IÅ
->bÙtom_right[i], 
F¿meSizeInM­Un™s
);

527 
µs
->
¦iû_group_m­_ty³
 = 
p_IÅ
->slice_group_map_type;

528 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
 = (
BoÞ—n
è
p_IÅ
->slice_group_change_direction_flag;

529 
µs
->
¦iû_group_chªge_¿‹_mšus1
 = 
p_IÅ
->slice_group_change_rate_minus1;

532 
µs
->
¦iû_group_m­_ty³
 = 6;

533 
µs
->
pic_size_š_m­_un™s_mšus1
 =

534 (((
p_IÅ
->
ouut
.
height
[0] + 
p_Vid
->
auto_üÝ_bÙtom
)/
MB_BLOCK_SIZE
)/(2-
¥s
->
äame_mbs_Úly_æag
))

535 *((
p_IÅ
->
ouut
.
width
[0] + 
p_Vid
->
auto_üÝ_right
)/
MB_BLOCK_SIZE
) -1;

537 
i
=0;i<=
µs
->
pic_size_š_m­_un™s_mšus1
; i++)

538 
µs
->
¦iû_group_id
[
i
] = 
p_IÅ
->slice_group_id[i];

542 
	`´štf
 ("Parset.c: slice_group_map_type invalid, default\n");

543 
	`as£¹
 (0==1);

548 
µs
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
 = 
¥s
->
äame_mbs_Úly_æag
 ? (¥s->
num_»f_äames
 - 1) : (2 * sps->num_ref_frames - 1) ;

549 
µs
->
num_»f_idx_l1_deçuÉ_aùive_mšus1
 = 
¥s
->
äame_mbs_Úly_æag
 ? (¥s->
num_»f_äames
 - 1) : (2 * sps->num_ref_frames - 1) ;

551 
µs
->
weigh‹d_´ed_æag
 = (
by‹
è
Weigh‹dP»diùiÚ
;

552 
µs
->
weigh‹d_b»d_idc
 = (
by‹
è
Weigh‹dB»diùiÚ
;

554 
µs
->
pic_š™_qp_mšus26
 = 0;

555 
µs
->
pic_š™_qs_mšus26
 = 0;

557 
µs
->
chroma_qp_šdex_off£t
 = 
cb_qp_šdex_off£t
;

558 ià(
äext_´ofže
)

560 
µs
->
cb_qp_šdex_off£t
 = cb_qp_index_offset;

561 
µs
->
ü_qp_šdex_off£t
 = cr_qp_index_offset;

564 
µs
->
cb_qp_šdex_off£t
 =…ps->
ü_qp_šdex_off£t
 =…ps->
chroma_qp_šdex_off£t
;

566 
µs
->
deblockšg_fž‹r_cÚŒÞ_´e£Á_æag
 = (
BoÞ—n
è((
p_IÅ
->
DFS’dP¬am‘”s
 !ð0è|| (p_IÅ->
RDPiùu»Deblockšg
 != 0));

568 
µs
->
cÚ¡¿šed_šŒa_´ed_æag
 = (
BoÞ—n
è
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
;

571 
µs
->
»dundªt_pic_út_´e£Á_æag
 = (
BoÞ—n
è
p_IÅ
->
»dundªt_pic_æag
;

572 
	}
}

595 
	$Sÿlšg_Li¡
(*
sÿlšgLi¡šput
, *
sÿlšgLi¡
, 
sizeOfSÿlšgLi¡
, *
U£DeçuÉSÿlšgM©rix
, 
B™¡»am
 *
b™¡»am
)

597 
j
, 
sÿnj
;

598 
Ën
=0;

599 
d–_sÿË
, 
Ï¡SÿË
, 
ÃxtSÿË
;

601 
Ï¡SÿË
 = 8;

602 
ÃxtSÿË
 = 8;

604 
j
=0; j<
sizeOfSÿlšgLi¡
; j++)

606 
sÿnj
 = (
sizeOfSÿlšgLi¡
==16è? 
ZZ_SCAN
[
j
]:
ZZ_SCAN8
[j];

608 if(
ÃxtSÿË
!=0)

610 
d–_sÿË
 = 
sÿlšgLi¡šput
[
sÿnj
]-
Ï¡SÿË
;

611 if(
d–_sÿË
>127)

612 
d–_sÿË
=delta_scale-256;

613 if(
d–_sÿË
<-128)

614 
d–_sÿË
=delta_scale+256;

616 
Ën
+=
	`wr™e_£_v
 (" : d–_¦ ", 
d–_sÿË
, 
b™¡»am
);

617 
ÃxtSÿË
 = 
sÿlšgLi¡šput
[
sÿnj
];

618 *
U£DeçuÉSÿlšgM©rix
|=(
sÿnj
==0 && 
ÃxtSÿË
==0);

621 
sÿlšgLi¡
[
sÿnj
] = (è((
ÃxtSÿË
==0è? 
Ï¡SÿË
:nextScale);

622 
Ï¡SÿË
 = 
sÿlšgLi¡
[
sÿnj
];

625  
Ën
;

626 
	}
}

648 #ià(
MVC_EXTENSION_ENABLE
)

649 
	$G’”©eSeq_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
by‹
 *
rb¥
, 
Is_Sub£t
)

651 
	$G’”©eSeq_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
by‹
 *
rb¥
)

654 
B™¡»am
 *
b™¡»am
;

655 
Ën
 = 0, 
L’InBy‹s
;

656 
i
;

657 
n_SÿlšgLi¡
;

659 
	`as£¹
 (
rb¥
 !ð
NULL
);

661 ià((
b™¡»am
=
	`ÿÎoc
(1, (
B™¡»am
)))==
NULL
è
	`no_mem_ex™
("SeqParameterSet:bitstream");

664 
b™¡»am
->
¡»amBufãr
 = 
rb¥
;

665 
b™¡»am
->
b™s_to_go
 = 8;

667 #ià(
MVC_EXTENSION_ENABLE
)

668 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
==2)

670 if(
Is_Sub£t
==1)

672 
	`as£¹
(
¥s
->
´ofže_idc
==
MULTIVIEW_HIGH
 || sps->´ofže_idc==
STEREO_HIGH
);

673 
Ën
+=
	`wr™e_u_v
 (8, "SPS:…rofže_idc", 
¥s
->
´ofže_idc
, 
b™¡»am
);

676 
Ën
+=
	`wr™e_u_v
 (8, "SPS:…rofže_idc", 100, 
b™¡»am
);

680 
Ën
+=
	`wr™e_u_v
 (8, "SPS:…rofže_idc", 
¥s
->
´ofže_idc
, 
b™¡»am
);

682 
Ën
+=
	`wr™e_u_1
 ("SPS: cÚ¡¿šed_£t0_æag", 
¥s
->
cÚ¡¿šed_£t0_æag
, 
b™¡»am
);

683 
Ën
+=
	`wr™e_u_1
 ("SPS: cÚ¡¿šed_£t1_æag", 
¥s
->
cÚ¡¿šed_£t1_æag
, 
b™¡»am
);

684 
Ën
+=
	`wr™e_u_1
 ("SPS: cÚ¡¿šed_£t2_æag", 
¥s
->
cÚ¡¿šed_£t2_æag
, 
b™¡»am
);

685 
Ën
+=
	`wr™e_u_1
 ("SPS: cÚ¡¿šed_£t3_æag", 
¥s
->
cÚ¡¿šed_£t3_æag
, 
b™¡»am
);

686 
Ën
+=
	`wr™e_u_v
 (4, "SPS:„e£rved_z”o_4b™s", 0, 
b™¡»am
);

688 
Ën
+=
	`wr™e_u_v
 (8, "SPS:†ev–_idc", 
¥s
->
Ëv–_idc
, 
b™¡»am
);

690 
Ën
+=
	`wr™e_ue_v
 ("SPS: seq_·¿m‘”_£t_id", 
¥s
->
£q_·¿m‘”_£t_id
, 
b™¡»am
);

693 ifÐ
	`is_FREXT_´ofže
(
¥s
->
´ofže_idc
) )

695 
Ën
+=
	`wr™e_ue_v
 ("SPS: chroma_fÜm©_idc", 
¥s
->
chroma_fÜm©_idc
, 
b™¡»am
);

696 if(
¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

697 
Ën
+=
	`wr™e_u_1
 ("SPS: s•¬©e_cÞour_¶ªe_æag", 
¥s
->
£·¿‹_cÞour_¶ªe_æag
, 
b™¡»am
);

698 
Ën
+=
	`wr™e_ue_v
 ("SPS: b™_d•th_luma_mšus8", 
¥s
->
b™_d•th_luma_mšus8
, 
b™¡»am
);

699 
Ën
+=
	`wr™e_ue_v
 ("SPS: b™_d•th_chroma_mšus8", 
¥s
->
b™_d•th_chroma_mšus8
, 
b™¡»am
);

701 
Ën
+=
	`wr™e_u_1
 ("SPS:†os¦ess_qµrime_y_z”o_æag", 
¥s
->
los¦ess_qµrime_æag
, 
b™¡»am
);

704 
Ën
+=
	`wr™e_u_1
 ("SPS: seq_sÿlšg_m©rix_´e£Á_æag", 
¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
, 
b™¡»am
);

706 if(
¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
)

708 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

709 
n_SÿlšgLi¡
 = (
¥s
->
chroma_fÜm©_idc
 !ð
YUV444
) ? 8 : 12;

710 
i
=0; i<
n_SÿlšgLi¡
; i++)

712 
Ën
+=
	`wr™e_u_1
 ("SPS: seq_sÿlšg_li¡_´e£Á_æag", 
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
], 
b™¡»am
);

713 if(
¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[
i
])

715 if(
i
<6)

716 
Ën
+=
	`Sÿlšg_Li¡
(
p_QSÿË
->
SÿlšgLi¡4x4šput
[
i
],…_QSÿË->
SÿlšgLi¡4x4
[i], 16, &p_QSÿË->
U£DeçuÉSÿlšgM©rix4x4FÏg
[i], 
b™¡»am
);

718 
Ën
+=
	`Sÿlšg_Li¡
(
p_QSÿË
->
SÿlšgLi¡8x8šput
[
i
-6],…_QSÿË->
SÿlšgLi¡8x8
[i-6], 64, &p_QSÿË->
U£DeçuÉSÿlšgM©rix8x8FÏg
[i-6], 
b™¡»am
);

724 
Ën
+=
	`wr™e_ue_v
 ("SPS:†og2_max_äame_num_mšus4", 
¥s
->
log2_max_äame_num_mšus4
, 
b™¡»am
);

725 
Ën
+=
	`wr™e_ue_v
 ("SPS:…ic_Üd”_út_ty³", 
¥s
->
pic_Üd”_út_ty³
, 
b™¡»am
);

727 ià(
¥s
->
pic_Üd”_út_ty³
 == 0)

728 
Ën
+=
	`wr™e_ue_v
 ("SPS:†og2_max_pic_Üd”_út_lsb_mšus4", 
¥s
->
log2_max_pic_Üd”_út_lsb_mšus4
, 
b™¡»am
);

729 ià(
¥s
->
pic_Üd”_út_ty³
 == 1)

731 
Ën
+=
	`wr™e_u_1
 ("SPS: d–_pic_Üd”_®ways_z”o_æag", 
¥s
->
d–_pic_Üd”_®ways_z”o_æag
, 
b™¡»am
);

732 
Ën
+=
	`wr™e_£_v
 ("SPS: off£t_fÜ_nÚ_»f_pic", 
¥s
->
off£t_fÜ_nÚ_»f_pic
, 
b™¡»am
);

733 
Ën
+=
	`wr™e_£_v
 ("SPS: off£t_fÜ_tÝ_to_bÙtom_f›ld", 
¥s
->
off£t_fÜ_tÝ_to_bÙtom_f›ld
, 
b™¡»am
);

734 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_»f_äames_š_pic_Üd”_út_cyþe", 
¥s
->
num_»f_äames_š_pic_Üd”_út_cyþe
, 
b™¡»am
);

735 
i
=0; i<
¥s
->
num_»f_äames_š_pic_Üd”_út_cyþe
; i++)

736 
Ën
+=
	`wr™e_£_v
 ("SPS: off£t_fÜ_»f_äame", 
¥s
->
off£t_fÜ_»f_äame
[
i
], 
b™¡»am
);

738 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_»f_äames", 
¥s
->
num_»f_äames
, 
b™¡»am
);

739 
Ën
+=
	`wr™e_u_1
 ("SPS: g­s_š_äame_num_v®ue_®lowed_æag", 
¥s
->
g­s_š_äame_num_v®ue_®lowed_æag
, 
b™¡»am
);

740 
Ën
+=
	`wr™e_ue_v
 ("SPS:…ic_width_š_mbs_mšus1", 
¥s
->
pic_width_š_mbs_mšus1
, 
b™¡»am
);

741 
Ën
+=
	`wr™e_ue_v
 ("SPS:…ic_height_š_m­_un™s_mšus1", 
¥s
->
pic_height_š_m­_un™s_mšus1
, 
b™¡»am
);

742 
Ën
+=
	`wr™e_u_1
 ("SPS: f¿me_mbs_Úly_æag", 
¥s
->
äame_mbs_Úly_æag
, 
b™¡»am
);

743 ià(!
¥s
->
äame_mbs_Úly_æag
)

745 
Ën
+=
	`wr™e_u_1
 ("SPS: mb_ad­tive_äame_f›ld_æag", 
¥s
->
mb_ad­tive_äame_f›ld_æag
, 
b™¡»am
);

747 
Ën
+=
	`wr™e_u_1
 ("SPS: dœeù_8x8_šã»nû_æag", 
¥s
->
dœeù_8x8_šã»nû_æag
, 
b™¡»am
);

749 
Ën
+=
	`wr™e_u_1
 ("SPS: f¿me_üÝpšg_æag", 
¥s
->
äame_üÝpšg_æag
, 
b™¡»am
);

750 ià(
¥s
->
äame_üÝpšg_æag
)

752 
Ën
+=
	`wr™e_ue_v
 ("SPS: f¿me_üÝ_Ëá_off£t", 
¥s
->
äame_üÝ_Ëá_off£t
, 
b™¡»am
);

753 
Ën
+=
	`wr™e_ue_v
 ("SPS: f¿me_üÝ_right_off£t", 
¥s
->
äame_üÝ_right_off£t
, 
b™¡»am
);

754 
Ën
+=
	`wr™e_ue_v
 ("SPS: f¿me_üÝ_tÝ_off£t", 
¥s
->
äame_üÝ_tÝ_off£t
, 
b™¡»am
);

755 
Ën
+=
	`wr™e_ue_v
 ("SPS: f¿me_üÝ_bÙtom_off£t", 
¥s
->
äame_üÝ_bÙtom_off£t
, 
b™¡»am
);

758 
Ën
+=
	`wr™e_u_1
 ("SPS: vui_·¿m‘”s_´e£Á_æag", 
¥s
->
vui_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

760 ià(
¥s
->
vui_·¿m‘”s_´e£Á_æag
)

761 
Ën
+=
	`G’”©eVUI_·¿m‘”s_rb¥
(
¥s
, 
b™¡»am
);

763 #ià(
MVC_EXTENSION_ENABLE
)

764 if(
Is_Sub£t
==1)

767 
Ën
+=
	`wr™e_u_1
 ("SPS: b™_equ®_to_Úe", 1, 
b™¡»am
);

771 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_v›ws_mšus1", 1, 
b™¡»am
);

772 iàÐ
p_Vid
->
p_IÅ
->
MVCFlV›ws
 )

774 
Ën
+=
	`wr™e_ue_v
 ("SPS: v›w_id[ 0 ]", 1, 
b™¡»am
);

775 
Ën
+=
	`wr™e_ue_v
 ("SPS: v›w_id[ 1 ]", 0, 
b™¡»am
);

777 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_ªchÜ_»fs_l0[ 1 ]", 1, 
b™¡»am
);

778 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡nchÜ_»f_l0[ 1 ][ 0 ]", 1, 
b™¡»am
);

779 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_ªchÜ_»fs_l1[ 1 ]", 1, 
b™¡»am
);

780 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡nchÜ_»f_l1[ 1 ][ 0 ]", 1, 
b™¡»am
);

782 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_nÚ_ªchÜ_»fs_l0[ 1 ]", 1, 
b™¡»am
);

783 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚Ú_ªchÜ_»f_l0[ 1 ][ 0 ]", 1, 
b™¡»am
);

784 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_nÚ_ªchÜ_»fs_l1[ 1 ]", 1, 
b™¡»am
);

785 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚Ú_ªchÜ_»f_l1[ 1 ][ 0 ]", 1, 
b™¡»am
);

789 
Ën
+=
	`wr™e_ue_v
 ("SPS: v›w_id[ 0 ]", 0, 
b™¡»am
);

790 
Ën
+=
	`wr™e_ue_v
 ("SPS: v›w_id[ 1 ]", 1, 
b™¡»am
);

792 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_ªchÜ_»fs_l0[ 1 ]", 1, 
b™¡»am
);

793 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡nchÜ_»f_l0[ 1 ][ 0 ]", 0, 
b™¡»am
);

794 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_ªchÜ_»fs_l1[ 1 ]", 1, 
b™¡»am
);

795 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡nchÜ_»f_l1[ 1 ][ 0 ]", 0, 
b™¡»am
);

797 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_nÚ_ªchÜ_»fs_l0[ 1 ]", 1, 
b™¡»am
);

798 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚Ú_ªchÜ_»f_l0[ 1 ][ 0 ]", 0, 
b™¡»am
);

799 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_nÚ_ªchÜ_»fs_l1[ 1 ]", 1, 
b™¡»am
);

800 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚Ú_ªchÜ_»f_l1[ 1 ][ 0 ]", 0, 
b™¡»am
);

803 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_Ëv–_v®ues_sigÇÎed_mšus1", 0, 
b™¡»am
);

804 
Ën
+=
	`wr™e_u_v
 (8, "SPS:†ev–_idc[ 0 ]", 
¥s
->
Ëv–_idc
, 
b™¡»am
);

805 
Ën
+=
	`wr™e_ue_v
 ("SPS:‚um_­¶iÿbË_Ýs_mšus1[ 0 ]", 0, 
b™¡»am
);

806 
Ën
+=
	`wr™e_u_v
 (3, "SPS:‡µliÿbË_Ý_‹mpÜ®_id[ 0 ][ 0 ]", 0, 
b™¡»am
);

807 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡µliÿbË_Ý_num_rg‘_v›ws_mšus1[ 0 ][ 0 ]", 0, 
b™¡»am
);

808 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡µliÿbË_Ý_rg‘_v›w_id[ 0 ][ 0 ][ 0 ]", 0, 
b™¡»am
);

809 
Ën
+=
	`wr™e_ue_v
 ("SPS:‡µliÿbË_Ý_num_v›ws_mšus1[ 0 ][ 0 ]", 0, 
b™¡»am
);

812 
Ën
+=
	`wr™e_u_1
 ("SPS: mvc_vui_·¿m‘”s_´e£Á_æag", 
¥s
->
vui_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

814 if(
¥s
->
vui_·¿m‘”s_´e£Á_æag
)

816 
Ën
+=
	`wr™e_ue_v
 ( "SPS: vui_mvc_num_Ýs_mšus1", 0, 
b™¡»am
);

817 
Ën
+=
	`wr™e_u_v
 ( 3, "SPS: vui_mvc_‹mpÜ®_id[ 0 ]", 0, 
b™¡»am
);

818 
Ën
+=
	`wr™e_ue_v
 ( "SPS: vui_mvc_num_rg‘_ouut_v›ws_mšus1[ 0 ]", 0, 
b™¡»am
);

819 
Ën
+=
	`wr™e_ue_v
 ( "SPS: vui_mvc_v›w_id[ 0 ][ 0 ]", 0, 
b™¡»am
);

820 
Ën
+=
	`wr™e_u_1
 ( "SPS: vui_mvc_timšg_šfo_´e£Á_æag[ 0 ]", 
¥s
->
vui_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

821 
Ën
+=
	`wr™e_u_v
 (32, "SPS: vui_mvc_num_un™s_š_tick[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
num_un™s_š_tick
, 
b™¡»am
);

822 
Ën
+=
	`wr™e_u_v
 (32, "SPS: vui_mvc_time_sÿË[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
time_sÿË
, 
b™¡»am
);

823 
Ën
+=
	`wr™e_u_1
 ( "SPS: vui_mvc_fixed_äame_¿‹_æag[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
fixed_äame_¿‹_æag
, 
b™¡»am
);

824 
Ën
+=
	`wr™e_u_1
 ( "SPS: vui_mvc_Çl_hrd_·¿m‘”s_´e£Á_æag[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

825 if(
¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
)

827 
Ën
 +ð
	`Wr™eHRDP¬am‘”s
(
¥s
, 
b™¡»am
);

829 
Ën
+=
	`wr™e_u_1
 ("SPS: vui_mvc_vþ_hrd_·¿m‘”s_´e£Á_æag[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

830 iàÐ
¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

832 
Ën
 +ð
	`Wr™eHRDP¬am‘”s
(
¥s
, 
b™¡»am
);

834 iàÐ
¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
 || sps->vui_£q_·¿m‘”s.
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

836 
Ën
+=
	`wr™e_u_1
 ("SPS: vui_mvc_low_d–ay_hrd_æag[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
low_d–ay_hrd_æag
, 
b™¡»am
 );

838 
Ën
+=
	`wr™e_u_1
 ("SPS: vui_mvc_pic_¡ruù_´e£Á_æag[ 0 ]", 
¥s
->
vui_£q_·¿m‘”s
.
pic_¡ruù_´e£Á_æag
, 
b™¡»am
);

842 
Ën
+=
	`wr™e_u_1
 ("SPS:‡dd™iÚ®_ex‹nsiÚ2_æag", 0, 
b™¡»am
);

846 
	`SODBtoRBSP
(
b™¡»am
);

848 
L’InBy‹s
=
b™¡»am
->
by‹_pos
;

850 
	`ä“
 (
b™¡»am
);

852  
L’InBy‹s
;

853 
	}
}

877 
	$G’”©ePic_·¿m‘”_£t_rb¥
 (
VideoP¬am‘”s
 *
p_Vid
, 
pic_·¿m‘”_£t_rb¥_t
 *
µs
, 
by‹
 *
rb¥
)

879 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

880 
B™¡»am
 *
b™¡»am
;

881 
Ën
 = 0, 
L’InBy‹s
;

882 
i
;

883 
´ofže_idc
;

885 
	`as£¹
 (
rb¥
 !ð
NULL
);

887 ià((
b™¡»am
=
	`ÿÎoc
(1, (
B™¡»am
)))==
NULL
è
	`no_mem_ex™
("PicParameterSet:bitstream");

890 
b™¡»am
->
¡»amBufãr
 = 
rb¥
;

891 
b™¡»am
->
b™s_to_go
 = 8;

893 
µs
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 = 
p_Vid
->bottom_field_pic_order_in_frame_present_flag;

895 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:…ic_·¿m‘”_£t_id", 
µs
->
pic_·¿m‘”_£t_id
, 
b™¡»am
);

896 
Ën
 +ð
	`wr™e_ue_v
 ("PPS: seq_·¿m‘”_£t_id", 
µs
->
£q_·¿m‘”_£t_id
, 
b™¡»am
);

897 
Ën
 +ð
	`wr™e_u_1
 ("PPS:ƒÁrÝy_codšg_mode_æag", 
µs
->
’ŒÝy_codšg_mode_æag
, 
b™¡»am
);

898 
Ën
 +ð
	`wr™e_u_1
 ("PPS: bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag", 
µs
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
, 
b™¡»am
);

899 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:‚um_¦iû_groups_mšus1", 
µs
->
num_¦iû_groups_mšus1
, 
b™¡»am
);

902 if(
µs
->
num_¦iû_groups_mšus1
 > 0 )

904 
Ën
 +ð
	`wr™e_ue_v
 ("PPS: sliû_group_m­_ty³", 
µs
->
¦iû_group_m­_ty³
, 
b™¡»am
);

905 ià(
µs
->
¦iû_group_m­_ty³
 == 0)

906 
i
=0; i<=
µs
->
num_¦iû_groups_mšus1
; i++)

907 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:„un_Ëngth_mšus1[i]", 
µs
->
run_Ëngth_mšus1
[
i
], 
b™¡»am
);

908 ià(
µs
->
¦iû_group_m­_ty³
==2)

910 
i
=0; i<
µs
->
num_¦iû_groups_mšus1
; i++)

912 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:Ý_Ëá[i]", 
µs
->
tÝ_Ëá
[
i
], 
b™¡»am
);

913 
Ën
 +ð
	`wr™e_ue_v
 ("PPS: bÙtom_right[i]", 
µs
->
bÙtom_right
[
i
], 
b™¡»am
);

916 ià(
µs
->
¦iû_group_m­_ty³
 == 3 ||

917 
µs
->
¦iû_group_m­_ty³
 == 4 ||

918 
µs
->
¦iû_group_m­_ty³
 == 5)

920 
Ën
 +ð
	`wr™e_u_1
 ("PPS: sliû_group_chªge_dœeùiÚ_æag", 
µs
->
¦iû_group_chªge_dœeùiÚ_æag
, 
b™¡»am
);

921 
Ën
 +ð
	`wr™e_ue_v
 ("PPS: sliû_group_chªge_¿‹_mšus1", 
µs
->
¦iû_group_chªge_¿‹_mšus1
, 
b™¡»am
);

923 ià(
µs
->
¦iû_group_m­_ty³
 == 6)

925 
Numb”B™sP”SliûGroupId
 = 0;

927 ià(
µs
->
num_¦iû_groups_mšus1
>=4)

928 
Numb”B™sP”SliûGroupId
=3;

929 ià(
µs
->
num_¦iû_groups_mšus1
>=2)

930 
Numb”B™sP”SliûGroupId
=2;

931 ià(
µs
->
num_¦iû_groups_mšus1
>=1)

932 
Numb”B™sP”SliûGroupId
=1;

934 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:…ic_size_š_m­_un™s_mšus1", 
µs
->
pic_size_š_m­_un™s_mšus1
, 
b™¡»am
);

935 
i
 = 0; i <ð
µs
->
pic_size_š_m­_un™s_mšus1
; i++)

936 
Ën
 +ð
	`wr™e_u_v
 (
Numb”B™sP”SliûGroupId
, "PPS: >¦iû_group_id[i]", 
µs
->
¦iû_group_id
[
i
], 
b™¡»am
);

941 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:‚um_»f_idx_l0_deçuÉ_aùive_mšus1", 
µs
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
, 
b™¡»am
);

942 
Ën
 +ð
	`wr™e_ue_v
 ("PPS:‚um_»f_idx_l1_deçuÉ_aùive_mšus1", 
µs
->
num_»f_idx_l1_deçuÉ_aùive_mšus1
, 
b™¡»am
);

943 
Ën
 +ð
	`wr™e_u_1
 ("PPS: weigh‹d_´ed_æag", 
µs
->
weigh‹d_´ed_æag
, 
b™¡»am
);

944 
Ën
 +ð
	`wr™e_u_v
 (2, "PPS: weigh‹d_b»d_idc", 
µs
->
weigh‹d_b»d_idc
, 
b™¡»am
);

945 
Ën
 +ð
	`wr™e_£_v
 ("PPS:…ic_š™_qp_mšus26", 
µs
->
pic_š™_qp_mšus26
, 
b™¡»am
);

946 
Ën
 +ð
	`wr™e_£_v
 ("PPS:…ic_š™_qs_mšus26", 
µs
->
pic_š™_qs_mšus26
, 
b™¡»am
);

948 
´ofže_idc
 = 
	`id’tify_´ofže
(
p_IÅ
);

949 ifÐ
	`is_FREXT_´ofže
(
´ofže_idc
) )

950 
Ën
 +ð
	`wr™e_£_v
 ("PPS: chroma_qp_šdex_off£t", 
µs
->
cb_qp_šdex_off£t
, 
b™¡»am
);

952 
Ën
 +ð
	`wr™e_£_v
 ("PPS: chroma_qp_šdex_off£t", 
µs
->
chroma_qp_šdex_off£t
, 
b™¡»am
);

954 
Ën
 +ð
	`wr™e_u_1
 ("PPS: deblockšg_fž‹r_cÚŒÞ_´e£Á_æag", 
µs
->
deblockšg_fž‹r_cÚŒÞ_´e£Á_æag
, 
b™¡»am
);

955 
Ën
 +ð
	`wr™e_u_1
 ("PPS: cÚ¡¿šed_šŒa_´ed_æag", 
µs
->
cÚ¡¿šed_šŒa_´ed_æag
, 
b™¡»am
);

956 
Ën
 +ð
	`wr™e_u_1
 ("PPS:„edundªt_pic_út_´e£Á_æag", 
µs
->
»dundªt_pic_út_´e£Á_æag
, 
b™¡»am
);

959 ifÐ
	`is_FREXT_´ofže
(
´ofže_idc
) )

961 
Ën
 +ð
	`wr™e_u_1
 ("PPS:¿nsfÜm_8x8_mode_æag", 
µs
->
ŒªsfÜm_8x8_mode_æag
, 
b™¡»am
);

962 
Ën
 +ð
	`wr™e_u_1
 ("PPS:…ic_sÿlšg_m©rix_´e£Á_æag", 
µs
->
pic_sÿlšg_m©rix_´e£Á_æag
, 
b™¡»am
);

964 if(
µs
->
pic_sÿlšg_m©rix_´e£Á_æag
)

966 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

967 
n_SÿlšgLi¡
 = 6 + ((
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 !ð3è? 2 : 6è* 
µs
->
ŒªsfÜm_8x8_mode_æag
;

969 
i
=0; i<
n_SÿlšgLi¡
; i++)

971 
Ën
 +ð
	`wr™e_u_1
 ("PPS:…ic_sÿlšg_li¡_´e£Á_æag", 
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
], 
b™¡»am
);

973 if(
µs
->
pic_sÿlšg_li¡_´e£Á_æag
[
i
])

975 if(
i
 < 6)

976 
Ën
 +ð
	`Sÿlšg_Li¡
(
p_QSÿË
->
SÿlšgLi¡4x4šput
[
i
],…_QSÿË->
SÿlšgLi¡4x4
[i], 16, &p_QSÿË->
U£DeçuÉSÿlšgM©rix4x4FÏg
[i], 
b™¡»am
);

978 
Ën
 +ð
	`Sÿlšg_Li¡
(
p_QSÿË
->
SÿlšgLi¡8x8šput
[
i
-6],…_QSÿË->
SÿlšgLi¡8x8
[i-6], 64, &p_QSÿË->
U£DeçuÉSÿlšgM©rix8x8FÏg
[i-6], 
b™¡»am
);

982 
Ën
 +ð
	`wr™e_£_v
 ("PPS: secÚd_chroma_qp_šdex_off£t", 
µs
->
ü_qp_šdex_off£t
, 
b™¡»am
);

985 
	`SODBtoRBSP
(
b™¡»am
);

987 
L’InBy‹s
 = 
b™¡»am
->
by‹_pos
;

990 
	`ä“
 (
b™¡»am
);

992  
L’InBy‹s
;

993 
	}
}

1015 
	$id’tify_´ofže
(
IÅutP¬am‘”s
 *
p_IÅ
)

1017  
p_IÅ
->
ProfžeIDC
;

1018 
	}
}

1033 
	$id’tify_Ëv–
(
IÅutP¬am‘”s
 *
p_IÅ
)

1035  
p_IÅ
->
Lev–IDC
;

1036 
	}
}

1048 
	$G’”©eVUI_·¿m‘”s_rb¥
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
B™¡»am
 *
b™¡»am
)

1050 
Ën
=0;

1051 
vui_£q_·¿m‘”s_t
 *
vui_£q_·¿m‘”s
 = &(
¥s
->vui_seq_parameters);

1053 
Ën
+=
	`wr™e_u_1
 ("VUI:‡¥eù_¿tio_šfo_´e£Á_æag", 
vui_£q_·¿m‘”s
->
a¥eù_¿tio_šfo_´e£Á_æag
, 
b™¡»am
);

1054 ià(
vui_£q_·¿m‘”s
->
a¥eù_¿tio_šfo_´e£Á_æag
)

1056 
Ën
+=
	`wr™e_u_v
 (8,"VUI:‡¥eù_¿tio_idc", 
vui_£q_·¿m‘”s
->
a¥eù_¿tio_idc
, 
b™¡»am
);

1057 ià(
vui_£q_·¿m‘”s
->
a¥eù_¿tio_idc
 == 255)

1059 
Ën
+=
	`wr™e_u_v
 (16,"VUI: s¬_width", 
vui_£q_·¿m‘”s
->
§r_width
, 
b™¡»am
);

1060 
Ën
+=
	`wr™e_u_v
 (16,"VUI: s¬_height", 
vui_£q_·¿m‘”s
->
§r_height
, 
b™¡»am
);

1064 
Ën
+=
	`wr™e_u_1
 ("VUI: ov”sÿn_šfo_´e£Á_æag", 
vui_£q_·¿m‘”s
->
ov”sÿn_šfo_´e£Á_æag
, 
b™¡»am
);

1065 ià(
vui_£q_·¿m‘”s
->
ov”sÿn_šfo_´e£Á_æag
)

1067 
Ën
+=
	`wr™e_u_1
 ("VUI: ov”sÿn_­´ÝrŸ‹_æag", 
vui_£q_·¿m‘”s
->
ov”sÿn_­´ÝrŸ‹_æag
, 
b™¡»am
);

1070 
Ën
+=
	`wr™e_u_1
 ("VUI: video_sigÇl_ty³_´e£Á_æag", 
vui_£q_·¿m‘”s
->
video_sigÇl_ty³_´e£Á_æag
, 
b™¡»am
);

1071 ià(
vui_£q_·¿m‘”s
->
video_sigÇl_ty³_´e£Á_æag
)

1073 
Ën
+=
	`wr™e_u_v
 (3,"VUI: video_fÜm©", 
vui_£q_·¿m‘”s
->
video_fÜm©
, 
b™¡»am
);

1074 
Ën
+=
	`wr™e_u_1
 ("VUI: video_fuÎ_¿nge_æag", 
vui_£q_·¿m‘”s
->
video_fuÎ_¿nge_æag
, 
b™¡»am
);

1075 
Ën
+=
	`wr™e_u_1
 ("VUI: cÞour_desütiÚ_´e£Á_æag", 
vui_£q_·¿m‘”s
->
cÞour_desütiÚ_´e£Á_æag
, 
b™¡»am
);

1076 ià(
vui_£q_·¿m‘”s
->
cÞour_desütiÚ_´e£Á_æag
)

1078 
Ën
+=
	`wr™e_u_v
 (8,"VUI: cÞour_´im¬›s", 
vui_£q_·¿m‘”s
->
cÞour_´im¬›s
, 
b™¡»am
);

1079 
Ën
+=
	`wr™e_u_v
 (8,"VUI:¿nsãr_ch¬aù”i¡ics", 
vui_£q_·¿m‘”s
->
Œªsãr_ch¬aù”i¡ics
, 
b™¡»am
);

1080 
Ën
+=
	`wr™e_u_v
 (8,"VUI: m©rix_cÛffic›Ás", 
vui_£q_·¿m‘”s
->
m©rix_cÛffic›Ás
, 
b™¡»am
);

1084 
Ën
+=
	`wr™e_u_1
 ("VUI: chroma_loc_šfo_´e£Á_æag", 
vui_£q_·¿m‘”s
->
chroma_loÿtiÚ_šfo_´e£Á_æag
, 
b™¡»am
);

1085 ià(
vui_£q_·¿m‘”s
->
chroma_loÿtiÚ_šfo_´e£Á_æag
)

1087 
Ën
+=
	`wr™e_ue_v
 ("VUI: chroma_§m¶e_loc_ty³_tÝ_f›ld", 
vui_£q_·¿m‘”s
->
chroma_§m¶e_loc_ty³_tÝ_f›ld
, 
b™¡»am
);

1088 
Ën
+=
	`wr™e_ue_v
 ("VUI: chroma_§m¶e_loc_ty³_bÙtom_f›ld", 
vui_£q_·¿m‘”s
->
chroma_§m¶e_loc_ty³_bÙtom_f›ld
, 
b™¡»am
);

1091 
Ën
+=
	`wr™e_u_1
 ("VUI:imšg_šfo_´e£Á_æag", 
vui_£q_·¿m‘”s
->
timšg_šfo_´e£Á_æag
, 
b™¡»am
);

1093 ià(
vui_£q_·¿m‘”s
->
timšg_šfo_´e£Á_æag
)

1095 
Ën
+=
	`wr™e_u_v
 (32,"VUI:‚um_un™s_š_tick", 
vui_£q_·¿m‘”s
->
num_un™s_š_tick
, 
b™¡»am
);

1096 
Ën
+=
	`wr™e_u_v
 (32,"VUI:ime_sÿË", 
vui_£q_·¿m‘”s
->
time_sÿË
, 
b™¡»am
);

1097 
Ën
+=
	`wr™e_u_1
 ("VUI: fixed_äame_¿‹_æag", 
vui_£q_·¿m‘”s
->
fixed_äame_¿‹_æag
, 
b™¡»am
);

1101 
Ën
+=
	`wr™e_u_1
 ("VUI:‚®_hrd_·¿m‘”s_´e£Á_æag", 
vui_£q_·¿m‘”s
->
Çl_hrd_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

1102 iàÐ
vui_£q_·¿m‘”s
->
Çl_hrd_·¿m‘”s_´e£Á_æag
 )

1104 
Ën
 +ð
	`Wr™eHRDP¬am‘”s
(
¥s
, 
b™¡»am
);

1107 
Ën
+=
	`wr™e_u_1
 ("VUI: vþ_hrd_·¿m‘”s_´e£Á_æag", 
vui_£q_·¿m‘”s
->
vþ_hrd_·¿m‘”s_´e£Á_æag
, 
b™¡»am
);

1108 iàÐ
vui_£q_·¿m‘”s
->
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

1110 
Ën
 +ð
	`Wr™eHRDP¬am‘”s
(
¥s
, 
b™¡»am
);

1112 iàÐ
vui_£q_·¿m‘”s
->
Çl_hrd_·¿m‘”s_´e£Á_æag
 || vui_£q_·¿m‘”s->
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

1114 
Ën
+=
	`wr™e_u_1
 ("VUI:†ow_d–ay_hrd_æag", 
vui_£q_·¿m‘”s
->
low_d–ay_hrd_æag
, 
b™¡»am
 );

1116 
Ën
+=
	`wr™e_u_1
 ("VUI:…ic_¡ruù_´e£Á_æag", 
vui_£q_·¿m‘”s
->
pic_¡ruù_´e£Á_æag
, 
b™¡»am
);

1118 
Ën
+=
	`wr™e_u_1
 ("VUI: b™¡»am_»¡riùiÚ_æag", 
vui_£q_·¿m‘”s
->
b™¡»am_»¡riùiÚ_æag
, 
b™¡»am
);

1119 ià(
vui_£q_·¿m‘”s
->
b™¡»am_»¡riùiÚ_æag
)

1121 
Ën
+=
	`wr™e_u_1
 ("VUI: mÙiÚ_veùÜs_ov”_pic_bound¬›s_æag", 
vui_£q_·¿m‘”s
->
mÙiÚ_veùÜs_ov”_pic_bound¬›s_æag
, 
b™¡»am
);

1122 
Ën
+=
	`wr™e_ue_v
 ("VUI: max_by‹s_³r_pic_d’om", 
vui_£q_·¿m‘”s
->
max_by‹s_³r_pic_d’om
, 
b™¡»am
);

1123 
Ën
+=
	`wr™e_ue_v
 ("VUI: max_b™s_³r_mb_d’om", 
vui_£q_·¿m‘”s
->
max_b™s_³r_mb_d’om
, 
b™¡»am
);

1124 
Ën
+=
	`wr™e_ue_v
 ("VUI:†og2_max_mv_Ëngth_hÜizÚl", 
vui_£q_·¿m‘”s
->
log2_max_mv_Ëngth_hÜizÚl
, 
b™¡»am
);

1125 
Ën
+=
	`wr™e_ue_v
 ("VUI:†og2_max_mv_Ëngth_v”tiÿl", 
vui_£q_·¿m‘”s
->
log2_max_mv_Ëngth_v”tiÿl
, 
b™¡»am
);

1126 
Ën
+=
	`wr™e_ue_v
 ("VUI:‚um_»Üd”_äames", 
vui_£q_·¿m‘”s
->
num_»Üd”_äames
, 
b™¡»am
);

1127 
Ën
+=
	`wr™e_ue_v
 ("VUI: max_dec_äame_bufãršg", 
vui_£q_·¿m‘”s
->
max_dec_äame_bufãršg
, 
b™¡»am
);

1130  
Ën
;

1131 
	}
}

1143 
NALU_t
 *
	$G’”©eSEImes§ge_NALU
(
IÅutP¬am‘”s
 *
p_IÅ
)

1145 
NALU_t
 *
n
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

1146 
RBSPËn
 = 0;

1147 
by‹
 
rb¥
[
MAXRBSPSIZE
];

1149 
RBSPËn
 = 
	`G’”©eSEImes§ge_rb¥
 (
p_IÅ
, 
NORMAL_SEI
, 
rb¥
);

1150 
	`RBSPtoNALU
 (
rb¥
, 
n
, 
RBSPËn
, 
NALU_TYPE_SEI
, 
NALU_PRIORITY_DISPOSABLE
, 1);

1151 
n
->
¡¬tcod•»fix_Ën
 = 4;

1153  
n
;

1154 
	}
}

1169 
	$G’”©eSEImes§ge_rb¥
 (
IÅutP¬am‘”s
 *
p_IÅ
, 
id
, 
by‹
 *
rb¥
)

1171 
B™¡»am
 *
b™¡»am
;

1173 
Ën
 = 0, 
L’InBy‹s
;

1174 
	`as£¹
 (
rb¥
 !ð
NULL
);

1176 ià((
b™¡»am
=
	`ÿÎoc
(1, (
B™¡»am
)))==
NULL
)

1177 
	`no_mem_ex™
("SeqParameterSet:bitstream");

1180 
b™¡»am
->
¡»amBufãr
 = 
rb¥
;

1181 
b™¡»am
->
b™s_to_go
 = 8;

1184 
£i_mes§ge
[500] = "";

1185 
uuid_mes§ge
[9] = "Random";

1186 
i
, 
mes§ge_size
 = (è
	`¡¾’
(
p_IÅ
->
SEIMes§geText
);

1187 
TIME_T
 
¡¬t_time
;

1188 
	`g‘time
(&
¡¬t_time
);

1190 ià(
mes§ge_size
 == 0)

1192 
mes§ge_size
 = 13;

1193 
	`¡ºýy
(
£i_mes§ge
,"Em±y Mes§ge",
mes§ge_size
);

1196 
	`¡ºýy
(
£i_mes§ge
,
p_IÅ
->
SEIMes§geText
,
mes§ge_size
);

1198 
Ën
+=
	`wr™e_u_v
 (8,"SEI:†a¡_·ylßd_ty³_by‹", 5, 
b™¡»am
);

1199 
mes§ge_size
 += 17;

1200 
mes§ge_size
 > 254)

1202 
Ën
+=
	`wr™e_u_v
 (8,"SEI: ff_by‹",255, 
b™¡»am
);

1203 
mes§ge_size
 -= 255;

1205 
Ën
+=
	`wr™e_u_v
 (8,"SEI:†a¡_·ylßd_size_by‹",
mes§ge_size
, 
b™¡»am
);

1208 #ifdeà
_WIN32


1209 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è
¡¬t_time
.
HighP¬t
, 
b™¡»am
);

1210 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è
¡¬t_time
.
QuadP¬t
, 
b™¡»am
);

1212 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è
¡¬t_time
.
tv_£c
, 
b™¡»am
);

1213 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è
¡¬t_time
.
tv_u£c
, 
b™¡»am
);

1215 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è(
uuid_mes§ge
[0] << 24è+ (uuid_mes§ge[1] << 16è+ (uuid_mes§ge[2] << 8è+ (uuid_mes§ge[3] << 0), 
b™¡»am
);

1216 
Ën
+=
	`wr™e_u_v
 (32,"SEI: uuid_iso_›c_11578",(è(
uuid_mes§ge
[4] << 24è+ (uuid_mes§ge[5] << 16è+ (uuid_mes§ge[6] << 8è+ (uuid_mes§ge[7] << 0), 
b™¡»am
);

1217 
i
 = 0; i < 
	`¡¾’
(
£i_mes§ge
); i++)

1218 
Ën
+=
	`wr™e_u_v
 (8,"SEI: u£r_d©a_·ylßd_by‹",
£i_mes§ge
[
i
], 
b™¡»am
);

1220 
Ën
+=
	`wr™e_u_v
 (8,"SEI: u£r_d©a_·ylßd_by‹", 0, 
b™¡»am
);

1222 
	`SODBtoRBSP
(
b™¡»am
);

1224 
L’InBy‹s
=
b™¡»am
->
by‹_pos
;

1226 
	`ä“
(
b™¡»am
);

1227  
L’InBy‹s
;

1228 
	}
}

1243 
	$Wr™eHRDP¬am‘”s
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
B™¡»am
 *
b™¡»am
)

1246 
Ën
 = 0;

1247 
SchedS–Idx
 = 0;

1248 
hrd_·¿m‘”s_t
 *
hrd
 = &(
¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
);

1250 
Ën
+=
	`wr™e_ue_v
 ("VUI: cpb_út_mšus1", 
hrd
->
ýb_út_mšus1
, 
b™¡»am
);

1251 
Ën
+=
	`wr™e_u_v
 (4, "VUI: b™_¿‹_sÿË", 
hrd
->
b™_¿‹_sÿË
, 
b™¡»am
);

1252 
Ën
+=
	`wr™e_u_v
 (4, "VUI: cpb_size_sÿË", 
hrd
->
ýb_size_sÿË
, 
b™¡»am
);

1254  
SchedS–Idx
 = 0; SchedS–Idx <ð(
hrd
->
ýb_út_mšus1
); SchedSelIdx++ )

1256 
Ën
+=
	`wr™e_ue_v
 ("VUI: b™_¿‹_v®ue_mšus1", 
hrd
->
b™_¿‹_v®ue_mšus1
[
SchedS–Idx
], 
b™¡»am
);

1257 
Ën
+=
	`wr™e_ue_v
 ("VUI: cpb_size_v®ue_mšus1", 
hrd
->
ýb_size_v®ue_mšus1
[
SchedS–Idx
], 
b™¡»am
);

1258 
Ën
+=
	`wr™e_u_1
 ("VUI: cbr_æag", 
hrd
->
cbr_æag
[
SchedS–Idx
], 
b™¡»am
);

1261 
Ën
+=
	`wr™e_u_v
 (5, "VUI: in™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1", 
hrd
->
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
, 
b™¡»am
);

1262 
Ën
+=
	`wr™e_u_v
 (5, "VUI: cpb_»mov®_d–ay_Ëngth_mšus1", 
hrd
->
ýb_»mov®_d–ay_Ëngth_mšus1
, 
b™¡»am
);

1263 
Ën
+=
	`wr™e_u_v
 (5, "VUI: dpb_ouut_d–ay_Ëngth_mšus1", 
hrd
->
dpb_ouut_d–ay_Ëngth_mšus1
, 
b™¡»am
);

1264 
Ën
+=
	`wr™e_u_v
 (5, "VUI:ime_off£t_Ëngth", 
hrd
->
time_off£t_Ëngth
, 
b™¡»am
);

1266  
Ën
;

1267 
	}
}

1277 
	$g‘MaxDpbSize
(
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
)

1279 
pic_size
 = (
aùive_¥s
->
pic_width_š_mbs_mšus1
 + 1è* (aùive_¥s->
pic_height_š_m­_un™s_mšus1
 + 1è* (aùive_¥s->
äame_mbs_Úly_æag
?1:2) * 384;

1281 
size
 = 0;

1283 
aùive_¥s
->
Ëv–_idc
)

1286 
size
 = 152064;

1289 
size
 = 152064;

1292 ià(!
	`is_FREXT_´ofže
(
aùive_¥s
->
´ofže_idc
è&& (aùive_¥s->
cÚ¡¿šed_£t3_æag
 == 1))

1293 
size
 = 152064;

1295 
size
 = 345600;

1298 
size
 = 912384;

1301 
size
 = 912384;

1304 
size
 = 912384;

1307 
size
 = 1824768;

1310 
size
 = 3110400;

1313 
size
 = 3110400;

1316 
size
 = 6912000;

1319 
size
 = 7864320;

1322 
size
 = 12582912;

1325 
size
 = 12582912;

1328 
size
 = 13369344;

1331 
size
 = 42393600;

1334 
size
 = 70778880;

1337 
size
 = 70778880;

1340 
	`”rÜ
 ("undefined†evel", 500);

1344 
size
 /ð
pic_size
;

1345 
size
 = 
	`imš
( size, 16);

1347  
size
;

1348 
	}
}

1363 
	$G’”©eVUIP¬am‘”s
(
£q_·¿m‘”_£t_rb¥_t
 *
¥s
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1365 
SchedS–Idx
;

1366 
hrd_·¿m‘”s_t
 *
Çl_hrd
 = &(
¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
);

1367 
hrd_·¿m‘”s_t
 *
vþ_hrd
 = &(
¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
);

1368 
vui_£q_·¿m‘”s_t
 *
vui
 = &(
¥s
->
vui_£q_·¿m‘”s
);

1369 
VUIP¬am‘”s
 *
iVui
 = &
p_IÅ
->
VUI
;

1371 
vui
->
a¥eù_¿tio_šfo_´e£Á_æag
 = (
BoÞ—n
è
iVui
->aspect_ratio_info_present_flag;

1372 
vui
->
a¥eù_¿tio_idc
 = (è
iVui
->aspect_ratio_idc;

1373 
vui
->
§r_width
 = (è
iVui
->sar_width;

1374 
vui
->
§r_height
 = (è
iVui
->sar_height;

1375 
vui
->
ov”sÿn_šfo_´e£Á_æag
 = (
BoÞ—n
è
iVui
->overscan_info_present_flag;

1376 
vui
->
ov”sÿn_­´ÝrŸ‹_æag
 = (
BoÞ—n
è
iVui
->overscan_appropriate_flag;

1377 
vui
->
video_sigÇl_ty³_´e£Á_æag
 = (
BoÞ—n
è
iVui
->video_signal_type_present_flag;

1378 
vui
->
video_fÜm©
 = (è
iVui
->video_format;

1379 
vui
->
video_fuÎ_¿nge_æag
 = (
BoÞ—n
è
iVui
->video_full_range_flag;

1380 
vui
->
cÞour_desütiÚ_´e£Á_æag
 = (
BoÞ—n
è
iVui
->colour_description_present_flag;

1381 
vui
->
cÞour_´im¬›s
 = (è
iVui
->colour_primaries;

1382 
vui
->
Œªsãr_ch¬aù”i¡ics
 = (è
iVui
->transfer_characteristics;

1383 
vui
->
m©rix_cÛffic›Ás
 = (è
iVui
->matrix_coefficients;

1384 
vui
->
chroma_loÿtiÚ_šfo_´e£Á_æag
 = (
BoÞ—n
è
iVui
->chroma_location_info_present_flag;

1385 
vui
->
chroma_§m¶e_loc_ty³_tÝ_f›ld
 = (è
iVui
->chroma_sample_loc_type_top_field;

1386 
vui
->
chroma_§m¶e_loc_ty³_bÙtom_f›ld
 = (è
iVui
->chroma_sample_loc_type_bottom_field;

1387 
vui
->
timšg_šfo_´e£Á_æag
 = (
BoÞ—n
è
iVui
->timing_info_present_flag;

1388 
vui
->
num_un™s_š_tick
 = (è
iVui
->num_units_in_tick;

1389 
vui
->
time_sÿË
 = (è
iVui
->time_scale;

1390 
vui
->
fixed_äame_¿‹_æag
 = (
BoÞ—n
è
iVui
->fixed_frame_rate_flag;

1393 
vui
->
Çl_hrd_·¿m‘”s_´e£Á_æag
 = (
BoÞ—n
è
iVui
->nal_hrd_parameters_present_flag;

1394 
Çl_hrd
->
ýb_út_mšus1
 = (è
iVui
->
Çl_ýb_út_mšus1
;

1395 
Çl_hrd
->
b™_¿‹_sÿË
 = (è
iVui
->
Çl_b™_¿‹_sÿË
;

1396 
Çl_hrd
->
ýb_size_sÿË
 = (è
iVui
->
Çl_ýb_size_sÿË
;

1397  
SchedS–Idx
 = 0; SchedS–Idx <ð
Çl_hrd
->
ýb_út_mšus1
; SchedSelIdx++ )

1399 
Çl_hrd
->
b™_¿‹_v®ue_mšus1
[
SchedS–Idx
] = (è
iVui
->
Çl_b™_¿‹_v®ue_mšus1
;

1400 
Çl_hrd
->
ýb_size_v®ue_mšus1
[
SchedS–Idx
] = (è
iVui
->
Çl_ýb_size_v®ue_mšus1
;

1401 
Çl_hrd
->
cbr_æag
[
SchedS–Idx
] = (è
iVui
->
Çl_vbr_cbr_æag
;

1403 
Çl_hrd
->
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 = (è
iVui
->
Çl_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

1404 
Çl_hrd
->
ýb_»mov®_d–ay_Ëngth_mšus1
 = (è
iVui
->
Çl_ýb_»mov®_d–ay_Ëngth_mšus1
;

1405 
Çl_hrd
->
dpb_ouut_d–ay_Ëngth_mšus1
 = (è
iVui
->
Çl_dpb_ouut_d–ay_Ëngth_mšus1
;

1406 
Çl_hrd
->
time_off£t_Ëngth
 = (è
iVui
->
Çl_time_off£t_Ëngth
;

1409 
vui
->
vþ_hrd_·¿m‘”s_´e£Á_æag
 = (
BoÞ—n
è
iVui
->vcl_hrd_parameters_present_flag;

1410 
vþ_hrd
->
ýb_út_mšus1
 = (è
iVui
->
vþ_ýb_út_mšus1
;

1411 
vþ_hrd
->
b™_¿‹_sÿË
 = (è
iVui
->
vþ_b™_¿‹_sÿË
;

1412 
vþ_hrd
->
ýb_size_sÿË
 = (è
iVui
->
vþ_ýb_size_sÿË
;

1413  
SchedS–Idx
 = 0; SchedS–Idx <ð
vþ_hrd
->
ýb_út_mšus1
; SchedSelIdx++ )

1415 
vþ_hrd
->
b™_¿‹_v®ue_mšus1
[
SchedS–Idx
] = (è
iVui
->
vþ_b™_¿‹_v®ue_mšus1
;

1416 
vþ_hrd
->
ýb_size_v®ue_mšus1
[
SchedS–Idx
] = (è
iVui
->
vþ_ýb_size_v®ue_mšus1
;

1417 
vþ_hrd
->
cbr_æag
[
SchedS–Idx
] = (è
iVui
->
vþ_vbr_cbr_æag
;

1419 
vþ_hrd
->
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 = (è
iVui
->
vþ_š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
;

1420 
vþ_hrd
->
ýb_»mov®_d–ay_Ëngth_mšus1
 = (è
iVui
->
vþ_ýb_»mov®_d–ay_Ëngth_mšus1
;

1421 
vþ_hrd
->
dpb_ouut_d–ay_Ëngth_mšus1
 = (è
iVui
->
vþ_dpb_ouut_d–ay_Ëngth_mšus1
;

1422 
vþ_hrd
->
time_off£t_Ëngth
 = (è
iVui
->
vþ_time_off£t_Ëngth
;

1424 
vui
->
low_d–ay_hrd_æag
 = (
BoÞ—n
è
iVui
->low_delay_hrd_flag;

1425 
vui
->
pic_¡ruù_´e£Á_æag
 = (
BoÞ—n
è
iVui
->pic_struct_present_flag;

1426 
vui
->
b™¡»am_»¡riùiÚ_æag
 = (
BoÞ—n
è
iVui
->bitstream_restriction_flag;

1427 
vui
->
mÙiÚ_veùÜs_ov”_pic_bound¬›s_æag
 = (
BoÞ—n
è
iVui
->motion_vectors_over_pic_boundaries_flag;

1428 
vui
->
max_by‹s_³r_pic_d’om
 = (è
iVui
->max_bytes_per_pic_denom;

1429 
vui
->
max_b™s_³r_mb_d’om
 = (è
iVui
->max_bits_per_mb_denom;

1430 
vui
->
log2_max_mv_Ëngth_hÜizÚl
 = (è
iVui
->log2_max_mv_length_horizontal;

1431 
vui
->
log2_max_mv_Ëngth_v”tiÿl
 = (è
iVui
->log2_max_mv_length_vertical;

1432 
vui
->
max_dec_äame_bufãršg
 = (è
	`imš
Ð
iVui
->max_dec_äame_bufãršg, 
	`g‘MaxDpbSize
(
¥s
) );

1433 
vui
->
num_»Üd”_äames
 = (è
	`imš
Ð
iVui
->num_»Üd”_äames, ()vui->
max_dec_äame_bufãršg
 );

1436 ià(
p_IÅ
->
ouut
.
cÞÜ_mod–
 !ð
CM_YUV
 &&…_IÅ->ouut.
yuv_fÜm©
 =ð
YUV444
)

1438 
	`´štf
 ("VUI: writing Sequence Parameter VUIo signal RGB format\n");

1440 
vui
->
a¥eù_¿tio_šfo_´e£Á_æag
 = 
FALSE
;

1441 
vui
->
ov”sÿn_šfo_´e£Á_æag
 = 
FALSE
;

1442 
vui
->
video_sigÇl_ty³_´e£Á_æag
 = 
TRUE
;

1443 
vui
->
video_fÜm©
 = 2;

1444 
vui
->
video_fuÎ_¿nge_æag
 = 
TRUE
;

1445 
vui
->
cÞour_desütiÚ_´e£Á_æag
 = 
TRUE
;

1446 
vui
->
cÞour_´im¬›s
 = 2;

1447 
vui
->
Œªsãr_ch¬aù”i¡ics
 = 2;

1448 
vui
->
m©rix_cÛffic›Ás
 = 0;

1449 
vui
->
chroma_loÿtiÚ_šfo_´e£Á_æag
 = 
FALSE
;

1450 
vui
->
timšg_šfo_´e£Á_æag
 = 
FALSE
;

1451 
vui
->
Çl_hrd_·¿m‘”s_´e£Á_æag
 = 
FALSE
;

1452 
vui
->
vþ_hrd_·¿m‘”s_´e£Á_æag
 = 
FALSE
;

1453 
vui
->
pic_¡ruù_´e£Á_æag
 = 
FALSE
;

1454 
vui
->
b™¡»am_»¡riùiÚ_æag
 = 
FALSE
;

1456 
	}
}

	@lencod/src/pred_struct.c

17 
	~"´ed_¡ruù.h
"

18 
	~"ex¶ic™_£q.h
"

20 
	#DEBUG_PRED_STRUCT
 0

	)

22 
šlše
 
pÝ_´ed_¡ruù_äm
Ð
P»dSŒuùFrm
 *
p_d¡
, 
¦iû_ty³
, 
Çl_»f_idc
, 
di¥_off£t
, 
Ïy”
, 
¦iû_qp_off
,

23 
¿ndom_acûss
, 
‹mpÜ®_Ïy”
 );

24 
š™_gÝ_¡ruù
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
is_idr
, *
memÜy_size
 );

25 
ä“_gÝ_¡ruù
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 );

26 
š™_´ed_¡ruù
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, *
memÜy_size
 );

27 
ä“_´ed_¡ruù
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 );

28 
PicSŒuùu»
 * 
®loc_pic_¡ruù
Ð
num_¦iûs
, *
memÜy_size
 );

29 
ä“_pic_¡ruù
Ð
PicSŒuùu»
 *
p_pic
 );

30 
F¿meUn™SŒuù
 * 
®loc_äame_bufãr
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
num_äames
, 
num_¦iûs
, *
memÜy_size
 );

31 
ä“_äame_bufãr
Ð
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_äames
 );

33 
¿nd_acc_‹¡_¿nge
Ð
cu¼_äame
, 
off£t
, 
idr_³riod
 );

34 
šlše
 
check_pow”_of_two
Ð
numb”
 );

35 
e¡ablish_¿ndom_acûss
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 );

36 
e¡ablish_šŒa
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 );

37 
e¡ablish_¥
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 );

38 
g‘_fixed_äame
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
 );

39 
g‘_´d_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 );

40 
g‘_idr_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 );

41 
g‘_šŒa_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 );

42 
pÝuÏ‹_äame
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
P»dSŒuùAtom
 *
p_cur_´d
,

43 
cu¼_äame
, 
´ed_äame
, 
idx
, 
num_¦iûs
, 
no_ºd_acc
 );

44 
upd©e_äame_šdiûs
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
cu¼_äame
, 
´ed_äame
 );

45 
pÝuÏ‹_»g_´ed_¡ruù_©om
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
,

46 
cu¼_äame
, 
´oc_äames
, *
‹rmš©e_pÝ
 );

47 
pÝuÏ‹_ºd_acc_´ed_¡ruù_©om
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
,

48 
cu¼_äame
, 
´oc_äames
, *
‹rmš©e_pÝ
, 
is_idr
, 
no_ºd_acc
 );

49 #ià(
MVC_EXTENSION_ENABLE
)

50 
cÝy_äame_mvc
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_¤c
, F¿meUn™SŒuù *
p_d¡
, 
num_¦iûs
, 
v›w_id
 );

66 
	$g‘_poc_ty³_z”o
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
 )

68 
F¿meUn™SŒuù
 *
p_cur
 = 
p_äm_¡ruù
;

69 
Ï¡_di¥_Üd”
;

71 iàÐ
p_Vid
->
Ï¡_idr_code_Üd”
 >…_Vid->
Ï¡_mmco_5_code_Üd”
 )

73 
Ï¡_di¥_Üd”
 = 
p_Vid
->
Ï¡_idr_di¥_Üd”
;

77 
Ï¡_di¥_Üd”
 = 
p_Vid
->
Ï¡_mmco_5_di¥_Üd”
;

80 iàÐ
p_cur
->
idr_æag
 )

82 
p_Vid
->
tÝpoc
 = 0;

86 
p_Vid
->
tÝpoc
 = (
p_cur
->
äame_no
 - 
Ï¡_di¥_Üd”
) << 1;

89 
p_Vid
->
tÝpoc
 = (1 + 
p_IÅ
->
äame_sk
) *…_Vid->toppoc;

91 iàÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
FRAME_CODING
 &&…_IÅ->
MbIÁ”Ïû
 == FRAME_CODING )

93 
p_Vid
->
bÙtompoc
 =…_Vid->
tÝpoc
;

97 
p_Vid
->
bÙtompoc
 =…_Vid->
tÝpoc
 + 1;

100 
p_Vid
->
äam•oc
 = 
	`imš
Ðp_Vid->
tÝpoc
,…_Vid->
bÙtompoc
 );

101 
	}
}

116 
	$g‘_poc_ty³_Úe
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
 )

118 
F¿meUn™SŒuù
 *
p_cur
 = 
p_äm_¡ruù
;

119 
i
;

120 
AbsF¿meNum
;

121 
Ex³ùedD–P”PicOrd”CÁCyþe
;

122 
PicOrd”CÁCyþeCÁ
;

123 
F¿meNumInPicOrd”CÁCyþe
;

124 
Ex³ùedPicOrd”CÁ
;

125 
CodšgP¬am‘”s
 *
p_EncodeP¬
 = 
p_Vid
->p_EncodeP¬[p_Vid->
dpb_Ïy”_id
];

128 
	`g‘_poc_ty³_z”o
Ð
p_Vid
, 
p_IÅ
, 
p_äm_¡ruù
 );

133 iàÐ
p_cur
->
idr_æag
 )

135 
p_Vid
->
F¿meNumOff£t
 = 0;

136 
p_Vid
->
d–_pic_Üd”_út
[0] = 0;

140 iàÐ
p_Vid
->
Ï¡_has_mmco_5
 )

142 
p_EncodeP¬
->
´evF¿meNumOff£t
 = 0;

143 
p_EncodeP¬
->
´evF¿meNum
 = 0;

145 iàÐ
p_Vid
->
äame_num
 < 
p_EncodeP¬
->
´evF¿meNum
 )

147 
p_Vid
->
F¿meNumOff£t
 = 
p_EncodeP¬
->
´evF¿meNumOff£t
 +…_Vid->
max_äame_num
;

151 
p_Vid
->
F¿meNumOff£t
 = 
p_EncodeP¬
->
´evF¿meNumOff£t
;

156 iàÐ
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
 )

158 
AbsF¿meNum
 = 
p_Vid
->
F¿meNumOff£t
 +…_Vid->
äame_num
;

162 
AbsF¿meNum
=0;

164 iàÐ!(
p_cur
->
Çl_»f_idc
è&& 
AbsF¿meNum
 > 0 )

166 
AbsF¿meNum
--;

170 
Ex³ùedD–P”PicOrd”CÁCyþe
=0;

171 iàÐ
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
 )

173  
i
 = 0; i < (è
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
; i++ )

175 
Ex³ùedD–P”PicOrd”CÁCyþe
 +ð
p_Vid
->
off£t_fÜ_»f_äame
[
i
];

179 iàÐ
AbsF¿meNum
 )

181 
PicOrd”CÁCyþeCÁ
 = (
AbsF¿meNum
 - 1è/ 
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
;

182 
F¿meNumInPicOrd”CÁCyþe
 = (
AbsF¿meNum
 - 1è% 
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
;

184 
Ex³ùedPicOrd”CÁ
 = 
PicOrd”CÁCyþeCÁ
 * 
Ex³ùedD–P”PicOrd”CÁCyþe
;

185  
i
 = 0; i <ð()
F¿meNumInPicOrd”CÁCyþe
; i++ )

187 
Ex³ùedPicOrd”CÁ
 +ð
p_Vid
->
off£t_fÜ_»f_äame
[
i
];

192 
Ex³ùedPicOrd”CÁ
 = 0;

195 iàÐ!(
p_cur
->
Çl_»f_idc
) )

197 
Ex³ùedPicOrd”CÁ
 +ð
p_Vid
->
off£t_fÜ_nÚ_»f_pic
;

200 
p_Vid
->
d–_pic_Üd”_út
[0] =…_Vid->
tÝpoc
 - 
Ex³ùedPicOrd”CÁ
;

201 
p_Vid
->
d–_pic_Üd”_út
[1] = 0;

204 
p_Vid
->
´evF¿meNum
 = 
p_EncodeP¬
->´evF¿meNum =…_Vid->
äame_num
;

205 
p_Vid
->
´evF¿meNumOff£t
 = 
p_EncodeP¬
->´evF¿meNumOff£ˆðp_Vid->
F¿meNumOff£t
;

206 
	}
}

218 
	$š™_poc
(
VideoP¬am‘”s
 *
p_Vid
)

220 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

222 
p_Vid
->
pic_Üd”_út_ty³
 = 
p_IÅ
->pic_order_cnt_type;

223 ià((
p_IÅ
->
PicIÁ”Ïû
 =ð
FRAME_CODING
è&& (p_IÅ->
MbIÁ”Ïû
 == FRAME_CODING))

225 
p_Vid
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 = 
FALSE
;

229 
p_Vid
->
bÙtom_f›ld_pic_Üd”_š_äame_´e£Á_æag
 = 
TRUE
;

233 ià((
p_IÅ
->
PicIÁ”Ïû
==
FRAME_CODING
è&& (p_IÅ->
MbIÁ”Ïû
==FRAME_CODING))

235 
p_Vid
->
d–_pic_Üd”_út_bÙtom
 = 0;

239 
p_Vid
->
d–_pic_Üd”_út_bÙtom
 = 1;

244 
p_Vid
->
d–_pic_Üd”_®ways_z”o_æag
 = 
FALSE
;

245 
p_Vid
->
num_»f_äames_š_pic_Üd”_út_cyþe
 = 1;

248 ià(
p_IÅ
->
BRefPiùu»s
 == 1)

250 
p_Vid
->
off£t_fÜ_nÚ_»f_pic
 = 0;

251 
p_Vid
->
off£t_fÜ_»f_äame
[0] = 2;

255 
p_Vid
->
off£t_fÜ_nÚ_»f_pic
 = -2*(
p_IÅ
->
Numb”BF¿mes
);

256 
p_Vid
->
off£t_fÜ_»f_äame
[0] = 2*(
p_IÅ
->
Numb”BF¿mes
 + 1);

259 ià((
p_IÅ
->
PicIÁ”Ïû
==
FRAME_CODING
è&& (p_IÅ->
MbIÁ”Ïû
==FRAME_CODING))

261 
p_Vid
->
off£t_fÜ_tÝ_to_bÙtom_f›ld
 = 0;

265 
p_Vid
->
off£t_fÜ_tÝ_to_bÙtom_f›ld
 = 1;

267 
	}
}

282 
PicSŒuùu»
 * 
	$®loc_pic_¡ruù
Ð
num_¦iûs
, *
memÜy_size
 )

284 
PicSŒuùu»
 *
p_pic
 = (PicSŒuùu» *)
	`m®loc
( ( PicStructure ) );

285 iàÐ
p_pic
 =ð
NULL
 )

287 
	`årštf
(
¡d”r
, "\nNotƒnough memory orƒrror during memory‡llocation:‡lloc_pic_struct()");

288 
	`ex™
(1);

290 *
memÜy_size
 +ðÐ
PicSŒuùu»
 );

292 
p_pic
->
num_¦iûs
 =‚um_slices;

293 
p_pic
->
p_Sliû
 = (
SliûSŒuùu»
 *)
	`m®loc
Ð
num_¦iûs
 * ( SliceStructure ) );

294 iàÐ
p_pic
->
p_Sliû
 =ð
NULL
 )

296 
	`årštf
(
¡d”r
, "\nNotƒnough memory orƒrror during memory‡llocation:‡lloc_pic_struct()");

297 
	`ex™
(1);

299 *
memÜy_size
 +ð(
num_¦iûs
 * Ð
SliûSŒuùu»
 ));

301  
p_pic
;

302 
	}
}

313 
	$ä“_pic_¡ruù
Ð
PicSŒuùu»
 *
p_pic
 )

315 iàÐ
p_pic
 !ð
NULL
 )

317 iàÐ
p_pic
->
p_Sliû
 !ð
NULL
 )

319 
	`ä“
Ð
p_pic
->
p_Sliû
 );

320 
p_pic
->
p_Sliû
 = 
NULL
;

322 
	`ä“
Ð
p_pic
 );

324 
	}
}

343 
F¿meUn™SŒuù
 * 
	$®loc_äame_bufãr
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
num_äames
, 
num_¦iûs
, *
memÜy_size
 )

345 
idx
;

348 
F¿meUn™SŒuù
 *
p_äm_¡ruù
 = (F¿meUn™SŒuù *)
	`m®loc
Ð
num_äames
 * ( FrameUnitStruct ) );

349 
F¿meUn™SŒuù
 *
p_äm_tmp
;

351 iàÐ
p_äm_¡ruù
 =ð
NULL
 )

353 
	`årštf
(
¡d”r
, "\nNotƒnough memory orƒrror during memory‡llocation:‡lloc_frame_buffer()");

354 
	`ex™
(1);

356 *
memÜy_size
 +ð
num_äames
 * Ð
F¿meUn™SŒuù
 );

358  
idx
 = 0; idx < 
num_äames
; idx++ )

360 
p_äm_tmp
 = 
p_äm_¡ruù
 + 
idx
;

362  
p_IÅ
->
PicIÁ”Ïû
 )

365 
FRAME_CODING
:

366 
p_äm_tmp
->
f›ld_pic_æag
 = 0;

367 
p_äm_tmp
->
p_tÝ_æd_pic
 = 
NULL
;

368 
p_äm_tmp
->
p_bÙ_æd_pic
 = 
NULL
;

369 
p_äm_tmp
->
p_äame_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

371 
FIELD_CODING
:

372 
p_äm_tmp
->
f›ld_pic_æag
 = 1;

373 
p_äm_tmp
->
p_tÝ_æd_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

374 
p_äm_tmp
->
p_bÙ_æd_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

375 
p_äm_tmp
->
p_äame_pic
 = 
NULL
;

377 
ADAPTIVE_CODING
:

378 
p_äm_tmp
->
p_tÝ_æd_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

379 
p_äm_tmp
->
p_bÙ_æd_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

380 
p_äm_tmp
->
p_äame_pic
 = 
	`®loc_pic_¡ruù
Ð
num_¦iûs
, 
memÜy_size
 );

385  
p_äm_¡ruù
;

386 
	}
}

399 
	$ä“_äame_bufãr
Ð
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_äames
 )

401 
idx
;

402 
F¿meUn™SŒuù
 *
p_äm_tmp
;

404 iàÐ
p_äm_¡ruù
 !ð
NULL
 )

406  
idx
 = 0; idx < 
num_äames
; idx++ )

408 
p_äm_tmp
 = 
p_äm_¡ruù
 + 
idx
;

410 
	`ä“_pic_¡ruù
Ð
p_äm_tmp
->
p_tÝ_æd_pic
 );

411 
p_äm_tmp
->
p_tÝ_æd_pic
 = 
NULL
;

413 
	`ä“_pic_¡ruù
Ð
p_äm_tmp
->
p_bÙ_æd_pic
 );

414 
p_äm_tmp
->
p_bÙ_æd_pic
 = 
NULL
;

416 
	`ä“_pic_¡ruù
Ð
p_äm_tmp
->
p_äame_pic
 );

417 
p_äm_tmp
->
p_äame_pic
 = 
NULL
;

420 
	`ä“
Ð
p_äm_¡ruù
 );

422 
	}
}

439 
SeqSŒuùu»
 * 
	$š™_£q_¡ruùu»
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, *
memÜy_size
 )

441 #ià(
MVC_EXTENSION_ENABLE
)

442 
¡¬t
, 
’d
;

444 
SeqSŒuùu»
 *
p_£q_¡ruù
 = (SeqSŒuùu» *)
	`m®loc
( ( SeqStructure ) );

445 
äames_to_pÝ
;

447 iàÐ
p_£q_¡ruù
 =ð
NULL
 )

449 
	`årštf
(
¡d”r
, "\nNotƒnough memory orƒrror during memory‡llocation: init_seq_structure()");

450 
	`ex™
(1);

454 
p_IÅ
->
FrmSŒuùBufãrL’gth
 = 
	`imax
Ðp_IÅ->FrmSŒuùBufãrL’gth, imaxÐp_IÅ->
idr_³riod
,…_IÅ->
šŒa_³riod
 ) +…_IÅ->
Numb”BF¿mes
 +…_IÅ->
šŒa_d–ay
 + 2 );

455 
p_Vid
->
äm_¡ruù_bufãr
 = 
p_IÅ
->
FrmSŒuùBufãrL’gth
;

456 
p_Vid
->
äm_¡ruù_bufãr
 = 
	`imš
Ðp_Vid->äm_¡ruù_bufãr, 
p_IÅ
->
no_äames
 );

457 
p_IÅ
->
FrmSŒuùBufãrL’gth
 = 
	`imš
Ðp_IÅ->FrmSŒuùBufãrL’gth,…_IÅ->
no_äames
 );

459 
p_IÅ
->
FrmSŒuùBufãrL’gth
 =…_IÅ->
no_äames
;

460 
p_Vid
->
äm_¡ruù_bufãr
 = 
p_IÅ
->
no_äames
;

462 *
memÜy_size
 +ðÐ
SeqSŒuùu»
 );

464 
p_£q_¡ruù
->
max_num_¦iûs
 = (
p_IÅ
->
¦iû_mode
 =ð1è? 
	`imax
(1, 
p_Vid
->
F¿meSizeInMbs
 /…_IÅ->
¦iû_¬gum’t
) : 1;

465 
p_£q_¡ruù
->
num_äames
 = 
p_Vid
->
äm_¡ruù_bufãr
;

466 
p_£q_¡ruù
->
p_äm
 = 
	`®loc_äame_bufãr
Ð
p_IÅ
,…_£q_¡ruù->
num_äames
,…_£q_¡ruù->
max_num_¦iûs
, 
memÜy_size
 );

467 
p_£q_¡ruù
->
Ï¡_¿ndom_acûss_äame
 = 0;

468 
p_£q_¡ruù
->
Ï¡_idr_äame
 = 0;

469 
p_£q_¡ruù
->
Ï¡_šŒa_äame
 = 0;

470 
p_£q_¡ruù
->
Ï¡_mmco_5_äame
 = -1;

471 
p_£q_¡ruù
->
cu¼_num_to_pÝuÏ‹
 = 
p_Vid
->
äm_¡ruù_bufãr
;

472 
p_£q_¡ruù
->
pÝ_¡¬t_äame
 = 0;

473 
p_£q_¡ruù
->
Ï¡_¿nd_acûss_di¥
 = 0;

474 
p_£q_¡ruù
->
Ï¡_idr_di¥
 = 0;

475 
p_£q_¡ruù
->
Ï¡_šŒa_di¥
 = 0;

476 
p_£q_¡ruù
->
Ï¡_bl_äm_di¥o§bË
 = 0;

477 
p_£q_¡ruù
->
Ï¡_¥_äame
 = 0;

478 
p_£q_¡ruù
->
Ï¡_¥_di¥
 = 0;

479 
p_£q_¡ruù
->
pÝ_æag
 = 0;

481 #ià(
MVC_EXTENSION_ENABLE
)

482 
p_£q_¡ruù
->
num_äames_mvc
 =…_£q_¡ruù->
num_äames
 * 
p_IÅ
->
num_of_v›ws
;

483 
p_£q_¡ruù
->
p_äm_mvc
 = 
	`®loc_äame_bufãr
Ð
p_IÅ
,…_£q_¡ruù->
num_äames_mvc
,…_£q_¡ruù->
max_num_¦iûs
, 
memÜy_size
 );

487 
	`š™_´ed_¡ruù
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
memÜy_size
 );

488 
	`š™_gÝ_¡ruù
 ( 
p_IÅ
, 
p_£q_¡ruù
, 1, 
memÜy_size
 );

489 
	`š™_gÝ_¡ruù
 ( 
p_IÅ
, 
p_£q_¡ruù
, 0, 
memÜy_size
 );

491 
äames_to_pÝ
 = 
p_Vid
->
äm_¡ruù_bufãr
;

494 #ià(
MVC_EXTENSION_ENABLE
)

495 
¡¬t
 = 
p_£q_¡ruù
->
pÝ_¡¬t_äame
;

496 
	`pÝuÏ‹_äm_¡ruù
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
äames_to_pÝ
,…_IÅ->
no_äames
 );

498 iàÐ
p_IÅ
->
num_of_v›ws
 > 1 )

500 
	`as£¹
Ð
p_IÅ
->
num_of_v›ws
 < 4 );

501 
’d
 = 
p_£q_¡ruù
->
pÝ_¡¬t_äame
;

502 
	`pÝuÏ‹_äm_¡ruù_mvc
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
¡¬t
, 
’d
 );

505 
	`pÝuÏ‹_äm_¡ruù
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
äames_to_pÝ
,…_IÅ->
no_äames
 );

508  
p_£q_¡ruù
;

509 
	}
}

520 
	$ä“_£q_¡ruùu»
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 )

522 
	`ä“_äame_bufãr
Ð
p_£q_¡ruù
->
p_äm
,…_£q_¡ruù->
num_äames
 );

523 
p_£q_¡ruù
->
p_äm
 = 
NULL
;

524 #ià(
MVC_EXTENSION_ENABLE
)

525 
	`ä“_äame_bufãr
Ð
p_£q_¡ruù
->
p_äm_mvc
,…_£q_¡ruù->
num_äames_mvc
 );

526 
p_£q_¡ruù
->
p_äm_mvc
 = 
NULL
;

528 
	`ä“_gÝ_¡ruù
Ð
p_£q_¡ruù
 );

529 
p_£q_¡ruù
->
p_gÝ
 = 
NULL
;

530 
	`ä“_´ed_¡ruù
Ð
p_£q_¡ruù
 );

531 
p_£q_¡ruù
->
p_´d
 = 
NULL
;

533 iàÐ
p_£q_¡ruù
 !ð
NULL
 )

535 
	`ä“
Ð
p_£q_¡ruù
 );

537 
	}
}

559 
	$e¡ablish_¿ndom_acûss
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 )

561 
d–
;

562 
is_¿ndom_acûss
 = 0;

564 iàÐ!
cu¼_äame
 )

566 iàÐ!(
p_IÅ
->
P»ãrDi¥Ord”
) )

568 
is_¿ndom_acûss
 = 1;

572 
idx
;

573 
P»dSŒuùAtom
 *
p_cur_gÝ
;

577  
idx
 = (
p_£q_¡ruù
->
num_gÝs
 - 1); idx >= 0; idx-- )

579 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
idx
;

581 iàÐ
sim
 )

583 iàÐ(
cu¼_äame
 + 
p_cur_gÝ
->
Ëngth
è<ð
p_IÅ
->
no_äames
 )

585 
is_¿ndom_acûss
 = 1 + 
idx
;

591 iàÐ
p_cur_gÝ
->
Ëngth
 <ð
avaž_äames
 )

593 
is_¿ndom_acûss
 = 1 + 
idx
;

600 iàÐ
p_IÅ
->
idr_³riod
 )

602 iàÐ!(
p_IÅ
->
P»ãrDi¥Ord”
) )

604  
p_IÅ
->
ad­tive_idr_³riod
 )

608 iàÐ
cu¼_äame
 % 
p_IÅ
->
idr_³riod
 == 0 )

610 
is_¿ndom_acûss
 = 1;

614 
d–
 = 
cu¼_äame
 - 
p_£q_¡ruù
->
Ï¡_¿ndom_acûss_äame
;

615 iàÐ
d–
 >ð
p_IÅ
->
idr_³riod
 && d– >ðp_IÅ->
MšIDRDi¡ªû
 )

617 
is_¿ndom_acûss
 = 1;

621 
d–
 = 
cu¼_äame
 - 
	`imax
Ð
p_£q_¡ruù
->
Ï¡_¿ndom_acûss_äame
,…_£q_¡ruù->
Ï¡_šŒa_äame
);

622 iàÐ
d–
 >ð
p_IÅ
->
idr_³riod
 && d– >ðp_IÅ->
MšIDRDi¡ªû
 )

624 
is_¿ndom_acûss
 = 1;

631 
idx
;

632 
off£t
;

633 
P»dSŒuùAtom
 *
p_cur_gÝ
;

637  
idx
 = (
p_£q_¡ruù
->
num_gÝs
 - 1); idx >= 0; idx-- )

639 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
idx
;

641 iàÐ
sim
 )

643 iàÐ(
cu¼_äame
 + 
p_cur_gÝ
->
Ëngth
è> 
p_IÅ
->
no_äames
 )

650 iàÐ
p_cur_gÝ
->
Ëngth
 > 
avaž_äames
 )

656 
off£t
 = 
p_cur_gÝ
->
p_äm
[0].
di¥_off£t
;

659  
p_IÅ
->
ad­tive_idr_³riod
 )

663 iàÐ!
cu¼_äame
 || (cu¼_äam+ 
off£t
 - 
p_IÅ
->
šŒa_d–ay
è%…_IÅ->
idr_³riod
 == 0 )

665 
is_¿ndom_acûss
 = 1 + 
idx
;

669 
d–
 = (
cu¼_äame
 + 
off£t
è- 
p_£q_¡ruù
->
Ï¡_¿nd_acûss_di¥
;

670 iàÐ!
cu¼_äame
 || (
d–
 >ð
p_IÅ
->
idr_³riod
 && d– >ðp_IÅ->
MšIDRDi¡ªû
) )

672 
is_¿ndom_acûss
 = 1 + 
idx
;

676 
d–
 = (
cu¼_äame
 + 
off£t
è- 
	`imax
Ð
p_£q_¡ruù
->
Ï¡_¿nd_acûss_di¥
,…_£q_¡ruù->
Ï¡_šŒa_di¥
);

677 iàÐ!
cu¼_äame
 || (
d–
 >ð
p_IÅ
->
idr_³riod
 && d– >ðp_IÅ->
MšIDRDi¡ªû
) )

679 
is_¿ndom_acûss
 = 1 + 
idx
;

683 iàÐ
is_¿ndom_acûss
 )

692  
is_¿ndom_acûss
;

693 
	}
}

702 
	$¿nd_acc_‹¡_¿nge
Ð
cu¼_äame
, 
off£t
, 
idr_³riod
 )

704 
idx
;

705 
no_ºd_acc
 = 1;

707 iàÐ
idr_³riod
 > 0 )

709  
idx
 = 
cu¼_äame
; idx <ð(cu¼_äam+ 
off£t
); idx++ )

711 iàÐ
idx
 % 
idr_³riod
 == 0 )

713 
no_ºd_acc
 = 0;

719  
no_ºd_acc
;

720 
	}
}

740 
	$e¡ablish_šŒa
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 )

742 
is_šŒa
 = 0;

744 iàÐ!
cu¼_äame
 )

746 
is_šŒa
 = 1;

748 iàÐ
p_IÅ
->
šŒa_³riod
 )

750 iàÐ!(
p_IÅ
->
P»ãrDi¥Ord”
) )

752  
p_IÅ
->
ad­tive_šŒa_³riod
 )

756 iàÐ
cu¼_äame
 % 
p_IÅ
->
šŒa_³riod
 == 0 )

758 
is_šŒa
 = 1;

762 iàÐ(
cu¼_äame
 - 
	`imax
Ð
p_£q_¡ruù
->
Ï¡_idr_äame
,…_£q_¡ruù->
Ï¡_šŒa_äame
)è% 
p_IÅ
->
šŒa_³riod
 == 0 )

764 
is_šŒa
 = 1;

771 
idx
;

772 
off£t
;

773 
P»dSŒuùAtom
 *
p_cur_gÝ
;

777  
idx
 = (
p_£q_¡ruù
->
num_šŒa_gÝs
 - 1); idx >= 0; idx-- )

779 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
 + 
idx
;

781 iàÐ
sim
 )

783 iàÐ(
cu¼_äame
 + 
p_cur_gÝ
->
Ëngth
è> 
p_IÅ
->
no_äames
 )

790 iàÐ
p_cur_gÝ
->
Ëngth
 > 
avaž_äames
 )

796 
off£t
 = 
p_cur_gÝ
->
p_äm
[0].
di¥_off£t
;

799  
p_IÅ
->
ad­tive_šŒa_³riod
 )

806 iàÐ(
cu¼_äame
 + 
off£t
è% 
p_IÅ
->
šŒa_³riod
 =ð0 && 
	`¿nd_acc_‹¡_¿nge
Ðcu¼_äame, off£t,…_IÅ->
idr_³riod
 ) )

808 
is_šŒa
 = 1 + 
idx
;

813 iàÐ((
cu¼_äame
 + 
off£t
è- 
	`imax
Ð
p_£q_¡ruù
->
Ï¡_idr_di¥
,…_£q_¡ruù->
Ï¡_šŒa_di¥
)è% 
p_IÅ
->
šŒa_³riod
 == 0

814 && 
	`¿nd_acc_‹¡_¿nge
Ð
cu¼_äame
 - 
	`imax
Ð
p_£q_¡ruù
->
Ï¡_idr_di¥
,…_£q_¡ruù->
Ï¡_šŒa_di¥
), 
off£t
, 
p_IÅ
->
idr_³riod
 ) )

816 
is_šŒa
 = 1 + 
idx
;

820 iàÐ
is_šŒa
 )

829  
is_šŒa
;

830 
	}
}

850 
	$e¡ablish_¥
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
, 
sim
 )

852 
is_¥
 = 0;

854 iàÐ
p_IÅ
->
¥_³riodic™y
 )

856 iàÐ!(
p_IÅ
->
P»ãrDi¥Ord”
) )

858 iàÐ(
cu¼_äame
 - 
p_£q_¡ruù
->
Ï¡_¥_äame
è% 
p_IÅ
->
¥_³riodic™y
 == 0 )

860 
is_¥
 = 1;

865 
idx
;

866 
off£t
;

867 
P»dSŒuùAtom
 *
p_cur_gÝ
;

871  
idx
 = (
p_£q_¡ruù
->
num_gÝs
 - 1); idx >= 0; idx-- )

873 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
idx
;

875 iàÐ
sim
 )

877 iàÐ(
cu¼_äame
 + 
p_cur_gÝ
->
Ëngth
è> 
p_IÅ
->
no_äames
 )

884 iàÐ
p_cur_gÝ
->
Ëngth
 > 
avaž_äames
 )

891 
off£t
 = 
p_cur_gÝ
->
p_äm
[0].
di¥_off£t
;

894 iàÐ(
cu¼_äame
 + 
off£t
 - 
p_£q_¡ruù
->
Ï¡_¥_di¥
è% 
p_IÅ
->
¥_³riodic™y
 == 0 )

896 
is_¥
 = 1 + 
idx
;

903  
is_¥
;

904 
	}
}

923 
	$g‘_fixed_äame
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
 )

925 
idx
 = 0;

926 
is_ºd_acc
 = 0;

927 
is_šŒa
 = 0;

928 
is_¥
 = 0;

930  
idx
 < 
avaž_äames
 )

932 
is_ºd_acc
 = 
	`e¡ablish_¿ndom_acûss
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

933 
is_šŒa
 = 
	`e¡ablish_šŒa
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

934 
is_¥
 = 
	`e¡ablish_¥
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

936 iàÐ
is_ºd_acc
 || 
is_šŒa
 || 
is_¥
 )

938  
idx
;

940 
idx
++;

944 
	}
}

964 
	$g‘_fixed_äame_fÜ_´d
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
cu¼_äame
, 
avaž_äames
 )

966 
idx
 = 0;

967 
is_ºd_acc
 = 0;

968 
is_šŒa
 = 0;

969 
is_¥
 = 0;

970 
P»dSŒuùAtom
 *
p_lÚge¡_´d
 = 
p_£q_¡ruù
->
p_´d
 +…_£q_¡ruù->
num_´ds
 - 1;

972  
idx
 < 
avaž_äames
 )

975 
is_ºd_acc
 = 
	`e¡ablish_¿ndom_acûss
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

976 iàÐ
is_ºd_acc
 )

978 iàÐ
p_IÅ
->
P»ãrDi¥Ord”
 && !Õ_IÅ->
EÇbËIDRGOP
) )

980 
gÝ_Ëngth
;

981 
P»dSŒuùAtom
 *
p_cu¼_gÝ
;

984 iàÐ
is_ºd_acc
 > 1 )

986 
p_cu¼_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
is_ºd_acc
 - 1;

987 
gÝ_Ëngth
 = 
p_cu¼_gÝ
->
Ëngth
;

991 
gÝ_Ëngth
 = 1;

995 iàÐ(
idx
 % 
p_lÚge¡_´d
->
Ëngth
) <…_longest_prd->length )

997 
p_£q_¡ruù
->
pÝ_æag
 = 
POP_IDR
;

998  ( 
	`imš
Ð
p_lÚge¡_´d
->
Ëngth
, 
idx
 + 
gÝ_Ëngth
 - 1 ) );

1002  
idx
;

1007  
idx
;

1011 
is_šŒa
 = 
	`e¡ablish_šŒa
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

1012 iàÐ
is_šŒa
 )

1014 iàÐ
p_IÅ
->
P»ãrDi¥Ord”
 )

1016 
gÝ_Ëngth
;

1017 
P»dSŒuùAtom
 *
p_cu¼_gÝ
;

1020 iàÐ
is_šŒa
 > 1 )

1022 
p_cu¼_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
 + 
is_šŒa
 - 1;

1023 
gÝ_Ëngth
 = 
p_cu¼_gÝ
->
Ëngth
;

1027 
gÝ_Ëngth
 = 1;

1031 iàÐ(
idx
 % 
p_lÚge¡_´d
->
Ëngth
) <…_longest_prd->length )

1033 
p_£q_¡ruù
->
pÝ_æag
 = 
POP_INTRA
;

1034  ( 
	`imš
Ð
p_lÚge¡_´d
->
Ëngth
, 
idx
 + 
gÝ_Ëngth
 - 1 ) );

1038  
idx
;

1043  
idx
;

1047 
is_¥
 = 
	`e¡ablish_¥
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 
idx
, 
avaž_äames
 - idx, 1 );

1048 iàÐ
is_¥
 )

1050 iàÐ
p_IÅ
->
P»ãrDi¥Ord”
 && !Õ_IÅ->
EÇbËIDRGOP
) )

1052 
gÝ_Ëngth
;

1053 
P»dSŒuùAtom
 *
p_cu¼_gÝ
;

1056 iàÐ
is_¥
 > 1 )

1058 
p_cu¼_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
is_¥
 - 1;

1059 
gÝ_Ëngth
 = 
p_cu¼_gÝ
->
Ëngth
;

1063 
gÝ_Ëngth
 = 1;

1067 iàÐ(
idx
 % 
p_lÚge¡_´d
->
Ëngth
) <…_longest_prd->length )

1069 
p_£q_¡ruù
->
pÝ_æag
 = 
POP_SP
;

1070  ( 
	`imš
Ð
p_lÚge¡_´d
->
Ëngth
, 
idx
 + 
gÝ_Ëngth
 - 1 ) );

1074  
idx
;

1079  
idx
;

1082 
idx
++;

1086 
	}
}

1099 
šlše
 
	$check_pow”_of_two
Ð
numb”
 )

1101  (((~((~
numb”
) + 1)) &‚umber ) == 0) ? 1 : 0;

1102 
	}
}

1119 
	$g‘_´d_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 )

1121 
cu¼_´d
;

1122 
P»dSŒuùAtom
 *
p_cur_´d
;

1125  
cu¼_´d
 = (
p_£q_¡ruù
->
num_´ds
 - 1); curr_prd >= 0; curr_prd-- )

1127 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
cu¼_´d
;

1128 iàÐ
p_IÅ
->
P»ãrPow”OfTwo
 && 
cu¼_´d
 !ð(
p_£q_¡ruù
->
num_´ds
 - 1è&& !
	`check_pow”_of_two
Ð
p_cur_´d
->
Ëngth
 ) )

1132 iàÐ
p_cur_´d
->
Ëngth
 <ð
num_äames
 )

1134  
cu¼_´d
;

1138 
	}
}

1155 
	$g‘_idr_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 )

1157 
cu¼_gÝ
;

1158 
P»dSŒuùAtom
 *
p_cur_gÝ
;

1161  
cu¼_gÝ
 = (
p_£q_¡ruù
->
num_gÝs
 - 1); curr_gop >= 0; curr_gop-- )

1163 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
cu¼_gÝ
;

1164 iàÐ
p_IÅ
->
P»ãrPow”OfTwo
 && 
cu¼_gÝ
 !ð(
p_£q_¡ruù
->
num_gÝs
 - 1è&& !
	`check_pow”_of_two
Ð
p_cur_gÝ
->
Ëngth
 ) )

1168 iàÐ
p_cur_gÝ
->
Ëngth
 <ð
num_äames
 )

1170  
cu¼_gÝ
;

1174 
	}
}

1191 
	$g‘_šŒa_šdex
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_äames
 )

1193 
cu¼_gÝ
;

1194 
P»dSŒuùAtom
 *
p_cur_gÝ
;

1197  
cu¼_gÝ
 = (
p_£q_¡ruù
->
num_šŒa_gÝs
 - 1); curr_gop >= 0; curr_gop-- )

1199 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
 + 
cu¼_gÝ
;

1200 iàÐ
p_IÅ
->
P»ãrPow”OfTwo
 && 
cu¼_gÝ
 !ð(
p_£q_¡ruù
->
num_šŒa_gÝs
 - 1è&& !
	`check_pow”_of_two
Ð
p_cur_gÝ
->
Ëngth
 ) )

1204 iàÐ
p_cur_gÝ
->
Ëngth
 <ð
num_äames
 )

1206  
cu¼_gÝ
;

1210 
	}
}

1221 
šlše
 
	$pÝ_´ed_¡ruù_äm
Ð
P»dSŒuùFrm
 *
p_d¡
, 
¦iû_ty³
, 
Çl_»f_idc
, 
di¥_off£t
, 
Ïy”
, 
¦iû_qp_off
,

1222 
¿ndom_acûss
, 
‹mpÜ®_Ïy”
 )

1224 
p_d¡
->
¦iû_ty³
 = slice_type;

1225 
p_d¡
->
Çl_»f_idc
 =‚al_ref_idc;

1226 
p_d¡
->
di¥_off£t
 = disp_offset;

1227 
p_d¡
->
Ïy”
 =†ayer;

1228 
p_d¡
->
¦iû_qp_off
 = slice_qp_off;

1229 
p_d¡
->
¿ndom_acûss
 =„andom_access;

1230 
p_d¡
->
‹mpÜ®_Ïy”
 =emporal_layer;

1231 
	}
}

1250 
	$š™_gÝ_¡ruù
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
is_idr
, *
memÜy_size
 )

1252 
idx
;

1253 
Ëngth
;

1254 
P»dSŒuùAtom
 *
p_cur_gÝ
, *
p_cur_´d
, *
p_cur_´d_ž
 = 
NULL
, *
p_gÝ
;

1255 
P»dSŒuùFrm
 *
p_d¡
, *
p_¤c
;

1257 iàÐ
is_idr
 )

1260 iàÐ
p_IÅ
->
idr_³riod
 =ð1 ||…_IÅ->
šŒa_³riod
 == 1 )

1262 
p_£q_¡ruù
->
num_gÝs
 = 1;

1264 iàÐ
p_IÅ
->
šŒa_d–ay
 && !p_IÅ->
EÇbËIDRGOP
 )

1266 
p_£q_¡ruù
->
num_gÝs
 = 3;

1268 iàÐ
p_IÅ
->
šŒa_d–ay
 || !p_IÅ->
EÇbËIDRGOP
 )

1270 
p_£q_¡ruù
->
num_gÝs
 = !
p_IÅ
->
EÇbËIDRGOP
 ?…_£q_¡ruù->
num_´ds
 : 2;

1274 
p_£q_¡ruù
->
num_gÝs
 = !
p_IÅ
->
EÇbËIDRGOP
 ?…_£q_¡ruù->
num_´ds
 : 1;

1278 iàÐ
p_IÅ
->
idr_³riod
 )

1280 
	`as£¹
Ð
p_IÅ
->
šŒa_d–ay
 <…_IÅ->
idr_³riod
 );

1283 
p_£q_¡ruù
->
p_gÝ
 = (
P»dSŒuùAtom
 *)
	`m®loc
Ðp_£q_¡ruù->
num_gÝs
 * ( PredStructAtom ) );

1284 *
memÜy_size
 +ðÐ
p_£q_¡ruù
->
num_gÝs
 * Ð
P»dSŒuùAtom
 ) );

1286 
p_gÝ
 = 
p_£q_¡ruù
->p_gop;

1291 iàÐ
p_IÅ
->
šŒa_³riod
 == 1 )

1293 
p_£q_¡ruù
->
num_šŒa_gÝs
 = 1;

1295 iàÐ
p_IÅ
->
šŒa_d–ay
 )

1297 
p_£q_¡ruù
->
num_šŒa_gÝs
 = 3;

1301 
p_£q_¡ruù
->
num_šŒa_gÝs
 =…_£q_¡ruù->
num_´ds
;

1305 iàÐ
p_IÅ
->
šŒa_³riod
 )

1307 
	`as£¹
Ð
p_IÅ
->
šŒa_d–ay
 <…_IÅ->
šŒa_³riod
 );

1310 
p_£q_¡ruù
->
p_šŒa_gÝ
 = (
P»dSŒuùAtom
 *)
	`m®loc
Ðp_£q_¡ruù->
num_šŒa_gÝs
 * ( PredStructAtom ) );

1311 *
memÜy_size
 +ðÐ
p_£q_¡ruù
->
num_šŒa_gÝs
 * Ð
P»dSŒuùAtom
 ) );

1313 
p_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
;

1317 
Ëngth
 = 1;

1318 
p_cur_gÝ
 = 
p_gÝ
;

1319 
p_cur_gÝ
->
Ëngth
 =†ength;

1320 
p_cur_gÝ
->
p_äm
 = (
P»dSŒuùFrm
 *)
	`m®loc
Ð
Ëngth
 * ( PredStructFrm ) );

1321 *
memÜy_size
 +ð
Ëngth
 * Ð
P»dSŒuùFrm
 );

1324 
p_cur_gÝ
 = 
p_gÝ
;

1325 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 0;

1326 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
I_SLICE
, 
NALU_PRIORITY_HIGHEST
, 0, 0, 0, 1, 0 );

1329 iàÐ
p_IÅ
->
šŒa_d–ay
 &&…_IÅ->
šŒa_³riod
 !ð1 &&…_IÅ->
idr_³riod
 != 1 )

1331 
´oc_äames
 = 0;

1332 
¡¬t_äame
 = 
p_IÅ
->
šŒa_d–ay
 - 1;

1333 
idr_idx
 = 0;

1334 
cu¼_´d
;

1337 
Ëngth
 = 
p_IÅ
->
šŒa_d–ay
 + 1;

1338 
p_cur_gÝ
 = 
p_gÝ
 + 1;

1339 
p_cur_gÝ
->
Ëngth
 =†ength;

1340 
p_cur_gÝ
->
gÝ_Ëv–s
 = 1;

1341 
p_cur_gÝ
->
p_äm
 = (
P»dSŒuùFrm
 *)
	`m®loc
Ð
Ëngth
 * ( PredStructFrm ) );

1342 *
memÜy_size
 +ð
Ëngth
 * Ð
P»dSŒuùFrm
 );

1345 
p_cur_gÝ
 = 
p_gÝ
 + 1;

1346 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1347 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
I_SLICE
, 
NALU_PRIORITY_HIGHEST
, 
p_IÅ
->
šŒa_d–ay
, 0, 0, 1, 0 );

1349 
idr_idx
++;

1351  
´oc_äames
 < 
p_IÅ
->
šŒa_d–ay
 )

1354 
cu¼_´d
 = 
	`g‘_´d_šdex
Ð
p_IÅ
, 
p_£q_¡ruù
,…_IÅ->
šŒa_d–ay
 - 
´oc_äames
 );

1355 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
cu¼_´d
;

1357 
p_cur_gÝ
->
gÝ_Ëv–s
 = 
p_cur_´d
->gop_levels;

1359  
idx
 = 0; idx < 
p_cur_´d
->
Ëngth
; idx++, 
idr_idx
++, 
´oc_äames
++ )

1361 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1362 
p_¤c
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1364 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
p_¤c
->
¦iû_ty³
,…_¤c->
Çl_»f_idc
, 
¡¬t_äame
 -…_¤c->
di¥_off£t
,…_¤c->
Ïy”
,

1365 
p_¤c
->
¦iû_qp_off
, 0,…_¤c->
‹mpÜ®_Ïy”
 );

1368 
¡¬t_äame
 -ð
p_cur_´d
->
Ëngth
;

1372 iàÐ!
p_IÅ
->
EÇbËIDRGOP
 || !
is_idr
 )

1374 
´oc_äames
 = 0;

1375 
¡¬t_äame
 = 
p_IÅ
->
šŒa_d–ay
 - 1;

1376 
idr_idx
 = 0;

1379 
p_cur_´d_ž
 = 
p_£q_¡ruù
->
p_´d
 +…_£q_¡ruù->
num_´ds
 - 1;

1382 
Ëngth
 = 
p_IÅ
->
šŒa_d–ay
 + 1 + (
p_cur_´d_ž
->length - 1);

1383 
p_cur_gÝ
 = 
p_gÝ
 + 2;

1384 
p_cur_gÝ
->
Ëngth
 =†ength;

1385 
p_cur_gÝ
->
gÝ_Ëv–s
 = 1;

1386 
p_cur_gÝ
->
p_äm
 = (
P»dSŒuùFrm
 *)
	`m®loc
Ð
Ëngth
 * ( PredStructFrm ) );

1387 *
memÜy_size
 +ð
Ëngth
 * Ð
P»dSŒuùFrm
 );

1388 
idr_idx
 = 0;

1391 
p_cur_gÝ
 = 
p_gÝ
 + 2;

1392 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1393 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
I_SLICE
, 
NALU_PRIORITY_HIGHEST
, 
p_IÅ
->
šŒa_d–ay
, 0, 0, 1, 0 );

1395 
idr_idx
++;

1397  
´oc_äames
 < 
p_IÅ
->
šŒa_d–ay
 )

1400 
cu¼_´d
 = 
	`g‘_´d_šdex
Ð
p_IÅ
, 
p_£q_¡ruù
,…_IÅ->
šŒa_d–ay
 - 
´oc_äames
 );

1401 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
cu¼_´d
;

1403 
p_cur_gÝ
->
gÝ_Ëv–s
 = 
p_cur_´d
->gop_levels;

1405  
idx
 = 0; idx < 
p_cur_´d
->
Ëngth
; idx++, 
idr_idx
++, 
´oc_äames
++ )

1407 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1408 
p_¤c
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1410 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
p_¤c
->
¦iû_ty³
,…_¤c->
Çl_»f_idc
, 
¡¬t_äame
 -…_¤c->
di¥_off£t
,

1411 
p_¤c
->
Ïy”
,…_¤c->
¦iû_qp_off
, 0,…_¤c->
‹mpÜ®_Ïy”
 );

1414 
¡¬t_äame
 -ð
p_cur_´d
->
Ëngth
;

1418  
idr_idx
 = 0; idr_idx < (
p_IÅ
->
šŒa_d–ay
 + 1); idr_idx++ )

1420 
p_cur_gÝ
->
p_äm
[
idr_idx
].
di¥_off£t
 +ð(
p_cur_´d_ž
->
Ëngth
 - 1);

1422 
p_cur_gÝ
->
gÝ_Ëv–s
 = 
	`imax
Ðp_cur_gÝ->gÝ_Ëv–s, 
p_cur_´d_ž
->gop_levels );

1424  
idx
 = 1; idx < 
p_cur_´d_ž
->
Ëngth
; idx++, 
idr_idx
++ )

1426 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1427 
p_¤c
 = 
p_cur_´d_ž
->
p_äm
 + 
idx
;

1429 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
p_¤c
->
¦iû_ty³
,…_¤c->
Çl_»f_idc
,…_¤c->
di¥_off£t
,

1430 
p_¤c
->
Ïy”
,…_¤c->
¦iû_qp_off
, 0,…_¤c->
‹mpÜ®_Ïy”
 );

1434 iàÐ!(
p_IÅ
->
šŒa_d–ay
è&& ((!p_IÅ->
EÇbËIDRGOP
 || !
is_idr
è&&…_IÅ->
šŒa_³riod
 !ð1 &&…_IÅ->
idr_³riod
 != 1) )

1436 
gÝ_idx
;

1437 
idr_idx
 = 0;

1439  
gÝ_idx
 = 1; gÝ_idx < 
p_£q_¡ruù
->
num_´ds
; gop_idx++ )

1442 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
gÝ_idx
;

1445 
Ëngth
 = 
p_cur_´d
->length;

1446 
p_cur_gÝ
 = 
p_gÝ
 + 
gÝ_idx
;

1447 
p_cur_gÝ
->
Ëngth
 =†ength;

1448 
p_cur_gÝ
->
p_äm
 = (
P»dSŒuùFrm
 *)
	`m®loc
Ð
Ëngth
 * ( PredStructFrm ) );

1449 *
memÜy_size
 +ð
Ëngth
 * Ð
P»dSŒuùFrm
 );

1450 
idr_idx
 = 0;

1453 
p_cur_gÝ
->
gÝ_Ëv–s
 = 
p_cur_´d
->gop_levels;

1454 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1455 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
I_SLICE
, 
NALU_PRIORITY_HIGHEST
, 
p_cur_´d
->
p_äm
[0].
di¥_off£t
, 0, 0, 1, 0 );

1456 
idr_idx
++;

1459  
idx
 = 1; idx < 
p_cur_´d
->
Ëngth
; idx++, 
idr_idx
++ )

1461 
p_d¡
 = 
p_cur_gÝ
->
p_äm
 + 
idr_idx
;

1462 
p_¤c
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1464 
	`pÝ_´ed_¡ruù_äm
Ð
p_d¡
, 
p_¤c
->
¦iû_ty³
,…_¤c->
Çl_»f_idc
,…_¤c->
di¥_off£t
,

1465 
p_¤c
->
Ïy”
,…_¤c->
¦iû_qp_off
, 0,…_¤c->
‹mpÜ®_Ïy”
 );

1469 
	}
}

1486 
	$š™_´ed_¡ruù
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, *
memÜy_size
 )

1488 
cu¼_´d
, 
idx
;

1489 
äm
, 
sum
, 
Ïy”
, 
Üd”
;

1490 
Ëngth
, 
Ëngth2
, 
´ed_mode
;

1491 
P»dSŒuùAtom
 *
p_cur_´d
;

1492 
P»dSŒuùFrm
 *
p_d¡
;

1494 
p_£q_¡ruù
->
num_´ds
 = (
p_IÅ
->
idr_³riod
 =ð1 ||…_IÅ->
šŒa_³riod
 =ð1è? 1 : (p_IÅ->
Numb”BF¿mes
 + 1);

1496 
p_£q_¡ruù
->
p_´d
 = (
P»dSŒuùAtom
 *)
	`m®loc
Ðp_£q_¡ruù->
num_´ds
 * ( PredStructAtom ) );

1497 *
memÜy_size
 +ð
p_£q_¡ruù
->
num_´ds
 * Ð
P»dSŒuùAtom
 );

1500  
cu¼_´d
 = (
p_£q_¡ruù
->
num_´ds
 - 1); curr_prd >= 0; curr_prd-- )

1503 
Ëngth
 = 
cu¼_´d
 + 1;

1505 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
cu¼_´d
;

1506 
p_cur_´d
->
Ëngth
 =†ength;

1507 
p_cur_´d
->
p_äm
 = (
P»dSŒuùFrm
 *)
	`m®loc
Ð
Ëngth
 * ( PredStructFrm ) );

1508 *
memÜy_size
 +ð
Ëngth
 * Ð
P»dSŒuùFrm
 );

1512  
cu¼_´d
 = (
p_£q_¡ruù
->
num_´ds
 - 1); curr_prd >= 0; curr_prd-- )

1515 
Ëngth
 = 
cu¼_´d
 + 1;

1517  
p_IÅ
->
H›¿rchiÿlCodšg
 )

1521 
´ed_mode
 = 0;

1524 
´ed_mode
 = 1;

1528 
´ed_mode
 = 
	`check_pow”_of_two
Ð
Ëngth
 ) ? 2 : (†ength > 4 ? 1 : 0 );

1532 iàÐ
p_IÅ
->
LowD–ay
 )

1534 
´ed_mode
 = 3;

1538 
´ed_mode
 = (
Ëngth
 =ð(
p_IÅ
->
Numb”BF¿mes
 + 1)è? 3 : (
	`check_pow”_of_two
(†ength ) ? 2 : (†ength > 4 ? 1 : 0 ));

1543 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
cu¼_´d
;

1544 
p_cur_´d
->
gÝ_Ëv–s
 = 0;

1545  
´ed_mode
 )

1549 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 0;

1551 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? 
B_SLICE
 : 
P_SLICE
;

1552 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1553 
p_d¡
->
di¥_off£t
 = 
Ëngth
 - 1;

1554 
p_d¡
->
Ïy”
 = 0;

1555 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? (p_IÅ->
qp
[
P_SLICE
] -…_IÅ->qp[
B_SLICE
]) : 0;

1556 
p_d¡
->
¿ndom_acûss
 = 0;

1557 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1559  
idx
 = 1; idx < 
Ëngth
; idx++ )

1561 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1563 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? 
P_SLICE
 : 
B_SLICE
;

1564 
p_d¡
->
Çl_»f_idc
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð1 &&…_d¡->
¦iû_ty³
 =ð
B_SLICE
 ) ? 
NALU_PRIORITY_LOW
 : 
NALU_PRIORITY_DISPOSABLE
;

1565 
p_d¡
->
di¥_off£t
 = 
idx
 - 1;

1566 
p_d¡
->
Ïy”
 = 2;

1567 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? (p_IÅ->
qp
[
B_SLICE
] -…_IÅ->qp[
P_SLICE
]è: (p_d¡->
Çl_»f_idc
 ?…_IÅ->
qpBRSOff£t
 : 0);

1568 
p_d¡
->
¿ndom_acûss
 = 0;

1569 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1571 iàÐ
Ëngth
 > 1 )

1573 
p_cur_´d
->
gÝ_Ëv–s
 = 1;

1577 
Ëngth2
 = ((
Ëngth
 - 1) >> 1) + 1;

1579 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 0;

1581 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? 
B_SLICE
 : 
P_SLICE
;

1582 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1583 
p_d¡
->
di¥_off£t
 = 
Ëngth
 - 1;

1584 
p_d¡
->
Ïy”
 = 0;

1585 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? (p_IÅ->
qp
[
B_SLICE
] -…_IÅ->qp[
P_SLICE
]) : 0;

1586 
p_d¡
->
¿ndom_acûss
 = 0;

1587 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1589  
idx
 = 1; idx < 
Ëngth2
; idx++ )

1591 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1593 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? 
P_SLICE
 : 
B_SLICE
;

1594 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_LOW
;

1595 
p_d¡
->
di¥_off£t
 = 2*(
idx
 - 1) + 1;

1596 
p_d¡
->
Ïy”
 = 1;

1597 
p_d¡
->
¦iû_qp_off
 =…_d¡->
¦iû_ty³
 =ð
B_SLICE
 ?

1598 (
p_IÅ
->
H›¿rchyLev–QPEÇbË
 ? -1:…_IÅ->
qpBRSOff£t
) : (p_Inp->HierarchyLevelQPEnable ? 1 : 0);

1599 
p_d¡
->
¿ndom_acûss
 = 0;

1600 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1602  
idx
 = 
Ëngth2
; idx < 
Ëngth
; idx++ )

1604 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1606 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? 
P_SLICE
 : 
B_SLICE
;

1607 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

1608 
p_d¡
->
di¥_off£t
 = (
idx
 - 
Ëngth2
) * 2;

1609 
p_d¡
->
Ïy”
 = 2;

1610 
p_d¡
->
¦iû_qp_off
 =…_d¡->
¦iû_ty³
 =ð
B_SLICE
 ? 0 : 2;

1611 
p_d¡
->
¿ndom_acûss
 = 0;

1612 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1614 iàÐ
Ëngth
 > 1 )

1616 
p_cur_´d
->
gÝ_Ëv–s
 = 2;

1620 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 0;

1622 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? 
B_SLICE
 : 
P_SLICE
;

1623 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1624 
p_d¡
->
di¥_off£t
 = 
Ëngth
 - 1;

1625 
p_d¡
->
Ïy”
 = 0;

1626 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? (p_IÅ->
qp
[
B_SLICE
] -…_IÅ->qp[
P_SLICE
]) : 0;

1627 
p_d¡
->
¿ndom_acûss
 = 0;

1628 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1630 iàÐ
Ëngth
 > 3 )

1632 
GOPËv–s
 = 1;

1635 (
Ëngth
 >> 
GOPËv–s
) > 1)

1637 
GOPËv–s
 ++;

1639 
p_cur_´d
->
gÝ_Ëv–s
 = 
GOPËv–s
;

1642  
Ïy”
 = 1, 
Üd”
 = 1, 
sum
 = 0, 
äm
 = 1; sum < (
Ëngth
 - 1); frm = (frm << 1), sum += frm,†ayer++ )

1645  
idx
 = 0; idx < 
äm
; idx++, 
Üd”
++ )

1647 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
Üd”
;

1649 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? 
P_SLICE
 : 
B_SLICE
;

1650 
p_d¡
->
Çl_»f_idc
 = (
äm
 =ð(
Ëngth
 >> 1)è? 
NALU_PRIORITY_DISPOSABLE
 : 
NALU_PRIORITY_LOW
;

1651 
p_d¡
->
di¥_off£t
 = ((
Ëngth
 - 1è>> 
Ïy”
è+ 
idx
 * (length >> (layer - 1));

1652 
p_d¡
->
Ïy”
 =†ayer;

1653 
p_d¡
->
¦iû_qp_off
 =…_d¡->
¦iû_ty³
 =ð
B_SLICE
 ?

1654 (
p_IÅ
->
H›¿rchyLev–QPEÇbË
 ? (-
GOPËv–s
 + 
Ïy”
): (
p_d¡
->
Çl_»f_idc
 !ð
NALU_PRIORITY_DISPOSABLE
 ?…_IÅ->
qpBRSOff£t
 : 0)) : (p_Inp->HierarchyLevelQPEnable ?†ayer : 0);

1655 
p_d¡
->
¿ndom_acûss
 = 0;

1656 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1662  
idx
 = 1; idx < 
Ëngth
; idx++ )

1664 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1666 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
PR•ÏûBSliû
 ) ? 
P_SLICE
 : 
B_SLICE
;

1667 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

1668 
p_d¡
->
di¥_off£t
 = 
idx
 - 1;

1669 
p_d¡
->
Ïy”
 = 2;

1670 
p_d¡
->
¦iû_qp_off
 = 0;

1671 
p_d¡
->
¿ndom_acûss
 = 0;

1672 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1674 iàÐ
Ëngth
 > 1 )

1676 
p_cur_´d
->
gÝ_Ëv–s
 = 1;

1682 
max_Ïy”
 = 0;

1684 iàÐ
p_IÅ
->
LowD–ay
 )

1686  
idx
 = 0; idx < (
Ëngth
 - 1); idx++ )

1688 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1690 
p_d¡
->
¦iû_ty³
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].slice_type;

1691 
p_d¡
->
Çl_»f_idc
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].
»ã»nû_idc
;

1692 
p_d¡
->
di¥_off£t
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].
di¥Ïy_no
;

1693 
p_d¡
->
Ïy”
 = ((
p_Vid
->
gÝ_¡ruùu»
[
idx
].
h›¿rchy_Ïy”
 == 1) ? 0 : 1) + 1;

1694 
p_d¡
->
¦iû_qp_off
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].slice_qp_off;

1695 
p_d¡
->
¿ndom_acûss
 = 0;

1697 
p_d¡
->
‹mpÜ®_Ïy”
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].temporal_layer;

1698 iàÐ
p_Vid
->
gÝ_¡ruùu»
[
idx
].
h›¿rchy_Ïy”
 > 
max_Ïy”
 )

1700 
max_Ïy”
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
].
h›¿rchy_Ïy”
;

1703 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1704 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? 
B_SLICE
 : 
P_SLICE
;

1705 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1706 
p_d¡
->
di¥_off£t
 = 
Ëngth
 - 1;

1707 
p_d¡
->
Ïy”
 = 0;

1708 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? (p_IÅ->
qp
[
B_SLICE
] -…_IÅ->qp[
P_SLICE
]) : 0;

1709 
p_d¡
->
¿ndom_acûss
 = 0;

1711 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1715 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 0;

1717 
p_d¡
->
¦iû_ty³
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? 
B_SLICE
 : 
P_SLICE
;

1718 
p_d¡
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1719 
p_d¡
->
di¥_off£t
 = 
Ëngth
 - 1;

1720 
p_d¡
->
Ïy”
 = 0;

1721 
p_d¡
->
¦iû_qp_off
 = ( 
p_IÅ
->
BRefPiùu»s
 =ð2 ) ? (p_IÅ->
qp
[
B_SLICE
] -…_IÅ->qp[
P_SLICE
]) : 0;

1722 
p_d¡
->
¿ndom_acûss
 = 0;

1723 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1725  
idx
 = 1; idx < 
Ëngth
; idx++ )

1727 
p_d¡
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1729 
p_d¡
->
¦iû_ty³
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].slice_type;

1730 
p_d¡
->
Çl_»f_idc
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].
»ã»nû_idc
;

1731 
p_d¡
->
di¥_off£t
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].
di¥Ïy_no
;

1732 
p_d¡
->
Ïy”
 = ((
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].
h›¿rchy_Ïy”
 == 1) ? 0 : 1) + 1;

1733 
p_d¡
->
¦iû_qp_off
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].slice_qp_off;

1734 
p_d¡
->
¿ndom_acûss
 = 0;

1735 
p_d¡
->
‹mpÜ®_Ïy”
 = 0;

1737 iàÐ
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].
h›¿rchy_Ïy”
 > 
max_Ïy”
 )

1739 
max_Ïy”
 = 
p_Vid
->
gÝ_¡ruùu»
[
idx
 - 1].
h›¿rchy_Ïy”
;

1743 
p_cur_´d
->
gÝ_Ëv–s
 = 
max_Ïy”
 + 1;

1748 
	}
}

1765 
	$pÝuÏ‹_äm_¡ruù
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
num_to_pÝuÏ‹
, 
š™_äames_to_code
 )

1768 
cu¼_äame
;

1769 
´oc_äames
;

1770 
is_idr
;

1771 
is_šŒa
;

1772 
is_¥
;

1773 
‹rmš©e_pÝ
 = 0;

1775 
p_£q_¡ruù
->
cu¼_num_to_pÝuÏ‹
 = 
	`imš
Ð
num_to_pÝuÏ‹
, 
š™_äames_to_code
 -…_£q_¡ruù->
pÝ_¡¬t_äame
 );

1776 
cu¼_äame
 = 
p_£q_¡ruù
->
pÝ_¡¬t_äame
;

1777 
´oc_äames
 = 0;

1779  
´oc_äames
 < 
p_£q_¡ruù
->
cu¼_num_to_pÝuÏ‹
 )

1781 
is_idr
 = 0;

1782 
is_šŒa
 = 0;

1783 
is_¥
 = 0;

1788 
is_idr
 = 
	`e¡ablish_¿ndom_acûss
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
, 0 );

1789 iàÐ
is_idr
 && 
p_£q_¡ruù
->
pÝ_æag
 !ð
POP_INTRA
 &&…_£q_¡ruù->pÝ_æag !ð
POP_SP
 )

1792 
gÝ_äame
 = 
	`pÝuÏ‹_ºd_acc_´ed_¡ruù_©om
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
, 
´oc_äames
, &
‹rmš©e_pÝ
, 
is_idr
, 0 );

1794 
cu¼_äame
 +ð
gÝ_äame
;

1795 
´oc_äames
 +ð
gÝ_äame
;

1796 iàÐ
‹rmš©e_pÝ
 )

1798 
‹rmš©e_pÝ
 = 0;

1804 
is_šŒa
 = 
	`e¡ablish_šŒa
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
, 0 );

1805 iàÐ
is_šŒa
 && 
p_£q_¡ruù
->
pÝ_æag
 !ð
POP_SP
 )

1808 
gÝ_äame
 = 
	`pÝuÏ‹_ºd_acc_´ed_¡ruù_©om
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
, 
´oc_äames
, &
‹rmš©e_pÝ
, 
is_šŒa
, 1 );

1810 
´oc_äames
 +ð
gÝ_äame
;

1811 
cu¼_äame
 +ð
gÝ_äame
;

1812 iàÐ
‹rmš©e_pÝ
 )

1814 
‹rmš©e_pÝ
 = 0;

1820 
is_¥
 = 
	`e¡ablish_¥
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
, 0 );

1821 iàÐ
is_¥
 )

1824 
gÝ_äame
 = 
	`pÝuÏ‹_ºd_acc_´ed_¡ruù_©om
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
, 
´oc_äames
, &
‹rmš©e_pÝ
, 
is_¥
, 2 );

1826 
´oc_äames
 +ð
gÝ_äame
;

1827 
cu¼_äame
 +ð
gÝ_äame
;

1828 iàÐ
‹rmš©e_pÝ
 )

1830 
‹rmš©e_pÝ
 = 0;

1837 iàÐ!
is_idr
 && !
is_šŒa
 && !
is_¥
 )

1839 
´ed_äame
 = 
	`pÝuÏ‹_»g_´ed_¡ruù_©om
Ð
p_Vid
, 
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
, 
´oc_äames
, &
‹rmš©e_pÝ
 );

1841 
cu¼_äame
 +ð
´ed_äame
;

1842 
´oc_äames
 +ð
´ed_äame
;

1843 iàÐ
‹rmš©e_pÝ
 )

1845 
‹rmš©e_pÝ
 = 0;

1851 
p_£q_¡ruù
->
pÝ_¡¬t_äame
 = 
cu¼_äame
;

1852 
	}
}

1871 
	$pÝuÏ‹_»g_pic
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
PicSŒuùu»
 *
p_pic
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_¦iûs
, 
is_bÙ_æd
 )

1873 
¦iû
;

1874 
¦iû_ty³
 = (
is_bÙ_æd
 && 
p_äm_¡ruù
->
ty³
 =ð
I_SLICE
è? ( 
p_IÅ
->
IÁ¿BÙtom
 ? I_SLICE : (p_IÅ->
BRefPiùu»s
 =ð2 ? 
B_SLICE
 : 
P_SLICE
) ) :…_frm_struct->type;

1875 
deblock
 = 
p_IÅ
->
DFS’dP¬am‘”s
 ?

1876 (!(
p_IÅ
->
DFDi§bËIdc
[
p_äm_¡ruù
->
Çl_»f_idc
][p_äm_¡ruù->
ty³
])) : 1;

1877 
weigh‹d_´ed
 = (
¦iû_ty³
 =ð
P_SLICE
) ?

1878 
p_IÅ
->
Weigh‹dP»diùiÚ
 : ((
¦iû_ty³
 =ð
B_SLICE
) ?

1879 
p_IÅ
->
Weigh‹dB»diùiÚ
 : 0);

1880 
SliûSŒuùu»
 *
p_Sliû
;

1883 
p_pic
->
idr_æag
 = !
is_bÙ_æd
 ? 
p_äm_¡ruù
->idr_flag : 0;

1884 
p_pic
->
¿ndom_acûss
 = !
is_bÙ_æd
 ? 
p_äm_¡ruù
->random_access : 0;

1885 
p_pic
->
Çl_»f_idc
 = 
p_äm_¡ruù
->nal_ref_idc;

1886 
p_pic
->
num_¦iûs
 =‚um_slices;

1888  
¦iû
 = 0; sliû < 
p_pic
->
num_¦iûs
; slice++ )

1891 
p_Sliû
 = 
p_pic
->p_Sliû + 
¦iû
;

1893 
p_Sliû
->
ty³
 = 
¦iû_ty³
;

1894 
p_Sliû
->
deblock
 = deblock;

1895 
p_Sliû
->
weigh‹d_´ed
 = weighted_pred;

1896 
p_Sliû
->
num_»fs
 = 
p_äm_¡ruù
->num_refs;

1897 
p_Sliû
->
qp
 = 
p_äm_¡ruù
->qp;

1899 
	}
}

1927 
	$pÝuÏ‹_äame
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
P»dSŒuùAtom
 *
p_cur_´d
,

1928 
cu¼_äame
, 
´ed_äame
, 
idx
, 
num_¦iûs
, 
no_ºd_acc
 )

1930 
P»dSŒuùFrm
 *
p_¤c
 = 
p_cur_´d
->
p_äm
 + 
idx
;

1933 
p_äm_¡ruù
->
ty³
 = 
p_¤c
->
¦iû_ty³
;

1934 
p_äm_¡ruù
->
¿ndom_acûss
 = 
p_¤c
->random_access;

1935 
p_äm_¡ruù
->
num_»fs
 = 
p_IÅ
->
num_»f_äames
;

1936 
p_äm_¡ruù
->
Ïy”
 = 
p_¤c
->layer;

1937 
p_äm_¡ruù
->
mod_qp
 = 
p_¤c
->
¦iû_qp_off
;

1938 
p_äm_¡ruù
->
f›ld_pic_æag
 = 0;

1939 
p_äm_¡ruù
->
äame_no
 = 
cu¼_äame
 + 
´ed_äame
 + 
p_¤c
->
di¥_off£t
;

1941 
p_äm_¡ruù
->
‹mpÜ®_Ïy”
 = 
p_¤c
->temporal_layer;

1943 iàÐ!(
cu¼_äame
 + 
´ed_äame
 + 
idx
) )

1946 
p_äm_¡ruù
->
ty³
 = 
I_SLICE
;

1947 
p_äm_¡ruù
->
idr_æag
 = 1;

1948 
p_äm_¡ruù
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGHEST
;

1951 iàÐ
p_IÅ
->
Di¥o§bËP
 && 
p_äm_¡ruù
->
ty³
 !ð
I_SLICE
 && !p_äm_¡ruù->
Ïy”
 )

1953 iàÐ!(
p_£q_¡ruù
->
Ï¡_bl_äm_di¥o§bË
) )

1955 
p_äm_¡ruù
->
Çl_»f_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

1956 
p_äm_¡ruù
->
mod_qp
 +ð
p_IÅ
->
Di¥PQPOff£t
;

1960 
p_äm_¡ruù
->
Çl_»f_idc
 = 
p_¤c
->nal_ref_idc;

1962 
p_äm_¡ruù
->
idr_æag
 = (
p_¤c
->
Çl_»f_idc
 =ð
NALU_PRIORITY_HIGHEST
) ? 1 : 0;

1964 iàÐ
no_ºd_acc
 =ð1 && !
idx
 )

1966 
p_äm_¡ruù
->
idr_æag
 = 0;

1967 
p_äm_¡ruù
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1968 
p_äm_¡ruù
->
¿ndom_acûss
 = 
p_IÅ
->
EÇbËO³nGOP
 ? 1 : 0;

1970 iàÐ
no_ºd_acc
 =ð2 && !
idx
 )

1972 
p_äm_¡ruù
->
ty³
 = 
p_IÅ
->
si_äame_šdiÿtÜ
 ? 
SI_SLICE
 : 
SP_SLICE
;

1973 
p_äm_¡ruù
->
idr_æag
 = 0;

1974 
p_äm_¡ruù
->
Çl_»f_idc
 = 
NALU_PRIORITY_HIGH
;

1975 
p_äm_¡ruù
->
¿ndom_acûss
 = 0;

1979 
p_äm_¡ruù
->
idr_æag
 = (
p_¤c
->
Çl_»f_idc
 =ð
NALU_PRIORITY_HIGHEST
) ? 1 : 0;

1980 
p_äm_¡ruù
->
Çl_»f_idc
 = 
p_¤c
->nal_ref_idc;

1983 
p_äm_¡ruù
->
qp
 =…_äm_¡ruù->
mod_qp
 + 
p_IÅ
->qp[p_äm_¡ruù->
ty³
];

1984 #ià(
DEBUG_PRED_STRUCT
)

1985 
	`årštf
Ð
¡d”r
, "\n\ÀF¿mPÝuÏtiÚ St fÜ F¿m%5d iÀcodšg ord”", 
cu¼_äame
 + 
´ed_äame
 + 
idx
 );

1986  
p_äm_¡ruù
->
ty³
 )

1989 
I_SLICE
:

1990 
	`årštf
Ð
¡d”r
, "\n Slice Type: I_SLICE " );

1992 
P_SLICE
:

1993 
	`årštf
Ð
¡d”r
, "\n Slice Type: P_SLICE " );

1995 
B_SLICE
:

1996 
	`årštf
Ð
¡d”r
, "\n Slice Type: B_SLICE " );

1998 
SP_SLICE
:

1999 
	`årštf
Ð
¡d”r
, "\n Slice Type: SP_SLICE " );

2001 
SI_SLICE
:

2002 
	`årštf
Ð
¡d”r
, "\n Slice Type: SI_SLICE " );

2005 
	`årštf
Ð
¡d”r
, "\ÀIDR…iùu»: %d ", 
p_äm_¡ruù
->
idr_æag
 );

2006  
p_äm_¡ruù
->
Çl_»f_idc
 )

2009 
NALU_PRIORITY_HIGHEST
:

2010 
	`årštf
Ð
¡d”r
, "\n NAL_reference_idc: NALU_PRIORITY_HIGHEST ");

2012 
NALU_PRIORITY_HIGH
:

2013 
	`årštf
Ð
¡d”r
, "\n NAL_reference_idc: NALU_PRIORITY_HIGH ");

2015 
NALU_PRIORITY_LOW
:

2016 
	`årštf
Ð
¡d”r
, "\n NAL_reference_idc: NALU_PRIORITY_LOW ");

2018 
NALU_PRIORITY_DISPOSABLE
:

2019 
	`årštf
Ð
¡d”r
, "\n NAL_reference_idc: NALU_PRIORITY_DISPOSABLE ");

2022 
	`årštf
Ð
¡d”r
, "\ÀRªdom Acûss: %d ", 
p_äm_¡ruù
->
¿ndom_acûss
 );

2023 
	`årštf
Ð
¡d”r
, "\ÀNumb” oàReã»nûs: %2d ", 
p_äm_¡ruù
->
num_»fs
 );

2024 
	`årštf
Ð
¡d”r
, "\ÀH›¿rchy Lay”: %d ", 
p_äm_¡ruù
->
Ïy”
 );

2025 
	`årštf
Ð
¡d”r
, "\ÀQP Modif›r: %2d ", 
p_äm_¡ruù
->
qp
 );

2026 
	`årštf
Ð
¡d”r
, "\ÀF›ld Codšg: %d ", 
p_äm_¡ruù
->
f›ld_pic_æag
 );

2027 
	`årštf
Ð
¡d”r
, "\ÀDi¥Ïy Ord”: %5d ", 
p_äm_¡ruù
->
äame_no
 );

2031 
p_äm_¡ruù
->
p_©om
 = 
p_cur_´d
;

2032 
p_äm_¡ruù
->
©om_idx
 = 
idx
;

2033 #ià(
MVC_EXTENSION_ENABLE
)

2034 
p_äm_¡ruù
->
v›w_id
 = 0;

2038  
p_IÅ
->
PicIÁ”Ïû
 )

2041 
FRAME_CODING
:

2043 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_äame_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2045 
FIELD_CODING
:

2047 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_tÝ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2049 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_bÙ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 1 );

2051 
ADAPTIVE_CODING
:

2053 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_äame_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2055 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_tÝ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2057 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_bÙ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 1 );

2060 
	}
}

2077 
	$upd©e_äame_šdiûs
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
cu¼_äame
, 
´ed_äame
 )

2079 iàÐ
p_äm_¡ruù
->
idr_æag
 )

2082 
p_£q_¡ruù
->
Ï¡_šŒa_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2083 
p_£q_¡ruù
->
Ï¡_idr_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2084 
p_£q_¡ruù
->
Ï¡_¿ndom_acûss_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2086 
p_£q_¡ruù
->
Ï¡_šŒa_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2087 
p_£q_¡ruù
->
Ï¡_idr_äame
 = 
p_äm_¡ruù
->
äame_no
;

2088 
p_£q_¡ruù
->
Ï¡_¿nd_acûss_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2091 
p_£q_¡ruù
->
Ï¡_¥_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2093 
p_£q_¡ruù
->
Ï¡_¥_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2095 iàÐ
p_äm_¡ruù
->
ty³
 =ð
I_SLICE
 )

2098 
p_£q_¡ruù
->
Ï¡_šŒa_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2100 
p_£q_¡ruù
->
Ï¡_šŒa_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2101 iàÐ
p_äm_¡ruù
->
¿ndom_acûss
 )

2104 
p_£q_¡ruù
->
Ï¡_¿ndom_acûss_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2106 
p_£q_¡ruù
->
Ï¡_¿nd_acûss_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2109 iàÐ
p_äm_¡ruù
->
ty³
 =ð
SP_SLICE
 ||…_äm_¡ruù->ty³ =ð
SI_SLICE
 )

2112 
p_£q_¡ruù
->
Ï¡_¥_äame
 = 
cu¼_äame
 + 
´ed_äame
;

2114 
p_£q_¡ruù
->
Ï¡_¥_di¥
 = 
p_äm_¡ruù
->
äame_no
;

2116 iàÐ
p_äm_¡ruù
->
Ïy”
 == 0 )

2118 iàÐ
p_äm_¡ruù
->
Çl_»f_idc
 =ð
NALU_PRIORITY_DISPOSABLE
 )

2120 
p_£q_¡ruù
->
Ï¡_bl_äm_di¥o§bË
 = 1;

2124 
p_£q_¡ruù
->
Ï¡_bl_äm_di¥o§bË
 = 0;

2127 
	}
}

2150 
	$pÝuÏ‹_»g_´ed_¡ruù_©om
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
,

2151 
cu¼_äame
, 
´oc_äames
, *
‹rmš©e_pÝ
 )

2153 
idx
;

2154 
fixed_idx
;

2155 
avaž_äames
;

2156 
´ed_äame
 = 0;

2157 
´ed_idx
;

2159 
F¿meUn™SŒuù
 *
p_äm_¡ruù
;

2160 
P»dSŒuùAtom
 *
p_cur_´d
;

2165 iàÐ!(
p_IÅ
->
šŒa_d–ay
) )

2167 
fixed_idx
 = 
	`g‘_fixed_äame_fÜ_´d
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
 );

2172 
fixed_idx
 = 
	`g‘_fixed_äame
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
 );

2174 iàÐ
fixed_idx
 == -1 )

2176 
avaž_äames
 = 
p_£q_¡ruù
->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
;

2180 
avaž_äames
 = 
fixed_idx
;

2183 iàÐ!
avaž_äames
 )

2185 *
‹rmš©e_pÝ
 = 1;

2189  
´ed_äame
 < 
avaž_äames
 )

2191 
´ed_idx
 = 
	`g‘_´d_šdex
Ð
p_IÅ
, 
p_£q_¡ruù
, 
avaž_äames
 - 
´ed_äame
 );

2194 iàÐ
fixed_idx
 =ð-1 && (
cu¼_äame
 + 
avaž_äames
è< 
p_IÅ
->
no_äames
 )

2196 iàÐ(
p_£q_¡ruù
->
num_´ds
 - 1è!ð
´ed_idx
 )

2198 *
‹rmš©e_pÝ
 = 1;

2203 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
´ed_idx
;

2207  
idx
 = 0; idx < 
p_cur_´d
->
Ëngth
; idx++ )

2210 
p_äm_¡ruù
 = 
p_£q_¡ruù
->
p_äm
 + ((
cu¼_äame
 + 
´ed_äame
 + 
idx
è% 
p_Vid
->
äm_¡ruù_bufãr
);

2213 
	`pÝuÏ‹_äame
Ð
p_IÅ
, 
p_£q_¡ruù
, 
p_äm_¡ruù
, 
p_cur_´d
, 
cu¼_äame
, 
´ed_äame
, 
idx
,…_£q_¡ruù->
max_num_¦iûs
, 0 );

2216 
	`upd©e_äame_šdiûs
Ð
p_£q_¡ruù
, 
p_äm_¡ruù
, 
cu¼_äame
, 
´ed_äame
 + 
idx
 );

2218 
´ed_äame
 +ð
idx
;

2220  
´ed_äame
;

2221 
	}
}

2249 
	$pÝuÏ‹_ºd_acc_´ed_¡ruù_©om
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
,

2250 
cu¼_äame
, 
´oc_äames
, *
‹rmš©e_pÝ
, 
is_idr
, 
no_ºd_acc
 )

2253 
idx
;

2254 
fixed_idx
;

2255 
avaž_äames
;

2256 
gÝ_äame
 = 0;

2257 
gÝ_idx
;

2258 
num_gÝs
;

2260 
F¿meUn™SŒuù
 *
p_äm_¡ruù
;

2261 
P»dSŒuùAtom
 *
p_cur_gÝ
;

2262 
P»dSŒuùAtom
 *
p_gÝ
;

2263 (*
g‘_¿nd_acc_šdex
)Ð
IÅutP¬am‘”s
 *, 
SeqSŒuùu»
 *, );

2265 iàÐ
no_ºd_acc
 == 1 )

2267 
p_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
;

2268 
num_gÝs
 = 
p_£q_¡ruù
->
num_šŒa_gÝs
;

2269 
g‘_¿nd_acc_šdex
 = 
g‘_šŒa_šdex
;

2273 
p_gÝ
 = 
p_£q_¡ruù
->p_gop;

2274 
num_gÝs
 = 
p_£q_¡ruù
->num_gops;

2275 
g‘_¿nd_acc_šdex
 = 
g‘_idr_šdex
;

2281 
fixed_idx
 = 
	`g‘_fixed_äame
Ð
p_IÅ
, 
p_£q_¡ruù
, 
cu¼_äame
 + 1,…_£q_¡ruù->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
 - 1 );

2282 iàÐ
fixed_idx
 == -1 )

2284 
avaž_äames
 = 
p_£q_¡ruù
->
cu¼_num_to_pÝuÏ‹
 - 
´oc_äames
;

2288 
avaž_äames
 = 
fixed_idx
 + 1;

2293 iàÐ!
cu¼_äame
 && !(
p_IÅ
->
EÇbËIDRGOP
è&& !Õ_IÅ->
šŒa_d–ay
) )

2295 
gÝ_idx
 = 0;

2297 iàÐ!
cu¼_äame
 && !(
p_IÅ
->
EÇbËIDRGOP
è&&…_IÅ->
šŒa_d–ay
 )

2299 
gÝ_idx
 = 1;

2303 iàÐ!(
p_IÅ
->
P»ãrDi¥Ord”
) )

2306 
gÝ_idx
 = 
	`g‘_¿nd_acc_šdex
Ð
p_IÅ
, 
p_£q_¡ruù
, 
avaž_äames
 );

2311 
gÝ_idx
 = 
is_idr
 - 1;

2314 iàÐ
fixed_idx
 =ð-1 && (
cu¼_äame
 + 
avaž_äames
è< 
p_IÅ
->
no_äames
 )

2316 iàÐ(
num_gÝs
 - 1è!ð
gÝ_idx
 && !
p_£q_¡ruù
->
pÝ_æag
 )

2318 *
‹rmš©e_pÝ
 = 1;

2325 iàÐ
p_£q_¡ruù
->
pÝ_æag
 )

2327 
p_£q_¡ruù
->
pÝ_æag
 = 0;

2331 
p_cur_gÝ
 = 
p_gÝ
 + 
gÝ_idx
;

2333  
idx
 = 0; idx < 
p_cur_gÝ
->
Ëngth
; idx++ )

2336 
p_äm_¡ruù
 = 
p_£q_¡ruù
->
p_äm
 + ((
cu¼_äame
 + 
gÝ_äame
 + 
idx
è% 
p_Vid
->
äm_¡ruù_bufãr
);

2339 
	`pÝuÏ‹_äame
Ð
p_IÅ
, 
p_£q_¡ruù
, 
p_äm_¡ruù
, 
p_cur_gÝ
, 
cu¼_äame
, 
gÝ_äame
, 
idx
,…_£q_¡ruù->
max_num_¦iûs
, 
no_ºd_acc
 );

2342 
	`upd©e_äame_šdiûs
Ð
p_£q_¡ruù
, 
p_äm_¡ruù
, 
cu¼_äame
, 
gÝ_äame
 + 
idx
 );

2344 
gÝ_äame
 +ð
idx
;

2346  
gÝ_äame
;

2347 
	}
}

2358 
	$ä“_gÝ_¡ruù
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 )

2360 
idx
;

2361 
P»dSŒuùAtom
 *
p_cur_gÝ
;

2364  
idx
 = 0; idx < 
p_£q_¡ruù
->
num_gÝs
; idx++ )

2366 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_gÝ
 + 
idx
;

2367 
	`ä“
Ð
p_cur_gÝ
->
p_äm
 );

2369 
	`ä“
Ð
p_£q_¡ruù
->
p_gÝ
 );

2371  
idx
 = 0; idx < 
p_£q_¡ruù
->
num_šŒa_gÝs
; idx++ )

2373 
p_cur_gÝ
 = 
p_£q_¡ruù
->
p_šŒa_gÝ
 + 
idx
;

2374 
	`ä“
Ð
p_cur_gÝ
->
p_äm
 );

2376 
	`ä“
Ð
p_£q_¡ruù
->
p_šŒa_gÝ
 );

2377 
	}
}

2388 
	$ä“_´ed_¡ruù
Ð
SeqSŒuùu»
 *
p_£q_¡ruù
 )

2390 
idx
;

2391 
P»dSŒuùAtom
 *
p_cur_´d
;

2394  
idx
 = 0; idx < 
p_£q_¡ruù
->
num_´ds
; idx++ )

2396 
p_cur_´d
 = 
p_£q_¡ruù
->
p_´d
 + 
idx
;

2397 
	`ä“
Ð
p_cur_´d
->
p_äm
 );

2399 
	`ä“
Ð
p_£q_¡ruù
->
p_´d
 );

2400 
	}
}

2417 
	$pÝuÏ‹_äame_ex¶ic™
Ð
ExpF¿meInfo
 *
šfo
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
num_¦iûs
 )

2420 
p_äm_¡ruù
->
idr_æag
 = 
šfo
->
is_idr
;

2421 
p_äm_¡ruù
->
Çl_»f_idc
 = 
šfo
->
»ã»nû_idc
;

2422 
p_äm_¡ruù
->
ty³
 = 
šfo
->
¦iû_ty³
;

2423 
p_äm_¡ruù
->
¿ndom_acûss
 = 
šfo
->
is_idr
;

2424 
p_äm_¡ruù
->
num_»fs
 = 
p_IÅ
->
num_»f_äames
;

2425 
p_äm_¡ruù
->
Ïy”
 = 
šfo
->
»ã»nû_idc
 ? 0 : 1;

2426 
p_äm_¡ruù
->
mod_qp
 = 0;

2427 
p_äm_¡ruù
->
f›ld_pic_æag
 = 0;

2428 
p_äm_¡ruù
->
äame_no
 = 
šfo
->
£q_numb”
;

2429 
p_äm_¡ruù
->
qp
 =…_äm_¡ruù->
mod_qp
 + 
p_IÅ
->qp[p_äm_¡ruù->
ty³
];

2432  
p_IÅ
->
PicIÁ”Ïû
 )

2435 
FRAME_CODING
:

2437 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_äame_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2439 
FIELD_CODING
:

2441 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_tÝ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2443 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_bÙ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 1 );

2445 
ADAPTIVE_CODING
:

2447 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_äame_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2449 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_tÝ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2451 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_bÙ_æd_pic
,…_äm_¡ruù, 
num_¦iûs
, 1 );

2454 
	}
}

2471 
	$pÝuÏ‹_äame_¦iû_ty³
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_äm_¡ruù
, 
¦iû_ty³
, 
num_¦iûs
 )

2473 
p_äm_¡ruù
->
ty³
 = 
¦iû_ty³
;

2476 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_äm_¡ruù
->
p_äame_pic
,…_äm_¡ruù, 
num_¦iûs
, 0 );

2477 
	}
}

2479 #ià(
MVC_EXTENSION_ENABLE
)

2497 
	$pÝuÏ‹_äm_¡ruù_mvc
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
SeqSŒuùu»
 *
p_£q_¡ruù
, 
¡¬t
, 
’d
 )

2499 
v›w_id
;

2500 
idx
;

2501 
F¿meUn™SŒuù
 *
p_cu¼_äm
, *
p_äm
 = 
p_£q_¡ruù
->p_frm;

2502 
F¿meUn™SŒuù
 *
p_cu¼_äm_mvc
, *
p_äm_mvc
 = 
p_£q_¡ruù
->p_frm_mvc;

2504 iàÐ
p_IÅ
->
num_of_v›ws
 == 2 )

2506  
idx
 = 
¡¬t
; idx < 
’d
; idx++ )

2508 
p_cu¼_äm
 = 
p_äm
 + (
idx
 % 
p_Vid
->
äm_¡ruù_bufãr
);

2511 
p_cu¼_äm_mvc
 = 
p_äm_mvc
 + ((
idx
 << 1è% 
p_£q_¡ruù
->
num_äames_mvc
);

2512 
	`cÝy_äame_mvc
Ð
p_IÅ
, 
p_cu¼_äm
, 
p_cu¼_äm_mvc
, 
p_£q_¡ruù
->
max_num_¦iûs
, 0 );

2514 
p_cu¼_äm_mvc
 = 
p_äm_mvc
 + (((
idx
 << 1è+ 1è% 
p_£q_¡ruù
->
num_äames_mvc
);

2515 
	`cÝy_äame_mvc
Ð
p_IÅ
, 
p_cu¼_äm
, 
p_cu¼_äm_mvc
, 
p_£q_¡ruù
->
max_num_¦iûs
, 1 );

2520 
	`as£¹
Ð
p_IÅ
->
num_of_v›ws
 > 2 );

2521  
idx
 = 
¡¬t
; idx < 
’d
; idx++ )

2523 
p_cu¼_äm
 = 
p_äm
 + (
idx
 % 
p_Vid
->
äm_¡ruù_bufãr
);

2525  
v›w_id
 = 0; v›w_id < 
p_IÅ
->
num_of_v›ws
; view_id++ )

2528 
p_cu¼_äm_mvc
 = 
p_äm_mvc
 + (((
idx
 * 
p_IÅ
->
num_of_v›ws
è+ 
v›w_id
è% 
p_£q_¡ruù
->
num_äames_mvc
);

2529 
	`cÝy_äame_mvc
Ð
p_IÅ
, 
p_cu¼_äm
, 
p_cu¼_äm_mvc
, 
p_£q_¡ruù
->
max_num_¦iûs
, 
v›w_id
 );

2533 
	}
}

2554 
	$cÝy_äame_mvc
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
F¿meUn™SŒuù
 *
p_¤c
, F¿meUn™SŒuù *
p_d¡
, 
num_¦iûs
, 
v›w_id
 )

2557 
p_d¡
->
ty³
 = 
v›w_id
 ? 
p_IÅ
->
MVCIÁ”V›wFÜûB
 !ð0? 
B_SLICE
 : (
p_¤c
->ty³ =ð
I_SLICE
 ? (p_IÅ->
BRefPiùu»s
 =ð2 ? B_SLICE : 
P_SLICE
) :…_src->type) :…_src->type;

2558 
p_d¡
->
¿ndom_acûss
 = 
p_¤c
->random_access;

2559 
p_d¡
->
num_»fs
 = 
p_¤c
->num_refs;

2560 
p_d¡
->
Ïy”
 = 
p_¤c
->layer;

2561 
p_d¡
->
mod_qp
 = 
p_¤c
->mod_qp;

2562 
p_d¡
->
f›ld_pic_æag
 = 
p_¤c
->field_pic_flag;

2563 
p_d¡
->
äame_no
 = 
p_¤c
->frame_no;

2564 
p_d¡
->
idr_æag
 = 
v›w_id
 ? 0 : 
p_¤c
->idr_flag;

2565 
p_d¡
->
Çl_»f_idc
 = 
v›w_id
 ? (
p_¤c
->
idr_æag
 ? 
NALU_PRIORITY_HIGH
 :…_src->nal_ref_idc) :…_src->nal_ref_idc;

2566 
p_d¡
->
qp
 = 
p_¤c
->qp;

2567 
p_d¡
->
p_©om
 = 
p_¤c
->p_atom;

2568 
p_d¡
->
©om_idx
 = 
p_¤c
->atom_idx;

2569 
p_d¡
->
v›w_id
 = view_id;

2572  
p_IÅ
->
PicIÁ”Ïû
 )

2575 
FRAME_CODING
:

2577 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_äame_pic
,…_d¡, 
num_¦iûs
, 0 );

2579 
FIELD_CODING
:

2581 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_tÝ_æd_pic
,…_d¡, 
num_¦iûs
, 0 );

2583 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_bÙ_æd_pic
,…_d¡, 
num_¦iûs
, 1 );

2585 
ADAPTIVE_CODING
:

2587 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_äame_pic
,…_d¡, 
num_¦iûs
, 0 );

2589 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_tÝ_æd_pic
,…_d¡, 
num_¦iûs
, 0 );

2591 
	`pÝuÏ‹_»g_pic
Ð
p_IÅ
, 
p_d¡
->
p_bÙ_æd_pic
,…_d¡, 
num_¦iûs
, 1 );

2594 
	}
}

	@lencod/src/q_around.c

15 
	~"glob®.h
"

16 
	~"mem®loc.h
"

17 
	~"q_off£ts.h
"

18 
	~"q_¬ound.h
"

20 cÚ¡ 
	gAd­tRndCrPos
[2][5] =

27 cÚ¡ 
	gAd­tRndPos
[4][5] =

43 
	$¡Üe_ad­tive_roundšg_4x4
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
, 
mode
, 
block_y
, 
block_x
)

45 
j
;

47 
j
 = 
block_y
; j < block_y + 4; j++)

48 
	`memýy
(&
ARCofAdj
[0][
DUMMY
][
j
][
block_x
], &ARCofAdj[0][
mode
][j][block_x], 
BLOCK_SIZE
 * ());

50 ià(
p_Vid
->
P444_jošed
)

52 
j
 = 
block_y
; j < block_y + 4; j++)

54 
	`memýy
(&
ARCofAdj
[1][
DUMMY
][
j
][
block_x
],&ARCofAdj[1][
mode
][j][block_x], 
BLOCK_SIZE
 * ());

56 
j
 = 
block_y
; j < block_y + 4; j++)

58 
	`memýy
(&
ARCofAdj
[2][
DUMMY
][
j
][
block_x
],&ARCofAdj[2][
mode
][j][block_x], 
BLOCK_SIZE
 * ());

61 
	}
}

70 
	$upd©e_ad­tive_roundšg_4x4
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
 , 
mode
, 
block_y
, 
block_x
)

72 
j
;

74 
j
 = 
block_y
; j < block_y + 
BLOCK_SIZE
; j++)

75 
	`memýy
 (&
ARCofAdj
[0][
mode
][
j
][
block_x
],&ARCofAdj[0][
DUMMY
][j][block_x], 
BLOCK_SIZE
 * ());

77 ià(
p_Vid
->
P444_jošed
)

79 
j
 = 0; j < 
block_y
 + 
BLOCK_SIZE
; j++)

81 
	`memýy
 (&
ARCofAdj
[1][
mode
][
j
][
block_x
], &ARCofAdj[1][
DUMMY
][j][block_x], 
BLOCK_SIZE
 * ());

83 
j
 = 0; j < 
block_y
 + 
BLOCK_SIZE
; j++)

85 
	`memýy
 (&
ARCofAdj
[2][
mode
][
j
][
block_x
], &ARCofAdj[2][
DUMMY
][j][block_x], 
BLOCK_SIZE
 * ());

88 
	}
}

96 
	$¡Üe_ad­tive_roundšg_16x16
 (
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
, 
mode
)

98 
	`memýy
(&
ARCofAdj
[0][
DUMMY
][0][0], &ARCofAdj[0][
mode
][0][0], 
MB_PIXELS
 * ());

99 ià(
p_Vid
->
P444_jošed
)

101 
	`memýy
(&
ARCofAdj
[1][
DUMMY
][0][0], &ARCofAdj[1][
mode
][0][0], 
MB_PIXELS
 * ());

102 
	`memýy
(&
ARCofAdj
[2][
DUMMY
][0][0], &ARCofAdj[2][
mode
][0][0], 
MB_PIXELS
 * ());

104 
	}
}

113 
	$upd©e_ad­tive_roundšg_16x16
(
VideoP¬am‘”s
 *
p_Vid
, ****
ARCofAdj
 , 
mode
)

115 
	`memýy
 (&
ARCofAdj
[0][
mode
][0][0],&ARCofAdj[0][
DUMMY
][0][0], 
MB_PIXELS
 * ());

116 ià(
p_Vid
->
P444_jošed
)

118 
	`memýy
 (&
ARCofAdj
[1][
mode
][0][0], &ARCofAdj[1][
DUMMY
][0][0], 
MB_PIXELS
 * ());

119 
	`memýy
 (&
ARCofAdj
[2][
mode
][0][0], &ARCofAdj[2][
DUMMY
][0][0], 
MB_PIXELS
 * ());

121 
	}
}

132 
	$upd©e_off£t_·¿ms
(
Maüoblock
 *
cu¼MB
, 
mode
, 
by‹
 
luma_ŒªsfÜm_size_8x8_æag
)

134 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

135 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

136 
is_š‹r
 = (
mode
 !ð
I4MB
)&&(mod!ð
I16MB
è&& (mod!ð
I8MB
);

137 
luma_pos
 = 
Ad­tRndPos
[(
is_š‹r
<<1è+ 
luma_ŒªsfÜm_size_8x8_æag
][
p_Vid
->
ty³
];

138 
i
,
j
;

139 
qp
 = 
cu¼MB
->q°+ 
p_Vid
->
b™d•th_luma_qp_sÿË
;

140 
cur_qp
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

141 
‹mp
 = 0;

142 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

143 
off£tRªge
 = 1 << (
Off£tB™s
 - 1);

144 
blk_mask
 = 0x03 + (
luma_ŒªsfÜm_size_8x8_æag
<<2);

145 
blk_shiá
 = 2 + 
luma_ŒªsfÜm_size_8x8_æag
;

146 **
off£tLi¡
 = 
luma_ŒªsfÜm_size_8x8_æag
 ? 
p_Quªt
->
Off£tLi¡8x8
[
cur_qp
] :…_Quªt->
Off£tLi¡4x4
[cur_qp];

147 *
cur_off£t_li¡
 = 
off£tLi¡
[
luma_pos
];

149 **
fAdju¡
 = 
luma_ŒªsfÜm_size_8x8_æag
 ? 
p_Vid
->
ARCofAdj8x8
[0][
mode
] :…_Vid->
ARCofAdj4x4
[0][mode];

151 ià(
mode
 =ð
IPCM
) ;

153 ifÐ(
p_Vid
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

155 ifÐ
luma_ŒªsfÜm_size_8x8_æag
 )

156 
luma_pos
 +ð5 * 
p_Vid
->
cÞour_¶ªe_id
;

158 
luma_pos
 +ð
p_Vid
->
cÞour_¶ªe_id
;

159 
cur_off£t_li¡
 = 
off£tLi¡
[
luma_pos
];

162 
j
=0; j < 
MB_BLOCK_SIZE
; j++)

164 
j_pos
 = ((
j
 & 
blk_mask
)<<
blk_shiá
);

165 
i
=0; i < 
MB_BLOCK_SIZE
; i++)

167 
‹mp
 = 
j_pos
 + (
i
 & 
blk_mask
);

168 
cur_off£t_li¡
[
‹mp
] = (è
	`iCl3
(0, 
off£tRªge
, cur_off£t_li¡[‹mp] + (è
fAdju¡
[
j
][
i
]);

172 if(
p_Vid
->
P444_jošed
)

174 **
fAdju¡CbCr
;

175 
uv
;

177 
uv
 = 0; uv < 2; uv++)

179 
luma_pos
 = 
Ad­tRndPos
[(
is_š‹r
<<1è+ 
luma_ŒªsfÜm_size_8x8_æag
][
p_Vid
->
ty³
];

180 
fAdju¡CbCr
 = 
luma_ŒªsfÜm_size_8x8_æag
 ? 
p_Vid
->
ARCofAdj8x8
[
uv
 + 1][
mode
] :…_Vid->
ARCofAdj4x4
[uv + 1][mode];

181 if(
luma_ŒªsfÜm_size_8x8_æag
 )

182 
luma_pos
 +ð5 * (
uv
+1);

184 
luma_pos
 +ð(
uv
+1);

185 
cur_off£t_li¡
 = 
off£tLi¡
[
luma_pos
];

186 
j
=0; j < 
MB_BLOCK_SIZE
; j++)

188 
j_pos
 = ((
j
 & 
blk_mask
)<<
blk_shiá
);

189 
i
=0; i < 
MB_BLOCK_SIZE
; i++)

191 
‹mp
 = 
j_pos
 + (
i
 & 
blk_mask
);

192 
cur_off£t_li¡
[
‹mp
] = (è
	`iCl3
(0, 
off£tRªge
, cur_off£t_li¡[‹mp] + (è
fAdju¡CbCr
[
j
][
i
]);

198 ià((
p_IÅ
->
Ad­tRndChroma
è&& (
p_Vid
->
yuv_fÜm©
 =ð
YUV420
 ||…_Vid->yuv_fÜm© =ð
YUV422
 ))

200 
u_pos
 = 
Ad­tRndCrPos
[
is_š‹r
][
p_Vid
->
ty³
];

201 
v_pos
 = 
u_pos
 + 1;

202 
k
, 
jpos
, 
uv
 = 1;

204 
k
 = 
u_pos
; k <ð
v_pos
; k++)

206 **
fAdju¡Chroma
 = (
luma_ŒªsfÜm_size_8x8_æag
 && 
mode
 =ð
P8x8
 )? 
p_Vid
->
ARCofAdj4x4
[
uv
][4] :…_Vid->ARCofAdj4x4[uv][mode];

207 
uv
++;

208 
cur_off£t_li¡
 = 
p_Quªt
->
Off£tLi¡4x4
[
cur_qp
][
k
];

210 
j
 = 0; j < 
p_Vid
->
mb_ü_size_y
; j++)

212 
jpos
 = ((
j
 & 0x03)<<2);

213 
i
 = 0; i < 
p_Vid
->
mb_ü_size_x
; i++)

215 
‹mp
 = 
jpos
 + (
i
 & 0x03);

216 
cur_off£t_li¡
[
‹mp
] = (è
	`iCl3
(0, 
off£tRªge
, cur_off£t_li¡[‹mp] + (è
fAdju¡Chroma
[
j
][
i
]);

221 
	}
}

230 
	$»£t_ad­tive_roundšg
(
VideoP¬am‘”s
 *
p_Vid
)

232 
max¶ªe
;

233 
max¶ªe
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV400
)? 1 : 3;

234 
	`mem£t
(&
p_Vid
->
ARCofAdj4x4
[0][0][0][0], 0, 
max¶ªe
 * 
MAXMODE
 * 
MB_PIXELS
 *  ());

235 ià(
p_Vid
->
p_IÅ
->
T¿nsfÜm8x8Mode
)

237 
max¶ªe
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV400
)? 1 : (p_Vid->
P444_jošed
 ? 3 : 1);

238 
	`mem£t
(&
p_Vid
->
ARCofAdj8x8
[0][0][0][0], 0, 
max¶ªe
 * 
MAXMODE
 * 
MB_PIXELS
 *  ());

240 
	}
}

248 
	$»£t_ad­tive_roundšg_dœeù
(
VideoP¬am‘”s
 *
p_Vid
)

250 
max¶ªe
, 
¶
;

251 
max¶ªe
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV400
)? 1 : 3;

252 
¶
 = 0;…È< 
max¶ªe
;…l++)

253 
	`mem£t
(&
p_Vid
->
ARCofAdj4x4
[
¶
][
DUMMY
][0][0], 0, 
MB_PIXELS
 *  ());

255 ià(
p_Vid
->
p_IÅ
->
T¿nsfÜm8x8Mode
)

257 
max¶ªe
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV400
)? 1 : (p_Vid->
P444_jošed
 ? 3 : 1);

258 
¶
 = 0;…È< 
max¶ªe
;…l++)

259 
	`mem£t
(&
p_Vid
->
ARCofAdj8x8
[
¶
][
DUMMY
][0][0], 0, 
MB_PIXELS
 *  ());

262 
	}
}

270 
	$upd©e_ad­tive_roundšg_8x8
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RD_8x8DATA
* 
d©aTr
, **** 
ARCofAdj
)

272 
b8
, 
¶
, 
¶ªe
, 
j0
, 
i0
, 
j
;

274 ià(
p_IÅ
->
Ad­tiveRoundšg
)

276 
¶ªe
 = (
p_Vid
->
P444_jošed
) ? 3 : 1;

277 
¶
 = 0;…È< 
¶ªe
;…l++)

279 
b8
 = 0; b8 < 4; b8++)

281 
j0
 = 8*(
b8
 >> 1);

282 
i0
 = 8*(
b8
 & 0x01);

283 ià(
d©aTr
->
·¹
[
b8
].
mode
 > 0)

285 
j
 = 
j0
; j < j0 + 
BLOCK_SIZE_8x8
; j++)

287 
	`memýy
(&
ARCofAdj
[
¶
][
P8x8
][
j
][
i0
], &ARCofAdj[¶][(è
d©aTr
->
·¹
[
b8
].
mode
][j][i0], 
BLOCK_SIZE_8x8
 * ());

293 
	}
}

	@lencod/src/q_matrix.c

12 
	~"glob®.h
"

13 
	~"mem®loc.h
"

14 
	~"q_m©rix.h
"

16 *
G‘CÚfigFžeCÚ‹Á
 (*
Fž’ame
, 
”rÜ_ty³
);

18 
	#MAX_ITEMS_TO_PARSE
 1000

	)

20 cÚ¡ 
	gquªt_cÛf
[6][4][4] = {

29 cÚ¡ 
	gdequªt_cÛf
[6][4][4] = {

38 cÚ¡ 
	gquªt_cÛf8
[6][8][8] =

104 cÚ¡ 
	gdequªt_cÛf8
[6][8][8] =

169 
	gm©rix4x4_check
[6] = {0, 0, 0, 0, 0, 0};

170 
	gm©rix8x8_check
[6] = {0, 0, 0, 0, 0, 0};

172 cÚ¡ 
	gM©rixTy³4x4
[6][20] =

182 cÚ¡ 
	gM©rixTy³8x8
[6][20] =

193 cÚ¡ 
	gQuªt_šŒa_deçuÉ
[16] =

201 cÚ¡ 
	gQuªt_š‹r_deçuÉ
[16] =

209 cÚ¡ 
	gQuªt8_šŒa_deçuÉ
[64] =

221 cÚ¡ 
	gQuªt8_š‹r_deçuÉ
[64] =

247 
	$CheckP¬am‘”Name
 (*
s
, *
ty³
)

249 
i
 = 0;

251 *
ty³
 = 0;

252 (
M©rixTy³4x4
[
i
] !ð
NULL
) && (i<6))

254 ià(0==
	`¡rcmp
 (
M©rixTy³4x4
[
i
], 
s
))

255  
i
;

257 
i
++;

260 
i
 = 0;

261 *
ty³
 = 1;

262 (
M©rixTy³8x8
[
i
] !ð
NULL
) && (i<6))

264 ià(0==
	`¡rcmp
 (
M©rixTy³8x8
[
i
], 
s
))

265  
i
;

267 
i
++;

271 
	}
}

285 
	$P¬£M©rix
 (
VideoP¬am‘”s
 *
p_Vid
, *
buf
, 
bufsize
)

287 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

288 *
™ems
[
MAX_ITEMS_TO_PARSE
] = {
NULL
};

289 
M­Idx
;

290 
™em
 = 0;

291 
InSŒšg
 = 0, 
InI‹m
 = 0;

292 *
p
 = 
buf
;

293 *
buãnd
 = &
buf
[
bufsize
];

294 
IÁCÚ‹Á
;

295 
i
, 
j
, 
¿nge
, 
ty³
, 
út
;

296 *
SÿlšgLi¡
;

298 
p
 < 
buãnd
)

300 *
p
)

303 
p
++;

306 *
p
 = '\0';

307 *
p
 !ð'\n' &&… < 
buãnd
)

308 
p
++;

309 
InSŒšg
 = 0;

310 
InI‹m
 = 0;

313 
InI‹m
 = 0;

314 
InSŒšg
 = 0;

315 *
p
++='\0';

319 ià(
InSŒšg
)

320 
p
++;

323 *
p
++ = '\0';

324 
InI‹m
 = 0;

329 *
p
++ = '\0';

330 ià(!
InSŒšg
)

332 
™ems
[
™em
++] = 
p
;

333 
InI‹m
 = ~InItem;

336 
InI‹m
 = 0;

337 
InSŒšg
 = ~InString;

341 
p
++;

342 
InI‹m
 = 0;

346 ià(!
InI‹m
)

348 
™ems
[
™em
++] = 
p
;

349 
InI‹m
 = ~InItem;

351 
p
++;

355 
™em
--;

357 
i
=0; i<
™em
; i+=
út
)

359 
út
=0;

360 ià(0 > (
M­Idx
 = 
	`CheckP¬am‘”Name
 (
™ems
[
i
+
út
], &
ty³
)))

362 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " P¬sšgƒ¼Ü iÀquªtiz©iÚ m©rix cÚfig fže: P¬am‘” Nam'%s'‚Ù„ecognized.", 
™ems
[
i
+
út
]);

363 
	`”rÜ
 (
”rÜ‹xt
, 300);

365 
út
++;

366 ià(
	`¡rcmp
 ("=", 
™ems
[
i
+
út
]))

368 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " Parsingƒrror in quantization matrix config file: '='ƒxpected‡she secondoken inƒach item.");

369 
	`”rÜ
 (
”rÜ‹xt
, 300);

371 
út
++;

373 ià(!
ty³
)

375 
¿nge
 = 16;

376 
SÿlšgLi¡
 = 
p_QSÿË
->
SÿlšgLi¡4x4šput
[
M­Idx
];

377 
m©rix4x4_check
[
M­Idx
] = 1;

381 
¿nge
 = 64;

382 
SÿlšgLi¡
 = 
p_QSÿË
->
SÿlšgLi¡8x8šput
[
M­Idx
];

383 
m©rix8x8_check
[
M­Idx
] = 1;

386 
j
=0; j<
¿nge
; j++)

388 ià(1 !ð
	`ssÿnf
 (
™ems
[
i
+
út
+
j
], "%d", &
IÁCÚ‹Á
))

390 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, " P¬sšgƒ¼Ü iÀquªtiz©iÚ m©rix fže: Ex³ùed‚um”iÿÈv®ufÜ P¬am‘” oà%s, found '%s'.", 
™ems
[
i
], i‹ms[i+
út
+
j
]);

391 
	`”rÜ
 (
”rÜ‹xt
, 300);

394 
SÿlšgLi¡
[
j
] = ()
IÁCÚ‹Á
;

396 
út
+=
j
;

397 
	`´štf
 (".");

399 
	}
}

408 
	$P©chM©rix
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

410 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

411 *
SÿlšgLi¡
;

412 
i
, 
út
, 
çž
;

414 
i
=0; i<6; i++)

416 if(
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[
i
])

418 
SÿlšgLi¡
 = 
p_QSÿË
->
SÿlšgLi¡4x4šput
[
i
];

419 if(
m©rix4x4_check
[
i
])

421 
çž
=0;

422 
út
=0; cnt<16; cnt++)

424 if(
SÿlšgLi¡
[
út
]<0 || ScalingList[cnt]>255)

426 
çž
=1;

431 if(
çž
)

433 
	`´štf
("\n% v®uexûed„ªge. (V®umu¡ b1Ø255)\n", 
M©rixTy³4x4
[
i
]);

434 
	`´štf
("Setting default values forhis matrix.");

435 if(
i
>2)

436 
	`memýy
(
SÿlšgLi¡
, 
Quªt_š‹r_deçuÉ
, ()*16);

438 
	`memýy
(
SÿlšgLi¡
, 
Quªt_šŒa_deçuÉ
, ()*16);

443 
	`´štf
("\n% m©rix defš™iÚ‚Ù found. S‘tšg deçuÉ v®ues.", 
M©rixTy³4x4
[
i
]);

444 if(
i
>2)

445 
	`memýy
(
SÿlšgLi¡
, 
Quªt_š‹r_deçuÉ
, ()*16);

447 
	`memýy
(
SÿlšgLi¡
, 
Quªt_šŒa_deçuÉ
, ()*16);

451 if(
p_IÅ
->
SÿlšgLi¡P»£ÁFÏg
[
i
+6])

453 
SÿlšgLi¡
 = 
p_QSÿË
->
SÿlšgLi¡8x8šput
[
i
];

454 if(
m©rix8x8_check
[
i
])

456 
çž
=0;

457 
út
=0; cnt<64; cnt++)

459 if(
SÿlšgLi¡
[
út
]<0 || ScalingList[cnt]>255)

461 
çž
=1;

466 if(
çž
)

468 
	`´štf
("\n% v®uexûed„ªge. (V®umu¡ b1Ø255)\n", 
M©rixTy³8x8
[
i
]);

469 
	`´štf
("Setting default values forhis matrix.");

470 if(
i
==1 || i==3 || i==5)

471 
	`memýy
(
SÿlšgLi¡
, 
Quªt8_š‹r_deçuÉ
, ()*64);

473 
	`memýy
(
SÿlšgLi¡
, 
Quªt8_šŒa_deçuÉ
, ()*64);

478 
	`´štf
("\n% m©rix defš™iÚ‚Ù found. S‘tšg deçuÉ v®ues.", 
M©rixTy³8x8
[
i
]);

479 if(
i
==1 || i==3 || i==5)

480 
	`memýy
(
SÿlšgLi¡
, 
Quªt8_š‹r_deçuÉ
, ()*64);

482 
	`memýy
(
SÿlšgLi¡
, 
Quªt8_šŒa_deçuÉ
, ()*64);

486 
	}
}

494 
	$®loÿ‹_QM©rix
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
)

496 
max_b™d•th
 = 
	`imax
(
p_IÅ
->
ouut
.
b™_d•th
[0],…_Inp->output.bit_depth[1]);

497 
max_qp
 = (3 + 6*(
max_b™d•th
));

499 
b™d•th_qp_sÿË
 = 6*(
p_IÅ
->
ouut
.
b™_d•th
[0] - 8);

500 
i
;

502 
	`g‘_mem5Dquªt
(&
p_Quªt
->
q_·¿ms_4x4
, 3, 2, 
max_qp
 + 1, 4, 4);

503 
	`g‘_mem5Dquªt
(&
p_Quªt
->
q_·¿ms_8x8
, 3, 2, 
max_qp
 + 1, 8, 8);

505 ià((
p_Quªt
->
qp_³r_m©rix
 = (*)
	`m®loc
((
MAX_QP
 + 1 + 
b™d•th_qp_sÿË
)*())è=ð
NULL
)

506 
	`no_mem_ex™
("allocate_QMatrix:…_Quant->qp_per_matrix");

507 ià((
p_Quªt
->
qp_»m_m©rix
 = (*)
	`m®loc
((
MAX_QP
 + 1 + 
b™d•th_qp_sÿË
)*())è=ð
NULL
)

508 
	`no_mem_ex™
("allocate_QMatrix:…_Quant->qp_per_matrix");

510 
i
 = 0; i < 
MAX_QP
 + 
b™d•th_qp_sÿË
 + 1; i++)

512 
p_Quªt
->
qp_³r_m©rix
[
i
] = i / 6;

513 
p_Quªt
->
qp_»m_m©rix
[
i
] = i % 6;

515 
	}
}

523 
	$ä“_QM©rix
 (
QuªtP¬am‘”s
 *
p_Quªt
)

525 
	`ä“_mem5Dquªt
(
p_Quªt
->
q_·¿ms_4x4
);

526 
	`ä“_mem5Dquªt
(
p_Quªt
->
q_·¿ms_8x8
);

528 
	`ä“
(
p_Quªt
->
qp_»m_m©rix
);

529 
	`ä“
(
p_Quªt
->
qp_³r_m©rix
);

530 
	}
}

539 
	$š™_qm©rix
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

541 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

542 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

543 *
cÚ‹Á
;

545 
	`®loÿ‹_QM©rix
 (
p_Quªt
, 
p_IÅ
);

547 if(
p_IÅ
->
SÿlšgM©rixP»£ÁFÏg
)

549 
	`´štf
 ("P¬sšg QM©rix fž% ", 
p_IÅ
->
Qm©rixFže
);

550 
cÚ‹Á
 = 
	`G‘CÚfigFžeCÚ‹Á
(
p_IÅ
->
Qm©rixFže
, 0);

551 if(
cÚ‹Á
!='\0')

552 
	`P¬£M©rix
(
p_Vid
, 
cÚ‹Á
, (è
	`¡¾’
 (content));

554 
	`´štf
("\nE¼Ü: %s\nProûedšg w™h deçuÉ v®ue fÜ‡Î m©riûs.", 
”rÜ‹xt
);

556 
	`P©chM©rix
(
p_Vid
, 
p_IÅ
);

557 
	`´štf
("\n");

559 
	`mem£t
(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
, 0, 6 * ());

560 
	`mem£t
(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
, 0, 6 * ());

562 
	`ä“
(
cÚ‹Á
);

564 
	}
}

566 
£t_deçuÉ_quªt4x4
(
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
, cÚ¡ (*
quªt
)[4], cÚ¡ (*
dequªt
)[4])

568 
	gi
, 
	gj
;

569 
	gj
=0; j<4; j++)

571 
	gi
=0; i<4; i++)

573 
	gq_·¿ms_4x4
[
j
][
i
].
	gSÿËComp
 = 
quªt
[j][i];

574 
	gq_·¿ms_4x4
[
j
][
i
].
	gInvSÿËComp
 = 
dequªt
[j][i]<<4;

591 
	$C®cuÏ‹Quªt4x4P¬am
(
VideoP¬am‘”s
 *
p_Vid
)

593 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

594 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

596 
pic_·¿m‘”_£t_rb¥_t
 *
aùive_µs
 = 
p_Vid
->active_pps;

597 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

599 
i
, 
j
, 
k
, 
‹mp
;

600 
k_mod
;

601 
´e£Á
[6];

602 
no_q_m©rix
=
FALSE
;

604 
max_b™d•th
 = 
	`imax
(
p_Vid
->
b™d•th_luma
,…_Vid->
b™d•th_chroma
);

605 
max_qp
 = (3 + 6*(
max_b™d•th
));

608 if(!
aùive_¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
 && !
aùive_µs
->
pic_sÿlšg_m©rix_´e£Á_æag
)

609 
no_q_m©rix
=
TRUE
;

612 
	`mem£t
(
´e£Á
, 0, 6 * ());

614 if(
aùive_¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
)

615 
i
=0; i<6; i++)

616 
´e£Á
[
i
] = 
aùive_¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[i];

618 if(
aùive_µs
->
pic_sÿlšg_m©rix_´e£Á_æag
)

619 
i
=0; i<6; i++)

621 if((
i
==0) || (i==3))

622 
´e£Á
[
i
] |ð
aùive_µs
->
pic_sÿlšg_li¡_´e£Á_æag
[i];

624 
´e£Á
[
i
] = 
aùive_µs
->
pic_sÿlšg_li¡_´e£Á_æag
[i];

628 if(
no_q_m©rix
==
TRUE
)

630 
k_mod
 = 0; k_mod <ð
max_qp
; k_mod++)

632 
k
 = 
k_mod
 % 6;

633 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][0][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

634 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][1][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

635 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][0][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

636 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][1][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

637 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][0][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

638 
	`£t_deçuÉ_quªt4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][1][
k_mod
], 
quªt_cÛf
[
k
], 
dequªt_cÛf
[k]);

643 
k_mod
 = 0; k_mod <ð
max_qp
; k_mod++)

645 
k
 = 
k_mod
 % 6;

646 
j
=0; j<4; j++)

648 
i
=0; i<4; i++)

650 
‹mp
 = (
j
<<2)+
i
;

651 if((!
´e£Á
[0]è|| 
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[0])

653 
p_Quªt
->
q_·¿ms_4x4
[0][1][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/
Quªt_šŒa_deçuÉ
[
‹mp
];

654 
p_Quªt
->
q_·¿ms_4x4
[0][1][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*
Quªt_šŒa_deçuÉ
[
‹mp
];

658 
p_Quªt
->
q_·¿ms_4x4
[0][1][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/
p_QSÿË
->
SÿlšgLi¡4x4
[0][
‹mp
];

659 
p_Quªt
->
q_·¿ms_4x4
[0][1][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*
p_QSÿË
->
SÿlšgLi¡4x4
[0][
‹mp
];

662 if(!
´e£Á
[1])

664 
p_Quªt
->
q_·¿ms_4x4
[1][1][
k_mod
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_4x4[0][1][k_mod][j][i].ScaleComp;

665 
p_Quªt
->
q_·¿ms_4x4
[1][1][
k_mod
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_4x4[0][1][k_mod][j][i].InvScaleComp;

669 
p_Quªt
->
q_·¿ms_4x4
[1][1][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[1] ? 
Quªt_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[1][temp]);

670 
p_Quªt
->
q_·¿ms_4x4
[1][1][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[1] ? 
Quªt_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[1][temp]);

673 if(!
´e£Á
[2])

675 
p_Quªt
->
q_·¿ms_4x4
[2][1][
k_mod
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_4x4[1][1][k_mod][j][i].ScaleComp;

676 
p_Quªt
->
q_·¿ms_4x4
[2][1][
k_mod
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_4x4[1][1][k_mod][j][i].InvScaleComp;

680 
p_Quªt
->
q_·¿ms_4x4
[2][1][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[2] ? 
Quªt_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[2][temp]);

681 
p_Quªt
->
q_·¿ms_4x4
[2][1][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[2] ? 
Quªt_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[2][temp]);

684 if((!
´e£Á
[3]è|| 
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[3])

686 
p_Quªt
->
q_·¿ms_4x4
[0][0][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/
Quªt_š‹r_deçuÉ
[
‹mp
];

687 
p_Quªt
->
q_·¿ms_4x4
[0][0][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*
Quªt_š‹r_deçuÉ
[
‹mp
];

691 
p_Quªt
->
q_·¿ms_4x4
[0][0][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/
p_QSÿË
->
SÿlšgLi¡4x4
[3][
‹mp
];

692 
p_Quªt
->
q_·¿ms_4x4
[0][0][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*
p_QSÿË
->
SÿlšgLi¡4x4
[3][
‹mp
];

695 if(!
´e£Á
[4])

697 
p_Quªt
->
q_·¿ms_4x4
[1][0][
k_mod
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_4x4[0][0][k_mod][j][i].ScaleComp;

698 
p_Quªt
->
q_·¿ms_4x4
[1][0][
k_mod
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_4x4[0][0][k_mod][j][i].InvScaleComp;

702 
p_Quªt
->
q_·¿ms_4x4
[1][0][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[4] ? 
Quªt_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[4][temp]);

703 
p_Quªt
->
q_·¿ms_4x4
[1][0][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[4] ? 
Quªt_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[4][temp]);

706 if(!
´e£Á
[5])

708 
p_Quªt
->
q_·¿ms_4x4
[2][0][
k_mod
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_4x4[1][0][k_mod][j][i].ScaleComp;

709 
p_Quªt
->
q_·¿ms_4x4
[2][0][
k_mod
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_4x4[1][0][k_mod][j][i].InvScaleComp;

713 
p_Quªt
->
q_·¿ms_4x4
[2][0][
k_mod
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf
[
k
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[5] ? 
Quªt_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[5][temp]);

714 
p_Quªt
->
q_·¿ms_4x4
[2][0][
k_mod
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf
[
k
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix4x4FÏg
[5] ? 
Quªt_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡4x4
[5][temp]);

720 
	}
}

729 
	$C®cuÏ‹Quªt8x8P¬am
(
VideoP¬am‘”s
 *
p_Vid
)

731 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

732 
SÿËP¬am‘”s
 *
p_QSÿË
 = 
p_Vid
->p_QScale;

734 
pic_·¿m‘”_£t_rb¥_t
 *
aùive_µs
 = 
p_Vid
->active_pps;

735 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

737 
i
, 
j
, 
k
, 
‹mp
;

738 
k_mod
;

739 
n_SÿlšgLi¡8x8
;

740 
´e£Á
[6];

741 
no_q_m©rix
=
FALSE
;

742 
max_b™d•th
 = 
	`imax
(
p_Vid
->
b™d•th_luma
,…_Vid->
b™d•th_chroma
);

743 
max_qp
 = (3 + 6*(
max_b™d•th
));

747 
n_SÿlšgLi¡8x8
 = ( 
aùive_¥s
->
chroma_fÜm©_idc
 != 3 ) ? 2 : 6;

749 if(!
aùive_¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
 && !
aùive_µs
->
pic_sÿlšg_m©rix_´e£Á_æag
)

750 
no_q_m©rix
=
TRUE
;

753 
	`mem£t
(
´e£Á
, 0, ()*
n_SÿlšgLi¡8x8
);

755 if(
aùive_¥s
->
£q_sÿlšg_m©rix_´e£Á_æag
)

757 
i
=0; i<
n_SÿlšgLi¡8x8
; i++)

758 
´e£Á
[
i
] = 
aùive_¥s
->
£q_sÿlšg_li¡_´e£Á_æag
[i+6];

761 if(
aùive_µs
->
pic_sÿlšg_m©rix_´e£Á_æag
)

763 
i
=0; i<
n_SÿlšgLi¡8x8
; i++)

765 ifÐ
i
==0 || i==1 )

766 
´e£Á
[
i
] |ð
aùive_µs
->
pic_sÿlšg_li¡_´e£Á_æag
[i+6];

768 
´e£Á
[
i
] = 
aùive_µs
->
pic_sÿlšg_li¡_´e£Á_æag
[i+6];

773 if(
no_q_m©rix
==
TRUE
)

775 
k
 = 0; k <ð
max_qp
; k++)

777 
k_mod
 = 
k
 % 6;

778 
j
=0; j<8; j++)

780 
i
=0; i<8; i++)

783 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

784 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

787 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

788 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

790 ifÐ
n_SÿlšgLi¡8x8
 > 2 )

793 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

794 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

797 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

798 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

801 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

802 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

805 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
SÿËComp
 = 
quªt_cÛf8
[
k_mod
][j][i];

806 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]<<4;

815 
k
 = 0; k <ð
max_qp
; k++)

817 
k_mod
 = 
k
 % 6;

818 
j
=0; j<8; j++)

820 
i
=0; i<8; i++)

822 
‹mp
 = (
j
<<3)+
i
;

823 if((!
´e£Á
[0]è|| 
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[0])

825 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/
Quªt8_šŒa_deçuÉ
[
‹mp
];

826 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*
Quªt8_šŒa_deçuÉ
[
‹mp
];

830 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/
p_QSÿË
->
SÿlšgLi¡8x8
[0][
‹mp
];

831 
p_Quªt
->
q_·¿ms_8x8
[0][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*
p_QSÿË
->
SÿlšgLi¡8x8
[0][
‹mp
];

834 if((!
´e£Á
[1]è|| 
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[1])

836 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/
Quªt8_š‹r_deçuÉ
[
‹mp
];

837 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*
Quªt8_š‹r_deçuÉ
[
‹mp
];

841 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/
p_QSÿË
->
SÿlšgLi¡8x8
[1][
‹mp
];

842 
p_Quªt
->
q_·¿ms_8x8
[0][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*
p_QSÿË
->
SÿlšgLi¡8x8
[1][
‹mp
];

845 ifÐ
n_SÿlšgLi¡8x8
 > 2 )

849 if(!
´e£Á
[2])

851 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_8x8[0][1][k][j][i].ScaleComp;

852 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_8x8[0][1][k][j][i].InvScaleComp;

856 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[2] ? 
Quªt8_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[2][temp]);

857 
p_Quªt
->
q_·¿ms_8x8
[1][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[2] ? 
Quªt8_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[2][temp]);

861 if(!
´e£Á
[3])

863 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_8x8[0][0][k][j][i].ScaleComp;

864 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_8x8[0][0][k][j][i].InvScaleComp;

868 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[3] ? 
Quªt8_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[3][temp]);

869 
p_Quªt
->
q_·¿ms_8x8
[1][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[3] ? 
Quªt8_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[3][temp]);

873 if(!
´e£Á
[4])

875 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_8x8[1][1][k][j][i].ScaleComp;

876 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_8x8[1][1][k][j][i].InvScaleComp;

880 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[4] ? 
Quªt8_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[4][temp]);

881 
p_Quªt
->
q_·¿ms_8x8
[2][1][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i]*(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[4] ? 
Quªt8_šŒa_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[4][temp]);

885 if(!
´e£Á
[5])

887 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
SÿËComp
 =…_Quant->q_params_8x8[1][0][k][j][i].ScaleComp;

888 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
InvSÿËComp
 =…_Quant->q_params_8x8[1][0][k][j][i].InvScaleComp;

892 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
SÿËComp
 = (
quªt_cÛf8
[
k_mod
][j][i]<<4)/(
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[5] ? 
Quªt8_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[5][temp]);

893 
p_Quªt
->
q_·¿ms_8x8
[2][0][
k
][
j
][
i
].
InvSÿËComp
 = 
dequªt_cÛf8
[
k_mod
][j][i] * (
p_QSÿË
->
U£DeçuÉSÿlšgM©rix8x8FÏg
[5] ? 
Quªt8_š‹r_deçuÉ
[
‹mp
]:p_QSÿË->
SÿlšgLi¡8x8
[5][temp]);

900 
	}
}

	@lencod/src/q_offsets.c

12 
	~"glob®.h
"

13 
	~"mem®loc.h
"

14 
	~"q_m©rix.h
"

15 
	~"q_off£ts.h
"

17 *
G‘CÚfigFžeCÚ‹Á
 (*
Fž’ame
, 
”rÜ_ty³
);

19 
	#MAX_ITEMS_TO_PARSE
 2000

	)

21 
	goff£t4x4_check
[15] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };

22 
	goff£t8x8_check
[15] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };

24 cÚ¡ 
	gOff£tTy³4x4
[15][24] = {

42 cÚ¡ 
	gOff£tTy³8x8
[15][24] = {

60 cÚ¡ 
	gOff£t_šŒa_æ©_šŒa
[16] = {

67 cÚ¡ 
	gOff£t_šŒa_æ©_chroma
[16] = {

75 cÚ¡ 
	gOff£t_šŒa_æ©_š‹r
[16] = {

82 cÚ¡ 
	gOff£t_š‹r_æ©
[16] = {

89 cÚ¡ 
	gOff£t8_šŒa_æ©_šŒa
[64] = {

100 cÚ¡ 
	gOff£t8_šŒa_æ©_chroma
[64] = {

111 cÚ¡ 
	gOff£t8_šŒa_æ©_š‹r
[64] = {

122 cÚ¡ 
	gOff£t8_š‹r_æ©
[64] = {

135 cÚ¡ 
	gOff£t_šŒa_deçuÉ_šŒa
[16] = {

142 cÚ¡ 
	gOff£t_šŒa_deçuÉ_chroma
[16] = {

150 cÚ¡ 
	gOff£t_šŒa_deçuÉ_š‹r
[16] = {

157 cÚ¡ 
	gOff£t_š‹r_deçuÉ
[16] = {

164 cÚ¡ 
	gOff£t8_šŒa_deçuÉ_šŒa
[64] = {

175 cÚ¡ 
	gOff£t8_šŒa_deçuÉ_chroma
[64] = {

186 cÚ¡ 
	gOff£t8_šŒa_deçuÉ_š‹r
[64] = {

197 cÚ¡ 
	gOff£t8_š‹r_deçuÉ
[64] = {

210 
In™Off£tP¬am
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
);

217 
	$®loÿ‹_QOff£ts
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
)

219 
max_b™d•th
 = 
	`imax
(
p_IÅ
->
ouut
.
b™_d•th
[0],…_Inp->output.bit_depth[1]);

220 
max_qp
 = (3 + 6*(
max_b™d•th
));

223 ià(
p_IÅ
->
Ad­tRoundšgFixed
)

225 
	`g‘_mem3DshÜt
(&
p_Quªt
->
Off£tLi¡4x4
, 1, 25, 16);

226 
	`g‘_mem3DshÜt
(&
p_Quªt
->
Off£tLi¡8x8
, 1, 15, 64);

230 
	`g‘_mem3DshÜt
(&
p_Quªt
->
Off£tLi¡4x4
, 
max_qp
 + 1, 25, 16);

231 
	`g‘_mem3DshÜt
(&
p_Quªt
->
Off£tLi¡8x8
, 
max_qp
 + 1, 15, 64);

234 
	`g‘_mem2DshÜt
(&
p_Quªt
->
Off£tLi¡4x4šput
, 25, 16);

235 
	`g‘_mem2DshÜt
(&
p_Quªt
->
Off£tLi¡8x8šput
, 15, 64);

236 
	}
}

238 
šlše
 
	$upd©e_q_off£t4x4
(
Lev–QuªtP¬ams
 **
q_·¿ms
, *
off£tLi¡
, 
q_b™s
)

240 
i
, 
j
;

241 *
p_li¡
 = &
off£tLi¡
[0];

242 
j
 = 0; j < 4; j++)

244 
i
 = 0; i < 4; i++)

246 
q_·¿ms
[
j
][
i
].
Off£tComp
 = (è*
p_li¡
++ << 
q_b™s
;

249 
	}
}

251 
šlše
 
	$upd©e_q_off£t8x8
(
Lev–QuªtP¬ams
 **
q_·¿ms
, *
off£tLi¡
, 
q_b™s
)

253 
i
, 
j
;

254 *
p_li¡
;

255 
j
 = 0; j < 8; j++)

257 
p_li¡
 = &
off£tLi¡
[
j
 << 3];

258 
i
 = 0; i < 8; i++)

260 
q_·¿ms
[
j
][
i
].
Off£tComp
 = (è*
p_li¡
++ << 
q_b™s
;

263 
	}
}

271 
	$ä“_QOff£ts
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
)

273 
	`ä“_mem3DshÜt
(
p_Quªt
->
Off£tLi¡8x8
);

274 
	`ä“_mem3DshÜt
(
p_Quªt
->
Off£tLi¡4x4
);

275 
	`ä“_mem2DshÜt
(
p_Quªt
->
Off£tLi¡8x8šput
);

276 
	`ä“_mem2DshÜt
(
p_Quªt
->
Off£tLi¡4x4šput
);

277 
	}
}

294 
	$CheckOff£tP¬am‘”Name
 (*
s
, *
ty³
)

296 
i
 = 0;

298 *
ty³
 = 0;

299 (
Off£tTy³4x4
[
i
] !ð
NULL
) && (i < 15))

301 ià(0 =ð
	`¡rcmp
 (
Off£tTy³4x4
[
i
], 
s
))

302  
i
;

304 
i
++;

307 
i
 = 0;

308 *
ty³
 = 1;

309 (
Off£tTy³8x8
[
i
] !ð
NULL
) && (i < 15))

311 ià(0 =ð
	`¡rcmp
 (
Off£tTy³8x8
[
i
], 
s
))

312  
i
;

314 
i
++;

318 
	}
}

332 
	$P¬£QOff£tM©rix
 (
QuªtP¬am‘”s
 *
p_Quªt
, *
buf
, 
bufsize
)

334 *
™ems
[
MAX_ITEMS_TO_PARSE
] = {
NULL
};

335 
M­Idx
;

336 
™em
 = 0;

337 
InSŒšg
 = 0, 
InI‹m
 = 0;

338 *
p
 = 
buf
;

339 *
buãnd
 = &
buf
[
bufsize
];

340 
IÁCÚ‹Á
;

341 
i
, 
j
, 
¿nge
, 
ty³
, 
út
;

342 *
Off£tLi¡
;

344 
p
 < 
buãnd
)

346 *
p
)

352 *
p
 = '\0';

353 (*
p
 !ð'\n' && *°!ð'\r'è&&… < 
buãnd
)

354 
p
++;

355 
InSŒšg
 = 0;

356 
InI‹m
 = 0;

360 
InI‹m
 = 0;

361 
InSŒšg
 = 0;

362 *
p
++ = '\0';

366 ià(
InSŒšg
)

367 
p
++;

370 *
p
++ = '\0';

371 
InI‹m
 = 0;

376 *
p
++ = '\0';

377 ià(!
InSŒšg
)

379 
™ems
[
™em
++] = 
p
;

380 
InI‹m
 = ~InItem;

383 
InI‹m
 = 0;

384 
InSŒšg
 = ~InString;

388 
p
++;

389 
InI‹m
 = 0;

393 ià(!
InI‹m
)

395 
™ems
[
™em
++] = 
p
;

396 
InI‹m
 = ~InItem;

398 
p
++;

402 
™em
--;

404 
i
 = 0; i < 
™em
; i +ð
út
)

406 
út
 = 0;

407 ià(0 > (
M­Idx
 = 
	`CheckOff£tP¬am‘”Name
 (
™ems
[
i
 + 
út
], &
ty³
)))

409 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
,

411 
™ems
[
i
 + 
út
]);

412 
	`”rÜ
 (
”rÜ‹xt
, 300);

414 
út
++;

415 ià(
	`¡rcmp
 ("=", 
™ems
[
i
 + 
út
]))

417 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
,

419 
	`”rÜ
 (
”rÜ‹xt
, 300);

421 
út
++;

423 ià(!
ty³
)

425 
¿nge
 = 16;

426 
Off£tLi¡
 = 
p_Quªt
->
Off£tLi¡4x4šput
[
M­Idx
];

427 
off£t4x4_check
[
M­Idx
] = 1;

431 
¿nge
 = 64;

432 
Off£tLi¡
 = 
p_Quªt
->
Off£tLi¡8x8šput
[
M­Idx
];

433 
off£t8x8_check
[
M­Idx
] = 1;

436 
j
 = 0; j < 
¿nge
; j++)

438 ià(1 !ð
	`ssÿnf
 (
™ems
[
i
 + 
út
 + 
j
], "%d", &
IÁCÚ‹Á
))

440 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
,

442 
™ems
[
i
], i‹ms[˜+ 
út
 + 
j
]);

443 
	`”rÜ
 (
”rÜ‹xt
, 300);

446 
Off£tLi¡
[
j
] = (è
IÁCÚ‹Á
;

448 
út
 +ð
j
;

449 
	`´štf
 (".");

451 
	}
}

460 
	$š™_qoff£t
 (
VideoP¬am‘”s
 *
p_Vid
)

462 *
cÚ‹Á
;

463 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

465 
	`®loÿ‹_QOff£ts
 (
p_Vid
->
p_Quªt
, 
p_IÅ
);

467 ià(
p_IÅ
->
Off£tM©rixP»£ÁFÏg
)

469 
	`´štf
 ("Parsing Quantization Offset Matrix file %s ",

470 
p_IÅ
->
QOff£tM©rixFže
);

471 
cÚ‹Á
 = 
	`G‘CÚfigFžeCÚ‹Á
 (
p_IÅ
->
QOff£tM©rixFže
, 0);

472 ià(
cÚ‹Á
 != '\0')

473 
	`P¬£QOff£tM©rix
 (
p_Vid
->
p_Quªt
, 
cÚ‹Á
, (è
	`¡¾’
 (content));

476 
	`´štf
 ("\nE¼Ü: %s\nProûedšg w™h deçuÉ v®ue fÜ‡Î m©riûs.", 
”rÜ‹xt
);

477 
p_IÅ
->
Off£tM©rixP»£ÁFÏg
 = 0;

480 
	`´štf
 ("\n");

482 
	`ä“
 (
cÚ‹Á
);

485 
	`In™Off£tP¬am
 (
p_Vid
->
p_Quªt
, 
p_IÅ
);

486 
	}
}

501 
	$In™Off£tP¬am
 (
QuªtP¬am‘”s
 *
p_Quªt
, 
IÅutP¬am‘”s
 *
p_IÅ
)

503 
i
, 
k
;

504 
max_qp_luma
 = (4 + 6*(
p_IÅ
->
ouut
.
b™_d•th
[0]));

505 
max_qp_ü
 = (4 + 6*(
p_IÅ
->
ouut
.
b™_d•th
[1]));

507 
i
 = 0; i < (
p_IÅ
->
Ad­tRoundšgFixed
 ? 1 : 
	`imax
(
max_qp_luma
, 
max_qp_ü
)); i++)

509 ià(
p_IÅ
->
Off£tM©rixP»£ÁFÏg
)

511 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][0][0]),&Õ_Quªt->
Off£tLi¡4x4šput
[0][0]), 400 * ());

512 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][0][0]),&Õ_Quªt->
Off£tLi¡8x8šput
[0][0]), 960 * ());

516 ià(
p_IÅ
->
Off£tM©rixFÏt
 == 1)

519 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][0][0]),&(
Off£t_šŒa_æ©_šŒa
[0]), 16 * ());

520 
k
 = 1; k < 3; k++)

521 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_æ©_chroma
[0]), 16 * ());

522 
k
 = 3; k < 9; k++)

523 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_æ©_š‹r
[0]), 16 * ());

524 
k
 = 9; k < 25; k++)

525 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_š‹r_æ©
[0]), 16 * ());

528 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][0][0]),&(
Off£t8_šŒa_æ©_šŒa
[0]), 64 * ());

529 
k
 = 1; k < 3; k++)

530 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_æ©_š‹r
[0]), 64 * ());

531 
k
 = 3; k < 5; k++)

532 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_æ©
[0]), 64 * ());

535 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][5][0]),&(
Off£t8_šŒa_æ©_chroma
[0]), 64 * ());

536 
k
 = 6; k < 8; k++)

537 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_æ©_š‹r
[0]), 64 * ());

538 
k
 = 8; k < 10; k++)

539 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_æ©
[0]), 64 * ());

542 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][10][0]),&(
Off£t8_šŒa_æ©_chroma
[0]), 64 * ());

543 
k
 = 11; k < 13; k++)

544 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_æ©_š‹r
[0]), 64 * ());

545 
k
 = 13; k < 15; k++)

546 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_æ©
[0]), 64 * ());

548 ià(
p_IÅ
->
Off£tM©rixFÏt
 == 2)

551 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][0][0]),&(
Off£t_šŒa_deçuÉ_šŒa
[0]), 16 * ());

552 
k
 = 1; k < 3; k++)

553 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_æ©_chroma
[0]), 16 * ());

554 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][3][0]),&(
Off£t_šŒa_deçuÉ_š‹r
[0]), 16 * ());

555 
k
 = 4; k < 6; k++)

556 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_æ©_š‹r
[0]), 16 * ());

557 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][6][0]),&(
Off£t_šŒa_deçuÉ_š‹r
[0]), 16 * ());

558 
k
 = 7; k < 9; k++)

559 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_æ©_š‹r
[0]), 16 * ());

560 
k
 = 9; k < 25; k++)

561 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_š‹r_deçuÉ
[0]), 16 * ());

564 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][0][0]),&(
Off£t8_šŒa_deçuÉ_šŒa
[0]), 64 * ());

565 
k
 = 1; k < 3; k++)

566 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_deçuÉ_š‹r
[0]), 64 * ());

567 
k
 = 3; k < 5; k++)

568 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

571 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][5][0]),&(
Off£t8_šŒa_æ©_chroma
[0]), 64 * ());

572 
k
 = 6; k < 8; k++)

573 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_æ©_š‹r
[0]), 64 * ());

574 
k
 = 8; k < 10; k++)

575 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

578 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][10][0]),&(
Off£t8_šŒa_æ©_chroma
[0]), 64 * ());

579 
k
 = 11; k < 13; k++)

580 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_æ©_š‹r
[0]), 64 * ());

581 
k
 = 13; k < 15; k++)

582 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

587 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][0][0]),&(
Off£t_šŒa_deçuÉ_šŒa
[0]), 16 * ());

588 
k
 = 1; k < 3; k++)

589 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_deçuÉ_chroma
[0]), 16 * ());

590 
k
 = 3; k < 9; k++)

591 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_šŒa_deçuÉ_š‹r
[0]), 16 * ());

592 
k
 = 9; k < 25; k++)

593 
	`memýy
(&(
p_Quªt
->
Off£tLi¡4x4
[
i
][
k
][0]),&(
Off£t_š‹r_deçuÉ
[0]), 16 * ());

596 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][0][0]),&(
Off£t8_šŒa_deçuÉ_šŒa
[0]), 64 * ());

597 
k
 = 1; k < 3; k++)

598 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_deçuÉ_š‹r
[0]), 64 * ());

599 
k
 = 3; k < 5; k++)

600 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

603 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][5][0]),&(
Off£t8_šŒa_deçuÉ_chroma
[0]), 64 * ());

604 
k
 = 6; k < 8; k++)

605 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_deçuÉ_š‹r
[0]), 64 * ());

606 
k
 = 8; k < 10; k++)

607 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

610 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][10][0]),&(
Off£t8_šŒa_deçuÉ_chroma
[0]), 64 * ());

611 
k
 = 11; k < 13; k++)

612 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_šŒa_deçuÉ_š‹r
[0]), 64 * ());

613 
k
 = 13; k < 15; k++)

614 
	`memýy
(&(
p_Quªt
->
Off£tLi¡8x8
[
i
][
k
][0]),&(
Off£t8_š‹r_deçuÉ
[0]), 64 * ());

618 
	}
}

633 
	$C®cuÏ‹Off£t4x4P¬am
 (
VideoP¬am‘”s
 *
p_Vid
)

635 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

636 
k
;

637 
qp_³r
, 
qp
;

638 
img_ty³
 = ((
p_Vid
->
ty³
 =ð
SI_SLICE
è? 
I_SLICE
 : (p_Vid->ty³ =ð
SP_SLICE
 ? 
P_SLICE
 :…_Vid->type));

640 
max_qp_sÿË
 = 
	`imax
(
p_Vid
->
b™d•th_luma_qp_sÿË
,…_Vid->
b™d•th_chroma_qp_sÿË
);

641 
max_qp
 = 51 + 
max_qp_sÿË
;

642 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

644 
p_Vid
->
Ad­tRndWeight
 = 
p_IÅ
->
Ad­tRndWFaùÜ
 [p_Vid->
Çl_»ã»nû_idc
 !ð0][
img_ty³
];

645 
p_Vid
->
Ad­tRndCrWeight
 = 
p_IÅ
->
Ad­tRndCrWFaùÜ
[p_Vid->
Çl_»ã»nû_idc
 !ð0][
img_ty³
];

647 ià(
img_ty³
 =ð
I_SLICE
 )

649 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

651 
k
 = 
p_Quªt
->
qp_³r_m©rix
 [
qp
];

652 
qp_³r
 = 
Q_BITS
 + 
k
 - 
Off£tB™s
;

653 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

656 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 0], 
qp_³r
);

658 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 1], 
qp_³r
);

660 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 2], 
qp_³r
);

663 ià(
img_ty³
 =ð
B_SLICE
)

665 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

667 
k
 = 
p_Quªt
->
qp_³r_m©rix
 [
qp
];

668 
qp_³r
 = 
Q_BITS
 + 
k
 - 
Off£tB™s
;

669 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

672 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][12], 
qp_³r
);

674 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 6], 
qp_³r
);

676 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][13], 
qp_³r
);

678 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 7], 
qp_³r
);

680 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][14], 
qp_³r
);

682 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 8], 
qp_³r
);

687 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

689 
k
 = 
p_Quªt
->
qp_³r_m©rix
 [
qp
];

690 
qp_³r
 = 
Q_BITS
 + 
k
 - 
Off£tB™s
;

691 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

694 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 9], 
qp_³r
);

696 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[0][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 3], 
qp_³r
);

698 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][10], 
qp_³r
);

700 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[1][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 4], 
qp_³r
);

702 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][0][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][11], 
qp_³r
);

704 
	`upd©e_q_off£t4x4
(
p_Quªt
->
q_·¿ms_4x4
[2][1][
qp
],…_Quªt->
Off£tLi¡4x4
[
k
][ 5], 
qp_³r
);

707 
	}
}

716 
	$C®cuÏ‹Off£t8x8P¬am
 (
VideoP¬am‘”s
 *
p_Vid
)

718 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

719 
k
;

720 
q_b™s
, 
qp
;

722 
max_qp_sÿË
 = 
	`imax
(
p_Vid
->
b™d•th_luma_qp_sÿË
,…_Vid->
b™d•th_chroma_qp_sÿË
);

723 
max_qp
 = 51 + 
max_qp_sÿË
;

724 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

726 ià(
p_Vid
->
ty³
 =ð
I_SLICE
 ||…_Vid->ty³ =ð
SI_SLICE
 )

728 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

730 
q_b™s
 = 
Q_BITS_8
 + 
p_Quªt
->
qp_³r_m©rix
[
qp
] - 
Off£tB™s
;

731 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

733 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[0][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][0], 
q_b™s
);

735 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[1][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][5], 
q_b™s
);

737 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[2][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][10], 
q_b™s
);

740 ià((
p_Vid
->
ty³
 =ð
P_SLICE
è|| (p_Vid->ty³ =ð
SP_SLICE
))

742 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

744 
q_b™s
 = 
Q_BITS_8
 + 
p_Quªt
->
qp_³r_m©rix
[
qp
] - 
Off£tB™s
;

745 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

748 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[0][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][3], 
q_b™s
);

750 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[0][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][1], 
q_b™s
);

752 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[1][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][8], 
q_b™s
);

754 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[1][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][6], 
q_b™s
);

756 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[2][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][13], 
q_b™s
);

758 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[2][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][11], 
q_b™s
);

763 
qp
 = 0; q°< 
max_qp
 + 1; qp++)

765 
q_b™s
 = 
Q_BITS_8
 + 
p_Quªt
->
qp_³r_m©rix
[
qp
] - 
Off£tB™s
;

766 
k
 = 
p_IÅ
->
Ad­tRoundšgFixed
 ? 0 : 
qp
;

769 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[0][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][4], 
q_b™s
);

771 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[0][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][2], 
q_b™s
);

773 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[1][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][9], 
q_b™s
);

775 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[1][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][7], 
q_b™s
);

777 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[2][0][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][14], 
q_b™s
);

779 
	`upd©e_q_off£t8x8
(
p_Quªt
->
q_·¿ms_8x8
[2][1][
qp
],…_Quªt->
Off£tLi¡8x8
[
k
][12], 
q_b™s
);

782 
	}
}

	@lencod/src/quant4x4.c

16 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"quªt4x4.h
"

27 
	$š™_quªt_4x4
(
Sliû
 *
cu¼Sliû
)

29 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

30 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

32 ià(
cu¼Sliû
->
U£RDOQuªt
 == 1)

34 
cu¼Sliû
->
quªt_4x4
 = 
quªt_4x4_Œ–lis
;

35 ià(
p_IÅ
->
RDOQ_DC
 == 1)

36 
cu¼Sliû
->
quªt_dc4x4
 = 
quªt_dc4x4_Œ–lis
;

38 
cu¼Sliû
->
quªt_dc4x4
 = 
quªt_dc4x4_nÜm®
;

39 
cu¼Sliû
->
quªt_ac4x4
 = 
quªt_ac4x4_Œ–lis
;

40 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

42 
cu¼Sliû
->
rdoq_4x4
 = 
rdoq_4x4_CAVLC
;

43 
cu¼Sliû
->
rdoq_dc
 = 
rdoq_dc_CAVLC
;

44 
cu¼Sliû
->
rdoq_ac4x4
 = 
rdoq_ac4x4_CAVLC
;

48 
cu¼Sliû
->
rdoq_4x4
 = 
rdoq_4x4_CABAC
;

49 
cu¼Sliû
->
rdoq_dc
 = 
rdoq_dc_CABAC
;

50 
cu¼Sliû
->
rdoq_ac4x4
 = 
rdoq_ac4x4_CABAC
;

53 ià(
p_Vid
->
Ad­tiveRoundšg
)

55 
cu¼Sliû
->
quªt_4x4
 = 
quªt_4x4_¬ound
;

56 
cu¼Sliû
->
quªt_dc4x4
 = 
quªt_dc4x4_nÜm®
;

57 
cu¼Sliû
->
quªt_ac4x4
 = 
quªt_ac4x4_¬ound
;

61 
cu¼Sliû
->
quªt_4x4
 = 
quªt_4x4_nÜm®
;

62 
cu¼Sliû
->
quªt_dc4x4
 = 
quªt_dc4x4_nÜm®
;

63 
cu¼Sliû
->
quªt_ac4x4
 = 
quªt_ac4x4_nÜm®
;

65 
	}
}

	@lencod/src/quant4x4_2step.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mb_acûss.h
"

24 
	~"vlc.h
"

25 
	~"ŒªsfÜm.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"q_off£ts.h
"

28 
	~"q_m©rix.h
"

29 
	~"quªt4x4.h
"

38 
	$quªt_4x4_2¡•
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

40 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

41 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

42 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

43 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

45 
block_x
 = 
q_m‘hod
->block_x;

46 
qp
 = 
q_m‘hod
->qp;

47 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

48 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

49 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

50 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

51 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

52 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

55 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

56 
i
,
j
, 
cÛff_ùr
;

58 *
m7
;

59 
sÿËd_cÛff
;

61 
Ëv–
, 
run
 = 0;

62 
nÚz”o
 = 
FALSE
;

63 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

64 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

65 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

68 
cÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

70 
i
 = *
p_sÿn
++;

71 
j
 = *
p_sÿn
++;

73 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

75 ià(*
m7
 != 0)

77 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

78 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

79 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

81 ià(
Ëv–
 != 0)

83 ià(
is_ÿvlc
)

84 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

86 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

88 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

89 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

93 *
ACL
++ = 
Ëv–
;

94 *
ACR
++ = 
run
;

96 
run
 = 0;

97 
nÚz”o
 = 
TRUE
;

101 *
m7
 = 0;

102 ++
run
;

107 ++
run
;

111 *
ACL
 = 0;

113  
nÚz”o
;

114 
	}
}

116 
	$quªt_ac4x4_2¡•
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

118 
block_x
 = 
q_m‘hod
->block_x;

120 
qp
 = 
q_m‘hod
->qp;

121 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

122 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

123 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

124 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

125 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

126 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

128 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

129 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

130 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

131 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

133 
i
,
j
, 
cÛff_ùr
;

135 *
m7
;

136 
sÿËd_cÛff
;

138 
Ëv–
, 
run
 = 0;

139 
nÚz”o
 = 
FALSE
;

140 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

141 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

142 cÚ¡ 
by‹
 *
p_sÿn1
 = &
pos_sÿn
[1][0];

143 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

144 
‹mp_block
[16][16];

146 
qp_³r2
 = 
p_Quªt
->
qp_³r_m©rix
[51];

147 
q_b™s2
 = 
Q_BITS
 + 
qp_³r2
;

148 
cÛff
;

152 
cÛff_ùr
 = 1; coeff_ctr < 16; ++coeff_ctr)

154 
i
 = *
p_sÿn1
++;

155 
j
 = *
p_sÿn1
++;

157 
cÛff
 = 
tblock
[
j
][
block_x
 + 
i
];

158 
m7
 = &
‹mp_block
[
j
][
block_x
 + 
i
];

159 ià(
cÛff
 != 0)

161 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

162 
sÿËd_cÛff
 = 
	`Ÿbs
 (
cÛff
);

163 
Ëv–
 = (
sÿËd_cÛff
 * 
q_·¿ms
->
SÿËComp
è>> 
q_b™s2
;

166 ià(
Ëv–
 != 0)

168 ià(
is_ÿvlc
)

169 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

171 
Ëv–
 = 
	`isigÇb
Öev–, 
cÛff
);

172 *
m7
 = (
Ëv–
 << 
q_b™s2
è/ 
q_·¿ms
->
SÿËComp
;

177 *
m7
 = 0;

181 *
m7
 = 0;

185 
cÛff_ùr
 = 1; coeff_ctr < 16; ++coeff_ctr)

187 
i
 = *
p_sÿn
++;

188 
j
 = *
p_sÿn
++;

190 
cÛff
 = 
‹mp_block
[
j
][
block_x
 + 
i
];

191 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

192 ià(*
m7
 != 0)

194 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

195 
sÿËd_cÛff
 = 
	`Ÿbs
 (
cÛff
è* 
q_·¿ms
->
SÿËComp
;

196 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

198 ià(
Ëv–
 != 0)

200 ià(
is_ÿvlc
)

201 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

203 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

205 
Ëv–
 = 
	`isigÇb
Öev–, 
cÛff
);

206 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

210 *
ACL
++ = 
Ëv–
;

211 *
ACR
++ = 
run
;

213 
run
 = 0;

214 
nÚz”o
 = 
TRUE
;

218 *
m7
 = 0;

219 ++
run
;

224 *
m7
 = 0;

225 ++
run
;

229 *
ACL
 = 0;

231  
nÚz”o
;

232 
	}
}

241 
quªt_dc4x4_2¡•
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

242 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

244 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

245 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

246 
	gi
,
	gj
, 
	gcÛff_ùr
;

248 *
	gm7
;

249 
	gsÿËd_cÛff
;

251 
	gËv–
, 
	grun
 = 0;

252 
	gnÚz”o
 = 
FALSE
;

253 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

254 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

255 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

256 * 
	gDCL
 = &
DCLev–
[0];

257 * 
	gDCR
 = &
DCRun
[0];

260 
	gcÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

262 
	gi
 = *
p_sÿn
++;

263 
	gj
 = *
p_sÿn
++;

265 
	gm7
 = &
tblock
[
j
][
i
];

267 ià(*
	gm7
 != 0)

269 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

270 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

272 ià(
	gËv–
 != 0)

274 ià(
is_ÿvlc
)

275 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

277 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

278 *
	gm7
 = 
Ëv–
;

279 *
	gDCL
++ = 
Ëv–
;

280 *
	gDCR
++ = 
run
;

282 
	grun
 = 0;

283 
	gnÚz”o
 = 
TRUE
;

287 ++
	grun
;

288 *
	gm7
 = 0;

293 ++
	grun
;

297 *
	gDCL
 = 0;

299  
	gnÚz”o
;

	@lencod/src/quant4x4_around.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<m©h.h
>

21 
	~"glob®.h
"

23 
	~"image.h
"

24 
	~"mb_acûss.h
"

25 
	~"vlc.h
"

26 
	~"ŒªsfÜm.h
"

27 
	~"mc_´ediùiÚ.h
"

28 
	~"q_off£ts.h
"

29 
	~"q_m©rix.h
"

30 
	~"quªt4x4.h
"

40 
	$quªt_4x4_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

42 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

43 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

44 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

45 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

47 
Ad­tRndWeight
 = 
p_Vid
->AdaptRndWeight;

49 
block_x
 = 
q_m‘hod
->block_x;

50 
qp
 = 
q_m‘hod
->qp;

51 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

52 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

53 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

54 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

55 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

56 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

59 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

60 **
çdju¡4x4
 = 
q_m‘hod
->
çdju¡
;

62 
i
,
j
, 
cÛff_ùr
;

64 *
m7
;

65 
sÿËd_cÛff
;

67 
Ëv–
, 
run
 = 0;

68 
nÚz”o
 = 
FALSE
;

69 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

70 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

71 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

73 * 
·dju¡4x4
;

76 
cÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

78 
i
 = *
p_sÿn
++;

79 
j
 = *
p_sÿn
++;

81 
·dju¡4x4
 = &
çdju¡4x4
[
j
][
block_x
 + 
i
];

82 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

84 ià(*
m7
 != 0)

86 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

87 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

88 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

90 ià(
Ëv–
 != 0)

92 ià(
is_ÿvlc
)

93 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

95 *
·dju¡4x4
 = 
	`rshiá_ºd_sf
((
Ad­tRndWeight
 * (
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
))), q_bits + 1);

97 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

99 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

100 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

104 *
ACL
++ = 
Ëv–
;

105 *
ACR
++ = 
run
;

107 
run
 = 0;

108 
nÚz”o
 = 
TRUE
;

112 *
·dju¡4x4
 = 0;

113 *
m7
 = 0;

114 ++
run
;

119 *
·dju¡4x4
 = 0;

120 ++
run
;

124 *
ACL
 = 0;

126  
nÚz”o
;

127 
	}
}

129 
	$quªt_ac4x4_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

131 
block_x
 = 
q_m‘hod
->block_x;

133 
qp
 = 
q_m‘hod
->qp;

134 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

135 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

136 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

137 **
çdju¡4x4
 = 
q_m‘hod
->
çdju¡
;

138 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

139 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

140 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

142 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

143 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

144 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

145 
Ad­tRndWeight
 = 
p_Vid
->AdaptRndWeight;

146 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

148 
i
,
j
, 
cÛff_ùr
;

150 *
m7
;

151 
sÿËd_cÛff
;

153 
Ëv–
, 
run
 = 0;

154 
nÚz”o
 = 
FALSE
;

155 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

156 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

157 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

158 * 
·dju¡4x4
;

161 
cÛff_ùr
 = 1; coeff_ctr < 16; ++coeff_ctr)

163 
i
 = *
p_sÿn
++;

164 
j
 = *
p_sÿn
++;

166 
·dju¡4x4
 = &
çdju¡4x4
[
j
][
block_x
 + 
i
];

167 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

168 ià(*
m7
 != 0)

170 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

171 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

172 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

174 ià(
Ëv–
 != 0)

176 ià(
is_ÿvlc
)

177 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

179 *
·dju¡4x4
 = 
	`rshiá_ºd_sf
((
Ad­tRndWeight
 * (
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
))), (q_bits + 1));

181 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

183 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

184 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

188 *
ACL
++ = 
Ëv–
;

189 *
ACR
++ = 
run
;

191 
run
 = 0;

192 
nÚz”o
 = 
TRUE
;

196 *
·dju¡4x4
 = 0;

197 *
m7
 = 0;

198 ++
run
;

203 *
·dju¡4x4
 = 0;

204 ++
run
;

208 *
ACL
 = 0;

210  
nÚz”o
;

211 
	}
}

220 
quªt_dc4x4_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

221 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

223 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

224 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

225 
	gi
,
	gj
, 
	gcÛff_ùr
;

227 *
	gm7
;

228 
	gsÿËd_cÛff
;

230 
	gËv–
, 
	grun
 = 0;

231 
	gnÚz”o
 = 
FALSE
;

232 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

233 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

234 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

235 * 
	gDCL
 = &
DCLev–
[0];

236 * 
	gDCR
 = &
DCRun
[0];

239 
	gcÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

241 
	gi
 = *
p_sÿn
++;

242 
	gj
 = *
p_sÿn
++;

244 
	gm7
 = &
tblock
[
j
][
i
];

246 ià(*
	gm7
 != 0)

248 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

249 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

251 ià(
	gËv–
 != 0)

253 ià(
is_ÿvlc
)

254 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

256 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

257 *
	gm7
 = 
Ëv–
;

258 *
	gDCL
++ = 
Ëv–
;

259 *
	gDCR
++ = 
run
;

261 
	grun
 = 0;

262 
	gnÚz”o
 = 
TRUE
;

266 ++
	grun
;

267 *
	gm7
 = 0;

272 ++
	grun
;

276 *
	gDCL
 = 0;

278  
	gnÚz”o
;

	@lencod/src/quant4x4_normal.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<m©h.h
>

21 
	~"glob®.h
"

23 
	~"image.h
"

24 
	~"mb_acûss.h
"

25 
	~"vlc.h
"

26 
	~"ŒªsfÜm.h
"

27 
	~"mc_´ediùiÚ.h
"

28 
	~"q_off£ts.h
"

29 
	~"q_m©rix.h
"

30 
	~"quªt4x4.h
"

39 
	$quªt_4x4_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

41 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

42 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

43 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

44 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

46 
block_x
 = 
q_m‘hod
->block_x;

47 
qp
 = 
q_m‘hod
->qp;

48 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

49 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

50 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

51 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

52 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

53 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

56 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

57 
i
,
j
, 
cÛff_ùr
;

59 *
m7
;

60 
sÿËd_cÛff
;

62 
Ëv–
, 
run
 = 0;

63 
nÚz”o
 = 
FALSE
;

64 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

65 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

66 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

69 
cÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

71 
i
 = *
p_sÿn
++;

72 
j
 = *
p_sÿn
++;

74 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

76 ià(*
m7
 != 0)

78 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

79 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

80 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

82 ià(
Ëv–
 != 0)

84 ià(
is_ÿvlc
)

85 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

87 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

89 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

90 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

94 *
ACL
++ = 
Ëv–
;

95 *
ACR
++ = 
run
;

97 
run
 = 0;

98 
nÚz”o
 = 
TRUE
;

102 *
m7
 = 0;

103 ++
run
;

108 ++
run
;

112 *
ACL
 = 0;

114  
nÚz”o
;

115 
	}
}

117 
	$quªt_ac4x4_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

119 
block_x
 = 
q_m‘hod
->block_x;

121 
qp
 = 
q_m‘hod
->qp;

122 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

123 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

124 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

125 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

126 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

127 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

129 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

130 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

131 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

132 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

134 
i
,
j
, 
cÛff_ùr
;

136 *
m7
;

137 
sÿËd_cÛff
;

139 
Ëv–
, 
run
 = 0;

140 
nÚz”o
 = 
FALSE
;

141 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

142 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

143 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

146 
cÛff_ùr
 = 1; coeff_ctr < 16; ++coeff_ctr)

148 
i
 = *
p_sÿn
++;

149 
j
 = *
p_sÿn
++;

151 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

152 ià(*
m7
 != 0)

154 
q_·¿ms
 = &
q_·¿ms_4x4
[
j
][
i
];

155 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

156 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

158 ià(
Ëv–
 != 0)

160 ià(
is_ÿvlc
)

161 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

163 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

165 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

166 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 4);

170 *
ACL
++ = 
Ëv–
;

171 *
ACR
++ = 
run
;

173 
run
 = 0;

174 
nÚz”o
 = 
TRUE
;

178 *
m7
 = 0;

179 ++
run
;

184 ++
run
;

188 *
ACL
 = 0;

190  
nÚz”o
;

191 
	}
}

200 
quªt_dc4x4_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

201 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

203 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

204 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

205 
	gi
,
	gj
, 
	gcÛff_ùr
;

207 *
	gm7
;

208 
	gsÿËd_cÛff
;

210 
	gËv–
, 
	grun
 = 0;

211 
	gnÚz”o
 = 
FALSE
;

212 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

213 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

214 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

215 * 
	gDCL
 = &
DCLev–
[0];

216 * 
	gDCR
 = &
DCRun
[0];

219 
	gcÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

221 
	gi
 = *
p_sÿn
++;

222 
	gj
 = *
p_sÿn
++;

224 
	gm7
 = &
tblock
[
j
][
i
];

226 ià(*
	gm7
 != 0)

228 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

229 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

231 ià(
	gËv–
 != 0)

233 ià(
is_ÿvlc
)

234 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

236 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

237 *
	gm7
 = 
Ëv–
;

238 *
	gDCL
++ = 
Ëv–
;

239 *
	gDCR
++ = 
run
;

241 
	grun
 = 0;

242 
	gnÚz”o
 = 
TRUE
;

246 ++
	grun
;

247 *
	gm7
 = 0;

252 ++
	grun
;

256 *
	gDCL
 = 0;

258  
	gnÚz”o
;

	@lencod/src/quant4x4_trellis.c

18 
	~"cÚŒibutÜs.h
"

20 
	~<m©h.h
>

22 
	~"glob®.h
"

24 
	~"image.h
"

25 
	~"mb_acûss.h
"

26 
	~"vlc.h
"

27 
	~"ŒªsfÜm.h
"

28 
	~"mc_´ediùiÚ.h
"

29 
	~"q_off£ts.h
"

30 
	~"q_m©rix.h
"

31 
	~"quªt4x4.h
"

32 
	~"rdoq.h
"

41 
	$quªt_4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

43 
block_x
 = 
q_m‘hod
->block_x;

45 * 
ACL
 = &
q_m‘hod
->
ACLev–
[0];

46 * 
ACR
 = &
q_m‘hod
->
ACRun
[0];

47 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

48 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

49 
qp
 = 
q_m‘hod
->qp;

50 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

51 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

52 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

53 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

55 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

57 
i
,
j
, 
cÛff_ùr
;

59 *
m7
;

61 
Ëv–
, 
run
 = 0;

62 
nÚz”o
 = 
FALSE
;

63 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

64 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

66 
Ëv–T»Îis
[16];

68 
cu¼Sliû
->
	`rdoq_4x4
(
cu¼MB
, 
tblock
, 
q_m‘hod
, 
Ëv–T»Îis
);

71 
cÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

73 
i
 = *
p_sÿn
++;

74 
j
 = *
p_sÿn
++;

76 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

78 ià(*
m7
 != 0)

84 
Ëv–
 = 
Ëv–T»Îis
[
cÛff_ùr
];

86 ià(
Ëv–
 != 0)

88 ià(
is_ÿvlc
)

89 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

91 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

93 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

94 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 4);

95 *
ACL
++ = 
Ëv–
;

96 *
ACR
++ = 
run
;

98 
run
 = 0;

99 
nÚz”o
 = 
TRUE
;

103 *
m7
 = 0;

104 ++
run
;

109 ++
run
;

113 *
ACL
 = 0;

115  
nÚz”o
;

116 
	}
}

126 
	$rdoq_4x4_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[])

128 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

129 
block_x
 = 
q_m‘hod
->block_x;

130 
block_y
 = 
q_m‘hod
->block_y;

131 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

132 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

133 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

134 
qp
 = 
q_m‘hod
->qp;

135 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

136 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

137 
qp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

139 
Ëv–D©aSŒuù
 
Ëv–D©a
[16];

140 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

142 
ty³
 = 
LUMA_4x4
;

143 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

144 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

145 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1);

146 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

148 
	`š™_Œ–lis_d©a_4x4_CAVLC
(
cu¼MB
, 
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0], 
ty³
);

149 
	`e¡_RunLev–_CAVLC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
LUMA
, 
b8
, 
b4
, 16, 
Ïmbda_md
);

150 
	}
}

159 
	$rdoq_4x4_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[])

161 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

163 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

164 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

166 
Ëv–D©aSŒuù
 
Ëv–D©a
[16];

167 
kS¹
=0, 
kStÝ
=0, 
noCÛff
 = 0, 
e¡B™s
;

169 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

171 
noCÛff
 = 
	`š™_Œ–lis_d©a_4x4_CABAC
(
cu¼MB
, 
tblock
, 
q_m‘hod
, 
p_sÿn
, &
Ëv–D©a
[0], &
kS¹
, &
kStÝ
, 
LUMA_4x4
);

172 
e¡B™s
 = 
	`e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
cu¼MB
, 
LUMA_4x4
);

173 
	`e¡_wr™eRunLev–_CABAC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
LUMA_4x4
, 
Ïmbda_md
, 
kS¹
, 
kStÝ
, 
noCÛff
, 
e¡B™s
);

174 
	}
}

183 
	$quªt_ac4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

185 
block_x
 = 
q_m‘hod
->block_x;

187 * 
ACLev–
 = 
q_m‘hod
->ACLevel;

188 * 
ACRun
 = 
q_m‘hod
->ACRun;

189 
qp
 = 
q_m‘hod
->qp;

190 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

191 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

192 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

193 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

195 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

196 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

197 
BoÞ—n
 
is_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

198 
i
,
j
, 
cÛff_ùr
;

200 *
m7
;

201 
Ëv–
, 
run
 = 0;

202 
nÚz”o
 = 
FALSE
;

203 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

204 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

205 * 
ACL
 = &
ACLev–
[0];

206 * 
ACR
 = &
ACRun
[0];

208 
Ëv–T»Îis
[16];

210 
cu¼Sliû
->
	`rdoq_ac4x4
(
cu¼MB
, 
tblock
, 
q_m‘hod
, 
Ëv–T»Îis
);

213 
cÛff_ùr
 = 1; coeff_ctr < 16; coeff_ctr++)

215 
i
 = *
p_sÿn
++;

216 
j
 = *
p_sÿn
++;

218 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

219 ià(*
m7
 != 0)

225 
Ëv–
=
Ëv–T»Îis
[
cÛff_ùr
 - 1];

227 ià(
Ëv–
 != 0)

229 ià(
is_ÿvlc
)

230 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

232 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

234 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

235 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_4x4
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 4);

239 *
ACL
++ = 
Ëv–
;

240 *
ACR
++ = 
run
;

242 
run
 = 0;

243 
nÚz”o
 = 
TRUE
;

247 
run
++;

248 *
m7
 = 0;

253 
run
++;

257 *
ACL
 = 0;

259  
nÚz”o
;

260 
	}
}

270 
	$rdoq_ac4x4_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[])

272 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

273 
block_x
 = 
q_m‘hod
->block_x;

274 
block_y
 = 
q_m‘hod
->block_y;

275 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

276 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

277 
qp
 = 
q_m‘hod
->qp;

278 
ty³
 = 
q_m‘hod
->type;

279 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

280 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

281 
qp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

283 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

284 
Ëv–D©aSŒuù
 
Ëv–D©a
[16];

285 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

287 
pos_x
 = 
block_x
 >> 
BLOCK_SHIFT
;

288 
pos_y
 = 
block_y
 >> 
BLOCK_SHIFT
;

289 
b8
 = 2*(
pos_y
 >> 1è+ (
pos_x
 >> 1);

290 
b4
 = 2*(
pos_y
 & 0x01è+ (
pos_x
 & 0x01);

291 
block_ty³
 = ( (
ty³
 =ð
CHROMA_AC
è? CHROMA_AC : 
LUMA_INTRA16x16AC
);

293 
	`š™_Œ–lis_d©a_4x4_CAVLC
(
cu¼MB
, 
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0], 
ty³
);

294 
	`e¡_RunLev–_CAVLC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
block_ty³
, 
b8
, 
b4
, 15, 
Ïmbda_md
);

295 
	}
}

304 
	$rdoq_ac4x4_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, 
Ëv–T»Îis
[])

306 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

308 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

309 
ty³
 = 
q_m‘hod
->type;

311 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[1][0];

312 
Ëv–D©aSŒuù
 
Ëv–D©a
[16];

313 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

314 
kS¹
 = 0, 
kStÝ
 = 0, 
noCÛff
 = 0, 
e¡B™s
;

316 
noCÛff
 = 
	`š™_Œ–lis_d©a_4x4_CABAC
(
cu¼MB
, 
tblock
, 
q_m‘hod
, 
p_sÿn
, &
Ëv–D©a
[0], &
kS¹
, &
kStÝ
, 
ty³
);

317 
e¡B™s
 = 
	`e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
cu¼MB
, 
ty³
);

318 
	`e¡_wr™eRunLev–_CABAC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
ty³
, 
Ïmbda_md
, 
kS¹
, 
kStÝ
, 
noCÛff
, 
e¡B™s
);

319 
	}
}

328 
quªt_dc4x4_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

329 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

331 
Sliû
 *
	gcu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

332 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

333 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

334 
	gi
,
	gj
, 
	gcÛff_ùr
;

336 *
	gm7
;

338 
	gËv–
, 
	grun
 = 0;

339 
	gnÚz”o
 = 
FALSE
;

340 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

341 
	gqp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

342 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

343 * 
	gDCL
 = &
DCLev–
[0];

344 * 
	gDCR
 = &
DCRun
[0];

346 
	gËv–T»Îis
[16];

348 
	gcu¼Sliû
->
rdoq_dc
(
cu¼MB
, 
tblock
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
pos_sÿn
, 
Ëv–T»Îis
, 
LUMA_16DC
);

351 
	gcÛff_ùr
 = 0; coeff_ctr < 16; coeff_ctr++)

353 
	gi
 = *
p_sÿn
++;

354 
	gj
 = *
p_sÿn
++;

356 
	gm7
 = &
tblock
[
j
][
i
];

358 ià(*
	gm7
 != 0)

360 
Ëv–
 = 
Ëv–T»Îis
[
cÛff_ùr
];

362 ià(
	gËv–
 != 0)

364 ià(
is_ÿvlc
)

365 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

367 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

368 *
	gm7
 = 
Ëv–
;

369 *
	gDCL
++ = 
Ëv–
;

370 *
	gDCR
++ = 
run
;

372 
	grun
 = 0;

373 
	gnÚz”o
 = 
TRUE
;

377 
	grun
++;

378 *
	gm7
 = 0;

383 
	grun
++;

387 *
	gDCL
 = 0;

389  
	gnÚz”o
;

400 
rdoq_dc_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
,

401 cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[], 
ty³
)

403 
VideoP¬am‘”s
 *
	gp_Vid
 = 
cu¼MB
->
p_Vid
;

404 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

405 
Ëv–D©aSŒuù
 
	gËv–D©a
[16];

406 
	gÏmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

408 
š™_Œ–lis_d©a_DC_CAVLC
(
cu¼MB
, 
tblock
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0]);

409 
e¡_RunLev–_CAVLC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
LUMA_INTRA16x16DC
, 0, 0, 16, 
Ïmbda_md
);

421 
rdoq_dc_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[], 
ty³
)

423 
VideoP¬am‘”s
 *
	gp_Vid
 = 
cu¼MB
->
p_Vid
;

424 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

425 
Ëv–D©aSŒuù
 
	gËv–D©a
[16];

426 
	gÏmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

427 
	gkS¹
 = 0, 
	gkStÝ
 = 0, 
	gnoCÛff
 = 0, 
	ge¡B™s
;

429 
	gnoCÛff
 = 
š™_Œ–lis_d©a_DC_CABAC
(
cu¼MB
, 
tblock
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0], &
kS¹
, &
kStÝ
);

430 
	ge¡B™s
 = 
e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
cu¼MB
, 
ty³
);

431 
e¡_wr™eRunLev–_CABAC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
ty³
, 
Ïmbda_md
, 
kS¹
, 
kStÝ
, 
noCÛff
, 
e¡B™s
);

	@lencod/src/quant8x8.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

21 
	~"quªt8x8.h
"

31 
	$š™_quªt_8x8
(
Sliû
 *
cu¼Sliû
)

33 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

35 ià(
cu¼Sliû
->
U£RDOQuªt
 == 1)

37 
cu¼Sliû
->
quªt_8x8
 = 
quªt_8x8_Œ–lis
;

38 
cu¼Sliû
->
quªt_8x8ÿvlc
 = 
quªt_8x8ÿvlc_Œ–lis
;

40 ià(
p_Vid
->
Ad­tiveRoundšg
)

42 
cu¼Sliû
->
quªt_8x8
 = 
quªt_8x8_¬ound
;

43 
cu¼Sliû
->
quªt_8x8ÿvlc
 = 
quªt_8x8ÿvlc_¬ound
;

47 
cu¼Sliû
->
quªt_8x8
 = 
quªt_8x8_nÜm®
;

48 
cu¼Sliû
->
quªt_8x8ÿvlc
 = 
quªt_8x8ÿvlc_nÜm®
;

50 
	}
}

	@lencod/src/quant8x8_around.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mb_acûss.h
"

24 
	~"vlc.h
"

25 
	~"ŒªsfÜm.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"q_off£ts.h
"

28 
	~"q_m©rix.h
"

29 
	~"quªt8x8.h
"

43 
	$quªt_8x8_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

45 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

46 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

47 
Ad­tRndWeight
 = 
p_Vid
->AdaptRndWeight;

49 
block_x
 = 
q_m‘hod
->block_x;

51 
qp
 = 
q_m‘hod
->qp;

52 * 
ACLev–
 = 
q_m‘hod
->ACLevel;

53 * 
ACRun
 = 
q_m‘hod
->ACRun;

54 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

55 
Lev–QuªtP¬ams
 *
q_·¿ms
 = 
NULL
;

57 **
çdju¡8x8
 = 
q_m‘hod
->
çdju¡
;

58 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

59 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

60 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

62 
i
,
j
, 
cÛff_ùr
;

64 *
m7
;

65 
sÿËd_cÛff
;

67 
Ëv–
, 
run
 = 0;

68 
nÚz”o
 = 
FALSE
;

69 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

70 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

71 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

72 * 
ACL
 = &
ACLev–
[0];

73 * 
ACR
 = &
ACRun
[0];

74 * 
·dju¡8x8
;

77 
cÛff_ùr
 = 0; coeff_ctr < 64; ++coeff_ctr)

79 
i
 = *
p_sÿn
++;

80 
j
 = *
p_sÿn
++;

82 
·dju¡8x8
 = &
çdju¡8x8
[
j
][
block_x
 + 
i
];

83 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

84 ià(*
m7
 != 0)

86 
q_·¿ms
 = &
q_·¿ms_8x8
[
j
][
i
];

87 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

88 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms
->
Off£tComp
è>> 
q_b™s
;

90 ià(
Ëv–
 != 0)

92 *
·dju¡8x8
 = 
	`rshiá_ºd_sf
((
Ad­tRndWeight
 * (
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
))), (q_bits + 1));

94 
nÚz”o
 = 
TRUE
;

96 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

98 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

99 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms
->
InvSÿËComp
è<< 
qp_³r
), 6);

100 *
ACL
++ = 
Ëv–
;

101 *
ACR
++ = 
run
;

103 
run
 = 0;

107 *
·dju¡8x8
 = 0;

108 ++
run
;

109 *
m7
 = 0;

114 *
·dju¡8x8
 = 0;

115 ++
run
;

119 *
ACL
 = 0;

121  
nÚz”o
;

122 
	}
}

136 
	$quªt_8x8ÿvlc_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
)

138 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

139 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

140 
Ad­tRndWeight
 = 
p_Vid
->AdaptRndWeight;

141 
block_x
 = 
q_m‘hod
->block_x;

143 
qp
 = 
q_m‘hod
->qp;

144 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

145 **
çdju¡8x8
 = 
q_m‘hod
->
çdju¡
;

146 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

147 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

148 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

150 
i
,
j
, 
k
, 
cÛff_ùr
;

152 *
m7
;

153 
sÿËd_cÛff
;

155 
Ëv–
, 
runs
[4] = { 0 };

156 
nÚz”o
 = 
FALSE
;

157 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

158 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

159 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

160 * 
ACL
[4];

161 * 
ACR
[4];

162 * 
·dju¡8x8
;

164 
k
 = 0; k < 4; ++k)

166 
ACL
[
k
] = &
cofAC
[k][0][0];

167 
ACR
[
k
] = &
cofAC
[k][1][0];

171 
k
 = 0; k < 4; ++k)

173 
cÛff_ùr
 = 0; coeff_ctr < 16; ++coeff_ctr)

175 
i
 = *
p_sÿn
++;

176 
j
 = *
p_sÿn
++;

178 
·dju¡8x8
 = &
çdju¡8x8
[
j
][
block_x
 + 
i
];

179 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

180 ià(*
m7
 != 0)

182 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms_8x8
[
j
][
i
].
SÿËComp
;

183 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms_8x8
[
j
][
i
].
Off£tComp
è>> 
q_b™s
;

185 ià(
Ëv–
 != 0)

187 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

189 *
·dju¡8x8
 = 
	`rshiá_ºd_sf
((
Ad­tRndWeight
 * (
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
))), (q_bits + 1));

191 
nÚz”o
=
TRUE
;

193 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
runs
[
k
]];

195 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

196 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_8x8
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 6);

198 *(
ACL
[
k
])++ = 
Ëv–
;

199 *(
ACR
[
k
])++ = 
runs
[k];

201 
runs
[
k
] = 0;

205 *
·dju¡8x8
 = 0;

206 *
m7
 = 0;

207 ++
runs
[
k
];

212 *
·dju¡8x8
 = 0;

213 ++
runs
[
k
];

218 
k
 = 0; k < 4; ++k)

219 *(
ACL
[
k
]) = 0;

221  
nÚz”o
;

222 
	}
}

	@lencod/src/quant8x8_normal.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"mb_acûss.h
"

24 
	~"vlc.h
"

25 
	~"ŒªsfÜm.h
"

26 
	~"mc_´ediùiÚ.h
"

27 
	~"q_off£ts.h
"

28 
	~"q_m©rix.h
"

29 
	~"quªt8x8.h
"

43 
	$quªt_8x8_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

45 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

46 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

47 
block_x
 = 
q_m‘hod
->block_x;

48 * 
ACLev–
 = 
q_m‘hod
->ACLevel;

49 * 
ACRun
 = 
q_m‘hod
->ACRun;

50 
qp
 = 
q_m‘hod
->qp;

51 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

52 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

53 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

54 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

56 
i
,
j
, 
cÛff_ùr
;

58 *
m7
;

59 
sÿËd_cÛff
;

61 
Ëv–
, 
run
 = 0;

62 
nÚz”o
 = 
FALSE
;

63 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

64 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

65 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

66 * 
ACL
 = &
ACLev–
[0];

67 * 
ACR
 = &
ACRun
[0];

70 
cÛff_ùr
 = 0; coeff_ctr < 64; coeff_ctr++)

72 
i
 = *
p_sÿn
++;

73 
j
 = *
p_sÿn
++;

75 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

76 ià(*
m7
 != 0)

78 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms_8x8
[
j
][
i
].
SÿËComp
;

79 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms_8x8
[
j
][
i
].
Off£tComp
è>> 
q_b™s
;

81 ià(
Ëv–
 != 0)

83 
nÚz”o
 = 
TRUE
;

85 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

87 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

88 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_8x8
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 6);

89 *
ACL
++ = 
Ëv–
;

90 *
ACR
++ = 
run
;

92 
run
 = 0;

96 
run
++;

97 *
m7
 = 0;

102 
run
++;

106 *
ACL
 = 0;

108  
nÚz”o
;

109 
	}
}

123 
	$quªt_8x8ÿvlc_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
)

125 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

126 
block_x
 = 
q_m‘hod
->block_x;

128 
qp
 = 
q_m‘hod
->qp;

129 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

130 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

131 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

132 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

135 
i
,
j
, 
k
, 
cÛff_ùr
;

137 *
m7
;

138 
sÿËd_cÛff
;

140 
Ëv–
, 
runs
[4] = { 0 };

141 
nÚz”o
 = 
FALSE
;

142 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

143 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

144 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

145 * 
ACL
[4];

146 * 
ACR
[4];

148 
k
 = 0; k < 4; k++)

150 
ACL
[
k
] = &
cofAC
[k][0][0];

151 
ACR
[
k
] = &
cofAC
[k][1][0];

155 
k
 = 0; k < 4; k++)

157 
cÛff_ùr
 = 0; coeff_ctr < 16; coeff_ctr++)

159 
i
 = *
p_sÿn
++;

160 
j
 = *
p_sÿn
++;

162 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

163 ià(*
m7
 != 0)

165 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms_8x8
[
j
][
i
].
SÿËComp
;

166 
Ëv–
 = (
sÿËd_cÛff
 + 
q_·¿ms_8x8
[
j
][
i
].
Off£tComp
è>> 
q_b™s
;

168 ià(
Ëv–
 != 0)

170 
Ëv–
 = 
	`imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

172 
nÚz”o
=
TRUE
;

174 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
runs
[
k
]];

176 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

177 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_8x8
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 6);

179 *(
ACL
[
k
])++ = 
Ëv–
;

180 *(
ACR
[
k
])++ = 
runs
[k];

182 
runs
[
k
] = 0;

186 
runs
[
k
]++;

187 *
m7
 = 0;

192 
runs
[
k
]++;

197 
k
 = 0; k < 4; k++)

198 *(
ACL
[
k
]) = 0;

200  
nÚz”o
;

201 
	}
}

	@lencod/src/quant8x8_trellis.c

15 
	~"cÚŒibutÜs.h
"

17 
	~<m©h.h
>

19 
	~"glob®.h
"

20 
	~"image.h
"

21 
	~"mb_acûss.h
"

22 
	~"vlc.h
"

23 
	~"ŒªsfÜm.h
"

24 
	~"mc_´ediùiÚ.h
"

25 
	~"q_off£ts.h
"

26 
	~"q_m©rix.h
"

27 
	~"quªt8x8.h
"

28 
	~"rdoq.h
"

38 
	$rdoq_8x8_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
,
qp_³r
, 
qp_»m
,

39 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
, cÚ¡ 
by‹
 *
p_sÿn
, 
Ëv–T»Îis
[64])

41 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

42 
Ëv–D©aSŒuù
 
Ëv–D©a
[64];

43 
Ïmbda_md
 = 0.0;

44 
kS¹
 = 0, 
kStÝ
 = 0, 
noCÛff
 = 0;

46 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

48 
noCÛff
 = 
	`š™_Œ–lis_d©a_8x8_CABAC
(
cu¼MB
, 
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_8x8
, 
p_sÿn
, &
Ëv–D©a
[0], &
kS¹
, &
kStÝ
);

49 
	`e¡_wr™eRunLev–_CABAC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
LUMA_8x8
, 
Ïmbda_md
, 
kS¹
, 
kStÝ
, 
noCÛff
, 0);

50 
	}
}

60 
	$rdoq_8x8_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_y
, 
block_x
, 
qp_³r
, 
qp_»m
,

61 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
, cÚ¡ 
by‹
 *
p_sÿn
, 
Ëv–T»Îis
[4][16])

63 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

64 
k
;

65 
Ëv–D©aSŒuù
 
Ëv–D©a
[4][16];

66 
Ïmbda_md
 = 0.0;

68 
b8
 = ((
block_y
 >> 3è<< 1è+ (
block_x
 >> 3);

70 
Ïmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

72 
	`š™_Œ–lis_d©a_8x8_CAVLC
 (
cu¼MB
, 
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_8x8
, 
p_sÿn
, 
Ëv–D©a
);

74 
k
 = 0; k < 4; k++)

75 
	`e¡_RunLev–_CAVLC
(
cu¼MB
, 
Ëv–D©a
[
k
], 
Ëv–T»Îis
[k], 
LUMA
, 
b8
, k, 16, 
Ïmbda_md
);

76 
	}
}

90 
	$quªt_8x8_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
)

92 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

93 
block_x
 = 
q_m‘hod
->block_x;

94 
qp
 = 
q_m‘hod
->qp;

95 * 
ACLev–
 = 
q_m‘hod
->ACLevel;

96 * 
ACRun
 = 
q_m‘hod
->ACRun;

97 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

98 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

99 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

100 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

102 
i
,
j
, 
cÛff_ùr
;

104 *
m7
;

105 
Ëv–
, 
run
 = 0;

106 
nÚz”o
 = 
FALSE
;

107 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

108 
qp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

109 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

110 * 
ACL
 = &
ACLev–
[0];

111 * 
ACR
 = &
ACRun
[0];

112 
Ëv–T»Îis
[64];

114 
	`rdoq_8x8_CABAC
(
cu¼MB
, 
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_8x8
, 
p_sÿn
, 
Ëv–T»Îis
);

117 
cÛff_ùr
 = 0; coeff_ctr < 64; coeff_ctr++)

119 
i
 = *
p_sÿn
++;

120 
j
 = *
p_sÿn
++;

122 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

123 ià(*
m7
 != 0)

125 
Ëv–
 = 
Ëv–T»Îis
[
cÛff_ùr
];

127 ià(
Ëv–
 != 0)

129 
nÚz”o
 = 
TRUE
;

131 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
run
];

133 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

134 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_8x8
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 6);

135 *
ACL
++ = 
Ëv–
;

136 *
ACR
++ = 
run
;

138 
run
 = 0;

142 
run
++;

143 *
m7
 = 0;

148 
run
++;

152 *
ACL
 = 0;

154  
nÚz”o
;

155 
	}
}

169 
	$quªt_8x8ÿvlc_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
quªt_m‘hods
 *
q_m‘hod
, *** 
cofAC
)

171 
QuªtP¬am‘”s
 *
p_Quªt
 = 
cu¼MB
->
p_Vid
->p_Quant;

172 
block_x
 = 
q_m‘hod
->block_x;

173 
block_y
 = 
q_m‘hod
->block_y;

174 
qp
 = 
q_m‘hod
->qp;

175 
Lev–QuªtP¬ams
 **
q_·¿ms_8x8
 = 
q_m‘hod
->
q_·¿ms
;

176 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
q_m‘hod
->pos_scan;

177 cÚ¡ 
by‹
 *
c_co¡
 = 
q_m‘hod
->c_cost;

178 *
cÛff_co¡
 = 
q_m‘hod
->coeff_cost;

180 
i
,
j
, 
k
, 
cÛff_ùr
;

182 *
m7
;

183 
Ëv–
, 
runs
[4] = { 0 };

184 
nÚz”o
 = 
FALSE
;

185 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

186 
qp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

187 cÚ¡ 
by‹
 *
p_sÿn
 = &
pos_sÿn
[0][0];

188 * 
ACL
[4];

189 * 
ACR
[4];

191 
Ëv–T»Îis
[4][16];

193 
	`rdoq_8x8_CAVLC
(
cu¼MB
, 
tblock
, 
block_y
, 
block_x
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_8x8
, 
p_sÿn
, 
Ëv–T»Îis
);

195 
k
 = 0; k < 4; k++)

197 
ACL
[
k
] = &
cofAC
[k][0][0];

198 
ACR
[
k
] = &
cofAC
[k][1][0];

202 
k
 = 0; k < 4; k++)

204 
cÛff_ùr
 = 0; coeff_ctr < 16; coeff_ctr++)

206 
i
 = *
p_sÿn
++;

207 
j
 = *
p_sÿn
++;

209 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

211 ià(
m7
 != 0)

213 
Ëv–
 = 
Ëv–T»Îis
[
k
][
cÛff_ùr
];

215 ià(
Ëv–
 != 0)

217 
nÚz”o
=
TRUE
;

219 *
cÛff_co¡
 +ð(
Ëv–
 > 1è? 
MAX_VALUE
 : 
c_co¡
[
runs
[
k
]];

221 
Ëv–
 = 
	`isigÇb
Öev–, *
m7
);

222 *
m7
 = 
	`rshiá_ºd_sf
(((
Ëv–
 * 
q_·¿ms_8x8
[
j
][
i
].
InvSÿËComp
è<< 
qp_³r
), 6);

224 *(
ACL
[
k
])++ = 
Ëv–
;

225 *(
ACR
[
k
])++ = 
runs
[k];

227 
runs
[
k
] = 0;

231 
runs
[
k
]++;

232 *
m7
 = 0;

237 
runs
[
k
]++;

242 
k
 = 0; k < 4; k++)

243 *(
ACL
[
k
]) = 0;

245  
nÚz”o
;

246 
	}
}

	@lencod/src/quantChroma.c

16 
	~"cÚŒibutÜs.h
"

18 
	~"glob®.h
"

19 
	~"quªt4x4.h
"

20 
	~"quªtChroma.h
"

29 
	$š™_quªt_Chroma
(
Sliû
 *
cu¼Sliû
)

31 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

32 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

34 ià(
p_IÅ
->
U£RDOQuªt
 =ð1 &&…_IÅ->
RDOQ_CR
 == 1)

36 
cu¼Sliû
->
quªt_ac4x4ü
 = 
quªt_ac4x4_Œ–lis
;

37 ià(
p_IÅ
->
RDOQ_DC_CR
)

39 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV422
)

40 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc4x2_Œ–lis
;

42 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc2x2_Œ–lis
;

46 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV422
)

47 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc4x2_nÜm®
;

49 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc2x2_nÜm®
;

51 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

52 
cu¼Sliû
->
rdoq_dc_ü
 = 
rdoq_dc_ü_CABAC
;

54 
cu¼Sliû
->
rdoq_dc_ü
 = 
rdoq_dc_ü_CAVLC
;

56 ià(
p_IÅ
->
U£RDOQuªt
 =ð1 || (!(
cu¼Sliû
->
p_Vid
)->
Ad­tiveRoundšg
))

58 
cu¼Sliû
->
quªt_ac4x4ü
 = 
quªt_ac4x4_nÜm®
;

59 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV422
)

60 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc4x2_nÜm®
;

62 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc2x2_nÜm®
;

66 
cu¼Sliû
->
quªt_ac4x4ü
 = 
quªt_ac4x4_¬ound
;

67 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV422
)

68 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc4x2_¬ound
;

70 
cu¼Sliû
->
quªt_dc_ü
 = 
quªt_dc2x2_¬ound
;

72 
	}
}

	@lencod/src/quantChroma_2step.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

21 
	~"q_m©rix.h
"

22 
	~"quªt4x4.h
"

23 
	~"quªtChroma.h
"

37 
quªt_dc2x2_2¡•
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

38 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

40 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

41 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

42 
	gcÛff_ùr
;

44 *
	gm7
;

45 
	gsÿËd_cÛff
;

47 
	gËv–
, 
	grun
 = 0;

48 
	gnÚz”o
 = 
FALSE
;

49 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

50 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

52 * 
	gDCL
 = &
DCLev–
[0];

53 * 
	gDCR
 = &
DCRun
[0];

55 
	gm7
 = *
tblock
;

58 
	gcÛff_ùr
=0; coeff_ctr < 4; coeff_ctr++)

62 ià(*
	gm7
)

64 
	gsÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

65 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

67 ià(
	gËv–
 != 0)

69 ià(
is_ÿvlc
)

70 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

72 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

74 *
	gm7
++ = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

76 *
	gDCL
++ = 
Ëv–
;

77 *
	gDCR
++ = 
run
;

78 
	grun
 = 0;

79 
	gnÚz”o
 = 
TRUE
;

83 
	grun
++;

84 *
	gm7
++ = 0;

89 
	grun
++;

90 
	gm7
++;

94 *
	gDCL
 = 0;

96  
	gnÚz”o
;

110 
quªt_dc4x2_2¡•
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

111 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

113 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

114 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

115 
	gi
,
	gj
, 
	gcÛff_ùr
;

117 *
	gm7
;

118 
	gsÿËd_cÛff
;

120 
	gËv–
, 
	grun
 = 0;

121 
	gnÚz”o
 = 
FALSE
;

122 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

123 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

124 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

125 * 
	gDCL
 = &
DCLev–
[0];

126 * 
	gDCR
 = &
DCRun
[0];

129 
	gcÛff_ùr
 = 0; coeff_ctr < 8; coeff_ctr++)

131 
	gj
 = *
p_sÿn
++;

132 
	gi
 = *
p_sÿn
++;

134 
	gm7
 = &
tblock
[
j
][
i
];

136 ià(*
	gm7
 != 0)

138 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

139 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

141 ià(
	gËv–
 != 0)

143 ià(
is_ÿvlc
)

144 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

145 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

147 *
	gm7
 = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

149 *
	gDCL
++ = 
Ëv–
;

150 *
	gDCR
++ = 
run
;

152 
	grun
 = 0;

153 
	gnÚz”o
 = 
TRUE
;

157 
	grun
++;

158 *
	gm7
 = 0;

163 
	grun
++;

167 *
	gDCL
 = 0;

169  
	gnÚz”o
;

	@lencod/src/quantChroma_around.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

21 
	~"q_m©rix.h
"

22 
	~"quªt4x4.h
"

23 
	~"quªtChroma.h
"

37 
quªt_dc2x2_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

38 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

40 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

41 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

42 
	gcÛff_ùr
;

44 *
	gm7
;

45 
	gsÿËd_cÛff
;

47 
	gËv–
, 
	grun
 = 0;

48 
	gnÚz”o
 = 
FALSE
;

49 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

50 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

52 * 
	gDCL
 = &
DCLev–
[0];

53 * 
	gDCR
 = &
DCRun
[0];

55 
	gm7
 = *
tblock
;

58 
	gcÛff_ùr
=0; coeff_ctr < 4; ++coeff_ctr)

62 ià(*
	gm7
)

64 
	gsÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

65 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

67 ià(
	gËv–
 != 0)

69 ià(
is_ÿvlc
)

70 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

72 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

74 *
	gm7
++ = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

76 *
	gDCL
++ = 
Ëv–
;

77 *
	gDCR
++ = 
run
;

79 
	grun
 = 0;

80 
	gnÚz”o
 = 
TRUE
;

84 ++
	grun
;

85 *
	gm7
++ = 0;

90 ++
	grun
;

91 ++
	gm7
;

95 *
	gDCL
 = 0;

97  
	gnÚz”o
;

111 
quªt_dc4x2_¬ound
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

112 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

114 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

115 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

116 
	gi
,
	gj
, 
	gcÛff_ùr
;

118 *
	gm7
;

119 
	gsÿËd_cÛff
;

121 
	gËv–
, 
	grun
 = 0;

122 
	gnÚz”o
 = 
FALSE
;

123 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

124 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

125 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

126 * 
	gDCL
 = &
DCLev–
[0];

127 * 
	gDCR
 = &
DCRun
[0];

130 
	gcÛff_ùr
 = 0; coeff_ctr < 8; ++coeff_ctr)

132 
	gj
 = *
p_sÿn
++;

133 
	gi
 = *
p_sÿn
++;

135 
	gm7
 = &
tblock
[
j
][
i
];

137 ià(*
	gm7
 != 0)

139 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

140 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

142 ià(
	gËv–
 != 0)

144 ià(
is_ÿvlc
)

145 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

146 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

148 *
	gm7
 = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

150 *
	gDCL
++ = 
Ëv–
;

151 *
	gDCR
++ = 
run
;

153 
	grun
 = 0;

154 
	gnÚz”o
 = 
TRUE
;

158 ++
	grun
;

159 *
	gm7
 = 0;

164 ++
	grun
;

168 *
	gDCL
 = 0;

170  
	gnÚz”o
;

	@lencod/src/quantChroma_normal.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

21 
	~"q_m©rix.h
"

22 
	~"quªt4x4.h
"

23 
	~"quªtChroma.h
"

37 
quªt_dc2x2_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

38 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

40 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

41 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

42 
	gcÛff_ùr
;

44 *
	gm7
;

45 
	gsÿËd_cÛff
;

47 
	gËv–
, 
	grun
 = 0;

48 
	gnÚz”o
 = 
FALSE
;

49 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

50 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

52 * 
	gDCL
 = &
DCLev–
[0];

53 * 
	gDCR
 = &
DCRun
[0];

55 
	gm7
 = *
tblock
;

58 
	gcÛff_ùr
=0; coeff_ctr < 4; coeff_ctr++)

62 ià(*
	gm7
)

64 
	gsÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

65 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

67 ià(
	gËv–
 != 0)

69 ià(
is_ÿvlc
)

70 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

72 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

74 *
	gm7
++ = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

76 *
	gDCL
++ = 
Ëv–
;

77 *
	gDCR
++ = 
run
;

78 
	grun
 = 0;

79 
	gnÚz”o
 = 
TRUE
;

83 
	grun
++;

84 *
	gm7
++ = 0;

89 
	grun
++;

90 
	gm7
++;

94 *
	gDCL
 = 0;

96  
	gnÚz”o
;

110 
quªt_dc4x2_nÜm®
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

111 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

113 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

114 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼MB
->
p_Sliû
->
symbÞ_mode
 =ð
CAVLC
);

115 
	gi
,
	gj
, 
	gcÛff_ùr
;

117 *
	gm7
;

118 
	gsÿËd_cÛff
;

120 
	gËv–
, 
	grun
 = 0;

121 
	gnÚz”o
 = 
FALSE
;

122 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

123 
	gq_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

124 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

125 * 
	gDCL
 = &
DCLev–
[0];

126 * 
	gDCR
 = &
DCRun
[0];

129 
	gcÛff_ùr
 = 0; coeff_ctr < 8; coeff_ctr++)

131 
	gj
 = *
p_sÿn
++;

132 
	gi
 = *
p_sÿn
++;

134 
	gm7
 = &
tblock
[
j
][
i
];

136 ià(*
	gm7
 != 0)

138 
sÿËd_cÛff
 = 
Ÿbs
 (*
m7
è* 
q_·¿ms_4x4
->
SÿËComp
;

139 
	gËv–
 = (
sÿËd_cÛff
 + (
q_·¿ms_4x4
->
Off£tComp
 << 1èè>> 
q_b™s
;

141 ià(
	gËv–
 != 0)

143 ià(
is_ÿvlc
)

144 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

145 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

147 *
	gm7
 = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

149 *
	gDCL
++ = 
Ëv–
;

150 *
	gDCR
++ = 
run
;

152 
	grun
 = 0;

153 
	gnÚz”o
 = 
TRUE
;

157 
	grun
++;

158 *
	gm7
 = 0;

163 
	grun
++;

167 *
	gDCL
 = 0;

169  
	gnÚz”o
;

	@lencod/src/quantChroma_trellis.c

16 
	~"cÚŒibutÜs.h
"

18 
	~<m©h.h
>

20 
	~"glob®.h
"

21 
	~"q_m©rix.h
"

22 
	~"quªt4x4.h
"

23 
	~"quªtChroma.h
"

24 
	~"rdoq.h
"

37 
quªt_dc2x2_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

38 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

40 
Sliû
 *
	gcu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

41 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

42 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

43 
	gcÛff_ùr
;

45 *
	gm7
;

47 
	gËv–
, 
	grun
 = 0;

48 
	gnÚz”o
 = 
FALSE
;

49 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

50 
	gqp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

52 * 
	gDCL
 = &
DCLev–
[0];

53 * 
	gDCR
 = &
DCRun
[0];

55 
	gËv–T»Îis
[16];

57 
	gcu¼Sliû
->
rdoq_dc_ü
(
cu¼MB
, 
tblock
,
qp_³r
,
qp_»m
, 
q_·¿ms_4x4
, 
pos_sÿn
, 
Ëv–T»Îis
, 
CHROMA_DC
);

59 
	gm7
 = *
tblock
;

62 
	gcÛff_ùr
=0; coeff_ctr < 4; coeff_ctr++)

66 ià(*
	gm7
)

68 
	gËv–
 = 
Ëv–T»Îis
[
cÛff_ùr
];

70 ià(
	gËv–
 != 0)

72 ià(
is_ÿvlc
)

73 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

75 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

77 *
	gm7
++ = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

79 *
	gDCL
++ = 
Ëv–
;

80 *
	gDCR
++ = 
run
;

82 
	grun
 = 0;

83 
	gnÚz”o
 = 
TRUE
;

87 
	grun
++;

88 *
	gm7
++ = 0;

93 
	grun
++;

94 
	gm7
++;

98 *
	gDCL
 = 0;

100  
	gnÚz”o
;

114 
quªt_dc4x2_Œ–lis
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp
, * 
DCLev–
, * 
DCRun
,

115 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, **
çdju¡
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2])

117 
Sliû
 *
	gcu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

118 
QuªtP¬am‘”s
 *
	gp_Quªt
 = 
cu¼MB
->
p_Vid
->
p_Quªt
;

119 
BoÞ—n
 
	gis_ÿvlc
 = (BoÞ—nè(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

120 
	gi
,
	gj
, 
	gcÛff_ùr
;

122 *
	gm7
;

124 
	gËv–
, 
	grun
 = 0;

125 
	gnÚz”o
 = 
FALSE
;

126 
	gqp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

127 
	gqp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

128 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

129 * 
	gDCL
 = &
DCLev–
[0];

130 * 
	gDCR
 = &
DCRun
[0];

132 
	gËv–T»Îis
[16];

134 
	gcu¼Sliû
->
rdoq_dc_ü
(
cu¼MB
, 
tblock
,
qp_³r
,
qp_»m
, 
q_·¿ms_4x4
,
pos_sÿn
, 
Ëv–T»Îis
, 
CHROMA_DC_2x4
);

136 
	gcÛff_ùr
=0; coeff_ctr < 8; coeff_ctr++)

138 
	gj
 = *
p_sÿn
++;

139 
	gi
 = *
p_sÿn
++;

141 
	gm7
 = &
tblock
[
j
][
i
];

143 ià(*
	gm7
 != 0)

145 
Ëv–
 = 
Ëv–T»Îis
[
cÛff_ùr
];

147 ià(
	gËv–
 != 0)

149 ià(
is_ÿvlc
)

150 
Ëv–
 = 
imš
Öev–, 
CAVLC_LEVEL_LIMIT
);

151 
	gËv–
 = 
isigÇb
(
Ëv–
, *
m7
);

153 *
	gm7
 = ((
Ëv–
 * 
q_·¿ms_4x4
->
InvSÿËComp
è<< 
qp_³r
);

155 *
	gDCL
++ = 
Ëv–
;

156 *
	gDCR
++ = 
run
;

158 
	grun
 = 0;

159 
	gnÚz”o
 = 
TRUE
;

163 
	grun
++;

164 *
	gm7
 = 0;

169 
	grun
++;

173 *
	gDCL
 = 0;

175  
	gnÚz”o
;

186 
rdoq_dc_ü_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[], 
ty³
)

188 
VideoP¬am‘”s
 *
	gp_Vid
 = 
cu¼MB
->
p_Vid
;

190 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

191 
Ëv–D©aSŒuù
 
	gËv–D©a
[16];

192 
	gÏmbda_md
 = 0.0;

194 
	gÏmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

196 
š™_Œ–lis_d©a_DC_ü_CAVLC
(
cu¼MB
, 
tblock
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0]);

197 
e¡_RunLev–_CAVLC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
CHROMA_DC
, 0, 0, 
p_Vid
->
num_cdc_cÛff
, 
Ïmbda_md
);

208 
rdoq_dc_ü_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 *
q_·¿ms_4x4
, cÚ¡ 
by‹
 (*
pos_sÿn
)[2], 
Ëv–T»Îis
[], 
ty³
)

210 
VideoP¬am‘”s
 *
	gp_Vid
 = 
cu¼MB
->
p_Vid
;

211 cÚ¡ 
by‹
 *
	gp_sÿn
 = &
pos_sÿn
[0][0];

212 
Ëv–D©aSŒuù
 
	gËv–D©a
[16];

213 
	gÏmbda_md
 = 0.0;

214 
	gkS¹
=0, 
	gkStÝ
=0, 
	gnoCÛff
 = 0, 
	ge¡B™s
;

216 
	gÏmbda_md
 = 
p_Vid
->
Ïmbda_rdoq
[p_Vid->
ty³
][p_Vid->
ma¡”QP
];

218 
	gnoCÛff
 = 
š™_Œ–lis_d©a_DC_ü_CABAC
(
cu¼MB
, 
tblock
, 
qp_³r
, 
qp_»m
, 
q_·¿ms_4x4
, 
p_sÿn
, &
Ëv–D©a
[0], &
kS¹
, &
kStÝ
);

219 
	ge¡B™s
 = 
e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
cu¼MB
, 
ty³
);

220 
e¡_wr™eRunLev–_CABAC
(
cu¼MB
, 
Ëv–D©a
, 
Ëv–T»Îis
, 
ty³
, 
Ïmbda_md
, 
kS¹
, 
kStÝ
, 
noCÛff
, 
e¡B™s
);

	@lencod/src/ratectl.c

19 
	~<m©h.h
>

20 
	~<lim™s.h
>

22 
	~"glob®.h
"

23 
	~"¿‹ùl.h
"

32 
	$rc_¡Üe_mad
(
Maüoblock
 *
cu¼MB
)

34 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

35 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

36 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

38 
p_g’
->
MADofMB
[
cu¼MB
->
mbAddrX
] = 
	`Compu‹MBMAD
(cu¼MB->
p_Sliû
->
diffy
);

40 if(
p_IÅ
->
basicun™
 < 
p_Vid
->
F¿meSizeInMbs
)

42 
p_g’
->
TÙ®MADBasicUn™
 +ðp_g’->
MADofMB
[
cu¼MB
->
mbAddrX
];

44 
	}
}

53 
	$QP2Q¡•
Ð
QP
 )

55 
i
;

56 
Q¡•
;

57 cÚ¡ 
QP2QSTEP
[6] = { 0.625, 0.6875, 0.8125, 0.875, 1.0, 1.125 };

59 
Q¡•
 = 
QP2QSTEP
[
QP
 % 6];

60  
i
=0; i<(
QP
/6); i++)

61 
Q¡•
 *= 2;

63  
Q¡•
;

64 
	}
}

74 
	$Q¡•2QP
Ð
Q¡•
, 
qp_off£t
 )

76 
q_³r
 = 0, 
q_»m
 = 0;

78 ifÐ
Q¡•
 < 
	`QP2Q¡•
(
MIN_QP
))

79  
MIN_QP
;

80 ià(
Q¡•
 > 
	`QP2Q¡•
(
MAX_QP
 + 
qp_off£t
) )

81  (
MAX_QP
 + 
qp_off£t
);

83  
Q¡•
 > 
	`QP2Q¡•
(5) )

85 
Q¡•
 /= 2.0;

86 
q_³r
++;

89 ià(
Q¡•
 <= 0.65625)

92 
q_»m
 = 0;

94 ià(
Q¡•
 <= 0.75)

97 
q_»m
 = 1;

99 ià(
Q¡•
 <= 0.84375)

102 
q_»m
 = 2;

104 ià(
Q¡•
 <= 0.9375)

107 
q_»m
 = 3;

109 ià(
Q¡•
 <= 1.0625)

112 
q_»m
 = 4;

117 
q_»m
 = 5;

120  (
q_³r
 * 6 + 
q_»m
);

121 
	}
}

133 
	$Compu‹MBMAD
(
diffy
[16][16])

135 
k
, 
l
, 
sum
 = 0;

137 
k
 = 0; k < 16; k++)

138 
l
 = 0;† < 16;†++)

139 
sum
 +ð
	`Ÿbs
(
diffy
[
k
][
l
]);

141  
sum
;

142 
	}
}

151 
	$Compu‹F¿meMAD
(
VideoP¬am‘”s
 *
p_Vid
)

153 
št64
 
TÙ®MAD
 = 0;

154 
i
;

155 
i
 = 0; i < 
p_Vid
->
F¿meSizeInMbs
; i++)

156 
TÙ®MAD
 +ð
p_Vid
->
p_rc_g’
->
MADofMB
[
i
];

157  ()
TÙ®MAD
 / (256.0 * ()
p_Vid
->
F¿meSizeInMbs
);

158 
	}
}

168 
	$rc_cÝy_g’”ic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
RCG’”ic
 *
d¡
, RCG’”iø*
¤c
 )

171 *
tmpMADofMB
 = 
d¡
->
MADofMB
;

176 
	`memýy
Ð(*)
d¡
, (*)
¤c
, (
RCG’”ic
) );

179 
d¡
->
MADofMB
 = 
tmpMADofMB
;

182 
	`memýy
Ð(*)
d¡
->
MADofMB
, (*)
¤c
->MADofMB, 
p_Vid
->
F¿meSizeInMbs
 *  () );

183 
	}
}

192 
	$rc_®loc_g’”ic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
RCG’”ic
 **
p_quad
 )

194 *
p_quad
 = (
RCG’”ic
 *è
	`m®loc
 ( ( RCGeneric ) );

195 ià(
NULL
 =ð*
p_quad
)

197 
	`no_mem_ex™
("rc_alloc_generic:„c_alloc_generic");

199 (*
p_quad
)->
MADofMB
 = (*è
	`ÿÎoc
 (
p_Vid
->
F¿meSizeInMbs
,  ());

200 ià(
NULL
 =ð(*
p_quad
)->
MADofMB
)

202 
	`no_mem_ex™
("rc_alloc_generic: (*p_quad)->MADofMB");

204 (*
p_quad
)->
F›ldF¿me
 = 1;

205 
	}
}

215 
	$rc_ä“_g’”ic
(
RCG’”ic
 **
p_quad
)

217 ià(
NULL
!=(*
p_quad
)->
MADofMB
)

219 
	`ä“
 ((*
p_quad
)->
MADofMB
);

220 (*
p_quad
)->
MADofMB
 = 
NULL
;

222 ià(
NULL
!=(*
p_quad
))

224 
	`ä“
 ((*
p_quad
));

225 (*
p_quad
èð
NULL
;

227 
	}
}

236 
	$rc_š™_gÝ_·¿ms
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

238 
Å
, 
nb
;

239 
RCQuad¿tic
 *
p_quad
 = 
p_Vid
->
p_rc_quad
;

240 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

242  
p_IÅ
->
RCUpd©eMode
 )

244 
RC_MODE_1
:

245 
RC_MODE_3
:

246 iàÐ!(
p_Vid
->
cu¼_äm_idx
) )

249 
Å
 = (è(
p_IÅ
->
no_äames
 +…_IÅ->
Numb”BF¿mes
) / (1 +…_Inp->NumberBFrames) - 1 + 1;

251 
nb
 = 
Å
 * 
p_IÅ
->
Numb”BF¿mes
;

253 
	`rc_š™_GOP
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
Å
, 
nb
);

256 
RC_MODE_0
:

257 
RC_MODE_2
:

258 ià(
p_IÅ
->
idr_³riod
 == 0)

260 iàÐ!(
p_Vid
->
cu¼_äm_idx
) )

263 
Å
 = (è(
p_IÅ
->
no_äames
 +…_IÅ->
Numb”BF¿mes
) / (1 +…_Inp->NumberBFrames) - 1 + 1;

265 
nb
 = 
Å
 * 
p_IÅ
->
Numb”BF¿mes
;

266 
	`rc_š™_GOP
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
Å
, 
nb
);

269 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
idr_æag
 )

271 
M
 = 
p_IÅ
->
Numb”BF¿mes
 + 1;

272 
n
 = 
p_IÅ
->
idr_³riod
;

275 ià((
p_Vid
->
cu¼_äm_idx
 / 
p_IÅ
->
idr_³riod
è>ðÕ_IÅ->
no_äames
 /…_Inp->idr_period))

277 
n
 = 
p_IÅ
->
no_äames
 - 
p_Vid
->
cu¼_äm_idx
;

281 
Å
 = (
p_Vid
->
cu¼_äm_idx
 =ð0è? 1 + ((
n
 - 2è/ 
M
) : (n - 1) / M;

283 
nb
 = 
n
 - 
Å
 - 1;

284 
	`rc_š™_GOP
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
Å
, 
nb
);

290 
	}
}

300 
	$rc_š™_äame
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

302  
p_IÅ
->
RCUpd©eMode
 )

304 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

307 ifÐ(
p_IÅ
->
MbIÁ”Ïû
è&& (p_IÅ->
basicun™
 < 
p_Vid
->
F¿meSizeInMbs
è&& (p_Vid->
ty³
 =ð
P_SLICE
 || (p_IÅ->
RCUpd©eMode
 =ð
RC_MODE_1
 &&…_Vid->
numb”
) ) )

308 
p_Vid
->
BasicUn™
 = 
p_IÅ
->
basicun™
 << 1;

310 
p_Vid
->
BasicUn™
 = 
p_IÅ
->
basicun™
;

312 iàÐ
p_IÅ
->
RDPiùu»DecisiÚ
 )

314 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad_š™
,…_Vid->
p_rc_quad
 );

315 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’_š™
,…_Vid->
p_rc_g’
 );

317 
p_Vid
->
	`rc_š™_più_±r
Õ_Vid, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_g’
, 1,0,1, 1.0F);

319 ifÐ
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

320 
p_Vid
->
p_rc_g’
->
TÝF›ldFÏg
=0;

322 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ðp_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_g’
, 0è-…_Vid->p_rc_quad->
b™d•th_qp_sÿË
;

327 
	}
}

337 
	$rc_š™_£qu’û
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

339  
p_IÅ
->
RCUpd©eMode
 )

341 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

342 
	`rc_š™_£q
(
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_g’
);

347 
	}
}

349 
	$rc_¡Üe_¦iû_h—d”_b™s
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
Ën
 )

351 
p_IÅ
->
RCUpd©eMode
)

353 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

354 
p_Vid
->
p_rc_g’
->
Numb”ofH—d”B™s
 +=
Ën
;

357 if(
p_Vid
->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
)

358 
p_Vid
->
p_rc_g’
->
Numb”ofBasicUn™H—d”B™s
 +=
Ën
;

363 
	}
}

372 
	$rc_¡Üe_diff
(
diffy
[16][16], 
img³l
 **
p_curImg
, 
ýix_x
,img³È**
´ediùiÚ
)

374 
i
, 
j
;

375 *
iD¡
;

376 
img³l
 *
Src1
, *
Src2
;

378 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

380 
iD¡
 = 
diffy
[
j
];

381 
Src1
 = &
p_curImg
[
j
][
ýix_x
];

382 
Src2
 = 
´ediùiÚ
[
j
];

383 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

385 
iD¡
[
i
] = 
Src1
[i] - 
Src2
[i];

388 
	}
}

390 
	$rc_¡Üe_diff_16b
(
diffy
[16][16], 
img³l
 **
p_curImg
, 
ýix_x
,img³È**
´ediùiÚ
)

392 
i
, 
j
;

393 *
iD¡
;

394 
ušt16
 *
Src1
, *
Src2
;

396 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

398 
iD¡
 = 
diffy
[
j
];

399 
Src1
 = (
ušt16
*)(
p_curImg
[
j
]è+
ýix_x
;

400 
Src2
 = (
ušt16
*)(
´ediùiÚ
[
j
]);

401 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

403 
iD¡
[
i
] = 
Src1
[i] - 
Src2
[i];

406 
	}
}

	@lencod/src/rc_quadratic.c

20 
	~<m©h.h
>

21 
	~<lim™s.h
>

23 
	~"glob®.h
"

24 
	~"¿‹ùl.h
"

27 cÚ¡ 
	gTHETA
 = 1.3636F;

28 cÚ¡ 
	gOMEGA
 = 0.9F;

29 cÚ¡ 
	gMINVALUE
 = 4.0F;

37 
	$rc_®loc_quad¿tic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 **
p_quad
 )

39 
rcBufSize
 = 
p_Vid
->
F¿meSizeInMbs
 / 
p_IÅ
->
basicun™
;

41 
RCQuad¿tic
 *
Írc
;

43 (*
p_quad
èð(
RCQuad¿tic
 *è
	`m®loc
 ( ( RCQuadratic ) );

44 ià(
NULL
==(*
p_quad
))

46 
	`no_mem_ex™
("rc_alloc_quadratic: (*p_quad)");

48 
Írc
 = *
p_quad
;

50 
Írc
->
P»viousF¿meMAD
 = 1.0;

51 
Írc
->
Cu¼’tF¿meMAD
 = 1.0;

52 
Írc
->
P´ev_b™s
 = 0;

53 
Írc
->
T¬g‘
 = 0;

54 
Írc
->
T¬g‘F›ld
 = 0;

55 
Írc
->
Low”Bound
 = 0;

56 
Írc
->
Uµ”Bound1
 = 
INT_MAX
;

57 
Írc
->
Uµ”Bound2
 = 
INT_MAX
;

58 
Írc
->
Wp
 = 0.0;

59 
Írc
->
Wb
 = 0.0;

60 
Írc
->
AveWb
 = 0.0;

61 
Írc
->
PAveF¿meQP
 = 
p_IÅ
->
qp
[
I_SLICE
] + 
p_Vid
->
b™d•th_luma_qp_sÿË
;

62 
Írc
->
m_Qc
 =†´c->
PAveF¿meQP
;

63 
Írc
->
F›ldQPBufãr
 =†´c->
PAveF¿meQP
;

64 
Írc
->
F¿meQPBufãr
 =†´c->
PAveF¿meQP
;

65 
Írc
->
PAv”ageQp
 =†´c->
PAveF¿meQP
;

66 
Írc
->
MyIn™ŸlQp
 =†´c->
PAveF¿meQP
;

67 
Írc
->
AveWb
 = 0.0;

69 
Írc
->
BUPFMAD
 = (*è
	`ÿÎoc
 ((
rcBufSize
),  ());

70 ià(
NULL
==
Írc
->
BUPFMAD
)

72 
	`no_mem_ex™
("rc_alloc_quadratic:†prc->BUPFMAD");

75 
Írc
->
BUCFMAD
 = (*è
	`ÿÎoc
 ((
rcBufSize
),  ());

76 ià(
NULL
==
Írc
->
BUCFMAD
)

78 
	`no_mem_ex™
("rc_alloc_quadratic:†prc->BUCFMAD");

81 
Írc
->
FCBUCFMAD
 = (*è
	`ÿÎoc
 ((
rcBufSize
),  ());

82 ià(
NULL
==
Írc
->
FCBUCFMAD
)

84 
	`no_mem_ex™
("rc_alloc_quadratic:†prc->FCBUCFMAD");

87 
Írc
->
FCBUPFMAD
 = (*è
	`ÿÎoc
 ((
rcBufSize
),  ());

88 ià(
NULL
==
Írc
->
FCBUPFMAD
)

90 
	`no_mem_ex™
("rc_alloc_quadratic:†prc->FCBUPFMAD");

92 
	}
}

101 
	$rc_cÝy_quad¿tic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
d¡
, RCQuad¿tiø*
¤c
 )

103 
rcBufSize
 = 
p_Vid
->
F¿meSizeInMbs
 / 
p_IÅ
->
basicun™
;

105 *
tmpBUPFMAD
 = 
d¡
->
BUPFMAD
;

106 *
tmpBUCFMAD
 = 
d¡
->
BUCFMAD
;

107 *
tmpFCBUPFMAD
 = 
d¡
->
FCBUPFMAD
;

108 *
tmpFCBUCFMAD
 = 
d¡
->
FCBUCFMAD
;

111 
	`memýy
Ð(*)
d¡
, (*)
¤c
, (
RCQuad¿tic
) );

114 
d¡
->
BUPFMAD
 = 
tmpBUPFMAD
;

115 
d¡
->
BUCFMAD
 = 
tmpBUCFMAD
;

116 
d¡
->
FCBUPFMAD
 = 
tmpFCBUPFMAD
;

117 
d¡
->
FCBUCFMAD
 = 
tmpFCBUCFMAD
;

120 
	`memýy
Ð(*)
d¡
->
BUPFMAD
, (*)
¤c
->BUPFMAD, (
rcBufSize
) *  () );

121 
	`memýy
Ð(*)
d¡
->
BUCFMAD
, (*)
¤c
->BUCFMAD, (
rcBufSize
) *  () );

122 
	`memýy
Ð(*)
d¡
->
FCBUPFMAD
, (*)
¤c
->FCBUPFMAD, (
rcBufSize
) *  () );

123 
	`memýy
Ð(*)
d¡
->
FCBUCFMAD
, (*)
¤c
->FCBUCFMAD, (
rcBufSize
) *  () );

124 
	}
}

133 
	$rc_ä“_quad¿tic
(
RCQuad¿tic
 **
p_quad
)

135 ià(
NULL
!=(*
p_quad
)->
BUPFMAD
)

137 
	`ä“
 ((*
p_quad
)->
BUPFMAD
);

138 (*
p_quad
)->
BUPFMAD
 = 
NULL
;

140 ià(
NULL
!=(*
p_quad
)->
BUCFMAD
)

142 
	`ä“
 ((*
p_quad
)->
BUCFMAD
);

143 (*
p_quad
)->
BUCFMAD
 = 
NULL
;

145 ià(
NULL
!=(*
p_quad
)->
FCBUCFMAD
)

147 
	`ä“
 ((*
p_quad
)->
FCBUCFMAD
);

148 (*
p_quad
)->
FCBUCFMAD
 = 
NULL
;

150 ià(
NULL
!=(*
p_quad
)->
FCBUPFMAD
)

152 
	`ä“
 ((*
p_quad
)->
FCBUPFMAD
);

153 (*
p_quad
)->
FCBUPFMAD
 = 
NULL
;

155 ià(
NULL
!=(*
p_quad
))

157 
	`ä“
 ((*
p_quad
));

158 (*
p_quad
èð
NULL
;

160 
	}
}

170 
	$rc_š™_£q
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
)

172 
L1
,
L2
,
L3
,
bµ
;

173 
qp
, 
i
;

175  
p_IÅ
->
RCUpd©eMode
 )

177 
RC_MODE_0
:

178 
p_Vid
->
upd©eQP
 = 
upd©eQPRC0
;

180 
RC_MODE_1
:

181 
p_Vid
->
upd©eQP
 = 
upd©eQPRC1
;

183 
RC_MODE_2
:

184 
p_Vid
->
upd©eQP
 = 
upd©eQPRC2
;

186 
RC_MODE_3
:

187 
p_Vid
->
upd©eQP
 = 
upd©eQPRC3
;

190 
p_Vid
->
upd©eQP
 = 
upd©eQPRC0
;

194 
p_Vid
->
rc_upd©e_più_äame_±r
 = 
rc_upd©e_più_äame
;

195 
p_Vid
->
rc_upd©e_piùu»_±r
 = 
rc_upd©e_piùu»
;

196 
p_Vid
->
rc_š™_più_±r
 = 
rc_š™_più
;

198 
p_quad
->
Xp
=0;

199 
p_quad
->
Xb
=0;

201 
p_quad
->
b™_¿‹
 = (è
p_IÅ
->bit_rate;

202 
p_quad
->
äame_¿‹
 = 
p_Vid
->
äam”©e
;

203 
p_quad
->
P»vB™R©e
 =…_quad->
b™_¿‹
;

206 if(
p_IÅ
->
basicun™
 > 
p_Vid
->
F¿meSizeInMbs
)

207 
p_IÅ
->
basicun™
 = 
p_Vid
->
F¿meSizeInMbs
;

208 if(
p_IÅ
->
basicun™
 < 
p_Vid
->
F¿meSizeInMbs
)

209 
p_quad
->
TÙ®Numb”ofBasicUn™
 = 
p_Vid
->
F¿meSizeInMbs
/
p_IÅ
->
basicun™
;

211 
p_quad
->
TÙ®Numb”ofBasicUn™
 = 1;

214 
p_g’
->
Cu¼’tBufãrFuÎÃss
 = 0;

215 
p_quad
->
GOPT¬g‘BufãrLev–
 = (è
p_g’
->
Cu¼’tBufãrFuÎÃss
;

218 
p_quad
->
m_wšdowSize
 = 0;

219 
p_quad
->
MADm_wšdowSize
 = 0;

220 
p_g’
->
Numb”ofCodedBF¿me
 = 0;

221 
p_quad
->
Numb”ofCodedPF¿me
 = 0;

222 
p_g’
->
Numb”ofGOP
 = 0;

224 
p_g’
->
RemaššgB™s
 = 0;

226 if(
p_IÅ
->
Numb”BF¿mes
>0)

228 
p_quad
->
GAMMAP
=0.25;

229 
p_quad
->
BETAP
=0.9;

233 
p_quad
->
GAMMAP
=0.5;

234 
p_quad
->
BETAP
=0.5;

238 
p_quad
->
PP»H—d”
=0;

240 
p_quad
->
Pm_X1
 =…_quad->
b™_¿‹
 * 1.0;

241 
p_quad
->
Pm_X2
 = 0.0;

243 
p_quad
->
PMADPiùu»C1
 = 1.0;

244 
p_quad
->
PMADPiùu»C2
 = 0.0;

247 
i
=0;i<21;i++)

249 
p_quad
->
Pm_rgQp
[
i
] = 0;

250 
p_quad
->
Pm_rgRp
[
i
] = 0.0;

251 
p_quad
->
PPiùu»MAD
[
i
] = 0.0;

255 
p_quad
->
PMaxQpChªge
 = 
p_IÅ
->
RCMaxQPChªge
;

258 
p_quad
->
PAveH—d”B™s1
 = 0;

259 
p_quad
->
PAveH—d”B™s3
 = 0;

260 
p_quad
->
DDquªt
 = (p_quad->
TÙ®Numb”ofBasicUn™
>=9 ? 1 : 2);

262 
p_quad
->
MBP”Row
 = 
p_Vid
->
PicWidthInMbs
;

265 
p_g’
->
F›ldCÚŒÞ
=0;

267 ià(
p_IÅ
->
Seš™ŸlQP
==0)

270 
bµ
 = 1.0*
p_quad
->
b™_¿‹
 /Õ_quad->
äame_¿‹
*
p_Vid
->
size
);

272 ià(
p_Vid
->
width
 == 176)

274 
L1
 = 0.1;

275 
L2
 = 0.3;

276 
L3
 = 0.6;

278 ià(
p_Vid
->
width
 == 352)

280 
L1
 = 0.2;

281 
L2
 = 0.6;

282 
L3
 = 1.2;

286 
L1
 = 0.6;

287 
L2
 = 1.4;

288 
L3
 = 2.4;

290 ià(
bµ
<ð
L1
)

291 
qp
 = 35;

292 if(
bµ
<=
L2
)

293 
qp
 = 25;

294 if(
bµ
<=
L3
)

295 
qp
 = 20;

297 
qp
 = 10;

298 
p_IÅ
->
Seš™ŸlQP
 = 
qp
;

302 
p_quad
->
b™d•th_qp_sÿË
 = 
p_Vid
->
b™d•th_luma_qp_sÿË
;

303 
	}
}

312 
	$rc_š™_GOP
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
Å
, 
nb
)

315 
GOPDquªt
;

316 
št64
 
AÎoÿ‹dB™s
;

319  
p_IÅ
->
RCUpd©eMode
 )

321 
RC_MODE_3
:

323 
sum
 = 0, 
tmp
, 
Ëv–
, 
Ëv–s
 = 0, 
num_äames
[
RC_MAX_TEMPORAL_LEVELS
];

324 
num”
, 
d’om
;

325 
gÝ
 = 
p_IÅ
->
Numb”BF¿mes
 + 1;

326 
i_³riod
 = 
p_IÅ
->
šŒa_³riod
 =ð0 ?…_IÅ->
idr_³riod
 : (p_IÅ->idr_³riod =ð0 ?…_IÅ->šŒa_³riod : 
	`imš
(p_Inp->intra_period,…_Inp->idr_period) );

328 
	`mem£t
Ð
num_äames
, 0, 
RC_MAX_TEMPORAL_LEVELS
 * () );

330 iàÐ
p_IÅ
->
Numb”BF¿mes
 )

332 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 == 1 )

334 
Ëv–s
 = 2;

335 
num_äames
[0] = 
p_IÅ
->
Numb”BF¿mes
 >> 1;

336 
num_äames
[1] = (
p_IÅ
->
Numb”BF¿mes
 -‚um_frames[0]) >= 0 ? (p_Inp->NumberBFrames -‚um_frames[0]) : 0;

338 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 == 2 )

341 
tmp
 = 
gÝ
;

342  
tmp
 )

344 
sum
 +ð
tmp
 & 1;

345 
tmp
 >>= 1;

347 
	`as£¹
Ð
sum
 == 1 );

350 
Ëv–s
 = 0;

351 
tmp
 = 
gÝ
;

352  
tmp
 > 1 )

354 
tmp
 >>= 1;

355 
num_äames
[
Ëv–s
] = 1 <<†evels;

356 
Ëv–s
++;

358 
	`as£¹
Ð
Ëv–s
 >ð1 &&†ev– <ð
RC_MAX_TEMPORAL_LEVELS
 );

360 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 == 3 )

362 
	`årštf
(
¡d”r
, "\n RCUpdateMode=3‡nd HierarchicalCoding == 3‡re currently‚ot supported");

363 
	`ex™
(1);

367 
Ëv–s
 = 1;

368 
num_äames
[0] = 
p_IÅ
->
Numb”BF¿mes
;

370 
p_g’
->
‹mpÜ®_Ëv–s
 = 
Ëv–s
;

374  
Ëv–
 = 0;†ev– < 
RC_MAX_TEMPORAL_LEVELS
;†evel++ )

376 
p_IÅ
->
RCBSliûB™R©io
[
Ëv–
] = 0.0F;

378 
p_g’
->
‹mpÜ®_Ëv–s
 = 0;

381 
num”
 = ()(Ð(!
i_³riod
 ? 1 : i_³riodè* 
gÝ
è* (()
p_IÅ
->
b™_¿‹
 /…_IÅ->
sourû
.
äame_¿‹
));

382 
d’om
 = 0.0F;

384  
Ëv–
 = 0;†ev– < 
Ëv–s
;†evel++ )

386 
d’om
 +ð()(
num_äames
[
Ëv–
] * 
p_IÅ
->
RCBSliûB™R©io
[level]);

387 
p_g’
->
h›rNb
[
Ëv–
] = 
num_äames
[Ëv–] * 
Å
;

389 
d’om
 += 1.0F;

390 iàÐ
i_³riod
 >= 1 )

392 
d’om
 *ð()
i_³riod
;

393 
d’om
 +ð()
p_IÅ
->
RCISliûB™R©io
 - 1.0F;

397 
p_g’
->
RCPSliûB™s
 = (è
	`æoÜ
Ð
num”
 / 
d’om
 + 0.5F );

398 
p_g’
->
RCISliûB™s
 = 
i_³riod
 ? ()(
p_IÅ
->
RCISliûB™R©io
 *…_g’->
RCPSliûB™s
 + 0.5) : 0;

400  
Ëv–
 = 0;†ev– < 
Ëv–s
;†evel++ )

402 
p_g’
->
RCBSliûB™s
[
Ëv–
] = ()
	`æoÜ
(
p_IÅ
->
RCBSliûB™R©io
[Ëv–] *…_g’->
RCPSliûB™s
 + 0.5);

405 
p_g’
->
NISliû
 = 
i_³riod
 ? ( 
p_IÅ
->
no_äames
 / i_period ) : 0;

406 
p_g’
->
NPSliû
 = (
p_IÅ
->
no_äames
 / (1 +…_IÅ->
Numb”BF¿mes
)è-…_g’->
NISliû
;

419 
p_quad
->
Low”Bound
 = ()(
p_g’
->
RemaššgB™s
 +…_quad->
b™_¿‹
 /…_quad->
äame_¿‹
);

420 
p_quad
->
Uµ”Bound1
 = ()(
p_g’
->
RemaššgB™s
 + (p_quad->
b™_¿‹
 * 2.048));

423 
AÎoÿ‹dB™s
 = (
št64
è
	`æoÜ
((1 + 
Å
 + 
nb
è* 
p_quad
->
b™_¿‹
 /…_quad->
äame_¿‹
 + 0.5);

424 
p_g’
->
RemaššgB™s
 +ð
AÎoÿ‹dB™s
;

425 
p_quad
->
Np
 = 
Å
;

426 
p_quad
->
Nb
 = 
nb
;

428 
p_quad
->
GOPOv”due
=
FALSE
;

432 iàÐ!
p_IÅ
->
PicIÁ”Ïû
 &&…_IÅ->
MbIÁ”Ïû
 &&…_IÅ->
basicun™
 =ð
p_Vid
->
F¿meSizeInMbs
 )

433 
p_g’
->
NoG¿nuÏrF›ldRC
 = 0;

435 
p_g’
->
NoG¿nuÏrF›ldRC
 = 1;

438 
p_quad
->
TÙ®PF¿me
=
Å
;

439 
p_g’
->
Numb”ofGOP
++;

440 if(
p_g’
->
Numb”ofGOP
==1)

442 
p_quad
->
MyIn™ŸlQp
 = 
p_IÅ
->
Seš™ŸlQP
 +…_quad->
b™d•th_qp_sÿË
;

443 
p_quad
->
Cu¼La¡QP
 =…_quad->
MyIn™ŸlQp
 - 1;

444 
p_quad
->
QPLa¡GOP
 =…_quad->
MyIn™ŸlQp
;

446 
p_quad
->
PAveF¿meQP
 =…_quad->
MyIn™ŸlQp
;

447 
p_quad
->
m_Qc
 =…_quad->
PAveF¿meQP
;

448 
p_quad
->
F›ldQPBufãr
 =…_quad->
PAveF¿meQP
;

449 
p_quad
->
F¿meQPBufãr
 =…_quad->
PAveF¿meQP
;

450 
p_quad
->
PAv”ageQp
 =…_quad->
PAveF¿meQP
;

455 ifÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
MbIÁ”Ïû
 )

457 ià(
p_g’
->
F›ldF¿me
 == 1)

459 
p_quad
->
TÙ®QpfÜPPiùu»
 +ðp_quad->
F¿meQPBufãr
;

460 
p_quad
->
QPLa¡PF¿me
 =…_quad->
F¿meQPBufãr
;

464 
p_quad
->
TÙ®QpfÜPPiùu»
 +ðp_quad->
F›ldQPBufãr
;

465 
p_quad
->
QPLa¡PF¿me
 =…_quad->
F›ldQPBufãr
;

469 
p_quad
->
PAv”ageQp
=()(1.0 *…_quad->
TÙ®QpfÜPPiùu»
 /…_quad->
Numb”ofPPiùu»
+0.5);

471 
GOPDquªt
=()((1.0*(
Å
+
nb
+1)/15.0) + 0.5);

472 if(
GOPDquªt
>2)

473 
GOPDquªt
=2;

475 
p_quad
->
PAv”ageQp
 -ð
GOPDquªt
;

477 ià(
p_quad
->
PAv”ageQp
 > (p_quad->
QPLa¡PF¿me
 - 2))

478 
p_quad
->
PAv”ageQp
--;

481 
p_quad
->
PAv”ageQp
 = 
	`iCl3
Õ_quad->
QPLa¡GOP
 - 2,…_quad->QPLastGOP + 2,…_quad->PAverageQp);

483 
p_quad
->
PAv”ageQp
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->PAverageQp);

485 
p_quad
->
MyIn™ŸlQp
 =…_quad->
PAv”ageQp
;

486 
p_quad
->
Pm_Qp
 =…_quad->
PAv”ageQp
;

487 
p_quad
->
PAveF¿meQP
 =…_quad->
PAv”ageQp
;

488 
p_quad
->
QPLa¡GOP
 =…_quad->
MyIn™ŸlQp
;

489 
p_quad
->
P»vLa¡QP
 =…_quad->
Cu¼La¡QP
;

490 
p_quad
->
Cu¼La¡QP
 =…_quad->
MyIn™ŸlQp
 - 1;

493 
p_quad
->
TÙ®QpfÜPPiùu»
=0;

494 
p_quad
->
Numb”ofPPiùu»
=0;

495 
p_quad
->
Numb”ofBF¿mes
=0;

496 
	}
}

506 
	$rc_š™_più
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
f›ldpic
,
tÝf›ld
,
rg‘computiÚ
, 
muÉ
)

508 
tmp_T
;

511 if(
p_IÅ
->
MbIÁ”Ïû
)

512 
p_quad
->
TÙ®Numb”ofBasicUn™
 = 
p_Vid
->
F¿meSizeInMbs
 /…_Vid->
BasicUn™
;

514 
p_quad
->
TÙ®Numb”ofBasicUn™
 = 
p_Vid
->
F¿meSizeInMbs
 / 
p_IÅ
->
basicun™
;

516 
p_Vid
->
Numb”ofCodedMaüoBlocks
 = 0;

521 if(
p_IÅ
->
chªÃl_ty³
==1)

523 if(
p_quad
->
Numb”ofCodedPF¿me
==58)

524 
p_quad
->
b™_¿‹
 *= 1.5;

525 if(
p_quad
->
Numb”ofCodedPF¿me
==59)

526 
p_quad
->
P»vB™R©e
 =…_quad->
b™_¿‹
;

530 if((
f›ldpic
||
tÝf›ld
è&& 
rg‘computiÚ
)

532 iàÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 !=0)) )

536 if(
p_quad
->
P»vB™R©e
!õ_quad->
b™_¿‹
)

537 
p_g’
->
RemaššgB™s
 +=(è
	`æoÜ
((
p_quad
->
b™_¿‹
-p_quad->
P»vB™R©e
)*Õ_quad->
Np
 +…_quad->
Nb
)/p_quad->
äame_¿‹
+0.5);

541 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

543 if(
p_quad
->
Numb”ofPPiùu»
==1)

545 
p_quad
->
T¬g‘BufãrLev–
 = (è
p_g’
->
Cu¼’tBufãrFuÎÃss
;

546 
p_quad
->
D–P
 = (
p_g’
->
Cu¼’tBufãrFuÎÃss
 -…_quad->
GOPT¬g‘BufãrLev–
è/ (p_quad->
TÙ®PF¿me
-1);

547 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

549 if(
p_quad
->
Numb”ofPPiùu»
>1)

550 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

555 if(
p_quad
->
Numb”ofCodedPF¿me
>0)

558 if(((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))&&(
p_g’
->
F›ldCÚŒÞ
==1))

559 
	`memýy
((*)
p_quad
->
FCBUPFMAD
,(*í_quad->
FCBUCFMAD
,…_quad->
TÙ®Numb”ofBasicUn™
 * ());

561 
	`memýy
((*)
p_quad
->
BUPFMAD
,(*í_quad->
BUCFMAD
,…_quad->
TÙ®Numb”ofBasicUn™
 * ());

564 if(
p_g’
->
Numb”ofGOP
==1)

566 if(
p_quad
->
Numb”ofPPiùu»
==1)

568 
p_quad
->
T¬g‘BufãrLev–
 = (è
p_g’
->
Cu¼’tBufãrFuÎÃss
;

569 
p_quad
->
D–P
 = (
p_g’
->
Cu¼’tBufãrFuÎÃss
 -…_quad->
GOPT¬g‘BufãrLev–
)/Õ_quad->
TÙ®PF¿me
 - 1);

570 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

572 if(
p_quad
->
Numb”ofPPiùu»
>1)

573 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

575 if(
p_g’
->
Numb”ofGOP
>1)

577 if(
p_quad
->
Numb”ofPPiùu»
==0)

579 
p_quad
->
T¬g‘BufãrLev–
 = (è
p_g’
->
Cu¼’tBufãrFuÎÃss
;

580 
p_quad
->
D–P
 = (
p_g’
->
Cu¼’tBufãrFuÎÃss
 -…_quad->
GOPT¬g‘BufãrLev–
è/…_quad->
TÙ®PF¿me
;

581 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

583 if(
p_quad
->
Numb”ofPPiùu»
>0)

584 
p_quad
->
T¬g‘BufãrLev–
 -ðp_quad->
D–P
;

588 if(
p_quad
->
Numb”ofCodedPF¿me
==1)

589 
p_quad
->
AveWp
 =…_quad->
Wp
;

591 if((
p_quad
->
Numb”ofCodedPF¿me
<8)&&(p_quad->NumberofCodedPFrame>1))

592 
p_quad
->
AveWp
 = (p_quad->AveW°+…_quad->
Wp
 * (p_quad->
Numb”ofCodedPF¿me
-1))/p_quad->NumberofCodedPFrame;

593 if(
p_quad
->
Numb”ofCodedPF¿me
>1)

594 
p_quad
->
AveWp
 = (p_quad->
Wp
 + 7 *…_quad->AveWp) / 8;

597 if(
p_IÅ
->
Numb”BF¿mes
>0)

600 
p_quad
->
T¬g‘BufãrLev–
 +ðÕ_quad->
AveWp
 * (
p_IÅ
->
Numb”BF¿mes
 + 1)*p_quad->
b™_¿‹
\

601 /(
p_quad
->
äame_¿‹
*Õ_quad->
AveWp
+p_quad->
AveWb
*
p_IÅ
->
Numb”BF¿mes
))-p_quad->
b™_¿‹
/p_quad->frame_rate);

604 iàÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

607 if(
p_quad
->
P»vB™R©e
 !ðp_quad->
b™_¿‹
)

608 
p_g’
->
RemaššgB™s
 +=(è
	`æoÜ
((
p_quad
->
b™_¿‹
-p_quad->
P»vB™R©e
è* (p_quad->
Np
 +…_quad->
Nb
è/…_quad->
äame_¿‹
+0.5);

609 if(
p_g’
->
Numb”ofCodedBF¿me
 == 1)

611 if(
p_quad
->
Numb”ofCodedPF¿me
 == 1)

613 
p_quad
->
AveWp
 =…_quad->
Wp
;

615 
p_quad
->
AveWb
 =…_quad->
Wb
;

617 if(
p_g’
->
Numb”ofCodedBF¿me
 > 1)

620 if(
p_g’
->
Numb”ofCodedBF¿me
<8)

621 
p_quad
->
AveWb
 = (p_quad->AveWb +…_quad->
Wb
*(
p_g’
->
Numb”ofCodedBF¿me
-1)) /…_gen->NumberofCodedBFrame;

623 
p_quad
->
AveWb
 = (p_quad->
Wb
 + 7 *…_quad->AveWb) / 8;

627 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || ( (p_Vid->
numb”
 !ð0è&& (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 ||…_IÅ->RCUpd©eMod=ð
RC_MODE_3
 ) ) )

630 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_3
) )

632 if(
p_quad
->
Numb”ofCodedPF¿me
>0)

634 ià(
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_3
)

636 
Ëv–_idx
 = (
p_Vid
->
ty³
 =ð
B_SLICE
 && 
p_IÅ
->
H›¿rchiÿlCodšg
è? (p_Vid->
p_cu¼_äm_¡ruù
->
Ïy”
 - 1) : 0;

637 
b™¿‹
 = (
p_Vid
->
ty³
 =ð
B_SLICE
è? 
p_g’
->
RCBSliûB™s
[ 
Ëv–_idx
 ]

638 : ( 
p_Vid
->
ty³
 =ð
P_SLICE
 ? 
p_g’
->
RCPSliûB™s
 :…_g’->
RCISliûB™s
 );

639 
Ëv–
, 
d’om
 = 
p_g’
->
NISliû
 *…_g’->
RCISliûB™s
 +…_g’->
NPSliû
 *…_g’->
RCPSliûB™s
;

641 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 )

643  
Ëv–
 = 0;†ev– < 
p_g’
->
‹mpÜ®_Ëv–s
;†evel++ )

644 
d’om
 +ð
p_g’
->
h›rNb
[ 
Ëv–
 ] *…_g’->
RCBSliûB™s
[†evel ];

648 
d’om
 +ð
p_g’
->
h›rNb
[0] *…_g’->
RCBSliûB™s
[0];

651 
p_quad
->
T¬g‘
 = (è
	`æoÜ
Ð()(1.0 * 
b™¿‹
 * 
p_g’
->
RemaššgB™s
è/ ()
d’om
 + 0.5F );

653 
tmp_T
 = 
	`imax
(0, (è
	`æoÜ
Ð()
b™¿‹
 - 
p_quad
->
GAMMAP
 * (
p_g’
->
Cu¼’tBufãrFuÎÃss
-p_quad->
T¬g‘BufãrLev–
) + 0.5) );

656  
p_Vid
->
ty³
 )

658 
B_SLICE
:

659 
p_quad
->
T¬g‘
 = (è
	`æoÜ
Ð(í_quad->T¬g‘ / 
p_IÅ
->
RCBov”PR©io
 + 0.5F);

661 
I_SLICE
:

662 
p_quad
->
T¬g‘
 = (è
	`æoÜ
Ð(í_quad->T¬g‘ / (
p_IÅ
->
RCIov”PR©io
 * 4.0) + 0.5F);

664 
P_SLICE
:

671 
p_quad
->
T¬g‘
 = (è
	`æoÜ
Ðp_quad->
Wp
 * 
p_g’
->
RemaššgB™s
 / (p_quad->
Np
 *…_quad->W°+…_quad->
Nb
 *…_quad->
Wb
) + 0.5);

672 
tmp_T
 = 
	`imax
(0, (è
	`æoÜ
(
p_quad
->
b™_¿‹
 /…_quad->
äame_¿‹
 -…_quad->
GAMMAP
 * (
p_g’
->
Cu¼’tBufãrFuÎÃss
-p_quad->
T¬g‘BufãrLev–
) + 0.5));

673 
p_quad
->
T¬g‘
 = (è
	`æoÜ
Õ_quad->
BETAP
 * (p_quad->T¬g‘ - 
tmp_T
) +mp_T + 0.5);

680 if(((
p_g’
->
Numb”ofGOP
 =ð1)&&(
p_quad
->
Numb”ofCodedPF¿me
>0))

681 || (
p_g’
->
Numb”ofGOP
 > 1))

683 
p_quad
->
T¬g‘
 = (è(
	`æoÜ
Ðp_quad->
Wp
 * 
p_g’
->
RemaššgB™s
 / (p_quad->
Np
 *…_quad->W°+…_quad->
Nb
 *…_quad->
Wb
) + 0.5));

684 
tmp_T
 = 
	`imax
(0, (è(
	`æoÜ
(
p_quad
->
b™_¿‹
 /…_quad->
äame_¿‹
 -…_quad->
GAMMAP
 * (
p_g’
->
Cu¼’tBufãrFuÎÃss
-p_quad->
T¬g‘BufãrLev–
) + 0.5)));

685 
p_quad
->
T¬g‘
 = (è(
	`æoÜ
Õ_quad->
BETAP
 * (p_quad->T¬g‘ - 
tmp_T
) +mp_T + 0.5));

688 
p_quad
->
T¬g‘
 = ()(
muÉ
 *…_quad->Target);

691 iàÐ
p_IÅ
->
RCUpd©eMode
 !ð
RC_MODE_3
 || 
p_Vid
->
ty³
 =ð
P_SLICE
 )

692 
p_quad
->
T¬g‘
 = 
	`iCl3
Õ_quad->
Low”Bound
,…_quad->
Uµ”Bound2
,…_quad->Target);

693 if((
tÝf›ld
è|| (
f›ldpic
 && ((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))))

694 
p_quad
->
T¬g‘F›ld
õ_quad->
T¬g‘
;

698 if(
f›ldpic
 || 
tÝf›ld
)

701 
p_g’
->
Numb”ofH—d”B™s
 = 0;

702 
p_g’
->
Numb”ofTextu»B™s
 = 0;

705 if(
p_Vid
->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
)

707 
p_quad
->
TÙ®F¿meQP
 = 0;

708 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 = 0;

709 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 = 0;

710 
p_g’
->
TÙ®MADBasicUn™
 = 0;

711 if(
p_g’
->
F›ldCÚŒÞ
==0)

712 
p_quad
->
Numb”ofBasicUn™
 =…_quad->
TÙ®Numb”ofBasicUn™
;

714 
p_quad
->
Numb”ofBasicUn™
 =…_quad->
TÙ®Numb”ofBasicUn™
 >> 1;

718 ifÐÐ
p_Vid
->
ty³
==
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 !ð0)èè&&…_Vid->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
 && 
p_g’
->
F›ldCÚŒÞ
 == 1 )

721 if(
tÝf›ld
)

723 
p_quad
->
b™s_tÝf›ld
=0;

724 
p_quad
->
T¬g‘
=()Õ_quad->
T¬g‘F›ld
*0.6);

729 
p_quad
->
T¬g‘
õ_quad->
T¬g‘F›ld
-p_quad->
b™s_tÝf›ld
;

730 
p_g’
->
Numb”ofBasicUn™H—d”B™s
=0;

731 
p_g’
->
Numb”ofBasicUn™Textu»B™s
=0;

732 
p_g’
->
TÙ®MADBasicUn™
=0;

733 
p_quad
->
Numb”ofBasicUn™
õ_quad->
TÙ®Numb”ofBasicUn™
 >> 1;

736 
	}
}

756 
	$rc_upd©e_più
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
nb™s
)

758 
d–_b™s
 = (
nb™s
 - ()
	`æoÜ
(
p_quad
->
b™_¿‹
 /…_quad->
äame_¿‹
 + 0.5F) );

760 
p_g’
->
RemaššgB™s
 -ð
nb™s
;

761 
p_g’
->
Cu¼’tBufãrFuÎÃss
 +ð
d–_b™s
;

764 
p_quad
->
Low”Bound
 -ð(è
d–_b™s
;

765 
p_quad
->
Uµ”Bound1
 -ð(è
d–_b™s
;

766 
p_quad
->
Uµ”Bound2
 = ()(
OMEGA
 *…_quad->
Uµ”Bound1
);

769 ifÐ
p_Vid
->
ty³
==
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 &&…_Vid->
cu¼_äm_idx
) )

771 
	`upd©eRCMod–
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
);

772 iàÐ
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_3
 )

773 
p_quad
->
P»viousWhÞeF¿meMAD
 = 
	`Compu‹F¿meMAD
(
p_Vid
);

775 
	}
}

792 
	$rc_upd©e_piùu»
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
b™s
 )

794 
	`rc_upd©e_più
(
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_g’
, 
b™s
);

795 
	}
}

797 
	$upd©eCom¶ex™y
Ð
VideoP¬am‘”s
 *
p_Vid
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
BoÞ—n
 
is_upd©ed
, 
nb™s
 )

799 
Avem_Qc
;

802 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

803  ((è
	`æoÜ
(
nb™s
 * 
p_quad
->
m_Qc
 + 0.5));

807 ifÐ
is_upd©ed
 )

809 ifÐ
p_g’
->
NoG¿nuÏrF›ldRC
 =ð0 ||…_g’->
F›ldCÚŒÞ
 == 0 )

811 
Avem_Qc
 = ()
p_quad
->
TÙ®F¿meQP
 / (í_quad->
TÙ®Numb”ofBasicUn™
;

812  (()
	`æoÜ
(
nb™s
 * 
Avem_Qc
 + 0.5));

815 ifÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

816  ((è
	`æoÜ
(
nb™s
 * 
p_quad
->
m_Qc
 + 0.5));

819 
	}
}

821 
	$upd©eP·¿ms
Ð
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
com¶ex™y
 )

823 
p_quad
->
Xp
 = 
com¶ex™y
;

824 
p_quad
->
Np
--;

825 
p_quad
->
Wp
 =…_quad->
Xp
;

826 
p_quad
->
Pm_Hp
 = 
p_g’
->
Numb”ofH—d”B™s
;

827 
p_quad
->
Numb”ofCodedPF¿me
++;

828 
p_quad
->
Numb”ofPPiùu»
++;

829 
	}
}

831 
	$upd©eB·¿ms
Ð
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
com¶ex™y
 )

833 
p_quad
->
Xb
 = 
com¶ex™y
;

834 
p_quad
->
Nb
--;

835 
p_quad
->
Wb
 =…_quad->
Xb
 / 
THETA
;

836 
p_quad
->
Numb”ofBF¿mes
++;

837 
p_g’
->
Numb”ofCodedBF¿me
++;

838 
	}
}

857 
	$rc_upd©e_più_äame
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
nb™s
)

860 
com¶ex™y
 = 0;

862  
p_IÅ
->
RCUpd©eMode
 )

864 
RC_MODE_0
:

865 
RC_MODE_2
:

867 
com¶ex™y
 = 
	`upd©eCom¶ex™y
Ð
p_Vid
, 
p_quad
, 
p_g’
, (
BoÞ—n
èÕ_Vid->
ty³
 =ð
P_SLICE
), 
nb™s
 );

868 iàÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

870 ifÐ
p_g’
->
NoG¿nuÏrF›ldRC
 =ð0 ||…_g’->
F›ldCÚŒÞ
 == 0 )

871 
	`upd©eP·¿ms
Ð
p_quad
, 
p_g’
, 
com¶ex™y
 );

873 
p_g’
->
NoG¿nuÏrF›ldRC
 = 0;

875 iàÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

876 
	`upd©eB·¿ms
Ð
p_quad
, 
p_g’
, 
com¶ex™y
 );

878 
RC_MODE_1
:

879 
com¶ex™y
 = 
	`upd©eCom¶ex™y
Ð
p_Vid
, 
p_quad
, 
p_g’
, (
BoÞ—n
èÕ_Vid->
numb”
 !ð0), 
nb™s
 );

880 iàÐ
p_Vid
->
numb”
 != 0 )

882 ifÐ
p_g’
->
NoG¿nuÏrF›ldRC
 =ð0 ||…_g’->
F›ldCÚŒÞ
 == 0 )

883 
	`upd©eP·¿ms
Ð
p_quad
, 
p_g’
, 
com¶ex™y
 );

885 
p_g’
->
NoG¿nuÏrF›ldRC
 = 0;

888 
RC_MODE_3
:

889 
com¶ex™y
 = 
	`upd©eCom¶ex™y
Ð
p_Vid
, 
p_quad
, 
p_g’
, (
BoÞ—n
èÕ_Vid->
ty³
 =ð
P_SLICE
), 
nb™s
 );

890 ià(
p_Vid
->
ty³
 =ð
I_SLICE
 && (p_Vid->
numb”
 != 0))

891 
p_g’
->
NISliû
--;

893 iàÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

895 ifÐ
p_g’
->
NoG¿nuÏrF›ldRC
 =ð0 ||…_g’->
F›ldCÚŒÞ
 == 0 )

897 
	`upd©eP·¿ms
Ð
p_quad
, 
p_g’
, 
com¶ex™y
 );

898 
p_g’
->
NPSliû
--;

901 
p_g’
->
NoG¿nuÏrF›ldRC
 = 0;

903 iàÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

905 
	`upd©eB·¿ms
Ð
p_quad
, 
p_g’
, 
com¶ex™y
 );

906 
p_g’
->
h›rNb
[ 
p_IÅ
->
H›¿rchiÿlCodšg
 ? (
p_Vid
->
p_cu¼_äm_¡ruù
->
Ïy”
 - 1) : 0 ]--;

910 
	}
}

920 
	$upd©eRCMod–
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
)

922 
n_wšdowSize
;

923 
i
;

924 
¡d
 = 0.0, 
th»shÞd
;

925 
m_Nc
 = 
p_quad
->
Numb”ofCodedPF¿me
;

926 
BoÞ—n
 
MADMod–FÏg
 = 
FALSE
;

927 
BoÞ—n
 
m_rgRejeùed
[
RC_MODEL_HISTORY
];

928 
”rÜ
 [
RC_MODEL_HISTORY
];

930 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 != 0)) )

933 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

935 
p_quad
->
Cu¼’tF¿meMAD
 = 
	`Compu‹F¿meMAD
(
p_Vid
);

936 
m_Nc
=
p_quad
->
Numb”ofCodedPF¿me
;

942 
p_quad
->
Cu¼’tF¿meMAD
 = (è((
p_g’
->
TÙ®MADBasicUn™
 >> 8)/
p_Vid
->
BasicUn™
);

943 
p_g’
->
TÙ®MADBasicUn™
=0;

946 
p_quad
->
CodedBasicUn™
õ_quad->
TÙ®Numb”ofBasicUn™
-p_quad->
Numb”ofBasicUn™
;

947 if(
p_quad
->
CodedBasicUn™
 > 0)

949 
p_quad
->
PAveH—d”B™s1
=()(()Õ_quad->PAveH—d”B™s1*Õ_quad->
CodedBasicUn™
-1)+

950 
p_g’
->
Numb”ofBasicUn™H—d”B™s
)/
p_quad
->
CodedBasicUn™
+0.5);

951 if(
p_quad
->
PAveH—d”B™s3
 == 0)

952 
p_quad
->
PAveH—d”B™s2
 =…_quad->
PAveH—d”B™s1
;

955 
p_quad
->
PAveH—d”B™s2
 = ()(()Õ_quad->
PAveH—d”B™s1
 *…_quad->
CodedBasicUn™
+

956 
p_quad
->
PAveH—d”B™s3
 *…_quad->
Numb”ofBasicUn™
)/p_quad->
TÙ®Numb”ofBasicUn™
+0.5);

960 ià((
p_quad
->
Numb”ofBasicUn™
 >ðp_quad->
TÙ®Numb”ofBasicUn™
) || (p_quad->NumberofBasicUnit<0))

962 
	`årštf
(
¡d”r
, "Write into invalid memory in updateRCModel‡t frame %d,…_quad->NumberofBasicUnit %d\n",

963 
p_Vid
->
äam•oc
, 
p_quad
->
Numb”ofBasicUn™
);

967 if(((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
MbIÁ”Ïû
)è&& (
p_g’
->
F›ldCÚŒÞ
 == 1))

968 
p_quad
->
FCBUCFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-1-p_quad->
Numb”ofBasicUn™
]õ_quad->
Cu¼’tF¿meMAD
;

970 
p_quad
->
BUCFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-1-p_quad->
Numb”ofBasicUn™
]õ_quad->
Cu¼’tF¿meMAD
;

972 if(
p_quad
->
Numb”ofBasicUn™
 != 0)

973 
m_Nc
 = 
p_quad
->
Numb”ofCodedPF¿me
 *…_quad->
TÙ®Numb”ofBasicUn™
 +…_quad->
CodedBasicUn™
;

975 
m_Nc
 = (
p_quad
->
Numb”ofCodedPF¿me
-1è*…_quad->
TÙ®Numb”ofBasicUn™
 +…_quad->
CodedBasicUn™
;

978 if(
m_Nc
 > 1)

979 
MADMod–FÏg
=
TRUE
;

981 
p_quad
->
PP»H—d”
 = 
p_g’
->
Numb”ofH—d”B™s
;

982 
i
 = (
RC_MODEL_HISTORY
-2); i > 0; i--)

984 
p_quad
->
Pm_rgQp
[
i
] =…_quad->Pm_rgQp[i - 1];

985 
p_quad
->
m_rgQp
[
i
] =…_quad->
Pm_rgQp
[i];

986 
p_quad
->
Pm_rgRp
[
i
] =…_quad->Pm_rgRp[i - 1];

987 
p_quad
->
m_rgRp
[
i
] =…_quad->
Pm_rgRp
[i];

989 
p_quad
->
Pm_rgQp
[0] = 
	`QP2Q¡•
Õ_quad->
m_Qc
);

991 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

992 
p_quad
->
Pm_rgRp
[0] = 
p_g’
->
Numb”ofTextu»B™s
*1.0/p_quad->
Cu¼’tF¿meMAD
;

995 
p_quad
->
Pm_rgRp
[0] = 
p_g’
->
Numb”ofBasicUn™Textu»B™s
*1.0/p_quad->
Cu¼’tF¿meMAD
;

997 
p_quad
->
m_rgQp
[0] =…_quad->
Pm_rgQp
[0];

998 
p_quad
->
m_rgRp
[0] =…_quad->
Pm_rgRp
[0];

999 
p_quad
->
m_X1
 =…_quad->
Pm_X1
;

1000 
p_quad
->
m_X2
 =…_quad->
Pm_X2
;

1003 
n_wšdowSize
 = (
p_quad
->
Cu¼’tF¿meMAD
>p_quad->
P»viousF¿meMAD
)

1004 ? ()(
p_quad
->
P»viousF¿meMAD
/p_quad->
Cu¼’tF¿meMAD
 * (
RC_MODEL_HISTORY
-1) )

1005 : ()(
p_quad
->
Cu¼’tF¿meMAD
/p_quad->
P»viousF¿meMAD
 *(
RC_MODEL_HISTORY
-1));

1006 
n_wšdowSize
=
	`iCl3
(1, 
m_Nc
,‚_windowSize);

1007 
n_wšdowSize
=
	`imš
Ò_wšdowSize,
p_quad
->
m_wšdowSize
+1);

1008 
n_wšdowSize
=
	`imš
Ò_wšdowSize,(
RC_MODEL_HISTORY
-1));

1011 
p_quad
->
m_wšdowSize
=
n_wšdowSize
;

1013 
i
 = 0; i < (
RC_MODEL_HISTORY
-1); i++)

1015 
m_rgRejeùed
[
i
] = 
FALSE
;

1019 
	`RCMod–E¡im©Ü
 (
p_Vid
, 
p_IÅ
, 
p_quad
, 
n_wšdowSize
, 
m_rgRejeùed
);

1021 
n_wšdowSize
 = 
p_quad
->
m_wšdowSize
;

1024 
i
 = 0; i < (è
n_wšdowSize
; i++)

1026 
”rÜ
[
i
] = 
p_quad
->
m_X1
 /…_quad->
m_rgQp
[i] +…_quad->
m_X2
 / (p_quad->m_rgQp[i] *…_quad->m_rgQp[i]è-…_quad->
m_rgRp
[i];

1027 
¡d
 +ð
”rÜ
[
i
] *ƒrror[i];

1029 
th»shÞd
 = (
n_wšdowSize
 =ð2è? 0 : 
	`sq¹
 (
¡d
 /‚_windowSize);

1030 
i
 = 0; i < (è
n_wšdowSize
; i++)

1032 ià(
	`çbs
(
”rÜ
[
i
]è> 
th»shÞd
)

1033 
m_rgRejeùed
[
i
] = 
TRUE
;

1036 
m_rgRejeùed
[0] = 
FALSE
;

1039 
	`RCMod–E¡im©Ü
 (
p_Vid
, 
p_IÅ
, 
p_quad
, 
n_wšdowSize
, 
m_rgRejeùed
);

1041 ifÐ
MADMod–FÏg
 )

1042 
	`upd©eMADMod–
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
);

1043 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 != 0)) )

1044 
p_quad
->
PPiùu»MAD
[0] =…_quad->
Cu¼’tF¿meMAD
;

1046 
	}
}

1055 
	$RCMod–E¡im©Ü
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
n_wšdowSize
, 
BoÞ—n
 *
m_rgRejeùed
)

1057 
n_»®Size
 = 
n_wšdowSize
;

1058 
i
;

1059 
ÚeSam¶eQ
 = 0;

1060 
a00
 = 0.0, 
a01
 = 0.0, 
a10
 = 0.0, 
a11
 = 0.0, 
b0
 = 0.0, 
b1
 = 0.0;

1061 
M©rixV®ue
;

1062 
BoÞ—n
 
e¡im©eX2
 = 
FALSE
;

1064 
i
 = 0; i < 
n_wšdowSize
; i++)

1066 ià(
m_rgRejeùed
[
i
])

1067 
n_»®Size
--;

1071 
p_quad
->
m_X1
 =…_quad->
m_X2
 = 0.0;

1073 
i
 = 0; i < 
n_wšdowSize
; i++)

1075 ià(!
m_rgRejeùed
[
i
])

1076 
ÚeSam¶eQ
 = 
p_quad
->
m_rgQp
[
i
];

1078 
i
 = 0; i < 
n_wšdowSize
; i++)

1080 ià((
p_quad
->
m_rgQp
[
i
] !ð
ÚeSam¶eQ
è&& !
m_rgRejeùed
[i])

1081 
e¡im©eX2
 = 
TRUE
;

1082 ià(!
m_rgRejeùed
[
i
])

1083 
p_quad
->
m_X1
 +ðÕ_quad->
m_rgQp
[
i
] *…_quad->
m_rgRp
[i]è/ 
n_»®Size
;

1087 ià((
n_»®Size
 >ð1è&& 
e¡im©eX2
)

1089 
i
 = 0; i < 
n_wšdowSize
; i++)

1091 ià(!
m_rgRejeùed
[
i
])

1093 
a00
 =‡00 + 1.0;

1094 
a01
 +ð1.0 / 
p_quad
->
m_rgQp
[
i
];

1095 
a10
 = 
a01
;

1096 
a11
 +ð1.0 / (
p_quad
->
m_rgQp
[
i
] *…_quad->m_rgQp[i]);

1097 
b0
 +ð
p_quad
->
m_rgQp
[
i
] *…_quad->
m_rgRp
[i];

1098 
b1
 +ð
p_quad
->
m_rgRp
[
i
];

1102 
M©rixV®ue
=
a00
*
a11
-
a01
*
a10
;

1103 if(
	`çbs
(
M©rixV®ue
) > 0.000001)

1105 
p_quad
->
m_X1
 = (
b0
 * 
a11
 - 
b1
 * 
a01
è/ 
M©rixV®ue
;

1106 
p_quad
->
m_X2
 = (
b1
 * 
a00
 - 
b0
 * 
a10
è/ 
M©rixV®ue
;

1110 
p_quad
->
m_X1
 = 
b0
 / 
a00
;

1111 
p_quad
->
m_X2
 = 0.0;

1114 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 != 0)) )

1116 
p_quad
->
Pm_X1
 =…_quad->
m_X1
;

1117 
p_quad
->
Pm_X2
 =…_quad->
m_X2
;

1119 
	}
}

1128 
	$upd©eMADMod–
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
)

1130 
n_wšdowSize
;

1131 
i
;

1132 
¡d
 = 0.0, 
th»shÞd
;

1133 
m_Nc
 = 
p_quad
->
Numb”ofCodedPF¿me
;

1134 
BoÞ—n
 
Piùu»Rejeùed
[
RC_MODEL_HISTORY
];

1135 
”rÜ
 [
RC_MODEL_HISTORY
];

1137 if(
p_quad
->
Numb”ofCodedPF¿me
>0)

1141 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

1142 
m_Nc
 = 
p_quad
->
Numb”ofCodedPF¿me
;

1144 
m_Nc
=
p_quad
->
Numb”ofCodedPF¿me
*p_quad->
TÙ®Numb”ofBasicUn™
+p_quad->
CodedBasicUn™
;

1146 
i
 = (
RC_MODEL_HISTORY
-2); i > 0; i--)

1148 
p_quad
->
PPiùu»MAD
[
i
] =…_quad->PPictureMAD[i - 1];

1149 
p_quad
->
Piùu»MAD
[
i
] =…_quad->
PPiùu»MAD
[i];

1150 
p_quad
->
Reã»nûMAD
[
i
] =…_quad->ReferenceMAD[i-1];

1152 
p_quad
->
PPiùu»MAD
[0] =…_quad->
Cu¼’tF¿meMAD
;

1153 
p_quad
->
Piùu»MAD
[0] =…_quad->
PPiùu»MAD
[0];

1155 if(
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
)

1156 
p_quad
->
Reã»nûMAD
[0]õ_quad->
Piùu»MAD
[1];

1159 if(((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
)è&&(
p_g’
->
F›ldCÚŒÞ
==1))

1160 
p_quad
->
Reã»nûMAD
[0]õ_quad->
FCBUPFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-1-p_quad->
Numb”ofBasicUn™
];

1162 
p_quad
->
Reã»nûMAD
[0]õ_quad->
BUPFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-1-p_quad->
Numb”ofBasicUn™
];

1164 
p_quad
->
MADPiùu»C1
 =…_quad->
PMADPiùu»C1
;

1165 
p_quad
->
MADPiùu»C2
 =…_quad->
PMADPiùu»C2
;

1168 
n_wšdowSize
 = (
p_quad
->
Cu¼’tF¿meMAD
 >…_quad->
P»viousF¿meMAD
)

1169 ? (è(()(
RC_MODEL_HISTORY
-1è* 
p_quad
->
P»viousF¿meMAD
 /…_quad->
Cu¼’tF¿meMAD
)

1170 : (è(()(
RC_MODEL_HISTORY
-1è* 
p_quad
->
Cu¼’tF¿meMAD
 /…_quad->
P»viousF¿meMAD
);

1171 
n_wšdowSize
 = 
	`iCl3
(1, (
m_Nc
-1),‚_windowSize);

1172 
n_wšdowSize
=
	`imš
Ò_wšdowSize, imš(20, 
p_quad
->
MADm_wšdowSize
 + 1));

1175 
p_quad
->
MADm_wšdowSize
=
n_wšdowSize
;

1177 
i
 = 0; i < (
RC_MODEL_HISTORY
-1); i++)

1179 
Piùu»Rejeùed
[
i
] = 
FALSE
;

1183 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 != 0)) )

1184 
p_quad
->
P»viousF¿meMAD
õ_quad->
Cu¼’tF¿meMAD
;

1187 
	`MADMod–E¡im©Ü
 (
p_Vid
, 
p_IÅ
, 
p_quad
, 
n_wšdowSize
, 
Piùu»Rejeùed
);

1190 
i
 = 0; i < 
n_wšdowSize
; i++)

1192 
”rÜ
[
i
] = 
p_quad
->
MADPiùu»C1
 *…_quad->
Reã»nûMAD
[i] +…_quad->
MADPiùu»C2
 -…_quad->
Piùu»MAD
[i];

1193 
¡d
 +ð(
”rÜ
[
i
] *ƒrror[i]);

1196 
th»shÞd
 = (
n_wšdowSize
 =ð2è? 0 : 
	`sq¹
 (
¡d
 /‚_windowSize);

1197 
i
 = 0; i < 
n_wšdowSize
; i++)

1199 ià(
	`çbs
(
”rÜ
[
i
]è> 
th»shÞd
)

1200 
Piùu»Rejeùed
[
i
] = 
TRUE
;

1203 
Piùu»Rejeùed
[0] = 
FALSE
;

1206 
	`MADMod–E¡im©Ü
 (
p_Vid
, 
p_IÅ
, 
p_quad
, 
n_wšdowSize
, 
Piùu»Rejeùed
);

1208 
	}
}

1218 
	$MADMod–E¡im©Ü
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
n_wšdowSize
, 
BoÞ—n
 *
Piùu»Rejeùed
)

1220 
n_»®Size
 = 
n_wšdowSize
;

1221 
i
;

1222 
ÚeSam¶eQ
 = 0.0;

1223 
a00
 = 0.0, 
a01
 = 0.0, 
a10
 = 0.0, 
a11
 = 0.0, 
b0
 = 0.0, 
b1
 = 0.0;

1224 
M©rixV®ue
;

1225 
BoÞ—n
 
e¡im©eX2
 = 
FALSE
;

1227 
i
 = 0; i < 
n_wšdowSize
; i++)

1229 ià(
Piùu»Rejeùed
[
i
])

1230 
n_»®Size
--;

1234 
p_quad
->
MADPiùu»C1
 =…_quad->
MADPiùu»C2
 = 0.0;

1236 
i
 = 0; i < 
n_wšdowSize
; i++)

1238 ià(!
Piùu»Rejeùed
[
i
])

1239 
ÚeSam¶eQ
 = 
p_quad
->
Piùu»MAD
[
i
];

1242 
i
 = 0; i < 
n_wšdowSize
; i++)

1244 ià((
p_quad
->
Piùu»MAD
[
i
] !ð
ÚeSam¶eQ
è&& !
Piùu»Rejeùed
[i])

1245 
e¡im©eX2
 = 
TRUE
;

1246 ià(!
Piùu»Rejeùed
[
i
])

1247 
p_quad
->
MADPiùu»C1
 +ðp_quad->
Piùu»MAD
[
i
] / (p_quad->
Reã»nûMAD
[i]*
n_»®Size
);

1251 ià((
n_»®Size
 >ð1è&& 
e¡im©eX2
)

1253 
i
 = 0; i < 
n_wšdowSize
; i++)

1255 ià(!
Piùu»Rejeùed
[
i
])

1257 
a00
 =‡00 + 1.0;

1258 
a01
 +ð
p_quad
->
Reã»nûMAD
[
i
];

1259 
a10
 = 
a01
;

1260 
a11
 +ð
p_quad
->
Reã»nûMAD
[
i
] *…_quad->ReferenceMAD[i];

1261 
b0
 +ð
p_quad
->
Piùu»MAD
[
i
];

1262 
b1
 +ð
p_quad
->
Piùu»MAD
[
i
] *…_quad->
Reã»nûMAD
[i];

1266 
M©rixV®ue
 = 
a00
 * 
a11
 - 
a01
 * 
a10
;

1267 if(
	`çbs
(
M©rixV®ue
) > 0.000001)

1269 
p_quad
->
MADPiùu»C2
 = (
b0
 * 
a11
 - 
b1
 * 
a01
è/ 
M©rixV®ue
;

1270 
p_quad
->
MADPiùu»C1
 = (
b1
 * 
a00
 - 
b0
 * 
a10
è/ 
M©rixV®ue
;

1274 
p_quad
->
MADPiùu»C1
 = 
b0
/
a01
;

1275 
p_quad
->
MADPiùu»C2
 = 0.0;

1278 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || (
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 && (p_Vid->
numb”
 != 0)) )

1280 
p_quad
->
PMADPiùu»C1
 =…_quad->
MADPiùu»C1
;

1281 
p_quad
->
PMADPiùu»C2
 =…_quad->
MADPiùu»C2
;

1283 
	}
}

1292 
	$upd©eQPRC0
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
)

1294 
m_B™s
;

1295 
BF¿meNumb”
;

1296 
S‹pSize
;

1297 
SumofBasicUn™
;

1298 
MaxQpChªge
, 
m_Qp
, 
m_Hp
;

1301 ifÐ
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
 )

1307 if((
tÝf›ld
è|| (
p_g’
->
F›ldCÚŒÞ
==0))

1309 ià(
p_Vid
->
ty³
==
I_SLICE
)

1311 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1312  
p_quad
->
m_Qc
;

1314 if(
p_Vid
->
ty³
 =ð
B_SLICE
)

1316 if(
p_IÅ
->
Numb”BF¿mes
==1)

1318 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1319 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1321 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->
P»vLa¡QP
,…_quad->
Cu¼La¡QP
) + 2;

1322 
p_quad
->
m_Qc
 = 
	`imax
Õ_quad->m_Qc, imaxÕ_quad->
P»vLa¡QP
,…_quad->
Cu¼La¡QP
));

1323 
p_quad
->
m_Qc
 = 
	`imax
Õ_quad->m_Qc,…_quad->
Cu¼La¡QP
 + 1);

1324 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1328 
BF¿meNumb”
 = (
p_quad
->
Numb”ofBF¿mes
 + 1è% 
p_IÅ
->
Numb”BF¿mes
;

1329 if(
BF¿meNumb”
==0)

1330 
BF¿meNumb”
 = 
p_IÅ
->
Numb”BF¿mes
;

1333 if(
BF¿meNumb”
==1)

1335 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1336 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1339 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)<=(-2*
p_IÅ
->
Numb”BF¿mes
-3))

1340 
S‹pSize
=-3;

1341 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
-2))

1342 
S‹pSize
=-2;

1343 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
-1))

1344 
S‹pSize
=-1;

1345 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
))

1346 
S‹pSize
=0;

1347 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
+1))

1348 
S‹pSize
=1;

1350 
S‹pSize
=2;

1352 
p_quad
->
m_Qc
 =…_quad->
P»vLa¡QP
 + 
S‹pSize
;

1353 
p_quad
->
m_Qc
 +ð
	`iCl3
Ð-2 * (
BF¿meNumb”
 - 1), 2*(BFrameNumber-1),

1354 (
BF¿meNumb”
-1)*(
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)/(
p_IÅ
->
Numb”BF¿mes
-1));

1355 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1357  
p_quad
->
m_Qc
;

1359 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && 
p_quad
->
Numb”ofPPiùu»
 == 0 )

1361 
p_quad
->
m_Qc
õ_quad->
MyIn™ŸlQp
;

1363 if(
p_g’
->
F›ldCÚŒÞ
==0)

1364 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1365  
p_quad
->
m_Qc
;

1370 ifÐÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
MbIÁ”Ïû
 ) && 
p_g’
->
F›ldCÚŒÞ
 == 0 )

1371 
	`upd©eQPIÁ”ÏûBU
Ð
p_quad
, 
p_g’
 );

1373 
p_quad
->
m_X1
 =…_quad->
Pm_X1
;

1374 
p_quad
->
m_X2
 =…_quad->
Pm_X2
;

1375 
p_quad
->
MADPiùu»C1
 =…_quad->
PMADPiùu»C1
;

1376 
p_quad
->
MADPiùu»C2
 =…_quad->
PMADPiùu»C2
;

1377 
p_quad
->
P»viousPiùu»MAD
 =…_quad->
PPiùu»MAD
[0];

1379 
MaxQpChªge
 = 
p_quad
->
PMaxQpChªge
;

1380 
m_Qp
 = 
p_quad
->
Pm_Qp
;

1381 
m_Hp
 = 
p_quad
->
PP»H—d”
;

1384 
p_quad
->
Cu¼’tF¿meMAD
 =…_quad->
MADPiùu»C1
*p_quad->
P»viousPiùu»MAD
 +…_quad->
MADPiùu»C2
;

1387 if(
p_quad
->
T¬g‘
 < 0)

1389 
p_quad
->
m_Qc
=
m_Qp
+
MaxQpChªge
;

1390 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1394 
m_B™s
 = 
p_quad
->
T¬g‘
-
m_Hp
;

1395 
m_B™s
 = 
	`imax
(m_B™s, ()(
p_quad
->
b™_¿‹
/(
MINVALUE
*p_quad->
äame_¿‹
)));

1397 
	`upd©eMod–QPF¿me
Ð
p_quad
, 
m_B™s
 );

1399 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1400 
p_quad
->
m_Qc
 = 
	`iCl3
(
m_Qp
-
MaxQpChªge
, m_Qp+MaxQpChange,…_quad->m_Qc);

1403 ifÐ
p_g’
->
F›ldCÚŒÞ
 == 0 )

1404 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1406  
p_quad
->
m_Qc
;

1412 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && 
p_g’
->
NoG¿nuÏrF›ldRC
 == 0 )

1413 
	`upd©eBÙtomF›ld
Ð
p_IÅ
, 
p_quad
 );

1414  
p_quad
->
m_Qc
;

1421 ià(
p_Vid
->
ty³
 =ð
I_SLICE
)

1423 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1424  
p_quad
->
m_Qc
;

1426 ifÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

1429 if((
tÝf›ld
)||(
p_g’
->
F›ldCÚŒÞ
==0))

1431 if(
p_IÅ
->
Numb”BF¿mes
==1)

1434 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1435 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1437 if(
p_quad
->
P»vLa¡QP
=õ_quad->
Cu¼La¡QP
)

1438 
p_quad
->
m_Qc
õ_quad->
P»vLa¡QP
+2;

1440 
p_quad
->
m_Qc
 = (Õ_quad->
P»vLa¡QP
+p_quad->
Cu¼La¡QP
) >> 1) + 1;

1441 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1445 
BF¿meNumb”
=(
p_quad
->
Numb”ofBF¿mes
+1)%
p_IÅ
->
Numb”BF¿mes
;

1446 if(
BF¿meNumb”
==0)

1447 
BF¿meNumb”
=
p_IÅ
->
Numb”BF¿mes
;

1450 if(
BF¿meNumb”
==1)

1452 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1453 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1456 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)<=(-2*
p_IÅ
->
Numb”BF¿mes
-3))

1457 
S‹pSize
=-3;

1458 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
-2))

1459 
S‹pSize
=-2;

1460 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
-1))

1461 
S‹pSize
=-1;

1462 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
))

1463 
S‹pSize
=0;

1464 if((
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)==(-2*
p_IÅ
->
Numb”BF¿mes
+1))

1465 
S‹pSize
=1;

1467 
S‹pSize
=2;

1468 
p_quad
->
m_Qc
õ_quad->
P»vLa¡QP
+
S‹pSize
;

1469 
p_quad
->
m_Qc
 +=

1470 
	`iCl3
Ð-2*(
BF¿meNumb”
-1), 2*(BF¿meNumb”-1), (BF¿meNumb”-1)*(
p_quad
->
Cu¼La¡QP
-p_quad->
P»vLa¡QP
)/(
p_IÅ
->
Numb”BF¿mes
-1) );

1471 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1473  
p_quad
->
m_Qc
;

1478  
p_quad
->
m_Qc
;

1481 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

1483 ifÐ(
p_g’
->
Numb”ofGOP
 =ð1è&& (
p_quad
->
Numb”ofPPiùu»
 == 0) )

1485 if((
p_g’
->
F›ldCÚŒÞ
==0)||(Õ_g’->F›ldCÚŒÞ==1è&& (p_g’->
NoG¿nuÏrF›ldRC
==0)))

1486  
	`upd©eFœ¡P
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1490 
p_quad
->
m_X1
õ_quad->
Pm_X1
;

1491 
p_quad
->
m_X2
õ_quad->
Pm_X2
;

1492 
p_quad
->
MADPiùu»C1
õ_quad->
PMADPiùu»C1
;

1493 
p_quad
->
MADPiùu»C2
õ_quad->
PMADPiùu»C2
;

1495 
m_Qp
=
p_quad
->
Pm_Qp
;

1497 if(
p_g’
->
F›ldCÚŒÞ
==0)

1498 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
;

1500 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
>>1;

1503 if(
p_quad
->
Numb”ofBasicUn™
==
SumofBasicUn™
)

1504  
	`upd©eFœ¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1508 
p_quad
->
T¬g‘
 -ð(
p_g’
->
Numb”ofBasicUn™H—d”B™s
 +…_g’->
Numb”ofBasicUn™Textu»B™s
);

1509 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 = 0;

1510 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 = 0;

1511 if(
p_quad
->
T¬g‘
<0)

1512  
	`upd©eNeg©iveT¬g‘
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
, 
m_Qp
 );

1516 
	`´ediùCu¼PicMAD
Ð
p_IÅ
, 
p_quad
, 
p_g’
 );

1519 
	`upd©eMod–QPBU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
m_Qp
 );

1521 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

1522 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

1523 
p_quad
->
Numb”ofBasicUn™
--;

1524 ifÐ
p_quad
->
Numb”ofBasicUn™
 =ð0 && 
p_Vid
->
ty³
 =ð
P_SLICE
 )

1525 
	`upd©eLa¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1527  
p_quad
->
m_Qc
;

1533  
p_quad
->
m_Qc
;

1534 
	}
}

1543 
	$upd©eQPRC1
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
)

1545 
m_B™s
;

1546 
SumofBasicUn™
;

1547 
MaxQpChªge
, 
m_Qp
, 
m_Hp
;

1550 ifÐ
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
 )

1556 if((
tÝf›ld
è|| (
p_g’
->
F›ldCÚŒÞ
==0))

1558 ià(
p_Vid
->
numb”
 == 0)

1560 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1561  
p_quad
->
m_Qc
;

1563 ifÐ
p_quad
->
Numb”ofPPiùu»
 =ð0 && (
p_Vid
->
numb”
 != 0))

1565 
p_quad
->
m_Qc
õ_quad->
MyIn™ŸlQp
;

1567 if(
p_g’
->
F›ldCÚŒÞ
==0)

1568 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1569  
p_quad
->
m_Qc
;

1574 ifÐÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
MbIÁ”Ïû
 ) && 
p_g’
->
F›ldCÚŒÞ
 == 0 )

1575 
	`upd©eQPIÁ”ÏûBU
Ð
p_quad
, 
p_g’
 );

1577 
p_quad
->
m_X1
 =…_quad->
Pm_X1
;

1578 
p_quad
->
m_X2
 =…_quad->
Pm_X2
;

1579 
p_quad
->
MADPiùu»C1
 =…_quad->
PMADPiùu»C1
;

1580 
p_quad
->
MADPiùu»C2
 =…_quad->
PMADPiùu»C2
;

1581 
p_quad
->
P»viousPiùu»MAD
 =…_quad->
PPiùu»MAD
[0];

1583 
MaxQpChªge
 = 
p_quad
->
PMaxQpChªge
;

1584 
m_Qp
 = 
p_quad
->
Pm_Qp
;

1585 
m_Hp
 = 
p_quad
->
PP»H—d”
;

1588 
p_quad
->
Cu¼’tF¿meMAD
õ_quad->
MADPiùu»C1
*p_quad->
P»viousPiùu»MAD
 +…_quad->
MADPiùu»C2
;

1591 if(
p_quad
->
T¬g‘
 < 0)

1593 
p_quad
->
m_Qc
=
m_Qp
+
MaxQpChªge
;

1594 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1598 
m_B™s
 = 
p_quad
->
T¬g‘
-
m_Hp
;

1599 
m_B™s
 = 
	`imax
(m_B™s, ()(
p_quad
->
b™_¿‹
/(
MINVALUE
*p_quad->
äame_¿‹
)));

1601 
	`upd©eMod–QPF¿me
Ð
p_quad
, 
m_B™s
 );

1603 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1604 
p_quad
->
m_Qc
 = 
	`iCl3
(
m_Qp
-
MaxQpChªge
, m_Qp+MaxQpChange,…_quad->m_Qc);

1607 ifÐ
p_g’
->
F›ldCÚŒÞ
 == 0 )

1608 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1610  
p_quad
->
m_Qc
;

1616 ifÐ
p_g’
->
NoG¿nuÏrF›ldRC
 == 0 )

1617 
	`upd©eBÙtomF›ld
Ð
p_IÅ
, 
p_quad
 );

1618  
p_quad
->
m_Qc
;

1625 ià(
p_Vid
->
numb”
 == 0)

1627 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1628  
p_quad
->
m_Qc
;

1632 if((
p_g’
->
Numb”ofGOP
==1)&&(
p_quad
->
Numb”ofPPiùu»
==0))

1634 if((
p_g’
->
F›ldCÚŒÞ
==0)||(Õ_g’->F›ldCÚŒÞ==1è&& (p_g’->
NoG¿nuÏrF›ldRC
==0)))

1635  
	`upd©eFœ¡P
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1639 
p_quad
->
m_X1
õ_quad->
Pm_X1
;

1640 
p_quad
->
m_X2
õ_quad->
Pm_X2
;

1641 
p_quad
->
MADPiùu»C1
õ_quad->
PMADPiùu»C1
;

1642 
p_quad
->
MADPiùu»C2
õ_quad->
PMADPiùu»C2
;

1644 
m_Qp
=
p_quad
->
Pm_Qp
;

1646 if(
p_g’
->
F›ldCÚŒÞ
==0)

1647 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
;

1649 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
>>1;

1652 if(
p_quad
->
Numb”ofBasicUn™
==
SumofBasicUn™
)

1653  
	`upd©eFœ¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1657 
p_quad
->
T¬g‘
 -ð(
p_g’
->
Numb”ofBasicUn™H—d”B™s
 +…_g’->
Numb”ofBasicUn™Textu»B™s
);

1658 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 = 0;

1659 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 = 0;

1660 if(
p_quad
->
T¬g‘
<0)

1661  
	`upd©eNeg©iveT¬g‘
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
, 
m_Qp
 );

1665 
	`´ediùCu¼PicMAD
Ð
p_IÅ
, 
p_quad
, 
p_g’
 );

1668 
	`upd©eMod–QPBU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
m_Qp
 );

1670 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

1671 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

1672 
p_quad
->
Numb”ofBasicUn™
--;

1673 if((
p_quad
->
Numb”ofBasicUn™
==0è&& (
p_Vid
->
numb”
 != 0))

1674 
	`upd©eLa¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1676  
p_quad
->
m_Qc
;

1682  
p_quad
->
m_Qc
;

1683 
	}
}

1692 
	$upd©eQPRC2
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
)

1694 
m_B™s
;

1695 
SumofBasicUn™
;

1696 
MaxQpChªge
, 
m_Qp
, 
m_Hp
;

1699 ifÐ
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
 )

1705 if((
tÝf›ld
è|| (
p_g’
->
F›ldCÚŒÞ
==0))

1707 ià(
p_Vid
->
numb”
 == 0)

1709 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1710  
p_quad
->
m_Qc
;

1712 ià(
p_Vid
->
ty³
==
I_SLICE
)

1714 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1715 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1717 iàÐ
p_Vid
->
p_cu¼_äm_¡ruù
->
idr_æag
 )

1718 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1720 
p_quad
->
m_Qc
 =…_quad->
Cu¼La¡QP
;

1722  
p_quad
->
m_Qc
;

1724 if(
p_Vid
->
ty³
 =ð
B_SLICE
)

1726 
´evQP
 = 
	`imax
(
p_quad
->
P»vLa¡QP
,…_quad->
Cu¼La¡QP
);

1729 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1730 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1732 ià(
p_IÅ
->
H›¿rchiÿlCodšg
)

1734 
p_quad
->
m_Qc
 = 
´evQP
 + 
p_Vid
->
p_cu¼_äm_¡ruù
->
Ïy”
;

1737 
p_quad
->
m_Qc
 = 
´evQP
 + 2 - 
p_Vid
->
Çl_»ã»nû_idc
;

1738 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1740  
p_quad
->
m_Qc
;

1742 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && 
p_quad
->
Numb”ofPPiùu»
 == 0 )

1744 
p_quad
->
m_Qc
õ_quad->
MyIn™ŸlQp
;

1746 if(
p_g’
->
F›ldCÚŒÞ
==0)

1747 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1748  
p_quad
->
m_Qc
;

1753 ifÐÐ
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
MbIÁ”Ïû
 ) && 
p_g’
->
F›ldCÚŒÞ
 == 0 )

1754 
	`upd©eQPIÁ”ÏûBU
Ð
p_quad
, 
p_g’
 );

1756 
p_quad
->
m_X1
 =…_quad->
Pm_X1
;

1757 
p_quad
->
m_X2
 =…_quad->
Pm_X2
;

1758 
p_quad
->
MADPiùu»C1
 =…_quad->
PMADPiùu»C1
;

1759 
p_quad
->
MADPiùu»C2
 =…_quad->
PMADPiùu»C2
;

1760 
p_quad
->
P»viousPiùu»MAD
 =…_quad->
PPiùu»MAD
[0];

1762 
MaxQpChªge
 = 
p_quad
->
PMaxQpChªge
;

1763 
m_Qp
 = 
p_quad
->
Pm_Qp
;

1764 
m_Hp
 = 
p_quad
->
PP»H—d”
;

1767 
p_quad
->
Cu¼’tF¿meMAD
õ_quad->
MADPiùu»C1
*p_quad->
P»viousPiùu»MAD
 +…_quad->
MADPiùu»C2
;

1770 if(
p_quad
->
T¬g‘
 < 0)

1772 
p_quad
->
m_Qc
=
m_Qp
+
MaxQpChªge
;

1773 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1777 
m_B™s
 = 
p_quad
->
T¬g‘
-
m_Hp
;

1778 
m_B™s
 = 
	`imax
(m_B™s, ()(
p_quad
->
b™_¿‹
/(
MINVALUE
*p_quad->
äame_¿‹
)));

1780 
	`upd©eMod–QPF¿me
Ð
p_quad
, 
m_B™s
 );

1782 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1783 
p_quad
->
m_Qc
 = 
	`iCl3
(
m_Qp
-
MaxQpChªge
, m_Qp+MaxQpChange,…_quad->m_Qc);

1786 ifÐ
p_g’
->
F›ldCÚŒÞ
 == 0 )

1787 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1789  
p_quad
->
m_Qc
;

1795 ifÐ
p_Vid
->
ty³
==
P_SLICE
 && 
p_g’
->
NoG¿nuÏrF›ldRC
 == 0 )

1796 
	`upd©eBÙtomF›ld
Ð
p_IÅ
, 
p_quad
 );

1797  
p_quad
->
m_Qc
;

1804 ià(
p_Vid
->
numb”
 == 0)

1806 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1807  
p_quad
->
m_Qc
;

1809 ià(
p_Vid
->
ty³
==
I_SLICE
)

1812 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1813 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1815 
p_quad
->
m_Qc
 =…_quad->
P»vLa¡QP
;

1816 
p_quad
->
P»vLa¡QP
 =…_quad->
Cu¼La¡QP
;

1817 
p_quad
->
Cu¼La¡QP
 =…_quad->
P»vLa¡QP
;

1818 
p_quad
->
PAveF¿meQP
 =…_quad->
Cu¼La¡QP
;

1820  
p_quad
->
m_Qc
;

1822 if(
p_Vid
->
ty³
 =ð
B_SLICE
)

1824 
´evQP
 = 
	`imax
(
p_quad
->
P»vLa¡QP
,…_quad->
Cu¼La¡QP
);

1825 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

1826 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1828 ià(
p_IÅ
->
H›¿rchiÿlCodšg
)

1830 
p_quad
->
m_Qc
 = 
´evQP
 + 
p_Vid
->
p_cu¼_äm_¡ruù
->
Ïy”
;

1833 
p_quad
->
m_Qc
 = 
´evQP
 + 2 - 
p_Vid
->
Çl_»ã»nû_idc
;

1835 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1837  
p_quad
->
m_Qc
;

1840 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

1842 if((
p_g’
->
Numb”ofGOP
==1)&&(
p_quad
->
Numb”ofPPiùu»
==0))

1844 if((
p_g’
->
F›ldCÚŒÞ
==0)||(Õ_g’->F›ldCÚŒÞ==1è&& (p_g’->
NoG¿nuÏrF›ldRC
==0)))

1845  
	`upd©eFœ¡P
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1849 
p_quad
->
m_X1
õ_quad->
Pm_X1
;

1850 
p_quad
->
m_X2
õ_quad->
Pm_X2
;

1851 
p_quad
->
MADPiùu»C1
õ_quad->
PMADPiùu»C1
;

1852 
p_quad
->
MADPiùu»C2
õ_quad->
PMADPiùu»C2
;

1854 
m_Qp
=
p_quad
->
Pm_Qp
;

1856 if(
p_g’
->
F›ldCÚŒÞ
==0)

1857 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
;

1859 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
>>1;

1862 if(
p_quad
->
Numb”ofBasicUn™
==
SumofBasicUn™
)

1863  
	`upd©eFœ¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1867 
p_quad
->
T¬g‘
 -ð(
p_g’
->
Numb”ofBasicUn™H—d”B™s
 +…_g’->
Numb”ofBasicUn™Textu»B™s
);

1868 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 = 0;

1869 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 = 0;

1870 if(
p_quad
->
T¬g‘
<0)

1871  
	`upd©eNeg©iveT¬g‘
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
, 
m_Qp
 );

1875 
	`´ediùCu¼PicMAD
Ð
p_IÅ
, 
p_quad
, 
p_g’
 );

1878 
	`upd©eMod–QPBU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
m_Qp
 );

1880 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

1881 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

1882 
p_quad
->
Numb”ofBasicUn™
--;

1883 if((
p_quad
->
Numb”ofBasicUn™
==0è&& 
p_Vid
->
ty³
 =ð
P_SLICE
 )

1884 
	`upd©eLa¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

1886  
p_quad
->
m_Qc
;

1892  
p_quad
->
m_Qc
;

1893 
	}
}

1902 
	$upd©eQPRC3
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
)

1904 
m_B™s
;

1905 
SumofBasicUn™
;

1906 
MaxQpChªge
, 
m_Qp
, 
m_Hp
;

1909 ifÐ
p_Vid
->
BasicUn™
 =ðp_Vid->
F¿meSizeInMbs
 ||…_Vid->
ty³
 !ð
P_SLICE
 )

1915 if((
tÝf›ld
è|| (
p_g’
->
F›ldCÚŒÞ
==0))

1917 ià(
p_Vid
->
numb”
 == 0)

1919 if((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
MbIÁ”Ïû
))

1920 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1921 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

1922  
p_quad
->
m_Qc
;

1924 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && 
p_quad
->
Numb”ofPPiùu»
 == 0 )

1926 
p_quad
->
m_Qc
õ_quad->
MyIn™ŸlQp
;

1928 if(
p_g’
->
F›ldCÚŒÞ
==0)

1929 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1930  
p_quad
->
m_Qc
;

1934 ifÐÐ(
p_Vid
->
ty³
 =ð
B_SLICE
 && (p_Vid->
p_cu¼_äm_¡ruù
->
Ïy”
 &&…_Vid->p_cu¼_äm_¡ruù->
©om_idx
 =ð1)è||…_Vid->ty³ =ð
I_SLICE
è&& ((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
MbIÁ”Ïû
)) )

1935 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

1937 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && ( 
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
MbIÁ”Ïû
 ) && 
p_g’
->
F›ldCÚŒÞ
 == 0 )

1938 
	`upd©eQPIÁ”ÏûBU
Ð
p_quad
, 
p_g’
 );

1940 
p_quad
->
m_X1
 =…_quad->
Pm_X1
;

1941 
p_quad
->
m_X2
 =…_quad->
Pm_X2
;

1942 
p_quad
->
MADPiùu»C1
 =…_quad->
PMADPiùu»C1
;

1943 
p_quad
->
MADPiùu»C2
 =…_quad->
PMADPiùu»C2
;

1944 
p_quad
->
P»viousPiùu»MAD
 =…_quad->
PPiùu»MAD
[0];

1946 
MaxQpChªge
 = 
p_quad
->
PMaxQpChªge
;

1947 
m_Qp
 = 
p_quad
->
Pm_Qp
;

1948 
m_Hp
 = 
p_quad
->
PP»H—d”
;

1950 iàÐ
p_Vid
->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
 &&…_Vid->
ty³
 !ð
P_SLICE
 )

1955 
p_quad
->
P»viousPiùu»MAD
 =…_quad->
P»viousWhÞeF¿meMAD
;

1957 iàÐ
p_Vid
->
ty³
 =ð
I_SLICE
 )

1958 
m_Hp
 = 0;

1961 
p_quad
->
Cu¼’tF¿meMAD
õ_quad->
MADPiùu»C1
*p_quad->
P»viousPiùu»MAD
 +…_quad->
MADPiùu»C2
;

1964 if(
p_quad
->
T¬g‘
 < 0)

1966 
p_quad
->
m_Qc
=
m_Qp
+
MaxQpChªge
;

1967 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1971 iàÐ
p_Vid
->
ty³
 !ð
P_SLICE
 )

1973 iàÐ
p_Vid
->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
 )

1974 
m_B™s
 =(
p_quad
->
T¬g‘
-
m_Hp
)/p_quad->
TÙ®Numb”ofBasicUn™
;

1976 
m_B™s
 =
p_quad
->
T¬g‘
-
m_Hp
;

1979 
m_B™s
 = 
p_quad
->
T¬g‘
-
m_Hp
;

1980 
m_B™s
 = 
	`imax
(m_B™s, ()(
p_quad
->
b™_¿‹
/(
MINVALUE
*p_quad->
äame_¿‹
)));

1982 
	`upd©eMod–QPF¿me
Ð
p_quad
, 
m_B™s
 );

1984 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

1985 iàÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

1986 
p_quad
->
m_Qc
 = 
	`iCl3
(
m_Qp
-
MaxQpChªge
, m_Qp+MaxQpChange,…_quad->m_Qc);

1989 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 && 
p_g’
->
F›ldCÚŒÞ
 == 0 )

1990 
	`upd©eQPNÚPicAFF
Ð
p_Vid
->
aùive_¥s
, 
p_quad
 );

1992 iàÐ
p_Vid
->
ty³
 =ð
B_SLICE
 )

1995 
´evqp
 = ((
p_quad
->
P»vLa¡QP
+p_quad->
Cu¼La¡QP
) >> 1) + 1;

1996 iàÐ
p_IÅ
->
H›¿rchiÿlCodšg
 && 
p_Vid
->
p_cu¼_äm_¡ruù
->
Ïy”
)

1997 
p_quad
->
m_Qc
 -ð(
p_Vid
->
p_cu¼_äm_¡ruù
->
p_©om
->
gÝ_Ëv–s
 -…_Vid->p_cu¼_äm_¡ruù->
Ïy”
);

1999 
p_quad
->
m_Qc
 = 
	`iCl3
(
´evqp
 - (
p_IÅ
->
H›¿rchiÿlCodšg
 ? 0 : 5),…revqp + 5,…_quad->m_Qc);

2000 
p_quad
->
m_Qc
 = 
	`iCl3
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_Vid->
RCMaxQP
 +…_quad->bitdepth_qp_scale,…_quad->m_Qc);

2002  
p_quad
->
m_Qc
;

2008 ifÐ
p_Vid
->
ty³
==
P_SLICE
 && 
p_g’
->
NoG¿nuÏrF›ldRC
 == 0 )

2009 
	`upd©eBÙtomF›ld
Ð
p_IÅ
, 
p_quad
 );

2010  
p_quad
->
m_Qc
;

2017 ià(
p_Vid
->
numb”
 == 0)

2019 if((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
MbIÁ”Ïû
))

2020 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

2021 
p_quad
->
m_Qc
 =…_quad->
MyIn™ŸlQp
;

2022  
p_quad
->
m_Qc
;

2024 ifÐ
p_Vid
->
ty³
 =ð
P_SLICE
 )

2026 if((
p_g’
->
Numb”ofGOP
==1)&&(
p_quad
->
Numb”ofPPiùu»
==0))

2028 if((
p_g’
->
F›ldCÚŒÞ
==0)||(Õ_g’->F›ldCÚŒÞ==1è&& (p_g’->
NoG¿nuÏrF›ldRC
==0)))

2029  
	`upd©eFœ¡P
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

2033 ifÐÐ(
p_Vid
->
ty³
 =ð
B_SLICE
 && (p_Vid->
p_cu¼_äm_¡ruù
->
Ïy”
 &&…_Vid->p_cu¼_äm_¡ruù->
©om_idx
 =ð1)è||…_Vid->ty³ =ð
I_SLICE
è&& ((
p_IÅ
->
PicIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->
MbIÁ”Ïû
)) )

2034 
	`upd©eQPIÁ”Ïû
Ð
p_quad
, 
p_g’
 );

2035 
p_quad
->
m_X1
õ_quad->
Pm_X1
;

2036 
p_quad
->
m_X2
õ_quad->
Pm_X2
;

2037 
p_quad
->
MADPiùu»C1
õ_quad->
PMADPiùu»C1
;

2038 
p_quad
->
MADPiùu»C2
õ_quad->
PMADPiùu»C2
;

2040 
m_Qp
=
p_quad
->
Pm_Qp
;

2042 if(
p_g’
->
F›ldCÚŒÞ
==0)

2043 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
;

2045 
SumofBasicUn™
=
p_quad
->
TÙ®Numb”ofBasicUn™
>>1;

2048 if(
p_quad
->
Numb”ofBasicUn™
==
SumofBasicUn™
)

2049  
	`upd©eFœ¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

2053 
p_quad
->
T¬g‘
 -ð(
p_g’
->
Numb”ofBasicUn™H—d”B™s
 +…_g’->
Numb”ofBasicUn™Textu»B™s
);

2054 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 = 0;

2055 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 = 0;

2056 if(
p_quad
->
T¬g‘
<0)

2057  
	`upd©eNeg©iveT¬g‘
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
, 
m_Qp
 );

2061 
	`´ediùCu¼PicMAD
Ð
p_IÅ
, 
p_quad
, 
p_g’
 );

2064 
	`upd©eMod–QPBU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
m_Qp
 );

2066 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

2067 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

2068 
p_quad
->
Numb”ofBasicUn™
--;

2069 if((
p_quad
->
Numb”ofBasicUn™
==0è&& 
p_Vid
->
ty³
 =ð
P_SLICE
 )

2070 
	`upd©eLa¡BU
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
, 
tÝf›ld
 );

2072  
p_quad
->
m_Qc
;

2078  
p_quad
->
m_Qc
;

2079 
	}
}

2088 
	$upd©eQPIÁ”Ïû
Ð
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 )

2090 if(
p_g’
->
F›ldCÚŒÞ
==0)

2093 if(
p_g’
->
F›ldF¿me
==1)

2095 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2096 
p_quad
->
Cu¼La¡QP
õ_quad->
F¿meQPBufãr
;

2101 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2102 
p_quad
->
Cu¼La¡QP
õ_quad->
F›ldQPBufãr
;

2105 
	}
}

2114 
	$upd©eQPNÚPicAFF
Ð
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
, 
RCQuad¿tic
 *
p_quad
 )

2116 if(
aùive_¥s
->
äame_mbs_Úly_æag
)

2118 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
m_Qc
;

2119 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2120 
p_quad
->
Cu¼La¡QP
õ_quad->
m_Qc
;

2121 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

2125 
p_quad
->
F¿meQPBufãr
õ_quad->
m_Qc
;

2126 
	}
}

2134 
	$upd©eBÙtomF›ld
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
 )

2137 if(
p_IÅ
->
PicIÁ”Ïû
==
FIELD_CODING
)

2139 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
m_Qc
;

2140 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
+1;

2141 
p_quad
->
Cu¼La¡QP
õ_quad->
m_Qc
;

2142 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

2146 
p_quad
->
F›ldQPBufãr
õ_quad->
m_Qc
;

2147 
	}
}

2155 
	$upd©eFœ¡P
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 )

2159 
p_quad
->
m_Qc
õ_quad->
MyIn™ŸlQp
;

2160 
p_g’
->
Numb”ofBasicUn™H—d”B™s
=0;

2161 
p_g’
->
Numb”ofBasicUn™Textu»B™s
=0;

2162 
p_quad
->
Numb”ofBasicUn™
--;

2164 if((!
tÝf›ld
)&&(
p_quad
->
Numb”ofBasicUn™
==0))

2167 if((
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)||(
p_IÅ
->
PicIÁ”Ïû
==
FIELD_CODING
))

2169 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
m_Qc
;

2170 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2171 
p_quad
->
Cu¼La¡QP
õ_quad->
m_Qc
;

2172 
p_quad
->
PAveF¿meQP
õ_quad->
m_Qc
;

2173 
p_quad
->
PAveH—d”B™s3
õ_quad->
PAveH—d”B™s2
;

2176 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

2178 if(
p_g’
->
F›ldCÚŒÞ
==0)

2180 
p_quad
->
F¿meQPBufãr
õ_quad->
m_Qc
;

2181 
p_quad
->
F¿meAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2185 
p_quad
->
F›ldQPBufãr
õ_quad->
m_Qc
;

2186 
p_quad
->
F›ldAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2190 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

2191 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

2192  
p_quad
->
m_Qc
;

2193 
	}
}

2201 
	$upd©eNeg©iveT¬g‘
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
, 
m_Qp
 )

2203 
PAv”ageQP
;

2205 if(
p_quad
->
GOPOv”due
==
TRUE
)

2206 
p_quad
->
m_Qc
=
m_Qp
+2;

2208 
p_quad
->
m_Qc
=
m_Qp
+p_quad->
DDquªt
;

2210 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->m_Qc, 
p_Vid
->
RCMaxQP
 +…_quad->
b™d•th_qp_sÿË
);

2211 if(
p_IÅ
->
basicun™
>=
p_quad
->
MBP”Row
)

2212 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->m_Qc,…_quad->
PAveF¿meQP
 + 6);

2214 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->m_Qc,…_quad->
PAveF¿meQP
 + 3);

2216 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

2217 
p_quad
->
Numb”ofBasicUn™
--;

2218 if(
p_quad
->
Numb”ofBasicUn™
==0)

2220 if((!
tÝf›ld
)||(
p_g’
->
F›ldCÚŒÞ
==0))

2223 if((
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)||(
p_IÅ
->
PicIÁ”Ïû
==
FIELD_CODING
))

2225 
PAv”ageQP
=()(()
p_quad
->
TÙ®F¿meQP
/(í_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2226 ià(
p_quad
->
Numb”ofPPiùu»
 =ð(
p_IÅ
->
šŒa_³riod
 - 2))

2227 
p_quad
->
QPLa¡PF¿me
 = 
PAv”ageQP
;

2229 
p_quad
->
TÙ®QpfÜPPiùu»
 +=
PAv”ageQP
;

2230 if(
p_quad
->
GOPOv”due
==
TRUE
)

2232 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
+1;

2233 
p_quad
->
Cu¼La¡QP
=
PAv”ageQP
;

2237 if((
p_quad
->
Numb”ofPPiùu»
==0)&&(
p_g’
->
Numb”ofGOP
>1))

2239 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2240 
p_quad
->
Cu¼La¡QP
=
PAv”ageQP
;

2242 if(
p_quad
->
Numb”ofPPiùu»
>0)

2244 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
+1;

2245 
p_quad
->
Cu¼La¡QP
=
PAv”ageQP
;

2248 
p_quad
->
PAveF¿meQP
=
PAv”ageQP
;

2249 
p_quad
->
PAveH—d”B™s3
õ_quad->
PAveH—d”B™s2
;

2252 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

2254 if(
p_g’
->
F›ldCÚŒÞ
==0)

2256 
PAv”ageQP
=()(()
p_quad
->
TÙ®F¿meQP
/(í_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2257 
p_quad
->
F¿meQPBufãr
=
PAv”ageQP
;

2258 
p_quad
->
F¿meAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2262 
PAv”ageQP
=()(()
p_quad
->
TÙ®F¿meQP
/(í_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2263 
p_quad
->
F›ldQPBufãr
=
PAv”ageQP
;

2264 
p_quad
->
F›ldAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2269 if(
p_quad
->
GOPOv”due
==
TRUE
)

2270 
p_quad
->
Pm_Qp
õ_quad->
PAveF¿meQP
;

2272 
p_quad
->
Pm_Qp
õ_quad->
m_Qc
;

2274  
p_quad
->
m_Qc
;

2275 
	}
}

2283 
	$upd©eFœ¡BU
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 )

2286 if(((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))&&(
p_g’
->
F›ldCÚŒÞ
==0))

2289 if(
p_g’
->
F›ldF¿me
==1)

2291 if(
p_quad
->
Numb”ofPPiùu»
>0)

2292 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
F¿meQPBufãr
;

2293 
p_quad
->
PAveF¿meQP
õ_quad->
F¿meQPBufãr
;

2294 
p_quad
->
PAveH—d”B™s3
õ_quad->
F¿meAveH—d”B™s
;

2299 if(
p_quad
->
Numb”ofPPiùu»
>0)

2300 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
F›ldQPBufãr
;

2301 
p_quad
->
PAveF¿meQP
õ_quad->
F›ldQPBufãr
;

2302 
p_quad
->
PAveH—d”B™s3
õ_quad->
F›ldAveH—d”B™s
;

2306 if(
p_quad
->
T¬g‘
<=0)

2308 
p_quad
->
m_Qc
 =…_quad->
PAveF¿meQP
 + 2;

2309 if(
p_quad
->
m_Qc
 > (
p_Vid
->
RCMaxQP
 +…_quad->
b™d•th_qp_sÿË
))

2310 
p_quad
->
m_Qc
 = 
p_Vid
->
RCMaxQP
 +…_quad->
b™d•th_qp_sÿË
;

2312 if(
tÝf›ld
||(
p_g’
->
F›ldCÚŒÞ
==0))

2313 
p_quad
->
GOPOv”due
=
TRUE
;

2317 
p_quad
->
m_Qc
õ_quad->
PAveF¿meQP
;

2319 
p_quad
->
TÙ®F¿meQP
 +õ_quad->
m_Qc
;

2320 
p_quad
->
Numb”ofBasicUn™
--;

2321 
p_quad
->
Pm_Qp
 =…_quad->
PAveF¿meQP
;

2323  
p_quad
->
m_Qc
;

2324 
	}
}

2332 
	$upd©eLa¡BU
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
, 
tÝf›ld
 )

2334 
PAv”ageQP
;

2336 if((!
tÝf›ld
)||(
p_g’
->
F›ldCÚŒÞ
==0))

2339 if((
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)||(
p_IÅ
->
PicIÁ”Ïû
==
FIELD_CODING
))

2341 
PAv”ageQP
=()(()
p_quad
->
TÙ®F¿meQP
/(èp_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2342 ià(
p_quad
->
Numb”ofPPiùu»
 =ð(
p_IÅ
->
šŒa_³riod
 - 2))

2343 
p_quad
->
QPLa¡PF¿me
 = 
PAv”ageQP
;

2345 
p_quad
->
TÙ®QpfÜPPiùu»
 +=
PAv”ageQP
;

2346 
p_quad
->
P»vLa¡QP
õ_quad->
Cu¼La¡QP
;

2347 
p_quad
->
Cu¼La¡QP
=
PAv”ageQP
;

2348 
p_quad
->
PAveF¿meQP
=
PAv”ageQP
;

2349 
p_quad
->
PAveH—d”B™s3
õ_quad->
PAveH—d”B™s2
;

2351 if((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))

2353 if(
p_g’
->
F›ldCÚŒÞ
==0)

2355 
PAv”ageQP
=()((è
p_quad
->
TÙ®F¿meQP
/(í_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2356 
p_quad
->
F¿meQPBufãr
=
PAv”ageQP
;

2357 
p_quad
->
F¿meAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2361 
PAv”ageQP
=()((è
p_quad
->
TÙ®F¿meQP
/(èp_quad->
TÙ®Numb”ofBasicUn™
+0.5);

2362 
p_quad
->
F›ldQPBufãr
=
PAv”ageQP
;

2363 
p_quad
->
F›ldAveH—d”B™s
õ_quad->
PAveH—d”B™s2
;

2367 
	}
}

2375 
	$´ediùCu¼PicMAD
Ð
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 )

2377 
i
;

2378 if(((
p_IÅ
->
PicIÁ”Ïû
==
ADAPTIVE_CODING
)||Õ_IÅ->
MbIÁ”Ïû
))&&(
p_g’
->
F›ldCÚŒÞ
==1))

2380 
p_quad
->
Cu¼’tF¿meMAD
õ_quad->
MADPiùu»C1
*p_quad->
FCBUPFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-p_quad->
Numb”ofBasicUn™
]+p_quad->
MADPiùu»C2
;

2381 
p_quad
->
TÙ®BUMAD
=0;

2382 
i
=
p_quad
->
TÙ®Numb”ofBasicUn™
-1; i>=Õ_quad->TÙ®Numb”ofBasicUn™-p_quad->
Numb”ofBasicUn™
);i--)

2384 
p_quad
->
Cu¼’tBUMAD
õ_quad->
MADPiùu»C1
*p_quad->
FCBUPFMAD
[
i
]+p_quad->
MADPiùu»C2
;

2385 
p_quad
->
TÙ®BUMAD
 +õ_quad->
Cu¼’tBUMAD
*p_quad->CurrentBUMAD;

2390 
p_quad
->
Cu¼’tF¿meMAD
õ_quad->
MADPiùu»C1
*p_quad->
BUPFMAD
[p_quad->
TÙ®Numb”ofBasicUn™
-p_quad->
Numb”ofBasicUn™
]+p_quad->
MADPiùu»C2
;

2391 
p_quad
->
TÙ®BUMAD
=0;

2392 
i
=
p_quad
->
TÙ®Numb”ofBasicUn™
-1; i>=Õ_quad->TÙ®Numb”ofBasicUn™-p_quad->
Numb”ofBasicUn™
);i--)

2394 
p_quad
->
Cu¼’tBUMAD
õ_quad->
MADPiùu»C1
*p_quad->
BUPFMAD
[
i
]+p_quad->
MADPiùu»C2
;

2395 
p_quad
->
TÙ®BUMAD
 +õ_quad->
Cu¼’tBUMAD
*p_quad->CurrentBUMAD;

2398 
	}
}

2406 
	$upd©eMod–QPBU
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
RCQuad¿tic
 *
p_quad
, 
m_Qp
 )

2408 
dtmp
, 
m_Q¡•
;

2409 
m_B™s
;

2411 
m_B™s
 =()(
p_quad
->
T¬g‘
 *…_quad->
Cu¼’tF¿meMAD
 *…_quad->Cu¼’tF¿meMAD /…_quad->
TÙ®BUMAD
);

2413 
m_B™s
 -=
p_quad
->
PAveH—d”B™s2
;

2415 
m_B™s
=
	`imax
(m_B™s,()(
p_quad
->
b™_¿‹
/(
MINVALUE
*p_quad->
äame_¿‹
*p_quad->
TÙ®Numb”ofBasicUn™
)));

2417 
dtmp
 = 
p_quad
->
Cu¼’tF¿meMAD
 *…_quad->Cu¼’tF¿meMAD *…_quad->
m_X1
 *…_quad->m_X1 \

2418 + 4 * 
p_quad
->
m_X2
 *…_quad->
Cu¼’tF¿meMAD
 * 
m_B™s
;

2419 ià((
p_quad
->
m_X2
 =ð0.0è|| (
dtmp
 < 0è|| ((
	`sq¹
 (dtmpè-…_quad->
m_X1
 *…_quad->
Cu¼’tF¿meMAD
) <= 0.0))

2420 
m_Q¡•
 = ()(
p_quad
->
m_X1
 *…_quad->
Cu¼’tF¿meMAD
 / (è
m_B™s
);

2422 
m_Q¡•
 = (è((2 * 
p_quad
->
m_X2
 *…_quad->
Cu¼’tF¿meMAD
è/ (
	`sq¹
 (
dtmp
è-…_quad->
m_X1
 *…_quad->CurrentFrameMAD));

2424 
p_quad
->
m_Qc
 = 
	`Q¡•2QP
(
m_Q¡•
,…_quad->
b™d•th_qp_sÿË
);

2425 
p_quad
->
m_Qc
 = 
	`imš
(
m_Qp
+p_quad->
DDquªt
,…_quad->m_Qc);

2427 if(
p_IÅ
->
basicun™
>=
p_quad
->
MBP”Row
)

2428 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->
PAveF¿meQP
+6,…_quad->m_Qc);

2430 
p_quad
->
m_Qc
 = 
	`imš
Õ_quad->
PAveF¿meQP
+3,…_quad->m_Qc);

2432 
p_quad
->
m_Qc
 = 
	`iCl3
(
m_Qp
-p_quad->
DDquªt
, 
p_Vid
->
RCMaxQP
 +…_quad->
b™d•th_qp_sÿË
,…_quad->m_Qc);

2433 if(
p_IÅ
->
basicun™
>=
p_quad
->
MBP”Row
)

2434 
p_quad
->
m_Qc
 = 
	`imax
Õ_quad->
PAveF¿meQP
-6,…_quad->m_Qc);

2436 
p_quad
->
m_Qc
 = 
	`imax
Õ_quad->
PAveF¿meQP
-3,…_quad->m_Qc);

2438 
p_quad
->
m_Qc
 = 
	`imax
(
p_Vid
->
RCMšQP
 +…_quad->
b™d•th_qp_sÿË
,…_quad->m_Qc);

2439 
	}
}

2447 
	$upd©eQPIÁ”ÏûBU
Ð
RCQuad¿tic
 *
p_quad
, 
RCG’”ic
 *
p_g’
 )

2450 if(
p_g’
->
F›ldF¿me
==1)

2452 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
F¿meQPBufãr
;

2453 
p_quad
->
Pm_Qp
õ_quad->
F¿meQPBufãr
;

2458 
p_quad
->
TÙ®QpfÜPPiùu»
 +õ_quad->
F›ldQPBufãr
;

2459 
p_quad
->
Pm_Qp
õ_quad->
F›ldQPBufãr
;

2461 
	}
}

2469 
	$upd©eMod–QPF¿me
Ð
RCQuad¿tic
 *
p_quad
, 
m_B™s
 )

2471 
dtmp
, 
m_Q¡•
;

2473 
dtmp
 = 
p_quad
->
Cu¼’tF¿meMAD
 *…_quad->
m_X1
 *…_quad->CurrentFrameMAD *…_quad->m_X1

2474 + 4 * 
p_quad
->
m_X2
 *…_quad->
Cu¼’tF¿meMAD
 * 
m_B™s
;

2475 ià((
p_quad
->
m_X2
 =ð0.0è|| (
dtmp
 < 0è|| ((
	`sq¹
 (dtmpè-…_quad->
m_X1
 *…_quad->
Cu¼’tF¿meMAD
) <= 0.0))

2476 
m_Q¡•
 = (è(
p_quad
->
m_X1
 *…_quad->
Cu¼’tF¿meMAD
 / (è
m_B™s
);

2478 
m_Q¡•
 = (è((2 * 
p_quad
->
m_X2
 *…_quad->
Cu¼’tF¿meMAD
è/ (
	`sq¹
 (
dtmp
è-…_quad->
m_X1
 *…_quad->CurrentFrameMAD));

2480 
p_quad
->
m_Qc
 = 
	`Q¡•2QP
(
m_Q¡•
,…_quad->
b™d•th_qp_sÿË
);

2481 
	}
}

2489 
	$rc_hªdË_mb
Ð
Maüoblock
 *
cu¼MB
, 
´ev_mb
 )

2491 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2492 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2493 
Maüoblock
 *
´evMB
 = 
cu¼MB
->
P»vMB
;

2494 
mb_qp
 = 
p_Vid
->
qp
;

2495 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

2496 
RCQuad¿tic
 *
p_quad
 = 
p_Vid
->
p_rc_quad
;

2498 ià(
´ev_mb
 > -1)

2500 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 && !
p_Vid
->
bÙ_MB
 && 
cu¼MB
->
mb_f›ld
 )

2501 
mb_qp
 = 
´evMB
->
qp
;

2505 ià(
p_IÅ
->
basicun™
 !ð
p_Vid
->
F¿meSizeInMbs
)

2508 iàÐ((
p_Vid
->
ty³
 =ð
I_SLICE
 ||…_Vid->ty³ =ð
B_SLICE
è&& 
p_IÅ
->
RCUpd©eMode
 !ð
RC_MODE_1
 ) || !Õ_Vid->
numb”
) )

2510  
mb_qp
;

2512 iàÐ
p_Vid
->
ty³
 =ð
P_SLICE
 || 
p_IÅ
->
RCUpd©eMode
 =ð
RC_MODE_1
 )

2514 ià(!
p_Vid
->
wr™e_maüoblock
)

2516 ià(
´ev_mb
 > -1)

2518 ià(!((
p_IÅ
->
MbIÁ”Ïû
è&& 
p_Vid
->
bÙ_MB
))

2520 ià(
´evMB
->
´ev_cbp
 != 1)

2522 
mb_qp
 = 
´evMB
->
´ev_qp
;

2530 ià(!
p_Vid
->
wr™e_maüoblock
)

2532 if(!((
p_IÅ
->
MbIÁ”Ïû
è&& 
p_Vid
->
bÙ_MB
))

2534 if(
p_IÅ
->
RCUpd©eMode
 <ð
MAX_RC_MODE
 && (
p_Vid
->
Numb”ofCodedMaüoBlocks
 > 0è&& (p_Vid->Numb”ofCodedMaüoBlock %…_Vid->
BasicUn™
 == 0))

2536 
	`upd©eRCMod–
(
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_g’
);

2538 if(
p_Vid
->
aùive_¥s
->
äame_mbs_Úly_æag
)

2540 
p_Vid
->
BasicUn™QP
 =…_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
,…_g’->
TÝF›ldFÏg
è-…_quad->
b™d•th_qp_sÿË
;

2543 if(
p_IÅ
->
MbIÁ”Ïû
 || (Õ_IÅ->
PicIÁ”Ïû
!=
FRAME_CODING
è&& (
p_g’
->
NoG¿nuÏrF›ldRC
==0)))

2545 
p_Vid
->
BasicUn™QP
 =…_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
,…_g’->
TÝF›ldFÏg
è-…_quad->
b™d•th_qp_sÿË
;

2549 if(
p_Vid
->
cu¼’t_mb_Ä
==0)

2550 
p_Vid
->
BasicUn™QP
 = 
mb_qp
;

2553 
mb_qp
 = 
p_Vid
->
BasicUn™QP
;

2554 
mb_qp
 = 
	`iCl3
(
MIN_QP
 - 
p_Vid
->
b™d•th_luma_qp_sÿË
, 
MAX_QP
, mb_qp);

2559  
mb_qp
;

2560 
	}
}

2568 
	$rc_š™_tÝ_f›ld
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

2570 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

2571 
RCQuad¿tic
 *
p_quad
 = 
p_Vid
->
p_rc_quad
;

2573 
p_Vid
->
BasicUn™
 = 
p_IÅ
->
basicun™
;

2574 
p_g’
->
TÝF›ldFÏg
 = 1;

2575 
p_Vid
->
	`rc_š™_più_±r
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 0, 1, (p_IÅ->
PicIÁ”Ïû
 =ð
FIELD_CODING
), 1.0F);

2576 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ðp_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 1è-…_quad->
b™d•th_qp_sÿË
;

2577 
	}
}

2585 
	$rc_š™_bÙtom_f›ld
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
TÝF›ldB™s
 )

2587 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

2588 
RCQuad¿tic
 *
p_quad
 = 
p_Vid
->
p_rc_quad
;

2590 
p_quad
->
b™s_tÝf›ld
 = 
TÝF›ldB™s
;

2591 
p_g’
->
TÝF›ldFÏg
 = 0;

2592 
p_Vid
->
	`rc_š™_più_±r
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 0,0,0, 1.0F);

2593 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ðp_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 0è-…_quad->
b™d•th_qp_sÿË
;

2594 
	}
}

2602 
	$rc_š™_äame_rdpic
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
¿‹R©io
 )

2604 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

2605 
RCG’”ic
 *
p_g’_š™
 = 
p_Vid
->
p_rc_g’_š™
;

2606 
RCQuad¿tic
 *
p_quad
 = 
p_Vid
->
p_rc_quad
;

2607 
RCQuad¿tic
 *
p_quad_š™
 = 
p_Vid
->
p_rc_quad_š™
;

2609 
p_IÅ
->
RCUpd©eMode
)

2611 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

2613 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
, 
p_quad
, 
p_quad_š™
 );

2614 
	`rc_cÝy_g’”ic
Ð
p_Vid
, 
p_g’
, 
p_g’_š™
 );

2615 
p_Vid
->
	`rc_š™_più_±r
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 1, 0, 1, 
¿‹R©io
 );

2616 
p_Vid
->
p_cu¼_äm_¡ruù
->
qp
 =…_Vid->q°ðp_Vid->
	`upd©eQP
Õ_Vid, 
p_IÅ
, 
p_quad
, 
p_g’
, 0è-…_quad->
b™d•th_qp_sÿË
;

2621 
	}
}

2629 
	$rc_®loÿ‹_memÜy
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

2631 
p_IÅ
->
RCUpd©eMode
)

2633 
RC_MODE_0
:

2634 
RC_MODE_1
:

2635 
RC_MODE_2
:

2636 
RC_MODE_3
:

2637 
	`rc_®loc_g’”ic
Ð
p_Vid
, &p_Vid->
p_rc_g’
 );

2638 
	`rc_®loc_quad¿tic
Ð
p_Vid
, 
p_IÅ
, &p_Vid->
p_rc_quad
 );

2640 iàÐ
p_IÅ
->
RDPiùu»DecisiÚ
 ||…_IÅ->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
PicIÁ”Ïû
 == ADAPTIVE_CODING )

2642 
	`rc_®loc_g’”ic
Ð
p_Vid
, &p_Vid->
p_rc_g’_š™
 );

2643 
	`rc_®loc_quad¿tic
Ð
p_Vid
, 
p_IÅ
, &p_Vid->
p_rc_quad_š™
 );

2644 
	`rc_®loc_g’”ic
Ð
p_Vid
, &p_Vid->
p_rc_g’_be¡
 );

2645 
	`rc_®loc_quad¿tic
Ð
p_Vid
, 
p_IÅ
, &p_Vid->
p_rc_quad_be¡
 );

2651 
	}
}

2659 
	$rc_ä“_memÜy
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

2661 
p_IÅ
->
RCUpd©eMode
)

2663 
RC_MODE_0
:

2664 
RC_MODE_1
:

2665 
RC_MODE_2
:

2666 
RC_MODE_3
:

2667 
	`rc_ä“_g’”ic
Ð&
p_Vid
->
p_rc_g’
 );

2668 
	`rc_ä“_quad¿tic
Ð&
p_Vid
->
p_rc_quad
 );

2670 iàÐ
p_IÅ
->
RDPiùu»DecisiÚ
 ||…_IÅ->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->
PicIÁ”Ïû
 == ADAPTIVE_CODING )

2672 
	`rc_ä“_g’”ic
Ð&
p_Vid
->
p_rc_g’_š™
 );

2673 
	`rc_ä“_quad¿tic
Ð&
p_Vid
->
p_rc_quad_š™
 );

2674 
	`rc_ä“_g’”ic
Ð&
p_Vid
->
p_rc_g’_be¡
 );

2675 
	`rc_ä“_quad¿tic
Ð&
p_Vid
->
p_rc_quad_be¡
 );

2681 
	}
}

2689 
	$rc_upd©e_mb_¡©s
(
Maüoblock
 *
cu¼MB
)

2691 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2692 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2693 
B™CouÁ”
 *
mbB™s
 = &
cu¼MB
->
b™s
;

2694 
RCG’”ic
 *
p_g’
 = 
p_Vid
->
p_rc_g’
;

2697 
p_Vid
->
Numb”ofMBH—d”B™s
 = 
mbB™s
->
mb_mode
 + mbB™s->
mb_š‹r


2698 + 
mbB™s
->
mb_cbp
 + mbB™s->
mb_d–_quªt
;

2699 
p_Vid
->
Numb”ofMBTextu»B™s
 = 
mbB™s
->
mb_y_cÛff
 + mbB™s->
mb_uv_cÛff
;

2701 
p_IÅ
->
RCUpd©eMode
)

2703 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

2704 
p_g’
->
Numb”ofTextu»B™s
 +ð
p_Vid
->
Numb”ofMBTextu»B™s
;

2705 
p_g’
->
Numb”ofH—d”B™s
 +ð
p_Vid
->
Numb”ofMBH—d”B™s
;

2707 if(
p_Vid
->
BasicUn™
 <…_Vid->
F¿meSizeInMbs
)

2709 
p_g’
->
Numb”ofBasicUn™H—d”B™s
 +ð
p_Vid
->
Numb”ofMBH—d”B™s
;

2710 
p_g’
->
Numb”ofBasicUn™Textu»B™s
 +ð
p_Vid
->
Numb”ofMBTextu»B™s
;

2716 
	}
}

2724 
	$rc_§ve_¡©e
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

2726 
p_IÅ
->
RCUpd©eMode
)

2728 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

2729 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad_be¡
,…_Vid->
p_rc_quad
 );

2730 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’_be¡
,…_Vid->
p_rc_g’
 );

2735 
	}
}

2743 
	$rc_»¡Üe_¡©e
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

2745 
p_IÅ
->
RCUpd©eMode
)

2747 
RC_MODE_0
: 
RC_MODE_1
: 
RC_MODE_2
: 
RC_MODE_3
:

2748 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_quad_be¡
 );

2749 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’
,…_Vid->
p_rc_g’_be¡
 );

2754 
	}
}

	@lencod/src/rd_intra_jm.c

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"maüoblock.h
"

24 
	~"mb_acûss.h
"

25 
	~"rdÝt_codšg_¡©e.h
"

26 
	~"mode_decisiÚ.h
"

27 
	~"rdÝt.h
"

28 
	~"rd_šŒa_jm.h
"

29 
	~"q_¬ound.h
"

30 
	~"šŒa4x4.h
"

31 
	~"šŒa8x8.h
"

32 
	~"md_commÚ.h
"

33 
	~"ŒªsfÜm8x8.h
"

34 
	~"md_di¡ÜtiÚ.h
"

35 
	~"–em’ts.h
"

36 
	~"symbÞ.h
"

37 
	~"šŒa16x16.h
"

38 
	~"šŒa4x4.h
"

39 
	~"šŒa8x8.h
"

41 
MBTy³2V®ue
 (
Maüoblock
* 
cu¼MB
);

49 
	$mode_decisiÚ_fÜ_I4x4_blocks_JM_High
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
)

51 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

52 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

53 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

54 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

56 
mode
, 
be¡_mode
 = 0, 
y
;

57 
avažabË_mode
;

58 
c_nz
, 
nÚz”o
 = 0;

59 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

60 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

61 
di¡blk
 
rdco¡
 = 0;

62 
di¡blk
 
mš_rdco¡
 = 
DISTBLK_MAX
;

63 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

64 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

65 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

66 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

67 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

68 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

69 
pic_block_x
 = 
pic_pix_x
 >> 2;

70 
pic_block_y
 = 
pic_pix_y
 >> 2;

72 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

73 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

75 
upMode
, 
ËáMode
;

76 
mo¡ProbabËMode
;

78 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

80 
Ìec4x4
[4][4];

81 
be¡_nz_cÛff
 = 0;

82 
block_x4
 = 
block_x
>>2;

83 
block_y4
 = 
block_y
>>2;

85 #ifdeà
BEST_NZ_COEFF


86 
be¡_coded_block_æag
 = 0;

87 
b™_pos
 = 1 + ((((
b8
>>1)<<1)+(
b4
>>1))<<2) + (((b8&1)<<1)+(b4&1));

88 
št64
 
cbp_b™s
;

90 ià(
b8
==0 && 
b4
==0)

91 
cbp_b™s
 = 0;

94 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

95 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

98 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

100 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
[Ëá_block.
mb_addr
] : 0;

101 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
[tÝ_block.
mb_addr
] : 0;

104 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : () -1;

105 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : () -1;

107 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

108 *
mš_co¡
 = 
DISTBLK_MAX
;

110 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

114 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

117 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

119 
avažabË_mode
 = (
®l_avažabË
è|| (
mode
==
DC_PRED
) ||

120 (
up_avažabË
 && (
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
)) ||

121 (
Ëá_avažabË
 && (
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
));

123 ià(
	`v®id_šŒa_mode
(
cu¼Sliû
, 
mode
) == 0)

126 ifÐ
avažabË_mode
)

129 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

132 
	`g’”©e_´ed_”rÜ_4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], 
cu¼Sliû
->
m´_4x4
[0][
mode
], &cu¼Sliû->
mb_´ed
[0][
block_y
], &cu¼Sliû->
mb_Ües
[0][block_y], 
pic_Ýix_x
, 
block_x
);

135 #ifdeà
BEST_NZ_COEFF


136 
cu¼MB
->
cbp_b™s
[0] = cbp_bits;

139 
rdco¡
 = 
cu¼Sliû
->
	`rdco¡_fÜ_4x4_šŒa_blocks
 (
cu¼MB
, &
c_nz
, 
b8
, 
b4
, 
mode
, 
Ïmbda
, 
mo¡ProbabËMode
, 
mš_rdco¡
);

140 ià((
rdco¡
 < 
mš_rdco¡
è|| (rdco¡ =ðmš_rdco¡ && 
mode
 =ð
mo¡ProbabËMode
))

143 
	`memýy
(
p_RDO
->
cofAC4x4
[0], 
ACLev–
, 18 * ());

144 
	`memýy
(
p_RDO
->
cofAC4x4
[1], 
ACRun
, 18 * ());

147 
	`cÝy_4x4block
(
p_RDO
->
»c4x4
[
PLANE_Y
], &
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 0, 
pic_pix_x
);

150 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !cu¼Sliû->
¥2_äame_šdiÿtÜ
)

152 
y
=0; y<4; y++)

154 
	`memýy
(
Ìec4x4
[
y
],&
p_Vid
->
Ìec
[
pic_pix_y
+y][
pic_pix_x
], 
BLOCK_SIZE
 * ());

159 
nÚz”o
 = 
c_nz
;

162 *
mš_co¡
 = 
rdco¡
;

163 
mš_rdco¡
 = 
rdco¡
;

164 
be¡_mode
 = 
mode
;

166 
be¡_nz_cÛff
 = 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
];

167 #ifdeà
BEST_NZ_COEFF


168 
be¡_coded_block_æag
 = ()((
cu¼MB
->
cbp_b™s
[0] >> 
b™_pos
)&(
št64
)(1));

170 ià(
p_Vid
->
Ad­tiveRoundšg
)

172 
	`¡Üe_ad­tive_roundšg_4x4
 (
p_Vid
,…_Vid->
ARCofAdj4x4
, 
I4MB
, 
block_y
, 
block_x
);

177 #ià
INTRA_RDCOSTCALC_NNZ


178 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
] = 
be¡_nz_cÛff
;

180 #ifdeà
BEST_NZ_COEFF


181 
cbp_b™s
 &ð(~(
št64
)(1<<
b™_pos
));

182 
cbp_b™s
 |ð(
št64
)(
be¡_coded_block_æag
<<
b™_pos
);

186 
p_Vid
->
»dmode
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

187 
cu¼MB
->
šŒa_´ed_modes
[4*
b8
+
b4
] =

188 (è(
mo¡ProbabËMode
 =ð
be¡_mode
 ? -1 : (best_ipmode < mostProbableMode ? best_ipmode : best_ipmode-1));

191 
	`memýy
 (
ACLev–
, 
p_RDO
->
cofAC4x4
[0], 18 * ());

192 
	`memýy
 (
ACRun
, 
p_RDO
->
cofAC4x4
[1], 18 * ());

195 
	`cÝy_4x4block
(&
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 
p_RDO
->
»c4x4
[
PLANE_Y
], 
pic_pix_x
, 0);

196 
	`cÝy_4x4block
(&
cu¼Sliû
->
mb_´ed
[0][
block_y
], cu¼Sliû->
m´_4x4
[0][
be¡_mode
], 
block_x
, 0);

199 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !cu¼Sliû->
¥2_äame_šdiÿtÜ
)

201 
y
=0; y<
BLOCK_SIZE
; y++)

203 
	`memýy
 (&
p_Vid
->
Ìec
[
pic_pix_y
+
y
][
pic_pix_x
], 
Ìec4x4
[y], 
BLOCK_SIZE
 * ());

207 ià(
p_Vid
->
Ad­tiveRoundšg
)

209 
	`upd©e_ad­tive_roundšg_4x4
 (
p_Vid
,p_Vid->
ARCofAdj4x4
, 
I4MB
, 
block_y
, 
block_x
);

212  
nÚz”o
;

213 
	}
}

221 
	$mode_decisiÚ_fÜ_I8x8_blocks_JM_High
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
)

223 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

224 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

225 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

226 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

228 
mode
, 
be¡_mode
 = 0, 
j
;

229 
c_nz
, 
nÚz”o
 = 0;

230 
di¡blk
 
rdco¡
 = 0;

231 
di¡blk
 
mš_rdco¡
 = 
DISTBLK_MAX
;

232 
block_x
 = (
b8
 & 0x01) << 3;

233 
block_y
 = (
b8
 >> 1) << 3;

234 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

235 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

236 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

237 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

238 
pic_block_x
 = 
pic_pix_x
 >> 2;

239 
pic_block_y
 = 
pic_pix_y
 >> 2;

240 
mb_block_y
 = (
cu¼MB
->
block_y
è+ ((
b8
 >> 1) << 1);

241 
mb_block_x
 = (
cu¼MB
->
block_x
è+ ((
b8
 & 0x01) << 1);

242 *
p_AC8x8
 = 
p_RDO
->
cÛfAC8x8šŒa
[
b8
][0][0][0];

243 *
cofAC
 = 
cu¼Sliû
->cofAC[
b8
][0][0];

245 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

246 **
mb_Ües
 = 
cu¼Sliû
->mb_ores[0];

247 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

249 
upMode
, 
ËáMode
;

250 
mo¡ProbabËMode
;

252 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

254 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

256 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

257 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

260 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

262 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
 [Ëá_block.
mb_addr
] : 0;

263 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
 [tÝ_block.
mb_addr
 ] : 0;

266 if(
b8
 >> 1)

267 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : () -1;

269 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
 [tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : () -1;

271 if(
b8
 & 0x01)

272 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : () -1;

274 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : () -1;

276 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

277 *
mš_co¡
 = 
DISTBLK_MAX
;

278 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

281 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

284 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

286 ifÐ(
mode
==
DC_PRED
) ||

287 ((
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
è&& 
up_avažabË
 ) ||

288 ((
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
è&& 
Ëá_avažabË
 ) ||

289 (
®l_avažabË
) )

291 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

293 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], 
cu¼Sliû
->
m´_8x8
[0][
mode
], &
mb_´ed
[
block_y
], &
mb_Ües
[block_y], 
pic_Ýix_x
, 
block_x
);

295 
cu¼MB
->
mode_DPCM
 = (è
mode
;

299 
rdco¡
 = 
cu¼Sliû
->
	`rdco¡_fÜ_8x8_šŒa_blocks
 (
cu¼MB
, &
c_nz
, 
b8
, 
mode
, 
Ïmbda
, 
mš_rdco¡
, 
mo¡ProbabËMode
);

300 ià((
rdco¡
 < 
mš_rdco¡
è|| (rdco¡ =ðmš_rdco¡ && 
mode
 =ð
mo¡ProbabËMode
))

303 
	`memýy
(
p_AC8x8
, 
cofAC
, 4 * 2 * 65 * ());

306 
	`cÝy_image_d©a_8x8
(
p_RDO
->
»c8x8
[
PLANE_Y
], &
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 0, 
pic_pix_x
);

308 ià(
p_Vid
->
Ad­tiveRoundšg
)

310 
j
 = 
block_y
; j < block_y + 8; j++)

311 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[0][
DUMMY
][
j
][
block_x
],&p_Vid->ARCofAdj8x8[0][
I8MB
][j][block_x], 8 * ());

315 
nÚz”o
 = 
c_nz
;

318 *
mš_co¡
 = 
rdco¡
;

319 
mš_rdco¡
 = 
rdco¡
;

320 
be¡_mode
 = 
mode
;

326 
p_Vid
->
»dmode8x8
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

327 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

329 
cu¼MB
->
šŒa_´ed_modes8x8
[4*
b8
] = (è((
mo¡ProbabËMode
 =ð
be¡_mode
)

331 : (
be¡_mode
 < 
mo¡ProbabËMode
 ? best_ipmode : best_ipmode - 1));

333 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
mb_block_y
 ][
mb_block_x
], 
be¡_mode
, 2 * ());

334 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
mb_block_y
 + 1][
mb_block_x
], 
be¡_mode
, 2 * ());

337 
	`memýy
(
cofAC
, 
p_AC8x8
, 4 * 2 * 65 * ());

339 ià(
p_Vid
->
Ad­tiveRoundšg
)

341 
j
=
block_y
; j< block_y + 8; j++)

342 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[0][
I8MB
][
j
][
block_x
], &p_Vid->ARCofAdj8x8[0][
DUMMY
][j][block_x], 8 * ());

346 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 
p_RDO
->
»c8x8
[0], 
pic_pix_x
, 0);

347 
	`cÝy_image_d©a_8x8
(&
mb_´ed
[
block_y
], 
cu¼Sliû
->
m´_8x8
[0][
be¡_mode
], 
block_x
, 0);

349  
nÚz”o
;

350 
	}
}

358 
	$Mode_DecisiÚ_fÜ_IÁ¿SubMBlocks
(
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
co¡
, 
nÚ_z”o
[3])

360 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

361 
b4
;

362 
di¡blk
 
co¡4x4
;

363 
cu¼MB
->
ü_cbp
[0] = 0;

364 
cu¼MB
->
ü_cbp
[1] = 0;

365 
cu¼MB
->
ü_cbp
[2] = 0;

367 
	`mem£t
(
nÚ_z”o
, 0, 3 * ());

368 *
co¡
 = 
	`weigh‹d_co¡
(
Ïmbda
, 6);

369 
b4
=0; b4<4; b4++)

371 
nÚ_z”o
[0] |ð
cu¼Sliû
->
	`mode_decisiÚ_fÜ_I4x4_blocks
 (
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, &
co¡4x4
);

372 
nÚ_z”o
[1] |ð
cu¼MB
->
ü_cbp
[1];

373 
nÚ_z”o
[2] |ð
cu¼MB
->
ü_cbp
[2];

374 *
co¡
 +ð
co¡4x4
;

377  
nÚ_z”o
[0];

378 
	}
}

386 
	$mode_decisiÚ_fÜ_I4x4_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
, 
di¡blk
* 
co¡
)

388 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

389 
cbp
=0, 
b8
;

390 
di¡blk
 
co¡8x8
;

391 
nÚ_z”o
[3] = {0, 0, 0};

393 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

395 *
co¡
=0, 
b8
=0; b8<4; b8++)

397 ià(
	`Mode_DecisiÚ_fÜ_IÁ¿SubMBlocks
 (
cu¼MB
, 
b8
, 
Ïmbda
, &
co¡8x8
, 
nÚ_z”o
))

399 
cbp
 |ð(1<<
b8
);

401 *
co¡
 +ð
co¡8x8
;

402 ià(
nÚ_z”o
[1])

404 
cu¼Sliû
->
cmp_cbp
[1] |ð(1<<
b8
);

405 
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[1];

406 
cu¼Sliû
->
cmp_cbp
[1] = 
cbp
;

407 
cu¼Sliû
->
cmp_cbp
[2] = 
cbp
;

409 ià(
nÚ_z”o
[2])

411 
cu¼Sliû
->
cmp_cbp
[2] |ð(1<<
b8
);

412 
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[2];

413 
cu¼Sliû
->
cmp_cbp
[1] = 
cbp
;

414 
cu¼Sliû
->
cmp_cbp
[2] = 
cbp
;

417  
cbp
;

418 
	}
}

420 
	$fšd_be¡_mode_I16x16_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
, 
di¡blk
 
mš_co¡
)

422 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

423 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

424  (è
cu¼Sliû
->
	`fšd_§d_16x16
 (
cu¼MB
);

425 
	}
}

433 
	$mode_decisiÚ_fÜ_I16x16_MB
 (
Maüoblock
* 
cu¼MB
, 
Ïmbda
)

435 
	`fšd_be¡_mode_I16x16_MB
 (
cu¼MB
, 
Ïmbda
, 
DISTBLK_MAX
);

436  
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_Y
);

437 
	}
}

445 
	$mode_decisiÚ_fÜ_I16x16_MB_RDO
 (
Maüoblock
* 
cu¼MB
, 
Ïmbda
)

447 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

448 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

449 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

451 
SyÁaxEËm’t
 
£
;

452 cÚ¡ * 
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

453 
D©aP¬t™iÚ
* 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_MBTYPE
]]);

455 
di¡blk
 
mš_rdco¡
 = 
DISTBLK_MAX
, 
rdco¡
;

456 
di¡blk
 
di¡ÜtiÚY
;

457 
¿‹
;

458 
i
,
k
;

459 
b8
, 
b4
;

462 
up_avaž
, 
Ëá_avaž
, 
Ëá_up_avaž
;

464 
be¡_mode
 = 0, 
be¡_cbp
 = 0;

465 
be¡CofAC
[4][4][2][65];

466 
be¡CofDC
[2][18];

467 
img³l
 
be¡Rec
[
MB_BLOCK_SIZE
][MB_BLOCK_SIZE];

469 
cu¼MB
->
mb_ty³
 = 
I16MB
;

471 
cu¼Sliû
->
	`£t_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_Y
, &
Ëá_avaž
, &
up_avaž
, &
Ëá_up_avaž
);

473 
k
 = 0;k < 4; k++)

475 ià(
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
 =ð0 || (
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
))

477 ià(
p_IÅ
->
IÁ¿16x16P¬Di§bË
 && (
k
==
VERT_PRED_16
||k==
HOR_PRED_16
))

480 ià(
p_IÅ
->
IÁ¿16x16PÏÃDi§bË
 && 
k
==
PLANE_16
)

484 ià((
k
==0 && !
up_avaž
è|| (k==1 && !
Ëá_avaž
è|| (k==3 && (!Ëá_avaž || !up_avaž || !
Ëá_up_avaž
)))

487 
	`g‘_šŒ­»d_16x16
(
cu¼MB
, 
PLANE_Y
, 
k
, 
Ëá_avaž
, 
up_avaž
);

489 
cu¼MB
->
i16mode
 = (è
k
;

490 
cu¼MB
->
cbp
 = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
(cu¼MB, 
PLANE_Y
);

491 
di¡ÜtiÚY
 = 
	`compu‹_SSE16x16_th»s
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
], &p_Vid->
’c_piùu»
->
p_cu¼_img
[cu¼MB->
pix_y
], cu¼MB->
pix_x
, cu¼MB->pix_x, 
mš_rdco¡
);

493 ià(
di¡ÜtiÚY
 < 
mš_rdco¡
 - 
	`weigh‹d_co¡
(
Ïmbda
, 4))

495 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

496 
cu¼MB
->
i16off£t
 = 
	`I16Off£t
 (cu¼MB->
cbp
, cu¼MB->
i16mode
);

497 
£
.
v®ue1
 = 
	`MBTy³2V®ue
 (
cu¼MB
);

498 
£
.
v®ue2
 = 0;

499 
£
.
ty³
 = 
SE_MBTYPE
;

501 
cu¼Sliû
->
	`wr™eMB_ty³Info
 (
cu¼MB
, &
£
, 
d©aP¬t
);

503 
¿‹
 = 
£
.
Ën
;

504 ià(
di¡ÜtiÚY
 + 
	`weigh‹d_co¡
(
Ïmbda
, 
¿‹
è< 
mš_rdco¡
)

506 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff16x16
 (
cu¼MB
, 
PLANE_Y
);

507 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

509 
rdco¡
 = 
di¡ÜtiÚY
 + 
	`weigh‹d_co¡
(
Ïmbda
, 
¿‹
);

511 if(
rdco¡
 < 
mš_rdco¡
)

513 
mš_rdco¡
 = 
rdco¡
;

514 
be¡_mode
 = 
k
;

515 
be¡_cbp
 = 
cu¼MB
->
cbp
;

516 
b8
 = 0; b8 < 4; b8++)

518 
b4
 = 0; b4 < 4; b4++)

520 
	`memýy
(
be¡CofAC
[
b8
][
b4
][0], 
cu¼Sliû
->
cofAC
[b8][b4][0], () * 65);

521 
	`memýy
(
be¡CofAC
[
b8
][
b4
][1], 
cu¼Sliû
->
cofAC
[b8][b4][1], () * 65);

525 
	`memýy
(
be¡CofDC
[0], 
cu¼Sliû
->
cofDC
[0][0], ()*18);

526 
	`memýy
(
be¡CofDC
[1], 
cu¼Sliû
->
cofDC
[0][1], ()*18);

528 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

529 
	`memýy
(
be¡Rec
[
i
], &
p_Vid
->
’c_piùu»
->
p_cu¼_img
[
cu¼MB
->
pix_y
 + i][cu¼MB->
pix_x
], (
img³l
)*
MB_BLOCK_SIZE
);

534 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_tmp
);

539 
cu¼MB
->
i16mode
 = (è
be¡_mode
;

540 
cu¼MB
->
cbp
 = 
be¡_cbp
;

541 
cu¼MB
->
i16off£t
 = 
	`I16Off£t
 (cu¼MB->
cbp
, cu¼MB->
i16mode
);

543 
b8
 = 0; b8 < 4; b8++)

545 
b4
 = 0; b4 < 4; b4++)

547 
	`memýy
(
cu¼Sliû
->
cofAC
[
b8
][
b4
][0], 
be¡CofAC
[b8][b4][0], ()*65);

548 
	`memýy
(
cu¼Sliû
->
cofAC
[
b8
][
b4
][1], 
be¡CofAC
[b8][b4][1], ()*65);

552 
	`memýy
(
cu¼Sliû
->
cofDC
[0][0], 
be¡CofDC
[0], ()*18);

553 
	`memýy
(
cu¼Sliû
->
cofDC
[0][1], 
be¡CofDC
[1], ()*18);

555 
i
 = 0; i < 
MB_BLOCK_SIZE
; i++)

557 
	`memýy
(&
p_Vid
->
’c_piùu»
->
p_cu¼_img
[
cu¼MB
->
pix_y
+
i
][cu¼MB->
pix_x
], 
be¡Rec
[i], 
MB_BLOCK_SIZE
*(
img³l
));

560  
cu¼MB
->
cbp
;

561 
	}
}

	@lencod/src/rd_intra_jm444.c

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"maüoblock.h
"

24 
	~"mb_acûss.h
"

25 
	~"rdÝt_codšg_¡©e.h
"

26 
	~"mode_decisiÚ.h
"

27 
	~"rdÝt.h
"

28 
	~"rd_šŒa_jm.h
"

29 
	~"q_¬ound.h
"

30 
	~"šŒa4x4.h
"

31 
	~"rd_šŒa_jm.h
"

32 
	~"blk_´ediùiÚ.h
"

40 
	$mode_decisiÚ_fÜ_I4x4_blocks_JM_High444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
)

42 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

43 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

44 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

45 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

47 
mode
, 
be¡_mode
 = 0, 
y
, 
dummy
;

48 
c_nz
, 
nÚz”o
 = 0;

49 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][0];

50 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
b8
][
b4
][1];

51 
uv
;

52 
di¡blk
 
rdco¡
 = 0;

53 
di¡blk
 
mš_rdco¡
 = 
DISTBLK_MAX
;

54 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

55 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

56 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

57 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

58 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

59 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

60 
pic_block_x
 = 
pic_pix_x
 >> 2;

61 
pic_block_y
 = 
pic_pix_y
 >> 2;

63 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

64 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

66 
upMode
, 
ËáMode
;

67 
mo¡ProbabËMode
;

69 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

71 
Ìec4x4
[4][4];

72 
be¡_nz_cÛff
 = 0;

73 
block_x4
 = 
block_x
>>2;

74 
block_y4
 = 
block_y
>>2;

76 #ifdeà
BEST_NZ_COEFF


77 
be¡_coded_block_æag
 = 0;

78 
b™_pos
 = 1 + ((((
b8
>>1)<<1)+(
b4
>>1))<<2) + (((b8&1)<<1)+(b4&1));

79 
št64
 
cbp_b™s
;

81 ià(
b8
==0 && 
b4
==0)

82 
cbp_b™s
 = 0;

85 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

86 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

89 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

91 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
[Ëá_block.
mb_addr
] : 0;

92 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
[tÝ_block.
mb_addr
] : 0;

95 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

96 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

98 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

99 *
mš_co¡
 = 
DISTBLK_MAX
;

100 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

104 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

106 ià(
cu¼Sliû
->
P444_jošed
)

108 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

109 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_U
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

110 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

111 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_V
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

112 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

116 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

118 
avažabË_mode
 = (
®l_avažabË
è|| (
mode
==
DC_PRED
) ||

119 (
up_avažabË
 && (
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
)) ||

120 (
Ëá_avažabË
 && (
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
));

122 ià(
	`v®id_šŒa_mode
(
cu¼Sliû
, 
mode
) == 0)

125 ifÐ
avažabË_mode
)

128 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

131 
	`g’”©e_´ed_”rÜ_4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], 
cu¼Sliû
->
m´_4x4
[0][
mode
], &cu¼Sliû->
mb_´ed
[0][
block_y
], &cu¼Sliû->
mb_Ües
[0][block_y], 
pic_Ýix_x
, 
block_x
);

133 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV444
)

135 
cu¼MB
->
mode_DPCM
 = (è
mode
;

136 ià(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0)

139 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_U
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

140 
	`g’”©e_´ed_”rÜ_4x4
(&
p_Vid
->
pImgOrg
[1][
pic_Ýix_y
], 
cu¼Sliû
->
m´_4x4
[1][
mode
], &cu¼Sliû->
mb_´ed
[1][
block_y
], &cu¼Sliû->
mb_Ües
[1][block_y], 
pic_Ýix_x
, 
block_x
);

142 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_V
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

143 
	`g’”©e_´ed_”rÜ_4x4
(&
p_Vid
->
pImgOrg
[2][
pic_Ýix_y
], 
cu¼Sliû
->
m´_4x4
[2][
mode
], &cu¼Sliû->
mb_´ed
[2][
block_y
], &cu¼Sliû->
mb_Ües
[2][block_y], 
pic_Ýix_x
, 
block_x
);

148 #ifdeà
BEST_NZ_COEFF


149 
cu¼MB
->
cbp_b™s
[0] = cbp_bits;

152 
rdco¡
 = 
cu¼Sliû
->
	`rdco¡_fÜ_4x4_šŒa_blocks
 (
cu¼MB
, &
c_nz
, 
b8
, 
b4
, 
mode
, 
Ïmbda
, 
mo¡ProbabËMode
, 
mš_rdco¡
);

153 ià((
rdco¡
 < 
mš_rdco¡
è|| (rdco¡ =ðmš_rdco¡ && 
mode
 =ð
mo¡ProbabËMode
))

156 
	`memýy
(
p_RDO
->
cofAC4x4
[0], 
ACLev–
, 18 * ());

157 
	`memýy
(
p_RDO
->
cofAC4x4
[1], 
ACRun
, 18 * ());

160 
	`cÝy_4x4block
(
p_RDO
->
»c4x4
[
PLANE_Y
], &
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 0, 
pic_pix_x
);

163 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !cu¼Sliû->
¥2_äame_šdiÿtÜ
)

165 
y
=0; y<4; y++)

167 
	`memýy
(
Ìec4x4
[
y
],&
p_Vid
->
Ìec
[
pic_pix_y
+y][
pic_pix_x
], 
BLOCK_SIZE
 * ());

171 if(
cu¼Sliû
->
P444_jošed
)

174 
uv
=0; uv < 2; uv++)

176 
	`memýy
(
p_RDO
->
cofAC4x4CbCr
[
uv
][0],
cu¼Sliû
->
cofAC
[
b8
+4+uv*4][
b4
][0], 18 * ());

177 
	`memýy
(
p_RDO
->
cofAC4x4CbCr
[
uv
][1],
cu¼Sliû
->
cofAC
[
b8
+4+uv*4][
b4
][1], 18 * ());

178 
cu¼MB
->
ü_cbp
[
uv
 + 1] = cu¼MB->
c_nzCbCr
[uv + 1];

181 
	`cÝy_4x4block
(
p_RDO
->
»c4x4
[
uv
 + 1], &
p_Vid
->
’c_piùu»
->
imgUV
[uv][
pic_pix_y
], 0, 
pic_pix_x
);

185 
nÚz”o
 = 
c_nz
;

188 *
mš_co¡
 = 
rdco¡
;

189 
mš_rdco¡
 = 
rdco¡
;

190 
be¡_mode
 = 
mode
;

192 
be¡_nz_cÛff
 = 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
];

193 #ifdeà
BEST_NZ_COEFF


194 
be¡_coded_block_æag
 = ()((
cu¼MB
->
cbp_b™s
[0] >> 
b™_pos
)&(
št64
)(1));

196 ià(
p_Vid
->
Ad­tiveRoundšg
)

198 
	`¡Üe_ad­tive_roundšg_4x4
 (
p_Vid
,…_Vid->
ARCofAdj4x4
, 
I4MB
, 
block_y
, 
block_x
);

203 #ià
INTRA_RDCOSTCALC_NNZ


204 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
] = 
be¡_nz_cÛff
;

206 #ifdeà
BEST_NZ_COEFF


207 
cbp_b™s
 &ð(~(
št64
)(1<<
b™_pos
));

208 
cbp_b™s
 |ð(
št64
)(
be¡_coded_block_æag
<<
b™_pos
);

212 
p_Vid
->
»dmode
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

213 
cu¼MB
->
šŒa_´ed_modes
[4*
b8
+
b4
] =

214 (è(
mo¡ProbabËMode
 =ð
be¡_mode
 ? -1 : (best_ipmode < mostProbableMode ? best_ipmode : best_ipmode-1));

216 if(
cu¼Sliû
->
P444_jošed
)

218 
CÞÜPÏÃ
 
k
;

219 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

221 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

223 
	`cÝy_4x4block
(&
cu¼Sliû
->
mb_´ed
[
k
][
block_y
], cu¼Sliû->
m´_4x4
[k][
be¡_mode
], 
block_x
, 0);

233 
	`compu‹_»sidue
(&(
p_Vid
->
pImgOrg
[
k
][
cu¼MB
->
pix_y
+
block_y
]), &
cu¼Sliû
->
mb_´ed
[k][block_y], &cu¼Sliû->
mb_Ües
[k][block_y], 
block_x
, cu¼MB->
pix_x
+block_x, 4, 4);

234 
cu¼MB
->
ü_cbp
[
k
] = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
(cu¼MB, k, 
block_x
,
block_y
,&
dummy
,1);

236 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

240 
	`memýy
 (
ACLev–
, 
p_RDO
->
cofAC4x4
[0], 18 * ());

241 
	`memýy
 (
ACRun
, 
p_RDO
->
cofAC4x4
[1], 18 * ());

244 
	`cÝy_4x4block
(&
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 
p_RDO
->
»c4x4
[
PLANE_Y
], 
pic_pix_x
, 0);

245 
	`cÝy_4x4block
(&
cu¼Sliû
->
mb_´ed
[0][
block_y
], cu¼Sliû->
m´_4x4
[0][
be¡_mode
], 
block_x
, 0);

248 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

250 
y
=0; y<
BLOCK_SIZE
; y++)

252 
	`memýy
 (&
p_Vid
->
Ìec
[
pic_pix_y
+
y
][
pic_pix_x
], 
Ìec4x4
[y], 
BLOCK_SIZE
 * ());

255 ià(
cu¼Sliû
->
P444_jošed
)

257 
uv
=0; uv < 2; uv++ )

260 
	`memýy
(
cu¼Sliû
->
cofAC
[
b8
+4+
uv
*4][
b4
][0], 
p_RDO
->
cofAC4x4CbCr
[uv][0], 18 * ());

261 
	`memýy
(
cu¼Sliû
->
cofAC
[
b8
+4+
uv
*4][
b4
][1], 
p_RDO
->
cofAC4x4CbCr
[uv][1], 18 * ());

263 
	`cÝy_4x4block
(&
p_Vid
->
’c_piùu»
->
imgUV
[
uv
][
pic_pix_y
], 
p_RDO
->
»c4x4
[uv + 1], 
pic_pix_x
, 0);

264 
	`cÝy_4x4block
(&
cu¼Sliû
->
mb_´ed
[
uv
 + 1][
block_y
], cu¼Sliû->
m´_4x4
[uv + 1][
be¡_mode
], 
block_x
, 0);

268 ià(
p_Vid
->
Ad­tiveRoundšg
)

270 
	`upd©e_ad­tive_roundšg_4x4
 (
p_Vid
,p_Vid->
ARCofAdj4x4
, 
I4MB
, 
block_y
, 
block_x
);

273  
nÚz”o
;

274 
	}
}

282 
	$mode_decisiÚ_fÜ_I4x4_blocks_JM_Low444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
)

284 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

285 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

286 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

288 
mode
, 
be¡_mode
 = 0, 
dummy
;

289 
di¡blk
 
co¡
;

290 
nÚz”o
 = 0;

292 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

293 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

294 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

295 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

296 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

297 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

298 
pic_block_x
 = 
pic_pix_x
 >> 2;

299 
pic_block_y
 = 
pic_pix_y
 >> 2;

301 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

303 
upMode
, 
ËáMode
;

304 
mo¡ProbabËMode
;

306 
Pix–Pos
 
Ëá_block
;

307 
Pix–Pos
 
tÝ_block
;

309 
di¡blk
 
fixedco¡
 = 
	`weigh‹d_co¡
(
Ïmbda
, 4);

310 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

311 
be¡_nz_cÛff
 = 0;

312 
block_x4
 = 
block_x
>>2;

313 
block_y4
 = 
block_y
>>2;

315 #ifdeà
BEST_NZ_COEFF


316 
be¡_coded_block_æag
 = 0;

317 
b™_pos
 = 1 + ((((
b8
>>1)<<1)+(
b4
>>1))<<2) + (((b8&1)<<1)+(b4&1));

318 
št64
 
cbp_b™s
;

320 ià(
b8
==0 && 
b4
==0)

321 
cbp_b™s
 = 0;

324 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

325 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

328 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

330 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
[Ëá_block.
mb_addr
] : 0;

331 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
[tÝ_block.
mb_addr
] : 0;

334 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

335 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

337 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

338 *
mš_co¡
 = 
DISTBLK_MAX
;

339 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

343 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

345 ià(
cu¼Sliû
->
P444_jošed
)

347 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

348 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_U
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

349 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

350 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_V
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

351 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

355 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

357 
avažabË_mode
 = (
®l_avažabË
è|| (
mode
==
DC_PRED
) ||

358 (
up_avažabË
 && (
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
)) ||

359 (
Ëá_avažabË
 && (
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
));

361 ià(
	`v®id_šŒa_mode
(
cu¼Sliû
, 
mode
) == 0)

364 ifÐ
avažabË_mode
)

369 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

370 
co¡
 = (
mode
 =ð
mo¡ProbabËMode
è? 0 : 
fixedco¡
;

371 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡4x4
(
p_Vid
, &p_Vid->
pCurImg
[
pic_Ýix_y
], cu¼Sliû->
m´_4x4
[0][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

372 ià(
cu¼Sliû
->
P444_jošed
)

374 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_U
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

375 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡4x4
(
p_Vid
, &p_Vid->
pImgOrg
[1][
pic_Ýix_y
], cu¼Sliû->
m´_4x4
[1][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

376 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_V
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

377 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡4x4
(
p_Vid
, &p_Vid->
pImgOrg
[2][
pic_Ýix_y
], cu¼Sliû->
m´_4x4
[2][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

380 ià(
co¡
 < *
mš_co¡
)

382 
be¡_mode
 = 
mode
;

383 *
mš_co¡
 = 
co¡
;

388 #ià
INTRA_RDCOSTCALC_NNZ


389 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
] = 
be¡_nz_cÛff
;

391 #ifdeà
BEST_NZ_COEFF


392 
cbp_b™s
 &ð(~(
št64
)(1<<
b™_pos
));

393 
cbp_b™s
 |ð(
št64
)(
be¡_coded_block_æag
<<
b™_pos
);

396 
p_Vid
->
»dmode
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

397 
cu¼MB
->
šŒa_´ed_modes
[4*
b8
+
b4
] =

398 (è(
mo¡ProbabËMode
 =ð
be¡_mode
 ? -1 : (best_ipmode < mostProbableMode ? best_ipmode : best_ipmode-1));

401 
	`g’”©e_´ed_”rÜ_4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], 
cu¼Sliû
->
m´_4x4
[0][
be¡_mode
], &cu¼Sliû->
mb_´ed
[0][
block_y
], &cu¼Sliû->
mb_Ües
[0][block_y], 
pic_Ýix_x
, 
block_x
);

403 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

405 
	`£Ëù_ŒªsfÜm
(
cu¼MB
);

406 
nÚz”o
 = 
cu¼MB
->
ü_cbp
[0] = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
dummy
, 1);

408 ià(
cu¼Sliû
->
P444_jošed
)

410 
CÞÜPÏÃ
 
k
;

411 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

413 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

424 
	`cÝy_4x4block
(&
cu¼Sliû
->
mb_´ed
[
k
][
block_y
], cu¼Sliû->
m´_4x4
[k][
be¡_mode
], 
block_x
, 0);

425 
	`compu‹_»sidue
(&(
p_Vid
->
pImgOrg
[
k
][
pic_Ýix_y
]), &
cu¼Sliû
->
mb_´ed
[k][
block_y
], &cu¼Sliû->
mb_Ües
[k][block_y], 
block_x
, 
pic_Ýix_x
, 4, 4);

426 
cu¼MB
->
ü_cbp
[
k
] = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, k, 
block_x
, 
block_y
, &
dummy
, 1);

428 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

431  
nÚz”o
;

432 
	}
}

440 
	$mode_decisiÚ_fÜ_I16x16_MB_444
 (
Maüoblock
* 
cu¼MB
, 
Ïmbda
)

442 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

443 
cbp
;

444 
	`fšd_be¡_mode_I16x16_MB
(
cu¼MB
, 
Ïmbda
, 
DISTBLK_MAX
);

446 ià(!
cu¼Sliû
->
P444_jošed
)

448 
cbp
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_Y
);

452 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

454 
cbp
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_Y
);

455 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

456 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_U
);

457 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

458 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_16x16
 (cu¼MB, 
PLANE_V
);

459 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

461 
cbp
 |ð(
cu¼Sliû
->
cmp_cbp
[1] | currSlice->cmp_cbp[2]);

462 
cu¼Sliû
->
cmp_cbp
[1] = 
cbp
;

463 
cu¼Sliû
->
cmp_cbp
[2] = 
cbp
;

466  
cbp
;

467 
	}
}

	@lencod/src/rd_intra_jm_low.c

18 
	~<lim™s.h
>

20 
	~"glob®.h
"

22 
	~"image.h
"

23 
	~"maüoblock.h
"

24 
	~"mb_acûss.h
"

25 
	~"rdÝt_codšg_¡©e.h
"

26 
	~"mode_decisiÚ.h
"

27 
	~"rdÝt.h
"

28 
	~"rd_šŒa_jm.h
"

29 
	~"q_¬ound.h
"

30 
	~"šŒa4x4.h
"

31 
	~"šŒa8x8.h
"

39 
	$mode_decisiÚ_fÜ_I4x4_blocks_JM_Low
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
b4
, 
Ïmbda
, 
di¡blk
* 
mš_co¡
)

41 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

42 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

43 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

45 
mode
, 
be¡_mode
 = 0, 
dummy
;

46 
nÚz”o
 = 0;

47 
di¡blk
 
co¡
;

48 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

49 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

50 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

51 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

52 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

54 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

55 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

57 
upMode
, 
ËáMode
;

58 
mo¡ProbabËMode
;

60 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

62 
di¡blk
 
fixedco¡
 = 
	`weigh‹d_co¡
(
Ïmbda
, 4);

63 
di¡blk
 
Úeco¡
 = 
	`weigh‹d_co¡
(
Ïmbda
, 1);

65 
be¡_nz_cÛff
 = 0;

66 
block_x4
 = 
block_x
>>2;

67 
block_y4
 = 
block_y
>>2;

68 
img³l
 ***
m´4x4
 = 
cu¼Sliû
->
m´_4x4
[0];

69 
img³l
 **
cur_img
 = &
p_Vid
->
pCurImg
[
pic_Ýix_y
];

71 #ifdeà
BEST_NZ_COEFF


72 
be¡_coded_block_æag
 = 0;

73 
b™_pos
 = 1 + ((((
b8
>>1)<<1)+(
b4
>>1))<<2) + (((b8&1)<<1)+(b4&1));

74 
št64
 
cbp_b™s
;

76 ià(
b8
==0 && 
b4
==0)

77 
cbp_b™s
 = 0;

80 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

81 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

84 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

86 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
[Ëá_block.
mb_addr
] : 0;

87 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
[tÝ_block.
mb_addr
] : 0;

90 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : () -1;

91 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : () -1;

93 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

94 *
mš_co¡
 = 
DISTBLK_MAX
;

96 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

100 
cu¼Sliû
->
	`£t_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

103 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

105 
avažabË_mode
 = (
®l_avažabË
è|| (
mode
==
DC_PRED
) ||

106 (
up_avažabË
 && (
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
)) ||

107 (
Ëá_avažabË
 && (
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
));

109 ifÐ
	`v®id_šŒa_mode
(
cu¼Sliû
, 
mode
è!ð0 && 
avažabË_mode
)

112 
	`g‘_šŒ­»d_4x4
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
block_x
, 
block_y
, 
Ëá_avažabË
, 
up_avažabË
);

114 
co¡
 = (
mode
 =ð
mo¡ProbabËMode
è? 
Úeco¡
 : 
fixedco¡
;

115 ià(
co¡
 < *
mš_co¡
)

117 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡4x4
(
p_Vid
, 
cur_img
, 
m´4x4
[
mode
], 
pic_pix_x
, *
mš_co¡
 - cost);

119 ià(
co¡
 < *
mš_co¡
)

121 
be¡_mode
 = 
mode
;

122 *
mš_co¡
 = 
co¡
;

128 #ià
INTRA_RDCOSTCALC_NNZ


129 
p_Vid
->
nz_cÛff
 [
cu¼MB
->
mbAddrX
][
block_x4
][
block_y4
] = 
be¡_nz_cÛff
;

131 #ifdeà
BEST_NZ_COEFF


132 
cbp_b™s
 &ð(~(
št64
)(1<<
b™_pos
));

133 
cbp_b™s
 |ð(
št64
)(
be¡_coded_block_æag
<<
b™_pos
);

137 
p_Vid
->
»dmode
[
pic_pix_y
 >> 2][
pic_pix_x
 >> 2] = (è
be¡_mode
;

138 
cu¼MB
->
šŒa_´ed_modes
[4*
b8
+
b4
] = (è(
mo¡ProbabËMode
 =ð
be¡_mode
 ? -1 : (best_ipmode < mostProbableMode ? best_ipmode : best_ipmode - 1));

141 
	`g’”©e_´ed_”rÜ_4x4
(
cur_img
, 
m´4x4
[
be¡_mode
], &
cu¼Sliû
->
mb_´ed
[0][
block_y
], &cu¼Sliû->
mb_Ües
[0][block_y], 
pic_pix_x
, 
block_x
);

143 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

145 
	`£Ëù_ŒªsfÜm
(
cu¼MB
);

147 ià(
cu¼MB
->
mb_ty³
 =ð
I4MB
)

148 
nÚz”o
 = 
cu¼MB
->
ü_cbp
[0] = 
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
dummy
, 1);

150 
nÚz”o
 = 
cu¼MB
->
ü_cbp
[0] = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
dummy
, 1);

152  
nÚz”o
;

153 
	}
}

162 
	$mode_decisiÚ_fÜ_I8x8_blocks_JM_Low
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
)

164 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

165 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

166 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

168 
mode
, 
be¡_mode
 = 0, 
j
, 
dummy
;

169 
di¡blk
 
co¡
;

170 
nÚz”o
 = 0;

171 
block_x
 = (
b8
 & 0x01) << 3;

172 
block_y
 = (
b8
 >> 1) << 3;

173 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

174 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

175 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

176 
mb_block_y
 = (
cu¼MB
->
block_y
) + (block_y >> 2);

177 
mb_block_x
 = (
cu¼MB
->
block_x
) + (block_x >> 2);

179 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

180 **
mb_Ües
 = 
cu¼Sliû
->mb_ores[0];

181 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

182 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

184 
upMode
;

185 
ËáMode
;

186 
mo¡ProbabËMode
;

187 
fixedco¡
 = (è
	`weigh‹d_co¡
(
Ïmbda
, 4);

188 
m´obco¡
 = (è
	`weigh‹d_co¡
(
Ïmbda
, 1);

190 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

192 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

193 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

195 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

197 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
 [tÝ_block.
mb_addr
] : 0;

198 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
 [Ëá_block.
mb_addr
] : 0;

201 if(
b8
 >> 1)

202 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

204 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
 [tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

206 if(
b8
 & 0x01)

207 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

209 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

211 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

212 *
mš_co¡
 = 
DISTBLK_MAX
;

213 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

216 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

219 
mode
 = 
mo¡ProbabËMode
;

221 ifÐ(
mode
==
DC_PRED
) ||

222 ((
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
è&& 
up_avažabË
 ) ||

223 ((
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
è&& 
Ëá_avažabË
 ) ||

224 (
®l_avažabË
) )

226 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

227 
co¡
 = 
m´obco¡
;

228 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡8x8
(
p_Vid
, &p_Vid->
pImgOrg
[0][
pic_Ýix_y
], cu¼Sliû->
m´_8x8
[0][
mode
], 
pic_pix_x
, *
mš_co¡
 - cost);

229 
be¡_mode
 = 
mo¡ProbabËMode
;

230 *
mš_co¡
 = 
co¡
;

235 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

237 ià(
mode
 !ð
mo¡ProbabËMode
)

239 ifÐ(
mode
==
DC_PRED
) ||

240 ((
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
è&& 
up_avažabË
 ) ||

241 ((
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
è&& 
Ëá_avažabË
 ) ||

242 (
®l_avažabË
) )

244 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

245 
co¡
 = 
fixedco¡
;

247 ià(
co¡
 < *
mš_co¡
)

249 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡8x8
(
p_Vid
, &p_Vid->
pImgOrg
[0][
pic_Ýix_y
], cu¼Sliû->
m´_8x8
[0][
mode
], 
pic_pix_x
, *
mš_co¡
 - cost);

250 ià(
co¡
 < *
mš_co¡
)

252 
be¡_mode
 = 
mode
;

253 *
mš_co¡
 = 
co¡
;

261 
p_Vid
->
»dmode8x8
[
pic_pix_y
 >> 2][
pic_pix_x
 >> 2] = (è
be¡_mode
;

262 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

264 
cu¼MB
->
šŒa_´ed_modes8x8
[4*
b8
] = ()((
mo¡ProbabËMode
 =ð
be¡_mode
)

266 : (
be¡_mode
 < 
mo¡ProbabËMode
 ? best_ipmode : best_ipmode-1));

268 
j
 = 
mb_block_y
; j < mb_block_y + 2; j++)

269 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
j
][
mb_block_x
], 
be¡_mode
, 2 * ());

272 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], 
cu¼Sliû
->
m´_8x8
[0][
be¡_mode
], &
mb_´ed
[
block_y
], &
mb_Ües
[block_y], 
pic_pix_x
, 
block_x
);

273 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

275 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
b8
, &
dummy
, 1);

276  
nÚz”o
;

277 
	}
}

	@lencod/src/rdopt.c

18 
	~<m©h.h
>

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

23 
	~"rdÝt.h
"

24 
	~"q_¬ound.h
"

25 
	~"rdÝt_codšg_¡©e.h
"

26 
	~"mem®loc.h
"

27 
	~"mb_acûss.h
"

28 
	~"–em’ts.h
"

29 
	~"šŒ¬eäesh.h
"

30 
	~"image.h
"

31 
	~"ŒªsfÜm8x8.h
"

32 
	~"ÿbac.h
"

33 
	~"bŸr›ncode.h
"

34 
	~"¦iû.h
"

35 
	~"vlc.h
"

36 
	~"¿‹ùl.h
"

37 
	~"mode_decisiÚ.h
"

38 
	~"rd_šŒa_jm.h
"

39 
	~"rd_šŒa_jm444.h
"

40 
	~"maüoblock.h
"

41 
	~"q_off£ts.h
"

42 
	~"cÚfÜmªû.h
"

43 
	~"”rdo.h
"

44 
	~"mv_£¬ch.h
"

45 
	~"md_commÚ.h
"

46 
	~"md_di¡ÜtiÚ.h
"

47 
	~"šŒa16x16.h
"

49 
	#FASTMODE
 1

	)

51 
£t_¡Üed_maüoblock_·¿m‘”s
 (
Maüoblock
 *
cu¼MB
);

52 
£t_¡Üed_maüoblock_·¿m‘”s_¥
 (
Maüoblock
 *
cu¼MB
);

53 
£t_¡Üed_maüoblock_·¿m‘”s_m·ss
(
Maüoblock
 *
cu¼MB
);

54 
£t_»f_ªd_mÙiÚ_veùÜs_P_¦iû
 (
Maüoblock
 *
cu¼MB
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Info8x8
 *
´ed
, );

55 
£t_»f_ªd_mÙiÚ_veùÜs_B_¦iû
 (
Maüoblock
 *
cu¼MB
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Info8x8
 *
´ed
, );

57 
di¡blk
 
compu‹_§d4x4_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

58 
di¡blk
 
compu‹_s£4x4_co¡
 (
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

59 
di¡blk
 
compu‹_§td4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

60 
di¡blk
 
compu‹_comp4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, di¡blk 
mš_co¡
);

62 
di¡blk
 
rdco¡_fÜ_4x4_šŒa_blocks
 (
Maüoblock
 *
cu¼MB
, * 
nÚz”o
, 
b8
, 
b4
, 
mode
, 
Ïmbda
, 
mo¡ProbabËMode
, di¡blk 
mš_rdco¡
);

63 
di¡blk
 
rdco¡_fÜ_4x4_šŒa_blocks_444
 (
Maüoblock
 *
cu¼MB
, * 
nÚz”o
, 
b8
, 
b4
, 
mode
, 
Ïmbda
, 
mo¡ProbabËMode
, di¡blk 
mš_rdco¡
);

65 
šlše
 
	$cÝy_mÙiÚ_veùÜs_MB
 (
Sliû
 *
cu¼Sliû
, 
RD_DATA
 *
rdÝt
)

67 
	`memýy
(&
cu¼Sliû
->
®l_mv
 [
LIST_0
][0][0][0][0], &
rdÝt
->®l_mv [LIST_0][0][0][0][0], 288 * cu¼Sliû->
max_num_»ã»nûs
 * (
MÙiÚVeùÜ
));

68 
	}
}

70 
Info8x8
 
	$š™_šfo_8x8_¡ruù
()

72 
Info8x8
 
i8x8
;

73 
i8x8
.
mode
 = 0;

74 
i8x8
.
pdœ
 = 0;

75 
i8x8
.
»f
[
LIST_0
] = 0;

76 
i8x8
.
»f
[
LIST_1
] = -1;

77 
i8x8
.
b»d
 = 0;

79  
i8x8
;

80 
	}
}

82 
	$®loc_rd8x8d©a
 (
RD_8x8DATA
 *
rd_d©a
)

84 
	`g‘_mem2Dšt
(&
rd_d©a
->
Ìec
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

85 
	`g‘_mem2D³l
(&
rd_d©a
->
m´8x8
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

86 
	`g‘_mem3D³l
(&
rd_d©a
->
m´8x8CbCr
, 2, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

87 
	`g‘_mem2D³l
(&
rd_d©a
->
»c_mbY8x8
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

88 
	`g‘_mem3D³l
(&
rd_d©a
->
»c_mb8x8_ü
, 2, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

89 
	}
}

91 
	$ä“_rd8x8d©a
 (
RD_8x8DATA
 *
rd_d©a
)

93 
	`ä“_mem3D³l
(
rd_d©a
->
»c_mb8x8_ü
);

94 
	`ä“_mem2D³l
(
rd_d©a
->
»c_mbY8x8
);

95 
	`ä“_mem3D³l
(
rd_d©a
->
m´8x8CbCr
);

96 
	`ä“_mem2D³l
(
rd_d©a
->
m´8x8
);

97 
	`ä“_mem2Dšt
(
rd_d©a
->
Ìec
);

98 
	}
}

106 
	$þ—r_rdÝt
 (
Sliû
 *
cu¼Sliû
)

108 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

109 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

110 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

112 
	`ä“_mem_DCcÛff
 (
p_RDO
->
cofDC
);

113 
	`ä“_mem_ACcÛff
 (
p_RDO
->
cofAC
);

114 
	`ä“_mem_ACcÛff
 (
p_RDO
->
cofAC4x4š‹º
);

115 
	`ä“_mem_ACcÛff_Ãw
(
p_RDO
->
cÛfAC8x8
);

116 
	`ä“_mem_ACcÛff_Ãw
(
p_RDO
->
cÛfAC8x8šŒa
);

118 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

120 
	`ä“_mem_ACcÛff_Ãw
(
p_RDO
->
cofAC8x8ts
);

123 ià(
p_Vid
->
P444_jošed
)

125 
	`ä“_mem_ACcÛff_Ãw
(
p_RDO
->
cofAC4x4CbCrš‹º
);

129 
	`ä“_rd8x8d©a
(
p_RDO
->
Œ4x4
);

130 
	`ä“
(
p_RDO
->
Œ4x4
);

131 
	`ä“_rd8x8d©a
(
p_RDO
->
Œ8x8
);

132 
	`ä“
(
p_RDO
->
Œ8x8
);

134 
	`ä“_mem4Dmv
(
p_RDO
->
®l_mv8x8
);

136 
	`ä“_mem3D³l
(
p_RDO
->
»c4x4
);

137 
	`ä“_mem3D³l
(
p_RDO
->
»c8x8
);

138 
	`ä“_mem2D³l
(
p_RDO
->
´ed
);

139 
	`ä“_mem3D³l
(
p_RDO
->
»c_mb
);

141 ià(
p_IÅ
->
ProfžeIDC
 =ð
EXTENDED
)

143 
	`ä“_mem2Dšt
(
p_RDO
->
Ìec_»c
);

144 
	`ä“_mem3Dšt
(
p_RDO
->
Ìec_»c_uv
);

147 
	`ä“_mem2D
((
by‹
 **è
p_RDO
->
l0_»fäame
);

148 
	`ä“_mem2D
((
by‹
 **è
p_RDO
->
l1_»fäame
);

151 
	`d–‘e_codšg_¡©e
 (
p_RDO
->
cs_mb
);

152 
	`d–‘e_codšg_¡©e
 (
p_RDO
->
cs_b8
);

153 
	`d–‘e_codšg_¡©e
 (
p_RDO
->
cs_cm
);

154 
	`d–‘e_codšg_¡©e
 (
p_RDO
->
cs_tmp
);

155 
	}
}

157 
	$£tupDi¡Co¡
(
Sliû
 *
cu¼Sliû
, 
IÅutP¬am‘”s
 *
p_IÅ
)

159 
p_IÅ
->
ModeDecisiÚM‘ric
)

161 
ERROR_SAD
:

162 
cu¼Sliû
->
compu‹_co¡4x4
 = 
compu‹_§d4x4_co¡
;

163 
cu¼Sliû
->
compu‹_co¡8x8
 = 
compu‹_§d8x8_co¡
;

164 
cu¼Sliû
->
di¡I16x16
 = 
di¡I16x16_§d
;

166 
ERROR_SSE
:

167 
cu¼Sliû
->
compu‹_co¡4x4
 = 
compu‹_s£4x4_co¡
;

168 
cu¼Sliû
->
compu‹_co¡8x8
 = 
compu‹_s£8x8_co¡
;

169 
cu¼Sliû
->
di¡I16x16
 = 
di¡I16x16_s£
;

171 
ERROR_SATD
:

172 
cu¼Sliû
->
compu‹_co¡4x4
 = 
compu‹_§td4x4_co¡
;

173 
cu¼Sliû
->
compu‹_co¡8x8
 = 
compu‹_§td8x8_co¡
;

174 
cu¼Sliû
->
di¡I16x16
 = 
di¡I16x16_§td
;

177 
cu¼Sliû
->
compu‹_co¡4x4
 = 
compu‹_comp4x4_co¡
;

178 
cu¼Sliû
->
compu‹_co¡8x8
 = 
compu‹_comp8x8_co¡
;

179 
cu¼Sliû
->
di¡I16x16
 = 
di¡I16x16_§td
;

182 
	}
}

191 
	$š™_rdÝt
 (
Sliû
 *
cu¼Sliû
)

193 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

194 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

195 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

197 
	`g‘_mem_DCcÛff
 (&
p_RDO
->
cofDC
);

198 
	`g‘_mem_ACcÛff
 (
p_Vid
, &
p_RDO
->
cofAC
);

199 
	`g‘_mem_ACcÛff
 (
p_Vid
, &
p_RDO
->
cofAC4x4š‹º
);

200 
p_RDO
->
cofAC4x4
 =…_RDO->
cofAC4x4š‹º
[0][0];

201 
	`g‘_mem_ACcÛff_Ãw
(&
p_RDO
->
cÛfAC8x8
, 3);

202 
	`g‘_mem_ACcÛff_Ãw
(&
p_RDO
->
cÛfAC8x8šŒa
, 3);

204 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

206 
	`g‘_mem_ACcÛff_Ãw
(&
p_RDO
->
cofAC8x8ts
, 3);

209 ià(((
p_RDO
->
Œ4x4
èð(
RD_8x8DATA
 *è
	`ÿÎoc
(1, (RD_8x8DATA)))==
NULL
)

210 
	`no_mem_ex™
("init_rdopt:…_RDO->tr4x4");

211 
	`®loc_rd8x8d©a
(
p_RDO
->
Œ4x4
);

212 ià(((
p_RDO
->
Œ8x8
èð(
RD_8x8DATA
 *è
	`ÿÎoc
(1, (RD_8x8DATA)))==
NULL
)

213 
	`no_mem_ex™
("init_rdopt:…_RDO->tr4x4");

214 
	`®loc_rd8x8d©a
(
p_RDO
->
Œ8x8
);

216 
	`g‘_mem2D³l
(&
p_RDO
->
´ed
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

217 
	`g‘_mem3D³l
(&
p_RDO
->
»c8x8
, 3, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8);

218 
	`g‘_mem3D³l
(&
p_RDO
->
»c4x4
, 3, 
BLOCK_SIZE
, BLOCK_SIZE);

219 
	`g‘_mem3D³l
(&
p_RDO
->
»c_mb
, 3, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

221 ià(
p_IÅ
->
ProfžeIDC
 =ð
EXTENDED
)

223 
	`g‘_mem2Dšt
(&
p_RDO
->
Ìec_»c
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

224 
	`g‘_mem3Dšt
(&
p_RDO
->
Ìec_»c_uv
, 2, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

227 
	`g‘_mem2D
((
by‹
 ***è&
p_RDO
->
l0_»fäame
, 4, 4);

228 
	`g‘_mem2D
((
by‹
 ***è&
p_RDO
->
l1_»fäame
, 4, 4);

230 
	`g‘_mem4Dmv
(&
p_RDO
->
®l_mv8x8
, 2, 2, 4, 4);

232 ià(
p_Vid
->
P444_jošed
)

234 
	`g‘_mem_ACcÛff_Ãw
(&
p_RDO
->
cofAC4x4CbCrš‹º
, 2);

236 
p_RDO
->
cofAC4x4CbCr
[0] =…_RDO->
cofAC4x4CbCrš‹º
[0][0][0];

237 
p_RDO
->
cofAC4x4CbCr
[1] =…_RDO->
cofAC4x4CbCrš‹º
[0][1][0];

240 
cu¼Sliû
->
£t_Ïg¿ngŸn_muÉl›rs
 = 
p_IÅ
->
rdÝt
 =ð0 ? 
S‘Lag¿ngŸnMuÉl›rsOff
 : 
S‘Lag¿ngŸnMuÉl›rsOn
;

242 
p_IÅ
->
rdÝt
)

245 
cu¼Sliû
->
’code_Úe_maüoblock
 = 
’code_Úe_maüoblock_low
;

249 
cu¼Sliû
->
’code_Úe_maüoblock
 = 
’code_Úe_maüoblock_high
;

252 
cu¼Sliû
->
’code_Úe_maüoblock
 = 
’code_Úe_maüoblock_highç¡
;

255 
cu¼Sliû
->
’code_Úe_maüoblock
 = 
’code_Úe_maüoblock_highloss
;

258 
cu¼Sliû
->
’code_Úe_maüoblock
 = 
’code_Úe_maüoblock_high_upd©ed
;

262 ià(
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1))

263 
cu¼Sliû
->
£t_¡Üed_mb_·¿m‘”s
 = 
£t_¡Üed_maüoblock_·¿m‘”s_m·ss
;

266 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

267 
cu¼Sliû
->
£t_¡Üed_mb_·¿m‘”s
 = 
£t_¡Üed_maüoblock_·¿m‘”s_¥
;

269 
cu¼Sliû
->
£t_¡Üed_mb_·¿m‘”s
 = 
£t_¡Üed_maüoblock_·¿m‘”s
;

273 
p_RDO
->
cs_mb
 = 
	`ü—‹_codšg_¡©e
 (
p_IÅ
);

274 
p_RDO
->
cs_b8
 = 
	`ü—‹_codšg_¡©e
 (
p_IÅ
);

275 
p_RDO
->
cs_cm
 = 
	`ü—‹_codšg_¡©e
 (
p_IÅ
);

276 
p_RDO
->
cs_tmp
 = 
	`ü—‹_codšg_¡©e
 (
p_IÅ
);

277 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

279 
p_Vid
->
mb16x16_co¡
 = 
CALM_MF_FACTOR_THRESHOLD
;

280 
p_RDO
->
Ïmbda_mf_çùÜ
 = 1.0;

283 
cu¼Sliû
->
rdco¡_fÜ_4x4_šŒa_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
rdco¡_fÜ_4x4_šŒa_blocks_444
 :„dcost_for_4x4_intra_blocks;

284 
cu¼Sliû
->
rdco¡_fÜ_8x8_šŒa_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
rdco¡_fÜ_8x8_šŒa_blocks_444
 :„dcost_for_8x8_intra_blocks;

286 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

287 
cu¼Sliû
->
šŒa_chroma_RD_decisiÚ
 = 
šŒa_chroma_RD_decisiÚ_mbaff
;

289 
cu¼Sliû
->
šŒa_chroma_RD_decisiÚ
 = intra_chroma_RD_decision;

290 ià(
p_IÅ
->
rdÝt
 == 0)

292 
cu¼Sliû
->
mode_decisiÚ_fÜ_I8x8_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
mode_decisiÚ_fÜ_I8x8_blocks_JM_Low444
 : 
mode_decisiÚ_fÜ_I8x8_blocks_JM_Low
;

293 
cu¼Sliû
->
mode_decisiÚ_fÜ_I4x4_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
mode_decisiÚ_fÜ_I4x4_blocks_JM_Low444
 : 
mode_decisiÚ_fÜ_I4x4_blocks_JM_Low
;

297 
cu¼Sliû
->
mode_decisiÚ_fÜ_I8x8_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
mode_decisiÚ_fÜ_I8x8_blocks_JM_High444
 : 
mode_decisiÚ_fÜ_I8x8_blocks_JM_High
;

298 
cu¼Sliû
->
mode_decisiÚ_fÜ_I4x4_blocks
 = (
p_Vid
->
yuv_fÜm©
 =ð
YUV444
è? 
mode_decisiÚ_fÜ_I4x4_blocks_JM_High444
 : 
mode_decisiÚ_fÜ_I4x4_blocks_JM_High
;

301 
cu¼Sliû
->
fšd_§d_16x16
 = 
fšd_§d_16x16_JM
;

303 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

304 
cu¼Sliû
->
£t_»f_ªd_mÙiÚ_veùÜs
 = 
£t_»f_ªd_mÙiÚ_veùÜs_B_¦iû
;

306 
cu¼Sliû
->
£t_»f_ªd_mÙiÚ_veùÜs
 = 
£t_»f_ªd_mÙiÚ_veùÜs_P_¦iû
;

308 
	`£tupDi¡ÜtiÚ
(
cu¼Sliû
);

309 
	`£tupDi¡Co¡
 (
cu¼Sliû
, 
p_IÅ
);

310 
	}
}

323 
	$Upd©ePix–M­
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

325 
mx
,
my
,
y
,
x
,
i
,
j
;

326 ià(
p_Vid
->
ty³
==
I_SLICE
)

328 
	`mem£t
(
p_Vid
->
pix–_m­
, 1,…_Vid->
height
 *…_Vid->
width
 * (
by‹
));

332 
my
=0; my<
p_Vid
->
height
 >> 3; my++)

334 
mx
=0; mx<
p_Vid
->
width
 >> 3; mx++)

336 
j
 = 
my
*8 + 8;

337 
i
 = 
mx
*8 + 8;

338 ià(
p_Vid
->
»äesh_m­
[
my
][
mx
])

340 
y
=
my
*8; y<
j
; y++)

341 
	`mem£t
(&
p_Vid
->
pix–_m­
[
y
][
mx
*8], 1, 8 * (
by‹
));

345 
y
=
my
*8; y<
j
; y++)

347 
x
=
mx
*8; x<
i
; x++)

349 
p_Vid
->
pix–_m­
[
y
][
x
] = (
by‹
è
	`imš
Õ_Vid->pix–_m­[y][x] + 1, 
p_IÅ
->
num_»f_äames
+1);

356 
	}
}

376 
	$CheckR–Ÿbž™yOfRef
 (
Maüoblock
 *
cu¼MB
, 
block
, 
li¡_idx
, 
»f
, 
mode
)

378 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

379 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

381 
y
,
x
, 
block_y
, 
block_x
, 
dy
, 
dx
, 
y_pos
, 
x_pos
, 
yy
, 
xx
, 
´es_x
, 
´es_y
;

382 
maxÞd_x
 = 
p_Vid
->
width
 - 1;

383 
maxÞd_y
 = 
p_Vid
->
height
 - 1;

384 
»f_äame
 = 
»f
 + 1;

386 
by0
 = (
mode
>=4?2*(
block
 >> 1):mode==2?2*block:0);

387 
by1
 = 
by0
 + (
mode
>=4||mode==2?2:4);

388 
bx0
 = (
mode
>=4?2*(
block
 & 0x01):mode==3?2*block:0);

389 
bx1
 = 
bx0
 + (
mode
>=4||mode==3?2:4);

391 
block_y
=
by0
; block_y<
by1
; block_y++)

393 
block_x
=
bx0
; block_x<
bx1
; block_x++)

395 
y_pos
 = 
cu¼Sliû
->
®l_mv
[
li¡_idx
][
»f
][
mode
][
block_y
][
block_x
].
mv_y
;

396 
y_pos
 +ð(
cu¼MB
->
block_y
 + block_yè* 
BLOCK_SIZE
 * 4;

397 
x_pos
 = 
cu¼Sliû
->
®l_mv
[
li¡_idx
][
»f
][
mode
][
block_y
][
block_x
].
mv_x
;

398 
x_pos
 +ð(
cu¼MB
->
block_x
 + block_xè* 
BLOCK_SIZE
 * 4;

404 
dy
 = 
y_pos
 & 3;

405 
dx
 = 
x_pos
 & 3;

407 
y_pos
 = (y_po - 
dy
) >> 2;

408 
x_pos
 = (x_po - 
dx
) >> 2;

410 ià(
dy
==0 && 
dx
==0)

412 
y
=
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

413 
x
=
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

414 ià(
p_Vid
->
pix–_m­
[
	`iCl3
(0,
maxÞd_y
,
y
)][iCl3(0,
maxÞd_x
,
x
)] < 
»f_äame
)

419 ià(
dy
 == 0)

421 
y
 = 
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

423 
´es_y
 = 
	`iCl3
(0, 
maxÞd_y
, 
y
);

424 
x
 = 
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

426 
xx
 = -2 ; xx < 4 ; xx++)

428 
´es_x
 = 
	`iCl3
(0, 
maxÞd_x
, 
x
 + 
xx
);

429 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

435 ià(
dx
 == 0)

437 
y
 = 
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

438 
x
 = 
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

440 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
,
x
);

441 
yy
=-2;yy<4;yy++)

443 
´es_y
 = 
	`iCl3
(0,
maxÞd_y
, 
yy
 + 
y
);

444 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

449 ià(
dx
 == 2)

451 
y
 = 
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

452 
x
 = 
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

454 
yy
=-2;yy<4;yy++)

456 
´es_y
 = 
	`iCl3
(0,
maxÞd_y
, 
yy
 + 
y
);

457 
xx
=-2;xx<4;xx++)

459 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
, 
xx
 + 
x
);

460 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

466 ià(
dy
 == 2)

468 
y
 = 
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

469 
x
 = 
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

471 
xx
=-2;xx<4;xx++)

473 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
, 
xx
 + 
x
);

474 
yy
=-2;yy<4;yy++)

476 
´es_y
 = 
	`iCl3
(0,
maxÞd_y
, 
yy
 + 
y
);

477 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

485 
y
 = 
y_pos
 ; y < y_po + 
BLOCK_SIZE
 ; y++)

487 
x
 = 
x_pos
 ; x < x_po + 
BLOCK_SIZE
 ; x++)

489 
´es_y
 = 
dy
 =ð1 ? 
y
 : y + 1;

490 
´es_y
 = 
	`iCl3
(0,
maxÞd_y
,pres_y);

492 
xx
 = -2; xx < 4; xx++)

494 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
,
xx
 + 
x
);

495 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

499 
´es_x
 = 
dx
 =ð1 ? 
x
 : x + 1;

500 
´es_x
 = 
	`iCl3
(0,
maxÞd_x
,pres_x);

502 
yy
=-2;yy<4;yy++)

504 
´es_y
 = 
	`iCl3
(0,
maxÞd_y
, 
yy
 + 
y
);

505 ià(
p_Vid
->
pix–_m­
[
´es_y
][
´es_x
] < 
»f_äame
)

515 
	}
}

523 
di¡blk
 
	$rdco¡_fÜ_4x4_šŒa_blocks
 (
Maüoblock
 *
cu¼MB
,

524 * 
nÚz”o
,

525 
b8
,

526 
b4
,

527 
mode
,

528 
Ïmbda
,

529 
mo¡ProbabËMode
,

530 
di¡blk
 
mš_rdco¡
)

532 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

533 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

534 
di¡blk
 
rdco¡
;

535 
dummy
 = 0, 
¿‹
;

536 
di¡blk
 
di¡ÜtiÚ
 = 0;

537 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

538 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

539 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

540 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

541 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

543 
SyÁaxEËm’t
 
£
;

544 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

546 
D©aP¬t™iÚ
 *
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

551 
cu¼MB
->
mode_DPCM
 = (è
mode
;

552 *
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
dummy
, 1);

555 
di¡ÜtiÚ
 +ð
	`compu‹_SSE4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
imgY
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

556 #ià
INTRA_RDCOSTCALC_ET


558 ià(
di¡ÜtiÚ
 >ð
mš_rdco¡
)

560  (
di¡ÜtiÚ
);

563 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

566 
£
.
v®ue1
 = (
mo¡ProbabËMode
 =ð
mode
) ? -1 : ipmode < mostProbableMode ? ipmode : ipmode - 1;

569 
£
.
cÚ‹xt
 = (
b8
 << 2è+ 
b4
;

570 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

573 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

574 
¿‹
 = 
£
.
Ën
;

577 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

579 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 
b4
, 0);

583 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
PLANE_Y
, 
b8
, 
b4
, 1);

586 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weigh‹d_co¡
(
Ïmbda
, 
¿‹
);

588 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

590  
rdco¡
;

591 
	}
}

600 
di¡blk
 
	$rdco¡_fÜ_4x4_šŒa_blocks_444
 (
Maüoblock
 *
cu¼MB
,

601 * 
nÚz”o
,

602 
b8
,

603 
b4
,

604 
mode
,

605 
Ïmbda
,

606 
mo¡ProbabËMode
,

607 
di¡blk
 
mš_rdco¡
)

609 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

610 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

611 
di¡blk
 
rdco¡
;

612 
dummy
 = 0, 
¿‹
;

613 
di¡blk
 
di¡ÜtiÚ
 = 0;

614 
block_x
 = ((
b8
 & 0x01è<< 3è+ ((
b4
 & 0x01) << 2);

615 
block_y
 = ((
b8
 >> 1è<< 3è+ ((
b4
 >> 1) << 2);

616 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

617 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

618 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

620 
SyÁaxEËm’t
 
£
;

621 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

622 
D©aP¬t™iÚ
 *
d©aP¬t
;

623 
CÞÜPÏÃ
 
k
;

627 *
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
 (cu¼MB, 
PLANE_Y
, 
block_x
, 
block_y
, &
dummy
, 1);

630 
di¡ÜtiÚ
 +ð
	`compu‹_SSE4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
imgY
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

632 if(
p_Vid
->
P444_jošed
)

634 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

636 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

637 
cu¼MB
->
c_nzCbCr
[
k
] = cu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_4x4
(cu¼MB, k, 
block_x
, 
block_y
, &
dummy
, 1);

638 
di¡ÜtiÚ
 +ð
	`compu‹_SSE4x4
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
p_cu¼_img
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

640 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

642 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

645 
£
.
v®ue1
 = (
mo¡ProbabËMode
 =ð
mode
) ? -1 : ipmode < mostProbableMode ? ipmode : ipmode - 1;

648 
£
.
cÚ‹xt
 = (
b8
 << 2è+ 
b4
;

649 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

652 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

654 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

655 
¿‹
 = 
£
.
Ën
;

658 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

660 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 
b4
, 0);

661 if(
p_Vid
->
P444_jošed
)

663 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CB
, 
b8
, 
b4
, 0);

664 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CR
, 
b8
, 
b4
, 0);

669 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
PLANE_Y
, 
b8
, 
b4
, 1);

670 if(
p_Vid
->
P444_jošed
)

672 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
PLANE_U
, 
b8
, 
b4
, 1);

673 
¿‹
 +ð
	`wr™eCÛff4x4_CABAC
 (
cu¼MB
, 
PLANE_V
, 
b8
, 
b4
, 1);

676 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
,
¿‹
);

677 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

679  
rdco¡
;

680 
	}
}

688 
di¡blk
 
	$rdco¡_fÜ_8x8blocks
 (
Maüoblock
 *
cu¼MB
,

689 
RD_8x8DATA
 *
d©aTr
,

690 * 
út_nÚz
,

691 
št64
* 
cbp_blk
,

692 
Ïmbda
,

693 
block
,

694 
mode
,

695 
Info8x8
 *
·¹
,

696 
di¡blk
 
mš_rdco¡
)

698 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

699 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

700 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

701 
pic_·¿m‘”_£t_rb¥_t
 *
aùive_µs
 = 
p_Vid
->active_pps;

702 
¿‹
=0;

703 
di¡blk
 
di¡ÜtiÚ
=0;

705 
dummy
 = 0, 
m¿‹
;

706 
li¡_mode
[2];

707 
cbp
 = 0;

708 
·x
 = 8*(
block
 & 0x01);

709 
·y
 = 8*(
block
 >> 1);

710 
i0
 = 
·x
 >> 2;

711 
j0
 = 
·y
 >> 2;

712 
dœeù
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && 
mode
==0);

713 
b8v®ue
 = 
	`B8Mode2V®ue
 (
cu¼Sliû
, (è
mode
, 
·¹
->
pdœ
);

715 
SyÁaxEËm’t
 
£
;

716 
D©aP¬t™iÚ
 *
d©aP¬t
;

717 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

719 
EncodšgEnvœÚm’tPŒ
 
“p_dp
;

721 
pdœ
 = 
·¹
->pdir;

722 
l0_»f
 = 
·¹
->
»f
[
LIST_0
];

723 
l1_»f
 = 
·¹
->
»f
[
LIST_1
];

728 
cu¼MB
->
b8x8
[
block
].
b»d
 = 
·¹
->bipred;

729 
cu¼MB
->
¬_mode
 = (è((
mode
 !ð0)? mode: 
P8x8
);

732 ià(
dœeù
)

734 
p_dœ
 = 
cu¼Sliû
->
dœeù_pdœ
[
cu¼MB
->
block_y
 + 
j0
][cu¼MB->
block_x
 + 
i0
];

735 ià(
p_dœ
 < 0)

736  (
DISTBLK_MAX
);

739 
li¡_mode
[2] = {0, 0};

740 *
út_nÚz
 = 
cu¼Sliû
->
	`luma_»sidu®_codšg_8x8
 (
cu¼MB
, &
cbp
, 
cbp_blk
, 
block
, (è
p_dœ
, 
li¡_mode
,

741 
cu¼Sliû
->
dœeù_»f_idx
[
cu¼MB
->
block_y
+
j0
][cu¼MB->
block_x
+
i0
]);

746 ià(
pdœ
 =ð2 && 
aùive_µs
->
weigh‹d_b»d_idc
 == 1)

749 
weight_sum
 = (
aùive_µs
->
weigh‹d_b»d_idc
 =ð1)? 
cu¼Sliû
->
wbp_weight
[0][
l0_»f
][
l1_»f
][0] + currSlice->wbp_weight[1][l0_ref][l1_ref][0] : 0;

750 ià(
weight_sum
 < -128 || weight_sum > 127)

752  (
DISTBLK_MAX
);

756 
li¡_mode
[0] = (
pdœ
==0||pdœ==2 ? 
mode
 : 0);

757 
li¡_mode
[1] = (
pdœ
==1||pdœ==2 ? 
mode
 : 0);

758 *
út_nÚz
 = 
cu¼Sliû
->
	`luma_»sidu®_codšg_8x8
 (
cu¼MB
, &
cbp
, 
cbp_blk
, 
block
, 
pdœ
, 
li¡_mode
, 
·¹
->
»f
);

761 if(
p_Vid
->
P444_jošed
)

763 *
út_nÚz
 +ðÐ
cu¼Sliû
->
cÛff_co¡_ü
[1] + currSlice->coeff_cost_cr[2] );

767 ià(
p_IÅ
->
rdÝt
==3)

770 
di¡ÜtiÚ
 = 
p_Vid
->
	`e¡im©e_di¡ÜtiÚ
(
cu¼MB
, 
block
, 8, 
mode
, 
pdœ
, 
mš_rdco¡
);

774 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
 + 
·y
], &p_Vid->
’c_piùu»
->
imgY
[cu¼MB->
pix_y
 +…ay], cu¼MB->
pix_x
 + 
·x
, currMB->pix_x +…ax);

777 ià(
p_Vid
->
P444_jošed
)

779 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pImgOrg
[1][
cu¼MB
->
Ýix_y
 + 
·y
], &p_Vid->
’c_piùu»
->
imgUV
[0][cu¼MB->
pix_y
 +…ay], cu¼MB->
pix_x
 + 
·x
, currMB->pix_x +…ax);

780 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pImgOrg
[2][
cu¼MB
->
Ýix_y
 + 
·y
], &p_Vid->
’c_piùu»
->
imgUV
[1][cu¼MB->
pix_y
 +…ay], cu¼MB->
pix_x
 + 
·x
, currMB->pix_x +…ax);

784 ià(
di¡ÜtiÚ
 >ð
mš_rdco¡
)

785  (
di¡ÜtiÚ
);

788 if(
p_Vid
->
P444_jošed
)

790 
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[1];

791 
cbp
 |ð
cu¼Sliû
->
cmp_cbp
[2];

793 
cu¼Sliû
->
cmp_cbp
[1] = 
cbp
;

794 
cu¼Sliû
->
cmp_cbp
[2] = 
cbp
;

801 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

803 
	`ue_lšfo
 (
b8v®ue
, 
dummy
, &
m¿‹
, &dummy);

804 
¿‹
 +ð
m¿‹
;

808 
£
.
v®ue1
 = 
b8v®ue
;

809 
£
.
ty³
 = 
SE_MBTYPE
;

810 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
£
.
ty³
]]);

811 
cu¼Sliû
->
	`wr™eB8_ty³Info
(&
£
, 
d©aP¬t
);

812 
¿‹
 +ð
£
.
Ën
;

816 ià(!
dœeù
)

818 ià((
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] > 1 ) && (
pdœ
==0 ||…dir==2))

819 
¿‹
 +ð
	`wr™eReã»nûF¿me
 (
cu¼MB
, 
i0
, 
j0
, 
LIST_0
, 
l0_»f
);

821 ià((
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] > 1 && cu¼Sliû->
¦iû_ty³
 =ð
B_SLICE
 ) && (
pdœ
==1 ||…dir==2))

823 
¿‹
 +ð
	`wr™eReã»nûF¿me
 (
cu¼MB
, 
i0
, 
j0
, 
LIST_1
, 
l1_»f
);

826 ià(
pdœ
==0 ||…dir==2)

828 
¿‹
 +ð
	`wr™eMÙiÚVeùÜ8x8
 (
cu¼MB
, 
i0
, 
j0
, i0 + 2, j0 + 2, 
l0_»f
, 
LIST_0
, 
mode
, cu¼MB->
b8x8
[
block
].
b»d
);

830 ià(
pdœ
==1 ||…dir==2)

832 
¿‹
 +ð
	`wr™eMÙiÚVeùÜ8x8
 (
cu¼MB
, 
i0
, 
j0
, i0 + 2, j0 + 2, 
l1_»f
, 
LIST_1
, 
mode
, cu¼MB->
b8x8
[
block
].
b»d
);

837 ià(!
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

839 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_CBP
]]);

840 
“p_dp
 = &(
d©aP¬t
->
“_ÿbac
);

841 
m¿‹
 = 
	`¬›nco_b™s_wr™‹n
 (
“p_dp
);

842 
	`wr™eCBP_BIT_CABAC
 (
cu¼MB
, 
block
, ((*
út_nÚz
>0)?1:0), 
d©aTr
->
cbp8x8
, 
“p_dp
, 
cu¼Sliû
->
‹x_ùx
);

843 
m¿‹
 = 
	`¬›nco_b™s_wr™‹n
 (
“p_dp
) - mrate;

844 
¿‹
 +ð
m¿‹
;

848 ià(*
út_nÚz
)

850 
¿‹
 +ð
	`wr™eCÛff8x8
 ( 
cu¼MB
, 
PLANE_Y
, 
block
, 
mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
);

853 if(
p_Vid
->
P444_jošed
)

855 
¿‹
 +ð
	`wr™eCÛff8x8
Ð
cu¼MB
, 
PLANE_U
, 
block
, 
mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
 );

856 
¿‹
 +ð
	`wr™eCÛff8x8
Ð
cu¼MB
, 
PLANE_V
, 
block
, 
mode
, cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
 );

858  (
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
, 
¿‹
));

859 
	}
}

868 
	$I16Off£t
 (
cbp
, 
i16mode
)

870  (è((
cbp
 & 15 ? 13 : 1è+ 
i16mode
 + ((cbp & 0x30) >> 2));

871 
	}
}

880 
	$£t_modes_ªd_»fs_fÜ_blocks_i_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
)

882 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

884 
i
,
j
;

885 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

886 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

889 
cu¼MB
->
mb_ty³
 = 
mode
;

890 
cu¼MB
->
¬_mode
 = 
mode
;

892  
i
 = 0; i < 4; i++)

894 
cu¼MB
->
b8x8
[
i
] = 
b8x8šfo
->
be¡
[
mode
][i];

898 
mode
)

900 
I4MB
:

901 
i
=0;i<4;i++)

903 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IBLOCK
;

904 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

907 
I16MB
:

909 
cu¼MB
->
b8x8
[0].
mode
 = 0;

910 
cu¼MB
->
b8x8
[1].
mode
 = 0;

911 
cu¼MB
->
b8x8
[2].
mode
 = 0;

912 
cu¼MB
->
b8x8
[3].
mode
 = 0;

913 
i
=0;i<4;i++)

915 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

918 
I8MB
:

919 
i
=0;i<4;i++)

921 
cu¼MB
->
b8x8
[
i
].
mode
 = 
I8MB
;

922 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

925 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

927 
IPCM
:

928 
i
=0;i<4;i++)

930 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IPCM
;

931 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

933 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

936 
	`´štf
 ("Unsupported mode in set_modes_and_refs_for_blocks!\n");

937 
	`ex™
 (1);

941 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

943 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

945 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
NULL
;

946 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = -1;

949 
	}
}

958 
	$£t_modes_ªd_»fs_fÜ_blocks_p_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
)

960 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

961 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

963 
i
,
j
,
k
;

965 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

966 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

969 
cu¼MB
->
mb_ty³
 = 
mode
;

971  
i
 = 0; i < 4; i++)

973 
cu¼MB
->
b8x8
[
i
] = 
b8x8šfo
->
be¡
[
mode
][i];

976 
cu¼MB
->
¬_mode
 = 
mode
;

979 
mode
)

982 
cu¼MB
->
b8x8
[0].
mode
 = 0;

983 
cu¼MB
->
b8x8
[1].
mode
 = 0;

984 
cu¼MB
->
b8x8
[2].
mode
 = 0;

985 
cu¼MB
->
b8x8
[3].
mode
 = 0;

986 
cu¼MB
->
b8x8
[0].
pdœ
 = 0;

987 
cu¼MB
->
b8x8
[1].
pdœ
 = 0;

988 
cu¼MB
->
b8x8
[2].
pdœ
 = 0;

989 
cu¼MB
->
b8x8
[3].
pdœ
 = 0;

994 
i
=0;i<4;i++)

996 
cu¼MB
->
b8x8
[
i
].
mode
 = () mode;

999 
P8x8
:

1001 
I4MB
:

1002 
i
=0;i<4;i++)

1004 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IBLOCK
;

1005 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1008 
I16MB
:

1010 
cu¼MB
->
b8x8
[0].
mode
 = 0;

1011 
cu¼MB
->
b8x8
[1].
mode
 = 0;

1012 
cu¼MB
->
b8x8
[2].
mode
 = 0;

1013 
cu¼MB
->
b8x8
[3].
mode
 = 0;

1014 
i
=0;i<4;i++)

1016 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1019 
I8MB
:

1020 
i
=0;i<4;i++)

1022 
cu¼MB
->
b8x8
[
i
].
mode
 = 
I8MB
;

1023 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1026 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

1028 
IPCM
:

1029 
i
=0;i<4;i++)

1031 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IPCM
;

1032 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1034 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

1037 
	`´štf
 ("Unsupported mode in set_modes_and_refs_for_blocks!\n");

1038 
	`ex™
 (1);

1042 ià(
mode
==0 || mode==
I4MB
 || mode==
I16MB
 || mode==
I8MB
 || mod=ð
IPCM
 || mod=ð
SI4MB
)

1044 ià(!
mode
)

1046 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1047 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

1048 
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_0
] = 0;

1052 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1053 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

1054 
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_0
] = -1;

1059 ià(
mode
 == 1)

1061 
cu¼ef
 = 
b8x8šfo
->
be¡
[
mode
][0].
pdœ
 =ð0 ? b8x8šfo->be¡[mode][0].
»f
[
LIST_0
] : -1;

1062 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1064 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

1066 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1067 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
cu¼ef
;

1071 ià(
mode
 == 2)

1073 
cu¼ef
 = 
b8x8šfo
->
be¡
[
mode
][0].
pdœ
 =ð0 ? b8x8šfo->be¡[mode][0].
»f
[
LIST_0
] : -1;

1074 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 2; j++)

1076 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

1078 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1079 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
cu¼ef
;

1082 
cu¼ef
 = 
b8x8šfo
->
be¡
[
mode
][2].
pdœ
 =ð0 ? b8x8šfo->be¡[mode][2].
»f
[
LIST_0
] : -1;

1083 
j
 = 
cu¼MB
->
block_y
 + 2; j < currMB->block_y + 4; j++)

1085 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

1087 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1088 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
cu¼ef
;

1092 ià(
mode
 == 3)

1094 
cu¼ef
 = (
b8x8šfo
->
be¡
[
mode
][0].
pdœ
 =ð0è? b8x8šfo->be¡[mode][0].
»f
[
LIST_0
] : -1;

1095 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1097 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 2;i++)

1099 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1100 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
cu¼ef
;

1103 
cu¼ef
 = (
b8x8šfo
->
be¡
[
mode
][1].
pdœ
 =ð0è? b8x8šfo->be¡[mode][1].
»f
[
LIST_0
] : -1;

1104 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1106 
i
 = 
cu¼MB
->
block_x
 + 2; i < currMB->block_x + 4;i++)

1108 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1109 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = (è
cu¼ef
;

1115 
block_x
, 
block_y
;

1116 
cu¼ef
;

1117 
j
 = 0; j < 4; j++)

1119 
block_x
 = 
cu¼MB
->block_x;

1120 
block_y
 = 
cu¼MB
->block_y + 
j
;

1121 
k
 = 2*(
j
 >> 1);

1122 
cu¼ef
 = 
b8x8šfo
->
be¡
[
mode
][
k
++].
»f
[
LIST_0
];

1123 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1124 
mÙiÚ
[
block_y
][
block_x
++].
»f_idx
[
LIST_0
] = (è
cu¼ef
;

1125 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1126 
mÙiÚ
[
block_y
][
block_x
++].
»f_idx
[
LIST_0
] = (è
cu¼ef
;

1127 
cu¼ef
 = 
b8x8šfo
->
be¡
[
mode
][
k
].
»f
[
LIST_0
];

1128 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1129 
mÙiÚ
[
block_y
][
block_x
++].
»f_idx
[
LIST_0
] = (è
cu¼ef
;

1130 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
cu¼ef
];

1131 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
] = (è
cu¼ef
;

1135 
	}
}

1144 
	$£t_modes_ªd_»fs_fÜ_blocks_b_¦iû
(
Maüoblock
 *
cu¼MB
, 
mode
)

1146 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1147 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1149 
i
,
j
,
k
;

1150 
block_x
, 
block_y
, 
block8x8
, 
block4x4
;

1151 
cur_»f
;

1152 
þi¡
;

1153 
cu¼ef
, 
be¡»f
;

1154 
Block8x8Info
 *
b8x8šfo
 = 
p_Vid
->b8x8info;

1155 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1158 
cu¼MB
->
mb_ty³
 = 
mode
;

1159 
cu¼MB
->
¬_mode
 = 
mode
;

1161  
i
 = 0; i < 4; i++)

1163 
cu¼MB
->
b8x8
[
i
] = 
b8x8šfo
->
be¡
[
mode
][i];

1167 
mode
)

1170 
cu¼MB
->
b8x8
[0].
mode
 = 0;

1171 
cu¼MB
->
b8x8
[1].
mode
 = 0;

1172 
cu¼MB
->
b8x8
[2].
mode
 = 0;

1173 
cu¼MB
->
b8x8
[3].
mode
 = 0;

1175 
cu¼MB
->
b8x8
[0].
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[cu¼MB->
block_y
 ][cu¼MB->
block_x
 ];

1176 
cu¼MB
->
b8x8
[1].
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[cu¼MB->
block_y
 ][cu¼MB->
block_x
 + 2];

1177 
cu¼MB
->
b8x8
[2].
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[cu¼MB->
block_y
 + 2][cu¼MB->
block_x
 ];

1178 
cu¼MB
->
b8x8
[3].
pdœ
 = 
cu¼Sliû
->
dœeù_pdœ
[cu¼MB->
block_y
 + 2][cu¼MB->
block_x
 + 2];

1183 
i
=0;i<4;i++)

1185 
cu¼MB
->
b8x8
[
i
].
mode
 = () mode;

1188 
P8x8
:

1190 
I4MB
:

1191 
i
=0;i<4;i++)

1193 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IBLOCK
;

1194 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1197 
I16MB
:

1198 
i
=0;i<4;i++)

1200 
cu¼MB
->
b8x8
[
i
].
mode
 = 0;

1201 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1204 
I8MB
:

1205 
i
=0;i<4;i++)

1207 
cu¼MB
->
b8x8
[
i
].
mode
 = 
I8MB
;

1208 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1211 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
TRUE
;

1213 
IPCM
:

1214 
i
=0;i<4;i++)

1216 
cu¼MB
->
b8x8
[
i
].
mode
 = 
IPCM
;

1217 
cu¼MB
->
b8x8
[
i
].
pdœ
 = -1;

1219 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

1222 
	`´štf
 ("Unsupported mode in set_modes_and_refs_for_blocks!\n");

1223 
	`ex™
 (1);

1226 
	#IS_FW
 ((
b8x8šfo
->
be¡
[
mode
][
k
].
pdœ
==0 || b8x8šfo->be¡[mode][k].pdœ==2è&& (mode!=
P8x8
 || b8x8šfo->be¡[mode][k].mode!=0))

	)

1227 
	#IS_BW
 ((
b8x8šfo
->
be¡
[
mode
][
k
].
pdœ
==1 || b8x8šfo->be¡[mode][k].pdœ==2è&& (mode!=
P8x8
 || b8x8šfo->be¡[mode][k].mode!=0))

	)

1230 ià(
mode
 == 0)

1232 
þi¡
 = 
LIST_0
; cli¡ <ð
LIST_1
; clist++)

1234 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1236 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

1237 
mÙiÚ
[
j
][
i
].
»f_idx
[
þi¡
] = 
cu¼Sliû
->
dœeù_»f_idx
[j][i][clist];

1241 ià(
mode
==
I4MB
 || mode==
I16MB
 || mode==
I8MB
 || mod=ð
IPCM
)

1243 
þi¡
 = 
LIST_0
; cli¡ <ð
LIST_1
; clist++)

1245 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1247 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

1248 
mÙiÚ
[
j
][
i
].
»f_idx
[
þi¡
] = -1;

1252 ià(
mode
 == 1 || mode == 2 || mode == 3)

1254 
block8x8
 = 0; block8x8 < 4; block8x8++)

1256 
þi¡
 = 
LIST_0
; cli¡ <ð
LIST_1
; clist++)

1258 
be¡»f
 = 
b8x8šfo
->
be¡
[
mode
][
block8x8
].
»f
[
þi¡
];

1260 iàÐ
b8x8šfo
->
be¡
[
mode
][
block8x8
].
pdœ
 == 2)

1262 
cu¼ef
 = (
b8x8šfo
->
be¡
[
mode
][
block8x8
].
b»d
è? 0 : 
be¡»f
;

1266 
cu¼ef
 = (
þi¡
 =ð
b8x8šfo
->
be¡
[
mode
][
block8x8
].
pdœ
è? 
be¡»f
 : -1;

1269 
block4x4
 = 0; block4x4 < 4; block4x4++)

1271 
block_x
 = 
cu¼MB
->block_x + 2 * (
block8x8
 & 0x01è+ (
block4x4
 & 0x01);

1272 
block_y
 = 
cu¼MB
->block_y + 2 * (
block8x8
 >> 1è+ (
block4x4
 >> 1);

1273 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
þi¡
] = 
cu¼ef
;

1280 
j
 = 0; j < 4; j++)

1282 
block_y
 = 
cu¼MB
->block_y + 
j
;

1283 
i
 = 0; i < 4; i++)

1285 
block_x
 = 
cu¼MB
->block_x + 
i
;

1286 
k
 = 2*(
j
 >> 1è+ (
i
 >> 1);

1288 if(
b8x8šfo
->
be¡
[
mode
][
k
].mode==0)

1290 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
] = 
cu¼Sliû
->
dœeù_»f_idx
[block_y][block_x][LIST_0];

1291 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_1
] = 
cu¼Sliû
->
dœeù_»f_idx
[block_y][block_x][LIST_1];

1295 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
] = (
IS_FW
 ? 
b8x8šfo
->
be¡
[
mode
][
k
].
»f
[LIST_0] : -1);

1296 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_1
] = (
IS_BW
 ? 
b8x8šfo
->
be¡
[
mode
][
k
].
»f
[LIST_1] : -1);

1302 
þi¡
 = 
LIST_0
; cli¡ <ð
LIST_1
; clist++)

1304 
StÜabËPiùu»
 **
»f_pic
 = 
cu¼Sliû
->
li¡X
[
þi¡
 + 
cu¼MB
->
li¡_off£t
];

1305 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

1307 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4;i++)

1309 
cur_»f
 = (è
mÙiÚ
[
j
][
i
].
»f_idx
[
þi¡
];

1310 
mÙiÚ
[
j
][
i
].
»f_pic
 [
þi¡
] = (
cur_»f
 < 0 ? 
NULL
 :„ef_pic[cur_ref]);

1315 #undeà
IS_FW


1316 #undeà
IS_BW


1317 
	}
}

1326 
	$£t_cÛff_ªd_»cÚ_8x8_p_¦iû
 (
Maüoblock
* 
cu¼MB
)

1328 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1329 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1330 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1331 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

1333 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1334 
block
, 
k
, 
j
, 
i
, 
uv
;

1335 
cur_»f
;

1339 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && (cu¼MB->
v®id_8x8
))

1342 
	`memýy
(
cu¼MB
->
b8x8
, 
p_RDO
->
Œ8x8
->
·¹
, 4 * (
Info8x8
));

1344 
j
 = 0; j < 4; j++)

1346 
i
 = 0; i < 4; i++)

1348 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

1349 
mÙiÚ
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
+
i
].
»f_idx
[
LIST_0
] = 
p_RDO
->
Œ8x8
->
·¹
[
k
].
»f
[LIST_0];

1353 
j
 = 
cu¼MB
->
block_y
;j<cu¼MB->block_y + 
BLOCK_MULTIPLE
;j++)

1355 
i
 = 
cu¼MB
->
block_x
;i<cu¼MB->block_x + 
BLOCK_MULTIPLE
;i++)

1357 
cur_»f
 = (è
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_0
];

1358 
mÙiÚ
[
j
][
i
].
»f_pic
[
LIST_0
] =(
cur_»f
 >ð0 ? 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][cur_»f] : 
NULL
);

1365 
	`StÜeMV8x8
(
cu¼Sliû
, 1);

1367 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 0);

1372 
block
 = 0; block<4; block++)

1374 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
][0][0],
p_RDO
->
cofAC8x8ts
[block][0][0][0], 4 * 2 * 65 * ());

1377 ià(
p_Vid
->
P444_jošed
)

1379 
uv
=0; uv<2; uv++)

1381 
block
 = 0; block<4; block++)

1383 
	`memýy
 (
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0],
p_RDO
->
cofAC8x8ts
[block][uv + 1][0][0], 4 * 2 * 65 * ());

1389 ià(
p_RDO
->
Œ8x8
->
út_nÚz_8x8
 <ð
_LUMA_8x8_COEFF_COST_
 &&

1390 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0) &&

1391 (
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
))

1393 
cu¼MB
->
cbp
 = 0;

1394 
cu¼MB
->
cbp_blk
 = 0;

1396 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8
, cu¼MB->
pix_x
, 0);

1398 if(
p_IÅ
->
rdÝt
 == 3)

1400 
p_Vid
->
p_decs
->
»c_ty³
 = 0;

1403 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1405 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

1407 
	`memýy
(&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
],
p_RDO
->
Œ8x8
->Ìec[j], 
MB_BLOCK_SIZE
 * ());

1413 if(
p_Vid
->
P444_jošed
)

1415 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1416 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8CbCr
[0], cu¼MB->
pix_x
, 0);

1417 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8CbCr
[1], cu¼MB->
pix_x
, 0);

1419 
uv
=0; uv<2; uv++)

1421 
block
 = 0; block<4; block++)

1423 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0], 0, 4 * 2 * 65 * ());

1430 
cu¼MB
->
cbp
 = 
p_RDO
->
Œ8x8
->
cbp8x8
;

1431 
cu¼MB
->
cbp_blk
 = 
p_RDO
->
Œ8x8
->
cbp_blk8x8
;

1433 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mbY8x8
, cu¼MB->
pix_x
, 0);

1435 ià(
p_IÅ
->
rdÝt
 == 3)

1437 
p_Vid
->
p_decs
->
»c_ty³
 = 1;

1440 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1442 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

1444 
	`memýy
 (&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
],
p_RDO
->
Œ8x8
->Ìec[j], 
MB_BLOCK_SIZE
 * ());

1448 ià(
p_Vid
->
P444_jošed
)

1450 
cu¼Sliû
->
cmp_cbp
[1] = cu¼Sliû->cmp_cbp[2] = 
p_RDO
->
Œ8x8
->
cbp8x8
;

1451 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mb8x8_ü
[0], cu¼MB->
pix_x
, 0);

1452 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mb8x8_ü
[1], cu¼MB->
pix_x
, 0);

1455 ià(
p_IÅ
->
rdÝt
 == 3)

1457 
	`”rdo_g‘_be¡_P8x8
(
cu¼MB
, 1);

1465 
block
 = 0; block < 4; block ++)

1467 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
][0][0],
p_RDO
->
cÛfAC8x8
[block][0][0][0], 4 * 2 * 65 * ());

1470 ià(
cu¼Sliû
->
P444_jošed
)

1472 
block
 = 0; block<4; block++)

1474 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
+4][0][0],
p_RDO
->
cÛfAC8x8
[block][1][0][0], 4 * 2 * 65 * ());

1475 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
+8][0][0],
p_RDO
->
cÛfAC8x8
[block][2][0][0], 4 * 2 * 65 * ());

1479 ià(((
p_IÅ
->
di¡h»s
 && 
p_RDO
->
Œ4x4
->
út_nÚz_8x8
 <ð0è|| (p_RDO->Œ4x4->út_nÚz_8x8 <ð5)è&& 
cu¼Sliû
->
¦iû_ty³
 !ð
SP_SLICE
 &&

1480 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

1482 
cu¼MB
->
cbp
 = 0;

1483 
cu¼MB
->
cbp_blk
 = 0;

1485 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8
, cu¼MB->
pix_x
, 0);

1487 if(
p_IÅ
->
rdÝt
 == 3)

1489 
p_Vid
->
p_decs
->
»c_ty³
 = 0;

1492 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1494 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

1496 
	`memýy
 (&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
],
p_RDO
->
Œ4x4
->Ìec[j], 
MB_BLOCK_SIZE
 * ());

1502 ià(
cu¼Sliû
->
P444_jošed
)

1504 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1506 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8CbCr
[0], cu¼MB->
pix_x
, 0);

1507 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8CbCr
[1], cu¼MB->
pix_x
, 0);

1509 
uv
=0; uv<2; uv++)

1511 
block
 = 0; block<4; block++)

1513 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0], 0, 4 * 2 * 65 * ());

1520 
cu¼MB
->
cbp
 = 
p_RDO
->
Œ4x4
->
cbp8x8
;

1521 
cu¼MB
->
cbp_blk
 = 
p_RDO
->
Œ4x4
->
cbp_blk8x8
;

1523 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mbY8x8
, cu¼MB->
pix_x
, 0);

1525 if(
p_IÅ
->
rdÝt
 == 3)

1527 
p_Vid
->
p_decs
->
»c_ty³
 = 1;

1530 if(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
 && !
p_Vid
->
¥2_äame_šdiÿtÜ
)

1532 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

1534 
	`memýy
 (&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
],
p_RDO
->
Œ4x4
->Ìec[j], 
MB_BLOCK_SIZE
 * ());

1537 ià(
cu¼Sliû
->
P444_jošed
)

1539 
cu¼Sliû
->
cmp_cbp
[1] = cu¼Sliû->cmp_cbp[2] = 
p_RDO
->
Œ4x4
->
cbp8x8
;

1540 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mb8x8_ü
[0], cu¼MB->
pix_x
, 0);

1541 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mb8x8_ü
[1], cu¼MB->
pix_x
, 0);

1544 ià(
p_IÅ
->
rdÝt
 == 3)

1546 
	`”rdo_g‘_be¡_P8x8
(
cu¼MB
, 0);

1549 
	}
}

1558 
	$£t_cÛff_ªd_»cÚ_8x8_b_¦iû
 (
Maüoblock
* 
cu¼MB
)

1560 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1561 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1562 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1563 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

1565 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

1566 
block
, 
k
, 
j
, 
i
, 
uv
;

1567 
cur_»f
;

1571 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && (cu¼MB->
v®id_8x8
))

1574 
	`memýy
(
cu¼MB
->
b8x8
, 
p_RDO
->
Œ8x8
->
·¹
, 4 * (
Info8x8
));

1576 
j
 = 0;j<4;j++)

1578 
i
 = 0;i<4;i++)

1580 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

1581 
mÙiÚ
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
+
i
].
»f_idx
[
LIST_0
] = ((cu¼MB->
b8x8
[
k
].
pdœ
 & 0x01è=ð0è? 
p_RDO
->
Œ8x8
->
·¹
[k].
»f
[LIST_0] : - 1;

1582 
mÙiÚ
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
+
i
].
»f_idx
[
LIST_1
] = (cu¼MB->
b8x8
[
k
].
pdœ
 > 0è? 
p_RDO
->
Œ8x8
->
·¹
[k].
»f
[LIST_1] : - 1;

1586 
j
 = 
cu¼MB
->
block_y
;j<cu¼MB->block_y + 
BLOCK_MULTIPLE
;j++)

1588 
i
 = 
cu¼MB
->
block_x
;i<cu¼MB->block_x + 
BLOCK_MULTIPLE
;i++)

1590 
cur_»f
 = (è
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_0
];

1591 
mÙiÚ
[
j
][
i
].
»f_pic
[
LIST_0
] =(
cur_»f
 >ð0 ? 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][cur_»f] : 
NULL
);

1595 
j
 = 
cu¼MB
->
block_y
;j<cu¼MB->block_y + 
BLOCK_MULTIPLE
;j++)

1597 
i
 = 
cu¼MB
->
block_x
;i<cu¼MB->block_x + 
BLOCK_MULTIPLE
;i++)

1599 
cur_»f
 = (è
mÙiÚ
[
j
][
i
].
»f_idx
[
LIST_1
];

1600 
mÙiÚ
[
j
][
i
].
»f_pic
[
LIST_1
] =(
cur_»f
 >ð0 ? 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][cur_»f] : 
NULL
);

1606 
	`StÜeMV8x8
(
cu¼Sliû
, 1);

1608 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 0);

1613 
block
 = 0; block<4; block++)

1615 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
][0][0],
p_RDO
->
cofAC8x8ts
[block][0][0][0], 4 * 2 * 65 * ());

1618 ià(
p_Vid
->
P444_jošed
)

1620 
uv
=0; uv<2; uv++)

1622 
block
 = 0; block<4; block++)

1624 
	`memýy
 (
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0],
p_RDO
->
cofAC8x8ts
[block][uv + 1][0][0], 4 * 2 * 65 * ());

1630 ià(
p_RDO
->
Œ8x8
->
út_nÚz_8x8
 <ð
_LUMA_8x8_COEFF_COST_
 &&

1631 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

1633 
cu¼MB
->
cbp
 = 0;

1634 
cu¼MB
->
cbp_blk
 = 0;

1636 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8
, cu¼MB->
pix_x
, 0);

1638 if(
p_IÅ
->
rdÝt
 == 3)

1640 
p_Vid
->
p_decs
->
»c_ty³
 = 0;

1646 if(
p_Vid
->
P444_jošed
)

1648 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1649 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8CbCr
[0], cu¼MB->
pix_x
, 0);

1650 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
m´8x8CbCr
[1], cu¼MB->
pix_x
, 0);

1652 
uv
=0; uv<2; uv++)

1654 
block
 = 0; block<4; block++)

1656 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0], 0, 4 * 2 * 65 * ());

1663 
cu¼MB
->
cbp
 = 
p_RDO
->
Œ8x8
->
cbp8x8
;

1664 
cu¼MB
->
cbp_blk
 = 
p_RDO
->
Œ8x8
->
cbp_blk8x8
;

1666 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mbY8x8
, cu¼MB->
pix_x
, 0);

1668 if(
p_IÅ
->
rdÝt
 == 3)

1670 
p_Vid
->
p_decs
->
»c_ty³
 = 1;

1674 ià(
p_Vid
->
P444_jošed
)

1676 
cu¼Sliû
->
cmp_cbp
[1] = cu¼Sliû->cmp_cbp[2] = 
p_RDO
->
Œ8x8
->
cbp8x8
;

1677 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mb8x8_ü
[0], cu¼MB->
pix_x
, 0);

1678 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ8x8
->
»c_mb8x8_ü
[1], cu¼MB->
pix_x
, 0);

1681 ià(
p_IÅ
->
rdÝt
 == 3)

1683 
	`”rdo_g‘_be¡_P8x8
(
cu¼MB
, 1);

1688 ià(
cu¼MB
->
v®id_8x8
)

1690 
	`StÜeMV8x8
(
cu¼Sliû
, 1);

1696 
block
 = 0; block < 4; block ++)

1698 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
][0][0],
p_RDO
->
cÛfAC8x8
[block][0][0][0], 4 * 2 * 65 * ());

1701 ià(
cu¼Sliû
->
P444_jošed
)

1703 
block
 = 0; block<4; block++)

1705 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
+4][0][0],
p_RDO
->
cÛfAC8x8
[block][1][0][0], 4 * 2 * 65 * ());

1706 
	`memýy
 (
cu¼Sliû
->
cofAC
[
block
+8][0][0],
p_RDO
->
cÛfAC8x8
[block][2][0][0], 4 * 2 * 65 * ());

1710 ià(((
p_IÅ
->
di¡h»s
 && 
p_RDO
->
Œ4x4
->
út_nÚz_8x8
 <= 0) || (p_RDO->tr4x4->cnt_nonz_8x8 <= 5)) &&

1711 ((
cu¼MB
->
qp_sÿËd
[0])!=0 || 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
==0))

1713 
cu¼MB
->
cbp
 = 0;

1714 
cu¼MB
->
cbp_blk
 = 0;

1716 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8
, cu¼MB->
pix_x
, 0);

1718 if(
p_IÅ
->
rdÝt
 == 3)

1720 
p_Vid
->
p_decs
->
»c_ty³
 = 0;

1723 ià(
cu¼Sliû
->
P444_jošed
)

1725 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

1727 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8CbCr
[0], cu¼MB->
pix_x
, 0);

1728 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
m´8x8CbCr
[1], cu¼MB->
pix_x
, 0);

1730 
uv
=0; uv<2; uv++)

1732 
block
 = 0; block<4; block++)

1734 
	`mem£t
Ð
cu¼Sliû
->
cofAC
[4+
block
+
uv
*4][0][0], 0, 4 * 2 * 65 * ());

1741 
cu¼MB
->
cbp
 = 
p_RDO
->
Œ4x4
->
cbp8x8
;

1742 
cu¼MB
->
cbp_blk
 = 
p_RDO
->
Œ4x4
->
cbp_blk8x8
;

1744 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mbY8x8
, cu¼MB->
pix_x
, 0);

1746 if(
p_IÅ
->
rdÝt
 == 3)

1748 
p_Vid
->
p_decs
->
»c_ty³
 = 1;

1751 ià(
cu¼Sliû
->
P444_jošed
)

1753 
cu¼Sliû
->
cmp_cbp
[1] = cu¼Sliû->cmp_cbp[2] = 
p_RDO
->
Œ4x4
->
cbp8x8
;

1754 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mb8x8_ü
[0], cu¼MB->
pix_x
, 0);

1755 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_y
], 
p_RDO
->
Œ4x4
->
»c_mb8x8_ü
[1], cu¼MB->
pix_x
, 0);

1758 ià(
p_IÅ
->
rdÝt
 == 3)

1760 
	`”rdo_g‘_be¡_P8x8
(
cu¼MB
, 0);

1763 
	}
}

1771 
	$»¡Üe_nz_cÛff
(
Maüoblock
 *
cu¼MB
)

1773 #ifdeà
BEST_NZ_COEFF


1774 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1775 
i
, 
j
;

1776 **
nz_cÛff
 = 
p_Vid
->nz_cÛff[
cu¼MB
->
mbAddrX
];

1777 
j
=0;j<4;j++)

1778 
i
=0; i<(4+
p_Vid
->
num_blk8x8_uv
); i++)

1779 
nz_cÛff
[
j
][
i
] = 
p_Vid
->
g¯iMBAFF_NZCÛff
[j][i];

1781 
	}
}

1784 
	$´•¬e_cm_mode
(
Maüoblock
 *
cu¼MB
)

1786 
i
, 
j
;

1787 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1788 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1790 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], &p_Vid->
pCurImg
[cu¼MB->
Ýix_y
], cu¼MB->
pix_x
, currMB->pix_x);

1793 ià((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 == 0))

1795 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_c_y
], &p_Vid->
pImgOrg
[1][cu¼MB->
Ýix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1796 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_c_y
], &p_Vid->
pImgOrg
[2][cu¼MB->
Ýix_c_y
], cu¼MB->
pix_c_x
, cu¼MB->pix_c_x,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

1799 
j
=0;j<4;j++)

1800 
i
=0; i<(4+
p_Vid
->
num_blk8x8_uv
); i++)

1801 
p_Vid
->
nz_cÛff
[
cu¼MB
->
mbAddrX
][
j
][
i
] = 16;

1802 
	}
}

1810 
	$RDCo¡_fÜ_maüoblocks
 (
Maüoblock
 *
cu¼MB
,

1811 
Ïmbda
,

1812 
mode
)

1814 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

1815 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

1816 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

1817 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

1819 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

1821 
¿‹
 = 0, 
cÛff_¿‹
 = 0;

1822 
di¡blk
 
di¡ÜtiÚ
 = 0;

1823 
Maüoblock
 *
´evMB
 = 
cu¼MB
->
P»vMB
;

1824 
tmp_cc
;

1826 
u£_of_cc
 = (
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
 && cu¼Sliû->
symbÞ_mode
 =ð
CAVLC
);

1827 
cc_¿‹
, 
dummy
;

1829 
di¡blk
 
rdco¡
;

1830 
di¡blk
 
dummy_d
;

1831 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

1832 
img³l
 ***
cu¼_m´_16x16
 = 
cu¼Sliû
->
m´_16x16
[0];

1835 ià((
cu¼Sliû
->
mb_aff_äame_æag
è&& (!
cu¼MB
->
mb_f›ld
è&& (cu¼Sliû->
¦iû_ty³
 =ð
P_SLICE
è&& (
mode
==0) )

1837 ià(
	`out_of_bounds_mvs
(
p_Vid
, &
cu¼Sliû
->
®l_mv
[
LIST_0
][0][0][0][0]))

1841 ià(
mode
 =ð
P8x8
)

1843 if((
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && !cu¼MB->
v®id_8x8
è|| (!cu¼MB->luma_ŒªsfÜm_size_8x8_æag && !cu¼MB->
v®id_4x4
))

1850 
cu¼Sliû
->
	`£t_modes_ªd_»fs_fÜ_blocks
 (
cu¼MB
, 
mode
);

1854 
cu¼Sliû
->
	`£t_mÙiÚ_veùÜs_mb
 (
cu¼MB
);

1859 ià(
mode
 < 
P8x8
)

1861 
cu¼Sliû
->
	`luma_»sidu®_codšg
(
cu¼MB
);

1863 ià(
mode
 =ð
P8x8
)

1865 
cu¼Sliû
->
	`£t_cÛff_ªd_»cÚ_8x8
 (
cu¼MB
);

1867 ià(
mode
==
I4MB
)

1869 
cu¼MB
->
cbp
 = 
	`mode_decisiÚ_fÜ_I4x4_MB
 (cu¼MB, 
Ïmbda
, &
dummy_d
);

1871 ià(
mode
==
I16MB
)

1873 
cu¼MB
->
cbp
 = 
cu¼Sliû
->
	`mode_decisiÚ_fÜ_I16x16_MB
 (cu¼MB, 
Ïmbda
);

1875 if(
mode
==
I8MB
)

1877 
cu¼MB
->
cbp
 = 
	`mode_decisiÚ_fÜ_I8x8_MB
(cu¼MB, 
Ïmbda
, &
dummy_d
);

1879 if(
mode
==
IPCM
)

1881 
	`´•¬e_cm_mode
(
cu¼MB
);

1891 ià(
p_IÅ
->
RCEÇbË
)

1893 ià(
mode
 =ð
I16MB
)

1894 
	`memýy
(
p_RDO
->
´ed
[0], 
cu¼_m´_16x16
[ (è
cu¼MB
->
i16mode
][0], 
MB_PIXELS
 * (
img³l
));

1896 
	`memýy
(
p_RDO
->
´ed
[0], 
mb_´ed
[0], 
MB_PIXELS
 * (
img³l
));

1899 
cu¼MB
->
i16off£t
 = 0;

1900 
dummy
 = 0;

1902 ià(((
p_Vid
->
yuv_fÜm©
 !ð
YUV400
è&& (
aùive_¥s
->
chroma_fÜm©_idc
 !ð
YUV444
)è&& (
mode
 !ð
IPCM
))

1903 
cu¼Sliû
->
	`chroma_»sidu®_codšg
 (
cu¼MB
);

1905 ià(
mode
==
I16MB
)

1906 
cu¼MB
->
i16off£t
 = 
	`I16Off£t
 (cu¼MB->
cbp
, cu¼MB->
i16mode
);

1912 ià(
p_IÅ
->
rdÝt
 == 3)

1914 
di¡ÜtiÚ
 = 
p_Vid
->
	`e¡im©e_di¡ÜtiÚ
(
cu¼MB
, 0, 16, 
mode
, 0, cu¼MB->
mš_rdco¡
);

1921 
di¡ÜtiÚ
 = 
cu¼Sliû
->
	`g‘Di¡ÜtiÚ
(
cu¼MB
);

1923 ià(
di¡ÜtiÚ
 > 
cu¼MB
->
mš_rdco¡
)

1927 ià(
cu¼MB
->
qp_sÿËd
[0] =ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 =ð1 && 
di¡ÜtiÚ
 != 0)

1932 
cu¼Sliû
->
	`¡Üe_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

1938 ià(
u£_of_cc
)

1940 ià(
cu¼MB
->
mb_ty³
!=0 || (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && cu¼MB->
cbp
!=0))

1943 
tmp_cc
 = 
p_Vid
->
cod_couÁ”
;

1945 
¿‹
 = 
cu¼Sliû
->
	`wr™e_MB_Ïy”
 (
cu¼MB
, 1, &
cÛff_¿‹
);

1947 
	`ue_lšfo
 (
tmp_cc
, 
dummy
, &
cc_¿‹
, &dummy);

1948 
¿‹
 -ð
cc_¿‹
;

1949 
p_Vid
->
cod_couÁ”
 = 
tmp_cc
;

1954 
	`ue_lšfo
 (
p_Vid
->
cod_couÁ”
 + 1, 
dummy
, &
¿‹
, &dummy);

1955 
	`ue_lšfo
 (
p_Vid
->
cod_couÁ”
 , 
dummy
, &
cc_¿‹
, &dummy);

1956 
¿‹
 -ð
cc_¿‹
;

1961 
¿‹
 = 
cu¼Sliû
->
	`wr™e_MB_Ïy”
 (
cu¼MB
, 1, &
cÛff_¿‹
);

1966 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

1968 ià(
p_IÅ
->
FÜûTrueR©eRDO
 == 1)

1969 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
, 
¿‹
);

1970 ià(
p_IÅ
->
FÜûTrueR©eRDO
 == 2)

1971 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
, (
¿‹
 + 
	`is_šŒa
(
cu¼MB
)));

1973 
rdco¡
 = 
di¡ÜtiÚ
 + (
¿‹
>0? (
	`weight_co¡
(
Ïmbda
,„ate)): (weight_cost(lambda, 1)/2));

1975 #ià
JCOST_OVERFLOWCHECK


1976 if(
rdco¡
 < 
di¡ÜtiÚ
)

1978 
	`´štf
("Ïmbda: %d,„©e: %d,ƒ¼Ü: %s: %d\n", 
Ïmbda
, 
¿‹
, 
__FILE__
, 
__LINE__
);

1979 
	`ex™
(-1);

1984 ià((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
è&& (
p_IÅ
->
BŸsSkRDO
 =ð1è&& (
mode
 =ð1è&& (
cu¼MB
->
be¡_mode
 =ð0è&& (cu¼MB->
mš_dco¡
 > 4 * 
di¡ÜtiÚ
è&& (cu¼MB->mš_dco¡ > ((64 * (256 + 2 * 
p_Vid
->
mb_ü_size_y
 *…_Vid->
mb_ü_size_x
)è<< 
LAMBDA_ACCURACY_BITS
)))

1986 
cu¼MB
->
mš_rdco¡
 = 
rdco¡
 + 1;

1989 ià((
rdco¡
 >ð
cu¼MB
->
mš_rdco¡
) ||

1990 ((
cu¼MB
->
qp_sÿËd
[0]è=ð0 && 
p_Vid
->
aùive_¥s
->
los¦ess_qµrime_æag
 =ð1 && 
di¡ÜtiÚ
 != 0))

1992 #ià
FASTMODE


1996 if((
cu¼Sliû
->
¦iû_ty³
 !ð
P_SLICE
 || 
mode
 !ð0 || 
rdco¡
 !ð
cu¼MB
->
mš_rdco¡
è|| 
	`is_FREXT_´ofže
(
p_IÅ
->
ProfžeIDC
))

2002 ià((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
mode
 ? 0: ((cu¼Sliû->
¦iû_ty³
 =ð
B_SLICE
è? !
cu¼MB
->
cbp
:1)))

2004 ià(
cu¼MB
->
mbAddrX
 & 0x01)

2006 ià(
´evMB
->
mb_ty³
 ? 0:((
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è? !´evMB->
cbp
:1))

2008 ià(!(
	`f›ld_æag_šã»nû
(
cu¼MB
è=ðcu¼MB->
mb_f›ld
))

2016 
cu¼MB
->
mš_rdco¡
 = 
rdco¡
;

2017 
cu¼MB
->
mš_dco¡
 = 
di¡ÜtiÚ
;

2018 
cu¼MB
->
mš_¿‹
 = 
	`weight_co¡
(
Ïmbda
, 
cÛff_¿‹
);

2019 
cu¼MB
->
mš_b™s
 = 
¿‹
;

2021 #ifdeà
BEST_NZ_COEFF


2022 
j
=0;j<4;j++)

2023 
	`memýy
(&
p_Vid
->
g¯iMBAFF_NZCÛff
[
j
][0], &p_Vid->
nz_cÛff
[
cu¼MB
->
mbAddrX
][j][0], (4 +…_Vid->
num_blk8x8_uv
) * ());

2027 
	}
}

2035 
	$š™_md_be¡
(
Be¡Mode
 *
be¡
)

2037 
be¡
->
cbp
 = 0;

2038 
be¡
->
co¡
 = 
DISTBLK_MAX
;

2039 
be¡
->
rdco¡
 = 1e20;

2040 
be¡
->
dco¡
 = 1e20;

2041 
be¡
->
¿‹
 = 1e20;

2042 
be¡
->
c_imode
 = 0;

2043 
be¡
->
i16off£t
 = 0;

2044 
be¡
->
mode
 = 10;

2045 
	}
}

2053 
	$¡Üe_maüoblock_·¿m‘”s
 (
Maüoblock
 *
cu¼MB
, 
mode
)

2055 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2056 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

2057 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2058 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2059 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2061 
i
, 
j
, ****
i4p
, ***
i3p
;

2064 
cu¼MB
->
be¡_mode
 = (è
mode
;

2065 
cu¼MB
->
be¡_c_imode
 = cu¼MB->
c_»d_mode
;

2066 
cu¼MB
->
be¡_i16off£t
 = cu¼MB->
i16off£t
;

2067 
cu¼MB
->
be¡_i16mode
 = cu¼MB->
i16mode
;

2068 
cu¼MB
->
be¡_cbp
 = cu¼MB->
cbp
;

2070 
	`memýy
(
cu¼Sliû
->
p_RDO
->
be¡8x8
, 
cu¼MB
->
b8x8
, 
BLOCK_MULTIPLE
 * (
Info8x8
));

2072 
	`memýy
(
cu¼Sliû
->
b4_šŒa_´ed_modes
, 
cu¼MB
->
šŒa_´ed_modes
, 
MB_BLOCK_PARTITIONS
 * ());

2073 
	`memýy
(
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
,
cu¼MB
->
šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2075 
j
 = 0 ; j < 
BLOCK_MULTIPLE
; j++)

2077 
	`memýy
(&
cu¼Sliû
->
b4_»dmode
[
j
 * 
BLOCK_MULTIPLE
],&
p_Vid
->
»dmode
 [
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
],BLOCK_MULTIPLE * ());

2078 
	`memýy
(&
cu¼Sliû
->
b8_»dmode8x8
[
j
][0], &
p_Vid
->
»dmode8x8
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
],
BLOCK_MULTIPLE
 * ());

2081 
	`cÝy_image_d©a_16x16
(
p_RDO
->
»c_mb
[0], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 0, cu¼MB->
pix_x
);

2083 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& 
p_Vid
->
¥2_äame_šdiÿtÜ
==0)

2085 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

2087 
	`memýy
(
p_RDO
->
Ìec_»c
[
j
], &
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+j][cu¼MB->
pix_x
], 
MB_BLOCK_SIZE
 * ());

2092 ià(
p_Vid
->
Ad­tiveRoundšg
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& 
mode
 <= 1)

2094 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

2095 
	`¡Üe_ad­tive_roundšg_16x16
Ð
p_Vid
,…_Vid->
ARCofAdj8x8
, 
mode
);

2097 
	`¡Üe_ad­tive_roundšg_16x16
Ð
p_Vid
,…_Vid->
ARCofAdj4x4
, 
mode
);

2100 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2102 
k
;

2103 
k
 = 0; k < 2; k++)

2105 
	`cÝy_image_d©a
(
p_RDO
->
»c_mb
[
k
 + 1], &
p_Vid
->
’c_piùu»
->
imgUV
[k][
cu¼MB
->
pix_c_y
], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2108 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& 
p_Vid
->
¥2_äame_šdiÿtÜ
==0)

2111 
k
 = 0; k < 2; k++)

2113 
j
 = 0; j<
p_Vid
->
mb_ü_size_y
; j++)

2115 
	`memýy
(
p_RDO
->
Ìec_»c_uv
[
k
][
j
],&
p_Vid
->
Ìec_uv
[k][
cu¼MB
->
pix_c_y
 + j][cu¼MB->
pix_c_x
],…_Vid->
mb_ü_size_x
 * ());

2122 ià(
p_IÅ
->
rdÝt
 == 3)

2124 
	`”rdo_¡Üe_be¡_MB
(
cu¼MB
);

2128 ià(
mode
 || 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2130 
i4p
 = 
p_RDO
->
cofAC
;

2131 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

2132 
cu¼Sliû
->
cofAC
 = 
i4p
;

2133 
i3p
 = 
p_RDO
->
cofDC
;

2134 
p_RDO
->
cofDC
 = 
cu¼Sliû
->cofDC;

2135 
cu¼Sliû
->
cofDC
 = 
i3p
;

2136 
p_RDO
->
cbp
 = 
cu¼MB
->cbp;

2137 
cu¼Sliû
->
cu¼_cbp
[0] = cu¼Sliû->
cmp_cbp
[1];

2138 
cu¼Sliû
->
cu¼_cbp
[1] = cu¼Sliû->
cmp_cbp
[2];

2140 
cu¼Sliû
->
cur_cbp_blk
[0] = 
cu¼MB
->
cbp_blk
;

2144 
cu¼Sliû
->
cur_cbp_blk
[0] = 
p_RDO
->
cbp
 = 0;

2145 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

2149 
cu¼MB
->
‹mp_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
luma_ŒªsfÜm_size_8x8_æag
;

2151 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

2153 
j
 = 0; j < 4; j++)

2155 
i
 = 0; i < 4; i++)

2157 
p_RDO
->
l0_»fäame
[
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[
LIST_0
];

2163 
j
 = 0; j < 4; j++)

2165 
i
 = 0; i < 4; i++)

2167 
p_RDO
->
l0_»fäame
[
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[
LIST_0
];

2168 
p_RDO
->
l1_»fäame
[
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[
LIST_1
];

2172 
	}
}

2180 
	$£t_¡Üed_maüoblock_·¿m‘”s_m·ss
 (
Maüoblock
 *
cu¼MB
)

2182 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2183 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

2184 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2185 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2187 
img³l
 **
imgY
 = 
p_Vid
->
’c_piùu»
->imgY;

2188 
img³l
 ***
imgUV
 = 
p_Vid
->
’c_piùu»
->imgUV;

2190 
mode
 = 
cu¼MB
->
be¡_mode
;

2191 
i
, 
j
, 
k
, ****
i4p
, ***
i3p
;

2192 
block_x
, 
block_y
;

2193 **
»dmodes
 = 
p_Vid
->
»dmode
;

2195 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2200 
	`cÝy_image_d©a_16x16
(&
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
»c_mb
[0], cu¼MB->
pix_x
, 0);

2203 
	`cÝy_image_d©a_16x16
(
cu¼Sliû
->
rdd©a
->
»c_mb
[0], 
p_RDO
->rec_mb[0], 0, 0);

2205 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& 
p_Vid
->
¥2_äame_šdiÿtÜ
==0)

2207 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

2208 
	`memýy
(&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
], 
p_RDO
->
Ìec_»c
[j], 
MB_BLOCK_SIZE
 * ());

2211 ià(
p_Vid
->
Ad­tiveRoundšg
)

2213 
	`upd©e_off£t_·¿ms
(
cu¼MB
, 
mode
, cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
);

2216 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2218 
k
 = 0; k < 2; k++)

2220 
	`cÝy_image_d©a
(&
imgUV
[
k
][
cu¼MB
->
pix_c_y
], 
p_RDO
->
»c_mb
[k + 1], cu¼MB->
pix_c_x
, 0, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2224 
	`cÝy_image_d©a
(
cu¼Sliû
->
rdd©a
->
»c_mb
[1], 
p_RDO
->»c_mb[1], 0, 0, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2225 
	`cÝy_image_d©a
(
cu¼Sliû
->
rdd©a
->
»c_mb
[2], 
p_RDO
->»c_mb[2], 0, 0, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2227 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& !
p_Vid
->
¥2_äame_šdiÿtÜ
)

2229 
k
 = 0; k < 2; k++)

2231 
j
 = 0; j<
p_Vid
->
mb_ü_size_y
; j++)

2233 
	`memýy
(&
p_Vid
->
Ìec_uv
[
k
][
cu¼MB
->
pix_c_y
 + 
j
][cu¼MB->
pix_c_x
], 
p_RDO
->
Ìec_»c_uv
[k][j],…_Vid->
mb_ü_size_x
 * ());

2240 
i4p
 = 
p_RDO
->
cofAC
;

2241 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

2242 
cu¼Sliû
->
cofAC
 = 
i4p
;

2244 
i3p
 = 
p_RDO
->
cofDC
;

2245 
p_RDO
->
cofDC
 = 
cu¼Sliû
->cofDC;

2246 
cu¼Sliû
->
cofDC
 = 
i3p
;

2247 
cu¼MB
->
cbp
 = 
p_RDO
->cbp;

2248 
cu¼MB
->
cbp_blk
 = 
cu¼Sliû
->
cur_cbp_blk
[0];

2249 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[0];

2250 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[1];

2251 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

2252 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

2255 
cu¼MB
->
mb_ty³
 = (è
mode
;

2257 
	`memýy
(
cu¼MB
->
b8x8
, 
cu¼Sliû
->
p_RDO
->
be¡8x8
, 
BLOCK_MULTIPLE
 * (
Info8x8
));

2260 
cu¼Sliû
->
rdd©a
->
mode
 = mode;

2261 
cu¼Sliû
->
rdd©a
->
i16off£t
 = 
cu¼MB
->i16offset;

2262 
cu¼Sliû
->
rdd©a
->
i16mode
 = 
cu¼MB
->i16mode;

2263 
cu¼Sliû
->
rdd©a
->
cbp
 = 
p_RDO
->cbp;

2264 
cu¼Sliû
->
rdd©a
->
cbp_blk
 = cu¼Sliû->
cur_cbp_blk
[0];

2265 
cu¼Sliû
->
rdd©a
->
mb_ty³
 = (è
mode
;

2267 
cu¼Sliû
->
rdd©a
->
´ev_qp
 = 
cu¼MB
->prev_qp;

2268 
cu¼Sliû
->
rdd©a
->
´ev_dqp
 = 
cu¼MB
->prev_dqp;

2269 
cu¼Sliû
->
rdd©a
->
qp
 = 
cu¼MB
->qp;

2270 
cu¼Sliû
->
rdd©a
->
´ev_cbp
 = 
cu¼MB
->prev_cbp;

2272 
	`memýy
(
cu¼Sliû
->
rdd©a
->
cofAC
[0][0][0], cu¼Sliû->cofAC[0][0][0], (4+
p_Vid
->
num_blk8x8_uv
) * 4 * 2 * 65 * ());

2273 
	`memýy
(
cu¼Sliû
->
rdd©a
->
cofDC
[0][0], currSlice->cofDC[0][0], 3 * 2 * 18 * ());

2275 
	`memýy
(
cu¼Sliû
->
rdd©a
->
b8x8
, cu¼Sliû->
p_RDO
->
be¡8x8
, 
BLOCK_MULTIPLE
 * (
Info8x8
));

2278 ià(
mode
 =ð
P8x8
 && !
cu¼MB
->
‹mp_ŒªsfÜm_size_8x8_æag
 && 
p_IÅ
->
T¿nsfÜm8x8Mode
 && (cu¼MB->
v®id_8x8
 =ð
TRUE
))

2280 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 1);

2284 ià(
p_Vid
->
P444_jošed
)

2286 ià(((
cu¼MB
->
cbp
 =ð0è&& 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2287 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2289 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2294 ià(((
cu¼MB
->
cbp
 & 15è=ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2295 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2297 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2300 
cu¼Sliû
->
rdd©a
->
luma_ŒªsfÜm_size_8x8_æag
 = 
cu¼MB
->luma_transform_size_8x8_flag;

2302 ià(
p_IÅ
->
rdÝt
 == 3)

2304 
	`”rdo_g‘_be¡_MB
(
cu¼MB
);

2308 
j
 = 0; j < 4; j++)

2310 
block_y
 = 
cu¼MB
->block_y + 
j
;

2311 
i
 = 0; i < 4; i++)

2313 
block_x
 = 
cu¼MB
->block_x + 
i
;

2314 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2317 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð1è|| 
	`is_šŒa
(currMB))

2319 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = -1;

2320 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
z”o_mv
;

2321 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
NULL
;

2324 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_0
][
j
][
i
] = -1;

2328 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2330 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 0;

2331 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][0];

2332 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_0][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2335 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_0
][
j
][
i
] = 0;

2339 
cur_»f
 = 
p_RDO
->
l0_»fäame
[
j
][
i
];

2340 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 
cur_»f
;

2341 if(
cur_»f
 >=0)

2343 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][()
cur_»f
];

2344 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][()
cur_»f
][(è
cu¼MB
->
b8x8
[
k
].
mode
][
j
][
i
];

2347 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_0
][
j
][
i
] = 
cur_»f
;

2352 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð0è|| 
	`is_šŒa
(currMB))

2354 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2355 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2356 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2359 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_1
][
j
][
i
] = -1;

2364 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2366 
j
=0; j<4; j++)

2368 
block_y
 = 
cu¼MB
->block_y + 
j
;

2369 
i
=0; i<4; i++)

2371 
block_x
 = 
cu¼MB
->block_x + 
i
;

2372 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2375 ià(
	`is_šŒa
(
cu¼MB
)||(cu¼MB->
b8x8
[
k
].
pdœ
 == 0))

2377 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2378 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2379 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2382 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_1
][
j
][
i
] = -1;

2386 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2388 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 0;

2389 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][0];

2390 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_1][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2393 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_1
][
j
][
i
] = 0;

2397 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 
p_RDO
->
l1_»fäame
[
j
][
i
];

2398 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][()
p_RDO
->
l1_»fäame
[
j
][
i
]];

2399 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
®l_mv
[LIST_1][()
p_RDO
->
l1_»fäame
[
j
][
i
]][(è
cu¼MB
->
b8x8
[
k
].
mode
][j][i];

2402 
cu¼Sliû
->
rdd©a
->
»çr
[
LIST_1
][
j
][
i
] = 
p_RDO
->
l1_»fäame
[j][i];

2410 
cu¼MB
->
c_»d_mode
 = cu¼MB->
be¡_c_imode
;

2411 
cu¼MB
->
i16off£t
 = cu¼MB->
be¡_i16off£t
;

2412 
cu¼MB
->
i16mode
 = cu¼MB->
be¡_i16mode
;

2413 
cu¼MB
->
cbp
 = cu¼MB->
be¡_cbp
;

2415 if(
cu¼MB
->
mb_ty³
 =ð
I8MB
)

2417 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes8x8
,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2418 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
 ,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2419 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2421 
	`memýy
(&
p_Vid
->
»dmode
 [
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2422 
	`memýy
(&
p_Vid
->
»dmode8x8
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2425 ià(
mode
!=
I4MB
 && mode!=
I8MB
)

2427 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
,
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

2428 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

2429 
	`mem£t
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
], 
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

2432 ià(
mode
 =ð
I4MB
)

2434 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,
cu¼Sliû
->
b4_šŒa_´ed_modes
, 
MB_BLOCK_PARTITIONS
 * ());

2435 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2436 
	`memýy
(&
p_Vid
->
»dmode
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
],&
cu¼Sliû
->
b4_»dmode
[
BLOCK_MULTIPLE
 * j], BLOCK_MULTIPLE * ());

2440 
cu¼Sliû
->
rdd©a
->
c_»d_mode
 = 
cu¼MB
->c_ipred_mode;

2441 
cu¼Sliû
->
rdd©a
->
i16off£t
 = 
cu¼MB
->i16offset;

2442 
cu¼Sliû
->
rdd©a
->
i16mode
 = 
cu¼MB
->i16mode;

2443 
cu¼Sliû
->
rdd©a
->
cbp
 = 
cu¼MB
->cbp;

2444 
cu¼Sliû
->
rdd©a
->
cbp_blk
 = 
cu¼MB
->cbp_blk;

2445 
	`memýy
(
cu¼Sliû
->
rdd©a
->
šŒa_´ed_modes
,
cu¼MB
->šŒa_´ed_modes, 
MB_BLOCK_PARTITIONS
 * ());

2446 
	`memýy
(
cu¼Sliû
->
rdd©a
->
šŒa_´ed_modes8x8
,
cu¼MB
->šŒa_´ed_modes8x8, 
MB_BLOCK_PARTITIONS
 * ());

2447 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

2448 
	`memýy
(&
cu¼Sliû
->
rdd©a
->
»dmode
[
j
][
cu¼MB
->
block_x
],&
»dmodes
[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

2451 
cu¼Sliû
->
	`£t_mÙiÚ_veùÜs_mb
 (
cu¼MB
);

2452 
	}
}

2460 
	$£t_¡Üed_maüoblock_·¿m‘”s
 (
Maüoblock
 *
cu¼MB
)

2462 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2463 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

2464 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2465 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2467 
img³l
 **
imgY
 = 
p_Vid
->
’c_piùu»
->imgY;

2468 
img³l
 ***
imgUV
 = 
p_Vid
->
’c_piùu»
->imgUV;

2470 
mode
 = 
cu¼MB
->
be¡_mode
;

2471 
i
, 
j
, 
k
, ****
i4p
, ***
i3p
;

2472 
block_x
, 
block_y
;

2474 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2479 
	`cÝy_image_d©a_16x16
(&
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
»c_mb
[0], cu¼MB->
pix_x
, 0);

2481 ià(
p_Vid
->
Ad­tiveRoundšg
)

2483 
	`upd©e_off£t_·¿ms
(
cu¼MB
, 
mode
, cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
);

2486 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2488 
k
 = 0; k < 2; k++)

2490 
	`cÝy_image_d©a
(&
imgUV
[
k
][
cu¼MB
->
pix_c_y
], 
p_RDO
->
»c_mb
[k + 1], cu¼MB->
pix_c_x
, 0, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2495 
i4p
 = 
p_RDO
->
cofAC
;

2496 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

2497 
cu¼Sliû
->
cofAC
 = 
i4p
;

2499 
i3p
 = 
p_RDO
->
cofDC
;

2500 
p_RDO
->
cofDC
 = 
cu¼Sliû
->cofDC;

2501 
cu¼Sliû
->
cofDC
 = 
i3p
;

2502 
cu¼MB
->
cbp
 = 
p_RDO
->cbp;

2503 
cu¼MB
->
cbp_blk
 = 
cu¼Sliû
->
cur_cbp_blk
[0];

2504 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[0];

2505 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[1];

2506 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

2507 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

2510 
cu¼MB
->
mb_ty³
 = (è
mode
;

2512 
	`memýy
(
cu¼MB
->
b8x8
, 
cu¼Sliû
->
p_RDO
->
be¡8x8
, 
BLOCK_MULTIPLE
 * (
Info8x8
));

2516 ià(
mode
 =ð
P8x8
 && !
cu¼MB
->
‹mp_ŒªsfÜm_size_8x8_æag
 && 
p_IÅ
->
T¿nsfÜm8x8Mode
 && (cu¼MB->
v®id_8x8
 =ð
TRUE
))

2518 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 1);

2522 ià(
p_Vid
->
P444_jošed
)

2524 ià(((
cu¼MB
->
cbp
 =ð0è&& 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2525 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2527 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2532 ià(((
cu¼MB
->
cbp
 & 15è=ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2533 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2535 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2538 
cu¼Sliû
->
rdd©a
->
luma_ŒªsfÜm_size_8x8_æag
 = 
cu¼MB
->luma_transform_size_8x8_flag;

2540 ià(
p_IÅ
->
rdÝt
 == 3)

2542 
	`”rdo_g‘_be¡_MB
(
cu¼MB
);

2546 
j
 = 0; j < 4; j++)

2548 
block_y
 = 
cu¼MB
->block_y + 
j
;

2549 
i
 = 0; i < 4; i++)

2551 
block_x
 = 
cu¼MB
->block_x + 
i
;

2552 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2555 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð1è|| 
	`is_šŒa
(currMB))

2557 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = -1;

2558 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
NULL
;

2559 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
z”o_mv
;

2563 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2565 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 0;

2566 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][0];

2567 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_0][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2571 
cur_»f
 = 
p_RDO
->
l0_»fäame
[
j
][
i
];

2572 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 
cur_»f
;

2573 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][()
cur_»f
];

2574 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][()
cur_»f
][(è
cu¼MB
->
b8x8
[
k
].
mode
][
j
][
i
];

2579 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð0è|| 
	`is_šŒa
(currMB))

2581 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2582 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2583 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2588 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2590 
j
=0; j<4; j++)

2592 
block_y
 = 
cu¼MB
->block_y + 
j
;

2593 
i
=0; i<4; i++)

2595 
block_x
 = 
cu¼MB
->block_x + 
i
;

2596 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2599 ià(
	`is_šŒa
(
cu¼MB
)||(cu¼MB->
b8x8
[
k
].
pdœ
 == 0))

2601 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2602 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2603 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2607 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2609 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 0;

2610 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][0];

2611 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_1][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2615 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 
p_RDO
->
l1_»fäame
[
j
][
i
];

2616 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][()
p_RDO
->
l1_»fäame
[
j
][
i
]];

2617 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
®l_mv
[LIST_1][()
p_RDO
->
l1_»fäame
[
j
][
i
]][(è
cu¼MB
->
b8x8
[
k
].
mode
][j][i];

2625 
cu¼MB
->
c_»d_mode
 = cu¼MB->
be¡_c_imode
;

2626 
cu¼MB
->
i16off£t
 = cu¼MB->
be¡_i16off£t
;

2627 
cu¼MB
->
i16mode
 = cu¼MB->
be¡_i16mode
;

2628 
cu¼MB
->
cbp
 = cu¼MB->
be¡_cbp
;

2630 if(
cu¼MB
->
mb_ty³
 =ð
I8MB
)

2632 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes8x8
,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2633 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
 ,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2634 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2636 
	`memýy
(&
p_Vid
->
»dmode
 [
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2637 
	`memýy
(&
p_Vid
->
»dmode8x8
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2640 ià(
mode
!=
I4MB
 && mode!=
I8MB
)

2642 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
,
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

2643 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

2644 
	`mem£t
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
], 
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

2647 ià(
mode
 =ð
I4MB
)

2649 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,
cu¼Sliû
->
b4_šŒa_´ed_modes
, 
MB_BLOCK_PARTITIONS
 * ());

2650 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2651 
	`memýy
(&
p_Vid
->
»dmode
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
],&
cu¼Sliû
->
b4_»dmode
[
BLOCK_MULTIPLE
 * j], BLOCK_MULTIPLE * ());

2655 
cu¼Sliû
->
	`£t_mÙiÚ_veùÜs_mb
 (
cu¼MB
);

2656 
	}
}

2665 
	$£t_¡Üed_maüoblock_·¿m‘”s_¥
 (
Maüoblock
 *
cu¼MB
)

2667 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2668 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

2669 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2670 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

2672 
img³l
 **
imgY
 = 
p_Vid
->
’c_piùu»
->imgY;

2673 
img³l
 ***
imgUV
 = 
p_Vid
->
’c_piùu»
->imgUV;

2675 
mode
 = 
cu¼MB
->
be¡_mode
;

2676 
i
, 
j
, 
k
, ****
i4p
, ***
i3p
;

2677 
block_x
, 
block_y
;

2678 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

2683 
	`cÝy_image_d©a_16x16
(&
imgY
[
cu¼MB
->
pix_y
], 
p_RDO
->
»c_mb
[0], cu¼MB->
pix_x
, 0);

2685 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& 
p_Vid
->
¥2_äame_šdiÿtÜ
==0)

2687 
j
 = 0; j < 
MB_BLOCK_SIZE
; j++)

2688 
	`memýy
(&
p_Vid
->
Ìec
[
cu¼MB
->
pix_y
+
j
][cu¼MB->
pix_x
], 
p_RDO
->
Ìec_»c
[j], 
MB_BLOCK_SIZE
 * ());

2691 ià(
p_Vid
->
Ad­tiveRoundšg
)

2693 
	`upd©e_off£t_·¿ms
(
cu¼MB
, 
mode
, cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
);

2696 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

2698 
k
 = 0; k < 2; k++)

2700 
	`cÝy_image_d©a
(&
imgUV
[
k
][
cu¼MB
->
pix_c_y
], 
p_RDO
->
»c_mb
[k + 1], cu¼MB->
pix_c_x
, 0, 
p_Vid
->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

2703 if((
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
è&& !
p_Vid
->
¥2_äame_šdiÿtÜ
)

2705 
k
 = 0; k < 2; k++)

2707 
j
 = 0; j<
p_Vid
->
mb_ü_size_y
; j++)

2709 
	`memýy
(&
p_Vid
->
Ìec_uv
[
k
][
cu¼MB
->
pix_c_y
 + 
j
][cu¼MB->
pix_c_x
], 
p_RDO
->
Ìec_»c_uv
[k][j],…_Vid->
mb_ü_size_x
 * ());

2716 
i4p
 = 
p_RDO
->
cofAC
;

2717 
p_RDO
->
cofAC
 = 
cu¼Sliû
->cofAC;

2718 
cu¼Sliû
->
cofAC
 = 
i4p
;

2720 
i3p
 = 
p_RDO
->
cofDC
;

2721 
p_RDO
->
cofDC
 = 
cu¼Sliû
->cofDC;

2722 
cu¼Sliû
->
cofDC
 = 
i3p
;

2723 
cu¼MB
->
cbp
 = 
p_RDO
->cbp;

2724 
cu¼MB
->
cbp_blk
 = 
cu¼Sliû
->
cur_cbp_blk
[0];

2725 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[0];

2726 
cu¼MB
->
cbp
 |ð
cu¼Sliû
->
cu¼_cbp
[1];

2727 
cu¼Sliû
->
cmp_cbp
[1] = 
cu¼MB
->
cbp
;

2728 
cu¼Sliû
->
cmp_cbp
[2] = 
cu¼MB
->
cbp
;

2731 
cu¼MB
->
mb_ty³
 = (è
mode
;

2733 
	`memýy
(
cu¼MB
->
b8x8
, 
cu¼Sliû
->
p_RDO
->
be¡8x8
, 
BLOCK_MULTIPLE
 * (
Info8x8
));

2736 ià(
mode
 =ð
P8x8
 && !
cu¼MB
->
‹mp_ŒªsfÜm_size_8x8_æag
 && 
p_IÅ
->
T¿nsfÜm8x8Mode
 && (cu¼MB->
v®id_8x8
 =ð
TRUE
))

2738 
	`Re¡ÜeMV8x8
(
cu¼Sliû
, 1);

2742 ià(
p_Vid
->
P444_jošed
)

2744 ià(((
cu¼MB
->
cbp
 =ð0è&& 
cu¼Sliû
->
cmp_cbp
[1] =ð0 && cu¼Sliû->cmp_cbp[2] =ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2745 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2747 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2752 ià(((
cu¼MB
->
cbp
 & 15è=ð0è&& (cu¼MB->
mb_ty³
 !ð
I4MB
 && cu¼MB->mb_ty³ !ð
I8MB
))

2753 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
FALSE
;

2755 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = cu¼MB->
‹mp_ŒªsfÜm_size_8x8_æag
;

2758 
cu¼Sliû
->
rdd©a
->
luma_ŒªsfÜm_size_8x8_æag
 = 
cu¼MB
->luma_transform_size_8x8_flag;

2760 ià(
p_IÅ
->
rdÝt
 == 3)

2762 
	`”rdo_g‘_be¡_MB
(
cu¼MB
);

2766 
j
 = 0; j < 4; j++)

2768 
block_y
 = 
cu¼MB
->block_y + 
j
;

2769 
i
 = 0; i < 4; i++)

2771 
block_x
 = 
cu¼MB
->block_x + 
i
;

2772 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2775 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð1è|| 
	`is_šŒa
(currMB))

2777 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = -1;

2778 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
NULL
;

2779 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
z”o_mv
;

2783 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2785 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 0;

2786 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][0];

2787 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_0][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2791 
cur_»f
 = 
p_RDO
->
l0_»fäame
[
j
][
i
];

2792 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 
cur_»f
;

2793 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][()
cur_»f
];

2794 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][()
cur_»f
][(è
cu¼MB
->
b8x8
[
k
].
mode
][
j
][
i
];

2799 ià((
cu¼MB
->
b8x8
[
k
].
pdœ
 =ð0è|| 
	`is_šŒa
(currMB))

2801 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2802 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2803 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2808 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2810 
j
=0; j<4; j++)

2812 
block_y
 = 
cu¼MB
->block_y + 
j
;

2813 
i
=0; i<4; i++)

2815 
block_x
 = 
cu¼MB
->block_x + 
i
;

2816 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

2819 ià(
	`is_šŒa
(
cu¼MB
)||(cu¼MB->
b8x8
[
k
].
pdœ
 == 0))

2821 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = -1;

2822 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
NULL
;

2823 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

2827 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 && (cu¼MB->b8x8[k].
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, cu¼MB->
mb_ty³
))

2829 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 0;

2830 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][0];

2831 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
b»d_mv
[
cu¼MB
->
b8x8
[
k
].
b»d
 - 1][LIST_1][0][(ècu¼MB->b8x8[k].
mode
][
j
][
i
];

2835 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 
p_RDO
->
l1_»fäame
[
j
][
i
];

2836 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1 + 
cu¼MB
->
li¡_off£t
][()
p_RDO
->
l1_»fäame
[
j
][
i
]];

2837 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
®l_mv
[LIST_1][()
p_RDO
->
l1_»fäame
[
j
][
i
]][(è
cu¼MB
->
b8x8
[
k
].
mode
][j][i];

2845 
cu¼MB
->
c_»d_mode
 = cu¼MB->
be¡_c_imode
;

2846 
cu¼MB
->
i16off£t
 = cu¼MB->
be¡_i16off£t
;

2847 
cu¼MB
->
i16mode
 = cu¼MB->
be¡_i16mode
;

2848 
cu¼MB
->
cbp
 = cu¼MB->
be¡_cbp
;

2850 if(
cu¼MB
->
mb_ty³
 =ð
I8MB
)

2852 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes8x8
,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2853 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
 ,
cu¼Sliû
->
b8_šŒa_´ed_modes8x8
, 
MB_BLOCK_PARTITIONS
 * ());

2854 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2856 
	`memýy
(&
p_Vid
->
»dmode
 [
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2857 
	`memýy
(&
p_Vid
->
»dmode8x8
[
cu¼MB
->
block_y
+
j
][cu¼MB->
block_x
], 
cu¼Sliû
->
b8_»dmode8x8
[j], 
BLOCK_MULTIPLE
 * ());

2860 ià(
mode
!=
I4MB
 && mode!=
I8MB
)

2862 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
,
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

2863 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

2864 
	`mem£t
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
], 
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

2867 ià(
mode
 =ð
I4MB
)

2869 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,
cu¼Sliû
->
b4_šŒa_´ed_modes
, 
MB_BLOCK_PARTITIONS
 * ());

2870 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

2871 
	`memýy
(&
p_Vid
->
»dmode
[
cu¼MB
->
block_y
 + 
j
][cu¼MB->
block_x
],&
cu¼Sliû
->
b4_»dmode
[
BLOCK_MULTIPLE
 * j], BLOCK_MULTIPLE * ());

2875 
cu¼Sliû
->
	`£t_mÙiÚ_veùÜs_mb
 (
cu¼MB
);

2876 
	}
}

2885 
	$£t_»f_ªd_mÙiÚ_veùÜs_P_¦iû
 (
Maüoblock
 *
cu¼MB
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Info8x8
 *
·¹
, 
block
)

2887 
mode
 = 
·¹
->mode;

2888 
j
 = 0, 
i
;

2889 
pmode
 = (
mode
==1||mode==2||mode==3 ? mode : 4);

2890 
j0
 = ((
block
 >> 1)<<1);

2891 
i0
 = ((
block
 & 0x01)<<1);

2892 
i1
 = 
i0
 + 
·¹_size
[
pmode
][0];

2893 
j1
 = 
j0
 + 
·¹_size
[
pmode
][1];

2894 
PicMÙiÚP¬ams
 *
mv
 = 
NULL
;

2896 ià(
·¹
->
pdœ
 < 0)

2898 
j
 = 
cu¼MB
->
block_y
 + 
j0
; j < cu¼MB->block_y + 
j1
; j++)

2900 
i
 = 
cu¼MB
->
block_x
 + 
i0
; i < cu¼MB->block_x + 
i1
; i++)

2902 
mv
 = &
mÙiÚ
[
j
][
i
];

2903 
mv
->
»f_pic
[
LIST_0
] = 
NULL
;

2904 
mv
->
»f_pic
[
LIST_1
] = 
NULL
;

2905 
mv
->mv [
LIST_0
] = 
z”o_mv
;

2906 
mv
->mv [
LIST_1
] = 
z”o_mv
;

2907 
mv
->
»f_idx
[
LIST_0
] = -1;

2908 
mv
->
»f_idx
[
LIST_1
] = -1;

2915 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2916 
block_y
;

2917 
fw»f
 = 
·¹
->
»f
[
LIST_0
];

2918 
j
 = 
j0
; j < 
j1
; j++)

2920 
block_y
 = 
cu¼MB
->block_y + 
j
;

2921 
i
 = 
i0
; i < 
i1
; i++)

2923 
mv
 = &
mÙiÚ
[
block_y
][
cu¼MB
->
block_x
 + 
i
];

2924 
mv
->
»f_pic
[
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0+
cu¼MB
->
li¡_off£t
][
fw»f
];;

2925 
mv
->mv [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
fw»f
][
mode
][
j
][
i
];

2926 
mv
->
»f_idx
[
LIST_0
] = (è
fw»f
;

2931 
	}
}

2940 
	$£t_»f_ªd_mÙiÚ_veùÜs_B_¦iû
 (
Maüoblock
 *
cu¼MB
, 
PicMÙiÚP¬ams
 **
mÙiÚ
, 
Info8x8
 *
·¹
, 
block
)

2942 
mode
 = 
·¹
->mode;

2943 
i
, 
j
=0;

2944 
pmode
 = (
mode
==1||mode==2||mode==3 ? mode : 4);

2945 
j0
 = ((
block
 >> 1)<<1);

2946 
i0
 = ((
block
 & 0x01)<<1);

2947 
i1
 = 
i0
 + 
·¹_size
[
pmode
][0];

2948 
j1
 = 
j0
 + 
·¹_size
[
pmode
][1];

2949 
PicMÙiÚP¬ams
 *
mv
 = 
NULL
;

2951 ià(
·¹
->
pdœ
 < 0)

2953 
j
 = 
cu¼MB
->
block_y
 + 
j0
; j < cu¼MB->block_y + 
j1
; j++)

2955 
i
 = 
cu¼MB
->
block_x
 + 
i0
; i < cu¼MB->block_x + 
i1
; i++)

2957 
mv
 = &
mÙiÚ
[
j
][
i
];

2958 
mv
->
»f_pic
[
LIST_0
] = 
NULL
;

2959 
mv
->
»f_pic
[
LIST_1
] = 
NULL
;

2960 
mv
->mv [
LIST_0
] = 
z”o_mv
;

2961 
mv
->mv [
LIST_1
] = 
z”o_mv
;

2962 
mv
->
»f_idx
[
LIST_0
] = -1;

2963 
mv
->
»f_idx
[
LIST_1
] = -1;

2970 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

2971 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

2973 
block_x
, 
block_y
;

2975 ià((
·¹
->
pdœ
 == 0 ||…art->pdir == 2))

2977 ià(
·¹
->
b»d
 && (·¹->
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

2979 
j
=
j0
; j<
j1
; j++)

2981 
block_y
 = 
cu¼MB
->block_y + 
j
;

2982 
i
=
i0
; i<
i1
; i++)

2984 
block_x
 = 
cu¼MB
->block_x + 
i
;

2986 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
b»d_mv
[
·¹
->
b»d
 - 1][LIST_0][0][
mode
][
j
][
i
];

2987 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_0
] = 0;

2988 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][0];

2994 ià(
mode
==0)

2996 
fw»f
;

2997 
j
=
j0
; j<
j1
; j++)

2999 
block_y
 = 
cu¼MB
->block_y + 
j
;

3000 
i
=
i0
; i<
i1
; i++)

3002 
block_x
 = 
cu¼MB
->block_x + 
i
;

3003 
fw»f
 = 
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][
LIST_0
];

3004 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
[
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0 + 
cu¼MB
->
li¡_off£t
][
fw»f
];

3005 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
fw»f
][
mode
][
j
][
i
];

3006 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
] = (è
fw»f
;

3012 
fw»f
 = 
·¹
->
»f
[
LIST_0
];

3013 
j
=
j0
; j<
j1
; j++)

3015 
block_y
 = 
cu¼MB
->block_y + 
j
;

3016 
i
 = 
i0
; i < 
i1
; i++)

3018 
block_x
 = 
cu¼MB
->block_x + 
i
;

3019 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
[
LIST_0
] = 
cu¼Sliû
->
li¡X
[LIST_0+
cu¼MB
->
li¡_off£t
][
fw»f
];

3020 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_0
] = 
cu¼Sliû
->
®l_mv
[LIST_0][
fw»f
][
mode
][
j
][
i
];

3021 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_0
] = (è
fw»f
;

3029 
j
=
cu¼MB
->
block_y
 + 
j0
; j < cu¼MB->block_y + 
j1
; j++)

3031 
i
 = 
cu¼MB
->
block_x
 + 
i0
; i < cu¼MB->block_x + 
i1
; i++)

3033 
mÙiÚ
[
j
][
i
].
»f_pic
 [
LIST_0
] = 
NULL
;

3034 
mÙiÚ
[
j
][
i
].
mv
 [
LIST_0
] = 
z”o_mv
;

3035 
mÙiÚ
[
j
][
i
].
»f_idx
 [
LIST_0
] = -1;

3041 ià((
·¹
->
pdœ
==1 ||…art->pdir==2))

3043 ià(
·¹
->
b»d
 && (·¹->
pdœ
 =ð2è&& 
	`is_b»d_’abËd
(
p_Vid
, 
mode
))

3045 
j
=
j0
; j<
j1
; j++)

3047 
block_y
 = 
cu¼MB
->block_y + 
j
;

3049 
i
=
i0
; i<
i1
; i++)

3051 
block_x
 = 
cu¼MB
->block_x + 
i
;

3053 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
b»d_mv
[
·¹
->
b»d
 - 1][LIST_1][0][
mode
][
j
][
i
];

3054 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = 0;

3055 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1+
cu¼MB
->
li¡_off£t
][0];

3061 ià(
mode
==0)

3063 
bw»f
 = 
·¹
->
»f
[
LIST_1
];

3064 
j
=
j0
; j<
j1
; j++)

3066 
block_y
 = 
cu¼MB
->block_y + 
j
;

3068 
i
 = 
i0
; i < 
i1
; i++)

3070 
block_x
 = 
cu¼MB
->block_x + 
i
;

3071 ià(
bw»f
 !ð
cu¼Sliû
->
dœeù_»f_idx
[
block_y
][
block_x
][
LIST_1
])

3072 
	`´štf
("error\n");

3073 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1+
cu¼MB
->
li¡_off£t
][
bw»f
];

3074 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
®l_mv
[LIST_1][
bw»f
][
mode
][
j
][
i
];

3075 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = (è
bw»f
;

3082 
bw»f
 = 
·¹
->
»f
[
LIST_1
];

3083 
j
=
j0
; j<
j1
; j++)

3085 
block_y
 = 
cu¼MB
->block_y + 
j
;

3086 
i
 = 
i0
; i < 
i1
; i++)

3088 
block_x
 = 
cu¼MB
->block_x + 
i
;

3090 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
LIST_1
] = 
cu¼Sliû
->
li¡X
[LIST_1+
cu¼MB
->
li¡_off£t
][
bw»f
];

3091 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
cu¼Sliû
->
®l_mv
[LIST_1][
bw»f
][
mode
][
j
][
i
];

3092 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
 [
LIST_1
] = (è
bw»f
;

3100 
block_y
 = 
cu¼MB
->block_y + 
j0
; block_y < cu¼MB->block_y + 
j1
; block_y++)

3102 
block_x
 = 
cu¼MB
->block_x + 
i0
; block_x < cu¼MB->block_x + 
i1
; block_x++)

3104 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
[
LIST_1
] = 
NULL
;

3105 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
LIST_1
] = 
z”o_mv
;

3106 
mÙiÚ
[
block_y
][
block_x
].
»f_idx
[
LIST_1
] = -1;

3111 
	}
}

3121 
by‹
 
	$f›ld_æag_šã»nû
(
Maüoblock
 *
cu¼MB
)

3123 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3124 
by‹
 
mb_f›ld
;

3126 ià(
cu¼MB
->
mbAvažA
)

3128 
mb_f›ld
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrA
].mb_field;

3133 ià(
cu¼MB
->
mbAvažB
)

3134 
mb_f›ld
 = 
p_Vid
->
mb_d©a
[
cu¼MB
->
mbAddrB
].mb_field;

3136 
mb_f›ld
 = 0;

3139  
mb_f›ld
;

3140 
	}
}

3149 
	$StÜeMVBlock8x8
(
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
mode
, 
Info8x8
 *
B8x8Info
)

3151 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3152 
i0
 = (
block8x8
 & 0x01) << 1;

3153 
j0
 = (
block8x8
 >> 1) << 1;

3154 
j1
 = 
j0
 + 1;

3156 
MÙiÚVeùÜ
 *****
®l_mv
 = 
cu¼Sliû
->all_mv;

3157 
MÙiÚVeùÜ
 **
lc_l0_mv8x8
 = 
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_0
];

3158 
MÙiÚVeùÜ
 **
lc_l1_mv8x8
 = 
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_1
];

3160 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
 )

3162 ià(
B8x8Info
->
pdœ
 >= 0)

3164 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3165 
	`memýy
(&
lc_l0_mv8x8
[
j0
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j0][i0], 2 * (
MÙiÚVeùÜ
));

3166 
	`memýy
(&
lc_l0_mv8x8
[
j1
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j1][i0], 2 * (
MÙiÚVeùÜ
));

3171 
b»d_me
 = 
B8x8Info
->
b»d
;

3172 
pdœ8
 = 
B8x8Info
->
pdœ
;

3174 ià(
pdœ8
 == 0)

3176 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3177 
	`memýy
(&
lc_l0_mv8x8
[
j0
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j0][i0], 2 * (
MÙiÚVeùÜ
));

3178 
	`memýy
(&
lc_l0_mv8x8
[
j1
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j1][i0], 2 * (
MÙiÚVeùÜ
));

3180 ià(
pdœ8
 == 1)

3182 
l1_»f
 = 
B8x8Info
->
»f
[
LIST_1
];

3183 
	`memýy
(&
lc_l1_mv8x8
[
j0
][
i0
], &
®l_mv
[
LIST_1
][
l1_»f
][
mode
][j0][i0], 2 * (
MÙiÚVeùÜ
));

3184 
	`memýy
(&
lc_l1_mv8x8
[
j1
][
i0
], &
®l_mv
[
LIST_1
][
l1_»f
][
mode
][j1][i0], 2 * (
MÙiÚVeùÜ
));

3186 ià(
pdœ8
==2)

3188 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3189 
l1_»f
 = 
B8x8Info
->
»f
[
LIST_1
];

3190 ià(
b»d_me
)

3192 
®l_mv
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

3195 
	`memýy
(&
lc_l0_mv8x8
[
j0
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j0][i0], 2 * (
MÙiÚVeùÜ
));

3196 
	`memýy
(&
lc_l0_mv8x8
[
j1
][
i0
], &
®l_mv
[
LIST_0
][
l0_»f
][
mode
][j1][i0], 2 * (
MÙiÚVeùÜ
));

3197 
	`memýy
(&
lc_l1_mv8x8
[
j0
][
i0
], &
®l_mv
[
LIST_1
][
l1_»f
][
mode
][j0][i0], 2 * (
MÙiÚVeùÜ
));

3198 
	`memýy
(&
lc_l1_mv8x8
[
j1
][
i0
], &
®l_mv
[
LIST_1
][
l1_»f
][
mode
][j1][i0], 2 * (
MÙiÚVeùÜ
));

3202 
	`”rÜ
("invalid direction mode", 255);

3205 
	}
}

3213 
	$StÜeMV8x8
(
Sliû
 *
cu¼Sliû
, 
dœ
)

3215 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3216 
block8x8
;

3218 
block8x8
=0; block8x8<4; block8x8++)

3219 
	`StÜeMVBlock8x8
(
cu¼Sliû
, 
dœ
, 
block8x8
, 
p_RDO
->
Œ8x8
->
·¹
[block8x8].
mode
, &p_RDO->tr8x8->part[block8x8]);

3220 
	}
}

3228 
	$Re¡ÜeMVBlock8x8
(
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
RD_8x8DATA
 *
Œ
)

3230 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3231 
MÙiÚVeùÜ
 *****
®l_mv
 = 
cu¼Sliû
->all_mv;

3232 
MÙiÚVeùÜ
 **
lc_l0_mv8x8
 = 
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_0
];

3233 
MÙiÚVeùÜ
 **
lc_l1_mv8x8
 = 
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_1
];

3235 
pdœ8
 = 
Œ
->
·¹
[
block8x8
].
pdœ
;

3236 
mode
 = 
Œ
->
·¹
[
block8x8
].mode;

3237 
l0_»f
 = 
Œ
->
·¹
[
block8x8
].
»f
[
LIST_0
];

3238 
l1_»f
 = 
Œ
->
·¹
[
block8x8
].
»f
[
LIST_1
];

3239 
b»d_me
 = 
Œ
->
·¹
[
block8x8
].
b»d
;

3241 
i0
 = (
block8x8
 & 0x01) << 1;

3242 
j0
 = (
block8x8
 >> 1) << 1;

3243 
j1
 = 
j0
 + 1;

3245 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

3247 ià(
pdœ8
>=0)

3249 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][4][
j0
][
i0
], &
lc_l0_mv8x8
[j0][i0], 2 * (
MÙiÚVeùÜ
));

3250 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][4][
j1
][
i0
], &
lc_l0_mv8x8
[j1][i0], 2 * (
MÙiÚVeùÜ
));

3255 ià(
pdœ8
==0)

3257 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][
mode
][
j0
][
i0
], &
lc_l0_mv8x8
[j0][i0], 2 * (
MÙiÚVeùÜ
));

3258 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][
mode
][
j1
][
i0
], &
lc_l0_mv8x8
[j1][i0], 2 * (
MÙiÚVeùÜ
));

3260 ià(
pdœ8
==1)

3262 
	`memýy
(&
®l_mv
[
LIST_1
][
l1_»f
][
mode
][
j0
][
i0
], &
lc_l1_mv8x8
[j0][i0], 2 * (
MÙiÚVeùÜ
));

3263 
	`memýy
(&
®l_mv
[
LIST_1
][
l1_»f
][
mode
][
j1
][
i0
], &
lc_l1_mv8x8
[j1][i0], 2 * (
MÙiÚVeùÜ
));

3265 ià(
pdœ8
==2)

3267 if(
b»d_me
)

3269 
®l_mv
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1];

3272 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][
mode
][
j0
][
i0
], &
lc_l0_mv8x8
[j0][i0], 2 * (
MÙiÚVeùÜ
));

3273 
	`memýy
(&
®l_mv
[
LIST_0
][
l0_»f
][
mode
][
j1
][
i0
], &
lc_l0_mv8x8
[j1][i0], 2 * (
MÙiÚVeùÜ
));

3274 
	`memýy
(&
®l_mv
[
LIST_1
][
l1_»f
][
mode
][
j0
][
i0
], &
lc_l1_mv8x8
[j0][i0], 2 * (
MÙiÚVeùÜ
));

3275 
	`memýy
(&
®l_mv
[
LIST_1
][
l1_»f
][
mode
][
j1
][
i0
], &
lc_l1_mv8x8
[j1][i0], 2 * (
MÙiÚVeùÜ
));

3279 
	`”rÜ
("invalid direction mode", 255);

3282 
	}
}

3290 
	$Re¡ÜeMV8x8
(
Sliû
 *
cu¼Sliû
, 
dœ
)

3292 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3293 
block8x8
;

3295 
block8x8
=0; block8x8<4; block8x8++)

3296 
	`Re¡ÜeMVBlock8x8
(
cu¼Sliû
, 
dœ
, 
block8x8
, 
p_RDO
->
Œ8x8
);

3297 
	}
}

3306 
	$StÜeNewMÙiÚVeùÜsBlock8x8
(
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
Info8x8
 *
B8x8Info
)

3308 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3309 
mode
 = 
B8x8Info
->mode;

3310 
i0
 = (
block8x8
 & 0x01) << 1;

3311 
j0
 = (
block8x8
 >> 1) << 1;

3312 
j1
 = 
j0
 + 1;

3314 
MÙiÚVeùÜ
 ****
®l_mv_l0
 = 
cu¼Sliû
->
®l_mv
[
LIST_0
];

3315 
MÙiÚVeùÜ
 ****
®l_mv_l1
 = 
cu¼Sliû
->
®l_mv
[
LIST_1
];

3316 
MÙiÚVeùÜ
 **
lc_l0_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_0
][
j0
];

3317 
MÙiÚVeùÜ
 **
lc_l1_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_1
][
j0
];

3320 ià(
B8x8Info
->
pdœ
 < 0)

3322 
	`mem£t
(&
lc_l0_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3323 
	`mem£t
(&
lc_l0_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3324 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3325 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3329 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

3331 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3332 
	`memýy
(&
lc_l0_mv8x8
[0][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3333 
	`memýy
(&
lc_l0_mv8x8
[1][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3334 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3335 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3340 
b»d_me
 = 
B8x8Info
->
b»d
;

3341 
pdœ8
 = 
B8x8Info
->
pdœ
;

3342 ià(
b»d_me
)

3344 
®l_mv_l0
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1][
LIST_0
];

3345 
®l_mv_l1
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1][
LIST_1
];

3348 ià((
pdœ8
==0 ||…dir8==2))

3350 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3351 
	`memýy
(&
lc_l0_mv8x8
[0][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3352 
	`memýy
(&
lc_l0_mv8x8
[1][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3356 
	`mem£t
(&
lc_l0_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3357 
	`mem£t
(&
lc_l0_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3360 ià((
pdœ8
==1 ||…dir8==2))

3362 
l1_»f
 = 
B8x8Info
->
»f
[
LIST_1
];

3363 
	`memýy
(&
lc_l1_mv8x8
[0][
i0
], &
®l_mv_l1
[
l1_»f
][
mode
][
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3364 
	`memýy
(&
lc_l1_mv8x8
[1][
i0
], &
®l_mv_l1
[
l1_»f
][
mode
][
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3368 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3369 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3372 
	}
}

3381 
	$¡Üe_8x8_mÙiÚ_veùÜs_p_¦iû
(
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
Info8x8
 *
B8x8Info
)

3383 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3385 
i0
 = (
block8x8
 & 0x01) << 1;

3386 
j0
 = (
block8x8
 >> 1) << 1;

3388 
MÙiÚVeùÜ
 **
lc_l0_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_0
][
j0
];

3389 
MÙiÚVeùÜ
 **
lc_l1_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_1
][
j0
];

3391 ià(
B8x8Info
->
pdœ
 < 0)

3393 
	`mem£t
(&
lc_l0_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3394 
	`mem£t
(&
lc_l0_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3395 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3396 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3400 
j1
 = 
j0
 + 1;

3401 
MÙiÚVeùÜ
 **
®l_mv_l0
 = 
cu¼Sliû
->
®l_mv
[
LIST_0
][(è
B8x8Info
->
»f
[LIST_0]][()B8x8Info->
mode
];

3402 
	`memýy
(&
lc_l0_mv8x8
[0][
i0
], &
®l_mv_l0
[
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3403 
	`memýy
(&
lc_l0_mv8x8
[1][
i0
], &
®l_mv_l0
[
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3404 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3405 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3407 
	}
}

3416 
	$¡Üe_8x8_mÙiÚ_veùÜs_b_¦iû
(
Sliû
 *
cu¼Sliû
, 
dœ
, 
block8x8
, 
Info8x8
 *
B8x8Info
)

3418 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

3419 
i0
 = (
block8x8
 & 0x01) << 1;

3420 
j0
 = (
block8x8
 >> 1) << 1;

3422 
MÙiÚVeùÜ
 **
lc_l0_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_0
][
j0
];

3423 
MÙiÚVeùÜ
 **
lc_l1_mv8x8
 = &
p_RDO
->
®l_mv8x8
[
dœ
][
LIST_1
][
j0
];

3425 ià(
B8x8Info
->
pdœ
 < 0)

3427 
	`mem£t
(&
lc_l0_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3428 
	`mem£t
(&
lc_l0_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3429 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3430 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3434 
mode
 = 
B8x8Info
->mode;

3435 
j1
 = 
j0
 + 1;

3436 
MÙiÚVeùÜ
 ****
®l_mv_l0
 = 
cu¼Sliû
->
®l_mv
[
LIST_0
];

3437 
MÙiÚVeùÜ
 ****
®l_mv_l1
 = 
cu¼Sliû
->
®l_mv
[
LIST_1
];

3439 
b»d_me
 = 
B8x8Info
->
b»d
;

3440 
pdœ8
 = 
B8x8Info
->
pdœ
;

3441 ià(
b»d_me
)

3443 
®l_mv_l0
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1][
LIST_0
];

3444 
®l_mv_l1
 = 
cu¼Sliû
->
b»d_mv
[
b»d_me
 - 1][
LIST_1
];

3447 ià((
pdœ8
==0 ||…dir8==2))

3449 
l0_»f
 = 
B8x8Info
->
»f
[
LIST_0
];

3450 
	`memýy
(&
lc_l0_mv8x8
[0][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3451 
	`memýy
(&
lc_l0_mv8x8
[1][
i0
], &
®l_mv_l0
[
l0_»f
][
mode
][
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3455 
	`mem£t
(&
lc_l0_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3456 
	`mem£t
(&
lc_l0_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3459 ià((
pdœ8
==1 ||…dir8==2))

3461 
l1_»f
 = 
B8x8Info
->
»f
[
LIST_1
];

3462 
	`memýy
(&
lc_l1_mv8x8
[0][
i0
], &
®l_mv_l1
[
l1_»f
][
mode
][
j0
][i0], 2 * (
MÙiÚVeùÜ
));

3463 
	`memýy
(&
lc_l1_mv8x8
[1][
i0
], &
®l_mv_l1
[
l1_»f
][
mode
][
j1
][i0], 2 * (
MÙiÚVeùÜ
));

3467 
	`mem£t
(&
lc_l1_mv8x8
[0][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3468 
	`mem£t
(&
lc_l1_mv8x8
[1][
i0
], 0, 2 * (
MÙiÚVeùÜ
));

3471 
	}
}

3480 
	$£t_mbaff_·¿m‘”s
(
Maüoblock
 *
cu¼MB
)

3482 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3483 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

3484 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3486 
j
, 
i
;

3487 
mode
 = 
cu¼MB
->
be¡_mode
;

3488 **
»dmodes
 = 
p_Vid
->
»dmode
;

3489 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

3490 
RD_DATA
 *
rdÝt
 = 
cu¼Sliû
->
rdd©a
;

3494 
	`cÝy_image_d©a_16x16
(
rdÝt
->
»c_mb
[0], &
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 0, cu¼MB->
pix_x
);

3496 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

3498 
	`cÝy_image_d©a
(
rdÝt
->
»c_mb
[1], &
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_c_y
], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

3499 
	`cÝy_image_d©a
(
rdÝt
->
»c_mb
[2], &
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_c_y
], 0, cu¼MB->
pix_c_x
,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

3503 
rdÝt
->
mode
 = mode;

3504 
rdÝt
->
i16off£t
 = 
cu¼MB
->i16offset;

3505 
rdÝt
->
i16mode
 = 
cu¼MB
->i16mode;

3506 
rdÝt
->
cbp
 = 
cu¼MB
->cbp;

3507 
rdÝt
->
cbp_blk
 = 
cu¼MB
->cbp_blk;

3508 
rdÝt
->
mb_ty³
 = 
cu¼MB
->mb_type;

3510 
rdÝt
->
luma_ŒªsfÜm_size_8x8_æag
 = 
cu¼MB
->luma_transform_size_8x8_flag;

3512 if(
rdÝt
->
mb_ty³
 =ð0 && 
mode
 != 0)

3514 
mode
=0;

3515 
rdÝt
->
mode
=0;

3518 
	`memýy
(
rdÝt
->
cofAC
[0][0][0], 
cu¼Sliû
->cofAC[0][0][0], (4+
p_Vid
->
num_blk8x8_uv
) * 4 * 2 * 65 * ());

3519 
	`memýy
(
rdÝt
->
cofDC
[0][0], 
cu¼Sliû
->cofDC[0][0], 3 * 2 * 18 * ());

3521 
	`memýy
(
rdÝt
->
b8x8
, 
cu¼MB
->b8x8, 
BLOCK_MULTIPLE
 * (
Info8x8
));

3524 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

3526 ià(
p_IÅ
->
BiP»dMERefšem’ts
 == 1)

3528 
k
;

3529 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

3531 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

3533 
k
 = 2*(
j
 >> 1)+(
i
 >> 1);

3534 ià(
cu¼MB
->
b8x8
[
k
].
b»d
 == 0)

3536 
rdÝt
->
»çr
[
LIST_0
][
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[LIST_0];

3537 
rdÝt
->
»çr
[
LIST_1
][
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[LIST_1];

3541 
rdÝt
->
»çr
[
LIST_0
][
j
][
i
] = 0;

3542 
rdÝt
->
»çr
[
LIST_1
][
j
][
i
] = 0;

3549 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

3551 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

3553 
rdÝt
->
»çr
[
LIST_0
][
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[LIST_0];

3554 
rdÝt
->
»çr
[
LIST_1
][
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[LIST_1];

3561 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

3563 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

3565 
rdÝt
->
»çr
[
LIST_0
][
j
][
i
] = 
mÙiÚ
[
cu¼MB
->
block_y
 + j][cu¼MB->
block_x
 + i].
»f_idx
[LIST_0];

3571 
	`memýy
(
rdÝt
->
šŒa_´ed_modes
, 
cu¼MB
->šŒa_´ed_modes, 
MB_BLOCK_PARTITIONS
 * ());

3572 
	`memýy
(
rdÝt
->
šŒa_´ed_modes8x8
,
cu¼MB
->šŒa_´ed_modes8x8, 
MB_BLOCK_PARTITIONS
 * ());

3573 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

3575 
	`memýy
(&
rdÝt
->
»dmode
[
j
][
cu¼MB
->
block_x
],&
»dmodes
[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

3577 
	}
}

3580 
	$assign_’c_piùu»_·¿ms
 (
Maüoblock
 *
cu¼MB
, 
mode
, 
Info8x8
 *
be¡
, 
block
)

3582 
i
,
j
;

3583 
block_y
, 
block_x
;

3584 
li¡
;

3585 
MÙiÚVeùÜ
 **
cu¼_mv
 = 
NULL
;

3586 
li¡_off£t
 = 
cu¼MB
->list_offset;

3587 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3588 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3589 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

3590 
maxli¡
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
) ? 1: 0;

3591 
StÜabËPiùu»
 *
li¡X
 = 
NULL
;

3593 
¡¬t_x
 = 0, 
¡¬t_y
 = 0, 
’d_x
 = 
BLOCK_MULTIPLE
, 
’d_y
 = BLOCK_MULTIPLE;

3595 
mode
)

3598 
¡¬t_x
 = 0;

3599 
¡¬t_y
 = 0;

3600 
’d_x
 = 
BLOCK_MULTIPLE
;

3601 
’d_y
 = 
BLOCK_MULTIPLE
;

3604 
¡¬t_x
 = 0;

3605 
¡¬t_y
 = 
block
;

3606 
’d_x
 = 
BLOCK_MULTIPLE
;

3607 
’d_y
 = 
block
 + 2;

3610 
¡¬t_x
 = 
block
;

3611 
¡¬t_y
 = 0;

3612 
’d_x
 = 
block
 + 2;

3613 
’d_y
 = 
BLOCK_MULTIPLE
;

3617 
¡¬t_x
 = ((
block
>>1) & 0x01)* 2;

3618 
¡¬t_y
 = ((
block
>>1) & 0x02);

3619 
’d_x
 = 
¡¬t_x
 + 2;

3620 
’d_y
 = 
¡¬t_y
 + 2;

3624 
li¡
 = 0;†i¡ <ð
maxli¡
;†ist++)

3626 ià((
be¡
->
pdœ
 !ð2è&& (be¡->pdœ !ð
li¡
))

3628 
j
 = 
cu¼MB
->
block_y
 + 
¡¬t_y
; j < cu¼MB->block_y + 
’d_y
; j++)

3630 
i
 = 
cu¼MB
->
block_x
 + 
¡¬t_x
; i < cu¼MB->block_x + 
’d_x
; i++)

3632 
mÙiÚ
[
j
][
i
].
»f_pic
[
li¡
] = 
NULL
;

3633 
mÙiÚ
[
j
][
i
].
mv
[
li¡
] = 
z”o_mv
;

3634 
mÙiÚ
[
j
][
i
].
»f_idx
[
li¡
] = - 1;

3640 
be¡
->
b»d
)

3644 
be¡»f
 = 
be¡
->
»f
[
li¡
];

3645 
cu¼_mv
 = 
cu¼Sliû
->
®l_mv
[
li¡
][
be¡»f
][
mode
];

3646 
li¡X
 = 
cu¼Sliû
->li¡X[
li¡
 + 
li¡_off£t
][
be¡»f
];

3650 
cu¼_mv
 = 
cu¼Sliû
->
b»d_mv
[0][
li¡
][0][
mode
] ;

3651 
li¡X
 = 
cu¼Sliû
->li¡X[
li¡
 + 
li¡_off£t
][0];

3654 
cu¼_mv
 = 
cu¼Sliû
->
b»d_mv
[1][
li¡
][0][
mode
] ;

3655 
li¡X
 = 
cu¼Sliû
->li¡X[
li¡
 + 
li¡_off£t
][0];

3661 
j
 = 
¡¬t_y
; j < 
’d_y
; j++)

3663 
block_y
 = 
cu¼MB
->block_y + 
j
;

3664 
i
 = 
¡¬t_x
; i < 
’d_x
; i++)

3666 
block_x
 = 
cu¼MB
->block_x + 
i
;

3667 
mÙiÚ
[
block_y
][
block_x
].
»f_pic
 [
li¡
] = 
li¡X
;

3668 
mÙiÚ
[
block_y
][
block_x
].
mv
 [
li¡
] = 
cu¼_mv
[
j
][
i
];

3673 
	}
}

3681 
	$£t_block8x8_šfo
(
Block8x8Info
 *
b8x8šfo
, 
mode
, 
block
, 
Info8x8
 *
be¡
)

3684 ià(
mode
==3)

3686 
b8x8šfo
->
be¡
[3][
block
 ] = *best;

3687 
b8x8šfo
->
be¡
[3][
block
+2] = *best;

3689 ià(
mode
==2)

3691 
b8x8šfo
->
be¡
[2][2*
block
 ] = *best;

3692 
b8x8šfo
->
be¡
[2][2*
block
 + 1] = *best;

3694 ià(
mode
==1)

3696 
b8x8šfo
->
be¡
[1][0] = *best;

3697 
b8x8šfo
->
be¡
[1][1] = *best;

3698 
b8x8šfo
->
be¡
[1][2] = *best;

3699 
b8x8šfo
->
be¡
[1][3] = *best;

3704 
b8x8šfo
->
be¡
[
mode
][
block
] = *best;

3706 
	}
}

3714 
	$£t_subblock8x8_šfo
(
Block8x8Info
 *
b8x8šfo
,
mode
, 
block
, 
RD_8x8DATA
 *
Œ
)

3716 
b8x8šfo
->
be¡
 [
mode
][
block
] = 
Œ
->
·¹
[block];

3717 
	}
}

3721 
	$upd©e_»äesh_m­
(
Maüoblock
 *
cu¼MB
, 
šŒa
, 
šŒa1
)

3723 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3724 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

3726 ià(
p_IÅ
->
Re¡riùRef
==1)

3729 ià(
p_IÅ
->
rdÝt
<2)

3731 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
 ] = (
by‹
è(
šŒa
 ? 1 : 0);

3732 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
+1] = (
by‹
è(
šŒa
 ? 1 : 0);

3733 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
 ] = (
by‹
è(
šŒa
 ? 1 : 0);

3734 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
+1] = (
by‹
è(
šŒa
 ? 1 : 0);

3736 ià(
p_IÅ
->
rdÝt
 == 3)

3738 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
 ] = (
by‹
è(
šŒa1
==0 && (cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
) ? 1 : 0);

3739 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
+1] = (
by‹
è(
šŒa1
==0 && (cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
) ? 1 : 0);

3740 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
 ] = (
by‹
è(
šŒa1
==0 && (cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
) ? 1 : 0);

3741 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
+1] = (
by‹
è(
šŒa1
==0 && (cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
) ? 1 : 0);

3744 ià(
p_IÅ
->
Re¡riùRef
==2)

3746 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
 ] = (
by‹
è(cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
 ? 1 : 0);

3747 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 ][2*cu¼MB->
mb_x
+1] = (
by‹
è(cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
 ? 1 : 0);

3748 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
 ] = (
by‹
è(cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
 ? 1 : 0);

3749 
p_Vid
->
»äesh_m­
[2*
cu¼MB
->
mb_y
 + 1][2*cu¼MB->
mb_x
+1] = (
by‹
è(cu¼MB->
mb_ty³
==
I16MB
 || cu¼MB->mb_ty³==
I4MB
 ? 1 : 0);

3751 
	}
}

3753 
	$v®id_šŒa_mode
(
Sliû
 *
cu¼Sliû
, 
mode
)

3755 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

3757 ià(
p_IÅ
->
IÁ¿Di§bËIÁ”OÆy
==0 || (
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
))

3759 ià(
p_IÅ
->
IÁ¿4x4P¬Di§bË
 && (
mode
==
VERT_PRED
||mode==
HOR_PRED
))

3762 ià(
p_IÅ
->
IÁ¿4x4DŸgDi§bË
 && (
mode
==
DIAG_DOWN_LEFT_PRED
||mode==
DIAG_DOWN_RIGHT_PRED
))

3765 ià(
p_IÅ
->
IÁ¿4x4DœDi§bË
 && 
mode
>=
VERT_RIGHT_PRED
)

3769 
	}
}

3771 
di¡blk
 
	$compu‹_§d4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

3773 
img³l
 *
cur_lše
, *
´d_lše
;

3774 
i32Co¡
 = 0;

3775 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

3777 
j
;

3778 
j
 = 0; j < 
BLOCK_SIZE
; j++)

3780 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

3781 
´d_lše
 = 
´d_img
[
j
];

3783 
i32Co¡
 +ð
	`Ÿbs
(
cur_lše
[0] - 
´d_lše
[0]);

3784 
i32Co¡
 +ð
	`Ÿbs
(
cur_lše
[1] - 
´d_lše
[1]);

3785 
i32Co¡
 +ð
	`Ÿbs
(
cur_lše
[2] - 
´d_lše
[2]);

3786 
i32Co¡
 +ð
	`Ÿbs
(
cur_lše
[3] - 
´d_lše
[3]);

3788 ià(
i32Co¡
 > 
imš_co¡
)

3790 (
mš_co¡
);

3793  
	`di¡_sÿË
(
i32Co¡
);

3794 
	}
}

3796 
di¡blk
 
	$compu‹_s£4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

3798 
j
, 
i
;

3799 
img³l
 *
cur_lše
, *
´d_lše
;

3800 
i32Co¡
 = 0;

3801 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

3802 
j
 = 0; j < 
BLOCK_SIZE
; j++)

3804 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

3805 
´d_lše
 = 
´d_img
[
j
];

3806 
i
 = 0; i < 
BLOCK_SIZE
; i++)

3808 
i32Co¡
 +ð
	`Ÿbs2
(*
cur_lše
++ - *
´d_lše
++);

3811 ià(
i32Co¡
 > 
imš_co¡
)

3813 (
mš_co¡
);

3816  
	`di¡_sÿË
(
i32Co¡
);

3817 
	}
}

3819 
di¡blk
 
	$compu‹_§td4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

3821 
j
, 
i
;

3822 
img³l
 *
cur_lše
, *
´d_lše
;

3823 
diff
[16];

3825 *
d
 = &
diff
[0];

3827 
j
 = 0; j < 
BLOCK_SIZE
; j++)

3829 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

3830 
´d_lše
 = 
´d_img
[
j
];

3832 
i
 = 0; i < 
BLOCK_SIZE
; i++)

3834 *
d
++ = *
cur_lše
++ - *
´d_lše
++;

3838  
	`di¡_sÿË
(
	`Hadam¬dSAD4x4
 (
diff
));

3839 
	}
}

3841 
di¡blk
 
	$compu‹_comp4x4_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
´d_img
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

3843 
j
, 
i
;

3844 
img³l
 *
cur_lše
, *
´d_lše
;

3845 
diff
[16];

3847 *
d
 = &
diff
[0];

3849 
j
 = 0; j < 
BLOCK_SIZE
; j++)

3851 
cur_lše
 = &
cur_img
[
j
][
pic_Ýix_x
];

3852 
´d_lše
 = 
´d_img
[
j
];

3854 
i
 = 0; i < 
BLOCK_SIZE
; i++)

3856 *
d
++ = *
cur_lše
++ - *
´d_lše
++;

3859 (
p_Vid
->
	`di¡ÜtiÚ4x4
 (
diff
, 
mš_co¡
));

3860 
	}
}

3864 
	$upd©e_qp_cbp_tmp
(
Maüoblock
 *
cu¼MB
, 
cbp
)

3866 ià(((
cbp
!=0 || 
cu¼MB
->
be¡_mode
==
I16MB
è&& (cu¼MB->be¡_mode!=
IPCM
) ))

3867 
cu¼MB
->
´ev_cbp
 = 1;

3868 ià((
cbp
==0è|| (
cu¼MB
->
be¡_mode
==
IPCM
))

3870 
cu¼MB
->
´ev_cbp
 = 0;

3871 
cu¼MB
->
qp
 = cu¼MB->
´ev_qp
;

3872 
cu¼MB
->
p_Vid
->
qp
 = currMB->qp;

3873 
	`upd©e_qp
(
cu¼MB
);

3875 
	}
}

3884 
	$upd©e_qp_cbp
(
Maüoblock
 *
cu¼MB
)

3886 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3887 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

3890 ià((
cu¼MB
->
cbp
!=0 || cu¼MB->
be¡_mode
 =ð
I16MB
è&& (cu¼MB->be¡_mod!ð
IPCM
))

3891 
cu¼MB
->
´ev_cbp
 = 1;

3894 
cu¼MB
->
´ev_cbp
 = 0;

3895 
cu¼MB
->
qp
 = cu¼MB->
´ev_qp
;

3896 
p_Vid
->
qp
 = 
cu¼MB
->qp;

3897 
	`upd©e_qp
(
cu¼MB
);

3900 ià(
p_IÅ
->
MbIÁ”Ïû
)

3902 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3904 
cu¼Sliû
->
rdd©a
->
qp
 = 
cu¼MB
->qp;

3905 
cu¼Sliû
->
rdd©a
->
´ev_cbp
 = 
cu¼MB
->prev_cbp;

3907 
	}
}

3914 
	$cÝy_rdÝt_d©a
 (
Maüoblock
 *
cu¼MB
)

3916 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

3917 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

3918 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

3919 
i
, 
j
;

3920 
RD_DATA
 *
rdÝt
 = 
cu¼Sliû
->
rdd©a
;

3922 
mode
;

3923 
b8mode
, 
b8pdœ
;

3924 
block_y
;

3926 
li¡_off£t
 = 
cu¼MB
->list_offset;

3928 
mode
 = 
rdÝt
->mode;

3929 
cu¼MB
->
mb_ty³
 = 
rdÝt
->mb_type;

3930 
cu¼MB
->
cbp
 = 
rdÝt
->cbp;

3931 
cu¼MB
->
cbp_blk
 = 
rdÝt
->cbp_blk;

3932 
cu¼MB
->
i16off£t
 = 
rdÝt
->i16offset;

3933 
cu¼MB
->
i16mode
 = 
rdÝt
->i16mode;

3935 
cu¼MB
->
´ev_qp
 = 
rdÝt
->prev_qp;

3936 
cu¼MB
->
´ev_dqp
 = 
rdÝt
->prev_dqp;

3937 
cu¼MB
->
´ev_cbp
 = 
rdÝt
->prev_cbp;

3938 
cu¼MB
->
qp
 = 
rdÝt
->qp;

3939 
	`upd©e_qp
 (
cu¼MB
);

3941 
cu¼MB
->
c_»d_mode
 = 
rdÝt
->c_ipred_mode;

3943 
	`memýy
(
cu¼Sliû
->
cofAC
[0][0][0],
rdÝt
->cofAC[0][0][0], (4 + 
p_Vid
->
num_blk8x8_uv
) * 4 * 2 * 65 * ());

3944 
	`memýy
(
cu¼Sliû
->
cofDC
[0][0],
rdÝt
->cofDC[0][0], 3 * 2 * 18 * ());

3946 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

3948 
block_y
 = 
cu¼MB
->block_y + 
j
;

3949 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

3951 
mÙiÚ
[
block_y
][
cu¼MB
->
block_x
 + 
i
].
»f_idx
 [
LIST_0
] = 
rdÝt
->
»çr
[LIST_0][
j
][i];

3952 
mÙiÚ
[
block_y
][
cu¼MB
->
block_x
 + 
i
].
»f_pic
 [
LIST_0
] = 
rdÝt
->
»çr
[LIST_0][
j
][i] < 0 ? 
NULL
 :

3953 
cu¼Sliû
->
li¡X
[
LIST_0
 + 
li¡_off£t
][()
rdÝt
->
»çr
[LIST_0][
j
][
i
]];

3957 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

3959 
j
 = 0; j < 
BLOCK_MULTIPLE
; j++)

3961 
block_y
 = 
cu¼MB
->block_y + 
j
;

3962 
i
 = 0; i < 
BLOCK_MULTIPLE
; i++)

3964 
mÙiÚ
[
block_y
][
cu¼MB
->
block_x
 + 
i
].
»f_idx
 [
LIST_1
] = 
rdÝt
->
»çr
[LIST_1][
j
][i];

3965 
mÙiÚ
[
block_y
][
cu¼MB
->
block_x
 + 
i
].
»f_pic
 [
LIST_1
] = 
rdÝt
->
»çr
[LIST_1][
j
][i] < 0 ? 
NULL
 :

3966 
cu¼Sliû
->
li¡X
[
LIST_1
 + 
li¡_off£t
][(è
rdÝt
->
»çr
[LIST_1][
j
][
i
]];

3973 
	`cÝy_image_d©a_16x16
(&
p_Vid
->
’c_piùu»
->
imgY
[
cu¼MB
->
pix_y
], 
rdÝt
->
»c_mb
[0], cu¼MB->
pix_x
, 0);

3975 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

3977 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
cu¼MB
->
pix_c_y
], 
rdÝt
->
»c_mb
[1], cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

3978 
	`cÝy_image_d©a
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
cu¼MB
->
pix_c_y
], 
rdÝt
->
»c_mb
[2], cu¼MB->
pix_c_x
, 0,…_Vid->
mb_ü_size_x
,…_Vid->
mb_ü_size_y
);

3982 
	`memýy
(
cu¼MB
->
b8x8
, 
rdÝt
->b8x8, 
BLOCK_MULTIPLE
 * (
Info8x8
));

3984 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 = 
rdÝt
->luma_transform_size_8x8_flag;

3987 ià(
mode
 =ð
P8x8
)

3989 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,
rdÝt
->šŒa_´ed_modes, 
MB_BLOCK_PARTITIONS
 * ());

3990 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

3991 
	`memýy
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
],&
rdÝt
->»dmode[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

3993 ià(
mode
 !ð
I4MB
 && mod!ð
I8MB
)

3995 
	`mem£t
(
cu¼MB
->
šŒa_´ed_modes
,
DC_PRED
, 
MB_BLOCK_PARTITIONS
 * ());

3996 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

3997 
	`mem£t
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
],
DC_PRED
, 
BLOCK_MULTIPLE
 * ());

3999 ià(
mode
 =ð
I4MB
 || mod=ð
I8MB
)

4001 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes
,
rdÝt
->šŒa_´ed_modes, 
MB_BLOCK_PARTITIONS
 * ());

4002 
	`memýy
(
cu¼MB
->
šŒa_´ed_modes8x8
,
rdÝt
->šŒa_´ed_modes8x8, 
MB_BLOCK_PARTITIONS
 * ());

4003 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

4005 
	`memýy
(&
p_Vid
->
»dmode
[
j
][
cu¼MB
->
block_x
],&
rdÝt
->»dmode[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

4009 ià(
cu¼Sliû
->
mb_aff_äame_æag
 || (cu¼Sliû->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1))

4012 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

4013 
	`cÝy_mÙiÚ_veùÜs_MB
 (
cu¼Sliû
, 
rdÝt
);

4015 ià(!
	`is_šŒa
(
cu¼MB
))

4017 
cu¼MB
->
b8x8
[0].
b»d
 = 0;

4018 
cu¼MB
->
b8x8
[1].
b»d
 = 0;

4019 
cu¼MB
->
b8x8
[2].
b»d
 = 0;

4020 
cu¼MB
->
b8x8
[3].
b»d
 = 0;

4022 
j
 = 0; j < 4; j++)

4024 
i
 = 0; i < 4; i++)

4026 
b8mode
 = 
cu¼MB
->
b8x8
[(
i
 >> 1è+ 2 * (
j
 >> 1)].
mode
;

4027 
b8pdœ
 = 
cu¼MB
->
b8x8
[(
i
 >> 1è+ 2 * (
j
 >> 1)].
pdœ
;

4029 ià(
b8pdœ
!=1)

4031 
mÙiÚ
[
j
+
cu¼MB
->
block_y
][
i
+cu¼MB->
block_x
].
mv
[
LIST_0
] = 
rdÝt
->
®l_mv
[LIST_0][(ìdÝt->
»çr
[LIST_0][j][i]][
b8mode
][j][i];

4035 
mÙiÚ
[
j
+
cu¼MB
->
block_y
][
i
+cu¼MB->
block_x
].
mv
[
LIST_0
] = 
z”o_mv
;

4037 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

4039 ià(
b8pdœ
!=0)

4041 
mÙiÚ
[
j
+
cu¼MB
->
block_y
][
i
+cu¼MB->
block_x
].
mv
[
LIST_1
] = 
rdÝt
->
®l_mv
[LIST_1][(ìdÝt->
»çr
[LIST_1][j][i]][
b8mode
][j][i];

4045 
mÙiÚ
[
j
+
cu¼MB
->
block_y
][
i
+cu¼MB->
block_x
].
mv
[
LIST_1
] = 
z”o_mv
;

4054 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

4056 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

4058 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

4060 
mÙiÚ
[
j
][
i
].
mv
[
LIST_0
] = 
z”o_mv
;

4061 
mÙiÚ
[
j
][
i
].
mv
[
LIST_1
] = 
z”o_mv
;

4067 
j
 = 
cu¼MB
->
block_y
; j < currMB->block_y + 4; j++)

4069 
i
 = 
cu¼MB
->
block_x
; i < currMB->block_x + 4; i++)

4071 
mÙiÚ
[
j
][
i
].
mv
[
LIST_0
] = 
z”o_mv
;

4077 
	}
}

	@lencod/src/rdopt_coding_state.c

17 
	~"glob®.h
"

19 
	~"rdÝt_codšg_¡©e.h
"

20 
	~"ÿbac.h
"

21 
	~"mem®loc.h
"

29 
	$d–‘e_codšg_¡©e
 (
CSobj
 *
cs
)

31 ià(
cs
 !ð
NULL
)

34 ià(
cs
->
’ûnv
 !ð
NULL
)

36 
	`ä“
 (
cs
->
’ûnv
);

37 
cs
->
’ûnv
 = 
NULL
;

39 ià(
cs
->
b™¡»am
 !ð
NULL
)

41 
	`ä“
 (
cs
->
b™¡»am
);

42 
cs
->
b™¡»am
 = 
NULL
;

46 
	`d–‘e_cÚ‹xts_MÙiÚInfo
 (
cs
->
mÙ_ùx
);

47 
	`d–‘e_cÚ‹xts_Textu»Info
 (
cs
->
‹x_ùx
);

49 ià(
cs
->
cbp_b™s_8x8
 !ð
NULL
)

51 
	`ä“
 (
cs
->
cbp_b™s_8x8
);

52 
cs
->
cbp_b™s_8x8
 = 
NULL
;

56 
	`ä“
 (
cs
);

57 
cs
=
NULL
;

59 
	}
}

68 
CSobj
 *
	$ü—‹_codšg_¡©e
 (
IÅutP¬am‘”s
 *
p_IÅ
)

70 
CSobj
 *
cs
;

73 ià((
cs
 = (
CSobj
 *è
	`ÿÎoc
 (1, (CSobj))è=ð
NULL
)

74 
	`no_mem_ex™
("init_coding_state: cs");

77 
cs
->
no_·¹
 = 
p_IÅ
->
·¹™iÚ_mode
 == 0 ? 1 : 3;

78 ià(
p_IÅ
->
symbÞ_mode
 =ð
CABAC
)

80 ià((
cs
->
’ûnv
 = (
EncodšgEnvœÚm’t
*è
	`ÿÎoc
 (cs->
no_·¹
, (EncodšgEnvœÚm’t))è=ð
NULL
)

81 
	`no_mem_ex™
("init_coding_state: cs->encenv");

83 ià((
cs
->
b™¡»am
 = (
B™¡»am
*è
	`ÿÎoc
 (cs->
no_·¹
, (B™¡»am))è=ð
NULL
)

84 
	`no_mem_ex™
("init_coding_state: cs->bitstream");

86 
cs
->
mÙ_ùx
 = 
	`ü—‹_cÚ‹xts_MÙiÚInfo
 ();

87 
cs
->
‹x_ùx
 = 
	`ü—‹_cÚ‹xts_Textu»Info
();

92 
cs
->
’ûnv
 = 
NULL
;

93 ià((
cs
->
b™¡»am
 = (
B™¡»am
*è
	`ÿÎoc
 (cs->
no_·¹
, (B™¡»am))è=ð
NULL
)

94 
	`no_mem_ex™
("init_coding_state: cs->bitstream");

96 
cs
->
mÙ_ùx
 = 
NULL
;

97 
cs
->
‹x_ùx
 = 
NULL
;

100 ià(
p_IÅ
->
ProfžeIDC
 =ð
FREXT_Hi444
)

102 ià((
cs
->
cbp_b™s_8x8
 = (
št64
 *è
	`ÿÎoc
 (3, (št64))è=ð
NULL
)

103 
	`no_mem_ex™
("init_coding_state: cs->cbp_bits_8x8");

106 
cs
->
cbp_b™s_8x8
 = 
NULL
;

108  
cs
;

109 
	}
}

117 
	$¡Üe_codšg_¡©e_nÜdo
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

119 
	}
}

128 
	$¡Üe_codšg_¡©e_ÿvlc
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

130 
i
;

131 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

132 
i_Ï¡
 = 
cu¼Sliû
->
idr_æag
? 1 : 
cs
->
no_·¹
;

135 
i
 = 0; i < 
i_Ï¡
; i++)

137 
cs
->
b™¡»am
[
i
] = *
cu¼Sliû
->
·¹A¼
[i].bitstream;

141 
cs
->
b™s
 = 
cu¼MB
->bits;

144 ià(
cu¼MB
->
mb_ty³
 <ð
P8x8
)

145 
	`memýy
 (
cs
->
mvd
, 
cu¼MB
->mvd, 
BLOCK_CONTEXT
 * ());

146 
	`memýy
 (
cs
->
cbp_b™s
, 
cu¼MB
->cbp_b™s, 3 * (
št64
));

148 ià(
cu¼Sliû
->
P444_jošed
)

149 
	`memýy
 (
cs
->
cbp_b™s_8x8
, 
cu¼MB
->cbp_b™s_8x8, 3 * (
št64
));

150 
	}
}

158 
	$¡Üe_codšg_¡©e_ÿbac
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

160 
i
;

161 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

162 
i_Ï¡
 = 
cu¼Sliû
->
idr_æag
? 1:
cs
->
no_·¹
;

163 
D©aP¬t™iÚ
 *
·¹A¼
 = &
cu¼Sliû
->partArr[0];

167 
i
 = 0; i < 
i_Ï¡
; i++)

169 
cs
->
b™¡»am
[
i
] = *
·¹A¼
->bitstream;

170 
cs
->
’ûnv
[
i
] = (
·¹A¼
++)->
“_ÿbac
;

174 *
cs
->
mÙ_ùx
 = *
cu¼Sliû
->mot_ctx;

175 *
cs
->
‹x_ùx
 = *
cu¼Sliû
->tex_ctx;

178 
cs
->
b™s
 = 
cu¼MB
->bits;

181 ià(
cu¼MB
->
mb_ty³
 <ð
P8x8
)

182 
	`memýy
 (
cs
->
mvd
, 
cu¼MB
->mvd, 
BLOCK_CONTEXT
 * ());

183 
	`memýy
 (
cs
->
cbp_b™s
, 
cu¼MB
->cbp_b™s, 3 * (
št64
));

185 ià(
cu¼Sliû
->
P444_jošed
)

186 
	`memýy
 (
cs
->
cbp_b™s_8x8
, 
cu¼MB
->cbp_b™s_8x8, 3 * (
št64
));

187 
	}
}

195 
	$»£t_codšg_¡©e_nÜdo
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

197 
	}
}

205 
	$»£t_codšg_¡©e_ÿvlc
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

207 
i
;

208 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

209 
i_Ï¡
 = 
cu¼Sliû
->
idr_æag
? 1:
cs
->
no_·¹
;

213 
i
 = 0; i < 
i_Ï¡
; i++)

216 *
cu¼Sliû
->
·¹A¼
[
i
].
b™¡»am
 = 
cs
->bitstream[i];

220 
cu¼MB
->
b™s
 = 
cs
->bits;

223 ià(
cu¼MB
->
mb_ty³
 <ð
P8x8
)

224 
	`memýy
 (
cu¼MB
->
mvd
, 
cs
->mvd, 
BLOCK_CONTEXT
 * ());

225 
	`memýy
 (
cu¼MB
->
cbp_b™s
, 
cs
->cbp_b™s, 3 * (
št64
));

226 if(
cu¼Sliû
->
P444_jošed
)

227 
	`memýy
 (
cu¼MB
->
cbp_b™s_8x8
, 
cs
->cbp_b™s_8x8, 3 * (
št64
));

228 
	}
}

237 
	$»£t_codšg_¡©e_ÿbac
 (
Maüoblock
 *
cu¼MB
, 
CSobj
 *
cs
)

239 
i
;

240 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

241 
i_Ï¡
 = 
cu¼Sliû
->
idr_æag
? 1:
cs
->
no_·¹
;

242 
D©aP¬t™iÚ
 *
·¹A¼
 = &
cu¼Sliû
->partArr[0];

246 
i
 = 0; i < 
i_Ï¡
; i++)

249 *
·¹A¼
->
b™¡»am
 = 
cs
->b™¡»am[
i
];

250 (
·¹A¼
++)->
“_ÿbac
 = 
cs
->
’ûnv
[
i
];

254 *
cu¼Sliû
->
mÙ_ùx
 = *
cs
->mot_ctx;

255 *
cu¼Sliû
->
‹x_ùx
 = *
cs
->tex_ctx;

258 
cu¼MB
->
b™s
 = 
cs
->bits;

261 ià(
cu¼MB
->
mb_ty³
 <ð
P8x8
)

262 
	`memýy
 (
cu¼MB
->
mvd
, 
cs
->mvd, 
BLOCK_CONTEXT
 * ());

264 
	`memýy
 (
cu¼MB
->
cbp_b™s
, 
cs
->cbp_b™s, 3 * (
št64
));

266 if(
cu¼Sliû
->
P444_jošed
)

267 
	`memýy
 (
cu¼MB
->
cbp_b™s_8x8
, 
cs
->cbp_b™s_8x8, 3 * (
št64
));

268 
	}
}

279 
	$š™_codšg_¡©e_m‘hods
(
Sliû
 *
cu¼Sliû
)

281 ià(
cu¼Sliû
->
p_IÅ
->
rdÝt
 == 0)

283 
cu¼Sliû
->
»£t_codšg_¡©e
 = 
»£t_codšg_¡©e_nÜdo
;

284 
cu¼Sliû
->
¡Üe_codšg_¡©e
 = 
¡Üe_codšg_¡©e_nÜdo
;

288 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

290 
cu¼Sliû
->
»£t_codšg_¡©e
 = 
»£t_codšg_¡©e_ÿbac
;

291 
cu¼Sliû
->
¡Üe_codšg_¡©e
 = 
¡Üe_codšg_¡©e_ÿbac
;

295 
cu¼Sliû
->
»£t_codšg_¡©e
 = 
»£t_codšg_¡©e_ÿvlc
;

296 
cu¼Sliû
->
¡Üe_codšg_¡©e
 = 
¡Üe_codšg_¡©e_ÿvlc
;

299 
	}
}

	@lencod/src/rdoq.c

10 
	~"cÚŒibutÜs.h
"

12 
	~<m©h.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"image.h
"

17 
	~"fmo.h
"

18 
	~"maüoblock.h
"

19 
	~"mb_acûss.h
"

20 
	~"rdÝt.h
"

21 
	~"rdoq.h
"

22 
	~"mv_£¬ch.h
"

24 
	#RDOQ_BASE
 0

	)

33 
	$š™_rdoq_¦iû
(
Sliû
 *
cu¼Sliû
)

37 
cu¼Sliû
->
nÜm_çùÜ_4x4
 = 
	`pow
(2, (2 * 
DQ_BITS
 + 19));

38 
cu¼Sliû
->
nÜm_çùÜ_8x8
 = 
	`pow
(2, (2 * 
Q_BITS_8
 + 9));

39 
	}
}

46 
	$š™_Œ–lis_d©a_DC_ü_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

47 
Lev–QuªtP¬ams
 *
q_·¿ms
, cÚ¡ 
by‹
 *
p_sÿn
,

48 
Ëv–D©aSŒuù
 *
d©aLev–
)

50 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

51 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

52 
i
, 
j
, 
cÛff_ùr
, 
’d_cÛff_ùr
 = 
p_Vid
->
num_cdc_cÛff
;

53 *
m7
;

54 
q_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

55 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

56 
”r
;

57 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

58 
e¡E¼
 = (è
e¡E¼4x4
[
qp_»m
][0][0] / 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

60 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

62 
j
 = *
p_sÿn
++;

63 
i
 = *
p_sÿn
++;

65 
m7
 = &
tblock
[
j
][
i
];

66 ià(*
m7
 == 0)

68 
d©aLev–
->
Ëv–
[0] = 0;

69 
d©aLev–
->
Ëv–DoubË
 = 0;

70 
d©aLev–
->
”rLev–
[0] = 0.0;

71 
d©aLev–
->
noLev–s
 = 1;

72 
”r
 = 0.0;

73 
d©aLev–
->
´e_Ëv–
 = 0;

74 
d©aLev–
->
sign
 = 0;

78 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

79 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

80 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

82 
low”IÁ
 = ((
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 )? 1 : 0;

83 
d©aLev–
->
Ëv–
[0] = 0;

84 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 1)

86 
d©aLev–
->
noLev–s
 = 1;

88 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 0)

90 
d©aLev–
->
Ëv–
[1] =†evel + 1;

91 
d©aLev–
->
noLev–s
 = 2;

93 ià(
Ëv–
 > 0 && 
low”IÁ
 == 1)

95 
d©aLev–
->
Ëv–
[1] =†evel;

96 
d©aLev–
->
noLev–s
 = 2;

100 
d©aLev–
->
Ëv–
[1] =†evel;

101 
d©aLev–
->
Ëv–
[2] =†evel + 1;

102 
d©aLev–
->
noLev–s
 = 3;

105 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

107 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

108 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

111 if(
d©aLev–
->
noLev–s
 == 1)

112 
d©aLev–
->
´e_Ëv–
 = 0;

114 
d©aLev–
->
´e_Ëv–
 = (
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
 + q_·¿ms->
Off£tComp
è>> 
q_b™s
;

115 
d©aLev–
->
sign
 = 
	`isign
(*
m7
);

117 
d©aLev–
++;

120 
	}
}

129 
	$š™_Œ–lis_d©a_DC_ü_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

130 
Lev–QuªtP¬ams
 *
q_·¿ms
, cÚ¡ 
by‹
 *
p_sÿn
,

131 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
)

133 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

134 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

135 
noCÛff
 = 0;

136 
i
, 
j
, 
cÛff_ùr
, 
’d_cÛff_ùr
 = 
p_Vid
->
num_cdc_cÛff
;

137 *
m7
;

138 
q_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

139 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

140 
”r
;

141 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

142 
e¡E¼
 = (è
e¡E¼4x4
[
qp_»m
][0][0] / 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

144 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

146 
j
 = *
p_sÿn
++;

147 
i
 = *
p_sÿn
++;

149 
m7
 = &
tblock
[
j
][
i
];

150 ià(*
m7
 == 0)

152 
d©aLev–
->
Ëv–
[0] = 0;

153 
d©aLev–
->
Ëv–DoubË
 = 0;

154 
d©aLev–
->
”rLev–
[0] = 0.0;

155 
d©aLev–
->
noLev–s
 = 1;

156 
”r
 = 0.0;

160 
sÿËd_cÛff
 = 
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
;

161 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

162 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

164 
low”IÁ
=Ð(
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 )? 1 : 0;

165 
d©aLev–
->
Ëv–
[0] = 0;

166 ià(
Ëv–
 == 0)

168 ià(
low”IÁ
 == 1)

170 
d©aLev–
->
noLev–s
 = 1;

174 
d©aLev–
->
Ëv–
[1] =†evel + 1;

175 
d©aLev–
->
noLev–s
 = 2;

176 *
kStÝ
 = 
cÛff_ùr
;

177 
noCÛff
++;

180 ià(
low”IÁ
 == 1)

182 
d©aLev–
->
Ëv–
[1] =†evel;

183 
d©aLev–
->
noLev–s
 = 2;

184 *
kStÝ
 = 
cÛff_ùr
;

185 
noCÛff
++;

189 
d©aLev–
->
Ëv–
[1] =†evel;

190 
d©aLev–
->
Ëv–
[2] =†evel + 1;

191 
d©aLev–
->
noLev–s
 = 3;

192 *
kStÝ
 = 
cÛff_ùr
;

193 *
kS¹
 = 
cÛff_ùr
;

194 
noCÛff
++;

197 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

199 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

200 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

203 
d©aLev–
++;

205  (
noCÛff
);

206 
	}
}

208 
	$g‘_dQP_bË
(
Sliû
 *
cu¼Sliû
)

210 
qp_off£t
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è? (cu¼Sliû->
RDOQ_QP_Num
 / 3): (currSlice->RDOQ_QP_Num >> 1);

211 
d–QPCÁ
, 
d–QP
;

213 
	`mem£t
(
cu¼Sliû
->
d–QPTabË
, 0, ()*9);

215 
d–QPCÁ
 = 0; d–QPCÁ < 
cu¼Sliû
->
RDOQ_QP_Num
; deltaQPCnt++)

217 ià(
d–QPCÁ
 == 0)

218 
d–QP
 = 0;

221 ià(
d–QPCÁ
 <ð
qp_off£t
)

222 
d–QP
 = 
d–QPCÁ
 - 1 - 
qp_off£t
;

224 
d–QP
 = 
d–QPCÁ
 - 
qp_off£t
;

226 
cu¼Sliû
->
d–QPTabË
[
d–QPCÁ
] = 
d–QP
;

228 
	}
}

230 
	$Œ–lis_mp
(
Maüoblock
 *
cu¼MB
)

232 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

233 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

234 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

236 
ma¡”QP
 = 0, 
d–QP
;

237 #ià
RDOQ_BASE


238 
qp_Ëá
, 
qp_up
;

239 cÚ¡ 
d–QPTabB
[] = {0, 1, -1, 2, 3, -2, 4, 5, -3};

240 cÚ¡ 
d–QPTabP
[] = {0, -1, 1, -2, 2, -3, 3, -4, 4};

241 
qp_ªchÜ
;

243 
d–QPCÁ
;

245 
ma¡”QP
 = 
p_Vid
->ma¡”QP =…_Vid->
qp
;

247 
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 = 0;

249 
cu¼Sliû
->
rdd©a_Œ–lis_be¡
.
mš_rdco¡
 = 1e30;

251 ià(
p_IÅ
->
symbÞ_mode
 =ð
CABAC
)

253 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_4x4
);

254 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_16AC
);

255 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_16DC
);

256 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

257 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_8x8
);

259 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

261 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_AC
);

262 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV420
)

263 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_DC
);

265 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_DC_2x4
);

269 #ià
RDOQ_BASE


270 
qp_Ëá
 = (
cu¼MB
->
mb_Ëá
è? cu¼MB->mb_Ëá->
qp
 : 
p_Vid
->
ma¡”QP
;

271 
qp_up
 = (
cu¼MB
->
mb_up
è? cu¼MB->mb_up->
qp
 : 
p_Vid
->
ma¡”QP
;

272 
qp_ªchÜ
 = (
qp_Ëá
 + 
qp_up
 + 1)>>1;

275 
d–QPCÁ
=0; d–QPCÁ < 
cu¼Sliû
->
RDOQ_QP_Num
; deltaQPCnt++)

277 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_Œ–lis_cu¼
;

278 
cu¼Sliû
->
rdd©a
->
mš_dco¡
 = 1e30;

279 #ià
RDOQ_BASE


280 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

281 
d–QP
 = 
d–QPTabB
[
d–QPCÁ
];

283 
d–QP
 = 
d–QPTabP
[
d–QPCÁ
];

288 
d–QP
 = 
cu¼Sliû
->
d–QPTabË
[
d–QPCÁ
];

291 
p_Vid
->
qp
 = 
	`iCl3
(-p_Vid->
b™d•th_luma_qp_sÿË
, 51, 
ma¡”QP
 + 
d–QP
);

292 
d–QP
 = 
p_Vid
->
qp
 - 
ma¡”QP
;

295 #ià
RDOQ_BASE


296 if(
d–QP
 !ð0 && !(
p_Vid
->
qp
 - 
qp_ªchÜ
 >ð-2 &&…_Vid->q°- qp_ªchÜ <ð1è&& 
cu¼MB
->
mb_Ëá
 && cu¼MB->
mb_up
 && 
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
)

298 if(
d–QP
 !ð0 && !(
p_Vid
->
qp
 - 
qp_ªchÜ
 >ð-1 &&…_Vid->q°- qp_ªchÜ <ð2è&& 
cu¼MB
->
mb_Ëá
 && cu¼MB->
mb_up
 && 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

302 
	`»£t_maüoblock
(
cu¼MB
);

303 
cu¼MB
->
qp
 = (è
p_Vid
->qp;

304 
	`upd©e_qp
 (
cu¼MB
);

306 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

307 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

310 iàÐ
cu¼Sliû
->
rdd©a_Œ–lis_cu¼
.
mš_rdco¡
 < cu¼Sliû->
rdd©a_Œ–lis_be¡
.min_rdcost)

311 
	`cÝy_rdd©a_Œ–lis
(
cu¼MB
, &
cu¼Sliû
->
rdd©a_Œ–lis_be¡
, cu¼Sliû->
rdd©a
);

313 ià(
p_IÅ
->
RDOQ_CP_MV
)

314 
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 = 1;

316 #ià(!
RDOQ_BASE
)

317 ià(
p_IÅ
->
RDOQ_Fa¡
 == 1)

319 ià((
p_Vid
->
qp
 - 
cu¼Sliû
->
rdd©a_Œ–lis_be¡
.qp > 1))

321 ià((
cu¼Sliû
->
rdd©a_Œ–lis_cu¼
.
cbp
 =ð0è&& (cu¼Sliû->rdd©a_Œ–lis_cu¼.
mb_ty³
 != 0))

323 ià((
cu¼Sliû
->
rdd©a_Œ–lis_be¡
.
mb_ty³
 =ð0è&& (cu¼Sliû->rdd©a_Œ–lis_be¡.
cbp
 == 0))

329 
	`»£t_maüoblock
(
cu¼MB
);

330 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_Œ–lis_be¡
;

332 
	`cÝy_rdÝt_d©a
 (
cu¼MB
);

333 
	`wr™e_maüoblock
 (
cu¼MB
, 1);

334 
p_Vid
->
qp
 = 
ma¡”QP
;

335 
	}
}

337 
	$Œ–lis_¥
(
Maüoblock
 *
cu¼MB
)

339 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

340 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

341 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

343 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

345 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

347 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_4x4
);

348 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_16AC
);

350 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_16DC
);

351 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
)

352 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
LUMA_8x8
);

354 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

356 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_AC
);

358 ià(
p_Vid
->
yuv_fÜm©
 =ð
YUV420
)

359 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_DC
);

361 
	`e¡RunLev–_CABAC
(
cu¼MB
, 
CHROMA_DC_2x4
);

365 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

366 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

368 
	`wr™e_maüoblock
 (
cu¼MB
, 1);

369 
	}
}

371 
	$Œ–lis_codšg
(
Maüoblock
 *
cu¼MB
)

373 ià(
cu¼MB
->
p_Sliû
->
RDOQ_QP_Num
 > 1)

375 
	`Œ–lis_mp
(
cu¼MB
);

379 
	`Œ–lis_¥
(
cu¼MB
);

381 
	}
}

383 
	$RDOQ_upd©e_mode
(
Sliû
 *
cu¼Sliû
, 
RD_PARAMS
 *
’c_mb
)

385 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

386 #ià(
MVC_EXTENSION_ENABLE
)

387 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[(
cu¼Sliû
->
p_Vid
->
num_of_Ïy”s
 > 1è? cu¼Sliû->
v›w_id
 : 0][(cu¼Sliû->
¦iû_ty³
 =ð
B_SLICE
)];

389 *
IÁ”S—rch
 = 
p_IÅ
->IÁ”S—rch[0][(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)];

392 
mb_ty³
 = 
cu¼Sliû
->
rdd©a_Œ–lis_be¡
.mb_type;

393 
i
;

394 
i
=0; i<
MAXMODE
; i++)

395 
’c_mb
->
v®id
[
i
] = 0;

397 
’c_mb
->
v®id
[
mb_ty³
] = 1;

399 if(
mb_ty³
 =ð
P8x8
)

401 
’c_mb
->
v®id
[4] = (è(
IÁ”S—rch
[4]);

402 
’c_mb
->
v®id
[5] = (è(
IÁ”S—rch
[5] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

403 
’c_mb
->
v®id
[6] = (è(
IÁ”S—rch
[6] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

404 
’c_mb
->
v®id
[7] = (è(
IÁ”S—rch
[7] && !(
p_IÅ
->
T¿nsfÜm8x8Mode
==2));

406 
	}
}

408 
	$cÝy_rdd©a_Œ–lis
 (
Maüoblock
 *
cu¼MB
, 
RD_DATA
 *
de¡
, RD_DATA *
¤c
)

410 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

411 
j
;

413 
de¡
->
mš_rdco¡
 = 
¤c
->min_rdcost;

414 
de¡
->
mš_dco¡
 = 
¤c
->min_dcost;

415 
de¡
->
mš_¿‹
 = 
¤c
->min_rate;

417 
	`memýy
(&
de¡
->
»c_mb
[0][0][0],&
¤c
->»c_mb[0][0][0], 
MB_PIXELS
 * (
img³l
));

419 ià(
p_Vid
->
yuv_fÜm©
 !ð
YUV400
)

421 
	`memýy
(&
de¡
->
»c_mb
[1][0][0],&
¤c
->»c_mb[1][0][0], 2 * 
MB_PIXELS
 * (
img³l
));

424 
	`memýy
(&
de¡
->
cofAC
[0][0][0][0], &
¤c
->cofAC[0][0][0][0], (4 + 
p_Vid
->
num_blk8x8_uv
) * 4 * 2 * 65 * ());

425 
	`memýy
(&
de¡
->
cofDC
[0][0][0], &
¤c
->cofDC[0][0][0], 3 * 2 * 18 * ());

427 
de¡
->
mb_ty³
 = 
¤c
->mb_type;

429 
	`memýy
(
de¡
->
b8x8
, 
¤c
->b8x8, 
BLOCK_MULTIPLE
 * (
Info8x8
));

431 
de¡
->
cbp
 = 
¤c
->cbp;

432 
de¡
->
mode
 = 
¤c
->mode;

433 
de¡
->
i16off£t
 = 
¤c
->i16offset;

434 
de¡
->
i16mode
 = 
¤c
->i16mode;

435 
de¡
->
c_»d_mode
 = 
¤c
->c_ipred_mode;

436 
de¡
->
luma_ŒªsfÜm_size_8x8_æag
 = 
¤c
->luma_transform_size_8x8_flag;

437 
de¡
->
NoMbP¬tLessThª8x8FÏg
 = 
¤c
->NoMbPartLessThan8x8Flag;

438 
de¡
->
qp
 = 
¤c
->qp;

440 
de¡
->
´ev_qp
 = 
¤c
->prev_qp;

441 
de¡
->
´ev_dqp
 = 
¤c
->prev_dqp;

442 
de¡
->
´ev_cbp
 = 
¤c
->prev_cbp;

443 
de¡
->
cbp_blk
 = 
¤c
->cbp_blk;

446 ià(
p_Vid
->
ty³
 !ð
I_SLICE
 &&…_Vid->ty³ !ð
SI_SLICE
)

449 
	`memýy
(&
de¡
->
®l_mv
 [0][0][0][0][0], &
¤c
->®l_mv [0][0][0][0][0], 
p_Vid
->
max_num_»ã»nûs
 * 288 * (
MÙiÚVeùÜ
));

452 
	`memýy
(
de¡
->
šŒa_´ed_modes
,
¤c
->šŒa_´ed_modes, 
MB_BLOCK_PARTITIONS
 * ());

453 
	`memýy
(
de¡
->
šŒa_´ed_modes8x8
,
¤c
->šŒa_´ed_modes8x8, 
MB_BLOCK_PARTITIONS
 * ());

454 
j
 = 
cu¼MB
->
block_y
; j < cu¼MB->block_y + 
BLOCK_MULTIPLE
; j++)

455 
	`memýy
(&
de¡
->
»dmode
[
j
][
cu¼MB
->
block_x
],&
¤c
->»dmode[j][cu¼MB->block_x], 
BLOCK_MULTIPLE
 * ());

457 
	`memýy
(&
de¡
->
»çr
[
LIST_0
][0][0], &
¤c
->»çr[LIST_0][0][0], 2 * 
BLOCK_MULTIPLE
 * BLOCK_MULTIPLE * ());

459 
	}
}

461 
	$upd©eMV_mp
(
Maüoblock
 *
cu¼MB
, 
di¡blk
 *
m_co¡
, 
»f
, 
li¡
, 
h
, 
v
, 
blockty³
, 
block8x8
)

463 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

464 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

466 
i
, 
j
;

467 
bsx
 = 
block_size
[
blockty³
][0] >> 2;

468 
bsy
 = 
block_size
[
blockty³
][1] >> 2;

469 
MÙiÚVeùÜ
 
®l_mv
;

471 iàÐ(
p_IÅ
->
T¿nsfÜm8x8Mode
 =ð1è&& (
blockty³
 =ð4è&& 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
)

473 
®l_mv
 = 
cu¼Sliû
->
tmp_mv8
[
li¡
][
»f
][
v
][
h
];

474 *
m_co¡
 = 
cu¼Sliû
->
mÙiÚ_co¡8
[
li¡
][
»f
][
block8x8
];

476 iàÐ(
p_IÅ
->
T¿nsfÜm8x8Mode
 =ð1è&& (
blockty³
 =ð4è&& 
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 == 0)

478 
®l_mv
 = 
cu¼Sliû
->
tmp_mv4
[
li¡
][
»f
][
v
][
h
];

479 *
m_co¡
 = 
cu¼Sliû
->
mÙiÚ_co¡4
[
li¡
][
»f
][
block8x8
];

483 
®l_mv
 = 
cu¼Sliû
->
rdd©a_Œ–lis_be¡
.®l_mv[
li¡
][
»f
][
blockty³
][
v
][
h
];

486 
j
 = 0; j < 
bsy
; j++)

488 
i
 = 0; i < 
bsx
; i++)

490 
cu¼Sliû
->
®l_mv
[
li¡
][
»f
][
blockty³
][
v
+
j
][
h
+
i
] =‡ll_mv;

493 
	}
}

	@lencod/src/rdoq_cabac.c

10 
	~"cÚŒibutÜs.h
"

12 
	~<m©h.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"ÿbac.h
"

17 
	~"image.h
"

18 
	~"fmo.h
"

19 
	~"maüoblock.h
"

20 
	~"mb_acûss.h
"

21 
	~"rdoq.h
"

23 
	#RDOQ_SQ
 0

	)

25 cÚ¡ 
	g’ŒÝyB™s
[128]=

46 
	$bŸri_no_b™s
(sigÃd 
symbÞ
, 
BiCÚ‹xtTy³PŒ
 
bi_ù
 )

48 
ùx_¡©e
, 
e¡B™s
;

50 
symbÞ
 = () (symbol != 0);

52 
ùx_¡©e
 = (
symbÞ
 =ð
bi_ù
->
MPS
è? 64 + bi_ù->
¡©e
 : 63 - bi_ct->state;

53 
e¡B™s
 = 
’ŒÝyB™s
[127 - 
ùx_¡©e
];

55 (
e¡B™s
);

56 
	}
}

58 
	$bŸri_¡©e
(sigÃd 
symbÞ
, 
BiCÚ‹xtTy³PŒ
 
bi_ù
 )

60 
ùx_¡©e
;

62 
symbÞ
 = () (symbol != 0);

63 
ùx_¡©e
 = (
symbÞ
 =ð
bi_ù
->
MPS
è? 64 + bi_ù->
¡©e
 : 63 - bi_ct->state;

65 (
ùx_¡©e
);

66 
	}
}

74 
	$e¡_CBP_block_b™
 (
Maüoblock
* 
cu¼MB
, 
ty³
)

76 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

77 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

78 
ùx
;

80 
ùx
=0; ctx<=3; ctx++)

82 
ÿbacE¡B™s
->
blockCbpB™s
[
ùx
][0]=
	`bŸri_no_b™s
(0, 
cu¼Sliû
->
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]]+ctx);

84 
ÿbacE¡B™s
->
blockCbpB™s
[
ùx
][1]=
	`bŸri_no_b™s
(1, 
cu¼Sliû
->
‹x_ùx
->
bcbp_cÚ‹xts
[
ty³2ùx_bcbp
[
ty³
]]+ctx);

86 
	}
}

94 
	$e¡_signifiÿnû_m­
(
Maüoblock
* 
cu¼MB
, 
ty³
)

96 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

97 
k
;

98 
k1
 = 
maxpos
[
ty³
]-1;

99 #ià
ENABLE_FIELD_CTX


100 
æd
 = ( 
cu¼Sliû
->
¡ruùu»
!=
FRAME
 || 
cu¼MB
->
mb_f›ld
 );

102 
æd
 = 0;

104 
BiCÚ‹xtTy³PŒ
 
m­_ùx
 = 
cu¼Sliû
->
‹x_ùx
->
m­_cÚ‹xts
 [
æd
][
ty³2ùx_m­
 [
ty³
]];

105 
BiCÚ‹xtTy³PŒ
 
Ï¡_ùx
 = 
cu¼Sliû
->
‹x_ùx
->
Ï¡_cÚ‹xts
[
æd
][
ty³2ùx_Ï¡
[
ty³
]];

106 cÚ¡ 
by‹
 *
pos2ùxm­
 = 
æd
 ? 
pos2ùx_m­_št
 [
ty³
] : 
pos2ùx_m­
[type];

107 cÚ¡ 
by‹
 *
pos2ùxÏ¡
 = 
pos2ùx_Ï¡
[
ty³
];

109 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

111 
k
 = 0; k < 
k1
; k++)

113 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùxm­
[
k
]][0] = 
	`bŸri_no_b™s
 (0, 
m­_ùx
 +…os2ctxmap[k]);

115 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùxm­
[
k
]][1] = 
	`bŸri_no_b™s
 (1, 
m­_ùx
 +…os2ctxmap[k]);

117 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùxÏ¡
[
k
]][0] = 
	`bŸri_no_b™s
(0, 
Ï¡_ùx
+pos2ctxlast[k]);

119 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùxÏ¡
[
k
]][1] = 
	`bŸri_no_b™s
(1, 
Ï¡_ùx
+pos2ctxlast[k]);

122 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùxm­
[
k1
]][0]=0;

123 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùxm­
[
k1
]][1]=0;

124 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùxÏ¡
[
k1
]][0]=0;

125 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùxÏ¡
[
k1
]][1]=0;

126 
	}
}

134 
	$e¡_signifiÿÁ_cÛffic›Ás
 (
Maüoblock
* 
cu¼MB
, 
ty³
)

136 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

137 
ùx
;

138 
maxCtx
 = 
	`imš
(4, 
max_c2
[
ty³
]);

139 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

141 
ùx
=0; ctx<=4; ctx++){

142 
ÿbacE¡B™s
->
g»©”OÃB™s
[0][
ùx
][0]=

143 
	`bŸri_no_b™s
 (0, 
cu¼Sliû
->
‹x_ùx
->
Úe_cÚ‹xts
[
ty³2ùx_Úe
[
ty³
]] + 
ùx
);

145 
ÿbacE¡B™s
->
g»©”OÃB™s
[0][
ùx
][1]=

146 
	`bŸri_no_b™s
 (1, 
cu¼Sliû
->
‹x_ùx
->
Úe_cÚ‹xts
[
ty³2ùx_Úe
[
ty³
]] + 
ùx
);

149 
ùx
=0; ctx<=
maxCtx
; ctx++){

150 
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][0]=

151 
	`bŸri_no_b™s
(0, 
cu¼Sliû
->
‹x_ùx
->
abs_cÚ‹xts
[
ty³2ùx_abs
[
ty³
]] + 
ùx
);

153 
ÿbacE¡B™s
->
g»©”OÃS‹
[
ùx
]=
	`bŸri_¡©e
(0, 
cu¼Sliû
->
‹x_ùx
->
abs_cÚ‹xts
[
ty³2ùx_abs
[
ty³
]] + ctx);

155 
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][1]=

156 
	`bŸri_no_b™s
(1, 
cu¼Sliû
->
‹x_ùx
->
abs_cÚ‹xts
[
ty³2ùx_abs
[
ty³
]] + 
ùx
);

158 
	}
}

166 
	$e¡_uÇry_exp_gÞomb_Ëv–_’code
(
Maüoblock
 *
cu¼MB
, 
symbÞ
, 
ùx
, 
ty³
)

168 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

169 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

170 
l
 = 
symbÞ
, 
k
 = 1;

171 
exp_¡¬t
 = 13;

172 
e¡B™s
;

174 ià(
symbÞ
==0)

176 
e¡B™s
 = 
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][0];

177  (
e¡B™s
);

181 
e¡B™s
 = 
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][1];

183 ((--
l
)>0è&& (++
k
 <ð
exp_¡¬t
))

185 
e¡B™s
 +ð
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][1];

188 ià(
symbÞ
 < 
exp_¡¬t
)

190 
e¡B™s
 +ð
ÿbacE¡B™s
->
g»©”OÃB™s
[1][
ùx
][0];

194 
e¡B™s
 +ð
	`e¡_exp_gÞomb_’code_eq_´ob
(
symbÞ
 - 
exp_¡¬t
);

197 (
e¡B™s
);

198 
	}
}

200 
	$´eÿlcuÏ‹_uÇry_exp_gÞomb_Ëv–
(
VideoP¬am‘”s
 *
p_Vid
)

202 
¡©e
, 
ùx_¡©e0
, 
ùx_¡©e1
, 
e¡B™s0
, 
e¡B™s1
, 
symbÞ
;

204 
¡©e
=0; state<=63; state++)

207 
ùx_¡©e0
 = 64 + 
¡©e
;

208 
e¡B™s0
 = 
’ŒÝyB™s
[127-
ùx_¡©e0
];

209 
ùx_¡©e1
 = 63 - 
¡©e
;

210 
e¡B™s1
 = 
’ŒÝyB™s
[127-
ùx_¡©e1
];

212 
symbÞ
 = 0; symbÞ < 
MAX_PREC_COEFF
; symbol++)

214 
p_Vid
->
´eÿlcUÇryLev–Tab
[
ùx_¡©e0
][
symbÞ
] = 
	`e¡_uÇry_exp_gÞomb_Ëv–_b™s
(symbÞ, 
e¡B™s0
, 
e¡B™s1
);

217 
p_Vid
->
´eÿlcUÇryLev–Tab
[
ùx_¡©e1
][
symbÞ
] =
	`e¡_uÇry_exp_gÞomb_Ëv–_b™s
(symbÞ, 
e¡B™s1
, 
e¡B™s0
);

220 
	}
}

222 
	$e¡_uÇry_exp_gÞomb_Ëv–_b™s
(
symbÞ
, 
b™s0
, 
b™s1
)

224 
l
,
k
;

225 
exp_¡¬t
 = 13;

226 
e¡B™s
;

228 ià(
symbÞ
 == 0)

230  (
b™s0
);

234 
e¡B™s
 = 
b™s1
;

235 
l
 = 
symbÞ
;

236 
k
 = 1;

237 ((--
l
)>0è&& (++
k
 <ð
exp_¡¬t
))

239 
e¡B™s
 +ð
b™s1
;

241 ià(
symbÞ
 < 
exp_¡¬t
)

243 
e¡B™s
 +ð
b™s0
;

247 
e¡B™s
 +ð
	`e¡_exp_gÞomb_’code_eq_´ob
(
symbÞ
 - 
exp_¡¬t
);

250 (
e¡B™s
);

251 
	}
}

259 
	$e¡_exp_gÞomb_’code_eq_´ob
(
symbÞ
)

261 
k
 = 0, 
e¡B™s
 = 0;

265 ià(
symbÞ
 >ð()(1<<
k
))

267 
e¡B™s
++;

268 
symbÞ
 -ð(1 << 
k
);

269 
k
++;

273 
e¡B™s
 +ð(
k
 + 1);

277 (
e¡B™s
);

278 
	}
}

286 
	$e¡RunLev–_CABAC
 (
Maüoblock
 *
cu¼MB
, 
cÚ‹xt
)

288 
	`e¡_CBP_block_b™
 (
cu¼MB
, 
cÚ‹xt
);

290 
	`e¡_signifiÿnû_m­
 (
cu¼MB
, 
cÚ‹xt
);

292 
	`e¡_signifiÿÁ_cÛffic›Ás
 (
cu¼MB
, 
cÚ‹xt
);

293 
	}
}

302 
	$e¡_wr™e_ªd_¡Üe_CBP_block_b™
(
Maüoblock
* 
cu¼MB
, 
ty³
)

304 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

305 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

306 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

308 
y_ac
 = (
ty³
==
LUMA_16AC
 ||y³==
LUMA_8x8
 ||y³==
LUMA_8x4
 ||y³==
LUMA_4x8
 ||y³==
LUMA_4x4


309 || 
ty³
==
CB_16AC
 ||y³==
CB_8x8
 ||y³==
CB_8x4
 ||y³==
CB_4x8
 ||y³==
CB_4x4


310 || 
ty³
==
CR_16AC
 ||y³==
CR_8x8
 ||y³==
CR_8x4
 ||y³==
CR_4x8
 ||y³==
CR_4x4
);

311 
y_dc
 = (
ty³
==
LUMA_16DC
 ||y³==
CB_16DC
 ||y³==
CR_16DC
);

312 
u_ac
 = (
ty³
==
CHROMA_AC
 && !
p_Vid
->
is_v_block
);

313 
v_ac
 = (
ty³
==
CHROMA_AC
 && 
p_Vid
->
is_v_block
);

314 
chroma_dc
 = (
ty³
==
CHROMA_DC
 ||y³==
CHROMA_DC_2x4
 ||y³==
CHROMA_DC_4x4
);

315 
u_dc
 = (
chroma_dc
 && !
p_Vid
->
is_v_block
);

316 
v_dc
 = (
chroma_dc
 && 
p_Vid
->
is_v_block
);

317 
j
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_y
 : 0);

318 
i
 = (
y_ac
 || 
u_ac
 || 
v_ac
 ? 
cu¼MB
->
subblock_x
 : 0);

319 
b™
;

320 
deçuÉ_b™
 = (
	`is_šŒa
(
cu¼MB
) ? 1 : 0);

321 
uµ”_b™
 = 
deçuÉ_b™
;

322 
Ëá_b™
 = 
deçuÉ_b™
;

323 
ùx
, 
e¡B™s
 = 0;

325 
b™_pos_a
 = 0;

326 
b™_pos_b
 = 0;

328 
Pix–Pos
 
block_a
, 
block_b
;

330 ià(
y_ac
 || 
y_dc
)

332 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_a
);

333 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 -1, 
p_Vid
->
mb_size
[
IS_LUMA
], &
block_b
);

334 ià(
y_ac
)

336 ià(
block_a
.
avažabË
)

337 
b™_pos_a
 = 4*
block_a
.
y
 + block_a.
x
;

338 ià(
block_b
.
avažabË
)

339 
b™_pos_b
 = 4*
block_b
.
y
 + block_b.
x
;

344 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
 - 1, 
j
 , 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_a
);

345 
	`g‘4x4Neighbour
(
cu¼MB
, 
i
, 
j
 - 1, 
p_Vid
->
mb_size
[
IS_CHROMA
], &
block_b
);

346 ià(
u_ac
||
v_ac
)

348 ià(
block_a
.
avažabË
)

349 
b™_pos_a
 = (
block_a
.
y
 << 2è+ block_a.
x
;

350 ià(
block_b
.
avažabË
)

351 
b™_pos_b
 = (
block_b
.
y
 << 2è+ block_b.
x
;

355 
b™
 = (
y_dc
 ? 0 : 
y_ac
 ? 1 : 
u_dc
 ? 17 : 
v_dc
 ? 18 : 
u_ac
 ? 19 : 35);

357 ià(
p_Vid
->
’c_piùu»
->
chroma_fÜm©_idc
!=
YUV444
 || (
cu¼MB
->
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0))

359 ià(
ty³
!=
LUMA_8x8
)

361 ià(
block_b
.
avažabË
)

363 if(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
==
IPCM
)

364 
uµ”_b™
 = 1;

366 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_b
);

369 ià(
block_a
.
avažabË
)

371 if(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
==
IPCM
)

372 
Ëá_b™
 = 1;

374 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_a
);

377 
ùx
 = 2*
uµ”_b™
+
Ëá_b™
;

379 
e¡B™s
 = 
ÿbacE¡B™s
->
blockCbpB™s
[
ùx
][0] - cabacEstBits->blockCbpBits[ctx][1];

384 ià(
block_b
.
avažabË
)

386 if(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
mb_ty³
 =ð
IPCM
)

387 
uµ”_b™
=1;

390 if(
ty³
==
LUMA_8x8
)

391 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[0], 
b™
 + 
b™_pos_b
);

392 ià(
ty³
==
CB_8x8
)

393 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[1], 
b™
 + 
b™_pos_b
);

394 ià(
ty³
==
CR_8x8
)

395 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s_8x8
[2], 
b™
 + 
b™_pos_b
);

396 ià((
ty³
==
CB_4x4
)||Ñy³==
CB_4x8
)||Ñy³==
CB_8x4
)||Ñy³==
CB_16AC
)||Ñy³==
CB_16DC
))

397 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[1], 
b™
 + 
b™_pos_b
);

398 ià((
ty³
==
CR_4x4
)||Ñy³==
CR_4x8
)||Ñy³==
CR_8x4
)||Ñy³==
CR_16AC
)||Ñy³==
CR_16DC
))

399 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[2], 
b™
 + 
b™_pos_b
);

401 
uµ”_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_b
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_b
);

405 ià(
block_a
.
avažabË
)

407 if(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
mb_ty³
==
IPCM
)

408 
Ëá_b™
 = 1;

411 if(
ty³
==
LUMA_8x8
)

412 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[0],
b™
 + 
b™_pos_a
);

413 ià(
ty³
==
CB_8x8
)

414 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[1],
b™
 + 
b™_pos_a
);

415 ià(
ty³
==
CR_8x8
)

416 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s_8x8
[2],
b™
 + 
b™_pos_a
);

417 ià((
ty³
==
CB_4x4
)||Ñy³==
CB_4x8
)||Ñy³==
CB_8x4
)||Ñy³==
CB_16AC
)||Ñy³==
CB_16DC
))

418 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[1], 
b™
 + 
b™_pos_a
);

419 ià((
ty³
==
CR_4x4
)||Ñy³==
CR_4x8
)||Ñy³==
CR_8x4
)||Ñy³==
CR_16AC
)||Ñy³==
CR_16DC
))

420 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[2], 
b™
 + 
b™_pos_a
);

422 
Ëá_b™
 = 
	`g‘_b™
(
p_Vid
->
mb_d©a
[
block_a
.
mb_addr
].
cbp_b™s
[0], 
b™
 + 
b™_pos_a
);

426 
ùx
 = 2*
uµ”_b™
+
Ëá_b™
;

429 
e¡B™s
 = 
ÿbacE¡B™s
->
blockCbpB™s
[
ùx
][0] - cabacEstBits->blockCbpBits[ctx][1];

432 (
e¡B™s
);

433 
	}
}

440 
	$e¡_wr™eRunLev–_CABAC
(
Maüoblock
 *
cu¼MB
, 
Ëv–D©aSŒuù
 
Ëv–D©a
[], 
Ëv–TabMš
[], 
ty³
, 
Ïmbda
, 
kIn™
, 
kStÝ
,

441 
noCÛff
, 
e¡CBP
)

443 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

444 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

445 
e¡B™sCabacSŒuù
 *
ÿbacE¡B™s
 = &
cu¼Sliû
->
e¡B™sCabac
[
ty³
];

446 
k
, 
i
;

447 
e¡B™s
;

448 
Ïgr
, 
ÏgrMš
=0, 
ÏgrTabMš
, 
ÏgrTab
;

449 
c1
 = 1, 
c2
 = 0, 
c1Tab
[3], 
c2Tab
[3];

450 
iBe¡
, 
Ëv–Tab
[64];

451 
ùx
, 
g»©”_Úe
, 
Ï¡
, 
maxK
 = 
maxpos
[
ty³
];

452 
ÏgrAcc
, 
ÏgrLa¡Mš
=0, 
ÏgrLa¡
;

453 
kBe¡
=0, 
kS¹
, 
fœ¡
;

454 
Ëv–D©aSŒuù
 *
d©aLev–
;

455 *
Ï¡_b™s
, *
signifiÿÁ_b™s
;

457 
	`mem£t
(
Ëv–TabMš
, 0, (
maxK
 + 1) * ());

459 ià(
noCÛff
 > 0)

461 ià(
noCÛff
 > 1)

463 
kS¹
 = 
kIn™
; 
kBe¡
 = 0; 
fœ¡
 = 1;

464 
ÏgrAcc
 = 0.0;

466 
k
 = 
kS¹
; k <ð
kStÝ
; k++)

468 
ÏgrAcc
 +ð
Ëv–D©a
[
k
].
”rLev–
[0];

471 ià(
Ëv–D©a
[
kS¹
].
noLev–s
 > 2)

473 
Ï¡_b™s
 = 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùx_Ï¡
[
ty³
][
kS¹
]];

474 
ÏgrAcc
 -ð
Ëv–D©a
[
kS¹
].
”rLev–
[0];

475 
ÏgrLa¡Mš
 = 
Ïmbda
 * (
Ï¡_b™s
[1] -†a¡_b™s[0]è+ 
ÏgrAcc
;

477 
kBe¡
 = 
kS¹
;

478 
kS¹
++;

479 
fœ¡
 = 0;

482 
k
 = 
kS¹
; k <ð
kStÝ
; k++)

484 
d©aLev–
 = &
Ëv–D©a
[
k
];

485 
signifiÿÁ_b™s
 = 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùx_m­
[
ty³
][
k
]];

486 
ÏgrMš
 = 
d©aLev–
->
”rLev–
[0] + 
Ïmbda
 * 
signifiÿÁ_b™s
[0];

487 
ÏgrAcc
 -ð
d©aLev–
->
”rLev–
[0];

489 ià(
d©aLev–
->
noLev–s
 > 1)

491 
Ï¡_b™s
 = 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùx_Ï¡
[
ty³
][
k
]];

492 
e¡B™s
 = 
SIGN_BITS
 + 
signifiÿÁ_b™s
[1] + 
ÿbacE¡B™s
->
g»©”OÃB™s
[0][4][0];

494 
Ïgr
 = 
d©aLev–
->
”rLev–
[1] + 
Ïmbda
 * (
e¡B™s
);

496 
ÏgrLa¡
 = 
Ïgr
 + 
Ïmbda
 * 
Ï¡_b™s
[1] + 
ÏgrAcc
;

497 
Ïgr
 =†ag¸+ 
Ïmbda
 * 
Ï¡_b™s
[0];

499 
ÏgrMš
 = (
Ïgr
 <†agrMin) ?†agr :†agrMin;

501 ià((
ÏgrLa¡
 < 
ÏgrLa¡Mš
è|| (
fœ¡
 == 1))

503 
kBe¡
 = 
k
;

504 
fœ¡
 = 0;

505 
ÏgrLa¡Mš
 = 
ÏgrLa¡
;

508 
ÏgrAcc
 +ð
ÏgrMš
;

510 
kS¹
 = 
kBe¡
;

514 
kS¹
 = 
kStÝ
;

517 
ÏgrTabMš
 = 0.0;

518 
k
 = 0; k <ð
kS¹
; k++)

520 
ÏgrTabMš
 +ð
Ëv–D©a
[
k
].
”rLev–
[0];

523 
ÏgrTab
 = 0.0;

527 
ÏgrTabMš
 +ð(
Ïmbda
*
e¡CBP
);

528 
iBe¡
 = 0; 
fœ¡
 = 1;

529 
k
 = 
kS¹
; k >= 0; k--)

531 
signifiÿÁ_b™s
 = 
ÿbacE¡B™s
->
signifiÿÁB™s
[
pos2ùx_m­
[
ty³
][
k
]];

532 
Ï¡_b™s
 = 
ÿbacE¡B™s
->
Ï¡B™s
[
pos2ùx_Ï¡
[
ty³
][
k
]];

533 
d©aLev–
 = &
Ëv–D©a
[
k
];

534 
Ï¡
 = (
k
 =ð
kS¹
);

536 ià(!
Ï¡
)

538 
ÏgrMš
 = 
d©aLev–
->
”rLev–
[0] + 
Ïmbda
 * 
signifiÿÁ_b™s
[0];

539 
iBe¡
 = 0;

540 
fœ¡
 = 0;

543 
i
 = 1; i < 
d©aLev–
->
noLev–s
; i++)

545 
e¡B™s
 = 
SIGN_BITS
 + 
signifiÿÁ_b™s
[1];

546 
e¡B™s
 +ð
Ï¡_b™s
[
Ï¡
];

549 
g»©”_Úe
 = (
d©aLev–
->
Ëv–
[
i
] > 1);

551 
c1Tab
[
i
] = 
c1
;

552 
c2Tab
[
i
] = 
c2
;

554 
ùx
 = 
	`imš
(
c1Tab
[
i
], 4);

555 
e¡B™s
 +ð
ÿbacE¡B™s
->
g»©”OÃB™s
[0][
ùx
][
g»©”_Úe
];

558 ià(
g»©”_Úe
)

560 
ùx
 = 
	`imš
(
c2Tab
[
i
], 
max_c2
[
ty³
]);

561 iàÐ(
d©aLev–
->
Ëv–
[
i
] - 2è< 
MAX_PREC_COEFF
)

563 
e¡B™s
 +ð
p_Vid
->
´eÿlcUÇryLev–Tab
[
ÿbacE¡B™s
->
g»©”OÃS‹
[
ùx
]][
d©aLev–
->
Ëv–
[
i
] - 2];

567 
e¡B™s
 +ð
	`e¡_uÇry_exp_gÞomb_Ëv–_’code
(
cu¼MB
, 
d©aLev–
->
Ëv–
[
i
] - 2, 
ùx
, 
ty³
);

570 
c1Tab
[
i
] = 0;

571 
c2Tab
[
i
]++;

573 ià(
c1Tab
[
i
])

575 
c1Tab
[
i
]++;

578 
Ïgr
 = 
d©aLev–
->
”rLev–
[
i
] + 
Ïmbda
 * 
e¡B™s
;

579 ià((
Ïgr
 < 
ÏgrMš
è|| (
fœ¡
 == 1))

581 
iBe¡
 = 
i
;

582 
ÏgrMš
=
Ïgr
;

583 
fœ¡
 = 0;

587 ià(
iBe¡
 > 0)

589 
c1
 = 
c1Tab
[
iBe¡
];

590 
c2
 = 
c2Tab
[
iBe¡
];

593 
Ëv–Tab
[
k
] = 
d©aLev–
->
Ëv–
[
iBe¡
];

594 
ÏgrTab
 +ð
ÏgrMš
;

598 ià(
ÏgrTab
 < 
ÏgrTabMš
)

600 
	`memýy
(
Ëv–TabMš
, 
Ëv–Tab
, (
kS¹
 + 1) * ());

603 
	}
}

612 
	$š™_Œ–lis_d©a_4x4_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
,

613 
quªt_m‘hods
 *
q_m‘hod
, cÚ¡ 
by‹
 *
p_sÿn
,

614 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
, 
ty³
)

616 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

617 
Lev–QuªtP¬ams
 **
q_·¿ms_4x4
 = 
q_m‘hod
->
q_·¿ms
;

618 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

619 
qp
 = 
q_m‘hod
->qp;

620 
qp_³r
 = 
p_Quªt
->
qp_³r_m©rix
[
qp
];

621 
qp_»m
 = 
p_Quªt
->
qp_»m_m©rix
[
qp
];

622 
block_x
 = 
q_m‘hod
->block_x;

624 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

625 
noCÛff
 = 0;

626 
i
, 
j
, 
cÛff_ùr
;

627 *
m7
;

628 
’d_cÛff_ùr
 = ( ( 
ty³
 =ð
LUMA_4x4
 ) ? 16 : 15 );

629 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

630 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

631 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

632 
”r
, 
e¡E¼
;

634 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

636 
i
 = *
p_sÿn
++;

637 
j
 = *
p_sÿn
++;

639 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

641 ià(*
m7
 == 0)

643 
d©aLev–
->
Ëv–
[0] = 0;

644 
d©aLev–
->
Ëv–DoubË
 = 0;

645 
d©aLev–
->
”rLev–
[0] = 0.0;

646 
d©aLev–
->
noLev–s
 = 1;

651 
e¡E¼
 = ((è
e¡E¼4x4
[
qp_»m
][
j
][
i
]è/ 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

653 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms_4x4
[
j
][
i
].
SÿËComp
;

654 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

655 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

657 
low”IÁ
 = ((
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 )? 1 : 0;

659 #ià
RDOQ_SQ


660 
d©aLev–
->
Ëv–
[0] = 
	`max
(0,†evel - 1);

662 
d©aLev–
->
Ëv–
[0] = 0;

664 ià(
Ëv–
 == 0)

666 ià(
low”IÁ
 == 1)

668 
d©aLev–
->
noLev–s
 = 1;

672 
d©aLev–
->
Ëv–
[1] = 1;

673 
d©aLev–
->
noLev–s
 = 2;

674 *
kStÝ
 = 
cÛff_ùr
;

675 
noCÛff
++;

678 ià(
low”IÁ
 == 1)

680 
d©aLev–
->
Ëv–
[1] =†evel;

681 
d©aLev–
->
noLev–s
 = 2;

682 *
kStÝ
 = 
cÛff_ùr
;

683 
noCÛff
++;

687 
d©aLev–
->
Ëv–
[1] =†evel;

688 
d©aLev–
->
Ëv–
[2] =†evel + 1;

689 
d©aLev–
->
noLev–s
 = 3;

690 *
kStÝ
 = 
cÛff_ùr
;

691 *
kS¹
 = 
cÛff_ùr
;

692 
noCÛff
++;

695 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

697 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

698 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

702 
d©aLev–
++;

704  (
noCÛff
);

705 
	}
}

713 
	$š™_Œ–lis_d©a_8x8_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 **
q_·¿ms
, cÚ¡ 
by‹
 *
p_sÿn
,

714 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
)

716 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

717 
noCÛff
 = 0;

718 *
m7
;

719 
i
, 
j
, 
cÛff_ùr
, 
’d_cÛff_ùr
 = 64;

720 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

721 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

722 
”r
, 
e¡E¼
;

723 
Ëv–
, 
low”IÁ
, 
k
;

724 
sÿËd_cÛff
;

726 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

728 
i
 = *
p_sÿn
++;

729 
j
 = *
p_sÿn
++;

731 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

733 ià(*
m7
 == 0)

735 
d©aLev–
->
Ëv–
[0] = 0;

736 
d©aLev–
->
Ëv–DoubË
 = 0;

737 
d©aLev–
->
”rLev–
[0] = 0.0;

738 
d©aLev–
->
noLev–s
 = 1;

743 
e¡E¼
 = (è
e¡E¼8x8
[
qp_»m
][
j
][
i
] / 
cu¼Sliû
->
nÜm_çùÜ_8x8
;

745 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms
[
j
][
i
].
SÿËComp
;

746 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

747 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

749 
low”IÁ
 = ((
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 )? 1 : 0;

751 #ià
RDOQ_SQ


752 
d©aLev–
->
Ëv–
[0] = 
	`max
(0,†evel - 1);

754 
d©aLev–
->
Ëv–
[0] = 0;

756 ià(
Ëv–
 == 0)

758 ià(
low”IÁ
 == 1)

760 
d©aLev–
->
noLev–s
 = 1;

764 
d©aLev–
->
Ëv–
[1] = 1;

765 
d©aLev–
->
noLev–s
 = 2;

766 *
kStÝ
 = 
cÛff_ùr
;

767 
noCÛff
++;

770 ià(
low”IÁ
 == 1)

772 
d©aLev–
->
Ëv–
[1] =†evel;

773 
d©aLev–
->
noLev–s
 = 2;

774 *
kStÝ
 = 
cÛff_ùr
;

775 
noCÛff
++;

779 
d©aLev–
->
Ëv–
[1] =†evel;

780 
d©aLev–
->
Ëv–
[2] =†evel + 1;

781 
d©aLev–
->
noLev–s
 = 3;

782 *
kStÝ
 = 
cÛff_ùr
;

783 *
kS¹
 = 
cÛff_ùr
;

784 
noCÛff
++;

787 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

789 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

790 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

794 
d©aLev–
++;

796  (
noCÛff
);

797 
	}
}

805 
	$š™_Œ–lis_d©a_DC_CABAC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

806 
Lev–QuªtP¬ams
 *
q_·¿ms
, cÚ¡ 
by‹
 *
p_sÿn
,

807 
Ëv–D©aSŒuù
 *
d©aLev–
, * 
kS¹
, * 
kStÝ
)

809 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

810 
noCÛff
 = 0;

811 
i
, 
j
, 
cÛff_ùr
, 
’d_cÛff_ùr
 = 16;

812 
q_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

813 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

814 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

815 *
m7
;

816 
”r
, 
e¡E¼
 = (è
e¡E¼4x4
[
qp_»m
][0][0] / 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

818 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

820 
i
 = *
p_sÿn
++;

821 
j
 = *
p_sÿn
++;

822 
m7
 = &
tblock
[
j
][
i
];

824 ià(*
m7
 == 0)

826 
d©aLev–
->
Ëv–
[0] = 0;

827 
d©aLev–
->
Ëv–DoubË
 = 0;

828 
d©aLev–
->
”rLev–
[0] = 0.0;

829 
d©aLev–
->
noLev–s
 = 1;

834 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms
->
SÿËComp
;

835 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

836 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

838 
low”IÁ
=Ð(
sÿËd_cÛff
 - (
Ëv–
<<
q_b™s
)è< 
q_off£t
 )? 1 : 0;

840 #ià
RDOQ_SQ


841 
d©aLev–
->
Ëv–
[0] = 
	`max
(0,†evel - 1);

843 
d©aLev–
->
Ëv–
[0] = 0;

845 ià(
Ëv–
 == 0)

847 ià(
low”IÁ
 == 1)

849 
d©aLev–
->
noLev–s
 = 1;

853 
d©aLev–
->
Ëv–
[1] = 1;

854 
d©aLev–
->
noLev–s
 = 2;

855 *
kStÝ
 = 
cÛff_ùr
;

856 
noCÛff
++;

859 ià(
low”IÁ
 == 1)

861 
d©aLev–
->
Ëv–
[1] =†evel;

862 
d©aLev–
->
noLev–s
 = 2;

863 *
kStÝ
 = 
cÛff_ùr
;

864 
noCÛff
++;

868 
d©aLev–
->
Ëv–
[1] =†evel;

869 
d©aLev–
->
Ëv–
[2] =†evel + 1;

870 
d©aLev–
->
noLev–s
 = 3;

871 *
kStÝ
 = 
cÛff_ùr
;

872 *
kS¹
 = 
cÛff_ùr
;

873 
noCÛff
++;

876 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

878 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

879 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

882 
d©aLev–
++;

884  (
noCÛff
);

885 
	}
}

	@lencod/src/rdoq_cavlc.c

10 
	~"cÚŒibutÜs.h
"

12 
	~<m©h.h
>

13 
	~<æßt.h
>

15 
	~"glob®.h
"

16 
	~"image.h
"

17 
	~"fmo.h
"

18 
	~"maüoblock.h
"

19 
	~"mb_acûss.h
"

20 
	~"rdoq.h
"

21 
	~"block.h
"

29 
	$e¡SyÁaxEËm’t_Lev–_VLC1
(
SyÁaxEËm’t
 *
£
)

31 
Ëv–
 = 
£
->
v®ue1
;

32 
sign
 = (
Ëv–
 < 0 ? 1 : 0);

33 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
);

35 ià(
Ëvabs
 < 8)

37 
£
->
Ën
 = 
Ëvabs
 * 2 + 
sign
 - 1;

39 ià(
Ëvabs
 < 16)

42 
£
->
Ën
 = 19;

47 
£
->
Ën
 = 28;

50  (
£
->
Ën
);

51 
	}
}

61 
	$e¡SyÁaxEËm’t_Lev–_VLCN
(
SyÁaxEËm’t
 *
£
, 
vlc
)

63 
Ëv–
 = 
£
->
v®ue1
;

64 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
) - 1;

66 
shiá
 = 
vlc
 - 1;

67 
esÿ³
 = (15 << 
shiá
);

69 ià(
Ëvabs
 < 
esÿ³
)

71 
£
->
Ën
 = ((
Ëvabs
è>> 
shiá
è+ 1 + 
vlc
;

75 
£
->
Ën
 = 28;

78  (
£
->
Ën
);

79 
	}
}

81 
	$cmp
(cÚ¡ *
¬g1
, cÚ¡ *
¬g2
)

83 if(((
Ëv–D©aSŒuù
 *)
¬g2
)->
Ëv–DoubË
 !ð(Öev–D©aSŒuù *)
¬g1
)->levelDouble)

84  (((
Ëv–D©aSŒuù
 *)
¬g2
)->
Ëv–DoubË
 - (Öev–D©aSŒuù *)
¬g1
)->levelDouble);

86  (((
Ëv–D©aSŒuù
 *)
¬g1
)->
cÛff_ùr
 - (Öev–D©aSŒuù *)
¬g2
)->coeff_ctr);

87 
	}
}

95 
	$e¡_CAVLC_b™s
 (
VideoP¬am‘”s
 *
p_Vid
, 
Ëv–_to_’c
[16], 
sign_to_’c
[16], 
Âz
, 
block_ty³
)

97 
no_b™s
 = 0;

98 
SyÁaxEËm’t
 
£
;

100 
cÛff_ùr
, 
sÿn_pos
 = 0;

101 
k
, 
Ëv–
 = 1, 
run
 = -1, 
vlúum
;

102 
numcÛff
 = 0, 
Ï¡cÛff
 = 0, 
numŒažšgÚes
 = 0;

103 
numÚes
 = 0, 
tÙz”os
 = 0, 
z”o¦eá
, 
numcÛf
;

104 
numcÛff_vlc
;

105 
Ëv–_two_Ü_high”
;

106 
max_cÛff_num
 = 0, 
cdc
 = (
block_ty³
 =ð
CHROMA_DC
 ? 1 : 0);

107 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

108 cÚ¡ 
šcVlc
[] = {0, 3, 6, 12, 24, 48, 32768};

110 
pLev–
[16] = {0};

111 
pRun
[16] = {0};

113 cÚ¡ 
Tok’_ËÁab
[3][4][17] =

135 cÚ¡ 
TÙ®z”os_ËÁab
[
TOTRUN_NUM
][16] =

153 cÚ¡ 
Run_ËÁab
[
TOTRUN_NUM
][16] =

163 cÚ¡ 
Tok’_ËÁab_cdc
[3][4][17] =

181 cÚ¡ 
TÙ®z”os_ËÁab_cdc
[3][
TOTRUN_NUM
][16] =

213 
max_cÛff_num
 = ( (
block_ty³
 =ð
CHROMA_DC
è? 
p_Vid
->
num_cdc_cÛff
 :

214 Ð(
block_ty³
 =ð
LUMA_INTRA16x16AC
 || block_ty³ =ð
CB_INTRA16x16AC
 || block_ty³ =ð
CR_INTRA16x16AC
 || block_ty³ =ð
CHROMA_AC
) ? 15 : 16) );

217 
cÛff_ùr
 = 0; cÛff_ù¸< 
max_cÛff_num
; coeff_ctr++)

219 
run
++;

220 
Ëv–
 = 
Ëv–_to_’c
[
cÛff_ùr
];

221 ià(
Ëv–
 != 0)

223 
pLev–
[
sÿn_pos
] = 
	`isigÇb
(
Ëv–
, 
sign_to_’c
[
cÛff_ùr
]);

224 
pRun
 [
sÿn_pos
] = 
run
;

225 ++
sÿn_pos
;

226 
run
 = -1;

230 
Ëv–
 = 1;

231 
k
 = 0; (k < 
max_cÛff_num
è&& 
Ëv–
 != 0; k++)

233 
Ëv–
 = 
pLev–
[
k
];

234 
run
 = 
pRun
[
k
];

236 ià(
Ëv–
)

238 
tÙz”os
 +ð
run
;

239 ià(
	`Ÿbs
(
Ëv–
) == 1)

241 
numÚes
 ++;

242 
numŒažšgÚes
 ++;

243 
numŒažšgÚes
 = 
	`imš
(numtrailingones, 3);

247 
numŒažšgÚes
 = 0;

249 
numcÛff
 ++;

250 
Ï¡cÛff
 = 
k
;

254 ià(!
cdc
)

256 
numcÛff_vlc
 = (
Âz
 < 2) ? 0 : ((nnz < 4) ? 1 : ((nnz < 8) ? 2 : 3));

262 
numcÛff_vlc
 = 0;

265 
£
.
v®ue1
 = 
numcÛff
;

266 
£
.
v®ue2
 = 
numŒažšgÚes
;

267 
£
.
Ën
 = 
numcÛff_vlc
;

269 ià(!
cdc
)

271 ià(
£
.
Ën
 == 3)

272 
no_b™s
 += 6;

274 
no_b™s
 +ð
Tok’_ËÁab
[
£
.
Ën
][£.
v®ue2
][£.
v®ue1
];

277 
no_b™s
 +ð
Tok’_ËÁab_cdc
[
yuv
][
£
.
v®ue2
][£.
v®ue1
];

279 ià(!
numcÛff
)

280  
no_b™s
;

283 ià(
numŒažšgÚes
)

284 
no_b™s
 +ð
numŒažšgÚes
;

287 
Ëv–_two_Ü_high”
 = (
numcÛff
 > 3 && 
numŒažšgÚes
 == 3) ? 0 : 1;

289 
vlúum
 = (
numcÛff
 > 10 && 
numŒažšgÚes
 < 3) ? 1 : 0;

291 
k
 = 
Ï¡cÛff
 - 
numŒažšgÚes
; k >= 0; k--)

293 
Ëv–
 = 
pLev–
[
k
];

295 
£
.
v®ue1
 = 
Ëv–
;

297 ià(
Ëv–_two_Ü_high”
)

299 
Ëv–_two_Ü_high”
 = 0;

300 ià(
£
.
v®ue1
 > 0)

301 
£
.
v®ue1
 --;

303 
£
.
v®ue1
 ++;

307 ià(
vlúum
 == 0)

308 
	`e¡SyÁaxEËm’t_Lev–_VLC1
(&
£
);

310 
	`e¡SyÁaxEËm’t_Lev–_VLCN
(&
£
, 
vlúum
);

313 ià(
	`Ÿbs
(
Ëv–
è> 
šcVlc
[
vlúum
])

314 
vlúum
++;

316 ià((
k
 =ð
Ï¡cÛff
 - 
numŒažšgÚes
è&& 
	`Ÿbs
(
Ëv–
) > 3)

317 
vlúum
 = 2;

319 
no_b™s
 +ð
£
.
Ën
;

323 ià(
numcÛff
 < 
max_cÛff_num
)

325 
£
.
v®ue1
 = 
tÙz”os
;

327 
vlúum
 = 
numcÛff
-1;

329 
£
.
Ën
 = 
vlúum
;

331 ià(!
cdc
)

332 
no_b™s
 +ð
TÙ®z”os_ËÁab
[
£
.
Ën
][£.
v®ue1
];

334 
no_b™s
 +ð
TÙ®z”os_ËÁab_cdc
[
yuv
][
£
.
Ën
][£.
v®ue1
];

338 
z”o¦eá
 = 
tÙz”os
;

339 
numcÛf
 = 
numcÛff
;

340 
k
 = 
Ï¡cÛff
; k >= 0; k--)

342 
run
 = 
pRun
[
k
];

344 
£
.
v®ue1
 = 
run
;

348 ià((!
z”o¦eá
è|| (
numcÛff
 <= 1 ))

351 ià(
numcÛf
 > 1 && 
z”o¦eá
)

353 
vlúum
 = 
	`imš
(
z”o¦eá
 - 1, 
RUNBEFORE_NUM_M1
);

354 
£
.
Ën
 = 
vlúum
;

355 
no_b™s
 +ð
Run_ËÁab
[
£
.
Ën
][£.
v®ue1
];

356 
z”o¦eá
 -ð
run
;

357 
numcÛf
 --;

362  
no_b™s
;

363 
	}
}

372 
	$e¡_RunLev–_CAVLC
(
Maüoblock
 *
cu¼MB
, 
Ëv–D©aSŒuù
 *
Ëv–D©a
, *
Ëv–T»Îis
, 
block_ty³
,

373 
b8
, 
b4
, 
cÛff_num
, 
Ïmbda
)

375 
k
, 
Ï¡nÚz”o
 = -1, 
cÛff_ùr
;

376 
Ëv–_to_’c
[16] = {0}, 
sign_to_’c
[16] = {0};

377 
c¡©
, 
be¡c¡©
 = 0;

378 
nz_cÛff
=0;

379 
Ïgr
, 
ÏgrAcc
 = 0, 
mšÏgr
 = 0;

380 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

382 
subblock_x
 = ((
b8
 & 0x1è=ð0è? (((
b4
 & 0x1) == 0) ? 0 : 1) : (((b4 & 0x1) == 0) ? 2 : 3);

384 
subblock_y
 = (
b8
 < 2è? ((
b4
 < 2) ? 0 : 1) :((b4 < 2) ? 2 : 3);

386 
Âz
;

387 
Ëv–D©aSŒuù
 *
d©aLev–
 = &
Ëv–D©a
[0];

389 ià(
block_ty³
 !ð
CHROMA_AC
)

390 
Âz
 = 
	`´ediù_Âz
(
cu¼MB
, 
LUMA
, 
subblock_x
, 
subblock_y
);

392 
Âz
 = 
	`´ediù_Âz_chroma
(
cu¼MB
, cu¼MB->
subblock_x
 >> 2, (cu¼MB->
subblock_y
 >> 2) + 4);

394 
cÛff_ùr
=0;cÛff_ù¸< 
cÛff_num
;coeff_ctr++)

396 
Ëv–T»Îis
[
cÛff_ùr
] = 0;

398 
k
=0; k < 
d©aLev–
->
noLev–s
; k++)

400 
d©aLev–
->
”rLev–
[
k
] /= 32768;

403 
ÏgrAcc
 +ð
d©aLev–
->
”rLev–
[
	`imax
(0, d©aLev–->
noLev–s
 - 1)];

405 
Ëv–_to_’c
[
cÛff_ùr
] = 
d©aLev–
->
´e_Ëv–
;

406 
sign_to_’c
[
cÛff_ùr
] = 
d©aLev–
->
sign
;

408 if(
d©aLev–
->
noLev–s
 > 1)

410 
d©aLev–
->
cÛff_ùr
 = coeff_ctr;

411 
Ï¡nÚz”o
 = 
cÛff_ùr
;

414 
d©aLev–
->
cÛff_ùr
 = -1;

415 
d©aLev–
++;

418 if(
Ï¡nÚz”o
 != -1)

421 
	`qsÜt
(
Ëv–D©a
, 
Ï¡nÚz”o
 + 1, (
Ëv–D©aSŒuù
), 
cmp
);

422 
d©aLev–
 = &
Ëv–D©a
[
Ï¡nÚz”o
];

424 
cÛff_ùr
 = 
Ï¡nÚz”o
; coeff_ctr >= 0; coeff_ctr--)

426 if(
d©aLev–
->
noLev–s
 == 1)

428 
d©aLev–
--;

432 
ÏgrAcc
 -ð
d©aLev–
->
”rLev–
[d©aLev–->
noLev–s
-1];

433 
c¡©
=0; c¡©<
d©aLev–
->
noLev–s
; cstat++)

435 
Ëv–_to_’c
[
d©aLev–
->
cÛff_ùr
] = d©aLev–->
Ëv–
[
c¡©
];

436 
Ïgr
 = 
ÏgrAcc
 + 
d©aLev–
->
”rLev–
[
c¡©
];

437 
Ïgr
 +ð
Ïmbda
 * 
	`e¡_CAVLC_b™s
Ð
p_Vid
, 
Ëv–_to_’c
, 
sign_to_’c
, 
Âz
, 
block_ty³
);

438 if(
c¡©
==0 || 
Ïgr
<
mšÏgr
)

440 
mšÏgr
 = 
Ïgr
;

441 
be¡c¡©
 = 
c¡©
;

445 
ÏgrAcc
 +ð
d©aLev–
->
”rLev–
[
be¡c¡©
];

446 
Ëv–_to_’c
[
d©aLev–
->
cÛff_ùr
] = d©aLev–->
Ëv–
[
be¡c¡©
];

447 
d©aLev–
--;

450 
cÛff_ùr
 = 0; cÛff_ù¸<ð
Ï¡nÚz”o
; coeff_ctr++)

452 
Ëv–T»Îis
[
cÛff_ùr
] = 
Ëv–_to_’c
[coeff_ctr];

453 ià(
Ëv–_to_’c
[
cÛff_ùr
] != 0)

454 
nz_cÛff
++;

458 
p_Vid
->
nz_cÛff
 [p_Vid->
cu¼’t_mb_Ä
 ][
subblock_x
][
subblock_y
] =‚z_coeff;

459 
	}
}

467 
	$š™_Œ–lis_d©a_4x4_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 **
q_·¿ms
,

468 cÚ¡ 
by‹
 *
p_sÿn
, 
Ëv–D©aSŒuù
 *
d©aLev–
, 
ty³
)

470 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

471 
i
, 
j
, 
cÛff_ùr
;

472 *
m7
;

473 
’d_cÛff_ùr
 = ( ( 
ty³
 =ð
LUMA_4x4
 ) ? 16 : 15 );

474 
q_b™s
 = 
Q_BITS
 + 
qp_³r
;

475 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

476 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

477 
”r
, 
e¡E¼
;

480 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

482 
i
 = *
p_sÿn
++;

483 
j
 = *
p_sÿn
++;

485 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

487 ià(*
m7
 == 0)

489 
d©aLev–
->
Ëv–DoubË
 = 0;

490 
d©aLev–
->
Ëv–
[0] = 0;

491 
d©aLev–
->
noLev–s
 = 1;

492 
”r
 = 0.0;

493 
d©aLev–
->
”rLev–
[0] = 0.0;

494 
d©aLev–
->
´e_Ëv–
 = 0;

495 
d©aLev–
->
sign
 = 0;

499 
e¡E¼
 = ((è
e¡E¼4x4
[
qp_»m
][
j
][
i
]è/ 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

501 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms
[
j
][
i
].
SÿËComp
;

502 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

503 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

505 
low”IÁ
 = ((
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 )? 1 : 0;

507 
d©aLev–
->
Ëv–
[0] = 0;

508 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 1)

510 
d©aLev–
->
noLev–s
 = 1;

512 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 0)

514 
d©aLev–
->
Ëv–
[1] = 1;

515 
d©aLev–
->
noLev–s
 = 2;

517 ià(
Ëv–
 > 0 && 
low”IÁ
 == 1)

519 
d©aLev–
->
Ëv–
[1] =†evel;

520 
d©aLev–
->
noLev–s
 = 2;

524 
d©aLev–
->
Ëv–
[1] =†evel;

525 
d©aLev–
->
Ëv–
[2] =†evel + 1;

526 
d©aLev–
->
noLev–s
 = 3;

529 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

531 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

532 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

535 if(
d©aLev–
->
noLev–s
 == 1)

536 
d©aLev–
->
´e_Ëv–
 = 0;

538 
d©aLev–
->
´e_Ëv–
 = (
	`Ÿbs
 (*
m7
è* 
q_·¿ms
[
j
][
i
].
SÿËComp
 + q_·¿ms[j][i].
Off£tComp
è>> 
q_b™s
;

539 
d©aLev–
->
sign
 = 
	`isign
(*
m7
);

541 
d©aLev–
++;

543 
	}
}

551 
	$š™_Œ–lis_d©a_DC_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
qp_³r
, 
qp_»m
,

552 
Lev–QuªtP¬ams
 *
q_·¿ms
, cÚ¡ 
by‹
 *
p_sÿn
,

553 
Ëv–D©aSŒuù
 *
d©aLev–
)

555 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

556 
i
, 
j
, 
cÛff_ùr
, 
’d_cÛff_ùr
 = 16;

557 
q_b™s
 = 
Q_BITS
 + 
qp_³r
 + 1;

558 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

559 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

560 *
m7
;

561 
”r
, 
e¡E¼
 = (è
e¡E¼4x4
[
qp_»m
][0][0] / 
cu¼Sliû
->
nÜm_çùÜ_4x4
;

563 
cÛff_ùr
 = 0; cÛff_ù¸< 
’d_cÛff_ùr
; coeff_ctr++)

565 
i
 = *
p_sÿn
++;

566 
j
 = *
p_sÿn
++;

567 
m7
 = &
tblock
[
j
][
i
];

569 ià(*
m7
 == 0)

571 
d©aLev–
->
Ëv–DoubË
 = 0;

572 
d©aLev–
->
Ëv–
[0] = 0;

573 
d©aLev–
->
noLev–s
 = 1;

574 
”r
 = 0.0;

575 
d©aLev–
->
”rLev–
[0] = 0.0;

576 
d©aLev–
->
´e_Ëv–
 = 0;

577 
d©aLev–
->
sign
 = 0;

581 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms
->
SÿËComp
;

582 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

583 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

585 
low”IÁ
=Ð(
sÿËd_cÛff
 - (
Ëv–
<<
q_b™s
)è< 
q_off£t
 )? 1 : 0;

587 
d©aLev–
->
Ëv–
[0] = 0;

588 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 1)

590 
d©aLev–
->
noLev–s
 = 1;

592 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 0)

594 
d©aLev–
->
Ëv–
[1] = 1;

595 
d©aLev–
->
noLev–s
 = 2;

597 ià(
Ëv–
 > 0 && 
low”IÁ
 == 1)

599 
d©aLev–
->
Ëv–
[1] =†evel;

600 
d©aLev–
->
noLev–s
 = 2;

604 
d©aLev–
->
Ëv–
[1] =†evel;

605 
d©aLev–
->
Ëv–
[2] =†evel + 1;

606 
d©aLev–
->
noLev–s
 = 3;

609 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

611 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

612 
d©aLev–
->
”rLev–
[
k
] = (
”r
 *ƒ¼ * 
e¡E¼
);

615 if(
d©aLev–
->
noLev–s
 == 1)

616 
d©aLev–
->
´e_Ëv–
 = 0;

618 
d©aLev–
->
´e_Ëv–
 = (
	`Ÿbs
 (*
m7
è* 
q_·¿ms
->
SÿËComp
 + q_·¿ms->
Off£tComp
è>> 
q_b™s
;

619 
d©aLev–
->
sign
 = 
	`isign
(*
m7
);

621 
d©aLev–
++;

623 
	}
}

631 
	$š™_Œ–lis_d©a_8x8_CAVLC
(
Maüoblock
 *
cu¼MB
, **
tblock
, 
block_x
, 
qp_³r
, 
qp_»m
, 
Lev–QuªtP¬ams
 **
q_·¿ms
,

632 cÚ¡ 
by‹
 *
p_sÿn
, 
Ëv–D©aSŒuù
 
Ëv–D©a
[4][16])

634 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

635 
i
, 
j
, 
block
, 
cÛff_ùr
;

636 *
m7
;

637 
q_b™s
 = 
Q_BITS_8
 + 
qp_³r
;

638 
q_off£t
 = ( 1 << (
q_b™s
 - 1) );

639 
”r
, 
e¡E¼
;

640 
sÿËd_cÛff
, 
Ëv–
, 
low”IÁ
, 
k
;

642 
Ëv–D©aSŒuù
 *
d©aLev–
 = &
Ëv–D©a
[0][0];

644 
cÛff_ùr
 = 0; coeff_ctr < 16; coeff_ctr++)

646 
block
 = 0; block < 4; block++)

648 
i
 = *
p_sÿn
++;

649 
j
 = *
p_sÿn
++;

651 
m7
 = &
tblock
[
j
][
block_x
 + 
i
];

653 
d©aLev–
 = &
Ëv–D©a
[
block
][
cÛff_ùr
];

654 ià(*
m7
 == 0)

656 
d©aLev–
->
Ëv–DoubË
 = 0;

657 
d©aLev–
->
Ëv–
[0] = 0;

658 
d©aLev–
->
noLev–s
 = 1;

659 
”r
 = 0.0;

660 
d©aLev–
->
”rLev–
[0] = 0.0;

661 
d©aLev–
->
´e_Ëv–
 = 0;

662 
d©aLev–
->
sign
 = 0;

666 
e¡E¼
 = (è
e¡E¼8x8
[
qp_»m
][
j
][
i
] / 
cu¼Sliû
->
nÜm_çùÜ_8x8
;

668 
sÿËd_cÛff
 = 
	`Ÿbs
(*
m7
è* 
q_·¿ms
[
j
][
i
].
SÿËComp
;

669 
d©aLev–
->
Ëv–DoubË
 = 
sÿËd_cÛff
;

670 
Ëv–
 = (
sÿËd_cÛff
 >> 
q_b™s
);

672 
low”IÁ
 = ((
sÿËd_cÛff
 - (
Ëv–
 << 
q_b™s
)è< 
q_off£t
 ) ? 1 : 0;

674 
d©aLev–
->
Ëv–
[0] = 0;

675 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 1)

677 
d©aLev–
->
noLev–s
 = 1;

679 ià(
Ëv–
 =ð0 && 
low”IÁ
 == 0)

681 
d©aLev–
->
Ëv–
[1] = 1;

682 
d©aLev–
->
noLev–s
 = 2;

684 ià(
Ëv–
 > 0 && 
low”IÁ
 == 1)

686 ià(
Ëv–
 > 1)

688 
d©aLev–
->
Ëv–
[1] =†evel - 1;

689 
d©aLev–
->
Ëv–
[2] =†evel;

690 
d©aLev–
->
noLev–s
 = 3;

694 
d©aLev–
->
Ëv–
[1] =†evel;

695 
d©aLev–
->
noLev–s
 = 2;

700 
d©aLev–
->
Ëv–
[1] =†evel;

701 
d©aLev–
->
Ëv–
[2] =†evel + 1;

702 
d©aLev–
->
noLev–s
 = 3;

705 
k
 = 0; k < 
d©aLev–
->
noLev–s
; k++)

707 
”r
 = ()(
d©aLev–
->
Ëv–
[
k
] << 
q_b™s
è- ()
sÿËd_cÛff
;

708 
d©aLev–
->
”rLev–
[
k
] = 
”r
 *ƒ¼ * 
e¡E¼
;

711 if(
d©aLev–
->
noLev–s
 == 1)

712 
d©aLev–
->
´e_Ëv–
 = 0;

714 
d©aLev–
->
´e_Ëv–
 = (
	`Ÿbs
 (*
m7
è* 
q_·¿ms
[
j
][
i
].
SÿËComp
 + q_·¿ms[j][i].
Off£tComp
è>> 
q_b™s
;

715 
d©aLev–
->
sign
 = 
	`isign
(*
m7
);

719 
	}
}

	@lencod/src/rdpicdecision.c

15 
	~"glob®.h
"

16 
	~<m©h.h
>

25 
	$rd_pic_decisiÚ
(
¢rY_v”siÚ1
, 
¢rY_v”siÚ2
, 
b™s_v”siÚ1
, 
b™s_v”siÚ2
, 
Ïmbda_piùu»
)

27 
co¡_v”siÚ1
, 
co¡_v”siÚ2
;

29 
co¡_v”siÚ1
 = (è
b™s_v”siÚ1
 * 
Ïmbda_piùu»
 + 
¢rY_v”siÚ1
;

30 
co¡_v”siÚ2
 = (è
b™s_v”siÚ2
 * 
Ïmbda_piùu»
 + 
¢rY_v”siÚ2
;

32 ià(
co¡_v”siÚ2
 > 
co¡_v”siÚ1
 || (co¡_v”siÚ2 =ðco¡_v”siÚ1 && 
¢rY_v”siÚ2
 >ð
¢rY_v”siÚ1
) )

36 
	}
}

44 
	$piùu»_codšg_decisiÚ
 (
VideoP¬am‘”s
 *
p_Vid
, 
Piùu»
 *
piùu»1
, Piùu» *
piùu»2
, 
qp
)

46 
Ïmbda_piùu»
;

47 
s£_piùu»1
, 
s£_piùu»2
;

49 ià(
p_Vid
->
p_IÅ
->
Numb”BF¿mes
)

50 
Ïmbda_piùu»
 = (
qp
 < 20 ? 0.55 : 0.68è* 
	`pow
 (2, (q°- 
SHIFT_QP
è/ 3.0è* ((
p_Vid
->
ty³
 =ð
B_SLICE
è|| (p_Vid->ty³ =ð
SP_SLICE
 ||…_Vid->ty³ =ð
SI_SLICE
) ? 2 : 1);

52 
Ïmbda_piùu»
 = (
qp
 < 20 ? 0.55 : 0.68è* 
	`pow
 (2, (q°- 
SHIFT_QP
) / 3.0);

54 if(
piùu»1
->
di¡ÜtiÚ
.
v®ue
[0] == 0)

56 if(
piùu»2
->
di¡ÜtiÚ
.
v®ue
[0] == 0)

59 
s£_piùu»1
 = 
piùu»1
->
di¡ÜtiÚ
.
v®ue
[0] +…icture1->distortion.value[1] +…icture1->distortion.value[2];

60 
s£_piùu»2
 = 
piùu»2
->
di¡ÜtiÚ
.
v®ue
[0] +…icture2->distortion.value[1] +…icture2->distortion.value[2];

62  
	`rd_pic_decisiÚ
(
s£_piùu»1
, 
s£_piùu»2
, 
piùu»1
->
b™s_³r_piùu»
, 
piùu»2
->b™s_³r_piùu», 
Ïmbda_piùu»
);

63 
	}
}

	@lencod/src/report.c

13 
	~"cÚŒibutÜs.h
"

15 
	~<time.h
>

16 
	~<m©h.h
>

18 
	~"glob®.h
"

19 
	~"cÚ‹xt_ši.h
"

20 
	~"ex¶ic™_gÝ.h
"

21 
	~"fžehªdË.h
"

22 
	~"fmo.h
"

23 
	~"image.h
"

24 
	~"šŒ¬eäesh.h
"

25 
	~"Ëaky_buck‘.h
"

26 
	~"me_•zs.h
"

27 
	~"me_•zs_št.h
"

28 
	~"ouut.h
"

29 
	~"·r£t.h
"

30 
	~"»pÜt.h
"

31 
	~"img_´oûss_ty³s.h
"

34 cÚ¡ 
	gDi¡ÜtiÚTy³
[3][20] = {"SAD", "SSE", "Hadamard SAD"};

36 
»pÜt_log_mode
 (
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
);

43 
	$»pÜt_äame_¡©i¡ic
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

45 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

46 
FILE
 *
p_¡©_äm
 = 
NULL
;

48 
i
;

49 
Çme
[30];

50 
b™couÁ”
;

51 
StP¬am‘”s
 *
cur_¡©s
 = &
p_Vid
->
’c_piùu»
->
¡©s
;

53 #iâdeà
WIN32


54 
time_t
 
now
;

55 
tm
 *
l_time
;

56 
¡ršg
[1000];

58 
timebuf
[128];

62 ià((
p_¡©_äm
 = 
	`fÝ’
("stat_frame.dat", "r")) == 0)

64 ià((
p_¡©_äm
 = 
	`fÝ’
("¡©_äame.d©", "a")è=ð
NULL
)

66 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "stat_frame.dat.dat");

67 
	`”rÜ
(
”rÜ‹xt
, 500);

71 
	`årštf
(
p_¡©_äm
, " --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

72 
	`årštf
(
p_¡©_äm
, "| Encoder statistics. This file is generated during firstƒncoding session,‚ew sessions will be‡ppended |\n");

73 
	`årštf
(
p_¡©_äm
, " --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

78 
	`fþo£
 (
p_¡©_äm
);

79 ià((
p_¡©_äm
 = 
	`fÝ’
("¡©_äame.d©", "a")è=ð
NULL
)

81 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "stat_frame.dat.dat");

82 
	`”rÜ
(
”rÜ‹xt
, 500);

86 ià(
p_Vid
->
äame_¡©i¡ic_¡¬t
)

88 
	`årštf
(
p_¡©_äm
, "| ver | Date | Time | Sequence |Frm | QP |P/MbInt| Bits | SNRY | SNRU | SNRV | I4 | I8 | I16 | IC0 | IC1 | IC2 | IC3 | PI4 | PI8 | PI16 | P0 | P1 | P2 | P3 | P1*4*| P1*8*| P2*4*| P2*8*| P3*4*| P3*8*| P8 | P8:4 | P4*4*| P4*8*| P8:5 | P8:6 | P8:7 | BI4 | BI8 | BI16 | B0 | B1 | B2 | B3 | B0*4*| B0*8*| B1*4*| B1*8*| B2*4*| B2*8*| B3*4*| B3*8*| B8 | B8:0 |B80*4*|B80*8*| B8:4 | B4*4*| B4*8*| B8:5 | B8:6 | B8:7 |\n");

89 
	`årštf
(
p_¡©_äm
, " ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ \n");

93 
	`årštf
(
p_¡©_äm
, "|%4s/%s", 
VERSION
, 
EXT_VERSION
);

95 #ifdeà
WIN32


96 
	`_¡rd©e
Ð
timebuf
 );

97 
	`årštf
(
p_¡©_äm
, "| %1.5 |", 
timebuf
);

99 
	`_¡¹ime
Ð
timebuf
);

100 
	`årštf
(
p_¡©_äm
, " % 1.5 |", 
timebuf
);

102 
now
 = 
	`time
 ((
time_t
 *è
NULL
);

103 
	`time
 (&
now
);

104 
l_time
 = 
	`loÿÉime
 (&
now
);

105 
	`¡ráime
 (
¡ršg
,  sŒšg, "%d-%b-%Y", 
l_time
);

106 
	`årštf
(
p_¡©_äm
, "| %1.5 |", 
¡ršg
 );

108 
	`¡ráime
 (
¡ršg
,  sŒšg, "%H:%M:%S", 
l_time
);

109 
	`årštf
(
p_¡©_äm
, " %1.5 |", 
¡ršg
);

112 
i
=0;i<30;i++)

113 
Çme
[
i
] = 
p_IÅ
->
šput_fže1
.
âame
[˜+ 
	`imax
(0,(è(
	`¡¾’
(p_Inp->input_file1.fname)- 30))];

115 
	`årštf
(
p_¡©_äm
, "%30.30s|", 
Çme
);

116 
	`årštf
(
p_¡©_äm
, "%3d |", 
p_Vid
->
äame_no
);

117 
	`årštf
(
p_¡©_äm
, "%3d |", 
p_Vid
->
qp
);

118 
	`årštf
(
p_¡©_äm
, " %d/%d |", 
p_IÅ
->
PicIÁ”Ïû
,…_IÅ->
MbIÁ”Ïû
);

120 #ià(
MVC_EXTENSION_ENABLE
)

121 ià(
p_Vid
->
cu¼_äm_idx
 =ð0 &&…_Vid->
äame_num
 =ð0 && !p_Vid->
v›w_id
)

123 ià(
p_Vid
->
cu¼_äm_idx
 =ð0 &&…_Vid->
äame_num
 == 0)

126 
b™couÁ”
 = (è
p_Vid
->
p_Sts
->
b™_couÁ”
[
I_SLICE
];

130 
b™couÁ”
 = (è(
p_Vid
->
p_Sts
->
b™_ùr_n
 -…_Vid->
Ï¡_b™_ùr_n
);

131 
p_Vid
->
Ï¡_b™_ùr_n
 =…_Vid->
p_Sts
->
b™_ùr_n
;

135 
	`årštf
(
p_¡©_äm
, " %9d|", 
b™couÁ”
);

138 
	`årštf
(
p_¡©_äm
, " %2.4f| %2.4f| %2.4f|", 
p_Di¡
->
m‘ric
[
PSNR
].
v®ue
[0],…_Dist->metric[PSNR].value[1],…_Dist->metric[PSNR].value[2]);

142 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
I_SLICE
][
I4MB
 ]);

143 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
I_SLICE
][
I8MB
 ]);

144 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
I_SLICE
][
I16MB
]);

147 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
šŒa_chroma_mode
[0]);

148 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
šŒa_chroma_mode
[1]);

149 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
šŒa_chroma_mode
[2]);

150 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
šŒa_chroma_mode
[3]);

153 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][
I4MB
 ]);

154 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][
I8MB
 ]);

155 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][
I16MB
]);

156 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][0 ]);

158 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][1 ]);

159 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][2 ]);

160 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][3 ]);

162 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][1][0]);

163 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][1][1]);

164 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][2][0]);

165 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][2][1]);

166 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][3][0]);

167 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][3][1]);

169 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][
P8x8
 ]);

170 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][4 ]);

171 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][4][0]);

172 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
P_SLICE
][4][1]);

173 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][5 ]);

174 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][6 ]);

175 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
P_SLICE
][7 ]);

178 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][
I4MB
 ]);

179 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][
I8MB
 ]);

180 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][
I16MB
]);

181 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][0 ]);

182 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][1 ]);

183 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][2 ]);

184 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][3 ]);

185 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][0][0]);

186 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][0][1]);

187 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][1][0]);

188 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][1][1]);

189 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][2][0]);

190 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][2][1]);

191 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][3][0]);

192 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][3][1]);

194 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][
P8x8
]);

195 
	`årštf
(
p_¡©_äm
, " %d|", (
cur_¡©s
->
b8_mode_0_u£
 [
B_SLICE
][0] + cur_stats->b8_mode_0_use [B_SLICE][1]));

196 
	`årštf
(
p_¡©_äm
, " %5d|", 
cur_¡©s
->
b8_mode_0_u£
 [
B_SLICE
][0]);

197 
	`årštf
(
p_¡©_äm
, " %5d|", 
cur_¡©s
->
b8_mode_0_u£
 [
B_SLICE
][1]);

198 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][4 ]);

199 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][4][0]);

200 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£_ŒªsfÜm
[
B_SLICE
][4][1]);

201 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][5 ]);

202 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][6 ]);

203 
	`årštf
(
p_¡©_äm
, " %5" 
FORMAT_OFF_T
 "|", 
cur_¡©s
->
mode_u£
[
B_SLICE
][7 ]);

205 
	`årštf
(
p_¡©_äm
, "\n");

208 
p_Vid
->
äame_¡©i¡ic_¡¬t
 = 0;

209 
	`fþo£
(
p_¡©_äm
);

210 
	}
}

213 
	$»pÜt_¦iû_´ed_¡©s
(
FILE
 *
p_¡©
, 
StP¬am‘”s
 *
p_Sts
, 
¦iû_ty³
, 
b™_u£
, *
¦iû_Çme
)

215 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|-----------------|");

216 
	`årštf
(
p_¡©
,"\À %8  | Modu£d | MÙiÚInfØb™ |", 
¦iû_Çme
);

217 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|-----------------|");

218 
	`årštf
(
p_¡©
,"\ÀMod 0 (cÝyè | %5" 
FORMAT_OFF_T
 " | %8.2à |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][0 ], (í_Sts->
b™_u£_mode
[¦iû_ty³][0 ] / 
b™_u£
);

219 
	`årštf
(
p_¡©
,"\ÀMod 1 (16x16è | %5" 
FORMAT_OFF_T
 " | %8.2à |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][1 ], (í_Sts->
b™_u£_mode
[¦iû_ty³][1 ] / 
b™_u£
);

220 
	`årštf
(
p_¡©
,"\ÀMod 2 (16x8è | %5" 
FORMAT_OFF_T
 " | %8.2à |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][2 ], (í_Sts->
b™_u£_mode
[¦iû_ty³][2 ] / 
b™_u£
);

221 
	`årštf
(
p_¡©
,"\ÀMod 3 (8x16è | %5" 
FORMAT_OFF_T
 " | %8.2à |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][3 ], (í_Sts->
b™_u£_mode
[¦iû_ty³][3 ] / 
b™_u£
);

222 
	`årštf
(
p_¡©
,"\ÀMod 4 (8x8è | %5" 
FORMAT_OFF_T
 " | %8.2à |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][
P8x8
], (í_Sts->
b™_u£_mode
[¦iû_ty³][P8x8] / 
b™_u£
);

223 
	`årštf
(
p_¡©
,"\ÀMod 5 iÁ¿ 4x4 | %5" 
FORMAT_OFF_T
 " |-----------------|", 
p_Sts
->
mode_u£
[
¦iû_ty³
][
I4MB
]);

224 
	`årštf
(
p_¡©
,"\ÀMod 6 iÁ¿ 8x8 | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][
I8MB
]);

225 
	`årštf
(
p_¡©
,"\ÀMod 7+ iÁ¿ 16x16 | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][
I16MB
]);

226 
	`årštf
(
p_¡©
,"\ÀMod iÁ¿ IPCM | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
¦iû_ty³
][
IPCM
 ]);

228  ()(
p_Sts
->
b™_u£_mode
[
¦iû_ty³
][0] +…_Stats->bit_use_mode[slice_type][1] +…_Stats->bit_use_mode[slice_type][2]

229 + 
p_Sts
->
b™_u£_mode
[
¦iû_ty³
][3] +…_Sts->b™_u£_mode[¦iû_ty³][
P8x8
]è/ 
b™_u£
;

230 
	}
}

239 
	$»pÜt_¡©s_Ú_”rÜ
()

241 
	`ä“_’cod”_memÜy
(
p_Enc
->
p_Vid
,…_Enc->
p_IÅ
);

242 
	`ex™
 (-1);

243 
	}
}

246 
	$»pÜt_¡©s
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
, 
št64
 
b™_u£
[
NUM_SLICE_TYPES
][2])

248 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

249 
FILE
 *
p_¡©
;

250 
m—n_mÙiÚ_šfo_b™_u£
[
NUM_SLICE_TYPES
] = {0.0};

251 
i
;

253 ià(
	`¡¾’
(
p_IÅ
->
StsFže
) == 0)

254 
	`¡rýy
 (
p_IÅ
->
StsFže
,"stats.dat");

256 ià((
p_¡©
 = 
	`fÝ’
(
p_IÅ
->
StsFže
, "wt")) == 0)

258 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "E¼Ü o³Àfž%s", 
p_IÅ
->
StsFže
);

259 
	`”rÜ
(
”rÜ‹xt
, 500);

262 
	`årštf
(
p_¡©
," -------------------------------------------------------------- \n");

263 
	`årštf
(
p_¡©
," This file contains statistics forhe†astƒncoded sequence \n");

264 
	`årštf
(
p_¡©
," -------------------------------------------------------------- \n");

265 
	`årštf
(
p_¡©
, " Sequ’û : %s\n", 
p_IÅ
->
šput_fže1
.
âame
);

268 
	`årštf
(
p_¡©
, " No.oàcoded…iùu»  : %4d\n", 
p_Sts
->
äame_couÁ”
);

269 
	`årštf
(
p_¡©
, " F»q. fÜƒncoded b™¡»am : %4.0f\n", 
p_IÅ
->
ouut
.
äame_¿‹
);

271 
	`årštf
(
p_¡©
, " I Sliû B™¿‹(kb/sè : %6.2f\n", 
p_Sts
->
b™¿‹_¡
[
I_SLICE
] / 1000.0);

272 
	`årštf
(
p_¡©
, " P Sliû B™¿‹(kb/sè : %6.2f\n", 
p_Sts
->
b™¿‹_¡
[
P_SLICE
] / 1000.0);

273 
	`årštf
(
p_¡©
, " B Sliû B™¿‹(kb/sè : %6.2f\n", 
p_Sts
->
b™¿‹_¡
[
B_SLICE
] / 1000.0);

274 
	`årštf
(
p_¡©
, " TÙ® B™¿‹(kb/sè : %6.2f\n", 
p_Sts
->
b™¿‹
 / 1000.0);

276 
i
 = 0; i < 3; i++)

278 
	`årštf
(
p_¡©
," ME Lev– %1d M‘riø : %s\n", 
i
, 
Di¡ÜtiÚTy³
[
p_IÅ
->
MEE¼ÜM‘ric
[i]]);

280 
	`årštf
(
p_¡©
," ModDecisiÚ M‘riø : %s\n", 
Di¡ÜtiÚTy³
[
p_IÅ
->
ModeDecisiÚM‘ric
]);

282  
p_IÅ
->
ChromaMEEÇbË
 )

285 
	`årštf
(
p_¡©
," ME for components : YCbCr\n");

288 
	`årštf
(
p_¡©
," ME for components : Y\n");

292 
	`årštf
(
p_¡©
, " ImagfÜm© : %dx%d\n", 
p_IÅ
->
ouut
.
width
[0],…_IÅ->ouut.
height
[0]);

294 ià(
p_IÅ
->
šŒa_upd
)

295 
	`årštf
(
p_¡©
," Error„obustness : On\n");

297 
	`årštf
(
p_¡©
," Error„obustness : Off\n");

299 
	`årštf
(
p_¡©
, " S—rch„ªg : %d\n", 
p_IÅ
->
£¬ch_¿nge
[0]);

300 #ià(
MVC_EXTENSION_ENABLE
)

301 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

303 
	`årštf
(
p_¡©
, " S—rch„ªg(v›w 1è : %d\n", 
p_IÅ
->
£¬ch_¿nge
[1]);

307 
	`årštf
(
p_¡©
, " TÙ®‚umb” oà»ã»nû  : %d\n", 
p_IÅ
->
num_»f_äames_Üg
);

308 
	`årštf
(
p_¡©
, " Reã»nû fÜ P sliû  : %d\n", 
p_IÅ
->
P_Li¡0_»fs_Üg
[0] ?…_IÅ->P_Li¡0_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
);

310 ià(
p_Sts
->
äame_ùr
[
B_SLICE
]!=0)

312 
	`årštf
(
p_¡©
, " Li¡0„ef fÜ B sliû  : %d\n", 
p_IÅ
->
B_Li¡0_»fs_Üg
[0] ?…_IÅ->B_Li¡0_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
);

313 
	`årštf
(
p_¡©
, " Li¡1„ef fÜ B sliû  : %d\n", 
p_IÅ
->
B_Li¡1_»fs_Üg
[0] ?…_IÅ->B_Li¡1_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
);

316 #ià(
MVC_EXTENSION_ENABLE
)

317 iàÐ
p_Vid
->
num_of_Ïy”s
 > 1 )

319 
	`årštf
(
p_¡©
, " V›w 1„ef fÜ P sliû  : %d\n", 
p_IÅ
->
P_Li¡0_»fs_Üg
[1] ?…_IÅ->P_Li¡0_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
);

320 
	`årštf
(
p_¡©
, " V›w 1 L0„ef fÜ B sliû  : %d\n", 
p_IÅ
->
B_Li¡0_»fs_Üg
[1] ?…_IÅ->B_Li¡0_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
);

321 
	`årštf
(
p_¡©
, " V›w 1 L1„ef fÜ B sliû  : %d\n", 
p_IÅ
->
B_Li¡1_»fs_Üg
[1] ?…_IÅ->B_Li¡1_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
);

325 
	`årštf
(
p_¡©
, " Profže/Lev– IDC : (%d,%d)\n", 
p_IÅ
->
ProfžeIDC
,…_IÅ->
Lev–IDC
);

326 ià(
p_IÅ
->
symbÞ_mode
 =ð
CAVLC
)

327 
	`årštf
(
p_¡©
, " Entropy coding method : CAVLC\n");

329 
	`årštf
(
p_¡©
, " Entropy coding method : CABAC\n");

331 ià(
p_IÅ
->
MbIÁ”Ïû
)

332 
	`årštf
(
p_¡©
, " MB Field Coding : On \n");

334 ià(
p_IÅ
->
S—rchMode
[0] =ð
EPZS
 ||…_Inp->SearchMode[1] == EPZS)

336 
	`EPZSOuutSts
(
p_IÅ
, 
p_¡©
, 1);

339 ià(
p_IÅ
->
fuÎ_£¬ch
 == 2)

340 
	`årštf
(
p_¡©
," Search„ange„estrictions :‚one\n");

341 ià(
p_IÅ
->
fuÎ_£¬ch
 == 1)

342 
	`årštf
(
p_¡©
," Search„ange„estrictions : older„eference frames\n");

344 
	`årštf
(
p_¡©
," Search„ange„estrictions : smaller blocks‡nd older„eference frames\n");

346 ià(
p_IÅ
->
rdÝt
)

347 
	`årštf
(
p_¡©
," RD-optimized mode decision : used\n");

349 
	`årštf
(
p_¡©
," RD-optimized mode decision :‚ot used\n");

351 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|");

352 
	`årštf
(
p_¡©
,"\n Item | Intra | All frames |");

353 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|");

354 
	`årštf
(
p_¡©
,"\n SNR Y(dB) |");

355 
	`årštf
(
p_¡©
," %5.2à |", 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][0]);

356 
	`årštf
(
p_¡©
," %5.2à |", 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[0]);

357 
	`årštf
(
p_¡©
,"\n SNR U/V (dB) |");

358 
	`årštf
(
p_¡©
," %5.2f/%5.2à |", 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][1],…_Dist->metric[PSNR].avslice[I_SLICE][2]);

359 
	`årštf
(
p_¡©
," %5.2f/%5.2à |", 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[1],…_Dist->metric[PSNR].average[2]);

360 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|");

361 
	`årštf
(
p_¡©
,"\n");

363 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

364 
	`årštf
(
p_¡©
,"\n SNR | I | P | B |");

365 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

366 
	`årštf
(
p_¡©
,"\n SNR Y(dB) | %5.3f | %5.3f | %5.3f |",

367 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][0],…_Di¡->m‘ric[PSNR].av¦iû[
P_SLICE
][0],…_Di¡->m‘ric[PSNR].av¦iû[
B_SLICE
][0]);

368 
	`årštf
(
p_¡©
,"\n SNR U(dB) | %5.3f | %5.3f | %5.3f |",

369 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][1],…_Di¡->m‘ric[PSNR].av¦iû[
P_SLICE
][1],…_Di¡->m‘ric[PSNR].av¦iû[
B_SLICE
][1]);

370 
	`årštf
(
p_¡©
,"\n SNR V(dB) | %5.3f | %5.3f | %5.3f |",

371 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][2],…_Di¡->m‘ric[PSNR].av¦iû[
P_SLICE
][2],…_Di¡->m‘ric[PSNR].av¦iû[
B_SLICE
][2]);

372 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

373 
	`årštf
(
p_¡©
,"\n");

376 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

377 
	`årštf
(
p_¡©
,"\n Ave Quant | I | P | B |");

378 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

379 
	`årštf
(
p_¡©
,"\n QP | %5.3f | %5.3f | %5.3f |",

380 ()
p_Sts
->
quªt
[
I_SLICE
]/
	`dmax
(1.0,(í_Sts->
num_maüoblocks
[I_SLICE]),

381 ()
p_Sts
->
quªt
[
P_SLICE
]/
	`dmax
(1.0,(í_Sts->
num_maüoblocks
[P_SLICE]),

382 ()
p_Sts
->
quªt
[
B_SLICE
]/
	`dmax
(1.0,(í_Sts->
num_maüoblocks
[B_SLICE]));

383 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|---------------|---------------|");

384 
	`årštf
(
p_¡©
,"\n");

387 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|");

388 
	`årštf
(
p_¡©
,"\n Intra | Mode used |");

389 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|");

390 
	`årštf
(
p_¡©
,"\ÀMod0 iÁ¿ 4x4 | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
I_SLICE
][
I4MB
 ]);

391 
	`årštf
(
p_¡©
,"\ÀMod1 iÁ¿ 8x8 | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
I_SLICE
][
I8MB
 ]);

392 
	`årštf
(
p_¡©
,"\ÀMod2+ iÁ¿ 16x16 | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
I_SLICE
][
I16MB
]);

393 
	`årštf
(
p_¡©
,"\ÀMod iÁ¿ IPCM | %5" 
FORMAT_OFF_T
 " |", 
p_Sts
->
mode_u£
[
I_SLICE
][
IPCM
 ]);

396 ià(
p_Sts
->
äame_ùr
[
P_SLICE
]!=0)

398 
m—n_mÙiÚ_šfo_b™_u£
[
P_SLICE
] = 
	`»pÜt_¦iû_´ed_¡©s
(
p_¡©
, 
p_Sts
, P_SLICE,(è
b™_u£
[P_SLICE][0], "P Slice ");

401 ià(
p_Sts
->
äame_ùr
[
B_SLICE
]!=0)

403 
m—n_mÙiÚ_šfo_b™_u£
[
B_SLICE
] = 
	`»pÜt_¦iû_´ed_¡©s
(
p_¡©
, 
p_Sts
, B_SLICE,(è
b™_u£
[B_SLICE][0], "B Slice ");

406 ià(
p_Sts
->
äame_ùr
[
SP_SLICE
]!=0)

408 
m—n_mÙiÚ_šfo_b™_u£
[
SP_SLICE
] = 
	`»pÜt_¦iû_´ed_¡©s
(
p_¡©
, 
p_Sts
, SP_SLICE,(è
b™_u£
[SP_SLICE][0], "SP Slice");

412 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|");

413 
	`årštf
(
p_¡©
,"\n");

415 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|----------------|----------------|----------------|");

416 
	`årštf
(
p_¡©
,"\n Bit usage: | Intra | Inter | B frame | SP frame |");

417 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|----------------|----------------|----------------|");

419 
	`årštf
(
p_¡©
,"\n Header |");

420 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_h—d”
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

421 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_h—d”
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

422 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_h—d”
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

424 
	`årštf
(
p_¡©
,"\n Mode |");

425 
	`årštf
(
p_¡©
," %10.2à |", ()
p_Sts
->
b™_u£_mb_ty³
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

426 
	`årštf
(
p_¡©
," %10.2à |", ()
p_Sts
->
b™_u£_mb_ty³
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

427 
	`årštf
(
p_¡©
," %10.2à |", ()
p_Sts
->
b™_u£_mb_ty³
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

429 
	`årštf
(
p_¡©
,"\n Motion Info |");

430 
	`årštf
(
p_¡©
," ./. |");

431 
	`årštf
(
p_¡©
," %10.2à |", 
m—n_mÙiÚ_šfo_b™_u£
[
P_SLICE
]);

432 
	`årštf
(
p_¡©
," %10.2à |", 
m—n_mÙiÚ_šfo_b™_u£
[
B_SLICE
]);

434 
	`årštf
(
p_¡©
,"\n CBP Y/C |");

435 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
tmp_b™_u£_cbp
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

436 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
tmp_b™_u£_cbp
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

437 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
tmp_b™_u£_cbp
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

440 
	`årštf
(
p_¡©
,"\n Coeffs. Y |");

441 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[0][
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

442 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[0][
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

443 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[0][
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

444 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[0][
SP_SLICE
] / 
b™_u£
[SP_SLICE][0]);

446 
	`årštf
(
p_¡©
,"\n Coeffs. C |");

447 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛffC
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

448 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛffC
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

449 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛffC
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

450 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛffC
[
SP_SLICE
] / 
b™_u£
[SP_SLICE][0]);

452 
	`årštf
(
p_¡©
,"\n Coeffs. CB |");

453 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[1][
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

454 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[1][
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

455 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[1][
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

456 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[1][
SP_SLICE
] / 
b™_u£
[SP_SLICE][0]);

458 
	`årštf
(
p_¡©
,"\n Coeffs. CR |");

459 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[2][
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

460 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[2][
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

461 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[2][
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

462 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_cÛff
[2][
SP_SLICE
] / 
b™_u£
[SP_SLICE][0]);

464 
	`årštf
(
p_¡©
,"\n Delta quant |");

465 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_d–_quªt
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

466 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_d–_quªt
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

467 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_d–_quªt
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

469 
	`årštf
(
p_¡©
,"\n Stuffing Bits |");

470 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_¡uffšg_b™s
[
I_SLICE
] / 
b™_u£
[I_SLICE][0]);

471 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_¡uffšg_b™s
[
P_SLICE
] / 
b™_u£
[P_SLICE][0]);

472 
	`årštf
(
p_¡©
," %10.2à |", (è
p_Sts
->
b™_u£_¡uffšg_b™s
[
B_SLICE
] / 
b™_u£
[B_SLICE][0]);

474 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|----------------|----------------|");

475 
	`årštf
(
p_¡©
,"\n‡verage bits/frame |");

476 
	`årštf
(
p_¡©
," %10.2à |", (è
b™_u£
[
I_SLICE
][1] / () bit_use[I_SLICE][0] );

477 
	`årštf
(
p_¡©
," %10.2à |", (è
b™_u£
[
P_SLICE
][1] / () bit_use[P_SLICE][0] );

478 
	`årštf
(
p_¡©
," %10.2à |", (è
b™_u£
[
B_SLICE
][1] / () bit_use[B_SLICE][0] );

479 
	`årštf
(
p_¡©
,"\n ---------------------|----------------|----------------|----------------|");

480 
	`årštf
(
p_¡©
,"\n");

482 
	`fþo£
(
p_¡©
);

483 
	}
}

486 
	$»pÜt_log
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
)

488 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

489 
FILE
 *
p_log
 = 
p_Vid
->p_log;

490 
Çme
[40];

491 
i
;

492 #iâdeà
WIN32


493 
time_t
 
now
;

494 
tm
 *
l_time
;

495 
¡ršg
[1000];

497 
timebuf
[128];

500 ià((
p_log
 = 
	`fÝ’
("log.dat", "r")) == 0)

502 ià((
p_log
 = 
	`fÝ’
("log.d©", "a")è=ð
NULL
)

504 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "log.dat");

505 
	`”rÜ
(
”rÜ‹xt
, 500);

509 
	`årštf
(
p_log
," ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ \n");

510 
	`årštf
(
p_log
,"| Encoder statistics. This file is generated during firstƒncoding session,‚ew sessions will be‡ppended |\n");

511 
	`årštf
(
p_log
," ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ \n");

512 
	`årštf
(
p_log
,"| ver | Date | Time | Sequence | #Img |P/MbInt| QPI| QPP| QPB| Format |Iperiod| #B | FMES | Hdmd | S.R |#Ref | Freq |Coding|RD-opt|Intra upd|8x8Tr| SNRY 1| SNRU 1| SNRV 1| SNRY N| SNRU N| SNRV N|#Bitr I|#Bitr P|#Bitr B|#Bitr IPB| Total Time | Me Time |\n");

513 
	`årštf
(
p_log
," ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ \n");

519 
	`fþo£
 (
p_log
);

520 ià((
p_log
 = 
	`fÝ’
("log.d©", "a")è=ð
NULL
)

522 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "log.dat");

523 
	`”rÜ
(
”rÜ‹xt
, 500);

526 
	`årštf
(
p_log
,"|%5s/%-5s", 
VERSION
, 
EXT_VERSION
);

528 #ifdeà
WIN32


529 
	`_¡rd©e
Ð
timebuf
 );

530 
	`årštf
(
p_log
,"| %1.5 |", 
timebuf
 );

532 
	`_¡¹ime
Ð
timebuf
);

533 
	`årštf
(
p_log
," % 1.5 |", 
timebuf
);

535 
now
 = 
	`time
 ((
time_t
 *è
NULL
);

536 
	`time
 (&
now
);

537 
l_time
 = 
	`loÿÉime
 (&
now
);

538 
	`¡ráime
 (
¡ršg
,  sŒšg, "%d-%b-%Y", 
l_time
);

539 
	`årštf
(
p_log
,"| %1.5 |", 
¡ršg
 );

541 
	`¡ráime
 (
¡ršg
,  sŒšg, "%H:%M:%S", 
l_time
);

542 
	`årštf
(
p_log
," %1.5 |", 
¡ršg
 );

545 
i
=0; i < 40; i++)

546 
Çme
[
i
] = 
p_IÅ
->
šput_fže1
.
âame
[˜+ 
	`imax
(0, ((è
	`¡¾’
(p_Inp->input_file1.fname)) - 40)];

547 
	`årštf
(
p_log
,"%40.40s|",
Çme
);

549 
	`årštf
(
p_log
,"%5d | %d/%d |", 
p_IÅ
->
no_äames
,…_IÅ->
PicIÁ”Ïû
,…_IÅ->
MbIÁ”Ïû
);

550 
	`årštf
(
p_log
," %-3d| %-3d| %-3d|", 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],…_IÅ->qp[
B_SLICE
]);

552 
	`årštf
(
p_log
,"%4dx%-4d|", 
p_IÅ
->
ouut
.
width
[0],…_IÅ->ouut.
height
[0]);

553 
	`årštf
(
p_log
," %3d |%3d |", 
p_IÅ
->
šŒa_³riod
, 
p_Sts
->
Numb”BF¿mes
);

556  
p_IÅ
->
S—rchMode
[0] )

558 
UM_HEX
:

559 
	`årštf
(
p_log
," HEX |");

561 
UM_HEX_SIMPLE
:

562 
	`årštf
(
p_log
," SHEX |");

564 
EPZS
:

565 
	`årštf
(
p_log
," EPZS |");

567 
FAST_FULL_SEARCH
:

568 
	`årštf
(
p_log
," FFS |");

571 
	`årštf
(
p_log
," FS |");

574 #ià(
MVC_EXTENSION_ENABLE
)

575 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

577  
p_IÅ
->
S—rchMode
[1] )

579 
UM_HEX
:

580 
	`årštf
(
p_log
," HEX |");

582 
UM_HEX_SIMPLE
:

583 
	`årštf
(
p_log
," SHEX |");

585 
EPZS
:

586 
	`årštf
(
p_log
," EPZS |");

588 
FAST_FULL_SEARCH
:

589 
	`årštf
(
p_log
," FFS |");

592 
	`årštf
(
p_log
," FS |");

598 
	`årštf
(
p_log
," %1d%1d%1d |", 
p_IÅ
->
MEE¼ÜM‘ric
[
F_PEL
],…_IÅ->MEE¼ÜM‘ric[
H_PEL
],…_IÅ->MEE¼ÜM‘ric[
Q_PEL
]);

600 #ià(
MVC_EXTENSION_ENABLE
)

601 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

603 
	`årštf
(
p_log
," %3d (%3dè| %2d |", 
p_IÅ
->
£¬ch_¿nge
[0],…_IÅ->£¬ch_¿nge[1],…_IÅ->
num_»f_äames
 );

607 
	`årštf
(
p_log
," %3d | %2d |", 
p_IÅ
->
£¬ch_¿nge
[0],…_IÅ->
num_»f_äames
 );

609 
	`årštf
(
p_log
," %5.2f|", 
p_Vid
->
äam”©e
);

611 ià(
p_IÅ
->
symbÞ_mode
 =ð
CAVLC
)

612 
	`årštf
(
p_log
," CAVLC|");

614 
	`årštf
(
p_log
," CABAC|");

616 
	`årštf
(
p_log
," %d |", 
p_IÅ
->
rdÝt
);

618 ià(
p_IÅ
->
šŒa_upd
 == 1)

619 
	`årštf
(
p_log
," ON |");

621 
	`årštf
(
p_log
," OFF |");

623 
	`årštf
(
p_log
," %d |", 
p_IÅ
->
T¿nsfÜm8x8Mode
);

625 
	`årštf
(
p_log
,"%7.3f|%7.3f|%7.3f|",

626 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][0],

627 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][1],

628 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][2]);

629 
	`årštf
(
p_log
,"%7.3f|%7.3f|%7.3f|", 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[0],p_Dist->metric[PSNR].average[1],p_Dist->metric[PSNR].average[2]);

635 
	`årštf
(
p_log
,"%7.0f|%7.0f|%7.0f|%9.0f|", 
p_Sts
->
b™¿‹_¡
[
I_SLICE
],p_Sts->b™¿‹_¡[
P_SLICE
],p_Sts->b™¿‹_¡[
B_SLICE
],…_Sts->
b™¿‹
);

636 
	`årštf
(
p_log
," %12d | %12d |", ()
p_Vid
->
tÙ_time
,(í_Vid->
me_tÙ_time
);

639 
	`årštf
(
p_log
,"\n");

641 
	`fþo£
(
p_log
);

643 
p_log
 = 
	`fÝ’
("data.txt", "a");

645 ià((
p_Sts
->
Numb”BF¿mes
 !ð0è&& (p_Sts->
äame_ùr
[
B_SLICE
] != 0))

647 
	`årštf
(
p_log
, "%3d %2d %2d %2.2à%2.2à%2.2à%5" 
FORMAT_OFF_T
 " "

649 "%2.2à%2.2à%2.2à%5" 
FORMAT_OFF_T
 " %5" FORMAT_OFF_T " %.3f\n",

650 
p_Sts
->
äame_couÁ”
, 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],

651 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][0],

652 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][1],

653 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][2],

654 
p_Sts
->
b™_couÁ”
[
I_SLICE
],

659 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[0],

660 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[1],

661 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[2],

662 (
p_Sts
->
b™_couÁ”
[
I_SLICE
] +…_Sts->
b™_ùr
è/…_Sts->
äame_couÁ”
,

663 
p_Sts
->
b™_couÁ”
[
B_SLICE
] /…_Sts->
äame_ùr
[B_SLICE],

664 (è0.001 * 
p_Vid
->
tÙ_time
 / (
p_Sts
->
äame_couÁ”
));

668 ià(
p_IÅ
->
no_äames
 != 0)

669 
	`årštf
(
p_log
, "%3d %2d %2d %2.2à%2.2à%2.2à%5" 
FORMAT_OFF_T
 " "

671 "%2.2à%2.2à%2.2à%5" 
FORMAT_OFF_T
 " %5d %.3f\n",

672 
p_Sts
->
äame_couÁ”
, 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],

673 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][0],

674 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][1],

675 
p_Di¡
->
m‘ric
[
PSNR
].
av¦iû
[
I_SLICE
][2],

676 
p_Sts
->
b™_couÁ”
[
I_SLICE
],

681 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[0],

682 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[1],

683 
p_Di¡
->
m‘ric
[
PSNR
].
av”age
[2],

684 (
p_Sts
->
b™_couÁ”
[
I_SLICE
] +…_Sts->
b™_ùr
)/…_Sts->
äame_couÁ”
,

686 ()0.001 * 
p_Vid
->
tÙ_time
 / 
p_Sts
->
äame_couÁ”
);

689 
	`fþo£
(
p_log
);

690 
	}
}

705 
	$»pÜt
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
)

707 
Di¡ÜtiÚP¬ams
 *
p_Di¡
 = 
p_Vid
->p_Dist;

708 
št64
 
b™_u£
[
NUM_SLICE_TYPES
][2];

709 
i
,
j
;

710 
št64
 
tÙ®_b™s
;

711 #ià(
MVC_EXTENSION_ENABLE
)

712 
št64
 
tÙ®_b™s_v
[
NUM_VIEWS
];

715 
b™_u£
[ 
I_SLICE
][0] = 
p_Sts
->
äame_ùr
[I_SLICE];

716 
b™_u£
[ 
P_SLICE
][0] = 
	`imax
(
p_Sts
->
äame_ùr
[P_SLICE ] +…_Sts->äame_ùr[
SP_SLICE
], 1);

717 
b™_u£
[ 
B_SLICE
][0] = 
	`imax
(
p_Sts
->
äame_ùr
[B_SLICE ], 1);

718 
b™_u£
[
SP_SLICE
][0] = 
	`imax
(
p_Sts
->
äame_ùr
[SP_SLICE], 1);

721 
p_Vid
->
tÙ_time
 = 
	`tim’Üm
(p_Vid->tot_time);

722 
p_Vid
->
me_tÙ_time
 = 
	`tim’Üm
(p_Vid->me_tot_time);

724 
j
=0; j < 
NUM_SLICE_TYPES
; j++)

726 
b™_u£
[
j
][1] = 0;

729 
j
=0; j < 
NUM_SLICE_TYPES
; j++)

731 
i
=0; i < 
MAXMODE
; i++)

732 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_mode
[j][
i
];

734 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_mb_ty³
[j];

735 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_h—d”
[j];

736 
b™_u£
[
j
][1] +ð
p_Sts
->
tmp_b™_u£_cbp
[j];

737 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_cÛffC
[j];

738 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_cÛff
[0][j];

739 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_cÛff
[1][j];

740 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_cÛff
[2][j];

741 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_d–_quªt
[j];

742 
b™_u£
[
j
][1] +ð
p_Sts
->
b™_u£_¡uffšg_b™s
[j];

746 
p_Sts
->
b™¿‹_¡
[ 
I_SLICE
] = (p_Sts->
b™_couÁ”
[ I_SLICE]è* (è(
p_IÅ
->
ouut
.
äame_¿‹
è/ (èÕ_Sts->
äame_couÁ”
);

747 
p_Sts
->
b™¿‹_¡
[ 
P_SLICE
] = (p_Sts->
b™_couÁ”
[ P_SLICE]è* (è(
p_IÅ
->
ouut
.
äame_¿‹
è/ (èÕ_Sts->
äame_couÁ”
);

748 
p_Sts
->
b™¿‹_¡
[ 
B_SLICE
] = (p_Sts->
b™_couÁ”
[ B_SLICE]è* (è(
p_IÅ
->
ouut
.
äame_¿‹
è/ (èÕ_Sts->
äame_couÁ”
);

749 
p_Sts
->
b™¿‹_¡
[
SP_SLICE
] = (p_Sts->
b™_couÁ”
[SP_SLICE]è* (è(
p_IÅ
->
ouut
.
äame_¿‹
è/ (èÕ_Sts->
äame_couÁ”
);

751 
p_IÅ
->
V”bo£
)

756 
	`årštf
(
¡dout
,"------------------ Average data‡ll frames -----------------------------------\n\n");

759 
	`årštf
(
¡dout
,"------------------------------------ Average data‡ll frames ---------------------------------\n\n");

762 
	`årštf
(
¡dout
,"--------------------------------------- Average data‡ll frames -------------------------------------\n\n");

766 ià(
p_IÅ
->
V”bo£
 != 0)

768 
Di¡M‘ric
 *
¢r
 = &
p_Di¡
->
m‘ric
[
PSNR
 ];

769 
Di¡M‘ric
 *
s£
 = &
p_Di¡
->
m‘ric
[
SSE
 ];

770 
Di¡M‘ric
 *
¢r_rgb
 = &
p_Di¡
->
m‘ric
[
PSNR_RGB
];

771 
Di¡M‘ric
 *
s£_rgb
 = &
p_Di¡
->
m‘ric
[
SSE_RGB
 ];

773 
impix
 = 
p_IÅ
->
ouut
.
size_cmp
[0];

774 
impix_ü
 = 
p_IÅ
->
ouut
.
size_cmp
[1];

776 
c¢r_y
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[0], 
impix
 , 
s£
->
av”age
[0]);

777 
c¢r_u
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[1], 
impix_ü
, 
s£
->
av”age
[1]);

778 
c¢r_v
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[2], 
impix_ü
, 
s£
->
av”age
[2]);

780 #ià(
MVC_EXTENSION_ENABLE
)

781 
Di¡M‘ric
 *
¢r_v
[2] = {
NULL
, NULL};

782 
Di¡M‘ric
 *
s£_v
[2] = {
NULL
, NULL};

783 
c¢r_y_v
[2] = {0.0, 0.0};

784 
c¢r_u_v
[2] = {0.0, 0.0};

785 
c¢r_v_v
[2] = {0.0, 0.0};

787 ià(
p_IÅ
->
num_of_v›ws
 == 2)

789 
¢r_v
[0] = &
p_Di¡
->
m‘ric_v
[0][
PSNR
];

790 
¢r_v
[1] = &
p_Di¡
->
m‘ric_v
[1][
PSNR
];

791 
s£_v
[0] = &
p_Di¡
->
m‘ric_v
[0][
SSE
];

792 
s£_v
[1] = &
p_Di¡
->
m‘ric_v
[1][
SSE
];

793 
c¢r_y_v
[0] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[0], 
impix
 , 
s£_v
[0]->
av”age
[0]);

794 
c¢r_u_v
[0] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[1], 
impix_ü
, 
s£_v
[0]->
av”age
[1]);

795 
c¢r_v_v
[0] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[2], 
impix_ü
, 
s£_v
[0]->
av”age
[2]);

796 
c¢r_y_v
[1] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[0], 
impix
 , 
s£_v
[1]->
av”age
[0]);

797 
c¢r_u_v
[1] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[1], 
impix_ü
, 
s£_v
[1]->
av”age
[1]);

798 
c¢r_v_v
[1] = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[2], 
impix_ü
, 
s£_v
[1]->
av”age
[2]);

802 
	`årštf
(
¡dout
, " TÙ®ƒncodšgimfÜh£q. : %7.3à£ø(%3.2àås)\n", (è
p_Vid
->
tÙ_time
 * 0.001, 1000.0 * (è(
p_Sts
->
äame_couÁ”
) / ()p_Vid->tot_time);

803 
	`årštf
(
¡dout
, " TÙ® MEimfÜ sequ’û : %7.3à£ø\n\n", ()
p_Vid
->
me_tÙ_time
 * 0.001);

805 
	`årštf
(
¡dout
," Y { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

806 
¢r
->
av”age
[0], 
c¢r_y
, 
s£
->av”age[0]/()
impix
);

807 
	`årštf
(
¡dout
," U { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

808 
¢r
->
av”age
[1], 
c¢r_u
, 
s£
->av”age[1]/()
impix_ü
);

809 
	`årštf
(
¡dout
," V { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

810 
¢r
->
av”age
[2], 
c¢r_v
, 
s£
->av”age[2]/()
impix_ü
);

811 #ià(
MVC_EXTENSION_ENABLE
)

812 ià(
p_IÅ
->
num_of_v›ws
 == 2)

814 
	`årštf
Ð
¡dout
, "\n" );

815 
	`årštf
(
¡dout
," View0_Y { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

816 
¢r_v
[0]->
av”age
[0], 
c¢r_y_v
[0], 
s£_v
[0]->av”age[0]/()
impix
);

817 
	`årštf
(
¡dout
," View0_U { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

818 
¢r_v
[0]->
av”age
[1], 
c¢r_u_v
[0], 
s£_v
[0]->av”age[1]/()
impix_ü
);

819 
	`årštf
(
¡dout
," View0_V { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

820 
¢r_v
[0]->
av”age
[2], 
c¢r_v_v
[0], 
s£_v
[0]->av”age[2]/()
impix_ü
);

821 
	`årštf
Ð
¡dout
, "\n" );

822 
	`årštf
(
¡dout
," View1_Y { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

823 
¢r_v
[1]->
av”age
[0], 
c¢r_y_v
[1], 
s£_v
[1]->av”age[0]/()
impix
);

824 
	`årštf
(
¡dout
," View1_U { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

825 
¢r_v
[1]->
av”age
[1], 
c¢r_u_v
[1], 
s£_v
[1]->av”age[1]/()
impix_ü
);

826 
	`årštf
(
¡dout
," View1_V { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

827 
¢r_v
[1]->
av”age
[2], 
c¢r_v_v
[1], 
s£_v
[1]->av”age[2]/()
impix_ü
);

831 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
 == 1)

833 
c¢r_r
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[0], 
impix
, 
s£_rgb
->
av”age
[0]);

834 
c¢r_g
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[1], 
impix
, 
s£_rgb
->
av”age
[1]);

835 
c¢r_b
 = 
	`p¢r
(
p_Vid
->
max_img³l_v®ue_comp_sq
[2], 
impix
, 
s£_rgb
->
av”age
[2]);

837 
	`årštf
(
¡dout
," R { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

838 
¢r_rgb
->
av”age
[0], 
c¢r_r
, 
s£_rgb
->av”age[0] / (è
impix
);

839 
	`årštf
(
¡dout
," G { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

840 
¢r_rgb
->
av”age
[1], 
c¢r_g
, 
s£_rgb
->av”age[1] / (è
impix
);

841 
	`årštf
(
¡dout
," B { PSNR (dB), cSNR (dB), MSE } : { %7.3f, %7.3f, %9.5f }\n",

842 
¢r_rgb
->
av”age
[2], 
c¢r_b
, 
s£_rgb
->av”age[2] / (è
impix
);

845 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

847 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
 == 1)

849 
	`årštf
(
¡dout
," SSIM {Y, R} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[0],…_Di¡->m‘ric[
SSIM_RGB
].average[0]);

850 
	`årštf
(
¡dout
," SSIM {U, G} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[1],…_Di¡->m‘ric[
SSIM_RGB
].average[1]);

851 
	`årštf
(
¡dout
," SSIM {V, B} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[2],…_Di¡->m‘ric[
SSIM_RGB
].average[2]);

855 
	`årštf
(
¡dout
," Y SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[0]);

856 
	`årštf
(
¡dout
," U SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[1]);

857 
	`årštf
(
¡dout
," V SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
SSIM
].
av”age
[2]);

860 ià(
p_IÅ
->
Di¡ÜtiÚ
[
MS_SSIM
] == 1)

862 if(
p_IÅ
->
Di¡ÜtiÚYUVtoRGB
 == 1)

864 
	`årštf
(
¡dout
," MS-SSIM {Y, R} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[0],…_Di¡->m‘ric[
MS_SSIM_RGB
].average[0]);

865 
	`årštf
(
¡dout
," MS-SSIM {U, G} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[1],…_Di¡->m‘ric[
MS_SSIM_RGB
].average[1]);

866 
	`årštf
(
¡dout
," MS-SSIM {V, B} : { %5.4f, %5.4à}\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[2],…_Di¡->m‘ric[
MS_SSIM_RGB
].average[2]);

870 
	`årštf
(
¡dout
," Y MS-SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[0]);

871 
	`årštf
(
¡dout
," U MS-SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[1]);

872 
	`årštf
(
¡dout
," V MS-SSIM : %5.4f\n", 
p_Di¡
->
m‘ric
[
MS_SSIM
].
av”age
[2]);

875 
	`årštf
(
¡dout
,"\n");

878 
	`årštf
(
¡dout
, " TÙ®ƒncodšgimfÜh£q. : %5.3à£ø(%5.2àås)\n\n", 
p_Vid
->
tÙ_time
 * 0.001, 1000.0 * (
p_Sts
->
äame_couÁ”
) /…_Vid->tot_time);

880 
tÙ®_b™s
 = 
p_Sts
->
b™_ùr_·¿m‘”£ts
;

881 
tÙ®_b™s
 +ð
p_Sts
->
b™_ùr_fžËr_d©a
;

882 
i
 = 0; i < 
NUM_SLICE_TYPES
; i++)

883 
tÙ®_b™s
 +ð
p_Sts
->
b™_couÁ”
[
i
];

884 #ià(
MVC_EXTENSION_ENABLE
)

885 ià(
p_IÅ
->
num_of_v›ws
 == 2)

887  
j
 = 0; j < 
NUM_VIEWS
; j++ )

889 
tÙ®_b™s_v
[
j
] = 
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[j];

890 
tÙ®_b™s_v
[
j
] +ð
p_Sts
->
b™_ùr_fžËr_d©a_v
[j];

891 
i
 = 0; i < 
NUM_SLICE_TYPES
; i++)

892 
tÙ®_b™s_v
[
j
] +ð
p_Sts
->
b™_couÁ”_v
[j][
i
];

896 ià(
p_IÅ
->
num_of_v›ws
 =ð2 && 
p_Vid
->
æd_æag
)

898 ià(
p_Sts
->
äame_ùr
[
B_SLICE
] != 0)

900 
	`årštf
(
¡dout
, " TÙ® b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", B %" FORMAT_OFF_T " NVB %d) \n",

901 
tÙ®_b™s_v
[0] +otal_bits_v[1],

902 
p_Sts
->
b™_couÁ”_v
[0][
I_SLICE
] +…_Stats->bit_counter_v[1][I_SLICE],

903 
p_Sts
->
b™_couÁ”_v
[0][
P_SLICE
] +…_Stats->bit_counter_v[1][P_SLICE],

904 
p_Sts
->
b™_couÁ”_v
[0][
B_SLICE
] +…_Stats->bit_counter_v[1][B_SLICE],

905 
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[0] +…_Stats->bit_ctr_parametersets_v[1]);

909 
	`årštf
(
¡dout
, " TÙ® b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", NVB %d) \n",

910 
tÙ®_b™s_v
[0] +otal_bits_v[1],

911 
p_Sts
->
b™_couÁ”_v
[0][
I_SLICE
] +…_Stats->bit_counter_v[1][I_SLICE],

912 
p_Sts
->
b™_couÁ”_v
[0][
P_SLICE
] +…_Stats->bit_counter_v[1][P_SLICE],

913 
p_Sts
->
b™_ùr_·¿m‘”£ts_v
[0] +…_Stats->bit_ctr_parametersets_v[1]);

919 ià(
p_Sts
->
äame_ùr
[
B_SLICE
] != 0)

921 
	`årštf
(
¡dout
, " TÙ® b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", B %" FORMAT_OFF_T " NVB %d) \n",

922 
tÙ®_b™s
, 
p_Sts
->
b™_couÁ”
[
I_SLICE
],…_Sts->b™_couÁ”[
P_SLICE
],…_Sts->b™_couÁ”[
B_SLICE
],…_Sts->
b™_ùr_·¿m‘”£ts
);

926 
	`årštf
(
¡dout
, " TÙ® b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", NVB %d) \n",

927 
tÙ®_b™s
, 
p_Sts
->
b™_couÁ”
[
I_SLICE
],…_Sts->b™_couÁ”[
P_SLICE
],…_Sts->
b™_ùr_·¿m‘”£ts
);

930 #ià(
MVC_EXTENSION_ENABLE
)

931 ià(
p_IÅ
->
num_of_v›ws
 == 2)

933 
v›w_id
;

935  
v›w_id
 = 0; v›w_id < 
NUM_VIEWS
; view_id++ )

937 ià(
p_Sts
->
äame_ùr
[
B_SLICE
] != 0)

939 
	`årštf
(
¡dout
, " V›w %1d TÙ®-b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", B %" FORMAT_OFF_T " NVB %d) \n",

940 
v›w_id
, 
tÙ®_b™s_v
[v›w_id], 
p_Sts
->
b™_couÁ”_v
[v›w_id][
I_SLICE
],…_Sts->b™_couÁ”_v[v›w_id][
P_SLICE
],…_Sts->b™_couÁ”_v[v›w_id][
B_SLICE
],…_Sts->
b™_ùr_·¿m‘”£ts_v
[view_id]);

944 
	`årštf
(
¡dout
, " V›w %1d TÙ®-b™  : %" 
FORMAT_OFF_T
 " (I %" FORMAT_OFF_T ", P %" FORMAT_OFF_T ", NVB %d) \n",

945 
v›w_id
, 
tÙ®_b™s_v
[v›w_id], 
p_Sts
->
b™_couÁ”_v
[v›w_id][
I_SLICE
],…_Sts->b™_couÁ”_v[v›w_id][
P_SLICE
],…_Sts->
b™_ùr_·¿m‘”£ts_v
[view_id]);

950 ià(
p_IÅ
->
num_of_v›ws
 == 2)

952 
p_Sts
->
b™¿‹
ð((è
tÙ®_b™s
 * (è
p_IÅ
->
ouut
.
äame_¿‹
è/ ((èÕ_Sts->
äame_couÁ”
>>1));

956 
p_Sts
->
b™¿‹
ð((è
tÙ®_b™s
 * (è
p_IÅ
->
ouut
.
äame_¿‹
è/ ((èÕ_Sts->
äame_couÁ”
));

957 
	`årštf
(
¡dout
, " B™„©(kb™/sè @ %2.2àHz : %5.2f\n", 
p_IÅ
->
ouut
.
äame_¿‹
, 
p_Sts
->
b™¿‹
 / 1000.0);

958 #ià(
MVC_EXTENSION_ENABLE
)

959 ià(
p_IÅ
->
num_of_v›ws
 == 2)

961 
p_Sts
->
b™¿‹_v
[0] = ((è
tÙ®_b™s_v
[0] * (è
p_IÅ
->
ouut
.
äame_¿‹
è/ ((èÕ_Sts->
äame_couÁ”
 >> 1));

962 
p_Sts
->
b™¿‹_v
[1] = ((è
tÙ®_b™s_v
[1] * (è
p_IÅ
->
ouut
.
äame_¿‹
è/ ((èÕ_Sts->
äame_couÁ”
 >> 1));

963 
	`årštf
(
¡dout
, " V›w 0 BR (kb™/sè @ %2.2àHz : %5.2f\n", 
p_IÅ
->
ouut
.
äame_¿‹
, 
p_Sts
->
b™¿‹_v
[0] / 1000.0);

964 
	`årštf
(
¡dout
, " V›w 1 BR (kb™/sè @ %2.2àHz : %5.2f\n", 
p_IÅ
->
ouut
.
äame_¿‹
, 
p_Sts
->
b™¿‹_v
[1] / 1000.0);

968 
i
 = 0; i < 5; i++)

970 
p_Sts
->
b™_ùr_emuÏtiÚ_´ev’tiÚ
 +ðp_Sts->
b™_u£_¡uffšg_b™s
[
i
];

972 #ià(
MVC_EXTENSION_ENABLE
)

973 iàÐ
p_Vid
->
num_of_Ïy”s
 == 2 )

975 
i
 = 0; i < 5; i++)

977 
p_Sts
->
b™_ùr_emuÏtiÚ´ev’tiÚ_v
[
p_Vid
->
dpb_Ïy”_id
] +ðp_Sts->
b™_u£_¡uffšg_b™s
[
i
];

982 
	`årštf
(
¡dout
, " B™ tØavoid S¹codEmuÏtiÚ : %" 
FORMAT_OFF_T
 " \n", 
p_Sts
->
b™_ùr_emuÏtiÚ_´ev’tiÚ
);

983 
	`årštf
(
¡dout
, " B™ fÜ…¬am‘” s‘  : %d \n", 
p_Sts
->
b™_ùr_·¿m‘”£ts
);

984 
	`årštf
(
¡dout
, " B™ fÜ fžË¸d©¨ : %" 
FORMAT_OFF_T
 " \n\n", 
p_Sts
->
b™_ùr_fžËr_d©a
);

986 
p_IÅ
->
V”bo£
)

991 
	`årštf
(
¡dout
,"-------------------------------------------------------------------------------\n");

994 
	`årštf
(
¡dout
,"------------------------------------------------------------------------------------------------\n");

997 
	`årštf
(
¡dout
,"-------------------------------------------------------------------------------------------------------\n");

1000 
	`årštf
(
¡dout
,"Ex™ JM % ’cod” v” % ", 
JM
, 
VERSION
);

1001 
	`årštf
(
¡dout
,"\n");

1004 
	`»pÜt_¡©s
(
p_Vid
, 
p_IÅ
, 
p_Sts
, 
b™_u£
);

1007 
	`»pÜt_log
(
p_Vid
, 
p_IÅ
, 
p_Sts
);

1009 ià(
p_IÅ
->
R•ÜtF¿meSts
)

1011 ià((
p_Vid
->
p_log
 = 
	`fÝ’
("¡©_äame.d©", "a")è=ð
NULL
)

1013 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "stat_frame.dat.dat");

1018 
	`årštf
(
p_Vid
->
p_log
," --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

1019 
	`fþo£
(
p_Vid
->
p_log
);

1021 
	`»pÜt_log_mode
(
p_Vid
, 
p_IÅ
, 
p_Sts
);

1023 
	}
}

1036 
	$šfÜm©iÚ_š™
 ( 
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
)

1038 
i
;

1039 cÚ¡ 
yuv_ty³s
[4][10] = {"YUV 4:0:0", "YUV 4:2:0", "YUV 4:2:2", "YUV 4:4:4"};

1040 
p_IÅ
->
V”bo£
)

1045 
	`´štf
("------------------------------- JM %4.4 %7.7 -------------------------------\n", 
VERSION
, 
EXT_VERSION
);

1048 
	`´štf
("--------------------------------------- JM %4.4 %7.7 ----------------------------------------\n", 
VERSION
, 
EXT_VERSION
);

1051 
	`´štf
("------------------------------------------ JM %4.4 %7.7 ------------------------------------------\n", 
VERSION
, 
EXT_VERSION
);

1055 
	`årštf
(
¡dout
, " IÅuˆYUV fž : % \n", 
p_IÅ
->
šput_fže1
.
âame
);

1056 #ià(
MVC_EXTENSION_ENABLE
)

1057 if(
p_IÅ
->
num_of_v›ws
==2)

1058 
	`årštf
(
¡dout
, " IÅuˆYUV fž2 : % \n", 
p_IÅ
->
šput_fže2
.
âame
);

1061 
	`årštf
(
¡dout
, " OuuˆH.264 b™¡»am : % \n", 
p_IÅ
->
outfže
);

1062 ià(
p_Vid
->
p_dec
 != -1)

1063 
	`årštf
(
¡dout
, " OuuˆYUV fž : % \n", 
p_IÅ
->
RecÚFže
);

1064 #ià(
MVC_EXTENSION_ENABLE
)

1065 if(
p_IÅ
->
num_of_v›ws
==2)

1067 ià(
p_Vid
->
p_dec2
 != -1)

1068 
	`årštf
(
¡dout
, " OuuˆYUV fž2 : % \n", 
p_IÅ
->
RecÚFže2
);

1071 
	`årštf
(
¡dout
, " YUV FÜm© : % \n", &
yuv_ty³s
[
p_Vid
->
yuv_fÜm©
][0]);

1072 
	`årštf
(
¡dout
, " F¿me tØb’coded : %d\n", 
p_IÅ
->
no_äames
);

1073 ià(
p_IÅ
->
V”bo£
 != 0)

1075 
	`årštf
(
¡dout
, " F»q. fÜƒncoded b™¡»am : %3.2f\n", 
p_IÅ
->
ouut
.
äame_¿‹
);

1076 
	`årštf
(
¡dout
, " PicIÁ”Ïû / MbIÁ”Ïû : %d/%d\n", 
p_IÅ
->
PicIÁ”Ïû
,…_IÅ->
MbIÁ”Ïû
);

1077 
	`årštf
(
¡dout
, " T¿nsfÜm8x8Mod : %d\n", 
p_IÅ
->
T¿nsfÜm8x8Mode
);

1079 
i
=0; i<3; i++)

1081 
	`årštf
(
¡dout
," ME M‘riøfÜ Refšem’ˆLev– %1d : %s\n", 
i
, 
Di¡ÜtiÚTy³
[
p_IÅ
->
MEE¼ÜM‘ric
[i]]);

1083 
	`årštf
(
¡dout
, " ModDecisiÚ M‘riø : %s\n", 
Di¡ÜtiÚTy³
[
p_IÅ
->
ModeDecisiÚM‘ric
]);

1085 ifÐ
p_IÅ
->
OnTheFlyF¿ùMCP
 )

1087 
	`årštf
(
¡dout
," On-the-æy iÁ”pÞ©iÚ mod : OTF_L%d\n", 
p_IÅ
->
OnTheFlyF¿ùMCP
 );

1090  
p_IÅ
->
ChromaMEEÇbË
 )

1093 
	`årštf
(
¡dout
," Motion Estimation for components : YCbCr\n");

1096 
	`årštf
(
¡dout
," Motion Estimation for components : Y\n");

1100 
	`årštf
(
¡dout
, " ImagfÜm© : %dx%d (%dx%d)\n", 
p_IÅ
->
ouut
.
width
[0],…_IÅ->ouut.
height
[0], 
p_Vid
->width,p_Vid->height);

1102 ià(
p_IÅ
->
šŒa_upd
)

1103 
	`årštf
(
¡dout
," Error„obustness : On\n");

1105 
	`årštf
(
¡dout
," Error„obustness : Off\n");

1106 
	`årštf
(
¡dout
, " S—rch„ªg : %d\n", 
p_IÅ
->
£¬ch_¿nge
[0]);

1107 #ià(
MVC_EXTENSION_ENABLE
)

1108 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

1110 
	`årštf
(
¡dout
, " S—rch„ªg(v›w 1è : %d\n", 
p_IÅ
->
£¬ch_¿nge
[1]);

1114 
	`årštf
(
¡dout
, " TÙ®‚umb” oà»ã»nû  : %d\n", 
p_IÅ
->
num_»f_äames_Üg
);

1115 
	`årštf
(
¡dout
, " Reã»nû fÜ P sliû  : %d\n", 
p_IÅ
->
P_Li¡0_»fs_Üg
[0] ?…_IÅ->P_Li¡0_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
);

1116 
	`årštf
(
¡dout
, " References for B slices (L0, L1) : %d, %d\n",

1117 
p_IÅ
->
B_Li¡0_»fs_Üg
[0] ?…_IÅ->B_Li¡0_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
,

1118 
p_IÅ
->
B_Li¡1_»fs_Üg
[0] ?…_IÅ->B_Li¡1_»fs_Üg[0] :…_IÅ->
num_»f_äames_Üg
);

1120 iàÐ
p_Vid
->
num_of_Ïy”s
 > 1 )

1122 
	`årštf
(
¡dout
, " V›w 1„ef fÜ P sliû  : %d\n", 
p_IÅ
->
P_Li¡0_»fs_Üg
[1] ?…_IÅ->P_Li¡0_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
);

1123 
	`årštf
(
¡dout
, " View 1„efs for B slices (L0, L1) : %d, %d\n",

1124 
p_IÅ
->
B_Li¡0_»fs_Üg
[1] ?…_IÅ->B_Li¡0_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
,

1125 
p_IÅ
->
B_Li¡1_»fs_Üg
[1] ?…_IÅ->B_Li¡1_»fs_Üg[1] :…_IÅ->
num_»f_äames_Üg
);

1129 
	`årštf
(
¡dout
, " Sequenceype :");

1130 ià(
p_Sts
->
Numb”BF¿mes
 > 0 && 
p_IÅ
->
H›¿rchiÿlCodšg
)

1132 
	`årštf
(
¡dout
, " Hierarchy (QP: I %d, P %d, B %d) \n",

1133 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],…_IÅ->qp[
B_SLICE
]);

1135 ià(
p_Sts
->
Numb”BF¿mes
 > 0)

1137 
£qty³
[80];

1138 
i
,
j
;

1140 
	`¡rýy
 (
£qty³
,"I");

1142 
j
=0; j < 2; j++)

1144 
i
=0; i < 
p_Sts
->
Numb”BF¿mes
; i++)

1146 ià(
p_IÅ
->
BRefPiùu»s
)

1147 
	`¡ºÿt
(
£qty³
,"-RB", 
	`imax
(0, (è(79 - 
	`¡¾’
(seqtype))));

1149 
	`¡ºÿt
(
£qty³
,"-B", 
	`imax
(0, (è(79 - 
	`¡¾’
(seqtype))));

1151 
	`¡ºÿt
(
£qty³
,"-P", 
	`imax
(0, (è(79 - 
	`¡¾’
(seqtype))));

1153 ià(
p_IÅ
->
BRefPiùu»s
)

1154 
	`årštf
(
¡dout
, " % (QP: I %d, P %d, RB %dè\n", 
£qty³
, 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
], 
	`iCl3
(0, 51,…_IÅ->qp[
B_SLICE
] +…_IÅ->
qpBRSOff£t
));

1156 
	`årštf
(
¡dout
, " % (QP: I %d, P %d, B %dè\n", 
£qty³
, 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],…_IÅ->qp[
B_SLICE
]);

1158 ià(
p_Sts
->
Numb”BF¿mes
 =ð0 && (
p_IÅ
->
šŒa_³riod
 =ð1 ||…_IÅ->
idr_³riod
 == 1))

1159 
	`årštf
(
¡dout
, " IIII (QP: I %dè\n", 
p_IÅ
->
qp
[
I_SLICE
]);

1160 ià(
p_Sts
->
Numb”BF¿mes
 =ð0 && 
p_IÅ
->
¥_³riodic™y
 == 0)

1161 
	`årštf
(
¡dout
, " IPPP (QP: I %d, P %dè\n", 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
]);

1163 
	`årštf
(
¡dout
, " I-P-P-SP-P (QP: I %d, P %d, SP (%d, %d)è\n", 
p_IÅ
->
qp
[
I_SLICE
],…_IÅ->qp[
P_SLICE
],…_IÅ->qp[
SP_SLICE
],…_IÅ->
qp¥
);

1166 ià(
p_IÅ
->
symbÞ_mode
 =ð
CAVLC
)

1167 
	`årštf
(
¡dout
," Entropy coding method : CAVLC\n");

1169 
	`årštf
(
¡dout
," Entropy coding method : CABAC\n");

1171 
	`årštf
(
¡dout
, " Profže/Lev– IDC : (%d,%d)\n", 
p_IÅ
->
ProfžeIDC
,…_IÅ->
Lev–IDC
);

1173 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX
)

1174 
	`årštf
(
¡dout
, " Motion Estimation Scheme : HEX\n");

1175 ià(
p_IÅ
->
S—rchMode
[0] =ð
UM_HEX_SIMPLE
)

1176 
	`årštf
(
¡dout
, " Motion Estimation Scheme : SHEX\n");

1177 ià(
p_IÅ
->
S—rchMode
[0] =ð
EPZS
)

1179 
	`årštf
(
¡dout
, " Motion Estimation Scheme : EPZS\n");

1180 
	`EPZSOuutSts
(
p_IÅ
, 
¡dout
, 0);

1182 ià(
p_IÅ
->
S—rchMode
[0] =ð
FAST_FULL_SEARCH
)

1183 
	`årštf
(
¡dout
, " Motion Estimation Scheme : Fast Full Search\n");

1185 
	`årštf
(
¡dout
, " Motion Estimation Scheme : Full Search\n");

1187 #ià(
MVC_EXTENSION_ENABLE
)

1188 iàÐ
p_IÅ
->
S•V›wIÁ”S—rch
 )

1190 ià(
p_IÅ
->
S—rchMode
[1] =ð
UM_HEX
)

1191 
	`årštf
(
¡dout
, " Motion Estimation Scheme : HEX\n");

1192 ià(
p_IÅ
->
S—rchMode
[1] =ð
UM_HEX_SIMPLE
)

1193 
	`årštf
(
¡dout
, " Motion Estimation Scheme : SHEX\n");

1194 ià(
p_IÅ
->
S—rchMode
[1] =ð
EPZS
)

1196 
	`årštf
(
¡dout
, " Motion Estimation Scheme : EPZS\n");

1197 
	`EPZSOuutSts
(
p_IÅ
, 
¡dout
, 0);

1199 ià(
p_IÅ
->
S—rchMode
[1] =ð
FAST_FULL_SEARCH
)

1200 
	`årštf
(
¡dout
, " Motion Estimation Scheme : Fast Full Search\n");

1202 
	`årštf
(
¡dout
, " Motion Estimation Scheme : Full Search\n");

1206 ià(
p_IÅ
->
fuÎ_£¬ch
 == 2)

1207 
	`årštf
(
¡dout
," Search„ange„estrictions :‚one\n");

1208 ià(
p_IÅ
->
fuÎ_£¬ch
 == 1)

1209 
	`årštf
(
¡dout
," Search„ange„estrictions : older„eference frames\n");

1211 
	`årštf
(
¡dout
," Search„ange„estrictions : smaller blocks‡nd older„eference frames\n");

1213 ià(
p_IÅ
->
rdÝt
)

1214 
	`årštf
(
¡dout
," RD-optimized mode decision : used\n");

1216 
	`årštf
(
¡dout
," RD-optimized mode decision :‚ot used\n");

1218 
p_IÅ
->
·¹™iÚ_mode
)

1220 
PAR_DP_1
:

1221 
	`årštf
(
¡dout
," Data Partitioning Mode : 1…artition \n");

1223 
PAR_DP_3
:

1224 
	`årštf
(
¡dout
," Data Partitioning Mode : 3…artitions \n");

1227 
	`årštf
(
¡dout
," Data Partitioning Mode :‚ot supported\n");

1231 
p_IÅ
->
of_mode
)

1233 
PAR_OF_ANNEXB
:

1234 
	`årštf
(
¡dout
," Output File Format : H.264/AVC Annex B Byte Stream Format \n");

1236 
PAR_OF_RTP
:

1237 
	`årštf
(
¡dout
," Output File Format : RTP Packet File Format \n");

1240 
	`årštf
(
¡dout
," Output File Format :‚ot supported\n");

1246 
p_IÅ
->
V”bo£
)

1250 
	`´štf
("-------------------------------------------------------------------------------\n");

1251 
	`´štf
("\nEncoding. Please Wait.\n\n");

1254 #ià(
MVC_EXTENSION_ENABLE
)

1255 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1257 
	`´štf
("------------------------------------------------------------------------------------\n");

1258 
	`´štf
("Frame View Bit/pic QP SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld Ref \n");

1259 
	`´štf
("------------------------------------------------------------------------------------\n");

1264 
	`´štf
("-------------------------------------------------------------------------------\n");

1265 
	`´štf
("Frame Bit/pic QP SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld Ref \n");

1266 
	`´štf
("-------------------------------------------------------------------------------\n");

1270 #ià(
MVC_EXTENSION_ENABLE
)

1271 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1273 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1275 
	`´štf
("----------------------------------------------------------------------------------------------------------------------------------\n");

1276 
	`´štf
("Frame View Bit/pic WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1277 
	`´štf
("----------------------------------------------------------------------------------------------------------------------------------\n");

1281 
	`´štf
("---------------------------------------------------------------------------------------------------------\n");

1282 
	`´štf
("Frame View Bit/pic WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1283 
	`´štf
("---------------------------------------------------------------------------------------------------------\n");

1289 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1291 
	`´štf
("---------------------------------------------------------------------------------------------------------------------------\n");

1292 
	`´štf
("Frame Bit/pic WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1293 
	`´štf
("---------------------------------------------------------------------------------------------------------------------------\n");

1297 
	`´štf
("---------------------------------------------------------------------------------------------------\n");

1298 
	`´štf
("Frame Bit/pic WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1299 
	`´štf
("---------------------------------------------------------------------------------------------------\n");

1304 #ià(
MVC_EXTENSION_ENABLE
)

1305 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1307 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1309 
	`´štf
("---------------------------------------------------------------------------------------------------------------------------------------\n");

1310 
	`´štf
("Frame View Bit/pic NVB WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1311 
	`´štf
("---------------------------------------------------------------------------------------------------------------------------------------\n");

1315 
	`´štf
("---------------------------------------------------------------------------------------------------------------\n");

1316 
	`´štf
("Frame View Bit/pic NVB WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1317 
	`´štf
("---------------------------------------------------------------------------------------------------------------\n");

1323 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1325 
	`´štf
("--------------------------------------------------------------------------------------------------------------------------------\n");

1326 
	`´štf
("Frame Bit/pic NVB WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1327 
	`´štf
("--------------------------------------------------------------------------------------------------------------------------------\n");

1331 
	`´štf
("--------------------------------------------------------------------------------------------------------\n");

1332 
	`´štf
("Frame Bit/pic NVB WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1333 
	`´štf
("--------------------------------------------------------------------------------------------------------\n");

1338 #ià(
MVC_EXTENSION_ENABLE
)

1339 ià(
p_IÅ
->
num_of_v›ws
 == 2)

1341 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1343 
	`´štf
("-------------------------------------------------------------------------------------------------------------------------------------------------\n");

1344 
	`´štf
("Frame View Bit/pic Filler NVB WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1345 
	`´štf
("-------------------------------------------------------------------------------------------------------------------------------------------------\n");

1349 
	`´štf
("-------------------------------------------------------------------------------------------------------------------------\n");

1350 
	`´štf
("Frame View Bit/pic Filler NVB WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1351 
	`´štf
("-------------------------------------------------------------------------------------------------------------------------\n");

1357 ià(
p_IÅ
->
Di¡ÜtiÚ
[
SSIM
] == 1)

1359 
	`´štf
("------------------------------------------------------------------------------------------------------------------------------------------\n");

1360 
	`´štf
("Frame Bit/pic Filler NVB WP QP QL SnrY SnrU SnrV SsimY SsimU SsimV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1361 
	`´štf
("------------------------------------------------------------------------------------------------------------------------------------------\n");

1365 
	`´štf
("------------------------------------------------------------------------------------------------------------------\n");

1366 
	`´štf
("Frame Bit/pic Filler NVB WP QP QL SnrY SnrU SnrV Time(ms) MET(ms) Frm/Fld I D L0 L1 RDP Ref\n");

1367 
	`´štf
("------------------------------------------------------------------------------------------------------------------\n");

1372 
	}
}

1380 
	$»pÜt_log_mode
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
StP¬am‘”s
 *
p_Sts
)

1382 
FILE
 *
p_¡©
;

1383 
i
;

1384 
Çme
[40];

1385 #iâdeà
WIN32


1386 
time_t
 
now
;

1387 
tm
 *
l_time
;

1388 
¡ršg
[1000];

1390 
timebuf
[128];

1393 ià((
p_¡©
 = 
	`fÝ’
("log_mode.dat", "r")) == 0)

1395 ià((
p_¡©
 = 
	`fÝ’
("log_mode.d©", "a")è=ð
NULL
)

1397 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "log_mode.dat");

1398 
	`”rÜ
(
”rÜ‹xt
, 500);

1402 
	`årštf
(
p_¡©
, " ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

1403 
	`årštf
(
p_¡©
,"| Encoder statistics. This file is generated during firstƒncoding session,‚ew sessions will be‡ppended |\n");

1404 
	`årštf
(
p_¡©
, " ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

1405 
	`årštf
(
p_¡©
, "| ver | Date | Time | Sequence | QP | I4 | I8 | I16 | IC0 | IC1 | IC2 | IC3 | PI4 | PI8 | PI16 | P0 | P1 | P2 | P3 | P1*4*| P1*8*| P2*4*| P2*8*| P3*4*| P3*8*| P8 | P8:4 | P4*4*| P4*8*| P8:5 | P8:6 | P8:7 | BI4 | BI8 | BI16 | B0 | B1 | B2 | B3 | B0*4*| B0*8*| B1*4*| B1*8*| B2*4*| B2*8*| B3*4*| B3*8*| B8 | B8:0 |B80*4*|B80*8*| B8:4 | B4*4*| B4*8*| B8:5 | B8:6 | B8:7 |\n");

1406 
	`årštf
(
p_¡©
, " ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- \n");

1411 
	`fþo£
 (
p_¡©
);

1412 ià((
p_¡©
 = 
	`fÝ’
("log_mode.d©", "a")è=ð
NULL
)

1414 
	`¢´štf
(
”rÜ‹xt
, 
ET_SIZE
, "Error open file %s \n", "log_mode.dat");

1415 
	`”rÜ
(
”rÜ‹xt
, 500);

1420 
	`årštf
(
p_¡©
, "|%4s/%s", 
VERSION
, 
EXT_VERSION
);

1422 #ifdeà
WIN32


1423 
	`_¡rd©e
Ð
timebuf
 );

1424 
	`årštf
(
p_¡©
, "| %1.5 |", 
timebuf
);

1426 
	`_¡¹ime
Ð
timebuf
);

1427 
	`årštf
(
p_¡©
, " % 1.5 |", 
timebuf
);

1429 
now
 = 
	`time
 ((
time_t
 *è
NULL
);

1430 
	`time
 (&
now
);

1431 
l_time
 = 
	`loÿÉime
 (&
now
);

1432 
	`¡ráime
 (
¡ršg
,  sŒšg, "%d-%b-%Y", 
l_time
);

1433 
	`årštf
(
p_¡©
, "| %1.5 |", 
¡ršg
 );

1435 
	`¡ráime
 (
¡ršg
,  sŒšg, "%H:%M:%S", 
l_time
);

1436 
	`årštf
(
p_¡©
, " %1.5 |", 
¡ršg
);

1439 
i
=0;i<30;i++)

1440 
Çme
[
i
]=
p_IÅ
->
šput_fže1
.
âame
[˜+ 
	`imax
(0,(è(
	`¡¾’
(p_Inp->input_file1.fname)- 30))];

1442 
	`årštf
(
p_¡©
, "%30.30s|", 
Çme
);

1443 
	`årštf
(
p_¡©
, "%3d |", 
p_Vid
->
qp
);

1447 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
I_SLICE
][
I4MB
 ]);

1448 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
I_SLICE
][
I8MB
 ]);

1449 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
I_SLICE
][
I16MB
]);

1452 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
šŒa_chroma_mode
[0]);

1453 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
šŒa_chroma_mode
[1]);

1454 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
šŒa_chroma_mode
[2]);

1455 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
šŒa_chroma_mode
[3]);

1458 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][
I4MB
 ]);

1459 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][
I8MB
 ]);

1460 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][
I16MB
]);

1461 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][0 ]);

1463 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][1 ]);

1464 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][2 ]);

1465 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][3 ]);

1467 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][1][0]);

1468 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][1][1]);

1469 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][2][0]);

1470 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][2][1]);

1471 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][3][0]);

1472 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][3][1]);

1474 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][
P8x8
 ]);

1475 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][4 ]);

1476 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][4][0]);

1477 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
P_SLICE
][4][1]);

1478 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][5 ]);

1479 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][6 ]);

1480 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
P_SLICE
][7 ]);

1483 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][
I4MB
 ]);

1484 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][
I8MB
 ]);

1485 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][
I16MB
]);

1486 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][0 ]);

1487 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][1 ]);

1488 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][2 ]);

1489 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][3 ]);

1490 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][0][0]);

1491 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][0][1]);

1492 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][1][0]);

1493 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][1][1]);

1494 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][2][0]);

1495 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][2][1]);

1496 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][3][0]);

1497 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][3][1]);

1499 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][
P8x8
]);

1500 
	`årštf
(
p_¡©
, " %d|", (
p_Sts
->
b8_mode_0_u£
 [
B_SLICE
][0]+p_Stats->b8_mode_0_use [B_SLICE][1]));

1501 
	`årštf
(
p_¡©
, " %5d|", 
p_Sts
->
b8_mode_0_u£
 [
B_SLICE
][0]);

1502 
	`årštf
(
p_¡©
, " %5d|", 
p_Sts
->
b8_mode_0_u£
 [
B_SLICE
][1]);

1503 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][4 ]);

1504 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][4][0]);

1505 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£_ŒªsfÜm
[
B_SLICE
][4][1]);

1506 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][5 ]);

1507 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][6 ]);

1508 
	`årštf
(
p_¡©
, " %5" 
FORMAT_OFF_T
 "|", 
p_Sts
->
mode_u£
[
B_SLICE
][7 ]);

1510 
	`årštf
(
p_¡©
, "\n");

1511 
	`fþo£
(
p_¡©
);

1512 
	}
}

	@lencod/src/rtp.c

14 #ifdeà
WIN32


15 
	~<Wšsock2.h
>

17 
	~<Ãtš‘/š.h
>

20 
	~"glob®.h
"

21 
	~"¹p.h
"

22 
	~"£i.h
"

25 #ià
TRACE


26 
	#SYMTRACESTRING
(
s
è
	`¡ºýy
(
sym
.
Œaû¡ršg
,s,
TRACESTRING_SIZE
)

	)

28 
	#SYMTRACESTRING
(
s
)

30 

	)

60 
	$Compo£RTPPack‘
 (
RTP·ck‘_t
 *
p
)

63 
‹mp32
;

64 
ušt16
 
‹mp16
;

67 
	`as£¹
 (
p
->
v
 == 2);

68 
	`as£¹
 (
p
->p == 0);

69 
	`as£¹
 (
p
->
x
 == 0);

70 
	`as£¹
 (
p
->
cc
 == 0);

71 
	`as£¹
 (
p
->
m
 == 0 ||…->m == 1);

72 
	`as£¹
 (
p
->
±
 < 128);

73 
	`as£¹
 (
p
->
·ylßd
 !ð
NULL
);

74 
	`as£¹
 (
p
->
·yËn
 < 65536 - 40);

75 
	`as£¹
 (
p
->
·ck‘
 !ð
NULL
);

79 
p
->
·ck‘
[0] = (
by‹
)

80 Ð((
p
->
v
 & 0x03) << 6)

81 | ((
p
->p & 0x01) << 5)

82 | ((
p
->
x
 & 0x01) << 4)

83 | ((
p
->
cc
 & 0x0F) << 0) );

85 
p
->
·ck‘
[1] = (
by‹
)

86 Ð((
p
->
m
 & 0x01) << 7)

87 | ((
p
->
±
 & 0x7F) << 0) );

90 
‹mp16
 = 
	`htÚs
((
ušt16
)
p
->
£q
);

91 
	`memýy
 (&
p
->
·ck‘
[2], &
‹mp16
, 2);

94 
‹mp32
 = 
	`htÚl
(
p
->
time¡amp
);

95 
	`memýy
 (&
p
->
·ck‘
[4], &
‹mp32
, 4);

97 
‹mp32
 = 
	`htÚl
(
p
->
s¤c
);

98 
	`memýy
 (&
p
->
·ck‘
[8], &
‹mp32
, 4);

102 
	`memýy
 (&
p
->
·ck‘
[12],…->
·ylßd
,…->
·yËn
);

103 
p
->
·ckËn
 =…->
·yËn
+12;

105 
	}
}

131 
	$Wr™eRTPPack‘
 (
RTP·ck‘_t
 *
p
, 
FILE
 *
f
)

134 
štime
 = -1;

136 
	`as£¹
 (
f
 !ð
NULL
);

137 
	`as£¹
 (
p
 !ð
NULL
);

140 ià(1 !ð
	`fwr™e
 (&
p
->
·ckËn
, 4, 1, 
f
))

142 ià(1 !ð
	`fwr™e
 (&
štime
, 4, 1, 
f
))

144 ià(1 !ð
	`fwr™e
 (
p
->
·ck‘
,…->
·ckËn
, 1, 
f
))

147 
	}
}

173 
	$Wr™eRTPNALU
 (
VideoP¬am‘”s
 *
p_Vid
, 
NALU_t
 *
n
, 
FILE
 **
f_¹p
)

175 
RTP·ck‘_t
 *
p
;

177 
by‹
 
fœ¡_by‹
;

179 
	`as£¹
 ((*
f_¹p
è!ð
NULL
);

180 
	`as£¹
 (
n
 !ð
NULL
);

181 
	`as£¹
 (
n
->
Ën
 < 65000);

183 
fœ¡_by‹
 = (
by‹
)

184 (
n
->
fÜbidd’_b™
 << 7 |

185 
n
->
Çl_»ã»nû_idc
 << 5 |

186 
n
->
Çl_un™_ty³
 );

189 ià((
p
 = (
RTP·ck‘_t
 *è
	`m®loc
 ( (RTP·ck‘_t))è=ð
NULL
)

190 
	`no_mem_ex™
 ("RTPWriteNALU-1");

191 ià((
p
->
·ck‘
 = 
	`m®loc
 (
MAXRTPPACKETSIZE
)è=ð
NULL
)

192 
	`no_mem_ex™
 ("RTPWriteNALU-2");

193 ià((
p
->
·ylßd
 = 
	`m®loc
 (
MAXRTPPACKETSIZE
)è=ð
NULL
)

194 
	`no_mem_ex™
 ("RTPWriteNALU-3");

196 
p
->
v
=2;

197 
p
->p=0;

198 
p
->
x
=0;

199 
p
->
cc
=0;

200 
p
->
m
=(
n
->
¡¬tcod•»fix_Ën
==4)&1;

206 
p
->
±
=
H264PAYLOADTYPE
;

207 
p
->
£q
 = 
p_Vid
->
Cu¼’tRTPSequ’ûNumb”
++;

208 
p
->
time¡amp
 = 
p_Vid
->
Cu¼’tRTPTime¡amp
;

209 
p
->
s¤c
=
H264SSRC
;

210 
p
->
·yËn
 = 1 + 
n
->
Ën
;

212 
p
->
·ylßd
[0] = 
fœ¡_by‹
;

213 
	`memýy
 (
p
->
·ylßd
+1, 
n
->
buf
,‚->
Ën
);

216 ià(
	`Compo£RTPPack‘
 (
p
) < 0)

218 
	`´štf
 ("Cannot compose RTP…acket,ƒxit\n");

219 
	`ex™
 (-1);

221 ià(
	`Wr™eRTPPack‘
 (
p
, *
f_¹p
) < 0)

223 
	`´štf
 ("CªnÙ wr™%d by‹ oàRTP…ack‘Øoutfže,ƒx™\n", 
p
->
·ckËn
);

224 
	`ex™
 (-1);

226 
	`ä“
 (
p
->
·ck‘
);

227 
	`ä“
 (
p
->
·ylßd
);

228 
	`ä“
 (
p
);

229  (
n
->
Ën
 * 8);

230 
	}
}

250 
	$RTPUpd©eTime¡amp
 (
VideoP¬am‘”s
 *
p_Vid
, 
Œ
)

252 
d–
;

253 
ÞdŒ
 = -1;

255 ià(
ÞdŒ
 == -1)

257 
p_Vid
->
Cu¼’tRTPTime¡amp
 = 0;

259 
ÞdŒ
 = 0;

273 
d–
 = 
Œ
 - 
ÞdŒ
;

275 ià(
d–
 < -10)

276 
d–
+=256;

278 
p_Vid
->
Cu¼’tRTPTime¡amp
 +ð
d–
 * 
RTP_TR_TIMESTAMP_MULT
;

279 
ÞdŒ
 = 
Œ
;

280 
	}
}

299 
	$O³nRTPFže
 (*
Fž’ame
, 
FILE
 **
f_¹p
)

301 ià(((*
f_¹p
èð
	`fÝ’
 (
Fž’ame
, "wb")è=ð
NULL
)

303 
	`´štf
 ("F©®: cªnÙ o³Àb™¡»am fž'%s',ƒx™ (-1)\n", 
Fž’ame
);

304 
	`ex™
 (-1);

306 
	}
}

320 
	$Clo£RTPFže
 (
FILE
 *
f_¹p
)

322 
	`fþo£
(
f_¹p
);

323 
	}
}

	@lencod/src/sei.c

15 
	~"glob®.h
"

16 
	~"mem®loc.h
"

17 
	~"¹p.h
"

18 
	~"mbufãr.h
"

19 
	~"£i.h
"

20 
	~"vlc.h
"

21 
	~"h—d”.h
"

23 
In™RªdomAcûss
 (
SEIP¬am‘”s
 *
p_SEI
);

24 
Clo£RªdomAcûss
 (
SEIP¬am‘”s
 *
p_SEI
);

25 
In™TÚeM­pšg
 (
SEIP¬am‘”s
 *
p_SEI
, 
IÅutP¬am‘”s
 *
p_IÅ
);

26 
Clo£TÚeM­pšg
 (
SEIP¬am‘”s
 *
p_SEI
);

27 
Clo£BufãršgP”iod
 (
SEIP¬am‘”s
 *
p_SEI
);

28 
In™PicTimšg
 (
SEIP¬am‘”s
 *
p_SEI
);

29 
Clo£PicTimšg
 (
SEIP¬am‘”s
 *
p_SEI
);

30 
In™DRPMR•‘™iÚ
 (
SEIP¬am‘”s
 *
p_SEI
);

31 
Clo£DRPMR•‘™iÚ
 (
SEIP¬am‘”s
 *
p_SEI
);

32 
Fš®izeDRPMR•‘™iÚ
 (
VideoP¬am‘”s
 *
p_Vid
);

33 
In™S·»Piùu»
 (
SEIP¬am‘”s
 *
p_SEI
);

34 
Clo£S·»Piùu»
 (
SEIP¬am‘”s
 *
p_SEI
);

35 
Fš®izeS·»MBM­
 (
VideoP¬am‘”s
 *
p_Vid
);

36 
In™Sub£qCh¬
 (
VideoP¬am‘”s
 *
p_Vid
);

37 
CË¬Sub£qCh¬Paylßd
 (
SEIP¬am‘”s
 *
p_SEI
);

38 
Clo£Sub£qCh¬
 (
SEIP¬am‘”s
 *
p_SEI
);

39 
In™Sub£qLay”Info
 (
SEIP¬am‘”s
 *
p_SEI
);

40 
In™PªSÿnReùInfo
 (
SEIP¬am‘”s
 *
p_SEI
);

41 
Clo£PªSÿnReùInfo
 (
SEIP¬am‘”s
 *
p_SEI
);

42 
In™U£r_d©a_uÄegi¡”ed
 (
SEIP¬am‘”s
 *
p_SEI
);

43 
In™U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
);

44 
CË¬U£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
);

45 
Clo£U£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
);

46 
CË¬U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
);

47 
Clo£U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
);

48 
In™Po¡Fž‹rHšts
 (
SEIP¬am‘”s
 *
p_SEI
);

49 
CË¬Po¡Fž‹rHšts
 (
SEIP¬am‘”s
 *
p_SEI
);

50 
Clo£Po¡Fž‹rHšts
 (
SEIP¬am‘”s
 *
p_SEI
);

51 
In™F¿mePackšgA¼ªgem’t
(
VideoP¬am‘”s
 *
p_Vid
);

52 
Clo£F¿mePackšgA¼ªgem’t
(
SEIP¬am‘”s
 *
p_SEI
);

54 
	$š™_£i
(
SEIP¬am‘”s
 *
p_SEI
)

56 
p_SEI
->
£iHasTempÜ®_»ã»nû
=
FALSE
;

57 
p_SEI
->
£iHasClock_time¡amp
=
FALSE
;

58 
p_SEI
->
£iHasPªsÿn_»ù
=
FALSE
;

59 
p_SEI
->
£iHasHrd_piùu»
=
FALSE
;

60 
p_SEI
->
£iHasFžËr_·ylßd
=
FALSE
;

61 
p_SEI
->
£iHasU£r_d©a_»gi¡”ed_™u_t_t35
=
FALSE
;

62 
p_SEI
->
£iHasU£r_d©a_uÄegi¡”ed
=
FALSE
;

63 
p_SEI
->
£iHasRecov”yPošt_šfo
=
FALSE
;

64 
p_SEI
->
£iHasRef_pic_bufãr_mªagem’t_»³t™iÚ
=
FALSE
;

65 
p_SEI
->
£iHasS·»_piùu»
=
FALSE
;

66 
p_SEI
->
£iHasBufãršgP”iod_šfo
=
FALSE
;

67 
p_SEI
->
£iHasPicTimšg_šfo
=
FALSE
;

68 
p_SEI
->
£iHasSûÃInfÜm©iÚ
=
FALSE
;

69 
p_SEI
->
£iHasSub£q_šfÜm©iÚ
=
FALSE
;

70 
p_SEI
->
£iHasSub£q_Ïy”_ch¬aù”i¡ics
=
FALSE
;

71 
p_SEI
->
£iHasSub£q_ch¬aù”i¡ics
=
FALSE
;

72 
p_SEI
->
£iHasTÚe_m­pšg
=
FALSE
;

73 
p_SEI
->
£iHasPo¡Fž‹rHšts_šfo
=
FALSE
;

74 
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
=
FALSE
;

75 
p_SEI
->
£iHasS·»Piùu»
 = 
FALSE
;

76 
p_SEI
->
£iHasSub£qCh¬
 = 
FALSE
;

77 
p_SEI
->
£iHasSub£qInfo
 = 
FALSE
;

78 
p_SEI
->
£iHasSub£qLay”Info
 = 
FALSE
;

79 
p_SEI
->
£iHasPªSÿnReùInfo
 = 
FALSE
;

80 
	}
}

89 
	$In™SEIMes§ges
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

91 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

92 
i
;

93 
i
=0; i<2; i++)

95 
p_SEI
->
£i_mes§ge
[
i
].
d©a
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

96 ifÐ
p_SEI
->
£i_mes§ge
[
i
].
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSEIMessages: sei_message[i].data");

97 
p_SEI
->
£i_mes§ge
[
i
].
subPack‘Ty³
 = 
SEI_PACKET_TYPE
;

98 
	`þ—r_£i_mes§ge
(
p_SEI
, 
i
);

102 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 = 
NULL
;

103 
	`In™S·»Piùu»
(
p_SEI
);

104 ià(
p_IÅ
->
NumF¿mesInELSubSeq
 != 0)

106 
	`In™Sub£qLay”Info
(
p_SEI
);

107 
	`In™Sub£qCh¬
(
p_Vid
);

109 
	`In™SûÃInfÜm©iÚ
(
p_SEI
);

111 
	`In™PªSÿnReùInfo
(
p_SEI
);

113 
	`In™U£r_d©a_uÄegi¡”ed
(
p_SEI
);

115 
	`In™U£r_d©a_»gi¡”ed_™u_t_t35
(
p_SEI
);

117 
	`In™RªdomAcûss
(
p_SEI
);

119 
	`In™TÚeM­pšg
(
p_SEI
, 
p_IÅ
);

121 
	`In™Po¡Fž‹rHšts
(
p_SEI
);

123 
	`In™BufãršgP”iod
(
p_Vid
);

125 
	`In™PicTimšg
(
p_SEI
);

127 
	`In™DRPMR•‘™iÚ
(
p_SEI
);

129 
	`In™F¿mePackšgA¼ªgem’t
(
p_Vid
);

130 
	}
}

132 
	$Clo£SEIMes§ges
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

134 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

135 
i
;

137 ià(
p_IÅ
->
NumF¿mesInELSubSeq
 != 0)

138 
	`Clo£Sub£qLay”Info
();

140 
	`Clo£Sub£qCh¬
(
p_SEI
);

141 
	`Clo£S·»Piùu»
(
p_SEI
);

142 
	`Clo£SûÃInfÜm©iÚ
(
p_SEI
);

143 
	`Clo£PªSÿnReùInfo
(
p_SEI
);

144 
	`Clo£U£r_d©a_uÄegi¡”ed
(
p_SEI
);

145 
	`Clo£U£r_d©a_»gi¡”ed_™u_t_t35
(
p_SEI
);

146 
	`Clo£RªdomAcûss
(
p_SEI
);

147 
	`Clo£TÚeM­pšg
(
p_SEI
);

148 
	`Clo£Po¡Fž‹rHšts
(
p_SEI
);

149 
	`Clo£BufãršgP”iod
(
p_SEI
);

150 
	`Clo£PicTimšg
(
p_SEI
);

151 
	`Clo£DRPMR•‘™iÚ
(
p_SEI
);

152 
	`Clo£F¿mePackšgA¼ªgem’t
(
p_SEI
);

154 
i
=0; i<
MAX_LAYER_NUMBER
; i++)

156 iàÐ
p_SEI
->
£i_mes§ge
[
i
].
d©a
 )

157 
	`ä“
Ð
p_SEI
->
£i_mes§ge
[
i
].
d©a
 );

158 
p_SEI
->
£i_mes§ge
[
i
].
d©a
 = 
NULL
;

160 
	}
}

162 
BoÞ—n
 
	$HaveAgg»g©iÚSEI
(
VideoP¬am‘”s
 *
p_Vid
)

164 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

165 ià(
p_SEI
->
£i_mes§ge
[
AGGREGATION_SEI
].
avažabË
 && 
p_Vid
->
ty³
 !ð
B_SLICE
)

166  
TRUE
;

167 ià(
p_SEI
->
£iHasSub£qInfo
)

168  
TRUE
;

169 ià(
p_SEI
->
£iHasSub£qLay”Info
 && 
p_Vid
->
numb”
 == 0)

170  
TRUE
;

171 ià(
p_SEI
->
£iHasSub£qCh¬
)

172  
TRUE
;

173 ià(
p_SEI
->
£iHasSûÃInfÜm©iÚ
)

174  
TRUE
;

175 ià(
p_SEI
->
£iHasPªSÿnReùInfo
)

176  
TRUE
;

177 ià(
p_SEI
->
£iHasU£r_d©a_uÄegi¡”ed_šfo
)

178  
TRUE
;

179 ià(
p_SEI
->
£iHasU£r_d©a_»gi¡”ed_™u_t_t35_šfo
)

180  
TRUE
;

181 ià(
p_SEI
->
£iHasRecov”yPošt_šfo
)

182  
TRUE
;

183 ià(
p_SEI
->
£iHasTÚe_m­pšg
)

184  
TRUE
;

185 ià(
p_SEI
->
£iHasPo¡Fž‹rHšts_šfo
)

186  
TRUE
;

187 ià(
p_SEI
->
£iHasBufãršgP”iod_šfo
)

188  
TRUE
;

189 ià(
p_SEI
->
£iHasPicTimšg_šfo
)

190  
TRUE
;

191 ià(
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
)

192  
TRUE
;

194  
FALSE
;

197 
	}
}

219 
	$wr™e_£i_mes§ge
(
SEIP¬am‘”s
 *
p_SEI
, 
id
, 
by‹
* 
·ylßd
, 
·ylßd_size
, 
·ylßd_ty³
)

221 
off£t
, 
ty³
, 
size
;

222 
	`as£¹
(
·ylßd_ty³
 >ð0 &&…aylßd_ty³ < 
SEI_MAX_ELEMENTS
);

224 
ty³
 = 
·ylßd_ty³
;

225 
size
 = 
·ylßd_size
;

226 
off£t
 = 
p_SEI
->
£i_mes§ge
[
id
].
·ylßdSize
;

228  
ty³
 > 254 )

230 
p_SEI
->
£i_mes§ge
[
id
].
d©a
[
off£t
++] = 0xFF;

231 
ty³
 =ype - 255;

233 
p_SEI
->
£i_mes§ge
[
id
].
d©a
[
off£t
++] = (
by‹
è
ty³
;

235  
size
 > 254 )

237 
p_SEI
->
£i_mes§ge
[
id
].
d©a
[
off£t
++] = 0xFF;

238 
size
 = size - 255;

240 
p_SEI
->
£i_mes§ge
[
id
].
d©a
[
off£t
++] = (
by‹
è
size
;

242 
	`memýy
(
p_SEI
->
£i_mes§ge
[
id
].
d©a
 + 
off£t
, 
·ylßd
, 
·ylßd_size
);

243 
off£t
 +ð
·ylßd_size
;

245 
p_SEI
->
£i_mes§ge
[
id
].
·ylßdSize
 = 
off£t
;

246 
	}
}

261 
	$fš®ize_£i_mes§ge
(
SEIP¬am‘”s
 *
p_SEI
, 
id
)

263 
off£t
 = 
p_SEI
->
£i_mes§ge
[
id
].
·ylßdSize
;

265 
p_SEI
->
£i_mes§ge
[
id
].
d©a
[
off£t
] = 0x80;

266 
p_SEI
->
£i_mes§ge
[
id
].
·ylßdSize
++;

268 
p_SEI
->
£i_mes§ge
[
id
].
avažabË
 = 
TRUE
;

269 
	}
}

285 
	$þ—r_£i_mes§ge
(
SEIP¬am‘”s
 *
p_SEI
, 
id
)

287 
	`mem£t
Ð
p_SEI
->
£i_mes§ge
[
id
].
d©a
, 0, 
MAXRTPPAYLOADLEN
);

288 
p_SEI
->
£i_mes§ge
[
id
].
·ylßdSize
 = 0;

289 
p_SEI
->
£i_mes§ge
[
id
].
avažabË
 = 
FALSE
;

290 
	}
}

304 
	$Aµ’dTmpb™s2Buf
Ð
B™¡»am
* 
de¡
, B™¡»am* 
sourû
 )

306 
i
, 
j
;

307 
by‹
 
mask
;

308 
b™s_š_Ï¡_by‹
;

311 
i
=0; i<
sourû
->
by‹_pos
; i++)

313 
mask
 = 0x80;

314 
j
=0; j<8; j++)

316 
de¡
->
by‹_buf
 <<= 1;

317 ià(
sourû
->
¡»amBufãr
[
i
] & 
mask
)

318 
de¡
->
by‹_buf
 |= 1;

319 
de¡
->
b™s_to_go
--;

320 
mask
 >>= 1;

321 ià(
de¡
->
b™s_to_go
==0)

323 
de¡
->
b™s_to_go
 = 8;

324 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

325 
de¡
->
by‹_buf
 = 0;

330 
b™s_š_Ï¡_by‹
 = 8-
sourû
->
b™s_to_go
;

331 iàÐ
b™s_š_Ï¡_by‹
 > 0 )

333 
mask
 = (
by‹
è(1 << (
b™s_š_Ï¡_by‹
-1));

334 
j
=0; j<
b™s_š_Ï¡_by‹
; j++)

336 
de¡
->
by‹_buf
 <<= 1;

337 ià(
sourû
->
by‹_buf
 & 
mask
)

338 
de¡
->
by‹_buf
 |= 1;

339 
de¡
->
b™s_to_go
--;

340 
mask
 >>= 1;

341 ià(
de¡
->
b™s_to_go
==0)

343 
de¡
->
b™s_to_go
 = 8;

344 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

345 
de¡
->
by‹_buf
 = 0;

349 
	}
}

369 
	$In™S·»Piùu»
(
SEIP¬am‘”s
 *
p_SEI
)

371 iàÐ
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 !ð
NULL
 )

372 
	`Clo£S·»Piùu»
(
p_SEI
);

374 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

375 iàÐ
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSparePicture: seiSparePicturePayload.data");

376 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

377 iàÐ
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSparePicture: seiSparePicturePayload.data->streamBuffer");

378 
	`mem£t
Ð
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

379 
p_SEI
->
£iS·»Piùu»Paylßd
.
num_¥¬e_pics
 = 0;

380 
p_SEI
->
£iS·»Piùu»Paylßd
.
rg‘_äame_num
 = 0;

382 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
b™s_to_go
 = 8;

383 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
by‹_pos
 = 0;

384 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
by‹_buf
 = 0;

385 
	}
}

393 
	$Clo£S·»Piùu»
(
SEIP¬am‘”s
 *
p_SEI
)

395 ià(
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
)

396 
	`ä“
(
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
);

397 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
 = 
NULL
;

398 ià(
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
)

399 
	`ä“
(
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
);

400 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 = 
NULL
;

401 
p_SEI
->
£iS·»Piùu»Paylßd
.
num_¥¬e_pics
 = 0;

402 
p_SEI
->
£iS·»Piùu»Paylßd
.
rg‘_äame_num
 = 0;

403 
	}
}

416 
	$C®cuÏ‹S·»Piùu»
()

580 
	}
}

599 
	$Compo£S·»Piùu»Mes§ge
(
SEIP¬am‘”s
 *
p_SEI
, 
d–_¥¬e_äame_num
, 
»f_¬—_šdiÿtÜ
, 
B™¡»am
 *
tmpB™¡»am
)

601 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
;

602 
SyÁaxEËm’t
 
sym
;

604 
sym
.
ty³
 = 
SE_HEADER
;

605 
sym
.
m­pšg
 = 
ue_lšfo
;

607 
sym
.
v®ue1
 = 
d–_¥¬e_äame_num
;

608 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
b™¡»am
);

609 
sym
.
v®ue1
 = 
»f_¬—_šdiÿtÜ
;

610 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
b™¡»am
);

612 
	`Aµ’dTmpb™s2Buf
Ð
b™¡»am
, 
tmpB™¡»am
 );

613 
	}
}

631 
BoÞ—n
 
	$Com´essS·»MBM­
(
VideoP¬am‘”s
 *
p_Vid
, **
m­_¥
, 
B™¡»am
 *
b™¡»am
)

633 
j
, 
k
;

634 
noc
, 
b™0
, 
b™c
;

635 
SyÁaxEËm’t
 
sym
;

636 
x
, 
y
, 
Ëá
, 
right
, 
bÙtom
, 
tÝ
, 
dœeùx
, 
dœeùy
;

639 
size_uncom´es£d
 = (
p_Vid
->
height
 >> 4è* (p_Vid->
width
 >> 4);

640 
size_com´es£d
 = 0;

641 
BoÞ—n
 
»t
;

644 
sym
.
ty³
 = 
SE_HEADER
;

645 
sym
.
m­pšg
 = 
ue_lšfo
;

646 
noc
 = 0;

647 
b™0
 = 0;

648 
b™c
 = 
b™0
;

651 
x
 = ( (
p_Vid
->
width
 >> 4) - 1 ) / 2;

652 
y
 = ( (
p_Vid
->
height
 >> 4) - 1 ) / 2;

653 
Ëá
 = 
right
 = 
x
;

654 
tÝ
 = 
bÙtom
 = 
y
;

655 
dœeùx
 = 0;

656 
dœeùy
 = 1;

657 
j
=0; j<
p_Vid
->
height
 >> 4; j++)

658 
k
=0; k<
p_Vid
->
width
 >> 4; k++)

661 iàÐ
m­_¥
[
y
][
x
] =ð
b™c
 ) 
noc
++;

664 
sym
.
v®ue1
 = 
noc
;

665 
size_com´es£d
 +ð
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
b™¡»am
);

666 
noc
=0;

669 iàÐ
dœeùx
 =ð-1 && 
dœeùy
 == 0 )

671 ià(
x
 > 
Ëá
) x--;

672 ià(
x
 == 0)

674 
y
 = 
bÙtom
 + 1;

675 
bÙtom
++;

676 
dœeùx
 = 1;

677 
dœeùy
 = 0;

679 ià(
x
 =ð
Ëá
)

681 
x
--;

682 
Ëá
--;

683 
dœeùx
 = 0;

684 
dœeùy
 = 1;

687 iàÐ
dœeùx
 =ð1 && 
dœeùy
 == 0 )

689 ià(
x
 < 
right
) x++;

690 ià(
x
 =ð(
p_Vid
->
width
 >> 4) - 1)

692 
y
 = 
tÝ
 - 1;

693 
tÝ
--;

694 
dœeùx
 = -1;

695 
dœeùy
 = 0;

697 ià(
x
 =ð
right
)

699 
x
++;

700 
right
++;

701 
dœeùx
 = 0;

702 
dœeùy
 = -1;

705 iàÐ
dœeùx
 =ð0 && 
dœeùy
 == -1 )

707 iàÐ
y
 > 
tÝ
) y--;

708 ià(
y
 == 0)

710 
x
 = 
Ëá
 - 1;

711 
Ëá
--;

712 
dœeùx
 = 0;

713 
dœeùy
 = 1;

715 ià(
y
 =ð
tÝ
)

717 
y
--;

718 
tÝ
--;

719 
dœeùx
 = -1;

720 
dœeùy
 = 0;

723 iàÐ
dœeùx
 =ð0 && 
dœeùy
 == 1 )

725 ià(
y
 < 
bÙtom
) y++;

726 ià(
y
 =ð(
p_Vid
->
height
 >> 4) - 1)

728 
x
 = 
right
+1;

729 
right
++;

730 
dœeùx
 = 0;

731 
dœeùy
 = -1;

733 ià(
y
 =ð
bÙtom
)

735 
y
++;

736 
bÙtom
++;

737 
dœeùx
 = 1;

738 
dœeùy
 = 0;

742 ià(
noc
!=0)

744 
sym
.
v®ue1
 = 
noc
;

745 
size_com´es£d
 +ð
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
b™¡»am
);

748 
»t
 = (
size_com´es£d
<
size_uncom´es£d
? 
TRUE
 : 
FALSE
);

749 iàÐ!
»t
 )

752 
b™¡»am
->
by‹_buf
 = 0;

753 
b™¡»am
->
b™s_to_go
 = 8;

754 
b™¡»am
->
by‹_pos
 = 0;

755 
j
=0; j<
p_Vid
->
height
 >> 4; j++)

757 
k
=0; k<
p_Vid
->
width
 >> 4; k++)

759 
b™¡»am
->
by‹_buf
 <<= 1;

760 ià(
m­_¥
[
j
][
k
]è
b™¡»am
->
by‹_buf
 |= 1;

761 
b™¡»am
->
b™s_to_go
--;

762 ià(
b™¡»am
->
b™s_to_go
==0)

764 
b™¡»am
->
b™s_to_go
 = 8;

765 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

766 
b™¡»am
->
by‹_buf
 = 0;

772  
»t
;

773 
	}
}

790 
	$Fš®izeS·»MBM­
(
VideoP¬am‘”s
 *
p_Vid
)

792 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

793 
Cu¼F¿meNum
 = 
p_Vid
->
numb”
 % 
MAX_FN
;

794 
d–_äame_num
;

795 
SyÁaxEËm’t
 
sym
;

796 
B™¡»am
 *
de¡
, *
sourû
;

798 
sym
.
ty³
 = 
SE_HEADER
;

799 
sym
.
m­pšg
 = 
ue_lšfo
;

801 
sourû
 = 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
;

802 
de¡
 = 
	`m®loc
((
B™¡»am
));

803 iàÐ
de¡
 =ð
NULL
 ) 
	`no_mem_ex™
("FinalizeSpareMBMap: dest");

804 
de¡
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

805 iàÐ
de¡
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("FinalizeSpareMBMap: dest->streamBuffer");

806 
de¡
->
b™s_to_go
 = 8;

807 
de¡
->
by‹_pos
 = 0;

808 
de¡
->
by‹_buf
 = 0;

809 
	`mem£t
Ð
de¡
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

812 
d–_äame_num
 = 
Cu¼F¿meNum
 - 
p_SEI
->
£iS·»Piùu»Paylßd
.
rg‘_äame_num
;

813 iàÐ
d–_äame_num
 < 0 ) d–_äame_num +ð
MAX_FN
;

814 
sym
.
v®ue1
 = 
d–_äame_num
;

815 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

818 
sym
.
v®ue1
 = 
p_SEI
->
£iS·»Piùu»Paylßd
.
num_¥¬e_pics
 - 1;

819 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

822 
	`Aµ’dTmpb™s2Buf
Ð
de¡
, 
sourû
);

825 iàÐ
de¡
->
b™s_to_go
 != 8 )

827 (
de¡
->
by‹_buf
) <<= 1;

828 
de¡
->
by‹_buf
 |= 1;

829 
de¡
->
b™s_to_go
--;

830 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

831 
de¡
->
b™s_to_go
 = 8;

832 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

833 
de¡
->
by‹_buf
 = 0;

835 
p_SEI
->
£iS·»Piùu»Paylßd
.
·ylßdSize
 = 
de¡
->
by‹_pos
;

838 
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
 = 
de¡
;

839 
	`ä“
Ð
sourû
->
¡»amBufãr
 );

840 
	`ä“
Ð
sourû
 );

841 
	}
}

860 
	$In™Sub£qInfo
(
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
)

862 
ušt16
 
id
 = 0;

864 
p_SEI
->
£iHasSub£qInfo
 = 
TRUE
;

865 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
sub£q_Ïy”_num
 = currLayer;

866 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
sub£q_id
 = 
id
++;

867 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
 = 0;

868 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
¡Üed_äame_út
 = () -1;

869 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
·ylßdSize
 = 0;

871 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

872 iàÐ
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSubseqInfo:…_SEI->seiSubseqInfo[currLayer].data");

873 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
¡»amBufãr
 = 
	`m®loc
Ð
MAXRTPPAYLOADLEN
 );

874 iàÐ
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSubseqInfo:…_SEI->seiSubseqInfo[currLayer].data->streamBuffer");

875 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
b™s_to_go
 = 8;

876 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
by‹_pos
 = 0;

877 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
by‹_buf
 = 0;

878 
	`mem£t
Ð
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
 );

879 
	}
}

887 
	$Upd©eSub£qInfo
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
cu¼Lay”
)

889 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

890 ià(
p_Vid
->
ty³
 !ð
B_SLICE
)

892 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
¡Üed_äame_út
 ++;

893 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
¡Üed_äame_út
 =…_SEI->£iSub£qInfo[cu¼Lay”].¡Üed_äame_úˆ% 
MAX_FN
;

896 iàÐ
cu¼Lay”
 == 0 )

898 iàÐ
p_Vid
->
numb”
 =ð
p_IÅ
->
no_äames
 - 1 )

899 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
 = 1;

901 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
 = 0;

903 iàÐ
cu¼Lay”
 == 1 )

905 iàÐ(((
p_Vid
->
cu¼_äm_idx
 -…_Vid->
Ï¡_idr_code_Üd”
è% (
p_IÅ
->
NumF¿mesInELSubSeq
 + 1è=ð0è&& (p_IÅ->
Numb”BF¿mes
 != 0) && ((p_Vid->curr_frm_idx -…_Vid->last_idr_code_order) > 0)) ||

906 (((
p_Vid
->
cu¼_äm_idx
 -…_Vid->
Ï¡_idr_code_Üd”
è% (
p_IÅ
->
NumF¿mesInELSubSeq
 + 1è=ðp_IÅ->NumF¿mesInELSubSeqè&& (p_IÅ->
Numb”BF¿mes
==0))

908 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
 = 1;

910 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
 = 0;

912 
	}
}

920 
	$Fš®izeSub£qInfo
(
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
)

922 
SyÁaxEËm’t
 
sym
;

923 
B™¡»am
 *
de¡
 = 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
;

925 
sym
.
ty³
 = 
SE_HEADER
;

926 
sym
.
m­pšg
 = 
ue_lšfo
;

928 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
sub£q_Ïy”_num
;

929 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

930 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
sub£q_id
;

931 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

932 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
Ï¡_piùu»_æag
;

933 
sym
.
Ën
 = 1;

934 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

935 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
¡Üed_äame_út
;

936 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

939 iàÐ
de¡
->
b™s_to_go
 != 8 )

941 (
de¡
->
by‹_buf
) <<= 1;

942 
de¡
->
by‹_buf
 |= 1;

943 
de¡
->
b™s_to_go
--;

944 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

945 
de¡
->
b™s_to_go
 = 8;

946 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

947 
de¡
->
by‹_buf
 = 0;

949 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
·ylßdSize
 = 
de¡
->
by‹_pos
;

952 
	}
}

960 
	$CË¬Sub£qInfoPaylßd
(
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
)

962 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
b™s_to_go
 = 8;

963 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
by‹_pos
 = 0;

964 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
by‹_buf
 = 0;

965 
	`mem£t
Ð
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
 );

966 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
·ylßdSize
 = 0;

967 
	}
}

975 
	$Clo£Sub£qInfo
(
SEIP¬am‘”s
 *
p_SEI
, 
cu¼Lay”
)

977 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
¡Üed_äame_út
 = () -1;

978 
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
·ylßdSize
 = 0;

980 
	`ä“
Ð
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
->
¡»amBufãr
 );

981 
	`ä“
Ð
p_SEI
->
£iSub£qInfo
[
cu¼Lay”
].
d©a
 );

982 
	}
}

1000 
	$In™Sub£qLay”Info
(
SEIP¬am‘”s
 *
p_SEI
)

1002 
i
;

1003 
p_SEI
->
£iHasSub£qLay”Info
 = 
TRUE
;

1004 
p_SEI
->
£iSub£qLay”Info
.
Ïy”_numb”
 = 0;

1005 
i
=0; i<
MAX_LAYER_NUMBER
; i++)

1007 
p_SEI
->
£iSub£qLay”Info
.
b™_¿‹
[
i
] = 0;

1008 
p_SEI
->
£iSub£qLay”Info
.
äame_¿‹
[
i
] = 0;

1009 
p_SEI
->
£iSub£qLay”Info
.
Ïy”_numb”
++;

1011 
	}
}

1019 
	$Clo£Sub£qLay”Info
()

1021 
	}
}

1029 
	$Fš®izeSub£qLay”Info
(
SEIP¬am‘”s
 *
p_SEI
)

1031 
i
, 
pos
;

1032 
pos
 = 0;

1033 
p_SEI
->
£iSub£qLay”Info
.
·ylßdSize
 = 0;

1034 
i
=0; i<
p_SEI
->
£iSub£qLay”Info
.
Ïy”_numb”
; i++)

1036 *((
ušt16
*)&(
p_SEI
->
£iSub£qLay”Info
.
d©a
[
pos
])èðp_SEI->£iSub£qLay”Info.
b™_¿‹
[
i
];

1037 
pos
 += 2;

1038 *((
ušt16
*)&(
p_SEI
->
£iSub£qLay”Info
.
d©a
[
pos
])èðp_SEI->£iSub£qLay”Info.
äame_¿‹
[
i
];

1039 
pos
 += 2;

1040 
p_SEI
->
£iSub£qLay”Info
.
·ylßdSize
 += 4;

1042 
	}
}

1054 
	$In™Sub£qCh¬
(
VideoP¬am‘”s
 *
p_Vid
)

1056 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

1057 
p_SEI
->
£iSub£qCh¬
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1058 ifÐ
p_SEI
->
£iSub£qCh¬
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSubseqChar:…_SEI->seiSubseqChar.data");

1059 
p_SEI
->
£iSub£qCh¬
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1060 ifÐ
p_SEI
->
£iSub£qCh¬
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSubseqChar:…_SEI->seiSubseqChar.data->streamBuffer");

1061 
	`CË¬Sub£qCh¬Paylßd
(
p_SEI
);

1063 
p_SEI
->
£iSub£qCh¬
.
sub£q_Ïy”_num
 = 
p_Vid
->
Ïy”
;

1064 
p_SEI
->
£iSub£qCh¬
.
sub£q_id
 =…_SEI->
£iSub£qInfo
[
p_Vid
->
Ïy”
].subseq_id;

1065 
p_SEI
->
£iSub£qCh¬
.
du¿tiÚ_æag
 = 0;

1066 
p_SEI
->
£iSub£qCh¬
.
av”age_¿‹_æag
 = 0;

1067 
p_SEI
->
£iSub£qCh¬
.
num_»ã»nûd_sub£qs
 = 0;

1068 
	}
}

1070 
	$CË¬Sub£qCh¬Paylßd
(
SEIP¬am‘”s
 *
p_SEI
)

1072 
	`mem£t
Ð
p_SEI
->
£iSub£qCh¬
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1073 
p_SEI
->
£iSub£qCh¬
.
d©a
->
b™s_to_go
 = 8;

1074 
p_SEI
->
£iSub£qCh¬
.
d©a
->
by‹_pos
 = 0;

1075 
p_SEI
->
£iSub£qCh¬
.
d©a
->
by‹_buf
 = 0;

1076 
p_SEI
->
£iSub£qCh¬
.
·ylßdSize
 = 0;

1078 
p_SEI
->
£iHasSub£qCh¬
 = 
FALSE
;

1079 
	}
}

1081 
	$Upd©eSub£qCh¬
(
VideoP¬am‘”s
 *
p_Vid
)

1083 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

1085 
p_SEI
->
£iSub£qCh¬
.
sub£q_Ïy”_num
 = 
p_Vid
->
Ïy”
;

1086 
p_SEI
->
£iSub£qCh¬
.
sub£q_id
 =…_SEI->
£iSub£qInfo
[
p_Vid
->
Ïy”
].subseq_id;

1087 
p_SEI
->
£iSub£qCh¬
.
du¿tiÚ_æag
 = 0;

1088 
p_SEI
->
£iSub£qCh¬
.
av”age_¿‹_æag
 = 0;

1089 
p_SEI
->
£iSub£qCh¬
.
av”age_b™_¿‹
 = 100;

1090 
p_SEI
->
£iSub£qCh¬
.
av”age_äame_¿‹
 = 30;

1091 
p_SEI
->
£iSub£qCh¬
.
num_»ã»nûd_sub£qs
 = 0;

1092 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_Ïy”_num
[0] = 1;

1093 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_id
[0] = 2;

1094 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_Ïy”_num
[1] = 3;

1095 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_id
[1] = 4;

1097 
p_SEI
->
£iHasSub£qCh¬
 = 
TRUE
;

1098 
	}
}

1100 
	$Fš®izeSub£qCh¬
(
SEIP¬am‘”s
 *
p_SEI
)

1102 
i
;

1103 
SyÁaxEËm’t
 
sym
;

1104 
B™¡»am
 *
de¡
 = 
p_SEI
->
£iSub£qCh¬
.
d©a
;

1106 
sym
.
ty³
 = 
SE_HEADER
;

1107 
sym
.
m­pšg
 = 
ue_lšfo
;

1109 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qCh¬
.
sub£q_Ïy”_num
;

1110 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1111 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qCh¬
.
sub£q_id
;

1112 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1113 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qCh¬
.
du¿tiÚ_æag
;

1114 
sym
.
Ën
 = 1;

1115 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1116 iàÐ
p_SEI
->
£iSub£qCh¬
.
du¿tiÚ_æag
 )

1118 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qCh¬
.
sub£q_du¿tiÚ
;

1119 
sym
.
Ën
 = 32;

1120 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1122 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qCh¬
.
av”age_¿‹_æag
;

1123 
sym
.
Ën
 = 1;

1124 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1125 iàÐ
p_SEI
->
£iSub£qCh¬
.
av”age_¿‹_æag
 )

1127 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qCh¬
.
av”age_b™_¿‹
;

1128 
sym
.
Ën
 = 16;

1129 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1130 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSub£qCh¬
.
av”age_äame_¿‹
;

1131 
sym
.
Ën
 = 16;

1132 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1134 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qCh¬
.
num_»ã»nûd_sub£qs
;

1135 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1136 
i
=0; i<
p_SEI
->
£iSub£qCh¬
.
num_»ã»nûd_sub£qs
; i++)

1138 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_Ïy”_num
[
i
];

1139 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1140 
sym
.
v®ue1
 = 
p_SEI
->
£iSub£qCh¬
.
»f_sub£q_id
[
i
];

1141 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1145 iàÐ
de¡
->
b™s_to_go
 != 8 )

1147 (
de¡
->
by‹_buf
) <<= 1;

1148 
de¡
->
by‹_buf
 |= 1;

1149 
de¡
->
b™s_to_go
--;

1150 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

1151 
de¡
->
b™s_to_go
 = 8;

1152 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

1153 
de¡
->
by‹_buf
 = 0;

1155 
p_SEI
->
£iSub£qCh¬
.
·ylßdSize
 = 
de¡
->
by‹_pos
;

1156 
	}
}

1158 
	$Clo£Sub£qCh¬
(
SEIP¬am‘”s
 *
p_SEI
)

1160 ià(
p_SEI
->
£iSub£qCh¬
.
d©a
)

1162 
	`ä“
(
p_SEI
->
£iSub£qCh¬
.
d©a
->
¡»amBufãr
);

1163 
	`ä“
(
p_SEI
->
£iSub£qCh¬
.
d©a
);

1165 
p_SEI
->
£iSub£qCh¬
.
d©a
 = 
NULL
;

1166 
	}
}

1179 
	$In™SûÃInfÜm©iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

1181 
p_SEI
->
£iHasSûÃInfÜm©iÚ
 = 
TRUE
;

1183 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_id
 = 0;

1184 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_Œªs™iÚ_ty³
 = 0;

1185 
p_SEI
->
£iSûÃInfÜm©iÚ
.
£cÚd_sûÃ_id
 = -1;

1187 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1188 if(
p_SEI
-> 
£iSûÃInfÜm©iÚ
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSceneInformation: seiSceneInformation.data");

1189 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
¡»amBufãr
 = 
	`m®loc
Ð
MAXRTPPAYLOADLEN
 );

1190 ifÐ
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitSceneInformation: seiSceneInformation.data->streamBuffer");

1191 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
b™s_to_go
 = 8;

1192 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
by‹_pos
 = 0;

1193 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
by‹_buf
 = 0;

1194 
	`mem£t
Ð
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
 );

1195 
	}
}

1197 
	$Clo£SûÃInfÜm©iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

1199 ià(
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
)

1201 
	`ä“
(
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
->
¡»amBufãr
);

1202 
	`ä“
(
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
);

1204 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
 = 
NULL
;

1205 
	}
}

1207 
	$Fš®izeSûÃInfÜm©iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

1209 
SyÁaxEËm’t
 
sym
;

1210 
B™¡»am
 *
de¡
 = 
p_SEI
->
£iSûÃInfÜm©iÚ
.
d©a
;

1212 
sym
.
ty³
 = 
SE_HEADER
;

1213 
sym
.
m­pšg
 = 
ue_lšfo
;

1215 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_id
;

1216 
sym
.
Ën
 = 8;

1217 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1219 
sym
.
v®ue1
 = 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_Œªs™iÚ_ty³
;

1220 
	`wr™eSyÁaxEËm’t2Buf_UVLC
(&
sym
, 
de¡
);

1222 if(
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_Œªs™iÚ_ty³
 > 3)

1224 
sym
.
b™·‰”n
 = 
p_SEI
->
£iSûÃInfÜm©iÚ
.
£cÚd_sûÃ_id
;

1225 
sym
.
Ën
 = 8;

1226 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1230 iàÐ
de¡
->
b™s_to_go
 != 8 )

1232 (
de¡
->
by‹_buf
) <<= 1;

1233 
de¡
->
by‹_buf
 |= 1;

1234 
de¡
->
b™s_to_go
--;

1235 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

1236 
de¡
->
b™s_to_go
 = 8;

1237 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

1238 
de¡
->
by‹_buf
 = 0;

1240 
p_SEI
->
£iSûÃInfÜm©iÚ
.
·ylßdSize
 = 
de¡
->
by‹_pos
;

1241 
	}
}

1246 
	$Upd©eSûÃInfÜm©iÚ
(
SEIP¬am‘”s
 *
p_SEI
, 
BoÞ—n
 
HasSûÃInfÜm©iÚ
, 
sûÃID
, 
sûÃT¿nsTy³
, 
£cÚdSûÃID
)

1248 
p_SEI
->
£iHasSûÃInfÜm©iÚ
 = 
HasSûÃInfÜm©iÚ
;

1250 
	`as£¹
 (
sûÃID
 < 256);

1251 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_id
 = 
sûÃID
;

1253 
	`as£¹
 (
sûÃT¿nsTy³
 <= 6 );

1254 
p_SEI
->
£iSûÃInfÜm©iÚ
.
sûÃ_Œªs™iÚ_ty³
 = 
sûÃT¿nsTy³
;

1256 if(
sûÃT¿nsTy³
 > 3)

1258 
	`as£¹
 (
£cÚdSûÃID
 < 256);

1259 
p_SEI
->
£iSûÃInfÜm©iÚ
.
£cÚd_sûÃ_id
 = 
£cÚdSûÃID
;

1261 
	}
}

1276 
	$In™PªSÿnReùInfo
(
SEIP¬am‘”s
 *
p_SEI
)

1278 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1279 ifÐ
p_SEI
->
£iPªSÿnReùInfo
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitPanScanRectInfo:…_SEI->seiPanScanRectInfo.data");

1280 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1281 ifÐ
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitPanScanRectInfo:…_SEI->seiPanScanRectInfo.data->streamBuffer");

1282 
	`CË¬PªSÿnReùInfoPaylßd
(
p_SEI
);

1284 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_id
 = 0;

1285 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_ÿnûl_æag
 = 0;

1286 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_út_mšus1
 = 0;

1287 
	`mem£t
Ð
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_Ëá_off£t
, 0, 3 *  ( ) );

1288 
	`mem£t
Ð
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_right_off£t
, 0, 3 *  ( ) );

1289 
	`mem£t
Ð
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_tÝ_off£t
, 0, 3 *  ( ) );

1290 
	`mem£t
Ð
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_bÙtom_off£t
, 0, 3 *  ( ) );

1291 
p_SEI
->
£iPªSÿnReùInfo
.
·c_sÿn_»ù_»³t™iÚ_³riod
 = 0;

1292 
	}
}

1295 
	$CË¬PªSÿnReùInfoPaylßd
(
SEIP¬am‘”s
 *
p_SEI
)

1297 
	`mem£t
Ð
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1298 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
b™s_to_go
 = 8;

1299 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
by‹_pos
 = 0;

1300 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
by‹_buf
 = 0;

1301 
p_SEI
->
£iPªSÿnReùInfo
.
·ylßdSize
 = 0;

1303 
p_SEI
->
£iHasPªSÿnReùInfo
 = 
FALSE
;

1304 
	}
}

1306 
	$Upd©ePªSÿnReùInfo
Ð
VideoP¬am‘”s
 *
p_Vid
 )

1308 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

1311 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_id
 = 0;

1312 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_ÿnûl_æag
 = 0;

1313 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_út_mšus1
 = 0;

1314 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_Ëá_off£t
[0] = 0;

1315 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_right_off£t
[0] = 160;

1316 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_tÝ_off£t
[0] = 0;

1317 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_bÙtom_off£t
[0] = 160;

1318 
p_SEI
->
£iPªSÿnReùInfo
.
·c_sÿn_»ù_»³t™iÚ_³riod
 = 1;

1321 
p_SEI
->
£iHasPªSÿnReùInfo
 = 
TRUE
;

1322 
	}
}

1324 
	$Fš®izePªSÿnReùInfo
(
SEIP¬am‘”s
 *
p_SEI
)

1326 
i
;

1327 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
;

1329 
	`wr™e_ue_v
Ð"SEI:…ª_sÿn_»ù_id", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_id
, 
b™¡»am
 );

1330 
	`wr™e_u_1
Ð"SEI:…ª_sÿn_»ù_ÿnûl_æag", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_ÿnûl_æag
, 
b™¡»am
 );

1331 iàÐ!(
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_ÿnûl_æag
) )

1333 
	`wr™e_ue_v
Ð"SEI:…ª_sÿn_út_mšus1", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_út_mšus1
, 
b™¡»am
 );

1334  
i
 = 0; i <ð
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_út_mšus1
; i++ )

1336 
	`wr™e_£_v
Ð"SEI:…ª_sÿn_»ù_Ëá_off£t[X]", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_Ëá_off£t
[
i
], 
b™¡»am
 );

1337 
	`wr™e_£_v
Ð"SEI:…ª_sÿn_»ù_right_off£t[X]", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_right_off£t
[
i
], 
b™¡»am
 );

1338 
	`wr™e_£_v
Ð"SEI:…ª_sÿn_»ù_tÝ_off£t[X]", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_tÝ_off£t
[
i
], 
b™¡»am
 );

1339 
	`wr™e_£_v
Ð"SEI:…ª_sÿn_»ù_bÙtom_off£t[X]", 
p_SEI
->
£iPªSÿnReùInfo
.
·n_sÿn_»ù_bÙtom_off£t
[
i
], 
b™¡»am
 );

1341 
	`wr™e_ue_v
Ð"SEI:…ac_sÿn_»ù_»³t™iÚ_³riod", 
p_SEI
->
£iPªSÿnReùInfo
.
·c_sÿn_»ù_»³t™iÚ_³riod
, 
b™¡»am
 );

1345 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

1347 (
b™¡»am
->
by‹_buf
) <<= 1;

1348 
b™¡»am
->
by‹_buf
 |= 1;

1349 
b™¡»am
->
b™s_to_go
--;

1350 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

1351 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

1352 
b™¡»am
->
b™s_to_go
 = 8;

1353 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

1354 
b™¡»am
->
by‹_buf
 = 0;

1356 
p_SEI
->
£iPªSÿnReùInfo
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

1357 
	}
}

1360 
	$Clo£PªSÿnReùInfo
(
SEIP¬am‘”s
 *
p_SEI
)

1362 ià(
p_SEI
->
£iPªSÿnReùInfo
.
d©a
)

1364 
	`ä“
(
p_SEI
->
£iPªSÿnReùInfo
.
d©a
->
¡»amBufãr
);

1365 
	`ä“
(
p_SEI
->
£iPªSÿnReùInfo
.
d©a
);

1367 
p_SEI
->
£iPªSÿnReùInfo
.
d©a
 = 
NULL
;

1368 
	}
}

1379 
	$In™U£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
)

1382 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1383 ifÐ
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_unregistered.data");

1384 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1385 ifÐ
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_unregistered.data->streamBuffer");

1386 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1387 ifÐ
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_unregistered.byte");

1388 
	`CË¬U£r_d©a_uÄegi¡”ed
(
p_SEI
);

1390 
	}
}

1393 
	$CË¬U£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
)

1395 
	`mem£t
Ð
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1396 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
b™s_to_go
 = 8;

1397 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
by‹_pos
 = 0;

1398 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
by‹_buf
 = 0;

1399 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
·ylßdSize
 = 0;

1401 
	`mem£t
Ð
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
, 0, 
MAXRTPPAYLOADLEN
);

1402 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
tÙ®_by‹
 = 0;

1404 
p_SEI
->
£iHasU£r_d©a_uÄegi¡”ed_šfo
 = 
FALSE
;

1405 
	}
}

1407 
	$Upd©eU£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
)

1409 
i
, 
‹mp_d©a
;

1410 
tÙ®_by‹
;

1413 
tÙ®_by‹
 = 7;

1414 
i
 = 0; i < 
tÙ®_by‹
; i++)

1416 
‹mp_d©a
 = 
i
 * 4;

1417 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
[
i
] = (è
	`iCl3
(0, 255, 
‹mp_d©a
);

1419 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
tÙ®_by‹
 =otal_byte;

1420 
	}
}

1422 
	$Fš®izeU£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
)

1424 
i
;

1425 
SyÁaxEËm’t
 
sym
;

1426 
B™¡»am
 *
de¡
 = 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
;

1428 
sym
.
ty³
 = 
SE_HEADER
;

1429 
sym
.
m­pšg
 = 
ue_lšfo
;

1432  
i
 = 0; i < 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
tÙ®_by‹
; i++)

1434 
sym
.
b™·‰”n
 = 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
[
i
];

1435 
sym
.
Ën
 = 8;

1436 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1437 #ifdeà
PRINT_USER_DATA_UNREGISTERED_INFO


1438 
	`´štf
("UÄeg d©¨·ylßd_by‹ = %d\n", 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
[
i
]);

1441 #ifdeà
PRINT_USER_DATA_UNREGISTERED_INFO


1442 #undeà
PRINT_USER_DATA_UNREGISTERED_INFO


1445 iàÐ
de¡
->
b™s_to_go
 != 8 )

1447 (
de¡
->
by‹_buf
) <<= 1;

1448 
de¡
->
by‹_buf
 |= 1;

1449 
de¡
->
b™s_to_go
--;

1450 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

1451 
de¡
->
b™s_to_go
 = 8;

1452 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

1453 
de¡
->
by‹_buf
 = 0;

1455 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
·ylßdSize
 = 
de¡
->
by‹_pos
;

1456 
	}
}

1458 
	$Clo£U£r_d©a_uÄegi¡”ed
(
SEIP¬am‘”s
 *
p_SEI
)

1460 ià(
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
)

1462 
	`ä“
(
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
¡»amBufãr
);

1463 
	`ä“
(
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
);

1465 
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
d©a
 = 
NULL
;

1466 if(
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
)

1468 
	`ä“
(
p_SEI
->
£iU£r_d©a_uÄegi¡”ed
.
by‹
);

1470 
	}
}

1482 
	$In™U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
)

1485 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1486 ifÐ
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_registered_itu_t_t35.data");

1487 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1488 ifÐ
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_registered_itu_t_t35.data->streamBuffer");

1489 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1490 ifÐ
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitUser_data_unregistered:…_SEI->seiUser_data_registered_itu_t_t35.byte");

1491 
	`CË¬U£r_d©a_»gi¡”ed_™u_t_t35
(
p_SEI
);

1493 
	}
}

1496 
	$CË¬U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
)

1498 
	`mem£t
Ð
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1499 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
b™s_to_go
 = 8;

1500 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
by‹_pos
 = 0;

1501 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
by‹_buf
 = 0;

1502 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
·ylßdSize
 = 0;

1504 
	`mem£t
Ð
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
, 0, 
MAXRTPPAYLOADLEN
);

1505 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
tÙ®_by‹
 = 0;

1506 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
 = 0;

1507 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code_ex‹nsiÚ_by‹
 = 0;

1509 
p_SEI
->
£iHasU£r_d©a_»gi¡”ed_™u_t_t35_šfo
 = 
FALSE
;

1510 
	}
}

1512 
	$Upd©eU£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
)

1514 
i
, 
‹mp_d©a
;

1515 
tÙ®_by‹
;

1516 
couÁry_code
 = 82;

1518 if(
couÁry_code
 < 0xFF)

1520 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
 = 
couÁry_code
;

1524 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
 = 0xFF;

1525 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code_ex‹nsiÚ_by‹
 = 
couÁry_code
 - 0xFF;

1528 
tÙ®_by‹
 = 7;

1529 
i
 = 0; i < 
tÙ®_by‹
; i++)

1531 
‹mp_d©a
 = 
i
 * 3;

1532 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
[
i
] = (è
	`iCl3
(0, 255, 
‹mp_d©a
);

1534 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
tÙ®_by‹
 =otal_byte;

1535 
	}
}

1537 
	$Fš®izeU£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
)

1539 
i
;

1540 
SyÁaxEËm’t
 
sym
;

1541 
B™¡»am
 *
de¡
 = 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
;

1543 
sym
.
ty³
 = 
SE_HEADER
;

1544 
sym
.
m­pšg
 = 
ue_lšfo
;

1546 
sym
.
b™·‰”n
 = 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
;

1547 
sym
.
Ën
 = 8;

1548 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1551 #ifdeà
PRINT_USER_DATA_REGISTERED_ITU_T_T35_INFO


1552 
	`´štf
(" ITU_T_T35_COUNTRTY_CODE %d \n", 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
);

1555 if(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code
 == 0xFF)

1557 
sym
.
b™·‰”n
 = 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code_ex‹nsiÚ_by‹
;

1558 
sym
.
Ën
 = 8;

1559 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1560 #ifdeà
PRINT_USER_DATA_REGISTERED_ITU_T_T35_INFO


1561 
	`´štf
(" ITU_T_T35_COUNTRTY_CODE_EXTENSION_BYTE %d \n", 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
™u_t_t35_couÁry_code_ex‹nsiÚ_by‹
);

1565  
i
 = 0; i < 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
tÙ®_by‹
; i++)

1567 
sym
.
b™·‰”n
 = 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
[
i
];

1568 
sym
.
Ën
 = 8;

1569 
	`wr™eSyÁaxEËm’t2Buf_Fixed
(&
sym
, 
de¡
);

1570 #ifdeà
PRINT_USER_DATA_REGISTERED_ITU_T_T35_INFO


1571 
	`´štf
("™u_t_t35…aylßd_by‹ = %d\n", 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
[
i
]);

1574 #ifdeà
PRINT_USER_DATA_REGISTERED_ITU_T_T35_INFO


1575 #undeà
PRINT_USER_DATA_REGISTERED_ITU_T_T35_INFO


1578 iàÐ
de¡
->
b™s_to_go
 != 8 )

1580 (
de¡
->
by‹_buf
) <<= 1;

1581 
de¡
->
by‹_buf
 |= 1;

1582 
de¡
->
b™s_to_go
--;

1583 iàÐ
de¡
->
b™s_to_go
 !ð0 ) (de¡->
by‹_buf
) <<= (dest->bits_to_go);

1584 
de¡
->
b™s_to_go
 = 8;

1585 
de¡
->
¡»amBufãr
[de¡->
by‹_pos
++]=de¡->
by‹_buf
;

1586 
de¡
->
by‹_buf
 = 0;

1588 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
·ylßdSize
 = 
de¡
->
by‹_pos
;

1589 
	}
}

1591 
	$Clo£U£r_d©a_»gi¡”ed_™u_t_t35
(
SEIP¬am‘”s
 *
p_SEI
)

1593 ià(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
)

1595 
	`ä“
(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
¡»amBufãr
);

1596 
	`ä“
(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
);

1598 
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
 = 
NULL
;

1599 if(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
)

1601 
	`ä“
(
p_SEI
->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
by‹
);

1603 
	}
}

1614 
	$In™RªdomAcûss
(
SEIP¬am‘”s
 *
p_SEI
)

1616 
p_SEI
->
£iRecov”yPošt
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1617 ifÐ
p_SEI
->
£iRecov”yPošt
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitRandomAccess: seiRandomAccess.data");

1618 
p_SEI
->
£iRecov”yPošt
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1619 ifÐ
p_SEI
->
£iRecov”yPošt
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitRandomAccess: seiRandomAccess.data->streamBuffer");

1620 
	`CË¬RªdomAcûss
(
p_SEI
);

1621 
	}
}

1624 
	$CË¬RªdomAcûss
(
SEIP¬am‘”s
 *
p_SEI
)

1626 
	`mem£t
Ð
p_SEI
->
£iRecov”yPošt
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1627 
p_SEI
->
£iRecov”yPošt
.
d©a
->
b™s_to_go
 = 8;

1628 
p_SEI
->
£iRecov”yPošt
.
d©a
->
by‹_pos
 = 0;

1629 
p_SEI
->
£iRecov”yPošt
.
d©a
->
by‹_buf
 = 0;

1630 
p_SEI
->
£iRecov”yPošt
.
·ylßdSize
 = 0;

1632 
p_SEI
->
£iRecov”yPošt
.
»cov”y_äame_út
 = 0;

1633 
p_SEI
->
£iRecov”yPošt
.
brok’_lšk_æag
 = 0;

1634 
p_SEI
->
£iRecov”yPošt
.
exaù_m©ch_æag
 = 0;

1635 
p_SEI
->
£iRecov”yPošt
.
chªgšg_¦iû_group_idc
 = 0;

1637 
p_SEI
->
£iHasRecov”yPošt_šfo
 = 
FALSE
;

1638 
	}
}

1640 
	$Upd©eRªdomAcûss
(
VideoP¬am‘”s
 *
p_Vid
)

1642 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

1643 if(
p_Vid
->
ty³
 =ð
I_SLICE
)

1645 
p_SEI
->
£iRecov”yPošt
.
»cov”y_äame_út
 = 0;

1646 
p_SEI
->
£iRecov”yPošt
.
exaù_m©ch_æag
 = 1;

1647 
p_SEI
->
£iRecov”yPošt
.
brok’_lšk_æag
 = 0;

1648 
p_SEI
->
£iRecov”yPošt
.
chªgšg_¦iû_group_idc
 = 0;

1649 
p_SEI
->
£iHasRecov”yPošt_šfo
 = 
TRUE
;

1653 
p_SEI
->
£iHasRecov”yPošt_šfo
 = 
FALSE
;

1655 
	}
}

1657 
	$Fš®izeRªdomAcûss
(
SEIP¬am‘”s
 *
p_SEI
)

1659 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iRecov”yPošt
.
d©a
;

1661 
	`wr™e_ue_v
Ð"SEI:„ecov”y_äame_út", 
p_SEI
->
£iRecov”yPošt
.
»cov”y_äame_út
, 
b™¡»am
);

1662 
	`wr™e_u_1
 ( "SEI:ƒxaù_m©ch_æag", 
p_SEI
->
£iRecov”yPošt
.
exaù_m©ch_æag
, 
b™¡»am
);

1663 
	`wr™e_u_1
 ( "SEI: brok’_lšk_æag", 
p_SEI
->
£iRecov”yPošt
.
brok’_lšk_æag
, 
b™¡»am
);

1664 
	`wr™e_u_v
 (2, "SEI: chªgšg_¦iû_group_idc", 
p_SEI
->
£iRecov”yPošt
.
chªgšg_¦iû_group_idc
, 
b™¡»am
);

1668 #ifdeà
PRINT_RECOVERY_POINT


1669 
	`´štf
("„ecov”y_äame_úˆ%d \n", 
p_SEI
->
£iRecov”yPošt
.
»cov”y_äame_út
);

1670 
	`´štf
("ƒxaù_m©ch_æag %d \n", 
p_SEI
->
£iRecov”yPošt
.
exaù_m©ch_æag
);

1671 
	`´štf
(" brok’_lšk_æag %d \n", 
p_SEI
->
£iRecov”yPošt
.
brok’_lšk_æag
);

1672 
	`´štf
(" chªgšg_¦iû_group_idø%d \n", 
p_SEI
->
£iRecov”yPošt
.
chªgšg_¦iû_group_idc
);

1673 
	`´štf
(" %d %d \n", 
b™¡»am
->
by‹_pos
, b™¡»am->
b™s_to_go
);

1675 #undeà
PRINT_RECOVERY_POINT


1678 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

1680 (
b™¡»am
->
by‹_buf
) <<= 1;

1681 
b™¡»am
->
by‹_buf
 |= 1;

1682 
b™¡»am
->
b™s_to_go
--;

1683 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

1684 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

1685 
b™¡»am
->
b™s_to_go
 = 8;

1686 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

1687 
b™¡»am
->
by‹_buf
 = 0;

1689 
p_SEI
->
£iRecov”yPošt
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

1690 
	}
}

1692 
	$Clo£RªdomAcûss
(
SEIP¬am‘”s
 *
p_SEI
)

1694 ià(
p_SEI
->
£iRecov”yPošt
.
d©a
)

1696 
	`ä“
(
p_SEI
->
£iRecov”yPošt
.
d©a
->
¡»amBufãr
);

1697 
	`ä“
(
p_SEI
->
£iRecov”yPošt
.
d©a
);

1699 
p_SEI
->
£iRecov”yPošt
.
d©a
 = 
NULL
;

1700 
	}
}

1711 
	$P¬£TÚeM­pšgCÚfigFže
(
SEIP¬am‘”s
 *
p_SEI
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
TÚeM­pšgSEI
 *
pSeiTÚeM­pšg
)

1713 
i
;

1714 
»t
;

1715 
FILE
* 
å
;

1716 
buf
[1024];

1717 
tmp
;

1719 
	`´štf
 ("P¬sšg TÚm­pšg cfg fž% ..........\n\n", 
p_IÅ
->
TÚeM­pšgFže
);

1720 ià((
å
 = 
	`fÝ’
(
p_IÅ
->
TÚeM­pšgFže
, "r")è=ð
NULL
)

1722 
	`årštf
(
¡d”r
, "TÚm­pšg cÚfig fž% i nÙ found, di§bËÚm­pšg SEI\n", 
p_IÅ
->
TÚeM­pšgFže
);

1723 
p_SEI
->
£iHasTÚe_m­pšg
=
FALSE
;

1729 
	`fsÿnf
(
å
, "%s", 
buf
)!=
EOF
)

1731 
»t
 = 1;

1732 ià(
	`¡rcmp
(
buf
, "tone_map_id")==0)

1734 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &(
pSeiTÚeM­pšg
->
tÚe_m­_id
));

1736 ià(
	`¡rcmp
(
buf
, "tone_map_cancel_flag")==0)

1738 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &
tmp
);

1739 
pSeiTÚeM­pšg
->
tÚe_m­_ÿnûl_æag
 = (è(
tmp
 ? 1 : 0);

1741 ià(
	`¡rcmp
(
buf
, "tone_map_repetition_period")==0)

1743 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &(
pSeiTÚeM­pšg
->
tÚe_m­_»³t™iÚ_³riod
));

1745 ià(
	`¡rcmp
(
buf
, "coded_data_bit_depth")==0)

1747 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &
tmp
);

1748 
pSeiTÚeM­pšg
->
coded_d©a_b™_d•th
 = (è
tmp
;

1750 ià(
	`¡rcmp
(
buf
, "sei_bit_depth")==0)

1752 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &
tmp
);

1753 
pSeiTÚeM­pšg
->
£i_b™_d•th
 = (è
tmp
;

1755 ià(
	`¡rcmp
(
buf
, "model_id")==0)

1757 
»t
 = 
	`fsÿnf
(
å
, " = %ud\n", &(
pSeiTÚeM­pšg
->
mod–_id
));

1760 ià(
	`¡rcmp
(
buf
, "min_value")==0)

1762 
»t
 = 
	`fsÿnf
(
å
, " = %d\n", &(
pSeiTÚeM­pšg
->
mš_v®ue
));

1764 ià(
	`¡rcmp
(
buf
, "max_value")==0)

1766 
»t
 = 
	`fsÿnf
(
å
, " = %d\n", &(
pSeiTÚeM­pšg
->
max_v®ue
));

1769 ià(
	`¡rcmp
(
buf
, "sigmoid_midpoint")==0)

1771 
»t
 = 
	`fsÿnf
(
å
, " = %d\n", &(
pSeiTÚeM­pšg
->
sigmoid_midpošt
));

1773 ià(
	`¡rcmp
(
buf
, "sigmoid_width")==0)

1775 
»t
 = 
	`fsÿnf
(
å
, " = %d\n", &(
pSeiTÚeM­pšg
->
sigmoid_width
));

1778 ià(
	`¡rcmp
(
buf
, "start_of_coded_interval")==0)

1780 
max_ouut_num
 = 1<<(
pSeiTÚeM­pšg
->
£i_b™_d•th
);

1781 
»t
 = 
	`fsÿnf
(
å
, " = ");

1782 ià(
»t
!=0)

1784 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1786 
i
=0; i < 
max_ouut_num
; i++)

1788 
»t
 = 
	`fsÿnf
(
å
, "%d\n", &(
pSeiTÚeM­pšg
->
¡¬t_of_coded_š‹rv®
[
i
]));

1789 ià(
»t
!=1)

1791 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1796 ià(
	`¡rcmp
(
buf
, "num_pivots")==0)

1798 
»t
 = 
	`fsÿnf
(
å
, " = %d\n", &(
pSeiTÚeM­pšg
->
num_pivÙs
));

1801 ià(
	`¡rcmp
(
buf
, "coded_pivot_value")==0)

1803 
»t
 = 
	`fsÿnf
(
å
, " = ");

1804 ià(
»t
!=0)

1806 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1808 
i
=0; i < 
pSeiTÚeM­pšg
->
num_pivÙs
; i++)

1810 
»t
 = 
	`fsÿnf
(
å
, "%d\n", &(
pSeiTÚeM­pšg
->
coded_pivÙ_v®ue
[
i
]));

1811 ià(
»t
!=1)

1813 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1817 ià(
	`¡rcmp
(
buf
, "sei_pivot_value")==0)

1819 
»t
 = 
	`fsÿnf
(
å
, " = ");

1820 ià(
»t
!=0)

1822 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1824 
i
=0; i < 
pSeiTÚeM­pšg
->
num_pivÙs
; i++)

1826 
»t
 = 
	`fsÿnf
(
å
, "%d\n", &(
pSeiTÚeM­pšg
->
£i_pivÙ_v®ue
[
i
]));

1827 ià(
»t
!=1)

1829 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1836 ià(
NULL
 =ð
	`fg‘s
(
buf
, (buf), 
å
))

1838 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1841 ià(
»t
!=1)

1843 
	`”rÜ
 ("ParseToneMappingConfigFile:ƒrror…arsingone mapping config file",500);

1847 
	`fþo£
(
å
);

1850 
	}
}

1852 
	$In™TÚeM­pšg
(
SEIP¬am‘”s
 *
p_SEI
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1854 ià(
p_IÅ
->
TÚeM­pšgSEIP»£ÁFÏg
 == 0)

1856 
p_SEI
->
£iHasTÚe_m­pšg
 = 
FALSE
;

1860 
p_SEI
->
£iHasTÚe_m­pšg
 = 
TRUE
;

1862 
p_SEI
->
£iTÚeM­pšg
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

1863 ifÐ
p_SEI
->
£iTÚeM­pšg
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitToneMapping: seiToneMapping.data");

1864 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

1865 ifÐ
p_SEI
->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitToneMapping: seiToneMapping.data->streamBuffer");

1866 
	`mem£t
Ð
p_SEI
->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1867 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
b™s_to_go
 = 8;

1868 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
by‹_pos
 = 0;

1869 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
by‹_buf
 = 0;

1870 
p_SEI
->
£iTÚeM­pšg
.
·ylßdSize
 = 0;

1873 
	`P¬£TÚeM­pšgCÚfigFže
(
p_SEI
, 
p_IÅ
, &p_SEI->
£iTÚeM­pšg
);

1874 
	}
}

1876 
	$Fš®izeTÚeM­pšg
(
VideoP¬am‘”s
 *
p_Vid
)

1878 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

1880 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iTÚeM­pšg
.
d©a
;

1881 
i
;

1883 
	`wr™e_ue_v
("SEI:Úe_m­_id" , 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_id
, 
b™¡»am
);

1884 
	`wr™e_u_1
("SEI:Úe_m­_ÿnûl_æag" , 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_ÿnûl_æag
, 
b™¡»am
);

1886 #ifdeà
PRINT_TONE_MAPPING


1887 
	`´štf
("äam%d: TÚe-m­pšg SEI mes§ge\n", 
p_Vid
->
äame_num
);

1888 
	`´štf
("tÚe_m­_id = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_id
);

1889 
	`´štf
("tÚe_m­_ÿnûl_æag = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_ÿnûl_æag
);

1891 ià(!
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_ÿnûl_æag
)

1893 
	`wr™e_ue_v
Ð"SEI:Úe_m­_»³t™iÚ_³riod", 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_»³t™iÚ_³riod
, 
b™¡»am
);

1894 
	`wr™e_u_v
 (8,"SEI: coded_d©a_b™_d•th" , 
p_SEI
->
£iTÚeM­pšg
.
coded_d©a_b™_d•th
, 
b™¡»am
);

1895 
	`wr™e_u_v
 (8,"SEI: sei_b™_d•th" , 
p_SEI
->
£iTÚeM­pšg
.
£i_b™_d•th
, 
b™¡»am
);

1896 
	`wr™e_ue_v
Ð"SEI: mod–_id" , 
p_SEI
->
£iTÚeM­pšg
.
mod–_id
, 
b™¡»am
);

1898 #ifdeà
PRINT_TONE_MAPPING


1899 
	`´štf
("tÚe_m­_»³t™iÚ_³riod = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
tÚe_m­_»³t™iÚ_³riod
);

1900 
	`´štf
("coded_d©a_b™_d•th = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
coded_d©a_b™_d•th
);

1901 
	`´štf
("£i_b™_d•th = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
£i_b™_d•th
);

1902 
	`´štf
("mod–_id = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
mod–_id
);

1904 ià(
p_SEI
->
£iTÚeM­pšg
.
mod–_id
 == 0)

1906 
	`wr™e_u_v
 (32,"SEI: mš_v®ue", 
p_SEI
->
£iTÚeM­pšg
.
mš_v®ue
, 
b™¡»am
);

1907 
	`wr™e_u_v
 (32,"SEI: mš_v®ue", 
p_SEI
->
£iTÚeM­pšg
.
max_v®ue
, 
b™¡»am
);

1908 #ifdeà
PRINT_TONE_MAPPING


1909 
	`´štf
("mš_v®uð%d, max_v®uð%d\n", 
p_SEI
->
£iTÚeM­pšg
.
mš_v®ue
,…_SEI->£iTÚeM­pšg.
max_v®ue
);

1912 ià(
p_SEI
->
£iTÚeM­pšg
.
mod–_id
 == 1)

1914 
	`wr™e_u_v
 (32,"SEI: sigmoid_midpošt", 
p_SEI
->
£iTÚeM­pšg
.
sigmoid_midpošt
, 
b™¡»am
);

1915 
	`wr™e_u_v
 (32,"SEI: sigmoid_width", 
p_SEI
->
£iTÚeM­pšg
.
sigmoid_width
, 
b™¡»am
);

1916 #ifdeà
PRINT_TONE_MAPPING


1917 
	`´štf
("sigmoid_midpošˆð%d, sigmoid_width = %d\n", 
p_SEI
->
£iTÚeM­pšg
.
sigmoid_midpošt
,…_SEI->£iTÚeM­pšg.
sigmoid_width
);

1920 ià(
p_SEI
->
£iTÚeM­pšg
.
mod–_id
 == 2)

1922 
b™_d•th_v®
 = 1 << 
p_SEI
->
£iTÚeM­pšg
.
£i_b™_d•th
;

1923 
i
=0; i<
b™_d•th_v®
; i++)

1925 
	`wr™e_u_v
((((
p_SEI
->
£iTÚeM­pšg
.
coded_d©a_b™_d•th
+7)>>3)<<3), "SEI: s¹_of_coded_š‹rv®",…_SEI->£iTÚeM­pšg.
¡¬t_of_coded_š‹rv®
[
i
], 
b™¡»am
);

1926 #ifdeà
PRINT_TONE_MAPPING


1931 ià(
p_SEI
->
£iTÚeM­pšg
.
mod–_id
 == 3)

1933 
	`wr™e_u_v
 (16,"SEI:‚um_pivÙs", 
p_SEI
->
£iTÚeM­pšg
.
num_pivÙs
, 
b™¡»am
);

1934 #ifdeà
PRINT_TONE_MAPPING


1935 
	`´štf
("num_pivÙ ð%d\n", 
p_SEI
->
£iTÚeM­pšg
.
num_pivÙs
);

1937 
i
=0; i < 
p_SEI
->
£iTÚeM­pšg
.
num_pivÙs
; i++)

1939 
	`wr™e_u_v
Ð(((
p_SEI
->
£iTÚeM­pšg
.
coded_d©a_b™_d•th
+7)>>3)<<3), "SEI: coded_pivÙ_v®ue",…_SEI->£iTÚeM­pšg.
coded_pivÙ_v®ue
[
i
], 
b™¡»am
);

1940 
	`wr™e_u_v
Ð(((
p_SEI
->
£iTÚeM­pšg
.
£i_b™_d•th
+7)>>3)<<3), "SEI: sei_pivÙ_v®ue",…_SEI->£iTÚeM­pšg.
£i_pivÙ_v®ue
[
i
], 
b™¡»am
);

1941 #ifdeà
PRINT_TONE_MAPPING


1942 
	`´štf
("coded_pivÙ_v®ue[%d] = %d, sei_pivÙ_v®ue[%d] = %d\n", 
i
, 
p_SEI
->
£iTÚeM­pšg
.
coded_pivÙ_v®ue
[i], i,…_SEI->£iTÚeM­pšg.
£i_pivÙ_v®ue
[i]);

1949 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

1951 (
b™¡»am
->
by‹_buf
) <<= 1;

1952 
b™¡»am
->
by‹_buf
 |= 1;

1953 
b™¡»am
->
b™s_to_go
--;

1954 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

1955 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

1956 
b™¡»am
->
b™s_to_go
 = 8;

1957 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

1958 
b™¡»am
->
by‹_buf
 = 0;

1960 
p_SEI
->
£iTÚeM­pšg
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

1961 
	}
}

1964 
	$Upd©eTÚeM­pšg
(
SEIP¬am‘”s
 *
p_SEI
)

1969 
	}
}

1971 
	$CË¬TÚeM­pšg
(
SEIP¬am‘”s
 *
p_SEI
)

1973 
	`mem£t
Ð
p_SEI
->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

1974 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
b™s_to_go
 = 8;

1975 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
by‹_pos
 = 0;

1976 
p_SEI
->
£iTÚeM­pšg
.
d©a
->
by‹_buf
 = 0;

1977 
p_SEI
->
£iTÚeM­pšg
.
·ylßdSize
 = 0;

1979 
p_SEI
->
£iHasTÚe_m­pšg
=
FALSE
;

1980 
	}
}

1982 
	$Clo£TÚeM­pšg
(
SEIP¬am‘”s
 *
p_SEI
)

1985 ià(
p_SEI
->
£iTÚeM­pšg
.
d©a
)

1987 
	`ä“
(
p_SEI
->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
);

1988 
	`ä“
(
p_SEI
->
£iTÚeM­pšg
.
d©a
);

1990 
p_SEI
->
£iTÚeM­pšg
.
d©a
 = 
NULL
;

1991 
p_SEI
->
£iHasTÚe_m­pšg
 = 
FALSE
;

1992 
	}
}

2003 
	$In™Po¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
)

2005 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

2006 ifÐ
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
 =ð
NULL
 ) 
	`no_mem_ex™
("InitPostFilterHints:…_SEI->seiPostFilterHints.data");

2007 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

2008 ifÐ
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
¡»amBufãr
 =ð
NULL
 ) 
	`no_mem_ex™
("InitPostFilterHints:…_SEI->seiPostFilterHints.data->streamBuffer");

2009 
	`CË¬Po¡Fž‹rHšts
(
p_SEI
);

2010 
	}
}

2012 
	$CË¬Po¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
)

2014 
	`mem£t
Ð
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

2015 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
b™s_to_go
 = 8;

2016 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
by‹_pos
 = 0;

2017 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
by‹_buf
 = 0;

2018 
p_SEI
->
£iPo¡Fž‹rHšts
.
·ylßdSize
 = 0;

2020 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
 = 0;

2021 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
 = 0;

2022 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_ty³
 = 0;

2023 
p_SEI
->
£iPo¡Fž‹rHšts
.
add™iÚ®_ex‹nsiÚ_æag
 = 0;

2024 
	}
}

2026 
	$Upd©ePo¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
)

2028 
cÞÜ_compÚ’t
, 
cx
, 
cy
;

2029 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_ty³
 = 0;

2030 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
 =…_SEI->£iPo¡Fž‹rHšts.
fž‹r_hšt_size_x
 = 5;

2031 
	`g‘_mem3Dšt
(&
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt
, 3,…_SEI->£iPo¡Fž‹rHšts.
fž‹r_hšt_size_y
,…_SEI->£iPo¡Fž‹rHšts.
fž‹r_hšt_size_x
);

2033 
cÞÜ_compÚ’t
 = 0; color_component < 3; color_component ++)

2034 
cy
 = 0; cy < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
; cy ++)

2035 
cx
 = 0; cx < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
; cx ++)

2036 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt
[
cÞÜ_compÚ’t
][
cy
][
cx
] = 1;

2038 
p_SEI
->
£iPo¡Fž‹rHšts
.
add™iÚ®_ex‹nsiÚ_æag
 = 0;

2039 
	}
}

2041 
	$Fš®izePo¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
)

2043 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
;

2044 
cÞÜ_compÚ’t
, 
cx
, 
cy
;

2046 
	`wr™e_ue_v
Ð"SEI:…o¡_fž‹r_hšt_size_y", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
, 
b™¡»am
);

2047 
	`wr™e_ue_v
Ð"SEI:…o¡_fž‹r_hšt_size_x", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
, 
b™¡»am
);

2048 
	`wr™e_u_v
 (2,"SEI:…o¡_fž‹r_hšt_ty³", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_ty³
, 
b™¡»am
);

2050 
cÞÜ_compÚ’t
 = 0; color_component < 3; color_component ++)

2051 
cy
 = 0; cy < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
; cy ++)

2052 
cx
 = 0; cx < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
; cx ++)

2053 
	`wr™e_£_v
("SEI:…o¡_fž‹r_hšts", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt
[
cÞÜ_compÚ’t
][
cy
][
cx
], 
b™¡»am
);

2055 
	`wr™e_u_1
 ("SEI:…o¡_fž‹r_add™iÚ®_ex‹nsiÚ_æag", 
p_SEI
->
£iPo¡Fž‹rHšts
.
add™iÚ®_ex‹nsiÚ_æag
, 
b™¡»am
);

2058 #ifdeà
PRINT_POST_FILTER_HINTS


2059 
	`´štf
("…o¡_fž‹r_hšt_size_y %d \n", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
);

2060 
	`´štf
("…o¡_fž‹r_hšt_size_x %d \n", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
);

2061 
	`´štf
("…o¡_fž‹r_hšt_ty³ %d \n", 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_ty³
);

2062 
cÞÜ_compÚ’t
 = 0; color_component < 3; color_component ++)

2063 
cy
 = 0; cy < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_y
; cy ++)

2064 
cx
 = 0; cx < 
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt_size_x
; cx ++)

2065 
	`´štf
("…o¡_fž‹r_hšt[%d][%d][%d] %d \n", 
cÞÜ_compÚ’t
, 
cy
, 
cx
, 
fž‹r_hšt
[color_component][cy][cx]);

2067 
	`´štf
("‡dd™iÚ®_ex‹nsiÚ_æag %d \n", 
p_SEI
->
£iPo¡Fž‹rHšts
.
add™iÚ®_ex‹nsiÚ_æag
);

2069 #undeà
PRINT_POST_FILTER_HINTS


2072 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

2074 (
b™¡»am
->
by‹_buf
) <<= 1;

2075 
b™¡»am
->
by‹_buf
 |= 1;

2076 
b™¡»am
->
b™s_to_go
--;

2077 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

2078 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

2079 
b™¡»am
->
b™s_to_go
 = 8;

2080 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

2081 
b™¡»am
->
by‹_buf
 = 0;

2083 
p_SEI
->
£iPo¡Fž‹rHšts
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

2084 
	}
}

2086 
	$Clo£Po¡Fž‹rHšts
(
SEIP¬am‘”s
 *
p_SEI
)

2088 ià(
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
)

2090 
	`ä“
(
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
->
¡»amBufãr
);

2091 
	`ä“
(
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
);

2092 ià(
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt
)

2093 
	`ä“_mem3Dšt
(
p_SEI
->
£iPo¡Fž‹rHšts
.
fž‹r_hšt
);

2095 
p_SEI
->
£iPo¡Fž‹rHšts
.
d©a
 = 
NULL
;

2096 
	}
}

2104 
	$Wr™e_SEI_NALU
(
VideoP¬am‘”s
 *
p_Vid
, 
Ën
)

2106 
NALU_t
 *
Çlu
 = 
NULL
;

2107 
RBSPËn
 = 0;

2108 
by‹
 *
rb¥
;

2110 ià(
	`HaveAgg»g©iÚSEI
(
p_Vid
))

2112 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2114 
Çlu
 = 
	`AÎocNALU
(
MAXNALUSIZE
);

2115 
rb¥
 = 
p_SEI
->
£i_mes§ge
[
AGGREGATION_SEI
].
d©a
;

2116 
RBSPËn
 = 
p_SEI
->
£i_mes§ge
[
AGGREGATION_SEI
].
·ylßdSize
;

2117 
	`RBSPtoNALU
 (
rb¥
, 
Çlu
, 
RBSPËn
, 
NALU_TYPE_SEI
, 
NALU_PRIORITY_DISPOSABLE
, 1);

2118 
Çlu
->
¡¬tcod•»fix_Ën
 = 4;

2120 
Ën
 +ð
p_Vid
->
	`Wr™eNALU
 (p_Vid, 
Çlu
,…_Vid->
f_out
);

2121 
	`F»eNALU
 (
Çlu
);

2124  
Ën
;

2125 
	}
}

2134 
	$In™BufãršgP”iod
(
VideoP¬am‘”s
 *
p_Vid
)

2136 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2137 
p_SEI
->
£iBufãršgP”iod
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

2138 ifÐ
p_SEI
->
£iBufãršgP”iod
.
d©a
 =ð
NULL
 )

2139 
	`no_mem_ex™
("InitBufferingPeriod: seiBufferingPeriod.data");

2141 
p_SEI
->
£iBufãršgP”iod
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

2142 ifÐ
p_SEI
->
£iBufãršgP”iod
.
d©a
->
¡»amBufãr
 =ð
NULL
 )

2143 
	`no_mem_ex™
("InitBufferingPeriod: seiBufferingPeriod.data->streamBuffer");

2145 
	`CË¬BufãršgP”iod
(
p_SEI
, 
p_Vid
->
aùive_¥s
);

2146 
	}
}

2148 
	$CË¬BufãršgP”iod
(
SEIP¬am‘”s
 *
p_SEI
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
)

2150 
SchedS–Idx
;

2151 
	`mem£t
Ð
p_SEI
->
£iBufãršgP”iod
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

2153 
p_SEI
->
£iBufãršgP”iod
.
d©a
->
b™s_to_go
 = 8;

2154 
p_SEI
->
£iBufãršgP”iod
.
d©a
->
by‹_pos
 = 0;

2155 
p_SEI
->
£iBufãršgP”iod
.
d©a
->
by‹_buf
 = 0;

2156 
p_SEI
->
£iBufãršgP”iod
.
·ylßdSize
 = 0;

2158 
p_SEI
->
£iBufãršgP”iod
.
£q_·¿m‘”_£t_id
 = 
aùive_¥s
->seq_parameter_set_id;

2159 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
 )

2161  
SchedS–Idx
 = 0; SchedS–Idx <ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
.
ýb_út_mšus1
; SchedSelIdx++ )

2163 
p_SEI
->
£iBufãršgP”iod
.
Çl_š™Ÿl_ýb_»mov®_d–ay
[
SchedS–Idx
] = 0;

2164 
p_SEI
->
£iBufãršgP”iod
.
Çl_š™Ÿl_ýb_»mov®_d–ay_off£t
[
SchedS–Idx
] = 0;

2167 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

2169  
SchedS–Idx
 = 0; SchedS–Idx <ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
.
ýb_út_mšus1
; SchedSelIdx++ )

2171 
p_SEI
->
£iBufãršgP”iod
.
vþ_š™Ÿl_ýb_»mov®_d–ay
[
SchedS–Idx
] = 0;

2172 
p_SEI
->
£iBufãršgP”iod
.
vþ_š™Ÿl_ýb_»mov®_d–ay_off£t
[
SchedS–Idx
] = 0;

2176 
p_SEI
->
£iHasBufãršgP”iod_šfo
 = 
FALSE
;

2177 
	}
}

2179 
	$Upd©eBufãršgP”iod
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2181 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2182 
p_SEI
->
£iHasBufãršgP”iod_šfo
 = 
FALSE
;

2183 
	}
}

2185 
	$Fš®izeBufãršgP”iod
(
SEIP¬am‘”s
 *
p_SEI
, 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
)

2187 
SchedS–Idx
;

2188 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iBufãršgP”iod
.
d©a
;

2190 
	`wr™e_ue_v
Ð"SEI: seq_·¿m‘”_£t_id", 
p_SEI
->
£iBufãršgP”iod
.
£q_·¿m‘”_£t_id
, 
b™¡»am
);

2191 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
 )

2193  
SchedS–Idx
 = 0; SchedS–Idx <ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
.
ýb_út_mšus1
; SchedSelIdx++ )

2195 
	`wr™e_u_v
Ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
.
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 + 1,

2196 "SEI: in™Ÿl_ýb_»mov®_d–ay", 
p_SEI
->
£iBufãršgP”iod
.
Çl_š™Ÿl_ýb_»mov®_d–ay
[
SchedS–Idx
], 
b™¡»am
);

2197 
	`wr™e_u_v
Ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
.
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 + 1,

2198 "SEI: in™Ÿl_ýb_»mov®_d–ay_off£t", 
p_SEI
->
£iBufãršgP”iod
.
Çl_š™Ÿl_ýb_»mov®_d–ay_off£t
[
SchedS–Idx
], 
b™¡»am
);

2201 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
 )

2203  
SchedS–Idx
 = 0; SchedS–Idx <ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
.
ýb_út_mšus1
; SchedSelIdx++ )

2205 
	`wr™e_u_v
Ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
.
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 + 1,

2206 "SEI: in™Ÿl_ýb_»mov®_d–ay", 
p_SEI
->
£iBufãršgP”iod
.
vþ_š™Ÿl_ýb_»mov®_d–ay
[
SchedS–Idx
], 
b™¡»am
);

2207 
	`wr™e_u_v
Ð
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
.
š™Ÿl_ýb_»mov®_d–ay_Ëngth_mšus1
 + 1,

2208 "SEI: in™Ÿl_ýb_»mov®_d–ay_off£t", 
p_SEI
->
£iBufãršgP”iod
.
vþ_š™Ÿl_ýb_»mov®_d–ay_off£t
[
SchedS–Idx
], 
b™¡»am
);

2213 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

2215 (
b™¡»am
->
by‹_buf
) <<= 1;

2216 
b™¡»am
->
by‹_buf
 |= 1;

2217 
b™¡»am
->
b™s_to_go
--;

2218 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

2219 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

2220 
b™¡»am
->
b™s_to_go
 = 8;

2221 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

2222 
b™¡»am
->
by‹_buf
 = 0;

2224 
p_SEI
->
£iBufãršgP”iod
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

2225 
	}
}

2227 
	$Clo£BufãršgP”iod
(
SEIP¬am‘”s
 *
p_SEI
)

2229 ià(
p_SEI
->
£iBufãršgP”iod
.
d©a
)

2231 
	`ä“
(
p_SEI
->
£iBufãršgP”iod
.
d©a
->
¡»amBufãr
);

2232 
	`ä“
(
p_SEI
->
£iBufãršgP”iod
.
d©a
);

2234 
p_SEI
->
£iBufãršgP”iod
.
d©a
 = 
NULL
;

2235 
	}
}

2243 
	$In™PicTimšg
(
SEIP¬am‘”s
 *
p_SEI
)

2245 
p_SEI
->
£iPicTimšg
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

2246 ifÐ
p_SEI
->
£iPicTimšg
.
d©a
 =ð
NULL
 )

2247 
	`no_mem_ex™
("InitPicTiming: seiPicTiming.data");

2249 
p_SEI
->
£iPicTimšg
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

2250 ifÐ
p_SEI
->
£iPicTimšg
.
d©a
->
¡»amBufãr
 =ð
NULL
 )

2251 
	`no_mem_ex™
("InitPicTiming: seiPicTiming.data->streamBuffer");

2253 
	`CË¬PicTimšg
(
p_SEI
);

2254 
	}
}

2262 
	$CË¬PicTimšg
(
SEIP¬am‘”s
 *
p_SEI
)

2264 
	`mem£t
Ð
p_SEI
->
£iPicTimšg
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

2266 
p_SEI
->
£iPicTimšg
.
d©a
->
b™s_to_go
 = 8;

2267 
p_SEI
->
£iPicTimšg
.
d©a
->
by‹_pos
 = 0;

2268 
p_SEI
->
£iPicTimšg
.
d©a
->
by‹_buf
 = 0;

2269 
p_SEI
->
£iPicTimšg
.
·ylßdSize
 = 0;

2272 
p_SEI
->
£iPicTimšg
.
ýb_»mov®_d–ay
 = 0;

2273 
p_SEI
->
£iPicTimšg
.
dpb_ouut_d–ay
 = 0;

2274 
p_SEI
->
£iPicTimšg
.
pic_¡ruù
 = 0;

2275 
	`mem£t
(
p_SEI
->
£iPicTimšg
.
þock_time¡amp_æag
, 0, 
MAX_PIC_STRUCT_VALUE
 * (
BoÞ—n
) );

2276 
p_SEI
->
£iPicTimšg
.
ù_ty³
 = 0;

2277 
p_SEI
->
£iPicTimšg
.
nu™_f›ld_ba£d_æag
 = 
FALSE
;

2278 
p_SEI
->
£iPicTimšg
.
couÁšg_ty³
 = 0;

2279 
p_SEI
->
£iPicTimšg
.
fuÎ_time¡amp_æag
 = 
FALSE
;

2280 
p_SEI
->
£iPicTimšg
.
discÚtšu™y_æag
 = 
FALSE
;

2281 
p_SEI
->
£iPicTimšg
.
út_drÝ³d_æag
 = 
FALSE
;

2282 
p_SEI
->
£iPicTimšg
.
n_äames
 = 0;

2283 
p_SEI
->
£iPicTimšg
.
£cÚds_v®ue
 = 0;

2284 
p_SEI
->
£iPicTimšg
.
mšu‹s_v®ue
 = 0;

2285 
p_SEI
->
£iPicTimšg
.
hours_v®ue
 = 0;

2286 
p_SEI
->
£iPicTimšg
.
£cÚds_æag
 = 
FALSE
;

2287 
p_SEI
->
£iPicTimšg
.
mšu‹s_æag
 = 
FALSE
;

2288 
p_SEI
->
£iPicTimšg
.
hours_æag
 = 
FALSE
;

2289 
p_SEI
->
£iPicTimšg
.
time_off£t
 = 0;

2291 
p_SEI
->
£iHasPicTimšg_šfo
 = 
FALSE
;

2292 
	}
}

2300 
	$g‘_pic_¡ruù
Ð
VideoP¬am‘”s
 *
p_Vid
, 
äame_no
, 
f›ld_pic_æag
, 
tÝ
 )

2302 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

2304 iàÐ
f›ld_pic_æag
 )

2306 iàÐ
tÝ
 )

2317 iàÐ!
p_IÅ
->
SEIVUI32PuÎdown
 )

2323 
Üd”
 = (
äame_no
 % 4);

2324 
pic_¡ruù_a
[4] = {0,5,6,0};

2325 
pic_¡ruù_b
[4] = {0,0,7,0};

2326 
pic_¡ruù_c
[4] = {3,5,6,3};

2327 
pic_¡ruù_d
[4] = {0,5,4,6};

2328 
pic_¡ruù_e
[4] = {3,5,4,6};

2330  
p_IÅ
->
SEIVUI32PuÎdown
 )

2334  
pic_¡ruù_a
[
Üd”
];

2337  
pic_¡ruù_b
[
Üd”
];

2340  
pic_¡ruù_c
[
Üd”
];

2343  
pic_¡ruù_d
[
Üd”
];

2346  
pic_¡ruù_e
[
Üd”
];

2351 
	}
}

2360 
	$Upd©ePicTimšg
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2362 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2363 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

2366 iàÐ
p_IÅ
->
SEIVUI32PuÎdown
 )

2368 
æd_æag
 = 
p_Vid
->fld_flag;

2370 
p_Vid
->
pic_¡ruù
 = 
	`g‘_pic_¡ruù
Ðp_Vid,…_Vid->
äm_no_š_fže
, 
æd_æag
, (p_Vid->
¡ruùu»
 =ð
TOP_FIELD
) ? 1 : 0 );

2372 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
pic_¡ruù_´e£Á_æag
 )

2374 
NumClockTS
 = 0, 
i
;

2375 
bÙtom_f›ld_æag
 = (
p_Vid
->
¡ruùu»
 =ð
BOTTOM_FIELD
);

2376 
p_SEI
->
£iPicTimšg
.
pic_¡ruù
 = 
p_Vid
->pic_struct;

2378  
p_SEI
->
£iPicTimšg
.
pic_¡ruù
 )

2383 
	`as£¹
Ð
æd_æag
 =ð
FALSE
 );

2384 
NumClockTS
 = 1;

2388 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
TRUE
è&& (
bÙtom_f›ld_æag
 =ð
FALSE
) );

2389 
NumClockTS
 = 1;

2393 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
TRUE
è&& (
bÙtom_f›ld_æag
 == TRUE) );

2394 
NumClockTS
 = 1;

2400 
	`as£¹
Ð
p_Vid
->
æd_æag
 =ð
FALSE
 );

2401 
NumClockTS
 = 2;

2407 
	`as£¹
Ð
p_Vid
->
æd_æag
 =ð
FALSE
 );

2408 
NumClockTS
 = 3;

2411 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
FALSE
è&& 
aùive_¥s
->
vui_£q_·¿m‘”s
.
fixed_äame_¿‹_æag
 == 1 );

2412 
NumClockTS
 = 2;

2416 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
FALSE
è&& 
aùive_¥s
->
vui_£q_·¿m‘”s
.
fixed_äame_¿‹_æag
 == 1 );

2417 
NumClockTS
 = 3;

2420  
i
 = 0; i < 
NumClockTS
; i++ )

2422 
p_SEI
->
£iPicTimšg
.
þock_time¡amp_æag
[
i
] = 
FALSE
;

2423 iàÐ
p_SEI
->
£iPicTimšg
.
þock_time¡amp_æag
[
i
] )

2425 
£cÚds
 = 0;

2426 
mšu‹s
 = 0;

2427 
hours
 = 0;

2428 
time_off£t_Ëngth
;

2429 
	`as£¹
Ð
£cÚds
 >= 0 && seconds <= 59 );

2430 
	`as£¹
Ð
mšu‹s
 >= 0 && minutes <= 59 );

2431 
	`as£¹
Ð
hours
 >= 0 && hours <= 23 );

2433 
p_SEI
->
£iPicTimšg
.
ù_ty³
 = 0;

2434 
p_SEI
->
£iPicTimšg
.
nu™_f›ld_ba£d_æag
 = 
FALSE
;

2435 
p_SEI
->
£iPicTimšg
.
couÁšg_ty³
 = 0;

2436 
p_SEI
->
£iPicTimšg
.
fuÎ_time¡amp_æag
 = 
FALSE
;

2437 
p_SEI
->
£iPicTimšg
.
discÚtšu™y_æag
 = 
FALSE
;

2438 
p_SEI
->
£iPicTimšg
.
út_drÝ³d_æag
 = 
FALSE
;

2439 
p_SEI
->
£iPicTimšg
.
n_äames
 = 0;

2441 iàÐ
p_SEI
->
£iPicTimšg
.
fuÎ_time¡amp_æag
 )

2443 
p_SEI
->
£iPicTimšg
.
£cÚds_v®ue
 = 
£cÚds
;

2444 
p_SEI
->
£iPicTimšg
.
mšu‹s_v®ue
 = 
mšu‹s
;

2445 
p_SEI
->
£iPicTimšg
.
hours_v®ue
 = 
hours
;

2449 
p_SEI
->
£iPicTimšg
.
£cÚds_æag
 = 
FALSE
;

2450 ià(
p_SEI
->
£iPicTimšg
.
£cÚds_æag
)

2452 
p_SEI
->
£iPicTimšg
.
£cÚds_v®ue
 = 
£cÚds
;

2453 
p_SEI
->
£iPicTimšg
.
mšu‹s_æag
 = 
FALSE
;

2454 ià(
p_SEI
->
£iPicTimšg
.
mšu‹s_æag
)

2456 
p_SEI
->
£iPicTimšg
.
mšu‹s_v®ue
 = 
mšu‹s
;

2457 
p_SEI
->
£iPicTimšg
.
hours_æag
 = 
FALSE
;

2458 ià(
p_SEI
->
£iPicTimšg
.
hours_æag
)

2460 
p_SEI
->
£iPicTimšg
.
hours_v®ue
 = 
hours
;

2465 ià(
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
)

2466 
time_off£t_Ëngth
 = 
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
.time_offset_length;

2467 ià(
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
)

2468 
time_off£t_Ëngth
 = 
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
.time_offset_length;

2470 
time_off£t_Ëngth
 = 24;

2471 iàÐ
time_off£t_Ëngth
 )

2473 
p_SEI
->
£iPicTimšg
.
time_off£t
 = 0;

2478 
p_SEI
->
£iHasPicTimšg_šfo
 = 
TRUE
;

2482 
p_SEI
->
£iHasPicTimšg_šfo
 = 
FALSE
;

2484 
	}
}

2492 
	$Fš®izePicTimšg
(
VideoP¬am‘”s
 *
p_Vid
)

2494 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2495 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

2497 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iPicTimšg
.
d©a
;

2499 
BoÞ—n
 
CpbDpbD–aysP»£ÁFÏg
 = (BoÞ—nè(
aùive_¥s
->
vui_·¿m‘”s_´e£Á_æag


2500 && ( (
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
 != 0)

2501 ||(
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
 != 0)));

2502 
hrd_·¿m‘”s_t
 *
hrd
 = 
NULL
;

2504 ià(
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s_´e£Á_æag
)

2506 
hrd
 = &(
aùive_¥s
->
vui_£q_·¿m‘”s
.
vþ_hrd_·¿m‘”s
);

2508 ià(
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s_´e£Á_æag
)

2510 
hrd
 = &(
aùive_¥s
->
vui_£q_·¿m‘”s
.
Çl_hrd_·¿m‘”s
);

2514 
hrd
 = 
NULL
;

2517 iàÐ
CpbDpbD–aysP»£ÁFÏg
 )

2519 
	`wr™e_u_v
Ð
hrd
->
ýb_»mov®_d–ay_Ëngth_mšus1
 + 1, "SEI: cpb_»mov®_d–ay", 
p_SEI
->
£iPicTimšg
.
ýb_»mov®_d–ay
, 
b™¡»am
);

2520 
	`wr™e_u_v
Ð
hrd
->
dpb_ouut_d–ay_Ëngth_mšus1
 + 1, "SEI: dpb_ouut_d–ay", 
p_SEI
->
£iPicTimšg
.
dpb_ouut_d–ay
, 
b™¡»am
);

2522 iàÐ
aùive_¥s
->
vui_£q_·¿m‘”s
.
pic_¡ruù_´e£Á_æag
 )

2524 
NumClockTS
 = 0, 
i
;

2525 
bÙtom_f›ld_æag
 = (
p_Vid
->
¡ruùu»
 =ð
BOTTOM_FIELD
);

2527 
	`wr™e_u_v
Ð4, "SEI:…ic_¡ruù", 
p_SEI
->
£iPicTimšg
.
pic_¡ruù
, 
b™¡»am
);

2529  
p_SEI
->
£iPicTimšg
.
pic_¡ruù
 )

2534 
	`as£¹
Ð
p_Vid
->
æd_æag
 =ð
FALSE
 );

2535 
NumClockTS
 = 1;

2539 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
TRUE
è&& (
bÙtom_f›ld_æag
 =ð
FALSE
) );

2540 
NumClockTS
 = 1;

2544 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
TRUE
è&& (
bÙtom_f›ld_æag
 == TRUE) );

2545 
NumClockTS
 = 1;

2551 
	`as£¹
Ð
p_Vid
->
æd_æag
 =ð
FALSE
 );

2552 
NumClockTS
 = 2;

2558 
	`as£¹
Ð
p_Vid
->
æd_æag
 =ð
FALSE
 );

2559 
NumClockTS
 = 3;

2563 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
FALSE
è&& 
aùive_¥s
->
vui_£q_·¿m‘”s
.
fixed_äame_¿‹_æag
 == 1 );

2564 
NumClockTS
 = 2;

2568 
	`as£¹
Ð(
p_Vid
->
æd_æag
 =ð
FALSE
è&& 
aùive_¥s
->
vui_£q_·¿m‘”s
.
fixed_äame_¿‹_æag
 == 1 );

2569 
NumClockTS
 = 3;

2572  
i
 = 0; i < 
NumClockTS
; i++ )

2574 
	`wr™e_u_1
Ð"SEI: clock_time¡amp_æag", 
p_SEI
->
£iPicTimšg
.
þock_time¡amp_æag
[
i
], 
b™¡»am
);

2575 iàÐ
p_SEI
->
£iPicTimšg
.
þock_time¡amp_æag
[
i
] )

2577 
	`wr™e_u_v
Ð2, "SEI: ct_ty³", 
p_SEI
->
£iPicTimšg
.
ù_ty³
, 
b™¡»am
);

2578 
	`wr™e_u_1
Ð"SEI:‚u™_f›ld_ba£d_æag", 
p_SEI
->
£iPicTimšg
.
nu™_f›ld_ba£d_æag
, 
b™¡»am
);

2579 
	`wr™e_u_v
Ð5, "SEI: couÁšg_ty³", 
p_SEI
->
£iPicTimšg
.
couÁšg_ty³
, 
b™¡»am
);

2580 
	`wr™e_u_1
Ð"SEI: fuÎ_time¡amp_æag", 
p_SEI
->
£iPicTimšg
.
fuÎ_time¡amp_æag
, 
b™¡»am
);

2581 
	`wr™e_u_1
Ð"SEI: discÚtšu™y_æag", 
p_SEI
->
£iPicTimšg
.
discÚtšu™y_æag
, 
b™¡»am
);

2582 
	`wr™e_u_1
Ð"SEI: cÁ_drÝ³d_æag", 
p_SEI
->
£iPicTimšg
.
út_drÝ³d_æag
, 
b™¡»am
);

2583 
	`wr™e_u_v
Ð8, "SEI:‚_äames", 
p_SEI
->
£iPicTimšg
.
n_äames
, 
b™¡»am
);

2585 iàÐ
p_SEI
->
£iPicTimšg
.
fuÎ_time¡amp_æag
 )

2587 
	`wr™e_u_v
Ð6, "SEI: secÚds_v®ue", 
p_SEI
->
£iPicTimšg
.
£cÚds_v®ue
, 
b™¡»am
);

2588 
	`wr™e_u_v
Ð6, "SEI: mšu‹s_v®ue", 
p_SEI
->
£iPicTimšg
.
mšu‹s_v®ue
, 
b™¡»am
);

2589 
	`wr™e_u_v
Ð5, "SEI: hours_v®ue", 
p_SEI
->
£iPicTimšg
.
hours_v®ue
, 
b™¡»am
);

2593 
	`wr™e_u_1
Ð"SEI: secÚds_æag", 
p_SEI
->
£iPicTimšg
.
£cÚds_æag
, 
b™¡»am
);

2594 ià(
p_SEI
->
£iPicTimšg
.
£cÚds_æag
)

2596 
	`wr™e_u_v
Ð6, "SEI: secÚds_v®ue", 
p_SEI
->
£iPicTimšg
.
£cÚds_v®ue
, 
b™¡»am
);

2597 
	`wr™e_u_1
Ð"SEI: mšu‹s_æag", 
p_SEI
->
£iPicTimšg
.
mšu‹s_æag
, 
b™¡»am
);

2598 ià(
p_SEI
->
£iPicTimšg
.
mšu‹s_æag
)

2600 
	`wr™e_u_v
Ð6, "SEI: mšu‹s_v®ue", 
p_SEI
->
£iPicTimšg
.
mšu‹s_v®ue
, 
b™¡»am
);

2601 
	`wr™e_u_1
Ð"SEI: hours_æag", 
p_SEI
->
£iPicTimšg
.
hours_æag
, 
b™¡»am
);

2602 ià(
p_SEI
->
£iPicTimšg
.
hours_æag
)

2604 
	`wr™e_u_v
Ð5, "SEI: hours_v®ue", 
p_SEI
->
£iPicTimšg
.
hours_v®ue
, 
b™¡»am
);

2609 iàÐ
hrd
 =ð
NULL
 )

2611 
	`wr™e_u_v
Ð24, "SEI:ime_off£t", 
p_SEI
->
£iPicTimšg
.
time_off£t
, 
b™¡»am
);

2615 
	`wr™e_u_v
Ð
hrd
->
time_off£t_Ëngth
, "SEI:ime_off£t", 
p_SEI
->
£iPicTimšg
.
time_off£t
, 
b™¡»am
);

2622 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

2624 (
b™¡»am
->
by‹_buf
) <<= 1;

2625 
b™¡»am
->
by‹_buf
 |= 1;

2626 
b™¡»am
->
b™s_to_go
--;

2627 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

2628 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

2629 
b™¡»am
->
b™s_to_go
 = 8;

2630 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

2631 
b™¡»am
->
by‹_buf
 = 0;

2633 
p_SEI
->
£iPicTimšg
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

2634 
	}
}

2642 
	$Clo£PicTimšg
(
SEIP¬am‘”s
 *
p_SEI
)

2644 ià(
p_SEI
->
£iPicTimšg
.
d©a
)

2646 
	`ä“
(
p_SEI
->
£iPicTimšg
.
d©a
->
¡»amBufãr
);

2647 
	`ä“
(
p_SEI
->
£iPicTimšg
.
d©a
);

2649 
p_SEI
->
£iPicTimšg
.
d©a
 = 
NULL
;

2650 
	}
}

2661 
	$In™F¿mePackšgA¼ªgem’t
(
VideoP¬am‘”s
 *
p_Vid
)

2663 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2665 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

2666 ifÐ
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
 =ð
NULL
 )

2667 
	`no_mem_ex™
("InitFramePackingArrangement: seiFramePackingArrangement.data");

2669 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

2670 ifÐ
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
¡»amBufãr
 =ð
NULL
 )

2671 
	`no_mem_ex™
("InitFramePackingArrangement: seiFramePackingArrangement.data->streamBuffer");

2673 
	`CË¬F¿mePackšgA¼ªgem’t
(
p_SEI
);

2674 
	}
}

2676 
	$CË¬F¿mePackšgA¼ªgem’t
(
SEIP¬am‘”s
 *
p_SEI
)

2678 
	`mem£t
Ð
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

2680 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
b™s_to_go
 = 8;

2681 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
by‹_pos
 = 0;

2682 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
by‹_buf
 = 0;

2683 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
·ylßdSize
 = 0;

2685 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_id
 = 0;

2686 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ÿnûl_æag
 = 
FALSE
;

2687 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ty³
 = 0;

2688 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
qušcunx_§m¶šg_æag
 = 
FALSE
;

2689 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
cÚ‹Á_š‹½»tiÚ_ty³
 = 0;

2690 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
¥©Ÿl_æpšg_æag
 = 
FALSE
;

2691 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_æ³d_æag
 = 
FALSE
;

2692 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
f›ld_v›ws_æag
 = 
FALSE
;

2693 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
cu¼’t_äame_is_äame0_æag
 = 
FALSE
;

2694 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_£lf_cÚšed_æag
 = 
FALSE
;

2695 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame1_£lf_cÚšed_æag
 = 
FALSE
;

2700 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_»£rved_by‹
 = 0;

2701 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_»³t™iÚ_³riod
 = 0;

2702 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ex‹nsiÚ_æag
 = 
FALSE
;

2704 
p_SEI
->
£iHasF¿mePackšgA¼ªgem’t_šfo
 = 
FALSE
;

2705 
	}
}

2707 
	$Upd©eF¿mePackšgA¼ªgem’t
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2709 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2711 
p_SEI
->
£iHasF¿mePackšgA¼ªgem’t_šfo
 = 
FALSE
;

2712 iàÐ
p_IÅ
->
SEIFPATy³
 != -1 )

2714 
p_SEI
->
£iHasF¿mePackšgA¼ªgem’t_šfo
 = 
TRUE
;

2715 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ty³
 = 
p_IÅ
->
SEIFPATy³
;

2717 
	}
}

2719 
	$Fš®izeF¿mePackšgA¼ªgem’t
(
SEIP¬am‘”s
 *
p_SEI
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2721 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
;

2723 
	`wr™e_ue_v
Ð"SEI: f¿me_·ckšg_¬¿ngem’t_id", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_id
, 
b™¡»am
 );

2724 
	`wr™e_u_1
Ð"SEI: f¿me_·ckšg_¬¿ngem’t_ÿnûl_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ÿnûl_æag
, 
b™¡»am
 );

2725 iàÐ
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ÿnûl_æag
 =ð
FALSE
 )

2727 
	`wr™e_u_v
Ð7, "SEI: f¿me_·ckšg_¬¿ngem’t_ty³", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ty³
, 
b™¡»am
 );

2728 
	`wr™e_u_1
Ð"SEI: qušcunx_§m¶šg_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
qušcunx_§m¶šg_æag
, 
b™¡»am
 );

2729 
	`wr™e_u_v
Ð6, "SEI: cÚ‹Á_š‹½»tiÚ_ty³", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
cÚ‹Á_š‹½»tiÚ_ty³
, 
b™¡»am
 );

2730 
	`wr™e_u_1
Ð"SEI: s·tŸl_æpšg_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
¥©Ÿl_æpšg_æag
, 
b™¡»am
 );

2731 
	`wr™e_u_1
Ð"SEI: f¿me0_æ³d_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_æ³d_æag
, 
b™¡»am
 );

2732 
	`wr™e_u_1
Ð"SEI: f›ld_v›ws_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
f›ld_v›ws_æag
, 
b™¡»am
 );

2733 
	`wr™e_u_1
Ð"SEI: cu¼’t_äame_is_äame0_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
cu¼’t_äame_is_äame0_æag
, 
b™¡»am
 );

2734 
	`wr™e_u_1
Ð"SEI: f¿me0_£lf_cÚšed_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_£lf_cÚšed_æag
, 
b™¡»am
 );

2735 
	`wr™e_u_1
Ð"SEI: f¿me1_£lf_cÚšed_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame1_£lf_cÚšed_æag
, 
b™¡»am
 );

2736 iàÐ
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
qušcunx_§m¶šg_æag
 =ð
FALSE
 &&…_SEI->£iF¿mePackšgA¼ªgem’t.
äame_·ckšg_¬¿ngem’t_ty³
 != 5 )

2738 
	`wr™e_u_v
Ð4, "SEI: f¿me0_grid_pos™iÚ_x", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_grid_pos™iÚ_x
, 
b™¡»am
 );

2739 
	`wr™e_u_v
Ð4, "SEI: f¿me0_grid_pos™iÚ_y", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame0_grid_pos™iÚ_y
, 
b™¡»am
 );

2740 
	`wr™e_u_v
Ð4, "SEI: f¿me1_grid_pos™iÚ_x", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame1_grid_pos™iÚ_x
, 
b™¡»am
 );

2741 
	`wr™e_u_v
Ð4, "SEI: f¿me1_grid_pos™iÚ_y", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame1_grid_pos™iÚ_y
, 
b™¡»am
 );

2745 
	`wr™e_u_v
Ð8, "SEI: f¿me_·ckšg_¬¿ngem’t_»£rved_by‹", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_»£rved_by‹
, 
b™¡»am
 );

2746 
	`wr™e_ue_v
Ð"SEI: f¿me_·ckšg_¬¿ngem’t_»³t™iÚ_³riod", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_»³t™iÚ_³riod
, 
b™¡»am
 );

2748 
	`wr™e_u_1
Ð"SEI: f¿me_·ckšg_¬¿ngem’t_ex‹nsiÚ_æag", ()
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
äame_·ckšg_¬¿ngem’t_ex‹nsiÚ_æag
, 
b™¡»am
 );

2751 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

2753 (
b™¡»am
->
by‹_buf
) <<= 1;

2754 
b™¡»am
->
by‹_buf
 |= 1;

2755 
b™¡»am
->
b™s_to_go
--;

2756 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

2757 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

2758 
b™¡»am
->
b™s_to_go
 = 8;

2759 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

2760 
b™¡»am
->
by‹_buf
 = 0;

2762 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

2763 
	}
}

2765 
	$Clo£F¿mePackšgA¼ªgem’t
(
SEIP¬am‘”s
 *
p_SEI
)

2767 ià(
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
)

2769 
	`ä“
(
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
¡»amBufãr
);

2770 
	`ä“
(
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
);

2772 
p_SEI
->
£iF¿mePackšgA¼ªgem’t
.
d©a
 = 
NULL
;

2773 
	}
}

2781 
	$In™DRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

2783 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
 = 
	`m®loc
Ð(
B™¡»am
) );

2784 ifÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
 =ð
NULL
 )

2785 
	`no_mem_ex™
("InitDRPMRepetition:…_SEI->seiDRPMRepetition.data");

2787 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
¡»amBufãr
 = 
	`m®loc
(
MAXRTPPAYLOADLEN
);

2788 ifÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
¡»amBufãr
 =ð
NULL
 )

2789 
	`no_mem_ex™
("InitDRPMRepetition:…_SEI->seiDRPMRepetition.data->streamBuffer");

2791 
	`CË¬DRPMR•‘™iÚ
(
p_SEI
);

2792 
	}
}

2800 
	$CË¬DRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

2802 
	`mem£t
Ð
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
¡»amBufãr
, 0, 
MAXRTPPAYLOADLEN
);

2804 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
b™s_to_go
 = 8;

2805 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
by‹_pos
 = 0;

2806 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
by‹_buf
 = 0;

2807 
p_SEI
->
£iDRPMR•‘™iÚ
.
·ylßdSize
 = 0;

2809 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_bÙtom_f›ld_æag
 = 
FALSE
;

2810 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_f›ld_pic_æag
 = 
FALSE
;

2811 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_äame_num
 = 0;

2812 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_idr_æag
 = 
FALSE
;

2813 iàÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 !ð
NULL
 )

2815 
	`ä“_d½m_bufãr
Ð
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 );

2816 
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 = 
NULL
;

2819 
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
 = 
FALSE
;

2820 
	}
}

2828 
	$Upd©eDRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

2830 iàÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 !ð
NULL
 )

2832 
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
 = 
TRUE
;

2836 
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
 = 
FALSE
;

2838 
	}
}

2846 
	$Fš®izeDRPMR•‘™iÚ
(
VideoP¬am‘”s
 *
p_Vid
)

2848 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2849 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

2851 
B™¡»am
 *
b™¡»am
 = 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
;

2854 
	`wr™e_u_1
Ð"SEI: origš®_idr_æag", 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_idr_æag
, 
b™¡»am
);

2855 
	`wr™e_ue_v
Ð"SEI: origš®_äame_num", 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_äame_num
, 
b™¡»am
);

2856 iàÐ!
aùive_¥s
->
äame_mbs_Úly_æag
 )

2858 
	`wr™e_u_1
Ð"SEI: origš®_f›ld_pic_æag", 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_f›ld_pic_æag
, 
b™¡»am
);

2859 iàÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_f›ld_pic_æag
 )

2861 
	`wr™e_u_1
Ð"SEI: origš®_bÙtom_f›ld_æag", 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_bÙtom_f›ld_æag
, 
b™¡»am
);

2865 
	`dec_»f_pic_m¬kšg
Ð
b™¡»am
,

2866 
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
,

2867 
p_SEI
->
£iDRPMR•‘™iÚ
.
Üigš®_idr_æag
, 0, 0);

2870 iàÐ
b™¡»am
->
b™s_to_go
 != 8 )

2872 (
b™¡»am
->
by‹_buf
) <<= 1;

2873 
b™¡»am
->
by‹_buf
 |= 1;

2874 
b™¡»am
->
b™s_to_go
--;

2875 iàÐ
b™¡»am
->
b™s_to_go
 != 0 )

2876 (
b™¡»am
->
by‹_buf
è<<ð(b™¡»am->
b™s_to_go
);

2877 
b™¡»am
->
b™s_to_go
 = 8;

2878 
b™¡»am
->
¡»amBufãr
[b™¡»am->
by‹_pos
++]=b™¡»am->
by‹_buf
;

2879 
b™¡»am
->
by‹_buf
 = 0;

2881 
p_SEI
->
£iDRPMR•‘™iÚ
.
·ylßdSize
 = 
b™¡»am
->
by‹_pos
;

2882 
	}
}

2890 
	$Clo£DRPMR•‘™iÚ
(
SEIP¬am‘”s
 *
p_SEI
)

2892 ià(
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
)

2894 
	`ä“
(
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
->
¡»amBufãr
);

2895 
	`ä“
(
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
);

2897 
p_SEI
->
£iDRPMR•‘™iÚ
.
d©a
 = 
NULL
;

2898 iàÐ
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 !ð
NULL
 )

2900 
	`ä“_d½m_bufãr
Ð
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 );

2901 
p_SEI
->
£iDRPMR•‘™iÚ
.
dec_»f_pic_m¬kšg_bufãr_§ved
 = 
NULL
;

2903 
	}
}

2916 
	$P»·»Agg»g©iÚSEIMes§ge
(
VideoP¬am‘”s
 *
p_Vid
)

2918 
SEIP¬am‘”s
 *
p_SEI
 = 
p_Vid
->p_SEI;

2919 
BoÞ—n
 
has_agg»g©iÚ_£i_mes§ge
 = 
FALSE
;

2921 
	`þ—r_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
);

2925 ià(
p_SEI
->
£iHasS·»Piùu»
 && 
p_Vid
->
ty³
 !ð
B_SLICE
)

2927 
	`Fš®izeS·»MBM­
(
p_Vid
);

2928 
	`as£¹
(
p_SEI
->
£iS·»Piùu»Paylßd
.
d©a
->
by‹_pos
 =ðp_SEI->£iS·»Piùu»Paylßd.
·ylßdSize
);

2929 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iS·»Piùu»Paylßd
.
d©a
->
¡»amBufãr
,…_SEI->£iS·»Piùu»Paylßd.
·ylßdSize
, 
SEI_SPARE_PIC
);

2930 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2933 ià(
p_SEI
->
£iHasSub£qInfo
)

2935 
	`Fš®izeSub£qInfo
(
p_SEI
, 
p_Vid
->
Ïy”
);

2936 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iSub£qInfo
[
p_Vid
->
Ïy”
].
d©a
->
¡»amBufãr
,…_SEI->£iSub£qInfo[p_Vid->Ïy”].
·ylßdSize
, 
SEI_SUB_SEQ_INFO
);

2937 
	`CË¬Sub£qInfoPaylßd
(
p_SEI
, 
p_Vid
->
Ïy”
);

2938 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2941 ià(
p_SEI
->
£iHasSub£qLay”Info
 && 
p_Vid
->
numb”
 == 0)

2943 
	`Fš®izeSub£qLay”Info
(
p_SEI
);

2944 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iSub£qLay”Info
.
d©a
,…_SEI->£iSub£qLay”Info.
·ylßdSize
, 
SEI_SUB_SEQ_LAYER_CHARACTERISTICS
);

2945 
p_SEI
->
£iHasSub£qLay”Info
 = 
FALSE
;

2946 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2949 ià(
p_SEI
->
£iHasSub£qCh¬
)

2951 
	`Fš®izeSub£qCh¬
(
p_SEI
);

2952 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iSub£qCh¬
.
d©a
->
¡»amBufãr
,…_SEI->£iSub£qCh¬.
·ylßdSize
, 
SEI_SUB_SEQ_CHARACTERISTICS
);

2953 
	`CË¬Sub£qCh¬Paylßd
(
p_SEI
);

2954 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2957 ià(
p_SEI
->
£iHasPªSÿnReùInfo
)

2959 
	`Fš®izePªSÿnReùInfo
(
p_SEI
);

2960 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iPªSÿnReùInfo
.
d©a
->
¡»amBufãr
,…_SEI->£iPªSÿnReùInfo.
·ylßdSize
, 
SEI_PAN_SCAN_RECT
);

2961 
	`CË¬PªSÿnReùInfoPaylßd
(
p_SEI
);

2962 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2965 ià(
p_SEI
->
£iHasU£r_d©a_uÄegi¡”ed_šfo
)

2967 
	`Fš®izeU£r_d©a_uÄegi¡”ed
(
p_SEI
);

2968 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iU£r_d©a_uÄegi¡”ed
.
d©a
->
¡»amBufãr
,…_SEI->£iU£r_d©a_uÄegi¡”ed.
·ylßdSize
, 
SEI_USER_DATA_UNREGISTERED
);

2969 
	`CË¬U£r_d©a_uÄegi¡”ed
(
p_SEI
);

2970 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2973 ià(
p_SEI
->
£iHasU£r_d©a_»gi¡”ed_™u_t_t35_šfo
)

2975 
	`Fš®izeU£r_d©a_»gi¡”ed_™u_t_t35
(
p_SEI
);

2976 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iU£r_d©a_»gi¡”ed_™u_t_t35
.
d©a
->
¡»amBufãr
,…_SEI->£iU£r_d©a_»gi¡”ed_™u_t_t35.
·ylßdSize
, 
SEI_USER_DATA_REGISTERED_ITU_T_T35
);

2977 
	`CË¬U£r_d©a_»gi¡”ed_™u_t_t35
(
p_SEI
);

2978 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2983 ià(
p_SEI
->
£iHasSûÃInfÜm©iÚ
)

2985 
	`Fš®izeSûÃInfÜm©iÚ
(
p_SEI
);

2986 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iSûÃInfÜm©iÚ
.
d©a
->
¡»amBufãr
,…_SEI->£iSûÃInfÜm©iÚ.
·ylßdSize
, 
SEI_SCENE_INFO
);

2987 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2990 ià(
p_SEI
->
£iHasTÚe_m­pšg
)

2992 
	`Fš®izeTÚeM­pšg
(
p_Vid
);

2993 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iTÚeM­pšg
.
d©a
->
¡»amBufãr
,…_SEI->£iTÚeM­pšg.
·ylßdSize
, 
SEI_TONE_MAPPING
);

2994 
	`CË¬TÚeM­pšg
(
p_SEI
);

2995 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

2998 ià(
p_SEI
->
£iHasPo¡Fž‹rHšts_šfo
)

3000 
	`Fš®izePo¡Fž‹rHšts
(
p_SEI
);

3001 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iPo¡Fž‹rHšts
.
d©a
->
¡»amBufãr
,…_SEI->£iPo¡Fž‹rHšts.
·ylßdSize
, 
SEI_POST_FILTER_HINTS
);

3002 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3005 ià(
p_SEI
->
£iHasBufãršgP”iod_šfo
)

3007 
	`Fš®izeBufãršgP”iod
(
p_SEI
, 
p_Vid
->
aùive_¥s
);

3008 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iBufãršgP”iod
.
d©a
->
¡»amBufãr
,…_SEI->£iBufãršgP”iod.
·ylßdSize
, 
SEI_BUFFERING_PERIOD
);

3009 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3012 ià(
p_SEI
->
£iHasPicTimšg_šfo
)

3014 
	`Fš®izePicTimšg
(
p_Vid
);

3015 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iPicTimšg
.
d©a
->
¡»amBufãr
,…_SEI->£iPicTimšg.
·ylßdSize
, 
SEI_PIC_TIMING
);

3016 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3019 ià(
p_SEI
->
£iHasRecov”yPošt_šfo
)

3021 
	`Fš®izeRªdomAcûss
(
p_SEI
);

3022 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iRecov”yPošt
.
d©a
->
¡»amBufãr
,…_SEI->£iRecov”yPošt.
·ylßdSize
, 
SEI_RECOVERY_POINT
);

3023 
	`CË¬RªdomAcûss
(
p_SEI
);

3024 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3027 ià(
p_SEI
->
£iHasDRPMR•‘™iÚ_šfo
)

3029 
	`Fš®izeDRPMR•‘™iÚ
(
p_Vid
);

3030 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iDRPMR•‘™iÚ
.
d©a
->
¡»amBufãr
,…_SEI->£iDRPMR•‘™iÚ.
·ylßdSize
, 
SEI_DEC_REF_PIC_MARKING_REPETITION
);

3031 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3032 
	`CË¬DRPMR•‘™iÚ
(
p_SEI
);

3035 ià(
p_SEI
->
£iHasF¿mePackšgA¼ªgem’t_šfo
)

3037 
	`Fš®izeF¿mePackšgA¼ªgem’t
(
p_SEI
, 
p_Vid
->
p_IÅ
);

3038 
	`wr™e_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
,…_SEI->
£iF¿mePackšgA¼ªgem’t
.
d©a
->
¡»amBufãr
,…_SEI->£iF¿mePackšgA¼ªgem’t.
·ylßdSize
, 
SEI_FRAME_PACKING_ARRANGEMENT
);

3039 
has_agg»g©iÚ_£i_mes§ge
 = 
TRUE
;

3043 ià(
has_agg»g©iÚ_£i_mes§ge
)

3045 
	`fš®ize_£i_mes§ge
(
p_SEI
, 
AGGREGATION_SEI
);

3047 
	}
}

3055 
	$ä“_d½m_bufãr
Ð
DecRefPicM¬kšg_t
 *
pDRPM
 )

3057 
DecRefPicM¬kšg_t
 *
pTmp
 = 
pDRPM
, *
pP»v
;

3059 ià(
pTmp
 =ð
NULL
)

3062  
pTmp
->
Next
 !ð
NULL
 )

3064 
pP»v
 = 
pTmp
;

3065 
pTmp
 =…Tmp->
Next
;

3066 
	`ä“
Ð
pP»v
 );

3068 
	`ä“
Ð
pTmp
 );

3069 
	}
}

	@lencod/src/slice.c

18 
	~"cÚŒibutÜs.h
"

20 
	~<m©h.h
>

21 
	~<æßt.h
>

23 
	~"glob®.h
"

24 
	~"h—d”.h
"

25 
	~"Çl.h
"

26 
	~"¹p.h
"

27 
	~"fmo.h
"

28 
	~"vlc.h
"

29 
	~"image.h
"

30 
	~"ÿbac.h
"

31 
	~"bŸr›ncode.h
"

32 
	~"–em’ts.h
"

33 
	~"maüoblock.h
"

34 
	~"mem®loc.h
"

35 
	~"mode_decisiÚ_p8x8.h
"

36 
	~"symbÞ.h
"

37 
	~"cÚ‹xt_ši.h
"

38 
	~"’c_¡©i¡ics.h
"

39 
	~"¿‹ùl.h
"

40 
	~"me_•zs.h
"

41 
	~"me_•zs_št.h
"

42 
	~"wp.h
"

43 
	~"¦iû.h
"

44 
	~"rdoq.h
"

45 
	~"wp_mý»c.h
"

46 
	~"q_off£ts.h
"

47 
	~"cÚfÜmªû.h
"

48 
	~"li¡_»Üd”.h
"

49 
	~"md_commÚ.h
"

50 
	~"mmco.h
"

51 
	~"mv_£¬ch.h
"

52 
	~"quªt4x4.h
"

53 
	~"quªt8x8.h
"

54 
	~"quªtChroma.h
"

55 
	~"rdÝt.h
"

56 
	~"rdÝt_codšg_¡©e.h
"

57 
	~"Ïmbda.h
"

58 
	~"šŒa4x4.h
"

59 
	~"šŒa8x8.h
"

60 
	~"šŒa16x16.h
"

61 
	~"mc_´ediùiÚ.h
"

62 
	~"rd_šŒa_jm.h
"

63 
	~"rd_šŒa_jm444.h
"

66 
Sliû
 *
m®loc_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

67 
Sliû
 *
m®loc_¦iû_l™e
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
);

69 
	$®loÿ‹_block_mem
(
Sliû
 *
cu¼Sliû
)

71 
®loc_size
 = 0;

72 
®loc_size
 +ð
	`g‘_mem2Dšt
(&
cu¼Sliû
->
tblk4x4
, 
BLOCK_SIZE
, BLOCK_SIZE);

73 
®loc_size
 +ð
	`g‘_mem2Dšt
(&
cu¼Sliû
->
tblk16x16
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

74 
®loc_size
 +ð
	`g‘_mem4Dšt
(&
cu¼Sliû
->
i16blk4x4
, 
BLOCK_SIZE
, BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);

76  (
®loc_size
);

77 
	}
}

80 
	$ä“_block_mem
(
Sliû
 *
cu¼Sliû
)

82 if(
cu¼Sliû
->
i16blk4x4
)

83 
	`ä“_mem4Dšt
(
cu¼Sliû
->
i16blk4x4
);

84 if(
cu¼Sliû
->
tblk16x16
)

85 
	`ä“_mem2Dšt
(
cu¼Sliû
->
tblk16x16
);

86 if(
cu¼Sliû
->
tblk4x4
)

87 
	`ä“_mem2Dšt
(
cu¼Sliû
->
tblk4x4
);

88 
	}
}

102 
	$CAVLC_š™
(
Sliû
 *
cu¼Sliû
)

104 
	`mem£t
(&
cu¼Sliû
->
p_Vid
->
nz_cÛff
[0][0][0], 0, cu¼Sliû->
PicSizeInMbs
 * 4 * (4 + cu¼Sliû->
num_blk8x8_uv
)* ());

105 
	}
}

107 
	$®loc_rdd©a
(
Sliû
 *
cu¼Sliû
, 
RD_DATA
 *
rd_d©a
)

109 
®loc_size
 = 0;

111 
®loc_size
 +ð
	`g‘_mem3D³l
(&(
rd_d©a
->
»c_mb
), 3, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

113 
®loc_size
 +ð
	`g‘_mem_ACcÛff
 (
cu¼Sliû
->
p_Vid
, &(
rd_d©a
->
cofAC
));

114 
®loc_size
 +ð
	`g‘_mem_DCcÛff
 (&(
rd_d©a
->
cofDC
));

116 ià((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
è&& cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

118 
®loc_size
 +ð
	`g‘_mem5Dmv
 (&(
rd_d©a
->
®l_mv
), 2, 
cu¼Sliû
->
max_num_»ã»nûs
, 9, 4, 4);

122 
®loc_size
 +ð
	`g‘_mem2D
((
by‹
***)&(
rd_d©a
->
»dmode
), 
cu¼Sliû
->
height_blk
, cu¼Sliû->
width_blk
);

123 
®loc_size
 +ð
	`g‘_mem3D
((
by‹
****)&(
rd_d©a
->
»çr
), 2, 4, 4);

125  
®loc_size
;

126 
	}
}

129 
	$nuÎify_rdd©a
(
RD_DATA
 *
rd_d©a
)

131 
rd_d©a
->
»c_mb
 = 
NULL
;

133 
rd_d©a
->
cofAC
 = 
NULL
;

134 
rd_d©a
->
cofDC
 = 
NULL
;

135 
rd_d©a
->
®l_mv
 = 
NULL
;

137 
rd_d©a
->
»dmode
 = 
NULL
;

138 
rd_d©a
->
»çr
 = 
NULL
;

140 
rd_d©a
->
®l_mv
 = 
NULL
;

141 
rd_d©a
->
b»d_mv
 = 
NULL
;

142 
	}
}

144 
	$ä“_rdd©a
(
Sliû
 *
cu¼Sliû
, 
RD_DATA
 *
rd_d©a
)

146 if(
rd_d©a
->
»çr
)

147 
	`ä“_mem3D
((
by‹
***è
rd_d©a
->
»çr
);

148 if(
rd_d©a
->
»dmode
)

149 
	`ä“_mem2D
((
by‹
**è
rd_d©a
->
»dmode
);

151 ià((
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
è&& cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

153 if(
rd_d©a
->
®l_mv
)

154 
	`ä“_mem5Dmv
 (
rd_d©a
->
®l_mv
);

157 if(
rd_d©a
->
cofDC
)

158 
	`ä“_mem_DCcÛff
 (
rd_d©a
->
cofDC
);

159 if(
rd_d©a
->
cofAC
)

160 
	`ä“_mem_ACcÛff
 (
rd_d©a
->
cofAC
);

162 if(
rd_d©a
->
»c_mb
)

163 
	`ä“_mem3D³l
(
rd_d©a
->
»c_mb
);

164 
	}
}

180 
	$¡¬t_¦iû
(
Sliû
 *
cu¼Sliû
, 
StP¬am‘”s
 *
cur_¡©s
)

182 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

183 
EncodšgEnvœÚm’tPŒ
 
“p
;

184 
B™¡»am
 *
cu¼SŒ—m
;

185 
h—d”_Ën
 = 0;

186 
i
;

187 
Numb”OfP¬t™iÚs
 = (
cu¼Sliû
->
·¹™iÚ_mode
 =ð
PAR_DP_1
?1:3);

190 if(
cu¼Sliû
->
idr_æag
)

192 
Numb”OfP¬t™iÚs
 = 1;

195 
	`RTPUpd©eTime¡amp
 (
p_Vid
, 
cu¼Sliû
->
äame_no
);

197 
i
 = 0; i < 
Numb”OfP¬t™iÚs
; i++)

199 
cu¼SŒ—m
 = (
cu¼Sliû
->
·¹A¼
[
i
]).
b™¡»am
;

201 
cu¼SŒ—m
->
wr™e_æag
 = 0;

202 ià(
i
==0)

203 
h—d”_Ën
 +ð
	`SliûH—d”
 (
cu¼Sliû
);

205 
h—d”_Ën
 +ð
	`P¬t™iÚ_BC_H—d”
(
cu¼Sliû
, 
i
);

208 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

210 
“p
 = &((
cu¼Sliû
->
·¹A¼
[
i
]).
“_ÿbac
);

211 ià(
cu¼SŒ—m
->
b™s_to_go
 != 8)

212 
h—d”_Ën
 +ð
cu¼SŒ—m
->
b™s_to_go
;

213 
	`wr™eVlcBy‹Align
(
p_Vid
, 
cu¼SŒ—m
, 
cur_¡©s
);

215 
“p
->
p_Vid
 =…_Vid;

216 
	`¬›nco_¡¬t_’codšg
(
“p
, 
cu¼SŒ—m
->
¡»amBufãr
, &(cu¼SŒ—m->
by‹_pos
));

218 
	`¬›nco_»£t_EC
(
“p
);

223 
	`CAVLC_š™
(
cu¼Sliû
);

227 if(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

229 
	`š™_cÚ‹xts
(
cu¼Sliû
);

232 #ià
MVC_EXTENSION_ENABLE


233 if(
p_Vid
->
p_IÅ
->
num_of_v›ws
 > 1 &&…_Vid->
v›w_id
 =ð1 && 
cu¼Sliû
->
Çl_»ã»nû_idc
 && cu¼Sliû->
¦iû_Ä
==0)

235 
i
=0; i<
cu¼Sliû
->
li¡Xsize
[0]; i++)

237 if(
cu¼Sliû
->
li¡X
[0][
i
]->
v›w_id
 == 0)

240 if(
i
<
cu¼Sliû
->
li¡Xsize
[0])

241 
p_Vid
->
’c_piùu»
->
»f_pic_Ç
[0] = 
i
;

242 
i
=0; i<
cu¼Sliû
->
li¡Xsize
[1]; i++)

244 if(
cu¼Sliû
->
li¡X
[1][
i
]->
v›w_id
 == 0)

247 if(
i
<
cu¼Sliû
->
li¡Xsize
[1])

248 
p_Vid
->
’c_piùu»
->
»f_pic_Ç
[1] = 
i
;

251  
h—d”_Ën
;

252 
	}
}

261 
	$ü—‹_¦iû_Çlus
(
Sliû
 *
cu¼Sliû
, 
is_bÙtom
)

265 
bufãr_size
 = 
cu¼Sliû
->
·¹A¼
[0].
b™¡»am
->buffer_size;

266 #ià(
MVC_EXTENSION_ENABLE
)

267 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

271 
·¹
;

272 
NALU_t
 *
Çlu
;

274 
·¹
=0;…¬t< 
cu¼Sliû
->
max_·¹_Ä
;…art++)

276 ià(
cu¼Sliû
->
·¹A¼
[
·¹
].
b™¡»am
->
wr™e_æag
)

278 
Çlu
 = 
	`AÎocNALU
(
bufãr_size
);

279 
cu¼Sliû
->
·¹A¼
[
·¹
].
Çl_un™
 = 
Çlu
;

280 
Çlu
->
¡¬tcod•»fix_Ën
 = 1+ (
cu¼Sliû
->
¡¬t_mb_Ä
 =ð0 && 
·¹
 =ð0 ?
ZEROBYTES_SHORTSTARTCODE
+1:ZEROBYTES_SHORTSTARTCODE);

281 
Çlu
->
fÜbidd’_b™
 = 0;

283 #ià(
MVC_EXTENSION_ENABLE
)

284 if(
p_Vid
->
num_of_Ïy”s
 == 2)

286 
Çlu
->
´iÜ™y_id
 = 
p_Vid
->priority_id;

287 
Çlu
->
v›w_id
 = 
p_Vid
->
dpb_Ïy”_id
;

288 
Çlu
->
‹mpÜ®_id
 = 
p_Vid
->temporal_id;

289 
Çlu
->
ªchÜ_pic_æag
 = 
p_Vid
->ªchÜ_pic_æag[
is_bÙtom
];

290 
Çlu
->
š‹r_v›w_æag
 = 
p_Vid
->š‹r_v›w_æag[
is_bÙtom
];

291 
Çlu
->
nÚ_idr_æag
 = !Çlu->
ªchÜ_pic_æag
;

292 
Çlu
->
»£rved_Úe_b™
 = 1;

296 ià(
cu¼Sliû
->
idr_æag
)

298 
Çlu
->
Çl_un™_ty³
 = 
NALU_TYPE_IDR
;

299 
Çlu
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_HIGHEST
;

304 if(
cu¼Sliû
->
·¹™iÚ_mode
 == 0)

306 #ià(
MVC_EXTENSION_ENABLE
)

307 if(
p_Vid
->
num_of_Ïy”s
 == 2)

309 
Çlu
->
Çl_un™_ty³
 = 
p_Vid
->
dpb_Ïy”_id
 ==0 ? 
NALU_TYPE_SLICE
 : 
NALU_TYPE_SLC_EXT
;

312 
Çlu
->
Çl_un™_ty³
 = 
NALU_TYPE_SLICE
;

314 
Çlu
->
Çl_un™_ty³
 = 
NALU_TYPE_SLICE
;

319 
Çlu
->
Çl_un™_ty³
 = (
N®uTy³
è(
NALU_TYPE_DPA
 + 
·¹
);

322 ià(
cu¼Sliû
->
Çl_»ã»nû_idc
 !=0)

324 
Çlu
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_HIGH
;

328 
Çlu
->
Çl_»ã»nû_idc
 = 
NALU_PRIORITY_DISPOSABLE
;

334 
cu¼Sliû
->
·¹A¼
[
·¹
].
Çl_un™
 = 
NULL
;

337 
	}
}

350 
	$‹rmš©e_¦iû
(
Maüoblock
 *
cu¼MB
, 
Ï¡¦iû
, 
StP¬am‘”s
 *
cur_¡©s
 )

352 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

353 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

355 
B™¡»am
 *
cu¼SŒ—m
;

356 
NALU_t
 *
cu¼N®u
;

357 
EncodšgEnvœÚm’tPŒ
 
“p
;

358 
·¹
;

359 
tmp_¡uffšgb™s
 = 
cu¼MB
->
b™s
.
mb_¡uffšg
;

361 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

362 
	`wr™e_‹rmš©šg_b™
 (
cu¼Sliû
, 1);

364 
	`ü—‹_¦iû_Çlus
(
cu¼Sliû
, 
p_Vid
->
¡ruùu»
 =ð
BOTTOM_FIELD
 ? 1 : 0);

366 
·¹
 = 0;…¬ˆ< 
cu¼Sliû
->
max_·¹_Ä
;…art++)

368 
cu¼SŒ—m
 = (
cu¼Sliû
->
·¹A¼
[
·¹
]).
b™¡»am
;

369 
cu¼N®u
 = (
cu¼Sliû
->
·¹A¼
[
·¹
]).
Çl_un™
;

370 ià(
cu¼SŒ—m
->
wr™e_æag
)

372 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

374 
	`SODBtoRBSP
(
cu¼SŒ—m
);

375 
cu¼N®u
->
Ën
 = 
	`RBSPtoEBSP
(cu¼N®u->
buf
, 
cu¼SŒ—m
->
¡»amBufãr
, cu¼SŒ—m->
by‹_pos
);

379 
“p
 = &((
cu¼Sliû
->
·¹A¼
[
·¹
]).
“_ÿbac
);

381 
	`¬›nco_dÚe_’codšg
(
cu¼MB
, 
“p
);

382 
	`£t_pic_bš_couÁ
(
p_Vid
, 
“p
);

384 
cu¼SŒ—m
->
b™s_to_go
 = 
“p
->
Eb™s_to_go
;

385 
cu¼SŒ—m
->
by‹_buf
 = 0;

387 
cu¼N®u
->
Ën
 = 
	`RBSPtoEBSP
(cu¼N®u->
buf
, 
cu¼SŒ—m
->
¡»amBufãr
, cu¼SŒ—m->
by‹_pos
);

390 
p_Vid
->
by‹s_š_piùu»
 +ð
cu¼N®u
->
Ën
 + 1;

392 ià(
Ï¡¦iû
 && (
·¹
==(
cu¼Sliû
->
max_·¹_Ä
 - 1)))

394 
	`addCabacZ”oWÜds
(
p_Vid
, 
cu¼N®u
, 
cur_¡©s
);

400 ifÐ
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
 )

402 
	`¡Üe_cÚ‹xts
(
cu¼Sliû
);

405 
cur_¡©s
->
b™_u£_¡uffšg_b™s
[
cu¼Sliû
->
¦iû_ty³
] +ð
cu¼MB
->
b™s
.
mb_¡uffšg
 - 
tmp_¡uffšgb™s
;

408 
	}
}

410 
	$š™_b»d_’abËd
(
VideoP¬am‘”s
 *
p_Vid
)

412 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

413 
mode
;

415 
	`mem£t
(
p_Vid
->
b»d_’abËd
, 0, ()*
MAXMODE
);

416 ià(
p_Vid
->
cu¼’tSliû
->
¦iû_ty³
 !ð
B_SLICE
 || !
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
)

419 
mode
 = 1; mode < 5; mode++)

420 
p_Vid
->
b»d_’abËd
[
mode
] = (
p_IÅ
->
BiP»dS—rch
[mode - 1]) ? 1: 0;

421 
	}
}

431 
	$’code_Úe_¦iû
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupId
, 
TÙ®CodedMBs
)

433 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

434 
BoÞ—n
 
’d_of_¦iû
 = 
FALSE
;

436 
Ën
;

437 
Numb”OfCodedMBs
 = 0;

438 
Maüoblock
* 
cu¼MB
 = 
NULL
;

439 
Cu¼’tMbAddr
;

440 
StP¬am‘”s
 *
cur_¡©s
 = &
p_Vid
->
’c_piùu»
->
¡©s
;

441 
Sliû
 *
cu¼Sliû
 = 
NULL
;

443 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

445 
	`chªge_¶ªe_JV
Ð
p_Vid
,…_Vid->
cÞour_¶ªe_id
 );

448 
p_Vid
->
cod_couÁ”
 = 0;

450 
Cu¼’tMbAddr
 = 
	`FmoG‘Fœ¡MaüoblockInSliû
 (
p_Vid
, 
SliûGroupId
);

453 
p_Vid
->
’c_piùu»
->
‹mpÜ®_Ïy”
 =…_Vid->
p_cu¼_äm_¡ruù
->temporal_layer;

454 
	`š™_¦iû
 (
p_Vid
, &
cu¼Sliû
, 
Cu¼’tMbAddr
);

455 
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 = 0;

456 
	`š™_b»d_’abËd
(
p_Vid
);

460 
	`š™_quªt_4x4
 (
cu¼Sliû
);

461 
	`š™_quªt_8x8
 (
cu¼Sliû
);

462 
	`š™_quªt_Chroma
(
cu¼Sliû
);

464 
cu¼Sliû
->
	`£t_Ïg¿ngŸn_muÉl›rs
(currSlice);

466 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

468 
	`S‘CtxMod–Numb”
 (
cu¼Sliû
);

471 
p_Vid
->
check»f
 = (è(
p_IÅ
->
rdÝt
 &&…_IÅ->
Re¡riùRef
 && (
cu¼Sliû
->
¦iû_ty³
==
P_SLICE
 || cu¼Sliû->¦iû_ty³==
SP_SLICE
));

473 
Ën
 = 
	`¡¬t_¦iû
 (
cu¼Sliû
, 
cur_¡©s
);

476 ià(
p_IÅ
->
RCEÇbË
)

477 
	`rc_¡Üe_¦iû_h—d”_b™s
Ð
p_Vid
, 
p_IÅ
, 
Ën
 );

480 
p_Vid
->
p_Sts
->
b™_¦iû
 +ð
Ën
;

481 
cur_¡©s
->
b™_u£_h—d”
[
cu¼Sliû
->
¦iû_ty³
] +ð
Ën
;

483 if(
cu¼Sliû
->
U£RDOQuªt
 =ð1 && cu¼Sliû->
RDOQ_QP_Num
 > 1)

484 
	`g‘_dQP_bË
(
cu¼Sliû
);

486 
’d_of_¦iû
 =ð
FALSE
)

488 
BoÞ—n
 
»code_maüoblock
 = 
FALSE
;

489 ià(
p_Vid
->
Ad­tiveRoundšg
 && 
p_IÅ
->
Ad­tRndP”iod
 && (p_Vid->
cu¼’t_mb_Ä
 %…_Inp->AdaptRndPeriod == 0))

491 
	`C®cuÏ‹Off£t4x4P¬am
(
p_Vid
);

492 if(
p_IÅ
->
T¿nsfÜm8x8Mode
)

493 
	`C®cuÏ‹Off£t8x8P¬am
(
p_Vid
);

496 if(
cu¼Sliû
->
U£RDOQuªt
)

497 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_Œ–lis_cu¼
;

499 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_tÝ_äame_mb
;

501 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
, 
FALSE
);

504 if(
cu¼Sliû
->
U£RDOQuªt
)

506 
	`Œ–lis_codšg
(
cu¼MB
);

510 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

512 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

513 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

515 
	`wr™e_maüoblock
 (
cu¼MB
, 1);

518 
	`’d_maüoblock
 (
cu¼MB
, &
’d_of_¦iû
, &
»code_maüoblock
);

519 
cu¼MB
->
´ev_»code_mb
 = 
»code_maüoblock
;

524 ià(
»code_maüoblock
 =ð
FALSE
)

526 
p_Vid
->
SumF¿meQP
 +ð
cu¼MB
->
qp
;

527 
Cu¼’tMbAddr
 = 
	`FmoG‘NextMBNr
 (
p_Vid
, CurrentMbAddr);

528 ià(
Cu¼’tMbAddr
 == -1)

531 
’d_of_¦iû
 = 
TRUE
;

533 
Numb”OfCodedMBs
++;

534 
	`Ãxt_maüoblock
 (
cu¼MB
);

539 
p_Vid
->
cu¼’t_mb_Ä
 = 
	`FmoG‘P»viousMBNr
(p_Vid,…_Vid->current_mb_nr);

540 
p_Vid
->
Numb”ofCodedMaüoBlocks
--;

541 if(
p_Vid
->
cu¼’t_mb_Ä
 == -1 )

544 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "Errorƒncoding first MB with specified…arameter, bits of current MB may beoo big");

545 
	`”rÜ
 (
”rÜ‹xt
, 300);

551 ià((
p_IÅ
->
WPI‹rMC
è&& (
p_Vid
->
äameOff£tAvaž
 =ð0è&&…_Vid->
Çl_»ã»nû_idc
)

553 
	`compu‹_off£t
(
cu¼Sliû
);

555 
p_Vid
->
num_»f_idx_l0_aùive
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
];

556 
p_Vid
->
num_»f_idx_l1_aùive
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
];

558 
	`‹rmš©e_¦iû
 (
cu¼MB
, (
Numb”OfCodedMBs
 + 
TÙ®CodedMBs
 >ð()
p_Vid
->
PicSizeInMbs
), 
cur_¡©s
 );

559  
Numb”OfCodedMBs
;

560 
	}
}

571 
	$’code_Úe_¦iû_MBAFF
 (
VideoP¬am‘”s
 *
p_Vid
, 
SliûGroupId
, 
TÙ®CodedMBs
)

573 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

574 
BoÞ—n
 
’d_of_¦iû
 = 
FALSE
;

575 
BoÞ—n
 
»code_maüoblock
;

576 
Ën
;

577 
Numb”OfCodedMBs
 = 0;

578 
Maüoblock
* 
cu¼MB
 = 
NULL
;

579 
Cu¼’tMbAddr
;

580 
F¿meRDCo¡
 = 
DBL_MAX
, 
F›ldRDCo¡
 = DBL_MAX;

581 
StP¬am‘”s
 *
cur_¡©s
 = &
p_Vid
->
’c_piùu»
->
¡©s
;

582 
Sliû
 *
cu¼Sliû
 = 
NULL
;

584 ifÐ(
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) )

586 
	`chªge_¶ªe_JV
Ð
p_Vid
,…_Vid->
cÞour_¶ªe_id
 );

589 
p_Vid
->
cod_couÁ”
 = 0;

591 
Cu¼’tMbAddr
 = 
	`FmoG‘Fœ¡MaüoblockInSliû
 (
p_Vid
, 
SliûGroupId
);

594 
	`š™_¦iû
 (
p_Vid
, &
cu¼Sliû
, 
Cu¼’tMbAddr
);

595 
cu¼Sliû
->
rdoq_mÙiÚ_cÝy
 = 0;

596 
	`š™_b»d_’abËd
(
p_Vid
);

600 
	`š™_quªt_4x4
 (
cu¼Sliû
);

601 
	`š™_quªt_8x8
 (
cu¼Sliû
);

602 
	`š™_quªt_Chroma
(
cu¼Sliû
);

604 
cu¼Sliû
->
	`£t_Ïg¿ngŸn_muÉl›rs
(currSlice);

606 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

608 
	`S‘CtxMod–Numb”
 (
cu¼Sliû
);

611 
p_Vid
->
check»f
 = (è(
p_IÅ
->
rdÝt
 &&…_IÅ->
Re¡riùRef
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
));

613 
Ën
 = 
	`¡¬t_¦iû
 (
cu¼Sliû
, 
cur_¡©s
);

616 ià(
p_IÅ
->
RCEÇbË
)

617 
	`rc_¡Üe_¦iû_h—d”_b™s
Ð
p_Vid
, 
p_IÅ
, 
Ën
 );

620 
p_Vid
->
p_Sts
->
b™_¦iû
 +ð
Ën
;

621 
cur_¡©s
->
b™_u£_h—d”
[
cu¼Sliû
->
¦iû_ty³
] +ð
Ën
;

623 
’d_of_¦iû
 =ð
FALSE
)

626 ià(
p_Vid
->
Ad­tiveRoundšg
 && 
p_IÅ
->
Ad­tRndP”iod
 && (p_Vid->
cu¼’t_mb_Ä
 %…_Inp->AdaptRndPeriod == 0))

628 
	`C®cuÏ‹Off£t4x4P¬am
(
p_Vid
);

629 if(
p_IÅ
->
T¿nsfÜm8x8Mode
)

630 
	`C®cuÏ‹Off£t8x8P¬am
(
p_Vid
);

661 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

662 ià(
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 ||…_IÅ->MbIÁ”Ïû =ð
FRAME_MB_PAIR_CODING
)

666 
»code_maüoblock
 = 
FALSE
;

668 
	`upd©e_mv_lim™s
(
p_Vid
, 
FALSE
);

670 
p_Vid
->
f›ld_mode
 = 
FALSE
;

671 
p_Vid
->
tÝ_f›ld
 = 
FALSE
;

674 
p_Vid
->
wr™e_maüoblock
 = 
FALSE
;

675 
p_Vid
->
bÙ_MB
 = 
FALSE
;

678 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

680 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING


681 && 
p_Vid
->
Numb”ofCodedMaüoBlocks
 > 0 && (p_Vid->Numb”ofCodedMaüoBlock %…_Vid->
BasicUn™
) == 0 )

682 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad_š™
,…_Vid->
p_rc_quad
 );

683 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 )

684 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’_š™
,…_Vid->
p_rc_g’
 );

687 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
, 
FALSE
);

689 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_tÝ_äame_mb
;

690 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

691 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

692 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

694 
F¿meRDCo¡
 = 
cu¼Sliû
->
rdd©a
->
mš_rdco¡
;

698 
p_Vid
->
bÙ_MB
 = 
TRUE
;

701 
p_Vid
->
f›ld_mode
 = 
FALSE
;

703 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
 + 1, 
FALSE
);

704 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_bÙ_äame_mb
;

705 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

706 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

707 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

709 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

711 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING


712 && 
p_Vid
->
Numb”ofCodedMaüoBlocks
 > 0 && (p_Vid->Numb”ofCodedMaüoBlock %…_Vid->
BasicUn™
) == 0 )

713 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad_be¡
,…_Vid->
p_rc_quad
 );

715 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 )

716 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’_be¡
,…_Vid->
p_rc_g’
 );

719 
F¿meRDCo¡
 +ð
cu¼Sliû
->
rdd©a
->
mš_rdco¡
;

723 ià((
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
è|| (p_IÅ->MbIÁ”Ïû =ð
FIELD_CODING
))

726 
p_Vid
->
bÙ_MB
 = 
FALSE
;

728 
	`upd©e_mv_lim™s
(
p_Vid
, 
TRUE
);

732 
p_Vid
->
f›ld_mode
 = 
TRUE
;

733 
p_Vid
->
tÝ_f›ld
 = 
TRUE
;

734 
p_IÅ
->
num_»f_äames
 <<= 1;

735 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] <<= 1;

736 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] += 1;

738 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

740 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING


741 && 
p_Vid
->
Numb”ofCodedMaüoBlocks
 > 0 && (p_Vid->Numb”ofCodedMaüoBlock %…_Vid->
BasicUn™
) == 0 )

742 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_quad_š™
 );

744 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 )

745 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’
,…_Vid->
p_rc_g’_š™
 );

748 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
, 
TRUE
);

750 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_tÝ_f›ld_mb
;

752 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

753 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

754 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

756 
F›ldRDCo¡
 = 
cu¼Sliû
->
rdd©a
->
mš_rdco¡
;

759 
p_Vid
->
bÙ_MB
 = 
TRUE
;

761 
p_Vid
->
tÝ_f›ld
 = 
FALSE
;

762 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
+1, 
TRUE
);

763 
cu¼Sliû
->
rdd©a
 = &cu¼Sliû->
rdd©a_bÙ_f›ld_mb
;

764 
p_Vid
->
ma¡”QP
 =…_Vid->
qp
;

765 
cu¼Sliû
->
	`’code_Úe_maüoblock
 (
cu¼MB
);

766 
	`’d_’code_Úe_maüoblock
(
cu¼MB
);

768 
F›ldRDCo¡
 +ð
cu¼Sliû
->
rdd©a
->
mš_rdco¡
;

773 
p_Vid
->
wr™e_mbaff_äame
 = 0;

777 iàÐ((
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
è&& (
F¿meRDCo¡
 < 
F›ldRDCo¡
)è||…_IÅ->MbIÁ”Ïû =ð
FRAME_MB_PAIR_CODING
 )

779 
p_Vid
->
f›ld_mode
 = 
FALSE
;

780 
p_Vid
->
MBPaœIsF›ld
 = 
FALSE
;

782 iàÐ
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_MB_PAIR_CODING
 )

784 
p_IÅ
->
num_»f_äames
 >>= 1;

785 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] -= 1;

786 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] >>= 1;

789 iàÐ
p_IÅ
->
RCEÇbË
 &&…_IÅ->
RCUpd©eMode
 <ð
MAX_RC_MODE
 )

791 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING


792 && 
p_Vid
->
Numb”ofCodedMaüoBlocks
 > 0 && (p_Vid->Numb”ofCodedMaüoBlock %…_Vid->
BasicUn™
) == 0 )

793 
	`rc_cÝy_quad¿tic
Ð
p_Vid
, 
p_IÅ
,…_Vid->
p_rc_quad
,…_Vid->
p_rc_quad_be¡
 );

795 iàÐ
p_IÅ
->
MbIÁ”Ïû
 =ð
ADAPTIVE_CODING
 )

796 
	`rc_cÝy_g’”ic
Ð
p_Vid
,…_Vid->
p_rc_g’
,…_Vid->
p_rc_g’_be¡
 );

800 
p_Vid
->
wr™e_mbaff_äame
 = 1;

804 
p_Vid
->
f›ld_mode
 = 
TRUE
;

805 
p_Vid
->
MBPaœIsF›ld
 = 
TRUE
;

809 
p_Vid
->
wr™e_maüoblock
 = 
TRUE
;

811 ià(
p_Vid
->
MBPaœIsF›ld
)

812 
p_Vid
->
tÝ_f›ld
 = 
TRUE
;

814 
p_Vid
->
tÝ_f›ld
 = 
FALSE
;

817 
p_Vid
->
bÙ_MB
 = 
FALSE
;

820 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
, 
p_Vid
->
f›ld_mode
);

822 
cu¼Sliû
->
rdd©a
 = 
p_Vid
->
f›ld_mode
 ? &cu¼Sliû->
rdd©a_tÝ_f›ld_mb
 : &cu¼Sliû->
rdd©a_tÝ_äame_mb
;

823 
	`cÝy_rdÝt_d©a
 (
cu¼MB
);

824 
	`wr™e_maüoblock
 (
cu¼MB
, 1);

825 
	`’d_maüoblock
 (
cu¼MB
, &
’d_of_¦iû
, &
»code_maüoblock
);

826 
cu¼MB
->
´ev_»code_mb
 = 
»code_maüoblock
;

828 ià(
»code_maüoblock
 =ð
FALSE
)

830 
p_Vid
->
SumF¿meQP
 +ð
cu¼MB
->
qp
;

832 
Cu¼’tMbAddr
 = 
	`FmoG‘NextMBNr
 (
p_Vid
, CurrentMbAddr);

833 ià(
Cu¼’tMbAddr
 == -1)

835 
’d_of_¦iû
 = 
TRUE
;

837 
Numb”OfCodedMBs
++;

838 
	`Ãxt_maüoblock
 (
cu¼MB
);

841 
p_Vid
->
bÙ_MB
 = 
TRUE
;

843 
p_Vid
->
tÝ_f›ld
 = 
FALSE
;

844 
	`¡¬t_maüoblock
 (
cu¼Sliû
, &
cu¼MB
, 
Cu¼’tMbAddr
, 
p_Vid
->
f›ld_mode
);

846 
cu¼Sliû
->
rdd©a
 = 
p_Vid
->
f›ld_mode
 ? &cu¼Sliû->
rdd©a_bÙ_f›ld_mb
 : &cu¼Sliû->
rdd©a_bÙ_äame_mb
;

847 
	`cÝy_rdÝt_d©a
 (
cu¼MB
);

849 
	`wr™e_maüoblock
 (
cu¼MB
, 0);

850 
	`’d_maüoblock
 (
cu¼MB
, &
’d_of_¦iû
, &
»code_maüoblock
);

851 
cu¼MB
->
´ev_»code_mb
 = 
»code_maüoblock
;

852 ià(
»code_maüoblock
 =ð
FALSE
)

854 
p_Vid
->
SumF¿meQP
 +ð
cu¼MB
->
qp
;

856 
Cu¼’tMbAddr
 = 
	`FmoG‘NextMBNr
 (
p_Vid
, CurrentMbAddr);

857 ià(
Cu¼’tMbAddr
 == -1)

859 
’d_of_¦iû
 = 
TRUE
;

861 
Numb”OfCodedMBs
++;

862 
	`Ãxt_maüoblock
 (
cu¼MB
);

867 
p_Vid
->
cu¼’t_mb_Ä
 = 
	`FmoG‘P»viousMBNr
(p_Vid,…_Vid->current_mb_nr);

868 
p_Vid
->
Numb”ofCodedMaüoBlocks
 -= 2;

869 if(
p_Vid
->
cu¼’t_mb_Ä
 == -1 )

872 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "Errorƒncoding first MB with specified…arameter, bits of current MB may beoo big");

873 
	`”rÜ
 (
”rÜ‹xt
, 300);

880 
p_Vid
->
cu¼’t_mb_Ä
 = 
	`FmoG‘P»viousMBNr
(p_Vid,…_Vid->current_mb_nr);

881 
p_Vid
->
Numb”ofCodedMaüoBlocks
--;

882 if(
p_Vid
->
cu¼’t_mb_Ä
 == -1 )

885 
	`¢´štf
 (
”rÜ‹xt
, 
ET_SIZE
, "Errorƒncoding first MB with specified…arameter, bits of current MB may beoo big");

886 
	`”rÜ
 (
”rÜ‹xt
, 300);

890 ià(
p_Vid
->
MBPaœIsF›ld
)

892 
p_IÅ
->
num_»f_äames
 >>= 1;

893 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] -= 1;

894 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] >>= 1;

897 
p_Vid
->
f›ld_mode
 =…_Vid->
tÝ_f›ld
 = 
FALSE
;

899 iàÐ!
’d_of_¦iû
 )

901 
	`as£¹
Ð
Cu¼’tMbAddr
 < ()
p_Vid
->
PicSizeInMbs
 );

902 
	`as£¹
Ð
Cu¼’tMbAddr
 >= 0 );

903 ià(
Cu¼’tMbAddr
 =ð
	`FmoG‘La¡CodedMBOfSliûGroup
 (
p_Vid
, 
	`FmoMB2SliûGroup
 (p_Vid, CurrentMbAddr)))

904 
’d_of_¦iû
 = 
TRUE
;

908 
p_Vid
->
num_»f_idx_l0_aùive
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
];

909 
p_Vid
->
num_»f_idx_l1_aùive
 = 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
];

911 
	`‹rmš©e_¦iû
 (
cu¼MB
, (
Numb”OfCodedMBs
 + 
TÙ®CodedMBs
 >ð()
p_Vid
->
PicSizeInMbs
), 
cur_¡©s
 );

912  
Numb”OfCodedMBs
;

913 
	}
}

915 
	$£tup_ÿbac
(
Sliû
 *
cu¼Sliû
, *
li¡Xsize
)

917 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
cu¼Sliû
->active_sps;

918 
i
;

920 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
)

922 
cu¼Sliû
->
£t_modes_ªd_»äame
 = 
£t_modes_ªd_»äame_i_¦iû
;

923 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
NULL
;

924 
cu¼Sliû
->
wr™eMB_Sk
 = 
NULL
;

925 
cu¼Sliû
->
wr™eMB_ty³Info
 = 
wr™eMB_I_ty³Info_CABAC
;

926 
cu¼Sliû
->
wr™eB8_ty³Info
 = 
wr™eB8_ty³Info_CABAC
;

927 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
NULL
;

928 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_i_¦iû_MB_Ïy”
;

929 
i
=0; i<6; i++)

931 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
NULL
;

934 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

936 
cu¼Sliû
->
£t_modes_ªd_»äame
 = 
£t_modes_ªd_»äame_b_¦iû
;

937 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
¡Üe_8x8_mÙiÚ_veùÜs_b_¦iû
;

938 
cu¼Sliû
->
wr™eMB_Sk
 = 
wr™eMB_Bsk_æagInfo_CABAC
;

939 
cu¼Sliû
->
wr™eMB_ty³Info
 = 
wr™eMB_B_ty³Info_CABAC
;

940 
cu¼Sliû
->
wr™eB8_ty³Info
 = 
wr™eB8_B_ty³Info_CABAC
;

941 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
wr™e_b_¦iû_mÙiÚ_šfo_to_NAL
;

942 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_b_¦iû_MB_Ïy”
;

943 
i
=0; i<6; i++)

945 
li¡Xsize
[
i
])

948 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
NULL
;

951 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_Dummy
;

954 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_B_CABAC
;

960 
cu¼Sliû
->
£t_modes_ªd_»äame
 = 
£t_modes_ªd_»äame_p_¦iû
;

961 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
¡Üe_8x8_mÙiÚ_veùÜs_p_¦iû
;

962 
cu¼Sliû
->
wr™eMB_Sk
 = 
wr™eMB_Psk_æagInfo_CABAC
;

963 
cu¼Sliû
->
wr™eMB_ty³Info
 = 
wr™eMB_P_ty³Info_CABAC
;

964 
cu¼Sliû
->
wr™eB8_ty³Info
 = 
wr™eB8_ty³Info_CABAC
;

965 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
wr™e_p_¦iû_mÙiÚ_šfo_to_NAL
;

966 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_p_¦iû_MB_Ïy”
;

968 
i
=0; i<6; i++)

970 
li¡Xsize
[
i
])

973 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
NULL
;

976 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_Dummy
;

979 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_P_CABAC
;

984 
cu¼Sliû
->
wr™eIÁ¿P»dMode
 = 
wr™eIÁ¿P»dMode_CABAC
;

985 
cu¼Sliû
->
wr™eCÛff16x16
 = 
wr™eCÛff16x16_CABAC
;

986 
cu¼Sliû
->
wr™eMVD
 = 
wr™eMVD_CABAC
;

987 
cu¼Sliû
->
wr™eCBP
 = 
wr™eCBP_CABAC
;

988 
cu¼Sliû
->
wr™eDquªt
 = 
wr™eDquªt_CABAC
;

989 
cu¼Sliû
->
wr™eCIP»dMode
 = 
wr™eCIP»dMode_CABAC
;

990 
cu¼Sliû
->
wr™eF›ldModeInfo
 = 
wr™eF›ldModeInfo_CABAC
;

991 
cu¼Sliû
->
wr™eMB_ŒªsfÜm_size
 = 
wr™eMB_ŒªsfÜm_size_CABAC
;

993 ià(
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

994 
cu¼Sliû
->
wr™e_ªd_¡Üe_CBP_block_b™
 = 
wr™e_ªd_¡Üe_CBP_block_b™_444
;

996 
cu¼Sliû
->
wr™e_ªd_¡Üe_CBP_block_b™
 = write_and_store_CBP_block_bit;

998 
	`mem£t
(
cu¼Sliû
->
cÛff
, 0 , 64 * ());

999 
cu¼Sliû
->
cÛff_ùr
 = 0;

1000 
cu¼Sliû
->
pos
 = 0;

1001 
	}
}

1003 
	$£tup_ÿvlc
(
Sliû
 *
cu¼Sliû
, *
li¡Xsize
)

1005 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
cu¼Sliû
->active_sps;

1007 
i
;

1008 
cu¼Sliû
->
wr™eMB_ty³Info
 = 
wr™eUVLC_CAVLC
;

1009 
cu¼Sliû
->
wr™eIÁ¿P»dMode
 = 
wr™eIÁ¿P»dMode_CAVLC
;

1010 
cu¼Sliû
->
wr™eB8_ty³Info
 = 
wr™eSE_UVLC
;

1011 
cu¼Sliû
->
wr™eCÛff16x16
 = 
wr™eCÛff16x16_CAVLC
;

1012 
i
=0; i<6; i++)

1014 
li¡Xsize
[
i
])

1017 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
NULL
;

1020 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_Dummy
;

1023 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_2Ref_CAVLC
;

1026 
cu¼Sliû
->
wr™eRefF¿me
[
i
] = 
wr™eRefPic_NRef_CAVLC
;

1031 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
I_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SI_SLICE
)

1033 
cu¼Sliû
->
£t_modes_ªd_»äame
 = set_modes_and_reframe;

1034 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
NULL
;

1035 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
NULL
;

1036 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_i_¦iû_MB_Ïy”
;

1038 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

1040 
cu¼Sliû
->
£t_modes_ªd_»äame
 = 
£t_modes_ªd_»äame_b_¦iû
;

1041 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
¡Üe_8x8_mÙiÚ_veùÜs_b_¦iû
;

1042 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
wr™e_b_¦iû_mÙiÚ_šfo_to_NAL
;

1043 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_b_¦iû_MB_Ïy”
;

1047 
cu¼Sliû
->
£t_modes_ªd_»äame
 = 
£t_modes_ªd_»äame_p_¦iû
;

1048 
cu¼Sliû
->
¡Üe_8x8_mÙiÚ_veùÜs
 = 
¡Üe_8x8_mÙiÚ_veùÜs_p_¦iû
;

1049 
cu¼Sliû
->
wr™eMÙiÚInfo2NAL
 = 
wr™e_p_¦iû_mÙiÚ_šfo_to_NAL
;

1050 
cu¼Sliû
->
wr™e_MB_Ïy”
 = 
wr™e_p_¦iû_MB_Ïy”
;

1053 
cu¼Sliû
->
wr™eMVD
 = 
wr™eSVLC_CAVLC
;

1054 
cu¼Sliû
->
wr™eCBP
 = 
wr™eCBP_VLC
;

1055 
cu¼Sliû
->
wr™eDquªt
 = 
wr™eSVLC_CAVLC
;

1056 
cu¼Sliû
->
wr™eCIP»dMode
 = 
wr™eUVLC_CAVLC
;

1057 
cu¼Sliû
->
wr™eF›ldModeInfo
 = 
wr™eFÏg_CAVLC
;

1058 
cu¼Sliû
->
wr™eMB_ŒªsfÜm_size
 = 
wr™eFÏg_CAVLC
;

1061 ià(
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

1062 
cu¼Sliû
->
wr™eCÛff4x4_CAVLC
 = 
wr™eCÛff4x4_CAVLC_444
;

1064 
cu¼Sliû
->
wr™eCÛff4x4_CAVLC
 = 
wr™eCÛff4x4_CAVLC_nÜm®
;

1065 
	}
}

1067 
	$£tup_¦iû
(
Sliû
 *
cu¼Sliû
)

1069 ià(
cu¼Sliû
->
P444_jošed
)

1071 
cu¼Sliû
->
luma_»sidu®_codšg
 = 
luma_»sidu®_codšg_p444
;

1072 
cu¼Sliû
->
luma_»sidu®_codšg_8x8
 = 
luma_»sidu®_codšg_p444_8x8
;

1076 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

1077 
cu¼Sliû
->
luma_»sidu®_codšg
 = 
luma_»sidu®_codšg_¥
;

1079 
cu¼Sliû
->
luma_»sidu®_codšg
 =†uma_residual_coding;

1080 
cu¼Sliû
->
luma_»sidu®_codšg_8x8
 =†uma_residual_coding_8x8;

1083 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SP_SLICE
)

1084 
cu¼Sliû
->
chroma_»sidu®_codšg
 = 
chroma_»sidu®_codšg_¥
;

1085 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
SI_SLICE
)

1086 
cu¼Sliû
->
chroma_»sidu®_codšg
 = 
chroma_»sidu®_codšg_si
;

1088 
cu¼Sliû
->
chroma_»sidu®_codšg
 = chroma_residual_coding;

1090 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 || cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
)

1092 
cu¼Sliû
->
weigh‹d_´ediùiÚ
 = (
by‹
ècu¼Sliû->
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
;

1093 
cu¼Sliû
->
£t_modes_ªd_»fs_fÜ_blocks
 = 
£t_modes_ªd_»fs_fÜ_blocks_p_¦iû
;

1094 
cu¼Sliû
->
£t_cÛff_ªd_»cÚ_8x8
 = 
£t_cÛff_ªd_»cÚ_8x8_p_¦iû
;

1095 
cu¼Sliû
->
š™_li¡s
 = 
š™_li¡s_p_¦iû
;

1096 
cu¼Sliû
->
submaüoblock_mode_decisiÚ
 = 
submaüoblock_mode_decisiÚ_p_¦iû
;

1097 
cu¼Sliû
->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBPSliû
;

1099 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

1101 
cu¼Sliû
->
weigh‹d_´ediùiÚ
 = (
by‹
ècu¼Sliû->
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
;

1102 
cu¼Sliû
->
£t_modes_ªd_»fs_fÜ_blocks
 = 
£t_modes_ªd_»fs_fÜ_blocks_b_¦iû
;

1103 
cu¼Sliû
->
£t_cÛff_ªd_»cÚ_8x8
 = 
£t_cÛff_ªd_»cÚ_8x8_b_¦iû
;

1104 
cu¼Sliû
->
š™_li¡s
 = 
š™_li¡s_b_¦iû
;

1105 
cu¼Sliû
->
submaüoblock_mode_decisiÚ
 = 
submaüoblock_mode_decisiÚ_b_¦iû
;

1106 
cu¼Sliû
->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBBSliû
;

1110 
cu¼Sliû
->
£t_modes_ªd_»fs_fÜ_blocks
 = 
£t_modes_ªd_»fs_fÜ_blocks_i_¦iû
;

1111 
cu¼Sliû
->
£t_cÛff_ªd_»cÚ_8x8
 = 
NULL
;

1112 
cu¼Sliû
->
š™_li¡s
 = 
š™_li¡s_i_¦iû
;

1113 
cu¼Sliû
->
submaüoblock_mode_decisiÚ
 = 
NULL
;

1114 
cu¼Sliû
->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBISliû
;

1117 ià(
cu¼Sliû
->
mb_aff_äame_æag
)

1119 
cu¼Sliû
->
£t_šŒ­»d_4x4
 = 
£t_šŒ­»d_4x4_mbaff
;

1120 
cu¼Sliû
->
£t_šŒ­»d_8x8
 = 
£t_šŒ­»d_8x8_mbaff
;

1121 
cu¼Sliû
->
£t_šŒ­»d_16x16
 = 
£t_šŒ­»d_16x16_mbaff
;

1122 
cu¼Sliû
->
rdo_low_šŒa_chroma_decisiÚ
 = 
rdo_low_šŒa_chroma_decisiÚ_mbaff
;

1123 
cu¼Sliû
->
šŒa_chroma_´ediùiÚ
 = 
šŒa_chroma_´ediùiÚ_mbaff
;

1124 ià(
cu¼Sliû
->
dœeù_¥©Ÿl_mv_´ed_æag
)

1125 
cu¼Sliû
->
G‘_Dœeù_MÙiÚ_VeùÜs
 = 
G‘_Dœeù_MV_S·tŸl_MBAFF
;

1127 
cu¼Sliû
->
G‘_Dœeù_MÙiÚ_VeùÜs
 = 
G‘_Dœeù_MV_TempÜ®
;

1131 
cu¼Sliû
->
£t_šŒ­»d_4x4
 = set_intrapred_4x4;

1132 
cu¼Sliû
->
£t_šŒ­»d_8x8
 = set_intrapred_8x8;

1133 
cu¼Sliû
->
£t_šŒ­»d_16x16
 = set_intrapred_16x16;

1134 
cu¼Sliû
->
rdo_low_šŒa_chroma_decisiÚ
 =„do_low_intra_chroma_decision;

1135 
cu¼Sliû
->
šŒa_chroma_´ediùiÚ
 = intra_chroma_prediction;

1136 ià(
cu¼Sliû
->
dœeù_¥©Ÿl_mv_´ed_æag
)

1137 
cu¼Sliû
->
G‘_Dœeù_MÙiÚ_VeùÜs
 = 
G‘_Dœeù_MV_S·tŸl_NÜm®
;

1139 
cu¼Sliû
->
G‘_Dœeù_MÙiÚ_VeùÜs
 = 
G‘_Dœeù_MV_TempÜ®
;

1142 ià(
cu¼Sliû
->
aùive_¥s
->
chroma_fÜm©_idc
 =ð
YUV444
)

1143 
cu¼Sliû
->
mode_decisiÚ_fÜ_I16x16_MB
 = 
mode_decisiÚ_fÜ_I16x16_MB_444
;

1144 if(
cu¼Sliû
->
p_IÅ
->
I16rdo
)

1145 
cu¼Sliû
->
mode_decisiÚ_fÜ_I16x16_MB
 = 
mode_decisiÚ_fÜ_I16x16_MB_RDO
;

1147 
cu¼Sliû
->
mode_decisiÚ_fÜ_I16x16_MB
 = mode_decision_for_I16x16_MB;

1148 
	}
}

1150 
	$ClWPP¬ams
(
Sliû
 *
cu¼Sliû
 )

1172 
	}
}

1174 
	$£tup_Ý’_gÝ_li¡s
(
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 *
cu¼Sliû
)

1176 
i
, 
j
;

1178 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

1180 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[0]; i++)

1182 ià(
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->
poc
 < 
p_Vid
->
Ï¡_v®id_»ã»nû
 &&…_Vid->
ThisPOC
 >=…_Vid->last_valid_reference)

1185 
j
 = 
i
; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]-1; j++)

1187 
cu¼Sliû
->
li¡X
[
LIST_0
][
j
] = currSlice->listX[LIST_0][j+1];

1189 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]--;

1190 
i
--;

1194 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; i++)

1196 ià(
cu¼Sliû
->
li¡X
[
LIST_1
][
i
]->
poc
 < 
p_Vid
->
Ï¡_v®id_»ã»nû
 &&…_Vid->
ThisPOC
 >=…_Vid->last_valid_reference)

1199 
j
 = 
i
; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]-1; j++)

1201 
cu¼Sliû
->
li¡X
[
LIST_1
][
j
] = currSlice->listX[LIST_1][j+1];

1203 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]--;

1204 
i
--;

1211 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

1213 ià(
cu¼Sliû
->
li¡Xsize
[
LIST_1
] =ð0 && cu¼Sliû->li¡Xsize[
LIST_0
] != 0)

1215 ià(
cu¼Sliû
->
li¡Xsize
[
LIST_0
] > 1)

1216 
cu¼Sliû
->
li¡X
[
LIST_1
][0] = cu¼Sliû->li¡X[
LIST_0
][1];

1218 
cu¼Sliû
->
li¡X
[
LIST_1
][0] = cu¼Sliû->li¡X[
LIST_0
][0];

1219 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]++;

1221 ià(
cu¼Sliû
->
li¡Xsize
[
LIST_0
] =ð0 && cu¼Sliû->li¡Xsize[
LIST_1
] != 0)

1223 ià(
cu¼Sliû
->
li¡Xsize
[
LIST_1
] > 1)

1224 
cu¼Sliû
->
li¡X
[
LIST_0
][0] = cu¼Sliû->li¡X[
LIST_1
][1];

1226 
cu¼Sliû
->
li¡X
[
LIST_0
][0] = cu¼Sliû->li¡X[
LIST_1
][0];

1227 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]++;

1235 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] = cu¼Sliû->
li¡Xsize
[LIST_0];

1236 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = cu¼Sliû->
li¡Xsize
[LIST_1];

1238 
	}
}

1241 
	$£t_¦iû
 (
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 *
cu¼Sliû
)

1243 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1245 
cu¼Sliû
->
p_Vid
 =…_Vid;

1246 
cu¼Sliû
->
p_IÅ
 =…_Inp;

1247 
cu¼Sliû
->
Ïy”_id
 = 
p_Vid
->
dpb_Ïy”_id
;

1248 
cu¼Sliû
->
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[p_Vid->
dpb_Ïy”_id
];

1249 
cu¼Sliû
->
aùive_¥s
 = 
p_Vid
->active_sps;

1250 
cu¼Sliû
->
aùive_µs
 = 
p_Vid
->active_pps;

1251 
cu¼Sliû
->
piùu»_id
 = (
p_Vid
->
äame_no
 & 0xFF);

1252 
cu¼Sliû
->
¦iû_Ä
 = 
p_Vid
->
cu¼’t_¦iû_Ä
;

1253 
cu¼Sliû
->
idr_æag
 = 
p_Vid
->
cu¼’tPiùu»
->idr_flag;

1254 
cu¼Sliû
->
¦iû_ty³
 = 
p_Vid
->
ty³
;

1255 
cu¼Sliû
->
äame_no
 = 
p_Vid
->frame_no;

1256 
cu¼Sliû
->
äame_num
 = 
p_Vid
->frame_num;

1257 
cu¼Sliû
->
max_äame_num
 = 
p_Vid
->max_frame_num;

1258 
cu¼Sliû
->
äam•oc
 = 
p_Vid
->framepoc;

1259 
cu¼Sliû
->
ThisPOC
 = 
p_Vid
->ThisPOC;

1260 
cu¼Sliû
->
qp
 = 
p_Vid
->
p_cu¼_äm_¡ruù
->qp;

1261 
cu¼Sliû
->
¡¬t_mb_Ä
 = 
p_Vid
->
cu¼’t_mb_Ä
;

1262 
cu¼Sliû
->
cÞour_¶ªe_id
 = 
p_Vid
->colour_plane_id;

1264 
cu¼Sliû
->
si_äame_šdiÿtÜ
 = cu¼Sliû->
¦iû_ty³
 =ð
SI_SLICE
 ? 
TRUE
 : 
FALSE
;

1265 
cu¼Sliû
->
¥2_äame_šdiÿtÜ
 = 
p_Vid
->sp2_frame_indicator;

1267 
cu¼Sliû
->
P444_jošed
 = 
p_Vid
->P444_joined;

1268 
cu¼Sliû
->
di¡h»s
 = 
p_IÅ
->disthres;

1269 
cu¼Sliû
->
U£RDOQuªt
 = 
p_IÅ
->UseRDOQuant;

1270 
cu¼Sliû
->
RDOQ_QP_Num
 = 
p_IÅ
->RDOQ_QP_Num;

1271 
cu¼Sliû
->
T¿nsfÜm8x8Mode
 = 
p_IÅ
->Transform8x8Mode;

1273 
cu¼Sliû
->
¦iû_too_big
 = 
dummy_¦iû_too_big
;

1274 
cu¼Sliû
->
width_blk
 = 
p_Vid
->width_blk;

1275 
cu¼Sliû
->
height_blk
 = 
p_Vid
->height_blk;

1276 
cu¼Sliû
->
·¹™iÚ_mode
 = (è
p_IÅ
->partition_mode;

1277 
cu¼Sliû
->
PicSizeInMbs
 = 
p_Vid
->PicSizeInMbs;

1278 
cu¼Sliû
->
num_blk8x8_uv
 = 
p_Vid
->num_blk8x8_uv;

1279 
cu¼Sliû
->
Çl_»ã»nû_idc
 = 
p_Vid
->nal_reference_idc;

1280 
cu¼Sliû
->
b™d•th_luma
 = 
p_Vid
->bitdepth_luma;

1281 
cu¼Sliû
->
b™d•th_chroma
 = 
p_Vid
->bitdepth_chroma;

1282 
cu¼Sliû
->
b™d•th_sÿË
[0] = 
p_Vid
->bitdepth_scale[0];

1283 
cu¼Sliû
->
b™d•th_sÿË
[1] = 
p_Vid
->bitdepth_scale[1];

1284 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 = 
p_Vid
->bitdepth_luma_qp_scale;

1285 
cu¼Sliû
->
b™d•th_chroma_qp_sÿË
 = 
p_Vid
->bitdepth_chroma_qp_scale;

1286 
cu¼Sliû
->
b™d•th_Ïmbda_sÿË
 = 
p_Vid
->bitdepth_lambda_scale;

1287 
cu¼Sliû
->
dœeù_¥©Ÿl_mv_´ed_æag
 = 
p_Vid
->direct_spatial_mv_pred_flag;

1288 
cu¼Sliû
->
mb_aff_äame_æag
 = 
p_Vid
->mb_aff_frame_flag;

1289 
cu¼Sliû
->
¡ruùu»
 = 
p_Vid
->structure;

1290 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] = (è(
p_Vid
->
aùive_µs
->
num_»f_idx_l0_deçuÉ_aùive_mšus1
 + 1);

1291 
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] = (è(
p_Vid
->
aùive_µs
->
num_»f_idx_l1_deçuÉ_aùive_mšus1
 + 1);

1292 
cu¼Sliû
->
DFDi§bËIdc
 = (
p_Vid
->
TuºDBOff
) ? 1 :…_Vid->DFDisableIdc;

1293 
cu¼Sliû
->
DFAÍhaC0Off£t
 = 
p_Vid
->DFAlphaC0Offset;

1294 
cu¼Sliû
->
DFB‘aOff£t
 = 
p_Vid
->DFBetaOffset;

1295 
cu¼Sliû
->
v›w_id
 = 
p_Vid
->view_id;

1296 
	}
}

1309 
	$š™_¦iû
 (
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 **
cu¼Sliû
, 
¡¬t_mb_addr
)

1311 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1312 
i
,
j
;

1314 
Ïy”_id
 = 
p_Vid
->
dpb_Ïy”_id
;

1316 
£q_·¿m‘”_£t_rb¥_t
 *
aùive_¥s
 = 
p_Vid
->active_sps;

1317 
Piùu»
 *
cu¼Pic
 = 
p_Vid
->
cu¼’tPiùu»
;

1318 
D©aP¬t™iÚ
 *
d©aP¬t
;

1319 
B™¡»am
 *
cu¼SŒ—m
;

1320 
aùive_»f_li¡s
 = (
p_Vid
->
mb_aff_äame_æag
) ? 6 : 2;

1321 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
p_Vid
->
p_Dpb_Ïy”
[
Ïy”_id
];

1322 
®loc_size
 = 0;

1324 #ià(
MVC_EXTENSION_ENABLE
)

1325 if(
p_IÅ
->
num_of_v›ws
 == 2)

1327 
’abË_š‹r_v›w
 = (
p_Vid
->
Çl_»ã»nû_idc
 || 
p_IÅ
->
’abË_š‹r_v›w_æag
) ? 1 : 0;

1328 
p_Vid
->
´iÜ™y_id
 = 0;

1329 
p_Vid
->
‹mpÜ®_id
 = 0;

1330 
p_Vid
->
š‹r_v›w_æag
[0] = ((
Ïy”_id
 =ð0è? 
’abË_š‹r_v›w
 : 0);

1331 
p_Vid
->
š‹r_v›w_æag
[1] = ((
Ïy”_id
 =ð0è? 
’abË_š‹r_v›w
 : 0);

1333 if(
p_Vid
->
¡ruùu»
!=
BOTTOM_FIELD
)

1334 
p_Vid
->
ªchÜ_pic_æag
[0] = ((Õ_Vid->
cu¼’tPiùu»
->
idr_æag
 &&…_Vid->
Çl_»ã»nû_idc
!=0è||…_Vid->
´ev_v›w_is_ªchÜ
) ? 1:0);

1336 
p_Vid
->
ªchÜ_pic_æag
[1] = 0;

1337 
p_Vid
->
nÚ_idr_æag
[p_Vid->
¡ruùu»
!=
BOTTOM_FIELD
 ? 0:1] = !p_Vid->
ªchÜ_pic_æag
[p_Vid->structure!=BOTTOM_FIELD ? 0:1];

1341 
p_Vid
->
cu¼’t_mb_Ä
 = 
¡¬t_mb_addr
;

1344 
	`as£¹
 (
cu¼Pic
 !ð
NULL
);

1345 
cu¼Pic
->
no_¦iûs
++;

1347 ià(
cu¼Pic
->
no_¦iûs
 >ð
MAXSLICEPERPICTURE
)

1348 
	`”rÜ
 ("Too many slices…er…icture, increase MAXSLICEPERPICTURE in global.h.", -1);

1350 
cu¼Pic
->
¦iûs
[cu¼Pic->
no_¦iûs
 - 1] = 
	`m®loc_¦iû
(
p_Vid
, 
p_IÅ
);

1351 *
cu¼Sliû
 = 
cu¼Pic
->
¦iûs
[cu¼Pic->
no_¦iûs
-1];

1353 
p_Vid
->
cu¼’tSliû
 = *
cu¼Sliû
;

1354 
	`£t_¦iû
 (
p_Vid
, *
cu¼Sliû
);

1357 if(
p_IÅ
->
»dundªt_pic_æag
)

1359 if(!
p_Vid
->
»dundªt_codšg
)

1361 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
(
p_Vid
->
numb”
,
p_IÅ
->
NumRefPrim¬y
);

1366 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = 1;

1370 
i
 = 0; i < (*
cu¼Sliû
)->
max_·¹_Ä
; i++)

1372 
d©aP¬t
 = &(*
cu¼Sliû
)->
·¹A¼
[
i
];

1374 
cu¼SŒ—m
 = 
d©aP¬t
->
b™¡»am
;

1375 
cu¼SŒ—m
->
b™s_to_go
 = 8;

1376 
cu¼SŒ—m
->
by‹_pos
 = 0;

1377 
cu¼SŒ—m
->
by‹_buf
 = 0;

1381 ià(((*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
SP_SLICE
è&& 
p_IÅ
->
P_Li¡0_»fs
[
Ïy”_id
])

1383 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
P_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1384 #ià
CRA


1385 iàÐ
p_IÅ
->
u£CRA
 )

1387 iàÐÐ((*
cu¼Sliû
)->
ThisPOC
/2è- (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

1389 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = () 1;

1395 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
 )

1397 ià(
p_IÅ
->
B_Li¡0_»fs
[
Ïy”_id
])

1399 #ià
B0_MORE_REF


1400 iàÐ
p_IÅ
->
BLev–0MÜeRef
 )

1402 iàÐ((*
cu¼Sliû
)->
ThisPOC
/2è% (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1) == 0 )

1404 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
P_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1408 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
B_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1413 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
B_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1415 #ià
CRA


1416 iàÐ
p_IÅ
->
u£CRA
 )

1418 iàÐÐ((*
cu¼Sliû
)->
ThisPOC
/2è- (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

1420 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = () 1;

1425 ià(
p_IÅ
->
B_Li¡1_»fs
[
Ïy”_id
])

1427 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_1], 
p_IÅ
->
B_Li¡1_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1428 #ià
B0_MORE_REF


1429 iàÐ
p_IÅ
->
BLev–0MÜeRef
 )

1431 iàÐ((*
cu¼Sliû
)->
ThisPOC
/2è% (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1) == 0 )

1433 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (*cu¼Sliû)->num_»f_idx_aùive[
LIST_0
];

1437 #ià
CRA


1438 iàÐ
p_IÅ
->
u£CRA
 )

1440 iàÐÐ((*
cu¼Sliû
)->
ThisPOC
/2è- (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

1442 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (*cu¼Sliû)->num_»f_idx_aùive[
LIST_0
];

1447 
	`g‘_mem3D
((
by‹
 ****)(*)&(*
cu¼Sliû
)->
dœeù_»f_idx
, (*cu¼Sliû)->
height_blk
, (*cu¼Sliû)->
width_blk
, 2);

1448 
	`g‘_mem2D
((
by‹
 ***è(*)&(*
cu¼Sliû
)->
dœeù_pdœ
, (*cu¼Sliû)->
height_blk
, (*cu¼Sliû)->
width_blk
);

1451 
	`£tup_¦iû
(*
cu¼Sliû
);

1452 
	`upd©e_pic_num
(*
cu¼Sliû
);

1454 (*
cu¼Sliû
)->
	`š™_li¡s
(*currSlice);

1457 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (*cu¼Sliû)->
li¡Xsize
[LIST_0];

1458 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (*cu¼Sliû)->
li¡Xsize
[LIST_1];

1460 ià(
p_Vid
->
is_hme
 == 0)

1462 #ià
CRA


1463 iàÐ
p_IÅ
->
u£CRA
 )

1465 iàÐÐ(*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
P_SLICE
 ) && (*cu¼Sliû)->
p_Dpb
->
»f_äames_š_bufãr
 >= 2 )

1467 iàÐÐ((*
cu¼Sliû
)->
ThisPOC
/2è- (
p_Vid
->
p_IÅ
->
Numb”BF¿mes
+1èè%…_Vid->p_IÅ->
šŒa_³riod
 == 0 )

1469 
	`üa_»f_mªagem’t_äame_pic
(
p_Dpb
, 
p_Vid
->
äame_num
);

1475 #ià
HM50_LIKE_MMCO


1476 iàÐ
p_IÅ
->
HM50RefSŒuùu»
 )

1478 ià(
p_Vid
->
¡ruùu»
 =ð
FRAME
 && 
p_Dpb
->
»f_äames_š_bufãr
 =ð
aùive_¥s
->
num_»f_äames
)

1479 
	`hm50_»f_mªagem’t_äame_pic
(
p_Dpb
, 
p_Vid
->
äame_num
);

1483 #ià
LD_REF_SETTING


1484 ià(
p_IÅ
->
HMEDi§bËMMCO
 =ð0 &&…_IÅ->
LDRefS‘tšg
 &&…_IÅ->
UncÚ¡¿šedLDRef
 == 0)

1486 ià(
p_Vid
->
¡ruùu»
 =ð
FRAME
 && 
p_Dpb
->
»f_äames_š_bufãr
 =ð
aùive_¥s
->
num_»f_äames
)

1487 
	`low_d–ay_»f_mªagem’t_äame_pic
(
p_Dpb
, 
p_Vid
->
äame_num
);

1492 ià(
p_IÅ
->
S‘Fœ¡AsLÚgT”m
 && 
p_Vid
->
numb”
 == 0)

1494 
	`mmco_lÚg_‹rm
(
p_Vid
,…_Vid->
numb”
);

1496 ià(
p_Vid
->
Çl_»ã»nû_idc
 && 
p_IÅ
->
PocMemÜyMªagem’t
 == 1)

1498 ià(
p_Vid
->
¡ruùu»
 =ð
FRAME
 && 
p_Dpb
->
»f_äames_š_bufãr
 =ð
aùive_¥s
->
num_»f_äames
)

1499 
	`poc_ba£d_»f_mªagem’t_äame_pic
(
p_Dpb
, 
p_Vid
->
äame_num
);

1500 ià(
p_Vid
->
¡ruùu»
 =ð
TOP_FIELD
 && 
p_Dpb
->
»f_äames_š_bufãr
=ð
aùive_¥s
->
num_»f_äames
)

1501 
	`poc_ba£d_»f_mªagem’t_f›ld_pic
(
p_Dpb
, (
p_Vid
->
äame_num
 << 1) + 1);

1502 ià(
p_Vid
->
¡ruùu»
 =ð
BOTTOM_FIELD
)

1503 
	`poc_ba£d_»f_mªagem’t_f›ld_pic
(
p_Dpb
, (
p_Vid
->
äame_num
 << 1) + 1);

1505 ià(
p_Vid
->
Çl_»ã»nû_idc
 && 
p_IÅ
->
PocMemÜyMªagem’t
 == 2)

1507 ià(
p_Vid
->
¡ruùu»
 =ð
FRAME
)

1508 
	`Žyr_ba£d_»f_mªagem’t_äame_pic
(
p_Vid
,…_Vid->
äame_num
);

1511 
	`£t_deçuÉ_»f_pic_li¡s
(*
cu¼Sliû
);

1514 
	`š™_»f_pic_li¡_»Üd”šg
(*
cu¼Sliû
, 
p_IÅ
->
Reã»nûReÜd”
,…_IÅ->
U£Di¡ÜtiÚReÜd”
);

1515 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(*
cu¼Sliû
);

1517 #ià(
MVC_EXTENSION_ENABLE
)

1518 
p_Vid
->
MVCIÁ”V›wReÜd”
 = 0;

1520 if(
p_Vid
->
num_of_Ïy”s
 =ð2 && 
p_IÅ
->
MVCIÁ”V›wReÜd”
 =ð1 && 
Ïy”_id
 == 1)

1523 
p_Vid
->
MVCIÁ”V›wReÜd”
 = 1;

1525 (*
cu¼Sliû
)->
	`»Üd”_li¡s
( *currSlice );

1527 if((*
cu¼Sliû
)->
li¡Xsize
[0]!=0)

1529 
StÜabËPiùu»
 *
IÁ”_V›wL0
 = (*
cu¼Sliû
)->
li¡X
[0][(*cu¼Sliû)->
li¡Xsize
[0]-1];

1532 
i
=(*
cu¼Sliû
)->
li¡Xsize
[0] - 1; i>0; i--)

1533 (*
cu¼Sliû
)->
li¡X
[0][
i
] = (*currSlice)->listX[0][i - 1];

1534 (*
cu¼Sliû
)->
li¡X
[0][0] = 
IÁ”_V›wL0
;

1535 (*
cu¼Sliû
)->
li¡Xsize
[0] = (è
	`imš
 ((*cu¼Sliû)->li¡Xsize[0], (*cu¼Sliû)->
num_»f_idx_aùive
[
LIST_0
]);

1544 if(
p_IÅ
->
»dundªt_pic_æag
 && 
p_Vid
->
»dundªt_codšg
)

1546 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(*
cu¼Sliû
);

1547 (*
cu¼Sliû
)->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 1;

1548 (*
cu¼Sliû
)->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][0] = 0;

1549 (*
cu¼Sliû
)->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][1] = 3;

1550 (*
cu¼Sliû
)->
abs_diff_pic_num_mšus1
[
LIST_0
][0] = 
p_Vid
->
»dundªt_»f_idx
 - 1;

1551 (*
cu¼Sliû
)->
lÚg_‹rm_pic_idx
[
LIST_0
][0] = 0;

1553 
	`»Üd”_»f_pic_li¡
 ( *
cu¼Sliû
, 
LIST_0
);

1555 ià(Ð(*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
B_SLICE
è&& 
p_IÅ
->
WPMCP»cisiÚ
 && 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 !ð
WP_REGULAR
 )

1556 
	`wp_mý»c_»Üd”_li¡s
Ð*
cu¼Sliû
 );

1558 (*
cu¼Sliû
)->
	`»Üd”_li¡s
( *currSlice );

1560 ià(
p_IÅ
->
EÇbËO³nGOP
)

1561 
	`£tup_Ý’_gÝ_li¡s
(
p_Vid
, *
cu¼Sliû
);

1564 #ià
PRINTREFLIST


1565 #ià(
MVC_EXTENSION_ENABLE
)

1566 iàÐ(*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 )

1569 if(
p_Vid
->
cu¼’t_¦iû_Ä
==0)

1571 if((*
cu¼Sliû
)->
li¡Xsize
[0]>0)

1573 
	`´štf
("\n");

1574 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 0 ****\n", 
Ïy”_id
, (*
cu¼Sliû
)->
¡ruùu»
==
FRAME
 ? "FRM":((*cu¼Sliû)->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1575 
i
=0; i<()((*
cu¼Sliû
)->
li¡Xsize
[0]); i++)

1577 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, (*
cu¼Sliû
)->
li¡X
[0][i]->
poc
, (*cu¼Sliû)->li¡X[0][i]->
pic_num
, (*cu¼Sliû)->li¡X[0][i]->
v›w_id
);

1582 iàÐ(*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
 )

1585 if(
p_Vid
->
cu¼’t_¦iû_Ä
==0)

1587 if(((*
cu¼Sliû
)->
li¡Xsize
[0]>0) || ((*currSlice)->listXsize[1]>0))

1588 
	`´štf
("\n");

1589 if((*
cu¼Sliû
)->
li¡Xsize
[0]>0)

1591 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 0 ****\n", 
Ïy”_id
, (*
cu¼Sliû
)->
¡ruùu»
==
FRAME
 ? "FRM":((*cu¼Sliû)->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1592 
i
=0; i<()((*
cu¼Sliû
)->
li¡Xsize
[0]); i++)

1594 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, (*
cu¼Sliû
)->
li¡X
[0][i]->
poc
, (*cu¼Sliû)->li¡X[0][i]->
pic_num
, (*cu¼Sliû)->li¡X[0][i]->
v›w_id
);

1597 if((*
cu¼Sliû
)->
li¡Xsize
[1]>0)

1599 
	`´štf
(" ** (CurV›wID:%dè% ReàPiøLi¡ 1 ****\n", 
Ïy”_id
, (*
cu¼Sliû
)->
¡ruùu»
==
FRAME
 ? "FRM":((*cu¼Sliû)->¡ruùu»==
TOP_FIELD
 ? "TOP":"BOT"));

1600 
i
=0; i<()((*
cu¼Sliû
)->
li¡Xsize
[1]); i++)

1602 
	`´štf
(" %2d -> POC: %4d PicNum: %4d V›wID: %d\n", 
i
, (*
cu¼Sliû
)->
li¡X
[1][i]->
poc
, (*cu¼Sliû)->li¡X[1][i]->
pic_num
, (*cu¼Sliû)->li¡X[1][i]->
v›w_id
);

1611 (*
cu¼Sliû
)->
max_num_»ã»nûs
 = (è
p_Vid
->max_num_references;

1613 ià(((*
cu¼Sliû
)->
¦iû_ty³
 !ð
I_SLICE
è&& (*cu¼Sliû)->¦iû_ty³ !ð
SI_SLICE
)

1615 
®loc_size
 +ð
	`g‘_mem5Dmv
 (&((*
cu¼Sliû
)->
®l_mv
), 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 9, 4, 4);

1617 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 && ((*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
))

1619 
®loc_size
 +ð
	`g‘_mem6Dmv
 (&((*
cu¼Sliû
)->
b»d_mv
), 2, 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 9, 4, 4);

1622 ià(
p_IÅ
->
U£RDOQuªt
 &&…_IÅ->
RDOQ_QP_Num
 > 1)

1624 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 &&…_IÅ->
RDOQ_CP_MV
)

1626 
	`g‘_mem4Dmv
 (&(*
cu¼Sliû
)->
tmp_mv8
, 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 4, 4);

1627 
	`g‘_mem3Ddi¡blk
(&(*
cu¼Sliû
)->
mÙiÚ_co¡8
, 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 4);

1628 
	`g‘_mem4Dmv
 (&(*
cu¼Sliû
)->
tmp_mv4
, 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 4, 4);

1629 
	`g‘_mem3Ddi¡blk
(&(*
cu¼Sliû
)->
mÙiÚ_co¡4
, 2, (*cu¼Sliû)->
max_num_»ã»nûs
, 4);

1634 ià(
p_Vid
->
mb_aff_äame_æag
)

1635 
	`š™_mbaff_li¡s
(*
cu¼Sliû
);

1637 ià(((*
cu¼Sliû
)->
¦iû_ty³
 !ð
I_SLICE
 && (*cu¼Sliû)->¦iû_ty³ !ð
SI_SLICE
è&& (
p_Vid
->
aùive_µs
->
weigh‹d_´ed_æag
 =ð1 || (p_Vid->aùive_µs->
weigh‹d_b»d_idc
 > 0 && ((*cu¼Sliû)->¦iû_ty³ =ð
B_SLICE
))))

1639 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
SP_SLICE
)

1641 
wp_ty³
 = (
p_IÅ
->
G’”©eMuÉËPPS
 &&…_IÅ->
RDPiùu»DecisiÚ
è&& (
p_Vid
->
’c_piùu»
 !ðp_Vid->
’c_äame_piùu»
[1]);

1642 
p_Vid
->
	`E¡im©eWPPSliû
 (*
cu¼Sliû
, 
wp_ty³
);

1645 
p_Vid
->
	`E¡im©eWPBSliû
 (*
cu¼Sliû
);

1647 
	`ClWPP¬ams
Ð*
cu¼Sliû
 );

1650 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
)

1653 
	`compu‹_cÞoÿ‹d
(*
cu¼Sliû
, (*cu¼Sliû)->
li¡X
);

1656 ià((*
cu¼Sliû
)->
¦iû_ty³
 !ð
I_SLICE
 && (*cu¼Sliû)->¦iû_ty³ !ð
SI_SLICE
)

1658 
p_Vid
->
£¬chRªge
.
mš_x
 = -
p_IÅ
->
£¬ch_¿nge
[
Ïy”_id
] << 2;

1659 
p_Vid
->
£¬chRªge
.
max_x
 = 
p_IÅ
->
£¬ch_¿nge
[
Ïy”_id
] << 2;

1660 
p_Vid
->
£¬chRªge
.
mš_y
 = -
p_IÅ
->
£¬ch_¿nge
[
Ïy”_id
] << 2;

1661 
p_Vid
->
£¬chRªge
.
max_y
 = 
p_IÅ
->
£¬ch_¿nge
[
Ïy”_id
] << 2;

1663 ià(
p_IÅ
->
S—rchMode
[
Ïy”_id
] =ð
EPZS
)

1665 ià(((*
cu¼Sliû
)->
p_EPZS
 = (
EPZSP¬am‘”s
*è
	`ÿÎoc
(1, (EPZSP¬am‘”s)))==
NULL
)

1666 
	`no_mem_ex™
("init_slice:…_EPZS");

1667 
	`EPZSSŒuùIn™
 (*
cu¼Sliû
);

1668 
	`EPZSSliûIn™
 (*
cu¼Sliû
);

1673 ià((*
cu¼Sliû
)->
symbÞ_mode
 =ð
CAVLC
)

1675 
	`£tup_ÿvlc
(*
cu¼Sliû
, (*cu¼Sliû)->
li¡Xsize
);

1679 
	`£tup_ÿbac
(*
cu¼Sliû
, (*cu¼Sliû)->
li¡Xsize
);

1684 
i
 = 0; i < 
aùive_»f_li¡s
; i++)

1686 
j
 = 0; j < (*
cu¼Sliû
)->
li¡Xsize
[
i
]; j++)

1688 ifÐ(*
cu¼Sliû
)->
li¡X
[
i
][
j
] )

1690 (*
cu¼Sliû
)->
li¡X
[
i
][
j
]->
p_cu¼_img
 = (*cu¼Sliû)->li¡X[i][j]->
p_img
 [(è
p_Vid
->
cÞour_¶ªe_id
];

1691 (*
cu¼Sliû
)->
li¡X
[
i
][
j
]->
p_cu¼_img_sub
 = (*cu¼Sliû)->li¡X[i][j]->
p_img_sub
[(è
p_Vid
->
cÞour_¶ªe_id
];

1696 ià(
p_IÅ
->
U£RDOQuªt
)

1698 ià(((*
cu¼Sliû
)->
e¡B™sCabac
 = (
e¡B™sCabacSŒuù
*è
	`ÿÎoc
(
NUM_BLOCK_TYPES
, Ó¡B™sCabacSŒuù)))==
NULL
)

1699 
	`no_mem_ex™
("init_slice: (*currSlice)->estBitsCabac");

1701 
	`š™_rdoq_¦iû
(*
cu¼Sliû
);

1703 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_Œ–lis_cu¼
);

1704 ià(
p_IÅ
->
RDOQ_QP_Num
 > 1)

1706 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_Œ–lis_be¡
);

1710 if(
p_Vid
->
mb_aff_äame_æag
)

1712 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_tÝ_äame_mb
);

1713 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_bÙ_äame_mb
);

1714 iàÐ
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_MB_PAIR_CODING
 )

1716 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_tÝ_f›ld_mb
);

1717 
	`®loc_rdd©a
(*
cu¼Sliû
, &(*cu¼Sliû)->
rdd©a_bÙ_f›ld_mb
);

1721 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
)

1723 (*
cu¼Sliû
)->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBBSliû
;

1725 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
SP_SLICE
)

1727 (*
cu¼Sliû
)->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBPSliû
;

1731 (*
cu¼Sliû
)->
£t_mÙiÚ_veùÜs_mb
 = 
S‘MÙiÚVeùÜsMBISliû
;

1734 
	`g‘_mem3D³l
(&((*
cu¼Sliû
)->
mb_´ed
), 
MAX_PLANE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1735 
	`g‘_mem3Dšt
(&((*
cu¼Sliû
)->
mb_¼es
), 
MAX_PLANE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1736 
	`g‘_mem3Dšt
(&((*
cu¼Sliû
)->
mb_Ües
), 
MAX_PLANE
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1737 
	`g‘_mem4D³l
(&((*
cu¼Sliû
)->
m´_4x4
), 
MAX_PLANE
, 9, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1738 
	`g‘_mem4D³l
(&((*
cu¼Sliû
)->
m´_8x8
), 
MAX_PLANE
, 9, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1739 
	`g‘_mem4D³l
(&((*
cu¼Sliû
)->
m´_16x16
), 
MAX_PLANE
, 5, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE);

1741 
	`g‘_mem_ACcÛff
 (
p_Vid
, &((*
cu¼Sliû
)->
cofAC
));

1742 
	`g‘_mem_DCcÛff
 (&((*
cu¼Sliû
)->
cofDC
));

1744 
	`®loÿ‹_block_mem
(*
cu¼Sliû
);

1745 
	`š™_codšg_¡©e_m‘hods
(*
cu¼Sliû
);

1746 
	`š™_rdÝt
(*
cu¼Sliû
);

1747 
	}
}

1760 
	$š™_¦iû_l™e
 (
VideoP¬am‘”s
 *
p_Vid
, 
Sliû
 **
cu¼Sliû
, 
¡¬t_mb_addr
)

1762 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

1763 
i
,
j
;

1764 #ià(
MVC_EXTENSION_ENABLE
)

1765 
Ïy”_id
 = 
p_Vid
->
dpb_Ïy”_id
;

1767 
Ïy”_id
 = 0;

1769 
aùive_»f_li¡s
 = (
p_Vid
->
mb_aff_äame_æag
) ? 6 : 2;

1771 #ià(
MVC_EXTENSION_ENABLE
)

1772 if(
p_IÅ
->
num_of_v›ws
 == 2)

1774 
’abË_š‹r_v›w
 = (
p_Vid
->
Çl_»ã»nû_idc
 || 
p_IÅ
->
’abË_š‹r_v›w_æag
) ? 1 : 0;

1775 
p_Vid
->
´iÜ™y_id
 = 0;

1776 
p_Vid
->
‹mpÜ®_id
 = 0;

1777 
p_Vid
->
š‹r_v›w_æag
[0] = ((
Ïy”_id
 =ð0è? 
’abË_š‹r_v›w
 : 0);

1778 
p_Vid
->
š‹r_v›w_æag
[1] = ((
Ïy”_id
 =ð0è? 
’abË_š‹r_v›w
 : 0);

1780 if(
p_Vid
->
¡ruùu»
!=
BOTTOM_FIELD
)

1781 
p_Vid
->
ªchÜ_pic_æag
[0] = ((Õ_Vid->
cu¼’tPiùu»
->
idr_æag
 &&…_Vid->
Çl_»ã»nû_idc
!=0è||…_Vid->
´ev_v›w_is_ªchÜ
) ? 1:0);

1783 
p_Vid
->
ªchÜ_pic_æag
[1] = 0;

1784 
p_Vid
->
nÚ_idr_æag
[p_Vid->
¡ruùu»
!=
BOTTOM_FIELD
 ? 0:1] = !p_Vid->
ªchÜ_pic_æag
[p_Vid->structure!=BOTTOM_FIELD ? 0:1];

1788 *
cu¼Sliû
 = 
	`m®loc_¦iû_l™e
(
p_Vid
, 
p_IÅ
);

1790 
	`£t_¦iû
 (
p_Vid
, *
cu¼Sliû
);

1793 ià(((*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
SP_SLICE
è&& 
p_IÅ
->
P_Li¡0_»fs
[
Ïy”_id
])

1795 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
P_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1798 ià((*
cu¼Sliû
)->
¦iû_ty³
 =ð
B_SLICE
 )

1800 ià(
p_IÅ
->
B_Li¡0_»fs
[
Ïy”_id
])

1802 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_0], 
p_IÅ
->
B_Li¡0_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1804 ià(
p_IÅ
->
B_Li¡1_»fs
[
Ïy”_id
])

1806 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (è
	`imš
((*cu¼Sliû)->num_»f_idx_aùive[LIST_1], 
p_IÅ
->
B_Li¡1_»fs
[
Ïy”_id
] * ((
p_Vid
->
¡ruùu»
 !=0) + 1));

1810 
	`£tup_¦iû
(*
cu¼Sliû
);

1812 
	`upd©e_pic_num
(*
cu¼Sliû
);

1813 (*
cu¼Sliû
)->
	`š™_li¡s
(*currSlice);

1816 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_0
] = (*cu¼Sliû)->
li¡Xsize
[LIST_0];

1817 (*
cu¼Sliû
)->
num_»f_idx_aùive
[
LIST_1
] = (*cu¼Sliû)->
li¡Xsize
[LIST_1];

1819 
	`£t_deçuÉ_»f_pic_li¡s
(*
cu¼Sliû
);

1821 
	`š™_»f_pic_li¡_»Üd”šg
(*
cu¼Sliû
, 
p_IÅ
->
Reã»nûReÜd”
,…_IÅ->
U£Di¡ÜtiÚReÜd”
);

1822 
	`®loc_»f_pic_li¡_»Üd”šg_bufãr
(*
cu¼Sliû
);

1824 #ià(
MVC_EXTENSION_ENABLE
)

1825 
p_Vid
->
MVCIÁ”V›wReÜd”
 = 0;

1826 if(
p_Vid
->
num_of_Ïy”s
 =ð2 && 
p_IÅ
->
MVCIÁ”V›wReÜd”
 =ð1 && 
Ïy”_id
 == 1)

1829 
p_Vid
->
MVCIÁ”V›wReÜd”
 = 1;

1831 if((*
cu¼Sliû
)->
li¡Xsize
[0]!=0)

1833 
StÜabËPiùu»
 *
IÁ”_V›wL0
 = (*
cu¼Sliû
)->
li¡X
[0][(*cu¼Sliû)->
li¡Xsize
[0]-1];

1834 
i
=(*
cu¼Sliû
)->
li¡Xsize
[0] - 1; i>0; i--)

1835 (*
cu¼Sliû
)->
li¡X
[0][
i
] = (*currSlice)->listX[0][i - 1];

1836 (*
cu¼Sliû
)->
li¡X
[0][0] = 
IÁ”_V›wL0
;

1837 (*
cu¼Sliû
)->
li¡Xsize
[0] = (è
	`imš
 ((*cu¼Sliû)->li¡Xsize[0], (*cu¼Sliû)->
num_»f_idx_aùive
[
LIST_0
]);

1839 (*
cu¼Sliû
)->
	`»Üd”_li¡s
( *currSlice );

1847 if(
p_IÅ
->
»dundªt_pic_æag
 && 
p_Vid
->
»dundªt_codšg
)

1849 (*
cu¼Sliû
)->
»f_pic_li¡_»Üd”šg_æag
[
LIST_0
] = 1;

1850 (*
cu¼Sliû
)->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][0] = 0;

1851 (*
cu¼Sliû
)->
modifiÿtiÚ_of_pic_nums_idc
[
LIST_0
][1] = 3;

1852 (*
cu¼Sliû
)->
abs_diff_pic_num_mšus1
[
LIST_0
][0] = 
p_Vid
->
»dundªt_»f_idx
 - 1;

1853 (*
cu¼Sliû
)->
lÚg_‹rm_pic_idx
[
LIST_0
][0] = 0;

1855 
	`»Üd”_»f_pic_li¡
 ( *
cu¼Sliû
, 
LIST_0
);

1857 iàÐ((*
cu¼Sliû
)->
¦iû_ty³
 =ð
P_SLICE
 || (*cu¼Sliû)->¦iû_ty³ =ð
B_SLICE
è&& 
p_IÅ
->
WPMCP»cisiÚ
 && 
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 !ð
WP_REGULAR
 )

1858 
	`wp_mý»c_»Üd”_li¡s
Ð*
cu¼Sliû
 );

1860 (*
cu¼Sliû
)->
	`»Üd”_li¡s
( *currSlice );

1862 ià(
p_IÅ
->
EÇbËO³nGOP
)

1863 
	`£tup_Ý’_gÝ_li¡s
(
p_Vid
, *
cu¼Sliû
);

1866 (*
cu¼Sliû
)->
max_num_»ã»nûs
 = (è
p_Vid
->max_num_references;

1868 ià(
p_Vid
->
mb_aff_äame_æag
)

1869 
	`š™_mbaff_li¡s
(*
cu¼Sliû
);

1872 
i
 = 0; i < 
aùive_»f_li¡s
; i++)

1874 
j
 = 0; j < (*
cu¼Sliû
)->
li¡Xsize
[
i
]; j++)

1876 ifÐ(*
cu¼Sliû
)->
li¡X
[
i
][
j
] )

1878 (*
cu¼Sliû
)->
li¡X
[
i
][
j
]->
p_cu¼_img
 = (*cu¼Sliû)->li¡X[i][j]->
p_img
 [(è
p_Vid
->
cÞour_¶ªe_id
];

1879 (*
cu¼Sliû
)->
li¡X
[
i
][
j
]->
p_cu¼_img_sub
 = (*cu¼Sliû)->li¡X[i][j]->
p_img_sub
[(è
p_Vid
->
cÞour_¶ªe_id
];

1884 (*
cu¼Sliû
)->
e¡B™sCabac
 = 
NULL
;

1885 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_Œ–lis_cu¼
));

1886 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_Œ–lis_be¡
));

1888 if(
p_Vid
->
mb_aff_äame_æag
)

1890 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_tÝ_äame_mb
));

1891 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_bÙ_äame_mb
));

1892 iàÐ
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_MB_PAIR_CODING
 )

1894 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_tÝ_f›ld_mb
));

1895 
	`nuÎify_rdd©a
(&((*
cu¼Sliû
)->
rdd©a_bÙ_f›ld_mb
));

1899 (*
cu¼Sliû
)->
®l_mv
 = 
NULL
;

1900 (*
cu¼Sliû
)->
b»d_mv
 = 
NULL
;

1902 (*
cu¼Sliû
)->
tmp_mv8
 = 
NULL
;

1903 (*
cu¼Sliû
)->
mÙiÚ_co¡8
 = 
NULL
;

1904 (*
cu¼Sliû
)->
tmp_mv4
 = 
NULL
;

1905 (*
cu¼Sliû
)->
mÙiÚ_co¡4
 = 
NULL
;

1906 (*
cu¼Sliû
)->
p_EPZS
 = 
NULL
;

1908 (*
cu¼Sliû
)->
mb_´ed
 = 
NULL
;

1909 (*
cu¼Sliû
)->
mb_¼es
 = 
NULL
;

1910 (*
cu¼Sliû
)->
mb_Ües
 = 
NULL
;

1911 (*
cu¼Sliû
)->
m´_4x4
 = 
NULL
;

1912 (*
cu¼Sliû
)->
m´_8x8
 = 
NULL
;

1913 (*
cu¼Sliû
)->
m´_16x16
 = 
NULL
;

1915 (*
cu¼Sliû
)->
cofAC
 = 
NULL
;

1916 (*
cu¼Sliû
)->
cofDC
 = 
NULL
;

1918 (*
cu¼Sliû
)->
tblk4x4
 = 
NULL
;

1919 (*
cu¼Sliû
)->
tblk16x16
 = 
NULL
;

1920 (*
cu¼Sliû
)->
i16blk4x4
 = 
NULL
;

1922 (*
cu¼Sliû
)->
dœeù_»f_idx
 = 
NULL
;

1923 (*
cu¼Sliû
)->
dœeù_pdœ
 = 
NULL
;

1925 
	`š™_codšg_¡©e_m‘hods
(*
cu¼Sliû
);

1926 
	}
}

1936 
Sliû
 *
	$m®loc_¦iû
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

1938 
i
;

1939 
D©aP¬t™iÚ
 *
d©aP¬t
;

1940 
Sliû
 *
cu¼Sliû
;

1941 
ü_size
 = (
p_IÅ
->
£·¿‹_cÞour_¶ªe_æag
 != 0) ? 0 : 512;

1943 
bufãr_size
;

1945 
p_IÅ
->
¦iû_mode
)

1949 
bufãr_size
 = 
	`imax
(2 * 
p_IÅ
->
¦iû_¬gum’t
, 764);

1952 
bufãr_size
 = 500 + 
p_IÅ
->
¦iû_¬gum’t
 * ((128 + 256 * 
p_Vid
->
b™d•th_luma
 + 
ü_size
 *…_Vid->
b™d•th_chroma
) >> 3);

1955 
bufãr_size
 = 500 + 
p_Vid
->
F¿meSizeInMbs
 * ((128 + 256 *…_Vid->
b™d•th_luma
 + 
ü_size
 *…_Vid->
b™d•th_chroma
) >> 3);

1960 ià((
cu¼Sliû
 = (
Sliû
 *è
	`ÿÎoc
(1, (Sliû))è=ð
NULL
è
	`no_mem_ex™
 ("malloc_slice: currSlice structure");

1962 
cu¼Sliû
->
p_Vid
 =…_Vid;

1963 
cu¼Sliû
->
p_IÅ
 =…_Inp;

1965 ià(((
cu¼Sliû
->
p_RDO
èð(
RDOPTSŒuùu»
 *è
	`ÿÎoc
(1, (RDOPTSŒuùu»)))==
NULL
)

1966 
	`no_mem_ex™
("malloc_slice:…_RDO");

1968 
cu¼Sliû
->
symbÞ_mode
 = (è
p_IÅ
->symbol_mode;

1970 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

1973 
cu¼Sliû
->
mÙ_ùx
 = 
	`ü—‹_cÚ‹xts_MÙiÚInfo
 ();

1974 
cu¼Sliû
->
‹x_ùx
 = 
	`ü—‹_cÚ‹xts_Textu»Info
();

1977 
cu¼Sliû
->
max_·¹_Ä
 = 
p_IÅ
->
·¹™iÚ_mode
==0?1:3;

1980 if(
p_Vid
->
cu¼’tPiùu»
->
idr_æag
)

1981 
cu¼Sliû
->
max_·¹_Ä
 = 1;

1983 
assignSE2·¹™iÚ
[0] = 
assignSE2·¹™iÚ_NoDP
;

1986 if(!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 && 
p_IÅ
->
·¹™iÚ_mode
 == 1)

1987 
assignSE2·¹™iÚ
[1] = 
assignSE2·¹™iÚ_DP
;

1989 
assignSE2·¹™iÚ
[1] = 
assignSE2·¹™iÚ_NoDP
;

1991 
cu¼Sliû
->
num_mb
 = 0;

1993 ià((
cu¼Sliû
->
·¹A¼
 = (
D©aP¬t™iÚ
 *è
	`ÿÎoc
(cu¼Sliû->
max_·¹_Ä
, (D©aP¬t™iÚ))è=ð
NULL
)

1994 
	`no_mem_ex™
 ("malloc_slice:…artArr");

1995 
i
=0; i<
cu¼Sliû
->
max_·¹_Ä
; i++)

1997 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

1998 ià((
d©aP¬t
->
b™¡»am
 = (
B™¡»am
 *è
	`ÿÎoc
(1, (B™¡»am))è=ð
NULL
)

1999 
	`no_mem_ex™
 ("malloc_slice: Bitstream");

2000 ià((
d©aP¬t
->
b™¡»am
->
¡»amBufãr
 = (
by‹
 *è
	`ÿÎoc
(
bufãr_size
, (by‹))è=ð
NULL
)

2001 
	`no_mem_ex™
 ("malloc_slice: StreamBuffer");

2002 
d©aP¬t
->
b™¡»am
->
bufãr_size
 = buffer_size;

2005 
d©aP¬t
->
p_Sliû
 = 
cu¼Sliû
;

2006 
d©aP¬t
->
p_Vid
 =…_Vid;

2007 
d©aP¬t
->
p_IÅ
 =…_Inp;

2010 ià(
p_IÅ
->
Weigh‹dP»diùiÚ
 ||…_IÅ->
Weigh‹dB»diùiÚ
 ||…_IÅ->
G’”©eMuÉËPPS
)

2013 
	`g‘_mem3DshÜt
(&
cu¼Sliû
->
wp_weight
 , 6, 
MAX_REFERENCE_PICTURES
, 3);

2014 
	`g‘_mem3DshÜt
(&
cu¼Sliû
->
wp_off£t
 , 6, 
MAX_REFERENCE_PICTURES
, 3);

2015 
	`g‘_mem4DshÜt
(&
cu¼Sliû
->
wbp_weight
, 6, 
MAX_REFERENCE_PICTURES
, MAX_REFERENCE_PICTURES, 3);

2018  
cu¼Sliû
;

2019 
	}
}

2032 
Sliû
 *
	$m®loc_¦iû_l™e
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

2034 
Sliû
 *
cu¼Sliû
;

2037 ià((
cu¼Sliû
 = (
Sliû
 *è
	`ÿÎoc
(1, (Sliû))è=ð
NULL
è
	`no_mem_ex™
 ("malloc_slice: currSlice structure");

2039 
cu¼Sliû
->
p_Vid
 =…_Vid;

2040 
cu¼Sliû
->
p_IÅ
 =…_Inp;

2041 
cu¼Sliû
->
p_RDO
 = 
NULL
;

2043 
cu¼Sliû
->
symbÞ_mode
 = (è
p_IÅ
->symbol_mode;

2046 
cu¼Sliû
->
mÙ_ùx
 = 
NULL
;

2047 
cu¼Sliû
->
‹x_ùx
 = 
NULL
;

2050 
cu¼Sliû
->
max_·¹_Ä
 = 
p_IÅ
->
·¹™iÚ_mode
==0?1:3;

2053 if(
p_Vid
->
cu¼’tPiùu»
->
idr_æag
)

2054 
cu¼Sliû
->
max_·¹_Ä
 = 1;

2056 
assignSE2·¹™iÚ
[0] = 
assignSE2·¹™iÚ_NoDP
;

2059 if(!
p_Vid
->
cu¼’tPiùu»
->
idr_æag
 && 
p_IÅ
->
·¹™iÚ_mode
 == 1)

2060 
assignSE2·¹™iÚ
[1] = 
assignSE2·¹™iÚ_DP
;

2062 
assignSE2·¹™iÚ
[1] = 
assignSE2·¹™iÚ_NoDP
;

2064 
cu¼Sliû
->
num_mb
 = 0;

2066 
cu¼Sliû
->
·¹A¼
 = 
NULL
;

2068 ià(
p_IÅ
->
Weigh‹dP»diùiÚ
 ||…_IÅ->
Weigh‹dB»diùiÚ
 ||…_IÅ->
G’”©eMuÉËPPS
)

2071 
	`g‘_mem3DshÜt
(&
cu¼Sliû
->
wp_weight
, 6, 
MAX_REFERENCE_PICTURES
, 3);

2072 
	`g‘_mem3DshÜt
(&
cu¼Sliû
->
wp_off£t
, 6, 
MAX_REFERENCE_PICTURES
, 3);

2073 
	`g‘_mem4DshÜt
(&
cu¼Sliû
->
wbp_weight
, 6, 
MAX_REFERENCE_PICTURES
, MAX_REFERENCE_PICTURES, 3);

2076  
cu¼Sliû
;

2077 
	}
}

2088 
	$ä“_Çl_un™
(
Piùu»
 *
pic
)

2090 
·¹™iÚ
, 
¦iû
;

2091 
Sliû
 *
cu¼Sliû
;

2094 
¦iû
=0; sliû < 
pic
->
no_¦iûs
; slice++)

2096 
cu¼Sliû
 = 
pic
->
¦iûs
[
¦iû
];

2099 ià(
cu¼Sliû
 !ð
NULL
)

2101 
·¹™iÚ
=0;…¬t™iÚ < 
cu¼Sliû
->
max_·¹_Ä
;…artition++)

2104 ià(
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
b™¡»am
->
wr™e_æag
 )

2106 ià(
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
Çl_un™
 !ð
NULL
)

2108 
	`F»eNALU
(
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
Çl_un™
);

2109 
cu¼Sliû
->
·¹A¼
[
·¹™iÚ
].
Çl_un™
 = 
NULL
;

2115 
	}
}

2127 
	$ä“_¦iû
(
Sliû
 *
cu¼Sliû
)

2129 ià(
cu¼Sliû
 !ð
NULL
)

2131 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

2132 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

2134 
i
;

2135 
D©aP¬t™iÚ
 *
d©aP¬t
;

2137 
i
=0; i<6; i++)

2139 ià(
cu¼Sliû
->
li¡X
[
i
])

2141 
	`ä“
 (
cu¼Sliû
->
li¡X
[
i
]);

2142 
cu¼Sliû
->
li¡X
[
i
] = 
NULL
;

2146 
i
 = 0; i < 
cu¼Sliû
->
max_·¹_Ä
; i++)

2148 iàÐ
cu¼Sliû
->
·¹A¼
 !ð
NULL
)

2150 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
i
]);

2152 ià(
d©aP¬t
 !ð
NULL
)

2154 ià(
d©aP¬t
->
b™¡»am
 !ð
NULL
)

2156 ià(
d©aP¬t
->
b™¡»am
->
¡»amBufãr
 !ð
NULL
)

2158 
	`ä“
(
d©aP¬t
->
b™¡»am
->
¡»amBufãr
);

2159 
d©aP¬t
->
b™¡»am
->
¡»amBufãr
 = 
NULL
;

2161 
	`ä“
(
d©aP¬t
->
b™¡»am
);

2162 
d©aP¬t
->
b™¡»am
 = 
NULL
;

2168 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

2169 
	`ä“_»f_pic_li¡_»Üd”šg_bufãr
 (
cu¼Sliû
);

2172 if(
cu¼Sliû
->
p_RDO
)

2174 
	`þ—r_rdÝt
 (
cu¼Sliû
);

2175 
	`ä“
 (
cu¼Sliû
->
p_RDO
);

2178 if(
cu¼Sliû
->
cofAC
)

2179 
	`ä“_mem_ACcÛff
 (
cu¼Sliû
->
cofAC
);

2180 if(
cu¼Sliû
->
cofDC
)

2181 
	`ä“_mem_DCcÛff
 (
cu¼Sliû
->
cofDC
);

2183 if(
cu¼Sliû
->
mb_¼es
)

2184 
	`ä“_mem3Dšt
(
cu¼Sliû
->
mb_¼es
 );

2185 if(
cu¼Sliû
->
mb_Ües
)

2186 
	`ä“_mem3Dšt
(
cu¼Sliû
->
mb_Ües
 );

2187 if(
cu¼Sliû
->
mb_´ed
)

2188 
	`ä“_mem3D³l
(
cu¼Sliû
->
mb_´ed
 );

2189 if(
cu¼Sliû
->
m´_16x16
)

2190 
	`ä“_mem4D³l
(
cu¼Sliû
->
m´_16x16
);

2191 if(
cu¼Sliû
->
m´_8x8
)

2192 
	`ä“_mem4D³l
(
cu¼Sliû
->
m´_8x8
 );

2193 if(
cu¼Sliû
->
m´_4x4
)

2194 
	`ä“_mem4D³l
(
cu¼Sliû
->
m´_4x4
 );

2197 ià(
cu¼Sliû
->
·¹A¼
 !ð
NULL
)

2199 
	`ä“
(
cu¼Sliû
->
·¹A¼
);

2200 
cu¼Sliû
->
·¹A¼
 = 
NULL
;

2203 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CABAC
)

2205 if(
cu¼Sliû
->
mÙ_ùx
)

2206 
	`d–‘e_cÚ‹xts_MÙiÚInfo
(
cu¼Sliû
->
mÙ_ùx
);

2207 if(
cu¼Sliû
->
‹x_ùx
)

2208 
	`d–‘e_cÚ‹xts_Textu»Info
(
cu¼Sliû
->
‹x_ùx
);

2211 ià(
p_IÅ
->
Weigh‹dP»diùiÚ
 ||…_IÅ->
Weigh‹dB»diùiÚ
 ||…_IÅ->
G’”©eMuÉËPPS
)

2213 
	`ä“_mem3DshÜt
(
cu¼Sliû
->
wp_weight
 );

2214 
	`ä“_mem3DshÜt
(
cu¼Sliû
->
wp_off£t
 );

2215 
	`ä“_mem4DshÜt
(
cu¼Sliû
->
wbp_weight
);

2218 ià(
cu¼Sliû
->
U£RDOQuªt
)

2220 
	`ä“
(
cu¼Sliû
->
e¡B™sCabac
);

2222 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_Œ–lis_cu¼
);

2223 if(
cu¼Sliû
->
RDOQ_QP_Num
 > 1)

2225 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_Œ–lis_be¡
);

2229 if(
cu¼Sliû
->
mb_aff_äame_æag
)

2231 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_tÝ_äame_mb
);

2232 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_bÙ_äame_mb
);

2234 iàÐ
p_IÅ
->
MbIÁ”Ïû
 !ð
FRAME_MB_PAIR_CODING
 )

2236 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_tÝ_f›ld_mb
);

2237 
	`ä“_rdd©a
(
cu¼Sliû
, &cu¼Sliû->
rdd©a_bÙ_f›ld_mb
);

2241 ià((
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
SP_SLICE
è|| (cu¼Sliû->¦iû_ty³ =ð
B_SLICE
))

2243 if(
cu¼Sliû
->
®l_mv
)

2244 
	`ä“_mem5Dmv
 (
cu¼Sliû
->
®l_mv
);

2245 ià(
p_IÅ
->
BiP»dMÙiÚE¡im©iÚ
 && (
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
è&& cu¼Sliû->
b»d_mv
)

2246 
	`ä“_mem6Dmv
(
cu¼Sliû
->
b»d_mv
);

2248 ià(
cu¼Sliû
->
U£RDOQuªt
 && cu¼Sliû->
RDOQ_QP_Num
 > 1)

2250 ià(
p_IÅ
->
T¿nsfÜm8x8Mode
 &&…_IÅ->
RDOQ_CP_MV
)

2252 if(
cu¼Sliû
->
tmp_mv8
)

2253 
	`ä“_mem4Dmv
 (
cu¼Sliû
->
tmp_mv8
);

2254 if(
cu¼Sliû
->
mÙiÚ_co¡8
)

2255 
	`ä“_mem3Ddi¡blk
(
cu¼Sliû
->
mÙiÚ_co¡8
);

2256 if(
cu¼Sliû
->
tmp_mv4
)

2257 
	`ä“_mem4Dmv
 (
cu¼Sliû
->
tmp_mv4
);

2258 if(
cu¼Sliû
->
mÙiÚ_co¡4
)

2259 
	`ä“_mem3Ddi¡blk
(
cu¼Sliû
->
mÙiÚ_co¡4
);

2264 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2266 if(
cu¼Sliû
->
dœeù_»f_idx
)

2267 
	`ä“_mem3D
((
by‹
 ***)
cu¼Sliû
->
dœeù_»f_idx
);

2268 if(
cu¼Sliû
->
dœeù_pdœ
)

2269 
	`ä“_mem2D
((
by‹
 **è
cu¼Sliû
->
dœeù_pdœ
);

2272 
	`ä“_block_mem
(
cu¼Sliû
);

2274 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
I_SLICE
 && cu¼Sliû->¦iû_ty³ !ð
SI_SLICE
)

2276 ià(
p_IÅ
->
S—rchMode
[
p_Vid
->
v›w_id
] =ð
EPZS
)

2278 if(
cu¼Sliû
->
p_EPZS
)

2279 
	`EPZSSŒuùD–‘e
 (
cu¼Sliû
);

2283 
	`ä“
(
cu¼Sliû
);

2285 
	}
}

2296 
	$ä“_¦iû_li¡
(
Piùu»
 *
cu¼Pic
)

2298 
i
;

2300 ià(
cu¼Pic
 !ð
NULL
)

2302 
	`ä“_Çl_un™
(
cu¼Pic
);

2304 
i
 = 0; i < 
cu¼Pic
->
no_¦iûs
; i++)

2306 
	`ä“_¦iû
 (
cu¼Pic
->
¦iûs
[
i
]);

2307 
cu¼Pic
->
¦iûs
[
i
] = 
NULL
;

2310 
	}
}

2312 
	$Upd©eMELambda
(
Sliû
 *
cu¼Sliû
)

2314 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

2316 ià(
p_IÅ
->
Upd©eLambdaChromaME
)

2318 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

2319 
j
, 
k
, 
qp
;

2320 ià(
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
)

2321 
j
 = 
cu¼Sliû
->
Çl_»ã»nû_idc
 ? 5 : 
B_SLICE
;

2323 
j
 = 
cu¼Sliû
->
¦iû_ty³
;

2325 
p_Vid
->
yuv_fÜm©
)

2327 
YUV420
:

2328 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

2330 
k
 = 0; k < 3; k++)

2332 ià((
p_IÅ
->
MEE¼ÜM‘ric
[
k
] =ð
ERROR_SAD
è&& (p_IÅ->
ChromaMEEÇbË
))

2334 
p_Vid
->
Ïmbda_mf
[
j
][
qp
][
k
] = (3 *…_Vid->lambda_mf[j][qp][k] + 1) >> 1;

2335 
p_Vid
->
Ïmbda_me
[
j
][
qp
][
k
] *= 1.5;

2340 
YUV422
:

2341 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

2343 
k
 = 0; k < 3; k++)

2345 ià((
p_IÅ
->
MEE¼ÜM‘ric
[
k
] =ð
ERROR_SAD
è&& (p_IÅ->
ChromaMEEÇbË
))

2347 
p_Vid
->
Ïmbda_mf
[
j
][
qp
][
k
] *= 2;

2348 
p_Vid
->
Ïmbda_me
[
j
][
qp
][
k
] *= 2.0;

2353 
YUV444
:

2354 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

2356 
k
 = 0; k < 3; k++)

2358 ià((
p_IÅ
->
MEE¼ÜM‘ric
[
k
] =ð
ERROR_SAD
è&& (p_IÅ->
ChromaMEEÇbË
))

2360 
p_Vid
->
Ïmbda_mf
[
j
][
qp
][
k
] *= 3;

2361 
p_Vid
->
Ïmbda_me
[
j
][
qp
][
k
] *= 3.0;

2370 
	}
}

2373 
	$S‘Lag¿ngŸnMuÉl›rsOn
(
Sliû
 *
cu¼Sliû
)

2375 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

2377 ià(
p_IÅ
->
U£Ex¶ic™LambdaP¬ams
 == 1)

2378 
	`g‘_ex¶ic™_Ïmbda
(
cu¼Sliû
);

2379 ià(
p_IÅ
->
U£Ex¶ic™LambdaP¬ams
 == 2)

2380 
	`g‘_fixed_Ïmbda
(
cu¼Sliû
);

2383 
cu¼Sliû
->
¦iû_ty³
)

2385 
I_SLICE
:

2386 
	`g‘_im¶ic™_Ïmbda_i_¦iû
(
cu¼Sliû
);

2389 
P_SLICE
:

2390 
	`g‘_im¶ic™_Ïmbda_p_¦iû
(
cu¼Sliû
);

2392 
B_SLICE
:

2393 
	`g‘_im¶ic™_Ïmbda_b_¦iû
(
cu¼Sliû
);

2395 
SI_SLICE
:

2396 
SP_SLICE
:

2397 
	`g‘_im¶ic™_Ïmbda_¥_¦iû
(
cu¼Sliû
);

2402 
	`Upd©eMELambda
(
cu¼Sliû
);

2403 iàÐ
p_IÅ
->
U£RDOQuªt
 )

2405 
	`£t_rdoq_Ïmbda
(
cu¼Sliû
);

2407 
	}
}

2410 
	$S‘Lag¿ngŸnMuÉl›rsOff
(
Sliû
 *
cu¼Sliû
)

2412 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

2413 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

2415 
qp
, 
j
, 
k
;

2416 
qp_‹mp
;

2418 
j
 = 0; j < 6; j++)

2420 
qp
 = -
cu¼Sliû
->
b™d•th_luma_qp_sÿË
; qp < 52; qp++)

2422 
qp_‹mp
 = ()
qp
 + 
cu¼Sliû
->
b™d•th_luma_qp_sÿË
 - 
SHIFT_QP
;

2424 
p_IÅ
->
U£Ex¶ic™LambdaP¬ams
)

2427 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
	`sq¹
(
p_IÅ
->
LambdaWeight
[j] * 
	`pow
 (2, 
qp_‹mp
/3.0));

2430 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
	`sq¹
(
p_IÅ
->
FixedLambda
[j]);

2433 
p_Vid
->
Ïmbda_md
[
j
][
qp
] = 
QP2QUANT
[
	`imax
(0,q°- 
SHIFT_QP
)];

2437 
k
 = 
F_PEL
; k <ð
Q_PEL
; k++)

2439 
p_Vid
->
Ïmbda_me
[
j
][
qp
][
k
] = (
p_IÅ
->
MEE¼ÜM‘ric
[k] =ð
ERROR_SSE
 &&…_IÅ->
MESoá’SSEM‘ric
 =ð0è? (p_Vid->
Ïmbda_md
[j][qp] *…_Vid->lambda_md[j][qp]) :…_Vid->lambda_md[j][qp];

2440 
p_Vid
->
Ïmbda_mf
[
j
][
qp
][
k
] = 
	`LAMBDA_FACTOR
 (p_Vid->
Ïmbda_me
[j][qp][k]);

2443 ià(
p_IÅ
->
CtxAd±Lag¿ngeMuÉ
 == 1)

2445 
Ïmbda_qp
 = (
qp
 >ð32 && !
p_IÅ
->
RCEÇbË
è? 
	`imax
(0, qp-4) : imax(0, qp-6);

2446 
p_Vid
->
Ïmbda_mf_çùÜ
[
j
][
qp
] = 
	`log
 (p_Vid->
Ïmbda_me
[j][
Ïmbda_qp
][
Q_PEL
] + 1.0) /†og (2.0);

2450 
	`Upd©eMELambda
(
cu¼Sliû
);

2451 iàÐ
p_IÅ
->
U£RDOQuªt
 )

2453 
	`£t_rdoq_Ïmbda
(
cu¼Sliû
);

2455 
	}
}

	@lencod/src/symbol.c

17 
	~"glob®.h
"

18 
	~"symbÞ.h
"

	@lencod/src/transform8x8.c

18 
	~<m©h.h
>

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

23 
	~"image.h
"

24 
	~"mb_acûss.h
"

25 
	~"blk_´ediùiÚ.h
"

26 
	~"–em’ts.h
"

27 
	~"vlc.h
"

28 
	~"ŒªsfÜm8x8.h
"

29 
	~"ŒªsfÜm.h
"

30 
	~"maüoblock.h
"

31 
	~"symbÞ.h
"

32 
	~"mc_´ediùiÚ.h
"

33 
	~"md_di¡ÜtiÚ.h
"

34 
	~"quªt8x8.h
"

35 
	~"rdoq.h
"

36 
	~"q_m©rix.h
"

37 
	~"q_off£ts.h
"

38 
	~"rdÝt.h
"

39 
	~"md_commÚ.h
"

40 
	~"šŒa8x8.h
"

41 
	~"rdÝt_codšg_¡©e.h
"

44 cÚ¡ 
by‹
 
	gSNGL_SCAN8x8
[64][2] = {

55 cÚ¡ 
by‹
 
	gSNGL_SCAN8x8_CAVLC
[64][2] = {

63 cÚ¡ 
by‹
 
	gFIELD_SCAN8x8
[64][2] = {

74 cÚ¡ 
by‹
 
	gFIELD_SCAN8x8_CAVLC
[64][2] = {

83 cÚ¡ 
by‹
 
	gCOEFF_COST8x8
[2][64] =

97 
	#P_Z
 (
P»dP–
[0])

	)

98 
	#P_A
 (
P»dP–
[1])

	)

99 
	#P_B
 (
P»dP–
[2])

	)

100 
	#P_C
 (
P»dP–
[3])

	)

101 
	#P_D
 (
P»dP–
[4])

	)

102 
	#P_E
 (
P»dP–
[5])

	)

103 
	#P_F
 (
P»dP–
[6])

	)

104 
	#P_G
 (
P»dP–
[7])

	)

105 
	#P_H
 (
P»dP–
[8])

	)

106 
	#P_I
 (
P»dP–
[9])

	)

107 
	#P_J
 (
P»dP–
[10])

	)

108 
	#P_K
 (
P»dP–
[11])

	)

109 
	#P_L
 (
P»dP–
[12])

	)

110 
	#P_M
 (
P»dP–
[13])

	)

111 
	#P_N
 (
P»dP–
[14])

	)

112 
	#P_O
 (
P»dP–
[15])

	)

113 
	#P_P
 (
P»dP–
[16])

	)

114 
	#P_Q
 (
P»dP–
[17])

	)

115 
	#P_R
 (
P»dP–
[18])

	)

116 
	#P_S
 (
P»dP–
[19])

	)

117 
	#P_T
 (
P»dP–
[20])

	)

118 
	#P_U
 (
P»dP–
[21])

	)

119 
	#P_V
 (
P»dP–
[22])

	)

120 
	#P_W
 (
P»dP–
[23])

	)

121 
	#P_X
 (
P»dP–
[24])

	)

135 
	$Residu®_DPCM_8x8
(
mode
, **
Ües
, **
¼es
,
block_y
, 
block_x
)

137 
i
,
j
;

138 
‹mp
[8][8];

140 if(
mode
==
VERT_PRED
)

142 
j
=0; j<8; j++)

143 
‹mp
[0][
j
] = 
Ües
[
block_y
][
block_x
+j];

145 
i
=1; i<8; i++)

146 
j
=0; j<8; j++)

147 
‹mp
[
i
][
j
] = 
Ües
[
block_y
+i][
block_x
+j] - ores[block_y+i-1][block_x+j];

149 
i
 = 0; i < 8; i++)

150 
j
 = 0; j < 8; j++)

151 
¼es
[
block_y
+
i
][
block_x
+
j
] = 
‹mp
[i][j];

155 
i
=0; i<8; i++)

156 
‹mp
[
i
][0] = 
Ües
[
block_y
 + i][
block_x
];

158 
i
=0; i<8; i++)

159 
j
=1; j<8; j++)

160 
‹mp
[
i
][
j
] = 
Ües
[
block_y
+i][
block_x
+j] - ores[block_y+i][block_x+j-1];

162 
i
=0; i<8; i++)

163 
j
=0; j<8; j++)

164 
¼es
[
block_y
+
i
][
block_x
+
j
] = 
‹mp
[i][j];

167 
	}
}

179 
	$Inv_Residu®_DPCM_8x8
(
Maüoblock
 *
cu¼MB
, **
m7
, 
block_y
, 
block_x
)

181 
i
;

182 
‹mp
[8][8];

184 if(
cu¼MB
->
mode_DPCM
 =ð
VERT_PRED
)

186 
i
=0; i<8; i++)

188 
‹mp
[0][
i
] = 
m7
[
block_y
+0][
block_x
+i];

189 
‹mp
[1][
i
] =emp[0][i] + 
m7
[
block_y
+1][
block_x
+i];

190 
‹mp
[2][
i
] =emp[1][i] + 
m7
[
block_y
+2][
block_x
+i];

191 
‹mp
[3][
i
] =emp[2][i] + 
m7
[
block_y
+3][
block_x
+i];

192 
‹mp
[4][
i
] =emp[3][i] + 
m7
[
block_y
+4][
block_x
+i];

193 
‹mp
[5][
i
] =emp[4][i] + 
m7
[
block_y
+5][
block_x
+i];

194 
‹mp
[6][
i
] =emp[5][i] + 
m7
[
block_y
+6][
block_x
+i];

195 
‹mp
[7][
i
] =emp[6][i] + 
m7
[
block_y
+7][
block_x
+i];

197 
i
=0; i<8; i++)

199 
m7
[
block_y
+1][
block_x
+
i
] = 
‹mp
[1][i];

200 
m7
[
block_y
+2][
block_x
+
i
] = 
‹mp
[2][i];

201 
m7
[
block_y
+3][
block_x
+
i
] = 
‹mp
[3][i];

202 
m7
[
block_y
+4][
block_x
+
i
] = 
‹mp
[4][i];

203 
m7
[
block_y
+5][
block_x
+
i
] = 
‹mp
[5][i];

204 
m7
[
block_y
+6][
block_x
+
i
] = 
‹mp
[6][i];

205 
m7
[
block_y
+7][
block_x
+
i
] = 
‹mp
[7][i];

210 
i
=0; i<8; i++)

212 
‹mp
[
i
][0] = 
m7
[
block_y
+i][
block_x
+0];

213 
‹mp
[
i
][1] =emp[i][0] + 
m7
[
block_y
+i][
block_x
+1];

214 
‹mp
[
i
][2] =emp[i][1] + 
m7
[
block_y
+i][
block_x
+2];

215 
‹mp
[
i
][3] =emp[i][2] + 
m7
[
block_y
+i][
block_x
+3];

216 
‹mp
[
i
][4] =emp[i][3] + 
m7
[
block_y
+i][
block_x
+4];

217 
‹mp
[
i
][5] =emp[i][4] + 
m7
[
block_y
+i][
block_x
+5];

218 
‹mp
[
i
][6] =emp[i][5] + 
m7
[
block_y
+i][
block_x
+6];

219 
‹mp
[
i
][7] =emp[i][6] + 
m7
[
block_y
+i][
block_x
+7];

221 
i
=0; i<8; i++)

223 
m7
[
block_y
+
i
][
block_x
+1] = 
‹mp
[i][1];

224 
m7
[
block_y
+
i
][
block_x
+2] = 
‹mp
[i][2];

225 
m7
[
block_y
+
i
][
block_x
+3] = 
‹mp
[i][3];

226 
m7
[
block_y
+
i
][
block_x
+4] = 
‹mp
[i][4];

227 
m7
[
block_y
+
i
][
block_x
+5] = 
‹mp
[i][5];

228 
m7
[
block_y
+
i
][
block_x
+6] = 
‹mp
[i][6];

229 
m7
[
block_y
+
i
][
block_x
+7] = 
‹mp
[i][7];

233 
	}
}

241 
	$mode_decisiÚ_fÜ_I8x8_MB
 (
Maüoblock
 *
cu¼MB
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
)

243 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

244 
cur_cbp
 = 0, 
b8
;

246 
di¡blk
 
co¡8x8
;

247 *
mš_co¡
 = 
	`weigh‹d_co¡
(
Ïmbda
, 6);

249 ià(
cu¼Sliû
->
P444_jošed
 == 0)

251 
b8
=0; b8<4; b8++)

253 ià(
cu¼Sliû
->
	`mode_decisiÚ_fÜ_I8x8_blocks
 (
cu¼MB
, 
b8
, 
Ïmbda
, &
co¡8x8
))

255 
cur_cbp
 |ð(1<<
b8
);

257 *
mš_co¡
 +ð
co¡8x8
;

262 
k
;

263 
cu¼Sliû
->
cmp_cbp
[1] = currSlice->cmp_cbp[2] = 0;

264 
cu¼MB
->
ü_cbp
[0] = 0;

265 
cu¼MB
->
ü_cbp
[1] = 0;

266 
cu¼MB
->
ü_cbp
[2] = 0;

268 
b8
 = 0; b8 < 4; b8++)

270 ià(
cu¼Sliû
->
	`mode_decisiÚ_fÜ_I8x8_blocks
 (
cu¼MB
, 
b8
, 
Ïmbda
, &
co¡8x8
))

272 
cur_cbp
 |ð(1<<
b8
);

274 *
mš_co¡
 +ð
co¡8x8
;

276 
k
 = 1; k < 3; k++)

278 if(
cu¼MB
->
ü_cbp
[
k
])

280 
cu¼Sliû
->
cmp_cbp
[
k
] |ð(1 << 
b8
);

281 
cur_cbp
 |ð
cu¼Sliû
->
cmp_cbp
[
k
];

282 
cu¼Sliû
->
cmp_cbp
[
k
] = 
cur_cbp
;

288  
cur_cbp
;

289 
	}
}

298 
di¡blk
 
	$rdco¡_fÜ_8x8_šŒa_blocks
(
Maüoblock
 *
cu¼MB
, *
nÚz”o
, 
b8
, 
mode
, 
Ïmbda
, 
di¡blk
 
mš_rdco¡
, 
mo¡ProbabËMode
)

300 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

301 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

302 
di¡blk
 
rdco¡
 = 0;

303 
dummy
 = 0;

304 
¿‹
;

305 
di¡blk
 
di¡ÜtiÚ
 = 0;

306 
block_x
 = (
b8
 & 0x01) << 3;

307 
block_y
 = (
b8
 >> 1) << 3;

308 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

309 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

310 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

312 
SyÁaxEËm’t
 
£
;

313 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

314 
D©aP¬t™iÚ
 *
d©aP¬t
;

317 *
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
b8
, &
dummy
, 1);

320 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
imgY
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

321 ià(
di¡ÜtiÚ
 > 
mš_rdco¡
)

324  
di¡ÜtiÚ
;

326 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

329 
£
.
v®ue1
 = (
mo¡ProbabËMode
 =ð
mode
) ? -1 : ipmode < mostProbableMode ? ipmode : ipmode-1;

332 
£
.
cÚ‹xt
 = 
b8
;

333 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

336 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

337 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

339 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_BFRAME
]]);

342 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

344 
¿‹
 = 
£
.
Ën
;

348 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

350 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 0, 0);

351 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 1, 0);

352 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 2, 0);

353 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 3, 0);

357 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
PLANE_Y
, 
b8
, 1);

359 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
, 
¿‹
);

360 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

362  
rdco¡
;

363 
	}
}

372 
di¡blk
 
	$rdco¡_fÜ_8x8_šŒa_blocks_444
(
Maüoblock
 *
cu¼MB
, *
nÚz”o
, 
b8
, 
mode
, 
Ïmbda
, 
di¡blk
 
mš_rdco¡
, 
mo¡ProbabËMode
)

374 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

375 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

376 
di¡blk
 
rdco¡
 = 0;

377 
dummy
 = 0;

378 
¿‹
;

379 
di¡blk
 
di¡ÜtiÚ
 = 0;

380 
block_x
 = (
b8
 & 0x01) << 3;

381 
block_y
 = (
b8
 >> 1) << 3;

382 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

383 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

384 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

386 
SyÁaxEËm’t
 
£
;

387 cÚ¡ *
·¹M­
 = 
assignSE2·¹™iÚ
[
cu¼Sliû
->
·¹™iÚ_mode
];

388 
D©aP¬t™iÚ
 *
d©aP¬t
;

390 if(
cu¼Sliû
->
P444_jošed
 == 0)

393 *
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
b8
, &
dummy
, 1);

396 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
imgY
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

398 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

401 
£
.
v®ue1
 = (
mo¡ProbabËMode
 =ð
mode
) ? -1 : ipmode < mostProbableMode ? ipmode : ipmode-1;

404 
£
.
cÚ‹xt
 = 
b8
;

405 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

408 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

409 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

411 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_BFRAME
]]);

414 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

416 
¿‹
 = 
£
.
Ën
;

420 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

422 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 0, 0);

423 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 1, 0);

424 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 2, 0);

425 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 3, 0);

429 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
PLANE_Y
, 
b8
, 1);

434 
CÞÜPÏÃ
 
k
;

436 *
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
b8
, &
dummy
, 1);

439 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pCurImg
[
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
imgY
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

441 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

443 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

444 
cu¼MB
->
c_nzCbCr
[
k
 ]ðcu¼MB->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
(cu¼MB, k, 
b8
, &
dummy
,1);

445 
di¡ÜtiÚ
 +ð
	`compu‹_SSE8x8
(&
p_Vid
->
pImgOrg
[
k
][
pic_Ýix_y
], &p_Vid->
’c_piùu»
->
p_cu¼_img
[
pic_pix_y
], 
pic_pix_x
,…ic_pix_x);

447 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

448 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

451 
£
.
v®ue1
 = (
mo¡ProbabËMode
 =ð
mode
) ? -1 : ipmode < mostProbableMode ? ipmode : ipmode-1;

454 
£
.
cÚ‹xt
 = 
b8
;

455 
£
.
ty³
 = 
SE_INTRAPREDMODE
;

458 ià(
cu¼Sliû
->
¦iû_ty³
 !ð
B_SLICE
)

459 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_INTRAPREDMODE
]]);

461 
d©aP¬t
 = &(
cu¼Sliû
->
·¹A¼
[
·¹M­
[
SE_BFRAME
]]);

464 
cu¼Sliû
->
	`wr™eIÁ¿P»dMode
 (&
£
, 
d©aP¬t
);

465 
¿‹
 = 
£
.
Ën
;

469 ià(
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
)

471 
b4
;

472 
b4
=0; b4<4; b4++)

474 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
LUMA
, 
b8
, 
b4
, 0);

475 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CB
, 
b8
, 
b4
, 0);

476 
¿‹
 +ð
cu¼Sliû
->
	`wr™eCÛff4x4_CAVLC
 (
cu¼MB
, 
CR
, 
b8
, 
b4
, 0);

481 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
PLANE_Y
, 
b8
, 1);

482 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
PLANE_U
, 
b8
, 1);

483 
¿‹
 +ð
	`wr™eCÛff8x8_CABAC
 (
cu¼MB
, 
PLANE_V
, 
b8
, 1);

486 
rdco¡
 = 
di¡ÜtiÚ
 + 
	`weight_co¡
(
Ïmbda
, 
¿‹
);

487 
cu¼Sliû
->
	`»£t_codšg_¡©e
 (
cu¼MB
, cu¼Sliû->
p_RDO
->
cs_cm
);

489  
rdco¡
;

490 
	}
}

492 
šlše
 
	$check_z”o
(**
mb_Ües
, 
block_x
)

494 
i
, 
j
, 
k
 = 0;

496 
j
 = 0; (j < 
BLOCK_SIZE_8x8
è&& (
k
 == 0); j++)

498 
i
 = 
block_x
; (i< block_x + 
BLOCK_SIZE_8x8
è&& (
k
 == 0); i++)

501 
k
 |ð
mb_Ües
[
j
][
i
];

504  
k
;

505 
	}
}

522 
	$»sidu®_ŒªsfÜm_quªt_luma_8x8
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
)

524 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

525 
nÚz”o
 = 
FALSE
;

527 
block_x
 = 8*(
b8
 & 0x01);

528 
block_y
 = 8*(
b8
 >> 1);

529 
¶_off
 = 
b8
+ (
¶
<<2);

530 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

531 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

533 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

534 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

535 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

537 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

539 ià(
	`check_z”o
(&
mb_Ües
[
block_y
], 
block_x
) != 0)

541 
qp
 = (
p_Vid
->
yuv_fÜm©
==
YUV444
 && !
cu¼Sliû
->
P444_jošed
)? 
cu¼MB
->
qp_sÿËd
[()Õ_Vid->
cÞour_¶ªe_id
)]: cu¼MB->qp_sÿËd[
¶
];

545 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

547 
QuªtM‘hods
 
quªt_m‘hods
;

548 
quªt_m‘hods
.
block_x
 = block_x;

549 
quªt_m‘hods
.
block_y
 = block_y;

551 
quªt_m‘hods
.
ACLev–
 = 
cu¼Sliû
->
cofAC
[
¶_off
][0][0];

552 
quªt_m‘hods
.
ACRun
 = 
cu¼Sliû
->
cofAC
[
¶_off
][0][1];

554 
quªt_m‘hods
.
qp
 = qp;

555 
quªt_m‘hods
.
q_·¿ms
 = 
p_Quªt
->
q_·¿ms_8x8
[
¶
][
šŒa
][
qp
];

556 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj8x8
[
¶
][
cu¼MB
->
¬_mode
][
block_y
]è: 
NULL
;

557 
quªt_m‘hods
.
cÛff_co¡
 = coeff_cost;

558 
quªt_m‘hods
.
pos_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN8x8
 : 
SNGL_SCAN8x8
;

559 
quªt_m‘hods
.
c_co¡
 = 
COEFF_COST8x8
[
cu¼Sliû
->
di¡h»s
];

562 
	`fÜw¬d8x8
(
mb_Ües
, 
mb_¼es
, 
block_y
, 
block_x
);

565 
nÚz”o
 = 
cu¼Sliû
->
	`quªt_8x8
(
cu¼MB
, &
mb_¼es
[
block_y
], &
quªt_m‘hods
);

569 
cu¼Sliû
->
cofAC
[
¶_off
][0][0][0] = 0;

572 ià(
nÚz”o
)

575 
	`šv”£8x8
(&
mb_¼es
[
block_y
], &mb_¼es[block_y], 
block_x
);

578 
	`§m¶e_»cÚ¡ruù
 (&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], &
mb_¼es
[block_y], 
block_x
, cu¼MB->
pix_x
 + block_x, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
max_img³l_v®ue
, 
DQ_BITS_8
);

582 
	`cÝy_image_d©a_8x8
 (&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], cu¼MB->
pix_x
 + 
block_x
, block_x);

586  
nÚz”o
;

587 
	}
}

604 
	$»sidu®_ŒªsfÜm_quªt_luma_8x8_ÿvlc
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
)

606 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

607 
nÚz”o
 = 
FALSE
;

609 
block_x
 = 8*(
b8
 & 0x01);

610 
block_y
 = 8*(
b8
 >> 1);

611 
¶_off
 = 
b8
+ (
¶
<<2);

612 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

613 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

614 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

615 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

616 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

618 
max_img³l_v®ue
 = 
p_Vid
->max_imgpel_value;

620 
qp
 = 
cu¼MB
->
qp_sÿËd
[
¶
];

626 
QuªtP¬am‘”s
 *
p_Quªt
 = 
p_Vid
->p_Quant;

628 
QuªtM‘hods
 
quªt_m‘hods
;

629 
quªt_m‘hods
.
block_x
 = block_x;

630 
quªt_m‘hods
.
block_y
 = block_y;

631 
quªt_m‘hods
.
qp
 = qp;

632 
quªt_m‘hods
.
q_·¿ms
 = 
p_Quªt
->
q_·¿ms_8x8
[
¶
][
šŒa
][
qp
];

633 
quªt_m‘hods
.
çdju¡
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj8x8
[
¶
][
cu¼MB
->
¬_mode
][
block_y
]è: 
NULL
;

634 
quªt_m‘hods
.
cÛff_co¡
 = coeff_cost;

636 
quªt_m‘hods
.
pos_sÿn
 = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN8x8_CAVLC
 : 
SNGL_SCAN8x8_CAVLC
;

637 
quªt_m‘hods
.
c_co¡
 = 
COEFF_COST8x8
[
cu¼Sliû
->
di¡h»s
];

640 
	`fÜw¬d8x8
(
mb_Ües
, 
mb_¼es
, 
block_y
, 
block_x
);

643 
nÚz”o
 = 
cu¼Sliû
->
	`quªt_8x8ÿvlc
(
cu¼MB
, &
mb_¼es
[
block_y
], &
quªt_m‘hods
, cu¼Sliû->
cofAC
[
¶_off
]);

646 ià(
nÚz”o
)

649 
	`šv”£8x8
(&
mb_¼es
[
block_y
], &mb_¼es[block_y], 
block_x
);

652 
	`§m¶e_»cÚ¡ruù
 (&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], &
mb_¼es
[block_y], 
block_x
, cu¼MB->
pix_x
 + block_x, 
BLOCK_SIZE_8x8
, BLOCK_SIZE_8x8, 
max_img³l_v®ue
, 
DQ_BITS_8
);

656 
	`cÝy_image_d©a_8x8
(&
img_’c
[
cu¼MB
->
pix_y
 + 
block_y
], &
mb_´ed
[block_y], cu¼MB->
pix_x
 + 
block_x
, block_x);

660  
nÚz”o
;

661 
	}
}

663 
	$»sidu®_ŒªsfÜm_quªt_luma_8x8_ls
(
Maüoblock
 *
cu¼MB
, 
CÞÜPÏÃ
 
¶
, 
b8
, *
cÛff_co¡
, 
šŒa
)

665 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

666 
i
,
j
,
cÛff_ùr
;

667 
sÿn_pos
 = 0,
run
 = -1;

668 
nÚz”o
 = 
FALSE
;

670 
block_x
 = 8*(
b8
 & 0x01);

671 
block_y
 = 8*(
b8
 >> 1);

672 
¶_off
 = 
b8
 + (
¶
<<2);

673 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

674 * 
ACLev–
 = 
cu¼Sliû
->
cofAC
[
¶_off
][0][0];

675 * 
ACRun
 = 
cu¼Sliû
->
cofAC
[
¶_off
][0][1];

676 
img³l
 **
img_’c
 = 
p_Vid
->
’c_piùu»
->
p_cu¼_img
;

677 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_´ed[
¶
];

678 **
mb_Ües
 = 
cu¼Sliû
->mb_Ües[
¶
];

679 **
mb_¼es
 = 
cu¼Sliû
->mb_¼es[
¶
];

681 
sÿn_poss
[4] = { 0 }, 
runs
[4] = { -1, -1, -1, -1 };

682 
MCcÛff
 = 0;

683 *
m7
;

684 
is_ÿvlc
 = (
cu¼Sliû
->
symbÞ_mode
 =ð
CAVLC
);

686 cÚ¡ 
	`by‹
 (*
pos_sÿn
)[2] = 
cu¼MB
->
is_f›ld_mode
 ? 
FIELD_SCAN8x8
 : 
SNGL_SCAN8x8
;

688 **
çdju¡8x8
 = 
p_Vid
->
Ad­tiveRoundšg
 ? (&p_Vid->
ARCofAdj8x8
[
¶
][
cu¼MB
->
¬_mode
][
block_y
]è:
NULL
;

690 
runs
[0]=runs[1]=runs[2]=runs[3]=-1;

691 
sÿn_poss
[0] = scan_poss[1] = scan_poss[2] = scan_poss[3] = 0;

693 ifÐ(
cu¼MB
->
mode_DPCM
 < 2)&&(
šŒa
))

695 
	`Residu®_DPCM_8x8
(
cu¼MB
->
mode_DPCM
, 
mb_Ües
, 
mb_¼es
, 
block_y
, 
block_x
);

699 
j
 = 
block_y
 ; j < block_y + 
BLOCK_SIZE_8x8
 ; j ++)

700 
i
 = 
block_x
 ; i < block_x + 
BLOCK_SIZE_8x8
 ; i ++)

701 
mb_¼es
[
j
][
i
] = 
mb_Ües
[j][i] ;

704 
cÛff_ùr
=0; coeff_ctr < 64; coeff_ctr++)

706 
i
=
pos_sÿn
[
cÛff_ùr
][0];

707 
j
=
pos_sÿn
[
cÛff_ùr
][1];

709 
run
++;

711 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && 
is_ÿvlc
)

713 
MCcÛff
 = (
cÛff_ùr
 & 3);

714 
runs
[
MCcÛff
]++;

717 
m7
 = &
mb_¼es
[
block_y
 + 
j
][
block_x
 + 
i
];

719 ià(
p_Vid
->
Ad­tiveRoundšg
)

721 
çdju¡8x8
[
j
][
block_x
+
i
] = 0;

724 ià(*
m7
 != 0)

726 
nÚz”o
 = 
TRUE
;

728 ià(
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 && 
is_ÿvlc
)

730 *
m7
 = 
	`iCl3
(-
CAVLC_LEVEL_LIMIT
, CAVLC_LEVEL_LIMIT, *m7);

731 *
cÛff_co¡
 +ð
MAX_VALUE
;

733 
cu¼Sliû
->
cofAC
[
¶_off
][
MCcÛff
][0][
sÿn_poss
[MCcÛff] ] = *
m7
;

734 
cu¼Sliû
->
cofAC
[
¶_off
][
MCcÛff
][1][
sÿn_poss
[MCcÛff]++] = 
runs
[MCcoeff];

735 ++
sÿn_pos
;

736 
runs
[
MCcÛff
]=-1;

740 *
cÛff_co¡
 +ð
MAX_VALUE
;

741 
ACLev–
[
sÿn_pos
 ] = *
m7
;

742 
ACRun
 [
sÿn_pos
++] = 
run
;

743 
run
=-1;

748 ià(!
cu¼MB
->
luma_ŒªsfÜm_size_8x8_æag
 || !
is_ÿvlc
)

749 
ACLev–
[
sÿn_pos
] = 0;

752 
i
=0; i<4; i++)

753 
cu¼Sliû
->
cofAC
[
¶_off
][
i
][0][
sÿn_poss
[i]] = 0;

756 ifÐ(
cu¼MB
->
mode_DPCM
 < 2è&& (
šŒa
))

758 
	`Inv_Residu®_DPCM_8x8
(
cu¼MB
, 
mb_¼es
, 
block_y
, 
block_x
);

761  
j
=
block_y
; j<block_y + 
BLOCK_SIZE_8x8
; j++)

763  
i
=
block_x
; i< block_x + 
BLOCK_SIZE_8x8
; i++)

765 
mb_¼es
[
j
][
i
] +ð(è
mb_´ed
[j][i];

766 
img_’c
[
cu¼MB
->
pix_y
 + 
j
][cu¼MB->
pix_x
 + 
i
]ð(
img³l
è
mb_¼es
[j][i];

771  
nÚz”o
;

772 
	}
}

790 
di¡blk
 
	$compu‹_comp8x8_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

792 
diff64
[64];

794 
i
, 
j
;

795 *
diff
 = &
diff64
[0];

796 
img³l
 *
cimg
, *
cm´
;

798 
j
=0; j<8; j++)

802 
cimg
 = &
cur_img
[
j
][
pic_Ýix_x
];

803 
cm´
 = &
m´8x8
[
j
][0];

804 
i
=0; i<8; i++)

806 *
diff
++ = *
cimg
++ - *
cm´
++;

810  
p_Vid
->
	`di¡ÜtiÚ8x8
 (
diff64
, 
mš_co¡
);

811 
	}
}

820 
di¡blk
 
	$compu‹_§d8x8_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

822 
img³l
 *
cimg
, *
cm´
;

823 
i32Co¡
 = 0;

824 
i
, 
j
;

825 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

827 
j
=0; j<8; j++)

829 
cimg
 = &
cur_img
[
j
][
pic_Ýix_x
];

830 
cm´
 = &
m´8x8
[
j
][0];

831 
i
=0; i<8; i++)

833 
i32Co¡
 +ð
	`Ÿbs
(*
cimg
++ - *
cm´
++);

836 ià(
i32Co¡
 > 
imš_co¡
)

838  
mš_co¡
;

841  
	`di¡_sÿË
(
i32Co¡
);

842 
	}
}

850 
di¡blk
 
	$compu‹_s£8x8_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

852 
i
, 
j
;

853 
img³l
 *
cimg
, *
cm´
;

854 
imš_co¡
 = 
	`di¡_down
(
mš_co¡
);

855 
di¡ÜtiÚ
 = 0;

857 
j
=0; j<8; j++)

859 
cimg
 = &
cur_img
[
j
][
pic_Ýix_x
];

860 
cm´
 = &
m´8x8
[
j
][0];

862 
i
=0; i<8; i++)

864 
di¡ÜtiÚ
 +ð
	`Ÿbs2
(*
cimg
++ - *
cm´
++);

867 ià(
di¡ÜtiÚ
 > 
imš_co¡
)

869  
mš_co¡
;

872  
	`di¡_sÿË
(
di¡ÜtiÚ
);

873 
	}
}

880 
di¡blk
 
	$compu‹_§td8x8_co¡
(
VideoP¬am‘”s
 *
p_Vid
, 
img³l
 **
cur_img
, img³È**
m´8x8
, 
pic_Ýix_x
, 
di¡blk
 
mš_co¡
)

882 
i
, 
j
;

883 
diff64
[64];

885 *
diff
 = &
diff64
[0];

886 
img³l
 *
cimg
, *
cm´
;

888 
j
=0; j<8; j++)

890 
cimg
 = &
cur_img
[
j
][
pic_Ýix_x
];

891 
cm´
 = &
m´8x8
[
j
][0];

892 
i
=0; i<8; i++)

894 *
diff
++ = *
cimg
++ - *
cm´
++;

898  (
	`di¡_sÿË
(
	`Hadam¬dSAD8x8
 (
diff64
)));

899 
	}
}

	@lencod/src/transform8x8_H444.c

18 
	~<m©h.h
>

19 
	~<lim™s.h
>

21 
	~"glob®.h
"

23 
	~"image.h
"

24 
	~"mb_acûss.h
"

25 
	~"–em’ts.h
"

26 
	~"vlc.h
"

27 
	~"ŒªsfÜm8x8.h
"

28 
	~"ŒªsfÜm.h
"

29 
	~"maüoblock.h
"

30 
	~"symbÞ.h
"

31 
	~"mc_´ediùiÚ.h
"

32 
	~"quªt8x8.h
"

33 
	~"rdoq.h
"

34 
	~"q_m©rix.h
"

35 
	~"q_off£ts.h
"

36 
	~"rdÝt.h
"

37 
	~"md_commÚ.h
"

38 
	~"šŒa8x8.h
"

39 
	~"rdÝt_codšg_¡©e.h
"

40 
	~"blk_´ediùiÚ.h
"

48 
	$mode_decisiÚ_fÜ_I8x8_blocks_JM_Low444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
)

50 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

51 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

52 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

54 
mode
, 
be¡_mode
 = 0, 
j
, 
dummy
;

55 
di¡blk
 
co¡
;

56 
nÚz”o
 = 0;

57 
block_x
 = (
b8
 & 0x01) << 3;

58 
block_y
 = (
b8
 >> 1) << 3;

59 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

60 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

61 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

62 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

63 
pic_block_x
 = 
pic_pix_x
 >> 2;

64 
pic_block_y
 = 
pic_pix_y
 >> 2;

65 
mb_block_y
 = (
cu¼MB
->
block_y
è+ ((
b8
 >> 1) << 1);

66 
mb_block_x
 = (
cu¼MB
->
block_x
è+ ((
b8
 & 0x01) << 1);

70 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

71 **
mb_Ües
 = 
cu¼Sliû
->mb_ores[0];

72 
img³l
 **
mb_´ed
 = 
cu¼Sliû
->mb_pred[0];

73 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

75 
upMode
, 
ËáMode
;

76 
mo¡ProbabËMode
;

78 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

80 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

81 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

83 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

85 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
 [tÝ_block.
mb_addr
] : 0;

86 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
 [Ëá_block.
mb_addr
] : 0;

89 if(
b8
 >> 1)

90 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

92 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
 [tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

94 if(
b8
 & 0x01)

95 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

97 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

99 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

100 *
mš_co¡
 = 
DISTBLK_MAX
;

101 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

104 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

106 if(
cu¼Sliû
->
P444_jošed
)

108 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

109 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_U
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

110 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

111 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_V
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

112 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

116 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

118 ifÐ(
mode
==
DC_PRED
) ||

119 ((
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
è&& 
up_avažabË
 ) ||

120 ((
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
è&& 
Ëá_avažabË
 ) ||

121 (
®l_avažabË
) )

123 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

124 
co¡
 = (
mode
 =ð
mo¡ProbabËMode
è? 0 : ( 
	`weigh‹d_co¡
(
Ïmbda
, 4) );

125 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡8x8
(
p_Vid
, &p_Vid->
pImgOrg
[0][
pic_Ýix_y
], cu¼Sliû->
m´_8x8
[0][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

127 if(
cu¼Sliû
->
P444_jošed
)

129 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_U
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

130 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡8x8
(
p_Vid
, &p_Vid->
pImgOrg
[
PLANE_U
][
pic_Ýix_y
], cu¼Sliû->
m´_8x8
[PLANE_U][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

131 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_V
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

132 
co¡
 +ð
cu¼Sliû
->
	`compu‹_co¡8x8
(
p_Vid
, &p_Vid->
pImgOrg
[
PLANE_V
][
pic_Ýix_y
], cu¼Sliû->
m´_8x8
[PLANE_V][
mode
], 
pic_Ýix_x
, *
mš_co¡
 - cost);

135 ià(
co¡
 < *
mš_co¡
)

137 
be¡_mode
 = 
mode
;

138 *
mš_co¡
 = 
co¡
;

144 
p_Vid
->
»dmode8x8
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

145 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

147 if(
cu¼Sliû
->
P444_jošed
)

149 
CÞÜPÏÃ
 
k
;

150 
p_Vid
->
CbCr_´edmode_8x8
[
b8
] = 
be¡_mode
;

151 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

153 
cu¼MB
->
ü_cbp
[
k
] = 0;

154 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

165 
	`cÝy_image_d©a_8x8
(&
cu¼Sliû
->
mb_´ed
[
k
][
block_y
], cu¼Sliû->
m´_8x8
[k][
be¡_mode
], 
block_x
, 0);

166 
	`compu‹_»sidue
(&(
p_Vid
->
pImgOrg
[
k
][
cu¼MB
->
pix_y
+
block_y
]), &
cu¼Sliû
->
mb_´ed
[k][block_y], &cu¼Sliû->
mb_Ües
[k][block_y], 
block_x
, cu¼MB->
pix_x
+block_x, 8, 8);

168 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

169 ià(
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
(cu¼MB, 
k
, 
b8
, &
dummy
, 1))

170 
cu¼MB
->
ü_cbp
[
k
] = 1;

172 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

175 
cu¼MB
->
šŒa_´ed_modes8x8
[4*
b8
] = (è((
mo¡ProbabËMode
 =ð
be¡_mode
)

177 : (
be¡_mode
 < 
mo¡ProbabËMode
 ? best_ipmode : best_ipmode-1));

179 
j
 = 
mb_block_y
; j < mb_block_y + 2; j++)

180 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
j
][
mb_block_x
], 
be¡_mode
, 2 * ());

196 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pCurImg
[
cu¼MB
->
Ýix_y
+
block_y
], 
cu¼Sliû
->
m´_8x8
[0][
be¡_mode
], &
mb_´ed
[block_y], &
mb_Ües
[block_y], 
pic_Ýix_x
, 
block_x
);

198 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

199 
nÚz”o
 = 
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
 (cu¼MB, 
PLANE_Y
, 
b8
, &
dummy
, 1);

200  
nÚz”o
;

201 
	}
}

209 
	$mode_decisiÚ_fÜ_I8x8_blocks_JM_High444
 (
Maüoblock
 *
cu¼MB
, 
b8
, 
Ïmbda
, 
di¡blk
 *
mš_co¡
)

211 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼MB
->p_Vid;

212 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼MB
->p_Inp;

213 
Sliû
 *
cu¼Sliû
 = 
cu¼MB
->
p_Sliû
;

214 
RDOPTSŒuùu»
 *
p_RDO
 = 
cu¼Sliû
->p_RDO;

216 
mode
, 
be¡_mode
 = 0, 
j
, 
dummy
;

217 
c_nz
, 
nÚz”o
 = 0;

218 
di¡blk
 
rdco¡
 = 0;

219 
di¡blk
 
mš_rdco¡
 = 
DISTBLK_MAX
;

220 
block_x
 = (
b8
 & 0x01) << 3;

221 
block_y
 = (
b8
 >> 1) << 3;

222 
pic_pix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

223 
pic_pix_y
 = 
cu¼MB
->
pix_y
 + 
block_y
;

224 
pic_Ýix_x
 = 
cu¼MB
->
pix_x
 + 
block_x
;

225 
pic_Ýix_y
 = 
cu¼MB
->
Ýix_y
 + 
block_y
;

226 
pic_block_x
 = 
pic_pix_x
 >> 2;

227 
pic_block_y
 = 
pic_pix_y
 >> 2;

228 
mb_block_y
 = (
cu¼MB
->
block_y
è+ ((
b8
 >> 1) << 1);

229 
mb_block_x
 = (
cu¼MB
->
block_x
è+ ((
b8
 & 0x01) << 1);

231 
uv
;

232 
Ëá_avažabË
, 
up_avažabË
, 
®l_avažabË
;

234 
upMode
, 
ËáMode
;

235 
mo¡ProbabËMode
;

237 
Pix–Pos
 
Ëá_block
, 
tÝ_block
;

239 *
mb_size
 = 
p_Vid
->mb_size[
IS_LUMA
];

241 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
 - 1, 
block_y
 , 
mb_size
, &
Ëá_block
);

242 
	`g‘4x4Neighbour
(
cu¼MB
, 
block_x
, 
block_y
 - 1, 
mb_size
, &
tÝ_block
 );

244 ià(
p_IÅ
->
U£CÚ¡¿šedIÁ¿P»d
)

246 
tÝ_block
.
avažabË
 =Ý_block.avažabË ? 
p_Vid
->
šŒa_block
 [tÝ_block.
mb_addr
 ] : 0;

247 
Ëá_block
.
avažabË
 =†eá_block.avažabË ? 
p_Vid
->
šŒa_block
 [Ëá_block.
mb_addr
] : 0;

250 if(
b8
 >> 1)

251 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

253 
upMode
 = 
tÝ_block
.
avažabË
 ? 
p_Vid
->
»dmode
 [tÝ_block.
pos_y
 ][tÝ_block.
pos_x
 ] : -1;

255 if(
b8
 & 0x01)

256 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode8x8
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

258 
ËáMode
 = 
Ëá_block
.
avažabË
 ? 
p_Vid
->
»dmode
[Ëá_block.
pos_y
][Ëá_block.
pos_x
] : -1;

260 
mo¡ProbabËMode
 = (
upMode
 < 0 || 
ËáMode
 < 0è? 
DC_PRED
 : upMode <†eftMode ? upMode :†eftMode;

261 *
mš_co¡
 = 
DISTBLK_MAX
;

262 
cu¼MB
->
mode_DPCM
 = 
NO_INTRA_PMODE
;

265 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

267 if(
cu¼Sliû
->
P444_jošed
)

269 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_U
);

270 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_U
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

271 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_V
);

272 
cu¼Sliû
->
	`£t_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_V
, 
pic_pix_x
, 
pic_pix_y
, &
Ëá_avažabË
, &
up_avažabË
, &
®l_avažabË
);

273 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

277 
mode
 = 0; ipmod< 
NO_INTRA_PMODE
; ipmode++)

279 ifÐ(
mode
==
DC_PRED
) ||

280 ((
mode
==
VERT_PRED
||mode==
VERT_LEFT_PRED
||mode==
DIAG_DOWN_LEFT_PRED
è&& 
up_avažabË
 ) ||

281 ((
mode
==
HOR_PRED
||mode==
HOR_UP_PRED
è&& 
Ëá_avažabË
 ) ||

282 (
®l_avažabË
) )

284 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_Y
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

287 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pImgOrg
[0][
pic_Ýix_y
], 
cu¼Sliû
->
m´_8x8
[0][
mode
], &cu¼Sliû->
mb_´ed
[0][
block_y
], &cu¼Sliû->
mb_Ües
[0][block_y], 
pic_Ýix_x
, 
block_x
);

289 if(
cu¼Sliû
->
P444_jošed
)

291 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_U
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

292 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pImgOrg
[1][
pic_Ýix_y
], 
cu¼Sliû
->
m´_8x8
[1][
mode
], &cu¼Sliû->
mb_´ed
[1][
block_y
], &cu¼Sliû->
mb_Ües
[1][block_y], 
pic_Ýix_x
, 
block_x
);

293 
	`g‘_šŒ­»d_8x8
(
cu¼MB
, 
PLANE_V
, 
mode
, 
Ëá_avažabË
, 
up_avažabË
);

294 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pImgOrg
[2][
pic_Ýix_y
], 
cu¼Sliû
->
m´_8x8
[2][
mode
], &cu¼Sliû->
mb_´ed
[2][
block_y
], &cu¼Sliû->
mb_Ües
[2][block_y], 
pic_Ýix_x
, 
block_x
);

297 
cu¼MB
->
mode_DPCM
 = (è
mode
;

301 
rdco¡
 = 
cu¼Sliû
->
	`rdco¡_fÜ_8x8_šŒa_blocks
 (
cu¼MB
, &
c_nz
, 
b8
, 
mode
, 
Ïmbda
, 
mš_rdco¡
, 
mo¡ProbabËMode
);

302 ià((
rdco¡
 < 
mš_rdco¡
è|| (rdco¡ =ðmš_rdco¡ && 
mode
 =ð
mo¡ProbabËMode
))

305 
	`memýy
(
p_RDO
->
cÛfAC8x8šŒa
[
b8
][0][0][0],
cu¼Sliû
->
cofAC
[b8][0][0], 4 * 2 * 65 * ());

308 
	`cÝy_image_d©a_8x8
(
p_RDO
->
»c8x8
[
PLANE_Y
], &
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 0, 
pic_pix_x
);

310 ià(
p_Vid
->
Ad­tiveRoundšg
)

312 
j
 = 
block_y
; j < block_y + 8; j++)

313 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[0][
DUMMY
][
j
][
block_x
],&p_Vid->ARCofAdj8x8[0][
I8MB
][j][block_x], 8 * ());

315 ià(
cu¼Sliû
->
P444_jošed
)

317 
j
 = 
block_y
; j < block_y + 8; j++)

319 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[1][
DUMMY
][
j
][
block_x
],&p_Vid->ARCofAdj8x8[1][
I8MB
][j][block_x], 8 * ());

320 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[2][
DUMMY
][
j
][
block_x
],&p_Vid->ARCofAdj8x8[2][
I8MB
][j][block_x], 8 * ());

325 ià(
cu¼Sliû
->
P444_jošed
)

328 
uv
=0; uv < 2; uv++)

330 
	`memýy
(
p_RDO
->
cÛfAC8x8šŒa
[
b8
][
uv
 + 1][0][0],
cu¼Sliû
->
cofAC
[4+b8+4*uv][0][0], 2 * 4 * 65 * ());

332 
cu¼MB
->
ü_cbp
[
uv
 + 1] = cu¼MB->
c_nzCbCr
[uv + 1];

334 
	`cÝy_image_d©a_8x8
(
p_RDO
->
»c8x8
[
uv
 + 1], &
p_Vid
->
’c_piùu»
->
imgUV
[uv][
pic_pix_y
], 0, 
pic_pix_x
);

339 
nÚz”o
 = 
c_nz
;

342 *
mš_co¡
 = 
rdco¡
;

343 
mš_rdco¡
 = 
rdco¡
;

344 
be¡_mode
 = 
mode
;

350 
p_Vid
->
»dmode8x8
[
pic_block_y
][
pic_block_x
] = (è
be¡_mode
;

351 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

353 if(
cu¼Sliû
->
P444_jošed
)

355 
CÞÜPÏÃ
 
k
;

356 
p_Vid
->
CbCr_´edmode_8x8
[
b8
] = 
be¡_mode
;

357 
k
 = 
PLANE_U
; k <ð
PLANE_V
; k++)

359 
cu¼MB
->
ü_cbp
[
k
] = 0;

360 
	`£Ëù_¶ªe
(
p_Vid
, 
k
);

371 
	`g’”©e_´ed_”rÜ_8x8
(&
p_Vid
->
pImgOrg
[
k
][
cu¼MB
->
pix_y
 + 
block_y
], 
cu¼Sliû
->
m´_8x8
[k][
be¡_mode
], &cu¼Sliû->
mb_´ed
[k][block_y], &cu¼Sliû->
mb_Ües
[k][block_y], cu¼MB->
pix_x
 + 
block_x
, block_x);

372 
cu¼MB
->
mode_DPCM
 = (è
be¡_mode
;

374 ià(
cu¼MB
->
	`»sidu®_ŒªsfÜm_quªt_luma_8x8
(cu¼MB, 
k
, 
b8
, &
dummy
, 1))

375 
cu¼MB
->
ü_cbp
[
k
] = 1;

377 
	`£Ëù_¶ªe
(
p_Vid
, 
PLANE_Y
);

380 
cu¼MB
->
šŒa_´ed_modes8x8
[4*
b8
] = (è((
mo¡ProbabËMode
 =ð
be¡_mode
)

382 : (
be¡_mode
 < 
mo¡ProbabËMode
 ? best_ipmode : best_ipmode-1));

384 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
mb_block_y
 ][
mb_block_x
], 
be¡_mode
, 2 * ());

385 
	`mem£t
(&
p_Vid
->
»dmode8x8
[
mb_block_y
 + 1][
mb_block_x
], 
be¡_mode
, 2 * ());

388 
	`memýy
(
cu¼Sliû
->
cofAC
[
b8
][0][0], 
p_RDO
->
cÛfAC8x8šŒa
[b8][0][0][0], 4 * 2 * 65 * ());

390 ià(
p_Vid
->
Ad­tiveRoundšg
)

392 
j
=
block_y
; j< block_y + 8; j++)

393 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[0][
I8MB
][
j
][
block_x
], &p_Vid->ARCofAdj8x8[0][
DUMMY
][j][block_x], 8 * ());

395 ià(
cu¼Sliû
->
P444_jošed
)

397 
j
=0; j<8; j++)

399 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[1][
I8MB
][
block_y
 + 
j
][
block_x
], &p_Vid->ARCofAdj8x8[1][
DUMMY
][block_y + j][block_x], 8 * ());

400 
	`memýy
(&
p_Vid
->
ARCofAdj8x8
[2][
I8MB
][
block_y
 + 
j
][
block_x
], &p_Vid->ARCofAdj8x8[2][
DUMMY
][block_y + j][block_x], 8 * ());

406 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgY
[
pic_pix_y
], 
p_RDO
->
»c8x8
[0], 
pic_pix_x
, 0);

407 
	`cÝy_image_d©a_8x8
(&
cu¼Sliû
->
mb_´ed
[0][
block_y
], cu¼Sliû->
m´_8x8
[0][
be¡_mode
], 
block_x
, 0);

409 ià(
cu¼Sliû
->
P444_jošed
)

412 
	`memýy
(
cu¼Sliû
->
cofAC
[4 + 
b8
 + 4*0][0][0], 
p_RDO
->
cÛfAC8x8šŒa
[b8][1][0][0], 4 * 2 * 65 * ());

413 
	`memýy
(
cu¼Sliû
->
cofAC
[4 + 
b8
 + 4*1][0][0], 
p_RDO
->
cÛfAC8x8šŒa
[b8][2][0][0], 4 * 2 * 65 * ());

416 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[0][
pic_pix_y
], 
p_RDO
->
»c8x8
[1], 
pic_pix_x
, 0);

417 
	`cÝy_image_d©a_8x8
(&
p_Vid
->
’c_piùu»
->
imgUV
[1][
pic_pix_y
], 
p_RDO
->
»c8x8
[2], 
pic_pix_x
, 0);

418 
	`cÝy_image_d©a_8x8
(&
cu¼Sliû
->
mb_´ed
[1][
block_y
], cu¼Sliû->
m´_8x8
[1][
be¡_mode
], 
block_x
, 0);

419 
	`cÝy_image_d©a_8x8
(&
cu¼Sliû
->
mb_´ed
[2][
block_y
], cu¼Sliû->
m´_8x8
[2][
be¡_mode
], 
block_x
, 0);

422  
nÚz”o
;

423 
	}
}

	@lencod/src/vlc.c

17 
	~"cÚŒibutÜs.h
"

19 
	~<m©h.h
>

21 
	~"glob®.h
"

22 
	~"’c_¡©i¡ics.h
"

23 
	~"vlc.h
"

25 #ià
TRACE


26 
	#SYMTRACESTRING
(
s
è
	`¡ºýy
(
sym
.
Œaû¡ršg
,s,
TRACESTRING_SIZE
)

	)

28 
	#SYMTRACESTRING
(
s
)

30 

	)

32 cÚ¡ 
by‹
 
	gNCBP
[2][48][2]=

72 
	$wr™e_ue_v
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
)

74 
SyÁaxEËm’t
 
symbÞ
, *
sym
=&symbol;

75 
sym
->
v®ue1
 = 
v®ue
;

76 
sym
->
v®ue2
 = 0;

80 
	`ue_lšfo
(
sym
->
v®ue1
,sym->
v®ue2
,&(sym->
Ën
),&(sym->
šf
));

81 
	`symbÞ2uvlc
(
sym
);

83 
	`wr™eUVLC2bufãr
 (
sym
, 
b™¡»am
);

85 #ià
TRACE


86 
	`¡ºýy
(
sym
->
Œaû¡ršg
,Œaû¡ršg,
TRACESTRING_SIZE
);

87 
	`Œaû2out
 (
sym
);

90  (
sym
->
Ën
);

91 
	}
}

117 
	$wr™e_£_v
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
)

119 
SyÁaxEËm’t
 
symbÞ
, *
sym
=&symbol;

120 
sym
->
v®ue1
 = 
v®ue
;

121 
sym
->
v®ue2
 = 0;

125 
	`£_lšfo
(
sym
->
v®ue1
,sym->
v®ue2
,&(sym->
Ën
),&(sym->
šf
));

126 
	`symbÞ2uvlc
(
sym
);

128 
	`wr™eUVLC2bufãr
 (
sym
, 
b™¡»am
);

130 #ià
TRACE


131 
	`¡ºýy
(
sym
->
Œaû¡ršg
,Œaû¡ršg,
TRACESTRING_SIZE
);

132 
	`Œaû2out
 (
sym
);

135  (
sym
->
Ën
);

136 
	}
}

163 
BoÞ—n
 
	$wr™e_u_1
 (*
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
)

165 
SyÁaxEËm’t
 
symbÞ
, *
sym
=&symbol;

167 
sym
->
b™·‰”n
 = 
v®ue
;

168 
sym
->
v®ue1
 = 
v®ue
;

169 
sym
->
Ën
 = 1;

173 
	`wr™eUVLC2bufãr
(
sym
, 
b™¡»am
);

175 #ià
TRACE


176 
	`¡ºýy
(
sym
->
Œaû¡ršg
,Œaû¡ršg,
TRACESTRING_SIZE
);

177 
	`Œaû2out
 (
sym
);

180  ((
BoÞ—n
è
sym
->
Ën
);

181 
	}
}

210 
	$wr™e_u_v
 (
n
, *
Œaû¡ršg
, 
v®ue
, 
B™¡»am
 *
b™¡»am
)

212 
SyÁaxEËm’t
 
symbÞ
, *
sym
=&symbol;

214 
sym
->
b™·‰”n
 = 
v®ue
;

215 
sym
->
v®ue1
 = 
v®ue
;

216 
sym
->
Ën
 = 
n
;

220 
	`wr™eUVLC2bufãr
(
sym
, 
b™¡»am
);

222 #ià
TRACE


223 
	`¡ºýy
(
sym
->
Œaû¡ršg
,Œaû¡ršg,
TRACESTRING_SIZE
);

224 
	`Œaû2out
 (
sym
);

227  (
sym
->
Ën
);

228 
	}
}

245 
	$ue_lšfo
(
ue
, 
dummy
, *
Ën
,*
šfo
)

247 
i
, 
Â
 =(
ue
 + 1) >> 1;

249 
i
=0; i < 33 && 
Â
 != 0; i++)

251 
Â
 >>= 1;

253 *
Ën
 = (
i
 << 1) + 1;

254 *
šfo
 = 
ue
 + 1 - (1 << 
i
);

255 
	}
}

272 
	$£_lšfo
(
£
, 
dummy
, *
Ën
,*
šfo
)

274 
sign
 = (
£
 <= 0) ? 1 : 0;

275 
n
 = 
	`Ÿbs
(
£
) << 1;

276 
Â
 = (
n
 >> 1);

277 
i
;

278 
i
 = 0; i < 33 && 
Â
 != 0; i++)

280 
Â
 >>= 1;

282 *
Ën
 = (
i
 << 1) + 1;

283 *
šfo
 = 
n
 - (1 << 
i
è+ 
sign
;

284 
	}
}

295 
	$cbp_lšfo_šŒa_Ùh”
(
cbp
, 
dummy
, *
Ën
,*
šfo
)

297 
	`ue_lšfo
(
NCBP
[0][
cbp
][0], 
dummy
, 
Ën
, 
šfo
);

298 
	}
}

309 
	$cbp_lšfo_šŒa_nÜm®
(
cbp
, 
dummy
, *
Ën
,*
šfo
)

311 
	`ue_lšfo
(
NCBP
[1][
cbp
][0], 
dummy
, 
Ën
, 
šfo
);

312 
	}
}

322 
	$cbp_lšfo_š‹r_Ùh”
(
cbp
, 
dummy
, *
Ën
,*
šfo
)

324 
	`ue_lšfo
(
NCBP
[0][
cbp
][1], 
dummy
, 
Ën
, 
šfo
);

325 
	}
}

335 
	$cbp_lšfo_š‹r_nÜm®
(
cbp
, 
dummy
, *
Ën
,*
šfo
)

337 
	`ue_lšfo
(
NCBP
[1][
cbp
][1], 
dummy
, 
Ën
, 
šfo
);

338 
	}
}

352 
	$Ëvrun_lšfo_c2x2
(
Ëv–
,
run
,*
Ën
,*
šfo
)

354 cÚ¡ 
by‹
 
NTAB
[2][2]=

359 cÚ¡ 
by‹
 
LEVRUN
[4]=

364 ià(
Ëv–
 == 0)

366 *
Ën
=1;

371 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
);

372 
sign
 = 
Ëv–
 <= 0 ? 1 : 0;

373 
n
 = (
Ëvabs
 <ð
LEVRUN
[
run
]è? 
NTAB
[levabs - 1][run] + 1 : (levabs - LEVRUN[run]) * 8 +„un * 2;

374 
Â
 = 
n
 >> 1;

375 
i
;

377 
i
=0; i < 16 && 
Â
 != 0; i++)

379 
Â
 >>= 1;

381 *
Ën
 = (
i
 << 1) + 1;

382 *
šfo
 = 
n
 - (1 << 
i
è+ 
sign
;

384 
	}
}

399 
	$Ëvrun_lšfo_š‹r
(
Ëv–
,
run
,*
Ën
,*
šfo
)

401 cÚ¡ 
by‹
 
LEVRUN
[16]=

405 cÚ¡ 
by‹
 
NTAB
[4][10]=

413 ià(
Ëv–
 == 0)

415 *
Ën
=1;

421 
sign
 = (
Ëv–
 <= 0) ? 1 : 0;

422 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
);

424 
n
 = (
Ëvabs
 <ð
LEVRUN
[
run
]è? 
NTAB
[levabs - 1][run] + 1 : (levabs - LEVRUN[run]) * 32 +„un * 2;

426 
Â
 = 
n
 >> 1;

427 
i
;

429 
i
=0; i < 16 && 
Â
 != 0; i++)

431 
Â
 >>= 1;

433 *
Ën
 = (
i
 << 1) + 1;

434 *
šfo
 = 
n
 - (1 << 
i
è+ 
sign
;

436 
	}
}

451 
	$symbÞ2uvlc
(
SyÁaxEËm’t
 *
sym
)

453 
suffix_Ën
 = 
sym
->
Ën
 >> 1;

455 
suffix_Ën
 = (1 << suffix_len);

456 
sym
->
b™·‰”n
 = 
suffix_Ën
 | (sym->
šf
 & (suffix_len - 1));

458 
	}
}

466 
	$wr™eSE_UVLC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

468 
	`ue_lšfo
 (
£
->
v®ue1
,£->
v®ue2
,&(£->
Ën
),&(£->
šf
));

469 
	`symbÞ2uvlc
(
£
);

471 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

473 if(
£
->
ty³
 !ð
SE_HEADER
)

474 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

476 #ià
TRACE


477 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

478 
	`Œaû2out
 (
£
);

480 
	}
}

488 
	$wr™eSE_SVLC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

490 
	`£_lšfo
 (
£
->
v®ue1
,£->
v®ue2
,&(£->
Ën
),&(£->
šf
));

491 
	`symbÞ2uvlc
(
£
);

493 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

495 if(
£
->
ty³
 !ð
SE_HEADER
)

496 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

498 #ià
TRACE


499 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

500 
	`Œaû2out
 (
£
);

502 
	}
}

510 
	$wr™eCBP_VLC
 (
Maüoblock
* 
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

512 ià(
cu¼MB
->
mb_ty³
 =ð
I4MB
 || cu¼MB->mb_ty³ =ð
SI4MB
 || cu¼MB->mb_ty³ =ð
I8MB
)

514 
cu¼MB
->
	`cbp_lšfo_šŒa
 (
£
->
v®ue1
, se->
v®ue2
, &(£->
Ën
), &(£->
šf
));

518 
cu¼MB
->
	`cbp_lšfo_š‹r
 (
£
->
v®ue1
,£->
v®ue2
,&(£->
Ën
),&(£->
šf
));

520 
	`symbÞ2uvlc
(
£
);

522 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

524 if(
£
->
ty³
 !ð
SE_HEADER
)

525 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

527 #ià
TRACE


528 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

529 
	`Œaû2out
 (
£
);

531 
	}
}

540 
	$wr™eIÁ¿P»dMode_CAVLC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

543 ià(
£
->
v®ue1
 == -1)

545 
£
->
Ën
 = 1;

546 
£
->
šf
 = 1;

550 
£
->
Ën
 = 4;

551 
£
->
šf
 = se->
v®ue1
;

554 
£
->
b™·‰”n
 = se->
šf
;

555 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

557 if(
£
->
ty³
 !ð
SE_HEADER
)

558 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

560 #ià
TRACE


561 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

562 
	`Œaû2out
 (
£
);

566 
	}
}

577 
	$wr™eSyÁaxEËm’t2Buf_UVLC
(
SyÁaxEËm’t
 *
£
, 
B™¡»am
* 
this_¡»amBufãr
 )

580 
£
->
	`m­pšg
(£->
v®ue1
,£->
v®ue2
,&(£->
Ën
),&(£->
šf
));

582 
	`symbÞ2uvlc
(
£
);

584 
	`wr™eUVLC2bufãr
(
£
, 
this_¡»amBufãr
 );

586 #ià
TRACE


587 if(
£
->
ty³
 <= 1)

588 
	`Œaû2out
 (
£
);

591  (
£
->
Ën
);

592 
	}
}

601 
	$wr™eUVLC2bufãr
(
SyÁaxEËm’t
 *
£
, 
B™¡»am
 *
cu¼SŒ—m
)

603 
mask
 = 1 << (
£
->
Ën
 - 1);

604 
by‹
 *
by‹_buf
 = &
cu¼SŒ—m
->byte_buf;

605 *
b™s_to_go
 = &
cu¼SŒ—m
->bits_to_go;

606 
i
;

610 iàÐ
£
->
Ën
 < 33 )

612 
i
 = 0; i < 
£
->
Ën
; i++)

614 *
by‹_buf
 <<= 1;

616 ià(
£
->
b™·‰”n
 & 
mask
)

617 *
by‹_buf
 |= 1;

619 
mask
 >>= 1;

621 ià((--(*
b™s_to_go
)) == 0)

623 *
b™s_to_go
 = 8;

624 
cu¼SŒ—m
->
¡»amBufãr
[cu¼SŒ—m->
by‹_pos
++] = *
by‹_buf
;

625 *
by‹_buf
 = 0;

632 
i
 = 0; i < (
£
->
Ën
 - 32); i++)

634 *
by‹_buf
 <<= 1;

636 ià((--(*
b™s_to_go
)) == 0)

638 *
b™s_to_go
 = 8;

639 
cu¼SŒ—m
->
¡»amBufãr
[cu¼SŒ—m->
by‹_pos
++] = *
by‹_buf
;

640 *
by‹_buf
 = 0;

644 
mask
 = () 1 << 31;

645 
i
 = 0; i < 32; i++)

647 *
by‹_buf
 <<= 1;

649 ià(
£
->
b™·‰”n
 & 
mask
)

650 *
by‹_buf
 |= 1;

652 
mask
 >>= 1;

654 ià((--(*
b™s_to_go
)) == 0)

656 *
b™s_to_go
 = 8;

657 
cu¼SŒ—m
->
¡»amBufãr
[cu¼SŒ—m->
by‹_pos
++] = *
by‹_buf
;

658 *
by‹_buf
 = 0;

662 
	}
}

673 
	$wr™eSyÁaxEËm’t2Buf_Fixed
(
SyÁaxEËm’t
 *
£
, 
B™¡»am
* 
this_¡»amBufãr
 )

675 
	`wr™eUVLC2bufãr
(
£
, 
this_¡»amBufãr
 );

677 #ià
TRACE


678 if(
£
->
ty³
 <= 1)

679 
	`Œaû2out
 (
£
);

681  (
£
->
Ën
);

682 
	}
}

692 
	$wr™eSE_FÏg
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

694 
£
->
Ën
 = 1;

695 
£
->
b™·‰”n
 = (£->
v®ue1
 & 1);

697 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
 );

699 #ià
TRACE


700 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

701 
	`Œaû2out
 (
£
);

703 
	}
}

713 
	$wr™eSE_švFÏg
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

715 
£
->
Ën
 = 1;

716 
£
->
b™·‰”n
 = 1 - (£->
v®ue1
 & 1);

718 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
 );

720 #ià
TRACE


721 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

722 
	`Œaû2out
 (
£
);

724 
	}
}

734 
	$wr™eSE_Dummy
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

736 
£
->
Ën
 = 0;

737 
	}
}

748 
	$wr™eSE_Fix
(
SyÁaxEËm’t
 *
£
, 
B™¡»am
 *
b™¡»am
 )

750 
	`wr™eUVLC2bufãr
(
£
, 
b™¡»am
);

752 #ià
TRACE


753 if(
b™¡»am
->
Œaû_’abËd
)

754 
	`Œaû2out
 (
£
);

756 
	}
}

770 
	$symbÞ2vlc
(
SyÁaxEËm’t
 *
sym
)

772 
šfo_Ën
 = 
sym
->
Ën
;

775 
sym
->
b™·‰”n
 = 0;

778 --
šfo_Ën
 >= 0)

780 
sym
->
b™·‰”n
 <<= 1;

781 
sym
->
b™·‰”n
 |ð(0x01 & (sym->
šf
 >> 
šfo_Ën
));

784 
	}
}

793 
	$wr™eSyÁaxEËm’t_VLC
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

795 
£
->
šf
 = se->
v®ue1
;

796 
£
->
Ën
 = se->
v®ue2
;

797 
	`symbÞ2vlc
(
£
);

799 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

801 if(
£
->
ty³
 !ð
SE_HEADER
)

802 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

804 #ià
TRACE


805 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

806 
	`Œaû2out
 (
£
);

809  (
£
->
Ën
);

810 
	}
}

820 
	$wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃs
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

822 cÚ¡ 
by‹
 
ËÁab
[3][4][17] =

845 cÚ¡ 
by‹
 
codb
[3][4][17] =

866 
vlúum
 = 
£
->
Ën
;

871 ià(
vlúum
 == 3)

873 
£
->
Ën
 = 6;

874 ià(
£
->
v®ue1
 > 0)

876 
£
->
šf
 = ((£->
v®ue1
-1è<< 2è| se->
v®ue2
;

880 
£
->
šf
 = 3;

885 
£
->
Ën
 = 
ËÁab
[
vlúum
][£->
v®ue2
][£->
v®ue1
];

886 
£
->
šf
 = 
codb
[
vlúum
][£->
v®ue2
][£->
v®ue1
];

889 ià(
£
->
Ën
 == 0)

891 
	`´štf
("ERROR: (numcoeff,trailingones)‚ot valid: vlc=%d (%d, %d)\n",

892 
vlúum
, 
£
->
v®ue1
, se->
v®ue2
);

893 
	`ex™
(-1);

896 
	`symbÞ2vlc
(
£
);

898 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

900 if(
£
->
ty³
 !ð
SE_HEADER
)

901 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

903 #ià
TRACE


904 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

905 
	`Œaû2out
 (
£
);

908  (
£
->
Ën
);

909 
	}
}

918 
	$wr™eSyÁaxEËm’t_NumCÛffT¿žšgOÃsChromaDC
(
VideoP¬am‘”s
 *
p_Vid
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

920 cÚ¡ 
by‹
 
ËÁab
[3][4][17] =

939 cÚ¡ 
by‹
 
codb
[3][4][17] =

958 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

962 
£
->
Ën
 = 
ËÁab
[
yuv
][£->
v®ue2
][£->
v®ue1
];

963 
£
->
šf
 = 
codb
[
yuv
][£->
v®ue2
][£->
v®ue1
];

965 ià(
£
->
Ën
 == 0)

967 
	`´štf
("ERROR: (numcoeff,trailingones)‚ot valid: (%d, %d)\n",

968 
£
->
v®ue1
, se->
v®ue2
);

969 
	`ex™
(-1);

972 
	`symbÞ2vlc
(
£
);

974 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

976 if(
£
->
ty³
 !ð
SE_HEADER
)

977 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

979 #ià
TRACE


980 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

981 
	`Œaû2out
 (
£
);

984  (
£
->
Ën
);

985 
	}
}

994 
	$wr™eSyÁaxEËm’t_TÙ®Z”os
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

996 cÚ¡ 
by‹
 
ËÁab
[
TOTRUN_NUM
][16] =

1015 cÚ¡ 
by‹
 
codb
[
TOTRUN_NUM
][16] =

1033 
vlúum
 = 
£
->
Ën
;

1036 
£
->
Ën
 = 
ËÁab
[
vlúum
][£->
v®ue1
];

1037 
£
->
šf
 = 
codb
[
vlúum
][£->
v®ue1
];

1039 ià(
£
->
Ën
 == 0)

1041 
	`´štf
("ERROR: (TÙ®Z”osènÙ v®id: (%d)\n",
£
->
v®ue1
);

1042 
	`ex™
(-1);

1045 
	`symbÞ2vlc
(
£
);

1047 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

1049 if(
£
->
ty³
 !ð
SE_HEADER
)

1050 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1052 #ià
TRACE


1053 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

1054 
	`Œaû2out
 (
£
);

1057  (
£
->
Ën
);

1058 
	}
}

1067 
	$wr™eSyÁaxEËm’t_TÙ®Z”osChromaDC
(
VideoP¬am‘”s
 *
p_Vid
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1069 cÚ¡ 
by‹
 
ËÁab
[3][
TOTRUN_NUM
][16] =

1101 cÚ¡ 
by‹
 
codb
[3][
TOTRUN_NUM
][16] =

1132 
vlúum
 = 
£
->
Ën
;

1133 
yuv
 = 
p_Vid
->
yuv_fÜm©
 - 1;

1136 
£
->
Ën
 = 
ËÁab
[
yuv
][
vlúum
][£->
v®ue1
];

1137 
£
->
šf
 = 
codb
[
yuv
][
vlúum
][£->
v®ue1
];

1139 ià(
£
->
Ën
 == 0)

1141 
	`´štf
("ERROR: (TÙ®Z”osènÙ v®id: (%d)\n",
£
->
v®ue1
);

1142 
	`ex™
(-1);

1145 
	`symbÞ2vlc
(
£
);

1147 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

1149 if(
£
->
ty³
 !ð
SE_HEADER
)

1150 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1152 #ià
TRACE


1153 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

1154 
	`Œaû2out
 (
£
);

1157  (
£
->
Ën
);

1158 
	}
}

1167 
	$wr™eSyÁaxEËm’t_Run
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1169 cÚ¡ 
by‹
 
ËÁab
[
TOTRUN_NUM
][16] =

1180 cÚ¡ 
by‹
 
codb
[
TOTRUN_NUM
][16] =

1190 
vlúum
 = 
£
->
Ën
;

1193 
£
->
Ën
 = 
ËÁab
[
vlúum
][£->
v®ue1
];

1194 
£
->
šf
 = 
codb
[
vlúum
][£->
v®ue1
];

1196 ià(
£
->
Ën
 == 0)

1198 
	`´štf
("ERROR: (runènÙ v®id: (%d)\n",
£
->
v®ue1
);

1199 
	`ex™
(-1);

1202 
	`symbÞ2vlc
(
£
);

1204 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

1206 if(
£
->
ty³
 !ð
SE_HEADER
)

1207 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1209 #ià
TRACE


1210 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

1211 
	`Œaû2out
 (
£
);

1214  (
£
->
Ën
);

1215 
	}
}

1224 
	$wr™eSyÁaxEËm’t_Lev–_VLC1
(
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
, 
´ofže_idc
)

1226 
Ëv–
 = 
£
->
v®ue1
;

1227 
sign
 = (
Ëv–
 < 0 ? 1 : 0);

1228 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
);

1230 ià(
Ëvabs
 < 8)

1232 
£
->
Ën
 = 
Ëvabs
 * 2 + 
sign
 - 1;

1233 
£
->
šf
 = 1;

1235 ià(
Ëvabs
 < 16)

1238 
£
->
Ën
 = 19;

1239 
£
->
šf
 = 16 | ((
Ëvabs
 << 1è- 16è| 
sign
;

1243 
iMask
 = 4096, 
numP»fix
 = 0;

1244 
Ëvabsm16
 = 
Ëvabs
 + 2032;

1247 ià((
Ëvabsm16
) >= 4096)

1249 
numP»fix
++;

1250 (
Ëvabsm16
è>ð(4096 << 
numP»fix
))

1252 
numP»fix
++;

1256 
iMask
 <<ð
numP»fix
;

1257 
£
->
šf
 = 
iMask
 | ((
Ëvabsm16
 << 1è- iMaskè| 
sign
;

1261 ià(
numP»fix
 > 0 && !
	`is_FREXT_´ofže
Ð
´ofže_idc
 ))

1264 
£
->
Ën
 = 0x0000FFFF;

1265  (
£
->
Ën
);

1268 
£
->
Ën
 = 28 + (
numP»fix
 << 1);

1271 
	`symbÞ2vlc
(
£
);

1273 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

1275 if(
£
->
ty³
 !ð
SE_HEADER
)

1276 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1278 #ià
TRACE


1279 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

1280 
	`Œaû2out
 (
£
);

1283  (
£
->
Ën
);

1284 
	}
}

1293 
	$wr™eSyÁaxEËm’t_Lev–_VLCN
(
SyÁaxEËm’t
 *
£
, 
vlc
, 
D©aP¬t™iÚ
 *
dp
, 
´ofže_idc
)

1295 
Ëv–
 = 
£
->
v®ue1
;

1296 
sign
 = (
Ëv–
 < 0 ? 1 : 0);

1297 
Ëvabs
 = 
	`Ÿbs
(
Ëv–
) - 1;

1299 
shiá
 = 
vlc
 - 1;

1300 
esÿ³
 = (15 << 
shiá
);

1302 ià(
Ëvabs
 < 
esÿ³
)

1304 
sufmask
 = ~((0xffffffffè<< 
shiá
);

1305 
suffix
 = (
Ëvabs
è& 
sufmask
;

1307 
£
->
Ën
 = ((
Ëvabs
è>> 
shiá
è+ 1 + 
vlc
;

1308 
£
->
šf
 = (2 << 
shiá
è| (
suffix
 << 1è| 
sign
;

1312 
iMask
 = 4096;

1313 
Ëvab£sc
 = 
Ëvabs
 - 
esÿ³
 + 2048;

1314 
numP»fix
 = 0;

1316 ià((
Ëvab£sc
) >= 4096)

1318 
numP»fix
++;

1319 (
Ëvab£sc
è>ð(4096 << 
numP»fix
))

1321 
numP»fix
++;

1325 
iMask
 <<ð
numP»fix
;

1326 
£
->
šf
 = 
iMask
 | ((
Ëvab£sc
 << 1è- iMaskè| 
sign
;

1330 ià(
numP»fix
 > 0 && !
	`is_FREXT_´ofže
Ð
´ofže_idc
 ))

1333 
£
->
Ën
 = 0x0000FFFF;

1334  (
£
->
Ën
);

1336 
£
->
Ën
 = 28 + (
numP»fix
 << 1);

1339 
	`symbÞ2vlc
(
£
);

1341 
	`wr™eUVLC2bufãr
(
£
, 
dp
->
b™¡»am
);

1343 if(
£
->
ty³
 !ð
SE_HEADER
)

1344 
dp
->
b™¡»am
->
wr™e_æag
 = 1;

1346 #ià
TRACE


1347 if(
dp
->
b™¡»am
->
Œaû_’abËd
)

1348 
	`Œaû2out
 (
£
);

1351  (
£
->
Ën
);

1352 
	}
}

1355 #ià
TRACE


1356 
	gb™couÁ”
 = 0;

1364 
	$Œaû2out
(
SyÁaxEËm’t
 *
sym
)

1366 
i
, 
ch¬s
;

1368 ià(
p_Enc
->
p_Œaû
 !ð
NULL
)

1370 
	`putc
('@', 
p_Enc
->
p_Œaû
);

1371 
ch¬s
 = 
	`årštf
(
p_Enc
->
p_Œaû
, "%i", 
b™couÁ”
);

1372 
ch¬s
++ < 6)

1373 
	`putc
(' ',
p_Enc
->
p_Œaû
);

1375 
ch¬s
 +ð
	`årštf
(
p_Enc
->
p_Œaû
, "%s", 
sym
->
Œaû¡ršg
);

1376 
ch¬s
++ < 55)

1377 
	`putc
(' ',
p_Enc
->
p_Œaû
);

1380 if(
sym
->
Ën
<15)

1382 
i
=0 ; i<15-
sym
->
Ën
 ; i++)

1383 
	`åutc
(' ', 
p_Enc
->
p_Œaû
);

1387 
b™couÁ”
 +ð
sym
->
Ën
;

1388 
i
=1 ; i<=
sym
->
Ën
 ; i++)

1390 if((
sym
->
b™·‰”n
 >> (sym->
Ën
-
i
)) & 0x1)

1391 
	`åutc
('1', 
p_Enc
->
p_Œaû
);

1393 
	`åutc
('0', 
p_Enc
->
p_Œaû
);

1395 
	`årštf
(
p_Enc
->
p_Œaû
, " (%3dè\n",
sym
->
v®ue1
);

1397 
	`fæush
 (
p_Enc
->
p_Œaû
);

1398 
	}
}

1400 
	$Œaû2out_ÿbac
(
SyÁaxEËm’t
 *
sym
)

1402 
ch¬s
;

1404 ià(
p_Enc
->
p_Œaû
 !ð
NULL
)

1406 
	`putc
('@', 
p_Enc
->
p_Œaû
);

1407 
ch¬s
 = 
	`årštf
(
p_Enc
->
p_Œaû
, "%i", 
b™couÁ”
);

1408 
ch¬s
++ < 6)

1409 
	`putc
(' ',
p_Enc
->
p_Œaû
);

1411 
ch¬s
 +ð
	`årštf
(
p_Enc
->
p_Œaû
, "%s", 
sym
->
Œaû¡ršg
);

1412 
ch¬s
++ < 70)

1413 
	`putc
(' ',
p_Enc
->
p_Œaû
);

1415 
	`årštf
(
p_Enc
->
p_Œaû
, " (%3dè\n",
sym
->
v®ue1
);

1417 
	`fæush
 (
p_Enc
->
p_Œaû
);

1418 
b™couÁ”
 +ð
sym
->
Ën
;

1419 
	}
}

1438 
	$wr™eVlcBy‹Align
(
VideoP¬am‘”s
 *
p_Vid
, 
B™¡»am
* 
cu¼SŒ—m
, 
StP¬am‘”s
 *
cur_¡©s
)

1440 ià(
cu¼SŒ—m
->
b™s_to_go
 < 8)

1442 
cu¼SŒ—m
->
by‹_buf
 = (
by‹
è((cu¼SŒ—m->by‹_buà<< cu¼SŒ—m->
b™s_to_go
) | (0xff >> (8 - currStream->bits_to_go)));

1443 
cu¼SŒ—m
->
¡»amBufãr
[cu¼SŒ—m->
by‹_pos
++] = cu¼SŒ—m->
by‹_buf
;

1444 
cur_¡©s
->
b™_u£_¡uffšg_b™s
[
p_Vid
->
ty³
] +ð
cu¼SŒ—m
->
b™s_to_go
;

1445 
cu¼SŒ—m
->
b™s_to_go
 = 8;

1447 
	}
}

1454 
	$»£t_mb_nz_cÛff
(
VideoP¬am‘”s
 *
p_Vid
, 
mb_numb”
)

1456 
	`mem£t
(&
p_Vid
->
nz_cÛff
 [
mb_numb”
][0][0], 0, 
BLOCK_SIZE
 * (BLOCK_SIZE +…_Vid->
num_blk8x8_uv
) * ());

1457 
	}
}

1460 
	$wr™eUVLC_CAVLC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1462 
	`wr™eSE_UVLC
(
£
, 
dp
);

1463 
	}
}

1465 
	$wr™eSVLC_CAVLC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1467 
	`wr™eSE_SVLC
(
£
, 
dp
);

1468 
	}
}

1470 
	$wr™eFÏg_CAVLC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
)

1472 
	`wr™eSE_FÏg
(
£
, 
dp
);

1473 
	}
}

1475 
	$bs_b™Ëngth
(
B™¡»am
 *
b™¡»am
)

1477  (
b™¡»am
->
by‹_pos
*8+(8-b™¡»am->
b™s_to_go
));

1478 
	}
}

1487 
	$wr™eRefPic_Dummy
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

1489 
£
->
Ën
 = 0;

1490 
	}
}

1499 
	$wr™eRefPic_2Ref_CAVLC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

1501 
	`wr™eSE_švFÏg
Ð
£
, 
dp
 );

1502 
	}
}

1511 
	$wr™eRefPic_NRef_CAVLC
(
Maüoblock
 *
cu¼MB
, 
SyÁaxEËm’t
 *
£
, 
D©aP¬t™iÚ
 *
dp
 )

1513 
	`wr™eSE_UVLC
Ð
£
, 
dp
 );

1514 
	}
}

1534 
	$G‘B™s
 (
by‹
 *
bufãr
,

1535 
tÙb™off£t
,

1536 *
šfo
,

1537 
b™couÁ
,

1538 
numb™s
)

1540 ià((
tÙb™off£t
 + 
numb™s
 ) > 
b™couÁ
)

1546 
b™off£t
 = 7 - (
tÙb™off£t
 & 0x07);

1547 
by‹off£t
 = (
tÙb™off£t
 >> 3);

1548 
b™couÁ”
 = 
numb™s
;

1549 
by‹
 *
curby‹
 = &(
bufãr
[
by‹off£t
]);

1550 
šf
 = 0;

1552 
numb™s
--)

1554 
šf
 <<=1;

1555 
šf
 |ð((*
curby‹
)>> (
b™off£t
--)) & 0x01;

1556 ià(
b™off£t
 == -1 )

1558 
curby‹
++;

1559 
b™off£t
 = 7;

1565 *
šfo
 = 
šf
;

1567  
b™couÁ”
;

1569 
	}
}

	@lencod/src/weighted_prediction.c

15 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"image.h
"

19 
	~"wp.h
"

27 
	$In™WP
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
, 
fÜû_wp_m‘hod
)

29 if(
fÜû_wp_m‘hod
)

31 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûAlg1
;

32 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûAlg1
;

33 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûAlg1
;

34 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûAlg1
;

37 ià(
p_IÅ
->
WPI‹rMC
 && 
p_Vid
->
Çl_»ã»nû_idc
)

39 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûAlg2
;

40 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûAlg2
;

41 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûAlg2
;

42 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûAlg2
;

46 
wp_m‘hod
 = 
p_IÅ
->
WPM‘hod
;

47 
wp_m‘hod
)

51 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûAlg0
;

52 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûAlg0
;

53 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûAlg0
;

54 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûAlg0
;

57 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûAlg1
;

58 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûAlg1
;

59 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûAlg1
;

60 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûAlg1
;

63 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûRªdom
;

64 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûRªdom
;

65 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûRªdom
;

66 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûRªdom
;

69 
p_Vid
->
E¡im©eWPPSliû
 = 
E¡im©eWPPSliûP”iodic
;

70 
p_Vid
->
E¡im©eWPBSliû
 = 
E¡im©eWPBSliûP”iodic
;

71 
p_Vid
->
Te¡WPPSliû
 = 
Te¡WPPSliûP”iodic
;

72 
p_Vid
->
Te¡WPBSliû
 = 
Te¡WPBSliûP”iodic
;

77 
	}
}

79 
	$Re£tWP
(
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
)

81 
deçuÉ_weights
[3];

82 
luma_log_weight_d’om
 = 5;

83 
chroma_log_weight_d’om
 = 5;

84 
cur_¦iû
, 
þi¡
, 
n
;

86 
deçuÉ_weights
[0] = 1 << 
luma_log_weight_d’om
;

87 
deçuÉ_weights
[1] = deçuÉ_weights[2] = 1 << 
chroma_log_weight_d’om
;

89 
p_Vid
->
wp_·¿m‘”s_£t
 = 0;

90 
cur_¦iû
 = 0; cur_¦iû < 
p_Vid
->
num_¦iûs_wp
; cur_slice++)

92 
þi¡
 = 0; clist < 2 ; clist++)

94 
n
 = 0;‚ < 
p_IÅ
->
num_»f_äames
;‚++)

96 
p_Vid
->
wp_weights
[0][
þi¡
][
n
][
cur_¦iû
] = 
deçuÉ_weights
[0];

97 
p_Vid
->
wp_off£ts
[0][
þi¡
][
n
][
cur_¦iû
] = 0;

98 
p_Vid
->
wp_weights
[1][
þi¡
][
n
][
cur_¦iû
] = 
deçuÉ_weights
[1];

99 
p_Vid
->
wp_off£ts
[1][
þi¡
][
n
][
cur_¦iû
] = 0;

100 
p_Vid
->
wp_weights
[2][
þi¡
][
n
][
cur_¦iû
] = 
deçuÉ_weights
[2];

101 
p_Vid
->
wp_off£ts
[2][
þi¡
][
n
][
cur_¦iû
] = 0;

105 
	}
}

107 
	$Compu‹Im¶ic™Weights
(
Sliû
 *
cu¼Sliû
,

108 
deçuÉ_weight
[3],

109 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3])

111 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

112 
i
, 
j
, 
comp
;

113 
tx
, 
td
, 
tb
, 
Di¡SÿËFaùÜ
;

115 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

117 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

119 
td
 = (è
	`iCl3
(-128, 127,(
cu¼Sliû
->
li¡X
[
LIST_1
][
j
]->
poc
 - cu¼Sliû->li¡X[
LIST_0
][
i
]->poc));

120 
tb
 = (è
	`iCl3
(-128, 127,(
p_Vid
->
ThisPOC
 - 
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->
poc
));

121 
comp
 = 0; comp < 3; comp++)

124 ià(
td
 == 0)

126 
im_weight
[0][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

127 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

131 
tx
 = (è(16384 + 
	`Ÿbs
(
td
 >> 1))/td;

132 
Di¡SÿËFaùÜ
 = 
	`sCl3
(-1024, 1023, (
tx
*
tb
 + 32 )>>6);

133 
im_weight
[1][
i
][
j
][
comp
] = 
Di¡SÿËFaùÜ
 >> 2;

134 ià(
im_weight
[1][
i
][
j
][
comp
] < -64 || im_weight[1][i][j][comp] >128)

135 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

136 
im_weight
[0][
i
][
j
][
comp
] = 64 - im_weight[1][i][j][comp];

141 
	}
}

150 
	$Compu‹ImgSum
(
img³l
 **
Cu¼’tImage
, 
height
, 
width
)

152 
i
, 
j
;

153 
sum_v®ue
 = 0.0;

154 
img³l
 *
p_tmp
;

156 
i
 = 0; i < 
height
; i++)

158 
p_tmp
 = 
Cu¼’tImage
[
i
];

159 
j
 = 0; j < 
width
; j++)

161 
sum_v®ue
 +ð(è*(
p_tmp
++);

164  
sum_v®ue
;

165 
	}
}

167 
	$Compu‹BlockSum
(
img³l
 **
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
cur_blk
)

169 
x
, 
y
;

170 
sum
 = 0;

172 
blkx
 = 
cur_blk
 % 
width_š_blk
;

173 
blky
 = 
cur_blk
 / 
width_š_blk
;

174 
blk_¡¬t_x
 = 
blkx
*
blk_size_x
;

175 
blk_¡¬t_y
 = 
blky
*
blk_size_y
;

176 
img³l
 *
img_±r
;

178 
y
 = 0; y < 
blk_size_y
; y++)

180 
img_±r
 = &
Cu¼’tImage
[
blk_¡¬t_y
 + 
y
][
blk_¡¬t_x
];

181 
x
 = 0; x < 
blk_size_x
; x++)

183 
sum
 +ð
img_±r
[
x
];

187  
sum
;

188 
	}
}

190 
	$Compu‹ImgSumBlockBa£d
(
img³l
 **
Cu¼’tImage
,

191 
height_š_blk
, 
width_š_blk
,

192 
blk_size_y
, 
blk_size_x
,

193 
¡¬t_blk
, 
’d_blk
, *
dc
)

195 
cur_blk
;

196 
block_sum
;

197 
št64
 
¦iû_sum
 = 0;

199 
cur_blk
 = 
¡¬t_blk
; cur_blk < 
’d_blk
; cur_blk++)

201 
block_sum
 = 
	`Compu‹BlockSum
(
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
cur_blk
);

202 
¦iû_sum
 +ð
block_sum
;

204 (*
dc
èð(è
¦iû_sum
;

205 
	}
}

207 
št64
 
	$Compu‹SumBlockBa£d
(
img³l
 **
Cu¼’tImage
,

208 
height_š_blk
, 
width_š_blk
,

209 
blk_size_y
, 
blk_size_x
,

210 
¡¬t_blk
, 
’d_blk
)

212 
cur_blk
;

213 
št64
 
¦iû_sum
 = 0;

215 
cur_blk
 = 
¡¬t_blk
; cur_blk < 
’d_blk
; cur_blk++)

217 
¦iû_sum
 +ð
	`Compu‹BlockSum
(
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
cur_blk
);

219  
¦iû_sum
;

220 
	}
}

229 
	$E¡im©eWPPSliûAlg0
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

231 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

232 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

233 
dc_Üg
 = 0.0;

234 
dc_Üg_UV
[2] = {0.0};

235 
dc_»f
[
MAX_REFERENCE_PICTURES
] = { 0.0 };

236 
dc_»f_UV
[
MAX_REFERENCE_PICTURES
][2] = { {0.0}};

238 
i
, 
n
, 
k
;

239 
deçuÉ_weight
[3];

240 
cur_weight
, 
cur_off£t
;

241 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
)&&(
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

242 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

243 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

244 
þi¡
;

246 
img³l
 **
tmpPŒ
;

248 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

249 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

251 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

252 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

253 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

254 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

256 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

258 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

260 
k
 = 0; k < 2; k++)

262 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

266 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

268 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

270 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

273 
i
 = 0; i < 3; i++)

275 
weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

276 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

277 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 0;

278 
off£t
[
þi¡
][
n
][
i
] = 0;

282 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

283 
dc_»f
[
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

285 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

287 
k
 = 0; k < 2; k++)

290 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

291 
dc_»f_UV
[
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

295 ià(
£Ëù_off£t
 == 0)

297 ià(
dc_»f
[
n
] != 0.0)

298 
cur_weight
 = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[
n
] + 0.5);

300 
cur_weight
 = 
deçuÉ_weight
[0];

301 
cur_weight
 = 
	`sCl3
(-128, 127, cur_weight);

302 
cur_off£t
 = 0;

304 
weight
[
þi¡
][
n
][0] = 
cur_weight
;

305 
off£t
[
þi¡
][
n
][0] = 
cur_off£t
;

307 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

309 ià(
dc_»f_UV
[
n
][0] != 0)

310 
weight
[
þi¡
][
n
][1] = (è(
deçuÉ_weight
[1] * 
dc_Üg_UV
[0] / 
dc_»f_UV
[n][0] + 0.5);

312 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

313 
weight
[
þi¡
][
n
][1] = 
	`sCl3
(-128, 127, weight[clist][n][1]);

315 ià(
dc_»f_UV
[
n
][1] != 0)

316 
weight
[
þi¡
][
n
][2] = (è(
deçuÉ_weight
[2] * 
dc_Üg_UV
[1] / 
dc_»f_UV
[n][1] + 0.5);

318 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

319 
weight
[
þi¡
][
n
][2] = 
	`sCl3
(-128, 127, weight[clist][n][2]);

324 
cur_off£t
 = (è((
dc_Üg
 - 
dc_»f
[
n
])/(
p_Vid
->
size
)+0.5);

325 
cur_off£t
 = (cur_off£t+((
p_Vid
->
b™d•th_luma
-8)>>1))>>(p_Vid->bitdepth_luma-8);

326 
cur_off£t
 = 
	`sCl3
( -128, 127, cur_offset);

327 
cur_off£t
 = cur_off£t<<(
p_Vid
->
b™d•th_luma
-8);

328 
cur_weight
 = 
deçuÉ_weight
[0];

330 
weight
[
þi¡
][
n
][0] = 
cur_weight
;

331 
off£t
[
þi¡
][
n
][0] = 
cur_off£t
;

333 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

335 
off£t
[
þi¡
][
n
][1] = (è((
dc_Üg_UV
[0] - 
dc_»f_UV
[n][0])/(
p_Vid
->
size_ü
)+0.5);

336 
off£t
[
þi¡
][
n
][1] = (off£t[þi¡][n][1] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

337 
off£t
[
þi¡
][
n
][1] = 
	`sCl3
( -128, 127, offset[clist][n][1]);

338 
off£t
[
þi¡
][
n
][1] = off£t[þi¡][n][1]<<(
p_Vid
->
b™d•th_chroma
 - 8);

340 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

342 
off£t
[
þi¡
][
n
][2] = (è((
dc_Üg_UV
[1] - 
dc_»f_UV
[n][1])/(
p_Vid
->
size_ü
)+0.5);

343 
off£t
[
þi¡
][
n
][2] = (off£t[þi¡][n][2] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

344 
off£t
[
þi¡
][
n
][2] = 
	`sCl3
( -128, 127, offset[clist][n][2]);

345 
off£t
[
þi¡
][
n
][2] = off£t[þi¡][n][2]<<(
p_Vid
->
b™d•th_chroma
 - 8);

347 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

351 
i
=0; i < 3; i ++)

353 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
weight
[clist][n][i];

354 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
off£t
[clist][n][i];

355 #ià
DEBUG_WP


356 
	`´štf
("šdex %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n",
n
,
i
,
weight
[0][n][i],
off£t
[0][n][i]);

362 
	}
}

370 
	$E¡im©eWPBSliûAlg0
(
Sliû
 *
cu¼Sliû
)

372 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

373 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

374 
i
, 
j
, 
k
, 
n
;

376 
šdex
;

377 
comp
;

378 
dc_Üg
 = 0.0;

379 
dc_Üg_UV
[2] = { 0.0 };

380 
dc_»f
[6][
MAX_REFERENCE_PICTURES
] = { {0.0} };

381 
dc_»f_UV
[6][
MAX_REFERENCE_PICTURES
][2] = { {{0.0}} };

383 
deçuÉ_weight
[3];

384 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
)&&(
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

385 
weight
[6][
MAX_REFERENCE_PICTURES
][3];

386 
off£t
[6][
MAX_REFERENCE_PICTURES
][3];

387 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

388 
þi¡
;

389 
wf_weight
, 
wf_off£t
;

390 
img³l
 **
tmpPŒ
;

392 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

394 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

395 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

399 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

400 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

403 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

404 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

405 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

406 
deçuÉ_weight
[1] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

407 
deçuÉ_weight
[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

409 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

411 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

413 
k
 = 0; k < 2; k++)

415 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

417 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

419 
comp
 = 0; comp < 3; comp++)

421 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
im_weight
[k][i][j][comp];

427 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

429 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

431 
comp
 = 0; comp < 3; comp++)

433 
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
][
comp
] = 
deçuÉ_weight
[comp];

434 
cu¼Sliû
->
wp_off£t
[
þi¡
][
šdex
][
comp
] = 0;

441 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

443 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

445 
k
 = 0; k < 2; k++)

447 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

451 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

453 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

455 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

458 
i
 = 0; i < 3; i++)

460 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

461 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 0;

462 
off£t
 [
þi¡
][
n
][
i
] = 0;

463 
weight
 [
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

468 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

469 
dc_»f
[
þi¡
][
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

471 ià(
dc_»f
[
þi¡
][
n
] != 0.0)

472 
wf_weight
 = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[
þi¡
][
n
] + 0.5);

474 
wf_weight
 = 
deçuÉ_weight
[0];

475 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

476 
wf_off£t
 = 0;

480 
weight
[
þi¡
][
n
][0] = 
wf_weight
;

481 
off£t
[
þi¡
][
n
][0] = 
wf_off£t
;

484 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

486 
k
 = 0; k < 2; k++)

488 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

489 
dc_»f_UV
[
þi¡
][
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

491 ià(
dc_»f_UV
[
þi¡
][
n
][
k
] != 0.0)

492 
wf_weight
 = (è(
deçuÉ_weight
[
k
 + 1] * 
dc_Üg_UV
[k] / 
dc_»f_UV
[
þi¡
][
n
][k] + 0.5);

494 
wf_weight
 = 
deçuÉ_weight
[
k
 + 1];

495 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

496 
wf_off£t
 = 0;

498 
weight
[
þi¡
][
n
][
k
 + 1] = 
wf_weight
;

499 
off£t
[
þi¡
][
n
][
k
 + 1] = 
wf_off£t
;

504 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

505 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

506 
off£t
[
þi¡
][
n
][1] = 0;

507 
off£t
[
þi¡
][
n
][2] = 0;

510 
i
 = 0; i < 3; i++)

512 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
weight
[clist][n][i];

513 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
off£t
[clist][n][i];

514 #ià
DEBUG_WP


515 
	`´štf
("%d %d\n",
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
][
comp
],cu¼Sliû->
wp_off£t
[clist][index][comp]);

522 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 != 1)

524 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

526 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

528 
	`memýy
(
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
], 
deçuÉ_weight
, 3 * ());

529 
	`mem£t
(
cu¼Sliû
->
wp_off£t
[
þi¡
][
šdex
], 0, 3 * ());

535 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

537 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

539 
comp
 = 0; comp < 3; comp++)

541 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

542 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

544 #ià
DEBUG_WP


545 
	`´štf
 ("bpw weight[%d][%d] = %d , %d (%d %d %dè(%d %dè(%d %d)\n", 
i
, 
j
, 
cu¼Sliû
->
wbp_weight
[0][i][j][0], currSlice->wbp_weight[1][i][j][0],

546 
p_Vid
->
’c_piùu»
->
poc
,
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc, cu¼Sliû->li¡X[
LIST_1
][
j
]->poc,

547 
Di¡SÿËFaùÜ
 ,
tx
,tx,tx);

552 
	}
}

562 
	$Te¡WPPSliûAlg0
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

564 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

565 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

566 
i
, 
j
, 
k
, 
n
;

568 
šdex
;

569 
comp
;

570 
dc_Üg
 = 0.0;

571 
dc_Üg_UV
[2] = {0.0};

572 
dc_»f
[
MAX_REFERENCE_PICTURES
] = { 0.0 };

573 
dc_»f_UV
[
MAX_REFERENCE_PICTURES
][2] = { {0.0}};

575 
deçuÉ_weight
[3];

577 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
)&&Õ_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

578 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

579 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

582 
þi¡
;

583 
³rfÜm_wp
 = 0;

584 
img³l
 **
tmpPŒ
;

586 
luma_log_weight_d’om
 = 5;

587 
chroma_log_weight_d’om
 = 5;

589 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

590 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
chroma_log_weight_d’om
;

593 
i
 = 0; i < 2 + 
li¡_off£t
; i++)

595 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
i
]; j++)

597 
n
 = 0;‚ < 3;‚++)

599 
weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

602 
off£t
[
i
][
j
][
n
] = 0;

607 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

609 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

611 
k
 = 0; k < 2; k++)

613 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

617 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

619 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

621 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

622 
dc_»f
[
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

624 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

626 
k
 = 0; k < 2; k++)

628 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

629 
dc_»f_UV
[
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

633 ià(
£Ëù_off£t
 == 0)

635 ià(
dc_»f
[
n
] != 0.0)

636 
weight
[
þi¡
][
n
][0] = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[n] + 0.5);

638 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

639 
weight
[
þi¡
][
n
][0] = 
	`sCl3
(-128, 127, weight[clist][n][0]);

641 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

643 ià(
dc_»f_UV
[
n
][0] != 0)

644 
weight
[
þi¡
][
n
][1] = (è(
deçuÉ_weight
[1] * 
dc_Üg_UV
[0] / 
dc_»f_UV
[n][0] + 0.5);

646 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

647 
weight
[
þi¡
][
n
][1] = 
	`sCl3
(-128, 127, weight[clist][n][1]);

649 ià(
dc_»f_UV
[
n
][1] != 0)

650 
weight
[
þi¡
][
n
][2] = (è(
deçuÉ_weight
[2] * 
dc_Üg_UV
[1] / 
dc_»f_UV
[n][1] + 0.5);

652 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

653 
weight
[
þi¡
][
n
][2] = 
	`sCl3
(-128, 127, weight[clist][n][2]);

658 
off£t
[
þi¡
][
n
][0] = (è((
dc_Üg
 - 
dc_»f
[n])/(
p_Vid
->
size
)+0.5);

659 
off£t
[
þi¡
][
n
][0] = (off£t[þi¡][n][0]+((
p_Vid
->
b™d•th_luma
-8)>>1))>>(p_Vid->bitdepth_luma-8);

660 
off£t
[
þi¡
][
n
][0] = 
	`sCl3
( -128, 127, offset[clist][n][0]);

661 
off£t
[
þi¡
][
n
][0] = off£t[þi¡][n][0]<<(
p_Vid
->
b™d•th_luma
-8);

662 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

664 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

666 
off£t
[
þi¡
][
n
][1] = (è((
dc_Üg_UV
[0] - 
dc_»f_UV
[n][0])/(
p_Vid
->
size_ü
)+0.5);

667 
off£t
[
þi¡
][
n
][1] = (off£t[þi¡][n][1] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

668 
off£t
[
þi¡
][
n
][1] = 
	`sCl3
( -128, 127, offset[clist][n][1]);

669 
off£t
[
þi¡
][
n
][1] = off£t[þi¡][n][1]<<(
p_Vid
->
b™d•th_chroma
 - 8);

671 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

673 
off£t
[
þi¡
][
n
][2] = (è((
dc_Üg_UV
[1] - 
dc_»f_UV
[n][1])/(
p_Vid
->
size_ü
)+0.5);

674 
off£t
[
þi¡
][
n
][2] = (off£t[þi¡][n][2] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

675 
off£t
[
þi¡
][
n
][2] = 
	`sCl3
( -128, 127, offset[clist][n][2]);

676 
off£t
[
þi¡
][
n
][2] = off£t[þi¡][n][2]<<(
p_Vid
->
b™d•th_chroma
 - 8);

678 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

684 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

686 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

688 
comp
=0; comp < 3; comp ++)

690 
off£t_‹¡
 = 
p_IÅ
->
RDPSliûBTe¡
 && 
p_Vid
->
aùive_¥s
->
´ofže_idc
 !ð
BASELINE


691 ? 
	`Ÿbs
(
off£t
[
þi¡
][
šdex
][
comp
]) > 2

692 : 
off£t
[
þi¡
][
šdex
][
comp
] != 0;

694 ià(
weight
[
þi¡
][
šdex
][
comp
] !ð
deçuÉ_weight
[0] || 
off£t_‹¡
)

696 
³rfÜm_wp
 = 1;

700 ià(
³rfÜm_wp
 == 1) ;

702 ià(
³rfÜm_wp
 == 1) ;

705  
³rfÜm_wp
;

706 
	}
}

715 
	$Te¡WPBSliûAlg0
(
Sliû
 *
cu¼Sliû
, 
£Ëù_m‘hod
)

717 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

718 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

719 
i
, 
j
, 
k
, 
n
;

720 #ià(
MVC_EXTENSION_ENABLE
)

721 
v›w_id
 = 
p_Vid
->view_id;

723 
v›w_id
 = 0;

726 
šdex
;

727 
comp
;

728 
dc_Üg
 = 0.0;

729 
dc_Üg_UV
[2] = { 0.0 };

730 
dc_»f
[6][
MAX_REFERENCE_PICTURES
] = { {0.0} };

731 
dc_»f_UV
[6][
MAX_REFERENCE_PICTURES
][2] = { {{0.0}} };

733 
deçuÉ_weight
[3];

735 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
)&&Õ_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

736 
weight
[6][
MAX_REFERENCE_PICTURES
][3];

737 
off£t
[6][
MAX_REFERENCE_PICTURES
][3];

738 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

739 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

740 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

743 
þi¡
;

744 
wf_weight
, 
wf_off£t
;

745 
³rfÜm_wp
 = 1;

746 
img³l
 **
tmpPŒ
;

748 
luma_log_weight_d’om
 = 5;

749 
chroma_log_weight_d’om
 = 5;

751 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

752 
deçuÉ_weight
[1] = 1 << 
chroma_log_weight_d’om
;

753 
deçuÉ_weight
[2] = 1 << 
chroma_log_weight_d’om
;

756 
i
 = 0; i < 2 + 
li¡_off£t
; i++)

758 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
i
]; j++)

760 
n
 = 0;‚ < 3;‚++)

762 
wp_weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

763 
wp_off£t
[
i
][
j
][
n
] = 0;

764 
weight
 [
i
][
j
][
n
] = 
deçuÉ_weight
[n];

765 
off£t
 [
i
][
j
][
n
] = 0;

770 ià(
£Ëù_m‘hod
 == 1)

772 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

774 
³rfÜm_wp
 = 0;

775 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

777 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

779 ià(
im_weight
[1][
i
][
j
][0] !ð
deçuÉ_weight
[0] || im_weight[1][i][j][0] != default_weight[0])

781 
³rfÜm_wp
 = 1;

785 ià(
³rfÜm_wp
 == 1) ;

790 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

792 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

794 
k
 = 0; k < 2; k++)

796 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

800 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

802 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

807 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

808 
dc_»f
[
þi¡
][
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

810 ià(
dc_»f
[
þi¡
][
n
] != 0.0)

811 
wf_weight
 = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[
þi¡
][
n
] + 0.5);

813 
wf_weight
 = 
deçuÉ_weight
[0];

814 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

815 
wf_off£t
 = 0;

817 
weight
[
þi¡
][
n
][0] = 
wf_weight
;

818 
off£t
[
þi¡
][
n
][0] = 
wf_off£t
;

821 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

823 
k
 = 0; k < 2; k++)

825 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

826 
dc_»f_UV
[
þi¡
][
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

828 ià(
dc_»f_UV
[
þi¡
][
n
][
k
] != 0.0)

829 
wf_weight
 = (è(
deçuÉ_weight
[
k
 + 1] * 
dc_Üg_UV
[k] / 
dc_»f_UV
[
þi¡
][
n
][k] + 0.5);

831 
wf_weight
 = 
deçuÉ_weight
[
k
 + 1];

832 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

833 
wf_off£t
 = 0;

835 
weight
[
þi¡
][
n
][
k
 + 1] = 
wf_weight
;

836 
off£t
[
þi¡
][
n
][
k
 + 1] = 
wf_off£t
;

841 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

842 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

843 
off£t
[
þi¡
][
n
][1] = 0;

844 
off£t
[
þi¡
][
n
][2] = 0;

849 ià(
£Ëù_m‘hod
 == 0)

851 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

853 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

855 
	`memýy
(
p_Vid
->
cu¼’tSliû
->
wp_weight
[
þi¡
][
šdex
], 
weight
[clist][index], 3 * ());

856 
	`memýy
(
p_Vid
->
cu¼’tSliû
->
wp_off£t
[
þi¡
][
šdex
], 
off£t
[clist][index], 3 * ());

862 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

864 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

866 
	`memýy
(
wp_weight
[
þi¡
][
šdex
], 
deçuÉ_weight
, 3 * ());

867 
	`mem£t
(
wp_off£t
[
þi¡
][
šdex
], 0, 3 * ());

873 ià(
£Ëù_m‘hod
 == 0)

875 
aùive_»fs
[2];

877 
aùive_»fs
[0] = (
p_IÅ
->
B_Li¡0_»fs
 =ð0 ? 
cu¼Sliû
->
li¡Xsize
[0] : 
	`imš
Õ_IÅ->B_Li¡0_»fs[
v›w_id
], currSlice->listXsize[0]));

878 
aùive_»fs
[1] = (
p_IÅ
->
B_Li¡1_»fs
 =ð0 ? 
cu¼Sliû
->
li¡Xsize
[1] : 
	`imš
Õ_IÅ->B_Li¡1_»fs[
v›w_id
], currSlice->listXsize[1]));

880 
³rfÜm_wp
 = 0;

881 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

883 
šdex
 = 0; index < 
aùive_»fs
[
þi¡
]; index++)

885 
comp
=0; comp < 3; comp ++)

887 ià(
wp_weight
[
þi¡
][
šdex
][
comp
] !ð
deçuÉ_weight
[comp])

889 
³rfÜm_wp
 = 1;

893 ià(
³rfÜm_wp
 == 1) ;

895 ià(
³rfÜm_wp
 == 1) ;

898  
³rfÜm_wp
;

899 
	}
}

	@lencod/src/wp_lms.c

16 
	~"cÚŒibutÜs.h
"

18 
	~"glob®.h
"

19 
	~"image.h
"

20 
	~"wp_lms.h
"

21 
	~"wp.h
"

24 
	$Compu‹BlockNÜmM—n
(
img³l
 **
Cu¼’tImage
,

25 
height_š_blk
, 
width_š_blk
,

26 
blk_size_y
, 
blk_size_x
,

27 
cur_blk
, 
dc_m—n
)

29 
blkx
, 
blky
;

30 
x
, 
y
;

31 
sum
 = 0.;

32 
img³l
 *
img_±r
;

34 
blkx
 = 
cur_blk
 % 
width_š_blk
;

35 
blky
 = 
cur_blk
 / 
width_š_blk
;

37 
y
 = 0; y < 
blk_size_y
; y++)

39 
img_±r
 = &
Cu¼’tImage
[
blky
*
blk_size_y
+
y
][
blkx
*
blk_size_x
];

40 
x
 = 0; x < 
blk_size_x
; x++)

42 
sum
 +ð
	`dabs
(()
img_±r
[
x
]-
dc_m—n
);

46  
sum
;

47 
	}
}

49 
	$Compu‹NÜmM—nBlockBa£d
(
img³l
 **
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
,

50 
blk_size_y
, 
blk_size_x
,

51 
¡¬t_blk
, 
’d_blk
,

52 
dc_m—n
, *
nÜm_¦iû
)

54 
cur_blk
;

55 
block_nÜm
;

56 
nÜm
;

59 
nÜm
 = 0.;

60 
cur_blk
 = 
¡¬t_blk
; cur_blk < 
’d_blk
; cur_blk++)

62 
block_nÜm
 = 
	`Compu‹BlockNÜmM—n
(
Cu¼’tImage
, 
height_š_blk
, 
width_š_blk
, 
blk_size_y
, 
blk_size_x
, 
cur_blk
, 
dc_m—n
);

63 
nÜm
 +ð
block_nÜm
;

65 (*
nÜm_¦iû
èð(è
nÜm
;

67 
	}
}

69 
	$Compu‹Ex¶ic™WPP¬amsLMS
(
Sliû
 *
cu¼Sliû
,

70 
£Ëù_off£t
,

71 
¡¬t_mb
,

72 
’d_mb
,

73 
deçuÉ_weight
[3],

74 
weight
[6][
MAX_REFERENCE_PICTURES
][3],

75 
off£t
[6][
MAX_REFERENCE_PICTURES
][3])

77 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

78 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

79 
þi¡
, 
n
, 
k
, 
comp
;

80 
¦iû_size
, 
¦iû_size_ü
;

82 
dc_Üg
[3];

83 
dc_»f
[3];

84 
nÜm_Üg
[3];

85 
nÜm_»f
[3];

86 
num”
[3];

87 
d’om
[3];

88 
cur_weight
, 
cur_off£t
;

89 
b™_d•th
 = (
p_Vid
->
b™d•th_luma
 - 8);

91 
img³l
 **
cur_»f
;

93 
þi¡
=0; clist< 2; clist++)

95 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

97 
comp
 = 0; comp < 3; comp++)

99 
weight
[
þi¡
][
n
][
comp
] = 
deçuÉ_weight
[comp];

100 
off£t
[
þi¡
][
n
][
comp
] = 0;

105 
¦iû_size
 = (
’d_mb
-
¡¬t_mb
)*
MB_BLOCK_SIZE
*MB_BLOCK_SIZE;

106 
¦iû_size_ü
 = (
’d_mb
-
¡¬t_mb
)*
p_Vid
->
mb_ü_size_x
*p_Vid->
mb_ü_size_y
;

108 
	`Compu‹ImgSumBlockBa£d
(
p_Vid
->
pCurImg
,…_Vid->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE,

109 
¡¬t_mb
, 
’d_mb
, &
dc_Üg
[0]);

111 
nÜm_Üg
[0] = 
dc_Üg
[0]/((è
¦iû_size
);

112 
	`Compu‹NÜmM—nBlockBa£d
(
p_Vid
->
pCurImg
,…_Vid->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE,

113 
¡¬t_mb
, 
’d_mb
, 
nÜm_Üg
[0], &
num”
[0]);

115 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

117 
k
 = 0; k < 2; k++)

119 
	`Compu‹ImgSumBlockBa£d
(
p_Vid
->
pImgOrg
[
k
 + 1],…_Vid->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
,

120 
¡¬t_mb
, 
’d_mb
, &
dc_Üg
[
k
+1]);

124 
þi¡
 = 0; clist < 2; clist++)

126 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

128 
cur_»f
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

129 
	`Compu‹ImgSumBlockBa£d
(
cur_»f
, 
p_Vid
->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE,

130 
¡¬t_mb
, 
’d_mb
, &
dc_»f
[0]);

131 
nÜm_»f
[0] = 
dc_»f
[0] / ((è
¦iû_size
);

132 
	`Compu‹NÜmM—nBlockBa£d
(
cur_»f
, 
p_Vid
->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE,

133 
¡¬t_mb
, 
’d_mb
, 
nÜm_»f
[0], &
d’om
[0]);

135 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

137 
k
 = 0; k < 2; k++)

139 
cur_»f
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

140 
	`Compu‹ImgSumBlockBa£d
(
cur_»f
, 
p_Vid
->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
,

141 
¡¬t_mb
, 
’d_mb
, &
dc_»f
[
k
+1]);

145 ià(
£Ëù_off£t
 == 0)

147 ià(
d’om
[0] != 0)

148 
cur_weight
 = (è(
deçuÉ_weight
[0] * 
num”
[0] / 
d’om
[0] + 0.5);

150 
cur_weight
 = 
deçuÉ_weight
[0];

151 
cur_weight
 = 
	`sCl3
(-128, 127, cur_weight);

153 
cur_off£t
 = (è(
nÜm_Üg
[0] - ((è
cur_weight
 * 
nÜm_»f
[0] / (è
deçuÉ_weight
[0]) + 0.5);

154 
cur_off£t
 = (è((cur_off£ˆ+ (
b™_d•th
>>1)) >> bit_depth);

155 
cur_off£t
 = 
	`sCl3
( -128, 127, cur_offset);

156 
cur_off£t
 = (è(cur_off£ˆ<< 
b™_d•th
);

157 
weight
[
þi¡
][
n
][0] = 
cur_weight
;

158 
off£t
[
þi¡
][
n
][0] = 
cur_off£t
;

160 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

162 ià(
dc_»f
[1] != 0)

163 
cur_weight
 = (è(
deçuÉ_weight
[1] * 
dc_Üg
[1] / 
dc_»f
[1] + 0.5);

165 
cur_weight
 = 
deçuÉ_weight
[1];

166 
weight
[
þi¡
][
n
][1] = 
	`sCl3
(-128, 127, 
cur_weight
);

168 ià(
dc_»f
[2] != 0)

169 
cur_weight
 = (è(
deçuÉ_weight
[2] * 
dc_Üg
[2] / 
dc_»f
[2] + 0.5);

171 
cur_weight
 = 
deçuÉ_weight
[2];

172 
weight
[
þi¡
][
n
][2] = 
	`sCl3
(-128, 127, 
cur_weight
);

177 
cur_off£t
 = (è((
dc_Üg
[0] - 
dc_»f
[0])/(
¦iû_size
)+0.5);

178 
cur_off£t
 = (cur_off£t+((
p_Vid
->
b™d•th_luma
-8)>>1))>>(p_Vid->bitdepth_luma-8);

179 
cur_off£t
 = 
	`sCl3
( -128, 127, cur_offset);

180 
cur_off£t
 = cur_off£t<<(
p_Vid
->
b™d•th_luma
-8);

181 
cur_weight
 = 
deçuÉ_weight
[0];

183 
weight
[
þi¡
][
n
][0] = 
cur_weight
;

184 
off£t
[
þi¡
][
n
][0] = 
cur_off£t
;

186 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

188 
cur_off£t
 = (è((
dc_Üg
[1] - 
dc_»f
[1])/(
¦iû_size_ü
)+0.5);

189 
cur_off£t
 = (cur_off£ˆ+ ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

190 
cur_off£t
 = 
	`sCl3
( -128, 127, cur_offset);

191 
off£t
[
þi¡
][
n
][1] = 
cur_off£t
<<(
p_Vid
->
b™d•th_chroma
 - 8);

193 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

195 
cur_off£t
 = (è((
dc_Üg
[2] - 
dc_»f
[2])/(
¦iû_size_ü
)+0.5);

196 
cur_off£t
 = (cur_off£ˆ+ ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

197 
cur_off£t
 = 
	`sCl3
( -128, 127, cur_offset);

198 
off£t
[
þi¡
][
n
][2] = 
cur_off£t
<<(
p_Vid
->
b™d•th_chroma
 - 8);

200 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

205 
	}
}

208 
	$Compu‹Ex¶ic™WPP¬amsJNT
(
Sliû
 *
cu¼Sliû
,

209 
¡¬t_mb
,

210 
’d_mb
,

211 
deçuÉ_weight
[3],

212 
weight
[6][
MAX_REFERENCE_PICTURES
][3],

213 
off£t
[6][
MAX_REFERENCE_PICTURES
][3])

215 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

216 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

217 
þi¡
, 
n
, 
k
, 
comp
;

220 
št64
 
dc_Üg
[3];

221 
št64
 
dc_cur_»f
[2][
MAX_REFERENCE_PICTURES
][3];

222 
w0
 = 
deçuÉ_weight
[0], 
w1
 = default_weight[0];

224 
img³l
 **
cur_»f
;

226 
þi¡
=0; clist< 2; clist++)

228 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

230 
comp
 = 0; comp < 3; comp++)

232 
weight
[
þi¡
][
n
][
comp
] = 
deçuÉ_weight
[comp];

233 
off£t
[
þi¡
][
n
][
comp
] = 0;

238 
dc_Üg
[0] = 
	`Compu‹SumBlockBa£d
 (
p_Vid
->
pCurImg
,…_Vid->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE,

239 
¡¬t_mb
, 
’d_mb
);

241 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

243 
k
 = 0; k < 2; k++)

245 
dc_Üg
[
k
+1] = 
	`Compu‹SumBlockBa£d
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
,

246 
¡¬t_mb
, 
’d_mb
);

250 
þi¡
 = 0; clist < 2; clist++)

252 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

254 
cur_»f
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

255 
dc_cur_»f
[
þi¡
][
n
][0] = 
	`Compu‹SumBlockBa£d
 (
cur_»f
, 
p_Vid
->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
, 
MB_BLOCK_SIZE
, MB_BLOCK_SIZE, 
¡¬t_mb
, 
’d_mb
);

257 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

259 
k
 = 0; k < 2; k++)

261 
cur_»f
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

262 
dc_cur_»f
[
þi¡
][
n
][
k
+1] = 
	`Compu‹SumBlockBa£d
 (
cur_»f
, 
p_Vid
->
F¿meHeightInMbs
,…_Vid->
PicWidthInMbs
,…_Vid->
mb_ü_size_y
,…_Vid->
mb_ü_size_x
, 
¡¬t_mb
, 
’d_mb
);

269 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
];‚++)

272 
‹mp_weight
 = ( ()(
dc_cur_»f
[
LIST_1
][
n
][0] - 
dc_Üg
[0]è/ (è(dc_Üg[0] - dc_cur_»f[
LIST_0
][0][0]));

274 
w0
 = (è(((è
deçuÉ_weight
[0] * 2 * 
‹mp_weight
) / ( 1.0 +emp_weight) + 0.5);

275 
w1
 = (è(((è
deçuÉ_weight
[0] * 2è/ ( 1.0 + 
‹mp_weight
) + 0.5);

278 ià(
w0
 <ð0 || 
w1
 <= 0)

280 
w0
 = 
deçuÉ_weight
[0];

281 
w1
 = 
deçuÉ_weight
[0];

284 ià(
w1
 < -64 || w1 > 128 || 
w0
 < -64 || w0 >128)

286 
w0
 = 
deçuÉ_weight
[0];

287 
w1
 = 
deçuÉ_weight
[0];

290 
weight
[
LIST_1
][
n
][0] = 
w1
;

291 
off£t
[
LIST_1
][
n
][0] = 0;

293 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

295 
weight
[
LIST_1
][
n
][1] = (è(()(
deçuÉ_weight
[1] * 
w1
) / () default_weight[0]);

296 
weight
[
LIST_1
][
n
][2] = (è(()(
deçuÉ_weight
[2] * 
w1
) / () default_weight[0]);

301 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
];‚++)

303 
‹mp_weight
 = ( ()(
dc_cur_»f
[
LIST_1
][0][0] - 
dc_Üg
[0]è/ (è(dc_Üg[0] - dc_cur_»f[
LIST_0
][
n
][0]));

305 
w0
 = (è(((è
deçuÉ_weight
[0] * 2 * 
‹mp_weight
) / ( 1.0 +emp_weight) + 0.5);

306 
w1
 = (è(((è
deçuÉ_weight
[0] * 2è/ ( 1.0 + 
‹mp_weight
) + 0.5);

308 ià(
w0
 <ð0 || 
w1
 <= 0)

310 
w0
 = 
deçuÉ_weight
[0];

311 
w1
 = 
deçuÉ_weight
[0];

314 ià(
w1
 < -64 || w1 > 128 || 
w0
 < -64 || w0 >128)

316 
w0
 = 
deçuÉ_weight
[0];

317 
w1
 = 
deçuÉ_weight
[0];

320 
weight
[
LIST_0
][
n
][0] = 
w0
;

321 
off£t
[
LIST_0
][
n
][0] = 0;

323 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

325 
weight
[
LIST_0
][
n
][1] = (è(()(
deçuÉ_weight
[1] * 
w0
) / () default_weight[0]);

326 
weight
[
LIST_0
][
n
][2] = (è(()(
deçuÉ_weight
[2] * 
w0
) / () default_weight[0]);

329 
	}
}

338 
	$E¡im©eWPPSliûAlg1
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

340 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

341 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

343 
i
, 
n
;

344 
deçuÉ_weight
[3];

345 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

346 
þi¡
;

348 
cur_¦iû
;

350 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

351 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

353 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

354 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

355 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

356 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

358 if(
p_IÅ
->
¦iû_mode
 == 1)

360 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
;

363 
cur_¦iû
 = 0;

365 if(
p_Vid
->
wp_·¿m‘”s_£t
 == 0)

367 
¡¬t_mb
, 
’d_mb
;

368 
comp
;

370 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

371 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

373 if(
p_IÅ
->
¦iû_mode
 == 1)

375 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

376 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

377 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

378 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

382 
¡¬t_mb
 = 0;

383 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

386 
	`Compu‹Ex¶ic™WPP¬amsLMS
(
cu¼Sliû
, 
£Ëù_off£t
, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
weight
, 
off£t
);

388 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

390 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

392 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

394 
comp
=0; comp < 3; comp ++)

396 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = 
weight
[clist][n][comp];

397 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = 
off£t
[clist][n][comp];

398 if(
p_Vid
->
wp_weights
)

399 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
weight
[clist][n][comp];

400 if(
p_Vid
->
wp_off£ts
)

401 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
off£t
[clist][n][comp];

403 #ià
DEBUG_WP


404 
comp
 = 0; comp < 3; comp++)

405 
	`´štf
("¦iû %d: index %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n", 
cur_¦iû
, 
n
,
comp
,
cu¼Sliû
->
wp_weight
[
þi¡
][n][comp],cu¼Sliû->
wp_off£t
[clist][n][comp]);

413 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

415 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

417 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

419 
i
=0; i < 3; i ++)

421 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
p_Vid
->
wp_weights
[i][þi¡][n][
cur_¦iû
];

422 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
p_Vid
->
wp_off£ts
[i][þi¡][n][
cur_¦iû
];

423 #ià
DEBUG_WP


424 
	`´štf
("¦iû %d: index %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n", 
cur_¦iû
, 
n
,
i
,
cu¼Sliû
->
wp_weight
[
þi¡
][n][i],cu¼Sliû->
wp_off£t
[clist][n][i]);

431 
	}
}

439 
	$E¡im©eWPBSliûAlg1
(
Sliû
 *
cu¼Sliû
)

441 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

442 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

443 
i
, 
j
, 
n
;

445 
comp
;

446 
k
;

448 
deçuÉ_weight
[3];

449 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

450 
þi¡
;

451 
cur_¦iû
 = 0;

453 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

455 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

456 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

460 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

461 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

464 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

465 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

466 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

467 
deçuÉ_weight
[1] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

468 
deçuÉ_weight
[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

470 if(
p_IÅ
->
¦iû_mode
 == 1)

472 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
 ;

475 
cur_¦iû
 = 0;

477 ià(
p_Vid
->
wp_·¿m‘”s_£t
 == 0)

479 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

481 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

483 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

485 
k
 = 0; k < 2; k++)

487 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

489 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

491 
comp
 = 0; comp < 3; comp++)

493 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
im_weight
[k][i][j][comp];

499 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

501 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; i++)

503 
comp
 = 0; comp < 3; comp++)

505 
cu¼Sliû
->
wp_weight
[
þi¡
][
i
][
comp
] = 
deçuÉ_weight
[comp];

506 
cu¼Sliû
->
wp_off£t
[
þi¡
][
i
][
comp
] = 0;

513 
¡¬t_mb
, 
’d_mb
;

515 
comp
;

517 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

518 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

520 if(
p_IÅ
->
¦iû_mode
 == 1)

522 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

523 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

524 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

525 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

529 
¡¬t_mb
 = 0;

530 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

533 ià(
p_IÅ
->
EnhªûdBWeightSuµÜt
 == 2)

534 
	`Compu‹Ex¶ic™WPP¬amsJNT
(
cu¼Sliû
, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
wp_weight
, 
wp_off£t
);

536 
	`Compu‹Ex¶ic™WPP¬amsLMS
(
cu¼Sliû
, 0, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
wp_weight
, 
wp_off£t
);

538 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

540 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

542 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

544 
comp
=0; comp < 3; comp ++)

546 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = wp_weight[clist][n][comp];

547 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = wp_offset[clist][n][comp];

548 if(
p_Vid
->
wp_weights
)

549 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_weight
[clist][n][comp];

550 if(
p_Vid
->
wp_off£ts
)

551 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_off£t
[clist][n][comp];

557 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 != 1)

559 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

561 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

563 
	`memýy
(
cu¼Sliû
->
wp_weight
[
þi¡
][
n
], 
deçuÉ_weight
, 3 * ());

564 
	`mem£t
(
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
], 0, 3 * ());

569 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

571 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

573 
comp
 = 0; comp < 3; comp++)

575 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

576 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

583 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

585 
k
 = 0; k < 2; k++)

587 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

589 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

591 
comp
 = 0; comp < 3; comp++)

593 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
p_Vid
->wbp_weight[comp][k][i][j][
cur_¦iû
];

601 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

603 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

605 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

607 
i
=0; i < 3; i ++)

609 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
p_Vid
->
wp_weights
[i][þi¡][n][
cur_¦iû
];

610 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
p_Vid
->
wp_off£ts
[i][þi¡][n][
cur_¦iû
];

615 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

617 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

619 
comp
 = 0; comp < 3; comp++)

621 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

622 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

627 
	}
}

636 
	$Te¡WPPSliûAlg1
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

638 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

639 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

640 
i
, 
j
, 
n
;

642 
šdex
;

643 
comp
;

645 
deçuÉ_weight
[3];

647 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
)&&Õ_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

648 
weight
[6][
MAX_REFERENCE_PICTURES
][3];

649 
off£t
[6][
MAX_REFERENCE_PICTURES
][3];

650 
þi¡
;

651 
³rfÜm_wp
 = 0;

653 
cur_¦iû
, 
num_¦iû
;

654 
¡¬t_mb
, 
’d_mb
;

656 
luma_log_weight_d’om
 = 5;

657 
chroma_log_weight_d’om
 = 5;

659 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

660 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
chroma_log_weight_d’om
;

663 
i
 = 0; i < 2 + 
li¡_off£t
; i++)

665 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
i
]; j++)

667 
n
 = 0;‚ < 3;‚++)

669 
weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

670 
off£t
[
i
][
j
][
n
] = 0;

675 
num_¦iû
 = 
p_Vid
->
num_¦iûs_wp
;

676 
cur_¦iû
 = 0; cur_¦iû < 
num_¦iû
; cur_slice++)

678 if(
p_IÅ
->
¦iû_mode
 == 1)

680 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

681 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

682 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

683 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

687 
¡¬t_mb
 = 0;

688 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

691 
	`Compu‹Ex¶ic™WPP¬amsLMS
(
cu¼Sliû
, 
£Ëù_off£t
, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
weight
, 
off£t
);

693 
þi¡
 = 0; clist < 2; clist++)

695 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

697 
comp
=0; comp < 3; comp ++)

699 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
weight
[clist][n][comp];

700 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
off£t
[clist][n][comp];

702 #ià
DEBUG_WP


703 
	`´štf
 ("weight[%d][%d][0] = %d\n", 
þi¡
, 
n
, 
weight
[clist][n][0]);

704 
	`´štf
 ("off£t[%d][%d][0] = %d\n", 
þi¡
, 
n
, 
off£t
[clist][n][0]);

705 
	`´štf
 ("weight[%d][%d][1] = %d\n", 
þi¡
, 
n
, 
weight
[clist][n][1]);

706 
	`´štf
 ("off£t[%d][%d][1] = %d\n", 
þi¡
, 
n
, 
off£t
[clist][n][1]);

707 
	`´štf
 ("weight[%d][%d][2] = %d\n", 
þi¡
, 
n
, 
weight
[clist][n][2]);

708 
	`´štf
 ("off£t[%d][%d][2] = %d\n", 
þi¡
, 
n
, 
off£t
[clist][n][2]);

714 
³rfÜm_wp
 = 0;

715 
cur_¦iû
 = 0; cur_¦iû < 
num_¦iû
; cur_slice++)

717 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

719 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

721 
comp
=0; comp < 3; comp ++)

723 
off£t_‹¡
 = 
p_IÅ
->
RDPSliûBTe¡
 && 
p_Vid
->
aùive_¥s
->
´ofže_idc
 !ð
BASELINE


724 ? 
	`Ÿbs
(
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
šdex
][
cur_¦iû
]) > 2

725 : 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
šdex
][
cur_¦iû
] != 0;

727 ià(
p_Vid
->
wp_weights
[
comp
][
þi¡
][
šdex
][
cur_¦iû
] !ð
deçuÉ_weight
[comp] || 
off£t_‹¡
)

729 
³rfÜm_wp
 = 1;

733 ià(
³rfÜm_wp
 == 1) ;

735 ià(
³rfÜm_wp
 == 1) ;

737 if(
³rfÜm_wp
 == 1) ;

740 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

742  
³rfÜm_wp
;

743 
	}
}

753 
	$Te¡WPBSliûAlg1
(
Sliû
 *
cu¼Sliû
, 
£Ëù_m‘hod
)

755 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

756 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

757 
i
, 
j
, 
n
;

759 
šdex
, 
comp
;

761 
deçuÉ_weight
[3];

763 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
è&& (p_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

764 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

765 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

766 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

768 
cur_¦iû
, 
num_¦iû
;

769 
¡¬t_mb
, 
’d_mb
;

771 
þi¡
;

772 
³rfÜm_wp
 = 1;

774 
luma_log_weight_d’om
 = 5;

775 
chroma_log_weight_d’om
 = 5;

777 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

778 
deçuÉ_weight
[1] = 1 << 
chroma_log_weight_d’om
;

779 
deçuÉ_weight
[2] = 1 << 
chroma_log_weight_d’om
;

781 ià(
£Ëù_m‘hod
 == 1)

783 
cur_¦iû
 = 0;

784 
num_¦iû
 = 
p_Vid
->
num_¦iûs_wp
;

786 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

788 
³rfÜm_wp
 = 1;

789 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

791 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

793 
comp
 = 0; comp < 3; comp++)

795 
weight0
, 
weight1
;

797 if(
³rfÜm_wp
)

799 
weight0
 = 
im_weight
[0][
i
][
j
][
comp
];

800 
weight1
 = 
im_weight
[1][
i
][
j
][
comp
];

804 
weight0
 = 
deçuÉ_weight
[
comp
];

805 
weight1
 = 
deçuÉ_weight
[
comp
];

809 
cur_¦iû
 = 0; cur_¦iû < 
num_¦iû
; cur_slice++)

811 
p_Vid
->
wbp_weight
[
comp
][0][
i
][
j
][
cur_¦iû
] = 
weight0
;

812 
p_Vid
->
wbp_weight
[
comp
][1][
i
][
j
][
cur_¦iû
] = 
weight1
;

820 
num_¦iû
 = 
p_Vid
->
num_¦iûs_wp
;

821 
cur_¦iû
 = 0; cur_¦iû < 
num_¦iû
; cur_slice++)

823 if(
p_IÅ
->
¦iû_mode
 == 1)

825 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

826 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

827 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

828 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

832 
¡¬t_mb
 = 0;

833 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

836 ià(
p_IÅ
->
EnhªûdBWeightSuµÜt
 == 2)

837 
	`Compu‹Ex¶ic™WPP¬amsJNT
(
cu¼Sliû
, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
wp_weight
, 
wp_off£t
);

839 
	`Compu‹Ex¶ic™WPP¬amsLMS
(
cu¼Sliû
, 0, 
¡¬t_mb
, 
’d_mb
, 
deçuÉ_weight
, 
wp_weight
, 
wp_off£t
);

841 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

843 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

845 
comp
=0; comp < 3; comp ++)

847 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_weight
[clist][n][comp];

848 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_off£t
[clist][n][comp];

850 #ià
DEBUG_WP


851 
	`´štf
 ("weight[%d][%d] = %d\n", 
þi¡
, 
n
, 
wp_weight
[clist][n][0]);

852 
	`´štf
 ("off£t[%d][%d] = %d\n", 
þi¡
, 
n
, 
wp_off£t
[clist][n][0]);

858 
³rfÜm_wp
 = 0;

859 
cur_¦iû
 = 0; cur_¦iû < 
num_¦iû
; cur_slice++)

861 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

863 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

865 
comp
=0; comp < 3; comp ++)

867 ià(
p_Vid
->
wp_weights
[
comp
][
þi¡
][
šdex
][
cur_¦iû
] !ð
deçuÉ_weight
[comp] ||

868 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
šdex
][
cur_¦iû
] != 0)

870 
³rfÜm_wp
 = 1;

874 ià(
³rfÜm_wp
 == 1) ;

876 ià(
³rfÜm_wp
 == 1) ;

878 if(
³rfÜm_wp
 == 1) ;

882 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

884  
³rfÜm_wp
;

885 
	}
}

	@lencod/src/wp_mciter.c

12 
	~"cÚŒibutÜs.h
"

14 
	~<m©h.h
>

15 
	~<æßt.h
>

17 
	~"glob®.h
"

18 
	~"image.h
"

19 
	~"wp.h
"

28 
	$E¡im©eWPPSliûAlg2
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

30 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

31 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

32 
dc_Üg
 = 0.0;

33 
dc_Üg_UV
[2] = {0.0};

34 
dc_»f
[
MAX_REFERENCE_PICTURES
] = { 0.0 };

35 
dc_»f_UV
[
MAX_REFERENCE_PICTURES
][2] = { {0.0}};

37 
i
, 
n
, 
k
;

38 
deçuÉ_weight
[3];

39 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
)&&(
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

40 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

41 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

42 
þi¡
;

44 
img³l
 **
tmpPŒ
;

46 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

47 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

49 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

50 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

51 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

52 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

54 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

56 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

58 
k
 = 0; k < 2; k++)

60 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

64 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

66 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

68 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

71 
i
 = 0; i < 3; i++)

73 
weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

74 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

75 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 0;

76 
off£t
[
þi¡
][
n
][
i
] = 0;

80 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

81 
dc_»f
[
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

83 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

85 
k
 = 0; k < 2; k++)

88 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

89 
dc_»f_UV
[
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

93 ià(
£Ëù_off£t
 == 0)

95 ià(
dc_»f
[
n
] != 0.0)

96 
weight
[
þi¡
][
n
][0] = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[n] + 0.5);

98 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

99 
weight
[
þi¡
][
n
][0] = 
	`sCl3
(-128, 127, weight[clist][n][0]);

100 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

102 ià(
dc_»f_UV
[
n
][0] != 0)

103 
weight
[
þi¡
][
n
][1] = (è(
deçuÉ_weight
[1] * 
dc_Üg_UV
[0] / 
dc_»f_UV
[n][0] + 0.5);

105 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

106 
weight
[
þi¡
][
n
][1] = 
	`sCl3
(-128, 127, weight[clist][n][1]);

108 ià(
dc_»f_UV
[
n
][1] != 0)

109 
weight
[
þi¡
][
n
][2] = (è(
deçuÉ_weight
[2] * 
dc_Üg_UV
[1] / 
dc_»f_UV
[n][1] + 0.5);

111 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

112 
weight
[
þi¡
][
n
][2] = 
	`sCl3
(-128, 127, weight[clist][n][2]);

117 
off£t
[
þi¡
][
n
][0] = 
p_Vid
->
äameOff£t
[clist][n];

119 
off£t
[
þi¡
][
n
][0] = (off£t[þi¡][n][0]+((
p_Vid
->
b™d•th_luma
-8)>>1))>>(p_Vid->bitdepth_luma - 8);

120 
off£t
[
þi¡
][
n
][0] = 
	`sCl3
( -128, 127, offset[clist][n][0]);

121 
off£t
[
þi¡
][
n
][0] = off£t[þi¡][n][0]<<(
p_Vid
->
b™d•th_luma
-8);

122 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

124 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

126 
off£t
[
þi¡
][
n
][1] = (è((
dc_Üg_UV
[0] - 
dc_»f_UV
[n][0])/(
p_Vid
->
size_ü
)+0.5);

127 
off£t
[
þi¡
][
n
][1] = (off£t[þi¡][n][1] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma - 8);

128 
off£t
[
þi¡
][
n
][1] = 
	`sCl3
( -128, 127, offset[clist][n][1]);

129 
off£t
[
þi¡
][
n
][1] = off£t[þi¡][n][1]<<(
p_Vid
->
b™d•th_chroma
 - 8);

131 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

133 
off£t
[
þi¡
][
n
][2] = (è((
dc_Üg_UV
[1] - 
dc_»f_UV
[n][1])/(
p_Vid
->
size_ü
)+0.5);

134 
off£t
[
þi¡
][
n
][2] = (off£t[þi¡][n][2] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

135 
off£t
[
þi¡
][
n
][2] = 
	`sCl3
( -128, 127, offset[clist][n][2]);

136 
off£t
[
þi¡
][
n
][2] = off£t[þi¡][n][2]<<(
p_Vid
->
b™d•th_chroma
 - 8);

138 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

142 
i
=0; i < 3; i ++)

144 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
weight
[clist][n][i];

145 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
off£t
[clist][n][i];

146 #ià
DEBUG_WP


147 
	`´štf
("šdex %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n",
n
,
i
,
weight
[0][n][i],
off£t
[0][n][i]);

153 
	}
}

161 
	$E¡im©eWPBSliûAlg2
(
Sliû
 *
cu¼Sliû
)

163 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

164 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

165 
i
, 
j
, 
k
, 
n
;

167 
tx
, 
tb
, 
td
, 
Di¡SÿËFaùÜ
;

169 
šdex
;

170 
comp
;

172 
dc_Üg_UV
[2] = { 0.0 };

173 
dc_»f_UV
[6][
MAX_REFERENCE_PICTURES
][2] = { {{0.0}} };

175 
deçuÉ_weight
[3];

176 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
)&&(
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

177 
weight
[6][
MAX_REFERENCE_PICTURES
][3];

178 
off£t
[6][
MAX_REFERENCE_PICTURES
][3];

179 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

180 
þi¡
;

181 
wf_weight
, 
wf_off£t
;

182 
img³l
 **
tmpPŒ
;

184 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

186 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

187 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

191 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

192 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

195 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

196 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

197 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

198 
deçuÉ_weight
[1] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

199 
deçuÉ_weight
[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

201 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

203 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

205 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

207 
td
 = (è
	`iCl3
(-128, 127,(
cu¼Sliû
->
li¡X
[
LIST_1
][
j
]->
poc
 - cu¼Sliû->li¡X[
LIST_0
][
i
]->poc));

208 
tb
 = ()
	`iCl3
(-128, 127,(
p_Vid
->
’c_piùu»
->
poc
 - 
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc));

209 
comp
 = 0; comp < 3; comp++)

212 ià(
td
 == 0)

214 
im_weight
[0][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

215 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

219 
tx
 = (è(16384 + 
	`Ÿbs
(
td
 >> 1))/td;

220 
Di¡SÿËFaùÜ
 = (è
	`iCl3
(-1024, 1023, (
tx
*
tb
 + 32 )>>6);

221 
im_weight
[1][
i
][
j
][
comp
] = 
Di¡SÿËFaùÜ
>>2;

222 ià(
im_weight
[1][
i
][
j
][
comp
] < -64 || im_weight[1][i][j][comp] >128)

223 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

224 
im_weight
[0][
i
][
j
][
comp
] = 64 - im_weight[1][i][j][comp];

227 #ià
DEBUG_WP


228 
	`´štf
 ("%d im°weight[%d][%d] = %d , %d (%d %d %dè(%d %dè(%d %d)\n",
p_Vid
->
’c_piùu»
->
poc
, 
i
, 
j
, 
im_weight
[0][i][j][0], im_weight[1][i][j][0],

229 
p_Vid
->
’c_piùu»
->
poc
,
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc, cu¼Sliû->li¡X[
LIST_1
][
j
]->poc,

230 
Di¡SÿËFaùÜ
 ,
tx
,
td
,
tb
);

235 
k
 = 0; k < 2; k++)

237 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

239 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

241 
comp
 = 0; comp < 3; comp++)

243 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
im_weight
[k][i][j][comp];

249 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

251 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

253 
comp
 = 0; comp < 3; comp++)

255 
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
][
comp
] = 
deçuÉ_weight
[comp];

256 
cu¼Sliû
->
wp_off£t
[
þi¡
][
šdex
][
comp
] = 0;

265 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

267 
k
 = 0; k < 2; k++)

269 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

273 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

275 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

277 iàÐ
	`wpxD‘”mšeWP
Ð
cu¼Sliû
, 
þi¡
, 
n
 ) )

280 
i
 = 0; i < 3; i++)

282 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

283 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 0;

284 
off£t
 [
þi¡
][
n
][
i
] = 0;

285 
weight
 [
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

288 
off£t
[
þi¡
][
n
][0] = 
wf_off£t
 = 
p_Vid
->
äameOff£t
[clist][n];

289 
weight
[
þi¡
][
n
][0] = 
wf_weight
 = 
deçuÉ_weight
[0];

293 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

295 
k
 = 0; k < 2; k++)

297 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

298 
dc_»f_UV
[
þi¡
][
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

300 ià(
dc_»f_UV
[
þi¡
][
n
][
k
] != 0.0)

301 
wf_weight
 = (è(
deçuÉ_weight
[
k
 + 1] * 
dc_Üg_UV
[k] / 
dc_»f_UV
[
þi¡
][
n
][k] + 0.5);

303 
wf_weight
 = 
deçuÉ_weight
[
k
 + 1];

304 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

305 
wf_off£t
 = 0;

307 
weight
[
þi¡
][
n
][
k
 + 1] = 
wf_weight
;

308 
off£t
[
þi¡
][
n
][
k
 + 1] = 
wf_off£t
;

313 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

314 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

315 
off£t
[
þi¡
][
n
][1] = 0;

316 
off£t
[
þi¡
][
n
][2] = 0;

319 
i
 = 0; i < 3; i++)

321 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
weight
[clist][n][i];

322 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 
off£t
[clist][n][i];

323 #ià
DEBUG_WP


324 
	`´štf
("%d %d\n",
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
][
comp
],cu¼Sliû->
wp_off£t
[clist][index][comp]);

331 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 != 1)

333 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

335 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

337 
	`memýy
(
cu¼Sliû
->
wp_weight
[
þi¡
][
šdex
], 
deçuÉ_weight
, 3 * ());

338 
	`mem£t
(
cu¼Sliû
->
wp_off£t
[
þi¡
][
šdex
], 0, 3 * ());

344 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

346 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

348 
comp
 = 0; comp < 3; comp++)

350 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

351 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

353 #ià
DEBUG_WP


354 
	`´štf
 ("bpw weight[%d][%d] = %d , %d (%d %d %dè(%d %dè(%d %d)\n", 
i
, 
j
, 
cu¼Sliû
->
wbp_weight
[0][i][j][0], currSlice->wbp_weight[1][i][j][0],

355 
p_Vid
->
’c_piùu»
->
poc
,
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc, cu¼Sliû->li¡X[
LIST_1
][
j
]->poc,

356 
Di¡SÿËFaùÜ
 ,
tx
,tx,tx);

361 
	}
}

371 
	$Te¡WPPSliûAlg2
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

373 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

374 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

375 
i
, 
j
, 
k
, 
n
;

377 
šdex
;

378 
comp
;

379 
dc_Üg
 = 0.0;

380 
dc_Üg_UV
[2] = {0.0};

381 
dc_»f
[
MAX_REFERENCE_PICTURES
] = { 0.0 };

382 
dc_»f_UV
[
MAX_REFERENCE_PICTURES
][2] = { {0.0}};

384 
deçuÉ_weight
[3];

386 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
)&&Õ_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

387 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

388 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

389 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

390 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

391 
þi¡
;

392 
³rfÜm_wp
 = 0;

393 
img³l
 **
tmpPŒ
;

395 
luma_log_weight_d’om
 = 5;

396 
chroma_log_weight_d’om
 = 5;

398 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

399 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
chroma_log_weight_d’om
;

402 
i
 = 0; i < 2 + 
li¡_off£t
; i++)

404 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
i
]; j++)

406 
n
 = 0;‚ < 3;‚++)

408 
weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

409 
wp_weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

410 
wp_off£t
[
i
][
j
][
n
] = 0;

411 
off£t
[
i
][
j
][
n
] = 0;

416 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

418 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

420 
k
 = 0; k < 2; k++)

422 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

426 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

428 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

430 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
p_cu¼_img
;

431 
dc_»f
[
n
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height
,…_Vid->
width
);

433 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

435 
k
 = 0; k < 2; k++)

437 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

438 
dc_»f_UV
[
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

442 ià(
£Ëù_off£t
 == 0)

444 ià(
dc_»f
[
n
] != 0.0)

445 
weight
[
þi¡
][
n
][0] = (è(
deçuÉ_weight
[0] * 
dc_Üg
 / 
dc_»f
[n] + 0.5);

447 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

448 
weight
[
þi¡
][
n
][0] = 
	`sCl3
(-128, 127, weight[clist][n][0]);

449 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

451 ià(
dc_»f_UV
[
n
][0] != 0)

452 
weight
[
þi¡
][
n
][1] = (è(
deçuÉ_weight
[1] * 
dc_Üg_UV
[0] / 
dc_»f_UV
[n][0] + 0.5);

454 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

455 
weight
[
þi¡
][
n
][1] = 
	`sCl3
(-128, 127, weight[clist][n][1]);

457 ià(
dc_»f_UV
[
n
][1] != 0)

458 
weight
[
þi¡
][
n
][2] = (è(
deçuÉ_weight
[2] * 
dc_Üg_UV
[1] / 
dc_»f_UV
[n][1] + 0.5);

460 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

461 
weight
[
þi¡
][
n
][2] = 
	`sCl3
(-128, 127, weight[clist][n][2]);

466 
off£t
[
þi¡
][
n
][0] = 
p_Vid
->
äameOff£t
[clist][n];

468 
off£t
[
þi¡
][
n
][0] = (off£t[þi¡][n][0]+((
p_Vid
->
b™d•th_luma
-8)>>1))>>(p_Vid->bitdepth_luma-8);

469 
off£t
[
þi¡
][
n
][0] = 
	`sCl3
( -128, 127, offset[clist][n][0]);

470 
off£t
[
þi¡
][
n
][0] = off£t[þi¡][n][0]<<(
p_Vid
->
b™d•th_luma
-8);

471 
weight
[
þi¡
][
n
][0] = 
deçuÉ_weight
[0];

473 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

475 
off£t
[
þi¡
][
n
][1] = (è((
dc_Üg_UV
[0] - 
dc_»f_UV
[n][0])/(
p_Vid
->
size_ü
)+0.5);

476 
off£t
[
þi¡
][
n
][1] = (off£t[þi¡][n][1] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

477 
off£t
[
þi¡
][
n
][1] = 
	`sCl3
( -128, 127, offset[clist][n][1]);

478 
off£t
[
þi¡
][
n
][1] = off£t[þi¡][n][1]<<(
p_Vid
->
b™d•th_chroma
 - 8);

480 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

482 
off£t
[
þi¡
][
n
][2] = (è((
dc_Üg_UV
[1] - 
dc_»f_UV
[n][1])/(
p_Vid
->
size_ü
)+0.5);

483 
off£t
[
þi¡
][
n
][2] = (off£t[þi¡][n][2] + ((
p_Vid
->
b™d•th_chroma
 - 8)>>1))>>(p_Vid->bitdepth_chroma-8);

484 
off£t
[
þi¡
][
n
][2] = 
	`sCl3
( -128, 127, offset[clist][n][2]);

485 
off£t
[
þi¡
][
n
][2] = off£t[þi¡][n][2]<<(
p_Vid
->
b™d•th_chroma
 - 8);

487 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

493 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

495 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

497 
comp
=0; comp < 3; comp ++)

499 
off£t_‹¡
 = 
p_IÅ
->
RDPSliûBTe¡
 && 
p_Vid
->
aùive_¥s
->
´ofže_idc
 !ð
BASELINE


500 ? 
	`Ÿbs
(
off£t
[
þi¡
][
šdex
][
comp
]) > 2

501 : 
off£t
[
þi¡
][
šdex
][
comp
] != 0;

503 ià(
weight
[
þi¡
][
šdex
][
comp
] !ð
deçuÉ_weight
[0] || 
off£t_‹¡
)

505 
³rfÜm_wp
 = 1;

509 ià(
³rfÜm_wp
 == 1) ;

511 ià(
³rfÜm_wp
 == 1) ;

514  
³rfÜm_wp
;

515 
	}
}

524 
	$Te¡WPBSliûAlg2
(
Sliû
 *
cu¼Sliû
, 
£Ëù_m‘hod
)

526 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

527 
IÅutP¬am‘”s
 *
p_IÅ
 = 
p_Vid
->p_Inp;

528 
i
, 
j
, 
k
, 
n
;

529 #ià(
MVC_EXTENSION_ENABLE
)

530 
v›w_id
 = 
p_Vid
->view_id;

532 
v›w_id
 = 0;

535 
tx
, 
td
, 
tb
, 
Di¡SÿËFaùÜ
;

537 
šdex
;

538 
comp
;

539 
dc_Üg
 = 0.0;

540 
dc_Üg_UV
[2] = { 0.0 };

541 
dc_»f_UV
[6][
MAX_REFERENCE_PICTURES
][2] = { {{0.0}} };

543 
deçuÉ_weight
[3];

545 
li¡_off£t
 = ((
p_Vid
->
mb_aff_äame_æag
)&&Õ_Vid->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

546 
weight
[6][
MAX_REFERENCE_PICTURES
][3];

547 
off£t
[6][
MAX_REFERENCE_PICTURES
][3];

548 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

549 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

550 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

551 
wbp_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

553 
þi¡
;

554 
wf_weight
, 
wf_off£t
;

555 
³rfÜm_wp
 = 0;

556 
img³l
 **
tmpPŒ
;

558 
luma_log_weight_d’om
 = 5;

559 
chroma_log_weight_d’om
 = 5;

561 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

562 
deçuÉ_weight
[1] = 1 << 
chroma_log_weight_d’om
;

563 
deçuÉ_weight
[2] = 1 << 
chroma_log_weight_d’om
;

566 
i
 = 0; i < 2 + 
li¡_off£t
; i++)

568 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
i
]; j++)

570 
n
 = 0;‚ < 3;‚++)

572 
wp_weight
[
i
][
j
][
n
] = 
deçuÉ_weight
[n];

573 
wp_off£t
[
i
][
j
][
n
] = 0;

574 
off£t
 [
i
][
j
][
n
] = 0;

575 
weight
 [
i
][
j
][
n
] = 
deçuÉ_weight
[n];

580 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

582 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

584 
td
 = (è
	`iCl3
(-128, 127,(
cu¼Sliû
->
li¡X
[
LIST_1
][
j
]->
poc
 - cu¼Sliû->li¡X[
LIST_0
][
i
]->poc));

585 
tb
 = (è
	`iCl3
(-128, 127,(
p_Vid
->
’c_piùu»
->
poc
 - 
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc));

586 
comp
 = 0; comp < 3; comp++)

589 ià(
td
 == 0)

591 
im_weight
[0][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

592 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

596 
tx
 = (è(16384 + 
	`Ÿbs
(
td
 >> 1))/td;

597 
Di¡SÿËFaùÜ
 = 
	`sCl3
(-1024, 1023, (
tx
*
tb
 + 32 )>>6);

598 
im_weight
[1][
i
][
j
][
comp
] = 
Di¡SÿËFaùÜ
 >> 2;

599 ià(
im_weight
[1][
i
][
j
][
comp
] < -64 || im_weight[1][i][j][comp] >128)

600 
im_weight
[1][
i
][
j
][
comp
] = 
deçuÉ_weight
[comp];

601 
im_weight
[0][
i
][
j
][
comp
] = 64 - im_weight[1][i][j][comp];

608 ià(
£Ëù_m‘hod
 == 1)

610 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

612 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

614 
comp
 = 0; comp < 3; comp++)

616 
wbp_weight
[1][
i
][
j
][
comp
] = 
im_weight
[1][i][j][comp] ;

617 
wbp_weight
[0][
i
][
j
][
comp
] = 
im_weight
[0][i][j][comp];

622 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

624 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

626 
comp
 = 0; comp < 3; comp++)

628 
wp_weight
[
þi¡
][
šdex
][
comp
] = 
deçuÉ_weight
[comp];

629 
wp_off£t
[
þi¡
][
šdex
][
comp
] = 0;

636 
dc_Üg
 = 
	`Compu‹ImgSum
(
p_Vid
->
pCurImg
,…_Vid->
height
,…_Vid->
width
);

638 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

640 
k
 = 0; k < 2; k++)

642 
dc_Üg_UV
[
k
] = 
	`Compu‹ImgSum
(
p_Vid
->
pImgOrg
[k + 1],…_Vid->
height_ü
,…_Vid->
width_ü
);

646 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

648 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

650 
off£t
[
þi¡
][
n
][0] = 
wf_off£t
 = 
p_Vid
->
äameOff£t
[clist][n];

651 
weight
[
þi¡
][
n
][0] = 
wf_weight
 = 
deçuÉ_weight
[0];

654 ià(
p_IÅ
->
ChromaWeightSuµÜt
 == 1)

656 
k
 = 0; k < 2; k++)

658 
tmpPŒ
 = 
cu¼Sliû
->
li¡X
[
þi¡
][
n
]->
imgUV
[
k
];

659 
dc_»f_UV
[
þi¡
][
n
][
k
] = 
	`Compu‹ImgSum
(
tmpPŒ
, 
p_Vid
->
height_ü
,…_Vid->
width_ü
);

661 ià(
dc_»f_UV
[
þi¡
][
n
][
k
] != 0.0)

662 
wf_weight
 = (è(
deçuÉ_weight
[
k
 + 1] * 
dc_Üg_UV
[k] / 
dc_»f_UV
[
þi¡
][
n
][k] + 0.5);

664 
wf_weight
 = 
deçuÉ_weight
[
k
 + 1];

665 
wf_weight
 = 
	`sCl3
(-128, 127, wf_weight);

666 
wf_off£t
 = 0;

668 
weight
[
þi¡
][
n
][
k
 + 1] = 
wf_weight
;

669 
off£t
[
þi¡
][
n
][
k
 + 1] = 
wf_off£t
;

674 
weight
[
þi¡
][
n
][1] = 
deçuÉ_weight
[1];

675 
weight
[
þi¡
][
n
][2] = 
deçuÉ_weight
[2];

676 
off£t
[
þi¡
][
n
][1] = 0;

677 
off£t
[
þi¡
][
n
][2] = 0;

682 ià(
£Ëù_m‘hod
 == 0)

684 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

686 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

688 
	`memýy
(
p_Vid
->
cu¼’tSliû
->
wp_weight
[
þi¡
][
šdex
], 
weight
[clist][index], 3 * ());

689 
	`memýy
(
p_Vid
->
cu¼’tSliû
->
wp_off£t
[
þi¡
][
šdex
], 
off£t
[clist][index], 3 * ());

695 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

697 
šdex
 = 0; index < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; index++)

699 
	`memýy
(
wp_weight
[
þi¡
][
šdex
], 
deçuÉ_weight
, 3 * ());

700 
	`mem£t
(
wp_off£t
[
þi¡
][
šdex
], 0, 3 * ());

705 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

707 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

709 
comp
 = 0; comp < 3; comp++)

711 
wbp_weight
[0][
i
][
j
][
comp
] = 
wp_weight
[0][i][comp];

712 
wbp_weight
[1][
i
][
j
][
comp
] = 
wp_weight
[1][j][comp];

714 #ià
DEBUG_WP


715 
	`´štf
 ("bpw weight[%d][%d] = %d , %d (%d %d %dè(%d %dè(%d %d)\n", 
i
, 
j
, 
p_Vid
->
cu¼’tSliû
->
wbp_weight
[0][i][j][0],…_Vid->currentSlice->wbp_weight[1][i][j][0],

716 
p_Vid
->
’c_piùu»
->
poc
,
cu¼Sliû
->
li¡X
[
LIST_0
][
i
]->poc, cu¼Sliû->li¡X[
LIST_1
][
j
]->poc,

717 
Di¡SÿËFaùÜ
 ,
tx
,tx,tx);

723 ià(
£Ëù_m‘hod
 == 0)

725 
aùive_»fs
[2];

727 
aùive_»fs
[0] = (
p_IÅ
->
B_Li¡0_»fs
 =ð0 ? 
cu¼Sliû
->
li¡Xsize
[0] : 
	`imš
Õ_IÅ->B_Li¡0_»fs[
v›w_id
], currSlice->listXsize[0]));

728 
aùive_»fs
[1] = (
p_IÅ
->
B_Li¡1_»fs
 =ð0 ? 
cu¼Sliû
->
li¡Xsize
[1] : 
	`imš
Õ_IÅ->B_Li¡1_»fs[
v›w_id
], currSlice->listXsize[1]));

730 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

732 
šdex
 = 0; index < 
aùive_»fs
[
þi¡
]; index++)

734 
comp
=0; comp < 3; comp ++)

736 ià(
wp_weight
[
þi¡
][
šdex
][
comp
] !ð
deçuÉ_weight
[comp])

738 
³rfÜm_wp
 = 1;

742 ià(
³rfÜm_wp
 == 1) ;

744 ià(
³rfÜm_wp
 == 1) ;

747  
³rfÜm_wp
;

748 
	}
}

750 
	$compu‹_off£t
(
Sliû
 *
cu¼Sliû
)

752 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

753 
PicMÙiÚP¬ams
 **
mÙiÚ
 = 
p_Vid
->
’c_piùu»
->
mv_šfo
;

754 
Maüoblock
 *
cu¼MB
;

755 
i
, 
j
, 
x
, 
y
, 
xj
, 
yi
, 
‹mp
, 
v®Org
;

756 
mvx
=0, 
mvy
=0;

757 
»f_äame
=0;

758 
subblock
=0;

759 
x_Üig
, 
y_Üig
;

760 
x_pos
, 
y_pos
;

761 
out4Y_width
 = (
p_Vid
->
width
 + 
IMG_PAD_SIZE_X
) * 4 - 1;

762 
out4Y_height
 = (
p_Vid
->
height
 + 
IMG_PAD_SIZE_Y
) * 4 - 1;

764 
äame
, 
li¡
, 
off£t
;

765 
d‹mp
;

766 
numli¡s
 = (
p_Vid
->
ty³
 =ð
B_SLICE
) ? 2 : 1;

769 
li¡
 = 0;†ist < 2;†ist++)

771 
äame
 = 0; f¿m< 
MAX_REFERENCE_PICTURES
; frame++)

773 
p_Vid
->
äameOff£tTÙ®
[
li¡
][
äame
] = 0;

774 
p_Vid
->
äameOff£tCouÁ
[
li¡
][
äame
] = 0;

779 
i
=0; i<
p_Vid
->
height
 >> 4; i++)

781 
j
=0; j<
p_Vid
->
width
 >> 4; j++)

784 
cu¼MB
 = &
p_Vid
->
mb_d©a
[((
i
*p_Vid->
width
è>> 4)+
j
];

785 if(
	`is_šŒa
(
cu¼MB
))

788 
x_Üig
 = 
MB_BLOCK_SIZE
*
j
;

789 
y_Üig
 = 
MB_BLOCK_SIZE
*
i
;

791 
subblock
 = 0; subblock < 16; subblock++)

794 
x
 = 
x_Üig
+4*(
subblock
 & 0x03);

795 
y
 = 
y_Üig
+4*(
subblock
 >> 2);

796 
mvx
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
mv
[
LIST_0
].
mv_x
;

797 
mvy
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
mv
[
LIST_0
].
mv_y
;

798 
»f_äame
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
»f_idx
[
LIST_0
];

800 if(
»f_äame
 != -1)

802 
yi
 = 0; yi < 4; yi++)

804 
xj
 = 0; xj < 4; xj++)

806 
v®Org
 = 
p_Vid
->
pCurImg
[
y
+
yi
][
x
+
xj
];

809 
y_pos
 = 
	`imax
(-4*
IMG_PAD_SIZE_Y
, 
	`imš
(
out4Y_height
, 4*(
y
+
yi
)+
mvy
));

811 
x_pos
 = 
	`imax
(-4*
IMG_PAD_SIZE_X
, 
	`imš
(
out4Y_width
, 4*(
x
+
xj
)+
mvx
));

813 
‹mp
=
cu¼Sliû
->
li¡X
[
LIST_0
][
»f_äame
]->
p_cu¼_img_sub
[(
y_pos
 & 0x03)][(
x_pos
 & 0x03)][y_pos >> 2][x_pos >> 2];

814 
p_Vid
->
äameOff£tTÙ®
[
LIST_0
][
»f_äame
]+=(
v®Org
-
‹mp
);

815 
p_Vid
->
äameOff£tCouÁ
[
LIST_0
][
»f_äame
]++;

822 
mvx
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
mv
[
LIST_1
].
mv_x
;

823 
mvy
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
mv
[
LIST_1
].
mv_y
;

824 
»f_äame
 = 
mÙiÚ
[
y
 >> 2][
x
 >> 2].
»f_idx
[
LIST_1
];

825 if(
»f_äame
 != -1)

827 
yi
 = 0; yi < 4; yi++)

829 
xj
 = 0; xj < 4; xj++)

831 
v®Org
 = 
p_Vid
->
pCurImg
[
y
+
yi
][
x
+
xj
];

834 
y_pos
 = 
	`imax
(-4*
IMG_PAD_SIZE_Y
, 
	`imš
(
out4Y_height
, 4*(
y
+
yi
è+ 
mvy
));

836 
x_pos
 = 
	`imax
(-4*
IMG_PAD_SIZE_X
, 
	`imš
(
out4Y_width
, 4*(
x
+
xj
è+ 
mvx
));

838 
‹mp
=
cu¼Sliû
->
li¡X
[
LIST_0
][
»f_äame
]->
p_cu¼_img_sub
[(
y_pos
 & 0x03)][(
x_pos
 & 0x03)][y_pos >> 2][x_pos >> 2];

839 
p_Vid
->
äameOff£tTÙ®
[
LIST_1
][
»f_äame
]+=(
v®Org
-
‹mp
);

840 
p_Vid
->
äameOff£tCouÁ
[
LIST_1
][
»f_äame
]++;

848 
li¡
 = 0;†i¡ < 
numli¡s
;†ist++)

850 
äame
 = 0; f¿m< 
cu¼Sliû
->
li¡Xsize
[
li¡
]; frame++)

852 
d‹mp
=()
p_Vid
->
äameOff£tTÙ®
[
li¡
][
äame
];

854 ià(
p_Vid
->
äameOff£tCouÁ
[
li¡
][
äame
]>0)

856 
off£t
=()(
	`çbs
(
d‹mp
)/()
p_Vid
->
äameOff£tCouÁ
[
li¡
][
äame
]+0.5);

857 ià(
p_Vid
->
äameOff£tTÙ®
[
li¡
][
äame
]>=0)

859 
p_Vid
->
äameOff£t
[
li¡
][
äame
] = (è
off£t
;

863 
p_Vid
->
äameOff£t
[
li¡
][
äame
] = (è-
off£t
;

874 
	}
}

	@lencod/src/wp_mcprec.c

15 
	~"cÚŒibutÜs.h
"

17 
	~"glob®.h
"

18 
	~"image.h
"

19 
	~"¦iû.h
"

20 
	~"li¡_»Üd”.h
"

21 
	~"wp_mý»c.h
"

22 
	~"mem®loc.h
"

31 
	$wpxIn™WPXObjeù
Ð
VideoP¬am‘”s
 *
p_Vid
 )

33 
p_Vid
->
pWPX
 = (
WPXObjeù
 *)
	`m®loc
( ( WPXObject ) );

34 iàÐ
p_Vid
->
pWPX
 =ð
NULL
 )

36 
	`årštf
Ð
¡d”r
, "\n Error initializing memory for WPXObject. Exiting...\n" );

37 
	`ex™
(1);

41 ià((
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_0
] = (
Weigh‹dP»dRefX
 *è
	`ÿÎoc
(
MAX_REFERENCE_PICTURES
, (Weigh‹dP»dRefX))è=ð
NULL
)

42 
	`no_mem_ex™
("wpxInitWPXObject:…_Vid->pWPX->wp_ref_list[0]");

44 ià((
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_1
] = (
Weigh‹dP»dRefX
 *è
	`ÿÎoc
(
MAX_REFERENCE_PICTURES
, (Weigh‹dP»dRefX))è=ð
NULL
)

45 
	`no_mem_ex™
("wpxInitWPXObject:…_Vid->pWPX->wp_ref_list[1]");

46 
	}
}

55 
	$wpxF»eWPXObjeù
Ð
VideoP¬am‘”s
 *
p_Vid
 )

58 ià(
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_0
])

59 
	`ä“
(
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_0
]);

60 
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_0
] = 
NULL
;

62 ià(
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_1
])

63 
	`ä“
(
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_1
]);

64 
p_Vid
->
pWPX
->
wp_»f_li¡
[
LIST_1
] = 
NULL
;

66 iàÐ
p_Vid
->
pWPX
 !ð
NULL
 )

68 
	`ä“
Ð
p_Vid
->
pWPX
 );

70 
	}
}

79 
	$wpxIn™WPXPas£s
Ð
VideoP¬am‘”s
 *
p_Vid
, 
IÅutP¬am‘”s
 *
p_IÅ
 )

82 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
LIST_0
] = 0;

83 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
LIST_1
] = 0;

85  
p_IÅ
->
WPMCP»cisiÚ
 )

91 
p_Vid
->
pWPX
->
wp_rd_·s£s
[0].
®gÜ™hm
 = 
WP_REGULAR
;

92 
p_Vid
->
pWPX
->
wp_rd_·s£s
[1].
®gÜ™hm
 = 
WP_MCPREC_MINUS0
;

95 
p_Vid
->
pWPX
->
wp_rd_·s£s
[0].
®gÜ™hm
 = 
WP_REGULAR
;

96 
p_Vid
->
pWPX
->
wp_rd_·s£s
[1].
®gÜ™hm
 = 
WP_MCPREC_MINUS0
;

97 
p_Vid
->
pWPX
->
wp_rd_·s£s
[2].
®gÜ™hm
 = 
WP_MCPREC_MINUS1
;

100 
	}
}

109 
	$wpxModifyRefPicLi¡
Ð
Sliû
 *
cu¼Sliû
 )

111 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

112 
i
, 
j
, 
þÚed_»fs
;

113 
deçuÉ_Üd”_li¡0
[32];

114 
deçuÉ_Üd”_li¡1
[32];

115 
»_Üd”
[32], *
li¡_Üd”
;

116 
´ed_li¡
;

117 
DecodedPiùu»Bufãr
 *
p_Dpb
 = 
cu¼Sliû
->p_Dpb;

119 
StÜabËPiùu»
 **
li¡
;

122 
	`mem£t
Ð(*)
deçuÉ_Üd”_li¡0
, 1<<20, 32 * ( ) );

123 
	`mem£t
Ð(*)
deçuÉ_Üd”_li¡1
, 1<<20, 32 * ( ) );

124 
	`mem£t
Ð(*)
»_Üd”
, 1<<20, 32 * ( ) );

127 
li¡
 = 
cu¼Sliû
->
li¡X
[
LIST_0
];

128 
i
=0; i<()(
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
]); i++)

130 
deçuÉ_Üd”_li¡0
[
i
] = 
li¡
[i]->
pic_num
;

132 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 )

134 
li¡
 = 
cu¼Sliû
->
li¡X
[
LIST_1
];

135 
i
=0; i<()(
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
]); i++)

137 
deçuÉ_Üd”_li¡1
[
i
] = 
li¡
[i]->
pic_num
;

142 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 )

144 
li¡_sign
[32];

145 
poc_diff
[32];

146 
tmp_v®ue
;

147 
abs_poc_di¡
;

149 
i
=0; i < 
p_Dpb
->
»f_äames_š_bufãr
; i++)

151 
»_Üd”
[
i
] = 
p_Dpb
->
fs_»f
[i]->
äame
->
pic_num
;

152 ià(
p_Dpb
->
fs_»f
[
i
]->
is_u£d
==3 && (p_Dpb->fs_»f[i]->
äame
->
u£d_fÜ_»ã»nû
)&&(!p_Dpb->fs_»f[i]->äame->
is_lÚg_‹rm
))

154 
abs_poc_di¡
 = 
	`Ÿbs
(
p_Dpb
->
fs_»f
[
i
]->
äame
->
poc
 - 
p_Vid
->
’c_piùu»
->poc) ;

155 
poc_diff
[
i
] = 
abs_poc_di¡
;

156 
li¡_sign
[
i
] = (
p_Vid
->
’c_piùu»
->
poc
 < 
p_Dpb
->
fs_»f
[i]->
äame
->poc) ? +1 : -1;

161 
i
=0; i< 
p_Dpb
->
»f_äames_š_bufãr
-1; i++)

163 
j
=
i
+1; j< 
p_Dpb
->
»f_äames_š_bufãr
; j++)

165 ià(
poc_diff
[
i
]>poc_diff[
j
] || (poc_diff[i] =ðpoc_diff[j] && 
li¡_sign
[j] >†ist_sign[i]))

167 
tmp_v®ue
 = 
poc_diff
[
i
];

168 
poc_diff
[
i
] =…oc_diff[
j
];

169 
poc_diff
[
j
] = 
tmp_v®ue
;

170 
tmp_v®ue
 = 
»_Üd”
[
i
];

171 
»_Üd”
[
i
] =„e_Üd”[
j
];

172 
»_Üd”
[
j
] = 
tmp_v®ue
 ;

173 
tmp_v®ue
 = 
li¡_sign
[
i
];

174 
li¡_sign
[
i
] =†i¡_sign[
j
];

175 
li¡_sign
[
j
] = 
tmp_v®ue
 ;

183  
´ed_li¡
 = 0;…»d_li¡ < (1 + ( 
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 ? 1 : 0 ));…red_list++ )

185 iàÐ
´ed_li¡
 =ð
LIST_0
 )

187 
li¡_Üd”
 = (
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
è? 
»_Üd”
 : 
deçuÉ_Üd”_li¡0
;

191 
li¡_Üd”
 = 
deçuÉ_Üd”_li¡1
;

195  
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 )

198 
WP_MCPREC_PLUS0
:

199 
WP_MCPREC_PLUS1
:

200 
WP_MCPREC_MINUS0
:

201 
WP_MCPREC_MINUS1
:

203 
þÚed_»fs
 = 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
´ed_li¡
] = 2;

204  
j
 = 0; j < 
þÚed_»fs
; j++ )

206 
p_Vid
->
pWPX
->
wp_»f_li¡
[
´ed_li¡
][
j
].
PicNum
 = 
li¡_Üd”
[0];

209  
j
 = 
þÚed_»fs
; j < 
p_Dpb
->
»f_äames_š_bufãr
; j++ )

211 
p_Vid
->
pWPX
->
wp_»f_li¡
[
´ed_li¡
][
j
].
PicNum
 = 
li¡_Üd”
[j - (
þÚed_»fs
 - 1)];

212 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
´ed_li¡
]++;

215 
WP_MCPREC_MINUS_PLUS0
:

217 
þÚed_»fs
 = 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
´ed_li¡
] = 3;

218  
j
 = 0; j < 
þÚed_»fs
; j++ )

220 
p_Vid
->
pWPX
->
wp_»f_li¡
[
´ed_li¡
][
j
].
PicNum
 = 
li¡_Üd”
[0];

223  
j
 = 
þÚed_»fs
; j < 
p_Dpb
->
»f_äames_š_bufãr
; j++ )

225 
p_Vid
->
pWPX
->
wp_»f_li¡
[
´ed_li¡
][
j
].
PicNum
 = 
li¡_Üd”
[j - (
þÚed_»fs
 - 1)];

226 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
´ed_li¡
]++;

231 
p_Vid
->
pWPX
->
num_wp_»f_li¡
[
´ed_li¡
] = 
	`imš
(…_Vid->pWPX->num_wp_ref_list[pred_list],

232 Ð
´ed_li¡
 =ð
LIST_0
 ) ? 
cu¼Sliû
->
num_»f_idx_aùive
[LIST_0] : cu¼Sliû->num_»f_idx_aùive[
LIST_1
] );

234 
	}
}

243 
	$wpxD‘”mšeWP
Ð
Sliû
 *
cu¼Sliû
, 
þi¡
, 
n
 )

245 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

246 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

247 
i
, 
j
, 
d‘”mše_wp
 = 0;

248 
deçuÉ_weight
[3];

250 
luma_log_weight_d’om
 = 5;

251 
chroma_log_weight_d’om
 = 5;

252 
cur_li¡
 = 
LIST_0
;

254 
deçuÉ_weight
[0] = 1 << 
luma_log_weight_d’om
;

255 
deçuÉ_weight
[1] = 1 << 
chroma_log_weight_d’om
;

256 
deçuÉ_weight
[2] = 1 << 
chroma_log_weight_d’om
;

258 iàÐ!
p_IÅ
->
WPMCP»cisiÚ
 )

260 
d‘”mše_wp
 = 1;

264 
d‘”mše_wp
 = 0;

266 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
P_SLICE
 )

268 
i
 = 0; i < 3; i++)

270 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

273 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 )

275 
cur_li¡
 = ((
þi¡
 & 0x01è=ð
LIST_1
è? 
LIST_0
 : LIST_1;

278 
i
 = 0; i < 3; i++)

280 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
i
] = 
deçuÉ_weight
[i];

283 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
cur_li¡
]; j++)

285 
i
 = 0; i < 3; i++)

286 
cu¼Sliû
->
wbp_weight
[
þi¡
][
n
][
j
][
i
] = 
deçuÉ_weight
[i];

290  
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 )

292 
WP_MCPREC_PLUS0
:

293 
i
 = 0; i < 3; i++)

294 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = (n == 1) ? 1 : 0;

296 
WP_MCPREC_MINUS0
:

297 
i
 = 0; i < 3; i++)

298 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = (n == 1) ? -1 : 0;

300 
WP_MCPREC_PLUS1
:

301 
i
 = 0; i < 3; i++)

302 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = (n == 0) ? 1 : 0;

304 
WP_MCPREC_MINUS1
:

305 
i
 = 0; i < 3; i++)

306 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = (n == 0) ? -1 : 0;

308 
WP_MCPREC_MINUS_PLUS0
:

309 
i
 = 0; i < 3; i++)

310 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = (n == 1) ? -1 : ((n == 2) ? 1 : 0);

313 
WP_REGULAR
:

314 
d‘”mše_wp
 = 1;

318 iàÐ
cu¼Sliû
->
¦iû_ty³
 =ð
B_SLICE
 && 
cur_li¡
 =ð
LIST_0
 )

320 
i
 = 0; i < 3; i++)

321 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] *= 2;

324 
i
 = 1; i < 3; i++)

326 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
i
] = 0;

330  
d‘”mše_wp
;

331 
	}
}

340 
	$wpxAd­tRefNum
Ð
Sliû
 *
cu¼Sliû
 )

342 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

343 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

344 #ià(
MVC_EXTENSION_ENABLE
)

345 
v›w_id
 = 
p_Vid
->view_id;

347 
v›w_id
 = 0;

350 iàÐ
p_Vid
->
pWPX
->
cu¼_wp_rd_·ss
->
®gÜ™hm
 =ð
WP_REGULAR
 )

352  
cu¼Sliû
->
¦iû_ty³
 )

355 
I_SLICE
:

357 
P_SLICE
:

358 iàÐ
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] =ðÐ
p_IÅ
->
P_Li¡0_»fs
[
v›w_id
] * ((cu¼Sliû->
¡ruùu»
 !=0) + 1) ) )

360 
cu¼Sliû
->
li¡Xsize
[
LIST_0
] = cu¼Sliû->
num_»f_idx_aùive
[LIST_0] = (è
	`imax
Ð((cu¼Sliû->
¡ruùu»
 !=0) + 1), currSlice->num_ref_idx_active[LIST_0] - ((currSlice->structure !=0) + 1) );

363 
B_SLICE
:

364 iàÐ
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_0
] =ðÐ
p_IÅ
->
B_Li¡0_»fs
[
v›w_id
] * ((cu¼Sliû->
¡ruùu»
 !=0) + 1) ) )

366 
cu¼Sliû
->
li¡Xsize
[
LIST_0
] = cu¼Sliû->
num_»f_idx_aùive
[LIST_0] = (è
	`imax
Ð((cu¼Sliû->
¡ruùu»
 !=0) + 1), currSlice->num_ref_idx_active[LIST_0] - ((currSlice->structure !=0) + 1) );

368 iàÐ
cu¼Sliû
->
num_»f_idx_aùive
[
LIST_1
] =ðÐ
p_IÅ
->
B_Li¡1_»fs
[
v›w_id
] * ((cu¼Sliû->
¡ruùu»
 !=0) + 1) ) )

370 
cu¼Sliû
->
li¡Xsize
[
LIST_1
] = cu¼Sliû->
num_»f_idx_aùive
[LIST_1] = (è
	`imax
Ð((cu¼Sliû->
¡ruùu»
 !=0) + 1), currSlice->num_ref_idx_active[LIST_1] - ((currSlice->structure !=0) + 1) );

375 
	}
}

	@lencod/src/wp_periodic.c

14 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"wp_³riodic.h
"

19 
	~"wp.h
"

20 
	~<m©h.h
>

22 
	#PI
 3.14159265

	)

31 
	$E¡im©eWPPSliûP”iodic
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

33 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

34 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

36 
n
;

37 
deçuÉ_weight
[3];

38 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

39 
þi¡
;

40 
¡¬t_mb
, 
’d_mb
;

41 
comp
;

42 
b™d•th
[3] = { (
p_Vid
->
b™d•th_luma
 - 8), (p_Vid->
b™d•th_chroma
 - 8), (p_Vid->bitdepth_chroma - 8)};

44 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

45 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

47 
cur_¦iû
;

48 
cur_weight
, 
cur_off£t
;

50 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

51 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

53 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

54 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

55 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

56 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

59 if(
p_IÅ
->
¦iû_mode
 == 1)

61 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
;

64 
cur_¦iû
 = 0;

67 if(
p_IÅ
->
¦iû_mode
 == 1)

69 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

70 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

71 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

72 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

76 
¡¬t_mb
 = 0;

77 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

80 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

82 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

84 
comp
=0; comp < 3; comp ++)

86 
cur_weight
 = (è((127.0 * 
	`cos
 (
p_Vid
->
numb”
 *
PI
 / 30)è+ (4.0 * (((è
	`¿nd
()è/ 
RAND_MAX
)) - 4.0);

87 
weight
[
þi¡
][
n
][
comp
] = 
	`sCl3
(-128, 127, 
cur_weight
);

88 
cur_off£t
 = (è((127.0 * 
	`cos
 ((
p_Vid
->
numb”
 + 15è* 
PI
 / 45)è+ (4.0 * (((è
	`¿nd
()è/ 
RAND_MAX
)) - 4.0);

89 
off£t
[
þi¡
][
n
][
comp
] = (
	`sCl3
(-128, 127, 
cur_off£t
è<< 
b™d•th
[comp]);

94 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

96 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

98 
comp
=0; comp < 3; comp ++)

100 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = 
weight
[clist][n][comp];

101 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = 
off£t
[clist][n][comp];

102 if(
p_Vid
->
wp_weights
)

103 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
weight
[clist][n][comp];

104 if(
p_Vid
->
wp_off£ts
)

105 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
off£t
[clist][n][comp];

107 #ià
DEBUG_WP


108 
comp
 = 0; comp < 3; comp++)

109 
	`´štf
("¦iû %d: index %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n", 
cur_¦iû
, 
n
,
comp
,
cu¼Sliû
->
wp_weight
[
þi¡
][n][comp],cu¼Sliû->
wp_off£t
[clist][n][comp]);

113 
	}
}

121 
	$E¡im©eWPBSliûP”iodic
(
Sliû
 *
cu¼Sliû
)

123 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

124 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

125 
i
, 
j
, 
n
;

127 
comp
;

128 
k
;

130 
deçuÉ_weight
[3];

131 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

132 
þi¡
;

133 
cur_¦iû
 = 0;

134 
cur_weight
, 
cur_off£t
;

135 
b™d•th
[3] = { (
p_Vid
->
b™d•th_luma
 - 8), (p_Vid->
b™d•th_chroma
 - 8), (p_Vid->bitdepth_chroma - 8)};

137 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

139 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

140 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

144 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

145 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

148 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

149 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

150 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

151 
deçuÉ_weight
[1] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

152 
deçuÉ_weight
[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

155 if(
p_IÅ
->
¦iû_mode
 == 1)

157 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
 ;

160 
cur_¦iû
 = 0;

162 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

164 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

166 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

168 
k
 = 0; k < 2; k++)

170 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

172 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

174 
comp
 = 0; comp < 3; comp++)

176 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
im_weight
[k][i][j][comp];

182 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

184 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; i++)

186 
comp
 = 0; comp < 3; comp++)

188 
cu¼Sliû
->
wp_weight
[
þi¡
][
i
][
comp
] = 
deçuÉ_weight
[comp];

189 
cu¼Sliû
->
wp_off£t
[
þi¡
][
i
][
comp
] = 0;

196 
¡¬t_mb
, 
’d_mb
;

198 
comp
;

200 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

201 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

203 if(
p_IÅ
->
¦iû_mode
 == 1)

205 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

206 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

207 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

208 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

212 
¡¬t_mb
 = 0;

213 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

216 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

218 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

220 
comp
 = 0; comp < 3; comp ++)

222 
cur_weight
 = (è((127.0 * 
	`cos
 (
p_Vid
->
numb”
 *
PI
 / 30)è+ (4.0 * (((è
	`¿nd
()è/ 
RAND_MAX
)) - 4.0);

223 
wp_weight
[
þi¡
][
n
][
comp
] = 
	`sCl3
(-128, 127, 
cur_weight
);

224 
cur_off£t
 = (è((127.0 * 
	`cos
 ((
p_Vid
->
numb”
 + 45è* 
PI
 / 45)è+ (4.0 * (((è
	`¿nd
()è/ 
RAND_MAX
)) - 4.0);

225 
wp_off£t
[
þi¡
][
n
][
comp
] = (
	`sCl3
(-128, 127, 
cur_off£t
è<< 
b™d•th
[comp]);

236 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

238 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

240 
comp
=0; comp < 3; comp ++)

242 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = wp_weight[clist][n][comp];

243 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = wp_offset[clist][n][comp];

244 if(
p_Vid
->
wp_weights
)

245 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_weight
[clist][n][comp];

246 if(
p_Vid
->
wp_off£ts
)

247 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_off£t
[clist][n][comp];

258 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

260 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

262 
comp
 = 0; comp < 3; comp++)

264 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

265 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

276 
	}
}

285 
	$Te¡WPPSliûP”iodic
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

287 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

288 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

291 
	}
}

301 
	$Te¡WPBSliûP”iodic
(
Sliû
 *
cu¼Sliû
, 
£Ëù_m‘hod
)

303 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

304 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

307 
	}
}

	@lencod/src/wp_random.c

14 
	~"cÚŒibutÜs.h
"

16 
	~"glob®.h
"

17 
	~"image.h
"

18 
	~"wp_¿ndom.h
"

19 
	~"wp.h
"

28 
	$E¡im©eWPPSliûRªdom
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

30 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

31 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

33 
n
;

34 
deçuÉ_weight
[3];

35 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

36 
þi¡
;

37 
¡¬t_mb
, 
’d_mb
;

38 
comp
;

39 
b™d•th
[3] = { (
p_Vid
->
b™d•th_luma
 - 8), (p_Vid->
b™d•th_chroma
 - 8), (p_Vid->bitdepth_chroma - 8)};

41 
weight
[2][
MAX_REFERENCE_PICTURES
][3];

42 
off£t
[2][
MAX_REFERENCE_PICTURES
][3];

44 
cur_¦iû
;

45 
cur_weight
, 
cur_off£t
;

47 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

48 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

50 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

51 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

52 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

53 
deçuÉ_weight
[1] = deçuÉ_weight[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

56 if(
p_IÅ
->
¦iû_mode
 == 1)

58 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
;

61 
cur_¦iû
 = 0;

64 if(
p_IÅ
->
¦iû_mode
 == 1)

66 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

67 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

68 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

69 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

73 
¡¬t_mb
 = 0;

74 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

77 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

79 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

81 
comp
=0; comp < 3; comp ++)

83 
cur_weight
 = ((è(255.0 * (((è
	`¿nd
()è/ 
RAND_MAX
))) - 128;

84 
weight
[
þi¡
][
n
][
comp
] = 
	`sCl3
(-128, 127, 
cur_weight
);

85 
cur_off£t
 = ((è(255.0 * (((è
	`¿nd
()è/ 
RAND_MAX
))) - 128;

86 
off£t
[
þi¡
][
n
][
comp
] = (
	`sCl3
(-128, 127, 
cur_off£t
è<< 
b™d•th
[comp]);

91 
þi¡
 = 0; cli¡ < 2 + 
li¡_off£t
; clist++)

93 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

95 
comp
=0; comp < 3; comp ++)

97 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = 
weight
[clist][n][comp];

98 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = 
off£t
[clist][n][comp];

99 if(
p_Vid
->
wp_weights
)

100 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
weight
[clist][n][comp];

101 if(
p_Vid
->
wp_off£ts
)

102 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
off£t
[clist][n][comp];

104 #ià
DEBUG_WP


105 
comp
 = 0; comp < 3; comp++)

106 
	`´štf
("¦iû %d: index %d compÚ’ˆ%d weighˆ%d off£ˆ%d\n", 
cur_¦iû
, 
n
,
comp
,
cu¼Sliû
->
wp_weight
[
þi¡
][n][comp],cu¼Sliû->
wp_off£t
[clist][n][comp]);

110 
	}
}

118 
	$E¡im©eWPBSliûRªdom
(
Sliû
 *
cu¼Sliû
)

120 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

121 
IÅutP¬am‘”s
 *
p_IÅ
 = 
cu¼Sliû
->p_Inp;

122 
i
, 
j
, 
n
;

124 
comp
;

125 
k
;

127 
deçuÉ_weight
[3];

128 
li¡_off£t
 = ((
cu¼Sliû
->
mb_aff_äame_æag
è&& (
p_Vid
->
mb_d©a
[p_Vid->
cu¼’t_mb_Ä
].
mb_f›ld
))? (p_Vid->current_mb_nr & 0x01) ? 4 : 2 : 0;

129 
þi¡
;

130 
cur_¦iû
 = 0;

131 
cur_weight
, 
cur_off£t
;

132 
b™d•th
[3] = { (
p_Vid
->
b™d•th_luma
 - 8), (p_Vid->
b™d•th_chroma
 - 8), (p_Vid->bitdepth_chroma - 8)};

134 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

136 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

137 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

141 
cu¼Sliû
->
luma_log_weight_d’om
 = 5;

142 
cu¼Sliû
->
chroma_log_weight_d’om
 = 5;

145 
cu¼Sliû
->
wp_luma_round
 = 1 << (cu¼Sliû->
luma_log_weight_d’om
 - 1);

146 
cu¼Sliû
->
wp_chroma_round
 = 1 << (cu¼Sliû->
chroma_log_weight_d’om
 - 1);

147 
deçuÉ_weight
[0] = 1 << 
cu¼Sliû
->
luma_log_weight_d’om
;

148 
deçuÉ_weight
[1] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

149 
deçuÉ_weight
[2] = 1 << 
cu¼Sliû
->
chroma_log_weight_d’om
;

152 if(
p_IÅ
->
¦iû_mode
 == 1)

154 
cur_¦iû
 = 
p_Vid
->
cu¼’t_mb_Ä
 / 
p_IÅ
->
¦iû_¬gum’t
 ;

157 
cur_¦iû
 = 0;

159 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 == 2)

161 
im_weight
[6][
MAX_REFERENCE_PICTURES
][MAX_REFERENCE_PICTURES][3];

163 
	`Compu‹Im¶ic™Weights
(
cu¼Sliû
, 
deçuÉ_weight
, 
im_weight
);

165 
k
 = 0; k < 2; k++)

167 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

169 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

171 
comp
 = 0; comp < 3; comp++)

173 
cu¼Sliû
->
wbp_weight
[
k
][
i
][
j
][
comp
] = 
im_weight
[k][i][j][comp];

179 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

181 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
þi¡
]; i++)

183 
comp
 = 0; comp < 3; comp++)

185 
cu¼Sliû
->
wp_weight
[
þi¡
][
i
][
comp
] = 
deçuÉ_weight
[comp];

186 
cu¼Sliû
->
wp_off£t
[
þi¡
][
i
][
comp
] = 0;

193 
¡¬t_mb
, 
’d_mb
;

195 
comp
;

197 
wp_weight
[6][
MAX_REFERENCE_PICTURES
][3];

198 
wp_off£t
[6][
MAX_REFERENCE_PICTURES
][3];

200 if(
p_IÅ
->
¦iû_mode
 == 1)

202 
¡¬t_mb
 = 
cur_¦iû
 * 
p_IÅ
->
¦iû_¬gum’t
;

203 
’d_mb
 = 
¡¬t_mb
 + 
p_IÅ
->
¦iû_¬gum’t
;

204 if(
’d_mb
 > ()
p_Vid
->
F¿meSizeInMbs
)

205 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

209 
¡¬t_mb
 = 0;

210 
’d_mb
 = 
p_Vid
->
F¿meSizeInMbs
;

213 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

215 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

217 
comp
=0; comp < 3; comp ++)

219 
cur_weight
 = ((è(255.0 * (((è
	`¿nd
()è/ 
RAND_MAX
))) - 128;

220 
wp_weight
[
þi¡
][
n
][
comp
] = 
	`sCl3
(-128, 127, 
cur_weight
);

221 
cur_off£t
 = ((è(255.0 * (((è
	`¿nd
()è/ 
RAND_MAX
))) - 128;

222 
wp_off£t
[
þi¡
][
n
][
comp
] = (
	`sCl3
(-128, 127, 
cur_off£t
è<< 
b™d•th
[comp]);

231 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

233 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

235 
comp
=0; comp < 3; comp ++)

237 
cu¼Sliû
->
wp_weight
[
þi¡
][
n
][
comp
] = wp_weight[clist][n][comp];

238 
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
][
comp
] = wp_offset[clist][n][comp];

239 if(
p_Vid
->
wp_weights
)

240 
p_Vid
->
wp_weights
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_weight
[clist][n][comp];

241 if(
p_Vid
->
wp_off£ts
)

242 
p_Vid
->
wp_off£ts
[
comp
][
þi¡
][
n
][
cur_¦iû
] = 
wp_off£t
[clist][n][comp];

247 ià(
p_Vid
->
aùive_µs
->
weigh‹d_b»d_idc
 != 1)

249 
þi¡
=0; cli¡<2 + 
li¡_off£t
; clist++)

251 
n
 = 0;‚ < 
cu¼Sliû
->
li¡Xsize
[
þi¡
];‚++)

253 
	`memýy
(
cu¼Sliû
->
wp_weight
[
þi¡
][
n
], 
deçuÉ_weight
, 3 * ());

254 
	`mem£t
(
cu¼Sliû
->
wp_off£t
[
þi¡
][
n
], 0, 3 * ());

259 
i
 = 0; i < 
cu¼Sliû
->
li¡Xsize
[
LIST_0
]; i++)

261 
j
 = 0; j < 
cu¼Sliû
->
li¡Xsize
[
LIST_1
]; j++)

263 
comp
 = 0; comp < 3; comp++)

265 
cu¼Sliû
->
wbp_weight
[0][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[0][i][comp];

266 
cu¼Sliû
->
wbp_weight
[1][
i
][
j
][
comp
] = cu¼Sliû->
wp_weight
[1][j][comp];

271 
	}
}

280 
	$Te¡WPPSliûRªdom
(
Sliû
 *
cu¼Sliû
, 
£Ëù_off£t
)

282 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

283 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

286 
	}
}

296 
	$Te¡WPBSliûRªdom
(
Sliû
 *
cu¼Sliû
, 
£Ëù_m‘hod
)

298 
VideoP¬am‘”s
 *
p_Vid
 = 
cu¼Sliû
->p_Vid;

299 
p_Vid
->
wp_·¿m‘”s_£t
 = 1;

302 
	}
}

	@rtp_loss/rtp_loss.cpp

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<memÜy.h
>

7 #ifdeà
WIN32


8 
	~<Wšsock2.h
>

10 
	~<Ãtš‘/š.h
>

13 
	$´št_u§ge
(*
¬gv
 [])

15 
	`´štf
 ("Thisool‡llows dropping RTP…ackets fromhe given input file.");

16 
	`´štf
 ("Note:he input file‚eedso be‡ H.264/AVC RTP dump file (lencod: OutFileMode=1)");

17 
	`´štf
 ("U§ge: % šput_fžouut_fžloss_³rûÁ <k“p_Ëadšg_·ck‘s>\n", 
¬gv
[0]);

18 
	`ex™
 (-1);

19 
	}
}

21 
	$k“p_·ck‘
(
loss_³rûÁ
)

23 
ºd
;

24 ià(
loss_³rûÁ
>100)

26 ià(
loss_³rûÁ
<=0)

29 
ºd
 = (100 * (((è
	`¿nd
()è/ 
RAND_MAX
));

31  (
ºd
 >ð
loss_³rûÁ
 );

32 
	}
}

34 
	$maš
(
¬gc
, * 
¬gv
[])

36 
bufsize
, 
·úo
=0;

37 
buf
[65000];

38 
i
, 
štime
;

39 
FILE
 *
ä
;

40 
FILE
 *
fw
;

43 ià((
¬gc
 != 4) && (argc != 5))

45 
	`´št_u§ge
 (
¬gv
);

48 ià(
NULL
 =ð(
ä
 = 
	`fÝ’
 (
¬gv
[1], "rb")))

50 
	`´štf
 ("%s: cªnÙ o³ÀH.264…ack‘ fž% fÜ„—dšg\n", 
¬gv
[0],‡rgv[1]);

54 ià(
NULL
 =ð(
fw
 = 
	`fÝ’
 (
¬gv
[2], "wb")))

56 
	`´štf
 ("%s: cªnÙ o³ÀH.264…ack‘ fž% fÜ„—dšg\n", 
¬gv
[0],‡rgv[1]);

57 
	`fþo£
 (
ä
);

62 ià(
¬gc
==5)

64 
i
=0; i< 
	`©oi
 (
¬gv
[4]); i++)

66 ià(4 !ð
	`ä—d
 (&
bufsize
, 1, 4, 
ä
))

68 ià(4 !ð
	`ä—d
 (&
štime
, 1, 4, 
ä
))

70 
	`´štf
 ("Panic, cannot„eadimestamp (ishis‡ valid RTP dump file?)\n");

73 ià(
bufsize
 !ð
	`ä—d
 (
buf
, 1, bufsize, 
ä
))

75 
	`´štf
 ("Cannot„ead…acket with indicated†ength (ishis‡ valid RTP dump file?),ƒxit\n");

79 ià(4 !ð
	`fwr™e
 (&
bufsize
, 1, 4, 
fw
))

81 
	`´štf
 ("Problems while writing buffer size,ƒxit\n");

84 ià(4 !ð
	`fwr™e
 (&
štime
, 1, 4, 
fw
))

86 
	`´štf
 ("Problems while writingimestamp,ƒxit\n");

89 ià(
bufsize
 !ð
	`fwr™e
 (
buf
, 1, bufsize, 
fw
))

91 
	`´štf
 ("Problems while writing buffer,ƒxit\n");

94 
·úo
++;

101 ià(4 !ð
	`ä—d
 (&
bufsize
, 1, 4, 
ä
))

103 ià(4 !ð
	`ä—d
 (&
štime
, 1, 4, 
ä
))

105 
	`´štf
 ("Panic, cannot„eadimestamp (ishis‡ valid RTP dump file?)\n");

108 ià(
bufsize
 !ð
	`ä—d
 (
buf
, 1, bufsize, 
ä
))

110 
	`´štf
 ("Cannot„ead…acket with indicated†ength (ishis‡ valid RTP dump file?)\n");

113 ià(
	`k“p_·ck‘
(
	`©oi
 (
¬gv
[3])))

115 ià(4 !ð
	`fwr™e
 (&
bufsize
, 1, 4, 
fw
))

117 
	`´štf
 ("Problems while writing buffer size,ƒxit\n");

120 ià(4 !ð
	`fwr™e
 (&
štime
, 1, 4, 
fw
))

122 
	`´štf
 ("Problems while writingimestamp,ƒxit\n");

125 ià(
bufsize
 !ð
	`fwr™e
 (
buf
, 1, bufsize, 
fw
))

127 
	`´štf
 ("Problems while writing buffer,ƒxit\n");

133 
	`´štf
 ("lo¡…ack‘ #%d\n", 
·úo
);

135 
·úo
++;

138 
	}
}

	@rtp_loss/rtp_loss.h

	@rtpdump/rtpdump.cpp

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<memÜy.h
>

8 #ià
defšed
(
WIN32
è|| defšed(
WIN64
)

9 
	~<Wšsock2.h
>

11 
	~<Ãtš‘/š.h
>

15 
	$maš
(
¬gc
, * 
¬gv
[])

17 
bufsize
, 
·úo
=0, 
‹mp32
;

18 
‹mp16
;

19 
buf
[65000];

20 
i
, 
štime
;

21 
FILE
 *
f
;

23 ià(
¬gc
 != 2)

25 
	`´štf
 ("Thisool displays information‡bouthe RTP…ackets inhe given input file.");

26 
	`´štf
 ("Note:he input file‚eedso be‡ H.264/AVC RTP dump file (lencod: OutFileMode=1)");

27 
	`´štf
 ("U§ge: % šput_fže\n", 
¬gv
[0]);

31 ià(
NULL
 =ð(
f
 = 
	`fÝ’
 (
¬gv
[1], "rb")))

33 
	`´štf
 ("%s: cªnÙ o³ÀH.264…ack‘ fž% fÜ„—dšg\n", 
¬gv
[0],‡rgv[1]);

39 ià(4 !ð
	`ä—d
 (&
bufsize
, 1, 4, 
f
))

42 ià(4 !ð
	`ä—d
 (&
štime
, 1, 4, 
f
))

44 
	`´štf
 ("Panic, cannot„eadimestamp (ishis‡ valid RTP dump file?)\n");

47 
	`´štf
 ("\n\Åack‘ #%4d cÚššg %5d by‹s\n", 
·úo
++, 
bufsize
);

48 ià(
bufsize
 !ð
	`ä—d
 (
buf
, 1, bufsize, 
f
))

50 
	`´štf
 ("Cannot„ead…acket with indicated†ength (ishis‡ valid RTP dump file?)\n");

54 
i
=0; i< 25; i++)

55 
	`´štf
 ("%02x ", 
buf
[
i
]);

57 
	`´štf
 ("\n");

58 
	`´štf
 ("V”siÚ (V): %d\n", (
buf
[0] >> 6) & 0x03);

59 
	`´štf
 ("Paddšg (P): %d\n", (
buf
[0] >> 5) & 0x01);

60 
	`´štf
 ("Ex‹nsiÚ (X): %d\n", (
buf
[0] >> 4) & 0x01);

61 
	`´štf
 ("CSRC couÁ (CC): %d\n", (
buf
[0] >> 0) & 0x0F);

62 
	`´štf
 ("M¬k” b™ (M): %d\n", (
buf
[1] >> 7) & 0x01);

63 
	`´štf
 ("Paylßd Ty³ (PT): %d\n", (
buf
[1] >> 0) & 0x7F);

64 
	`memýy
 (&
‹mp16
, &
buf
[2], 2);

65 
	`´štf
 ("Sequ’û Numb”: %d\n", 
	`Áohs
(
‹mp16
));

66 
	`memýy
 (&
‹mp32
, &
buf
[4], 4);

67 
	`´štf
 ("Time¡amp: %d\n", 
	`Áohl
(
‹mp32
));

68 
	`memýy
 (&
‹mp32
, &
buf
[8], 4);

69 
	`´štf
 ("SSRC: %d\n", 
	`Áohl
(
‹mp32
));

71 
	`´štf
 ("Fœ¡ By‹: 0x%x\n", 
buf
[12]);

73 
	}
}

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ýlu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_çž
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fže
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_çž
 (
__”ºum
, cÚ¡ *
__fže
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fže
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


88 
	#as£¹
(
ex´
) \

89 ((
ex´
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£¹_çž
 (
	`__STRING
(
ex´
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£¹_³¼Ü
(
”ºum
) \

95 (!(
”ºum
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£¹_³¼Ü_çž
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #ià
defšed
 
__ýlu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

118 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ýlu¥lus


120 #undeà
¡©ic_as£¹


121 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ð
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tÞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ýlu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ð0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tÞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tÞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__bužtš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tÞow”
 (
__c
))

217  
__c
 >ð-128 && __ø< 256 ? (*
	`__ùy³_tÞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ð-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ð2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ýlu¥lus


228 
	#tÞow”
(
c
è
	`__tobody
 (c, 
tÞow”
, *
	`__ùy³_tÞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tÞow”
(
c
è((è(*
	`__ùy³_tÞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tÞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tÞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ð2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ýlu¥lus


295 
	#__tÞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tÞow”_l
, (
loÿË
)->
__ùy³_tÞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tÞow”_l
(
c
, 
loÿË
è
	`__tÞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/fcntl.h

22 #iâdef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

35 
	~<b™s/fúŽ.h
>

40 #iâdeà
__mode_t_defšed


41 
__mode_t
 
	tmode_t
;

42 
	#__mode_t_defšed


	)

45 #iâdeà
__off_t_defšed


46 #iâdeà
__USE_FILE_OFFSET64


47 
__off_t
 
	toff_t
;

49 
__off64_t
 
	toff_t
;

51 
	#__off_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


55 
__off64_t
 
	toff64_t
;

56 
	#__off64_t_defšed


	)

59 #iâdeà
__pid_t_defšed


60 
__pid_t
 
	tpid_t
;

61 
	#__pid_t_defšed


	)

65 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


66 
	#__Ãed_time¥ec


	)

67 
	~<time.h
>

68 
	~<b™s/¡©.h
>

70 
	#S_IFMT
 
__S_IFMT


	)

71 
	#S_IFDIR
 
__S_IFDIR


	)

72 
	#S_IFCHR
 
__S_IFCHR


	)

73 
	#S_IFBLK
 
__S_IFBLK


	)

74 
	#S_IFREG
 
__S_IFREG


	)

75 #ifdeà
__S_IFIFO


76 
	#S_IFIFO
 
__S_IFIFO


	)

78 #ifdeà
__S_IFLNK


79 
	#S_IFLNK
 
__S_IFLNK


	)

81 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


82 
	#S_IFSOCK
 
__S_IFSOCK


	)

87 
	#S_ISUID
 
__S_ISUID


	)

88 
	#S_ISGID
 
__S_ISGID


	)

90 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


92 
	#S_ISVTX
 
__S_ISVTX


	)

95 
	#S_IRUSR
 
__S_IREAD


	)

96 
	#S_IWUSR
 
__S_IWRITE


	)

97 
	#S_IXUSR
 
__S_IEXEC


	)

99 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

101 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

102 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

103 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

105 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

107 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

108 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

109 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

111 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

114 #ifdef 
__USE_MISC


115 #iâdeà
R_OK


118 
	#R_OK
 4

	)

119 
	#W_OK
 2

	)

120 
	#X_OK
 1

	)

121 
	#F_OK
 0

	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#SEEK_SET
 0

	)

128 
	#SEEK_CUR
 1

	)

129 
	#SEEK_END
 2

	)

137 
fúŽ
 (
__fd
, 
__cmd
, ...);

145 #iâdeà
__USE_FILE_OFFSET64


146 
	$Ý’
 (cÚ¡ *
__fže
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

148 #ifdeà
__REDIRECT


149 
	`__REDIRECT
 (
Ý’
, (cÚ¡ *
__fže
, 
__oæag
, ...), 
Ý’64
)

150 
	`__nÚnuÎ
 ((1));

152 
	#Ý’
 
Ý’64


	)

155 #ifdeà
__USE_LARGEFILE64


156 
	$Ý’64
 (cÚ¡ *
__fže
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

159 #ifdeà
__USE_ATFILE


169 #iâdeà
__USE_FILE_OFFSET64


170 
	$Ý’©
 (
__fd
, cÚ¡ *
__fže
, 
__oæag
, ...)

171 
	`__nÚnuÎ
 ((2));

173 #ifdeà
__REDIRECT


174 
	`__REDIRECT
 (
Ý’©
, (
__fd
, cÚ¡ *
__fže
, 
__oæag
,

175 ...), 
Ý’©64
è
	`__nÚnuÎ
 ((2));

177 
	#Ý’©
 
Ý’©64


	)

180 #ifdeà
__USE_LARGEFILE64


181 
	$Ý’©64
 (
__fd
, cÚ¡ *
__fže
, 
__oæag
, ...)

182 
	`__nÚnuÎ
 ((2));

191 #iâdeà
__USE_FILE_OFFSET64


192 
	$ü—t
 (cÚ¡ *
__fže
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

194 #ifdeà
__REDIRECT


195 
	`__REDIRECT
 (
ü—t
, (cÚ¡ *
__fže
, 
mode_t
 
__mode
),

196 
ü—t64
è
	`__nÚnuÎ
 ((1));

198 
	#ü—t
 
ü—t64


	)

201 #ifdeà
__USE_LARGEFILE64


202 
	$ü—t64
 (cÚ¡ *
__fže
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

205 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

206 && !
defšed
 
__USE_POSIX
))

215 
	#F_ULOCK
 0

	)

216 
	#F_LOCK
 1

	)

217 
	#F_TLOCK
 2

	)

218 
	#F_TEST
 3

	)

220 #iâdeà
__USE_FILE_OFFSET64


221 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Ën
);

223 #ifdeà
__REDIRECT


224 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

226 
	#lockf
 
lockf64


	)

229 #ifdeà
__USE_LARGEFILE64


230 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Ën
);

234 #ifdeà
__USE_XOPEN2K


237 #iâdeà
__USE_FILE_OFFSET64


238 
	$posix_çdvi£
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
,

239 
__advi£
è
__THROW
;

241 #ifdeà
__REDIRECT_NTH


242 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

243 
__off64_t
 
__Ën
, 
__advi£
),

244 
posix_çdvi£64
);

246 
	#posix_çdvi£
 
posix_çdvi£64


	)

249 #ifdeà
__USE_LARGEFILE64


250 
	$posix_çdvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
,

251 
__advi£
è
__THROW
;

259 #iâdeà
__USE_FILE_OFFSET64


260 
	`posix_çÎoÿ‹
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
);

262 #ifdeà
__REDIRECT


263 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

264 
__off64_t
 
__Ën
),

265 
posix_çÎoÿ‹64
);

267 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

270 #ifdeà
__USE_LARGEFILE64


271 
	`posix_çÎoÿ‹64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
);

277 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
 \

278 && 
defšed
 
__va_¬g_·ck_Ën


279 
	~<b™s/fúŽ2.h
>

282 
__END_DECLS


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šþude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xÝ’_lim.h
>

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


32 
	~<b™s/huge_v®.h
>

33 #ifdeà
__USE_ISOC99


34 
	~<b™s/huge_v®f.h
>

35 
	~<b™s/huge_v®l.h
>

38 
	~<b™s/šf.h
>

41 
	~<b™s/Çn.h
>

45 
	~<b™s/m©hdef.h
>

52 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

53 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

54 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

55 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

56 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

57 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

58 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

59 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

60 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

61 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

62 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

63 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

65 
	#_MdoubË_
 

	)

66 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

67 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

68 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

69 
	~<b™s/m©hÿÎs.h
>

70 #undeà
_MdoubË_


71 #undeà
_MdoubË_BEGIN_NAMESPACE


72 #undeà
_MdoubË_END_NAMESPACE


73 #undeà
__MATH_PRECNAME


75 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


81 #iâdeà
_Mæßt_


82 
	#_Mæßt_
 

	)

84 
	#_MdoubË_
 
_Mæßt_


	)

85 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

86 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

87 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

88 
	~<b™s/m©hÿÎs.h
>

89 #undeà
_MdoubË_


90 #undeà
_MdoubË_BEGIN_NAMESPACE


91 #undeà
_MdoubË_END_NAMESPACE


92 #undeà
__MATH_PRECNAME


94 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

95 || 
defšed
 
__LDBL_COMPAT


96 #ifdeà
__LDBL_COMPAT


98 #ifdeà
__USE_ISOC99


99 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

100 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

101 #ifdeà
__REDIRECT_NTH


102 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

103 
__Ædbl_Ãx‰ow¬df
)

104 
	`__©Œibu‹__
 ((
__cÚ¡__
));

105 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

106 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

107 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

108 (
__x
, 
__y
),

109 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

113 #undeà
__MATHDECL_1


114 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

115 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

116 
¬gs
, 
®Ÿs
)

	)

117 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

118 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

124 #iâdeà
_MlÚg_doubË_


125 
	#_MlÚg_doubË_
 

	)

127 
	#_MdoubË_
 
_MlÚg_doubË_


	)

128 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

129 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

130 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

131 
	#__MATH_DECLARE_LDOUBLE
 1

	)

132 
	~<b™s/m©hÿÎs.h
>

133 #undeà
_MdoubË_


134 #undeà
_MdoubË_BEGIN_NAMESPACE


135 #undeà
_MdoubË_END_NAMESPACE


136 #undeà
__MATH_PRECNAME


141 #undeà
__MATHDECL_1


142 #undeà
__MATHDECL


143 #undeà
__MATHCALL


146 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


148 
signgam
;

153 #ifdeà
__USE_ISOC99


191 
FP_NAN
 =

192 
	#FP_NAN
 0

	)

193 
FP_NAN
,

194 
FP_INFINITE
 =

195 
	#FP_INFINITE
 1

	)

196 
FP_INFINITE
,

197 
FP_ZERO
 =

198 
	#FP_ZERO
 2

	)

199 
FP_ZERO
,

200 
FP_SUBNORMAL
 =

201 
	#FP_SUBNORMAL
 3

	)

202 
FP_SUBNORMAL
,

203 
FP_NORMAL
 =

204 
	#FP_NORMAL
 4

	)

205 
FP_NORMAL


209 #ifdeà
__NO_LONG_DOUBLE_MATH


210 
	#åþassify
(
x
) \

211 ( (
x
è=ð (è? 
	`__åþassifyf
 (xè: 
	`__åþassify
 (x))

	)

213 
	#åþassify
(
x
) \

214 ( (
x
) ==  () \

215 ? 
	`__åþassifyf
 (
x
) \

216 :  (
x
) ==  () \

217 ? 
	`__åþassify
 (
x
è: 
	`__åþassifyl
 (x))

	)

221 #ifdeà
__NO_LONG_DOUBLE_MATH


222 
	#signb™
(
x
) \

223 ( (
x
è=ð (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

225 
	#signb™
(
x
) \

226 ( (
x
) ==  () \

227 ? 
	`__signb™f
 (
x
) \

228 :  (
x
) ==  () \

229 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

233 #ifdeà
__NO_LONG_DOUBLE_MATH


234 
	#isfš™e
(
x
) \

235 ( (
x
è=ð (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

237 
	#isfš™e
(
x
) \

238 ( (
x
) ==  () \

239 ? 
	`__fš™ef
 (
x
) \

240 :  (
x
) ==  () \

241 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

245 
	#i¢Üm®
(
x
è(
	`åþassify
 (xè=ð
FP_NORMAL
)

	)

249 #ifdeà
__NO_LONG_DOUBLE_MATH


250 
	#i¢ª
(
x
) \

251 ( (
x
è=ð (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

253 
	#i¢ª
(
x
) \

254 ( (
x
) ==  () \

255 ? 
	`__i¢ªf
 (
x
) \

256 :  (
x
) ==  () \

257 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

261 #ifdeà
__NO_LONG_DOUBLE_MATH


262 
	#isšf
(
x
) \

263 ( (
x
è=ð (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

265 
	#isšf
(
x
) \

266 ( (
x
) ==  () \

267 ? 
	`__isšff
 (
x
) \

268 :  (
x
) ==  () \

269 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

273 
	#MATH_ERRNO
 1

	)

274 
	#MATH_ERREXCEPT
 2

	)

279 #iâdeà
__FAST_MATH__


280 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

285 #ifdeà
__USE_GNU


287 #ifdeà
__NO_LONG_DOUBLE_MATH


288 
	#issigÇlšg
(
x
) \

289 ( (
x
è=ð (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

291 
	#issigÇlšg
(
x
) \

292 ( (
x
) ==  () \

293 ? 
	`__issigÇlšgf
 (
x
) \

294 :  (
x
) ==  () \

295 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

299 #ifdef 
__USE_MISC


303 
_IEEE_
 = -1,

304 
_SVID_
,

305 
_XOPEN_
,

306 
_POSIX_
,

307 
_ISOC_


308 } 
	t_LIB_VERSION_TYPE
;

313 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

317 #ifdeà
__USE_SVID


323 #ifdeà
__ýlu¥lus


324 
__exû±iÚ


326 
exû±iÚ


329 
ty³
;

330 *
Çme
;

331 
¬g1
;

332 
¬g2
;

333 
»tv®
;

334 
	}
};

336 #ifdeà
__ýlu¥lus


337 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

339 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

342 
	#X_TLOSS
 1.41484755040568800000e+16

	)

345 
	#DOMAIN
 1

	)

346 
	#SING
 2

	)

347 
	#OVERFLOW
 3

	)

348 
	#UNDERFLOW
 4

	)

349 
	#TLOSS
 5

	)

350 
	#PLOSS
 6

	)

353 
	#HUGE
 3.40282347e+38F

	)

357 #ifdeà
__USE_XOPEN


359 
	#MAXFLOAT
 3.40282347e+38F

	)

366 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


367 
	#M_E
 2.7182818284590452354

	)

368 
	#M_LOG2E
 1.4426950408889634074

	)

369 
	#M_LOG10E
 0.43429448190325182765

	)

370 
	#M_LN2
 0.69314718055994530942

	)

371 
	#M_LN10
 2.30258509299404568402

	)

372 
	#M_PI
 3.14159265358979323846

	)

373 
	#M_PI_2
 1.57079632679489661923

	)

374 
	#M_PI_4
 0.78539816339744830962

	)

375 
	#M_1_PI
 0.31830988618379067154

	)

376 
	#M_2_PI
 0.63661977236758134308

	)

377 
	#M_2_SQRTPI
 1.12837916709551257390

	)

378 
	#M_SQRT2
 1.41421356237309504880

	)

379 
	#M_SQRT1_2
 0.70710678118654752440

	)

385 #ifdeà
__USE_GNU


386 
	#M_El
 2.718281828459045235360287471352662498L

	)

387 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

388 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

389 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

390 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

391 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

392 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

393 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

394 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

395 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

396 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

397 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

398 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

405 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


406 
	#__NO_MATH_INLINES
 1

	)

409 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

416 
	#isg»©”
(
x
, 
y
è
	`__bužtš_isg»©”
(x, y)

	)

417 
	#isg»©”equ®
(
x
, 
y
è
	`__bužtš_isg»©”equ®
(x, y)

	)

418 
	#i¦ess
(
x
, 
y
è
	`__bužtš_i¦ess
(x, y)

	)

419 
	#i¦es£qu®
(
x
, 
y
è
	`__bužtš_i¦es£qu®
(x, y)

	)

420 
	#i¦essg»©”
(
x
, 
y
è
	`__bužtš_i¦essg»©”
(x, y)

	)

421 
	#isunÜd”ed
(
u
, 
v
è
	`__bužtš_isunÜd”ed
(u, v)

	)

425 #ifdeà
__USE_EXTERN_INLINES


426 
	~<b™s/m©hšlše.h
>

431 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

432 
	~<b™s/m©h-fš™e.h
>

435 #ifdeà
__USE_ISOC99


439 #iâdeà
isg»©”


440 
	#isg»©”
(
x
, 
y
) \

441 (
__ex‹nsiÚ__
 \

442 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

443 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

447 #iâdeà
isg»©”equ®


448 
	#isg»©”equ®
(
x
, 
y
) \

449 (
__ex‹nsiÚ__
 \

450 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

451 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ð__y; }))

	)

455 #iâdeà
i¦ess


456 
	#i¦ess
(
x
, 
y
) \

457 (
__ex‹nsiÚ__
 \

458 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

459 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

463 #iâdeà
i¦es£qu®


464 
	#i¦es£qu®
(
x
, 
y
) \

465 (
__ex‹nsiÚ__
 \

466 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

467 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ð__y; }))

	)

471 #iâdeà
i¦essg»©”


472 
	#i¦essg»©”
(
x
, 
y
) \

473 (
__ex‹nsiÚ__
 \

474 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

475 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

479 #iâdeà
isunÜd”ed


480 
	#isunÜd”ed
(
u
, 
v
) \

481 (
__ex‹nsiÚ__
 \

482 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

483 
	`åþassify
 (
__u
è=ð
FP_NAN
 || fpþassify (
__v
è=ðFP_NAN; }))

	)

488 
	g__END_DECLS


	@/usr/include/memory.h

22 #iâdef 
_MEMORY_H


23 
	#_MEMORY_H
 1

	)

25 
	~<ã©u»s.h
>

28 #iâdef 
_STRING_H


29 
	~<¡ršg.h
>

	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<¡dšt.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_RAW
 = 255,

89 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

90 
	mIPPROTO_MAX


96 #iâdeà
__USE_KERNEL_IPV6_DEFS


99 
	mIPPROTO_HOPOPTS
 = 0,

100 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

101 
	mIPPROTO_ROUTING
 = 43,

102 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

103 
	mIPPROTO_FRAGMENT
 = 44,

104 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

105 
	mIPPROTO_ICMPV6
 = 58,

106 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

107 
	mIPPROTO_NONE
 = 59,

108 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

109 
	mIPPROTO_DSTOPTS
 = 60,

110 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

111 
	mIPPROTO_MH
 = 135

112 
	#IPPROTO_MH
 
IPPROTO_MH


	)

117 
ušt16_t
 
	tš_pÜt_t
;

122 
	mIPPORT_ECHO
 = 7,

123 
	mIPPORT_DISCARD
 = 9,

124 
	mIPPORT_SYSTAT
 = 11,

125 
	mIPPORT_DAYTIME
 = 13,

126 
	mIPPORT_NETSTAT
 = 15,

127 
	mIPPORT_FTP
 = 21,

128 
	mIPPORT_TELNET
 = 23,

129 
	mIPPORT_SMTP
 = 25,

130 
	mIPPORT_TIMESERVER
 = 37,

131 
	mIPPORT_NAMESERVER
 = 42,

132 
	mIPPORT_WHOIS
 = 43,

133 
	mIPPORT_MTP
 = 57,

135 
	mIPPORT_TFTP
 = 69,

136 
	mIPPORT_RJE
 = 77,

137 
	mIPPORT_FINGER
 = 79,

138 
	mIPPORT_TTYLINK
 = 87,

139 
	mIPPORT_SUPDUP
 = 95,

142 
	mIPPORT_EXECSERVER
 = 512,

143 
	mIPPORT_LOGINSERVER
 = 513,

144 
	mIPPORT_CMDSERVER
 = 514,

145 
	mIPPORT_EFSSERVER
 = 520,

148 
	mIPPORT_BIFFUDP
 = 512,

149 
	mIPPORT_WHOSERVER
 = 513,

150 
	mIPPORT_ROUTESERVER
 = 520,

153 
	mIPPORT_RESERVED
 = 1024,

156 
	mIPPORT_USERRESERVED
 = 5000

164 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ð0)

	)

165 
	#IN_CLASSA_NET
 0xff000000

	)

166 
	#IN_CLASSA_NSHIFT
 24

	)

167 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

168 
	#IN_CLASSA_MAX
 128

	)

170 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ð0x80000000)

	)

171 
	#IN_CLASSB_NET
 0xffff0000

	)

172 
	#IN_CLASSB_NSHIFT
 16

	)

173 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

174 
	#IN_CLASSB_MAX
 65536

	)

176 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ð0xc0000000)

	)

177 
	#IN_CLASSC_NET
 0xffffff00

	)

178 
	#IN_CLASSC_NSHIFT
 8

	)

179 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

181 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ð0xe0000000)

	)

182 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

184 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ð0xe0000000)

	)

185 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ð0xf0000000)

	)

188 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

190 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

192 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

195 
	#IN_LOOPBACKNET
 127

	)

197 #iâdeà
INADDR_LOOPBACK


198 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

202 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

203 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

204 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

205 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

207 #iâdeà
__USE_KERNEL_IPV6_DEFS


209 
	sš6_addr


213 
ušt8_t
 
	m__u6_addr8
[16];

214 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


215 
ušt16_t
 
	m__u6_addr16
[8];

216 
ušt32_t
 
	m__u6_addr32
[4];

218 } 
	m__š6_u
;

219 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

220 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


221 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

222 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

227 cÚ¡ 
š6_addr
 
š6addr_ªy
;

228 cÚ¡ 
š6_addr
 
š6addr_loÝback
;

229 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

230 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

232 
	#INET_ADDRSTRLEN
 16

	)

233 
	#INET6_ADDRSTRLEN
 46

	)

237 
	ssockaddr_š


239 
__SOCKADDR_COMMON
 (
sš_
);

240 
š_pÜt_t
 
	msš_pÜt
;

241 
š_addr
 
	msš_addr
;

244 
	msš_z”o
[ (
sockaddr
) -

245 
__SOCKADDR_COMMON_SIZE
 -

246  (
š_pÜt_t
) -

247  (
š_addr
)];

250 #iâdeà
__USE_KERNEL_IPV6_DEFS


252 
	ssockaddr_š6


254 
__SOCKADDR_COMMON
 (
sš6_
);

255 
š_pÜt_t
 
	msš6_pÜt
;

256 
ušt32_t
 
	msš6_æowšfo
;

257 
š6_addr
 
	msš6_addr
;

258 
ušt32_t
 
	msš6_scÝe_id
;

262 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


264 
	s_m»q


267 
š_addr
 
	mimr_muÉŸddr
;

270 
š_addr
 
	mimr_š‹rçû
;

273 
	s_m»q_sourû


276 
š_addr
 
	mimr_muÉŸddr
;

279 
š_addr
 
	mimr_š‹rçû
;

282 
š_addr
 
	mimr_sourûaddr
;

286 #iâdeà
__USE_KERNEL_IPV6_DEFS


288 
	sv6_m»q


291 
š6_addr
 
	mv6mr_muÉŸddr
;

294 
	mv6mr_š‹rçû
;

298 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


300 
	sgroup_»q


303 
ušt32_t
 
	mgr_š‹rçû
;

306 
sockaddr_¡Üage
 
	mgr_group
;

309 
	sgroup_sourû_»q


312 
ušt32_t
 
	mg¤_š‹rçû
;

315 
sockaddr_¡Üage
 
	mg¤_group
;

318 
sockaddr_¡Üage
 
	mg¤_sourû
;

323 
	s_msfž‹r


326 
š_addr
 
	mimsf_muÉŸddr
;

329 
š_addr
 
	mimsf_š‹rçû
;

332 
ušt32_t
 
	mimsf_fmode
;

335 
ušt32_t
 
	mimsf_num¤c
;

337 
š_addr
 
	mimsf_¦i¡
[1];

340 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msfž‹r
) \

341 -  (
š_addr
) \

342 + (
num¤c
è*  (
š_addr
))

	)

344 
	sgroup_fž‹r


347 
ušt32_t
 
	mgf_š‹rçû
;

350 
sockaddr_¡Üage
 
	mgf_group
;

353 
ušt32_t
 
	mgf_fmode
;

356 
ušt32_t
 
	mgf_num¤c
;

358 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

361 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_fž‹r
) \

362 -  (
sockaddr_¡Üage
) \

363 + ((
num¤c
) \

364 *  (
sockaddr_¡Üage
)))

	)

374 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃŽÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

375 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

376 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

382 
	~<’dŸn.h
>

385 
	~<b™s/by‹sw­.h
>

387 #ifdeà
__OPTIMIZE__


391 #ià
__BYTE_ORDER
 =ð
__BIG_ENDIAN


394 
	#Áohl
(
x
è(x)

	)

395 
	#Áohs
(
x
è(x)

	)

396 
	#htÚl
(
x
è(x)

	)

397 
	#htÚs
(
x
è(x)

	)

399 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


400 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

401 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

402 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

403 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

408 #ifdeà
__GNUC__


409 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

410 (
__ex‹nsiÚ__
 \

411 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

412 
__a
->
s6_addr32
[0] == 0 \

413 && 
__a
->
s6_addr32
[1] == 0 \

414 && 
__a
->
s6_addr32
[2] == 0 \

415 && 
__a
->
s6_addr32
[3] =ð0; 
	}
}))

	)

417 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

418 (
__ex‹nsiÚ__
 \

419 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

420 
__a
->
s6_addr32
[0] == 0 \

421 && 
__a
->
s6_addr32
[1] == 0 \

422 && 
__a
->
s6_addr32
[2] == 0 \

423 && 
__a
->
s6_addr32
[3] =ð
	`htÚl
 (1); }))

	)

425 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

426 (
__ex‹nsiÚ__
 \

427 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

428 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ðhtÚÈ(0xã800000); }))

	)

430 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

431 (
__ex‹nsiÚ__
 \

432 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

433 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ðhtÚÈ(0xãc00000); }))

	)

435 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

436 (
__ex‹nsiÚ__
 \

437 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

438 
__a
->
s6_addr32
[0] == 0 \

439 && 
__a
->
s6_addr32
[1] == 0 \

440 && 
__a
->
s6_addr32
[2] =ð
	`htÚl
 (0xffff); }))

	)

442 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

443 (
__ex‹nsiÚ__
 \

444 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

445 
__a
->
s6_addr32
[0] == 0 \

446 && 
__a
->
s6_addr32
[1] == 0 \

447 && 
__a
->
s6_addr32
[2] == 0 \

448 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

450 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

451 (
__ex‹nsiÚ__
 \

452 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

453 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

454 
__a
->
s6_addr32
[0] =ð
__b
->s6_addr32[0] \

455 && 
__a
->
s6_addr32
[1] =ð
__b
->s6_addr32[1] \

456 && 
__a
->
s6_addr32
[2] =ð
__b
->s6_addr32[2] \

457 && 
__a
->
s6_addr32
[3] =ð
__b
->s6_addr32[3]; }))

	)

459 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

460 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

461 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

462 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ð0)

	)

465 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

466 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

467 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

468 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ð
	`htÚl
 (1))

	)

471 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

472 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

473 =ð
	`htÚl
 (0xã800000))

	)

475 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

476 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

477 =ð
	`htÚl
 (0xãc00000))

	)

479 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

480 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

481 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

482 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ð
	`htÚl
 (0xffff)))

	)

484 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

485 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

486 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

487 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

488 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

490 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

491 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ð((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

492 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ð((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

493 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ð((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ð((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

497 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ð0xff)

	)

499 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


501 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

504 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

505 
__THROW
;

509 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

510 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

511 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ð0x1))

	)

513 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

514 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

515 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ð0x2))

	)

517 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

518 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

519 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ð0x5))

	)

521 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

522 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

523 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ð0x8))

	)

525 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

526 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

527 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ð0xe))

	)

530 #ifdeà
__USE_GNU


531 
cmsghdr
;

534 
	sš6_pktšfo


536 
š6_addr
 
i6_addr
;

537 
i6_ifšdex
;

541 
	s6_mtušfo


543 
sockaddr_š6
 
6m_addr
;

544 
ušt32_t
 
6m_mtu
;

549 
	$š‘6_ÝtiÚ_¥aû
 (
__nby‹s
)

550 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

551 
	$š‘6_ÝtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

552 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

553 
	$š‘6_ÝtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

554 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

555 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

556 
ušt8_t
 *
	$š‘6_ÝtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

557 
__muÉx
, 
__¶usy
)

558 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

559 
	$š‘6_ÝtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

560 
ušt8_t
 **
__Œp
)

561 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

562 
	$š‘6_ÝtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

563 
ušt8_t
 **
__Œp
, 
__ty³
)

564 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

568 
	$š‘6_Ýt_š™
 (*
__extbuf
, 
sockËn_t
 
__exŽ’
è
__THROW
;

569 
	$š‘6_Ýt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__exŽ’
, 
__off£t
,

570 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

571 **
__d©abuå
è
__THROW
;

572 
	$š‘6_Ýt_fšish
 (*
__extbuf
, 
sockËn_t
 
__exŽ’
, 
__off£t
)

573 
__THROW
;

574 
	$š‘6_Ýt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

575 
sockËn_t
 
__v®Ën
è
__THROW
;

576 
	$š‘6_Ýt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__exŽ’
, 
__off£t
,

577 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

578 **
__d©abuå
è
__THROW
;

579 
	$š‘6_Ýt_fšd
 (*
__extbuf
, 
sockËn_t
 
__exŽ’
, 
__off£t
,

580 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

581 **
__d©abuå
è
__THROW
;

582 
	$š‘6_Ýt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

583 
sockËn_t
 
__v®Ën
è
__THROW
;

587 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

588 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

589 
__£gm’ts
è
__THROW
;

590 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

591 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

592 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

593 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

594 
__THROW
;

600 
	$g‘v4sourûfž‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

601 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

602 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

603 
__THROW
;

606 
	$£tv4sourûfž‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

607 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

608 
ušt32_t
 
__num¤c
,

609 cÚ¡ 
š_addr
 *
__¦i¡
)

610 
__THROW
;

614 
	$g‘sourûfž‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

615 cÚ¡ 
sockaddr
 *
__group
,

616 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

617 
ušt32_t
 *
__num¤c
,

618 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

621 
	$£tsourûfž‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

622 cÚ¡ 
sockaddr
 *
__group
,

623 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

624 
ušt32_t
 
__num¤c
,

625 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

628 
__END_DECLS


	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/wch¬.h
>

27 
	~<b™s/wÜdsize.h
>

34 #iâdeà
__št8_t_defšed


35 
	#__št8_t_defšed


	)

36 sigÃd 
	tšt8_t
;

37 
	tšt16_t
;

38 
	tšt32_t
;

39 #ià
__WORDSIZE
 == 64

40 
	tšt64_t
;

42 
__ex‹nsiÚ__


43 
	tšt64_t
;

48 
	tušt8_t
;

49 
	tušt16_t
;

50 #iâdeà
__ušt32_t_defšed


51 
	tušt32_t
;

52 
	#__ušt32_t_defšed


	)

54 #ià
__WORDSIZE
 == 64

55 
	tušt64_t
;

57 
__ex‹nsiÚ__


58 
	tušt64_t
;

65 sigÃd 
	tšt_Ëa¡8_t
;

66 
	tšt_Ëa¡16_t
;

67 
	tšt_Ëa¡32_t
;

68 #ià
__WORDSIZE
 == 64

69 
	tšt_Ëa¡64_t
;

71 
__ex‹nsiÚ__


72 
	tšt_Ëa¡64_t
;

76 
	tušt_Ëa¡8_t
;

77 
	tušt_Ëa¡16_t
;

78 
	tušt_Ëa¡32_t
;

79 #ià
__WORDSIZE
 == 64

80 
	tušt_Ëa¡64_t
;

82 
__ex‹nsiÚ__


83 
	tušt_Ëa¡64_t
;

90 sigÃd 
	tšt_ç¡8_t
;

91 #ià
__WORDSIZE
 == 64

92 
	tšt_ç¡16_t
;

93 
	tšt_ç¡32_t
;

94 
	tšt_ç¡64_t
;

96 
	tšt_ç¡16_t
;

97 
	tšt_ç¡32_t
;

98 
__ex‹nsiÚ__


99 
	tšt_ç¡64_t
;

103 
	tušt_ç¡8_t
;

104 #ià
__WORDSIZE
 == 64

105 
	tušt_ç¡16_t
;

106 
	tušt_ç¡32_t
;

107 
	tušt_ç¡64_t
;

109 
	tušt_ç¡16_t
;

110 
	tušt_ç¡32_t
;

111 
__ex‹nsiÚ__


112 
	tušt_ç¡64_t
;

117 #ià
__WORDSIZE
 == 64

118 #iâdeà
__šŒ_t_defšed


119 
	tšŒ_t
;

120 
	#__šŒ_t_defšed


	)

122 
	tušŒ_t
;

124 #iâdeà
__šŒ_t_defšed


125 
	tšŒ_t
;

126 
	#__šŒ_t_defšed


	)

128 
	tušŒ_t
;

133 #ià
__WORDSIZE
 == 64

134 
	tštmax_t
;

135 
	tuštmax_t
;

137 
__ex‹nsiÚ__


138 
	tštmax_t
;

139 
__ex‹nsiÚ__


140 
	tuštmax_t
;

144 #ià
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
èø## 
L


	)

146 
	#__UINT64_C
(
c
èø## 
UL


	)

148 
	#__INT64_C
(
c
èø## 
LL


	)

149 
	#__UINT64_C
(
c
èø## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #ià
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #ià
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #ià
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #ià
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #ià
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #ià
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 
	#SIZE_MAX
 (4294967295U)

	)

267 #iâdeà
WCHAR_MIN


269 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

270 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

274 
	#WINT_MIN
 (0u)

	)

275 
	#WINT_MAX
 (4294967295u)

	)

278 
	#INT8_C
(
c
è
	)
c

279 
	#INT16_C
(
c
è
	)
c

280 
	#INT32_C
(
c
è
	)
c

281 #ià
__WORDSIZE
 == 64

282 
	#INT64_C
(
c
èø## 
L


	)

284 
	#INT64_C
(
c
èø## 
LL


	)

288 
	#UINT8_C
(
c
è
	)
c

289 
	#UINT16_C
(
c
è
	)
c

290 
	#UINT32_C
(
c
èø## 
U


	)

291 #ià
__WORDSIZE
 == 64

292 
	#UINT64_C
(
c
èø## 
UL


	)

294 
	#UINT64_C
(
c
èø## 
ULL


	)

298 #ià
__WORDSIZE
 == 64

299 
	#INTMAX_C
(
c
èø## 
L


	)

300 
	#UINTMAX_C
(
c
èø## 
UL


	)

302 
	#INTMAX_C
(
c
èø## 
LL


	)

303 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ifdeà
__USE_XOPEN2K8


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

101 #iâdeà
__ssize_t_defšed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defšed


	)

108 
__BEGIN_NAMESPACE_STD


109 #iâdeà
__USE_FILE_OFFSET64


110 
_G_åos_t
 
	tåos_t
;

112 
_G_åos64_t
 
	tåos_t
;

114 
__END_NAMESPACE_STD


115 #ifdeà
__USE_LARGEFILE64


116 
_G_åos64_t
 
	tåos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #iâdeà
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #iâdeà
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifdeà
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


151 
	#P_tmpdœ
 "/tmp"

	)

164 
	~<b™s/¡dio_lim.h
>

168 
_IO_FILE
 *
¡dš
;

169 
_IO_FILE
 *
¡dout
;

170 
_IO_FILE
 *
¡d”r
;

172 
	#¡dš
 
¡dš


	)

173 
	#¡dout
 
¡dout


	)

174 
	#¡d”r
 
¡d”r


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$»move
 (cÚ¡ *
__fž’ame
è
__THROW
;

180 
	$»Çme
 (cÚ¡ *
__Þd
, cÚ¡ *
__Ãw
è
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifdeà
__USE_ATFILE


185 
	$»Çm—t
 (
__Þdfd
, cÚ¡ *
__Þd
, 
__Ãwfd
,

186 cÚ¡ *
__Ãw
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #iâdeà
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfže
 (è
__wur
;

197 #ifdeà
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfže
, (), 
tmpfže64
è
__wur
;

200 
	#tmpfže
 
tmpfže64


	)

204 #ifdeà
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfže64
 (è
__wur
;

209 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifdeà
__USE_MISC


215 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

219 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


227 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

228 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fþo£
 (
FILE
 *
__¡»am
);

242 
	`fæush
 (
FILE
 *
__¡»am
);

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_MISC


252 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

255 #ifdeà
__USE_GNU


262 
	`fþo£®l
 ();

266 
__BEGIN_NAMESPACE_STD


267 #iâdeà
__USE_FILE_OFFSET64


272 
FILE
 *
	$fÝ’
 (cÚ¡ *
__»¡riù
 
__fž’ame
,

273 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

278 
FILE
 *
	$äeÝ’
 (cÚ¡ *
__»¡riù
 
__fž’ame
,

279 cÚ¡ *
__»¡riù
 
__modes
,

280 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

282 #ifdeà
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fÝ’
, (cÚ¡ *
__»¡riù
 
__fž’ame
,

284 cÚ¡ *
__»¡riù
 
__modes
), 
fÝ’64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
äeÝ’
, (cÚ¡ *
__»¡riù
 
__fž’ame
,

287 cÚ¡ *
__»¡riù
 
__modes
,

288 
FILE
 *
__»¡riù
 
__¡»am
), 
äeÝ’64
)

289 
__wur
;

291 
	#fÝ’
 
fÝ’64


	)

292 
	#äeÝ’
 
äeÝ’64


	)

295 
__END_NAMESPACE_STD


296 #ifdeà
__USE_LARGEFILE64


297 
FILE
 *
	$fÝ’64
 (cÚ¡ *
__»¡riù
 
__fž’ame
,

298 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

299 
FILE
 *
	$äeÝ’64
 (cÚ¡ *
__»¡riù
 
__fž’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
,

301 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdÝ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fÝ’cook›
 (*
__»¡riù
 
__magic_cook›
,

313 cÚ¡ *
__»¡riù
 
__modes
,

314 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

317 #ifdeà
__USE_XOPEN2K8


319 
FILE
 *
	$fmemÝ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$Ý’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

337 
__modes
, 
size_t
 
__n
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

344 
size_t
 
__size
è
__THROW
;

347 
	$£Žšebuf
 (
FILE
 *
__¡»am
è
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

357 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

362 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	$¥rštf
 (*
__»¡riù
 
__s
,

365 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

371 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

372 
_G_va_li¡
 
__¬g
);

377 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

379 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

380 
_G_va_li¡
 
__¬g
è
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

387 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

388 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

390 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

391 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

392 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifdeà
__USE_GNU


399 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

400 
_G_va_li¡
 
__¬g
)

401 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

402 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

403 cÚ¡ *
__»¡riù
 
__fmt
, ...)

404 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

405 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

406 cÚ¡ *
__»¡riù
 
__fmt
, ...)

407 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

410 #ifdeà
__USE_XOPEN2K8


412 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

413 
_G_va_li¡
 
__¬g
)

414 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

415 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

426 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

431 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

434 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

436 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

444 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

445 
__isoc99_fsÿnf
è
__wur
;

446 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_sÿnf
è
__wur
;

448 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

449 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

450 
__isoc99_ssÿnf
);

452 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

454 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

455 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

456 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

457 
	#fsÿnf
 
__isoc99_fsÿnf


	)

458 
	#sÿnf
 
__isoc99_sÿnf


	)

459 
	#ssÿnf
 
__isoc99_ssÿnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

472 
_G_va_li¡
 
__¬g
)

473 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

479 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

480 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

483 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

484 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

485 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

487 #ià!
defšed
 
__USE_GNU
 \

488 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

489 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

490 #ifdeà
__REDIRECT


494 
	`__REDIRECT
 (
vfsÿnf
,

495 (
FILE
 *
__»¡riù
 
__s
,

496 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

497 
__isoc99_vfsÿnf
)

498 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

499 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

500 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

501 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

502 
	`__REDIRECT_NTH
 (
vssÿnf
,

503 (cÚ¡ *
__»¡riù
 
__s
,

504 cÚ¡ *
__»¡riù
 
__fÜm©
,

505 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

506 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

508 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

509 cÚ¡ *
__»¡riù
 
__fÜm©
,

510 
_G_va_li¡
 
__¬g
è
__wur
;

511 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

514 cÚ¡ *
__»¡riù
 
__fÜm©
,

515 
_G_va_li¡
 
__¬g
è
__THROW
;

516 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

517 
	#vsÿnf
 
__isoc99_vsÿnf


	)

518 
	#vssÿnf
 
__isoc99_vssÿnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fg‘c
 (
FILE
 *
__¡»am
);

532 
	`g‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘ch¬
 ();

539 
__END_NAMESPACE_STD


543 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

545 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


550 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

551 
	`g‘ch¬_uÆocked
 ();

554 #ifdeà
__USE_MISC


561 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

574 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putch¬
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

587 #ifdeà
__USE_MISC


594 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

597 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


602 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 
	`putch¬_uÆocked
 (
__c
);

607 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

608 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

610 
	`g‘w
 (
FILE
 *
__¡»am
);

613 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

623 
__wur
;

625 #ià!
defšed
 
__USE_ISOC11
 \

626 || (
defšed
 
__ýlu¥lus
 && __cplusplus <= 201103L)

638 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

640 
__END_NAMESPACE_STD


642 #ifdeà
__USE_GNU


649 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

650 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

668 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

669 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

670 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

678 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

679 
size_t
 *
__»¡riù
 
__n
,

680 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

695 
	`puts
 (cÚ¡ *
__s
);

702 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

709 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

715 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

716 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifdeà
__USE_GNU


726 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

727 
FILE
 *
__»¡riù
 
__¡»am
);

730 #ifdeà
__USE_MISC


737 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

754 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

759 
	`»wšd
 (
FILE
 *
__¡»am
);

760 
__END_NAMESPACE_STD


767 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


768 #iâdeà
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

778 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

780 #ifdeà
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#á–lo
 
á–lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #iâdeà
__USE_FILE_OFFSET64


798 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

803 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

805 #ifdeà
__REDIRECT


806 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

807 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

808 
	`__REDIRECT
 (
f£os
,

809 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

811 
	#fg‘pos
 
fg‘pos64


	)

812 
	#f£os
 
f£os64


	)

815 
__END_NAMESPACE_STD


817 #ifdeà
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

819 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

820 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

821 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$þ—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

828 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifdeà
__USE_MISC


835 
	$þ—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

836 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

837 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`³¼Ü
 (cÚ¡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<b™s/sys_”¾i¡.h
>

856 #ifdef 
__USE_POSIX


858 
	$fž’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

861 #ifdeà
__USE_MISC


863 
	$fž’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

867 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

868 
defšed
 
__USE_MISC
)

873 
FILE
 *
	$pÝ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

879 
	`pþo£
 (
FILE
 *
__¡»am
);

883 #ifdef 
__USE_POSIX


885 *
	$ù”mid
 (*
__s
è
__THROW
;

889 #ifdeà
__USE_XOPEN


891 *
	`cu£rid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
ob¡ack
;

899 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

901 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

902 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

903 cÚ¡ *
__»¡riù
 
__fÜm©
,

904 
_G_va_li¡
 
__¬gs
)

905 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

909 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


913 
	$æockfže
 (
FILE
 *
__¡»am
è
__THROW
;

917 
	$árylockfže
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

920 
	$fuÆockfže
 (
FILE
 *
__¡»am
è
__THROW
;

923 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


927 
	#__Ãed_g‘Ýt


	)

928 
	~<g‘Ýt.h
>

933 #ifdeà
__USE_EXTERN_INLINES


934 
	~<b™s/¡dio.h
>

936 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


937 
	~<b™s/¡dio2.h
>

939 #ifdeà
__LDBL_COMPAT


940 
	~<b™s/¡dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_BSD


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ýlu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ýlu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Þ
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Þl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Þd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Þ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifdeà
__USE_BSD


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Þl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Þ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Þl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Þd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Þ
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Þ
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Þ
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Þl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Þl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Þd_x
[3];

416 
__c
;

417 
__š™
;

418 
__ex‹nsiÚ__
 
__a
;

423 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

424 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

425 
	$”ªd48_r
 (
__xsubi
[3],

426 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

427 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

431 *
__»¡riù
 
__»suÉ
)

432 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

433 
	$Äªd48_r
 (
__xsubi
[3],

434 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

435 *
__»¡riù
 
__»suÉ
)

436 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

439 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

442 
	$j¿nd48_r
 (
__xsubi
[3],

443 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

444 *
__»¡riù
 
__»suÉ
)

445 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

448 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$lcÚg48_r
 (
__·¿m
[7],

455 
d¿nd48_d©a
 *
__bufãr
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

462 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


463 
	#__m®loc_ªd_ÿÎoc_defšed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

468 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

469 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

483 
	$ä“
 (*
__±r
è
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$cä“
 (*
__±r
è
__THROW
;

491 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


492 
	~<®loÿ.h
>

495 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

496 || 
defšed
 
__USE_BSD


498 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

501 #ifdeà
__USE_XOPEN2K


503 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

504 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

507 #ifdeà
__USE_ISOC11


509 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

510 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

521 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


523 #ifdeà
__ýlu¥lus


524 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

527 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

536 
__THROW
 
	`__nÚnuÎ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

545 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


549 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

551 
__END_NAMESPACE_STD


553 #ifdeà
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

565 
__END_NAMESPACE_STD


567 #ifdeà
__USE_GNU


570 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

571 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

574 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


578 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

581 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


584 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

585 
__THROW
 
	`__nÚnuÎ
 ((2));

588 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$þ—»nv
 (è
__THROW
;

599 #ià
defšed
 
__USE_MISC
 \

600 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fže_Çme
 (cÚ¡ *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sÞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
) (const *, const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
) (const *, const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

759 #ifdeà
__USE_EXTERN_INLINES


760 
	~<b™s/¡dlib-b£¬ch.h
>

765 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

766 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

767 #ifdeà
__USE_GNU


768 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

769 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

770 
	`__nÚnuÎ
 ((1, 4));

775 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

776 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

777 
__END_NAMESPACE_STD


779 #ifdeà
__USE_ISOC99


780 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

781 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

785 
__BEGIN_NAMESPACE_STD


789 
div_t
 
	$div
 (
__num”
, 
__d’om
)

790 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

791 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

792 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

793 
__END_NAMESPACE_STD


795 #ifdeà
__USE_ISOC99


796 
__BEGIN_NAMESPACE_C99


797 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

798 
__d’om
)

799 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

800 
__END_NAMESPACE_C99


804 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

805 || 
defšed
 
__USE_SVID


812 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

813 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

818 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

819 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

824 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

825 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

828 #ifdeà
__USE_MISC


830 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

831 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
)

832 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

833 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

834 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
)

835 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

836 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

837 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

842 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

843 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

844 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deýt
,

846 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

847 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

853 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

854 *
__»¡riù
 
__deýt
, *__»¡riù 
__sign
,

855 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

856 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

860 
__BEGIN_NAMESPACE_STD


863 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

866 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

867 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

870 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

874 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

875 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

877 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

878 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

879 
__THROW
;

880 
__END_NAMESPACE_STD


883 #ifdeà
__USE_SVID


888 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


899 
	$g‘subÝt
 (**
__»¡riù
 
__ÝtiÚp
,

900 *cÚ¡ *
__»¡riù
 
__tok’s
,

901 **
__»¡riù
 
__v®u•
)

902 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

906 #ifdeà
__USE_XOPEN


908 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

914 #ifdeà
__USE_XOPEN2KXSI


916 
	$posix_Ý’±
 (
__oæag
è
__wur
;

919 #ifdeà
__USE_XOPEN


924 
	$g¿Á±
 (
__fd
è
__THROW
;

928 
	$uÆock±
 (
__fd
è
__THROW
;

933 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

936 #ifdeà
__USE_GNU


940 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

941 
__THROW
 
	`__nÚnuÎ
 ((2));

944 
	`g‘±
 ();

947 #ifdeà
__USE_BSD


951 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

952 
__THROW
 
	`__nÚnuÎ
 ((1));

955 
	~<b™s/¡dlib-æßt.h
>

958 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


959 
	~<b™s/¡dlib.h
>

961 #ifdeà
__LDBL_COMPAT


962 
	~<b™s/¡dlib-ldbl.h
>

966 #undeà
__Ãed_m®loc_ªd_ÿÎoc


968 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

39 #ià
defšed
 
__ýlu¥lus
 && (__ýlu¥lu >ð199711L || 
__GNUC_PREREQ
 (4, 4))

40 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

44 
__BEGIN_NAMESPACE_STD


46 *
	$memýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

47 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

50 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

51 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 
__END_NAMESPACE_STD


57 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


58 *
	$memcýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

59 
__c
, 
size_t
 
__n
)

60 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

64 
__BEGIN_NAMESPACE_STD


66 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

69 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

70 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

73 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


76 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

77 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

79 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ifdeà
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__bužtš_memchr
 (
__s
, 
__c
, 
__n
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


91  
	`__bužtš_memchr
 (
__s
, 
__c
, 
__n
);

94 
	}
}

96 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

99 
__END_NAMESPACE_STD


101 #ifdeà
__USE_GNU


104 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


105 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

106 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

107 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

108 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

110 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

111 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

115 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


116 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

117 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

118 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

119 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

122 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

127 
__BEGIN_NAMESPACE_STD


129 *
	$¡rýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºýy
 (*
__»¡riù
 
__de¡
,

133 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

137 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

138 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

141 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

144 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

151 
	$¡rcÞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

154 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

155 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

156 
__THROW
 
	`__nÚnuÎ
 ((2));

157 
__END_NAMESPACE_STD


159 #ifdeà
__USE_XOPEN2K8


163 
	~<xloÿË.h
>

166 
	$¡rcÞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

169 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

170 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

173 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

174 || 
defšed
 
__USE_XOPEN2K8


176 *
	$¡rdup
 (cÚ¡ *
__s
)

177 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_XOPEN2K8


184 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

185 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

188 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


190 
	#¡rdu·
(
s
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Þd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Þd
) + 1; \

195 *
__Ãw
 = (*è
	`__bužtš_®loÿ
 (
__Ën
); \

196 (*è
	`memýy
 (
__Ãw
, 
__Þd
, 
__Ën
); \

197 
	}
}))

	)

200 
	#¡ºdu·
(
s
, 
n
) \

201 (
__ex‹nsiÚ__
 \

203 cÚ¡ *
__Þd
 = (
s
); \

204 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Þd
, (
n
)); \

205 *
__Ãw
 = (*è
	`__bužtš_®loÿ
 (
__Ën
 + 1); \

206 
__Ãw
[
__Ën
] = '\0'; \

207 (*è
	`memýy
 (
__Ãw
, 
__Þd
, 
__Ën
); \

208 }))

	)

211 
	g__BEGIN_NAMESPACE_STD


213 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


216 *
¡rchr
 (*
__s
, 
__c
)

217 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

218 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

219 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

221 #ifdeà
__OPTIMIZE__


222 
__ex‹º_®ways_šlše
 *

223 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


225  
__bužtš_¡rchr
 (
__s
, 
__c
);

228 
__ex‹º_®ways_šlše
 const *

229 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


231  
__bužtš_¡rchr
 (
__s
, 
__c
);

236 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

237 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


243 *
	`¡¼chr
 (*
__s
, 
__c
)

244 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

245 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

246 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

248 #ifdeà
__OPTIMIZE__


249 
__ex‹º_®ways_šlše
 *

250 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


252  
	`__bužtš_¡¼chr
 (
__s
, 
__c
);

255 
__ex‹º_®ways_šlše
 const *

256 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


258  
	`__bužtš_¡¼chr
 (
__s
, 
__c
);

261 
	}
}

263 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

264 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

266 
__END_NAMESPACE_STD


268 #ifdeà
__USE_GNU


271 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


272 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

273 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

274 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

275 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

278 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

282 
__BEGIN_NAMESPACE_STD


285 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

286 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

289 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

290 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


295 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

296 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

297 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

298 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

300 #ifdeà
__OPTIMIZE__


301 
__ex‹º_®ways_šlše
 *

302 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


304  
	`__bužtš_¡½brk
 (
__s
, 
__acû±
);

307 
__ex‹º_®ways_šlše
 const *

308 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


310  
	`__bužtš_¡½brk
 (
__s
, 
__acû±
);

313 
	}
}

315 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

316 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


322 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

323 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

324 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


331  
	`__bužtš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 const *

335 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


337  
	`__bužtš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 cÚ¡ *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

370 cÚ¡ *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempýy
 (*
__»¡riù
 
__de¡
,

389 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempýy
 (*
__»¡riù
 
__de¡
,

392 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcÝy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__bužtš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 const *

482 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


484  
	`__bužtš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__bužtš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 const *

510 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


512  
	`__bužtš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

530 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

534 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

535 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

538 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

539 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

542 #ifdef 
__USE_GNU


545 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

546 
__loÿË_t
 
__loc
)

547 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

549 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

550 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

551 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

554 #ifdef 
__USE_BSD


557 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

558 cÚ¡ *
__»¡riù
 
__d–im
)

559 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

562 #ifdef 
__USE_XOPEN2K8


564 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

567 *
	$__¡pýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

568 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$¡pýy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 *
	$__¡²ýy
 (*
__»¡riù
 
__de¡
,

575 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 *
	$¡²ýy
 (*
__»¡riù
 
__de¡
,

578 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

582 #ifdef 
__USE_GNU


584 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

585 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

588 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 #iâdeà
ba£Çme


598 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


599 "C++" *
	$ba£Çme
 (*
__fž’ame
)

600 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

601 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__fž’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

604 *
	$ba£Çme
 (cÚ¡ *
__fž’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

610 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

611 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

612 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ýlu¥lus


632 
	~<b™s/¡ršg.h
>

635 
	~<b™s/¡ršg2.h
>

638 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


640 
	~<b™s/¡ršg3.h
>

644 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_þock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__þock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_þock_t
)

53 
	#__þock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__þock_t
 
	tþock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
þock_t
)

66 #undeà
__Ãed_þock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__þockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_þockid_t
)

86 
	#__þockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__þockid_t
 
	tþockid_t
;

94 #undeà
__þockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
þock_t
 
	$þock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ð0 && ((y—rè% 100 !ð0 || (y—rè% 400 =ð0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$þock_g‘»s
 (
þockid_t
 
__þock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$þock_g‘time
 (
þockid_t
 
__þock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$þock_£‰ime
 (
þockid_t
 
__þock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`þock_Çno¦“p
 (
þockid_t
 
__þock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$þock_g‘ýuþockid
 (
pid_t
 
__pid
, 
þockid_t
 *
__þock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
þockid_t
 
__þock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

71 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

75 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

79 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

83 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

86 #ifdeà
__USE_XOPEN2K8


87 
	#_XOPEN_VERSION
 700

	)

88 #–ià
defšed
 
__USE_XOPEN2K


89 
	#_XOPEN_VERSION
 600

	)

90 #–ià
defšed
 
__USE_UNIX98


91 
	#_XOPEN_VERSION
 500

	)

93 
	#_XOPEN_VERSION
 4

	)

97 
	#_XOPEN_XCU_VERSION
 4

	)

100 
	#_XOPEN_XPG2
 1

	)

101 
	#_XOPEN_XPG3
 1

	)

102 
	#_XOPEN_XPG4
 1

	)

105 
	#_XOPEN_UNIX
 1

	)

108 
	#_XOPEN_CRYPT
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<b™s/posix_Ýt.h
>

205 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


206 
	~<b™s/’vœÚm’ts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<b™s/ty³s.h
>

219 #iâdef 
__ssize_t_defšed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_defšed


	)

224 
	#__Ãed_size_t


	)

225 
	#__Ãed_NULL


	)

226 
	~<¡ddef.h
>

228 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


231 #iâdeà
__gid_t_defšed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_defšed


	)

236 #iâdeà
__uid_t_defšed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_defšed


	)

241 #iâdeà
__off_t_defšed


242 #iâdeà
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_defšed


	)

249 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_defšed


	)

254 #iâdeà
__u£cÚds_t_defšed


255 
__u£cÚds_t
 
	tu£cÚds_t
;

256 
	#__u£cÚds_t_defšed


	)

259 #iâdeà
__pid_t_defšed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_defšed


	)

265 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


266 #iâdeà
__šŒ_t_defšed


267 
__šŒ_t
 
	tšŒ_t
;

268 
	#__šŒ_t_defšed


	)

272 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


273 #iâdeà
__sockËn_t_defšed


274 
__sockËn_t
 
	tsockËn_t
;

275 
	#__sockËn_t_defšed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

289 #ifdeà
__USE_GNU


292 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

293 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

297 
__THROW
 
	`__nÚnuÎ
 ((1));

300 #ifdeà
__USE_ATFILE


304 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fže
, 
__ty³
, 
__æag
)

305 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

310 #iâdef 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifdeà
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #iâdeà
__USE_FILE_OFFSET64


334 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

336 #ifdeà
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

338 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

339 
l£ek64
);

341 
	#l£ek
 
l£ek64


	)

344 #ifdeà
__USE_LARGEFILE64


345 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

346 
__THROW
;

353 
	`þo£
 (
__fd
);

360 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

366 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

368 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


369 #iâdeà
__USE_FILE_OFFSET64


376 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

377 
__off_t
 
__off£t
è
__wur
;

384 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__off£t
è
__wur
;

387 #ifdeà
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

389 
__off64_t
 
__off£t
),

390 
´—d64
è
__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

392 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

393 
pwr™e64
è
__wur
;

395 
	#´—d
 
´—d64


	)

396 
	#pwr™e
 
pwr™e64


	)

400 #ifdeà
__USE_LARGEFILE64


404 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

405 
__off64_t
 
__off£t
è
__wur
;

408 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__off£t
è
__wur
;

417 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

419 #ifdeà
__USE_GNU


422 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

432 
	$®¬m
 (
__£cÚds
è
__THROW
;

444 
	`¦“p
 (
__£cÚds
);

446 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

447 || 
defšed
 
__USE_BSD


452 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

453 
__THROW
;

460 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

469 
	`·u£
 ();

473 
	$chown
 (cÚ¡ *
__fže
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

476 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

483 
	$lchown
 (cÚ¡ *
__fže
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

488 #ifdeà
__USE_ATFILE


491 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fže
, 
__uid_t
 
__owÃr
,

492 
__gid_t
 
__group
, 
__æag
)

493 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

497 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

499 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


501 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

511 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

520 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

521 || 
defšed
 
__USE_BSD


525 *
	$g‘wd
 (*
__buf
)

526 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

531 
	$dup
 (
__fd
è
__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

536 #ifdeà
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

543 **
__’vœÚ
;

544 #ifdeà
__USE_GNU


545 **
’vœÚ
;

551 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

552 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

554 #ifdeà
__USE_XOPEN2K8


557 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

558 
__THROW
 
	`__nÚnuÎ
 ((2));

563 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

564 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

568 
	$exeþe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

569 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

573 
	$exeþ
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

578 
	$execvp
 (cÚ¡ *
__fže
, *cÚ¡ 
__¬gv
[])

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 
	$exeþp
 (cÚ¡ *
__fže
, cÚ¡ *
__¬g
, ...)

585 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 #ifdeà
__USE_GNU


590 
	$execv³
 (cÚ¡ *
__fže
, *cÚ¡ 
__¬gv
[],

591 *cÚ¡ 
__’vp
[])

592 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

596 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


598 
	$niû
 (
__šc
è
__THROW
 
__wur
;

603 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

609 
	~<b™s/cÚâame.h
>

612 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

613 
__THROW
 
	`__nÚnuÎ
 ((1));

616 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

619 
	$syscÚf
 (
__Çme
è
__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

628 
__pid_t
 
	$g‘pid
 (è
__THROW
;

631 
__pid_t
 
	$g‘µid
 (è
__THROW
;

634 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

637 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

638 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


639 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

646 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

648 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


660 
	$£g½
 (è
__THROW
;

667 
__pid_t
 
	$£tsid
 (è
__THROW
;

669 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


671 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

675 
__uid_t
 
	$g‘uid
 (è
__THROW
;

678 
__uid_t
 
	$g‘euid
 (è
__THROW
;

681 
__gid_t
 
	$g‘gid
 (è
__THROW
;

684 
__gid_t
 
	$g‘egid
 (è
__THROW
;

689 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

691 #ifdef 
__USE_GNU


693 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

700 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

702 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


705 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

708 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


710 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

717 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

719 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


722 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


727 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

730 #ifdeà
__USE_GNU


733 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

734 
__THROW
;

738 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

739 
__THROW
;

743 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

744 
__THROW
 
__wur
;

748 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

749 
__THROW
 
__wur
;

756 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

758 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

759 || 
defšed
 
__USE_BSD


764 
__pid_t
 
	$vfÜk
 (è
__THROW
;

770 *
	$‰yÇme
 (
__fd
è
__THROW
;

774 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

775 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

779 
	$i§‰y
 (
__fd
è
__THROW
;

781 #ià
defšed
 
__USE_BSD
 \

782 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

785 
	$‰y¦Ù
 (è
__THROW
;

790 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

791 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

793 #ifdeà
__USE_ATFILE


796 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

797 cÚ¡ *
__to
, 
__æags
)

798 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

801 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


803 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

804 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

809 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

810 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

811 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

814 #ifdeà
__USE_ATFILE


816 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

817 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

820 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

821 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

822 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

826 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

828 #ifdeà
__USE_ATFILE


830 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

831 
__THROW
 
	`__nÚnuÎ
 ((2));

835 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

839 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

842 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

849 *
	`g‘logš
 ();

850 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


857 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

860 #ifdef 
__USE_BSD


862 
	$£Žogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

866 #ifdef 
__USE_POSIX2


870 
	#__Ãed_g‘Ýt


	)

871 
	~<g‘Ýt.h
>

875 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


879 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

883 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

886 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

887 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

891 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

897 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

898 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

899 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

900 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

906 
	$vhªgup
 (è
__THROW
;

909 
	$»voke
 (cÚ¡ *
__fže
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

917 
	$´ofž
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

918 
size_t
 
__off£t
, 
__sÿË
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

925 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

929 *
	$g‘u£rsh–l
 (è
__THROW
;

930 
	$’du£rsh–l
 (è
__THROW
;

931 
	$£tu£rsh–l
 (è
__THROW
;

937 
	$d«mÚ
 (
__nochdœ
, 
__noþo£
è
__THROW
 
__wur
;

941 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

944 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

948 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

956 
	`fsync
 (
__fd
);

959 #ifdeà
__USE_GNU


962 
	$syncfs
 (
__fd
è
__THROW
;

966 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


969 
	`g‘ho¡id
 ();

972 
	$sync
 (è
__THROW
;

975 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


978 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

983 
	$g‘dbËsize
 (è
__THROW
;

989 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


992 #iâdeà
__USE_FILE_OFFSET64


993 
	$Œunÿ‹
 (cÚ¡ *
__fže
, 
__off_t
 
__Ëngth
)

994 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

996 #ifdeà
__REDIRECT_NTH


997 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

998 (cÚ¡ *
__fže
, 
__off64_t
 
__Ëngth
),

999 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1001 
	#Œunÿ‹
 
Œunÿ‹64


	)

1004 #ifdeà
__USE_LARGEFILE64


1005 
	$Œunÿ‹64
 (cÚ¡ *
__fže
, 
__off64_t
 
__Ëngth
)

1006 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1011 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_POSIX199309
 \

1012 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1015 #iâdeà
__USE_FILE_OFFSET64


1016 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1018 #ifdeà
__REDIRECT_NTH


1019 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1020 
árunÿ‹64
è
__wur
;

1022 
	#árunÿ‹
 
árunÿ‹64


	)

1025 #ifdeà
__USE_LARGEFILE64


1026 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1032 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1033 || 
defšed
 
__USE_MISC


1037 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1043 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1047 #ifdeà
__USE_MISC


1058 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1063 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1075 
	#F_ULOCK
 0

	)

1076 
	#F_LOCK
 1

	)

1077 
	#F_TLOCK
 2

	)

1078 
	#F_TEST
 3

	)

1080 #iâdeà
__USE_FILE_OFFSET64


1081 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1083 #ifdeà
__REDIRECT


1084 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1085 
lockf64
è
__wur
;

1087 
	#lockf
 
lockf64


	)

1090 #ifdeà
__USE_LARGEFILE64


1091 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1096 #ifdeà
__USE_GNU


1101 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1102 (
__ex‹nsiÚ__
 \

1103 ({ 
__»suÉ
; \

1104 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1105 
__»suÉ
 =ð-1L && 
”ºo
 =ð
EINTR
); \

1106 
__»suÉ
; 
	}
}))

	)

1109 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1112 
fd©async
 (
__fždes
);

1118 #ifdef 
__USE_XOPEN


1120 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1121 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1125 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1126 
__THROW
 
	`__nÚnuÎ
 ((1));

1133 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1134 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1140 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1142 *
	$ù”mid
 (*
__s
è
__THROW
;

1147 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1148 
	~<b™s/uni¡d.h
>

1151 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__bužtš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ð
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ð
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htÞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htÞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htÞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htÞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htÞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htÞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ð((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ýlu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ð1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ð2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ð((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘Ýt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ýlu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ýlu¥lus


57 *
Ýrg
;

71 
Ýtšd
;

76 
Ý‹¼
;

80 
ÝtÝt
;

82 #iâdeà
__Ãed_g‘Ýt


104 
	sÝtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#ÝtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘Ýt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtÝts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘Ýt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘Ýt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtÝts
),

161 
__posix_g‘Ýt
);

163 
__posix_g‘Ýt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtÝts
è
__THROW
;

165 
	#g‘Ýt
 
__posix_g‘Ýt


	)

169 
g‘Ýt
 ();

172 #iâdeà
__Ãed_g‘Ýt


173 
g‘Ýt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtÝts
,

175 cÚ¡ 
ÝtiÚ
 *
__lÚgÝts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘Ýt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtÝts
,

179 cÚ¡ 
ÝtiÚ
 *
__lÚgÝts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ýlu¥lus


189 #undeà
__Ãed_g‘Ýt


	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ð2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ýlu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


148 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

149 
	~<b™s/¡dio-lock.h
>

154 
	t_IO_lock_t
;

160 
	s_IO_m¬k”
 {

161 
_IO_m¬k”
 *
	m_Ãxt
;

162 
_IO_FILE
 *
	m_sbuf
;

166 
	m_pos
;

168 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

169 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

170 
	mpublic
:

171 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

172 ~
¡»amm¬k”
();

173 
§všg
(è{  
	m_¥os
 == -2; }

174 
d–
(
¡»amm¬k”
&);

175 
d–
();

180 
	e__codecvt_»suÉ


182 
	m__codecvt_ok
,

183 
	m__codecvt_·¹Ÿl
,

184 
	m__codecvt_”rÜ
,

185 
	m__codecvt_nocÚv


188 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


191 
	s_IO_codecvt


193 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

194 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

195 
	m__mb¡©e_t
 *,

196 cÚ¡ 
	mwch¬_t
 *,

197 cÚ¡ 
	mwch¬_t
 *,

198 cÚ¡ 
	mwch¬_t
 **, *,

200 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

201 
	m__mb¡©e_t
 *, *,

203 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

204 
	m__mb¡©e_t
 *,

206 cÚ¡ **, 
	mwch¬_t
 *,

207 
	mwch¬_t
 *, wchar_t **);

208 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

209 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

211 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

212 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

214 
_IO_icÚv_t
 
	m__cd_š
;

215 
_IO_icÚv_t
 
	m__cd_out
;

219 
	s_IO_wide_d©a


221 
wch¬_t
 *
	m_IO_»ad_±r
;

222 
wch¬_t
 *
	m_IO_»ad_’d
;

223 
wch¬_t
 *
	m_IO_»ad_ba£
;

224 
wch¬_t
 *
	m_IO_wr™e_ba£
;

225 
wch¬_t
 *
	m_IO_wr™e_±r
;

226 
wch¬_t
 *
	m_IO_wr™e_’d
;

227 
wch¬_t
 *
	m_IO_buf_ba£
;

228 
wch¬_t
 *
	m_IO_buf_’d
;

230 
wch¬_t
 *
	m_IO_§ve_ba£
;

231 
wch¬_t
 *
	m_IO_backup_ba£
;

233 
wch¬_t
 *
	m_IO_§ve_’d
;

235 
__mb¡©e_t
 
	m_IO_¡©e
;

236 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

237 
_IO_codecvt
 
	m_codecvt
;

239 
wch¬_t
 
	m_shÜtbuf
[1];

241 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

245 
	s_IO_FILE
 {

246 
	m_æags
;

247 
	#_IO_fže_æags
 
_æags


	)

251 * 
	m_IO_»ad_±r
;

252 * 
	m_IO_»ad_’d
;

253 * 
	m_IO_»ad_ba£
;

254 * 
	m_IO_wr™e_ba£
;

255 * 
	m_IO_wr™e_±r
;

256 * 
	m_IO_wr™e_’d
;

257 * 
	m_IO_buf_ba£
;

258 * 
	m_IO_buf_’d
;

260 *
	m_IO_§ve_ba£
;

261 *
	m_IO_backup_ba£
;

262 *
	m_IO_§ve_’d
;

264 
_IO_m¬k”
 *
	m_m¬k”s
;

266 
_IO_FILE
 *
	m_chaš
;

268 
	m_fž’o
;

270 
	m_blksize
;

272 
	m_æags2
;

274 
_IO_off_t
 
	m_Þd_off£t
;

276 
	#__HAVE_COLUMN


	)

278 
	m_cur_cÞumn
;

279 sigÃd 
	m_vbË_off£t
;

280 
	m_shÜtbuf
[1];

284 
_IO_lock_t
 *
	m_lock
;

285 #ifdeà
_IO_USE_OLD_IO_FILE


288 
	s_IO_FILE_com¶‘e


290 
_IO_FILE
 
	m_fže
;

292 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

293 
_IO_off64_t
 
	m_off£t
;

294 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


296 
_IO_codecvt
 *
	m_codecvt
;

297 
_IO_wide_d©a
 *
	m_wide_d©a
;

298 
_IO_FILE
 *
	m_ä“»s_li¡
;

299 *
	m_ä“»s_buf
;

300 
size_t
 
	m_ä“»s_size
;

302 *
	m__·d1
;

303 *
	m__·d2
;

304 *
	m__·d3
;

305 *
	m__·d4
;

306 
size_t
 
	m__·d5
;

308 
	m_mode
;

310 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

314 #iâdeà
__ýlu¥lus


315 
_IO_FILE
 
	t_IO_FILE
;

318 
	g_IO_FILE_¶us
;

320 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

321 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

322 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

323 #iâdeà
_LIBC


324 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

325 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

326 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

328 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

329 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

330 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

338 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

346 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

347 
	tsize_t
 
	t__n
);

355 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

358 
	t__io_þo£_â
 (*
	t__cook›
);

361 #ifdeà
_GNU_SOURCE


363 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

364 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

365 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

366 
__io_þo£_â
 
	tcook›_þo£_funùiÚ_t
;

371 
__io_»ad_â
 *
	m»ad
;

372 
__io_wr™e_â
 *
	mwr™e
;

373 
__io_£ek_â
 *
	m£ek
;

374 
__io_þo£_â
 *
	mþo£
;

375 } 
	t_IO_cook›_io_funùiÚs_t
;

376 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

378 
	g_IO_cook›_fže
;

381 
_IO_cook›_š™
 (
_IO_cook›_fže
 *
__cfže
, 
__»ad_wr™e
,

382 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

386 #ifdeà
__ýlu¥lus


390 
__und”æow
 (
_IO_FILE
 *);

391 
__uæow
 (
_IO_FILE
 *);

392 
__ov”æow
 (
_IO_FILE
 *, );

393 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


394 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

395 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

396 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

399 #ià 
__GNUC__
 >= 3

400 
	#_IO_BE
(
ex´
, 
»s
è
	`__bužtš_ex³ù
 (Óx´),„es)

	)

402 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

405 
	#_IO_g‘c_uÆocked
(
_å
) \

406 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ð(_å)->
_IO_»ad_’d
, 0) \

407 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

408 
	#_IO_³ekc_uÆocked
(
_å
) \

409 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ð(_å)->
_IO_»ad_’d
, 0) \

410 && 
	`__und”æow
 (
_å
è=ð
EOF
 ? EOF \

411 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

412 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

413 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ð(_å)->
_IO_wr™e_’d
, 0) \

414 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

415 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

417 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


418 
	#_IO_g‘wc_uÆocked
(
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ð
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

421 >ð(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

422 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

423 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

424 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ð
NULL
 \

425 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

426 >ð(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

427 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

428 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

431 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ð0)

	)

432 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ð0)

	)

434 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

435 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

436 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

437 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

439 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

442 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

443 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

445 
_IO_æockfže
 (
_IO_FILE
 *è
__THROW
;

446 
_IO_fuÆockfže
 (
_IO_FILE
 *è
__THROW
;

447 
_IO_árylockfže
 (
_IO_FILE
 *è
__THROW
;

449 #ifdeà
_IO_MTSAFE_IO


450 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

451 
	#_IO_æockfže
(
_å
) \

452 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ð0è
	`_IO_æockfže
 (_å)

	)

453 
	#_IO_fuÆockfže
(
_å
) \

454 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ð0è
	`_IO_fuÆockfže
 (_å)

	)

456 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

457 
	#_IO_æockfže
(
_å
è

	)

458 
	#_IO_fuÆockfže
(
_å
è

	)

459 
	#_IO_árylockfže
(
_å
è

	)

460 
	#_IO_þ—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

461 
	#_IO_þ—nup_»giÚ_’d
(
_Do™
è

	)

464 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

465 
_IO_va_li¡
, *
__»¡riù
);

466 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

467 
_IO_va_li¡
);

468 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

469 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

471 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

472 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

474 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

476 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


477 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

478 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

479 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

480 #ià
__GNUC__
 >= 2

483 #ià
defšed
 
_LIBC
 && defšed 
SHARED


484 
	~<shlib-com·t.h
>

485 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

486 
	#_IO_fwide_maybe_šcom·tibË
 \

487 (
	`__bužtš_ex³ù
 (&
_IO_¡dš_u£d
 =ð
NULL
, 0))

	)

488 cÚ¡ 
_IO_¡dš_u£d
;

489 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

492 #iâdeà
_IO_fwide_maybe_šcom·tibË


493 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

497 
	#_IO_fwide
(
__å
, 
__mode
) \

498 ({ 
__»suÉ
 = (
__mode
); \

499 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

501 ià((
__å
)->
_mode
 == 0) \

503 (
__å
)->
_mode
 = -1; \

504 
__»suÉ
 = (
__å
)->
_mode
; \

506 ià(
	`__bužtš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

507 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

509 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

510 
__»suÉ
; })

	)

513 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

514 
_IO_va_li¡
, *
__»¡riù
);

515 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

516 
_IO_va_li¡
);

517 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

518 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

521 #ifdeà
__LDBL_COMPAT


522 
	~<b™s/libio-ldbl.h
>

525 #ifdeà
__ýlu¥lus


	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tÞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
) (*, const *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
) (const *, const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 cÚ¡ *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ýlu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ýlu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsýy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

150 
wch¬_t
 *
	$wc¢ýy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

151 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

158 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

159 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

164 
__THROW
 
__©Œibu‹_pu»__
;

166 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__©Œibu‹_pu»__
;

168 
__END_NAMESPACE_STD


170 #ifdeà
__USE_XOPEN2K8


172 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

175 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

176 
size_t
 
__n
è
__THROW
;

180 
	~<xloÿË.h
>

182 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

183 
__loÿË_t
 
__loc
è
__THROW
;

185 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscÞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

196 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

197 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

198 
__END_NAMESPACE_STD


200 #ifdeà
__USE_XOPEN2K8


206 
	$wcscÞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

207 
__loÿË_t
 
__loc
è
__THROW
;

212 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

213 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

216 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
__©Œibu‹_pu»__
;

231 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

233 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
__©Œibu‹_pu»__
;

240 
__END_NAMESPACE_STD


242 #ifdeà
__USE_GNU


245 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

246 
__THROW
 
__©Œibu‹_pu»__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

253 
__THROW
 
__©Œibu‹_pu»__
;

256 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

257 
__THROW
 
__©Œibu‹_pu»__
;

259 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

262 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

263 cÚ¡ 
wch¬_t
 *
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

266 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

267 
__THROW
 
__©Œibu‹_pu»__
;

270 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

273 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

274 cÚ¡ 
wch¬_t
 *
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

277 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

278 
__THROW
 
__©Œibu‹_pu»__
;

282 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

283 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

284 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

287 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

288 
__END_NAMESPACE_STD


290 #ifdeà
__USE_XOPEN


292 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

295 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

296 cÚ¡ 
wch¬_t
 *
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

299 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

300 
__THROW
 
__©Œibu‹_pu»__
;

304 #ifdeà
__USE_XOPEN2K8


306 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

307 
__THROW
 
__©Œibu‹_pu»__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

316 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

320 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

321 
__THROW
 
__©Œibu‹_pu»__
;

325 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__©Œibu‹_pu»__
;

329 
wch¬_t
 *
	$wmemýy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

330 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

334 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdeà
__USE_GNU


344 
wch¬_t
 *
	$wmempýy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

345 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

357 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

361 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

365 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

366 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

367 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

370 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

371 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

377 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

378 
__END_NAMESPACE_STD


380 #ifdeà
__USE_EXTERN_INLINES


386 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

387 
__ex‹º_šlše
 
wšt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__bužtš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

392 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

393 
__ex‹º_šlše
 

394 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

395 {  (
	`__bužtš_cÚ¡ªt_p
 (
__wc
è&& __wø>ð
L
'\0' && __wc <= L'\x7f'

396 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

398 
__ex‹º_šlše
 
size_t


399 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

400 
mb¡©e_t
 *
__»¡riù
 
__ps
))

401 {  (
__ps
 !ð
NULL


402 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

409 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

410 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

415 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

416 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

424 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

425 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

429 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

430 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

431 
size_t
 
__nwc
, size_ˆ
__Ën
,

432 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

437 #ifdeà
__USE_XOPEN


439 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

443 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

451 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

452 
__END_NAMESPACE_STD


454 #ifdeà
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
	$wc¡Þd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

460 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc¡Þ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

469 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

473 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

474 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #ifdeà
__USE_ISOC99


479 
__BEGIN_NAMESPACE_C99


482 
__ex‹nsiÚ__


483 
	$wc¡Þl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

484 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

485 
__THROW
;

489 
__ex‹nsiÚ__


490 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

491 
wch¬_t
 **
__»¡riù
 
__’d±r
,

492 
__ba£
è
__THROW
;

493 
__END_NAMESPACE_C99


496 #ifdeà
__USE_GNU


499 
__ex‹nsiÚ__


500 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

501 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

502 
__THROW
;

506 
__ex‹nsiÚ__


507 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

508 
wch¬_t
 **
__»¡riù
 
__’d±r
,

509 
__ba£
è
__THROW
;

512 #ifdeà
__USE_GNU


526 
	~<xloÿË.h
>

530 
	$wc¡Þ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

531 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

532 
__loÿË_t
 
__loc
è
__THROW
;

534 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

535 
wch¬_t
 **
__»¡riù
 
__’d±r
,

536 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

538 
__ex‹nsiÚ__


539 
	$wc¡Þl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

540 
wch¬_t
 **
__»¡riù
 
__’d±r
,

541 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

543 
__ex‹nsiÚ__


544 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

545 
wch¬_t
 **
__»¡riù
 
__’d±r
,

546 
__ba£
, 
__loÿË_t
 
__loc
)

547 
__THROW
;

549 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

550 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

551 
__THROW
;

553 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

554 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

555 
__THROW
;

557 
	$wc¡Þd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

558 
wch¬_t
 **
__»¡riù
 
__’d±r
,

559 
__loÿË_t
 
__loc
è
__THROW
;

563 #ifdeà
__USE_XOPEN2K8


566 
wch¬_t
 *
	$wýýy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

567 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

571 
wch¬_t
 *
	$wýnýy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

572 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$Ý’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

583 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

594 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

595 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

605 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

606 
__THROW
 ;

612 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

613 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

614 
__gnuc_va_li¡
 
__¬g
)

620 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

621 
__gnuc_va_li¡
 
__¬g
)

625 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

626 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

627 
__gnuc_va_li¡
 
__¬g
)

628 
__THROW
 ;

635 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

636 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

646 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

647 
__THROW
 ;

649 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

650 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

651 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

652 #ifdeà
__REDIRECT


656 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

657 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_fwsÿnf
)

660 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_wsÿnf
)

663 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

664 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

665 ...), 
__isoc99_swsÿnf
)

668 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

669 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

670 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

671 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

673 
__THROW
;

674 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

675 
	#wsÿnf
 
__isoc99_wsÿnf


	)

676 
	#swsÿnf
 
__isoc99_swsÿnf


	)

680 
__END_NAMESPACE_STD


683 #ifdeà
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

690 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

691 
__gnuc_va_li¡
 
__¬g
)

697 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

698 
__gnuc_va_li¡
 
__¬g
)

701 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

702 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

703 
__gnuc_va_li¡
 
__¬g
)

704 
__THROW
 ;

706 #ià!
defšed
 
__USE_GNU
 \

707 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

708 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

711 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

714 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

717 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

718 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

719 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

722 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

723 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
);

727 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

728 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

730 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

731 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

732 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

746 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

752 
wšt_t
 
	`g‘wch¬
 ();

759 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

760 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

766 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

774 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

775 
__FILE
 *
__»¡riù
 
__¡»am
);

781 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

782 
__FILE
 *
__»¡riù
 
__¡»am
);

789 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

790 
__END_NAMESPACE_STD


793 #ifdeà
__USE_GNU


801 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

802 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

810 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

818 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

827 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

828 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

837 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

838 
__FILE
 *
__»¡riù
 
__¡»am
);

846 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

847 
__FILE
 *
__»¡riù
 
__¡»am
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

856 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

857 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

858 
__END_NAMESPACE_C99


860 #ifdeà
__USE_GNU


861 
	~<xloÿË.h
>

865 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

866 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

867 cÚ¡ 
tm
 *
__»¡riù
 
__
,

868 
__loÿË_t
 
__loc
è
__THROW
;

877 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


878 
	#__Ãed_iswxxx


	)

879 
	~<wùy³.h
>

883 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


884 
	~<b™s/wch¬2.h
>

887 #ifdeà
__LDBL_COMPAT


888 
	~<b™s/wch¬-ldbl.h
>

891 
__END_DECLS


899 #undeà
__Ãed_mb¡©e_t


900 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ð
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´Ý”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´Ý”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´Ý”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´Ý”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
285
6859
lcommon/inc/blk_prediction.h
lcommon/inc/config_common.h
lcommon/inc/ctx_tables.h
lcommon/inc/distortion.h
lcommon/inc/enc_statistics.h
lcommon/inc/fast_memory.h
lcommon/inc/frame.h
lcommon/inc/ifunctions.h
lcommon/inc/img_io.h
lcommon/inc/img_process.h
lcommon/inc/img_process_types.h
lcommon/inc/input.h
lcommon/inc/io_image.h
lcommon/inc/io_raw.h
lcommon/inc/io_tiff.h
lcommon/inc/io_video.h
lcommon/inc/lagrangian.h
lcommon/inc/mb_access.h
lcommon/inc/mbuffer_common.h
lcommon/inc/memalloc.h
lcommon/inc/mv_prediction.h
lcommon/inc/nalucommon.h
lcommon/inc/parsetcommon.h
lcommon/inc/quant_params.h
lcommon/inc/report.h
lcommon/inc/resize.h
lcommon/inc/transform.h
lcommon/inc/typedefs.h
lcommon/inc/types.h
lcommon/inc/vui_params.h
lcommon/inc/win32.h
lcommon/src/blk_prediction.c
lcommon/src/config_common.c
lcommon/src/img_io.c
lcommon/src/img_process.c
lcommon/src/input.c
lcommon/src/io_raw.c
lcommon/src/io_tiff.c
lcommon/src/mbuffer_common.c
lcommon/src/memalloc.c
lcommon/src/mv_prediction.c
lcommon/src/nalucommon.c
lcommon/src/parsetcommon.c
lcommon/src/resize.c
lcommon/src/transform.c
lcommon/src/win32.c
lencod/inc/annexb.h
lencod/inc/biariencode.h
lencod/inc/block.h
lencod/inc/cabac.h
lencod/inc/cconv_yuv2rgb.h
lencod/inc/configfile.h
lencod/inc/conformance.h
lencod/inc/context_ini.h
lencod/inc/contributors.h
lencod/inc/defines.h
lencod/inc/elements.h
lencod/inc/errdo.h
lencod/inc/errdo_dist_mhyp.h
lencod/inc/explicit_gop.h
lencod/inc/explicit_seq.h
lencod/inc/filehandle.h
lencod/inc/fmo.h
lencod/inc/get_block_otf.h
lencod/inc/global.h
lencod/inc/header.h
lencod/inc/hme_distortion.h
lencod/inc/image.h
lencod/inc/img_chroma.h
lencod/inc/img_dist_ms_ssim.h
lencod/inc/img_dist_snr.h
lencod/inc/img_dist_ssim.h
lencod/inc/img_distortion.h
lencod/inc/img_luma.h
lencod/inc/intra16x16.h
lencod/inc/intra4x4.h
lencod/inc/intra8x8.h
lencod/inc/intrarefresh.h
lencod/inc/lambda.h
lencod/inc/leaky_bucket.h
lencod/inc/list_reorder.h
lencod/inc/lln_mc_prediction.h
lencod/inc/loop_filter.h
lencod/inc/macroblock.h
lencod/inc/macroblock_p444.h
lencod/inc/mbuffer.h
lencod/inc/mc_prediction.h
lencod/inc/mc_prediction_otf.h
lencod/inc/md_common.h
lencod/inc/md_distortion.h
lencod/inc/me_distortion.h
lencod/inc/me_distortion_otf.h
lencod/inc/me_epzs.h
lencod/inc/me_epzs_common.h
lencod/inc/me_epzs_int.h
lencod/inc/me_fullfast.h
lencod/inc/me_fullfast_otf.h
lencod/inc/me_fullsearch.h
lencod/inc/me_hme.h
lencod/inc/me_umhex.h
lencod/inc/me_umhexsmp.h
lencod/inc/mmco.h
lencod/inc/mode_decision.h
lencod/inc/mode_decision_p8x8.h
lencod/inc/mv_search.h
lencod/inc/nal.h
lencod/inc/nalu.h
lencod/inc/output.h
lencod/inc/params.h
lencod/inc/parset.h
lencod/inc/pred_struct.h
lencod/inc/pred_struct_adapt.h
lencod/inc/pred_struct_adapt_types.h
lencod/inc/pred_struct_types.h
lencod/inc/q_around.h
lencod/inc/q_matrix.h
lencod/inc/q_offsets.h
lencod/inc/quant4x4.h
lencod/inc/quant8x8.h
lencod/inc/quantChroma.h
lencod/inc/ratectl.h
lencod/inc/rc_quadratic.h
lencod/inc/rc_types.h
lencod/inc/rd_intra_jm.h
lencod/inc/rd_intra_jm444.h
lencod/inc/rdopt.h
lencod/inc/rdopt_coding_state.h
lencod/inc/rdoq.h
lencod/inc/refbuf.h
lencod/inc/refbuf_otf.h
lencod/inc/rtp.h
lencod/inc/sei.h
lencod/inc/slice.h
lencod/inc/symbol.h
lencod/inc/transform8x8.h
lencod/inc/vlc.h
lencod/inc/wp.h
lencod/inc/wp_lms.h
lencod/inc/wp_mciter.h
lencod/inc/wp_mcprec.h
lencod/inc/wp_periodic.h
lencod/inc/wp_random.h
lencod/src/annexb.c
lencod/src/biariencode.c
lencod/src/block.c
lencod/src/cabac.c
lencod/src/cconv_yuv2rgb.c
lencod/src/configfile.c
lencod/src/conformance.c
lencod/src/context_ini.c
lencod/src/errdo.c
lencod/src/errdo_dist_mhyp.c
lencod/src/explicit_gop.c
lencod/src/explicit_seq.c
lencod/src/filehandle.c
lencod/src/fmo.c
lencod/src/get_block_otf.c
lencod/src/header.c
lencod/src/hme_distortion.c
lencod/src/hme_luma.c
lencod/src/image.c
lencod/src/image_mp.c
lencod/src/img_chroma.c
lencod/src/img_dist_ms_ssim.c
lencod/src/img_dist_snr.c
lencod/src/img_dist_ssim.c
lencod/src/img_distortion.c
lencod/src/img_luma.c
lencod/src/intra16x16.c
lencod/src/intra4x4.c
lencod/src/intra8x8.c
lencod/src/intra_chroma.c
lencod/src/intrarefresh.c
lencod/src/lambda.c
lencod/src/leaky_bucket.c
lencod/src/lencod.c
lencod/src/list_reorder.c
lencod/src/lln_mc_prediction.c
lencod/src/loopFilter.c
lencod/src/loop_filter_mbaff.c
lencod/src/loop_filter_normal.c
lencod/src/macroblock.c
lencod/src/macroblock_P444.c
lencod/src/mb_access.c
lencod/src/mbuffer.c
lencod/src/mc_prediction.c
lencod/src/mc_prediction_otf.c
lencod/src/md_common.c
lencod/src/md_distortion.c
lencod/src/md_high.c
lencod/src/md_high_updated.c
lencod/src/md_highfast.c
lencod/src/md_highloss.c
lencod/src/md_low.c
lencod/src/me_distortion.c
lencod/src/me_distortion_otf.c
lencod/src/me_epzs.c
lencod/src/me_epzs_common.c
lencod/src/me_epzs_int.c
lencod/src/me_epzs_sub.c
lencod/src/me_fullfast.c
lencod/src/me_fullfast_otf.c
lencod/src/me_fullsearch.c
lencod/src/me_hme.c
lencod/src/me_umhex.c
lencod/src/me_umhexsmp.c
lencod/src/mmco.c
lencod/src/mode_decision.c
lencod/src/mode_decision_P8x8.c
lencod/src/mv_direct.c
lencod/src/mv_search.c
lencod/src/nal.c
lencod/src/nalu.c
lencod/src/output.c
lencod/src/parset.c
lencod/src/pred_struct.c
lencod/src/q_around.c
lencod/src/q_matrix.c
lencod/src/q_offsets.c
lencod/src/quant4x4.c
lencod/src/quant4x4_2step.c
lencod/src/quant4x4_around.c
lencod/src/quant4x4_normal.c
lencod/src/quant4x4_trellis.c
lencod/src/quant8x8.c
lencod/src/quant8x8_around.c
lencod/src/quant8x8_normal.c
lencod/src/quant8x8_trellis.c
lencod/src/quantChroma.c
lencod/src/quantChroma_2step.c
lencod/src/quantChroma_around.c
lencod/src/quantChroma_normal.c
lencod/src/quantChroma_trellis.c
lencod/src/ratectl.c
lencod/src/rc_quadratic.c
lencod/src/rd_intra_jm.c
lencod/src/rd_intra_jm444.c
lencod/src/rd_intra_jm_low.c
lencod/src/rdopt.c
lencod/src/rdopt_coding_state.c
lencod/src/rdoq.c
lencod/src/rdoq_cabac.c
lencod/src/rdoq_cavlc.c
lencod/src/rdpicdecision.c
lencod/src/report.c
lencod/src/rtp.c
lencod/src/sei.c
lencod/src/slice.c
lencod/src/symbol.c
lencod/src/transform8x8.c
lencod/src/transform8x8_H444.c
lencod/src/vlc.c
lencod/src/weighted_prediction.c
lencod/src/wp_lms.c
lencod/src/wp_mciter.c
lencod/src/wp_mcprec.c
lencod/src/wp_periodic.c
lencod/src/wp_random.c
rtp_loss/rtp_loss.cpp
rtp_loss/rtp_loss.h
rtpdump/rtpdump.cpp
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/fcntl.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/memory.h
/usr/include/netinet/in.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
